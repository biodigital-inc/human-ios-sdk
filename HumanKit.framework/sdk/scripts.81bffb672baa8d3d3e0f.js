var glMatrix={EPSILON:1e-6};glMatrix.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,glMatrix.RANDOM=Math.random,glMatrix.setMatrixArrayType=function(e){glMatrix.ARRAY_TYPE=e};var degree=Math.PI/180;glMatrix.toRadian=function(e){return e*degree},glMatrix.equals=function(e,t){return Math.abs(e-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))};var mat4={create:function(){var e=new glMatrix.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,r,i,a,n,o,s,l,c,u,_,h,f,d,m){var p=new glMatrix.ARRAY_TYPE(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=i,p[4]=a,p[5]=n,p[6]=o,p[7]=s,p[8]=l,p[9]=c,p[10]=u,p[11]=_,p[12]=h,p[13]=f,p[14]=d,p[15]=m,p},set:function(e,t,r,i,a,n,o,s,l,c,u,_,h,f,d,m,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=n,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=_,e[11]=h,e[12]=f,e[13]=d,e[14]=m,e[15]=p,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(e===t){var r=t[1],i=t[2],a=t[3],n=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=a,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15],y=r*s-i*o,v=r*l-a*o,S=r*c-n*o,E=i*l-a*s,b=i*c-n*s,I=a*c-n*l,x=u*m-_*d,C=u*p-h*d,T=u*g-f*d,N=_*p-h*m,D=_*g-f*m,A=h*g-f*p,P=y*A-v*D+S*N+E*T-b*C+I*x;return P?(e[0]=(s*A-l*D+c*N)*(P=1/P),e[1]=(a*D-i*A-n*N)*P,e[2]=(m*I-p*b+g*E)*P,e[3]=(h*b-_*I-f*E)*P,e[4]=(l*T-o*A-c*C)*P,e[5]=(r*A-a*T+n*C)*P,e[6]=(p*S-d*I-g*v)*P,e[7]=(u*I-h*S+f*v)*P,e[8]=(o*D-s*T+c*x)*P,e[9]=(i*T-r*D-n*x)*P,e[10]=(d*b-m*S+g*y)*P,e[11]=(_*S-u*b-f*y)*P,e[12]=(s*C-o*N-l*x)*P,e[13]=(r*N-i*C+a*x)*P,e[14]=(m*v-d*E-p*y)*P,e[15]=(u*E-_*v+h*y)*P,e):null},adjoint:function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15];return e[0]=s*(h*g-f*p)-_*(l*g-c*p)+m*(l*f-c*h),e[1]=-(i*(h*g-f*p)-_*(a*g-n*p)+m*(a*f-n*h)),e[2]=i*(l*g-c*p)-s*(a*g-n*p)+m*(a*c-n*l),e[3]=-(i*(l*f-c*h)-s*(a*f-n*h)+_*(a*c-n*l)),e[4]=-(o*(h*g-f*p)-u*(l*g-c*p)+d*(l*f-c*h)),e[5]=r*(h*g-f*p)-u*(a*g-n*p)+d*(a*f-n*h),e[6]=-(r*(l*g-c*p)-o*(a*g-n*p)+d*(a*c-n*l)),e[7]=r*(l*f-c*h)-o*(a*f-n*h)+u*(a*c-n*l),e[8]=o*(_*g-f*m)-u*(s*g-c*m)+d*(s*f-c*_),e[9]=-(r*(_*g-f*m)-u*(i*g-n*m)+d*(i*f-n*_)),e[10]=r*(s*g-c*m)-o*(i*g-n*m)+d*(i*c-n*s),e[11]=-(r*(s*f-c*_)-o*(i*f-n*_)+u*(i*c-n*s)),e[12]=-(o*(_*p-h*m)-u*(s*p-l*m)+d*(s*h-l*_)),e[13]=r*(_*p-h*m)-u*(i*p-a*m)+d*(i*h-a*_),e[14]=-(r*(s*p-l*m)-o*(i*p-a*m)+d*(i*l-a*s)),e[15]=r*(s*h-l*_)-o*(i*h-a*_)+u*(i*l-a*s),e},determinant:function(e){var t=e[0],r=e[1],i=e[2],a=e[3],n=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],_=e[10],h=e[11],f=e[12],d=e[13],m=e[14],p=e[15];return(t*o-r*n)*(_*p-h*m)-(t*s-i*n)*(u*p-h*d)+(t*l-a*n)*(u*m-_*d)+(r*s-i*o)*(c*p-h*f)-(r*l-a*o)*(c*m-_*f)+(i*l-a*s)*(c*d-u*f)},multiply:function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=t[9],f=t[10],d=t[11],m=t[12],p=t[13],g=t[14],y=t[15],v=r[0],S=r[1],E=r[2],b=r[3];return e[0]=v*i+S*s+E*_+b*m,e[1]=v*a+S*l+E*h+b*p,e[2]=v*n+S*c+E*f+b*g,e[3]=v*o+S*u+E*d+b*y,e[4]=(v=r[4])*i+(S=r[5])*s+(E=r[6])*_+(b=r[7])*m,e[5]=v*a+S*l+E*h+b*p,e[6]=v*n+S*c+E*f+b*g,e[7]=v*o+S*u+E*d+b*y,e[8]=(v=r[8])*i+(S=r[9])*s+(E=r[10])*_+(b=r[11])*m,e[9]=v*a+S*l+E*h+b*p,e[10]=v*n+S*c+E*f+b*g,e[11]=v*o+S*u+E*d+b*y,e[12]=(v=r[12])*i+(S=r[13])*s+(E=r[14])*_+(b=r[15])*m,e[13]=v*a+S*l+E*h+b*p,e[14]=v*n+S*c+E*f+b*g,e[15]=v*o+S*u+E*d+b*y,e}};mat4.mul=mat4.multiply,mat4.translate=function(e,t,r){var i,a,n,o,s,l,c,u,_,h,f,d,m=r[0],p=r[1],g=r[2];return t===e?(e[12]=t[0]*m+t[4]*p+t[8]*g+t[12],e[13]=t[1]*m+t[5]*p+t[9]*g+t[13],e[14]=t[2]*m+t[6]*p+t[10]*g+t[14],e[15]=t[3]*m+t[7]*p+t[11]*g+t[15]):(a=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=t[9],f=t[10],d=t[11],e[0]=i=t[0],e[1]=a,e[2]=n,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=_,e[9]=h,e[10]=f,e[11]=d,e[12]=i*m+s*p+_*g+t[12],e[13]=a*m+l*p+h*g+t[13],e[14]=n*m+c*p+f*g+t[14],e[15]=o*m+u*p+d*g+t[15]),e},mat4.scale=function(e,t,r){var i=r[0],a=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.rotate=function(e,t,r,i){var a,n,o,s,l,c,u,_,h,f,d,m,p,g,y,v,S,E,b,I,x,C,T,N,D=i[0],A=i[1],P=i[2],M=Math.sqrt(D*D+A*A+P*P);return Math.abs(M)<glMatrix.EPSILON?null:(D*=M=1/M,A*=M,P*=M,a=Math.sin(r),n=Math.cos(r),l=t[1],c=t[2],u=t[3],h=t[5],f=t[6],d=t[7],p=t[9],g=t[10],y=t[11],b=D*A*(o=1-n)-P*a,I=A*A*o+n,x=P*A*o+D*a,C=D*P*o+A*a,T=A*P*o-D*a,N=P*P*o+n,e[0]=(s=t[0])*(v=D*D*o+n)+(_=t[4])*(S=A*D*o+P*a)+(m=t[8])*(E=P*D*o-A*a),e[1]=l*v+h*S+p*E,e[2]=c*v+f*S+g*E,e[3]=u*v+d*S+y*E,e[4]=s*b+_*I+m*x,e[5]=l*b+h*I+p*x,e[6]=c*b+f*I+g*x,e[7]=u*b+d*I+y*x,e[8]=s*C+_*T+m*N,e[9]=l*C+h*T+p*N,e[10]=c*C+f*T+g*N,e[11]=u*C+d*T+y*N,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},mat4.rotateX=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],_=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*a+c*i,e[5]=o*a+u*i,e[6]=s*a+_*i,e[7]=l*a+h*i,e[8]=c*a-n*i,e[9]=u*a-o*i,e[10]=_*a-s*i,e[11]=h*a-l*i,e},mat4.rotateY=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[0],o=t[1],s=t[2],l=t[3],c=t[8],u=t[9],_=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a-c*i,e[1]=o*a-u*i,e[2]=s*a-_*i,e[3]=l*a-h*i,e[8]=n*i+c*a,e[9]=o*i+u*a,e[10]=s*i+_*a,e[11]=l*i+h*a,e},mat4.rotateZ=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[0],o=t[1],s=t[2],l=t[3],c=t[4],u=t[5],_=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a+c*i,e[1]=o*a+u*i,e[2]=s*a+_*i,e[3]=l*a+h*i,e[4]=c*a-n*i,e[5]=u*a-o*i,e[6]=_*a-s*i,e[7]=h*a-l*i,e},mat4.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},mat4.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotation=function(e,t,r){var i,a,n,o=r[0],s=r[1],l=r[2],c=Math.sqrt(o*o+s*s+l*l);return Math.abs(c)<glMatrix.EPSILON?null:(o*=c=1/c,s*=c,l*=c,i=Math.sin(t),a=Math.cos(t),e[0]=o*o*(n=1-a)+a,e[1]=s*o*n+l*i,e[2]=l*o*n-s*i,e[3]=0,e[4]=o*s*n-l*i,e[5]=s*s*n+a,e[6]=l*s*n+o*i,e[7]=0,e[8]=o*l*n+s*i,e[9]=s*l*n-o*i,e[10]=l*l*n+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},mat4.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotationTranslation=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=i+i,l=a+a,c=n+n,u=i*s,_=i*l,h=i*c,f=a*l,d=a*c,m=n*c,p=o*s,g=o*l,y=o*c;return e[0]=1-(f+m),e[1]=_+y,e[2]=h-g,e[3]=0,e[4]=_-y,e[5]=1-(u+m),e[6]=d+p,e[7]=0,e[8]=h+g,e[9]=d-p,e[10]=1-(u+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},mat4.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},mat4.getScaling=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[4],o=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+a*a),e[1]=Math.sqrt(n*n+o*o+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e},mat4.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},mat4.fromRotationTranslationScale=function(e,t,r,i){var a=t[0],n=t[1],o=t[2],s=t[3],l=a+a,c=n+n,u=o+o,_=a*l,h=a*c,f=a*u,d=n*c,m=n*u,p=o*u,g=s*l,y=s*c,v=s*u,S=i[0],E=i[1],b=i[2];return e[0]=(1-(d+p))*S,e[1]=(h+v)*S,e[2]=(f-y)*S,e[3]=0,e[4]=(h-v)*E,e[5]=(1-(_+p))*E,e[6]=(m+g)*E,e[7]=0,e[8]=(f+y)*b,e[9]=(m-g)*b,e[10]=(1-(_+d))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},mat4.fromRotationTranslationScaleOrigin=function(e,t,r,i,a){var n=t[0],o=t[1],s=t[2],l=t[3],c=n+n,u=o+o,_=s+s,h=n*c,f=n*u,d=n*_,m=o*u,p=o*_,g=s*_,y=l*c,v=l*u,S=l*_,E=i[0],b=i[1],I=i[2],x=a[0],C=a[1],T=a[2];return e[0]=(1-(m+g))*E,e[1]=(f+S)*E,e[2]=(d-v)*E,e[3]=0,e[4]=(f-S)*b,e[5]=(1-(h+g))*b,e[6]=(p+y)*b,e[7]=0,e[8]=(d+v)*I,e[9]=(p-y)*I,e[10]=(1-(h+m))*I,e[11]=0,e[12]=r[0]+x-(e[0]*x+e[4]*C+e[8]*T),e[13]=r[1]+C-(e[1]*x+e[5]*C+e[9]*T),e[14]=r[2]+T-(e[2]*x+e[6]*C+e[10]*T),e[15]=1,e},mat4.fromQuat=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=r+r,s=i+i,l=a+a,c=r*o,u=i*o,_=i*s,h=a*o,f=a*s,d=a*l,m=n*o,p=n*s,g=n*l;return e[0]=1-_-d,e[1]=u+g,e[2]=h-p,e[3]=0,e[4]=u-g,e[5]=1-c-d,e[6]=f+m,e[7]=0,e[8]=h+p,e[9]=f-m,e[10]=1-c-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.frustum=function(e,t,r,i,a,n,o){var s=1/(r-t),l=1/(a-i),c=1/(n-o);return e[0]=2*n*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(a+i)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e},mat4.perspective=function(e,t,r,i,a){var n=1/Math.tan(t/2),o=1/(i-a);return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*i*o,e[15]=0,e},mat4.perspectiveFromFieldOfView=function(e,t,r,i){var a=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),c=2/(a+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(a-n)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},mat4.ortho=function(e,t,r,i,a,n,o){var s=1/(t-r),l=1/(i-a),c=1/(n-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(a+i)*l,e[14]=(o+n)*c,e[15]=1,e},mat4.lookAt=function(e,t,r,i){var a,n,o,s,l,c,u,_,h,f,d=t[0],m=t[1],p=t[2],g=i[0],y=i[1],v=i[2],S=r[0],E=r[1],b=r[2];return Math.abs(d-S)<glMatrix.EPSILON&&Math.abs(m-E)<glMatrix.EPSILON&&Math.abs(p-b)<glMatrix.EPSILON?mat4.identity(e):(u=d-S,_=m-E,h=p-b,a=y*(h*=f=1/Math.sqrt(u*u+_*_+h*h))-v*(_*=f),n=v*(u*=f)-g*h,o=g*_-y*u,(f=Math.sqrt(a*a+n*n+o*o))?(a*=f=1/f,n*=f,o*=f):(a=0,n=0,o=0),s=_*o-h*n,l=h*a-u*o,c=u*n-_*a,(f=Math.sqrt(s*s+l*l+c*c))?(s*=f=1/f,l*=f,c*=f):(s=0,l=0,c=0),e[0]=a,e[1]=s,e[2]=u,e[3]=0,e[4]=n,e[5]=l,e[6]=_,e[7]=0,e[8]=o,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*d+n*m+o*p),e[13]=-(s*d+l*m+c*p),e[14]=-(u*d+_*m+h*p),e[15]=1,e)},mat4.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},mat4.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},mat4.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},mat4.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e},mat4.sub=mat4.subtract,mat4.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},mat4.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},mat4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},mat4.equals=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],_=e[9],h=e[10],f=e[11],d=e[12],m=e[13],p=e[14],g=e[15],y=t[0],v=t[1],S=t[2],E=t[3],b=t[4],I=t[5],x=t[6],C=t[7],T=t[8],N=t[9],D=t[10],A=t[11],P=t[12],M=t[13],w=t[14],R=t[15];return Math.abs(r-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(a-S)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(n-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-I)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-C)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-T)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(_-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(h-D)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(f-A)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-P)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(m-M)<=glMatrix.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(p),Math.abs(w))&&Math.abs(g-R)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))};var mat3={create:function(){var e=new glMatrix.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,r,i,a,n,o,s,l){var c=new glMatrix.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=a,c[5]=n,c[6]=o,c[7]=s,c[8]=l,c},set:function(e,t,r,i,a,n,o,s,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=n,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],i=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=u*o-s*c,h=-u*n+s*l,f=c*n-o*l,d=r*_+i*h+a*f;return d?(e[0]=_*(d=1/d),e[1]=(-u*i+a*c)*d,e[2]=(s*i-a*o)*d,e[3]=h*d,e[4]=(u*r-a*l)*d,e[5]=(-s*r+a*n)*d,e[6]=f*d,e[7]=(-c*r+i*l)*d,e[8]=(o*r-i*n)*d,e):null},adjoint:function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-s*c,e[1]=a*c-i*u,e[2]=i*s-a*o,e[3]=s*l-n*u,e[4]=r*u-a*l,e[5]=a*n-r*s,e[6]=n*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*n,e},determinant:function(e){var t=e[3],r=e[4],i=e[5],a=e[6],n=e[7],o=e[8];return e[0]*(o*r-i*n)+e[1]*(-o*t+i*a)+e[2]*(n*t-r*a)},multiply:function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=r[0],f=r[1],d=r[2],m=r[3],p=r[4],g=r[5],y=r[6],v=r[7],S=r[8];return e[0]=h*i+f*o+d*c,e[1]=h*a+f*s+d*u,e[2]=h*n+f*l+d*_,e[3]=m*i+p*o+g*c,e[4]=m*a+p*s+g*u,e[5]=m*n+p*l+g*_,e[6]=y*i+v*o+S*c,e[7]=y*a+v*s+S*u,e[8]=y*n+v*l+S*_,e}};mat3.mul=mat3.multiply,mat3.translate=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=r[0],f=r[1];return e[0]=i,e[1]=a,e[2]=n,e[3]=o,e[4]=s,e[5]=l,e[6]=h*i+f*o+c,e[7]=h*a+f*s+u,e[8]=h*n+f*l+_,e},mat3.rotate=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=Math.sin(r),f=Math.cos(r);return e[0]=f*i+h*o,e[1]=f*a+h*s,e[2]=f*n+h*l,e[3]=f*o-h*i,e[4]=f*s-h*a,e[5]=f*l-h*n,e[6]=c,e[7]=u,e[8]=_,e},mat3.scale=function(e,t,r){var i=r[0],a=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},mat3.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},mat3.fromQuat=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=r+r,s=i+i,l=a+a,c=r*o,u=i*o,_=i*s,h=a*o,f=a*s,d=a*l,m=n*o,p=n*s,g=n*l;return e[0]=1-_-d,e[3]=u-g,e[6]=h+p,e[1]=u+g,e[4]=1-c-d,e[7]=f-m,e[2]=h-p,e[5]=f+m,e[8]=1-c-_,e},mat3.normalFromMat4=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15],y=r*s-i*o,v=r*l-a*o,S=r*c-n*o,E=i*l-a*s,b=i*c-n*s,I=a*c-n*l,x=u*m-_*d,C=u*p-h*d,T=u*g-f*d,N=_*p-h*m,D=_*g-f*m,A=h*g-f*p,P=y*A-v*D+S*N+E*T-b*C+I*x;return P?(e[0]=(s*A-l*D+c*N)*(P=1/P),e[1]=(l*T-o*A-c*C)*P,e[2]=(o*D-s*T+c*x)*P,e[3]=(a*D-i*A-n*N)*P,e[4]=(r*A-a*T+n*C)*P,e[5]=(i*T-r*D-n*x)*P,e[6]=(m*I-p*b+g*E)*P,e[7]=(p*S-d*I-g*v)*P,e[8]=(d*b-m*S+g*y)*P,e):null},mat3.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},mat3.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},mat3.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},mat3.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e},mat3.sub=mat3.subtract,mat3.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},mat3.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},mat3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},mat3.equals=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],_=t[0],h=t[1],f=t[2],d=t[3],m=t[4],p=t[5],g=t[6],y=t[7],v=t[8];return Math.abs(r-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(n-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))};var vec2={create:function(){var e=new glMatrix.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new glMatrix.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}};vec2.sub=vec2.subtract,vec2.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},vec2.mul=vec2.multiply,vec2.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},vec2.div=vec2.divide,vec2.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},vec2.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},vec2.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},vec2.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},vec2.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},vec2.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},vec2.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},vec2.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},vec2.dist=vec2.distance,vec2.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},vec2.len=vec2.length,vec2.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},vec2.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},vec2.normalize=function(e,t){var r=t[0],i=t[1],a=r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a),e},vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},vec2.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},vec2.lerp=function(e,t,r,i){var a=t[0],n=t[1];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e},vec2.random=function(e,t){t=t||1;var r=2*glMatrix.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},vec2.transformMat2=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a,e[1]=r[1]*i+r[3]*a,e},vec2.transformMat2d=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a+r[4],e[1]=r[1]*i+r[3]*a+r[5],e},vec2.transformMat3=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[3]*a+r[6],e[1]=r[1]*i+r[4]*a+r[7],e},vec2.transformMat4=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[4]*a+r[12],e[1]=r[1]*i+r[5]*a+r[13],e},vec2.forEach=function(){var e=vec2.create();return function(t,r,i,a,n,o){var s,l;for(r||(r=2),i||(i=0),l=a?Math.min(a*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],n(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}(),vec2.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},vec2.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},vec2.equals=function(e,t){var r=e[0],i=e[1],a=t[0],n=t[1];return Math.abs(r-a)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))};var vec3={create:function(){var e=new glMatrix.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,r){var i=new glMatrix.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}};vec3.sub=vec3.subtract,vec3.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},vec3.mul=vec3.multiply,vec3.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},vec3.div=vec3.divide,vec3.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},vec3.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},vec3.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},vec3.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},vec3.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},vec3.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},vec3.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},vec3.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(r*r+i*i+a*a)},vec3.dist=vec3.distance,vec3.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return r*r+i*i+a*a},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},vec3.len=vec3.length,vec3.squaredLength=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},vec3.normalize=function(e,t){var r=t[0],i=t[1],a=t[2],n=r*r+i*i+a*a;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e},vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},vec3.cross=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=r[0],s=r[1],l=r[2];return e[0]=a*l-n*s,e[1]=n*o-i*l,e[2]=i*s-a*o,e},vec3.lerp=function(e,t,r,i){var a=t[0],n=t[1],o=t[2];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e},vec3.hermite=function(e,t,r,i,a,n){var o=n*n,s=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return e[0]=t[0]*s+r[0]*l+i[0]*c+a[0]*u,e[1]=t[1]*s+r[1]*l+i[1]*c+a[1]*u,e[2]=t[2]*s+r[2]*l+i[2]*c+a[2]*u,e},vec3.bezier=function(e,t,r,i,a,n){var o=1-n,s=o*o,l=n*n,c=s*o,u=3*n*s,_=3*l*o,h=l*n;return e[0]=t[0]*c+r[0]*u+i[0]*_+a[0]*h,e[1]=t[1]*c+r[1]*u+i[1]*_+a[1]*h,e[2]=t[2]*c+r[2]*u+i[2]*_+a[2]*h,e},vec3.random=function(e,t){t=t||1;var r=2*glMatrix.RANDOM()*Math.PI,i=2*glMatrix.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},vec3.transformMat4=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=r[3]*i+r[7]*a+r[11]*n+r[15];return e[0]=(r[0]*i+r[4]*a+r[8]*n+r[12])/(o=o||1),e[1]=(r[1]*i+r[5]*a+r[9]*n+r[13])/o,e[2]=(r[2]*i+r[6]*a+r[10]*n+r[14])/o,e},vec3.transformMat3=function(e,t,r){var i=t[0],a=t[1],n=t[2];return e[0]=i*r[0]+a*r[3]+n*r[6],e[1]=i*r[1]+a*r[4]+n*r[7],e[2]=i*r[2]+a*r[5]+n*r[8],e},vec3.transformQuat=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=r[0],s=r[1],l=r[2],c=r[3],u=c*i+s*n-l*a,_=c*a+l*i-o*n,h=c*n+o*a-s*i,f=-o*i-s*a-l*n;return e[0]=u*c+f*-o+_*-l-h*-s,e[1]=_*c+f*-s+h*-o-u*-l,e[2]=h*c+f*-l+u*-s-_*-o,e},vec3.rotateX=function(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[0],n[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),n[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.rotateY=function(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),n[1]=a[1],n[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.rotateZ=function(e,t,r,i){var a=[],n=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],n[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),n[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),n[2]=a[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.forEach=function(){var e=vec3.create();return function(t,r,i,a,n,o){var s,l;for(r||(r=3),i||(i=0),l=a?Math.min(a*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],n(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),vec3.angle=function(e,t){var r=vec3.fromValues(e[0],e[1],e[2]),i=vec3.fromValues(t[0],t[1],t[2]);vec3.normalize(r,r),vec3.normalize(i,i);var a=vec3.dot(r,i);return a>1?0:a<-1?Math.PI:Math.acos(a)},vec3.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},vec3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},vec3.equals=function(e,t){var r=e[0],i=e[1],a=e[2],n=t[0],o=t[1],s=t[2];return Math.abs(r-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(a-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))};var vec4={create:function(){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,r,i){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,r,i,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}};vec4.sub=vec4.subtract,vec4.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},vec4.mul=vec4.multiply,vec4.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},vec4.div=vec4.divide,vec4.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},vec4.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},vec4.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},vec4.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},vec4.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},vec4.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},vec4.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},vec4.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+a*a+n*n)},vec4.dist=vec4.distance,vec4.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+a*a+n*n},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(e){var t=e[0],r=e[1],i=e[2],a=e[3];return Math.sqrt(t*t+r*r+i*i+a*a)},vec4.len=vec4.length,vec4.squaredLength=function(e){var t=e[0],r=e[1],i=e[2],a=e[3];return t*t+r*r+i*i+a*a},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},vec4.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},vec4.normalize=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=r*r+i*i+a*a+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=a*o,e[3]=n*o),e},vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},vec4.lerp=function(e,t,r,i){var a=t[0],n=t[1],o=t[2],s=t[3];return e[0]=a+i*(r[0]-a),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},vec4.random=function(e,t){return t=t||1,e[0]=glMatrix.RANDOM(),e[1]=glMatrix.RANDOM(),e[2]=glMatrix.RANDOM(),e[3]=glMatrix.RANDOM(),vec4.normalize(e,e),vec4.scale(e,e,t),e},vec4.transformMat4=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*a+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*a+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*a+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*a+r[11]*n+r[15]*o,e},vec4.transformQuat=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=r[0],s=r[1],l=r[2],c=r[3],u=c*i+s*n-l*a,_=c*a+l*i-o*n,h=c*n+o*a-s*i,f=-o*i-s*a-l*n;return e[0]=u*c+f*-o+_*-l-h*-s,e[1]=_*c+f*-s+h*-o-u*-l,e[2]=h*c+f*-l+u*-s-_*-o,e[3]=t[3],e},vec4.forEach=function(){var e=vec4.create();return function(t,r,i,a,n,o){var s,l;for(r||(r=4),i||(i=0),l=a?Math.min(a*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],n(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),vec4.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},vec4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},vec4.equals=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(n-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))};var quat={};function ColorFresnel(e){var t=[[1,1,1],[1,1,1],1,0,1];5===arguments.length?t=Array.prototype.slice.call(arguments):Array.isArray(e)&&(t=e),this.isColorFresnel=!0,this.center=t[0],this.edge=t[1],this.centerBias=t[2],this.edgeBias=t[3],this.power=t[4]}function ScalarFresnel(e){var t=[1,1,1,0,1];5===arguments.length?t=Array.prototype.slice.call(arguments):Array.isArray(e)&&(t=e),this.isScalarFresnel=!0,this.center=t[0],this.edge=t[1],this.centerBias=t[2],this.edgeBias=t[3],this.power=t[4]}function unpackChapterLights(e){"use strict";var t,r={},i=0,a=0,n=Human.assets.lights.lightIds,o=Human.renderer.lights.defaultLightIds;if(e.lights.length)for(i=0;i<e.lights.length;i++)r[e.lights[i]]=!0;if(e.libraries.length)for(i=0;i<e.libraries.length;i++)if(n.hasOwnProperty(t=e.libraries[i]))for(a=0;a<n[t].length;a++)r[n[t][a]]=!0;else if("default"===t)for(a=0;a<o.length;a++)r[o[a]]=!0;return r}quat.create=function(){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},quat.rotationTo=function(){var e=vec3.create(),t=vec3.fromValues(1,0,0),r=vec3.fromValues(0,1,0);return function(i,a,n){var o=vec3.dot(a,n);return o<-.999999?(vec3.cross(e,t,a),vec3.length(e)<1e-6&&vec3.cross(e,r,a),vec3.normalize(e,e),quat.setAxisAngle(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(vec3.cross(e,a,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,quat.normalize(i,i))}}(),quat.setAxes=function(){var e=mat3.create();return function(t,r,i,a){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],quat.normalize(t,quat.fromMat3(t,e))}}(),quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},quat.setAxisAngle=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},quat.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},quat.add=vec4.add,quat.multiply=function(e,t,r){var i=t[0],a=t[1],n=t[2],o=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+o*s+a*c-n*l,e[1]=a*u+o*l+n*s-i*c,e[2]=n*u+o*c+i*l-a*s,e[3]=o*u-i*s-a*l-n*c,e},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*s,e[1]=a*l+n*s,e[2]=n*l-a*s,e[3]=o*l-i*s,e},quat.rotateY=function(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l-n*s,e[1]=a*l+o*s,e[2]=n*l+i*s,e[3]=o*l-a*s,e},quat.rotateZ=function(e,t,r){r*=.5;var i=t[0],a=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=a*l-i*s,e[2]=n*l+o*s,e[3]=o*l-n*s,e},quat.calculateW=function(e,t){var r=t[0],i=t[1],a=t[2];return e[0]=r,e[1]=i,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-a*a)),e},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(e,t,r,i){var a,n,o,s,l,c=t[0],u=t[1],_=t[2],h=t[3],f=r[0],d=r[1],m=r[2],p=r[3];return(n=c*f+u*d+_*m+h*p)<0&&(n=-n,f=-f,d=-d,m=-m,p=-p),1-n>1e-6?(a=Math.acos(n),o=Math.sin(a),s=Math.sin((1-i)*a)/o,l=Math.sin(i*a)/o):(s=1-i,l=i),e[0]=s*c+l*f,e[1]=s*u+l*d,e[2]=s*_+l*m,e[3]=s*h+l*p,e},quat.sqlerp=function(){var e=quat.create(),t=quat.create();return function(r,i,a,n,o,s){return quat.slerp(e,i,o,s),quat.slerp(t,a,n,s),quat.slerp(r,e,t,2*s*(1-s)),r}}(),quat.invert=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],o=r*r+i*i+a*a+n*n,s=o?1/o:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-a*s,e[3]=n*s,e},quat.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var n=(a+1)%3,o=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*n+n]-t[3*o+o]+1),e[a]=.5*r,e[3]=(t[3*n+o]-t[3*o+n])*(r=.5/r),e[n]=(t[3*n+a]+t[3*a+n])*r,e[o]=(t[3*o+a]+t[3*a+o])*r}return e},quat.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},quat.exactEquals=vec4.exactEquals,quat.equals=vec4.equals,function(){"use strict";window.SceneJS_Map=function(e,t){this.items=e||[];var r=(t||0)+1;this.addItem=function(){var e;if(2==arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw SceneJS_error.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+t+"'");return this.items[t]=e,t}for(;;){e=arguments[0];var i=r++;if(!this.items[i])return this.items[i]=e,i}},this.removeItem=function(e){delete this.items[e]}}}(),function(){"use strict";var e=window.SceneJS=new function(){this.VERSION="3.2",this.ENABLE_EXTENSIONS=["WEBGL_depth_texture","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","OES_standard_derivatives","EXT_shader_texture_lod"],this._baseStateId=0,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._engines={},this._engineIds=new SceneJS_Map,this.timer=window.performance||window.Date,this.WEBGL_INFO=function(){var e={WEBGL:!1,SOFTWARE_RENDERER:!1},t=document.createElement("canvas");if(!t)return e;var r=t.getContext("webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0})||t.getContext("experimental-webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0});return r||(r=t.getContext("webgl",{antialias:!0})||t.getContext("experimental-webgl",{antialias:!0}))&&(e.SOFTWARE_RENDERER=!0),e.WEBGL=!!r,e.WEBGL?(e.ANTIALIAS=r.getContextAttributes().antialias,e.FS_MAX_FLOAT_PRECISION=r.getShaderPrecisionFormat?r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0?"highp":r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",e.DEPTH_BITS=r.getParameter(r.DEPTH_BITS),e.STENCIL_BITS=r.getParameter(r.STENCIL_BITS),e.MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE),e.MAX_CUBE_MAP_SIZE=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),e.MAX_RENDERBUFFER_SIZE=r.getParameter(r.MAX_RENDERBUFFER_SIZE),e.MAX_TEXTURE_UNITS=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e.MAX_VERTEX_ATTRIBS=r.getParameter(r.MAX_VERTEX_ATTRIBS),e.MAX_VERTEX_UNIFORM_VECTORS=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),e.MAX_FRAGMENT_UNIFORM_VECTORS=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),e.MAX_VARYING_VECTORS=r.getParameter(r.MAX_VARYING_VECTORS),e.SAMPLE_BUFFERS=!!r.getParameter(r.SAMPLE_BUFFERS),e.SAMPLES=r.getParameter(r.SAMPLES),e.MAX_POINT_SIZE=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1],e.MAX_VIEWPORT_DIMS=r.getParameter(r.MAX_VIEWPORT_DIMS),e.SUPPORTED_EXTENSIONS={},r.getSupportedExtensions().forEach((function(t){e.SUPPORTED_EXTENSIONS[t]=!0})),e.depthTexturesSupported=e.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||!1,e.floatTexturesSupported=e.SUPPORTED_EXTENSIONS.OES_texture_float||!1,e.linearFloatTexturesSupported=e.SUPPORTED_EXTENSIONS.OES_texture_float_linear||!1,e.drawBuffersSupported=e.SUPPORTED_EXTENSIONS.WEBGL_draw_buffers||!1,e.standardDerivativesSupported=e.SUPPORTED_EXTENSIONS.OES_standard_derivatives||!1,e.textureLODSupported=e.SUPPORTED_EXTENSIONS.EXT_shader_texture_lod||!1,e):e}(),this.DISPLAY_FLAGS={FOG_LINEAR:1,FOG_EXP:2,FOG_EXP2:3},this.TEXTURE_FLAGS={baseColor:1,specular:2,emit:4,alpha:8,normals:16,shine:32,metallic:64,roughness:128,occlusion:256,add:512,multiply:1024,over:2048,transparency:4096,conditionalAlpha:8192},this.CUBEMAP_FLAGS={reflect:1,light:2},this.PROPERTY_FLAGS={PICKING:1,ENABLED:2,REFLECTIVE:4,SOLID:8,SKYBOX:16,XRAY:32,CCW:64,NO_DEPTH_MASK:128,PARTIALLY_OPAQUE:256,FORCE_TRANSPARENT:512,ROUND_POINTS:1024,PERSPECTIVE_POINTS:2048,BILLBOARD:4096,CLIPPING:8192,STOCHASTIC_ALPHA:16384},this.COLOR_MOD_FLAGS={SATURATION:1,BRIGHTNESS:2,CONTRAST:4,TINT:8},this.XFORM_FLAGS={MATRIX_DIRTY:1,COMPILING:2,DIRTY:4},this.TRANSPARENCY_FLAGS={ALPHA:1,IMPROVED_ALPHA:2,ADD_ALPHA:4,ALPHA_TO_COVERAGE:8,WEIGHTED_OIT:16},this.DEPTH_TEST_FLAGS={ENABLED:1,DISABLED:2,ALWAYS_PASS:4},this.TRANSPARENCY_FLAGS.TWO_PASS=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ORDER_DEPENDENT=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_BLEND=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.KD_TREE_MAX_DEPTH=10,this.KD_TREE_MIN_TRIANGLES=20,this.setMaxPointSize=function(e){SceneJS_ProgramSourceFactory.setMaxPointSize(e)},this.publish=function(e,t,r){r||(this._topicPubs[e]=t);var i=this._topicSubs[e];if(i)for(var a in i)i.hasOwnProperty(a)&&i[a].call(this,t)},this.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var r in t)t.hasOwnProperty(r)&&t[r].call(this,null);delete this._topicPubs[e]},this.on=function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var i=this._handleMap.addItem();r[i]=t,this._handleTopics[i]=e;var a=this._topicPubs[e];return a&&t.call(this,a),i},this.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var r=this._topicSubs[t];r&&delete r[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},this.once=function(e,t){var r=this,i=this.on(e,(function(e){r.off(i),t(e)}))},this.createScene=function(t,r){if((t=t||{}).id){if(this._engines[t.id])throw SceneJS_error.fatalError(e.errors.ILLEGAL_NODE_CONFIG,"Scene already exists with this ID: '"+t.id+"'");this._engineIds.addItem(t.id,{})}else t.id=this._engineIds.addItem({});var i=new SceneJS_Engine(t,r);return this._engines[t.id]=i,i.scene},this.scene=function(e){var t=this._engines[e];return t?t.scene:null},this.getScene=function(e){if(!e)for(var e in this._engines)if(this._engines.hasOwnProperty(e))return this._engines[e].scene;var t=this._engines[e];return t?t.scene:null},this.getScenes=function(){var e={};for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e[t]=this._engines[t].scene);return e},this._isArray=function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},this._shallowClone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},this._applyIf=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(null!=t[r]&&null!=t[r]||(t[r]=e[r]));return t},this._apply=function(e,t,r){var i;if(r)for(i in t)t.hasOwnProperty(i)&&delete t[i];for(i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t[i]=e[i]);return t};var t=Object.prototype.hasOwnProperty;this._isEmpty=function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var r in e)if(t.call(e,r))return!1;return!0},this._isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this._sliceArray=function(e,t,r){if(e.slice)return e.slice(t,r);for(var i=(r=r||e.length)-(t=t||0),a=new e.constructor(i),n=0;n<i;n++)a[n]=e[t+n];return a},this._loadBinary=function(e,t){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",e),r.onload=function(){t(r.response)},r.send(null)};var r=["","MOZ_","WEBKIT_"];this.checkExtension=function(e){for(var t=0,i=r.length;t<i;t++)if(this.WEBGL_INFO.SUPPORTED_EXTENSIONS[r[t]+e])return!0;return!1},this._getExtension=function(e,t){for(var i=0,a=r.length;i<a;i++){var n=e.getExtension(r[i]+t);if(n)return n}return null},this.printGraph=function(e){!function e(t,r){var i,a="";for(i=0;i<r;i++)a+=" ";for(a+="-- ",console.log(a+t.type+" (id: "+t.id+", coreId: "+t.coreId+")"),i=0;i<t.nodes.length;i++)e(t.nodes[i],r+1)}(e,0)},this.reset=function(){var e=[];for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e.push(this._engines[t]),delete this._engines[t],this._engineIds.removeItem(t));for(;e.length>0;)e.pop().destroy();SceneJS_events.fireEvent(SceneJS_events.RESET)}}}(),function(){"use strict";var e=window.SceneJS_events=new function(){this.ERROR=0,this.RESET=1,this.NODE_CREATED=2,this.SCENE_CREATED=3,this.SCENE_COMPILING=4,this.SCENE_DESTROYED=5,this.OBJECT_COMPILING=6,this.WEBGL_CONTEXT_LOST=7,this.WEBGL_CONTEXT_RESTORED=8,this.RENDER=9;var e=[];this.addListener=function(t,r,i){var a=e[t];a||(e[t]=a=[]);for(var n={command:r,priority:null==i?a.length:i},o=-1,s=0,l=a.length;s<l;s++)if(!a[s]){o=s;break}return o<0&&(a.push(n),o=a.length-1),t+"."+o},this.removeListener=function(t){var r=t.lastIndexOf("."),i=parseInt(t.substr(0,r)),a=parseInt(t.substr(r+1)),n=e[i];n&&delete n[a]},this.fireEvent=function(t,r){var i=e[t];if(i){r=r||{};for(var a=0;a<i.length;a++)i[a]&&i[a].command(r)}}};SceneJS.bind=function(t,r){switch(t){case"error":return e.addListener(e.ERROR,r);case"reset":return e.addListener(e.RESET,(function(){r()}));case"webglcontextlost":return e.addListener(e.WEBGL_CONTEXT_LOST,(function(e){r(e)}));case"webglcontextrestored":return e.addListener(e.WEBGL_CONTEXT_RESTORED,(function(e){r(e)}));default:throw SceneJS_error.fatalError("SceneJS.bind - this event type not supported: '"+t+"'")}},SceneJS.onEvent=SceneJS.bind,SceneJS.unEvent=function(t){return e.removeListener(t)},SceneJS.subscribe=SceneJS.addListener=SceneJS.onEvent=SceneJS.bind,SceneJS.unsubscribe=SceneJS.unEvent,SceneJS.on=SceneJS.onEvent,SceneJS.off=SceneJS.unEvent}(),function(){"use strict";var e=window.SceneJS_Canvas=function(e,t,r,i){if(!t){t="canvas-"+e;var a=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=n.style;o.height="100%",o.width="100%",o.padding="0",o.margin="0",o.left="0",o.top="0",o.position="absolute",n.innerHTML+='<canvas id="'+t+'" style="width: 100%; height: 100%; margin: 0; padding: 0;"></canvas>',a.appendChild(n)}var s=document.getElementById(t);if(!s)throw SceneJS_error.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"SceneJS.Scene attribute 'canvasId' does not match any elements in the page");s.addEventListener("webglcontextcreationerror",(function(e){console.error("Unable to initialize WebGL:",e.statusMessage||"Unknown error")}),!1),this.canvasId=t,this.options=i||{},this.canvas=s,this.options.simulateWebGLContextLost&&(window.WebGLDebugUtils?this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas):console.error("To simulate context loss, please include WebGLDebugUtils")),this.resolutionScaling=this.options.resolutionScaling||1,this.canvas.width=this.canvas.clientWidth*this.resolutionScaling,this.canvas.height=this.canvas.clientHeight*this.resolutionScaling,this.contextAttr=r||{},this.contextAttr.alpha=!0,this.gl=null,this.webgl2=!1,this.initWebGL()};e.prototype._WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],e.prototype.initWebGL=function(){if(!0===this.options.webgl2){try{this.gl=this.canvas.getContext("webgl2",this.contextAttr)}catch(t){}this.gl?this.webgl2=!0:console.log("Failed to get a WebGL 2 context - defaulting to WebGL 1.")}if(!this.gl)for(var e=0;!this.gl&&e<this._WEBGL_CONTEXT_NAMES.length;e++)try{this.gl=this.canvas.getContext(this._WEBGL_CONTEXT_NAMES[e],this.contextAttr)}catch(t){}if(!this.gl)throw SceneJS_error.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Failed to get a WebGL context")},e.prototype.loseWebGLContext=function(){this.options.simulateWebGLContextLost&&this.canvas.loseContext()},e.prototype.setResolutionScaling=function(e){this.resolutionScaling=e,this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e}}(),function(){"use strict";var e=window.SceneJS_Engine=function(e,t){t=t||{},e.type="scene",this.id=e.id,this._numPasses=e.numPasses||1,this._clearEachPass=!!e.clearEachPass,this.canvas=new SceneJS_Canvas(this.id,e.canvasId,e.contextAttr,t),this._coreFactory=new SceneJS_CoreFactory,this._nodeFactory=new SceneJS_NodeFactory,this.stats={build:{version:SceneJS.VERSION},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{},state:{programs:0},geometry:{meshes:0,vertices:0,triangles:0},textures:{},load:{sceneGraphCompilation:0,shaderCompilation:0,programCompilation:0},memory:{positions:0,colors:0,normals:0,uvs:0,indices:0,morphPositions:0,morphNormals:0,textures:0,tangents:0,pickPositions:0,pickColors:0},frame:{frameCount:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,drawChunks:0}},this.display=new SceneJS_Display(this.stats,{canvas:this.canvas,transparent:e.transparent,autoTangents:t.autoTangents,gammaInputPhong:t.gammaInputPhong}),this.sceneDirty=!1,this._sceneBranchesDirty=!1,this._compilationPaused=!1,this._nodesToDestroy=[],this._numNodesToDestroy=0,this.destroyed=!1;for(var r=this.canvas.gl,i=SceneJS.ENABLE_EXTENSIONS,a=0,n=i.length;a<n;++a)r.getExtension(i[a]);this.cpuTimer=SceneJS.timer,this.gpuTimer=r.getExtension("EXT_disjoint_timer_query")||null,this.gpuTimer&&(this.gpuTimerQuery=this.gpuTimer.createQueryEXT(this.gpuTimer.TIME_ELAPSED_EXT)),this.sceneStatus={nodes:{},numTasks:0};var o=this,s=e.nodes;e.nodes=[],this.scene=this.createNode(e),s&&(e.nodes=s,this.scene.addNodes(s)),this.canvas.canvas.addEventListener("webglcontextlost",(function(e){e.preventDefault(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_LOST,{scene:o.scene})}),!1),this.canvas.canvas.addEventListener("webglcontextrestored",(function(e){o.canvas.initWebGL();for(var t=o.canvas.gl,r=SceneJS.ENABLE_EXTENSIONS,i=0,a=r.length;i<a;++i)t.getExtension(r[i]);o.gpuTimer=t.getExtension("EXT_disjoint_timer_query"),o.gpuTimer&&(o.gpuTimerQuery=o.gpuTimer.createQueryEXT(o.gpuTimer.TIME_ELAPSED_EXT)),o._coreFactory.webglRestored(),o.display.webglRestored(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_RESTORED,{scene:o.scene})}),!1)};e.prototype.setNumPasses=function(e){this._numPasses=e},e.prototype.setClearEachPass=function(e){this._clearEachPass=e},e.prototype.loseWebGLContext=function(){this.canvas.loseWebGLContext()},e.prototype.hasNodeType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]},e.prototype.createNode=function(e){this._doDestroyNodes(),e.type=e.type||"node";var t=this._coreFactory.getCore(e.type,e.coreId),r=this._nodeFactory.getNode(this,e,t),i=e.nodes;if(i){var a=SceneJS_NodeFactory.nodeTypes[r.type];if(!a||!a.prototype._fromPlugin)for(var n=0,o=i.length;n<o;n++){var s=this.createNode(i[n]);r.addNode(s)}}return r},e.prototype._doDestroyNodes=function(){for(var e;this._numNodesToDestroy>0;)--this._numNodesToDestroy,e=this._nodesToDestroy[this._numNodesToDestroy],this._nodesToDestroy[this._numNodesToDestroy]=null,e._doDestroy(),this._coreFactory.putCore(e._core),this._nodeFactory.putNode(e)},e.prototype.findNode=function(e){return this._nodeFactory.nodes.items[e]},e.prototype.findNodes=function(e){var t=new RegExp(e),r=[],i=this._nodeFactory.nodes.items;for(var a in i)i.hasOwnProperty(a)&&t.test(a)&&r.push(i[a]);return r},e.prototype.hasCore=function(e,t){return this._coreFactory.hasCore(e,t)},e.prototype.branchDirty=function(e){if(!this.sceneDirty&&e!=window){e.branchDirty=!0,e.dirty=!0;for(var t=e.parent;t&&!t.dirty&&!t.branchDirty;t=t.parent)t.dirty=!0;this._sceneBranchesDirty=!0}},e.prototype.render=function(e){var t=!1;if(this._willRender()||e&&e.force)for(var r=Date.now(),i=e&&e.force,a=e&&e.custom,n=0;n<this._numPasses;n++)this.scene.publish("rendering",{pass:n}),this.compile(),this.display.prepareScene(),this.display.render({pass:n,clear:this._clearEachPass||0==n,force:i,custom:a,opaqueOnly:e&&e.opaqueOnly}),this.scene.publish("rendered",{sceneId:this.id,time:r,pass:n}),t=!0;return t},e.prototype.pick=function(e){return this._willRender()&&this.compile(),this.display.pick({pickTriangle:!!e&&e.rayPick,pickRegion:!!e&&e.regionPick,canvasPos:e.canvasPos,origin:e.origin,direction:e.direction})},e.prototype.readPixels=function(e,t,r){return this._willRender()&&this.compile(),this.display.readPixels(e,t,r)},e.prototype._willRender=function(){return SceneJS_events.fireEvent(SceneJS_events.RENDER),this.display.imageDirty||this.display.objectListDirty||this._sceneBranchesDirty||this.sceneDirty},e.prototype.pauseCompilation=function(){this._compilationPaused=!0},e.prototype.resumeCompilation=function(){this._compilationPaused=!1},e.prototype.compile=function(){if(!this._compilationPaused){if(this._sceneBranchesDirty||this.sceneDirty){this._sceneBranchesDirty=!1,SceneJS_events.fireEvent(SceneJS_events.SCENE_COMPILING,{engine:this});var e=SceneJS.timer.now();this.scene._compileNodes(),this.stats.load.sceneGraphCompilation+=SceneJS.timer.now()-e,this.sceneDirty=!1}this._doDestroyNodes()}},e.prototype.destroyNode=function(e){this._nodesToDestroy[this._numNodesToDestroy++]=e;var t=this.sceneStatus.nodes[e.id];t&&(this.sceneStatus.numTasks-=t.numTasks,delete this.sceneStatus.nodes[e.id])},e.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";window.SceneJS_error=new function(){var e;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){e=t.engine.id})),SceneJS_events.addListener(SceneJS_events.RESET,(function(){e=null}),1e5),this.fatalError=function(t,r){"string"==typeof t&&(r=t,t=SceneJS.errors.ERROR);var i={errorName:SceneJS.errors._getErrorName(t)||"ERROR",code:t,exception:r,fatal:!0};return e&&(i.sceneId=e),SceneJS_events.fireEvent(SceneJS_events.ERROR,i),r},this.error=function(t,r){var i={errorName:SceneJS.errors._getErrorName(t)||"ERROR",code:t,exception:r,fatal:!1};e&&(i.sceneId=e),SceneJS_events.fireEvent(SceneJS_events.ERROR,i)}},function(){SceneJS.errors={};var e=0;SceneJS.errors.ERROR=e++,SceneJS.errors.INVALID_FRAMEBUFFER=e++,SceneJS.errors.WEBGL_NOT_SUPPORTED=e++,SceneJS.errors.WEBGL_CONTEXT_LOST=e++,SceneJS.errors.NODE_CONFIG_EXPECTED=e++,SceneJS.errors.ILLEGAL_NODE_CONFIG=e++,SceneJS.errors.SHADER_COMPILATION_FAILURE=e++,SceneJS.errors.SHADER_LINK_FAILURE=e++,SceneJS.errors.CANVAS_NOT_FOUND=e++,SceneJS.errors.OUT_OF_VRAM=e++,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=e++,SceneJS.errors.NODE_NOT_FOUND=e++,SceneJS.errors.NODE_ILLEGAL_STATE=e++,SceneJS.errors.ID_CLASH=e++}(),SceneJS.errors._getErrorName=function(e){for(var t in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(t)&&SceneJS.errors[t]==e)return t;return null}}(),function(){"use strict";SceneJS.log=new function(){var e=null,t={},r=0,i="";SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){})),SceneJS_events.addListener(SceneJS_events.RESET,(function(){t={},e=null}),1e5),this._setIndent=function(e){r=e;for(var t=[],a=0;a<r;a++)t.push("----");i=t.join("")},this.error=function(e){this._log("error",e)},this.warn=function(e){this._log("warn",e)},this.info=function(e){this._log("info",e)},this.debug=function(e){this._log("debug",e)},this.setFuncs=function(r){if(r)for(var i in e=r,t)this._flush(i)},this._flush=function(r){var i=t[r];if(i){var a=e?e[r]:null;if(a){for(var n=0;n<i.length;n++)a(i[n]);t[r]=[]}}},this._log=function(e,t){if(SceneJS._isArray(t))for(var r=0;r<t.length;r++)this.__log(e,t[r]);else this.__log(e,t)},this.__log=function(t,r){r=i+r,e&&e[t]?e[t](r):console&&console[t]&&console[t](r)},this.getFuncs=function(){return e}}}(),function(){"use strict";mat4.create(),mat4.create(),vec2.create();var e=vec3.create(),t=vec3.create(),r=vec3.create(),i=vec3.create(),a=vec3.create(),n=vec3.create(),o=vec3.create();vec3.create(),vec4.create(),Math.log2?window.SceneJS_math_log2=Math.log2:window.SceneJS_math_log2=function(e){return Math.round(Math.log(e)*Math.LOG2E)},window.SceneJS_math_isPOT=function(e){return 0==(e&e-1)},window.SceneJS_math_cross3Vec4=function(e,t){var r=e[0],i=e[1],a=e[2],n=t[0],o=t[1],s=t[2];return[i*s-a*o,a*n-r*s,r*o-i*n,0]},window.SceneJS_math_setCellMat4=function(e,t,r,i){e[t+4*r]=i},window.SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:10},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},window.SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,10],look:[0,0,0],up:[0,1,0]},window.SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},window.SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},window.SceneJS_math_angleAxisQuaternion=function(e,t,r,i){var a=i/180*Math.PI/2,n=Math.sin(a);return[n*e,n*t,n*r,Math.cos(a)]},window.SceneJS_math_mulQuaternions=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return[n*o+r*c+i*l-a*s,n*s+i*c+a*o-r*l,n*l+a*c+r*s-i*o,n*c-r*o-i*s-a*l]},window.SceneJS_math_newMat4FromQuaternion=function(e){var t=e[0],r=e[1],i=e[2],a=e[3],n=2*t,o=2*r,s=2*i,l=n*a,c=o*a,u=s*a,_=n*t,h=o*t,f=s*t,d=o*r,m=s*r,p=s*i,g=mat4.create();return SceneJS_math_setCellMat4(g,0,0,1-(d+p)),SceneJS_math_setCellMat4(g,0,1,h-u),SceneJS_math_setCellMat4(g,0,2,f+c),SceneJS_math_setCellMat4(g,1,0,h+u),SceneJS_math_setCellMat4(g,1,1,1-(_+p)),SceneJS_math_setCellMat4(g,1,2,m-l),SceneJS_math_setCellMat4(g,2,0,f-c),SceneJS_math_setCellMat4(g,2,1,m+l),SceneJS_math_setCellMat4(g,2,2,1-(_+d)),g},window.SceneJS_math_normalizeQuaternion=function(e){var t=vec4.length([e[0],e[1],e[2],e[3]]);return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},window.SceneJS_math_angleAxisFromQuaternion=function(e){var t=(e=SceneJS_math_normalizeQuaternion(e))[3],r=2*Math.acos(t),i=Math.sqrt(1-t*t);return i<.001?{x:e[0],y:e[1],z:e[2],angle:57.295779579*r}:{x:e[0]/i,y:e[1]/i,z:e[2]/i,angle:57.295779579*r}},window.SceneJS_math_decompressPosition=function(e,t,r){e[0]=t[0]*r[0]+r[12],e[1]=t[1]*r[5]+r[13],e[2]=t[2]*r[10]+r[14]},window.SceneJS_math_decompressUV=function(e,t,r){e[0]=t[0]*r[0]+r[6],e[1]=t[1]*r[4]+r[7]},window.SceneJS_math_getPickPrimitives=function(e,t,r){var i,a,n=!!t;n?(a=t.length,i=r?new Uint16Array(3*a):new Float32Array(3*a)):(a=e.length/3,i=e);for(var o,s,l,c,u,_,h,f=new Uint8Array(4*a),d=0,m=0;m<a;m+=3)s=3*m,l=4*m,h=d>>24&255,_=d>>16&255,u=d>>8&255,c=255&d,n&&(i[s]=e[o=3*t[m]],i[s+1]=e[o+1],i[s+2]=e[o+2]),f[l]=c,f[l+1]=u,f[l+2]=_,f[l+3]=h,n&&(i[s+3]=e[o=3*t[m+1]],i[s+4]=e[o+1],i[s+5]=e[o+2]),f[l+4]=c,f[l+5]=u,f[l+6]=_,f[l+7]=h,n&&(i[s+6]=e[o=3*t[m+2]],i[s+7]=e[o+1],i[s+8]=e[o+2]),f[l+8]=c,f[l+9]=u,f[l+10]=_,f[l+11]=h,d++;return{positions:i,colors:f}},window.SceneJS_math_getPickPositions=function(e,t){for(var r,i,a=t.length,n=new Float32Array(3*a),o=0;o<a;o++)n[r=3*o]=e[i=3*t[o]],n[r+1]=e[i+1],n[r+2]=e[i+2];return n},window.SceneJS_math_getPickColors=function(e){for(var t,r,i,a,n,o=e.length,s=new Uint8Array(4*o),l=0,c=0;c<o;c+=3)n=l>>24&255,a=l>>16&255,i=l>>8&255,s[t=4*c]=r=255&l,s[t+1]=i,s[t+2]=a,s[t+3]=n,s[t+4]=r,s[t+5]=i,s[t+6]=a,s[t+7]=n,s[t+8]=r,s[t+9]=i,s[t+10]=a,s[t+11]=n,l++;return s},window.SceneJS_math_rayPlaneIntersect=function(a,n,o,s,l,c){c=c||vec3.create(),n=vec3.normalize(e,n);var u=vec3.subtract(t,s,o),_=vec3.subtract(r,l,o),h=vec3.cross(i,u,_);vec3.normalize(h,h);var f=-vec3.dot(o,h),d=-(vec3.dot(a,h)+f)/vec3.dot(n,h);return c[0]=a[0]+d*n[0],c[1]=a[1]+d*n[1],c[2]=a[2]+d*n[2],c},window.SceneJS_math_cartesianToBarycentric=function(i,a,n,o,s){var l=vec3.subtract(e,o,a),c=vec3.subtract(t,n,a),u=vec3.subtract(r,i,a),_=vec3.dot(l,l),h=vec3.dot(l,c),f=vec3.dot(l,u),d=vec3.dot(c,c),m=vec3.dot(c,u),p=_*d-h*h;if(0===p)return null;var g=1/p,y=(d*f-h*m)*g,v=(_*m-h*f)*g;return s[0]=1-y-v,s[1]=v,s[2]=y,s},window.SceneJS_math_barycentricToCartesian=function(e,t,r,i,a){var n=e[0],o=e[1],s=e[2];return a[0]=t[0]*n+r[0]*o+i[0]*s,a[1]=t[1]*n+r[1]*o+i[1]*s,a[2]=t[2]*n+r[2]*o+i[2]*s,a},window.SceneJS_math_barycentricToCartesian=function(e,t,r,i,a){a=a||vec3.create();var n=e[0],o=e[1],s=e[2];return a[0]=t[0]*n+r[0]*o+i[0]*s,a[1]=t[1]*n+r[1]*o+i[1]*s,a[2]=t[2]*n+r[2]*o+i[2]*s,a},window.SceneJS_math_buildTangents=function(s,l,c,u,_){for(var h=new Float32Array(s.length),f=vec3.create(),d=vec3.create(),m=vec3.create(),p=vec2.create(),g=vec2.create(),y=vec2.create(),v=l?l.length:s.length/3,S=0;S<v;S+=3){var E=l?l[S]:S;f.set(s.subarray(3*E,3*E+3)),p.set(c.subarray(2*E,2*E+2)),d.set(s.subarray(3*(E=l?l[S+1]:S+1),3*E+3)),g.set(c.subarray(2*E,2*E+2)),m.set(s.subarray(3*(E=l?l[S+2]:S+2),3*E+3)),y.set(c.subarray(2*E,2*E+2)),u&&(SceneJS_math_decompressPosition(f,f,u),SceneJS_math_decompressPosition(d,d,u),SceneJS_math_decompressPosition(m,m,u)),_&&(SceneJS_math_decompressUV(p,p,_),SceneJS_math_decompressUV(g,g,_),SceneJS_math_decompressUV(y,y,_));var b=vec3.subtract(e,d,f),I=vec3.subtract(t,m,f),x=vec2.subtract(r,g,p),C=vec2.subtract(i,y,p),T=x[0]*C[1]-x[1]*C[0];0===T&&(T=.001);for(var N=1/T,D=vec3.scale(n,vec3.subtract(o,vec3.scale(a,b,C[1]),vec3.scale(n,I,x[1])),N),A=0;A<3;A++){var P=l?3*l[S+A]:3*(S+A);h[P]+=D[0],h[P+1]+=D[1],h[P+2]+=D[2]}}return h},window.SceneJS_math_octDecodeVec2=function(e,t){var r=e[0],i=e[1];r=(2*r+1)/255,i=(2*i+1)/255;var a=1-Math.abs(r)-Math.abs(i);a<0&&(r=(1-Math.abs(i))*(r>=0?1:-1),i=(1-Math.abs(r))*(i>=0?1:-1));var n=Math.sqrt(r*r+i*i+a*a);return t[0]=r/n,t[1]=i/n,t[2]=a/n,t}}(),function(){"use strict";SceneJS._webgl={enumMap:{funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"}}}(),function(){"use strict";SceneJS._webgl.ArrayBuffer=function(e,t,r,i,a,n,o){switch(this.allocated=!1,r.constructor){case Uint8Array:this.itemType=e.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=e.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=e.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=e.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=e.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=e.INT,this.itemByteSize=4;break;default:this.itemType=e.FLOAT,this.itemByteSize=4}this.gl=e,this.type=t,this.numItems=i,this.itemSize=a,this.usage=n,this.normalize=!!o,this._allocate(r,i)},SceneJS._webgl.ArrayBuffer.prototype._allocate=function(e,t){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,e,this.usage),this.gl.bindBuffer(this.type,null),this.numItems=t,this.length=e.length,this.allocated=!0)},SceneJS._webgl.ArrayBuffer.prototype.setData=function(e){this.allocated&&(this.gl.bindBuffer(this.type,this.handle),e.length>this.length?(this.gl.bufferData(this.type,e,this.usage),this.length=e.length):this.gl.bufferSubData(this.type,0,e),this.gl.bindBuffer(this.type,null),this.numItems=e.length)},SceneJS._webgl.ArrayBuffer.prototype.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},SceneJS._webgl.ArrayBuffer.prototype.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.handle=null,this.allocated=!1)},SceneJS._webgl.ArrayBuffer.prototype.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)}}(),function(){"use strict";SceneJS._webgl.Attribute=function(e,t){this.gl=e,this.location=t},SceneJS._webgl.Attribute.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalize,0,0))}}(),function(){"use strict";SceneJS._webgl.Framebuffer=function(e){this.allocated=!1,this.canvas=e.canvas,this.gl=e.canvas.gl,this.canvasWidth=0,this.canvasHeight=0,this.sizeRatio=e.sizeRatio||1,"number"==typeof e.colorAttachments&&(e.colorAttachments=new Array(e.colorAttachments));var t=e.colorAttachments||new Array(1);this.numColorAttachments=t.length,this.colorAttachments=new Array(this.numColorAttachments);for(var r=0;r<this.numColorAttachments;++r){var i=t[r]||{};this.colorAttachments[r]={format:void 0!==i.format?this.gl[i.format]:this.gl.RGBA,type:void 0!==i.type?this.gl[i.type]:this.gl.UNSIGNED_BYTE,minFilter:void 0!==i.minFilter?this.gl[i.minFilter]:this.gl.LINEAR,magFilter:void 0!==i.magFilter?this.gl[i.magFilter]:this.gl.LINEAR,wrapS:void 0!==i.wrapS?this.gl[i.wrapS]:this.gl.CLAMP_TO_EDGE,wrapT:void 0!==i.wrapT?this.gl[i.wrapT]:this.gl.CLAMP_TO_EDGE}}this.sharedDepthBuffer=e.sharedDepthBuffer||null,this.hasDepthAttachment=!1!==e.depthAttachment,this.useDepthTextures=SceneJS.WEBGL_INFO.depthTexturesSupported,this.drawBuffers=this.gl.getExtension("WEBGL_draw_buffers"),window.localContentOnly&&(this.useDepthTextures=!1),this.buf=null,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.webglRestored=function(e){this.gl=e,this.buf=null,this.allocated=!1,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.bind=function(){this._touch(),this.bound||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),this.gl.viewport(0,0,this.buf.width,this.buf.height),this.bound=!0)},SceneJS._webgl.Framebuffer.prototype._touch=function(){var e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;if(this.buf){if(this.canvasWidth==e&&this.canvasHeight==t)return;for(var r=0;r<this.numColorAttachments;++r)this.gl.deleteTexture(this.buf.colorTargets[r]);this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.gl.deleteFramebuffer(this.buf.framebuf)}this.canvasWidth=e,this.canvasHeight=t;var i=Math.floor(e*this.sizeRatio),a=Math.floor(t*this.sizeRatio);for(this.buf={framebuf:this.gl.createFramebuffer(),colorTargets:new Array(this.numColorAttachments),width:i,height:a},this.buf.depthTarget=this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget().texture():this.useDepthTextures?this.gl.createTexture():this.gl.createRenderbuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),r=0;r<this.numColorAttachments;++r)this.buf.colorTargets[r]=this.gl.createTexture(),this._setTexture(this.buf.colorTargets[r],i,a,this.colorAttachments[r]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0+r,this.gl.TEXTURE_2D,this.buf.colorTargets[r],0);if(this.drawBuffers){var n=new Array(this.numColorAttachments);for(r=0;r<this.numColorAttachments;++r)n[r]=this.gl.COLOR_ATTACHMENT0+r;this.drawBuffers.drawBuffersWEBGL(n)}if(this.hasDepthAttachment&&(this.useDepthTextures?(this.sharedDepthBuffer||this._setTexture(this.buf.depthTarget,i,a,{format:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.buf.depthTarget,0)):(this.sharedDepthBuffer||(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,i,a)),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null))),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),!this.gl.isFramebuffer(this.buf.framebuf))throw SceneJS_error.fatalError(SceneJS.errors.INVALID_FRAMEBUFFER,"Invalid framebuffer");var o=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);switch(o){case this.gl.FRAMEBUFFER_COMPLETE:break;case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: "+o)}this.bound=!1},SceneJS._webgl.Framebuffer.prototype._setTexture=function(e,t,r,i){var a=void 0!==i.format?i.format:this.gl.RGBA,n=void 0!==i.type?i.type:this.gl.UNSIGNED_BYTE,o=void 0!==i.minFilter?i.minFilter:this.gl.LINEAR,s=void 0!==i.magFilter?i.magFilter:this.gl.LINEAR,l=void 0!==i.wrapS?i.wrapS:this.gl.CLAMP_TO_EDGE,c=void 0!==i.wrapT?i.wrapT:this.gl.CLAMP_TO_EDGE;this.gl.bindTexture(this.gl.TEXTURE_2D,e);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,a,t,r,0,a,n,null)}catch(_){var u=new WebGLUnsignedByteArray(t*r*3);this.gl.texImage2D(this.gl.TEXTURE_2D,0,a,t,r,0,a,n,u)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,o),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,l),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,c)},SceneJS._webgl.Framebuffer.prototype.clear=function(){if(!this.bound)throw"Render buffer not bound";this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.BLEND)},SceneJS._webgl.Framebuffer.prototype.read=function(e,t){var r=e,i=this.canvas.canvas.height-t,a=new Uint8Array(4);return this.gl.readPixels(r,i,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),a},SceneJS._webgl.Framebuffer.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.bound=!1},SceneJS._webgl.Framebuffer.prototype.getColorTarget=function(e){var t=this;return e=e||0,{bind:function(r){return!(!t.buf||!t.buf.colorTargets[e]||(t.gl.activeTexture(t.gl.TEXTURE0+r),t.gl.bindTexture(t.gl.TEXTURE_2D,t.buf.colorTargets[e]),0))},unbind:function(r){t.buf&&t.buf.colorTargets[e]&&(t.gl.activeTexture(t.gl.TEXTURE0+r),t.gl.bindTexture(t.gl.TEXTURE_2D,null))},texture:function(){return t.buf.colorTargets[e]}}},SceneJS._webgl.Framebuffer.prototype.getDepthTarget=function(){var e=this;return this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget():{bind:function(t){return!(!e.buf||!e.buf.depthTarget||(e.gl.activeTexture(e.gl.TEXTURE0+t),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buf.depthTarget),0))},unbind:function(t){e.buf&&e.buf.depthTarget&&(e.gl.activeTexture(e.gl.TEXTURE0+t),e.gl.bindTexture(e.gl.TEXTURE_2D,null))},texture:function(){return e.buf.depthTarget}}},SceneJS._webgl.Framebuffer.prototype.destroy=function(){if(this.buf){for(var e=0;e<this.numColorAttachments;++e)this.gl.deleteTexture(this.buf.colorTargets[e]);this.gl.deleteFramebuffer(this.buf.framebuf),this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.buf=null,this.bound=!1}}}(),function(){"use strict";SceneJS._webgl.Program=function(e,t,r,i,a){this.stats=e,this.hash=r,this.useCount=0,this.allocated=!1,this.gl=null,this._uniforms={},this._samplers={},this._attributes={},this.vertexSource=i,this.fragmentSource=a,this._vertexShader=null,this._fragmentShader=null,this.build(t)},SceneJS._webgl.Program.prototype.build=function(e){var t,r,i,a,n,o=SceneJS.timer.now(),s=this.stats;if(this.gl=e,this._vertexShader=new SceneJS._webgl.Shader(s,e,e.VERTEX_SHADER,this.vertexSource),this._fragmentShader=new SceneJS._webgl.Shader(s,e,e.FRAGMENT_SHADER,this.fragmentSource),this.handle=e.createProgram(),this.handle){e.attachShader(this.handle,this._vertexShader.handle),e.attachShader(this.handle,this._fragmentShader.handle),e.linkProgram(this.handle),e.getProgramParameter(this.handle,e.LINK_STATUS)||SceneJS.log.error("Shader program failed to link: "+e.getProgramInfoLog(this.handle));var l=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS);for(r=0;r<l;++r)(i=e.getActiveUniform(this.handle,r))&&("\0"==(a=i.name)[a.length-1]&&(a=a.substr(0,a.length-1)),n=e.getUniformLocation(this.handle,a),i.type==e.SAMPLER_2D||i.type==e.SAMPLER_CUBE||35682==i.type?this._samplers[a]=n:this._uniforms[a]=new SceneJS._webgl.Uniform(e,i.type,i.size,n));var c=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(r=0;r<c;r++)(t=e.getActiveAttrib(this.handle,r))&&(n=e.getAttribLocation(this.handle,t.name),this._attributes[t.name]=new SceneJS._webgl.Attribute(e,n));s.load.programCompilation+=SceneJS.timer.now()-o,this.allocated=!0}},SceneJS._webgl.Program.prototype.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},SceneJS._webgl.Program.prototype.getUniformLocation=function(e){if(this.allocated){var t=this._uniforms[e];return t?t.getLocation():void 0}},SceneJS._webgl.Program.prototype.getUniform=function(e){if(this.allocated)return this._uniforms[e]||void 0},SceneJS._webgl.Program.prototype.getAttribute=function(e){if(this.allocated)return this._attributes[e]||void 0},SceneJS._webgl.Program.prototype.bindArrayBuffer=function(e,t){if(this.allocated){var r=this._attributes[e];r&&r.bindArrayBuffer(t)}},SceneJS._webgl.Program.prototype.bindTexture=function(e,t,r){if(!this.allocated)return!1;var i=this._samplers[e];return!!i&&!!t.bind(r)&&(this.gl.uniform1i(i,r),!0)},SceneJS._webgl.Program.prototype.destroy=function(){this.allocated&&(this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this._attributes=null,this._uniforms=null,this._samplers=null,this.allocated=!1)},SceneJS._webgl.Program.prototype.setUniform=function(e,t){if(this.allocated){var r=this._uniforms[e];r&&r.setValue(t)}}}(),function(){"use strict";SceneJS._webgl.Shader=function(e,t,r,i){this.allocated=!1;var a=SceneJS.timer.now();if(this.handle=t.createShader(r),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create WebGL shader");if(t.shaderSource(this.handle,i),t.compileShader(this.handle),this.valid=0!=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.valid&&!t.isContextLost()){SceneJS.log.error("Shader program failed to compile: "+t.getShaderInfoLog(this.handle)),SceneJS.log.error("Shader source:");for(var n=i.split("\n"),o=0;o<n.length;o++)SceneJS.log.error(o+1+": "+n[o]);throw SceneJS_error.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}e.load.shaderCompilation+=SceneJS.timer.now()-a,this.allocated=!0}}(),function(){"use strict";SceneJS._webgl.Texture2D=function(e,t){try{this._init(e,t)}catch(r){throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create texture: "+r.message||r)}},SceneJS._webgl.Texture2D.prototype._init=function(e,t){this.allocated=!1,this.gl=e,this.target=t.target||e.TEXTURE_2D,this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.update=t.update,this.texture=t.texture,this.compressed=!!t.compressed,this.format=e.RGBA,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0,e.bindTexture(this.target,this.texture),t.minFilter&&e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,t.minFilter),t.magFilter&&e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,t.magFilter),t.wrapS&&e.texParameteri(this.target,e.TEXTURE_WRAP_S,t.wrapS),t.wrapT&&e.texParameteri(this.target,e.TEXTURE_WRAP_T,t.wrapT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1!==t.flipY),this.compressed||this.minFilter!=e.NEAREST_MIPMAP_NEAREST&&this.minFilter!=e.LINEAR_MIPMAP_NEAREST&&this.minFilter!=e.NEAREST_MIPMAP_LINEAR&&this.minFilter!=e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target),e.bindTexture(this.target,null),this.allocated=!0},SceneJS._webgl.Texture2D.prototype.bind=function(e){if(this.allocated){var t=this.gl;return!!this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),this.update&&this.update(t),!0)}},SceneJS._webgl.Texture2D.prototype.unbind=function(e){if(this.allocated){var t=this.gl;this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null))}},SceneJS._webgl.Texture2D.prototype.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}(),function(){"use strict";var e,t,r,i=(e={},(r=(t=document.createElement("canvas")).getContext("webgl")||t.getContext("experimental-webgl"))?(e[r.BOOL]=function(e){var t,r,i=!0;if(1===this.length)this.value[0]!==e&&(i=!1);else for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){i=!1;break}if(!i){if(1===this.length)this.value[0]=e;else for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform1fv(this.location,this.value)}},e[r.BOOL_VEC2]=function(e){var t,r,i=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){i=!1;break}if(!i){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform2iv(this.location,e)}},e[r.BOOL_VEC3]=function(e){var t,r,i=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){i=!1;break}if(!i){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform3iv(this.location,e)}},e[r.BOOL_VEC4]=function(e){var t,r,i=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){i=!1;break}if(!i){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform4iv(this.location,e)}},e[r.INT_VEC2]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform2iv(this.location,e))},e[r.INT_VEC3]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform3iv(this.location,e))},e[r.INT_VEC4]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform4iv(this.location,e))},e[r.FLOAT]=function(e){var t=!0;if(1===this.length)this.value[0]!==e&&(t=!1);else for(var r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(1===this.length?this.value[0]=e:this.value.set(e),this.gl.uniform1fv(this.location,this.value))},e[r.FLOAT_VEC2]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform2fv(this.location,e))},e[r.FLOAT_VEC3]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform3fv(this.location,e))},e[r.FLOAT_VEC4]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform4fv(this.location,e))},e[r.FLOAT_MAT2]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix2fv(this.location,!1,e))},e[r.FLOAT_MAT3]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix3fv(this.location,!1,e))},e[r.FLOAT_MAT4]=function(e){for(var t=!0,r=0,i=this.length;r<i;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix4fv(this.location,!1,e))},e):e);SceneJS._webgl.Uniform=function(e,t,r,a){this.gl=e,this.location=a,this.value=function(e,t,r){if(t===e.BOOL)return new Array(r);if(t===e.BOOL_VEC2)return new Array(2*r);if(t===e.BOOL_VEC3)return new Array(3*r);if(t===e.BOOL_VEC4)return new Array(4*r);if(t===e.INT)return new Uint32Array(r);if(t===e.INT_VEC2)return new Uint32Array(2*r);if(t===e.INT_VEC3)return new Uint32Array(3*r);if(t===e.INT_VEC4)return new Uint32Array(4*r);if(t===e.FLOAT)return new Float32Array(r);if(t===e.FLOAT_VEC2)return new Float32Array(2*r);if(t===e.FLOAT_VEC3)return new Float32Array(3*r);if(t===e.FLOAT_VEC4)return new Float32Array(4*r);if(t===e.FLOAT_MAT2)return new Float32Array(4*r);if(t===e.FLOAT_MAT3)return new Float32Array(9*r);if(t===e.FLOAT_MAT4)return new Float32Array(16*r);throw"Unsupported shader uniform type: "+t}(e,t,r),this.length=this.value.length,this.setValue=i[t]},SceneJS._webgl.Uniform.prototype.getLocation=function(){return this.location}}(),function(){"use strict";window.SceneJS_Core=function(e){this.type=e,this.coreId=null,this.stateId=null,this.useCount=0}}(),ColorFresnel.prototype.isEqual=function(e,t){var r=e.center.reduce((function(e,r,i){return e&&r===t.center[i]}),!0),i=e.edge.reduce((function(e,r,i){return e&&r===t.edge[i]}),!0);return r&&i&&e.edgeBias===t.edgeBias&&e.centerBias===t.centerBias&&e.power===t.power},ScalarFresnel.prototype.isEqual=function(e,t){return e.center===t.center&&e.edge==t.edge&&e.edgeBias===t.edgeBias&&e.centerBias===t.centerBias&&e.power===t.power},function(){"use strict";var e=SceneJS.KD_TREE_MAX_DEPTH,t=SceneJS.KD_TREE_MIN_TRIANGLES,r=window.SceneJS_GeometryCore=function(){this.type="xform",this.coreId=null,this.stateId=null,this.kdTree=null,this.kdTreeDirty=!0};function i(e){var t,r,i,a=e._engine.canvas.gl;e.arrays.positions?(r=(t=SceneJS_math_getPickPrimitives(e.arrays.positions,e.arrays.indices,e.compressedPositions)).positions,i=t.colors,e.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,r,r.length,3,a.STATIC_DRAW),e._engine.stats.memory.pickPositions+=r.length*r.constructor.BYTES_PER_ELEMENT,e._engine.stats.memory.pickColors+=i.length*i.constructor.BYTES_PER_ELEMENT):(i=SceneJS_math_getPickColors(e.arrays.indices),e._engine.stats.memory.pickColors+=i.length*i.constructor.BYTES_PER_ELEMENT),e.pickColorsBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,i,i.length,4,a.STATIC_DRAW,!0)}r.prototype.getTangents=function(e){if(this.tangentBufs||(this.tangentBufs=[]),this.tangentBufs[e])return this.tangentBufs[e];var t=this.arrays,r=this.arrays.tangents[e],i=this._engine.canvas.gl;return r||t.positions&&t.uvs&&t.uvs[e]&&(r=SceneJS_math_buildTangents(t.positions,t.indices,t.uvs[e],this.positionDecodeMat,this.compressedUVs&&this.uvDecodeMats[e]),this._engine.stats.memory.tangents+=r.length*r.constructor.BYTES_PER_ELEMENT),r?(this.tangentBufs[e]=new SceneJS._webgl.ArrayBuffer(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),this.arrays.tangents[e]=!0,this.tangentBufs[e]):null},r.prototype.getPickPositions=function(){return this.pickPositionsBuf?this.pickPositionsBuf:(i(this),this.pickPositionsBuf)},r.prototype.getPickColors=function(){return this.pickColorsBuf?this.pickColorsBuf:(i(this),this.pickColorsBuf)},r.prototype.getKdTree=function(){return this.kdTree||this.buildKdTree(),this.kdTree},r.prototype.buildKdTree=function(){if(this.kdTreeDirty){var r=this.arrays.positions,i=this.arrays.indices;if(r){var n;n=i?i.length/3:r.length/9;for(var o=new Array(n),s=0;s<n;++s)o[s]=s;this.kdTree=function r(i,n,o,s,l,c){var u,_,h=vec3.create(),f=vec3.create(),d={triangles:null,left:null,right:null,bb:{min:h,max:f}};for(h[0]=h[1]=h[2]=Number.POSITIVE_INFINITY,f[0]=f[1]=f[2]=Number.NEGATIVE_INFINITY,u=0,_=i.length;u<_;++u)for(var m=3*i[u],p=0;p<3;++p){var g;a[0]=o[g=n?3*n[m+p]:3*(m+p)],a[1]=o[g+1],a[2]=o[g+2],s&&SceneJS_math_decompressPosition(a,a,s),a[0]<h[0]&&(h[0]=a[0]),a[0]>f[0]&&(f[0]=a[0]),a[1]<h[1]&&(h[1]=a[1]),a[1]>f[1]&&(f[1]=a[1]),a[2]<h[2]&&(h[2]=a[2]),a[2]>f[2]&&(f[2]=a[2])}if(c>e)return d.triangles=i,d;var y=(h[l]+f[l])/2,v=new Array(i.length),S=0,E=new Array(i.length),b=0;for(u=0,_=i.length;u<_;++u){var I,x,C;m=3*i[u],n?(I=n[m],x=n[m+1],C=n[m+2]):(I=m,x=m+1,C=m+2);var T=o[3*I+l],N=o[3*x+l],D=o[3*C+l];if(s){var A=s[5*l],P=s[l+12];T=T*A+P,N=N*A+P,D=D*A+P}T<=y||N<=y||D<=y?v[S++]=i[u]:E[b++]=i[u]}return S<t||b<t?(d.triangles=i,d):(v.length=S,E.length=b,d.left=r(v,n,o,s,(l+1)%3,c+1),d.right=r(E,n,o,s,(l+1)%3,c+1),d)}(o,i,r,this.positionDecodeMat,0,0),this.kdTreeDirty=!1}}};var a=vec3.create()}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.DEPTH_TEST_FLAGS,r=window.SceneJS_PropertiesCore=function(){this.type="properties",this.coreId=null,this.stateId=null,this.useCount=0,this.xrayParams=new Float32Array([.4,.8]),this.solidColor=new Float32Array([1,1,1]),this.colorModifiers=[],this.colorModRange=!1,this.opacityModifiers=[],this.opacityModRange=!1,this.name=null,this.flags=e.PICKING|e.ENABLED|e.REFLECTIVE|e.CCW|e.CLIPPING,this.transparent=!1,this.partiallyOpaque=!1,this.stochasticAlpha=!1,this.blend=!1,this.fragmentShaderHeader=null,this.fragmentShaderFooter=null,this.depthTest=t.ENABLED,this.hash="refl;;;;;;;"};r.prototype.getFlag=function(e){return!!(this.flags&e)},r.prototype.setFlag=function(e,t){this.flags=t?this.flags|e:this.flags&~e},r.prototype.resetTransparency=function(){var t=this.opacityModifiers,r=!1,i=!1,a=0;for(a=0;a<t.length;a++)if(t[a].value<1){r=!0;break}for(a=0;a<t.length;a++)if(t[a].range){i=!0;break}this.stochasticAlpha=this.getFlag(e.STOCHASTIC_ALPHA),this.transparent=this.getFlag(e.FORCE_TRANSPARENT)||!this.stochasticAlpha&&(r||this.getFlag(e.XRAY)),this.partiallyOpaque=this.getFlag(e.PARTIALLY_OPAQUE)||r&&i&&!this.getFlag(e.XRAY)}}(),function(){"use strict";var e=window.SceneJS_CoreFactory=function(){this._stateMap=new SceneJS_Map(null,SceneJS._baseStateId),this._cores={}};e.coreConstructors={geometry:SceneJS_GeometryCore,properties:SceneJS_PropertiesCore,default:SceneJS_Core},e.prototype.getCore=function(t,r){var i,a=this._cores[t];return a||(a=this._cores[t]={}),r&&(i=a[r])?(i.useCount++,i):((i=new(e.coreConstructors[t]||e.coreConstructors.default)(t)).useCount=1,i.stateId=this._stateMap.addItem(i),i.coreId=null!=r&&null!=r?r:i.stateId,a[i.coreId]=i,i)},e.prototype.hasCore=function(e,t){var r=this._cores[e];return r&&r[t]},e.prototype.putCore=function(e){0!=e.useCount&&--e.useCount<=0&&(delete this._cores[e.type][e.coreId],this._stateMap.removeItem(e.stateId))},e.prototype.webglRestored=function(){var e,t;for(var r in this._cores)if(this._cores.hasOwnProperty(r)&&(e=this._cores[r]))for(var i in e)e.hasOwnProperty(i)&&(t=e[i])&&t.webglRestored&&t.webglRestored()}}(),function(){"use strict";SceneJS.Node=function(){},SceneJS.Node.prototype.constructor=SceneJS.Node,SceneJS.Node.prototype._construct=function(e,t,r,i){this._engine=e,this._core=t,this.coreId=t.coreId,this.id=r.id||r.nodeId||i,this.type=r.type||"node",this.data=r.data,this.parent=null,this.nodes=[],this.dirty=!1,this.disabled=!1,this.branchDirty=!1,this._init&&this._init(r)},SceneJS.Node.prototype.disable=function(){this.disabled||(this.disabled=!0,this._engine.branchDirty(this))},SceneJS.Node.prototype.enable=function(){this.disabled&&(this.disabled=!1,this._engine.branchDirty(this))},SceneJS.Node.prototype.log=function(){var e,t;switch(1==arguments.length?(e="info",t=arguments[0]):2==arguments.length&&(e=arguments[0],t=arguments[1]),e){case"warn":t="WARN;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;case"error":t="ERROR; [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;default:t="INFO;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t}console[e]?console[e](t):console.log(t)},SceneJS.Node.prototype.getScene=function(){return this._engine.scene},SceneJS.Node.prototype.getCoreId=function(){return this._core.coreId},SceneJS.Node.prototype.getID=function(){return this.id},SceneJS.Node.prototype.getId=function(){return this.id},SceneJS.Node.prototype.getNodeId=function(){return this.id},SceneJS.Node.prototype.getType=function(){return this.type},SceneJS.Node.prototype.getData=function(){return this.data},SceneJS.Node.prototype.setData=function(e){return this.data=e,this},SceneJS.Node.prototype.getNumNodes=function(){return this.nodes.length},SceneJS.Node.prototype.getNodes=function(){return this.nodes.slice(0)},SceneJS.Node.prototype.getNodeAt=function(e){return e<0||e>=this.nodes.length?null:this.nodes[e]},SceneJS.Node.prototype.getFirstNode=function(){return 0==this.nodes.length?null:this.nodes[0]},SceneJS.Node.prototype.getLastNode=function(){return 0==this.nodes.length?null:this.nodes[this.nodes.length-1]},SceneJS.Node.prototype.getNode=function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].id==e)return this.nodes[t];return null},SceneJS.Node.prototype.disconnectNodeAt=function(e){var t=this.nodes.splice(e,1);return t.length>0?(t[0]._disconnectFromScene(),t[0].parent=null,this._engine.branchDirty(this),t[0]):null},SceneJS.Node.prototype.disconnect=function(){if(this.parent){for(var e=0;e<this.parent.nodes.length;e++)if(this.parent.nodes[e]===this){var t=this.parent.disconnectNodeAt(e);return this._disconnectFromScene(),this.parent=null,t}this._disconnectFromScene(),this.parent=null}return null},SceneJS.Node.prototype._connectToScene=function(){for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]._connectToScene()},SceneJS.Node.prototype._disconnectFromScene=function(){for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]._disconnectFromScene()},SceneJS.Node.prototype.removeNodeAt=function(e){var t=this.disconnectNodeAt(e);t&&t.destroy()},SceneJS.Node.prototype.removeNode=function(e){if(!e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined");if(!e._compile&&"string"==typeof e){var t=this._engine.findNode(e);if(!t)throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+e+"'");e=t}if(e._compile)for(var r=0;r<this.nodes.length;r++)if(this.nodes[r]===e)return this.removeNodeAt(r);throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(e._compile?": "+e.id:e))},SceneJS.Node.prototype.disconnectNodes=function(){for(var e=this.nodes.length,t=0;t<e;t++)this.nodes[t]._disconnectFromScene(),this.nodes[t].parent=null;var r=this.nodes;return this.nodes=[],this._engine.branchDirty(this),r},SceneJS.Node.prototype.removeNodes=function(){for(var e=this.disconnectNodes(),t=0;t<e.length;t++)e[t].destroy()},SceneJS.Node.prototype.splice=function(){var e,t;if(null==this.parent)return null;var r=this.parent,i=this.disconnectNodes();for(e=0,t=i.length;e<t;e++)i[e].parent=this.parent,i[e]._connectToScene();for(e=0,t=r.nodes.length;e<t;e++)if(r.nodes[e]===this)return r.nodes.splice.apply(r.nodes,[e,1].concat(i)),this.nodes=[],this._disconnectFromScene(),this.parent=null,this.destroy(),this._engine.branchDirty(r),r},SceneJS.Node.prototype.addNodes=function(e){if(!e)return null;for(var t=e.length-1;t>=0;t--)this.addNode(e[t])},SceneJS.Node.prototype.addNode=function(e,t){if((e=e||{})._compile){if(null!=e.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e}if("string"==typeof e){var r=this._engine.findNode(e);if(!r)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+e+"'");if(null!=(e=r).parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e}if(e.type=e.type||"node","node"==e.type||this._engine.hasNodeType(e.type))return e=this._engine.createNode(e),this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e;var i=this;return this._engine.createNode(e,(function(e){i.nodes.push(e),e.parent=i,e._connectToScene(),i._engine.branchDirty(e),t&&t(e)})),null},SceneJS.Node.prototype.insertNode=function(e,t){if(!e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is undefined");if(e._compile||(e=this._engine.createNode(e)),!e._compile)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is not a SceneJS.Node");if(null!=e.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is still attached to another parent");if(null==t)e.addNodes(this.disconnectNodes()),this.addNode(e);else{if(t<0)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node index out of range: -1");t>=this.nodes.length?this.nodes.push(e):this.nodes.splice(t,0,e)}return e.parent=this,e._connectToScene(),e},SceneJS.Node.prototype.mapNodes=function(e){if(e(this))return this;for(var t,r=0;r<this.nodes.length;r++)if(t=this.nodes[r].mapNodes(e))return t;return null},SceneJS.Node.prototype.getParent=function(e){return this.parent},SceneJS.Node.prototype.getParentOfType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.eachParent=function(e){if(!e)throw"SceneJS.Node.eachParent param 'fn' is null or undefined";for(var t=0,r=this;r.parent;){if(!0===e.call(r.parent,t++))return r.parent;r=r.parent}return null},SceneJS.Node.prototype.hasNode=function(e){if(null==e)throw"SceneJS.Node.hasNode param 'node' is null or undefined";var t,r=typeof e;if("number"==r)t=this.getNodeAt(e);else{if("string"!=r)throw"SceneJS.Node.hasNode param 'node' should be either an index number or an ID string";t=this.getNode(e)}return null!=t&&null!=t},SceneJS.Node.prototype.node=function(e){if(null==e)throw"SceneJS.Node.node param 'node' is null or undefined";var t,r=typeof e;if("number"==r)t=this.getNodeAt(e);else{if("string"!=r)throw"SceneJS.Node.node param 'node' should be either an index number or an ID string";t=this.getNode(e)}if(!t)throw"SceneJS.Node.node - node not found: '"+e+"'";return t},SceneJS.Node.prototype.eachNode=function(e,t){if(!e)throw"SceneJS.Node.eachNode param 'fn' is null or undefined";if("function"!=typeof e)throw"SceneJS.Node.eachNode param 'fn' should be a function";var r,i=0;return(t=t||{}).andSelf&&!0===e.call(this,i++)?this:(t.depthFirst||t.breadthFirst?t.depthFirst&&(r=this._iterateEachNodeDepthFirst(e,this,i,!1)):r=this._iterateEachNode(e,this,i),r||void 0)},SceneJS.Node.prototype.numNodes=function(){return this.nodes.length},SceneJS.Node.prototype._iterateEachNode=function(e,t,r){for(var i,a=t.nodes.length,n=0;n<a;n++)if(!0===e.call(i=t.nodes[n],r++))return i;return null},SceneJS.Node.prototype._iterateEachNodeDepthFirst=function(e,t,r,i){if(i&&!0===e.call(t,r++))return t;i=!0;for(var a,n=t.nodes.length,o=0;o<n;o++)if(a=this._iterateEachNodeDepthFirst(e,t.nodes[o],r,i))return a;return null},SceneJS.Node.prototype.findNodesByType=function(e,t){return this._findNodesByType(e,[],t)},SceneJS.Node.prototype._findNodesByType=function(e,t,r){var i;for(i=0;i<this.nodes.length;i++){var a=this.nodes[i];a.type==e&&t.push(a)}if(r)for(i=0;i<this.nodes.length;i++)this.nodes[i]._findNodesByType(e,t,r);return t},SceneJS.Node.prototype.findParentByType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.getJSON=function(){return this},SceneJS.Node.prototype._compile=function(e){this.preCompile&&this.preCompile(),this._compileNodes(e),this.postCompile&&this.postCompile()},SceneJS.Node.prototype._compileNodes=function(e){for(var t,r=0,i=this.nodes.length;r<i;r++)(t=this.nodes[r]).branchDirty=t.branchDirty||this.branchDirty,(t.dirty||t.branchDirty||this._engine.sceneDirty)&&(t.disabled?t._compileNodes(e):t._compile(e),t.dirty=!1,t.branchDirty=!1)},SceneJS.Node.prototype.destroy=function(){if(!this.destroyed){if(this.parent)for(var e=this.parent.nodes,t=e.length,r=0;r<t;r++)if(e[r].id===this.id){e.splice(r,1);break}this._engine.scene.unpublish("nodes/"+this.id),this._destroyTree(),this._engine.display.objectListDirty=!0}return this},SceneJS.Node.prototype._destroyTree=function(){var e;this.destroyed=!0,this._engine.destroyNode(this);for(var t=0,r=this.nodes.length;t<r;t++)this._engine.scene.unpublish("nodes/"+(e=this.nodes[t]).id),e._destroyTree()},SceneJS.Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),this}}(),function(){"use strict";var e=window.SceneJS_NodeFactory=function(){this.nodes=new SceneJS_Map({})};e.nodeTypes={},e.createNodeType=function(t){if(e.nodeTypes[t])throw"Node type already defined: "+t;var r=function(){SceneJS.Node.apply(this,arguments),this.type=t};return(r.prototype=new SceneJS.Node).constructor=r,e.nodeTypes[t]=r,r},e.prototype.getNode=function(t,r,i){var a;r.type=r.type||"node","node"===r.type?a=SceneJS.Node:(a=e.nodeTypes[r.type])||(console.error("Unknown node type: "+r.type+" - can't create - making a SceneJS.Node by default"),a=SceneJS.Node);var n=new a,o=r.id||r.nodeId;return o?this.nodes.addItem(o,n):o=this.nodes.addItem(n),n._construct(t,i,r,o),n},e.prototype.putNode=function(e){this.nodes.removeItem(e.id)}}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.COLOR_MOD_FLAGS,r=SceneJS.DEPTH_TEST_FLAGS,i={saturation:t.SATURATION,brightness:t.BRIGHTNESS,contrast:t.CONTRAST,tintColor:t.TINT},a={enabled:r.ENABLED,disabled:r.DISABLED,alwaysPass:r.ALWAYS_PASS},n={};for(var o in a)n[a[o]]=o;var s=new SceneJS_PropertiesCore;s.stateId=SceneJS._baseStateId++;var l=[],c=0;function u(r){return(r.getFlag(e.REFLECTIVE)?"refl":"")+";"+(r.getFlag(e.SKYBOX)?"sky":"")+";"+(r.getFlag(e.SOLID)?"s":"")+";"+(r.getFlag(e.ROUND_POINTS)?"rpt":"")+";"+(r.getFlag(e.PERSPECTIVE_POINTS)?"ppt":"")+";"+(r.getFlag(e.BILLBOARD)?"b":"")+";"+(r.getFlag(e.STOCHASTIC_ALPHA)?"sa":"")+";"+function(e){var r="",i=0,a=e.colorModifiers.length;for(i=0;i<a;i++){var n=e.colorModifiers[i],o=n.applyTo,s=n.value;o===t.BRIGHTNESS?r+="b":o===t.CONTRAST?r+="c":o===t.SATURATION?r+="s":o===t.TINT&&(r+="t"),n.range&&(r+="r"),r+=s.isScalarFresnel?"sf":s.isColorFresnel?"cf":"nv"}return r}(r)+";"+function(e){var t="",r=0,i=e.opacityModifiers.length;for(r=0;r<i;r++){var a=e.opacityModifiers[r];t+=a.range?"r":"o",t+=a.value.isScalarFresnel?"sf":"nv"}return t}(r)+";"+(r.fragmentShaderHeader||"")+";"+(r.fragmentShaderFooter||"")+";"}SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.properties=s,c=0})),SceneJS.Properties=SceneJS_NodeFactory.createNodeType("properties"),SceneJS.Properties.prototype._init=function(e){1==this._core.useCount&&e.properties&&this.setProperties(e.properties)},SceneJS.Properties.prototype.setProperties=function(r){var n=this._core;if(null!=r.picking&&(n.setFlag(e.PICKING,r.picking),this._engine.display.imageDirty=!0),null!=r.solidColor){var o=s.solidColor,l=r.solidColor;n.solidColor[0]=null!=l.r?l.r:o[0],n.solidColor[1]=null!=l.g?l.g:o[1],n.solidColor[2]=null!=l.b?l.b:o[2],this._engine.display.imageDirty=!0}if(null!=r.clipping&&(n.setFlag(e.CLIPPING,r.clipping),this._engine.branchDirty(this)),null!=r.enabled&&(n.setFlag(e.ENABLED,r.enabled),this._engine.display.objectListDirty=!0),null!=r.frontface&&(n.setFlag(e.CCW,"ccw"===r.frontface),this._engine.display.imageDirty=!0),null!=r.reflective&&(n.setFlag(e.REFLECTIVE,r.reflective),this._engine.branchDirty(this)),null!=r.solid&&(n.setFlag(e.SOLID,r.solid),this._engine.branchDirty(this)),null!=r.skybox&&(n.setFlag(e.SKYBOX,r.skybox),this._engine.branchDirty(this)),null!=r.billboard&&(n.setFlag(e.BILLBOARD,r.billboard),this._engine.branchDirty(this)),r.colorModifiers){var c;n.colorModifiers.length=r.colorModifiers.length,n.colorModRange=!1;for(var _=0,h=r.colorModifiers.length;_<h;_++){var f=r.colorModifiers[_];c=i[f.applyTo]||f.applyTo,(m=f.value).isScalarFresnel||m.isColorFresnel||c!==t.CONTRAST||f.normalized||(m=f.value+1),n.colorModifiers[_]={applyTo:c,value:m,range:null},c===t.CONTRAST&&(n.colorModifiers[_].normalized=!0),f.range&&(n.colorModRange=!0,n.colorModifiers[_].range={center:new Float32Array(f.range.center),radius:new Float32Array([f.range.minRadius,f.range.maxRadius-f.range.minRadius])})}}if(null!=r.name&&(n.name=r.name),null!=r.xray){var d=n.transparent;n.setFlag(e.XRAY,r.xray),n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(null!=r.glassFactor&&(n.xrayParams[0]=r.glassFactor,this._engine.display.imageDirty=!0),null!=r.murkiness&&(n.xrayParams[1]=r.murkiness,this._engine.display.imageDirty=!0),r.opacityModifiers){d=n.transparent;var m,p,g=r.opacityModifiers.length;n.opacityModifiers.length=g,n.opacityModRange=!1;for(var y=0;y<g;++y)n.opacityModifiers[y]={value:m=(p=r.opacityModifiers[y]).value,range:null},p.range&&(n.opacityModRange=!0,n.opacityModifiers[y].range={center:new Float32Array(p.range.center),radius:new Float32Array([p.range.minRadius,p.range.maxRadius-p.range.minRadius])});n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(null!=r.noDepthMask&&(n.setFlag(e.NO_DEPTH_MASK,r.noDepthMask),this._engine.display.imageDirty=!0),null!=r.partiallyOpaque){var v=n.partiallyOpaque;n.setFlag(e.PARTIALLY_OPAQUE,r.partiallyOpaque),n.resetTransparency(),n.partiallyOpaque!==v&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0}null!=r.forceTransparent&&(d=n.transparent,n.setFlag(e.FORCE_TRANSPARENT,r.forceTransparent),n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0),null!=r.stochasticAlpha&&(d=n.transparent,n.setFlag(e.STOCHASTIC_ALPHA,r.stochasticAlpha),n.resetTransparency(),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.roundPoints&&(n.setFlag(e.ROUND_POINTS,r.roundPoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.perspectivePoints&&(n.setFlag(e.PERSPECTIVE_POINTS,r.perspectivePoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.fragmentShaderHeader&&(n.fragmentShaderHeader=r.fragmentShaderHeader,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.fragmentShaderFooter&&(n.fragmentShaderFooter=r.fragmentShaderFooter,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.depthTest&&(n.depthTest=a[r.depthTest]||r.depthTest,this._engine.display.imageDirty=!0);var S=n.hash;return n.hash=u(n),n.hash!==S&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this},SceneJS.Properties.prototype.getProperties=function(){var t=this._core;return{picking:t.getFlag(e.PICKING),clipping:t.getFlag(e.CLIPPING),enabled:t.getFlag(e.ENABLED),frontface:t.getFlag(e.CCW)?"ccw":"cw",reflective:t.getFlag(e.REFLECTIVE),solid:t.getFlag(e.SOLID),solidColor:t.solidColor,skybox:t.getFlag(e.SKYBOX),billboard:t.getFlag(e.BILLBOARD),fullyTransparent:t.getFlag(e.FULLY_TRANSPARENT),roundPoints:t.getFlag(e.ROUND_POINTS),perspectivePoints:t.getFlag(e.PERSPECTIVE_POINTS),xray:t.getFlag(e.XRAY),glassFactor:t.xrayParams[0],murkiness:t.xrayParams[1],colorModifiers:t.colorModifiers,opacityModifier:t.opacityModifiers,pointPerspectiveDistance:t.pointPerspectiveDistance,fragmentShaderHeader:t.fragmentShaderHeader,fragmentShaderFooter:t.fragmentShaderFooter,depthTest:n[t.depthTest]||"enabled"}},SceneJS.Properties.prototype.setPicking=function(t){return t=!!t,this._core.getFlag(e.PICKING)!==t&&(this._core.setFlag(e.PICKING,t),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getPicking=function(){return this._core.getFlag(e.PICKING)},SceneJS.Properties.prototype.setClipping=function(e){return this.setProperties({clipping:e}),this},SceneJS.Properties.prototype.getClipping=function(){return!!this.solidColor[3]},SceneJS.Properties.prototype.setEnabled=function(e){return this.setProperties({enabled:e})},SceneJS.Properties.prototype.getEnabled=function(){return this._core.getFlag(e.ENABLED)},SceneJS.Properties.prototype.setFrontface=function(t){var r="ccw"===t;return this._core.getFlag(e.CCW)!==r&&(this._core.setFlag(e.CCW,r),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFrontface=function(){return this._core.getFlag(e.CCW)?"ccw":"cw"},SceneJS.Properties.prototype.setReflective=function(t){return t=!!t,this._core.getFlag(e.REFLECTIVE)!=t&&(this._core.setFlag(e.REFLECTIVE,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getReflective=function(){return this._core.getFlag(e.REFLECTIVE)},SceneJS.Properties.prototype.setSolid=function(t){return t=!!t,this._core.getFlag(e.SOLID)!=t&&(this._core.setFlag(e.SOLID,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSolid=function(){return this._core.getFlag(e.SOLID)},SceneJS.Properties.prototype.setSolidColor=function(e){return this.setProperties({solidColor:e}),this},SceneJS.Properties.prototype.getSolidColor=function(){return{r:this._core.solidColor[0],g:this._core.solidColor[1],b:this._core.solidColor[2]}},SceneJS.Properties.prototype.setSkybox=function(t){return t=!!t,this._core.getFlag(e.SKYBOX)!=t&&(this._core.setFlag(e.SKYBOX,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSkybox=function(){return this._core.getFlag(e.SKYBOX)},SceneJS.Properties.prototype.setName=function(e){this._core.name=e},SceneJS.Properties.prototype.getName=function(){return this._core.name},SceneJS.Properties.prototype.setFullyTransparent=function(t){return t=!!t,this._core.getFlag(e.FULLY_TRANSPARENT)!==t&&(this._core.setFlag(e.FULLY_TRANSPARENT,t),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFullyTransparent=function(){return this._core.getFlag(e.FULLY_TRANSPARENT)},SceneJS.Properties.prototype.setRoundPoints=function(t){return t=!!t,this._core.getFlag(e.ROUND_POINTS)!=t&&(this._core.setFlag(e.ROUND_POINTS,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getRoundPoints=function(){return this._core.getFlag(e.ROUND_POINTS)},SceneJS.Properties.prototype._compile=function(e){this._engine.display.properties=l[c++]=this._core,this._compileNodes(e),this._engine.display.properties=--c>0?l[c-1]:s,l[c]=null}}(),function(){"use strict";SceneJS.Geometry=SceneJS_NodeFactory.createNodeType("geometry"),SceneJS.Geometry.prototype._init=function(e){1==this._core.useCount&&(this._initNodeCore(e,{origin:e.origin,scale:e.scale,autoNormals:"auto"==e.normals}),this._buildNodeCore(this._engine.canvas.gl,this._core),this._boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this._boundaryDirty=!0,this.backfaces=!1!==e.backfaces,this.addBlend=!0===e.addBlend,this.layer=e.layer||0,this.onObjectCreate=e.onObjectCreate||null,this._core.webglRestored=function(e){return function(){e._core.tangentBufs=null,e._core.pickPositionsBuf=null,e._core.arrays.tangents&&(e._core.arrays.tangents=[]),e._buildNodeCore(e._engine.canvas.gl,e._core)}}(this),this._engine.stats.geometry.meshes++)},SceneJS.Geometry.prototype._initNodeCore=function(e,t){t=t||{};var r,i,a=e.primitive||"triangles",n=this._core,o=SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint?Uint32Array:Uint16Array;if(n._engine=this._engine,n.primitive=this._getPrimitiveType(a),n.primitiveName=a,n.pointSize=e.pointSize||1,n.pointUVScale=e.pointUVScale||new Float32Array([1,1]),n.compressedPositions=!1,n.compressedNormals=!1,n.compressedUVs=!1,e.normals&&"triangles"==a&&("auto"!==e.normals&&!0!==e.normals||e.positions&&e.indices&&this._buildNormals(e)),n.arrays={},e.positions&&(e.positionDecodeMat?(n.arrays.positions=e.positions,n.positionDecodeMat=e.positionDecodeMat,n.compressedPositions=!0):(e.positions.constructor!=Float32Array&&(e.positions=new Float32Array(e.positions)),(t.scale||t.origin)&&this._applyOptions(e.positions,t),n.arrays.positions=e.positions),this._engine.stats.geometry.vertices+=e.positions.length/3,this._engine.stats.memory.positions+=e.positions.length*e.positions.constructor.BYTES_PER_ELEMENT),e.normals&&(e.normals.constructor==Int8Array?(n.arrays.normals=e.normals,n.compressedNormals=!0):(e.normals.constructor!=Float32Array&&(e.normals=new Float32Array(e.normals)),n.arrays.normals=e.normals),this._engine.stats.memory.normals+=e.normals.length*e.normals.constructor.BYTES_PER_ELEMENT),e.uvDecodeMats){for(var s=0,l=(r=e.uvs).length;s<l;s++)(i=r[s]).constructor!=Uint16Array&&(r[s]=new Uint16Array(r[s])),this._engine.stats.memory.uvs+=i.length*i.constructor.BYTES_PER_ELEMENT;n.arrays.uvs=r,n.uvDecodeMats=e.uvDecodeMats,n.compressedUVs=!0}else if(e.uvs){for(s=0,l=(r=e.uvs).length;s<l;s++)(i=r[s]).constructor!=Float32Array&&(r[s]=new Float32Array(r[s])),this._engine.stats.memory.uvs+=i.length*i.constructor.BYTES_PER_ELEMENT;n.arrays.uvs=r}e.uv&&(e.uv.constructor!=Float32Array&&(e.uv=new Float32Array(e.uv)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[0]=e.uv,this._engine.stats.memory.uvs+=e.uv.length*e.uv.constructor.BYTES_PER_ELEMENT),e.uv1&&(e.uv1.constructor!=Float32Array&&(e.uv1=new Float32Array(e.uv1)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[1]=e.uv1,this._engine.stats.memory.uvs+=e.uv1.length*e.uv1.constructor.BYTES_PER_ELEMENT),e.uv2&&(e.uv2.constructor!=Float32Array&&(e.uv2=new Float32Array(e.uv2)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[2]=e.uv2,this._engine.stats.memory.uvs+=e.uv2.length*e.uv2.constructor.BYTES_PER_ELEMENT),e.uv3&&(e.uv3.constructor!=Float32Array&&(e.uv3=new Float32Array(e.uv3)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[3]=e.uv3,this._engine.stats.memory.uvs+=e.uv3.length*e.uv3.constructor.BYTES_PER_ELEMENT),n.arrays.normals&&n.arrays.uvs&&(n.arrays.tangents=[]),e.colors&&(e.colors.constructor!=Uint8Array&&(e.colors=new Uint8Array(e.colors)),n.arrays.colors=e.colors,this._engine.stats.memory.colors+=e.colors.length*e.colors.constructor.BYTES_PER_ELEMENT),e.indices&&(e.indices.constructor!=Uint8Array&&e.indices.constructor!=Uint16Array&&e.indices.constructor!=Uint32Array&&(e.indices=new o(e.indices)),n.arrays.indices=e.indices,this._engine.stats.geometry.triangles+=e.indices.length/3,this._engine.stats.memory.indices+=e.indices.length*e.indices.constructor.BYTES_PER_ELEMENT),e.pointScaleRotations&&(e.pointScaleRotations.constructor!=Float32Array&&(e.pointScaleRotations=new Float32Array(e.pointScaleRotations)),n.arrays.pointScaleRotations=e.pointScaleRotations,this._engine.stats.memory.pointScaleRotations+=e.pointScaleRotations.length*e.pointScaleRotations.constructor.BYTES_PER_ELEMENT),e.pointUVTranslates&&(e.pointUVTranslates.constructor!=Float32Array&&(e.pointUVTranslates=new Float32Array(e.pointUVTranslates)),n.arrays.pointUVTranslates=e.pointUVTranslates,this._engine.stats.memory.pointUVTranslates+=e.pointUVTranslates.length*e.pointUVTranslates.constructor.BYTES_PER_ELEMENT)},SceneJS.Geometry.prototype._getPrimitiveType=function(e){var t=this._engine.canvas.gl;switch(e){case"points":return t.POINTS;case"lines":return t.LINES;case"line-loop":return t.LINE_LOOP;case"line-strip":return t.LINE_STRIP;case"triangles":return t.TRIANGLES;case"triangle-strip":return t.TRIANGLE_STRIP;case"triangle-fan":return t.TRIANGLE_FAN;default:throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"geometry primitive unsupported: '"+e+"' - supported types are: 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}},SceneJS.Geometry.prototype._applyOptions=function(e,t){if(t.scale)for(var r=null!=t.scale.x?t.scale.x:1,i=null!=t.scale.y?t.scale.y:1,a=null!=t.scale.z?t.scale.z:1,n=0,o=e.length;n<o;n+=3)e[n]*=r,e[n+1]*=i,e[n+2]*=a;if(t.origin){var s=null!=t.origin.x?t.origin.x:0,l=null!=t.origin.y?t.origin.y:0,c=null!=t.origin.z?t.origin.z:0;for(n=0,o=e.length;n<o;n+=3)e[n]-=s,e[n+1]-=l,e[n+2]-=c}return e};var e=function(e){if(e.vertexBuf&&(e.vertexBuf.destroy(),e.vertexBuf=null),e.normalBuf&&(e.normalBuf.destroy(),e.normalBuf=null),e.uvBufs){for(var t,r=e.uvBufs,i=0,a=r.length;i<a;i++)(t=r[i])&&t.destroy();e.uvBufs=null}if(e.colorBuf&&(e.colorBuf.destroy(),e.colorBuf=null),e.pointScaleRotationBuf&&(e.pointScaleRotationBuf.destroy(),e.pointScaleRotationBuf=null),e.pointUVTranslateBuf&&(e.pointUVTranslateBuf.destroy(),e.pointUVTranslateBuf=null),e.tangentBufs){for(var n,o=e.tangentBufs,s=0,l=o.length;s<l;s++)(n=o[s])&&n.destroy();e.tangentBufs=null}e.indexBuf&&(e.indexBuf.destroy(),e.indexBuf=null)};SceneJS.Geometry.prototype._buildNodeCore=function(t,r){try{!function(e,t){var r=e.STATIC_DRAW,i=t.arrays;if(t.transparent=!!i.colors,i.positions&&(t.vertexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.positions,i.positions.length,3,r)),t.compressedNormals?t.normalBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.normals,i.normals.length,2,r,!0):i.normals&&(t.normalBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.normals,i.normals.length,3,r)),i.uvs){var a,n,o,s=i.uvs;for(t.uvBufs=[],a=0,n=s.length;a<n;a++)(o=i.uvs[a]).length>0&&t.uvBufs.push(new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,o,o.length,2,r))}i.colors&&(t.colorBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.colors,i.colors.length,4,r,!0)),i.indices&&(t.indexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ELEMENT_ARRAY_BUFFER,i.indices,i.indices.length,1,r)),i.pointScaleRotations&&(t.pointScaleRotationBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.pointScaleRotations,i.pointScaleRotations.length,2,r,!0)),i.pointUVTranslates&&(t.pointUVTranslateBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,i.pointUVTranslates,i.pointUVTranslates.length,2,r,!0))}(t,r)}catch(i){throw e(r),SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate geometry: "+i)}},SceneJS.Geometry.prototype._updateArray=function(e,t,r){var i=e.length,a=t.length;a+r>i&&(a-=a+r-i);for(var n=r,o=0;o<a;n++,o++)e[n]=t[o]},SceneJS.Geometry.prototype._buildNormals=function(e){for(var t,r,i,a,n,o,s=e.positions,l=e.indices,c=new Array(s.length/3),u=0,_=l.length-3;u<_;u+=3){a=[s[3*(t=l[u+0])+0],s[3*t+1],s[3*t+2]],n=[s[3*(r=l[u+1])+0],s[3*r+1],s[3*r+2]],o=[s[3*(i=l[u+2])+0],s[3*i+1],s[3*i+2]],n=vec4.subtract(vec4.create(),n,a),o=vec4.subtract(vec4.create(),o,a);var h=vec4.normalize(vec4.create(),SceneJS_math_cross3Vec4(n,o,[0,0,0,0]));c[t]||(c[t]=[]),c[r]||(c[r]=[]),c[i]||(c[i]=[]),c[t].push(h),c[r].push(h),c[i].push(h)}var f=new Float32Array(s.length);for(u=0,_=c.length;u<_;u++){var d=c[u];if(d){for(var m=d.length,p=0,g=0,y=0,v=0;v<m;v++)p+=d[v][0],g+=d[v][1],y+=d[v][2];f[3*u+0]=p/m,f[3*u+1]=g/m,f[3*u+2]=y/m}}e.normals=f,this._engine.stats.memory.normals+=f.length/3},SceneJS.Geometry.prototype.setSource=function(e){this._sourceConfigs=e;var t=this._source;t&&t.configure&&t.configure(e)},SceneJS.Geometry.prototype.getSource=function(){return this._sourceConfigs||{}},SceneJS.Geometry.prototype.getBackfaces=function(){return this.backfaces},SceneJS.Geometry.prototype.setBackfaces=function(e){this.backfaces=e;var t=this.getObject();t&&(t.backfaces=e),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getAddBlend=function(){return this.addBlend},SceneJS.Geometry.prototype.setAddBlend=function(e){this.addBlend=e;var t=this.getObject();t&&(t.addBlend=e),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getLayer=function(){return this.layer},SceneJS.Geometry.prototype.setLayer=function(e){this.layer=e;var t=this.getObject();t&&(t.layer=e),this._engine.display.objectListDirty=!0},SceneJS.Geometry.prototype.setPositions=function(e){if(e&&this._core.vertexBuf){this._boundaryDirty=!0;var t=this._core;t.vertexBuf.bind(),t.vertexBuf.setData(e),t.arrays.positions.set(e),t.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPositions=function(){return this._core.arrays?this._core.arrays.positions:null},SceneJS.Geometry.prototype.getPositionDecodeMat=function(){return this._core.positionDecodeMat||null},SceneJS.Geometry.prototype.setNormals=function(e){if(e&&this._core.normalBuf){var t=this._core;t.normalBuf.bind(),t.normalBuf.setData(e),t.arrays.normals.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getNormals=function(){return this._core.arrays?this._core.arrays.normals:null},SceneJS.Geometry.prototype.setColors=function(e){if(e&&this._core.colorBuf){var t=this._core;t.colorBuf.bind(),t.colorBuf.setData(e),t.arrays.colors.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getColors=function(){return this._core.arrays?this._core.arrays.colors:null},SceneJS.Geometry.prototype.setIndices=function(e){if(e&&this._core.indexBuf){this._boundaryDirty=!0;var t=this._core;t.indexBuf.bind(),e.constructor!=t.arrays.indices.constructor&&(e=new t.arrays.indices.constructor(e)),t.indexBuf.setData(e),t.arrays.indices.set(e),t.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getIndices=function(){return this._core.arrays?this._core.arrays.indices:null},SceneJS.Geometry.prototype.getUVs=function(){return this._core.arrays?this._core.arrays.uvs:null},SceneJS.Geometry.prototype.getUV=function(){return this._core.arrays?this._core.arrays.uvs[0]:null},SceneJS.Geometry.prototype.getUVDecodeMat=function(e){return this._core.uvDecodeMats[e||0]||null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[1]:null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[2]:null},SceneJS.Geometry.prototype.getUv3=function(){return this._core.arrays?this._core.arrays.uvs[3]:null},SceneJS.Geometry.prototype.setUV=function(e,t){if(t&&this._core.uvBufs&&this._core.uvBufs[e]){var r=this._core;r.uvBufs[e].bind(),r.uvBufs[e].setData(t),r.arrays.uvs[e].set(t),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.hasCompressedPositions=function(){return!!this._core.compressedPositions},SceneJS.Geometry.prototype.hasCompressedNormals=function(){return!!this._core.compressedNormals},SceneJS.Geometry.prototype.hasCompressedUVs=function(){return!!this._core.compressedUVs},SceneJS.Geometry.prototype.getPrimitive=function(){return this.primitive},SceneJS.Geometry.prototype.getPointSize=function(){return this._core.pointSize},SceneJS.Geometry.prototype.setPointSize=function(e){e&&this._core.pointSize!==e&&(this._core.pointSize=e,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.getPointUVScale=function(){return this._core.pointUVScale},SceneJS.Geometry.prototype.setPointUVScale=function(e){e&&this._core.pointUVScale!==e&&(this._core.pointUVScale=e,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.setPointScaleRotations=function(e){if(e&&this._core.pointScaleRotationBuf){var t=this._core;t.pointScaleRotationBuf.bind(),t.pointScaleRotationBuf.setData(e),t.arrays.pointScaleRotations.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointScaleRotations=function(){return this._core.arrays?this._core.arrays.pointScaleRotations:null},SceneJS.Geometry.prototype.setPointUVTranslates=function(e){if(e&&this._core.pointUVTranslateBuf){var t=this._core;t.pointUVTranslateBuf.bind(),t.pointUVTranslateBuf.setData(e),t.arrays.pointUVTranslates.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointUVTranslates=function(){return this._core.arrays?this._core.arrays.pointUVTranslates:null},SceneJS.Geometry.prototype.getKdTree=function(){var e=this.getObject();return e?e.getKdTree():this._core.getKdTree()},SceneJS.Geometry.prototype.getObject=function(){return this._engine.display._objects[this.id]||null},SceneJS.Geometry.prototype.getBoundary=function(){if(!this._boundaryDirty)return this._boundary;var e=this._core.arrays;if(!e)return null;var t,r,i,a=e.positions;if(!a)return null;this._boundary.xmin=Number.POSITIVE_INFINITY,this._boundary.ymin=Number.POSITIVE_INFINITY,this._boundary.zmin=Number.POSITIVE_INFINITY,this._boundary.xmax=Number.NEGATIVE_INFINITY,this._boundary.ymax=Number.NEGATIVE_INFINITY,this._boundary.zmax=Number.NEGATIVE_INFINITY;for(var n=0,o=a.length-2;n<o;n+=3)r=a[n+1],i=a[n+2],(t=a[n])<this._boundary.xmin&&(this._boundary.xmin=t),r<this._boundary.ymin&&(this._boundary.ymin=r),i<this._boundary.zmin&&(this._boundary.zmin=i),t>this._boundary.xmax&&(this._boundary.xmax=t),r>this._boundary.ymax&&(this._boundary.ymax=r),i>this._boundary.zmax&&(this._boundary.zmax=i);return this._boundaryDirty=!1,this._boundary},SceneJS.Geometry.prototype._compile=function(e){if(this._core._loading)this._compileNodes(e);else{var t=this._core,r=[t.normalBuf?"t":"f",t.arrays&&t.arrays.tangents?"t":"f",t.colorBuf?"t":"f",t.primitive,t.compressedPositions?"t":"f",t.compressedNormals?"t":"f",t.compressedUVs?"t":"f",t.pointScaleRotationBuf?"t":"f",t.pointUVTranslateBuf?"t":"f"];r.push(";uvs");var i=t.uvBufs;if(i)for(var a=0,n=i.length;a<n;a++)r.push(i[a]?"t":"f");t.hash=r.join(""),t.stateId=this._core.stateId,t.type="geometry",this._engine.display.geometry=t,SceneJS_events.fireEvent(SceneJS_events.OBJECT_COMPILING,{display:this._engine.display}),this._engine.display.buildObject(this.id,{backfaces:this.backfaces,addBlend:this.addBlend,layer:this.layer}),this.onObjectCreate&&this.onObjectCreate(this.getObject()),this._compileNodes(e)}},SceneJS.Geometry.prototype._destroy=function(){this._engine.display.removeObject(this.id),1==this._core.useCount&&(this._destroyNodeCore(),this._source&&this._source.destroy&&this._source.destroy(),this._engine.stats.geometry.meshes--)},SceneJS.Geometry.prototype._disconnectFromScene=function(){this._engine.display.removeObject(this.id)},SceneJS.Geometry.prototype._destroyNodeCore=function(){document.getElementById(this._engine.canvas.canvasId)&&e(this._core);var t=this._core.arrays;t.positions&&(this._engine.stats.memory.positions-=t.positions.length/3),t.normals&&(this._engine.stats.memory.normals-=t.normals.length/3),t.colors&&(this._engine.stats.memory.colors-=t.colors.length/3),t.uvs&&t.uvs.length>0&&(this._engine.stats.memory.uvs-=t.uvs.length*(t.uvs[0].length/2)),t.indices&&(this._engine.stats.memory.indices-=t.indices.length),t.pointScaleRotations&&(this._engine.stats.memory.pointScaleRotations-=t.pointScaleRotations.length/2),t.pointUVTranslates&&(this._engine.stats.memory.pointUVTranslates-=t.pointUVTranslates.length/2)}}(),function(){"use strict";SceneJS.Library=SceneJS_NodeFactory.createNodeType("library"),SceneJS.Library.prototype._compile=function(e){}}(),function(){"use strict";SceneJS.Material=SceneJS_NodeFactory.createNodeType("material"),SceneJS.Material.PHONG=0,SceneJS.Material.METALLIC=1;var e={type:"material",stateId:SceneJS._baseStateId++,workflow:SceneJS.Material.PHONG,baseColor:new Float32Array([1,1,1,1]),specularColor:new Float32Array([1,1,1,1]),emitColor:new Float32Array([1,1,1,0]),shine:70,metalRoughspecularf0:new Float32Array([1,1,.1,0])},t=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.material=e,r=0})),SceneJS.Material.prototype._init=function(t){1==this._core.useCount&&(this._core.baseColor=new Float32Array(e.baseColor),this._core.specularColor=new Float32Array(e.specularColor),this._core.emitColor=new Float32Array(e.emitColor),this._core.shine=e.shine,this._core.metalRoughspecularf0=new Float32Array(e.metalRoughspecularf0),(t.color||t.baseColor)&&this.setBaseColor(t.color||t.baseColor),t.specularColor&&this.setSpecularColor(t.specularColor),t.emitColor&&this.setEmitColor(t.emitColor),null!=t.specular&&this.setSpecular(t.specular),null!=t.shine&&this.setShine(t.shine),null!=t.emit&&this.setEmit(t.emit),null!=t.alpha&&this.setAlpha(t.alpha),null!=t.metallic&&this.setMetallic(t.metallic),null!=t.roughness&&this.setRoughness(t.roughness),null!=t.specularf0&&this.setspecularf0(t.specularf0),this.setWorkflow(t.workflow))},SceneJS.Material.prototype.setWorkflow=function(e){return"phong"===(e=e||"phong")?this._core.workflow=SceneJS.Material.PHONG:"metallic"===e?this._core.workflow=SceneJS.Material.METALLIC:(console.error("Unsupported SceneJS material workflow: "+e),this._core.workflow=SceneJS.Material.PHONG),this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getWorkflow=function(){switch(this._core.workflow){case SceneJS.Material.PHONG:return"phong";case SceneJS.Material.METALLIC:return"metallic"}},SceneJS.Material.prototype.setBaseColor=function(t){var r=e.baseColor;return this._core.baseColor[0]=null!=t.r?t.r:r[0],this._core.baseColor[1]=null!=t.g?t.g:r[1],this._core.baseColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.setColor=SceneJS.Material.prototype.setBaseColor,SceneJS.Material.prototype.getBaseColor=function(){return{r:this._core.baseColor[0],g:this._core.baseColor[1],b:this._core.baseColor[2]}},SceneJS.Material.prototype.getColor=SceneJS.Material.prototype.getBaseColor,SceneJS.Material.prototype.setSpecularColor=function(t){var r=e.specularColor;return this._core.specularColor[0]=null!=t.r?t.r:r[0],this._core.specularColor[1]=null!=t.g?t.g:r[1],this._core.specularColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecularColor=function(){return{r:this._core.specularColor[0],g:this._core.specularColor[1],b:this._core.specularColor[2]}},SceneJS.Material.prototype.setEmitColor=function(t){var r=e.emitColor;return this._core.emitColor[0]=null!=t.r?t.r:r[0],this._core.emitColor[1]=null!=t.g?t.g:r[1],this._core.emitColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmitColor=function(){return{r:this._core.emitColor[0],g:this._core.emitColor[1],b:this._core.emitColor[2]}},SceneJS.Material.prototype.setSpecular=function(t){return this._core.specularColor[3]=null!=t&&null!=t?t:e.specularColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecular=function(){return this._core.specularColor[3]},SceneJS.Material.prototype.setShine=function(t){return this._core.shine=null!=t?t:e.shine,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getShine=function(){return this._core.shine},SceneJS.Material.prototype.setEmit=function(t){return this._core.emitColor[3]=null!=t?t:e.emitColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmit=function(){return this._core.emitColor[3]},SceneJS.Material.prototype.setAlpha=function(t){var r=this._core.baseColor[3]<1;return this._core.baseColor[3]=null!=t?t:e.baseColor[3],this._core.transparent=this._core.baseColor[3]<1,this._engine.display.imageDirty=!0,r!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this},SceneJS.Material.prototype.getAlpha=function(){return this._core.baseColor[3]},SceneJS.Material.prototype.setMetallic=function(t){return this._core.metalRoughspecularf0[0]=null!=t?t:e.metalRoughspecularf0[0],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getMetallic=function(){return this._core.metalRoughspecularf0[0]},SceneJS.Material.prototype.setRoughness=function(t){return this._core.metalRoughspecularf0[1]=null!=t?t:e.metalRoughspecularf0[1],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getRoughness=function(){return this._core.metalRoughspecularf0[1]},SceneJS.Material.prototype.setspecularf0=function(t){return this._core.metalRoughspecularf0[2]=null!=t?t:e.metalRoughspecularf0[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getspecularf0=function(){return this._core.metalRoughspecularf0[2]},SceneJS.Material.prototype._compile=function(i){this._engine.display.material=t[r++]=this._core,this._compileNodes(i),this._engine.display.material=--r>0?t[r-1]:e,t[r]=null}}(),function(){"use strict";var e=SceneJS.KD_TREE_MAX_DEPTH,t=SceneJS.KD_TREE_MIN_TRIANGLES,r={type:"morphGeometry",stateId:SceneJS._baseStateId++,hash:"",morph:null},i=[],a=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.morphGeometry=r,a=0})),SceneJS.MorphGeometry=SceneJS_NodeFactory.createNodeType("morphGeometry"),SceneJS.MorphGeometry.prototype._init=function(e){if(1==this._core.useCount){this._pickPositionsDirty=!0,this._buildNodeCore(e),this._core.webglRestored=function(){};var t=this;this._core.getPickPositions=function(e,r){return t._pickPositionsDirty&&t._buildPickPositions(r),t._core.targets[e].pickPositionsBuf},this._core.getTangents=function(e,r,i,a,n){var o=t._core.targets[e];if(o.tangentBuf)return o.tangentBuf;var s=o.positions;if(a=o.positionDecodeMat||a,i=o.uv||i,s&&r&&i){var l=t._engine.canvas.gl,c=SceneJS_math_buildTangents(s,r,i,a,n);return o.tangents=c,o.tangentBuf=new SceneJS._webgl.ArrayBuffer(l,l.ARRAY_BUFFER,c,c.length,3,l.STATIC_DRAW),o.tangentBuf}},this.setFactor(e.factor)}this._core.factor=e.factor||0,this._core.clamp=!!e.clamp},SceneJS.MorphGeometry.prototype._buildNodeCore=function(r){try{!function(r,i){var a=i.targets||[];if(a.length<2)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var o=i.keys||[];if(o.length!=a.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");var s,l,c,u,_,h,f,d=r._core,m=r._engine.canvas.gl,p=m.STATIC_DRAW;d.keys=o,d.targets=[],d.key1=0,d.key2=1;for(var g=0,y=a.length;g<y;g++)_=a[g],!s&&_.positions&&(s=_.positions),!l&&_.normals&&(l=_.normals),!c&&_.uv&&(c=_.uv),!u&&_.uv2&&(u=_.uv2);for(g=0,y=a.length;g<y;g++)h={},(f=(_=a[g]).positions||s)&&(_.positionDecodeMat?(h.positions=f,h.positionDecodeMat=_.positionDecodeMat,d.compressedPositions=!0):h.positions=f.constructor==Float32Array?f:new Float32Array(f),h.vertexBuf=new SceneJS._webgl.ArrayBuffer(m,m.ARRAY_BUFFER,h.positions,f.length,3,p),s=f,r._engine.stats.memory.morphPositions+=h.positions.length*h.positions.constructor.BYTES_PER_ELEMENT),(f=_.normals||l)&&(f.constructor==Int8Array?(h.normals=f,d.compressedNormals=!0,h.normalBuf=new SceneJS._webgl.ArrayBuffer(m,m.ARRAY_BUFFER,h.normals,f.length,2,p,!0)):(h.normals=f.constructor==Float32Array?f:new Float32Array(f),h.normalBuf=new SceneJS._webgl.ArrayBuffer(m,m.ARRAY_BUFFER,h.normals,f.length,3,p)),l=f,r._engine.stats.memory.morphNormals+=h.normals.length*h.normals.constructor.BYTES_PER_ELEMENT),(f=_.uv||c)&&(h.uv=f.constructor==Float32Array?f:new Float32Array(f),h.uvBuf=new SceneJS._webgl.ArrayBuffer(m,m.ARRAY_BUFFER,h.uv,f.length,2,p),c=f),(f=_.uv2||u)&&(h.uv2=f.constructor==Float32Array?f:new Float32Array(f),h.uvBuf2=new SceneJS._webgl.ArrayBuffer(m,m.ARRAY_BUFFER,h.uv2,f.length,2,p),u=f),d.targets.push(h);d.kdTree=null,d.kdTreeDirty=!0,d.getKdTree=function(r){if(!this.kdTreeDirty)return this.kdTree;for(var i=r.length/3,a=new Array(i),o=0;o<i;++o)a[o]=o;return this.kdTree=function r(i,a,o,s,l){var c,u,_=vec3.create(),h=vec3.create(),f={triangles:null,left:null,right:null,bb:{min:_,max:h}};_[0]=_[1]=_[2]=Number.POSITIVE_INFINITY,h[0]=h[1]=h[2]=Number.NEGATIVE_INFINITY;var d=o.length;for(c=0,u=i.length;c<u;++c)for(var m=3*i[c],p=0;p<3;++p)for(var g=3*a[m+p],y=0;y<d;++y){var v=o[y].positionDecodeMat;n[0]=(A=o[y].positions)[g],n[1]=A[g+1],n[2]=A[g+2],v&&SceneJS_math_decompressPosition(n,n,v),n[0]<_[0]&&(_[0]=n[0]),n[0]>h[0]&&(h[0]=n[0]),n[1]<_[1]&&(_[1]=n[1]),n[1]>h[1]&&(h[1]=n[1]),n[2]<_[2]&&(_[2]=n[2]),n[2]>h[2]&&(h[2]=n[2])}if(l>e)return f.triangles=i,f;var S=(_[s]+h[s])/2,E=new Array(i.length),b=0,I=new Array(i.length),x=0;for(c=0,u=i.length;c<u;++c){var C=3*a[m=3*i[c]],T=3*a[m+1],N=3*a[m+2],D=!0;for(y=0;y<d;++y){var A,P=(A=o[y].positions)[C+s],M=A[T+s],w=A[N+s];if(v=o[y].positionDecodeMat){var R=v[5*s],F=v[s+12];P=P*R+F,M=M*R+F,w=w*R+F}if(P<S||M<S||w<S){D=!1;break}}D?I[x++]=i[c]:E[b++]=i[c]}return b<t||x<t?(f.triangles=i,f):(E.length=b,I.length=x,f.left=r(E,a,o,(s+1)%3,l+1),f.right=r(I,a,o,(s+1)%3,l+1),f)}(a,r,this.targets,0,0),this.kdTreeDirty=!1,this.kdTree},r._pickPositionsDirty=!0}(this,r)}catch(o){for(var i=0,a=this._core.targets.length;i<a;i++)target=core.targets[i],target.vertexBuf&&target.vertexBuf.destroy(),target.normalBuf&&target.normalBuf.destroy(),target.uvBuf&&target.uvBuf.destroy(),target.uvBuf2&&target.uvBuf2.destroy();throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate VBO(s) for morphGeometry: "+o)}},SceneJS.MorphGeometry.prototype._buildPickPositions=function(e){for(var t,r=this._core,i=null,a=this._engine.canvas.gl,n=a.STATIC_DRAW,o=0,s=r.targets.length;o<s;o++)(i=r.targets[o]).positions&&(i.pickPositionsBuf&&(i.pickPositionsBuf.destroy(),i.pickPositionsBuf=null),t=SceneJS_math_getPickPositions(i.positions,e),i.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,t,t.length,3,n));this._pickPositionsDirty=!1},SceneJS.MorphGeometry.prototype.setFactor=function(e){var t=this._core,r=t.keys,i=t.key1,a=t.key2,n=t.factor;if((e=e||0)<r[0])i=0,a=1;else if(e>r[r.length-1])a=1+(i=r.length-2);else{for(;r[i]>e;)i--,a--;for(;r[a]<e;)i++,a++}var o=i!=t.key1;t.factor=(e-r[i])/(r[a]-r[i]),this._factor=e;var s=o||n!=t.factor;if(t.key1=i,t.key2=a,s){var l=this.getCurrentFrame();this.onUpdate&&this.onUpdate(l),o&&this.onFrameUpdate&&this.onFrameUpdate(l)}this._engine.display.imageDirty=!0},SceneJS.MorphGeometry.prototype.getFactor=function(){return this._factor},SceneJS.MorphGeometry.prototype.getKeys=function(){return this._core.keys},SceneJS.MorphGeometry.prototype.getTargets=function(){return this._core.targets},SceneJS.MorphGeometry.prototype.getCurrentFrame=function(){var e=this._core,t=e.key1,r=e.key2;return{key1:t,key2:r,factor:e.factor,target1:e.targets[t],target2:e.targets[r]}},SceneJS.MorphGeometry.prototype._compile=function(e){this._core.hash||this._makeHash(),this._engine.display.morphGeometry=i[a++]=this._core,this._compileNodes(e),this._engine.display.morphGeometry=--a>0?i[a-1]:r,i[a]=null},SceneJS.MorphGeometry.prototype._makeHash=function(){var e=this._core;if(e.targets.length>0){var t=e.targets[0],r="t",i="f";e.hash=[t.vertexBuf?r:i,t.normalBuf?r:i,t.uvBuf?r:i,t.uvBuf2?r:i].join("")}else e.hash=""},SceneJS.MorphGeometry.prototype._destroy=function(){if(1==this._core.useCount&&document.getElementById(this._engine.canvas.canvasId))for(var e,t=this._core,r=0,i=t.targets.length;r<i;r++)(e=t.targets[r]).vertexBuf&&e.vertexBuf.destroy(),e.pickPositionsBuf&&e.pickPositionsBuf.destroy(),e.normalBuf&&e.normalBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.uvBuf2&&e.uvBuf2.destroy()},vec3.create(),vec3.create();var n=vec3.create()}(),function(){"use strict";SceneJS.Scene=SceneJS_NodeFactory.createNodeType("scene"),SceneJS.Scene.prototype._init=function(e){this.transparent=!0===e.transparent,this.stats=this._engine.stats,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},SceneJS.Scene.prototype.loseWebGLContext=function(){this._engine.loseWebGLContext()},SceneJS.Scene.prototype.getCanvas=function(){return this._engine.canvas.canvas},SceneJS.Scene.prototype.setTransparencyMode=function(e){this._engine.display.setTransparencyMode(e),this._engine.branchDirty(this)},SceneJS.Scene.prototype.setDepthSort=function(e){this._engine.display.depthSort=e,this._engine.display.objectListDirty=!0},SceneJS.Scene.prototype.getGL=function(){return this._engine.canvas.gl},SceneJS.Scene.prototype.getGPUTimer=function(){return this._engine.gpuTimer},SceneJS.Scene.prototype.getGPUTimerQuery=function(){return this._engine.gpuTimerQuery},SceneJS.Scene.prototype.getWebGL2Supported=function(){return this._engine.canvas.webgl2},SceneJS.Scene.prototype.getZBufferDepth=function(){var e=this._engine.canvas.gl;return e.getParameter(e.DEPTH_BITS)},SceneJS.Scene.prototype.setResolutionScaling=function(e){return this._engine.canvas.setResolutionScaling(e)},SceneJS.Scene.prototype.setProjection=function(e){var t=this._engine.display,r=e.type;r||t.projection&&(r=t.projection.type),"ortho"==(r=r||"perspective")?t.projection=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:r,left:e.left,bottom:e.bottom,near:e.near,right:e.right,top:e.top,far:e.far}):"frustum"==r?t.projection={type:r,left:e.left||-1,bottom:e.bottom||-1,near:e.near||.1,right:e.right||1,top:e.top||1,far:e.far||1e4}:"perspective"==r&&(null!=e.fovy&&(e.fov=e.fovy),t.projection={type:r,fov:e.fov||60,aspect:null==e.aspect?1:e.aspect,near:e.near||.1,far:e.far||1e4}),t.projection.pan=e.pan,t.buildProjectionMatrix(),t.imageDirty=!0},SceneJS.Scene.prototype.getProjection=function(){return this._engine.display.projection},SceneJS.Scene.prototype.setCamera=function(e){var t=this._engine.display;e.eye&&t.camera.eye.set(e.eye),e.look&&t.camera.look.set(e.look),e.up&&t.camera.up.set(e.up),e.deviceMatrix&&(t.hasDeviceMatrix=!0,t.deviceMatrix.set(e.deviceMatrix)),t.buildViewMatrix(),t.imageDirty=!0},SceneJS.Scene.prototype.setLights=function(e){var t=this._engine.display;t.lights.length=(e=e||[]).length;var r="";t._ambientColor[0]=0,t._ambientColor[1]=0,t._ambientColor[2]=0;for(var i=0,a=0,n=e.length;a<n;++a){t.lights[i]=t.lights[i]||{};var o=t.lights[i],s=e[a],l=s.mode||"dir";if("dir"!=l&&"point"!=l&&"ambient"!=l&&"spot"!=l)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'spot' or 'ambient'");var c=s.pos,u=s.dir,_=s.color;o.color=new Float32Array([null!=_.r?_.r:1,null!=_.g?_.g:1,null!=_.b?_.b:1]),"ambient"!==l?(o.mode=l,o.diffuse="ambient"==l||null==s.diffuse||s.diffuse,o.specular="ambient"!=l&&(null==s.specular||s.specular),o.pos=new Float32Array(s.pos?[c.x||0,c.y||0,c.z||0]:[0,0,0]),o.dir=new Float32Array(s.dir?[u.x||0,u.y||0,u.z||0]:[0,0,1]),o.innerCone=null!=s.innerCone?s.innerCone:.25,o.outerCone=null!=s.outerCone?s.outerCone:0,o.attenuation=new Float32Array([null!=s.constantAttenuation?s.constantAttenuation:0,s.linearAttenuation||0,s.quadraticAttenuation||0]),o.space=s.space||"world",++i,r+=o.mode,o.specular&&(r+="s"),o.diffuse&&(r+="d"),r+="world"===o.space?"w":"v",a<n-1&&(r+="/")):(t._ambientColor[0]=o.color[0],t._ambientColor[1]=o.color[1],t._ambientColor[2]=o.color[2])}t.lights.length=i,t.lightHash!==r?(t.lightHash=r,this._engine.branchDirty(this)):t.imageDirty=!0},SceneJS.Scene.prototype.setClips=function(e){var t=this._engine.display,r=t.clips,i="";r.clips.length=e.length,r.enabled=!1;for(var a=0,n=e.length;a<n;++a){var o=e[a],s=r.clips[a]||(r.clips[a]={normalAndDist:vec4.create(),fade:!1,fadeDistance:0}),l=o.n;vec3.normalize(l,l);var c=0;o.d?c=o.d:o.p&&(c=-vec3.dot(l,o.p)),s.normalAndDist.set(l),s.normalAndDist[3]=c,s.fade=!!o.fade,s.fadeDistance=0,s.fade?(r.clipFade=!0,s.fadeDistance=o.fadeDistance):r.clipDiscard=!0,i+=s.fade?"f":"c"}i===t.clipsHash?t.imageDirty=!0:(this._engine.branchDirty(this),t.clipsHash=i)},SceneJS.Scene.prototype.createReflection=function(e,t){var r=this._engine.display.reflections,i=r.reflections[e];i?console.error("Reflection already exists: "+e):(i=new SceneJS.GlobalCubemap(this,e,t),r.reflections[e]=i)},SceneJS.Scene.prototype.activateReflection=function(e){var t=this._engine.display.reflections,r=t.reflections[e];r?(t.activeReflection=r,this._updateReflectionsHash()):console.error("Reflection not found: "+e)},SceneJS.Scene.prototype._updateReflectionsHash=function(){var e=this._engine.display,t=e.reflections.activeReflection?e.reflections.activeReflection.hash:";";t===e.reflectionsHash?e.imageDirty=!0:(this._engine.branchDirty(this),e.reflectionsHash=t)},SceneJS.Scene.prototype.deactivateReflection=function(){var e=this._engine.display.reflections;e.activeReflection&&(e.activeReflection=null,this._updateReflectionsHash())},SceneJS.Scene.prototype.destroyReflection=function(e){var t=this._engine.display.reflections,r=t.reflections[e];r?(t.activeReflection&&t.activeReflection.id===r.id&&this.deactivateReflection(),r.destroy(),delete t.reflections[e]):console.error("Reflection not found: "+e)},SceneJS.Scene.prototype.destroyAllReflections=function(){for(var e=Object.keys(this._engine.display.reflections.reflections),t=0,r=e.length;t<r;t++)this.destroyReflection(e[t])},SceneJS.Scene.prototype.createLightmap=function(e,t){var r=this._engine.display.lightmaps,i=r.lightmaps[e];i?console.error("Lightmap already exists: "+e):(i=new SceneJS.GlobalCubemap(this,e,t),r.lightmaps[e]=i)},SceneJS.Scene.prototype.activateLightmap=function(e){var t=this._engine.display.lightmaps,r=t.lightmaps[e];r?(t.activeLightmap=r,this._updateLightmapsHash()):console.error("Lightmap not found: "+e)},SceneJS.Scene.prototype._updateLightmapsHash=function(){var e=this._engine.display,t=e.lightmaps.activeLightmap?e.lightmaps.activeLightmap.hash:";";t===e.lightmapsHash?e.imageDirty=!0:(this._engine.branchDirty(this),e.lightmapsHash=t)},SceneJS.Scene.prototype.deactivateLightmap=function(){var e=this._engine.display.lightmaps;e.activeLightmap&&(e.activeLightmap=null,this._updateLightmapsHash())},SceneJS.Scene.prototype.destroyLightmap=function(e){var t=this._engine.display.lightmaps,r=t.lightmaps[e];r?(t.activeLightmap&&t.activeLightmap.id===r.id&&this.deactivateLightmap(),r.destroy(),delete t.lightmaps[e]):console.error("Lightmap not found: "+e)},SceneJS.Scene.prototype.destroyAllLightmaps=function(){for(var e=Object.keys(this._engine.display.lightmaps.lightmaps),t=0,r=e.length;t<r;t++)this.destroyLightmap(e[t])},SceneJS.Scene.prototype.setDeviceMatrix=function(e){var t=this._engine.display;t.hasDeviceMatrix=!!e,e&&t.deviceMatrix.set(e),t.imageDirty=!0},SceneJS.Scene.prototype.getCamera=function(){return this._engine.display.camera},SceneJS.Scene.prototype.getViewMatrix=function(){return this._engine.display.viewMatrix},SceneJS.Scene.prototype.getProjectionMatrix=function(){return this._engine.display.projectionMatrix},SceneJS.Scene.prototype.setFogDensity=function(e){this._engine.display.fogDensity=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogStart=function(e){this._engine.display.fogParams[0]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnd=function(e){this._engine.display.fogParams[1]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMin=function(e){this._engine.display.fogParams[2]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMax=function(e){this._engine.display.fogParams[3]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogColor=function(e,t,r){this._engine.display.fogColor[0]=e,this._engine.display.fogColor[1]=t,this._engine.display.fogColor[2]=r,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogDensity=function(e){this._engine.display.fogColor[3]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMode=function(e){this._engine.display.fogMode=e,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnabled=function(e){this._engine.display.fogEnabled=e,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setXrayColor=function(e,t,r){this._engine.display.xrayColor[0]=e,this._engine.display.xrayColor[1]=t,this._engine.display.xrayColor[2]=r,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.mainFramebufferParams=function(e){this._engine.display.mainFramebufferParams=e||null},SceneJS.Scene.prototype.createFramebuffer=function(e,t){this._engine.display.createFramebuffer(e,t)},SceneJS.Scene.prototype.destroyFramebuffer=function(e){this._engine.display.destroyFramebuffer(e)},SceneJS.Scene.prototype.getPostProcessStage=function(e){return this._engine.display.getPostProcessStage(e)},SceneJS.Scene.prototype.createPostProcessType=function(e,t,r){this._engine.display.createPostProcessType(e,t,r)},SceneJS.Scene.prototype.postProcessOpaque=function(e){this._engine.display.postProcessOpaque(e)},SceneJS.Scene.prototype.postProcessFinal=function(e){this._engine.display.postProcessFinal(e)},SceneJS.Scene.prototype.setNumPasses=function(e){this._engine.setNumPasses(e)},SceneJS.Scene.prototype.setClearEachPass=function(e){this._engine.setClearEachPass(e)},SceneJS.Scene.prototype.setViewport=function(e,t,r,i){this._engine.display.setViewport(e,t,r,i)},SceneJS.Scene.prototype.render=function(e){return this._engine.render(e)},SceneJS.Scene.prototype.pauseCompilation=function(){return this._engine.pauseCompilation()},SceneJS.Scene.prototype.resumeCompilation=function(){return this._engine.resumeCompilation()},SceneJS.Scene.prototype.compile=function(){return this._engine.compile()},SceneJS.Scene.prototype.needFrame=function(){this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.start=function(e){this._engine.start(e)},SceneJS.Scene.prototype.pick=function(){var e;if(SceneJS._isNumeric(arguments[0])){var t=arguments[0],r=arguments[1];(e=arguments[2]||{}).canvasPos=new Float32Array([t,r])}else e=arguments[0]||{};var i=this._engine.pick(e);if(this.render({force:!0}),i)return this.publish("pick",i),i;this.publish("nopick")},SceneJS.Scene.prototype.readPixels=function(e,t,r){return this._engine.readPixels(e,t,r)},SceneJS.Scene.prototype._destroy=function(){this.destroyed||(delete SceneJS._engines[this.id],SceneJS._engineIds.removeItem(this.id),this.destroyed=!0)},SceneJS.Scene.prototype.isActive=function(){return!this._engine.destroyed},SceneJS.Scene.prototype.stop=function(){this._engine.stop()},SceneJS.Scene.prototype.containsNode=function(e){return!!this._engine.findNode(e)},SceneJS.Scene.prototype.findNodes=function(e){return this._engine.findNodes(e)},SceneJS.Scene.prototype.findNode=function(e){return this.getNode(e)},SceneJS.Scene.prototype.getNode=function(e){return this._engine.findNode(e)},SceneJS.Scene.prototype.hasCore=function(e,t){return this._engine.hasCore(e,t)},SceneJS.Scene.prototype.publish=function(e,t,r){if(r||(this._topicPubs[e]=t),this._topicSubs[e]){var i=this._topicSubs[e];for(var a in i)i.hasOwnProperty(a)&&i[a].call(this,t)}},SceneJS.Scene.prototype.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var r in t)t.hasOwnProperty(r)&&t[r].call(this,null);delete this._topicPubs[e]},SceneJS.Scene.prototype.on=function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var i=this._handleMap.addItem();r[i]=t,this._handleTopics[i]=e;var a=this._topicPubs[e];return a&&t.call(this,a),"rendered"==e&&this._engine.branchDirty(this),i},SceneJS.Scene.prototype.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var r=this._topicSubs[t];r&&delete r[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},SceneJS.Scene.prototype.once=function(e,t){var r=this,i=this.on(e,(function(e){r.off(i),t(e)}))}}(),function(){"use strict";var e={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.texture=e,r=0}));var t=[],r=0,i=null,a=null,n=null,o=null,s=SceneJS.TEXTURE_FLAGS;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function c(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function u(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function _(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function h(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}SceneJS.TextureMap=SceneJS_NodeFactory.createNodeType("texture"),SceneJS.TextureMap.prototype._init=function(e){if(1==this._core.useCount){var t=e.applyFrom||"uv";if("uv"!==t.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var r=0;if("uv"!==t&&(r=parseInt(t.substring(2)),isNaN(r)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");if(e.applyTo){var i=e.applyTo;if("baseColor"!=i&&"color"!=i&&"occlusion"!=i&&"specular"!=i&&"emit"!=i&&"alpha"!=i&&"normals"!=i&&"shine"!=i&&"transparency"!=i&&"metallic"!=i&&"roughness"!=i&&"metallicRoughness"!=i)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyTo value is unsupported: "+i)}if(e.blendMode&&"add"!=e.blendMode&&"multiply"!=e.blendMode&&"over"!=e.blendMode&&"conditionalAlpha"!=e.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");if("color"==e.applyTo&&(e.applyTo="baseColor"),SceneJS._apply({waitForLoad:null==e.waitForLoad||e.waitForLoad,texture:null,minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,flipY:e.flipY,uvLayerIdx:r,isNormalMap:"normals"===e.applyTo,isAlphaMap:"alpha"===e.applyTo,isTransparencyMap:"transparency"===e.applyTo,flags:s[e.applyTo||"baseColor"]|s[e.blendMode||"multiply"],blendFactor:null!=e.blendFactor&&null!=e.blendFactor?e.blendFactor:1},this._core),this._initTexture(e.preloadColor),e.compressedImage)this.setCompressedImage(e.compressedImage,e.containerFormat,e.compressedSrc);else if(e.compressedSrc){var a;if(this._core.compressedSrc=e.compressedSrc,"dds"===e.containerFormat)a=this._parseDDS;else if("pvr"===e.containerFormat)a=this._parsePVR;else{if("ktx"!==e.containerFormat)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Compressed textures require containerFormat parameter to be 'dds' or 'pvr'");a=this._parseKTX}SceneJS._loadBinary(e.compressedSrc,a.bind(this))}else e.image?this._setTextureImage(e.image):e.src&&(this._core.src=e.src,this._loadTexture(e.src,e.preloadSrc));this._core.mipMapLevels=0,this._core.drawTexture=e.drawTexture||!1,this._core.webglRestored=function(e,t,r,i){return function(){var a;t.compressedSrc?(e._initTexture(r),"dds"===i?a=e._parseDDS:"pvr"===i&&(a=e._parsePVR),SceneJS._loadBinary(t.compressedSrc,a.bind(this))):t.image?(e._initTexture(r),e._setTextureImage(t.image)):t.src&&(e._initTexture(r),e._loadTexture(t.src))}}(this,this._core,e.preloadColor,e.containerFormat)}},SceneJS.TextureMap.prototype._initTexture=function(e){var t=this._engine.canvas.gl;(e=e||{r:.57735,g:.57735,b:.57735}).a=void 0===e.a?1:e.a,e=new Uint8Array([Math.floor(255*e.r),Math.floor(255*e.g),Math.floor(255*e.b),Math.floor(255*e.a)]),this._core.width=1,this._core.height=1;var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),this._setCoreTexture(r)},SceneJS.TextureMap.prototype._loadTexture=function(e,t){var r=this,i=new Image,a=!1;if(t){var n=new Image;n.onload=function(){a||(r._setTextureImage(n),r._engine.display.imageDirty=!0)},n.src=t}i.onload=function(){r._setTextureImage(i),a=!0,r._engine.display.imageDirty=!0},i.src=e},SceneJS.TextureMap.prototype._setTextureImage=function(e){var t=this._engine.canvas.gl,r=this._core,i=r.texture&&r.texture.texture?r.texture.texture:t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),r.width=e.width,r.height=e.height,this._setCoreTexture(i),this._gatherStats(e.width,e.height,e.width*e.height*4)},SceneJS.TextureMap.prototype._setCompressedTextureImage=function(e,t,r,a,n,o,s){var l=this._engine.canvas.gl,c=this._core,u=c.texture&&c.texture.texture?c.texture.texture:l.createTexture();if(!SceneJS._getExtension(l,t))throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Compressed texture format "+t+"not available.");l.bindTexture(l.TEXTURE_2D,u);var _=0;this._core.width=a,this._core.height=n,this._core.mipMapLevels=o,this._core.compressed=!0;for(var h=i.SIZE_FUNCTIONS[r],f=a,d=n,m=0;m<o;++m){var p=0;s?(p=e[_]+(e[_+1]<<8)+(e[_+2]<<16)+(e[_+3]<<24),_+=4):p=h(f,d);var g=new Uint8Array(e.buffer,e.byteOffset+_,p);l.compressedTexImage2D(l.TEXTURE_2D,m,r,f,d,0,g),f/=2,d/=2,_+=p}this._setCoreTexture(u),this._gatherStats(a,n,e.byteLength)},SceneJS.TextureMap.prototype._gatherStats=function(e,t,r){this._engine.stats.memory.textures+=r;var i=this._engine.stats.textures,a=e+"x"+t,n=this._getTextureTarget(),o=i[n]=i[n]||{};o[a]=(o[a]||0)+1,o.memory=(o.memory||0)+r},SceneJS.TextureMap.prototype._setCoreTexture=function(e){var t=this._engine.canvas.gl,r=SceneJS_math_isPOT(this._core.width)&SceneJS_math_isPOT(this._core.height),i=r?t.REPEAT:t.CLAMP_TO_EDGE;this._core.texture=new SceneJS._webgl.Texture2D(t,{texture:e,minFilter:this._getGLOption("minFilter",1!==this._core.mipMapLevels&&r?t.LINEAR_MIPMAP_NEAREST:t.LINEAR),magFilter:this._getGLOption("magFilter",t.LINEAR),wrapS:this._getGLOption("wrapS",i),wrapT:this._getGLOption("wrapT",i),compressed:this._core.compressed,flipY:this._core.flipY,update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype._getTextureTarget=function(){var e=this._core.flags;return e&s.baseColor?"baseColor":e&s.occlusion?"occlusion":e&s.normals?"normals":e&s.alpha?"alpha":e&s.specular?"specular":e&s.emit?"emit":e&s.shine?"shine":e&s.transparency?"transparency":e&s.metallic?"metallic":e&s.roughness?"roughness":e&s.metallicRoughness?"metallicRoughness":void 0},SceneJS.TextureMap.prototype._getGLOption=function(e,t){var r=this._engine.canvas.gl,i=this._core[e];if(null==i)return t;var a=SceneJS._webgl.enumMap[i];if(null==a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+i+"'");return r[a]},SceneJS.TextureMap.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.TextureMap.prototype.setSrc=function(e){this._core.image=null,this._core.src=e,this._core.target=null,this._loadTexture(e)},SceneJS.TextureMap.prototype.setImage=function(e){this._core.src=null,this._core.target=null,this._setTextureImage(e)},SceneJS.TextureMap.prototype.setCompressedImage=function(e,t,r){this._core.src=null,this._core.image=null,this._core.target=null,this._core.compressedSrc=r,"dds"===t?this._parseDDS(e):"pvr"===t?this._parsePVR(e):this._parseKTX(e)},SceneJS.TextureMap.prototype.setTarget=function(e){"colorTarget"==e.type||"depthTarget"==e.type?(delete this._core.src,this._core.target=e,this._core.src=null,this._core.image=null,this._core.texture=e._core.renderBuf.getTexture(),this._core.texture.bufType=e._core.bufType,this._engine.display.imageDirty=!0):console.log("Target node type not compatible: "+e.type)},SceneJS.TextureMap.prototype.setBlendFactor=function(e){this._core.blendFactor=e,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getBlendFactor=function(){return this._core.blendFactor},SceneJS.TextureMap.prototype.setTranslate=function(e){this._core.translate||(this._core.translate={x:0,y:0}),this._core.translate.x=e.x,this._core.translate.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getTranslate=function(){return this._core.translate},SceneJS.TextureMap.prototype.setScale=function(e){this._core.scale||(this._core.scale={x:0,y:0}),this._core.scale.x=e.x,this._core.scale.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getScale=function(){return this._core.scale},SceneJS.TextureMap.prototype.setRotate=function(e){this._core.rotate=e,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getRotate=function(){return this._core.rotate},SceneJS.TextureMap.prototype.getMatrix=function(){return this._core._matrixDirty&&this._core.buildMatrix.call(this.core)(),this.core.matrix},SceneJS.TextureMap.prototype._compile=function(i){this.__core||(this.__core=this._engine._coreFactory.getCore("texture"),this.__core.transparent=!1,this.__core.drawLayer=-1);var a=this._engine.display.texture;this._core.empty||(this.__core.layers=a&&a.layers?a.layers.concat([this._core]):[this._core],this.__core.transparent=this._core.isAlphaMap||this._core.isTransparencyMap||a.transparent,this._core.drawTexture&&(this.__core.drawLayerIndex=this.__core.layers.length-1)),this._makeHash(this.__core),t[r++]=this.__core,this._engine.display.texture=this.__core,this._compileNodes(i),this._engine.display.texture=--r>0?t[r-1]:e,t[r]=null},SceneJS.TextureMap.prototype._makeHash=function(e){var t=[];if(e.layers&&e.layers.length>0)for(var r,i=e.layers,a=0,n=i.length;a<n;a++)r=i[a],t.push("/"),t.push(r.uvLayerIdx),t.push("/"),t.push(r.flags),r.matrix&&t.push("/anim"),r.compressed&&t.push("/comp"),"normals"===r.applyTo&&SceneJS.WEBGL_INFO.standardDerivativesSupported&&t.push("/gt");var o=t.join("");e.hash!=o&&(e.hash=o)},SceneJS.TextureMap.prototype._destroy=function(){1==this._core.useCount&&(this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null),this._engine.stats.memory.textures--)},SceneJS.TextureMap.prototype._parseDDS=function(e){if(!a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"DXT compressed textures not supported on this platform.");var t=new Uint32Array(e,0,a.HEADER_LENGTH);if(t[a.MAGIC_NUMBER_INDEX]!=a.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: Magic number invalid.");if(t[a.PIXEL_FORMAT_FLAGS_INDEX]&0===a.PIXEL_FORMAT_FOURCC_FLAG)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: FourCC required.");var r=a.FOURCC_MAP[t[a.PIXEL_FORMAT_FOURCC_INDEX]],i=a.EXTENSION_MAP[t[a.PIXEL_FORMAT_FOURCC_INDEX]],n=1;t[a.FLAGS_INDEX]&a.MIPMAPCOUNT_FLAG&&(n=t[a.MIPMAPCOUNT_INDEX]);var o=t[a.WIDTH_INDEX],s=t[a.HEIGHT_INDEX],l=new Uint8Array(e,a.DATA_OFFSET);this._setCompressedTextureImage(l,i,r,o,s,n)},SceneJS.TextureMap.prototype._parsePVR=function(e){var t=new Uint32Array(e,0,n.HEADER_LENGTH);if(t[n.MAGIC_NUMBER_INDEX]!=n.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid PVR File: Magic number invalid.");var r=t[n.PIXEL_FORMAT_INDEX],i=n.EXTENSION_MAP[r],a=n.FORMAT_MAP[r],o=t[n.MIPMAPCOUNT_INDEX],s=t[n.WIDTH_INDEX],l=t[n.HEIGHT_INDEX],c=new Uint8Array(e,n.HEADER_SIZE+t[n.METADATA_SIZE_INDEX]);this._setCompressedTextureImage(c,i,a,s,l,o)},SceneJS.TextureMap.prototype._parseKTX=function(e){for(var t=new Uint32Array(e,0,o.HEADER_LENGTH),r=0;r<o.IDENTIFIER_LENGTH;++r)if(t[r]!=o.IDENTIFIER[r])throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid KTX File: Identifier invalid.");var i=t[o.INTERNAL_FORMAT_INDEX],a=o.EXTENSION_MAP[i],n=t[o.MIPMAPCOUNT_INDEX],s=t[o.WIDTH_INDEX],l=t[o.HEIGHT_INDEX],c=new Uint8Array(e,o.HEADER_SIZE+t[o.KEY_VALUE_SIZE_INDEX]);this._setCompressedTextureImage(c,a,i,s,l,n,!0)},function(){var e,t=document.createElement("canvas");if(t){var r=t.getContext("webgl")||t.getContext("experimental-webgl");r&&(i=function(e){var t=SceneJS._getExtension(e,"WEBGL_compressed_texture_pvrtc"),r=SceneJS._getExtension(e,"WEBGL_compressed_texture_etc1"),i=SceneJS._getExtension(e,"WEBGL_compressed_texture_s3tc"),a={PVRTC_SUPPORTED:!!t,ETC1_SUPPORTED:!!r,DXT_SUPPORTED:!!i,FORMAT_ENUMS:{},SIZE_FUNCTIONS:{}};return a.PVRTC_SUPPORTED&&(a.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,a.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,a.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,a.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,a.SIZE_FUNCTIONS[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=c,a.SIZE_FUNCTIONS[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=c,a.SIZE_FUNCTIONS[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=u,a.SIZE_FUNCTIONS[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=u),a.ETC1_SUPPORTED&&(a.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL=r.COMPRESSED_RGB_ETC1_WEBGL,a.SIZE_FUNCTIONS[r.COMPRESSED_RGB_ETC1_WEBGL]=_),a.DXT_SUPPORTED&&(a.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT=i.COMPRESSED_RGB_S3TC_DXT1_EXT,a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT=i.COMPRESSED_RGBA_S3TC_DXT3_EXT,a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT=i.COMPRESSED_RGBA_S3TC_DXT5_EXT,a.SIZE_FUNCTIONS[i.COMPRESSED_RGB_S3TC_DXT1_EXT]=_,a.SIZE_FUNCTIONS[i.COMPRESSED_RGBA_S3TC_DXT3_EXT]=h,a.SIZE_FUNCTIONS[i.COMPRESSED_RGBA_S3TC_DXT5_EXT]=h),a}(r),a=function(){var e={MAGIC_NUMBER:542327876,MIPMAPCOUNT_FLAG:131072,PIXEL_FORMAT_FOURCC_FLAG:4,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,SIZE_INDEX:1,FLAGS_INDEX:2,HEIGHT_INDEX:3,WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,PIXEL_FORMAT_FLAGS_INDEX:20,PIXEL_FORMAT_FOURCC_INDEX:21,DATA_OFFSET:128,FOURCC_MAP:{},EXTENSION_MAP:{}};if(i.DXT_SUPPORTED){var t=l("DXT1"),r=l("DXT3"),a=l("DXT5");e.FOURCC_MAP[t]=i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,e.FOURCC_MAP[r]=i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.FOURCC_MAP[a]=i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT,e.EXTENSION_MAP[t]="WEBGL_compressed_texture_s3tc",e.EXTENSION_MAP[r]="WEBGL_compressed_texture_s3tc",e.EXTENSION_MAP[a]="WEBGL_compressed_texture_s3tc"}if(i.ETC1_SUPPORTED){var n=l("ETC1");e.FOURCC_MAP[n]=i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL,e.EXTENSION_MAP[n]="WEBGL_compressed_texture_etc1"}return e}(),e={MAGIC_NUMBER:55727696,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12,EXTENSION_MAP:{0:"WEBGL_compressed_texture_pvrtc",1:"WEBGL_compressed_texture_pvrtc",2:"WEBGL_compressed_texture_pvrtc",3:"WEBGL_compressed_texture_pvrtc",6:"WEBGL_compressed_texture_etc1",7:"WEBGL_compressed_texture_s3tc",9:"WEBGL_compressed_texture_s3tc",11:"WEBGL_compressed_texture_s3tc"},FORMAT_MAP:{}},i.PVRTC_SUPPORTED&&(e.FORMAT_MAP[0]=i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,e.FORMAT_MAP[1]=i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,e.FORMAT_MAP[2]=i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,e.FORMAT_MAP[3]=i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),i.ETC1_SUPPORTED&&(e.FORMAT_MAP[6]=i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL),i.DXT_SUPPORTED&&(e.FORMAT_MAP[7]=i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,e.FORMAT_MAP[9]=i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.FORMAT_MAP[11]=i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT),n=e,o=function(){var e=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]),t={IDENTIFIER:new Uint32Array(e.buffer),IDENTIFIER_LENGTH:3,HEADER_LENGTH:16,HEADER_SIZE:64,INTERNAL_FORMAT_INDEX:7,WIDTH_INDEX:9,HEIGHT_INDEX:10,MIPMAPCOUNT_INDEX:14,KEY_VALUE_SIZE_INDEX:15,EXTENSION_MAP:{}};return i.DXT_SUPPORTED&&(t.EXTENSION_MAP[i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",t.EXTENSION_MAP[i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc",t.EXTENSION_MAP[i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc"),i.ETC1_SUPPORTED&&(t.EXTENSION_MAP[i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL]="WEBGL_compressed_texture_etc1"),t}())}}()}(),function(){"use strict";var e=SceneJS.TEXTURE_FLAGS,t={type:"fresnel",stateId:SceneJS._baseStateId++,power:1,centerColor:new Float32Array([1,1,1,1]),edgeColor:new Float32Array([0,0,0,0]),blendFactor:1,blendMode:e.multiply,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.fresnel=t,i=0}));var r=[],i=0;SceneJS.Fresnel=SceneJS_NodeFactory.createNodeType("fresnel"),SceneJS.Fresnel.prototype._init=function(r){if(1==this._core.useCount){if(r.applyTo&&"color"!=r.applyTo&&"specular"!=r.applyTo&&"alpha"!=r.applyTo&&"reflect"!=r.applyTo&&"emit"!=r.applyTo&&"fragment"!=r.applyTo&&"transparency"!=r.applyTo)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"fresnel applyTo value is unsupported - should be either 'color', 'specular', 'alpha', 'reflect', 'emit' or 'fragment'");if(this._core.applyTo=r.applyTo,r.blendMode&&"add"!=r.blendMode&&"multiply"!=r.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");this._core.blendMode=e[r.blendMode||"multiply"],this._core.centerColor=new Float32Array(t.centerColor),this._core.edgeColor=new Float32Array(t.edgeColor),this._core.power=t.power,null!=r.centerBias&&this.setCenterBias(r.centerBias),null!=r.edgeBias&&this.setEdgeBias(r.edgeBias),null!=r.power&&this.setPower(r.power),null!=r.centerColor&&this.setCenterColor(r.centerColor),null!=r.edgeColor&&this.setEdgeColor(r.edgeColor)}},SceneJS.Fresnel.prototype.getApplyTo=function(){return this._core.applyTo},SceneJS.Fresnel.prototype.setCenterBias=function(e){this._core.centerColor[3]=void 0!==e?e:t.centerColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getCenterBias=function(){return this._core.centerColor[3]},SceneJS.Fresnel.prototype.setEdgeBias=function(e){this._core.edgeColor[3]=void 0!==e?e:t.edgeColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getEdgeBias=function(){return this._core.edgeColor[3]},SceneJS.Fresnel.prototype.setPower=function(e){this._core.power=void 0!==e?e:t.power,this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getPower=function(){return this._core.power},SceneJS.Fresnel.prototype.setCenterColor=function(e){var r=t.centerColor;return this._core.centerColor[0]=null!=e.r?e.r:r[0],this._core.centerColor[1]=null!=e.g?e.g:r[1],this._core.centerColor[2]=null!=e.b?e.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getCenterColor=function(){return{r:this._core.centerColor[0],g:this._core.centerColor[1],b:this._core.centerColor[2]}},SceneJS.Fresnel.prototype.setEdgeColor=function(e){var r=t.edgeColor;return this._core.edgeColor[0]=null!=e.r?e.r:r[0],this._core.edgeColor[1]=null!=e.g?e.g:r[1],this._core.edgeColor[2]=null!=e.b?e.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getEdgeColor=function(){return{r:this._core.edgeColor[0],g:this._core.edgeColor[1],b:this._core.edgeColor[2]}},SceneJS.Fresnel.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("fresnel"),this.__core.transparent=!1,this.__core.partiallyOpaque=!1);var a=this._engine.display.fresnel;this._core.empty||(this.__core.diffuse="color"==this._core.applyTo?this._core:a.diffuse,this.__core.specular="specular"==this._core.applyTo?this._core:a.specular,this.__core.alpha="alpha"==this._core.applyTo?this._core:a.alpha,this.__core.reflect="reflect"==this._core.applyTo?this._core:a.reflect,this.__core.emit="emit"==this._core.applyTo?this._core:a.emit,this.__core.fragment="fragment"==this._core.applyTo?this._core:a.fragment,this.__core.transparency="transparency"==this._core.applyTo?this._core:a.transparency,this.__core.transparent=a.transparent,this.__core.partiallyOpaque=a.partiallyOpaque,"alpha"!=this._core.applyTo&&"transparency"!=this._core.applyTo||(this.__core.transparent=!0,(this._core.centerColor[0]>=1||this._core.edgeColor[0]>=1)&&(this.__core.partiallyOpaque=!0))),this._makeHash(this.__core),r[i++]=this.__core,this._engine.display.fresnel=this.__core,this._compileNodes(e),this._engine.display.fresnel=--i>0?r[i-1]:t,r[i]=null},SceneJS.Fresnel.prototype._makeHash=function(e){var t=[];e.diffuse&&t.push("d"+e.diffuse.blendMode+";"),e.specular&&t.push("s"+e.specular.blendMode+";"),e.alpha&&t.push("a"+e.alpha.blendMode+";"),e.reflect&&t.push("r"+e.reflect.blendMode+";"),e.emit&&t.push("e"+e.emit.blendMode+";"),e.fragment&&t.push("f"+e.fragment.blendMode+";"),e.transparency&&t.push("t"+e.transparency.blendMode+";"),t.push(e.blendMode+";"),t=t.join(""),e.hash!=t&&(e.hash=t)},SceneJS.Fresnel.prototype._destroy=function(){}}(),function(){"use strict";var e={type:"cubemap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,space:"world",hash:""},t=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.cubemap=e,r=0})),SceneJS.Cubemap=SceneJS_NodeFactory.createNodeType("cubemap"),SceneJS.Cubemap.prototype._init=function(e){if(1===this._core.useCount){if(this._core.hash="y",e.blendMode&&"add"!==e.blendMode&&"multiply"!==e.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap blendMode value is unsupported - should be either 'add' or 'multiply'");var t=e.applyTo||"reflect";if("reflect"!==t&&"light"!==t)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap applyTo value is unsupported - should be either 'reflect' or 'light'");this._core.blendMode=e.blendMode||"multiply",this._core.intensity=null!=e.intensity&&null!=e.intensity?e.intensity:1,this._core.applyTo=SceneJS.CUBEMAP_FLAGS[t];var r=e.space||"world";if("view"!==r&&"world"!==r)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"cubemap 'space' value is unsupported: '"+r+"' - should be 'view' or 'world'");"view"===r&&"reflect"===t&&(r="world;"),this._core.space=r;for(var i=this,a=this._engine.canvas.gl,n=a.createTexture(),o=[a.TEXTURE_CUBE_MAP_POSITIVE_X,a.TEXTURE_CUBE_MAP_NEGATIVE_X,a.TEXTURE_CUBE_MAP_POSITIVE_Y,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,a.TEXTURE_CUBE_MAP_POSITIVE_Z,a.TEXTURE_CUBE_MAP_NEGATIVE_Z],s=new Array(6),l=!1,c=6,u=0;u<o.length;u++){var _=new Image;_.onload=function(e){var t=_;return function(){if(!l&&(s[e]=t,0==--c)){a.bindTexture(a.TEXTURE_CUBE_MAP,n),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);for(var r=0,u=s.length;r<u;r++)a.texImage2D(o[r],0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,s[r]);i._core.texture=new SceneJS._webgl.Texture2D(a,{texture:n,target:a.TEXTURE_CUBE_MAP,minFilter:a.LINEAR_MIPMAP_LINEAR,magFilter:a.LINEAR,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE});var _=Math.min(t.width,t.height);i._core.mipLevels=SceneJS_math_log2(_),i._engine.display.imageDirty=!0}}}(u),_.onerror=function(){l=!0},_.src=e.src[u]}}},SceneJS.Cubemap.prototype._compile=function(i){this.__core||(this.__core=this._engine._coreFactory.getCore("cubemap"));var a=this._engine.display.cubemap;this._core.empty||(this.__core.layers=a&&a.layers?a.layers.concat([this._core]):[this._core]),this._makeHash(this.__core),t[r++]=this.__core,this._engine.display.cubemap=this.__core,this._compileNodes(i),this._engine.display.cubemap=--r>0?t[r-1]:e,t[r]=null},SceneJS.Cubemap.prototype._makeHash=function(e){var t;if(e.layers&&e.layers.length>0){for(var r,i=e.layers,a=[],n=0,o=i.length;n<o;n++)r=i[n],a.push("/"),a.push(r.applyTo),a.push("/"),a.push(r.space),a.push("/"),a.push(r.blendMode);t=a.join("")}else t="";e.hash!=t&&(e.hash=t)},SceneJS.Cubemap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";var e={type:"regionMap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,regionColor:[-1,-1,-1],highlightFactor:[1.5,1.5,0],hideAlpha:0,regionData:[],mode:"info",hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.regionMap=e}));var t={info:!0,highlight:!0,hide:!0,isolate:!0};SceneJS.RegionMap=SceneJS_NodeFactory.createNodeType("regionMap"),SceneJS.RegionMap.prototype._init=function(e){var t=this;if(1==this._core.useCount){SceneJS._apply({regionMap:null},this._core);var r=e.applyFrom||"uv";if("uv"!==r.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var i=0;if("uv"!==r&&(i=r.substring(2),isNaN(i)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");this._core.uvLayerIdx=i,e.src?(this._initTexture(),this._core.src=e.src,this._loadTexture(e.src)):e.image&&(this._initTexture(e.preloadColor),this._core.image=e.image,this._setTextureImage(e.image)),this._core.webglRestored=function(){t._core.image?(t._initTexture(),t._setTextureImage(t._core.image)):t._core.src&&(t._initTexture(),t._loadTexture(t._core.src))},this.setRegionColor(e.regionColor),this.setHighlightFactor(e.highlightFactor),this.setHideAlpha(e.hideAlpha),this.setRegionData(e.regionData),this.setMode(e.mode)}},SceneJS.RegionMap.prototype._initTexture=function(){var e=this._engine.canvas.gl,t={r:.57735,g:.57735,b:.57735};t.a=void 0===t.a?1:t.a,t=new Uint8Array([Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b),Math.floor(255*t.a)]);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),this._setCoreTexture(r)},SceneJS.RegionMap.prototype._loadTexture=function(e){var t=this,r=new Image;r.onload=function(){t._setTextureImage(r),t._engine.display.imageDirty=!0},this._fetchImage(r,e)},SceneJS.RegionMap.prototype._fetchImage=function(e,t){0==t.indexOf("data")?e.src=t:(e.crossOrigin="Anonymous",e.src=t)},SceneJS.RegionMap.prototype._setTextureImage=function(e){var t=this._engine.canvas.gl,r=this._core.texture?this._core.texture.texture:t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),this._core.image=e,this._setCoreTexture(r)},SceneJS.RegionMap.prototype._setCoreTexture=function(e){var t=this._engine.canvas.gl;this._core.texture=new SceneJS._webgl.Texture2D(t,{texture:e,minFilter:this._getGLOption("minFilter",t.NEAREST_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",t.NEAREST),wrapS:this._getGLOption("wrapS",t.REPEAT),wrapT:this._getGLOption("wrapT",t.REPEAT),isDepth:this._getOption(this._core.isDepth,!1),depthMode:this._getGLOption("depthMode",t.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",t.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",t.LEQUAL),flipY:this._getOption(this._core.flipY,!0),width:this._getOption(this._core.width,1),height:this._getOption(this._core.height,1),internalFormat:this._getGLOption("internalFormat",t.ALPHA),sourceFormat:this._getGLOption("sourceFormat",t.ALPHA),sourceType:this._getGLOption("sourceType",t.UNSIGNED_BYTE),update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.RegionMap.prototype._getGLOption=function(e,t){var r=this._engine.canvas.gl,i=this._core[e];if(null==i)return t;var a=SceneJS._webgl.enumMap[i];if(null==a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+i+"'");return r[a]},SceneJS.RegionMap.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.RegionMap.prototype.setSrc=function(e){this._core.image=null,this._core.src=e,this._core.target=null,this._loadTexture(e)},SceneJS.RegionMap.prototype.setImage=function(e){this._core.image=e,this._core.src=null,this._core.target=null,this._setTextureImage(e)},SceneJS.RegionMap.prototype.setTarget=function(e){"colorTarget"==e.type||"depthTarget"==e.type?(delete this._core.src,this._core.target=e,this._core.src=null,this._core.image=null,this._core.texture=e._core.renderBuf.getTexture(),this._core.texture.bufType=e._core.bufType,this._engine.display.imageDirty=!0):console.log("Target node type not compatible: "+e.type)},SceneJS.RegionMap.prototype.setRegionColor=function(t){var r=e.regionColor;return this._core.regionColor=t?[null!=t.r&&null!=t.r?t.r:r[0],null!=t.g&&null!=t.g?t.g:r[1],null!=t.b&&null!=t.b?t.b:r[2]]:e.regionColor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHighlightFactor=function(t){var r=e.highlightFactor;return this._core.highlightFactor=t?[null!=t.r&&null!=t.r?t.r:r[0],null!=t.g&&null!=t.g?t.g:r[1],null!=t.b&&null!=t.b?t.b:r[2]]:e.highlightFactor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHideAlpha=function(t){return this._core.hideAlpha=null!=t?t:e.hideAlpha,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setMode=function(r){var i=!!this._core.transparent;return this._core.mode=r&&t[r]?r:e.mode,this._core.transparent="hide"===this._core.mode||"isolate"===this._core.mode,i!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this._core.hash="reg-"+r,this},SceneJS.RegionMap.prototype.setRegionData=function(t){return this._core.regionData=t||e.regionData,this},SceneJS.RegionMap.prototype._compile=function(e){var t=this._engine.display.regionMap;this._engine.display.regionMap=this._core,this._compileNodes(e),this._engine.display.regionMap=t},SceneJS.RegionMap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";SceneJS.GlobalCubemap=function(e,t,r){this.scene=e,this.id=t,this.intensity=null!=r.intensity?r.intensity:1;var i=r.space||"world";"view"!==i&&"world"!==i&&(console.error("cubemap 'space' value is unsupported: '"+i+"' - should be 'view' or 'world' - defaulting to 'world'"),i="world"),this.space=i,this.hash=[this.space].join("");for(var a=this,n=e._engine.canvas.gl,o=n.createTexture(),s=[n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z,n.TEXTURE_CUBE_MAP_NEGATIVE_Z],l=new Array(6),c=!1,u=6,_=0;_<s.length;_++){var h=new Image;h.onload=function(t){var r=h;return function(){if(!c&&(l[t]=r,0==--u)){n.bindTexture(n.TEXTURE_CUBE_MAP,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);for(var i=0,_=l.length;i<_;i++)n.texImage2D(s[i],0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,l[i]);a.texture=new SceneJS._webgl.Texture2D(n,{texture:o,target:n.TEXTURE_CUBE_MAP,minFilter:n.LINEAR_MIPMAP_LINEAR,magFilter:n.LINEAR,wrapS:n.CLAMP_TO_EDGE,wrapT:n.CLAMP_TO_EDGE});var h=Math.min(r.width,r.height);a.mipLevels=SceneJS_math_log2(h),e._engine.display.imageDirty=!0}}}(_),h.onerror=function(){c=!0},h.src=r.src[_]}},SceneJS.GlobalCubemap.prototype.destroy=function(){this.texture&&(this.texture.destroy(),this.texture=null)}}(),function(){"use strict";var e=[],t=0,r={type:"xform",stateId:SceneJS._baseStateId++,matrix:mat4.create(),normalMatrix:mat4.create()};SceneJS.XForm=SceneJS_NodeFactory.createNodeType("xform"),SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.modelTransform=r,t=0})),SceneJS.XForm.prototype._init=function(e){1==this._core.useCount&&(this._core.matrix=mat4.create(),this._core.normalMatrix=mat4.create(),e.elements&&this.setElements(e.elements))},SceneJS.XForm.prototype.getMatrix=function(){return this._core.matrix},SceneJS.XForm.prototype.setElements=function(e){if(16!=e.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.XForm elements should number 16");var t=this._core;return t.matrix.set(e),mat4.invert(t.normalMatrix,t.matrix),mat4.transpose(t.normalMatrix,t.normalMatrix),this._engine.display.imageDirty=!0,this},SceneJS.XForm.prototype.getElements=function(){return this._core.matrix},SceneJS.XForm.prototype._compile=function(i){this._engine.display.modelTransform=e[t++]=this._core,this._compileNodes(i),this._engine.display.modelTransform=--t>0?e[t-1]:r,e[t]=null}}(),function(){"use strict";SceneJS.Types=new function(){this.addType=function(e,t){var r,i=SceneJS_NodeFactory.createNodeType(e);for(var a in t)if(t.hasOwnProperty(a))switch(r=t[a],a){case"init":case"construct":!function(){var e=t[a];i.prototype._init=function(t){e.call(this,t)},i.prototype._fromPlugin=!0}();break;case"destroy":case"destruct":i.prototype._destroy=r;break;default:i.prototype[a]=r}},this.hasType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]}}}(),function(){"use strict";var e,t,r,i,a,n,o,s,l,c,u=window.SceneJS_Display=function(e,t){this.stats=e||{},this._canvas=t.canvas,this._programFactory=new SceneJS_ProgramFactory(this.stats,{canvas:t.canvas}),this._chunkFactory=new SceneJS_ChunkFactory,this.transparent=!0===t.transparent,this.depthSort=!0===t.depthSort,this.autoTangents=!0===t.autoTangents,this.gammaInputPhong=!0===t.gammaInputPhong,this.properties=null,this.material=null,this.texture=null,this.fresnel=null,this.cubemap=null,this.modelTransform=null,this.regionMap=null,this.morphGeometry=null,this.geometry=null,this._objects={},this._ambientColor=[.7,.7,.8],this.projection={type:"perspective",fov:60,aspect:1,near:.1,far:500,pan:0},this.projectionMatrix=mat4.create(),this.buildProjectionMatrix(),this.camera={eye:new Float32Array([0,0,10]),look:new Float32Array([0,0,0]),up:new Float32Array([0,1,0])},this.viewMatrix=mat4.create(),this.hasDeviceMatrix=!1,this.deviceMatrix=mat4.create(),this.buildViewMatrix(),this.lights=[{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!0,specular:!0,dir:new Float32Array([-.5,-.5,-1]),space:"view"},{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!1,specular:!0,dir:new Float32Array([1,-.9,-.7]),space:"view"}],this.lightHash="dirsdv/dirsv/",this.clips={clips:[],clipFade:!1,clipDiscard:!1,enabled:!1},this.clipsHash="",this.reflections={reflections:{},activeReflection:null},this.reflectionsHash="",this.lightmaps={lightmaps:{},activeLightmap:null},this.lightmapsHash="",this.highlightColor=new Float32Array([1.5,1.5,.5]),this.desatParams=new Float32Array([.9,.3]),this.fogParams=new Float32Array([0,1e3,0,1]),this.fogColor=new Float32Array([1,1,1,.01]),this.fogEnabled=!1,this.xrayColor=new Float32Array([0,0,.1]),this.fogMode=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,this.viewport=new Float32Array([0,0,this._canvas.canvas.width,this._canvas.canvas.height]),this._opaqueObjects=[],this._numOpaqueObjects=0,this._transparentObjects=[],this._numTransparentObjects=0,this._pickLookup=[],this._frameCtx={regionData:[],canvas:this._canvas,VAO:null},this.objectListDirty=!0,this.imageDirty=!0,this._nextProgramId=0,this.postProcessPipelineOpaque=[],this.postProcessPipelineTransparent=[],this.postProcessPipelineFinal=[],this._postProcessTypes={},this._postProcesses={},this.framebuffers={},this.mainFramebuffer=null,this.mainFramebufferParams=null,this.oitAccumulateFramebuffer=null,this.oitPostprocessType=null,this.oitPostprocess=null,this.blitPostprocessType=null,this.blitPostprocess=null,this.transparencyMode=SceneJS.TRANSPARENCY_FLAGS.ALPHA,this.depthSort=!1,this.postProcessInitialized=!1,this.oitInitialized=!1};function _(e,t){return e.sortKey-t.sortKey}function h(e,t){return e.layer-t.layer||e.properties.stateId-t.properties.stateId||e.sortTieBreaker-t.sortTieBreaker}function f(e,t){return e.layer-t.layer||t.getDepth()-e.getDepth()}u.prototype.initPostProcess=function(){this.postProcessInitialized||(this.mainFramebuffer=this.createFramebuffer("__MAIN",this.mainFramebufferParams),this.blitPostprocessType=this.createPostProcessType("__BLIT",["precision highp float;","varying vec2 vUV;","uniform sampler2D uTexture;","void main() {","    gl_FragColor = texture2D(uTexture, vUV);","}"].join("\n")),this.blitPostprocess=new SceneJS_PostProcessStage(this,{type:"__BLIT",textures:{uTexture:{framebuffer:"__MAIN",target:"color"}}}),this.postProcessInitialized=!0)},u.prototype.initOIT=function(){this.oitInitialized||(this.initPostProcess(),this.oitAccumulateFramebuffer=this.createFramebuffer("__OIT_ACCUMULATE",{colorAttachments:[{type:"FLOAT"}],sharedDepthBuffer:this.mainFramebuffer}),this.oitDepthBuffer=this.createFramebuffer("__OIT_DEPTH",{colorAttachments:0}),this.oitPostprocessType=this.createPostProcessType("__OIT",["precision highp float;","varying vec2 vUV;","uniform vec2 uTexelOffset;","uniform sampler2D uAccumulate;","#define THRESH 0.1176","float edgeFilter(vec2 center, vec2 a0, vec2 a1, vec2 a2, vec2 a3){","    vec4 luminance = vec4(a0.x, a1.x , a2.x, a3.x);","    vec4 w = 1.0 - step(THRESH, abs(luminance - center.x));","    float W = w.x + w.y + w.z + w.w;","    w.x = W == 0.0 ? 1.0 : w.x;","    W = W == 0.0 ? 1.0 : W;","    return (w.x * a0.y + w.y * a1.y + w.z * a2.y + w.w * a3.y) / W;","}","void main() {","    vec4 accum = texture2D(uAccumulate, vUV);","    vec4 a0 = texture2D(uAccumulate, vUV + vec2(uTexelOffset.x, 0.0));","    vec4 a1 = texture2D(uAccumulate, vUV - vec2(uTexelOffset.x, 0.0));","    vec4 a2 = texture2D(uAccumulate, vUV + vec2(0.0, uTexelOffset.y));","    vec4 a3 = texture2D(uAccumulate, vUV - vec2(0.0, uTexelOffset.y));","    accum.rg /= max(accum.b, 0.001);","    a0.rg /= max(a0.b, 0.001);","    a1.rg /= max(a1.b, 0.001);","    a2.rg /= max(a2.b, 0.001);","    a3.rg /= max(a3.b, 0.001);","    vec3 ycocg = vec3(accum.rg, edgeFilter(accum.rg, a0.rg, a1.rg, a2.rg, a3.rg));","    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);","    ycocg.gb = checkerboard ? ycocg.gb : ycocg.bg;","    vec3 rgb = vec3(ycocg.r + ycocg.g - ycocg.b, ycocg.r + ycocg.b, ycocg.r - ycocg.g - ycocg.b);","    float a = 1.0 - accum.a;","    gl_FragColor = vec4(a * rgb, a);","}"].join("\n")),this.oitPostprocess=new SceneJS_PostProcessStage(this,{type:"__OIT",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uAccumulate:{framebuffer:"__OIT_ACCUMULATE",target:"color"}}}),this.oitInitialized=!0)},u.prototype.setTransparencyMode=function(e){this.transparencyMode=e,e===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.initOIT(),this.objectListDirty=!0},u.prototype.createFramebuffer=function(e,t){return this.framebuffers[e]&&this.framebuffers[e].destroy(),(t=t||{}).canvas=this._canvas,this.framebuffers[e]=new SceneJS._webgl.Framebuffer(t),this.framebuffers[e]},u.prototype.destroyFramebuffer=function(e){this.framebuffers[e]&&this.framebuffers[e].destroy(),delete this.framebuffers[e]},u.prototype.getPostProcessStage=function(e){return this._postProcesses[e]},u.prototype.createPostProcessType=function(e,t,r){return this._postProcessTypes[e]=new SceneJS_PostProcess(this.stats,this._canvas.gl,t,r),this._postProcessTypes[e]},u.prototype.postProcessOpaque=function(e){var t,r;for((e=e||[]).length>0&&this.initPostProcess(),t=0,r=this.postProcessPipelineOpaque.length;t<r;++t){var i=this.postProcessPipelineOpaque[t];delete this._postProcesses[i.id],i.destroy()}for(this.postProcessPipelineOpaque.length=0,t=0,r=e.length;t<r;++t){var a=e[t],n=a.id;this._postProcesses[n]=new SceneJS_PostProcessStage(this,a),this.postProcessPipelineOpaque.push(this._postProcesses[n])}this.imageDirty=!0},u.prototype.postProcessFinal=function(e){var t,r;for((e=e||[]).length>0&&this.initPostProcess(),t=0,r=this.postProcessPipelineFinal.length;t<r;++t){var i=this.postProcessPipelineFinal[t];delete this._postProcesses[i.id],i.destroy()}for(this.postProcessPipelineFinal.length=0,t=0,r=e.length;t<r;++t){var a=e[t],n=a.id;this._postProcesses[n]=new SceneJS_PostProcessStage(this,a),this.postProcessPipelineFinal.push(this._postProcesses[n])}this.imageDirty=!0},u.prototype.webglRestored=function(){this._programFactory.webglRestored(),this._chunkFactory.webglRestored();var e=this._canvas.gl;for(var t in this.pickBuf&&this.pickBuf.webglRestored(e),this.framebuffers)this.framebuffers[t].webglRestored(e);for(var r in this._postProcessTypes)this._postProcessTypes[r].webglRestored(e);this.imageDirty=!0},u.prototype.setViewport=function(e,t,r,i){this.viewport[0]=e,this.viewport[1]=t,this.viewport[2]=r,this.viewport[3]=i,this.imageDirty=!0},u.prototype.buildProjectionMatrix=function(){var e=this.projection,t=this.projectionMatrix;if("ortho"==e.type)mat4.ortho(t,e.left,e.right,e.bottom,e.top,e.near,e.far);else if("frustum"==e.type)mat4.frustum(t,e.left,e.right,e.bottom,e.top,e.near,e.far);else if("perspective"==e.type){var r=e.fov;r=Math.min(r,120),mat4.perspective(t,r*Math.PI/180,e.aspect,e.near,e.far)}if(e.pan){var i=e.pan,a=mat4.fromTranslation(mat4.create(),[i.x||0,i.y||0,i.z||0]);mat4.multiply(t,a,t)}},u.prototype.buildViewMatrix=function(){var e=this.camera,t=this.viewMatrix;if(mat4.lookAt(t,e.eye,e.look,e.up),this.hasDeviceMatrix){var r=mat4.create();mat4.multiply(r,this.deviceMatrix,t),t.set(r)}},u.prototype.buildObject=function(e,t){var r=this._objects[e];r||(r=this._objects[e]=new SceneJS_Object(e)),r.modelTransform=this.modelTransform,r.viewMatrix=this.viewMatrix,r.projectionMatrix=this.projectionMatrix,r.texture=this.texture,r.cubemap=this.cubemap,r.geometry=this.geometry,r.morphGeometry=this.morphGeometry,r.properties=this.properties,r.material=this.material,r.fresnel=this.fresnel,r.regionMap=this.regionMap,r.backfaces=t.backfaces,r.addBlend=t.addBlend,r.layer=t.layer;var i=[this.geometry.hash,this.morphGeometry.hash,this.texture.hash,this.fresnel.hash,this.cubemap.hash,this.lightHash,this.clipsHash,this.reflectionsHash,this.lightmapsHash,this.properties.hash,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&r.isPartiallyOpaque()?"pt":"",this.regionMap.hash,this.fogEnabled?"f"+this.fogMode:""].join(";");if(!r.program||i!=r.hash){r.program&&(this._programFactory.putProgram(r.program.draw),this._programFactory.putProgram(r.program.xray),this._programFactory.putProgram(r.program.pick),this._programFactory.putProgram(r.program.pickTriangle),this._programFactory.putProgram(r.program.depth),this._programFactory.putProgram(r.program.drawTexture),SceneJS_ProgramSourceFactory.putSource(r.hash));var a=SceneJS_ProgramSourceFactory.getSource(i,this,r);r.program={draw:this._programFactory.getProgram(i+"-draw",a.drawVertexSrc,a.drawFragmentSrc),xray:this._programFactory.getProgram(i+"-xray",a.xrayVertexSrc,a.xrayFragmentSrc),pick:this._programFactory.getProgram(i+"-pick",a.pickVertexSrc,a.pickFragmentSrc),pickTriangle:this._programFactory.getProgram(i+"-pickTriangle",a.pickTriangleVertexSrc,a.pickTriangleFragmentSrc),depth:this._programFactory.getProgram(i+"-depth",a.depthVertexSrc,a.depthFragmentSrc),drawTexture:this._programFactory.getProgram(i+"-drawTexture",a.drawTextureVertexSrc,a.drawTextureFragmentSrc),id:this._nextProgramId++,gl:this._canvas.gl},r.hash=i,r.sortKey=1e5*(r.program.id+1)+r.texture.stateId}this._setChunk(r,"draw",0,"program"),this._setChunk(r,"draw",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"draw",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(r,"draw",3,"regionMap",[this.regionMap]),this._setChunk(r,"draw",4,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"draw",5,"draw",[this.geometry]),this._setChunk(r,"xray",0,"program"),this._setChunk(r,"xray",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"xray",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"xray",3,"draw",[this.geometry]),this._setChunk(r,"pick",0,"program"),this._setChunk(r,"pick",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"pick",2,"regionMap",[this.regionMap]),this._setChunk(r,"pick",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"pick",4,"draw",[this.geometry]),this._setChunk(r,"pickTriangle",0,"program"),this._setChunk(r,"pickTriangle",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"pickTriangle",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"pickTriangle",3,"draw",[this.geometry]),this._setChunk(r,"depth",0,"program"),this._setChunk(r,"depth",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"depth",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"depth",3,"draw",[this.geometry]),this._setChunk(r,"drawTexture",0,"program"),this._setChunk(r,"drawTexture",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"drawTexture",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(r,"drawTexture",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"drawTexture",4,"draw",[this.geometry]),this.objectListDirty=!0},u.prototype._setChunk=function(e,t,r,i,a,n){var o;void 0===e.chunkSets[t]&&(e.chunkSets[t]=[]);var s=e.chunkSets[t];if(a){for(var l,c=!0,u=0,_=a.length;u<_;++u)if(!a[u].empty){c=!1;break}if(c)return(l=s[r])&&this._chunkFactory.putChunk(l),void(s[r]=null);for(o="p"+e.program.id,u=0,_=a.length;u<_;++u)o+="_"+a[u].stateId}else o="p"+e.program.id;if(o=r+"__"+o,l=s[r]){if(l.id==o)return;this._chunkFactory.putChunk(l)}s[r]=this._chunkFactory.getChunk(o,i,e.program,a)},u.prototype.removeObject=function(e){var t=this._objects[e];if(t){for(var r in this._programFactory.putProgram(t.program),t.program=null,t.hash=null,t.chunkSets)for(var i,a=t.chunkSets[r],n=0,o=a.length;n<o;n++)(i=a[n])&&this._chunkFactory.putChunk(i);delete this._objects[e],this.objectListDirty=!0}},u.prototype.prepareScene=function(){this.objectListDirty&&(this._buildObjectList(),this.objectListDirty=!1,this.imageDirty=!0)},u.prototype.render=function(e){e=e||{},0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height&&(this.imageDirty||e.force)&&(this._doDrawList({clear:!1!==e.clear,opaqueOnly:e.opaqueOnly,pass:e.pass,custom:e.custom}),this.imageDirty=!1,this.pickBufDirty=!0)},u.prototype._buildObjectList=function(){var e,t=SceneJS.PROPERTY_FLAGS.ENABLED,r=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS);for(e in this._numOpaqueObjects=0,this._numTransparentObjects=0,this._objects){var i=this._objects[e];i.properties.flags&t&&(i.isTransparent()?(this._transparentObjects[this._numTransparentObjects++]=i,r&&i.isPartiallyOpaque()&&(this._opaqueObjects[this._numOpaqueObjects++]=i)):this._opaqueObjects[this._numOpaqueObjects++]=i)}this._opaqueObjects.length=this._numOpaqueObjects,this._opaqueObjects.sort(_),this._transparentObjects.length=this._numTransparentObjects,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ORDER_DEPENDENT?this._transparentObjects.sort(h):this._transparentObjects.sort(_)},e=vec3.create(),t=vec3.create(),r=mat4.create(),i=mat4.frustum(mat4.create(),-1,1,-1,1,.1,1e4),a=vec3.create(),n=vec3.create(),o=vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),mat4.create(),mat4.create(),vec4.create(),vec4.create(),s=vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),l=function(){var e=mat4.create(),t=mat4.create(),r=mat4.create(),i=vec4.create(),a=vec4.create();return function(n,o,s,l,c){var u=o.projectionMatrix;mat4.multiply(e,o.viewMatrix,o.modelTransform.matrix),mat4.multiply(t,u,e),mat4.invert(r,t);var _=n.width,h=n.height,f=(s[0]-_/2)/(_/2),d=-(s[1]-h/2)/(h/2);vec4.transformMat4(i,[f,d,-1,1],r),vec3.scale(i,i,1/i[3]),vec4.transformMat4(a,[f,d,1,1],r),vec3.scale(a,a,1/a[3]),l[0]=i[0],l[1]=i[1],l[2]=i[2],vec3.subtract(c,a,i),vec3.normalize(c,c)}}(),c=function(){var e=mat4.create(),t=vec4.create(),r=vec4.create();return function(i,a,n,o,s){mat4.invert(e,i.modelTransform.matrix),t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=1,vec4.transformMat4(r,t,e),o[0]=r[0],o[1]=r[1],o[2]=r[2],vec3.transformMat4(s,n,e)}}(),u.prototype.pick=function(u){if(u.canvasPos||!u.rayPick||u.origin&&u.direction){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var _=this._canvas.canvas,h=this._canvas.resolutionScaling,f=u.canvasPos;f&&(f=new Float32Array([f[0]*h,f[1]*h]));var d,m,p,g=this.pickBuf,y=null;g||(g=this.pickBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas}));var v,S,E,b,I=!u.canvasPos;if(I){v=u.origin||new Float32Array([0,0,0]),S=u.direction||new Float32Array([0,0,1]);var x=vec3.add(s,v,S),C=new Float32Array([0,1,0]);mat4.lookAt(r,v,x,C),E=.5*_.clientWidth,b=.5*_.clientHeight}else E=f[0],b=f[1];this.prepareScene(),this.render(),g.bind(),g.clear(),this._doDrawList({pickObject:!0,clear:!0,pickViewMatrix:I?r:null,pickProjMatrix:I?i:null}),this._canvas.gl.finish();var T=g.read(E,b),N=this._pickLookup[T[0]+256*T[1]+256*T[2]*256+256*T[3]*256*256-1];if(N>=0){y={canvasPos:f,objectId:(d=N<this._numOpaqueObjects?this._opaqueObjects[N]:this._transparentObjects[N-this._numOpaqueObjects]).id};var D=d.properties;D&&(y.name=D.name,y.nodeId=D.nodeId)}if(u.pickRegion&&(g.clear(),this._doDrawList({pickRegion:!0,object:d,pickViewMatrix:I?r:null,pickProjMatrix:I?i:null,clear:!0}),0!==(T=g.read(E,b))[0]||0!==T[1]||0!==T[2]||0!==T[3])){y=y||{canvasPos:f};var A,P={r:T[0]/255,g:T[1]/255,b:T[2]/255,a:T[3]/255},M=this._frameCtx.regionData,w={};for(m=0,p=M.length;m<p;m++)if(A=M[m].color,P&&M[m].data&&Math.max(Math.abs(P.r-A.r),Math.abs(P.g-A.g),Math.abs(P.b-A.b),Math.abs(P.a-(void 0===A.a?P.a:A.a)))<.01){w=M[m].data;break}y.color=P,y.regionData=w}if(u.pickTriangle&&d){g.clear(),this._doDrawList({pickTriangle:!0,object:d,pickViewMatrix:I?r:null,pickProjMatrix:I?i:null,clear:!0});var R=(T=g.read(E,b))[0]+256*T[1]+256*T[2]*256+256*T[3]*256*256;y.primitiveIndex=R*=3,"triangles"===d.geometry.primitiveName&&(y.primitive="triangle",I?c(d,v,S,e,t):l(_,d,f,e,t),y.indices=vec3.create(),d.getTriangleIndices(R,y.indices),d.getTrianglePositionOnSurface(R,a,n,o),y.position=vec3.create(),SceneJS_math_rayPlaneIntersect(e,t,a,n,o,y.position),y.barycentric=vec3.create(),d.cartesianToBarycentric(R,y.position,y.barycentric),y.normal=vec3.create(),d.normalFromBarycentric(R,y.barycentric,y.normal),y.worldPos=vec3.create(),d.getPointInWorldSpace(y.position,y.worldPos),y.uvs=[],d.uvFromBarycentric(R,y.barycentric,y.uvs),y.uvs.length>0&&(y.uv=y.uvs[0]))}return g.unbind(),y}}else console.warn("Incomplete pick parameters")},u.prototype._doDrawList=function(){var e={},t=new Float32Array(2);function r(t){e[t]||(e[t]=new Int32Array(8));for(var r=e[t],i=0,a=r.length;i<a;++i)r[i]=-1}function i(t,r,i){var a,n=t.gl,o=r.chunkSets[i],s=e[i];t.backfaces!=r.backfaces&&(r.backfaces?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),t.backfaces=r.backfaces),t.addBlend!=r.addBlend&&(n.blendFunc(n.ONE,r.addBlend?n.ONE:n.ONE_MINUS_SRC_ALPHA),t.addBlend=r.addBlend);for(var l=0,c=o.length;l<c;l++)(a=o[l])&&(a.unique||s[l]!==a.numericId)&&(a.draw(i,t),s[l]=a.numericId)}return function(e){var a=this._canvas.gl,n=this._frameCtx;n.gl=a,n.pass=e.pass||0,n.targetIndex=0,n.viewMatrix=this.viewMatrix,n.cameraEye=this.camera.eye,n.modelMat=null,n.cameraMat=null,n.projectionMatrix=this.projectionMatrix,n.lights=this.lights,n.clips=this.clips,n.reflection=this.reflections.activeReflection,n.lightmap=this.lightmaps.activeLightmap,n.highlightColor=this.highlightColor,n.desatParams=this.desatParams,n.fogParams=this.fogParams,n.fogColor=this.fogColor,n.fogMode=this.fogMode,n.fogEnabled=this.fogEnabled,n.xrayColor=this.xrayColor,n.scissorTestEnabled=!1,n.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,n.backfaces=!0,n.frontface=SceneJS.PROPERTY_FLAGS.CCW,n.picking=!!e.pickObject||!!e.pickTriangle||!!e.pickRegion,n.pickObject=!!e.pickObject,n.pickTriangle=!!e.pickTriangle,n.pickRegion=!!e.pickRegion,n.pickIndex=1,n.textureUnit=0,n.lineWidth=1,n.transparent=0,n.ambientColor=this._ambientColor,n.canvasResolution=n.canvasResolution||new Float32Array(2),n.canvasResolution[0]=this._canvas.canvas.width,n.canvasResolution[1]=this._canvas.canvas.height,n.aspect=this._canvas.canvas.width/this._canvas.canvas.height,n.texture=null,n.hasNormalMap=!1,n.regionMapUVLayerIdx=-1,n.drawElements=0,n.drawArrays=0,n.useProgram=0,n.bindTexture=0,n.bindArray=0,n.pickViewMatrix=e.pickViewMatrix,n.pickProjMatrix=e.pickProjMatrix,n.discardOpaque=!1,n.outputFormat=0,n.depthBuffer=null,n.addBlend=!1;var o=a.getExtension("OES_vertex_array_object");if(n.VAO=o||null,SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&a.getExtension("OES_standard_derivatives"),a.viewport(this.viewport[0],this.viewport[1],n.canvasResolution[0],n.canvasResolution[1]),a.enable(a.DEPTH_TEST),a.frontFace(a.CCW),a.disable(a.CULL_FACE),a.depthMask(!0),this.transparent||n.picking?a.clearColor(0,0,0,0):a.clearColor(this._ambientColor[0],this._ambientColor[1],this._ambientColor[2],1),e.custom){var s=e.custom.renderMode,l=e.custom.objects;for(r(s),_=0;_<l.length;_++)i(n,p=l[_],s)}else if(e.pickObject){r("pick");var c=0;for(e.clear&&a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),_=0,h=this._numOpaqueObjects;_<h;_++)(p=this._opaqueObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=_,i(n,p,"pick"));for(_=0,h=this._numTransparentObjects;_<h;_++)(p=this._transparentObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=this._numOpaqueObjects+_,i(n,p,"pick"))}else if(e.pickTriangle&&e.object)e.clear&&a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),r("pickTriangle"),i(n,e.object,"pickTriangle");else if(e.pickRegion){if(r("pick"),e.clear&&a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),e.object)i(n,e.object,"pick");else if(c=0,e.pickRegion){for(_=0,h=this._numOpaqueObjects;_<h;_++)(p=this._opaqueObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=_,i(n,p,"pick"));for(_=0,h=this._numTransparentObjects;_<h;_++)(p=this._transparentObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=this._numOpaqueObjects+_,i(n,p,"pick"))}}else{r("draw"),r("xray"),Date.now();var u=this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this._numTransparentObjects>0||this.postProcessPipelineOpaque.length>0||this.postProcessPipelineFinal.length>0;for(u&&this.mainFramebuffer.bind(),e.clear&&a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),_=0,h=this._numOpaqueObjects;_<h;_++)(p=this._opaqueObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?i(n,p,"xray"):i(n,p,"draw");u&&this.mainFramebuffer.unbind(),this.postProcessPipelineOpaque.length>0&&(a.disable(a.DEPTH_TEST),a.frontFace(a.CCW),a.disable(a.CULL_FACE));for(var _=0,h=this.postProcessPipelineOpaque.length;_<h;++_)(y=this.postProcessPipelineOpaque[_]).framebuffer&&y.framebuffer.bind(),y.draw(n),y.framebuffer&&y.framebuffer.unbind();if(this.postProcessPipelineOpaque.length>0&&(a.enable(a.DEPTH_TEST),a.frontFace(a.CCW),a.disable(a.CULL_FACE),n.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,n.backfaces=SceneJS.PROPERTY_FLAGS.BACKFACES,n.frontface=SceneJS.PROPERTY_FLAGS.CCW,n.addBlend=!1),this._numTransparentObjects>0){if(r("draw"),r("xray"),u&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.bind(),this.depthSort&&this._transparentObjects.sort(f),n.discardOpaque=!0,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_BLEND){var d=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK);a.enable(a.BLEND),this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA?a.blendFunc(a.ONE,a.ONE):a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);var m=SceneJS.PROPERTY_FLAGS.NO_DEPTH_MASK;for(d&&a.depthMask(!1),_=0;_<this._numTransparentObjects;_++){var p=this._transparentObjects[_],g=!d&&p.properties.flags&m;g&&a.depthMask(!1),p.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?i(n,p,"xray"):i(n,p,"draw"),g&&a.depthMask(!0)}a.disable(a.BLEND),a.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT){for(r("depth"),t[0]=1/n.canvasResolution[0],t[1]=1/n.canvasResolution[1],this.oitDepthBuffer.bind(),a.clear(a.DEPTH_BUFFER_BIT),a.colorMask(!1,!1,!1,!1),_=0;_<this._numTransparentObjects;_++)i(n,this._transparentObjects[_],"depth");for(a.colorMask(!0,!0,!0,!0),this.oitDepthBuffer.unbind(),a.clearColor(0,0,0,1),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),this.oitAccumulateFramebuffer.bind(),a.clear(a.COLOR_BUFFER_BIT),n.outputFormat=1,n.depthBuffer=this.oitDepthBuffer.getDepthTarget(),_=0;_<this._numTransparentObjects;_++)(p=this._transparentObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?i(n,p,"xray"):i(n,p,"draw");this.oitAccumulateFramebuffer.unbind(),a.disable(a.DEPTH_TEST),a.frontFace(a.CCW),a.disable(a.CULL_FACE),this.mainFramebuffer.bind(),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),this.oitPostprocess.setUniform("uTexelOffset",t),this.oitPostprocess.draw(n),this.mainFramebuffer.unbind(),a.disable(a.BLEND),a.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE){for(a.enable(a.SAMPLE_ALPHA_TO_COVERAGE),_=0;_<this._numTransparentObjects;_++)(p=this._transparentObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?i(n,p,"xray"):i(n,p,"draw");a.disable(a.SAMPLE_ALPHA_TO_COVERAGE)}u&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.unbind()}if(u)if(a.disable(a.DEPTH_TEST),a.frontFace(a.CCW),a.disable(a.CULL_FACE),this.postProcessPipelineFinal.length>0)for(_=0,h=this.postProcessPipelineFinal.length;_<h;++_){var y;(y=this.postProcessPipelineFinal[_]).framebuffer&&y.framebuffer.bind(),y.draw(n),y.framebuffer&&y.framebuffer.unbind()}else this.blitPostprocess.draw(n);Date.now(),this.stats.frame.drawElements=n.drawElements,this.stats.frame.drawArrays=n.drawArrays,this.stats.frame.useProgram=n.useProgram,this.stats.frame.bindTexture=n.bindTexture,this.stats.frame.bindArray=n.bindArray,this.stats.frame.drawChunks=this._drawListLen}if(n.VAO)for(n.VAO.bindVertexArrayOES(null),_=0;_<10;_++)a.disableVertexAttribArray(_)}}(),u.prototype.readPixels=function(e,t,r){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var i,a;this._readPixelBuf||(this._readPixelBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas})),this._readPixelBuf.bind(),this._readPixelBuf.clear(),this.prepareScene(),this.render({force:!0,opaqueOnly:r});for(var n=0;n<t;n++)i=e[n]||(e[n]={}),a=this._readPixelBuf.read(i.x,i.y),i.r=a[0],i.g=a[1],i.b=a[2],i.a=a[3];this._readPixelBuf.unbind()}},u.prototype.destroy=function(){this._programFactory.destroy()}}(),function(){"use strict";var e=SceneJS.DISPLAY_FLAGS,t=SceneJS.TEXTURE_FLAGS,r=SceneJS.CUBEMAP_FLAGS,i=SceneJS.PROPERTY_FLAGS,a=SceneJS.COLOR_MOD_FLAGS,n="highp"===SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION,o=SceneJS.WEBGL_INFO.textureLODSupported;window.SceneJS_ProgramSourceFactory=new function(){var s,l,c,u,_,h,f,d,m,p,g,y,v,S,E,b,I,x,C,T,N,D,A,P,M,w,R,F,L,O,H,J,B,k,U,V,j,G,z,X,Y,W,q={},Q=Math.floor(SceneJS.WEBGL_INFO.MAX_POINT_SIZE).toFixed(1),K="";function Z(e){return se(),le("attribute vec4 SCENEJS_aVertex;"),e&&(le("attribute vec4 SCENEJS_aTriColor;"),le("varying vec4 SCENEJS_vTriColor;")),le("uniform mat4 SCENEJS_uMMatrix;"),le("uniform mat4 SCENEJS_uVMatrix;"),le("uniform mat4 SCENEJS_uPMatrix;"),N&&(le("uniform float SCENEJS_uPointSize;"),P&&le("attribute vec2 SCENEJS_aPointScaleRotation;")),w&&le("uniform mat4 SCENEJS_uDecodePositionMatrix;"),le("varying vec4 SCENEJS_vWorldVertex;"),C&&(le("attribute vec2 SCENEJS_aRegionMapUV;"),le("varying vec2 SCENEJS_vRegionMapUV;")),x&&(le("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&le("attribute vec4 SCENEJS_aMorphVertex;"),w&&le("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),le("void main(void) {"),le(w?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),x&&s.morphGeometry.targets[0].vertexBuf&&le(w?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),le("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),le("mat4 vPosMatrix = SCENEJS_uVMatrix;"),v&&le("vPosMatrix[3].xyz = vec3(0.0);"),le("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),le("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),C&&le("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),e&&le("SCENEJS_vTriColor = SCENEJS_aTriColor;"),N&&(le("gl_PointSize = SCENEJS_uPointSize;"),A&&le("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&le("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),le("gl_PointSize = min(gl_PointSize, "+Q+");")),le("}"),ce()}function $(e){if(se(),le("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),le("varying vec4 SCENEJS_vWorldVertex;"),e?le("varying vec4  SCENEJS_vTriColor;"):(le("uniform float  SCENEJS_uPickMode;"),le("uniform vec4  SCENEJS_uPickColor;")),I)for(var t=0;t<s.clips.clips.length;t++)le("uniform vec4  SCENEJS_uClipNormalAndDist"+t+";"),s.clips.clips[t].fade&&le("uniform float SCENEJS_uClipFadeDistance"+t+";");if(C&&(le("varying vec2 SCENEJS_vRegionMapUV;"),le("uniform sampler2D SCENEJS_uRegionMapSampler;")),le("void main(void) {"),I){for(s.clips.clipDiscard&&le("float distOff = 0.0;"),s.clips.clipFade&&le("float distAlpha = 0.0;"),t=0;t<s.clips.clips.length;t++)le(s.clips.clips[t].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w) / SCENEJS_uClipFadeDistance"+t+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w);");s.clips.clipDiscard&&le("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&le("if (distAlpha > 1.0) { discard; }")}return e?le("gl_FragColor = SCENEJS_vTriColor;  "):(le("    if  (SCENEJS_uPickMode == 0.0) {"),le("          gl_FragColor = SCENEJS_uPickColor;  "),le("    } else {"),le(C?"          gl_FragColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t));":"          gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"),le("    }")),le("}"),ce()}function ee(){se(),le("attribute vec4 SCENEJS_aVertex;"),le("uniform mat4 SCENEJS_uMMatrix;"),le("uniform mat4 SCENEJS_uVMatrix;"),le("uniform mat4 SCENEJS_uPMatrix;"),w&&le("uniform mat4 SCENEJS_uDecodePositionMatrix;");var e=0,t=null,r=null;return h&&((r=s.texture.layers[s.texture.drawLayerIndex])&&(e=r.uvLayerIdx||0),s.geometry.uvBufs&&(t=s.geometry.uvBufs[e]),t&&(le("varying vec2 SCENEJS_vUVCoord"+e+";"),le("attribute vec2 SCENEJS_aUVCoord"+e+";"),F&&le("uniform mat3 SCENEJS_uDecodeUVMatrix"+e+";"))),le("varying vec4 SCENEJS_vWorldVertex;"),x&&(le("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&le("attribute vec4 SCENEJS_aMorphVertex;"),w&&le("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),le("void main(void) {"),le(w?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),x&&s.morphGeometry.targets[0].vertexBuf&&le(w?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),le("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),le("mat4 vPosMatrix = SCENEJS_uVMatrix;"),le("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),le("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),h&&t&&le(F?"SCENEJS_vUVCoord"+e+" = (SCENEJS_uDecodeUVMatrix"+e+" * vec3(SCENEJS_aUVCoord"+e+", 1.0)).xy;":"SCENEJS_vUVCoord"+e+" = SCENEJS_aUVCoord"+e+";"),le("}"),ce()}function te(){se(),le("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;");var e=0,t=null,r=null;return h&&((r=s.texture.layers[s.texture.drawLayerIndex])&&(e=r.uvLayerIdx||0),s.geometry.uvBufs&&(t=s.geometry.uvBufs[e]),t&&(le("uniform sampler2D SCENEJS_uDrawSampler;"),le("varying vec2 SCENEJS_vUVCoord"+e+";"))),le("void main(void) {"),le("vec4 color = vec4(0.0);"),h&&t&&r&&(le("vec2 textureCoord;"),le("textureCoord = SCENEJS_vUVCoord"+e+";"),r.compressed&&le("   textureCoord.y = 1.0 - textureCoord.y;"),le("if(textureCoord.x != -1.0) {"),le("   color = texture2D(SCENEJS_uDrawSampler, textureCoord);"),le("}")),le("gl_FragColor = color;"),le("}"),ce()}function re(){return"points"===s.geometry.primitiveName||!!s.geometry.uvBufs||!(!s.morphGeometry.targets||!s.morphGeometry.targets[0].uvBuf&&!s.morphGeometry.targets[0].uvBuf2)}function ie(){var e;if(se(),le("uniform mat4 SCENEJS_uMMatrix;"),le(n?"uniform mat4 SCENEJS_uVMatrix;":"uniform mediump mat4 SCENEJS_uVMatrix;"),le("uniform mat4 SCENEJS_uPMatrix;"),le("attribute vec4 SCENEJS_aVertex;"),le(n?"uniform vec3 SCENEJS_uWorldEye;":"uniform mediump vec3 SCENEJS_uWorldEye;"),le("varying vec3 SCENEJS_vViewEyeVec;"),N&&(le("uniform float SCENEJS_uPointSize;"),P&&(le("attribute vec2 SCENEJS_aPointScaleRotation;"),le("varying float SCENEJS_vPointRotation;")),M&&(le("attribute vec2 SCENEJS_aPointUVTranslate;"),le("varying vec2 SCENEJS_vPointUVTranslate;"))),w&&le("uniform mat4 SCENEJS_uDecodePositionMatrix;"),g&&(le("attribute vec3 SCENEJS_aNormal;"),le("uniform   mat4 SCENEJS_uMNMatrix;"),le("varying   vec3 SCENEJS_vViewNormal;"),(f||d||m||p)&&le("varying   vec3 SCENEJS_vWorldNormal;"),E&&!b&&(le("attribute vec3 SCENEJS_aTangent;"),le("varying   vec3 SCENEJS_vTangent;"))),h&&(e=s.geometry.uvBufs))for(var t=0,r=e.length;t<r;t++)e[t]&&(le("attribute vec2 SCENEJS_aUVCoord"+t+";"),F&&le("uniform mat3 SCENEJS_uDecodeUVMatrix"+t+";"));if(s.geometry.colorBuf&&(le("attribute vec4 SCENEJS_aVertexColor;"),le("varying vec4 SCENEJS_vColor;")),(I||g||H||j)&&le("varying vec4 SCENEJS_vWorldVertex;"),X&&le("varying vec4 SceneJS_vModelVertex;"),le("varying vec4 SCENEJS_vViewVertex;"),h&&(e=s.geometry.uvBufs))for(t=0,r=e.length;t<r;t++)e[t]&&le("varying vec2 SCENEJS_vUVCoord"+t+";");if(T&&(le("attribute vec2 SCENEJS_aRegionMapUV;"),le("varying vec2 SCENEJS_vRegionMapUV;")),x&&(le("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&le("attribute vec4 SCENEJS_aMorphVertex;"),g&&s.morphGeometry.targets[0].normalBuf&&le("attribute vec3 SCENEJS_aMorphNormal;"),E&&!b&&le("attribute vec3 SCENEJS_aMorphTangent;"),w&&le("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),S&&(le("void billboard(inout mat4 mat) {"),le("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),le("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),le("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),le("}")),R&&(le("vec3 octDecode(vec2 oct) {"),le("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),le("    if (v.z < 0.0) {"),le("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),le("    }"),le("    return normalize(v);"),le("}")),le("void main(void) {"),E&&!b&&le("vec3 modelTangent = SCENEJS_aTangent;"),le(w?"  vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"  vec4 modelVertex = SCENEJS_aVertex; "),R?le("  vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):g&&le("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),x&&(s.morphGeometry.targets[0].vertexBuf&&le(w?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),g&&s.morphGeometry.targets[0].normalBuf&&le(R?"  modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"  modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); "),E&&!b&&le("  modelTangent = mix(modelTangent, SCENEJS_aMorphTangent, SCENEJS_uMorphFactor); ")),X&&le("SceneJS_vModelVertex = modelVertex;;"),le("mat4 modelMatrix = SCENEJS_uMMatrix;"),le("mat4 viewMatrix = SCENEJS_uVMatrix;"),g&&le("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),le("vec4 worldVertex;"),le("vec4 viewVertex;"),v&&le("viewMatrix[3].xyz = vec3(0.0);"),S?(le("   mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),le("   billboard(modelMatrix);"),le("   billboard(viewMatrix);"),le("   billboard(modelViewMatrix);"),g&&le("   billboard(modelNormalMatrix);"),le("   worldVertex = modelMatrix * modelVertex;"),le("   viewVertex = modelViewMatrix * modelVertex;")):(le("  worldVertex = modelMatrix * modelVertex;"),le("  viewVertex  = viewMatrix * worldVertex; ")),g&&(le("  vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),le("  SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;"),(f||d||m||p)&&le("SCENEJS_vWorldNormal = worldNormal;")),(I||g||H||j)&&le("  SCENEJS_vWorldVertex = worldVertex;"),le("  SCENEJS_vViewVertex = viewVertex;"),le("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),E&&!b&&le("SCENEJS_vTangent = modelTangent;"),le("SCENEJS_vViewEyeVec = ((viewMatrix * vec4(SCENEJS_uWorldEye, 1.0)).xyz  - viewVertex.xyz);"),h&&(e=s.geometry.uvBufs))for(t=0,r=e.length;t<r;t++)e[t]&&le(F?"SCENEJS_vUVCoord"+t+" = (SCENEJS_uDecodeUVMatrix"+t+" * vec3(SCENEJS_aUVCoord"+t+", 1.0)).xy;":"SCENEJS_vUVCoord"+t+" = SCENEJS_aUVCoord"+t+";");return s.geometry.colorBuf&&le("SCENEJS_vColor = SCENEJS_aVertexColor;"),T&&le("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),N&&(le("gl_PointSize = SCENEJS_uPointSize;"),A&&le("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&(le("SCENEJS_vPointRotation = SCENEJS_aPointScaleRotation.y;"),le("gl_PointSize *= SCENEJS_aPointScaleRotation.x;")),M&&le("SCENEJS_vPointUVTranslate = SCENEJS_aPointUVTranslate;"),le("gl_PointSize = min(gl_PointSize, "+Q+");")),le("}"),ce()}function ae(){var r=s.fresnel.diffuse,i=s.fresnel.specular,n=s.fresnel.alpha,l=s.fresnel.transparency,v=s.fresnel.reflect,S=s.fresnel.emit,x=s.fresnel.fragment,C=u;if(se(),(E&&b||X)&&le("#extension GL_OES_standard_derivatives : enable"),o&&le("#extension GL_EXT_shader_texture_lod : enable"),Y&&le(Y),le("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),le("uniform sampler2D SCENEJS_uDepthBuffer;"),le("uniform vec2 SCENEJS_uCanvasRes;"),(u||_)&&(le("vec4 sRGBToLinear( in vec4 value ) {"),le("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),le("}")),z&&le("uniform bool SCENEJS_uDiscardOpaque;"),X&&(le("float hash(vec2 v) {"),le("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),le("}"),le("float hash3D(vec3 v) {"),le("    return hash(vec2(hash(v.xy), v.z));"),le("}")),u&&(le("#define PI 3.14159265359"),le("#define RECIPROCAL_PI 0.31830988618"),le("#define RECIPROCAL_PI2 0.15915494"),le("#define EPSILON 1e-6"),le("#define saturate(a) clamp( a, 0.0, 1.0 )"),le("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),le("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),le("}"),le("struct IncidentLight {"),le("   vec3 color;"),le("   vec3 direction;"),le("};"),le("struct ReflectedLight {"),le("   vec3 diffuse;"),le("   vec3 specular;"),le("};"),le("struct Geometry {"),le("   vec3 position;"),le("   vec3 viewNormal;"),le("   vec3 worldNormal;"),le("   vec3 viewEyeDir;"),le("};"),le("struct Material {"),le("   vec3    diffuseColor;"),le("   float   specularRoughness;"),le("   vec3    specularColor;"),le("   float   shine;"),le("};"),p&&(le("void computePBRLightMapping(const in samplerCube lightMap, const in float intensity, const in vec3 normal, const in Material material, inout ReflectedLight reflectedLight) {"),le("   reflectedLight.diffuse += (sRGBToLinear(textureCube(lightMap, normal)).rgb * PI) * (RECIPROCAL_PI * material.diffuseColor) * intensity;"),le("}")),m&&(le("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),le("   float r = ggxRoughness + 0.0001;"),le("   return (2.0 / (r * r) - 2.0);"),le("}"),le("float getSpecularMIPLevel(const in float blinnShininessExponent, float maxMipLevels) {"),le("   float desiredMIPLevel = maxMipLevels - 0.79248 - 0.5 * log2( (blinnShininessExponent * blinnShininessExponent) + 1.0 );"),le("   return clamp( desiredMIPLevel, 0.0, maxMipLevels );"),le("}"),le("vec3 getLightProbeIndirectRadiance(const in samplerCube reflectMap, const in vec3 reflectVec, const in float blinnShininessExponent, float maxMipLevels) {"),le("   float mipLevel = getSpecularMIPLevel(blinnShininessExponent, maxMipLevels);"),le(o?"   vec3 envMapColor = sRGBToLinear(textureCubeLodEXT(reflectMap, reflectVec, mipLevel)).rgb;":"   vec3 envMapColor = sRGBToLinear(textureCube(reflectMap, reflectVec, mipLevel)).rgb;"),le("   return envMapColor;"),le("}"),le("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),le("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),le("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),le("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),le("   vec4 r = roughness * c0 + c1;"),le("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),le("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),le("   return specularColor * AB.x + AB.y;"),le("}"),le("void computePBRReflectionMapping(const in samplerCube reflectMap, const in float intensity, const in mat4 viewMatrix, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight, float maxMipLevel) {"),le("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),le("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),le("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),le("   vec3 radiance               = getLightProbeIndirectRadiance(reflectMap, reflectVec, blinnExpFromRoughness, maxMipLevel);"),le("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),le("   reflectedLight.specular     += radiance * specularBRDFContrib * intensity;"),le("}")),le("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),le("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),le("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),le("}"),le("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),le("   float a2 = alpha * alpha;"),le("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),le("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),le("   return 1.0 / ( gl * gv );"),le("}"),le("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),le("   float a2 = ( alpha * alpha );"),le("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),le("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),le("   return 0.5 / max( gv + gl, EPSILON );"),le("}"),le("float D_GGX(const in float alpha, const in float dotNH) {"),le("   float a2 = ( alpha * alpha );"),le("   float denom = ( dotNH * dotNH ) * ( a2 - 1.0 ) + 1.0;"),le("   return RECIPROCAL_PI * a2 / ( denom * denom );"),le("}"),le("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),le("   float alpha = ( roughness * roughness );"),le("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),le("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),le("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),le("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),le("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),le("   vec3  F = F_Schlick( specularColor, dotLH );"),le("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),le("   float D = D_GGX( alpha, dotNH );"),le("   return F * (G * D);"),le("}"),le("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),le("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),le("   vec3 irradiance = dotNL * incidentLight.color * PI;"),le("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),le("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),le("}")),(I||g||H||j)&&le("varying vec4 SCENEJS_vWorldVertex;"),X&&le("varying vec4 SceneJS_vModelVertex;"),le("varying vec4 SCENEJS_vViewVertex;"),s.geometry.colorBuf&&le("varying vec4 SCENEJS_vColor;"),h&&(E&&(b?(le("vec3 perturbNormal2Arb( sampler2D sampler, vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),le("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),le("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),le("      vec2 st0 = dFdx( uv.st );"),le("      vec2 st1 = dFdy( uv.st );"),le("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),le("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),le("      vec3 N = normalize( surf_norm );"),le("      vec3 mapN = texture2D( sampler, uv ).xyz * 2.0 - 1.0;"),le("      mat3 tsn = mat3( S, T, N );"),le("      return normalize( tsn * mapN );"),le("}")):le("varying vec3 SCENEJS_vTangent;")),he=s.geometry.uvBufs))for(var A=0,w=he.length;A<w;A++)he[A]&&le("varying vec2 SCENEJS_vUVCoord"+A+";");if(le("uniform mat4 SCENEJS_uVMatrix;"),le("uniform mat4 SCENEJS_uMMatrix;"),le("uniform vec3 SCENEJS_uWorldEye;"),le("varying vec3 SCENEJS_vViewEyeVec;"),le("uniform vec4  SCENEJS_uMaterialColor;"),le("uniform vec4  SCENEJS_uMaterialEmitColor;"),h)for(A=0,w=s.texture.layers.length;A<w;A++){var R=s.texture.layers[A];le("uniform sampler2D SCENEJS_uSampler"+A+";"),R.matrix&&le("uniform mat4 SCENEJS_uLayer"+A+"Matrix;"),le("uniform float SCENEJS_uLayer"+A+"BlendFactor;")}if((r||i||n||l||S||x||v||k||U||V)&&(K.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),K.push("    float fr = abs(dot(eyeDir, normal));"),K.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),K.push("    return pow(finalFr, power);"),K.push("}"),r&&(le("uniform vec4 SCENEJS_uDiffuseFresnelCenterColor;"),le("uniform vec4 SCENEJS_uDiffuseFresnelEdgeColor;"),le("uniform float SCENEJS_uDiffuseFresnelPower;")),i&&(le("uniform vec4 SCENEJS_uSpecularFresnelCenterColor;"),le("uniform vec4 SCENEJS_uSpecularFresnelEdgeColor;"),le("uniform float SCENEJS_uSpecularFresnelPower;")),n&&(le("uniform vec4 SCENEJS_uAlphaFresnelCenterColor;"),le("uniform vec4 SCENEJS_uAlphaFresnelEdgeColor;"),le("uniform float SCENEJS_uAlphaFresnelPower;")),l&&(le("uniform vec4 SCENEJS_uTransparencyFresnelCenterColor;"),le("uniform vec4 SCENEJS_uTransparencyFresnelEdgeColor;"),le("uniform float SCENEJS_uTransparencyFresnelPower;")),v&&(le("uniform vec4 SCENEJS_uReflectFresnelCenterColor;"),le("uniform vec4 SCENEJS_uReflectFresnelEdgeColor;"),le("uniform float SCENEJS_uReflectFresnelPower;")),S&&(le("uniform vec4 SCENEJS_uEmitFresnelCenterColor;"),le("uniform vec4 SCENEJS_uEmitFresnelEdgeColor;"),le("uniform float SCENEJS_uEmitFresnelPower;")),x&&(le("uniform vec4 SCENEJS_uFragmentFresnelCenterColor;"),le("uniform vec4 SCENEJS_uFragmentFresnelEdgeColor;"),le("uniform float SCENEJS_uFragmentFresnelPower;"))),c&&(le("uniform vec3  SCENEJS_uAmbientColor;"),le("uniform vec4  SCENEJS_uMaterialSpecularColor;"),le("uniform float SCENEJS_uMaterialShine;")),u&&le("uniform vec4 SCENEJS_uMetalRoughSpecularf0;"),g){if(le("uniform vec2  SCENEJS_uXrayParams;"),f||d)for(A=0,w=s.cubemap.layers.length;A<w;A++)R=s.cubemap.layers[A],le("uniform samplerCube SCENEJS_uCubeMapSampler"+A+";"),le("uniform float SCENEJS_uCubeMapIntensity"+A+";"),le("uniform float SCENEJS_uCubeMapMipLevels"+A+";");for(m&&(le("uniform samplerCube SCENEJS_uPBRReflectionMapSampler;"),le("uniform float SCENEJS_uPBRReflectionMapIntensity;"),le("uniform float SCENEJS_uPBRReflectionMapMipLevels;")),p&&(le("uniform samplerCube SCENEJS_uPBRLightMapSampler;"),le("uniform float SCENEJS_uPBRLightMapIntensity;"),le("uniform float SCENEJS_uPBRLightMapMipLevels;")),le("varying vec3 SCENEJS_vViewNormal;"),(f||d||m||p)&&le("varying vec3 SCENEJS_vWorldNormal;"),A=0;A<s.lights.length;A++){var F=s.lights[A];le("uniform vec3  SCENEJS_uLightColor"+A+";"),"dir"==F.mode&&le("uniform vec3 SCENEJS_uLightDir"+A+";"),"point"==F.mode&&(le("uniform vec3  SCENEJS_uLightAttenuation"+A+";"),le("uniform vec3 SCENEJS_uLightPos"+A+";")),"spot"==F.mode&&(le("uniform vec3  SCENEJS_uLightAttenuation"+A+";"),le("uniform vec3 SCENEJS_uLightPos"+A+";"),le("uniform vec3 SCENEJS_uLightDir"+A+";"),le("uniform float SCENEJS_uInnerCone"+A+";"),le("uniform float SCENEJS_uOuterCone"+A+";"))}}if(J){var q=0,Q=s.properties.colorModifiers;for(w=Q.length,q=0;q<w;q++)(ye=Q[q]).value.isColorFresnel||ye.value.isScalarFresnel?(le("uniform vec4 SCENEJS_uColorModFresnelEdge"+q+";"),le("uniform vec4 SCENEJS_uColorModFresnelCenter"+q+";"),le("uniform float SCENEJS_uColorModFresnelPower"+q+";")):le(ye.applyTo===a.TINT?"uniform vec3 SCENEJS_uColorModification"+q+";":"uniform float SCENEJS_uColorModification"+q+";"),ye.range&&(le("uniform vec3 SCENEJS_uColorModCenter"+q+";"),le("uniform vec2 SCENEJS_uColorModRadius"+q+";"))}if(G){var Z,$=0;for(w=(me=s.properties.opacityModifiers).length,$=0;$<w;$++)(Z=me[$]).value.isScalarFresnel?(le("uniform vec4 SCENEJS_uOpacityModFresnelEdge"+$+";"),le("uniform vec4 SCENEJS_uOpacityModFresnelCenter"+$+";"),le("uniform float SCENEJS_uOpacityModFresnelPower"+$+";")):le("uniform float SCENEJS_uOpacityModification"+$+";"),Z.range&&(le("uniform vec3 SCENEJS_uOpacityModCenter"+$+";"),le("uniform vec2 SCENEJS_uOpacityModRadius"+$+";"))}if(L&&(le("uniform vec4   SCENEJS_uFogParams;"),le("uniform vec4   SCENEJS_uFogColor;")),T&&(le("varying vec2 SCENEJS_vRegionMapUV;"),le("uniform sampler2D SCENEJS_uRegionMapSampler;"),le("uniform vec3 SCENEJS_uRegionMapRegionColor;"),le("uniform vec3 SCENEJS_uRegionMapHighlightFactor;"),le("uniform float SCENEJS_uRegionMapHideAlpha;")),I)for(y&&le("uniform vec3  SCENEJS_uSolidColor;"),A=0;A<s.clips.clips.length;A++)le("uniform vec4  SCENEJS_uClipNormalAndDist"+A+";"),s.clips.clips[A].fade&&le("uniform float SCENEJS_uClipFadeDistance"+A+";");if(le("uniform float SCENEJS_uOutputFormat;"),le("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),N&&(P&&le("varying float SCENEJS_vPointRotation;"),M&&(le("uniform vec2 SCENEJS_uPointUVScale;"),le("varying vec2 SCENEJS_vPointUVTranslate;"))),C&&(K.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),K.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),K.push("}")),le("void main(void) {"),I){for(s.clips.clipDiscard&&le("float distOff = 0.0;"),s.clips.clipFade&&le("float distAlpha = 0.0;"),A=0;A<s.clips.clips.length;A++)le(s.clips.clips[A].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+A+".xyz) + SCENEJS_uClipNormalAndDist"+A+".w) / SCENEJS_uClipFadeDistance"+A+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+A+".xyz) + SCENEJS_uClipNormalAndDist"+A+".w);");s.clips.clipDiscard&&le("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&le("if (distAlpha > 1.0) { discard; }"),y&&(le("if (gl_FrontFacing == false) {"),le("   gl_FragColor = vec4(SCENEJS_uSolidColor, 1.0);"),le("   return;"),le("}"))}if(N&&D&&(le("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),le("float r = dot(cxy, cxy);"),le("if (r > 1.0) {"),le("   discard;"),le("}")),g&&le("vec3 worldEyeVec = normalize(SCENEJS_uWorldEye - SCENEJS_vWorldVertex.xyz);"),s.geometry.colorBuf?(le("  vec3  color   = SCENEJS_vColor.rgb;"),le("  float colorAlpha  = SCENEJS_vColor.a;")):le("  vec3  color   = SCENEJS_uMaterialColor.rgb;"),le("  float alpha = SCENEJS_uMaterialColor.a;"),le("  float emit          = SCENEJS_uMaterialEmitColor.a;"),le("  vec3  emitColor     = SCENEJS_uMaterialEmitColor.rgb;"),le("  float occlusion     = 1.0;"),s.geometry.colorBuf&&le("alpha *= colorAlpha;"),le("float transparency  = 1.0 - alpha;"),c&&(le("  vec3  ambientColor  = SCENEJS_uAmbientColor;"),le("  float specular      = SCENEJS_uMaterialSpecularColor.a;"),le("  vec3  specularColor = SCENEJS_uMaterialSpecularColor.rgb;"),le("  float shine         = SCENEJS_uMaterialShine;")),u&&(le("  vec3  ambientColor  = vec3(0.2, 0.2, 0.2);"),le("  float metallic      = SCENEJS_uMetalRoughSpecularf0.r;"),le("  float roughness     = SCENEJS_uMetalRoughSpecularf0.g;"),le("  float specularF0    = SCENEJS_uMetalRoughSpecularf0.b;")),g&&(le("float attenuation = 1.0;"),le(E?"vec3 viewNormalVec = vec3(0.0, 0.0, 0.0);":"vec3 viewNormalVec = normalize(SCENEJS_vViewNormal);"),le("vec3 viewEyeVec = normalize(SCENEJS_vViewEyeVec);"),le("  float glassfactor = SCENEJS_uXrayParams.x;"),le("  float murkiness = SCENEJS_uXrayParams.y;"),le("if (transparency > 0.0) {"),le("  alpha = 1.0 - transparency;"),le("  float gf = (glassfactor  * (murkiness - abs(dot(SCENEJS_vViewNormal, vec3(0.0, 0.0, -1.0)))));"),le("  alpha = max(alpha, gf);"),le("  transparency = 1.0 - alpha;"),le("}")),g&&E&&!b&&(le("mat3 mat =  mat3(SCENEJS_uVMatrix * SCENEJS_uMMatrix);"),le("vec3 n = normalize(SCENEJS_vViewNormal);"),le("vec3 t = normalize(mat * SCENEJS_vTangent);"),le("vec3 b = normalize(cross(SCENEJS_vViewNormal, mat * SCENEJS_vTangent));"),le("mat3 TBN = mat3(t, b, n);")),h){le("vec2 textureCoord;");var ee=!0,te=!0,re=!0,ie=!0,ae=!0,ne=!0,oe=!0,ue=!0,_e=!0;for(N&&(le("vec2 pointCoord = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);"),le("vec2 centerCoord = vec2(0.5);"),M&&(le("centerCoord = SCENEJS_vPointUVTranslate + SCENEJS_uPointUVScale * 0.5;"),le("pointCoord = pointCoord * SCENEJS_uPointUVScale + SCENEJS_vPointUVTranslate;")),P&&(le("vec2 pivot = pointCoord - centerCoord;"),le("float c = cos(SCENEJS_vPointRotation);"),le("float s = sin(SCENEJS_vPointRotation);"),le("pointCoord.x = c * pivot.x + s * pivot.y + centerCoord.x;"),le("pointCoord.y = c * pivot.y - s * pivot.x + centerCoord.y;"))),A=0,w=s.texture.layers.length;A<w;A++){var he,fe,de=(R=s.texture.layers[A]).uvLayerIdx||0;if((he=s.geometry.uvBufs)&&he[de])le("textureCoord = SCENEJS_vUVCoord"+de+";");else{if(!N){SceneJS.log.warn("Texture layer applyTo='uv' but geometry has no UV coordinates for layer "+de);continue}le("textureCoord = pointCoord;")}R.matrix&&le("textureCoord=(SCENEJS_uLayer"+A+"Matrix * vec4(textureCoord, 1.0, 1.0)).xy;"),R.compressed&&le("textureCoord.y = 1.0 - textureCoord.y;"),R.flags&t.alpha&&(ee?(le("transparency = mix(transparency, 1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),ee=!1):R.flags&t.multiply?(le("alpha = 1.0 - transparency;"),le("alpha *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"),le("transparency = 1.0 - alpha;")):R.flags&t.add?(le("alpha = 1.0 - transparency;"),le("alpha += SCENEJS_uLayer"+A+"BlendFactor * (texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"),le("transparency = 1.0 - alpha;")):R.flags&t.over&&(le("alpha = 1.0 - transparency;"),le("alpha = mix(alpha, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),le("transparency = 1.0 - alpha;"))),R.flags&t.transparency&&(ee?(le("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),ee=!1):R.flags&t.multiply?le("transparency *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("transparency += SCENEJS_uLayer"+A+"BlendFactor * (texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.over&&le("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.occlusion&&(re?(le("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),re=!1):R.flags&t.multiply?le("occlusion *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("occlusion += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).r;"):R.flags&t.over&&le("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);")),c&&(_?(R.flags&t.baseColor&&(te?(le("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),te=!1):R.flags&t.multiply?le("color *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb);"):R.flags&t.add?le("color += SCENEJS_uLayer"+A+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb;"):R.flags&t.over&&le("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.emit&&(ie?(le("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),ie=!1):R.flags&t.multiply?le("emitColor *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb);"):R.flags&t.add?le("emitColor += SCENEJS_uLayer"+A+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb;"):R.flags&t.over&&le("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);"))):(R.flags&t.baseColor&&(te?(R.flags&t.conditionalAlpha?(le("if(textureCoord.x != -1.0) {"),le("   vec4 color"+A+" = texture2D(SCENEJS_uSampler"+A+", textureCoord);"),le("   color = mix(color, color"+A+".rgb, color"+A+".a * SCENEJS_uLayer"+A+"BlendFactor);"),le("}")):le("color = mix(color, texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),te=!1):R.flags&t.multiply?le("color *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb);"):R.flags&t.add?le("color += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb;"):R.flags&t.over?le("color = mix(color, texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb, SCENEJS_uLayer"+A+"BlendFactor);"):R.flags&t.conditionalAlpha&&(le("if(textureCoord.x != -1.0) {"),le("vec4 color"+A+" = texture2D(SCENEJS_uSampler"+A+", textureCoord);"),le("color = mix(color, color"+A+".rgb, color"+A+".a * SCENEJS_uLayer"+A+"BlendFactor);"),le("}"))),R.flags&t.emit&&(ie?(le("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),ie=!1):R.flags&t.multiply?le("emitColor *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb);"):R.flags&t.add?le("emitColor += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb;"):R.flags&t.over&&le("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+A+", textureCoord).rgb, SCENEJS_uLayer"+A+"BlendFactor);"))),R.flags&t.specular&&g&&(ae?(le("specular = mix(specular, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),ae=!1):R.flags&t.multiply?le("specular *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("specular += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).r;"):R.flags&t.over&&le("specular = mix(specular, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.shine&&(ne?(le("shine = mix((shine, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),ne=!1):R.flags&t.multiply?le("shine *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("shine += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).r;"):R.flags&t.over&&le("shine = mix((shine, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"))),u&&(R.flags&t.baseColor&&(te?(le("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),te=!1):R.flags&t.multiply?le("color *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb);"):R.flags&t.add?le("color += SCENEJS_uLayer"+A+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb;"):R.flags&t.over&&le("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.emit&&(ie?(le("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);"),ie=!1):R.flags&t.multiply?le("emitColor *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb);"):R.flags&t.add?le("emitColor += SCENEJS_uLayer"+A+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb;"):R.flags&t.over&&le("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+A+", textureCoord)).rgb, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.metallic&&(oe?(le("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),oe=!1):R.flags&t.multiply?le("metallic *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("metallic += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).r;"):R.flags&t.over&&le("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);")),R.flags&t.roughness&&(ue?(le("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"),ue=!1):R.flags&t.multiply?le("roughness *= 1.0 - SCENEJS_uLayer"+A+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+A+", textureCoord).r);"):R.flags&t.add?le("roughness += SCENEJS_uLayer"+A+"BlendFactor * texture2D(SCENEJS_uSampler"+A+", textureCoord).r;"):R.flags&t.over&&le("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+A+", textureCoord).r, SCENEJS_uLayer"+A+"BlendFactor);"))),R.flags&t.normals&&g&&(R.flags&t.add?(fe=_e?"=":"+=",le(b?"viewNormalVec "+fe+" perturbNormal2Arb( SCENEJS_uSampler"+A+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+A+"BlendFactor;":"viewNormalVec "+fe+" (TBN * normalize(texture2D(SCENEJS_uSampler"+A+", textureCoord).xyz * 2.0 - 1.0)) * SCENEJS_uLayer"+A+"BlendFactor;")):le(b?"viewNormalVec = mix(viewNormalVec, (perturbNormal2Arb(SCENEJS_uSampler"+A+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord).xyz), SCENEJS_uLayer"+A+"BlendFactor);":"viewNormalVec = mix(viewNormalVec, TBN * normalize(texture2D(SCENEJS_uSampler"+A+", textureCoord).xyz * 2.0 - 1.0), SCENEJS_uLayer"+A+"BlendFactor);"),_e=!1)}E&&le("viewNormalVec = normalize(viewNormalVec);")}if(le("vec4 fragColor;"),g){if(le("vec3 viewLightDir;"),c){if(le("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),le("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),le("vec3 viewLightVec;"),le("float dotN;"),le("float spotDirRatio;"),le("float lightDist;"),f)for(le("float reflectFactor = 1.0;"),v&&(le("float reflectFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uReflectFresnelEdgeColor.a,  SCENEJS_uReflectFresnelCenterColor.a, SCENEJS_uReflectFresnelPower);"),v.blendMode&t.multiply?le("reflectFactor *= mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);"):v.blendMode&t.add&&le("reflectFactor += mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);")),le("vec3 envLookup = reflect(-viewEyeVec, viewNormalVec);"),le("vec4 envColor;"),A=0,w=s.cubemap.layers.length;A<w;A++)(R=s.cubemap.layers[A]).applyTo===SceneJS.CUBEMAP_FLAGS.reflect&&(le("envColor = textureCube(SCENEJS_uCubeMapSampler"+A+", envLookup);"),le("color = mix(color, envColor.rgb, reflectFactor * specular * SCENEJS_uCubeMapIntensity"+A+");"));for(A=0,w=s.lights.length;A<w;A++)"ambient"!=(F=s.lights[A]).mode&&("point"==F.mode&&("world"==F.space?(le("viewLightVec = SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz;"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):le("viewLightVec = SCENEJS_uLightPos"+A+".xyz - SCENEJS_vViewVertex.xyz;"),le("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),le("lightDist = length( SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz);"),le("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+A+".x +   SCENEJS_uLightAttenuation"+A+".y * lightDist +   SCENEJS_uLightAttenuation"+A+".z * lightDist * lightDist);"),F.diffuse&&le("      lightValue += dotN * SCENEJS_uLightColor"+A+" * attenuation;"),F.specular&&le("    specularValue += specularColor * SCENEJS_uLightColor"+A+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"spot"==F.mode&&(le("viewLightDir = SCENEJS_uLightDir"+A+";"),"world"==F.space?(le("viewLightVec = SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz;"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),le("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):le("viewLightVec = SCENEJS_uLightPos"+A+".xyz - SCENEJS_vViewVertex.xyz;"),le("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),le("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),le("lightDist = length( SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz);"),le("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+A+".x +   SCENEJS_uLightAttenuation"+A+".y * lightDist +   SCENEJS_uLightAttenuation"+A+".z * lightDist * lightDist);"),le("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+A+") / max(SCENEJS_uOuterCone"+A+" - SCENEJS_uInnerCone"+A+", 0.0001), 0.0, 1.0);"),F.diffuse&&le("      lightValue += dotN * SCENEJS_uLightColor"+A+" * attenuation;"),F.specular&&le("    specularValue += specularColor * SCENEJS_uLightColor"+A+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"dir"==F.mode&&("world"==F.space?(le("viewLightVec = normalize(SCENEJS_uLightDir"+A+");"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):le("viewLightVec = normalize(SCENEJS_uLightDir"+A+");"),le("viewLightVec = -viewLightVec;"),le("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),F.diffuse&&le("lightValue += dotN * SCENEJS_uLightColor"+A+";"),F.specular&&le("specularValue += specularColor * SCENEJS_uLightColor"+A+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine);")));r&&(le("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),r.blendMode&t.multiply?le("color.rgb *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):r.blendMode&t.add&&le("color.rgb += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),i&&(le("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),i.blendMode&t.multiply?le("specularValue.rgb *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):i.blendMode&t.add&&le("specularValue.rgb += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),n&&(le("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),le("alpha = 1.0 - transparency;"),n.blendMode&t.multiply?le("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):n.blendMode&t.add&&le("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),le("transparency = 1.0 -alpha;")),l&&(le("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),l.blendMode&t.multiply?le("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):l.blendMode&t.add&&le("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),S&&(le("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),S.blendMode&t.multiply?le("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):S.blendMode&t.add&&le("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),le("alpha = 1.0 - transparency;"),le("fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambientColor.rgb)) + (emit * emitColor.rgb), alpha);")}if(u){for(le("IncidentLight  light;"),le("Material       material;"),le("Geometry       geometry;"),le("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),le("float dielectricSpecular   = 0.16 * specularF0 * specularF0;"),le("material.diffuseColor      = color * (1.0 - dielectricSpecular) * (1.0 - metallic);"),le("float realRoughness = sqrt(roughness);"),le("material.specularRoughness = clamp(realRoughness, 0.04, 1.0);"),le("material.specularColor     = mix(vec3(dielectricSpecular), color, metallic);"),le("geometry.position = SCENEJS_vViewVertex.xyz;"),d&&le("geometry.worldNormal = normalize(SCENEJS_vWorldNormal);"),le("geometry.viewNormal = viewNormalVec;"),le("geometry.viewEyeDir = -normalize(SCENEJS_vViewVertex.xyz);"),m&&le("computePBRReflectionMapping(SCENEJS_uPBRReflectionMapSampler, SCENEJS_uPBRReflectionMapIntensity, SCENEJS_uVMatrix, geometry, material, reflectedLight, SCENEJS_uPBRReflectionMapMipLevels);"),p&&le("world"===s.lightmaps.activeLightmap.space?"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.worldNormal, material, reflectedLight);":"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.viewNormal, material, reflectedLight);"),le("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),le("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),le("vec3 viewLightVec;"),le("float dotN;"),le("float spotDirRatio;"),le("float lightDist;"),A=0,w=s.lights.length;A<w;A++)"ambient"!=(F=s.lights[A]).mode&&("dir"==F.mode&&("world"==F.space?(le("viewLightVec = normalize(SCENEJS_uLightDir"+A+");"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):le("viewLightVec = normalize(SCENEJS_uLightDir"+A+");"),le("viewLightVec = -viewLightVec;"),le("light.direction = viewLightVec;"),le("light.color = SCENEJS_uLightColor"+A+";"),le("computePBRLighting(light, geometry, material, reflectedLight);")),"point"==F.mode&&("world"==F.space?(le("viewLightVec = SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz;"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):le("viewLightVec = SCENEJS_uLightPos"+A+".xyz - SCENEJS_vViewVertex.xyz;"),le("lightDist = length(viewLightVec);"),le("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+A+".x +   SCENEJS_uLightAttenuation"+A+".y * lightDist +   SCENEJS_uLightAttenuation"+A+".z * lightDist * lightDist);"),le("light.direction = normalize(viewLightVec);"),le("light.color = SCENEJS_uLightColor"+A+" * attenuation;"),le("computePBRLighting(light, geometry, material, reflectedLight);")),"spot"==F.mode&&(le("viewLightDir = SCENEJS_uLightDir"+A+";"),"world"==F.space?(le("viewLightVec = SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz;"),le("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),le("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):le("viewLightVec = SCENEJS_uLightPos"+A+".xyz - SCENEJS_vViewVertex.xyz;"),le("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),le("lightDist = length(SCENEJS_uLightPos"+A+" - SCENEJS_vWorldVertex.xyz);"),le("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+A+".x +   SCENEJS_uLightAttenuation"+A+".y * lightDist +   SCENEJS_uLightAttenuation"+A+".z * lightDist * lightDist);"),le("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+A+") / max(SCENEJS_uOuterCone"+A+" - SCENEJS_uInnerCone"+A+", 0.0001), 0.0, 1.0);"),le("light.direction = normalize(viewLightVec);"),le("light.color = SCENEJS_uLightColor"+A+" * attenuation;"),le("computePBRLighting(light, geometry, material, reflectedLight);")));r&&(le("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),r.blendMode&t.multiply?le("reflectedLight.diffuse *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):r.blendMode&t.add&&le("reflectedLight.diffuse += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),i&&(le("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),i.blendMode&t.multiply?le("reflectedLight.specular *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):i.blendMode&t.add&&le("reflectedLight.specular += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),n&&(le("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),le("alpha = 1.0 - transparency;"),n.blendMode&t.multiply?le("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):n.blendMode&t.add&&le("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),le("transparency = 1.0 - alpha;")),l&&(le("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),l.blendMode&t.multiply?le("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):l.blendMode&t.add&&le("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),S&&(le("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),S.blendMode&t.multiply?le("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):S.blendMode&t.add&&le("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),le("vec3 outgoingLight = (occlusion * reflectedLight.diffuse) + (occlusion * reflectedLight.specular) + (emit * emitColor);"),le("alpha = 1.0 - transparency;"),le("fragColor = vec4(outgoingLight, alpha);")}}else le("alpha = 1.0 - transparency;"),le("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambientColor.rgb), alpha);");if(G){$=0,w=(me=s.properties.opacityModifiers).length;var me,pe=!1,ge=!1;for(le("float opacity;"),$=0;$<w;$++)(Z=me[$]).value.isScalarFresnel?(pe||(le("float opacityModFresnel;"),pe=!0),le("opacityModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uOpacityModFresnelEdge"+$+".a, SCENEJS_uOpacityModFresnelCenter"+$+".a, SCENEJS_uOpacityModFresnelPower"+$+");"),le("opacity = mix(SCENEJS_uOpacityModFresnelEdge"+$+".r, SCENEJS_uOpacityModFresnelCenter"+$+".r, opacityModFresnel);")):le("opacity =  SCENEJS_uOpacityModification"+$+";"),Z.range&&(ge||(le("float opacityModFactor;"),ge=!0),le("opacityModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uOpacityModCenter"+$+") - SCENEJS_uOpacityModRadius"+$+".x) / SCENEJS_uOpacityModRadius"+$+".y, 0.0, 1.0);"),le("opacity = mix(1.0, opacity, opacityModFactor);")),le("fragColor.a *= opacity;")}if(I&&s.clips.clipFade&&le("fragColor.a *= 1.0 - max(distAlpha, 0.0);"),T&&(le("vec3 regionColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t)).rgb;"),le("float tolerance = 0.01;"),le("vec3 colorDelta = abs(SCENEJS_uRegionMapRegionColor - regionColor);"),"highlight"===s.regionMap.mode||"hide"===s.regionMap.mode?(le("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) < tolerance) {"),le("highlight"===s.regionMap.mode?"  fragColor.rgb *= SCENEJS_uRegionMapHighlightFactor;":"  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),le("}")):(le("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) > tolerance) {"),le("  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),le("}"))),z&&(le("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),le("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),X&&(le("{"),le("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),le("    float pixScale = 1.0 / maxDeriv;"),le("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),le("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),le("    float lerpFactor = fract(log2(pixScale));"),le("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),le("    float a = min(lerpFactor, 1.0 - lerpFactor);"),le("    vec3 cases = vec3("),le("        x * x / (2.0 * a * (1.0 - a)), "),le("        (x - 0.5 * a)/(1.0 - a), "),le("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),le("    );"),le("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),le("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),le("    if (fragColor.a < aThresh) {"),le("        discard;"),le("    } else {"),le("        fragColor.a = 1.0;"),le("    }"),le("}")),B.length>0){le("float colorModFresnel;"),le("float saturation;"),le("float contrast;"),le("float brightness;"),le("float colorModFactor;"),le("vec3 tintColor;");var ye,ve=!1;for(q=0,w=B.length,q=0;q<w;q++)(ye=B[q]).range&&le("colorModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uColorModCenter"+q+") - SCENEJS_uColorModRadius"+q+".x) / SCENEJS_uColorModRadius"+q+".y, 0.0, 1.0);"),ye.applyTo===a.SATURATION?(ve||(le("float L = dot(vec3(0.3, 0.59, 0.11), fragColor.rgb);"),ve=!0),ye.value.isScalarFresnel?(le("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+q+".a, SCENEJS_uColorModFresnelCenter"+q+".a, SCENEJS_uColorModFresnelPower"+q+");"),le("saturation = mix(SCENEJS_uColorModFresnelEdge"+q+".r, SCENEJS_uColorModFresnelCenter"+q+".r, colorModFresnel);")):le("saturation = SCENEJS_uColorModification"+q+";"),ye.range&&le("saturation *= colorModFactor;"),le("fragColor.rgb -= saturation * (L - fragColor.rgb);")):ye.applyTo===a.CONTRAST?(ye.value.isScalarFresnel?(le("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+q+".a, SCENEJS_uColorModFresnelCenter"+q+".a, SCENEJS_uColorModFresnelPower"+q+");"),le("contrast = mix(SCENEJS_uColorModFresnelEdge"+q+".r, SCENEJS_uColorModFresnelCenter"+q+".r, colorModFresnel);")):le("contrast = SCENEJS_uColorModification"+q+";"),ye.range&&le("contrast = mix(1.0, contrast, colorModFactor);"),le("fragColor.rgb = (fragColor.rgb - 0.5) * contrast + 0.5;")):ye.applyTo===a.BRIGHTNESS?(ye.value.isScalarFresnel?(le("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+q+".a, SCENEJS_uColorModFresnelCenter"+q+".a, SCENEJS_uColorModFresnelPower"+q+");"),le("brightness = mix(SCENEJS_uColorModFresnelEdge"+q+".r, SCENEJS_uColorModFresnelCenter"+q+".r, colorModFresnel);")):le("brightness = SCENEJS_uColorModification"+q+";"),ye.range&&le("brightness *= colorModFactor;"),le("fragColor.rgb += brightness;")):ye.applyTo===a.TINT&&(ye.value.isColorFresnel?(le("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+q+".a, SCENEJS_uColorModFresnelCenter"+q+".a, SCENEJS_uColorModFresnelPower"+q+");"),le("tintColor = mix(SCENEJS_uColorModFresnelEdge"+q+".rgb, SCENEJS_uColorModFresnelCenter"+q+".rgb, colorModFresnel);"),ye.range&&le("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")):(le("tintColor = SCENEJS_uColorModification"+q+";"),ye.range&&le("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")),le("fragColor.rgb *= tintColor;"))}return L&&(le("vec3 fogColor = SCENEJS_uFogColor.rgb;"),le("float fogDensity = SCENEJS_uFogColor.a;"),le("float fogStart = SCENEJS_uFogParams.x;"),le("float fogEnd = SCENEJS_uFogParams.y;"),le("float fogMin = SCENEJS_uFogParams.z;"),le("float fogMax = SCENEJS_uFogParams.w;"),O===e.FOG_LINEAR?le("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(le("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),O===e.FOG_EXP2&&le("fogAttenuation = fogAttenuation * fogAttenuation;"),le("float fog = 1.0 - exp(-fogAttenuation);")),le("fog = clamp(fog, fogMin, fogMax);"),le("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),x&&(le("float fragmentFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uFragmentFresnelEdgeColor.a, SCENEJS_uFragmentFresnelCenterColor.a, SCENEJS_uFragmentFresnelPower);"),x.blendMode&t.multiply?le("fragColor.rgb *= mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);"):x.blendMode&t.add&&le("fragColor.rgb += mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);")),C&&K.push("fragColor = linearToGamma(fragColor, 2.2);"),X||le("fragColor.rgb *= fragColor.a;"),le("fragColor = clamp(fragColor, 0.0, 1.0);"),le("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),W?le(W):(le("if (SCENEJS_uOutputFormat == 0.0) {"),le("    gl_FragColor = fragColor;"),le("} else if (SCENEJS_uOutputFormat == 1.0) {"),le("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),le("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),le("    float d = 1.0 - fragZ * 0.99;"),le("    float d4 = d * d * d * d;"),le("    float d16 = d4 * d4 * d4 * d4;"),le("    float a2 = fragColor.a * fragColor.a;"),le("    float a4 = a2 * a2;"),le("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),le("    float w = clamp(depthWeight, 0.0001, 1e4);"),le("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),le("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),le("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),le("}")),le("}"),ce()}function ne(){if(se(),X&&le("#extension GL_OES_standard_derivatives : enable"),Y&&le(Y),le("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),le("#define EDGE_ALPHA 0.9"),le("#define CENTER_ALPHA 0.0"),le("#define EDGE_BIAS 0.0"),le("#define CENTER_BIAS 0.6"),le("uniform sampler2D SCENEJS_uDepthBuffer;"),le("uniform vec2 SCENEJS_uCanvasRes;"),le("varying vec4 SCENEJS_vViewVertex;"),I){le("varying vec4 SCENEJS_vWorldVertex;"),y&&le("uniform vec3 SCENEJS_uSolidColor;");for(var t=0;t<s.clips.clips.length;t++)le("uniform vec4  SCENEJS_uClipNormalAndDist"+t+";"),s.clips.clips[t].fade&&le("uniform float SCENEJS_uClipFadeDistance"+t+";")}if(X&&le("varying vec4 SceneJS_vModelVertex;"),g&&(le("uniform vec3 SCENEJS_uXrayColor;"),le("varying vec3 SCENEJS_vViewNormal;")),L&&(le("uniform vec4   SCENEJS_uFogParams;"),le("uniform vec4   SCENEJS_uFogColor;")),le("uniform float SCENEJS_uOutputFormat;"),le("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),z&&le("uniform bool SCENEJS_uDiscardOpaque;"),X&&(le("float hash(vec2 v) {"),le("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),le("}"),le("float hash3D(vec3 v) {"),le("    return hash(vec2(hash(v.xy), v.z));"),le("}")),le("void main(void) {"),le("vec4 fragColor = vec4(1.0);"),I){for(s.clips.clipDiscard&&le("float distOff = 0.0;"),s.clips.clipFade&&le("float distAlpha = 0.0;"),t=0;t<s.clips.clips.length;t++)le(s.clips.clips[t].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w) / SCENEJS_uClipFadeDistance"+t+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w);");s.clips.clipDiscard&&le("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&le("if (distAlpha > 1.0) { discard; }")}return N&&D&&(le("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),le("float r = dot(cxy, cxy);"),le("if (r > 1.0) {"),le("   discard;"),le("}")),g&&(le("float fr = abs(dot(normalize(-SCENEJS_vViewVertex.xyz), normalize(SCENEJS_vViewNormal)));"),le("float fresnelFactor = clamp((fr - EDGE_BIAS) / (CENTER_BIAS - EDGE_BIAS), 0.0, 1.0);"),le("fragColor.rgb = SCENEJS_uXrayColor;"),le("fragColor.a = mix(EDGE_ALPHA, CENTER_ALPHA, fresnelFactor);")),I&&s.clips.clipFade&&le("fragColor.a *= (1.0 - distAlpha);"),z&&(le("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),le("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),X&&(le("{"),le("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),le("    float pixScale = 1.0 / maxDeriv;"),le("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),le("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),le("    float lerpFactor = fract(log2(pixScale));"),le("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),le("    float a = min(lerpFactor, 1.0 - lerpFactor);"),le("    vec3 cases = vec3("),le("        x * x / (2.0 * a * (1.0 - a)), "),le("        (x - 0.5 * a)/(1.0 - a), "),le("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),le("    );"),le("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),le("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),le("    if (fragColor.a < aThresh) {"),le("        discard;"),le("    } else {"),le("        fragColor.a = 1.0;"),le("    }"),le("}")),L&&(le("vec3 fogColor = SCENEJS_uFogColor.rgb;"),le("float fogDensity = SCENEJS_uFogColor.a;"),le("float fogStart = SCENEJS_uFogParams.x;"),le("float fogEnd = SCENEJS_uFogParams.y;"),le("float fogMin = SCENEJS_uFogParams.z;"),le("float fogMax = SCENEJS_uFogParams.w;"),O===e.FOG_LINEAR?le("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(le("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),O===e.FOG_EXP2&&le("fogAttenuation = fogAttenuation * fogAttenuation;"),le("float fog = 1.0 - exp(-fogAttenuation);")),le("fog = clamp(fog, fogMin, fogMax);"),le("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),le("fragColor.rgb *= fragColor.a;"),le("fragColor = clamp(fragColor, 0.0, 1.0);"),le("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),W?le(W):(le("if (SCENEJS_uOutputFormat == 0.0) {"),le("    gl_FragColor = fragColor;"),le("} else if (SCENEJS_uOutputFormat == 1.0) {"),le("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),le("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),le("    float d = 1.0 - fragZ * 0.99;"),le("    float d4 = d * d * d * d;"),le("    float d16 = d4 * d4 * d4 * d4;"),le("    float a2 = fragColor.a * fragColor.a;"),le("    float a4 = a2 * a2;"),le("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),le("    float w = clamp(depthWeight, 0.0001, 1e4);"),le("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),le("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),le("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),le("}")),le("}"),ce()}function oe(){if(se(),le("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),le("varying vec4 SCENEJS_vWorldVertex;"),I)for(var e=0;e<s.clips.clips.length;e++)le("uniform vec4  SCENEJS_uClipNormalAndDist"+e+";"),s.clips.clips[e].fade&&le("uniform float SCENEJS_uClipFadeDistance"+e+";");if(le("void main(void) {"),I){for(s.clips.clipDiscard&&le("float distOff = 0.0;"),s.clips.clipFade&&le("float distAlpha = 0.0;"),e=0;e<s.clips.clips.length;e++)le(s.clips.clips[e].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+e+".xyz) + SCENEJS_uClipNormalAndDist"+e+".w) / SCENEJS_uClipFadeDistance"+e+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+e+".xyz) + SCENEJS_uClipNormalAndDist"+e+".w);");s.clips.clipDiscard&&le("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&le("if (distAlpha > 1.0) { discard; }")}return le("   gl_FragColor = vec4(gl_FragCoord.zzz, 1.0);"),le("}"),ce()}function se(){K=[]}function le(e){K.push(e||"")}function ce(){return K.join("\n")}this.setMaxPointSize=function(e){e=Math.min(e,SceneJS.WEBGL_INFO.MAX_POINT_SIZE),Q=Math.floor(e).toFixed(1)},this.getSource=function(e,a,o){var K=q[e];return K?(K.useCount++,K):(l=o,c=(s=a).material.workflow===SceneJS.Material.PHONG,u=s.material.workflow===SceneJS.Material.METALLIC,_=a.gammaInputPhong,h=!!(s.texture.layers&&s.texture.layers.length>0)&&re(),f=function(e){if(!e.properties.getFlag(i.REFLECTIVE))return!1;if(!e.geometry.normalBuf)return!1;if(!e.cubemap.layers)return!1;for(var t=0,a=e.cubemap.layers.length;t<a;t++)if(e.cubemap.layers[t].applyTo===r.reflect)return!0;return!1}(s),d=function(e){if(!e.geometry.normalBuf)return!1;if(!e.cubemap.layers)return!1;for(var t=0,i=e.cubemap.layers.length;t<i;t++)if(e.cubemap.layers[t].applyTo===r.light)return!0;return!1}(s),m=function(e){return e.material.workflow===SceneJS.Material.METALLIC&&!!e.properties.getFlag(i.REFLECTIVE)&&!!e.geometry.normalBuf&&!!e.reflections.activeReflection}(s),p=function(e){return e.material.workflow===SceneJS.Material.METALLIC&&!!e.geometry.normalBuf&&!!e.lightmaps.activeLightmap}(s),g=function(e){return!!e.geometry.normalBuf||!(!e.morphGeometry.targets||!e.morphGeometry.targets[0].normalBuf)}(s),y=(I=s.clips.clips.length>0&&!!(s.properties.flags&i.CLIPPING))&&!!(s.properties.flags&i.SOLID),v=!!(s.properties.flags&i.SKYBOX),S=!!(s.properties.flags&i.BILLBOARD),E=function(e){if(e.texture){var r=e.texture.layers;if(!r)return!1;for(var i=0,a=r.length;i<a;i++)if(r[i].flags&t.normals)return!0}return!1}(s),b=E&&a.autoTangents&&SceneJS.WEBGL_INFO.standardDerivativesSupported,x=!!s.morphGeometry.targets,C=!s.regionMap.empty&&re(),T=C&&"info"!==s.regionMap.mode,N="points"===s.geometry.primitiveName,A=!!(s.properties.flags&i.PERSPECTIVE_POINTS),P=!!s.geometry.pointScaleRotationBuf,M=!!s.geometry.pointUVTranslateBuf,D=!!(s.properties.flags&i.ROUND_POINTS),w=!(!s.geometry.compressedPositions&&!s.morphGeometry.compressedPositions),R=!(!s.geometry.compressedNormals&&!s.morphGeometry.compressedNormals),F=!(!s.geometry.compressedUVs&&!s.morphGeometry.compressedUVs),L=s.fogEnabled,O=s.fogMode,H=s.properties.colorModRange,J=s.properties.colorModifiers.length>0,B=s.properties.colorModifiers,k=function(){for(var e=s.properties.colorModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isScalarFresnel)return!0;return!1}(),U=function(){for(var e=s.properties.colorModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isColorFresnel)return!0;return!1}(),V=function(){for(var e=s.properties.opacityModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isScalarFresnel)return!0;return!1}(),j=s.properties.opacityModRange,G=s.properties.opacityModifiers.length>0,z=s.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&l.isPartiallyOpaque(),X=!!(s.properties.flags&i.STOCHASTIC_ALPHA),Y=s.properties.fragmentShaderHeader||null,W=s.properties.fragmentShaderFooter||null,K={hash:e,pickVertexSrc:Z(),pickFragmentSrc:$(),pickTriangleVertexSrc:Z(!0),pickTriangleFragmentSrc:$(!0),drawVertexSrc:ie(),drawFragmentSrc:ae(),xrayVertexSrc:(se(),le("uniform mat4 SCENEJS_uMMatrix;"),n?(le("uniform mat4 SCENEJS_uVMatrix;"),le("uniform vec3 SCENEJS_uWorldEye;")):(le("uniform mediump mat4 SCENEJS_uVMatrix;"),le("uniform mediump vec3 SCENEJS_uWorldEye;")),le("uniform mat4 SCENEJS_uPMatrix;"),le("attribute vec4 SCENEJS_aVertex;"),N&&(le("uniform float SCENEJS_uPointSize;"),P&&le("attribute vec2 SCENEJS_aPointScaleRotation;")),w&&le("uniform mat4 SCENEJS_uDecodePositionMatrix;"),le("varying vec4 SCENEJS_vViewVertex;"),g&&(le("attribute vec3 SCENEJS_aNormal;"),le("uniform   mat4 SCENEJS_uMNMatrix;"),le("varying   vec3 SCENEJS_vViewNormal;")),I&&le("varying vec4 SCENEJS_vWorldVertex;"),X&&le("varying vec4 SceneJS_vModelVertex;"),x&&(le("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&le("attribute vec4 SCENEJS_aMorphVertex;"),g&&s.morphGeometry.targets[0].normalBuf&&le("attribute vec3 SCENEJS_aMorphNormal;"),w&&le("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),S&&(le("void billboard(inout mat4 mat) {"),le("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),le("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),le("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),le("}")),R&&(le("vec3 octDecode(vec2 oct) {"),le("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),le("    if (v.z < 0.0) {"),le("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),le("    }"),le("    return normalize(v);"),le("}")),le("void main(void) {"),le(w?"vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"vec4 modelVertex = SCENEJS_aVertex; "),R?le("vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):g&&le("vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),x&&(s.morphGeometry.targets[0].vertexBuf&&le(w?"modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),g&&s.morphGeometry.targets[0].normalBuf&&le(R?"modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); ")),X&&le("SceneJS_vModelVertex = modelVertex;"),le("mat4 modelMatrix = SCENEJS_uMMatrix;"),le("mat4 viewMatrix = SCENEJS_uVMatrix;"),g&&le("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),le("vec4 worldVertex;"),le("vec4 viewVertex;"),v&&le("viewMatrix[3].xyz = vec3(0.0);"),S?(le("mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),le("billboard(modelMatrix);"),le("billboard(viewMatrix);"),le("billboard(modelViewMatrix);"),g&&le("billboard(modelNormalMatrix);"),le("worldVertex = modelMatrix * modelVertex;"),le("viewVertex = modelViewMatrix * modelVertex;")):(le("worldVertex = modelMatrix * modelVertex;"),le("viewVertex  = viewMatrix * worldVertex; ")),le("SCENEJS_vViewVertex = viewVertex;"),g&&(le("vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),le("SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;")),I&&le("SCENEJS_vWorldVertex = worldVertex;"),le("gl_Position = SCENEJS_uPMatrix * viewVertex;"),N&&(le("gl_PointSize = SCENEJS_uPointSize;"),A&&le("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&le("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),le("gl_PointSize = min(gl_PointSize, "+Q+");")),le("}"),ce()),xrayFragmentSrc:ne(),depthVertexSrc:(se(),le("attribute vec4 SCENEJS_aVertex;"),le("uniform mat4 SCENEJS_uMMatrix;"),le("uniform mat4 SCENEJS_uVMatrix;"),le("uniform mat4 SCENEJS_uPMatrix;"),N&&(le("uniform float SCENEJS_uPointSize;"),P&&le("attribute vec2 SCENEJS_aPointScaleRotation;")),w&&le("uniform mat4 SCENEJS_uDecodePositionMatrix;"),le("varying vec4 SCENEJS_vWorldVertex;"),x&&(le("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&le("attribute vec4 SCENEJS_aMorphVertex;"),w&&le("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),le("void main(void) {"),le(w?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),x&&s.morphGeometry.targets[0].vertexBuf&&le(w?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),le("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),le("mat4 vPosMatrix = SCENEJS_uVMatrix;"),v&&le("vPosMatrix[3].xyz = vec3(0.0);"),le("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),le("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),N&&(le("gl_PointSize = SCENEJS_uPointSize;"),A&&le("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&le("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),le("gl_PointSize = min(gl_PointSize, "+Q+");")),le("}"),ce()),depthFragmentSrc:oe(),drawTextureVertexSrc:ee(),drawTextureFragmentSrc:te(),useCount:0},q[e]=K,K)},this.putSource=function(e){var t=q[e];t&&0==--t.useCount&&(q[t.hash]=null)}}}(),function(){"use strict";var e=window.SceneJS_ProgramFactory=function(e,t){this.stats=e,this._canvas=t.canvas,this._programs={}};e.prototype.getProgram=function(e,t,r){var i=this._programs[e];return i||(i=new SceneJS._webgl.Program(this.stats,this._canvas.gl,e,t,r),this._programs[e]=i,this.stats.state.programs++),i.useCount++,i},e.prototype.putProgram=function(e){--e.useCount<=0&&(e.destroy(),delete this._programs[e.hash],this.stats.state.programs--)},e.prototype.webglRestored=function(){var e=this._canvas.gl;for(var t in this._programs)this._programs.hasOwnProperty(t)&&this._programs[t].build(e)},e.prototype.destroy=function(){}}(),function(){"use strict";var e=window.SceneJS_Object=function(e){this.id=e,this.hash=null,this.sortKey=0,this.sortTieBreaker=0,this.chunkSets={},this.chunksLen=0,this.program=null,this.layer=null,this.texture=null,this.properties=null,this.centroid=null},t=new vec3.create,r=vec2.create(),i=vec2.create(),a=(vec2.create(),vec3.create()),n=vec3.create(),o=vec3.create(),s=vec3.create(),l=vec3.create(),c=vec3.create(),u=vec3.create(),_=vec3.create(),h=vec3.create(),f=vec4.create();function d(e,t,r){var i=e.arrays.positions,a=e.positionDecodeMat,n=3*t;r[0]=i[n],r[1]=i[n+1],r[2]=i[n+2],a&&SceneJS_math_decompressPosition(r,r,a)}function m(e,t,r,i,a,n,o,s){var l=2*r,c=2*i,u=2*a,_=e.arrays.uvs[t];if(n[0]=_[l],n[1]=_[l+1],o[0]=_[c],o[1]=_[c+1],s[0]=_[u],s[1]=_[u+1],e.compressedUVs){var h=e.uvDecodeMats[t];SceneJS_math_decompressUV(n,n,h),SceneJS_math_decompressUV(o,o,h),SceneJS_math_decompressUV(s,s,h)}}vec4.create(),vec4.create(),e.prototype.getDepth=function(){this.centroid||(this.centroid=this._calculateCentroid(this));var e=this.viewMatrix,r=vec3.transformMat4(t,this.centroid,this.modelTransform.matrix);return-(e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14])},e.prototype.isTransparent=function(){return!this.properties.stochasticAlpha&&!!(this.properties.transparent||this.properties.opacityModifiers.length>0||this.texture.transparent||this.geometry.transparent||this.fresnel.transparent||this.material.transparent||this.regionMap.transparent)},e.prototype.isPartiallyOpaque=function(){return this.properties.partiallyOpaque||!this.properties.transparent&&(this.fresnel.partiallyOpaque||this.texture.transparent)},e.prototype.getKdTree=function(){var e=this.morphGeometry.targets;return e&&e.length>0?this.morphGeometry.getKdTree(this.geometry.arrays.indices):this.geometry.getKdTree()},e.prototype.getPositions=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].positions:this.geometry.arrays.positions},e.prototype.getPositionDecodeMat=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].positionDecodeMat:this.geometry.positionDecodeMat},e.prototype.getFrameEndPositions=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].positions:null},e.prototype.getFrameEndPositionDecodeMat=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].positionDecodeMat:null},e.prototype.getNormals=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].normals:this.geometry.arrays.normals},e.prototype.getFrameEndNormals=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].normals:null},e.prototype.getIndices=function(){return this.geometry.arrays.indices||null},e.prototype.getMorphFactor=function(){var e=this.morphGeometry.targets;return e&&e.length>0?this.morphGeometry.factor:null},e.prototype.cartesianToBarycentric=function(e,t,r){this.getTrianglePositionOnSurface(e,a,n,o),SceneJS_math_cartesianToBarycentric(t,a,n,o,r)},e.prototype.getPointInWorldSpace=function(e,t){f.set(e),f[3]=1,vec4.transformMat4(f,f,this.modelTransform.matrix),t.set(f.subarray(0,3))},e.prototype.getTriangleIndices=function(e,t){var r=this.geometry.arrays.indices;r?(t[0]=r[e],t[1]=r[e+1],t[2]=r[e+2]):(t[0]=e,t[1]=e+1,t[2]=e+2)},e.prototype.barycentricToCartesian=function(e,t,r){t=t||[1/3,1/3,1/3],this.getTrianglePositionOnSurface(e,a,n,o),SceneJS_math_barycentricToCartesian(t,a,n,o,r)},e.prototype.getTrianglePositionOnSurface=function(e,t,r,i){var a,n,o,f=this.geometry.arrays.indices;(this.geometry||this.morphGeometry)&&(f?(a=f[e],n=f[e+1],o=f[e+2]):(a=e,n=e+1,o=e+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?function(e,t,r,i,a,n,o){var f=3*t,d=3*r,m=3*i,p=e.targets[e.key1].positions,g=e.targets[e.key2].positions,y=e.targets[e.key1].positionDecodeMat,v=e.targets[e.key2].positionDecodeMat;e.compressedPositions?(SceneJS_math_decompressPosition(s,p.subarray(f,f+3),y),SceneJS_math_decompressPosition(u,g.subarray(f,f+3),v),SceneJS_math_decompressPosition(l,p.subarray(d,d+3),y),SceneJS_math_decompressPosition(_,g.subarray(d,d+3),v),SceneJS_math_decompressPosition(c,p.subarray(m,m+3),y),SceneJS_math_decompressPosition(h,g.subarray(m,m+3),v)):(s.set(p.subarray(f,f+3)),u.set(g.subarray(f,f+3)),l.set(p.subarray(d,d+3)),_.set(g.subarray(d,d+3)),c.set(p.subarray(m,m+3)),h.set(g.subarray(m,m+3))),vec3.lerp(a,s,u,e.factor),vec3.lerp(n,l,_,e.factor),vec3.lerp(o,c,h,e.factor)}(this.morphGeometry,a,n,o,t,r,i):function(e,t,r,i,a,n,o){var s=e.arrays.positions,l=e.positionDecodeMat,c=3*t,u=3*r,_=3*i;a[0]=s[c],a[1]=s[c+1],a[2]=s[c+2],n[0]=s[u],n[1]=s[u+1],n[2]=s[u+2],o[0]=s[_],o[1]=s[_+1],o[2]=s[_+2],l&&(SceneJS_math_decompressPosition(a,a,l),SceneJS_math_decompressPosition(n,n,l),SceneJS_math_decompressPosition(o,o,l))}(this.geometry,a,n,o,t,r,i))},e.prototype.normalFromBarycentric=function(e,t,r){return t=t||[1/3,1/3,1/3],!!this.normalFromCartesian(e,a,n,o)&&(vec3.scale(r,a,t[0]),vec3.add(r,r,vec3.scale(l,n,t[1])),vec3.add(r,r,vec3.scale(l,o,t[2])),!0)},e.prototype.normalFromCartesian=function(e,t,r,i){if(this.geometry||this.morphGeometry){var a,n,o,f=this.geometry.arrays.indices;return f?(a=f[e],n=f[e+1],o=f[e+2]):(a=e,n=e+1,o=e+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?function(e,t,r,i,a,n,o){var f,d,m,p=e.targets[e.key1].normals,g=e.targets[e.key2].normals;return e.compressedNormals?(f=2*t,d=2*r,m=2*i,SceneJS_math_octDecodeVec2(p.subarray(f,f+2),s),SceneJS_math_octDecodeVec2(g.subarray(f,f+2),u),SceneJS_math_octDecodeVec2(p.subarray(d,d+2),l),SceneJS_math_octDecodeVec2(g.subarray(d,d+2),_),SceneJS_math_octDecodeVec2(p.subarray(m,m+2),c),SceneJS_math_octDecodeVec2(g.subarray(m,m+2),h)):(d=3*r,m=3*i,s.set(p.subarray(f=3*t,f+3)),u.set(g.subarray(f,f+3)),l.set(p.subarray(d,d+3)),_.set(g.subarray(d,d+3)),c.set(p.subarray(m,m+3)),h.set(g.subarray(m,m+3))),vec3.lerp(a,s,u,e.factor),vec3.lerp(n,l,_,e.factor),vec3.lerp(o,c,h,e.factor),!0}(this.morphGeometry,a,n,o,t,r,i):function(e,t,r,i,a,n,o){var s=e.arrays.normals;if(!s)return a=a.set([0,0,0]),n=n.set([0,0,0]),o=o.set([0,0,0]),!1;if(e.compressedNormals){var l,c=2*r,u=2*i;s.subarray(l=2*t,l+2),s.subarray(c,c+2),s.subarray(u,u+2),SceneJS_math_octDecodeVec2(s.subarray(l,l+2),a),SceneJS_math_octDecodeVec2(s.subarray(c,c+2),n),SceneJS_math_octDecodeVec2(s.subarray(u,u+2),o)}else c=3*r,u=3*i,a[0]=s[l=3*t],a[1]=s[l+1],a[2]=s[l+2],n[0]=s[c],n[1]=s[c+1],n[2]=s[c+2],o[0]=s[u],o[1]=s[u+1],o[2]=s[u+2];return!0}(this.geometry,a,n,o,t,r,i)}},e.prototype.uvFromBarycentric=function(e,t,s){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var l,c,u,_,h=this.geometry.arrays.indices;for(h?(l=h[e],c=h[e+1],u=h[e+2]):(l=e,c=e+1,u=e+2),_=0;_<this.geometry.arrays.uvs.length;_++){m(this.geometry,_,l,c,u,a,n,o);var f=vec2.create();vec2.scale(f,a,t[0]),vec2.add(f,f,vec2.scale(r,n,t[1])),vec2.add(f,f,vec2.scale(i,o,t[2])),s.push(f)}}},e.prototype.uvFromCartesian=function(e,t,r,i){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var s,l,c,u=this.geometry.arrays.indices;u?(s=u[e],l=u[e+1],c=u[e+2]):(s=e,l=e+1,c=e+2);var _,h=[],f=[],d=[];for(_=0;_<this.geometry.arrays.uvs.length;_++){m(e,_,s,l,c,a,n,o);var p=vec2.create(),g=vec2.create(),y=vec3.create();p[0]=a[0],p[1]=a[1],g[0]=n[0],g[1]=n[1],y[0]=o[0],y[1]=o[1],h.push(p),f.push(g),d.push(y)}}},e.prototype._calculateCentroid=function(){for(var e=vec3.create(),r=1/0,i=1/0,a=1/0,n=-1/0,o=-1/0,s=-1/0,l=Math.min,c=Math.max,u=0,_=this.geometry.arrays.positions.length/3;u<_;++u){d(this.geometry,u,t);var h=t[0],f=t[1],m=t[2];r=l(h,r),i=l(f,i),a=l(m,a),n=c(h,n),o=c(f,o),s=c(m,s)}return e[0]=.5*(r+n),e[1]=.5*(i+o),e[2]=.5*(a+s),e}}(),function(){"use strict";var e=["attribute vec2 aPosition;","varying vec2 vUV;","void main() {","    vUV = aPosition * 0.5 + 0.5;","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),t=new Float32Array([-1,-1,1,-1,-1,1,1,1]);window.SceneJS_PostProcess=function(r,i,a,n){n=n||{},this.gl=i,this.uniformIndices={},this.uniformHandles=[],this.uniformValues=[],this.textureIndices={},this.samplerNames=[],this.textures=[],this.positionBuffer=new SceneJS._webgl.ArrayBuffer(i,i.ARRAY_BUFFER,t,t.length,2,i.STATIC_DRAW),this.program=new SceneJS._webgl.Program(r,i,"post-process",e,a),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformCount=0,this.textureCount=0,this.clear=!!n.clear},SceneJS_PostProcess.prototype.setUniform=function(e,t){var r=this.uniformIndices[e];void 0===r&&(r=this.uniformIndices[e]=this.uniformCount++,this.uniformHandles.push(this.program.getUniform(e))),this.uniformValues[r]=t},SceneJS_PostProcess.prototype.setTexture=function(e,t){var r=this.textureIndices[e];void 0===r&&(r=this.textureIndices[e]=this.textureCount++,this.samplerNames.push(e)),this.textures[r]=t},SceneJS_PostProcess.prototype.draw=function(e){e.VAO&&e.VAO.bindVertexArrayOES(null),this.program.bind(),this.positionsAttribute.bindArrayBuffer(this.positionBuffer);for(var t=0;t<this.uniformCount;++t)this.uniformHandles[t].setValue(this.uniformValues[t]);for(t=0;t<this.textureCount;++t)this.program.bindTexture(this.samplerNames[t],this.textures[t],t);this.clear&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},SceneJS_PostProcess.prototype.destroy=function(){this.positionBuffer.destroy(),this.positionBuffer=null,this.program.destroy(),this.program=null},SceneJS_PostProcess.prototype.webglRestored=function(e){for(var r in this.gl=e,this.positionBuffer=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),this.program.build(e),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformIndices)this.uniformHandles[this.uniformIndices[r]]=this.program.getUniform(r)}}(),function(){"use strict";window.SceneJS_PostProcessStage=function(e,t){for(var r in this.id=t.id,this.display=e,this.postProcess=e._postProcessTypes[t.type],this.uniforms=t.uniforms,this.framebuffer=null,t.framebuffer&&(this.framebuffer=e.framebuffers[t.framebuffer]),this.textures={},t.textures){var i,a=t.textures[r],n=a.framebuffer,o=a.target,s=a.data,l=e._canvas.gl;if(n){if(!(i=e.framebuffers[n])){console.error("Framebuffer not found: "+n);continue}if("color"===o)this.textures[r]=i.getColorTarget(a.attachment||0);else{if("depth"!==o){console.error("Invalid target: "+o);continue}this.textures[r]=i.getDepthTarget()}}else if(s){var c=l.createTexture(),u=void 0!==a.format?l[a.format]:l.RGBA,_=void 0!==a.type?l[a.type]:l.UNSIGNED_BYTE,h=void 0!==a.minFilter?l[a.minFilter]:l.NEAREST,f=void 0!==a.magFilter?l[a.magFilter]:l.NEAREST,d=void 0!==a.wrapS?l[a.wrapS]:l.CLAMP_TO_EDGE,m=void 0!==a.wrapT?l[a.wrapT]:l.CLAMP_TO_EDGE;l.bindTexture(l.TEXTURE_2D,c),l.texImage2D(l.TEXTURE_2D,0,u,a.width,a.height,0,u,_,s),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,h),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,f),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,m),this.textures[r]={texture:c,gl:l,bind:function(e){return!!this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0)},unbind:function(e){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},l.bindTexture(l.TEXTURE_2D,null)}}},SceneJS_PostProcessStage.prototype.setUniform=function(e,t){this.uniforms[e]=t,this.display.imageDirty=!0},SceneJS_PostProcessStage.prototype.draw=function(e){for(var t in this.uniforms)this.postProcess.setUniform(t,this.uniforms[t]);for(var r in this.textures)this.postProcess.setTexture(r,this.textures[r]);this.postProcess.draw(e)},SceneJS_PostProcessStage.prototype.destroy=function(){for(var e in this.textures)"function"==typeof this.textures[e].destroy&&this.textures[e].destroy(),this.textures[e]=null}}(),function(){"use strict";var e=window.SceneJS_ChunkFactory=function(){this._chunks={},this._numericIds=1,this.chunkTypes=e.chunkTypes};e.chunkTypes={},e.addChunkType=function(t,r){e.chunkTypes[t]=r},e.prototype.getChunk=function(t,r,i,a){var n=e.chunkTypes[r];if(!n)throw"chunk type not supported: '"+r+"'";var o=this._chunks[t];return o?(o.useCount++,o):((o=new n(t,this._numericIds++,i,a)).useCount=1,this._chunks[t]=o,o)},e.prototype.putChunk=function(e){0!==e.useCount&&--e.useCount<=0&&(e.recycle&&e.recycle(),delete this._chunks[e.id])},e.prototype.webglRestored=function(){var e;for(var t in this._chunks)this._chunks.hasOwnProperty(t)&&(e=this._chunks[t])&&e.build&&e.build()}}(),function(){"use strict";var e=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.unique=!0,this.build()};e.prototype.build=function(){this.core=this.cores[0],this.handles.draw={},this.handles.xray={},this.handles.pick={uPickColor:this.program.pick.getUniform("SCENEJS_uPickColor")},this.handles.depth={},this.handles.drawTexture={}},e.prototype.draw=function(e,t){var r=this.core,i=this.handles[e],a=this.program.gl;if(t.pickTriangle){var n=r.getPickColors();n&&a.drawArrays(r.primitive,0,n.numItems/4)}else{if(t.pickObject&&i.uPickColor){var o=t.pickIndex>>24&255,s=t.pickIndex>>16&255,l=t.pickIndex>>8&255,c=255&t.pickIndex;t.pickIndex++,i.uPickColor.setValue([c/255,l/255,s/255,o/255])}r.indexBuf?a.drawElements(r.primitive,r.indexBuf.numItems,r.indexBuf.itemType,0):a.drawArrays(r.primitive,0,r.vertexBuf.numItems/3)}t.transparent=!1},SceneJS_ChunkFactory.addChunkType("draw",e)}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.DEPTH_TEST_FLAGS,r=vec4.create(),i=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.unique=!0,this.build()};i.prototype.build=function(){this.propertiesCore=this.cores[0],this.xformCore=this.cores[1];var e=this.program.draw,t=this.program.xray,r=this.program.pick,i=this.program.pickTriangle,a=this.program.depth,n=this.program.drawTexture,o=this.handles.draw={},s=this.handles.xray={},l=this.handles.pick={},c=this.handles.pickTriangle={},u=this.handles.depth={},_=this.handles.drawTexture={};if(o.uDiscardOpaque=e.getUniform("SCENEJS_uDiscardOpaque"),o.uOutputFormat=e.getUniform("SCENEJS_uOutputFormat"),s.uDiscardOpaque=t.getUniform("SCENEJS_uDiscardOpaque"),s.uOutputFormat=t.getUniform("SCENEJS_uOutputFormat"),this.propertiesCore){o.uSolidColor=e.getUniform("SCENEJS_uSolidColor"),o.uXrayParams=e.getUniform("SCENEJS_uXrayParams"),s.uSolidColor=t.getUniform("SCENEJS_uSolidColor"),u.uClipping=a.getUniform("SCENEJS_uClipping"),o.uColorModifications=new Array(this.propertiesCore.colorModifiers.length),o.uColorModCenters=new Array(this.propertiesCore.colorModifiers.length),o.uColorModRadii=new Array(this.propertiesCore.colorModifiers.length),o.uColorModFresnels=new Array(this.propertiesCore.colorModifiers.length);for(var h=0,f=this.propertiesCore.colorModifiers.length;h<f;h++){var d=this.propertiesCore.colorModifiers[h].value;o.uColorModifications[h]=e.getUniform("SCENEJS_uColorModification"+h),(d.isColorFresnel||d.isScalarFresnel)&&(o.uColorModFresnels[h]={edge:e.getUniform("SCENEJS_uColorModFresnelEdge"+h),center:e.getUniform("SCENEJS_uColorModFresnelCenter"+h),power:e.getUniform("SCENEJS_uColorModFresnelPower"+h)}),o.uColorModCenters[h]=e.getUniform("SCENEJS_uColorModCenter"+h),o.uColorModRadii[h]=e.getUniform("SCENEJS_uColorModRadius"+h)}o.uOpacityModifications=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModCenters=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModRadii=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModFresnels=new Array(this.propertiesCore.opacityModifiers.length);var m=0;for(f=this.propertiesCore.opacityModifiers.length;m<f;++m){var p=this.propertiesCore.opacityModifiers[m];o.uOpacityModifications[m]=e.getUniform("SCENEJS_uOpacityModification"+m),p.value.isScalarFresnel&&(o.uOpacityModFresnels[m]={edge:e.getUniform("SCENEJS_uOpacityModFresnelEdge"+m),center:e.getUniform("SCENEJS_uOpacityModFresnelCenter"+m),power:e.getUniform("SCENEJS_uOpacityModFresnelPower"+m)}),o.uOpacityModCenters[m]=e.getUniform("SCENEJS_uOpacityModCenter"+m),o.uOpacityModRadii[m]=e.getUniform("SCENEJS_uOpacityModRadius"+m)}}this.xformCore&&(o.uMatLocation=e.getUniform("SCENEJS_uMMatrix"),o.uNormalMatLocation=e.getUniform("SCENEJS_uMNMatrix"),s.uMatLocation=t.getUniform("SCENEJS_uMMatrix"),s.uNormalMatLocation=t.getUniform("SCENEJS_uMNMatrix"),l.uMatLocation=r.getUniform("SCENEJS_uMMatrix"),c.uMatLocation=i.getUniform("SCENEJS_uMMatrix"),u.uMatLocation=a.getUniform("SCENEJS_uMMatrix"),_.uMatLocation=n.getUniform("SCENEJS_uMMatrix"))},i.prototype.draw=function(i,a){var n=this.program.gl,o=this.handles[i];if(o.uDiscardOpaque&&o.uDiscardOpaque.setValue(a.discardOpaque),o.uOutputFormat&&o.uOutputFormat.setValue(a.outputFormat),this.propertiesCore){var s=this.propertiesCore.depthTest;a.depthTest!=s&&(s==t.ALWAYS_PASS?(n.enable(n.DEPTH_TEST),n.depthFunc(n.ALWAYS)):s==t.DISABLED?n.disable(n.DEPTH_TEST):(n.enable(n.DEPTH_TEST),n.depthFunc(n.LESS)),a.depthTest=s);var l=this.propertiesCore.flags&e.CCW;if(a.frontface!=l&&(n.frontFace(l?n.CCW:n.CW),a.frontface=l),o.uColorModifications)for(var c=0,u=this.propertiesCore.colorModifiers.length;c<u;++c){var _=this.propertiesCore.colorModifiers[c],h=_.value;o.uColorModifications[c]&&o.uColorModifications[c].setValue(h);var f=o.uColorModFresnels[c];f&&(h.isColorFresnel?(f.edge&&(r[0]=h.edge[0],r[1]=h.edge[1],r[2]=h.edge[2],r[3]=h.edgeBias,f.edge.setValue(r)),f.center&&(r[0]=h.center[0],r[1]=h.center[1],r[2]=h.center[2],r[3]=h.centerBias,f.center.setValue(r)),f.power&&f.power.setValue(h.power)):h.isScalarFresnel&&(f.edge&&(r[0]=h.edge,r[3]=h.edgeBias,f.edge.setValue(r)),f.center&&(r[0]=h.center,r[3]=h.centerBias,f.center.setValue(r)),f.power&&f.power.setValue(h.power))),o.uColorModCenters[c]&&o.uColorModCenters[c].setValue(_.range.center),o.uColorModRadii[c]&&o.uColorModRadii[c].setValue(_.range.radius)}if(o.uOpacityModifications){var d=0;for(u=this.propertiesCore.opacityModifiers.length;d<u;++d){var m=this.propertiesCore.opacityModifiers[d];h=m.value,o.uOpacityModifications[d]&&o.uOpacityModifications[d].setValue(h);var p=o.uOpacityModFresnels[d];p&&(p.edge&&(r[0]=h.edge,r[3]=h.edgeBias,p.edge.setValue(r)),p.center&&(r[0]=h.center,r[3]=h.centerBias,p.center.setValue(r)),p.power&&p.power.setValue(h.power)),o.uOpacityModCenters[d]&&o.uOpacityModCenters[d].setValue(m.range.center),o.uOpacityModRadii[d]&&o.uOpacityModRadii[d].setValue(m.range.radius)}}o.uSolidColor&&o.uSolidColor.setValue(this.propertiesCore.solidColor),o.uXrayParams&&o.uXrayParams.setValue(this.propertiesCore.xrayParams)}this.xformCore&&(o.uMatLocation&&o.uMatLocation.setValue(this.xformCore.matrix),o.uNormalMatLocation&&o.uNormalMatLocation.setValue(this.xformCore.normalMatrix))},SceneJS_ChunkFactory.addChunkType("object",i)}(),function(){"use strict";var e=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.VAOs={draw:null,pick:null,pickTriangle:null,xray:null,depth:null,drawTexture:null},this.build()};e.prototype.build=function(){this.core=this.cores[0],this.core2=this.cores[1];var e=this.program.draw,t=0;this.core2.uvBufs&&(t=this.core2.uvBufs.length),this.handles.draw={aRegionMapUV:e.getAttribute("SCENEJS_aRegionMapUV"),aVertex:e.getAttribute("SCENEJS_aVertex"),aNormal:e.getAttribute("SCENEJS_aNormal"),aUV:new Array(t),uDecodeUV:new Array(t),aTangent:e.getAttribute("SCENEJS_aTangent"),aColor:e.getAttribute("SCENEJS_aVertexColor"),aMorphVertex:e.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:e.getAttribute("SCENEJS_aMorphNormal"),aMorphTangent:e.getAttribute("SCENEJS_aMorphTangent"),aPointScaleRotation:e.getAttribute("SCENEJS_aPointScaleRotation"),aPointUVTranslate:e.getAttribute("SCENEJS_aPointUVTranslate"),uPointUVScale:e.getUniform("SCENEJS_uPointUVScale"),uMorphFactor:e.getUniform("SCENEJS_uMorphFactor"),uPointSize:e.getUniform("SCENEJS_uPointSize"),uDecodePositions:e.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:e.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var r=0;r<t;r++)this.handles.draw.aUV[r]=e.getAttribute("SCENEJS_aUVCoord"+r),this.handles.draw.uDecodeUV[r]=e.getUniform("SCENEJS_uDecodeUVMatrix"+r);var i=this.program.xray;this.handles.xray={aVertex:i.getAttribute("SCENEJS_aVertex"),aNormal:i.getAttribute("SCENEJS_aNormal"),aMorphVertex:i.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:i.getAttribute("SCENEJS_aMorphNormal"),aPointScaleRotation:i.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:i.getUniform("SCENEJS_uMorphFactor"),uPointSize:i.getUniform("SCENEJS_uPointSize"),uDecodePositions:i.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:i.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var a=this.program.pick;this.handles.pick={aRegionMapUV:a.getAttribute("SCENEJS_aRegionMapUV"),aVertex:a.getAttribute("SCENEJS_aVertex"),aMorphVertex:a.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:a.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:a.getUniform("SCENEJS_uMorphFactor"),uPointSize:a.getUniform("SCENEJS_uPointSize"),uDecodePositions:a.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:a.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var n=this.program.pickTriangle;this.handles.pickTriangle={aVertex:n.getAttribute("SCENEJS_aVertex"),aTriColor:n.getAttribute("SCENEJS_aTriColor"),aMorphVertex:n.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:n.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:n.getUniform("SCENEJS_uMorphFactor"),uPointSize:n.getUniform("SCENEJS_uPointSize"),uDecodePositions:n.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:n.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var o=this.program.depth;this.handles.depth={aVertex:o.getAttribute("SCENEJS_aVertex"),aMorphVertex:o.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:o.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:o.getUniform("SCENEJS_uMorphFactor"),uPointSize:o.getUniform("SCENEJS_uPointSize"),uDecodePositions:o.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:o.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var s=this.program.drawTexture;for(this.handles.drawTexture={aVertex:s.getAttribute("SCENEJS_aVertex"),aUV:new Array(t),uDecodeUV:new Array(t),aMorphVertex:s.getAttribute("SCENEJS_aMorphVertex"),uMorphFactor:s.getUniform("SCENEJS_uMorphFactor"),uDecodePositions:s.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:s.getUniform("SCENEJS_uDecodeMorphPosMatrix")},r=0;r<t;r++)this.handles.drawTexture.aUV[r]=s.getAttribute("SCENEJS_aUVCoord"+r),this.handles.drawTexture.uDecodeUV[r]=s.getUniform("SCENEJS_uDecodeUVMatrix"+r);for(var l in this.VAOs)this.VAOs[l]={VAO:null,morphKey1:-1,morphKey2:-1}},e.prototype.recycle=function(){var e=this.program.gl.getExtension("OES_vertex_array_object");if(e)for(var t in this.VAOs)this.VAOs[t].VAO&&(e.deleteVertexArrayOES(this.VAOs[t].VAO),this.VAOs[t].VAO=null),this.VAOs[t].morphKey1=-1,this.VAOs[t].morphKey2=-1},e.prototype.morphDraw=function(e,t,r){t.morphKey1=this.core.key1,t.morphKey2=this.core.key2;var i=this.core.key1,a=this.core.key2,n=this.core.targets[i],o=this.core.targets[a];if(e.aMorphVertex?(e.aVertex.bindArrayBuffer(n.vertexBuf),e.aMorphVertex.bindArrayBuffer(o.vertexBuf),r.bindArray+=2):e.aVertex&&(e.aVertex.bindArrayBuffer(this.core2.vertexBuf),r.bindArray++),e.aMorphNormal?(e.aNormal.bindArrayBuffer(n.normalBuf),e.aMorphNormal.bindArrayBuffer(o.normalBuf),r.bindArray+=2):e.aNormal&&(e.aNormal.bindArrayBuffer(this.core2.normalBuf),r.bindArray++),(e.aMorphTangent||e.aTangent)&&r.hasNormalMap&&e.aMorphTangent&&(e.aTangent.bindArrayBuffer(this.core.getTangents(i,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),e.aMorphTangent.bindArrayBuffer(this.core.getTangents(a,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),r.bindArray+=2),e.aUV)for(var s,l=0,c=e.aUV.length;l<c;l++)(s=this.core2.uvBufs[l])&&e.aUV[l]&&(e.aUV[l].bindArrayBuffer(s),r.bindArray++);e.aColor&&(e.aColor.bindArrayBuffer(this.core2.colorBuf),r.bindArray++)},e.prototype.updateGeoUniforms=function(e){e.uDecodePositions&&e.uDecodePositions.setValue(this.core2.positionDecodeMat)},e.prototype.updateMorphUniforms=function(e){var t=this.core.targets[this.core.key2];e.uDecodePositions&&e.uDecodePositions.setValue(this.core.targets[this.core.key1].positionDecodeMat),e.uDecodeMorphPos&&e.uDecodeMorphPos.setValue(t.positionDecodeMat),e.uMorphFactor&&e.uMorphFactor.setValue(this.core.factor)},e.prototype.draw=function(e,t){var r=this.handles[e],i=this.VAOs[e],a=this.core.targets&&this.core.targets.length;if(r.uPointSize&&r.uPointSize.setValue(this.core2.pointSize),r.uPointUVScale&&r.uPointUVScale.setValue(this.core2.pointUVScale),r.uDecodeUV)for(var n=0,o=r.uDecodeUV.length;n<o;n++)r.uDecodeUV[n]&&r.uDecodeUV[n].setValue(this.core2.uvDecodeMats[n]);if(a?this.updateMorphUniforms(r):this.updateGeoUniforms(r),t.pickTriangle)if(a)if(r.aMorphVertex){var s=this.core.getPickPositions(this.core.key1,this.core2.arrays.indices);s&&r.aVertex.bindArrayBuffer(s),(s=this.core.getPickPositions(this.core.key2,this.core2.arrays.indices))&&r.aMorphVertex.bindArrayBuffer(s),r.aTriColor&&r.aTriColor.bindArrayBuffer(this.core2.getPickColors())}else r.aVertex&&(r.aVertex.bindArrayBuffer(this.core2.vertexBuf),this.core2.indexBuf.bind());else r.aVertex&&r.aVertex.bindArrayBuffer(this.core2.getPickPositions()),r.aTriColor&&r.aTriColor.bindArrayBuffer(this.core2.getPickColors());else{if(i.VAO&&t.VAO){if(t.VAO.bindVertexArrayOES(i.VAO),!a)return;if(i.morphKey1==this.core.key1&&i.morphKey2==this.core.key2)return}else t.VAO&&(t.VAO.bindVertexArrayOES(null),i.VAO=t.VAO.createVertexArrayOES(),t.VAO.bindVertexArrayOES(i.VAO));if(a)this.morphDraw(r,i,t);else{var l;if(r.aVertex&&(r.aVertex.bindArrayBuffer(this.core2.vertexBuf),t.bindArray++),r.aNormal&&(r.aNormal.bindArrayBuffer(this.core2.normalBuf),t.bindArray++),r.aUV)for(n=0,o=r.aUV.length;n<o;n++)(l=this.core2.uvBufs[n])&&r.aUV[n]&&(r.aUV[n].bindArrayBuffer(l),t.bindArray++);r.aColor&&(r.aColor.bindArrayBuffer(this.core2.colorBuf),t.bindArray++),r.aPointScaleRotation&&(r.aPointScaleRotation.bindArrayBuffer(this.core2.pointScaleRotationBuf),t.bindArray++),r.aPointUVTranslate&&(r.aPointUVTranslate.bindArrayBuffer(this.core2.pointUVTranslateBuf),t.bindArray++),r.aTangent&&t.hasNormalMap&&(r.aTangent.bindArrayBuffer(this.core2.getTangents(0)),t.bindArray++)}if(r.aRegionMapUV){var c=t.regionMapUVLayerIdx;if(c>=0){var u=this.core2.uvBufs;c<u.length&&(r.aRegionMapUV.bindArrayBuffer(u[c]),t.bindArray++)}}this.core2.indexBuf&&this.core2.indexBuf.bind()}},SceneJS_ChunkFactory.addChunkType("geometry",e)}(),function(){"use strict";var e=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.build()};e.prototype.build=function(){this.materialCore=this.cores[0],this.textureCore=this.cores[1],this.fresnelCore=this.cores[2],this.cubemapCore=this.cores[3];var e=this.program.draw,t=this.handles.draw={},r=this.handles.drawTexture={};if(this.materialCore&&(t.uMaterialBaseColor=e.getUniform("SCENEJS_uMaterialColor"),t.uMaterialSpecularColor=e.getUniform("SCENEJS_uMaterialSpecularColor"),t.uMaterialEmitColor=e.getUniform("SCENEJS_uMaterialEmitColor"),t.uMaterialShine=e.getUniform("SCENEJS_uMaterialShine"),t.uMetalRoughSpecularf0=e.getUniform("SCENEJS_uMetalRoughSpecularf0")),this.textureCore&&(t.uTexSampler=[],t.uTexMatrix=[],t.uTexBlendFactor=[],o=this.textureCore.layers)){e=this.program.draw;for(var i=0,a=o.length;i<a;i++)t.uTexSampler[i]="SCENEJS_uSampler"+i,t.uTexMatrix[i]=e.getUniform("SCENEJS_uLayer"+i+"Matrix"),t.uTexBlendFactor[i]=e.getUniform("SCENEJS_uLayer"+i+"BlendFactor");r.uDrawSampler="SCENEJS_uDrawSampler"}if(this.fresnelCore){var n=this.fresnelCore;n.diffuse&&(t.uDiffuseFresnelCenterColor=e.getUniform("SCENEJS_uDiffuseFresnelCenterColor"),t.uDiffuseFresnelEdgeColor=e.getUniform("SCENEJS_uDiffuseFresnelEdgeColor"),t.uDiffuseFresnelPower=e.getUniform("SCENEJS_uDiffuseFresnelPower")),n.specular&&(t.uSpecularFresnelCenterColor=e.getUniform("SCENEJS_uSpecularFresnelCenterColor"),t.uSpecularFresnelEdgeColor=e.getUniform("SCENEJS_uSpecularFresnelEdgeColor"),t.uSpecularFresnelPower=e.getUniform("SCENEJS_uSpecularFresnelPower")),n.alpha&&(t.uAlphaFresnelCenterColor=e.getUniform("SCENEJS_uAlphaFresnelCenterColor"),t.uAlphaFresnelEdgeColor=e.getUniform("SCENEJS_uAlphaFresnelEdgeColor"),t.uAlphaFresnelPower=e.getUniform("SCENEJS_uAlphaFresnelPower")),n.transparency&&(t.uTransparencyFresnelCenterColor=e.getUniform("SCENEJS_uTransparencyFresnelCenterColor"),t.uTransparencyFresnelEdgeColor=e.getUniform("SCENEJS_uTransparencyFresnelEdgeColor"),t.uTransparencyFresnelPower=e.getUniform("SCENEJS_uTransparencyFresnelPower")),n.reflect&&(t.uReflectFresnelCenterColor=e.getUniform("SCENEJS_uReflectFresnelCenterColor"),t.uReflectFresnelEdgeColor=e.getUniform("SCENEJS_uReflectFresnelEdgeColor"),t.uReflectFresnelPower=e.getUniform("SCENEJS_uReflectFresnelPower")),n.emit&&(t.uEmitFresnelCenterColor=e.getUniform("SCENEJS_uEmitFresnelCenterColor"),t.uEmitFresnelEdgeColor=e.getUniform("SCENEJS_uEmitFresnelEdgeColor"),t.uEmitFresnelPower=e.getUniform("SCENEJS_uEmitFresnelPower")),n.fragment&&(t.uFragmentFresnelCenterColor=e.getUniform("SCENEJS_uFragmentFresnelCenterColor"),t.uFragmentFresnelEdgeColor=e.getUniform("SCENEJS_uFragmentFresnelEdgeColor"),t.uFragmentFresnelPower=e.getUniform("SCENEJS_uFragmentFresnelPower"))}if(this.cubemapCore){var o=this.cubemapCore.layers;if(t.uCubeMapSampler=new Array(o.length),t.uCubeMapIntensity=new Array(o.length),t.uCubeMapMipLevels=new Array(o.length),o)for(e=this.program.draw,i=0,a=o.length;i<a;i++)t.uCubeMapSampler[i]="SCENEJS_uCubeMapSampler"+i,t.uCubeMapIntensity[i]=e.getUniform("SCENEJS_uCubeMapIntensity"+i),t.uCubeMapMipLevels[i]=e.getUniform("SCENEJS_uCubeMapMipLevels"+i)}},e.prototype.draw=function(e,t){var r,i=this.handles[e];if(this.materialCore&&(i.uMaterialBaseColor&&i.uMaterialBaseColor.setValue(this.materialCore.baseColor),i.uMaterialSpecularColor&&i.uMaterialSpecularColor.setValue(this.materialCore.specularColor),i.uMaterialEmitColor&&i.uMaterialEmitColor.setValue(this.materialCore.emitColor),i.uMaterialSpecular&&i.uMaterialSpecular.setValue(this.materialCore.specular),i.uMaterialShine&&i.uMaterialShine.setValue(this.materialCore.shine),i.uMaterialEmit&&i.uMaterialEmit.setValue(this.materialCore.emit),i.uMaterialAlpha&&i.uMaterialAlpha.setValue(this.materialCore.alpha),i.uMetalRoughSpecularf0&&i.uMetalRoughSpecularf0.setValue(this.materialCore.metalRoughspecularf0)),this.textureCore){var a;if(t.hasNormalMap=!1,a=this.textureCore.layers){var n=this.program[e];if(i.uTexSampler)for(var o=0,s=a.length;o<s;o++)r=a[o],i.uTexSampler[o]&&r.texture&&(n.bindTexture(i.uTexSampler[o],r.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r._matrixDirty&&r.buildMatrix&&r.buildMatrix.call(r),i.uTexMatrix&&i.uTexMatrix[o]&&i.uTexMatrix[o].setValue(r.matrixAsArray),i.uTexBlendFactor&&i.uTexBlendFactor[o]&&i.uTexBlendFactor[o].setValue(r.blendFactor),t.hasNormalMap=t.hasNormalMap||r.isNormalMap);i.uDrawSampler&&(n.bindTexture(i.uDrawSampler,a[this.textureCore.drawLayerIndex].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS)}t.texture=this.textureCore}if(this.fresnelCore){var l=this.fresnelCore;l.diffuse&&(i.uDiffuseFresnelCenterColor&&i.uDiffuseFresnelCenterColor.setValue(l.diffuse.centerColor),i.uDiffuseFresnelEdgeColor&&i.uDiffuseFresnelEdgeColor.setValue(l.diffuse.edgeColor),i.uDiffuseFresnelPower&&i.uDiffuseFresnelPower.setValue(l.diffuse.power)),l.specular&&(i.uSpecularFresnelCenterColor&&i.uSpecularFresnelCenterColor.setValue(l.specular.centerColor),i.uSpecularFresnelEdgeColor&&i.uSpecularFresnelEdgeColor.setValue(l.specular.edgeColor),i.uSpecularFresnelPower&&i.uSpecularFresnelPower.setValue(l.specular.power)),l.alpha&&(i.uAlphaFresnelCenterColor&&i.uAlphaFresnelCenterColor.setValue(l.alpha.centerColor),i.uAlphaFresnelEdgeColor&&i.uAlphaFresnelEdgeColor.setValue(l.alpha.edgeColor),i.uAlphaFresnelPower&&i.uAlphaFresnelPower.setValue(l.alpha.power)),l.transparency&&(i.uTransparencyFresnelCenterColor&&i.uTransparencyFresnelCenterColor.setValue(l.transparency.centerColor),i.uTransparencyFresnelEdgeColor&&i.uTransparencyFresnelEdgeColor.setValue(l.transparency.edgeColor),i.uTransparencyFresnelPower&&i.uTransparencyFresnelPower.setValue(l.transparency.power)),l.reflect&&(i.uReflectFresnelCenterColor&&i.uReflectFresnelCenterColor.setValue(l.reflect.centerColor),i.uReflectFresnelEdgeColor&&i.uReflectFresnelEdgeColor.setValue(l.reflect.edgeColor),i.uReflectFresnelPower&&i.uReflectFresnelPower.setValue(l.reflect.power)),l.emit&&(i.uEmitFresnelCenterColor&&i.uEmitFresnelCenterColor.setValue(l.emit.centerColor),i.uEmitFresnelEdgeColor&&i.uEmitFresnelEdgeColor.setValue(l.emit.edgeColor),i.uEmitFresnelPower&&i.uEmitFresnelPower.setValue(l.emit.power)),l.fragment&&(i.uFragmentFresnelCenterColor&&i.uFragmentFresnelCenterColor.setValue(l.fragment.centerColor),i.uFragmentFresnelEdgeColor&&i.uFragmentFresnelEdgeColor.setValue(l.fragment.edgeColor),i.uFragmentFresnelPower&&i.uFragmentFresnelPower.setValue(l.fragment.power))}if(this.cubemapCore&&(a=this.cubemapCore.layers)&&(n=this.program[e],i.uCubeMapSampler))for(o=0,s=a.length;o<s;o++)r=a[o],i.uCubeMapSampler[o]&&r.texture&&(n.bindTexture(i.uCubeMapSampler[o],r.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,i.uCubeMapIntensity[o]&&i.uCubeMapIntensity[o].setValue(r.intensity),i.uCubeMapMipLevels[o]&&i.uCubeMapMipLevels[o].setValue(r.mipLevels))},SceneJS_ChunkFactory.addChunkType("material",e)}(),function(){"use strict";var e=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.numLights=0,this.numClips=0,this.build()};e.prototype.build=function(){var e=this.program.draw,t=this.program.xray,r=this.program.pick,i=this.program.pickTriangle,a=this.program.depth,n=this.program.drawTexture;this.handles.draw={uPMatrix:e.getUniform("SCENEJS_uPMatrix"),uvMatrix:e.getUniform("SCENEJS_uVMatrix"),uWorldEye:e.getUniform("SCENEJS_uWorldEye"),uFogParams:e.getUniform("SCENEJS_uFogParams"),uFogColor:e.getUniform("SCENEJS_uFogColor"),uCanvasRes:e.getUniform("SCENEJS_uCanvasRes"),uAmbientColor:e.getUniform("SCENEJS_uAmbientColor"),uLightColor:[],uLightDir:[],uLightPos:[],uLightCutOff:[],uLightSpotExp:[],uLightAttenuation:[],uInnerCone:[],uOuterCone:[],uClipNormalAndDist:[],uClipFadeDistance:[],uPBRLightMapIntensity:e.getUniform("SCENEJS_uPBRLightMapIntensity"),uPBRLightMapMipLevels:e.getUniform("SCENEJS_uPBRLightMapMipLevels"),uPBRReflectionMapIntensity:e.getUniform("SCENEJS_uPBRReflectionMapIntensity"),uPBRReflectionMapMipLevels:e.getUniform("SCENEJS_uPBRReflectionMapMipLevels")};var o=this.program;for(this.numLights=0;;){var s=e.getUniform("SCENEJS_uLightColor"+this.numLights);if(!s)break;this.handles.draw.uLightColor[this.numLights]=s,this.handles.draw.uLightPos[this.numLights]=o.draw.getUniform("SCENEJS_uLightPos"+this.numLights),this.handles.draw.uLightDir[this.numLights]=o.draw.getUniform("SCENEJS_uLightDir"+this.numLights),this.handles.draw.uLightAttenuation[this.numLights]=o.draw.getUniform("SCENEJS_uLightAttenuation"+this.numLights),this.handles.draw.uInnerCone[this.numLights]=o.draw.getUniform("SCENEJS_uInnerCone"+this.numLights),this.handles.draw.uOuterCone[this.numLights]=o.draw.getUniform("SCENEJS_uOuterCone"+this.numLights),++this.numLights}for(this.handles.xray={uPMatrix:t.getUniform("SCENEJS_uPMatrix"),uvMatrix:t.getUniform("SCENEJS_uVMatrix"),uWorldEye:t.getUniform("SCENEJS_uWorldEye"),uFogParams:t.getUniform("SCENEJS_uFogParams"),uFogColor:t.getUniform("SCENEJS_uFogColor"),uXrayColor:t.getUniform("SCENEJS_uXrayColor"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pick={pickMode:r.getUniform("SCENEJS_uPickMode"),uPMatrix:r.getUniform("SCENEJS_uPMatrix"),uvMatrix:r.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pickTriangle={uPMatrix:i.getUniform("SCENEJS_uPMatrix"),uvMatrix:i.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.depth={uPMatrix:a.getUniform("SCENEJS_uPMatrix"),uvMatrix:a.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.drawTexture={uPMatrix:n.getUniform("SCENEJS_uPMatrix"),uvMatrix:n.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.numClips=0;;){var l=e.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips);if(!l)break;this.handles.draw.uClipNormalAndDist[this.numClips]=l,this.handles.draw.uClipFadeDistance[this.numClips]=e.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.xray.uClipNormalAndDist[this.numClips]=t.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.xray.uClipFadeDistance[this.numClips]=t.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pick.uClipNormalAndDist[this.numClips]=r.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pick.uClipFadeDistance[this.numClips]=r.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pickTriangle.uClipNormalAndDist[this.numClips]=i.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pickTriangle.uClipFadeDistance[this.numClips]=i.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.depth.uClipNormalAndDist[this.numClips]=a.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.depth.uClipFadeDistance[this.numClips]=a.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.drawTexture.uClipNormalAndDist[this.numClips]=n.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.drawTexture.uClipFadeDistance[this.numClips]=n.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),++this.numClips}var c=e.gl,u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array(4)),this.dummyDepthTexture={texture:u,gl:c,bind:function(e){return!!this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0)},unbind:function(e){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},c.bindTexture(c.TEXTURE_2D,null)},e.prototype.draw=function(e,t){this.program[e].bind();var r=this.handles[e];t.textureUnit=0;var i=this.program.gl;if(r.depthMode&&r.depthMode.setValue(t.depthMode),!t.VAO)for(var a=0;a<10;a++)i.disableVertexAttribArray(a);if(r.uPMatrix&&r.uPMatrix.setValue(t.projectionMatrix),r.uvMatrix&&r.uvMatrix.setValue(t.viewMatrix),r.uWorldEye&&r.uWorldEye.setValue(t.cameraEye),r.uAmbientColor&&r.uAmbientColor.setValue(t.ambientColor),r.uLightColor)for(a=0;a<this.numLights;++a){var n=t.lights[a];r.uLightColor[a]&&r.uLightColor[a].setValue(n.color),r.uLightPos[a]&&(r.uLightPos[a].setValue(n.pos),r.uLightAttenuation[a]&&r.uLightAttenuation[a].setValue(n.attenuation)),r.uLightDir[a]&&r.uLightDir[a].setValue(n.dir),r.uInnerCone[a]&&r.uInnerCone[a].setValue(n.innerCone),r.uOuterCone[a]&&r.uOuterCone[a].setValue(n.outerCone)}if(this.numClips>0)for(a=0;a<this.numClips;++a){var o=t.clips.clips[a];r.uClipNormalAndDist[a]&&r.uClipNormalAndDist[a].setValue(o.normalAndDist),r.uClipFadeDistance[a]&&r.uClipFadeDistance[a].setValue(o.fadeDistance)}t.reflection&&t.reflection.texture&&(this.program[e].bindTexture("SCENEJS_uPBRReflectionMapSampler",t.reflection.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uPBRReflectionMapIntensity&&r.uPBRReflectionMapIntensity.setValue(t.reflection.intensity),r.uPBRReflectionMapMipLevels&&r.uPBRReflectionMapMipLevels.setValue(t.reflection.mipLevels)),t.lightmap&&t.lightmap.texture&&(this.program[e].bindTexture("SCENEJS_uPBRLightMapSampler",t.lightmap.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uPBRLightMapIntensity&&r.uPBRLightMapIntensity.setValue(t.lightmap.intensity),r.uPBRLightMapMipLevels&&r.uPBRLightMapMipLevels.setValue(t.lightmap.mipLevels)),r.uFogParams&&r.uFogParams.setValue(t.fogParams),r.uFogColor&&r.uFogColor.setValue(t.fogColor),r.uXrayColor&&r.uXrayColor.setValue(t.xrayColor),this.program[e].bindTexture("SCENEJS_uDepthBuffer",t.depthBuffer||this.dummyDepthTexture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uCanvasRes&&r.uCanvasRes.setValue(t.canvasResolution),r.pickMode&&r.pickMode.setValue(t.pickObject?0:2),t.useProgram++},SceneJS_ChunkFactory.addChunkType("program",e)}(),function(){"use strict";var e=function(e,t,r,i){this.id=e,this.numericId=t,this.program=r;for(var a=0,n=(i=i||[]).length;a<n;++a)i[a]&&i[a].empty&&(i[a]=null);this.cores=i,this.handles={},this.build()};e.prototype.build=function(){this.core=this.cores[0],this.handles.draw={uRegionMapRegionColor:this.program.draw.getUniform("SCENEJS_uRegionMapRegionColor"),uRegionMapHighlightFactor:this.program.draw.getUniform("SCENEJS_uRegionMapHighlightFactor"),uRegionMapHideAlpha:this.program.draw.getUniform("SCENEJS_uRegionMapHideAlpha")},this.sampleName="SCENEJS_uRegionMapSampler"},e.prototype.draw=function(e,t){var r=this.core.texture,i=this.handles[e]||{};r?(t.regionData=this.core.regionData,this.program.draw.bindTexture(this.sampleName,r,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,i.uRegionMapRegionColor&&i.uRegionMapRegionColor.setValue(this.core.regionColor),i.uRegionMapHighlightFactor&&i.uRegionMapHighlightFactor.setValue(this.core.highlightFactor),i.uRegionMapHideAlpha&&i.uRegionMapHideAlpha.setValue(this.core.hideAlpha),t.regionMapUVLayerIdx=this.core.uvLayerIdx):t.regionMapUVLayerIdx=-1},SceneJS_ChunkFactory.addChunkType("regionMap",e)}(),function(){function e(e){var t,r,i;e.size?(t=e.size[0],r=e.size[1],i=e.size[2]):(t=e.xSize||1,r=e.ySize||1,i=e.zSize||1);var a="geometry/box_"+t+"_"+r+"_"+i+(e.wire?"wire":"_solid");return this.getScene().hasCore("geometry",a)?{type:"geometry",coreId:a}:{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:a,positions:new Float32Array([t,r,i,-t,r,i,-t,-r,i,t,-r,i,t,r,i,t,-r,i,t,-r,-i,t,r,-i,t,r,i,t,r,-i,-t,r,-i,-t,r,i,-t,r,i,-t,r,-i,-t,-r,-i,-t,-r,i,-t,-r,-i,t,-r,-i,t,-r,i,-t,-r,i,t,-r,-i,-t,-r,-i,-t,r,-i,t,r,-i]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),uv:new Float32Array([t,r,0,r,0,0,t,0,0,r,0,0,t,0,t,r,t,0,t,r,0,r,0,0,t,r,0,r,0,0,t,0,0,0,t,0,t,r,0,r,0,0,t,0,t,r,0,r]),indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}SceneJS.Types.addType("geometry/box",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t="geometry/quad"+(e.wire?"wire":"_solid");return this.getScene().hasCore("geometry",t)?{type:"geometry",coreId:t}:{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:t,positions:[1,1,0,-1,1,0,-1,-1,0,1,-1,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3]}}SceneJS.Types.addType("geometry/quad",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t=e.latitudeBands||30,r=e.longitudeBands||30,i=e.radius||1,a="geometry/sphere_"+(e.wire?"wire":"_solid")+i+"_"+r+"_"+t;if(this.getScene().hasCore("geometry",a))return{type:"geometry",coreId:a};for(var n=[],o=[],s=[],l=0;l<=t;l++)for(var c=l*Math.PI/t,u=Math.sin(c),_=Math.cos(c),h=0;h<=r;h++){var f=2*h*Math.PI/r,d=Math.sin(f),m=Math.cos(f)*u,p=_,g=d*u,y=h/r,v=l/t;o.push(m),o.push(p),o.push(g),s.push(y),s.push(v),n.push(i*m),n.push(i*p),n.push(i*g)}var S=[];for(l=0;l<t;l++)for(h=0;h<r;h++){var E=l*(r+1)+h,b=E+r+1;S.push(E+1),S.push(b+1),S.push(b),S.push(E+1),S.push(b),S.push(E)}return{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:a,positions:new Float32Array(n),normals:new Float32Array(o),uv:new Float32Array(s),indices:S}}SceneJS.Types.addType("geometry/sphere",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t=e.width||1,r=e.height||1,i=e.widthSegments||1,a=e.heightSegments||1,n="geometry/plane_"+(1==e.wire?"wire_":"")+r+"_"+i+"_"+a;if(this.getScene().hasCore("geometry",n))return{type:"geometry",coreId:n};var o,s,l,c,u,_,h,f=[],d=[],m=[],p=[],g=t/2,y=r/2,v=i,S=a,E=v+1,b=S+1,I=t/v,x=r/S;for(s=0;s<b;s++)for(o=0;o<E;o++)l=s*x-y,f.push(o*I-g),f.push(-l),f.push(0),d.push(0),d.push(0),d.push(1),m.push(o/v),m.push(1-s/S);for(s=0;s<S;s++)for(o=0;o<v;o++)u=o+E*(s+1),_=o+1+E*(s+1),h=o+1+E*s,p.push(c=o+E*s),p.push(u),p.push(_),p.push(_),p.push(h),p.push(c);return{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:n,positions:new Float32Array(f),normals:new Float32Array(d),uv:new Float32Array(m),indices:p}}SceneJS.Types.addType("geometry/plane",{construct:function(t){this.addNode(e.call(this,t))}})}(),(("undefined"!=typeof window?window:module.exports).GrowingPacker=function(){}).prototype={fit:function(e){var t,r,i,a=e.length;for(this.root={x:0,y:0,w:a>0?e[0].w:0,h:a>0?e[0].h:0},t=0;t<a;t++)(i=e[t]).fit=(r=this.findNode(this.root,i.w,i.h))?this.splitNode(r,i.w,i.h):this.growNode(i.w,i.h)},findNode:function(e,t,r){return e.used?this.findNode(e.right,t,r)||this.findNode(e.down,t,r):t<=e.w&&r<=e.h?e:null},splitNode:function(e,t,r){return e.used=!0,e.down={x:e.x,y:e.y+r,w:e.w,h:e.h-r},e.right={x:e.x+t,y:e.y,w:e.w-t,h:r},e},growNode:function(e,t){var r=e<=this.root.w,i=t<=this.root.h,a=r&&this.root.w>=this.root.h+t;return i&&this.root.h>=this.root.w+e?this.growRight(e,t):a?this.growDown(e,t):i?this.growRight(e,t):r?this.growDown(e,t):null},growRight:function(e,t){return this.root={used:!0,x:0,y:0,w:this.root.w+e,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:e,h:this.root.h}},(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null},growDown:function(e,t){return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root},(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null}},function(){"use strict";var e=window.Human={},t="17.1.3";t=t.indexOf("ENGINE_VERSION")>0?"qa":t;var r,i="2.0.1";i=i.indexOf("API_VERSION")>0?"qa":i,e.VERSION=t,e.API_VERSION=i,e.deployed=!(window.location.hostname.match(/(localhost|192\.168\.11\.\d{1,3})/)||"file:"===window.location.protocol),e.locale="en-US",e.timer=window.performance||window.Date,e.stats={trackingDownloadSize:!1,jsonDownloadTotal:0,geometryDownloadTotal:0,textureDownloadTotal:0,jsonDownloadSizes:{},geometryDownloadSizes:{},textureDownloadSizes:{},loadSequence:{startTime:e.timer.now(),moduleRequest:0,moduleLoaded:0,assetsRequested:0,assetsLoaded:0,texturesRequested:0,texturesLoaded:0},loadTimes:{preModule:0,moduleDownload:0,preAsset:0,assetDownload:0,preTexture:0,textureDownload:0},trackDownloadSize:function(){window.pako&&(this.trackingDownloadSize=!0)}},e.canvasId="theCanvas",e.annotationCanvasId="annotationCanvas",e.containerId="container",e.XML_HTTP_JSON_SUPPORTED=((r=new XMLHttpRequest).open("GET","/"),r.responseType="json","json"===r.responseType),e.ELEMENT_REMOVE_SUPPORTED="function"==typeof Element.prototype.remove,SceneJS.bind("error",(function(t){e._error("WEBGL",t.errorName,t.exception,!0)})),e.error=function(t,r){return void 0===r&&(r=t,t="ERROR"),e._error("HUMAN",t,r,!1)},e.fatalError=function(t,r){return void 0===r&&(r=t,t="ERROR"),e._error("HUMAN",t,r,!0)},e._error=function(t,r,i,a){return e.events.fire("error",{type:t,name:r,message:i,fatal:a,log:e.log.messages.join("\n"),stack:e.utils.getStackTrace(),webglInfo:SceneJS.WEBGL_INFO}),i}}(),function(){"use strict";Human.Component=function(){},Human.Component.prototype={_init:function(e){this._ctx=e,this._handleMap=new Human.utils.Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},publish:function(e,t,r){r||(this._topicPubs[e]=t);var i=this._topicSubs[e];if(i)for(var a in i)i.hasOwnProperty(a)&&i[a].call(this,t)},on:function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var i=this._handleMap.addItem();r[i]=t,this._handleTopics[i]=e;var a=this._topicPubs[e];return a&&t.call(this,a),i},off:function(e,t){var r,i;if(t){for(var a in i=this._topicSubs[r=e])if(i[a]===t){e=a;break}}else r=this._handleTopics[e];r&&(delete this._handleTopics[e],(i=this._topicSubs[r])&&delete i[e],this._handleMap.removeItem(e))},once:function(e,t){var r=this,i=this.on(e,(function(e){r.off(i),t(e)}))}}}(),function(){"use strict";var e=Human.math={X_AXIS:vec3.fromValues(1,0,0),Y_AXIS:vec3.fromValues(0,1,0),Z_AXIS:vec3.fromValues(0,0,1),VEC3_ZEROS:vec3.fromValues(0,0,0),VEC3_ONES:vec3.fromValues(1,1,1),TO_RADIANS:Math.PI/180},t=vec3.create(),r=vec3.create();e.clamp=function(e,t,r){return e<t?t:e>r?r:e},e.nextPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.sign=function(e){return e>0?1:e<0?-1:0},e.lerpScalar=function(e,t,r,i,a){return i+(e-t)/(r-t)*(a-i)},e.lerpVec3=function(e,t,r,i,a,n){var o=(e-t)/(r-t);return(n=n||vec3.create())[0]=i[0]+o*(a[0]-i[0]),n[1]=i[1]+o*(a[1]-i[1]),n[2]=i[2]+o*(a[2]-i[2]),n},e.triangleNormal=function(e,i,a,n){var o=t,s=r;return vec3.subtract(o,i,e),vec3.subtract(s,a,e),vec3.cross(n,o,s),vec3.normalize(n,n),n},e.getShortRotation=function(e,t){var r=t>e?1:-1,i=(t-e)*r;return(i=(i+Math.PI)%(2*Math.PI)-Math.PI)*r},e.lerpRadian=function(t,r,i){return r+t*e.getShortRotation(r,i)},e.lerpVec3Cylindrical=function(t,r,i,a,n,o){var s=(t-r)/(i-r);return(o=o||vec3.create())[0]=a[0]+s*(n[0]-a[0]),o[1]=e.lerpRadian(s,a[1],n[1]),o[2]=a[2]+s*(n[2]-a[2]),o},Human.math.decompressPosition=function(e,t,r){e[0]=t[0]*r[0]+r[12],e[1]=t[1]*r[5]+r[13],e[2]=t[2]*r[10]+r[14]},Human.math.decompressUV=function(e,t,r){e[0]=t[0]*r[0]+r[6],e[1]=t[1]*r[4]+r[7]},Human.math.vec3ObjToArray=function(e,t){var r=t||vec3.create();return r[0]=e.x||0,r[1]=e.y||0,r[2]=e.z||0,r},Human.math.vec3ArrayToObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.cartesianToCylindrical=function(e,t){var r=t||vec3.create();return r[0]=Math.sqrt(e[0]*e[0]+e[2]*e[2]),r[1]=Math.atan2(e[0],e[2]),r[2]=e[1],r},e.cylindricalToCartesian=function(e,t){var r=t||vec3.create();return r[0]=e[0]*Math.sin(e[1]),r[1]=e[2],r[2]=e[0]*Math.cos(e[1]),r},e.AxisBox3=function(e,t){this.verts=[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]},e.easeOut=function(e,t,r){var i=e*e;return t+r*(-1*i*i+i*e*4+-6*i+4*e)},e.easeIn=function(t,r,i){return 1-e.easeOut(1-t,r,i)},e.easeInOut=function(t,r,i){return t<.5?e.easeIn(2*t,r,i)/2:.5*e.easeOut(2*t-1,r,i)+.5},e.getBoundaryCenter=function(e,t){var r=t||vec3.create();return r[0]=.5*(e.xmax+e.xmin),r[1]=.5*(e.ymax+e.ymin),r[2]=.5*(e.zmax+e.zmin),r};var i=vec3.create();e.getBoundaryDiag=function(e){return i[0]=e.xmax-e.xmin,i[1]=e.ymax-e.ymin,i[2]=e.zmax-e.zmin,vec3.length(i)};var a=mat4.create(),n=mat4.create(),o=mat4.create(),s=mat4.create(),l=mat4.create();e.buildRotationScaleMat3=function(e,t,r){return t=t||this.VEC3_ZEROS,mat4.fromScaling(a,r=r||this.VEC3_ONES),mat4.fromZRotation(n,t[2]*this.TO_RADIANS),mat4.fromYRotation(o,t[1]*this.TO_RADIANS),mat4.fromXRotation(s,t[0]*this.TO_RADIANS),mat4.multiply(l,s,a),mat4.multiply(l,o,l),mat4.multiply(l,n,l),mat3.fromMat4(e,l)}}(),function(){"use strict";var e=Math.abs,t=Math.cos,r=Math.sin,i=Math.atan2,a=Math.sqrt,n=Math.pow,o={x:0,y:0,z:0},s={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,t){var r=t(e),i=r.x*r.x+r.y*r.y;return void 0!==r.z&&(i+=r.z*r.z),a(i)},length:function(e){var t,r=0,i=s.Tvalues.length;for(t=0;t<i;t++)r+=s.Cvalues[t]*s.arcfn(.5*s.Tvalues[t]+.5,e);return.5*r},map:function(e,t,r,i,a){return i+(e-t)/(r-t)*(a-i)},lerp:function(e,t,r){var i={x:t.x+e*(r.x-t.x),y:t.y+e*(r.y-t.y)};return t.z&&r.z&&(i.z=t.z+e*(r.z-t.z)),i},pointToString:function(e){var t=e.x+"/"+e.y;return void 0!==e.z&&(t+="/"+e.z),t},pointsToString:function(e){return"["+e.map(s.pointToString).join(", ")+"]"},angle:function(e,t,r){var n=t.x-e.x,o=t.y-e.y,s=r.x-e.x,l=r.y-e.y,c=n*l-o*s,u=a(n*n+o*o),_=a(s*s+l*l);return i(c,(n/=u)*(s/=_)+(o/=u)*(l/=_))},dist:function(e,t){var r=e.x-t.x,i=e.y-t.y;return a(r*r+i*i)},abcratio:function(t,r){if(2!==r&&3!==r)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var i=n(t,r)+n(1-t,r);return e((i-1)/i)},projectionratio:function(e,t){if(2!==t&&3!==t)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;var r=n(1-e,t);return r/(n(e,t)+r)},align:function(e,a){var n=a.p1.x,o=a.p1.y,s=-i(a.p2.y-o,a.p2.x-n);return e.map((function(e){return{x:(e.x-n)*t(s)-(e.y-o)*r(s),y:(e.x-n)*r(s)+(e.y-o)*t(s)}}))}},l=Human.math.bezier=function(t){var r=t&&t.forEach?t:[].slice.call(arguments),i=!1;if("object"==typeof r[0]){i=r.length;var a=[];r.forEach((function(e){["x","y","z"].forEach((function(t){void 0!==e[t]&&a.push(e[t])}))})),r=a}var n=!1,o=r.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(6!==o&&8!==o&&9!==o&&12!==o&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var l=!n&&(9===o||12===o)||t&&t[0]&&void 0!==t[0].z;this._3d=l;for(var c=[],u=0,_=l?3:2;u<o;u+=_){var h={x:r[u],y:r[u+1]};l&&(h.z=r[u+2]),c.push(h)}this.order=c.length-1,this.points=c;var f=["x","y"];l&&f.push("z"),this.dims=f,this.dimlen=f.length,function(t){for(var r=s.align(c,{p1:c[0],p2:c[t.order]}),i=0;i<r.length;i++)if(e(r[i].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};function c(e,t,r,i,a){void 0===a&&(a=.5);var n=s.projectionratio(a,e),o=1-n,l={x:n*t.x+o*i.x,y:n*t.y+o*i.y},c=s.abcratio(a,e);return{A:{x:r.x+(r.x-l.x)/c,y:r.y+(r.y-l.y)/c},B:r,C:l}}l.quadraticFromPoints=function(e,t,r,i){if(void 0===i&&(i=.5),0===i)return new l(t,t,r);if(1===i)return new l(e,t,t);var a=c(2,e,t,r,i);return new l(e,a.A,r)},l.cubicFromPoints=function(e,t,r,i,a){void 0===i&&(i=.5);var n=c(3,e,t,r,i);void 0===a&&(a=s.dist(t,n.C));var o=a*(1-i)/i,u=s.dist(e,r),_=(r.x-e.x)/u,h=(r.y-e.y)/u,f=n.A;return new l(e,{x:e.x+(f.x+(t.x-a*_-f.x)/(1-i)-e.x)/i,y:e.y+(f.y+(t.y-a*h-f.y)/(1-i)-e.y)/i},{x:r.x+(f.x+(t.x+o*_-f.x)/i-r.x)/(1-i),y:r.y+(f.y+(t.y+o*h-f.y)/i-r.y)/(1-i)},r)},l.prototype={valueOf:function(){return this.toString()},toString:function(){return s.pointsToString(this.points)},update:function(){this.dpoints=[];for(var e=this.points,t=e.length,r=t-1;t>1;t--,r--){for(var i,a=[],n=0;n<r;n++)i={x:r*(e[n+1].x-e[n].x),y:r*(e[n+1].y-e[n].y)},this._3d&&(i.z=r*(e[n+1].z-e[n].z)),a.push(i);this.dpoints.push(a),e=a}this.computedirection()},computedirection:function(){var e=this.points,t=s.angle(e[0],e[this.order],e[1]);this.clockwise=t>0},length:function(){return s.length(this.derivative.bind(this))},_lut:[],getLUT:function(e){if(this._lut.length===(e=e||100))return this._lut;this._lut=[];for(var t=0;t<=e;t++)this._lut.push(this.compute(t/e));return this._lut},on:function(e,t){t=t||5;for(var r,i=this.getLUT(),a=[],n=0,o=0;o<i.length;o++)s.dist(r=i[o],e)<t&&(a.push(r),n+=o/i.length);return!!a.length&&n/a.length},get:function(e){return this.compute(e)},point:function(e){return this.points[e]},compute:function(e){if(0===e)return this.points[0];if(1===e)return this.points[this.order];var t,r=this.points,i=1-e;if(1===this.order)return t={x:i*r[0].x+e*r[1].x,y:i*r[0].y+e*r[1].y},this._3d&&(t.z=i*r[0].z+e*r[1].z),t;if(this.order<4){var a,n,s,l=i*i,c=e*e,u=0;return 2===this.order?(r=[r[0],r[1],r[2],o],a=l,n=i*e*2,s=c):3===this.order&&(a=l*i,n=l*e*3,s=i*c*3,u=e*c),t={x:a*r[0].x+n*r[1].x+s*r[2].x+u*r[3].x,y:a*r[0].y+n*r[1].y+s*r[2].y+u*r[3].y},this._3d&&(t.z=a*r[0].z+n*r[1].z+s*r[2].z+u*r[3].z),t}for(var _=JSON.parse(JSON.stringify(this.points));_.length>1;){for(var h=0;h<_.length-1;h++)_[h]={x:_[h].x+(_[h+1].x-_[h].x)*e,y:_[h].y+(_[h+1].y-_[h].y)*e},void 0!==_[h].z&&(_[h]=_[h].z+(_[h+1].z-_[h].z)*e);_.splice(_.length-1,1)}return _[0]},derivative:function(e){var t,r,i=1-e,a=0,n=this.dpoints[0];2===this.order&&(n=[n[0],n[1],o],t=i,r=e),3===this.order&&(t=i*i,r=i*e*2,a=e*e);var s={x:t*n[0].x+r*n[1].x+a*n[2].x,y:t*n[0].y+r*n[1].y+a*n[2].y};return this._3d&&(s.z=t*n[0].z+r*n[1].z+a*n[2].z),s}}}(),function(){"use strict";var e=Human.math.intersections={},t=vec3.create(),r=vec3.create(),i=[new Float32Array([1,0,0]),new Float32Array([0,1,0]),new Float32Array([0,0,1]),new Float32Array([-1,0,0]),new Float32Array([0,-1,0])];e.pointAabb=function(e,t,r){return!(e[0]<t[0]||e[0]>r[0]||e[1]<t[1]||e[1]>r[1]||e[2]<t[2]||e[2]>r[2])},e.aabbAabb=function(e,t,r,i){return!(t[0]<r[0]||i[0]<e[0]||t[1]<r[1]||i[1]<e[1]||t[2]<r[2]||i[2]<e[2])},e.rayAabb=function(e,t,r,i,a){for(var n=0,o=Number.POSITIVE_INFINITY,s=Math.abs,l=Math.min,c=Math.max,u=0;u<3;++u)if(s(t[u])<1e-8){if(e[u]<r[u]||e[u]>i[u])return!1}else{var _=(r[u]-e[u])/t[u],h=(i[u]-e[u])/t[u];if(_>h){var f=_;_=h,h=f}if((n=c(n,_))>(o=l(o,h)))return!1}return a&&(a[0]=n,a[1]=o),!0};var a=new Float32Array(3),n=new Float32Array(3),o=new Float32Array(3),s=new Float32Array(3),l=new Float32Array(3);e.rayTriangle=function(e,t,r,i,c,u){vec3.sub(a,i,r),vec3.sub(n,c,r),vec3.cross(s,t,n);var _=vec3.dot(s,a);if(_>-1e-8&&_<1e-8)return!1;var h=1/_;vec3.sub(o,e,r);var f=h*vec3.dot(s,o);if(f<0||f>1)return!1;vec3.cross(l,o,a);var d=h*vec3.dot(l,t);if(d<0||f+d>1)return!1;var m=h*vec3.dot(l,n);return!(m<1e-8||(u&&m<u.t&&(u.u=f,u.v=d,u.w=1-f-d,u.t=m),0))},e.pointPolyhedron=function(e,t){var r=0,a=0,n=t.getObject();if(!n)return!1;for(var o=0,s=i.length;o<s;++o)p(e,i[o],n.getKdTree(),n)%2==1?++r:++a;return r>a},e.rayPolyhedron=function(e,t,r,i){var a=r.getObject();return a?(i=i||{t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1},p(e,t,a.getKdTree(),a,i)>0?i:null):null},e.planeAabb=function(e,t,r,i){var a=i[0],n=i[1],o=i[2];if(e[0]>=0&&(a=r[0]),e[1]>=0&&(n=r[1]),e[2]>=0&&(o=r[2]),a*e[0]+n*e[1]+o*e[2]+t>0)return-1;var s=r[0],l=r[1],c=r[2];return e[0]>=0&&(s=i[0]),e[1]>=0&&(l=i[1]),e[2]>=0&&(c=i[2]),s*e[0]+l*e[1]+c*e[2]+t>0?0:1},e.planesAabb=function(e,t,r,i){for(var a=1,n=e.length,o=0;o<n;++o){var s=e[o],l=this.planeAabb(s.n,s.d,t,r);if(i&&(i[o]=l),l<1&&(a=l),-1===a)break}if(i&&o<n)for(var c=5;c>o;--c)i[c]=void 0;return a};var c=mat4.create(),u=mat3.create(),_=vec3.create(),h=vec3.create(),f=vec3.create(),d=vec3.create(),m=vec3.create();function p(t,r,i,a,n){if(!e.rayAabb(t,r,i.bb.min,i.bb.max))return 0;if(i.triangles){for(var o=i.triangles,s=0,l=0,c=o.length;l<c;++l)a.getTrianglePositionOnSurface(3*o[l],S,E,b),e.rayTriangle(t,r,S,E,b,n)&&(n&&(n.triangleIndex=o[l]),++s);return s}return p(t,r,i.left,a,n)+p(t,r,i.right,a,n)}e.pointObject=function(e,t){var r=Human.scene.objects[t],i=r.getBoundary();if(d[0]=i.xmin,d[1]=i.ymin,d[2]=i.zmin,m[0]=i.xmax,m[1]=i.ymax,m[2]=i.zmax,!this.pointAabb(e,d,m))return!1;mat4.invert(c,r.getWorldMatrix()),vec3.transformMat4(_,e,c);for(var a=0,n=r.renderables.length;a<n;++a){var o=r.renderables[a];if(d[0]=(i=o.boundary).xmin,d[1]=i.ymin,d[2]=i.zmin,m[0]=i.xmax,m[1]=i.ymax,m[2]=i.zmax,this.pointAabb(_,d,m)){var s=o.geometryNode;if(s&&this.pointPolyhedron(_,s))return!0}}return!1},e.rayObjectAabb=function(e,t,r,i){var a=Human.scene.objects[r].getBoundary();return d[0]=a.xmin,d[1]=a.ymin,d[2]=a.zmin,m[0]=a.xmax,m[1]=a.ymax,m[2]=a.zmax,this.rayAabb(e,t,d,m,i)},e.rayObject=function(e,t,r,i,a){var n=Human.scene.objects[r];if(!this.rayObjectAabb(e,t,r))return null;mat4.invert(c,n.getWorldMatrix()),vec3.transformMat4(h,e,c),mat3.fromMat4(u,c),vec3.transformMat3(f,t,u);for(var o=0,s=n.renderables.length;o<s;++o){var l=n.renderables[o];if(!a||a(l)){var _=l.boundary;if(d[0]=_.xmin,d[1]=_.ymin,d[2]=_.zmin,m[0]=_.xmax,m[1]=_.ymax,m[2]=_.zmax,this.rayAabb(h,f,d,m)){var p=l.geometryNode;if(p){var g=this.rayPolyhedron(h,f,p,i);if(g)return g}}}}return null},e.raySceneAabb=function(t,r,i){var a=[];return function t(r,i,a,n,o){if(!a.left){for(var s=a.objects,l=0,c=s.length;l<c;++l){var u=s[l],_=u.objectId;n&&!n(u)||e.rayObjectAabb(r,i,_,g)&&o.push({object:u,tmin:g[0],tmax:g[1]})}return o}return e.rayAabb(r,i,a.bb.min,a.bb.max)?(t(r,i,a.left,n,o),t(r,i,a.right,n,o),o):o}(t,r,Human.scene.getKdTree(),i,a),a.length>0?(a.sort(v),a):null},e.rayScene=function(e,t,r,i){var a=[],n=this.raySceneAabb(e,t,r);if(n)for(var o=0,s=n.length;o<s;++o){var l=n[o].object.objectId,c={t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1,objectId:l};this.rayObject(e,t,l,c,i)&&a.push(c)}return a.length>0?(a.sort(y),a):null},e.spherePolyhedron=function(i,a,n){var o=t,s=r;return o[0]=a[0]-n,o[1]=a[1]-n,o[2]=a[2]-n,s[0]=a[0]+n,s[1]=a[1]+n,s[2]=a[2]+n,x(i,(function(t){return e.aabbAabb(t.bb.min,t.bb.max,o,s)}),(function(e,t,r){return function(e,t,r,i,a){vec3.subtract(C,r,e),vec3.subtract(T,t,e),vec3.cross(N,T,C),vec3.cross(A,N,T);var n=vec3.length(C);vec3.scale(A,A,n*=n),vec3.cross(P,C,N);var o=vec3.length(T);vec3.scale(P,P,o*=o),vec3.add(A,A,P);var s=vec3.length(N);vec3.scale(D,A,1/(2*(s*=s)));var l=vec3.length(D);return vec3.add(M,e,D),vec3.subtract(w,i,M),vec3.length(w)<=l+a}(e,t,r,a,n)}))},e.sphereInPolyhedron=function(i,a,n){var o=t,s=r;return o[0]=a[0]-n,o[1]=a[1]-n,o[2]=a[2]-n,s[0]=a[0]+n,s[1]=a[1]+n,s[2]=a[2]+n,x(i,(function(t){return e.aabbAabb(t.bb.min,t.bb.max,o,s)}),(function(e,t,r){return function(e,t,r,i,a){var n=a*a,o=e[0]-i[0],s=e[1]-i[1],l=e[2]-i[2],c=o*o+s*s+l*l;return!(c>n||(c=(o=t[0]-i[0])*o+(s=t[1]-i[1])*s+(l=t[2]-i[2])*l)>n||(c=(o=r[0]-i[0])*o+(s=r[1]-i[1])*s+(l=r[2]-i[2])*l)>n)}(e,t,r,a,n)}))};var g=new Float32Array(2);function y(e,t){return e.t-t.t}function v(e,t){return e.tmin-t.tmin}var S=new Float32Array(3),E=new Float32Array(3),b=new Float32Array(3),I=[];function x(e,t,r){var i=[],a=e.getObject();if(!a)return i;for(I.length=0,I.push(a.getKdTree());I.length>0;){var n=I.pop();if(t(n)&&(n.left&&I.push(n.left),n.right&&I.push(n.right),n.triangles))for(var o=0,s=n.triangles.length;o<s;++o)a.getTrianglePositionOnSurface(3*n.triangles[o],S,E,b),r(S,E,b)&&i.push(n.triangles[o])}return i}var C=new Float32Array(3),T=new Float32Array(3),N=new Float32Array(3),D=new Float32Array(3),A=new Float32Array(3),P=new Float32Array(3),M=new Float32Array(3),w=new Float32Array(3)}(),function(){"use strict";Human.utils=Human.utils||{};var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],t=1347834371;function r(e,t){return e<t?-1:e>t?1:0}function i(e,r,i,a){var n=new XMLHttpRequest;n.open("GET",e,!0),n.timeout=0,n.responseType=r,n.onerror=function(){a(new Error("Failed request ("+e+"): "+n.status+" - "+n.statusText))},n.onload=window.localContentOnly?function(){e.endsWith("-etc1.pvr")&&new DataView(n.response).getInt32(0)!==t?a(new Error("Failed offline PVR get request: "+n.status+" - "+n.statusText)):i(n.response)}:function(){200===n.status?i(n.response):a&&a(new Error("Failed network request ("+e+"): "+n.status+" - "+n.statusText))},n.send(null)}Human.utils.leftPad=function(e,t,r){for(;e.length<r;)e=t+e;return e},Human.utils.toHexString=function(t){for(var r="";t>0;)r=e[15&t]+r,t>>=4;return r},Human.utils.floatRGBToHexString=function(e,t,r){return"#"+this.leftPad(this.toHexString(Math.floor(255*e)),"0",2)+this.leftPad(this.toHexString(Math.floor(255*t)),"0",2)+this.leftPad(this.toHexString(Math.floor(255*r)),"0",2)},Human.utils.isArray=function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},Human.utils.isObject=function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},Human.utils.isPrimitive=function(e){return null===e||!!(typeof e).match(/^(string|number|boolean|undefined)$/)},Human.utils.isString=function(e){return"string"==typeof e||e instanceof String},Human.utils.filterInPlace=function(e,t){for(var r=0,i=0,a=e.length;i<a;i++)t(e[i])?e[i-r]=e[i]:r++;return e.length=e.length-r,e},Human.utils.getStackTrace=function(){var e,t=new Error;if(t.stack)e=t.stack;else try{throw t}catch(r){e=r.stack}return e||null},Human.utils.extend=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},Human.utils.apply=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Human.utils.applyIf=function(e,t){for(var r in e)e.hasOwnProperty(r)&&null==t[r]&&(t[r]=e[r]);return t},Human.utils.applyIf2=function(e,t){e=e||{};var r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=void 0!==e[i]?e[i]:t[i]);return r},Human.utils.shallowClone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Human.utils.deepClone=function(e){if(null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;var t;if(Array.isArray(e)){t=new Array(e.length);for(var r=0,i=e.length;r<i;++r)t[r]=Human.utils.deepClone(e[r]);return t}for(var a in t={},e)t[a]=Human.utils.deepClone(e[a]);return t},Human.utils.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},Human.utils.getDir=function(e){var t=e.lastIndexOf("/");return t>-1?e.substring(0,t>0?t+1:0):""},Human.utils.async=function(e){setTimeout(e,0)},Human.utils.noop=function(){},Human.utils.getKeys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t},Human.utils.createUUID=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],t=["8","9","A","B"],r=[],i=0;i<38;i++)switch(i){case 8:case 13:case 18:r.push("-");break;case 14:r.push("4");break;case 19:r.push(t[Math.round(3*Math.random())]);break;default:r.push(e[Math.round(15*Math.random())])}return r.join("")},Human.utils.binarySearch=function(e,t,i,a){a=a||{index1:null,index2:null,value1:null,value2:null};var n,o,s,l=0,c=e.length-1;if((i=i||r)(e[0],t)>0)return a.index1=null,a.value1=null,a.index2=0,a.value2=e[0],a;if(i(e[c],t)<0)return a.index1=c,a.value1=e[c],a.index2=null,a.value2=null,a;for(;l<=c;){if(s=e[(n=Math.floor((l+c)/2))+1],i(o=e[n],t)<=0&&i(s,t)>=0)return a.index1=n,a.index2=n+1,a.value1=o,a.value2=s,a;i(o,t)>0?c=n-1:l=n+1}},Human.utils.atos=function(e,t,r){t=t||0,r=r||e.byteLength;var i=new Uint8Array(e,t,r);return new TextDecoder("utf-8").decode(i)},Human.utils.atoj=function(e,t,r){return JSON.parse(Human.utils.atos(e,t,r))},Human.utils.benchmark=function(e,t){t=t||1e7;for(var r=performance.now(),i=0;i<t;i++)e();r=performance.now()-r,console.log("Total time: "+r.toFixed(3)+"ms"),console.log("Time / operation: "+(r/t).toExponential(3)+"ms")},Human.utils.setRandomVisibleObjects=function(e){for(var t=Object.keys(Human.scene.objects).filter((function(e){return Human.scene.objects[e].isLeaf()})),r={},i=0;i<e;i++){var a=Math.floor(Math.random()*t.length);r[t.splice(a,1)]=!0}Human.scene.setEnabledObjects({objectIds:r,replace:!0})},Human.utils.getText=function(e,t,r){i(e,"text",t,r)},Human.XML_HTTP_JSON_SUPPORTED?Human.utils.getJSON=function(e,t,r){i(e,"json",t,r)}:Human.utils.getJSON=function(e,t,r){this.getText(e,(function(e){t(JSON.parse(e))}),r)},Human.utils.getBinary=function(e,t,r){i(e,"arraybuffer",t,r)},Human.utils.elementVisible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},Human.ELEMENT_REMOVE_SUPPORTED?Human.utils.removeElement=function(e){e.remove()}:Human.utils.removeElement=function(e){null!==e.parentNode&&e.parentNode.removeChild(e)},Human.utils.boundaryToScreen=function(e){var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=[e.xmin,e.ymin,e.zmin,1],o=[e.xmin,e.ymin,e.zmax,1],s=[e.xmin,e.ymax,e.zmin,1],l=[e.xmin,e.ymax,e.zmax,1],c=[e.xmax,e.ymin,e.zmin,1],u=[e.xmax,e.ymin,e.zmax,1],_=[e.xmax,e.ymax,e.zmin,1],h=[e.xmax,e.ymax,e.zmax,1],f=Human.renderer.getViewMat(),d=Human.renderer.getProjMat(),m=mat4.create();mat4.multiply(m,d,f),vec4.transformMat4(n,n,m),t=Math.min(t,n[0]/n[3]),r=Math.max(r,n[0]/n[3]),i=Math.min(i,n[1]/n[3]),a=Math.max(a,n[1]/n[3]),vec4.transformMat4(o,o,m),t=Math.min(t,o[0]/o[3]),r=Math.max(r,o[0]/o[3]),i=Math.min(i,o[1]/o[3]),a=Math.max(a,o[1]/o[3]),vec4.transformMat4(s,s,m),t=Math.min(t,s[0]/s[3]),r=Math.max(r,s[0]/s[3]),i=Math.min(i,s[1]/s[3]),a=Math.max(a,s[1]/s[3]),vec4.transformMat4(l,l,m),t=Math.min(t,l[0]/l[3]),r=Math.max(r,l[0]/l[3]),i=Math.min(i,l[1]/l[3]),a=Math.max(a,l[1]/l[3]),vec4.transformMat4(c,c,m),t=Math.min(t,c[0]/c[3]),r=Math.max(r,c[0]/c[3]),i=Math.min(i,c[1]/c[3]),a=Math.max(a,c[1]/c[3]),vec4.transformMat4(u,u,m),t=Math.min(t,u[0]/u[3]),r=Math.max(r,u[0]/u[3]),i=Math.min(i,u[1]/u[3]),a=Math.max(a,u[1]/u[3]),vec4.transformMat4(_,_,m),t=Math.min(t,_[0]/_[3]),r=Math.max(r,_[0]/_[3]),i=Math.min(i,_[1]/_[3]),a=Math.max(a,_[1]/_[3]),vec4.transformMat4(h,h,m),t=Math.min(t,h[0]/h[3]),r=Math.max(r,h[0]/h[3]),i=Math.min(i,h[1]/h[3]),a=Math.max(a,h[1]/h[3]);var p=Human.renderer.canvas.canvas[0],g=(.5*t+.5)*p.width,y=(.5*r+.5)*p.width,v=p.height-(.5*a+.5)*p.height,S=p.height-(.5*i+.5)*p.height;return{min:[g,v],max:[y,S],pixelCoverage:(y-g)*(S-v)}},Human.utils.visibleAssetReport=function(){var e={totalVertices:0,totalTriangles:0,objectStats:{},geometryStats:{},textureStats:{},objectsByTrianglesPerPixel:null,objectsByTexelsPerPixel:null,geometriesByTriangleCount:null,texturesBySize:null},t=Human.scene.objects,r=Object.keys(Human.scene.enabledObjects).filter((function(e){return!!Human.scene.objects[e].geometry&&!!Human.scene.objects[e].material}));e.objectsByTrianglesPerPixel=new Array(r.length),e.objectsByTexelsPerPixel=new Array(r.length);for(var i=e.geometryStats,a=e.textureStats,n=0,o=r.length;n<o;++n){for(var s=r[n],l=t[s],c=l.geometry._core.arrays,u=c.positions.length/3,_=c.indices.length/3,h=l.material.textures||[],f=new Array(h.length),d=0;d<h.length;++d){var m=h[d]._core,p=m.compressedSrc||m.src||m.uri;f[d]=a[p]=a[p]||{src:p,width:m.width,height:m.height,objectIds:[],count:0,atlasSharing:0,atlas:!1,adjustedTexels:m.width*m.height},a[p].count++;for(var g=!0,y=0,v=a[p].objectIds.length;y<v;++y){var S=t[a[p].objectIds[y]].geometryId;S!==l.geometryId&&(a[p].atlas=!0),S===l.geometryId&&(g=!1)}g&&a[p].atlasSharing++,a[p].objectIds.push(s)}l._setBoundaryDirty();var E=Human.utils.boundaryToScreen(l.getBoundary());e.totalVertices+=u,e.totalTriangles+=_,e.objectsByTexelsPerPixel[n]=e.objectsByTrianglesPerPixel[n]=e.objectStats[s]={objectId:s,vertices:u,triangles:_,textures:f,canvasBounds:{min:E.min,max:E.max},pixelCoverage:E.pixelCoverage,trianglesPerPixel:_/E.pixelCoverage,texelsPerPixel:0},i[l.geometryId]=i[l.geometryId]||{geometryId:l.geometryId,vertices:u,triangles:_,totalVertices:0,totalTriangles:0,objectIds:[],count:0},i[l.geometryId].count++,i[l.geometryId].totalVertices+=u,i[l.geometryId].totalTriangles+=_,i[l.geometryId].objectIds.push(s)}return Object.keys(a).forEach((function(e){var t=a[e];t.atlas&&(t.adjustedTexels/=t.atlasSharing)})),e.objectsByTrianglesPerPixel.sort((function(e,t){return t.trianglesPerPixel-e.trianglesPerPixel})),e.objectsByTexelsPerPixel.filter((function(e){return e.textures.length>0})).forEach((function(e){e.textures.sort((function(e,t){return t.adjustedTexels-e.adjustedTexels})),e.texelsPerPixel=e.textures[0].adjustedTexels/e.pixelCoverage})),e.objectsByTexelsPerPixel.sort((function(e,t){return t.texelsPerPixel-e.texelsPerPixel})),e.geometriesByTriangleCount=Object.keys(i).map((function(e){return i[e]})).sort((function(e,t){return t.triangles*t.count-e.triangles*e.count})),e.texturesBySize=Object.keys(a).map((function(e){return a[e]})).sort((function(e,t){return t.adjustedTexels-e.adjustedTexels})),e},Human.utils.textGzipSize=function(e){if(window.pako){var t=(new TextEncoder).encode(e);return pako.deflate(t).byteLength}return 0},Human.utils.binaryGzipSize=function(e){if(window.pako){var t=new Uint8Array(e);return pako.deflate(t).byteLength}return 0},Human.utils.drawKdTree=function(e,t){!function e(t,r){if(t){var i=t.bb.min,a=t.bb.max,n=i[0],o=i[1],s=i[2],l=a[0],c=a[1],u=a[2];r.addNode({type:"geometry",primitive:"lines",positions:[n,c,s,l,c,s,l,c,s,l,o,s,l,o,s,n,o,s,n,o,s,n,c,s,n,c,s,n,c,u,l,c,s,l,c,u,n,o,s,n,o,u,l,o,s,l,o,u,n,c,u,l,c,u,l,c,u,l,o,u,l,o,u,n,o,u,n,o,u,n,c,u]}),e(t.left,r),e(t.right,r)}}(e,t)},Human.utils.kdTreeStats=function(e){var t={numNodes:0,numLeaves:0,numObjects:0,averageLeafObjects:0,depthSum:0,averageDepth:0};return function e(t,r,i){r++,i.numNodes++;var a=t.triangles||t.objects;a?(i.numLeaves++,i.numObjects+=a.length,i.depthSum+=r):(e(t.left,r,i),e(t.right,r,i))}(e,0,t),t.averageDepth=t.depthSum/t.numLeaves,t.averageLeafObjects=t.numObjects/t.numLeaves,t},Human.utils.loadScript=function(e,t){var r=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src=e,null!==t&&(i.onload=t),r.appendChild(i)}}(),Human.utils.Map=function(e,t){"use strict";this.items=e||[];var r=t||0,i=r;"number"!=typeof r&&(i=r+"0"),this.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e=arguments[1],t}for(;;){var a;if(e=arguments[0],"number"==typeof r?a=i++:(a=r+parseInt(i.substr(r.length)),i=r+(parseInt(i.substr(r.length))+1)),!this.items[a])return this.items[a]=e,a}},this.removeItem=function(e){var t=this.items[e];return void 0!==t&&(delete this.items[e],i=e),t}},Human.utils.IDPool=function(e){"use strict";var t=(e=e||{}).prefix||"id",r=t.length,i=[],a={},n={};this.getId=function(e){if(e){if(a[e]||n[e])throw"ID already in use: "+e;return a[e]=!0,e}for(var r,o=0,s=i.length;o<s;o++)if(!i[o]&&!a[r=t+o])return i[o]=!0,n[r]=!0,r;return i.push(!0),n[r=t+(i.length-1)]=!0,r},this.containsId=function(e){return void 0!==a[e]||void 0!==n[e]},this.putId=function(e){a[e]?delete a[e]:n[e]&&(i[parseInt(e.substr(r))]=!1,delete n[e])}},function(){"use strict";var e=Human.utils.selection={},t=function(e){this.defunct="function"!=typeof e?t.defunct:function(){return!1},this.tokens=[],this.rules=[],this.remove=0,this.state=0,this.index=0,this.input=""};t.prototype.addRule=function(e,t,r){var i=e.global;if(!i){var a="g";e.multiline&&(a+="m"),e.ignoreCase&&(a+="i"),e=new RegExp(e.source,a)}return"[object Array]"!==Object.prototype.toString.call(r)&&(r=[0]),this.rules.push({pattern:e,global:i,action:t,start:r}),this},t.prototype.setInput=function(e){return this.remove=0,this.state=0,this.index=0,this.tokens.length=0,this.input=e,this},t.prototype.lex=function(){if(this.tokens.length)return this.tokens.shift();var e;for(this.reject=!0;this.index<=this.input.length;){for(var t=this.scan().splice(this.remove),r=this.index;t.length&&this.reject;){var i=t.shift(),a=i.result,n=i.length;if(this.index+=n,this.reject=!1,this.remove++,e=i.action.apply(this,a),this.reject)this.index=a.index;else if(void 0!==e)switch(Object.prototype.toString.call(e)){case"[object Array]":this.tokens=e.slice(1),e=e[0];default:return n&&(this.remove=0),e}}var o=this.input;if(r<o.length)if(this.reject){if(this.remove=0,void 0!==(e=this.defunct.call(this,o.charAt(this.index++))))return"[object Array]"===Object.prototype.toString.call(e)?(this.tokens=e.slice(1),e[0]):e}else this.index!==r&&(this.remove=0),this.reject=!0;else{if(!t.length)break;this.reject=!0}}},t.prototype.scan=function(){for(var e=[],t=0,r=this.state,i=this.index,a=this.input,n=0,o=this.rules.length;n<o;n++){var s=this.rules[n],l=s.start,c=l.length;if(!c||l.indexOf(r)>=0||r%2&&1===c&&!l[0]){var u=s.pattern;u.lastIndex=i;var _=u.exec(a);if(_&&_.index===i){var h=e.push({result:_,action:s.action,length:_[0].length});for(s.global&&(t=h);--h>t;){var f=h-1;if(e[h].length>e[f].length){var d=e[h];e[h]=e[f],e[f]=d}}}}}return e};var r,i=function(e){this.table=e};i.prototype.parse=function(e){for(var t,r=e.length,i=this.table,a=[],n=[],o=0;o<r;)switch(t=e[o++]){case"(":n.unshift(t);break;case")":for(;n.length&&"("!==(t=n.shift());)a.push(t);if("("!==t)throw new Error("Mismatched parentheses.");break;default:if(i.hasOwnProperty(t)){for(;n.length;){var s=n[0];if("("===s)break;var l=i[t],c=l.precedence,u=i[s].precedence;if(c>u||c===u&&"right"===l.associativity)break;a.push(n.shift())}n.unshift(t)}else a.push(t)}for(;n.length;)"("!==(t=n.shift())&&a.push(t);return a},[].push(r=function(){return this});var a={};function n(e,t,i){var a,n,o=Object.create(null),s=[];if(e.forEach((function(e){a=r.call(e),o[a]||(o[a]={value:e,freq:1})})),t.forEach((function(e){a=r.call(e),o[a]?1===o[a].freq&&(o[a].freq=3):o[a]={value:e,freq:2}})),i){for(n in o)i(o[n].freq)&&s.push(o[n].value);return s}return o}a.union=function(e,t){return n(e,t,(function(){return!0}))},a.intersection=function(e,t){return n(e,t,(function(e){return 3===e}))},a.difference=function(e,t){return n(e,t,(function(e){return e<3}))},a.complement=function(e,t){return n(e,t,(function(e){return 1===e}))},a.equals=function(e,t){var r,i=0,a=Math.pow(2,53),o=n(e,t);for(r in o)i=Math.max(i,o[r].freq),a=Math.min(a,o[r].freq);return 3===a&&3===i};var o={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},s={"<AND>":function(e,t){return e&&t},"<OR>":function(e,t){return e||t},"<NOT>":function(e){return!e}};e.StringMatcher=function(){this.lexer=new t((function(){return!1})),this.parser=new i(o),this.operators=s,this.lexer.addRule(/[A-z0-9]+/i,(function(e){return e})),this.lexer.addRule(/(<[A-Z]+>)/,(function(e){return e})),this.lexer.addRule(/[\(\+\-\*\/\)]/,(function(e){return e}))},e.StringMatcher.prototype.parse=function(e){this.lexer.setInput(e);for(var t=[],r=this.lexer.lex();r;)t.push(r),r=this.lexer.lex();return this.parser.parse(t)},e.StringMatcher.prototype.match=function(e,t){var r,i,a=this.parse(t),n=[];return a.forEach((function(t){this.operators.hasOwnProperty(t)?"<NOT>"!==t?(r=n.pop(),n.push(this.operators[t](r))):(i=n.pop(),r=n.pop(),n.push(this.operators[t](r,i))):(t="("+t+")",n.push(!!e.match(new RegExp(t,"i"))))})),n[0]};var l={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},c={"<AND>":function(e,t){return a.intersection(e,t)},"<OR>":function(e,t){return a.union(e,t)},"<XOR>":function(e,t){return a.difference(e,t)},"<NOT>":function(e,t){return a.complement(e,t)}};e.GraphMatcher=function(){this.lexer=new t((function(){return!1})),this.parser=new i(l),this.operators=c,this.lexer.addRule(/[A-z0-9\-]+/i,(function(e){return e})),this.lexer.addRule(/(<[A-Z]+>)/,(function(e){return e})),this.lexer.addRule(/[\(\)]/,(function(e){return e}))},e.GraphMatcher.prototype.parse=function(e){this.lexer.setInput(e);for(var t=[],r=this.lexer.lex();r;)t.push(r),r=this.lexer.lex();return this.parser.parse(t)},e.GraphMatcher.prototype.match=function(e,t){var r,i,a=this.parse(t),n=[],o=this;return a.forEach((function(t){o.operators.hasOwnProperty(t)?(i=n.pop(),r=n.pop(),Array.isArray(r)||(r=e.access(r)),Array.isArray(i)||(i=e.access(i)),n.push(o.operators[t](r,i))):Array.isArray(t)?n.push(t):n.push(e.access(t))})),n[0]}}(),function(){"use strict";var e=Human.events={},t={},r=[{}],i={},a={},n=!1;e.addBinder=function(e,r){(t[e]||(t[e]=[])).push(r)},e.createChannel=function(t){var i=r.length;return r.push({}),t&&t.enabled&&e.enableChannel(i,t.enabled),i},e.enableChannel=function(e,t){i[e]=t},e.onEvent=e.on=function(){var e,n,o,s;if("number"==typeof arguments[0]){if((e=arguments[0])>r.length-1)return void Human.log.error("Human_event.onEvent","Channel not created: "+e+" - should be created first with Human.events.createChannel");n=arguments[1],o=arguments[2],s=arguments[3]}else if("object"==typeof arguments[0]){var l=arguments[0];o=l.fn;var c=t[n=l.type];if(c)for(var u=l.mask||{},_=0,h=c.length;_<h;_++)c[_](u,o);e=null!=l.channel?l.channel:0,s=l.options}else e=0,n=arguments[0],o=arguments[1],s=arguments[2];i[e]=!s||null==s.enable||s.enable,s=s||{};var f=r[e];f||(f=r[e]={});var d=f[n];d||(f[n]=d=[]);var m={fn:o,priority:void 0===s.priority?d.length:s.priority,once:s.once};for(_=0;_<d.length;_++)if(d[_].priority>m.priority)return void d.splice(_,0,m);d.push(m),a[n]&&m.fn(a[n])},e.once=function(t,r){e.on(t,r,{once:!0})},e.fireEvent=e.fire=function(e,t,o){if(!n){for(var s,l=0,c=r.length;l<c;l++)if(i[l]&&(s=r[l][e])){var u,_;t||(t={});for(var h=0,f=s.length;h<f;h++)if(_=s[h])try{_.fn(t),_.once&&(u||(u=[]),u.push(h))}catch(d){Human.log.error(d)}if(u)for(h=u.length-1;h>=0;h--)s.splice(u[h],1)}o&&(a[e]=t)}},e.blockEvents=function(e){n=!0;try{e()}catch(t){Human.log.error(t.message)}n=!1},e.unEvent=e.off=function(e,t,i){if(null==i)i=0;else if(i>=r.length||i<0)throw"Channel does not exist: "+i;var a=r[i];a||(a=r[i]={});var n=a[e];n||(a[e]=n=[]);for(var o=n.length;o--;)n[o].fn===t&&n.splice(o,1)}}(),function(){"use strict";var e=Human.properties={},t=new Human.utils.IDPool;e.properties={};var r={},i={},a={};e.subscribe=function(n){var o=(n=n||{}).propId;if(!o)return Human.log.error("Human.properties.subscribe","Param expected: propId"),null;var s=n.callback;if(!s)return Human.log.error("Human.properties.subscribe","Param expected: callback"),null;if(n.subId&&t.containsId(n.subId))return Human.log.error("Human.properties.subscribe","Subscription already exists with this ID: "+n.subId),null;var l=n.value,c=t.getId(n.subId);return e.properties[o]?((i[o]||(i[o]={}))[c]=s,l&&(e.properties[o]=l),r[c]=s,a[c]=o,s(l),c):((i[o]||(i[o]={}))[c]=s,null==l&&(l={}),e.properties[o]=l,r[c]=s,a[c]=o,s(l),c)},e.resubscribe=function(t,n){var o=r[t];if(o){var s=a[t],l=e.properties[n];s&&l&&(i[s]&&delete i[s][t],(i[n]||(i[n]={}))[t]=o,a[t]=n,o(l))}else Human.log.warn("Human.properties.resubscribe","Subscription not found: '"+t+"'")},e.set=function(t){var r,a;for(var n in t)if(t.hasOwnProperty(n)&&(e.properties[n]=r=t[n],a=i[n]))for(var o in a)a.hasOwnProperty(o)&&a[o](r)},e.unsubscribe=function(e){var t=a[e];t&&(delete a[e],delete i[t][e])},e.query=function(t){if(!t)return e.properties;var r;if(t){var i=new RegExp(t);for(var a in r={},e.properties)e.properties.hasOwnProperty(a)&&i.test(a)&&(r[a]=e.properties[a])}return r};var n={"annotations.margins":{top:80,left:50,right:50,bottom:50},"annotations.labelWidth":120,"annotations.horizontalLines":!1,"annotations.fadeoutAngle":100,"annotation.layout.labelWidth":100,"annotations.layout.type":"draggable","camera.optics.far":5e3,"camera.optics.fov":55,"camera.optics.near":.1,"camera.zoomLimits":{max:300,min:.01},"fog.color":[1,1,1],"fog.density":.01,"fog.enabled":!1,"fog.end":1e3,"fog.max":1,"fog.min":0,"fog.mode":1,"fog.start":0,"timeline.autoPlay.enabled":!1,"timeline.autoPlay.type":"play","timeline.chapterCamerasEnabled":!0,"timeline.prevNextMode":"scrub","ui.mouseWheel.capture":!0,"ui.zoom.mouseWheel.enabled":!0};e.getDefaults=function(e){return e?n[e]:Human.utils.shallowClone(n)},e.setDefaults=function(e){Human.utils.apply(e,n)},e.applyDefaults=function(){this.set(n)}}(),function(){"use strict";var e=Human.log={};e.LOG_NONE=0,e.LOG_DEBUG=1,e.LOG_INFO=2,e.LOG_WARN=3,e.LOG_ERROR=4,e.messages=[],e.maxMessages=100;var t=["none","debug","info","warn","error"],r=e.messageBuf=[],i=e.LOG_WARN,a=e.reporters={};function n(e){return e.length<45?e+"                                                           ".substr(0,45-e.length):e}function o(r,i){var a=t[i].toUpperCase();e.messages.length>e.maxMessages&&e.messages.shift(),e.messages.push(r="["+a+"]\t"+r)}e.setLevel=function(e){i=e},e.getLevel=function(){return i},e.log=function(n,s){switch(s=null==s?e.INFO:s){case e.LOG_DEBUG:i<=e.LOG_DEBUG&&window.console&&window.console.debug&&(window.console.debug(n),o(n,s),Human.events.fire("_log.debug",n));break;case e.LOG_ERROR:i<=e.LOG_ERROR&&window.console&&window.console.error&&(window.console.error(n),o(n,s),Human.events.fire("_log.error",n));break;case e.LOG_INFO:i<=e.LOG_INFO&&window.console&&window.console.info&&(window.console.info(n),o(n,s),Human.events.fire("_log.info",n));break;case e.LOG_WARN:i<=e.LOG_WARN&&window.console&&window.console.warn&&(window.console.warn(n),o(n,s),Human.events.fire("_log.warn",n))}var l={message:n,level:t[s]};for(var c in a)a.hasOwnProperty(c)&&Human.events.fire(c,l);r.length>200&&(r.length=0,r.push({message:"Logging buffer exceeded max length of 200 - messages to this point were flushed",level:t[e.LOG_WARN]})),r.push(l)},e.debug=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_DEBUG)},e.error=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_ERROR)},e.info=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_INFO)},e.warn=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_WARN)},Human.events.on("error",(function(t){e.error(t.message)}))}(),function(){"use strict";var e,t,r,i=Human.request={};i.getHashStr=function(){return window.location.hash},i.getHashParams=function(){if(!t||e!==window.location.hash){t={};for(var r,i=window.location.hash.slice(1).split(","),a=0,n=i.length;a<n;a++)r=i[a].split("="),t[r[0]]=r[1];e=window.location.hash}return t},i.getHashParam=function(r){return t&&e===window.location.hash||i.getHashParams(),t[r]},i.getSearchStr=function(){return window.location.search},i.getSearchParams=function(){if(!r){r={};for(var e,t=window.location.search.slice(1).split("&"),i=0,a=t.length;i<a;i++)e=t[i].split("="),r[e[0]]=e[1]}return r},i.getSearchParam=function(e){return r||i.getSearchParams(),r[e]}}(),function(){"use strict";var e=Human.rpc={windowClientEnabled:!0};e._procedures={},e._eventMap={};var t=[],r=!1,i={},a=[];function n(e,t){this.procName=e,this.callId=t}function o(e){return!e||"object"!=typeof e||e!==window&&("string"!=typeof e.nodeName||"function"!=typeof e.querySelectorAll||"function"!=typeof e.getElementsByTagName)&&("function"!=typeof e.preventDefault||"function"!=typeof e.stopPropagation)}n.prototype.setResult=function(e){for(var r=0,i=t.length;r<i;r++)t[r](this.callId,e)},n.prototype.info=function(e){Human.log.info(this.procName,e)},n.prototype.warn=function(e){Human.log.warn(this.procName,e)},n.prototype.error=function(e){Human.log.error(this.procName,e)},e.define=function(t,a,o){e._procedures[t]&&Human.log.warn("Human.rpc.define","Redefining procedure: "+t),((o=o||{}).hidden||r)&&(i[t]=!0),e._procedures[t]=function(e,r){a.call(new n(t,e),r||{})}},e.defineEvent=function(t,r){e._eventMap[t]&&Human.log.warn("Human.rpc.defineEvent","Redefining event: "+t),e._eventMap[t]=r||t},e.enableEvent=function(t,r,i){if(e._eventMap[r]){var a=e._eventMap[r];"string"==typeof a?Human.events[i?"once":"on"](a,(function(e){t.setResult(e)})):function(e,t,r){var i=!1,a=r?"once":"on",n=t.events,o=t.map;function s(t){if(!r||!i){i=!0;var a=o?o(t):t;null!==a&&e.setResult(a||{})}}t.init&&t.init();for(var l=0,c=n.length;l<c;l++)Human.events[a](n[l],s)}(t,a,i)}else Human.log.warn("Human.rpc.enableEvent","Event: "+r+" not defined.")},e.getProcedures=function(){var t=Object.keys(e._procedures);return Human.utils.filterInPlace(t,(function(e){return!i[e]})),t},e.getEvents=function(){return["human.ready"].concat(Object.keys(e._eventMap))},e.hideDefinitions=function(e){r=!0;try{e()}finally{r=!1}},e.onResult=function(e){t.push(e)},e.call=function(t,r,i){var a=e._procedures[r];a?a(t,i):Human.log.warn("Human.rpc.call","Target procedure not found: "+r)},e.log=function(e){a.length>1e4&&a.shift(),a.push({engine_version:Human.VERSION,api_version:Human.API_VERSION,identifier:e,category:e.split(".")[0]})},e.getLog=function(){return a},e.logPending=function(){return a.length>0},e.resetLog=function(){a.length=0},e.filterUnsafeProperties=function(e){if(!Human.utils.isObject(e))return e;var t={};for(var r in e)e.hasOwnProperty(r)&&o(e[r])&&(t[r]=e[r]);return t}}(),function(){"use strict";Human.rpc.define("human.info",(function(){this.setResult({version:Human.VERSION,webglInfo:SceneJS.WEBGL_INFO,apiFunctions:Human.rpc.getProcedures().sort(),apiEvents:Human.rpc.getEvents().sort()})})),Human.rpc.defineEvent("human.error","error")}(),function(){"use strict";function e(e){var t=(e=Human.view.annotations.annotations[e.annotationId]).pin.marker;return{annotationId:e.annotationId,title:e.label.title,description:e.label.description,objectId:e.object?e.object.objectId:null,position:{x:t.pos[0],y:t.pos[1],z:t.pos[2]},canvasPosition:{x:t.canvasPos[0],y:t.canvasPos[1]},occludable:e.occludable,shown:e.pin.shown}}Human.rpc.define("annotations.info",(function(){var t=Human.view.annotations.annotations,r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=e(t[i]));this.setResult(r)})),Human.rpc.define("annotations.create",(function(t){t.saved=!1!==t.saved,t.position&&(t.pos=t.position);var r=Human.view.annotations.createAnnotation(t);this.setResult(e(r))})),Human.rpc.define("annotations.update",(function(e){Human.view.annotations.updateAnnotation(e.annotationId,e),this.setResult(!0)})),Human.rpc.define("annotations.show",(function(e){var t=Human.view.annotations.annotations[e];t?t.setShown(!0):Human.view.annotations.setShown(!0),this.setResult(!0)})),Human.rpc.define("annotations.hide",(function(e){var t=Human.view.annotations.annotations[e];t?t.setShown(!1):Human.view.annotations.setShown(!1),this.setResult(!0)})),Human.rpc.define("annotations.destroy",(function(e){"string"==typeof e&&(e={annotationId:e});var t=Human.view.annotations.annotations[e.annotationId];t&&t.destroy(),this.setResult(!0)})),Human.rpc.defineEvent("annotations.created",{events:["annotations.created"],map:e}),Human.rpc.defineEvent("annotations.destroyed"),Human.rpc.defineEvent("annotations.shown",{events:["annotations.shown"],map:function(e){if(!e.shown)return null}}),Human.rpc.defineEvent("annotations.hidden",{events:["annotations.shown"],map:function(e){if(e.shown)return null}})}(),function(){"use strict";function e(){var e=Human.renderer.camera.getLookAt();return{position:e.eye,target:e.look,up:e.up,zoom:Human.renderer.camera.getZoom()}}Human.rpc.define("camera.set",(function(e){var t=this;e.position&&(e.eye=e.position),e.target&&(e.look=e.target),"direct"===e.animationStyle&&(e.cylindricalView=!1),e.animate?Human.renderer.camera.fly.flyTo(e,(function(){t.setResult(!0)})):Human.renderer.camera.fly.jumpTo(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.orbit",(function(e){e.yaw&&Human.renderer.camera.rotateY(e.yaw),e.pitch&&Human.renderer.camera.rotateX(e.pitch),this.setResult(!0)})),Human.rpc.define("camera.pan",(function(e){Human.renderer.camera.pan({x:e.x||0,y:e.y||0,z:e.z||0}),this.setResult(!0)})),Human.rpc.define("camera.zoom",(function(e){var t="number"==typeof e?e:e.factor;t=Math.max(0,Math.min(t||0,1)),Human.renderer.camera.setZoom(t),this.setResult(!0)})),Human.rpc.define("camera.path",(function(e){var t=this;Human.renderer.camera.fly.flyAlongCurvePath(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.info",(function(){this.setResult(e())})),Human.rpc.define("camera.reset",(function(){var e=this;Human.init.resetCamera((function(){e.setResult(!0)}))})),Human.rpc.defineEvent("camera.updated",{events:["camera.rested"],map:e})}(),Human.rpc.hideDefinitions((function(){"use strict";Human.rpc.define("apiEvents.on",(function(e){Human.rpc.enableEvent(this,e,!1)})),Human.rpc.define("apiEvents.once",(function(e){Human.rpc.enableEvent(this,e,!0)}))})),function(){"use strict";Human.rpc.define("input.disable",(function(){Human.input.setEnabled(!1)})),Human.rpc.define("input.enable",(function(){Human.input.setEnabled(!0)}))}(),function(){"use strict";function e(e){var t,r={},i=Human.rpc.fmaIds,a=Human.modules.MALE_STATE_ID,n=Human.modules.FEMALE_STATE_ID;for(var o in e)if(e.hasOwnProperty(o)){t=i[o];for(var s=0;s<t.length;s++){var l=Human.scene.objects[a+"-"+t[s]]||Human.scene.objects[n+"-"+t[s]];l&&(r[l.objectId]=e[o])}}return r}var t,r;function i(e){if(!e)return null;var t={};return t.objectId=e.objectId,t.canvasPosition={x:e.canvasPos[0],y:e.canvasPos[1]},e.worldPos&&(t.position={x:e.worldPos[0],y:e.worldPos[1],z:e.worldPos[2]}),t.mode=e.mode,t}Human.rpc.define("scene.load",(function(e){var t=this,r=null,i=null;function a(e){Human.modules.deactivate(e,(function(){var t=Human.modules.modules[e].rootObjects;Human.modules.unload(e,t,["tweens","reflections","lights","geometry","material","transform","morph"],(function(){Human.modules.destroy(e)}))}))}for(var n in"string"==typeof e?".json"===e.slice(-5)?i=e:r=e:(i=e.moduleId,r=e.bookmarkId),Human.modules.activeModules)Human.modules.activeModules.hasOwnProperty(n)&&a(n);if(r)Human.utils.getJSON("/search/bookmarks/data?be="+r,(function(e){Human.bookmarks.restore(e.bookmark,(function(){t.setResult(!0)}))}),(function(){t.setResult(!1)}));else if(i){var o=["material","tweens","reflections","lights","geometry","transform"],s=["morph"],l={camera:!0,cameraCallback:function(){var e=Human.timeline.activeRoot._nowBranch.id;Human.events.fire("chapter.camera.finished",{chapterId:e})},graph:!0,annotations:!1,properties:!0,time:!1,hotspots:!1};Human.modules.fetch(i,(function(){var e=Human.modules.moduleData[i];Human.modules.create(i,e,(function(){var r=function(e){var t=Human.modules.modules[e],r=[];for(var i in t.showObjects)t.showObjects.hasOwnProperty(i)&&t.showObjects[i]&&Human.scene.objects[i]&&r.push(Human.scene.objects[i]);return r}(i);Human.modules.activate(i,0,l,(function(){Human.modules.load(i,r,o,(function(){var a=0;e.animation&&(a=Human.timeline.parsePlayInstruction(e.animation).t),l.annotations=!0,l.graph=!1,Human.modules.activate(i,a,l,(function(){Human.modules.load(i,r,s,(function(){e.animation&&Human.timeline.play(e.animation),Human.events.fire("module.ready",{moduleId:i}),Human.modules.activeModules.hasOwnProperty(i)?t.setResult(!0):t.setResult(!1)}))}))}))}))}))}))}})),Human.rpc.define("scene.pick",(function(e){var t;void 0!==e.x&&(e.canvasX=e.x),void 0!==e.y&&(e.canvasY=e.y),e.rayPick=!1!==e.rayPick,t=e.triggerActions?Human.renderer.pick.pick(e):Human.renderer.pick.queryPick(e),this.setResult(i(t))})),Human.rpc.define("scene.pickingMode",(function(e){"dissect"===e?(Human.events.blockEvents((function(){Human.view.annotations.setEnabled(!1)})),Human.view.dissect.setEnabled(!0)):"annotate"===e?(Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1)})),Human.view.annotations.setEnabled(!0)):"highlight"===e?(Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)})),Human.view.highlight.setEnabled(!0)):"none"===e&&Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1),Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1)})),this.setResult(!0)})),Human.rpc.define("scene.selectionMode",(function(e){"isolate"===e?(Human.events.blockEvents((function(){Human.view.highlight.setEnabled(!1)})),Human.view.isolate.setEnabled(!0)):"highlight"===e?(Human.events.blockEvents((function(){Human.view.isolate.setEnabled(!1)})),Human.view.highlight.setEnabled(!0)):"none"===e&&(Human.events.blockEvents((function(){Human.view.isolate.setEnabled(!1)})),Human.view.highlight.setEnabled(!1)),this.setResult(!0)})),Human.rpc.define("scene.enableXray",(function(){Human.view.xray.setEnabled(!0),this.setResult(!0)})),Human.rpc.define("scene.disableXray",(function(){Human.view.xray.setEnabled(!1),this.setResult(!0)})),Human.rpc.define("scene.showObjects",(function(t){var r=!!t.replace;delete t.replace,t.fmaIds&&(t=e(t.fmaIds)),Human.scene.setEnabledObjects({objects:t,replace:r,fetchAssets:!0}),this.setResult(!0)})),Human.rpc.define("scene.selectObjects",(function(t){var r=!!t.replace;delete t.replace,t.fmaIds&&(t=e(t.fmaIds)),Human.scene.setSelectedObjects({objects:t,replace:r}),this.setResult(!0)})),function(){function e(e,r){function i(e){r[e.objectId]||(r[e.objectId]=t(e))}for(var a=0,n=e.length;a<n;a++)e[a].traverseUp(i)}function t(e){for(var t={objectId:e.objectId,name:e.displayName||"",description:e.description||"",shown:e.shown,selected:e.selected,children:[]},r=0,i=e.objects.length;r<i;r++)t.children.push(e.objects[r].objectId);return t.parent=e.parent?e.parent.objectId:null,t}Human.rpc.define("scene.info",(function(r){var i={},a=Human.modules.activeModules[Object.keys(Human.modules.activeModules)[0]];i.name=a?a.displayName:null;var n,o=i.objects={};if(r.objectId)(n=Human.scene.objects[r.objectId])&&(o[n.objectId]=t(n));else for(var s=0,l=Human.scene.rootObjects.length;s<l;s++)e(Human.scene.rootObjects[s].getRenderableObjects(),o);this.setResult(i)}))}(),Human.rpc.define("scene.transformObject",(function(e){var t=e.objectId,r=Human.scene.objects[t];r?(r.setTransform(e),this.setResult(!0)):(this.error("Scene object not found: '"+t+"'"),this.setResult(!1))})),Human.rpc.define("scene.colorObject",(function(e){var t=e.objectId,r=Human.scene.objects[t];r?(void 0!==e.tintColor&&r.setTintColor&&r.setTintColor(e.tintColor[0],e.tintColor[1],e.tintColor[2]),void 0!==e.saturation&&r.setSaturation&&r.setSaturation(e.saturation),void 0!==e.brightness&&r.setBrightness&&r.setBrightness(e.brightness),void 0!==e.contrast&&r.setContrast&&r.setContrast(e.contrast),void 0!==e.highlight&&r.setHighlight&&r.setHighlight(e.highlight),void 0!==e.xray&&r.setXRay&&r.setXRay(e.xray),void 0!==e.opacity&&r.setOpacity&&r.setOpacity(e.opacity),this.setResult(!0)):(this.error("Scene object not found: '"+t+"'"),this.setResult(!1))})),Human.rpc.define("scene.uncolorObject",(function(e){var t=Human.scene.objects[e.objectId];t&&(t.clearColorModifiers(),t.clearOpacityModifiers(),this.setResult(!0))})),Human.rpc.define("scene.getColor",(function(e){var t=Human.scene.objects[e.objectId];if(t){var r=t.getProperties();this.setResult({tintColor:r.tintColor&&r.tintColor.length?r.tintColor:[1,1,1],brightness:r.brightness,saturation:r.saturation,contrast:r.contrast,opacity:r.opacity})}else this.setResult({})})),Human.rpc.define("scene.enableHighlight",(function(){Human.renderer.highlightColor=new Float32Array([1.5,1.5,.5]),this.setResult(!0)})),Human.rpc.define("scene.disableHighlight",(function(){Human.renderer.highlightColor=new Float32Array([1,1,1]),this.setResult(!0)})),Human.rpc.define("scene.capture",(function(){this.setResult(Human.bookmarks.capture())})),Human.rpc.define("scene.restore",(function(e){var t=this;Human.bookmarks.restore(e,(function(){t.setResult(!0)}))})),Human.rpc.define("scene.reset",(function(){var e=this;Human.init.reset((function(){e.setResult(!0)}))})),Human.rpc.defineEvent("scene.objectsShown",{events:["scene.objectsShown"],map:function(e){return e.enabledObjectsUpdate}}),Human.rpc.defineEvent("scene.objectsSelected",{events:["scene.objectsSelected"],map:function(e){return e.selectedObjectsUpdate}}),Human.rpc.defineEvent("scene.restored","bookmarks.restored"),Human.rpc.defineEvent("scene.picked",{events:["pick.picked"],init:function(){Human.properties.set({"pick.alwaysRayPick":!0})},map:i}),Human.rpc.defineEvent("scene.pickingModeUpdated",{events:["highlight.toggled","dissect.toggled","annotations.toggled"],map:function(){var e;return Human.view.dissect.enabled?e="dissect":Human.view.annotations.enabled?e="annotate":Human.view.highlight.enabled&&(e="highlight"),e===t?null:{pickingMode:t=e}}}),Human.rpc.defineEvent("scene.selectionModeUpdated",{events:["highlight.toggled","isolate.toggled"],map:function(){var e;return(e=Human.view.isolate.enabled?"isolate":Human.view.highlight.enabled?"highlight":"none")===r?null:{selectionMode:r=e}}}),Human.rpc.defineEvent("scene.xrayEnabled",{events:["xray.toggled"],map:function(e){if(!e.enabled)return null}}),Human.rpc.defineEvent("scene.xrayDisabled",{events:["xray.toggled"],map:function(e){if(e.enabled)return null}})}(),function(){"use strict";function e(e){var t=e.split(".json");return 2!==t.length||t[1].startsWith("_")?e:t[0]+".json_"+t[1]}Human.rpc.define("timeline.info",(function(){var e;this.setResult((e=Human.timeline.getTimeFrame(),{time:Human.timeline.time,startTime:e.firstTime,endTime:e.lastTime,chapters:Object.keys(Human.timeline.chapters),playing:Human.timeline.playing}))})),Human.rpc.define("timeline.set",(function(t){t.hasOwnProperty("chapterId")&&(t.chapterId=e(t.chapterId)),Human.timeline.scrub(t),this.setResult(!0)})),Human.rpc.define("timeline.play",(function(t){t.hasOwnProperty("chapterId")&&(t.chapterId=e(t.chapterId)),t.time&&(t.startTime=t.time),t.chapterId&&(t.startChapterId=t.chapterId),Human.timeline.play(t),this.setResult(!0)})),Human.rpc.define("timeline.pause",(function(){Human.timeline.pause(),this.setResult(!0)})),Human.rpc.define("timeline.previousChapter",(function(){Human.timeline.prev(),this.setResult(!0)})),Human.rpc.define("timeline.nextChapter",(function(){Human.timeline.next(),this.setResult(!0)})),Human.rpc.defineEvent("timeline.chapterTransition",{events:["timeline.chapters.activated"],map:function(e){return{previousChapter:e.oldChapterIndex,currentChapter:e.newChapterIndex,time:e.time}}})}(),Human.rpc.hideDefinitions((function(){"use strict";function e(e){var t,r={},i=Human.rpc.fmaIds,a=Human.modules.MALE_STATE_ID,n=Human.modules.FEMALE_STATE_ID;for(var o in e)if(e.hasOwnProperty(o)){t=i[o];for(var s=0;s<t.length;s++){var l=Human.scene.objects[a+"-"+t[s]]||Human.scene.objects[n+"-"+t[s]];l&&(r[l.objectId]=e[o])}}return r}var t,r;Human.rpc.define("bookmarks.capture",(function(){this.setResult(Human.bookmarks.capture())})),Human.rpc.define("bookmarks.restore",(function(e){var t=this;Human.bookmarks.restore(e,(function(){t.setResult(!0)}))})),Human.rpc.define("events.off",(function(e){if(e.id)s(e.id);else if(e.ids)for(var t=e.ids,r=0,i=t.length;r<i;r++)s(t[r]);else for(var a in o)o.hasOwnProperty(a)&&s(a)})),Human.rpc.define("timeline.query",(function(){this.setResult(Human.timeline.query())})),Human.rpc.define("camera.query",(function(){var e=Human.renderer.camera.getLookAt();e.zoom=Human.renderer.camera.getZoom(),this.setResult(e)})),Human.rpc.define("properties.query",(function(e){this.setResult(Human.properties.query(e.regex))})),Human.rpc.define("actions.doAction",(function(e){Human.actions._doAction([e.action,e.arguments])})),Human.rpc.define("alert",(function(e){window.alert(e.message||"")})),Human.rpc.define("videos.getClips",(function(){this.setResult(Human.media.videos.clipsList)})),Human.rpc.define("videos.open",(function(e){var t=this;Human.media.videos.open(e.clipId,(function(){t.setResult(!0)}))})),Human.rpc.define("videos.play",(function(e){Human.media.videos.play(e.clipId)})),Human.rpc.define("videos.scrub",(function(e){Human.media.videos.scrub(e.clipId,e.time)})),Human.rpc.define("videos.pause",(function(e){Human.media.videos.pause(e.clipId)})),Human.rpc.define("videos.stop",(function(e){Human.media.videos.stop(e.clipId)})),Human.rpc.define("videos.close",(function(e){Human.media.videos.close(e.clipId)})),Human.rpc.define("audio.getClips",(function(){this.setResult(Human.media.audio.clipsList)})),Human.rpc.define("audio.open",(function(e){var t=this;Human.media.audio.open(e.clipId,(function(){t.setResult(!0)}))})),Human.rpc.define("audio.play",(function(e){Human.media.audio.play(e.clipId)})),Human.rpc.define("audio.scrub",(function(e){Human.media.audio.scrub(e.clipId,e.time)})),Human.rpc.define("audio.pause",(function(e){Human.media.audio.pause(e.clipId)})),Human.rpc.define("audio.stop",(function(e){Human.media.audio.stop(e.clipId)})),Human.rpc.define("audio.close",(function(e){Human.media.videos.close(e.clipId)})),Human.rpc.define("modules.getModules",(function(e){this.setResult(Human.modules.query(e))})),Human.rpc.define("modules.activate",(function(e){var t=this;Human.modules.activateModules(e,(function(){t.setResult(!0)}))})),Human.rpc.define("modules.deactivate",(function(e){Human.modules.deactivateModules(e)})),Human.rpc.define("properties.subscribe",(function(e){var t=this;Human.properties.subscribe({subId:e.subId,propId:"myProperty",callback:function(e){t.setResult(e)}})})),Human.rpc.define("properties.resubscribe",(function(e){Human.properties.resubscribe(e.subId,e.propId)})),Human.rpc.define("properties.unsubscribe",(function(e){Human.properties.unsubscribe(e.subId)})),Human.rpc.define("renderer.getBGColor",(function(){this.setResult(Human.renderer.bg.getBGColor())})),Human.rpc.define("renderer.setBGColor",(function(e){Human.renderer.bg.setBGColor(e.color)})),Human.rpc.define("request.getParams",(function(){this.setResult({hashParams:Human.request.getHashParams(),hashStr:Human.request.getHashStr(),searchParams:Human.request.getSearchParams(),searchStr:Human.request.getSearchStr()})})),Human.rpc.define("scene.queryBoundary",(function(e){var t,r,i;if(e.objectId&&Human.scene.objects[e.objectId])t=Human.scene.objects[e.objectId].getBoundary();else if(e.fmaId){if(i=e.fmaId,!(r=Human.scene.objectsByFMAID[i]))return void this.error("No scene object found for the given FMA ID: '"+i+"'");t=r.getBoundary()}else if(e.objectIds)t=Human.scene.getBoundary({objectIds:e.objectIds});else if(e.fmaIds){for(var a=e.fmaIds,n=[],o=0,s=a.length;o<s;o++){if(i=a[o],!(r=Human.scene.objectsByFMAID[i]))return void this.error("No scene object found for the given FMA ID: '"+i+"'");n.push(r.objectId)}t=Human.scene.getBoundary({objectIds:n})}else t=e.selectedObjects?Human.scene.getBoundary({objects:Human.scene.selectedObjects}):e.enabledObjects?Human.scene.getBoundary({objects:Human.scene.enabledObjects}):Human.scene.getBoundary();this.setResult(t)})),t=document.getElementById("theCanvas"),r=function(e,r){r&&vec3.add(e,r,e);var i=Human.renderer.getViewMat(),a=Human.renderer.getProjMat(),n=vec4.create();vec3.transformMat4(n,e,i),n[3]=1,vec4.transformMat4(n,n,a);var o=n[1],s=n[3];return[Math.round((1+n[0]/s)*t.width/2),Math.round((1-o/s)*t.height/2)]},Human.rpc.define("scene.getCanvasPos",(function(e){this.setResult(r(e.worldPos,e.offset))})),Human.rpc.define("scene.getObjectCanvasPos",(function(e){var t=Human.scene.objects[e.objectId];if(t){var i=t.getCenter();this.setResult(r(i,e.offset))}})),Human.rpc.define("annotations.setTitle",(function(e){var t=Human.view.annotations.annotations[e.annotationId];t&&t.label.setTitle(e.title),this.setResult(!0)})),Human.rpc.define("annotations.setDescription",(function(e){var t=Human.view.annotations.annotations[e.annotationId];t&&t.label.setDescription(e.description),this.setResult(!0)})),Human.rpc.define("annotations.setLabelsShown",(function(e){Human.view.annotations.setLabelsShown(e),this.setResult(!0)})),Human.rpc.define("timeline.getBookmark",(function(){this.setResult(Human.timeline.getBookmark())})),Human.rpc.define("timeline.setBookmark",(function(e){Human.timeline.setBookmark(e)})),Human.rpc.define("clip.set",(function(e){if(e.clips){var t,r=e.clips;for(var i in r)r.hasOwnProperty(i)&&((t=r[i]).clipId=i,Human.renderer.clip.setClip(t))}else e.clip&&Human.renderer.clip.setClip(e.clip)})),Human.rpc.define("clip.reset",(function(){Human.renderer.clip.reset()})),Human.rpc.define("effects.getEffects",(function(){var e,t=[],r=Human.view.effects.effects;for(var i in r)r.hasOwnProperty(i)&&t.push({effectId:i,displayName:(e=r[i]).displayName,description:e.description,enabled:e.enabled,params:e.params});this.setResult(t)})),Human.rpc.define("effects.setEnabled",(function(e){Human.view.effects.setEnabled(e)})),Human.rpc.define("effects.setParams",(function(e){Human.view.effects.setParams(e)})),Human.rpc.define("focus.focusObject",(function(e){var t=this,r=function(){t.setResult(!0)},i=e.fmaId,a=e.objectId;if(!a&&!i&&!e.objectIds)return Human.log.error("Human.view.focusObject","Parameter expected: either 'objectId', 'objectIds' or 'fmaId'"),void r();var n,o=Human.scene;if(a){if(!(n=o.objects[a]))return Human.log.error("Human.view.focusObject","Scene object not found: '"+a+"'"),void r()}else if(i){if(!(n=o.objectsByFMAID[i]))return Human.log.error("Human.view.focusObject","Scene object not found for this FMAID: '"+i+"'"),void r();a=n.objectId}!0===e.xray?Human.rpc.call(null,"xray.setEnabled",{enable:!0}):!1===e.xray&&Human.rpc.call(null,"xray.setEnabled",{enable:!1});var s=e.select;s=null==s?e.replace||!o.selectedObjects[a]:e.select;var l,c=e.flyTo;if(e.replace)o.setSelectedObjects({objectId:a,select:s,replace:e.replace});else if(s){var u={};u[a]=s,o.setSelectedObjects({objects:u,replace:e.replace})}!1===e.showLabel&&s||Human.view.labels._clearLabels(),!1!==e.showLabel&&(Human.view.labels.createLabel({objectId:e.objectId,afterDelay:!0}),Human.renderer.forceRenderFrame()),s&&"newSelected"===c?(l=n.getBoundary())&&Human.renderer.camera.fly.flyTo({boundary:l,backOff:e.backOff,arc:0},(function(){r()})):c&&"allSelected"!==c?"selectedLeafObjects"===c?Human.renderer.camera.fly.flyTo({selectedLeafObjects:!0,backOff:e.backOff,arc:0},(function(){r()})):"object"===c?(l=n.getBoundary(),Human.renderer.camera.fly.flyTo({boundary:l,backOff:e.backOff,arc:0},(function(){r()}))):r():(l=o.getBoundary({objects:o.selectedObjects}))?Human.renderer.camera.fly.flyTo({boundary:l,backOff:e.backOff,arc:0},(function(){r()})):r()})),Human.rpc.define("labels.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.labels.getEnabled()),Human.view.labels.setEnabled(t)})),Human.rpc.define("labels.create",(function(e){e.objectId?(e.replace&&Human.view.labels.clearLabels(),Human.view.labels.createLabel(e)):this.error("parameter expected: 'objectId'")})),Human.rpc.define("labels.clear",(function(){Human.view.labels.clearLabels()})),Human.rpc.define("lights.getLights",(function(){var e,t=[],r=Human.renderer.lights.lights;for(var i in r)r.hasOwnProperty(i)&&t.push({lightId:i,displayName:(e=r[i]).displayName,description:e.description,enabled:e.enabled,params:e.params});this.setResult(t)})),Human.rpc.define("lights.setEnabled",(function(e){Human.renderer.lights.setEnabled(e)})),Human.rpc.define("lights.setParams",(function(e){Human.renderer.lights.setParams(e)})),Human.rpc.define("dissect.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.dissect.enabled),c(t,(function(){Human.view.dissect.setEnabled(t),t?(Human.renderer.pick.setMultiPickEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!1),Human.view.annotations.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))}))})),Human.rpc.define("highlight.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.highlight.enabled),Human.view.highlight.setEnabled(t),t&&(Human.view.isolate.setEnabled(!1),Human.view.xray.setEnabled(!1))})),Human.rpc.define("isolate.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.isolate.enabled),Human.view.isolate.setEnabled(t),(!t||Human.scene.anySelected())&&t&&(Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1))})),Human.rpc.define("pick.single.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.renderer.pick.getSinglePickEnabled()),c(t,(function(){Human.renderer.pick.setSinglePickEnabled(t),t&&(Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1))}))})),Human.rpc.define("pick.multi.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.renderer.pick.getMultiPickEnabled()),c(t,(function(){Human.renderer.pick.setMultiPickEnabled(t),t?(Human.renderer.pick.setSinglePickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)):Human.renderer.pick.setSinglePickEnabled(!0)}))})),Human.rpc.define("pick.doublePick",(function(e){Human.renderer.pick.doublePick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("pick.hoverPick",(function(e){Human.renderer.pick.hoverPick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("annotations.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.annotations.enabled),c(!t,(function(){Human.view.annotations.setEnabled(t),t?(Human.renderer.pick.setSinglePickEnabled(!1),Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))}))})),Human.rpc.define("xray.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.xray.enabled),Human.view.xray.setEnabled(t),t&&(Human.view.highlight.setEnabled(!1),Human.view.isolate.setEnabled(!1))})),Human.rpc.define("queryModes",(function(){var e={xray:Human.view.xray.enabled,highlight:Human.view.highlight.enabled,annotation:Human.view.annotations.enabled,singlePick:Human.renderer.pick.singleEnabled,multipick:Human.renderer.pick.multiEnabled,dissect:Human.view.dissect.enabled};this.setResult(e)})),Human.rpc.define("navigation.setEnabled",(function(e){l("navigator_container",e.enable)})),Human.rpc.define("fullscreen.setEnabled",(function(e){l("embed-full-screen",e.enable)}));var i=Human.log.reporters,a=Human.log.messageBuf;function n(e){var t,r={};for(var i in e)e.hasOwnProperty(i)&&(t=e[i],Human.utils.isPrimitive(t)&&"_"!==i[0]&&(r[i]=t));return r.objectId=e.object?e.object.objectId:"",r.title=e.label.title,r.description=e.label.description,r.pos=e.pin.pos,r.pinVec=e.pin.dir,r.visible=e.pin.visible,r}Human.rpc.define("log.createReporter",(function(e){if(e.id){var t="log.reporters."+e.id;if(!i[t]){i[t]={};for(var r=0,n=a.length;r<n;r++)Human.events.fire(t,a[r])}}else Human.log.error("param expected: id")})),Human.rpc.define("log.destroyReporter",(function(e){e.id?delete i["log.reporters."+e.id]:Human.log.error("param expected: id")})),Human.rpc.define("annotations.getAnnotations",(function(){var e=Human.view.annotations.annotations,t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=n(e[r]));this.setResult(t)})),Human.rpc.define("annotations.setShown",(function(e){Human.view.annotations.setShown(e.shown),this.setResult(!0)})),Human.rpc.define("camera.flyTo",(function(e){var t=this;Human.renderer.camera.fly.flyTo(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.jumpTo",(function(e){var t=this;Human.renderer.camera.fly.jumpTo(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.getZoom",(function(){this.setResult(Human.renderer.camera.getZoom())}));var o={};function s(e){var t=o[e];t&&(Human.unEvent(t[0],t[1]),delete o[e])}Human.rpc.define("events.on",(function(e){var t=this,r=this.id;if(r&&o[r])this.error("an event is already bound to this ID: '"+r+"'");else{var i=e.type;if(i){var a=function(e){t.setResult(e)};e.mask?(e.fn=a,Human.events.on(e)):Human.events.on(e.type,a),r&&(o[r]=[i,a])}else this.error("parameter expected: 'type'")}})),Human.rpc.define("events.once",(function(e){var t=this,r=e.type;r?Human.events.once(r,(function(e){t.setResult(e)})):this.error("parameter expected: 'type'")})),Human.rpc.define("events.fire",(function(e){Human.events.fire(e.eventName,e.params)})),Human.rpc.define("reset",(function(){var e=this;Human.init.reset((function(){e.setResult(!0)}))})),Human.rpc.define("reload",(function(){Human.init.reload()})),Human.rpc.define("pick.pick",(function(e){Human.renderer.pick.pick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("pick.queryPick",(function(e){this.setResult(Human.renderer.pick.queryPick({canvasX:e.canvasX,canvasY:e.canvasY,rayPick:e.rayPick})||{})})),Human.rpc.define("scene.setEnabledObjects",(function(t){var r;if(t.fmaIds)r=e(t.fmaIds);else if(Human.utils.isArray(t.objectIds)){r={};for(var i=0,a=t.objectIds.length;i<a;i++)r[t.objectIds[i]]=!0}else r=t.objectIds;Human.scene.setEnabledObjects({objects:r,replace:t.replace})})),Human.rpc.define("scene.setSelectedObjects",(function(t){var r;if(t.fmaIds)r=e(t.fmaIds);else if(Human.utils.isArray(t.objectIds)){r={};for(var i=0,a=t.objectIds.length;i<a;i++)r[t.objectIds[i]]=!0}else r=t.objectIds;t.objectIds=r,Human.scene.setSelectedObjects(t)})),function(){function e(r,i){if(r){i.push(t(r));for(var a=0,n=r.objects.length;a<n;a++)e(r.objects[a],i)}}function t(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&"_"!==r[0]){var i=e[r];Human.utils.isPrimitive(i)&&(t[r]=i)}return t.parentObjectId=e.parent?e.parent.objectId:null,t}Human.rpc.define("scene.getObjects",(function(r){var i,a=[];if(r.objectId)(i=Human.scene.objects[r.objectId])&&a.push(t(i));else for(var n=0,o=Human.scene.rootObjects.length;n<o;n++)e(Human.scene.rootObjects[n],a);this.setResult(a)}))}(),Human.rpc.define("scene.setObjectTransform",(function(e){var t,r=e.objectId,i=e.fmaId;if(r){if(!(t=Human.scene.objects[r]))return void this.error("Scene object not found: '"+r+"'")}else if(i&&!(t=Human.scene.objectsByFMAID[i]))return void this.error("scene object not found for the given FMA ID: '"+i+"'");t.setTransform(e)})),Human.rpc.define("timeline.scrub",(function(e){Human.timeline.scrub(e)})),Human.rpc.define("timeline.stop",(function(){Human.timeline.stop()})),Human.rpc.define("timeline.prev",(function(){Human.timeline.prev()})),Human.rpc.define("timeline.next",(function(){Human.timeline.next()})),Human.rpc.define("timeline.unpause",(function(){Human.timeline.unpause()})),Human.rpc.define("properties.set",(function(e){Human.properties.set(e.props||e||{})}));var l=function(e,t){var r=void 0===t||t;document.getElementById(e).style.display=r?"block":"none"};function c(e,t){e&&Human.view.annotations.unsavedAnnotation?alert("Please save or cancel annotation first"):t()}})),Human.rpc.fmaIds={3734:["Base_of_aorta_3734_ID"],3768:["Aortic_arch_3768_ID"],3784:["Descending_Aorta_3784_ID"],3818:["Marginal_branch_of_right_coronary_artery_3818_ID"],3829:["Anterior_atrial_branch_of_right_coronary_artery_3829_ID"],3837:["Posterior_left_ventricular_branch_of_left_coronary_artery_3837_ID"],3932:["left_lower_subclavian_artery_3932_ID","Right_Brachiocephalic_trunk_3932_ID"],3941:["Right_common_carotid_artery_3941_ID"],3945:["Right_external_carotid_artery_3945_ID"],3949:["Right_Internal_Carotid_Artery_3949_ID"],3950:["Right_Internal_Carotid_Artery_3950_ID"],3958:["Right_Vertebral_Artery_3958_ID"],3969:["Right_internal_thoracic_artery_3969_ID"],3988:["Superior_right_epigastric_artery_3988_ID","Right_Superior_epigastric_artery_3988_ID"],4058:["Left_common_carotid_artery_4058_ID","Base_of_left_common_carotid_artery_4058_ID","Base_of_Left_common_carotid_artery_4058_ID"],4060:["Left_external_carotid_artery_4060_ID"],4062:["Left_Internal_Carotid_Artery_4062_ID"],4066:["Left_Vertebral_Artery_4066_ID"],4068:["Left_internal_thoracic_artery_4068_ID"],4083:["Left_Superior_epigastric_artery_4083_ID"],4085:["Right_costocervical_trunk_4085_ID"],4086:["Right_costocervical_trunk_4086_ID","Left_costocervical_trunk_4086_ID"],4134:["Left_deep_cervical_artery_4134_ID","left_deep_cervical_artery_4134_ID"],4634:["Right_Subcostal_artery_4634_ID","Right_subcostal_artery_4634_ID"],4654:["Left_Subcostal_artery_4654_ID","Left_subcostal_artery_4654_ID"],4693:["Right_subclavian_artery_4693_ID"],4694:["left_subclavian_artery_4694_ID","Left_Lower_Subclavian_artery_4694_ID","right_subclavian_artery_4694_ID"],4706:["Coronary_sinus_4706_ID"],4707:["Great_cardiac_vein_4707_ID"],4712:["Posterior_vein_of_left_ventricle_4712_ID"],4713:["Middle_cardiac_vein_4713_ID"],4714:["Small_cardiac_vein_4714_ID"],4715:["Oblique_vein_of_left_atrium_4715_ID"],4720:["Superior_Vena_Cava_4720_ID"],4728:["Inferior_Thyroid_vein_4728_ID"],4751:["Right_Brachiocephalic_vein_4751_ID","Right_brachiocephalic_vein_4751_ID"],4755:["Right_internal_jugular_vein_4755_ID"],4756:["Right_Vertebral_vein_4756_ID"],4758:["Right_internal_thoracic_vein_4758_ID"],4761:["Left_Brachiocephalic_vein_4761_ID","Left_brachiocephalic_vein_4761_ID"],4763:["Left_internal_jugular_vein_4763_ID"],4764:["Left_Vertebral_vein_4764_ID"],4766:["Left_internal_thoracic_vein_4766_ID"],4771:["Right_Superior_epigastric_vein_4771_ID","Right_superior_epigastric_vein_4771_ID"],4785:["Left_superior_epigastric_vein_4785_ID"],4838:["Azygos_Vein_4838_ID","Azygos_vein_4838_ID"],4843:["Right_ascending_lumbar_vein_4843_ID"],4944:["Hemiazgos_vein_4944_ID","Hemiazygos_vein_4944_ID"],4950:["Left_ascending_lumbar_vein_4950_ID"],5011:["Left_Accessory_Hemiazgos_vein_5011_ID","Left_Accessory_Hemiazygos_vein_5011_ID"],5883:["Right_Splanchnic_Nerve_5883_ID","Left_Splanchnic_Nerve_5883_ID"],6192:["Right_Phrenic_Nerve_6192_ID"],6193:["Left_Phrenic_Nerve_6193_ID"],6246:["Left_Recurrent_Laryngeal_Nerve_6246_ID","Right_Recurrent_Laryngeal_Nerve_6246_ID"],6258:["Left_Sympathetic_Chain_6258_ID","Right_Sympathetic_Chain_6258_ID"],6259:["Right_Sympathetic_Chain_6259_ID"],6442:["Left_C1_Spinal_Nerve_6442_ID","Right_C1_Spinal_Nerve_6442_ID"],6451:["Left_C2_Spinal_Nerve_6451_ID","Right_C2_Spinal_Nerve_6451_ID"],6453:["Left_C3_Spinal_Nerve_6453_ID","Right_C3_Spinal_Nerve_6453_ID"],6456:["Left_C4_Spinal_Nerve_6456_ID","Right_C4_Spinal_Nerve_6456_ID"],6457:["Right_C5_Spinal_Nerve_6457_ID","Left_C5_Spinal_Nerve_6457_ID"],6459:["Left_C6_Spinal_Nerve_6459_ID","Right_C6_Spinal_Nerve_6459_ID"],6461:["Right_C7_Spinal_Nerve_Group_6461_ID","Left_C7_Spinal_Nerve_6461_ID","Right_C7_Spinal_Nerve_6461_ID","Left_C7_Spinal_Nerve_Group_6461_ID"],6465:["Left_C8_Spinal_Nerve_6465_ID","Right_C8_Spinal_Nerve_6465_ID"],6582:["Ansa_Subclavia_6582_ID"],6642:["Superior_hypogastric_nerve_plexus_6642_ID"],6643:["Inferior_hypogastric_nerve_plexus_6643_ID"],6647:["Prostatic_nerve_plexus_6647_ID"],7088:["Heart_7088_ID"],7096:["Right_atrium_7096_ID"],7097:["Left_atrium_7097_ID"],7098:["Right_Ventricle_7098_ID"],7101:["Left_Ventricle_7101_ID"],7131:["Esophagus_7131_ID"],7133:["Interventricular_Septum_7133_ID"],7148:["Stomach_7148_ID"],7196:["Spleen_7196_ID"],7197:["Liver_7197_ID"],7198:["Pancreas_7198_ID"],7200:["Small_intestine_7200_ID"],7202:["Gallbladder_7202_ID"],7204:["Left_Kidney_7204_ID","Right_Kidney_7204_ID"],7205:["Right_Kidney_7205_ID","Left_Kidney_7205_ID"],7206:["Duodenum_7206_ID"],7207:["Jejunum_7207_ID"],7208:["Ileum_7208_ID"],7209:["Ovaries_7209_ID"],7211:["Right_testis_7211_ID"],7212:["Left_testis_7212_ID"],7213:["Right_Ovary_7213_ID"],7214:["Left_Ovary_7214_ID"],7218:["Right_auricle_7218_ID"],7219:["Left_auricle_7219_ID"],7234:["Tricuspid_Valve_7234_ID"],7235:["Mitral_valve_7235_ID"],7236:["Aortic_Valve_7236_ID"],7246:["Pulmonary_Valve_7246_ID"],7309:["Right_Lung_7309_ID"],7310:["Left_Lung_7310_ID"],7333:["Right_Superior_Lobe_7333_ID"],7337:["Right_Inferior_Lobe_7337_ID"],7370:["Left_Superior_Lobe_7370_ID"],7371:["Left_Inferior_Lobe_7371_ID"],7383:["Right_Middle_Lobe_7383_ID"],7394:["Trachea_7394_ID"],7486:["manubrium_of_sternum_7486_ID","body_of_sternum_7486_ID"],7591:["Right_Costal_Cartilage_7591_ID","Left_Costal_Cartilage_7591_ID"],7592:["Left_Costal_Cartilage_7592_ID","Right_Costal_Cartilage_7592_ID"],7647:["spinal_cord_7647_ID"],7857:["Left_first_rib_7857_ID","Right_first_rib_7857_ID"],7882:["Right_second_rib_7882_ID"],7883:["Left_second_rib_7883_ID"],7909:["Right_third_rib_7909_ID"],7910:["Left_third_rib_7910_ID"],7957:["Right_fourth_rib_7957_ID"],7958:["Left_fourth_rib_7958_ID"],8066:["Right_fifth_rib_8066_ID","Left_fifth_rib_8066_ID"],8175:["Left_sixth_rib_8175_ID","Right_sixth_rib_8175_ID"],8229:["Left_seventh_rib_8229_ID","Right_seventh_rib_8229_ID"],8283:["Left_eighth_rib_8283_ID","Right_eighth_rib_8283_ID"],8364:["Left_ninth_rib_8364_ID","Right_ninth_rib_8364_ID"],8445:["Right_tenth_rib_8445_ID","Left_tenth_rib_8445_ID"],8531:["Left_eleventh_rib_8531_ID","Right_eleventh_rib_8531_ID"],8533:["Right_twelfth_rib_8533_ID","Left_twelfth_rib_8533_ID"],8612:["Pulmonary_trunk_8612_ID"],9165:["First_thoracic_vertebra_9165_ID"],9187:["Second_thoracic_vertebra_9187_ID"],9209:["Third_thoracic_vertebra_9209_ID"],9248:["Fourth_thoracic_vertebra_9248_ID"],9600:["Prostate_9600_ID"],9603:["Thyroid_Gland_9603_ID"],9615:["Cricoid_cartilage_9615_ID"],9706:["Bile_Ducts_9706_ID"],9707:["Penis_9707_ID"],9710:["Vomer_9710_ID"],9711:["Maxilla_9711_ID"],9761:["Right_Transversus_thoracis_9761_ID"],9762:["Right_Transversus_thoracis_9762_ID","Left_Transversus_thoracis_9762_ID"],9922:["Fifth_thoracic_vertebra_9922_ID"],9945:["Sixth_thoracic_vertebra_9945_ID"],9968:["Seventh_thoracic_vertebra_9968_ID"],9991:["Eighth_thoracic_vertebra_9991_ID"],10014:["Ninth_thoracic_vertebra_10014_ID"],10037:["Tenth_thoracic_vertebra_10037_ID"],10059:["Eleventh_thoracic_vertebra_10059_ID"],10081:["Twelfth_thoracic_vertebra_10081_ID"],10551:["Right_dorsal_scapular_artery_10551_ID"],10552:["right_dorsal_scapular_artery_10552_ID","left_dorsal_scapular_artery_10552_ID"],10660:["Right_deep_cervical_artery_10660_ID"],10679:["Right_inferior_thyroid_artery_10679_ID"],10680:["left_inferior_thyroid_artery_10680_ID","Right_suprascapular_artery_10680_ID"],10681:["left_suprascapular_artery_10681_ID","Right_transverse_cervical_artery_10681_ID","right_suprascapular_artery_10681_ID"],10682:["left_transverse_cervical_artery_10682_ID","Right_superficial_cervical_artery_10682_ID"],10683:["left_superficial_cervical_artery_10683_ID"],10951:["Inferior_vena_cava_10951_ID","base_of_inferior_vena_cava_10951_ID"],12519:["Atlas_C1_12519_ID"],12520:["Axis_C2_12520_ID"],12521:["Third_cervical_vertebra_12521_ID"],12522:["Fourth_cervical_vertebra_12522_ID"],12523:["Fifth_cervical_vertebra_12523_ID"],12524:["Sixth_cervical_vertebra_12524_ID"],12525:["Seventh_cervical_vertebra_12525_ID"],12770:["Deep_lateral_cervical_lymph_nodes_12770_ID"],12858:["Union_between_ascending_lumbar_veins_12858_ID"],13072:["First_lumbar_vertebra_13072_ID"],13073:["Second_lumbar_vertebra_13073_ID"],13074:["Third_lumbar_vertebra_13074_ID"],13075:["Fourth_lumbar_vertebra_13075_ID"],13076:["Fifth_lumbar_vertebra_13076_ID"],13111:["Right_external_jugular_vein_13111_ID"],13112:["Left_external_jugular_vein_13112_ID","Right_external_jugular_vein_13112_ID"],13113:["Left_external_jugular_vein_13113_ID"],13295:["Diaphragm_13295_ID"],13322:["Right_Clavicle_13322_ID"],13323:["Left_Clavicle_13323_ID"],13325:["Right_cephalic_vein_13325_ID"],13326:["right_cephalic_vein_13326_ID","left_cephalic_vein_13326_ID"],13328:["Left_Clavicle_13328_ID"],13336:["Right_external_oblique_13336_ID"],13337:["Left_external_oblique_13337_ID"],13346:["Right_Sternohyoid_13346_ID"],13347:["Left_Sternohyoid_13347_ID"],13350:["Right_Sternothyroid_13350_ID"],13351:["Left_Sternothyroid_13351_ID"],13352:["Right_Thyrohyoid_13352_ID"],13353:["Left_Thyrohyoid_13353_ID"],13354:["Intercostal_Muscles_of_Left_Thorax_13354_ID","Intercostal_Muscles_of_Right_Thorax_13354_ID"],13358:["Right_latissimus_dorsi_13358_ID"],13359:["Left_latissimus_dorsi_13359_ID"],13373:["Right_pectoralis_major_13373_ID"],13374:["Left_pectoralis_major_13374_ID","Right_pectoralis_major_13374_ID"],13375:["Right_Pectoralis_minor_13375_ID"],13376:["Left_Pectoralis_minor_13376_ID","Right_Pectoralis_minor_13376_ID"],13377:["Right_Rectus_Abdominis_13377_ID"],13378:["Left_Rectus_Abdominis_13378_ID"],13379:["Right_Rectus_Abdominis_13379_ID"],13381:["Right_Rhomboid_Major_13381_ID"],13382:["Left_Rhomboid_Major_13382_ID"],13383:["Right_Rhomboid_Minor_13383_ID"],13384:["Left_Rhomboid_Minor_13384_ID"],13395:["Right_Scapula_13395_ID"],13396:["Left_Scapula_13396_ID","Right_Scapula_13396_ID"],13398:["Right_serratus_anterior_13398_ID"],13399:["Left_serratus_anterior_13399_ID"],13403:["Right_Serratus_Posterior_Superior_13403_ID"],13404:["Left_Serratus_Posterior_Superior_13404_ID"],13405:["Right_Serratus_Posterior_Inferior_13405_ID"],13406:["Left_Serratus_Posterior_Inferior_13406_ID"],13408:["Right_Sternocleidomastoid_13408_ID"],13409:["Left_Sternocleidomastoid_13409_ID"],13410:["Right_Subclavius_13410_ID"],13411:["Left_Subclavius_13411_ID","Right_Subclavius_13411_ID"],13414:["Right_subscapularis_13414_ID"],13415:["Left_subscapularis_13415_ID","Right_subscapularis_13415_ID"],13417:["Right_Thoracoepigastric_vein_13417_ID"],13418:["Left_Thoracoepigastric_vein_13418_ID"],13419:["Right_Trapezius_13419_ID"],13420:["Left_Trapezius_13420_ID"],13421:["Ligamentum_arteriosum_13421_ID"],13478:["Vertebral_Column_13478_ID"],13889:["Pituitary_Gland_13889_ID"],13890:["Parathyroid_Glands_13890_ID"],13892:["Right_Internal_oblique_13892_ID"],13893:["Left_Internal_oblique_13893_ID"],13912:["Anterior_interventricular_artery_13912_ID"],14331:["splenic_vein_14331_ID"],14332:["superior_mesenteric_vein_14332_ID"],14335:["Right_renal_vein_14335_ID"],14336:["Left_renal_vein_14336_ID"],14338:["Right_Hepatic_Vein_14338_ID"],14339:["Left_Hepatic_Vein_14339_ID"],14341:["Right_testicular_vein_14341_ID"],14345:["Left_testicular_vein_14345_ID"],14384:["Right_median_nerve_14384_ID"],14385:["Left_median_nerve_14385_ID"],14468:["Right_Recurrent_Laryngeal_Nerve_14468_ID"],14469:["Left_Recurrent_Laryngeal_Nerve_14469_ID"],14542:["Appendix_14542_ID"],14543:["Colon_14543_ID"],14544:["Rectum_14544_ID"],14545:["Ascending_colon_14545_ID"],14546:["Transverse_colon_14546_ID"],14547:["Descending_Colon_14547_ID"],14548:["Sigmoid_Colon_14548_ID"],14735:["Right_Lumbar_artery_14735_ID","Left_Lumbar_Artery_14735_ID","Right_Lumbar_Artery_14735_ID"],14746:["Right_Inferior_Phrenic_Artery_14746_ID"],14747:["Left_Inferior_Phrenic_Artery_14747_ID"],14749:["superior_mesenteric_artery_14749_ID"],14750:["Inferior_Mesenteric_artery_14750_ID"],14752:["Right_renal_artery_14752_ID"],14753:["Left_Renal_artery_14753_ID"],14759:["Right_testicular_artery_14759_ID"],14760:["Left_testicular_artery_14760_ID"],14768:["Left_Gastric_Artery_14768_ID"],14771:["Common_hepatic_artery_14771_ID"],14772:["Hepatic_artery_proper_14772_ID"],14773:["Splenic_artery_14773_ID"],14775:["Gastroduodenal_artery_14775_ID"],14776:["Right_Gastric_artery_14776_ID"],14778:["Right_hepatic_artery_14778_ID"],14779:["Left_hepatic_artery_14779_ID"],14781:["Right_Gastroepiploic_artery_14781_ID"],14787:["Dorsal_pancreatic_artery_14787_ID"],14790:["Inferior_pancreatic_artery_14790_ID"],14791:["Prepancreatic_Artery_14791_ID"],14792:["Great_pancreatic_artery_14792_ID"],14793:["Caudal_pancreatic_artery_14793_ID"],14796:["Left_Gastroepiploic_artery_14796_ID"],14810:["middle_colic_artery_14810_ID"],14811:["Right_colic_artery_14811_ID"],14812:["Celiac_Trunk_14812_ID"],14815:["Ileocolic_artery_14815_ID"],14819:["ileal_branch_of_ileocolic_artery_14819_ID"],14820:["Ileal_branch_of_ileocolic_vein_14820_ID","Colic_branch_of_ileocolic_vein_14820_ID"],14822:["Superior_branch_of_ileocolic_artery_14822_ID"],14826:["Left_colic_artery_14826_ID"],14830:["Sigmoid_artery_14830_ID"],14831:["Marginal_artery_of_colon_14831_ID"],14832:["Superior_Rectal_artery_14832_ID"],14835:["Cystic_artery_14835_ID"],15388:["Pancreatic_tributary_of_splenic_vein_15388_ID"],15390:["left_gastroepiploic_vein_15390_ID"],15391:["Inferior_Mesenteric_vein_15391_ID"],15394:["Left_colic_vein_15394_ID"],15395:["Sigmoid_vein_15395_ID"],15397:["Right_gastroepiploic_vein_15397_ID"],15398:["Anterior_Superior_pancreaticoduodenal_vein_15398_ID","Anterior_Inferior_pancreaticoduodenal_vein_15398_ID","Pancreaticoduodenal_vein_15398_ID","Posterior_Superior_pancreaticoduodenal_vein_15398_ID","Posterior_Inferior_pancreaticoduodenal_vein_15398_ID"],15399:["Left_Gastric_vein_15399_ID"],15400:["Right_Gastric_vein_15400_ID"],15407:["right_colic_vein_15407_ID"],15408:["Ileocolic_vein_15408_ID"],15414:["Right_Hepatic_Portal_Vein_15414_ID"],15415:["Left_Hepatic_Portal_Vein_15415_ID"],15571:["Right_Ureter_15571_ID"],15572:["Left_Ureter_15572_ID"],15629:["Right_Adrenal_Gland_15629_ID"],15630:["Left_Adrenal_Gland_15630_ID"],15710:["Internal_anal_sphincter_15710_ID"],15900:["Bladder_15900_ID"],16202:["Sacrum_16202_ID"],16491:["Right_iliohypogastric_nerve_16491_ID"],16492:["Left_iliohypogastric_nerve_16492_ID"],16493:["Right_ilioinguinal_nerve_16493_ID"],16494:["Left_ilioinguinal_nerve_16494_ID"],16497:["Right_lateral_femoral_cutaneous_nerve_16497_ID"],16498:["Left_lateral_femoral_cutaneous_nerve_16498_ID"],16499:["Right_femoral_nerve_16499_ID"],16500:["Left_femoral_nerve_16500_ID"],16501:["Right_obturator_nerve_16501_ID"],16502:["Left_obturator_nerve_16502_ID"],17559:["Uterus_17559_ID"],17740:["Cervix_of_uterus_17740_ID"],18245:["Right_Fallopian_Tube_18245_ID","Left_Fallopian_Tube_18245_ID"],18256:["Right_epididymis_18256_ID"],18257:["Left_epididymis_18257_ID"],18806:["Right_external_iliac_artery_18806_ID"],18807:["Left_external_iliac_artery_18807_ID"],18809:["Right_internal_iliac_artery_18809_ID"],18810:["Left_internal_iliac_artery_18810_ID"],18824:["Right_inferior_vesical_artery_18824_ID"],18825:["Left_inferior_vesical_artery_18825_ID"],18829:["Left_Uterine_Artery_18829_ID","Right_Uterine_Artery_18829_ID"],18836:["Right_internal_pudendal_artery_18836_ID"],18837:["Left_internal_pudendal_artery_18837_ID"],18846:["Right_iliolumbar_artery_18846_ID"],18847:["Left_iliolumbar_artery_18847_ID"],18856:["Right_lateral_sacral_artery_18856_ID"],18857:["Left_lateral_sacral_artery_18857_ID"],18866:["Right_obturator_artery_18866_ID"],18867:["Left_obturator_artery_18867_ID"],18869:["Right_superior_gluteal_artery_18869_ID"],18870:["Right_superior_gluteal_artery_18870_ID","Left_superior_gluteal_artery_18870_ID"],18872:["Right_inferior_gluteal_artery_18872_ID"],18873:["Left_inferior_gluteal_artery_18873_ID"],18885:["Right_external_iliac_vein_18885_ID"],18886:["Left_external_iliac_vein_18886_ID"],18887:["Right_internal_iliac_vein_18887_ID"],18888:["Left_internal_iliac_vein_18888_ID"],18891:["Right_inferior_vesical_vein_18891_ID"],18892:["Left_inferior_vesical_vein_18892_ID"],18897:["Right_Uterine_Vein_18897_ID"],18898:["Left_Uterine_Vein_18898_ID"],18903:["Right_iliolumbar_vein_18903_ID"],18904:["Left_iliolumbar_vein_18904_ID"],18906:["Right_lateral_sacral_vein_18906_ID"],18907:["Left_lateral_sacral_vein_18907_ID"],18909:["Right_superior_gluteal_vein_18909_ID"],18910:["Left_superior_gluteal_vein_18910_ID"],18912:["Right_inferior_gluteal_vein_18912_ID"],18913:["Left_inferior_gluteal_vein_18913_ID"],18915:["Right_obturator_vein_18915_ID"],18916:["Left_obturator_vein_18916_ID"],18918:["Right_internal_pudendal_vein_18918_ID"],18919:["Left_internal_pudendal_vein_18919_ID"],19086:["Muscles_of_the_Pelvis_19086_ID"],19087:["Levator_Ani_19087_ID"],19090:["Pubococcygeus_19090_ID"],19091:["Puborectalis_19091_ID"],19119:["Right_Uterosacral_Ligament_19119_ID"],19120:["Left_Uterosacral_Ligament_19120_ID"],19235:["Right_vas_deferens_19235_ID"],19236:["Left_vas_deferens_19236_ID"],19387:["Right_Seminal_Vesicle_19387_ID"],19388:["Left_Seminal_Vesicle_19388_ID"],19617:["Corpus_spongiosum_of_penis_19617_ID"],19618:["Right_corporus_cavernosum_of_penis_19618_ID","Left_corporus_cavernosum_of_penis_19618_ID"],19667:["Urethra_19667_ID"],19668:["Male_urethra_19668_ID"],19730:["Left_Ischiocavernosus_19730_ID","Right_Ischiocavernosus_19730_ID"],19731:["Right_Superficial_Transverse_Perineal_Muscle_19731_ID","Left_Superficial_Transverse_Perineal_Muscle_19731_ID"],19732:["Deep_transverse_perineal_muscle_19732_ID"],19949:["Vagina_19949_ID"],20224:["Right_Ribs_20224_ID"],20225:["Right_Ribs_20225_ID","Left_Ribs_20225_ID"],20226:["Right_Bony_Pelvis_20226_ID","Left_Ribs_20226_ID","Right_side_of_bony_pelvis_20226_ID"],20227:["Left_Bony_Pelvis_20227_ID","Left_side_of_bony_pelvis_20227_ID"],20274:["Perineal_Body_20274_ID"],20630:["Right_genitofemoral_nerve_20630_ID"],20631:["Left_genitofemoral_nerve_20631_ID"],20632:["Genital_branch_of_right_genitofemoral_nerve_20632_ID"],20633:["Genital_branch_of_left_genitofemoral_nerve_20633_ID"],20634:["Femoral_branch_of_right_genitofemoral_nerve_20634_ID"],20635:["Femoral_branch_of_left_genitofemoral_nerve_20635_ID"],20688:["Right_Inferior_Epigastric_Artery_20688_ID"],20689:["Left_Inferior_Epigastric_Artery_20689_ID"],20735:["Right_Superficial_Epigastric_Artery_20735_ID"],20736:["Left_Superficial_Epigastric_Artery_20736_ID"],20796:["Right_deep_femoral_artery_20796_ID"],20797:["Left_deep_femoral_artery_20797_ID"],20801:["Right_lateral_circumflex_femoral_artery_20801_ID"],20802:["Left_lateral_circumflex_femoral_artery_20802_ID"],20807:["Right_Medial_circumflex_femoral_artery_20807_ID"],20808:["Left_Medial_circumflex_femoral_artery_20808_ID"],20818:["Right_dorsal_artery_of_penis_20818_ID"],20819:["Left_dorsal_artery_of_penis_20819_ID"],20967:["Prostatic_part_of_right_inferior_vesical_artery_20967_ID"],20968:["Prostatic_part_of_left_inferior_vesical_artery_20968_ID"],21163:["Right_Inferior_Epigastric_Vein_21163_ID"],21164:["Left_Inferior_Epigastric_Vein_21164_ID"],21188:["Right_Femoral_Vein_21188_ID"],21189:["Left_Femoral_Vein_21189_ID"],21378:["Superficial_Veins_of_the_Left_Leg_21378_ID","Superficial_Veins_of_the_Right_Leg_21378_ID"],21379:["Right_Great_Saphenous_Vein_21379_ID"],21380:["Left_Great_Saphenous_Vein_21380_ID"],21422:["Descending_branch_of_right_lateral_circumflex_femoral_artery_21422_ID"],21423:["Descending_branch_of_left_lateral_circumflex_femoral_artery_21423_ID"],21863:["Right_Pudendal_nerve_21863_ID"],21864:["Left_Pudendal_nerve_21864_ID"],21919:["Right_superficial_transverse_perineal_muscle_21919_ID"],21920:["Left_superficial_transverse_perineal_muscle_21920_ID"],21921:["Right_bulbospongiosus_21921_ID"],21922:["Left_bulbospongiosus_21922_ID"],21923:["Right_ischiocavernosus_21923_ID"],21924:["Left_ischiocavernosus_21924_ID"],21930:["External_Anal_Sphincter_21930_ID"],22109:["Right_Tibial_nerve_22109_ID"],22110:["Left_Tibial_nerve_22110_ID"],22111:["Right_sciatic_nerve_22111_ID"],22112:["Left_sciatic_nerve_22112_ID"],22171:["Right_inferior_ulnar_collateral_artery_22171_ID"],22172:["right_inferior_ulnar_collateral_artery_22172_ID","left_inferior_ulnar_collateral_artery_22172_ID"],22322:["Right_Iliacus_22322_ID"],22323:["Left_Iliacus_22323_ID"],22324:["Right_Obturator_Internus_22324_ID"],22325:["Left_Obturator_Internus_22325_ID"],22326:["Right_Obturator_externus_22326_ID"],22327:["Left_Obturator_externus_22327_ID"],22328:["Right_gluteus_maximus_22328_ID"],22329:["Left_gluteus_maximus_22329_ID"],22330:["Right_gluteus_medius_22330_ID"],22331:["Left_gluteus_medius_22331_ID"],22332:["Right_Gluteus_minimus_22332_ID"],22333:["Left_Gluteus_minimus_22333_ID"],22334:["Right_superior_gemellus_22334_ID"],22335:["Left_superior_gemellus_22335_ID"],22336:["Right_inferior_gemellus_22336_ID"],22337:["Left_inferior_gemellus_22337_ID"],22338:["Right_Quadratus_femoris_22338_ID"],22339:["Left_Quadratus_femoris_22339_ID"],22340:["Right_Piriformis_22340_ID"],22341:["Left_Piriformis_22341_ID"],22342:["Right_Psoas_Major_22342_ID"],22343:["Left_Psoas_Major_22343_ID"],22344:["Right_Transversus_abdominis_22344_ID"],22345:["Left_Transversus_abdominis_22345_ID"],22348:["Right_Quadratus_lumborum_22348_ID"],22349:["Left_Quadratus_lumborum_22349_ID"],22351:["Right_Psoas_Minor_22351_ID"],22352:["Left_Psoas_Minor_22352_ID"],22354:["Right_Sartorius_22354_ID"],22355:["Left_Sartorius_22355_ID"],22358:["Right_Semitendinosus_22358_ID"],22359:["Left_Semitendinosus_22359_ID"],22360:["Right_Biceps_Femoris_22360_ID"],22361:["Left_Biceps_Femoris_22361_ID"],22425:["Right_Tensor_Fasciae_Latae_22425_ID"],22426:["Left_Tensor_Fasciae_Latae_22426_ID"],22444:["Right_quadriceps_femoris_22444_ID"],22445:["Left_quadriceps_femoris_22445_ID"],22446:["Right_Articularis_Genus_22446_ID"],22447:["Left_Articularis_Genus_22447_ID"],22448:["Right_Semimembranosus_22448_ID"],22449:["Left_Semimembranosus_22449_ID"],22450:["Right_Pectineus_22450_ID"],22451:["Left_Pectineus_22451_ID"],22456:["Right_Adductor_Longus_22456_ID"],22457:["Right_Adductor_Longus_22457_ID","Left_Adductor_Longus_22457_ID"],22458:["Left_Adductor_Longus_22458_ID"],22459:["Right_Adductor_Magnus_22459_ID"],22460:["Left_Adductor_Magnus_22460_ID"],22507:["Right_descending_genicular_artery_22507_ID"],22508:["Left_descending_genicular_artery_22508_ID"],22539:["Right_Fibularis_tertius_22539_ID","Left_Fibularis_tertius_22539_ID"],22545:["Right_Tibialis_anterior_22545_ID","Left_Tibialis_anterior_22545_ID"],22547:["Left_Extensor_hallucis_longus_22547_ID","Right_Extensor_hallucis_longus_22547_ID"],22548:["Right_Extensor_hallucis_longus_22548_ID","Left_Extensor_hallucis_longus_22548_ID"],22549:["Right_extensor_digitorum_longus_22549_ID","Left_extensor_digitorum_longus_22549_ID"],22551:["Right_Fibularis_tertius_22551_ID","Left_Fibularis_tertius_22551_ID"],22553:["Right_Fibularis_longus_22553_ID","Left_Fibularis_longus_22553_ID"],22555:["Left_Fibularis_brevis_22555_ID","Right_Fibularis_brevis_22555_ID"],22556:["Right_Gastrocnemius_22556_ID"],22557:["Left_Gastrocnemius_22557_ID"],22559:["Right_Soleus_22559_ID","Left_Soleus_22559_ID"],22561:["Left_Plantaris_22561_ID","Right_Plantaris_22561_ID"],22586:["Right_superior_medial_genicular_artery_22586_ID"],22587:["Left_superior_medial_genicular_artery_22587_ID"],22588:["Right_superior_lateral_genicular_artery_22588_ID"],22589:["Left_superior_lateral_genicular_artery_22589_ID"],22592:["Right_Popliteus_22592_ID","Left_Popliteus_22592_ID"],22655:["Right_Axillary_artery_22655_ID"],22656:["Left_Axillary_artery_22656_ID","Right_Axillary_artery_22656_ID"],22669:["right_superior_thoracic_artery_22669_ID"],22670:["left_superior_thoracic_artery_22670_ID"],22675:["Right_lateral_thoracic_artery_22675_ID"],22676:["right_lateral_thoracic_artery_22676_ID","left_lateral_thoracic_artery_22676_ID"],22679:["Right_subscapular_artery_22679_ID"],22680:["left_subscapular_artery_22680_ID","right_subscapular_artery_22680_ID"],22682:["Right_anterior_humeral_circumflex_artery_22682_ID"],22683:["right_anterior_humeral_circumflex_artery_22683_ID","left_anterior_humeral_circumflex_artery_22683_ID"],22686:["Right_posterior_humeral_circumflex_artery_22686_ID"],22687:["left_posterior_humeral_circumflex_artery_22687_ID","right_posterior_humeral_circumflex_artery_22687_ID"],22691:["Right_brachial_artery_22691_ID"],22692:["right_brachial_artery_22692_ID","left_brachial_artery_22692_ID"],22696:["Right_deep_brachial_artery_22696_ID"],22697:["right_deep_brachial_artery_22697_ID","left_deep_brachial_artery_22697_ID"],22707:["Right_superior_ulnar_collateral_artery_22707_ID"],22708:["right_superior_ulnar_collateral_artery_22708_ID","left_superior_ulnar_collateral_artery_22708_ID"],22726:["Right_Splenius_cervicis_22726_ID"],22727:["Left_Splenius_cervicis_22727_ID"],22728:["Right_Splenius_capitis_22728_ID"],22729:["Left_Splenius_capitis_22729_ID"],22733:["Right_radial_artery_22733_ID"],22734:["Right_radial_artery_22734_ID","Left_radial_artery_22734_ID"],22740:["Right_Iliocostalis_Lumborum_22740_ID"],22741:["Left_Iliocostalis_Lumborum_22741_ID"],22742:["Right_Iliocostalis_Thoracis_22742_ID"],22743:["Left_Iliocostalis_Thoracis_22743_ID"],22744:["Right_Iliocostalis_Cervicis_22744_ID"],22745:["Left_Iliocostalis_Cervicis_22745_ID"],22751:["Right_Longissimus_Thoracis_22751_ID"],22753:["Left_Longissimus_Thoracis_22753_ID"],22754:["Right_Longissimus_Capitis_22754_ID"],22756:["Left_Longissimus_Capitis_22756_ID"],22757:["Right_Longissimus_Cervicis_22757_ID"],22758:["Left_Longissimus_Cervicis_22758_ID"],22765:["Right_radial_recurrent_artery_22765_ID"],22766:["left_radial_recurrent_artery_22766_ID","right_radial_recurrent_artery_22766_ID"],22772:["dorsal_carpal_branch_of_Right_radial_artery_22772_ID"],22773:["dorsal_carpal_branch_of_left_radial_artery_22773_ID","dorsal_carpal_branch_of_right_radial_artery_22773_ID"],22779:["Right_Spinalis_Thoracis_22779_ID"],22780:["Left_Spinalis_Thoracis_22780_ID"],22781:["Right_Spinalis_Cervicis_22781_ID"],22782:["Left_Spinalis_Cervicis_22782_ID"],22783:["Right_Spinalis_Capitis_22783_ID"],22784:["Left_Spinalis_Capitis_22784_ID"],22798:["Right_ulnar_artery_22798_ID","Left_ulnar_artery_22798_ID"],22801:["Right_anterior_ulnar_recurrent_artery_22801_ID"],22802:["right_anterior_ulnar_recurrent_artery_22802_ID","left_anterior_ulnar_recurrent_artery_22802_ID"],22804:["Right_posterior_ulnar_recurrent_artery_22804_ID"],22805:["right_posterior_ulnar_recurrent_artery_22805_ID","left_posterior_ulnar_recurrent_artery_22805_ID"],22807:["Right_common_interosseous_artery_22807_ID"],22808:["left_common_interosseous_artery_22808_ID","right_common_interosseous_artery_22808_ID"],22812:["Right_anterior_interosseous_artery_22812_ID"],22813:["left_anterior_interosseous_artery_22813_ID","right_anterior_interosseous_artery_22813_ID"],22821:["dorsal_carpal_branch_of_Right_ulnar_artery_22821_ID"],22822:["dorsal_carpal_branch_of_left_ulnar_artery_22822_ID","dorsal_carpal_branch_of_right_ulnar_artery_22822_ID"],22836:["Right_superficial_palmar_arch_22836_ID"],22837:["left_superficial_palmar_arch_22837_ID","right_superficial_palmar_arch_22837_ID"],22839:["Right_deep_palmar_arterial_arch_22839_ID"],22840:["left_deep_palmar_venous_arch_22840_ID","right_deep_palmar_venous_arch_22840_ID","right_deep_palmar_arterial_arch_22840_ID","left_deep_palmar_arterial_arch_22840_ID","right_deep_palmar_arch_22840_ID","left_deep_palmar_arch_22840_ID"],22872:["Right_Semispinalis_thoracis_22872_ID"],22873:["Left_Semispinalis_thoracis_22873_ID"],22874:["Right_Semispinalis_cervicis_22874_ID"],22875:["Left_Semispinalis_cervicis_22875_ID"],22876:["Right_Semispinalis_capitis_22876_ID"],22877:["Left_Semispinalis_capitis_22877_ID"],22878:["Right_Multifidus_22878_ID"],22879:["Left_Multifidus_22879_ID"],22909:["Right_basilic_vein_22909_ID"],22910:["right_basilic_vein_22910_ID","left_basilic_vein_22910_ID","Left_basilic_vein_22910_ID"],22920:["Right_palmar_metacarpal_veins_22920_ID"],22921:["right_palmar_metacarpal_veins_22921_ID","left_palmar_metacarpal_veins_22921_ID"],22935:["Right_medial_brachial_vein_22935_ID"],22936:["right_medial_brachial_vein_22936_ID","left_medial_brachial_vein_22936_ID"],22948:["Right_radial_vein_22948_ID"],22949:["left_radial_vein_22949_ID","right_radial_vein_22949_ID"],22951:["right_ulnar_vein_22951_ID"],22952:["right_ulnar_vein_22952_ID","left_ulnar_vein_22952_ID"],22964:["Right_median_cubital_vein_22964_ID"],22965:["right_median_cubital_vein_22965_ID","left_median_cubital_vein_22965_ID"],22968:["Right_median_antebrachial_vein_22968_ID"],22969:["left_median_antebrachial_vein_22969_ID","right_median_antebrachial_vein_22969_ID"],23111:["Right_deep_dorsal_vein_23111_ID"],23112:["right_deep_dorsal_vein_23112_ID","left_deep_dorsal_vein_23112_ID"],23123:["Right_medial_collateral_artery_23123_ID"],23124:["right_medial_collateral_artery_23124_ID","left_medial_collateral_artery_23124_ID"],23126:["Right_radial_collateral_artery_23126_ID"],23127:["right_radial_collateral_artery_23127_ID","left_radial_collateral_artery_23127_ID"],23130:["Right_Humerus_23130_ID","Left_Humerus_23130_ID"],23180:["Right_circumflex_scapular_artery_23180_ID"],23181:["right_circumflex_scapular_artery_23181_ID","left_circumflex_scapular_artery_23181_ID"],23464:["Left_radius_23464_ID","Right_radius_23464_ID"],23467:["Left_Ulna_23467_ID","Right_Ulna_23467_ID"],23707:["Right_Interosseous_membrane_23707_ID"],23708:["Left_Interosseous_membrane_23708_ID"],24160:["Bones_of_the_Right_Arm_24160_ID"],24162:["Bones_of_the_Left_Arm_24162_ID"],24435:["Right_scaphoid_bone_24435_ID","Left_scaphoid_bone_24435_ID"],24437:["Left_lunate_bone_24437_ID","Right_lunate_bone_24437_ID"],24439:["Left_triquetral_bone_24439_ID","Right_triquetral_bone_24439_ID"],24441:["Right_pisiform_24441_ID","Left_pisiform_24441_ID"],24443:["Right_trapezium_24443_ID","Left_trapezium_24443_ID"],24444:["Right_trapezoid_bone_24444_ID","Left_trapezoid_bone_24444_ID"],24446:["Right_capitate_bone_24446_ID","Left_capitate_bone_24446_ID"],24448:["Left_hamate_bone_24448_ID","Right_hamate_bone_24448_ID"],24474:["Right_femur_24474_ID"],24475:["Left_femur_24475_ID"],24477:["Right_tibia_24477_ID"],24478:["Right_tibia_24478_ID","Left_tibia_24478_ID"],24480:["Right_fibula_24480_ID"],24481:["Right_fibula_24481_ID","Left_fibula_24481_ID"],24482:["Right_talus_24482_ID"],24483:["Right_talus_24483_ID","Left_talus_24483_ID"],24486:["Right_patella_24486_ID"],24487:["Right_patella_24487_ID","Left_patella_24487_ID"],24497:["Right_calcaneus_24497_ID"],24498:["Right_calcaneus_24498_ID","Left_calcaneus_24498_ID"],24500:["Navicular_bone_of_right_foot_24500_ID"],24501:["Navicular_of_right_foot_24501_ID","Navicular_of_left_foot_24501_ID","Navicular_bone_of_left_foot_24501_ID"],24521:["Right_medial_Cuneiform_bone_24521_ID"],24522:["Left_medial_Cuneiform_bone_24522_ID","Right_medial_Cuneiform_bone_24522_ID"],24523:["Right_intermediate_Cuneiform_bone_24523_ID"],24524:["Right_intermediate_Cuneiform_bone_24524_ID","Left_intermediate_Cuneiform_bone_24524_ID"],24525:["Right_lateral_Cuneiform_bone_24525_ID"],24526:["Right_lateral_Cuneiform_bone_24526_ID","Left_lateral_Cuneiform_bone_24526_ID"],24528:["Right_cuboid_bone_24528_ID"],24529:["Left_cuboid_bone_24529_ID","Right_cuboid_bone_24529_ID"],25005:["Anterior_atlanto_occipital_membrane_25005_ID","Anterior_atlantooccipital_membrane_25005_ID"],29711:["Prostatic_venous_plexus_29711_ID"],31893:["Anterior_longitudinal_ligament_31893_ID"],32530:["Right_Rectus_capitis_posterior_major_32530_ID"],32531:["Left_Rectus_Capitis_posterior_major_32531_ID"],32532:["Right_Rectus_capitis_posterior_minor_32532_ID"],32533:["Left_Rectus_capitis_posterior_minor_32533_ID","Right_Rectus_Capitis_posterior_major_32533_ID"],32535:["Right_Rectus_capitis_posterior_minor_32535_ID"],32540:["Right_Levator_Scapulae_32540_ID","Right_Levator_scapulae_32540_ID"],32541:["Left_Levator_scapulae_32541_ID"],32542:["Right_Deltoid_32542_ID"],32543:["Left_Deltoid_32543_ID","Right_Deltoid_32543_ID"],32544:["Right_supraspinatus_32544_ID","Right_Supraspinatus_32544_ID"],32545:["Left_Supraspinatus_32545_ID"],32547:["Right_infraspinatus_32547_ID"],32548:["Left_infraspinatus_32548_ID"],32551:["Right_Teres_Major_32551_ID"],32552:["Left_Teres_Major_32552_ID"],32553:["Right_teres_minor_32553_ID"],32554:["Left_teres_minor_32554_ID"],33098:["Right_Rotatores_short_fibers_33098_ID","Right_Rotatores_long_fibers_33098_ID"],33099:["Left_Rotatores_long_fibers_33099_ID","Left_Rotatores_short_fibers_33099_ID"],33520:["Right_pectoral_girdle_muscles_33520_ID"],33521:["Left_pectoral_girdle_muscles_33521_ID","Right_pectoral_girdle_muscles_33521_ID"],37318:["Right_ulnar_nerve_37318_ID"],37319:["Left_ulnar_nerve_37319_ID"],37386:["Right_Abductor_pollicis_brevis_37386_ID"],37387:["Left_Abductor_pollicis_brevis_37387_ID"],37388:["Right_Flexor_pollicis_brevis_37388_ID"],37389:["Left_Flexor_pollicis_brevis_37389_ID"],37390:["Right_Opponens_pollicis_37390_ID"],37391:["Left_Opponens_pollicis_37391_ID"],37392:["Right_Adductor_pollicis_37392_ID"],37393:["Left_Adductor_pollicis_37393_ID","Right_Palmaris_brevis_37393_ID"],37395:["Left_Palmaris_brevis_37395_ID"],37396:["Right_Abductor_digiti_minimi_37396_ID"],37397:["Left_Abductor_digiti_minimi_37397_ID"],37398:["Right_Flexor_digiti_minimi_brevis_37398_ID"],37399:["Left_Flexor_digiti_minimi_brevis_37399_ID"],37400:["Right_Opponens_digiti_minimi_37400_ID"],37401:["Left_Opponens_digiti_minimi_37401_ID"],37460:["Right_Abductor_hallucis_37460_ID","Left_Abductor_hallucis_37460_ID"],37462:["Right_Flexor_digiti_minimi_brevis_37462_ID","Left_Flexor_digiti_minimi_brevis_37462_ID"],37464:["Abductor_digiti_minimi_of_right_foot_37464_ID","Abductor_digiti_minimi_of_left_foot_37464_ID"],37468:["Left_Flexor_hallucis_brevis_37468_ID","Right_Flexor_hallucis_brevis_37468_ID"],37470:["Left_Adductor_hallucis_37470_ID","Left_Adductor_hallucis_oblique_head_37470_ID","Left_Adductor_hallucis_transverse_head_37470_ID","Right_Adductor_hallucis_37470_ID","Right_Adductor_hallucis_oblique_head_37470_ID","Right_Adductor_hallucis_transverse_head_37470_ID"],37665:["Right_Coracobrachialis_37665_ID"],37666:["Left_Coracobrachialis_37666_ID","Right_Coracobrachialis_37666_ID"],37668:["Right_Brachialis_37668_ID"],37669:["Left_Brachialis_37669_ID"],37671:["Right_Biceps_Brachii_37671_ID"],37672:["Right_Biceps_Brachii_37672_ID","Left_Biceps_Brachii_37672_ID"],37689:["Right_Triceps_Brachii_37689_ID"],37690:["Right_Triceps_Brachii_37690_ID","Left_Triceps_Brachii_37690_ID"],37705:["Right_anconeus_37705_ID"],37706:["Left_anconeus_37706_ID","Right_anconeus_37706_ID"],38451:["Right_Pronator_teres_38451_ID"],38452:["Left_Pronator_teres_38452_ID"],38454:["Right_Pronator_quadratus_38454_ID"],38455:["Left_Pronator_quadratus_38455_ID"],38460:["Right_Flexor_carpi_radialis_longus_38460_ID"],38461:["Left_Flexor_carpi_radialis_longus_38461_ID"],38463:["Right_Palmaris_longus_38463_ID"],38464:["Left_Palmaris_longus_38464_ID"],38466:["Right_Flexor_carpi_ulnaris_38466_ID"],38467:["Left_Flexor_carpi_ulnaris_38467_ID"],38483:["Right_flexor_pollicis_longus_38483_ID"],38484:["Left_flexor_pollicis_longus_38484_ID"],38486:["Right_Brachioradialis_38486_ID"],38487:["Left_Brachioradialis_38487_ID"],38495:["Right_Extensor_carpi_radialis_longus_38495_ID"],38496:["Left_Extensor_carpi_radialis_longus_38496_ID"],38498:["Right_Extensor_carpi_radialis_brevis_38498_ID"],38499:["Left_Extensor_carpi_radialis_brevis_38499_ID"],38504:["Right_Extensor_digiti_minimi_38504_ID"],38505:["Left_Extensor_digiti_minimi_38505_ID"],38507:["Right_Extensor_carpi_ulnaris_38507_ID"],38508:["Left_Extensor_carpi_ulnaris_38508_ID"],38513:["Right_Supinator_38513_ID"],38514:["Left_Supinator_38514_ID"],38516:["Right_Abductor_pollicis_longus_38516_ID"],38517:["Left_Abductor_pollicis_longus_38517_ID"],38519:["Right_Extensor_pollicis_brevis_38519_ID"],38520:["Left_Extensor_pollicis_brevis_38520_ID"],38522:["Right_Extensor_pollicis_longus_38522_ID"],38523:["Left_Extensor_pollicis_longus_38523_ID"],38525:["Right_Extensor_indicis_38525_ID"],38526:["Left_Extensor_indicis_38526_ID"],38928:["Right_Rectus_Femoris_38928_ID"],38929:["Left_Rectus_Femoris_38929_ID"],38930:["Right_Vastus_Lateralis_38930_ID"],38931:["Left_Vastus_Lateralis_38931_ID"],38932:["Right_Vastus_Medialis_38932_ID"],38933:["Left_Vastus_Medialis_38933_ID"],38934:["Right_Vastus_Intermedius_38934_ID"],38935:["Left_Vastus_Intermedius_38935_ID"],39091:["Left_forearm_muscles_39091_ID"],39092:["Right_forearm_muscles_39092_ID"],39987:["Right_Extensor_retinaculum_of_hand_39987_ID","Left_Extensor_retinaculum_of_hand_39987_ID"],39988:["Right_Flexor_retinaculum_of_hand_39988_ID","Left_Flexor_retinaculum_of_hand_39988_ID"],42313:["Right_Pisohamate_Ligament_42313_ID","Left_Pisohamate_Ligament_42313_ID"],42369:["Right_hand_muscles_42369_ID"],42370:["Left_hand_muscles_42370_ID"],43883:["Right_Gracilis_43883_ID"],43884:["Left_Gracilis_43884_ID"],43890:["Right_inferior_medial_genicular_artery_43890_ID"],43891:["Left_inferior_medial_genicular_artery_43891_ID","Right_inferior_medial_genicular_artery_43891_ID"],43892:["Right_inferior_lateral_genicular_artery_43892_ID"],43893:["Left_inferior_lateral_genicular_artery_43893_ID"],43896:["Right_anterior_tibial_artery_43896_ID"],43897:["Right_anterior_tibial_artery_43897_ID","Left_anterior_tibial_artery_43897_ID"],43898:["Left_anterior_tibial_artery_43898_ID","Right_posterior_tibial_artery_43898_ID"],43899:["Left_posterior_tibial_artery_43899_ID"],43907:["Right_anterior_tibial_recurrent_artery_43907_ID"],43908:["Left_anterior_tibial_recurrent_artery_43908_ID"],43916:["Right_dorsalis_pedis_artery_43916_ID"],43917:["Left_dorsalis_pedis_artery_43917_ID"],43922:["Right_fibular_artery_43922_ID"],43923:["Left_fibular_artery_43923_ID"],43929:["Right_medial_plantar_artery_43929_ID"],43930:["Left_medial_plantar_artery_43930_ID"],43931:["Right_lateral_plantar_artery_43931_ID"],43932:["Left_lateral_plantar_artery_43932_ID"],43935:["Right_deep_medial_plantar_artery_43935_ID"],43936:["Left_deep_medial_plantar_artery_43936_ID"],43943:["Right_plantar_arch_43943_ID"],43944:["Left_plantar_arch_43944_ID"],43950:["Calcaneal_branch_of_right_fibular_artery_43950_ID"],43951:["Calcaneal_branch_of_left_fibular_artery_43951_ID"],44227:["Left_Popliteal_Lymph_Nodes_44227_ID","Right_Popliteal_Lymph_Nodes_44227_ID"],44249:["Right_Long_plantar_ligament_44249_ID","Left_Long_plantar_ligament_44249_ID"],44310:["Lymphatics_of_the_Lower_Limb_44310_ID"],44326:["Descending_branch_of_right_lateral_circumflex_femoral_Vein_44326_ID"],44327:["Descending_branch_of_left_lateral_circumflex_femoral_Vein_44327_ID"],44328:["Right_Popliteal_vein_44328_ID"],44329:["Left_Popliteal_vein_44329_ID"],44334:["Right_small_saphenous_vein_44334_ID"],44335:["Left_small_saphenous_vein_44335_ID"],44336:["Right_Anterior_Tibial_Vein_44336_ID"],44337:["Left_Anterior_Tibial_Vein_44337_ID"],44338:["Right_Posterior_Tibial_Vein_44338_ID"],44339:["Left_Posterior_Tibial_Vein_44339_ID"],44340:["Right_superficial_epigastric_vein_44340_ID"],44341:["Left_superficial_epigastric_vein_44341_ID"],44583:["Right_Oblique_Popliteal_Ligament_44583_ID"],44584:["Left_Oblique_Popliteal_Ligament_44584_ID"],44585:["Right_Patellar_Ligament_44585_ID"],44586:["Left_Patellar_Ligament_44586_ID"],44597:["Right_Arcuate_Popliteal_Ligament_44597_ID"],44599:["Left_Arcuate_Popliteal_Ligament_44599_ID"],44601:["Right_Tibial_Collateral_Ligament_44601_ID"],44602:["Left_Tibial_Collateral_Ligament_44602_ID"],44609:["Right_Fibular_Collateral_Ligament_44609_ID"],44610:["Left_Fibular_Collateral_Ligament_44610_ID"],44615:["Right_Anterior_Cruciate_Ligament_44615_ID"],44616:["Left_Anterior_Cruciate_Ligament_44616_ID"],44618:["Right_Posterior_Cruciate_Ligament_44618_ID"],44619:["Left_Posterior_Cruciate_Ligament_44619_ID"],44741:["Right_proper_plantar_digital_nerves_44741_ID"],44742:["Left_proper_plantar_digital_nerves_44742_ID"],44874:["Right_dorsal_branch_of_ulnar_nerve_44874_ID"],44875:["Left_dorsal_branch_of_ulnar_nerve_44875_ID"],44881:["Branch_of_Dorsal_venous_arch_of_Right_foot_44881_ID","Right_Dorsalis_pedis_vein_44881_ID","Dorsal_venous_arch_of_Right_foot_44881_ID"],44882:["Branch_of_Dorsal_venous_arch_of_Left_foot_44882_ID","Dorsal_venous_arch_of_Left_foot_44882_ID","Left_Dorsalis_pedis_vein_44882_ID"],44883:["Medial_branch_of_Plantar_venous_arch_of_right_foot_44883_ID","Plantar_venous_arch_of_Right_foot_44883_ID","Lateral_branch_of_Plantar_venous_arch_of_right_foot_44883_ID"],44884:["Medial_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Lateral_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Plantar_venous_arch_of_Left_foot_44884_ID"],44885:["Right_Fibular_vein_44885_ID"],44886:["Left_Fibular_vein_44886_ID"],44887:["Right_Superior_Medial_Genicular_vein_44887_ID","Right_Genicular_Veins_44887_ID","Right_Inferior_Medial_Genicular_Vein_44887_ID","Right_Superior_Lateral_Genicular_vein_44887_ID","Right_Inferior_Lateral_Genicular_Vein_44887_ID"],44888:["Left_Inferior_Lateral_Genicular_Vein_44888_ID","Left_Genicular_Veins_44888_ID","Left_Inferior_Medial_Genicular_Vein_44888_ID","Left_Superior_Medial_Genicular_vein_44888_ID","Left_Superior_Lateral_Genicular_vein_44888_ID"],44918:["Right_medial_circumflex_femoral_vein_44918_ID"],44919:["Left_medial_circumflex_femoral_vein_44919_ID"],44920:["Right_lateral_circumflex_femoral_vein_44920_ID"],44922:["Left_lateral_circumflex_femoral_vein_44922_ID"],45257:["Right_Intermediate_Femoral_Cutaneous_Nerve_45257_ID"],45258:["Left_Intermediate_Femoral_Cutaneous_Nerve_45258_ID"],45263:["Right_saphenous_nerve_45263_ID"],45264:["Left_saphenous_nerve_45264_ID"],45338:["Right_Posterior_femoral_cutaneous_nerve_45338_ID"],45339:["Left_Posterior_femoral_cutaneous_nerve_45339_ID"],45357:["Right_common_fibular_nerve_45357_ID"],45358:["Left_common_fibular_nerve_45358_ID"],45363:["Right_superficial_fibular_nerve_45363_ID"],45364:["Left_superficial_fibular_nerve_45364_ID"],45387:["Right_deep_fibular_nerve_45387_ID"],45388:["Left_deep_fibular_nerve_45388_ID"],45389:["Right_Lateral_terminal_branch_of_deep_fibular_nerve_45389_ID"],45390:["Left_Lateral_terminal_branch_of_deep_fibular_nerve_45390_ID"],45426:["Right_sural_nerve_45426_ID"],45427:["Left_sural_nerve_45427_ID"],45434:["Right_medial_proper_plantar_nerve_45434_ID"],45435:["Left_medial_proper_plantar_nerve_45435_ID"],45450:["Right_lateral_plantar_nerve_45450_ID"],45451:["Left_lateral_plantar_nerve_45451_ID"],45654:["Female_Internal_Genitalia_45654_ID"],45739:["Right_platysma_45739_ID"],45740:["Left_platysma_45740_ID"],45769:["Internal_Urethral_Sphincter_45769_ID"],45826:["Right_Stylohyoid_45826_ID"],45827:["Left_Stylohyoid_45827_ID"],45858:["Right_Iliococcygeus_45858_ID"],45859:["Left_Iliococcygeus_45859_ID"],45890:["Right_Biceps_Femoris_Short_Head_45890_ID"],45891:["Left_Biceps_Femoris_Short_Head_45891_ID"],46283:["Superior_oblique_part_of_right_longus_colli_46283_ID"],46284:["Superior_oblique_part_of_left_longus_colli_46284_ID"],46285:["Vertical_Intermediate_part_of_right_longus_colli_46285_ID"],46286:["Vertical_Intermediate_part_of_left_longus_colli_46286_ID"],46287:["Inferior_oblique_part_of_right_longus_colli_46287_ID"],46288:["Inferior_oblique_part_of_left_longus_colli_46288_ID"],46292:["Right_Digastric_46292_ID","Right_Digastric_muscle_46292_ID"],46293:["Left_Digastric_46293_ID","Left_Digastric_muscle_46293_ID"],46309:["Right_Longus_capitis_46309_ID"],46310:["Left_Longus_capitis_46310_ID"],46313:["Right_Rectus_capitis_anterior_46313_ID"],46314:["Left_Rectus_capitis_anterior_46314_ID"],46317:["Right_Rectus_capitis_lateralis_46317_ID"],46318:["Right_Rectus_capitis_lateralis_46318_ID","Left_Rectus_capitis_lateralis_46318_ID"],46319:["Left_Rectus_capitis_lateralis_46319_ID"],46321:["Right_Mylohyoid_muscle_46321_ID","Right_Mylohyoid_Muscle_46321_ID"],46322:["Left_Mylohyoid_46322_ID","Left_Mylohyoid_Muscle_46322_ID"],46326:["Right_Geniohyoid_46326_ID"],46327:["Left_Geniohyoid_46327_ID"],46443:["Right_Coccygeus_46443_ID"],46444:["Left_Coccygeus_46444_ID"],46563:["Vertical_part_of_left_cricothyroid_muscle_46563_ID","Right_Cricothyroid_muscle_46563_ID","Oblique_part_of_left_cricothyroid_muscle_46563_ID"],46564:["Vertical_part_of_left_cricothyroid_muscle_46564_ID","Left_Cricothyroid_muscle_46564_ID","Oblique_part_of_left_cricothyroid_muscle_46564_ID"],46621:["Superior_Pharyngeal_Constrictor_46621_ID"],46622:["Middle_Pharyngeal_Constrictor_46622_ID"],46623:["Inferior_Pharyngeal_Constrictor_46623_ID"],46690:["Genioglossus_46690_ID"],46703:["Right_Hyoglossus_46703_ID"],46704:["Left_Hyoglossus_46704_ID"],46705:["Right_Styloglossus_46705_ID"],46706:["Right_Styloglossus_46706_ID","Left_Styloglossus_46706_ID"],46759:["Right_frontalis_46759_ID"],46760:["Left_frontalis_46760_ID"],46761:["Right_occipitalis_46761_ID"],46762:["Left_occipitalis_46762_ID"],46768:["Epicranial_aponeurosis_46768_ID"],46777:["Depressor_septi_nasi_46777_ID"],46792:["Right_orbicularis_oculi_46792_ID"],46793:["Left_orbicularis_oculi_46793_ID"],46796:["Right_corrugator_supercilii_46796_ID"],46797:["Left_corrugator_supercilii_46797_ID"],46803:["Right_levator_labii_superioris_alaeque_nasi_46803_ID"],46804:["Left_levator_labii_superioris_alaeque_nasi_46804_ID"],46806:["Right_levator_labii_superioris_46806_ID"],46807:["Left_levator_labii_superioris_46807_ID"],46812:["Right_zygomaticus_major_46812_ID"],46813:["Left_zygomaticus_major_46813_ID"],46814:["Right_zygomaticus_minor_46814_ID"],46815:["Left_zygomaticus_minor_46815_ID"],46817:["Right_depressor_labii_inferioris_46817_ID"],46818:["Left_depressor_labii_inferioris_46818_ID"],46823:["Right_levator_anguli_oris_46823_ID"],46824:["Left_levator_anguli_oris_46824_ID"],46826:["Right_mentalis_46826_ID"],46827:["Left_mentalis_46827_ID"],46829:["Right_depressor_anguli_oris_46829_ID"],46830:["Left_depressor_anguli_oris_46830_ID"],46835:["Right_buccinator_46835_ID"],46836:["Left_buccinator_46836_ID"],46839:["Right_risorius_46839_ID"],46840:["Left_risorius_46840_ID"],46841:["Orbicularis_oris_46841_ID"],48025:["Left_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_Muscle_48025_ID","Left_Tendon_of_Digastric_Muscle_48025_ID"],48957:["Right_auricularis_superior_48957_ID"],48958:["Left_auricularis_superior_48958_ID"],48959:["Right_auricularis_anterior_48959_ID"],48960:["Left_auricularis_anterior_48960_ID"],48961:["Right_auricularis_posterior_48961_ID"],48962:["Left_auricularis_posterior_48962_ID"],48997:["Right_masseter_48997_ID"],48998:["Left_masseter_48998_ID"],49007:["Right_temporalis_49007_ID"],49008:["Left_temporalis_49008_ID"],49012:["Right_Medial_Pterygoid_49012_ID"],49013:["Left_Medial_Pterygoid_49013_ID"],49016:["Right_inferior_lateral_pterygoid_49016_ID","Right_superior_lateral_pterygoid_49016_ID"],49017:["Left_superior_lateral_pterygoid_49017_ID","Left_inferior_lateral_pterygoid_49017_ID"],49036:["Left_inferior_rectus_49036_ID"],49044:["Right_superior_rectus_49044_ID"],49045:["Left_superior_rectus_49045_ID"],49046:["Right_inferior_rectus_49046_ID"],49047:["Left_inferior_rectus_49047_ID"],49048:["Right_levator_palpebrae_superioris_49048_ID"],49049:["Left_levator_palpebrae_superioris_49049_ID"],49050:["Right_inferior_oblique_49050_ID"],49051:["Left_inferior_oblique_49051_ID"],49052:["Right_superior_oblique_49052_ID"],49053:["Left_superior_oblique_49053_ID"],49054:["Right_lateral_rectus_49054_ID"],49055:["Left_lateral_rectus_49055_ID"],49056:["Right_medial_rectus_49056_ID"],49057:["Left_medial_rectus_49057_ID"],49152:["Right_Ciliary_Muscle_49152_ID"],49153:["Left_Ciliary_Muscle_49153_ID"],49177:["Upper_Gastrointestinal_Tract_49177_ID"],49386:["Right_Inferior_extensor_retinaculum_49386_ID","Left_Inferior_extensor_retinaculum_49386_ID"],49388:["Right_Superior_extensor_retinaculum_49388_ID","Left_Superior_extensor_retinaculum_49388_ID"],49481:["Right_superior_laryngeal_artery_49481_ID"],49482:["Left_superior_laryngeal_artery_49482_ID"],49486:["Right_superior_thyroid_artery_49486_ID"],49487:["Left_superior_thyroid_artery_49487_ID"],49498:["Right_ascending_pharyngeal_artery_49498_ID"],49499:["Left_ascending_pharyngeal_artery_49499_ID"],49550:["Right_facial_artery_49550_ID"],49551:["Left_facial_artery_49551_ID","Right_facial_artery_49551_ID"],49552:["Left_facial_artery_49552_ID"],49556:["Right_ascending_palatine_artery_49556_ID"],49557:["Left_ascending_palatine_artery_49557_ID"],49559:["Right_tonsillar_artery_49559_ID"],49560:["Left_tonsillar_artery_49560_ID"],49561:["Right_tonsillar_artery_49561_ID"],49567:["Inferior_labial_artery_49567_ID"],49570:["Superior_labial_artery_49570_ID"],49584:["Right_angular_artery_49584_ID"],49585:["Left_angular_artery_49585_ID"],49625:["Right_posterior_auricular_artery_49625_ID"],49626:["Left_posterior_auricular_artery_49626_ID"],49651:["Right_superficial_temporal_artery_49651_ID"],49652:["Left_superficial_temporal_artery_49652_ID"],49658:["Right_transverse_facial_artery_49658_ID"],49659:["Left_transverse_facial_artery_49659_ID"],49660:["Right_transverse_facial_artery_49660_ID"],49676:["Right_maxillary_artery_49676_ID"],49677:["Left_maxillary_artery_49677_ID"],49678:["Right_maxillary_artery_49678_ID"],49705:["Right_mental_artery_49705_ID","branch_of_right_mental_artery_49705_ID"],49706:["Left_mental_artery_49706_ID","branch_of_left_mental_artery_49706_ID"],49712:["Right_middle_meningeal_artery_49712_ID"],49713:["Left_middle_meningeal_artery_49713_ID"],49743:["Right_deep_temporal_artery_49743_ID"],49744:["Left_deep_temporal_artery_49744_ID"],49755:["Right_buccal_artery_49755_ID"],49756:["Left_buccal_artery_49756_ID"],49768:["Right_infraorbital_artery_49768_ID"],49769:["Left_infraorbital_artery_49769_ID"],49792:["Right_descending_palatine_artery_49792_ID"],49793:["Left_descending_palatine_artery_49793_ID"],49799:["Left_greater_palatine_artery_49799_ID"],49800:["Right_greater_palatine_artery_49800_ID"],49802:["Right_lesser_palatine_artery_49802_ID"],49803:["Left_lesser_palatine_artery_49803_ID"],49805:["Right_sphenopalatine_artery_49805_ID"],49806:["Left_sphenopalatine_artery_49806_ID"],49810:["Right_posterior_lateral_nasal_artery_49810_ID"],49811:["Left_posterior_lateral_nasal_artery_49811_ID"],49812:["Posterior_septal_branch_of_right_sphenopalatine_artery_49812_ID"],49813:["Posterior_septal_branch_of_left_sphenopalatine_artery_49813_ID"],49869:["Right_opthalmic_artery_49869_ID","Right_ophthalmic_artery_49869_ID"],49870:["Left_opthalmic_artery_49870_ID","Left_ophthalmic_artery_49870_ID"],49881:["Right_central_retinal_artery_49881_ID","Left_central_retinal_artery_49881_ID"],49911:["Right_Inferior_Pulmonary_vein_49911_ID"],49913:["Left_Inferior_Pulmonary_vein_49913_ID"],49914:["Right_Superior_Pulmonary_vein_49914_ID"],49916:["Left_Superior_Pulmonary_vein_49916_ID"],49928:["Right_lacrimal_artery_49928_ID"],49929:["Left_lacrimal_artery_49929_ID"],49974:["Right_supraorbital_artery_49974_ID"],49975:["Left_supraorbital_artery_49975_ID"],49987:["Right_anterior_ethmoidal_artery_49987_ID"],49988:["Left_anterior_ethmoidal_artery_49988_ID"],49990:["Right_posterior_ethmoidal_artery_49990_ID"],49991:["Left_posterior_ethmoidal_artery_49991_ID"],50001:["Right_dorsal_nasal_artery_50001_ID"],50002:["Left_dorsal_nasal_artery_50002_ID"],50026:["Right_supratrochlear_artery_50026_ID"],50027:["Left_supratrochlear_artery_50027_ID","Right_supratrochlear_artery_50027_ID"],50028:["Left_supratrochlear_artery_50028_ID"],50029:["Right_anterior_cerebral_artery_50029_ID"],50030:["Left_anterior_cerebral_artery_50030_ID"],50031:["Left_anterior_cerebral_artery_50031_ID"],50038:["Left_coronary_artery_50038_ID"],50039:["Right_Coronary_Artery_50039_ID"],50082:["Right_Middle_Cerebral_Artery_50082_ID"],50083:["Left_Middle_Cerebral_Artery_50083_ID"],50085:["Right_Posterior_Communicating_Artery_50085_ID"],50086:["Left_Posterior_Communicating_Artery_50086_ID"],50169:["Anterior_Communicating_Artery_50169_ID"],50197:["Muscles_of_the_Right_Arm_50197_ID"],50198:["Muscles_of_the_Right_Arm_50198_ID","Muscles_of_the_Left_Arm_50198_ID"],50203:["Right_upper_arm_muscles_50203_ID"],50204:["Right_upper_arm_muscles_50204_ID","Left_upper_arm_muscles_50204_ID"],50221:["Right_shoulder_muscles_50221_ID","Left_shoulder_muscles_50221_ID"],50222:["Left_shoulder_muscles_50222_ID","Right_shoulder_muscles_50222_ID"],50542:["Basilar_Artery_50542_ID"],50545:["Right_Anterior_Inferior_cerebellar_artery_50545_ID","Right_anterior_Inferior_cerebellar_artery_50545_ID"],50546:["Left_Anterior_Inferior_cerebellar_artery_50546_ID","Left_anterior_Inferior_cerebellar_artery_50546_ID"],50574:["Right_Superior_Cerebellar_artery_50574_ID"],50575:["Left_Superior_Cerebellar_Artery_50575_ID","Left_Superior_Cerebellar_artery_50575_ID"],50584:["Right_Posterior_cerebral_artery_50584_ID","Right_posterior_cerebral_artery_50584_ID"],50585:["Left_Posterior_cerebral_artery_50585_ID","Left_posterior_cerebral_artery_50585_ID"],50718:["Superior_Terminal_Branch_of_Right_Middle_Cerebral_Artery_50718_ID"],50719:["Superior_Terminal_Branch_of_Left_Middle_Cerebral_Artery_50719_ID"],50735:["Hepatic_Portal_and_Associated_Branches_50735_ID"],50764:["Right_transverse_sinus_50764_ID"],50765:["Left_transverse_sinus_50765_ID"],50767:["Superior_sagittal_sinus_50767_ID"],50768:["Inferior_Sagittal_Sinus_50768_ID"],50769:["Straight_Sinus_50769_ID"],50773:["Intercavernous_sinus_50773_ID"],50781:["Occipital_Sinus_50781_ID"],50784:["Sinus_Confluence_50784_ID"],50808:["Right_superior_thyroid_vein_50808_ID"],50809:["Left_superior_thyroid_vein_50809_ID"],50852:["Right_posterior_auricular_vein_50852_ID"],50853:["Left_posterior_auricular_vein_50853_ID"],50859:["Right_suprascapular_vein_50859_ID"],50860:["Left_suprascapular_vein_50860_ID","Right_suprascapular_vein_50860_ID"],50872:["Right_Pulmonary_artery_50872_ID"],50873:["Left_Pulmonary_artery_50873_ID"],50875:["Right_optic_nerve_50875_ID"],50876:["Left_Facial_Vein_50876_ID","Right_Facial_Vein_50876_ID"],50877:["Right_Facial_Vein_50877_ID","Left_Facial_Vein_50877_ID"],50878:["Left_optic_nerve_50878_ID"],50879:["Right_oculomotor_nerve_50879_ID"],50880:["Left_oculomotor_nerve_50880_ID"],50881:["Right_trochlear_nerve_50881_ID"],50882:["Left_trochlear_nerve_50882_ID"],50886:["Right_abducens_nerve_50886_ID"],50887:["Left_abducens_nerve_50887_ID"],50888:["Right_facial_nerve_50888_ID"],50889:["Left_facial_nerve_50889_ID"],50890:["Right_vestibulocochlear_nerve_50890_ID"],50891:["Left_vestibulocochlear_nerve_50891_ID"],50892:["Right_glossopharyngeal_nerve_50892_ID"],50894:["Left_glossopharyngeal_nerve_50894_ID"],50897:["Right_spinal_accessory_nerve_50897_ID","Left_spinal_accessory_nerve_50897_ID"],50899:["Left_spinal_accessory_nerve_50899_ID"],50902:["Right_hypoglossal_nerve_50902_ID"],50903:["Left_hypoglossal_Nerve_50903_ID"],50929:["Right_retromandibular_vein_50929_ID"],50930:["Left_retromandibular_vein_50930_ID"],50933:["Right_Superficial_Temporal_Vein_50933_ID"],50934:["Left_Superficial_Temporal_Vein_50934_ID"],51042:["Right_Deep_Femoral_vein_51042_ID"],51043:["Left_Deep_Femoral_vein_51043_ID"],51085:["Tendon_of_left_flexor_digitorum_brevis_51085_ID","Tendon_of_right_flexor_digitorum_brevis_51085_ID","Right_flexor_digitorum_longus_51085_ID","Left_flexor_digitorum_longus_51085_ID"],51289:["Right_superior_petrosal_sinus_51289_ID"],51290:["Left_superior_petrosal_sinus_51290_ID"],51402:["Right_Cavernous_sinus_51402_ID"],51403:["Left_Cavernous_Sinus_51403_ID"],51489:["Right_occipital_vein_51489_ID"],51490:["Left_occipital_vein_51490_ID"],51885:["Left_central_retinal_vein_51885_ID","Right_central_retinal_vein_51885_ID"],51942:["Right_superior_central_retinal_artery_51942_ID","Left_superior_central_retinal_artery_51942_ID"],51944:["Right_inferior_central_retinal_artery_51944_ID","Left_inferior_central_retinal_artery_51944_ID"],52619:["Right_trigeminal_ganglion_52619_ID"],52620:["Left_trigeminal_ganglion_52620_ID"],52629:["Right_lacrimal_nerve_52629_ID"],52630:["Left_lacrimal_nerve_52630_ID"],52639:["Right_opthalmic_nerve_52639_ID"],52640:["Left_opthalmic_nerve_52640_ID"],52643:["Right_supratrochlear_nerve_52643_ID"],52644:["Left_supratrochlear_nerve_52644_ID"],52661:["Medial_branch_of_right_supraorbital_nerve_52661_ID"],52662:["Medial_branch_of_left_supraorbital_nerve_52662_ID"],52663:["Lateral_branch_of_right_supraorbital_nerve_52663_ID"],52664:["Lateral_branch_of_left_supraorbital_nerve_52664_ID"],52669:["Right_nasociliary_nerve_52669_ID"],52670:["Left_nasociliary_nerve_52670_ID"],52725:["Right_maxillary_nerve_52725_ID"],52726:["Left_maxillary_nerve_52726_ID"],52734:["Frontal_bone_52734_ID"],52735:["Occipital_bone_52735_ID"],52736:["Sphenoid_bone_52736_ID"],52738:["Right_temporal_bone_52738_ID"],52739:["Left_temporal_bone_52739_ID"],52740:["Ethmoid_bone_52740_ID"],52745:["Nasal_bone_52745_ID"],52746:["Palatine_bone_52746_ID"],52748:["Mandible_52748_ID"],52749:["Hyoid_bone_52749_ID"],52784:["Left_lateral_posterior_superior_nasal_nerve_52784_ID"],52785:["Right_lateral_posterior_superior_nasal_nerve_52785_ID"],52788:["Right_parietal_bone_52788_ID"],52789:["Left_parietal_bone_52789_ID"],52803:["Right_greater_palatine_nerve_52803_ID"],52804:["Left_greater_palatine_nerve_52804_ID"],52806:["Right_lesser_palatine_nerve_52806_ID"],52807:["Left_lesser_palatine_nerve_52807_ID"],52824:["Left_posterior_inferior_nasal_nerve_52824_ID"],52825:["Right_posterior_inferior_nasal_nerve_52825_ID"],52892:["Right_zygomatic_bone_52892_ID"],52893:["Left_zygomatic_bone_52893_ID"],52974:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52974_ID"],52975:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52975_ID"],52976:["Zygomaticofacial_branch_of_right_zygomatic_nerve_52976_ID"],52977:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52977_ID","Zygomaticofacial_branch_of_left_zygomatic_nerve_52977_ID"],52978:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52978_ID"],52979:["Right_infraorbital_nerve_52979_ID"],52980:["Left_infra_orbital_nerve_52980_ID","Left_infraorbital_nerve_52980_ID"],52997:["Right_Mandibular_Nerve_52997_ID"],52998:["Left_Mandibular_Nerve_52998_ID"],53001:["Right_auriculotemporal_nerve_53001_ID"],53002:["Left_auriculotemporal_nerve_53002_ID"],53069:["Right_pterygopalatine_ganglion_53069_ID"],53070:["Left_pterygopalatine_ganglion_53070_ID"],53121:["Right_zygomatic_bone_53121_ID"],53122:["Left_zygomatic_bone_53122_ID"],53185:["Buccal_branch_of_right_facial_nerve_53185_ID","Buccal_branch_of_Right_Facial_Nerve_53185_ID"],53186:["Buccal_branch_of_Left_Facial_Nerve_53186_ID"],53219:["Right_lingual_nerve_53219_ID"],53220:["Left_lingual_nerve_53220_ID"],53244:["Right_Inferior_Alveolar_Nerve_53244_ID"],53245:["Left_Inferior_Alveolar_Nerve_53245_ID"],53251:["Right_mental_nerve_53251_ID","Left_mental_nerve_53251_ID"],53252:["Left_mental_nerve_53252_ID"],53279:["Right_posterior_auricular_nerve_53279_ID"],53280:["Left_posterior_auricular_nerve_53280_ID"],53290:["Temporal_branch_of_the_right_facial_nerve_53290_ID"],53291:["Temporal_branch_of_the_left_facial_nerve_53291_ID","Temporal_branch_of_the_right_facial_nerve_53291_ID"],53366:["Marginal_mandibular_branch_of_right_facial_nerve_53366_ID"],53367:["Marginal_mandibular_branch_of_left_facial_nerve_53367_ID"],53398:["Cervical_branch_of_right_facial_nerve_53398_ID"],53399:["Cervical_branch_of_left_facial_nerve_53399_ID"],53549:["Right_ciliary_ganglion_53549_ID"],53550:["Left_ciliary_ganglion_53550_ID"],53641:["Right_ear_53641_ID"],53642:["Left_ear_53642_ID"],53643:["Left_ear_53643_ID"],53645:["Right_Lacrimal_Bone_53645_ID"],53646:["Left_lacrimal_bone_53646_ID"],53654:["Palatine_bone_53654_ID"],54375:["Nasal_septum_54375_ID"],54449:["Right_eye_54449_ID"],54450:["Left_eye_54450_ID"],54640:["Tongue_54640_ID"],55099:["Thyroid_Cartilage_55099_ID"],55123:["Lower_part_of_cricopharyngeus_55123_ID"],55132:["Thyrohyoid_Membrane_55132_ID"],55143:["Right_ansa_cervicalis_nerve_55143_ID"],55144:["left_ansa_cervicalis_nerve_55144_ID"],55145:["Right_ansa_cervicalis_nerve_55145_ID"],55233:["Cricothyroid_ligament_55233_ID"],55560:["Right_Superior_Parathyroid_55560_ID"],55561:["Left_Superior_Parathyroid_55561_ID"],55562:["Right_Inferior_Parathyroid_55562_ID"],55563:["Left_Inferior_Parathyroid_55563_ID"],55610:["Right_procerus_55610_ID"],55611:["Left_procerus_55611_ID"],55612:["Transverse_part_of_right_nasalis_55612_ID"],55613:["Transverse_part_of_left_nasalis_55613_ID"],55614:["Alar_part_of_right_nasalis_55614_ID"],55615:["Alar_part_of_left_nasalis_55615_ID"],56103:["Right_Internal_acoustic_meatus_56103_ID"],56104:["Left_Internal_acoustic_meatus_56104_ID"],56427:["Right_tympanic_membrane_56427_ID"],56428:["Left_tympanic_membrane_56428_ID"],58236:["Right_Iris_58236_ID"],58237:["Left_Iris_58237_ID"],58242:["Right_Lens_58242_ID"],58243:["Left_Lens_58243_ID"],58271:["Right_Sclera_58271_ID"],58272:["Left_Sclera_58272_ID"],58299:["Right_Choroid_58299_ID"],58300:["Left_Choroid_58300_ID"],58302:["Right_Retina_58302_ID"],58303:["Left_Retina_58303_ID"],58841:["Right_Hyaloid_Canal_58841_ID"],58842:["Left_Hyaloid_Canal_58842_ID"],59102:["Right_lacrimal_gland_59102_ID"],59103:["Left_lacrimal_gland_59103_ID"],59505:["Right_major_alar_cartilage_59505_ID"],59506:["Left_major_alar_cartilage_59506_ID"],59512:["Right_lateral_nasal_cartilage_59512_ID"],59513:["Left_lateral_nasal_cartilage_59513_ID"],59545:["Right_lacrimal_sac_59545_ID"],59546:["Left_lacrimal_sac_59546_ID"],59797:["Left_Parotid_Gland_59797_ID","Right_Parotid_Gland_59797_ID"],59798:["Right_Parotid_Gland_59798_ID","Left_Parotid_Gland_59798_ID"],59802:["Right_Submandibular_Gland_59802_ID"],59803:["Left_Submandibular_Gland_59803_ID"],59804:["Right_Sublingual_Gland_59804_ID"],59805:["Left_Sublingual_Gland_59805_ID"],59866:["Right_Parotid_Duct_59866_ID"],59867:["Left_Parotid_Duct_59867_ID"],59964:["Right_Submandibular_Duct_59964_ID"],59965:["Left_Submandibular_Duct_59965_ID"],60180:["Right_osseous_labyrinth_60180_ID"],60181:["Left_osseous_labyrinth_60181_ID"],60188:["Right_Anterior_semicircular_canal_60188_ID"],60189:["Left_Anterior_semicircular_canal_60189_ID"],60191:["Right_Posterior_semicircular_canal_60191_ID"],60192:["Left_Posterior_semicircular_canal_60192_ID"],60194:["Right_Lateral_semicircular_canal_60194_ID"],60195:["Left_Lateral_semicircular_canal_60195_ID"],60202:["Right_Cochlea_60202_ID"],60203:["Left_Cochlea_60203_ID"],61020:["Right_Internal_Ear_61020_ID"],61021:["Left_Internal_Ear_61021_ID"],61735:["Right_external_acoustic_tube_61735_ID"],61736:["Left_external_acoustic_tube_61736_ID"],61965:["fornix_61965_ID"],62008:["hypothalamus_62008_ID"],62033:["Pineal_Gland_62033_ID"],62045:["optic_chiasm_62045_ID"],64919:["Right_Iliopsoas_64919_ID"],64920:["Left_Iliopsoas_64920_ID"],65015:["Left_Flexor_hallucis_longus_65015_ID","Right_Flexor_hallucis_longus_65015_ID"],65019:["Left_Tibialis_posterior_65019_ID","Right_Tibialis_posterior_65019_ID"],65281:["Right_long_thoracic_nerve_65281_ID"],65282:["Left_long_thoracic_nerve_65282_ID"],65536:["Right_lumbosacral_trunk_nerve_65536_ID"],65537:["Left_lumbosacral_trunk_nerve_65537_ID","Left_lumbosacral_trunk_65537_ID"],66321:["Right_thoracodorsal_artery_66321_ID"],66322:["right_thoracodorsal_artery_66322_ID","left_thoracodorsal_artery_66322_ID"],67584:["Left_nerve_of_pterygoid_canal_67584_ID","Right_nerve_of_pterygoid_canal_67584_ID"],67944:["cerebellum_67944_ID"],69316:["Right_Brachiocephalic_trunk_69316_ID"],69490:["Right_lateral_tarsal_artery_69490_ID"],69491:["Left_lateral_tarsal_artery_69491_ID"],69494:["Right_arcuate_artery_69494_ID"],69495:["Left_arcuate_artery_69495_ID"],69514:["Right_deep_plantar_artery_69514_ID"],69515:["Right_deep_plantar_artery_69515_ID"],69516:["Left_deep_plantar_artery_69516_ID"],69726:["Calcaneal_branch_of_right_posterior_tibial_artery_69726_ID"],69727:["Calcaneal_branch_of_left_posterior_tibial_artery_69727_ID"],70249:["Right_femoral_artery_70249_ID"],70250:["Left_femoral_artery_70250_ID"],70799:["Right_dorsal_metacarpal_arteries_70799_ID"],70800:["left_dorsal_metacarpal_arteries_70800_ID","right_dorsal_metacarpal_arteries_70800_ID"],70801:["left_dorsal_digital_arteries_70801_ID","right_dorsal_digital_arteries_70801_ID","Right_dorsal_digital_arteries_70801_ID","Right_palmar_metacarpal_arteries_70801_ID"],70802:["left_palmar_metacarpal_arteries_70802_ID","right_palmar_metacarpal_arteries_70802_ID","Right_common_palmar_digital_arteries_70802_ID"],70803:["right_common_palmar_digital_arteries_70803_ID","Right_proper_palmar_digital_arteries_70803_ID","left_common_palmar_digital_arteries_70803_ID"],70804:["left_proper_palmar_digital_arteries_70804_ID","right_proper_palmar_digital_arteries_70804_ID","left_common_palmar_digital_arteries_70804_ID"],70809:["Set_of_Jejunal_arteries_70809_ID"],70810:["Set_of_ileal_arteries_70810_ID"],70815:["Perforating_arteries_of_left_deep_fibular_artery_70815_ID","Perforating_arteries_of_right_deep_fibular_artery_70815_ID"],70889:["Left_lumbar_vein_70889_ID","Right_lumbar_vein_70889_ID"],70917:["Right_palmar_digital_veins_70917_ID"],70918:["right_palmar_digital_veins_70918_ID","left_palmar_digital_veins_70918_ID"],70922:["Right_distal_perforating_veins_70922_ID","Perforating_veins_of_right_deep_femoral_artery_70922_ID","Perforating_veins_of_left_deep_femoral_artery_70922_ID","Left_distal_perforating_veins_70922_ID"],70927:["Set_of_jejunal_veins_70927_ID"],70928:["Set_of_ileal_veins_70928_ID"],71132:["Gastrointestinal_Tract_71132_ID"],71211:["Right_lateral_thoracic_vein_71211_ID"],71212:["Left_lateral_thoracic_vein_71212_ID","Right_lateral_thoracic_vein_71212_ID"],71214:["Right_thoracodorsal_vein_71214_ID","Left_thoracodorsal_vein_71214_ID"],71215:["Right_thoracodorsal_vein_71215_ID"],71287:["Muscles_of_the_Head_and_Neck_71287_ID"],71291:["Muscles_of_the_Back_71291_ID"],71293:["Muscles_of_the_Thorax_71293_ID"],71310:["Left_Intertransversarii_71310_ID","Right_Intertransversarii_71310_ID"],71398:["Left_Radiate_Sternocostal_Ligaments_71398_ID","Right_Radiate_Sternocostal_Ligaments_71398_ID"],71894:["Right_carpal_bones_71894_ID","Left_carpal_bones_71894_ID"],71898:["Right_metacarpal_bones_of_hand_71898_ID","Left_metacarpal_bones_of_hand_71898_ID"],71900:["Phalanges_of_right_hand_71900_ID","Phalanges_of_left_hand_71900_ID"],72063:["Set_of_cervical_vertebrae_72063_ID"],72064:["Set_of_thoracic_vertebrae_72064_ID"],72065:["Set_of_lumbar_vertebrae_72065_ID"],72309:["Right_Stylohyoid_Ligament_72309_ID"],72311:["Left_Stylohyoid_Ligament_72311_ID"],72316:["Set_of_intervertebral_discs_72316_ID"],72826:["right_caudate_nucleus_72826_ID"],72827:["left_caudate_nucleus_72827_ID"],72828:["right_putamen_72828_ID"],72829:["left_putamen_72829_ID"],72832:["right_amygdaloid_body_72832_ID"],72833:["left_amygdaloid_body_72833_ID"],72856:["right_lateral_globus_pallidus_72856_ID"],72857:["left_lateral_globus_pallidus_72857_ID"],72858:["right_medial_globus_pallidus_72858_ID"],72859:["left_medial_globus_pallidus_72859_ID"],74048:["Right_stapes_74048_ID"],74049:["Left_stapes_74049_ID"],74050:["Right_Incus_74050_ID"],74051:["Left_Incus_74051_ID"],74052:["Right_malleus_74052_ID"],74053:["Left_malleus_74053_ID"],74073:["Right_Levatores_costarum_74073_ID"],74074:["Left_Levatores_costarum_74074_ID"],74075:["Right_Levatores_costarum_longi_74075_ID"],74076:["Left_Levatores_costarum_longi_74076_ID"],74079:["Right_Subcostales_74079_ID"],74080:["Left_Subcostales_74080_ID"],74525:["Occipital_74525_ID"],75150:["Teeth_75150_ID"],75398:["Superficial_dorsal_vein_of_penis_75398_ID"],75492:["Right_common_plantar_digital_nerves_75492_ID"],75493:["Left_common_plantar_digital_nerves_75493_ID"],76767:["Anterior_cardiac_vein_76767_ID"],76829:["Right_Zonula_Fibers_76829_ID","Left_Zonula_Fibers_76829_ID"],77161:["Intermediate_Hepatic_Vein_77161_ID"],77380:["Right_popliteal_artery_77380_ID"],77381:["Left_popliteal_artery_77381_ID"],77596:["Hypogastric_nerve_77596_ID"],77949:["Right_circumflex_scapular_vein_77949_ID"],77950:["Right_circumflex_scapular_vein_77950_ID","Left_circumflex_scapular_vein_77950_ID"],78023:["Right_lateral_brachial_vein_78023_ID"],78024:["right_lateral_brachial_vein_78024_ID","left_lateral_brachial_vein_78024_ID"],78209:["trunk_of_Hepatic_portal_vein_78209_ID"],78508:["Right_tarsal_bones_78508_ID"],78509:["Left_tarsal_bones_78509_ID"],78510:["Right_metatarsal_bones_78510_ID"],79468:["Right_accessory_meningeal_artery_79468_ID"],79469:["Left_accessory_meningeal_artery_79469_ID"],82695:["trunk_of_Hepatic_portal_vein_82695_ID"],82933:["Right_Nerve_to_levator_ani_82933_ID"],82934:["Left_Nerve_to_levator_ani_82934_ID"],85274:["External_Urethral_Sphincter_85274_ID"],86233:["Lymphatics_of_the_Upper_Limb_86233_ID"],86917:["Muscles_of_the_Abdomen_86917_ID"],87217:["Descending_aorta_thoracic_87217_ID","Descending_thoracic_aorta_87217_ID"],228738:["Muscles_of_the_Throat_228738_ID"],231317:["Phalanges_of_the_right_foot_231317_ID"],231319:["Phalanges_of_the_left_foot_231319_ID"],258714:["right_thalamus_258714_ID"],258716:["left_thalamus_258716_ID"],258847:["Right_Calcaneal_Tendon__aka_Achilles_Tendon_258847_ID"],258848:["Left_Calcaneal_Tendon__aka_Achilles_Tendon_258848_ID"],268668:["Right_interosseous_recurrent_artery_268668_ID"],268669:["right_interosseous_recurrent_artery_268669_ID","left_interosseous_recurrent_artery_268669_ID"]},function(){"use strict";var e=Human.clients={};e.numConnections=0,e.addClient=function(t){t({connected:function(){e.numConnections++,Human.events.fire("clients.connected",{})},disconnected:function(){e.numConnections--,Human.events.fire("clients.disconnected",{})}})}}(),Human.clients.addClient((function(e){"use strict";var t,r,i=[];function a(e){var a=JSON.stringify(e);t?t.postMessage(a,r):i.push(a)}Human.events.on("started",(function(){a({message:"status",status:"ready"})})),window.addEventListener?(Human.events.on("error",(function(e){a({error:e})})),Human.rpc.onResult((function(e,t){var r={};r[e]=Human.rpc.filterUnsafeProperties(t),a({results:r})})),addEventListener("message",(function(n){var o;try{o=JSON.parse(n.data)}catch(s){return}"connect"===o.action?t||(Human.log.info("Human.clients.windowClient","Client connected"),e.connected(),t=n.source,r=n.origin,a({message:"connected"}),function(){for(;i.length>0;)t.postMessage(i.pop(),r)}()):o.call&&function(e){!function(e){if(Human.rpc.windowClientEnabled)try{Human.rpc.call(e.id,e.call,e.params),Human.rpc.log(e.call)}catch(s){Human.log.error("Human.clients.windowClient","Error executing RPC call [callId: "+e.id+", procedure: "+e.call+"]: "+s)}}(e)}(o)}),!1)):Human.log.error("Human.clients.windowClient","Browser does not support cross-window messaging")})),function(){"use strict";var e=Human.cookies={};e.setCookie=function(e,t,r){var i;if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),i="; expires="+a.toGMTString()}else i="";document.cookie=e+"="+t+i+"; path=/"},e.getCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var a=r[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},e.eraseCookie=function(t){e.setCookie(t,"",-1)}}(),function(){"use strict";var e=Human.init={};e.bookmark={},e.cameraBookmark={},e.saveReset=function(){var t=Human.bookmarks.capture(),r=t.modules;if(r){var i=r.active;i&&i.length>1&&(r.active=[r.active[0]])}e.bookmark=t,Human.timeline.activeRoot&&(e.bookmark.camera=Human.timeline.activeRoot._chapters[0].camera.location)},e.reset=function(t){if(!e.bookmark)return Human.log.error("Human.init.reset","Bookmark for reset was not captured"),void(t&&t());Human.renderer.lights.restoreDefaults(),Human.bookmarks.restore(e.bookmark,(function(){Human.events.fire("init.reset"),t&&t()}),(function(e){Human.log.error("Human.init.reset","Reset failed: "+e),t&&t()}))},e.resetCamera=function(t){var r=Human.timeline.getCurrentChapterCamera();if(r)Human.renderer.camera.fly.flyTo(r,t);else{var i,a,n=Human.modules.activeModules;for(var o in n)n.hasOwnProperty(o)&&(a=n[o]).camera&&a.timeActivated>0&&(i=a);if(!i)return e.bookmark?void Human.renderer.camera.fly.flyTo(e.bookmark.camera,t):(Human.log.error("Human.init.resetCamera","Bookmark for reset was not captured"),void(t&&t()));Human.renderer.camera.fly.flyTo(i.camera,t)}},e.init=function(e){Human.renderer.init(),Human.assets.init(),Human.events.fire("loaded"),e&&e()},e.start=function(){e.saveReset(),Human.events.fire("started")}}(),function(){"use strict";var e,t,r,i=Human.renderer={highlightColor:new Float32Array([1.5,1.5,.5]),xrayBGColor:new Float32Array([.2,.2,.3]),frameRateThrottled:!1,testContextLoss:!1,viewportDirty:!0,lastFrameStats:{gpuTime:0,cpuTime:0}},a={alpha:SceneJS.TRANSPARENCY_FLAGS.ALPHA,improvedAlpha:SceneJS.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,addAlpha:SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA,alphaToCoverage:SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE,weightedOIT:SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT},n=!1,o=!1,s=!1,l=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,c=.01,u=0,_=1e3,h=0,f=1,d=new Float32Array([1,1,1]),m=0,p=0,g=0,y=1,v=0,S=!1,E={timeStarted:0,timeLast:0,timeNow:0,tick:0},b={frameStart:0,lastFrameStart:0},I={frameStart:0,frameEnd:0,lastFrameEnd:0},x=mat4.create(),C=mat4.create(),T=vec3.create(),N=vec4.create();Human.properties.subscribe({propId:"highlight.color",value:i.highlightColor,callback:function(e){i.highlightColor=e,n=!0}}),Human.properties.subscribe({propId:"fog.enabled",value:s,callback:function(e){s=e,n=!0}}),Human.properties.subscribe({propId:"fog.mode",value:l,callback:function(e){l=e,n=!0}}),Human.properties.subscribe({propId:"fog.start",value:u,callback:function(e){u=e,n=!0}}),Human.properties.subscribe({propId:"fog.end",value:_,callback:function(e){_=e,n=!0}}),Human.properties.subscribe({propId:"fog.min",value:h,callback:function(e){h=e,n=!0}}),Human.properties.subscribe({propId:"fog.max",value:f,callback:function(e){f=e,n=!0}}),Human.properties.subscribe({propId:"fog.density",value:c,callback:function(e){c=e,n=!0}}),Human.properties.subscribe({propId:"fog.color",value:d,callback:function(e){d=e,n=!0}}),i.init=function(){SceneJS.WEBGL_INFO.SOFTWARE_RENDERER&&Human.log.error("This browser is using a software renderer for WebGL. Expect substantially reduced rendering performance.");var t=Date.now(),r=t,a=0;SceneJS.setMaxPointSize(255),e=this.graph.init(),this.postprocess.init(e),this.canvas.init(),this.lights.init(),this.setXrayBGColor(this.xrayBGColor),requestAnimationFrame((function x(){requestAnimationFrame(x);var C=e.getGPUTimer(),T=e.getGPUTimerQuery(),N=e.getGL();if(C&&S){var D=C.getQueryObjectEXT(T,C.QUERY_RESULT_AVAILABLE_EXT),A=N.getParameter(C.GPU_DISJOINT_EXT);D&&(S=!1),D&&!A&&(i.lastFrameStats.gpuTime=C.getQueryObjectEXT(T,C.QUERY_RESULT_EXT)/1e6)}if(!(o||++v<y)){v=0;var P=Human.timer.now();C&&!S&&C.beginQueryEXT(C.TIME_ELAPSED_EXT,T),b.frameStart=Human.timer.now(),Human.events.fire("frameStart",b),b.lastFrameStart=b.frameStart,n&&(e.setFogEnabled(s),e.setFogMode(l),e.setFogStart(u),e.setFogEnd(_),e.setFogMin(h),e.setFogMax(f),e.setFogDensity(c),e.setFogColor(d[0],d[1],d[2]),n=!1),i.viewportDirty&&(e.setViewport(0,0,i.canvas.width,i.canvas.height),i.viewportDirty=!1);var M=Human.timer.now();if(E.timeStarted=t,E.timeLast=r,E.timeNow=M,E.tick=a,Human.events.fire("tick",E),r=M,a++,!i.frameRateThrottled){var w=e.stats.frame;p+=w.gpuTime,g+=w.cpuTime,100==++m&&((g/m>14||p/m>14)&&(i.setTicksPerRender(2),i.frameRateThrottled=!0),p=0,g=0,m=0)}i.prepareFrame(E),e.render(),I.frameStart=b.frameStart,I.frameEnd=Human.timer.now(),Human.events.fire("frameEnd",I),I.lastFrameEnd=I.frameEnd,C&&!S&&(C.endQueryEXT(C.TIME_ELAPSED_EXT),S=!0),i.lastFrameStats.cpuTime=Human.timer.now()-P}}))},i.prepareFrame=function(){Human.timeline.onFrame(),Human.renderer.lights.onFrame(),Human.renderer.clip.onFrame(),Human.renderer.camera.onFrame(),Human.scene.onFrame(),Human.scene.markers.onFrame(),Human.events.fire("cull",E),Human.scene.cull()},i.updateDisplayForBG=function(){n=!0},i.pushPause=function(){i._pauses=i._pauses?i._pauses+1:1,1===i._pauses&&(o=!0)},i.popPause=function(){i._pauses&&0==--i._pauses&&(o=!1,e.render())},i.pauseCompilation=function(){e.pauseCompilation()},i.resumeCompilation=function(){e.resumeCompilation()},i.setTicksPerRender=function(e){y=e,v=0},i.resetFrameThrottling=function(){i.frameRateThrottled&&(i.setTicksPerRender(1),i.frameRateThrottled=!1)},i.setTransparencyMode=function(t){var r=a[t];void 0!==r?(e.setTransparencyMode(r),"alphaToCoverage"===t?Human.renderer.postprocess.disable():Human.renderer.postprocess.enable()):Human.log.error("Unrecognized transparency mode: "+t)},i.setDepthSort=function(t){e.setDepthSort(t)},i.onTasksComplete=function(e){null!=i._pauses&&i._pauses>0&&Human.log.error("Human.renderer.onTaskComplete","Renderer deadlock: Human.renderer.pushPause has paused renderer. Renderer needs to be unpaused in order to complete pending tasks.");var t=Human.renderer.getScene().getStatus().numTasks;if(t&&0!==t){if(i.__checkLoaded)throw"Human.renderer.onTasksComplete: already blocking";i.__checkLoaded=window.setInterval((function(){var t=Human.renderer.getScene().getStatus().numTasks;t&&0!==t||(window.clearInterval(i.__checkLoaded),i.__checkLoaded=null,e())}),200)}else e()},i.compile=function(){e.compile()},i.forceRenderFrame=function(t){(t=t||{}).force=!0,e.render(t)},i.getScene=function(){return e},i.getLibraryRoot=function(){return e},i.getNode=function(t){return e.findNode(t)},i.nodeExists=function(t){return null!=e.findNode(t)},i.loseContext=function(){e.loseWebGLContext()},i.getViewMat=function(){return e.getViewMatrix()},i.getProjMat=function(){return e.getProjectionMatrix()},i.checkWebGLExtension=function(e){return SceneJS.checkExtension(e)},i.setXrayBGColor=function(t){this.xrayBGColor.set(t),e.setXrayColor(t[0],t[1],t[2])},i.viewPositionToCanvas=function(e,t){var r=i.getProjMat();N.set(e),N[3]=1,vec4.transformMat4(N,N,r);var a=N[3];return t[0]=.5*this.canvas.width*(1+N[0]/a),t[1]=.5*this.canvas.height*(1-N[1]/a),t},i.worldPositionToCanvas=function(e,t){return vec3.transformMat4(T,e,i.getViewMat()),i.viewPositionToCanvas(T,t)},i.getResolutionScalingSupported=(t=!1,r=!1,function(){var e,a,n,o,s,l,c;return t||(e=Element.prototype,a=Function.call.bind(Array.prototype.slice),n=Function.call.bind(e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||e.oMatchesSelector),o=function(e,t){return e in t.style&&""!==t.style[e]},s=a(document.styleSheets).reduce((function(e,t){return e.concat(a(t.cssRules))}),[]).filter((function(e,t){return n(e,t.selectorText)}).bind(null,i.canvas.canvas)),l=o.bind(null,"width"),c=o.bind(null,"height"),r=s.some(l)&&s.some(c),t=!0),r}),i.setResolutionScaling=function(t){t<1&&(t=1),e.setResolutionScaling(t)},i.canvasPositionToWorldRay=function(e,t,r,i){var a=2*e/Human.renderer.canvas.width-1,n=1-2*t/Human.renderer.canvas.height,o=Human.renderer.camera.eye;r[0]=o.x,r[1]=o.y,r[2]=o.z,i[0]=a,i[1]=n,i[2]=.5;var s=mat4.invert(x,this.getProjMat()),l=mat4.invert(C,this.getViewMat());vec3.transformMat4(i,i,s),vec3.transformMat4(i,i,l),vec3.subtract(i,i,r),vec3.normalize(i,i)};var D=vec3.create(),A=vec3.create(),P=vec3.create(),M=vec3.create(),w=vec3.create(),R=vec3.create();i.canvasCircleToWorldSphereRadius=function(e,t,r,i){this.canvasPositionToWorldRay(e,t+r,w,R);var a=Human.renderer.camera.getLookDir(T),n=vec3.dot(a,R);if(n>.001){vec3.subtract(D,i,w);var o=vec3.dot(D,a)/n;return vec3.scale(P,R,o),vec3.add(A,w,P),vec3.subtract(M,A,i),vec3.length(M)}return 0}}(),function(){"use strict";var e,t={xform:1,properties:2,texture:3,material:3,cubemap:3,fresnel:3,billboard:3,morphGeometry:4,geometry:5},r=Human.renderer.graph={libraryRootNode:null},i={type:"scene",canvasId:Human.canvasId,transparent:!0,contextAttr:{preserveDrawingBuffer:!1,antialias:!0}};r.init=function(){return i.canvasId=Human.canvasId,e=SceneJS.createScene(i,{simulateWebGLContextLost:Human.renderer.testContextLoss}),this.libraryRootNode=e.addNode({type:"library"}),e.setCamera({eye:[0,0,55],look:[0,0,0],up:[0,1,0]}),e.setProjection({type:"perspective",fov:60,near:.01,far:400,fovAxis:"y",pan:{x:0,y:0,z:0}}),e},r.createSubtree=function(t){return e.addNode(t)},r.insertNode=function(e,r){r instanceof SceneJS.Node?r.parent&&"library"===r.parent.type?r.disconnect():r={type:r.type,coreId:r.getCoreId()}:"reflect"===r.type&&(r.type="cubemap");for(var i=t[r.type],a=e;a;){if(i<(t[a.type]?t[a.type]:0)){var n=a.parent;return a.disconnect(),(r=n.addNode(r)).addNode(a),r}if(0===a.nodes.length)return a.addNode(r);a=a.nodes[0]}},r.disconnectNode=function(e){var t=e.parent,r=e.disconnectNodes();e.disconnect(),t.addNodes(r)},r.destroySubtree=function(e){e.destroy()}}(),function(){"use strict";var e=Human.renderer.bg={},t=null;e.getBGColor=function(){var e=null;if(t){e=[];for(var r=0;r<t.length;r++)e.push(t[r])}return e},e.setBGColor=function(e){Array.isArray(e)&&(t=e)}}(),function(){"use strict";function e(){var e=Human.renderer.canvas.canvas,t=Human.renderer.canvas.annotationCanvas,r=e.parentNode,i=r.clientWidth,a=r.clientHeight;Human.renderer.canvas.width=i,Human.renderer.canvas.height=a,e.width=i,e.height=a,t.width=i,t.height=a,Human.renderer.viewportDirty=!0,Human.renderer.camera.updateCanvas(),Human.renderer.postprocess.updateCanvas(),Human.renderer.draw.updateCanvas(),Human.events.fire("canvas.resized",{canvasWidth:i,canvasHeight:a})}Human.renderer.canvas={canvas:null,annotationCanvas:null,context2D:null,width:0,height:0},Human.renderer.canvas.init=function(){this.canvas=document.getElementById(Human.canvasId),this.annotationCanvas=document.getElementById(Human.annotationCanvasId),this.context2D=this.annotationCanvas.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,e()},Human.renderer.resize=e,window.addEventListener("resize",e)}(),function(){"use strict";var e=Human.renderer.camera={FRUSTUM_TOP:0,FRUSTUM_BOTTOM:1,FRUSTUM_LEFT:2,FRUSTUM_RIGHT:3,FRUSTUM_NEAR:4,FRUSTUM_FAR:5,autoSetNearFar:!0,nearFarDirty:!1},t=vec3.create(),r=vec3.create(),i=vec3.create(),a=vec3.create(),n=vec3.create(),o=vec3.create(),s=vec3.create(),l=vec3.create(),c=vec3.create(),u=vec3.create(),_=vec3.create(),h=vec3.create(),f=mat4.create(),d=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],m=!0;e.eye={x:0,y:0,z:-80},e.look={x:0,y:0,z:0},e.up={x:0,y:1,z:0},e.rotationCenter=vec3.create(),e.lookDistance=80,e._screenPan={x:0,y:0,z:0},e._startcamera={eye:e.eye,look:e.look,up:e.up};var p=!0,g=!0,y=!1;e.lock=!1,e.aspect=1,e.fovy=55,Human.properties.subscribe({propId:"camera.optics.fov",value:e.fovy,callback:function(t){e.fovy=t,g=!0}}),e.near=.1,e.far=5e3,e.minZoom=.01,e.maxZoom=150,Human.properties.subscribe({propId:"camera.zoomLimits",value:{min:.01,max:150},callback:function(t){t.min<.01?Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' too small - should be >= 0.01"):t.min>=t.max?Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' should be less than camera.zoomLimits.max"):(e.minZoom=t.min,e.maxZoom=t.max,p=!0)}}),e.updateCanvas=function(){e.setAspect(Human.renderer.canvas.width/Human.renderer.canvas.height)},e.setLookAt=function(i){var a=i.look||e.look,n=i.up||e.up;e.eye=i.eye||e.eye,e.look=a,e.up=n,Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),e.lookDistance=vec3.distance(t,r),i.look&&!i.preserveCenter&&this.setRotationCenter(i.look.x,i.look.y,i.look.z),p=!0},e.setRotationCenter=function(t,r,i){e.rotationCenter[0]=t,e.rotationCenter[1]=r,e.rotationCenter[2]=i},e.getLookAt=function(){return{eye:e.eye,look:e.look,up:e.up}},e.getLookDir=function(e){var t=this.eye,r=this.look;return e[0]=r.x-t.x,e[1]=r.y-t.y,e[2]=r.z-t.z,vec3.normalize(e,e),e},e.setScreenPan=function(t){e._screenPan.x=t.x||0,e._screenPan.y=t.y||0,e._screenPan.z=t.z||0,g=!0},e.getScreenPan=function(){return e._screenPan},e._reset={eye:{x:e.eye.x,y:e.eye.y,z:e.eye.z},look:{x:e.look.x,y:e.look.y,z:e.look.z},up:{x:e.up.x,y:e.up.y,z:e.up.z}},e.reset=function(){e.yaw=0,e.pitch=90,e._eye={x:e._reset.eye.x,y:e._reset.eye.y,z:e._reset.eye.z},e._look={x:e._reset.look.x,y:e._reset.look.y,z:e._reset.look.z},e._up={x:e._reset.up.x,y:e._reset.up.y,z:e._reset.up.z},e.rotationCenter.set([e._reset.look.x,e._reset.look.y,e._reset.look.z]),p=!0},e.rotateY=function(a){if(!e.lock){Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,i),vec3.subtract(t,t,e.rotationCenter),vec3.subtract(r,r,e.rotationCenter);var n=Human.math.sign(i[1])||1;mat4.fromRotation(f,n*a*.0174532925,Human.math.Y_AXIS),vec3.transformMat4(t,t,f),vec3.transformMat4(r,r,f),vec3.transformMat4(i,i,f),vec3.add(t,t,e.rotationCenter),vec3.add(r,r,e.rotationCenter),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},up:{x:i[0],y:i[1],z:i[2]},preserveCenter:!0})}},e.rotateX=function(n){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,i),vec3.subtract(t,t,e.rotationCenter),vec3.subtract(r,r,e.rotationCenter),vec3.subtract(c,r,t),vec3.normalize(c,c),vec3.normalize(u,i),vec3.cross(a,u,c),mat4.fromRotation(f,.0174532925*n,a),vec3.transformMat4(t,t,f),vec3.transformMat4(r,r,f),vec3.transformMat4(i,i,f),vec3.add(t,t,e.rotationCenter),vec3.add(r,r,e.rotationCenter),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},up:{x:i[0],y:i[1],z:i[2]},preserveCenter:!0}))};var v=vec3.create();e.pan=function(n){if(!e.lock){if(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,i),vec3.subtract(v,t,r),l[0]=l[1]=l[2]=0,void 0!==n.x){vec3.normalize(c,v),vec3.normalize(u,i);var o=vec3.cross(a,v,i);vec3.normalize(o,vec3.cross(a,v,i)),vec3.scale(h,o,n.x),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]}void 0!==n.y&&(vec3.normalize(u,i),vec3.scale(h,u,n.y),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]),void 0!==n.z&&(vec3.normalize(c,t),vec3.scale(h,c,n.z),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]),vec3.add(t,t,l),vec3.add(r,r,l),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},preserveCenter:!0})}},e.setAspect=function(t){e.aspect=t,g=!0},e.viewRight=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:-t.z,y:r,z:0},up:{x:0,y:1,z:0}})}},e.viewLeft=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:t.z,y:r,z:0},up:{x:0,y:1,z:0}})}},e.viewPosterior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:r,z:-t.z},up:{x:0,y:1,z:0}})}},e.viewAnterior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:r,z:t.z},up:{x:0,y:1,z:0}})}},e.viewSuperior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:-t.z+r,z:0},up:{x:0,y:0,z:1}})}},e.viewInferior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:t.z+r,z:0},up:{x:0,y:0,z:-1}})}},e.zoom=function(i){if(!e.lock){Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r);var a=Math.abs(vec3.length(t)),n=Math.abs(a+i);e.minZoom&&e.maxZoom&&(i=40*i*(a/e.maxZoom*.6),(n=Math.abs(a+i))<e.minZoom?n=e.minZoom:n>e.maxZoom&&(n=e.maxZoom)),vec3.normalize(c,t),vec3.scale(t,c,n),vec3.add(t,r,t),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},preserveCenter:!0})}},e.setZoom=function(i){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),vec3.normalize(c,t),vec3.scale(t,c,e.minZoom+(1-i)*(e.maxZoom-e.minZoom)),vec3.add(t,r,t),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},preserveCenter:!0}))},e.getZoom=function(){return Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),1-(Math.abs(vec3.length(t))-e.minZoom)/e.maxZoom},e.setZoomPercent=function(i){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),vec3.normalize(c,t),vec3.scale(t,c,e.minZoom+.01*(100-i)*(e.maxZoom-e.minZoom)),e.setLookAt({eye:{x:r[0]+t[0],y:r[1]+t[1],z:r[2]+t[2]},preserveCenter:!0}))},e.getZoomPercent=function(){return Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),100-(Math.abs(vec3.length(t))-e.minZoom)/e.maxZoom*100},e.getFrustum=function(){return m&&(function(){var a=e,l=a.near,c=a.far,u=a.aspect,f=a.fovy*Math.PI/180;t[0]=a.eye.x,t[1]=a.eye.y,t[2]=a.eye.z,r[0]=a.look.x,r[1]=a.look.y,r[2]=a.look.z,i[0]=a.up.x,i[1]=a.up.y,i[2]=a.up.z;var m=Math.tan(.5*f)*l,p=m*u;vec3.subtract(_,r,t),vec3.normalize(_,_),vec3.cross(n,_,i),vec3.normalize(n,n),vec3.cross(i,n,_),vec3.scale(h,_,l),vec3.add(o,t,h),vec3.scale(h,_,c),vec3.add(s,t,h),vec3.scale(d[a.FRUSTUM_NEAR].n,_,-1),d[a.FRUSTUM_NEAR].d=-vec3.dot(o,d[a.FRUSTUM_NEAR].n),d[a.FRUSTUM_FAR].n.set(_),d[a.FRUSTUM_FAR].d=-vec3.dot(s,d[a.FRUSTUM_FAR].n),vec3.scale(h,n,p),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[a.FRUSTUM_RIGHT].n,h,i),d[a.FRUSTUM_RIGHT].d=-vec3.dot(t,d[a.FRUSTUM_RIGHT].n),vec3.scale(h,n,-p),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[a.FRUSTUM_LEFT].n,i,h),d[a.FRUSTUM_LEFT].d=-vec3.dot(t,d[a.FRUSTUM_LEFT].n),vec3.scale(h,i,m),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[a.FRUSTUM_TOP].n,n,h),d[a.FRUSTUM_TOP].d=-vec3.dot(t,d[a.FRUSTUM_TOP].n),vec3.scale(h,i,-m),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[a.FRUSTUM_BOTTOM].n,h,n),d[a.FRUSTUM_BOTTOM].d=-vec3.dot(t,d[a.FRUSTUM_BOTTOM].n)}(),m=!1),d},e.getSubRegionFrustum=function(a,l,c,u){var f=e,d=f.near,m=f.far,p=f.aspect,g=f.fovy*Math.PI/180;t[0]=f.eye.x,t[1]=f.eye.y,t[2]=f.eye.z,r[0]=f.look.x,r[1]=f.look.y,r[2]=f.look.z,i[0]=f.up.x,i[1]=f.up.y,i[2]=f.up.z,vec3.subtract(_,r,t),vec3.normalize(_,_),vec3.cross(n,_,i),vec3.normalize(n,n),vec3.cross(i,n,_),vec3.normalize(i,i),vec3.scale(h,_,d),vec3.add(o,t,h);var y=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],v=Math.tan(.5*g)*d,S=v*p,E=Human.renderer.canvas.width/2,b=Human.renderer.canvas.height/2,I=(a-E)/E,x=I+c/E,C=(b-l)/b,T=C-u/b;return y[e.FRUSTUM_NEAR].n.set(_),y[e.FRUSTUM_NEAR].d=-vec3.dot(y[e.FRUSTUM_NEAR].n,o),vec3.scale(h,_,m),vec3.add(s,t,h),y[e.FRUSTUM_FAR].n.set([-_[0],-_[1],-_[2]]),y[e.FRUSTUM_FAR].d=-vec3.dot(y[e.FRUSTUM_FAR].n,s),vec3.scale(h,n,I*S),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,h,i),vec3.normalize(h,h),y[e.FRUSTUM_LEFT].n.set(h),y[e.FRUSTUM_LEFT].d=-vec3.dot(h,t),vec3.scale(h,n,x*S),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,i,h),vec3.normalize(h,h),y[e.FRUSTUM_RIGHT].n.set(h),y[e.FRUSTUM_RIGHT].d=-vec3.dot(h,t),vec3.scale(h,i,T*v),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,n,h),vec3.normalize(h,h),y[e.FRUSTUM_BOTTOM].n.set(h),y[e.FRUSTUM_BOTTOM].d=-vec3.dot(h,t),vec3.scale(h,i,C*v),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,h,n),vec3.normalize(h,h),y[e.FRUSTUM_TOP].n.set(h),y[e.FRUSTUM_TOP].d=-vec3.dot(h,t),y},e.onFrame=function(){if(p?(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,i),Human.renderer.getScene().setCamera({eye:t,look:r,up:i}),vec3.subtract(h,t,r),Human.events.fire("camera.updated",{eye:e.eye,look:e.look,up:e.up,dist:Math.abs(vec3.length(h))}),y=!1,p=!1,m=!0,e.nearFarDirty=!0):y||(y=!0,Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(h,t,r),Human.events.fire("camera.rested",{eye:e.eye,look:e.look,up:e.up,dist:Math.abs(vec3.length(h))})),e.autoSetNearFar&&e.nearFarDirty){var a=Human.scene.getBoundary(),n=Human.particles.getBoundary(),o=Math.min(a.xmin,n.xmin),s=Math.min(a.ymin,n.ymin),l=Math.min(a.zmin,n.zmin),c=Math.max(a.xmax,n.xmax),u=Math.max(a.ymax,n.ymax),_=Math.max(a.zmax,n.zmax),f=Human.renderer.getViewMat(),d=f[2],v=f[6],S=f[10],E=f[14],b=c-o,I=u-s,x=_-l,C=Math.sqrt(b*b+I*I+x*x),T=o*d+s*v+l*S+E;isFinite(T)&&(T=Math.max(T,c*d+s*v+l*S+E),T=Math.max(T,o*d+u*v+l*S+E),T=Math.max(T,o*d+s*v+_*S+E),T=Math.max(T,c*d+u*v+l*S+E),T=Math.max(T,c*d+s*v+_*S+E),T=Math.max(T,o*d+u*v+_*S+E),T=Math.max(T,c*d+u*v+_*S+E),e.near=Math.max(-T,.1),e.far=e.near+C,e.nearFarDirty=!1,g=!0)}g&&(Human.renderer.getScene().setProjection({type:"perspective",fov:e.fovy,near:e.near,far:e.far,aspect:e.aspect,pan:e._screenPan}),g=!1,m=!0,Human.renderer.postprocess.updateProjection())}}(),function(){"use strict";(Human.renderer.pick={}).pick=function(e,t,r){var i=Human.renderer.getScene();if(!i)return null;var a={objectId:null},n=null,o=i.pick(e,t,r)||null;if(o){n=Human.scene.objects[o.name];var s=o.objectId;if(a=Human.utils.apply(o,a),n&&(a.objectId=n.objectId,s))for(var l=0,c=n.renderables.length;l<c;++l){var u=n.renderables[l].getRenderObject();if(u&&u.id===s){a.renderableIndex=l;break}}}return n?Human.events.fire("pick.picked",a):Human.events.fire("pick.missed",a),a}}(),function(){"use strict";var e=Human.renderer.clip={};e.LEFT=0,e.RIGHT=1,e.BOTTOM=2,e.TOP=3,e.FRONT=4,e.BACK=5;var t=[{n:new Float32Array([-1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,-1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,-1]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,1]),d:0,fade:!1,fadeDistance:0}],r={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,zmin:1/0,zmax:-1/0},i=new Array(t.length),a=new Float32Array(t.length),n=new Array(t.length),o=[],s=!0,l={left:e.LEFT,right:e.RIGHT,bottom:e.BOTTOM,top:e.TOP,front:e.FRONT,back:e.BACK},c=null,u=null,_=mat4.create(),h=mat4.create(),f=mat4.create(),d=mat4.create(),m=vec3.create(),p=vec3.fromValues(1,1,1);e.setClip=function(r){var o=void 0!==l[r.clipId]?l[r.clipId]:r.clipId,c=t[o],u=n[o]=r.boundary||Human.scene.getBoundary();if(void 0!==r.enabled&&(i[o]=r.enabled),void 0!==r.fade&&(c.fade=r.fade),void 0!==r.fadeDistance&&(c.fadeDistance=r.fadeDistance),void 0!==r.progress){var _=a[o]=r.progress,h=0,f=0;o!==e.LEFT&&o!==e.RIGHT||(f=u.xmin+.5*(h=u.xmax-u.xmin)),o!==e.TOP&&o!==e.BOTTOM||(f=u.ymin+.5*(h=u.ymax-u.ymin)),o!==e.FRONT&&o!==e.BACK||(f=u.zmin+.5*(h=u.zmax-u.zmin)),o!==e.LEFT&&o!==e.BOTTOM&&o!==e.FRONT||(f*=-1),_=1-_,c.d=-((_-=.5)*h+f)}s=!0,Human.events.fire("clip.updated",{clipId:o,progress:r.progress||this.getProgress(o),enabled:!!i[o],fade:c.fade,fadeDistance:c.fadeDistance})},e.getActiveClips=function(){return o},e.isEnabled=function(e){return!!i[l[e]||e]},e.getProgress=function(e){return a[l[e]||e]},e.serialize=function(){for(var e={},r=0,o=t.length;r<o;++r)e[r]={clipId:r,enabled:!!i[r],progress:a[r],fade:t[r].fade,fadeDistance:t[r].fadeDistance,boundary:n[r]};return e},e.show=function(r){c||(c=Human.renderer.getScene().addNode({type:"properties",properties:{enabled:!1,backfaces:!0,clipping:!1,picking:!1,noDepthMask:!0}}),(u=c.addNode({type:"xform"})).addNode({type:"material",emit:.9,baseColor:{r:.3,g:.3,b:.4},specularColor:{r:.3,g:.3,b:.4},specular:0,shine:100,alpha:.2,nodes:[{type:"geometry/plane"}]}));var i=t[r],a=Human.scene.getBoundary(),n=a.xmax-a.xmin,o=a.ymax-a.ymin,s=a.zmax-a.zmin,l=.5*(a.xmin+a.xmax),g=.5*(a.ymin+a.ymax),y=.5*(a.zmin+a.zmax);c.setEnabled(!0),r!==e.LEFT&&r!==e.RIGHT||(mat4.fromYRotation(h,.5*Math.PI),m[0]=-i.d*i.n[0],m[1]=g,m[2]=y,p[0]=s,p[1]=o),r!==e.TOP&&r!==e.BOTTOM||(mat4.fromXRotation(h,.5*Math.PI),m[0]=l,m[1]=-i.d*i.n[1],m[2]=y,p[0]=n,p[1]=s),r!==e.FRONT&&r!==e.BACK||(mat4.identity(h),m[0]=l,m[1]=g,m[2]=-i.d*i.n[2],p[0]=n,p[1]=o),mat4.fromScaling(f,p),mat4.fromTranslation(_,m),mat4.multiply(d,h,f),mat4.multiply(d,_,d),u.setElements(d)},e.hide=function(){c&&c.setEnabled(!1)},e.reset=function(){for(var e=0,r=t.length;e<r;++e)i[e]=!1;s=!0,Human.events.fire("CrossSections.Reset")},e.onFrame=function(){if(s){o.length=0;for(var e=0,r=t.length;e<r;++e)i[e]&&o.push(t[e]);Human.renderer.getScene().setClips(o),s=!1}},e.getBoundary=function(){return r.xmin=i[e.LEFT]?t[e.LEFT].d:-1/0,r.xmax=i[e.RIGHT]?-t[e.RIGHT].d:1/0,r.ymin=i[e.BOTTOM]?t[e.BOTTOM].d:-1/0,r.ymax=i[e.TOP]?-t[e.TOP].d:1/0,r.zmin=i[e.BACK]?t[e.BACK].d:-1/0,r.zmax=i[e.FRONT]?-t[e.FRONT].d:1/0,r}}(),function(){"use strict";var e=Human.renderer.lights={};e.lights={},e.defaultLightIds=[];var t=[],r=!0,i=!0;e.init=function(){e.addLight({lightId:"light0",enabled:!0,params:{mode:"ambient",color:{r:.2,g:.2,b:.2,diffuse:!0}}}),e.addLight({lightId:"light1",enabled:!0,params:{mode:"dir",dir:{x:1,y:0,z:-.5},color:{r:.1,g:.1,b:.2},diffuse:!0,specular:!0,space:"view"}}),e.addLight({lightId:"light2",enabled:!0,params:{mode:"dir",dir:{x:-1,y:0,z:1},color:{r:.55,g:.5,b:.5},diffuse:!0,specular:!0,space:"view"}}),e.addLight({lightId:"light3",enabled:!0,params:{mode:"dir",dir:{x:.25,y:0,z:-1},color:{r:.9,g:.9,b:.9},diffuse:!0,specular:!1,space:"view"}}),e.defaultLightIds.push("light0"),e.defaultLightIds.push("light1"),e.defaultLightIds.push("light2"),e.defaultLightIds.push("light3")},e.addLight=function(a){e.lights.hasOwnProperty(a.lightId)?Human.log.warn("Human.renderer.lights.addLights","The lightId already exists: "+a.lightId):(e.lights[a.lightId]={lightId:a.lightId,enabled:!!a.enabled,params:a.params,index:t.length},r=!0,i=!0)},e.addLights=function(t){for(var r in t)t.hasOwnProperty(r)&&e.addLight(t[r])},e.removeLight=function(t){e.lights[t]&&(delete e.lights[t],r=!0,i=!0)},e.removeAllLights=function(){e.lights={},t.length=0,i=!0},e.removeCustomLights=function(){for(var t in e.lights)e.lights.hasOwnProperty(t)&&e.defaultLightIds.indexOf(t)<0&&(delete e.lights[t],i=!0)},e.setEnabled=function(t){var a=!1;for(var n in t){var o=e.lights[n];if(o){var s=!!t[n];o.enabled!==s&&(o.enabled=s,a=!0)}else Human.log.error("Human.renderer.lights.setEnabled","Light not found: "+n)}a&&(r=!0,i=!0)},e.clearEnabled=function(){var t=!1;for(var a in e.lights)e.lights[a].enabled=!1,t=!0;t&&(r=!0,i=!0)},e.setLight=function(t){var r=t.lightId,a=e.lights[r];a?(void 0!==t.mode&&(a.params.mode=t.mode),void 0!==t.color&&(a.params.color=t.color),void 0!==t.dir&&(a.params.dir=t.dir),void 0!==t.pos&&(a.params.pos=t.pos),void 0!==t.diffuse&&(a.params.diffuse=t.diffuse),void 0!==t.specular&&(a.params.specular=t.specular),void 0!==t.innerCone&&(a.params.innerCone=t.innerCone),void 0!==t.outerCone&&(a.params.outerCone=t.outerCone),void 0!==t.constantAttenuation&&(a.params.constantAttenuation=t.constantAttenuation),void 0!==t.linearAttenuation&&(a.params.linearAttenuation=t.linearAttenuation),void 0!==t.quadraticAttenuation&&(a.params.quadraticAttenuation=t.quadraticAttenuation),void 0!==t.space&&(a.params.space=t.space),i=!0):Human.log.error("Light "+r+" does not exist")},e.restoreDefaults=function(){var t={};e.defaultLightIds.forEach((function(e){t[e]=!0})),e.clearEnabled(),e.setEnabled(t)},e.onFrame=function(){if(r){var a=0;for(var n in t.length=0,e.lights){var o=e.lights[n];o.enabled&&(t.push(o.params),o.index=a++)}r=!1,i=!0}i&&(Human.renderer.getScene().setLights(t),i=!1)}}(),function(){"use strict";var e=Human.renderer.reflections={};e.setEnabled=function(e){var t=Human.assets.reflections.reflections[e];t?function(e){var t=Human.renderer.getScene();t&&function e(t,r){for("cubemap"!==t.type&&"reflection"!==t.applyTo||function(e,t){if(e.getCoreId()!==t.node.getCoreId()){var r=e.getParent(),i=e.disconnectNodes();e.destroy(),e._engine._doDestroyNodes(),r.addNode({type:"cubemap",coreId:t.node.getCoreId()}).addNodes(i)}}(t,r);t.nodes&&t.nodes.length>0;)e(t.nodes[0],r)}(t,e)}(t):Human.log.error("Human.renderer.reflections.setEnabled","reflection not found: "+e)},e.clearEnabled=function(){}}(),function(){"use strict";var e=Human.renderer.lightmaps={};e.setEnabled=function(e){var t=Human.assets.reflections.reflections[e];t?function(e){var t=Human.renderer.getScene();t&&function e(t,r){for("cubemap"!==t.type&&"lightmap"!==t.applyTo||function(e,t){if(e.getCoreId()!==t.node.getCoreId()){var r=e.getParent(),i=e.disconnectNodes();e.destroy(),e._engine._doDestroyNodes(),r.addNode({type:"cubemap",coreId:t.node.getCoreId()}).addNodes(i)}}(t,r);t.nodes&&t.nodes.length>0;)e(t.nodes[0],r)}(t,e)}(t):Human.log.error("Human.renderer.lightmaps.setEnabled","reflection not found: "+e)},e.clearEnabled=function(){}}(),function(){"use strict";var e=Human.renderer.postprocess={scene:null,framebuffersInitialized:!1,enabled:!0,effects:{},currentConfig:[]};e.init=function(e){for(var t in this.scene=e,e.createPostProcessType("blit",["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","void main() {","gl_FragColor = texture2D(uColorBuffer, vUV);","}"].join("\n")),this.effects)this.effects[t].init(e)},e.enable=function(){this.enabled||(this.enabled=!0,e.parse(this.currentConfig))},e.disable=function(){this.enabled&&(this.destroyPipeline(),this.enabled=!1)},e.parse=function(t){if(this.destroyPipeline(),this.currentConfig=t,this.enabled){for(var r=[],i=0,a=t.length;i<a;++i){var n=t[i];Human.renderer.postprocess.effects[n.effect]?(r.push(n.effect),Human.renderer.postprocess.effects[n.effect].configure(n)):Human.log.error("Unknown postprocess effect: ",n.effect)}!function(t){if(e.enabled){var r,i,a,n,o,s={opaquePipeline:[],transparentPipeline:[],finalPipeline:[],pipelineFramebuffers:{opaque:{read:"__MAIN",write:"__BDS_COLOR1"},transparent:{read:"__MAIN",write:"__BDS_COLOR1"},final:{read:"__MAIN",write:"__BDS_COLOR1"}},getIOFramebuffers:function(e){var t=this.pipelineFramebuffers[e],r={read:t.read,write:t.write};return"__BDS_COLOR1"===t.write?(t.read="__BDS_COLOR1",t.write="__BDS_COLOR2"):(t.read="__BDS_COLOR2",t.write="__BDS_COLOR1"),r}};for(n=0,o=t.length;n<o;++n){var l=e.effects[t[n]];l?l.addStage(s):Human.log.error("Unknown effect: "+t[n])}if(0!==s.opaquePipeline.length||0!==s.transparentPipeline.length||0!==s.finalPipeline.length){if(e.framebuffersInitialized||(e.scene.createFramebuffer("__BDS_COLOR1",{depthAttachment:!1}),e.scene.createFramebuffer("__BDS_COLOR2",{depthAttachment:!1}),e.framebuffersInitialized=!0),s.opaquePipeline.length>0){for(var c in a=!1,i=(r=s.opaquePipeline[s.opaquePipeline.length-1]).textures)if("__MAIN"===i[c].framebuffer){a=!0;break}a?s.opaquePipeline.push({type:"blit",id:"blitOpaqueToMain",textures:{uColorBuffer:{framebuffer:r.framebuffer,target:"color"}},framebuffer:"__MAIN"}):r.framebuffer="__MAIN",e.scene.postProcessOpaque(s.opaquePipeline)}s.finalPipeline.length>0?(r=s.finalPipeline[s.finalPipeline.length-1]).framebuffer=!1:s.finalPipeline.push({type:"blit",id:"blitToScreen",textures:{uColorBuffer:{framebuffer:"__MAIN",target:"color"}},framebuffer:!1}),e.scene.postProcessFinal(s.finalPipeline)}}}(r)}},e.destroyPipeline=function(){this.scene.postProcessOpaque(null),this.scene.postProcessFinal(null)},e.updateProjection=function(){for(var e in this.effects)this.effects[e].updateProjection&&this.effects[e].updateProjection()},e.updateCanvas=function(){for(var e in this.effects)this.effects[e].updateCanvas&&this.effects[e].updateCanvas()}}(),function(){"use strict";var e="---",t=Human.renderer.draw={initalized:!1,erase:!1,brushRadius:20,brushColor:vec3.fromValues(1,0,0),brushColorCSS:null},r=null,i=null,a=null,n={},o=!1,s=vec3.create(),l=0,c={},u=0,_=0,h=-1,f=-1;t.init=function(){this.initalized||(Human.renderer.getScene(),i=document.createElement("canvas"),a=i.getContext("2d"),r=new GrowingPacker,this.initalized=!0,this.setBrushColor(this.brushColor[0],this.brushColor[1],this.brushColor[2]),this.updateCanvas())},t.setBrushColor=function(e,t,r){this.brushColor[0]=e,this.brushColor[1]=t,this.brushColor[2]=r,this.brushColorCSS=Human.utils.floatRGBToHexString(e,t,r)},t.beginStroke=function(e,r){var i;(i=Human.renderer.canvas.context2D).lineWidth=2*t.brushRadius,i.lineJoin="round",i.lineCap="round",t.erase?(i.strokeStyle="#FFFFFF",i.fillStyle="#FFFFFF"):(i.strokeStyle=t.brushColorCSS,i.fillStyle=t.brushColorCSS),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.arc(e,r,this.brushRadius,0,2*Math.PI,!1),Human.renderer.canvas.context2D.fill(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.moveTo(e,r),S(e,r),h=e,f=r},t.strokeTo=function(e,t){Human.renderer.canvas.context2D.lineTo(e,t),Human.renderer.canvas.context2D.stroke();var r=2*this.brushRadius,i=e-h,a=t-f,n=Math.sqrt(i*i+a*a);if(n>r)for(var o=Math.floor(n/r),s=r*(i/n),l=r*(a/n),c=1;c<=o;++c)S(h+c*s,f+c*l);S(e,t),h=e,f=t},t.record=function(){for(var e in o&&(function(){var e,i;for(e in E.length=0,c)i=n[e],E.push(c[e].getRenderObject());Human.renderer.forceRenderFrame({custom:{renderMode:"drawTexture",objects:E}});var o=Human.renderer.canvas.canvas,s=Human.renderer.canvas.annotationCanvas,h=Human.renderer.canvas.context2D;a.globalCompositeOperation="source-over",a.drawImage(o,0,0),a.globalCompositeOperation=t.erase?"destination-out":"source-over",a.drawImage(s,0,0);var f,d,m,p=a.getImageData(0,0,u,_);for(e in a.clearRect(0,0,u,_),c){var g=c[e],y=(i=n[e]).bb;if(y.min[0]!==1/0){h.putImageData(p,0,0);var v=h.getImageData(y.min[0]*u,y.min[1]*_,(y.max[0]-y.min[0])*u,(y.max[1]-y.min[1])*_);h.clearRect(0,0,u,_);var S=i.patches;for(m in S[l]={w:v.width,h:v.height,imageData:v},b.length=0,S)b.push(S[m]);b.sort((function(e,t){return t.h-e.h})),r.fit(b);var I=Math.min(Human.math.nextPowerOf2(r.root.w),4096),x=Math.min(Human.math.nextPowerOf2(r.root.h),4096);for(s.width=Math.max(s.width,I),s.height=Math.max(s.height,x),f=0,d=b.length;f<d;++f)h.putImageData(b[f].imageData,b[f].fit.x,b[f].fit.y);var C=h.getImageData(0,0,I,x);g.drawTexture.setImage(C);var T=i.triangleUVs,N=g.geometryNode.getUVs(),D=N[N.length-1],A={};for(var P in T){var M=T[P];if(M.patchId===l){var w=y.min[0],R=y.min[1],F=y.max[0]-y.min[0],L=y.max[1]-y.min[1];for(f=0;f<3;++f){var O=M.uvs[f];O[0]=(O[0]-w)/F,O[1]=(O[1]-R)/L}}var H=S[M.patchId],J=M.uvs[0],B=M.uvs[1],k=M.uvs[2],U=H.fit.x/I,V=H.fit.y/x,j=H.w/I,G=H.h/x;D[3*P*2]=J[0]*j+U,D[3*P*2+1]=1-J[1]*G+1-V,D[2*(3*P+1)]=B[0]*j+U,D[2*(3*P+1)+1]=1-B[1]*G+1-V,D[2*(3*P+2)]=k[0]*j+U,D[2*(3*P+2)+1]=1-k[1]*G+1-V,A[M.patchId]=!0}for(m in S)A[m]||delete S[m];g.geometryNode.setUV(N.length-1,D),s.width=u,s.height=_}else Human.console.error("Draw mesh data invalid.")}}(),++l),n){var i=n[e];i.bb.min[0]=i.bb.min[1]=1/0,i.bb.max[0]=i.bb.max[1]=-1/0}c={},Human.renderer.canvas.context2D.clearRect(0,0,u,_),a.clearRect(0,0,u,_),o=!1},t.updateCanvas=function(){if(this.initalized){var e=Human.renderer.canvas;i.width=u=e.width,i.height=_=e.height}};var d=vec4.create(),m=vec3.create(),p=vec3.create(),g=vec3.create(),y=mat4.create(),v=vec3.create();function S(r,i){var a=Human.renderer.pick.corePick(r,i,{rayPick:!0});if(a&&a.worldPos){var u=a.objectId+e+a.renderableIndex,_=Human.scene.objects[a.objectId],h=_.renderables[a.renderableIndex];n[u]||function(e,t){var r=e.geometryNode,i={type:"geometry",primitive:"triangles",id:t+"_draw_geometry",positionDecodeMat:r.getPositionDecodeMat()},a=r.getPositions(),o=r.getNormals(),s=r.getUVs(),l=r.getIndices(),c=l.length;if(i.positions=new(0,a.constructor)(3*c),o&&(i.normals=r.hasCompressedNormals()?new Int8Array(2*c):new Float32Array(3*c)),s){i.uvs=new Array(s.length+1);for(var u=0,_=s.length;u<_;u++)i.uvs[u]=new Float32Array(2*c);i.uvs[u]=new Float32Array(2*c)}else i.uvs=[new Float32Array(2*c)];for(var h=i.positions,f=i.normals,d=i.uvs,m=0,p=l.length;m<p;m+=3){var g=l[m],y=l[m+1],v=l[m+2];if(h[3*m]=a[3*g],h[3*m+1]=a[3*g+1],h[3*m+2]=a[3*g+2],h[3*m+3]=a[3*y],h[3*m+4]=a[3*y+1],h[3*m+5]=a[3*y+2],h[3*m+6]=a[3*v],h[3*m+7]=a[3*v+1],h[3*m+8]=a[3*v+2],f&&(r.hasCompressedNormals()?(f[2*m]=o[2*g],f[2*m+1]=o[2*g+1],f[2*m+2]=o[2*y],f[2*m+3]=o[2*y+1],f[2*m+4]=o[2*v],f[2*m+5]=o[2*v+1]):(f[3*m]=o[3*g],f[3*m+1]=o[3*g+1],f[3*m+2]=o[3*g+2],f[3*m+3]=o[3*y],f[3*m+4]=o[3*y+1],f[3*m+5]=o[3*y+2],f[3*m+6]=o[3*v],f[3*m+7]=o[3*v+1],f[3*m+8]=o[3*v+2])),d){var S,E,b=0;if(s)for(var I=s.length;b<I;b++){E=d[b],x[0]=(S=s[b])[2*g],x[1]=S[2*g+1],C[0]=S[2*y],C[1]=S[2*y+1],T[0]=S[2*v],T[1]=S[2*v+1];var N=r.getUVDecodeMat(b);N&&(Human.math.decompressUV(x,x,N),Human.math.decompressUV(C,C,N),Human.math.decompressUV(T,T,N)),E[2*m]=x[0],E[2*m+1]=x[1],E[2*m+2]=C[0],E[2*m+3]=C[1],E[2*m+4]=T[0],E[2*m+5]=T[1]}(E=d[b])[2*m]=-1,E[2*m+1]=-1,E[2*m+2]=-1,E[2*m+3]=-1,E[2*m+4]=-1,E[2*m+5]=-1}}n[t]={triangleUVs:{},patches:{},bb:{min:vec2.fromValues(1/0,1/0),max:vec2.fromValues(-1/0,-1/0)}};var D=0;s&&(D=s.length),e.attachDrawTexture({type:"texture",applyFrom:"uv"+D,applyTo:"color",blendMode:"conditionalAlpha",drawTexture:!0});var A=t+"-draw-mesh";Human.assets.geometries.createGeometry(A,{geometry:i}),e.setGeometry(A)}(h,u);var f=Human.renderer.canvasCircleToWorldSphereRadius(r,i,t.brushRadius,a.worldPos),S=a.worldPos,E=h.geometryNode,b=h.getRenderObject();mat4.invert(y,_.worldMatrix),vec3.transformMat4(v,S,y);var N,D,A=n[u],P=A.triangleUVs,M=Human.math.intersections.spherePolyhedron(E,v,f);if(0!==M.length){var w={};if(t.erase){var R=Human.math.intersections.sphereInPolyhedron(E,v,f);for(N=0,D=R.length;N<D;++N)w[R[N]]=!0}var F,L,O=Human.renderer.camera.getLookDir(s);for(N=0,D=M.length;N<D;++N)w[F=M[N]]&&P[F]?delete P[F]:(b.getTrianglePositionOnSurface(3*F,m,p,g),Human.math.triangleNormal(m,p,g,d),vec4.transformMat4(d,d,_.worldMatrix),vec3.dot(d,O)>0||(b.getPointInWorldSpace(m,m),b.getPointInWorldSpace(p,p),b.getPointInWorldSpace(g,g),P[F]?P[F].patchId!==l&&(P[F].patchId=l,I(m,p,g,P[F].uvs)):(L=new Array(3),I(m,p,g,L),P[F]={patchId:l,uvs:L})));var H=A.bb;for(F in P){var J=(L=P[F].uvs)[0],B=L[1],k=L[2];H.min[0]=Math.min(H.min[0],J[0]),H.min[0]=Math.min(H.min[0],B[0]),H.min[0]=Math.min(H.min[0],k[0]),H.max[0]=Math.max(H.max[0],J[0]),H.max[0]=Math.max(H.max[0],B[0]),H.max[0]=Math.max(H.max[0],k[0]),H.min[1]=Math.min(H.min[1],J[1]),H.min[1]=Math.min(H.min[1],B[1]),H.min[1]=Math.min(H.min[1],k[1]),H.max[1]=Math.max(H.max[1],J[1]),H.max[1]=Math.max(H.max[1],B[1]),H.max[1]=Math.max(H.max[1],k[1])}c[u]=h,o=!0}}}var E=[],b=[];function I(e,t,r,i){var a=vec2.create();Human.renderer.worldPositionToCanvas(e,a),a[0]/=u,a[1]/=_,i[0]=a;var n=vec2.create();Human.renderer.worldPositionToCanvas(t,n),n[0]/=u,n[1]/=_,i[1]=n;var o=vec2.create();Human.renderer.worldPositionToCanvas(r,o),o[0]/=u,o[1]/=_,i[2]=o}var x=vec2.create(),C=vec2.create(),T=vec2.create()}(),function(){"use strict";Human.renderer.camera.CurvePath=function(){var e,t,r=[],i=0,a=vec3.create(),n=Human.math.bezier;this.init=function(o){r=[],i=0,t=(e=o.length)-1,e<2&&Human.log.error("curvePath init no enough points");var s,l,c,u,_=vec3.create(),h=vec3.create();vec3.subtract(a,o[0],o[1]),vec3.scale(a,a,.25),vec3.add(_,o[0],a),vec3.subtract(a,o[e-1],o[e-2]),vec3.scale(a,a,.25),vec3.add(h,o[e-1],a);var f,d=vec3.create(),m=vec3.create();for(s=1;s<e;++s)u=l=o[s-1],f=c=o[s],s<=1?vec3.subtract(a,l,_):(vec3.subtract(a,c,o[s-2]),vec3.scale(a,a,.25)),vec3.add(d,u,a),s>=e-1?vec3.subtract(a,h,c):(vec3.subtract(a,o[s+1],l),vec3.scale(a,a,.25)),vec3.subtract(m,f,a),r.push(new n(u[0],u[1],u[2],d[0],d[1],d[2],m[0],m[1],m[2],f[0],f[1],f[2]));for(s=0;s<t;++s)i+=r[s].length()},this.getPosition=function(e){var t=this.getParameter(e);return{position:r[t.i].compute(t.t01),i:t.i,t01:t.t01}},this.getParameter=function(t){var r,i;return i=t*(e-1),i=Human.math.clamp(i,0,e-1),(r=Math.floor(i))>=e-1&&(r-=1),{i:r,t01:i-=r}},this.getPathLength=function(){return i}}}(),function(){"use strict";var e=Human.renderer.camera.fly={};e.flyTimeScale=1,e.velocity=1,e.cylindricalArcScale=1,e.cylindricalView=!1,e.cylindricalOnly=!1,e.cylindricalRotationLerpMin=Math.PI/6,e.cylindricalRotationLerpMax=Math.PI/2,e.cylindricalRadiusLerpMin=.2,e.cylindricalRadiusLerpMax=1;var t=[],r=null,i=new Human.renderer.camera.CurvePath,a=new Human.renderer.camera.CurvePath;function n(e,i){Human.renderer.camera.lock=!0,i&&t.push(i),e=e||{},(r=new Human.renderer.camera.fly.Animation({animationDuration:e.animationDuration,velocity:e.velocity,target:e.target,arc:e.arc,backOff:e.backOff,constrainUp:e.constrainUp,onComplete:o,cylindricalView:e.cylindricalView,easeIn:e.easeIn,easeOut:e.easeOut})).update(Date.now())}function o(){for(r=null;t.length>0;)t.pop()();Human.renderer.camera.lock=!1}e.onFrame=function(){r&&r.update(Date.now())},e.cancelAnimation=function(){r&&(o(),r=null)},e.flyAlongCurvePath=function(e,n,s){n=n||function(){},s=s||function(e){Human.log.error("Human.renderer.camera.fly.flyAlongCurvePath",e),n()},e||(s("params must be defined"),n());var l,c,u=void 0!==e.velocity?e.velocity:1,_=[],h=[],f=[];for(l=0,c=e.points.length;l<c;++l)_.push(Human.math.vec3ObjToArray(e.points[l].eye||e.points[l].position)),h.push(Human.math.vec3ObjToArray(e.points[l].look||e.points[l].target)),f.push(Human.math.vec3ObjToArray(e.points[l].up));i.init(_),a.init(h),function(e,i){Human.renderer.camera.lock=!0,i&&t.push(i),e=e||{},(r=new Human.renderer.camera.fly.CurvePathAnimation({eyeCurvePath:e.eyeCurvePath,lookCurvePath:e.lookCurvePath,upVecs:e.upVecs,velocity:e.velocity,constrainUp:e.constrainUp,easeIn:e.easeIn,easeOut:e.easeOut,onComplete:o})).update(Date.now())}({eyeCurvePath:i,lookCurvePath:a,upVecs:f,velocity:u,constrainUp:e.constrainUp,easeIn:e.easeIn,easeOut:e.easeOut},n)},e.flyTo=function(e,t,r){var i,a,o;if(t=t||function(){},r=r||function(e){Human.log.error("Human.renderer.camera.fly",e),t()},e.objectId){if(o=e.objectId,!(i=Human.scene.objects[o]))return void r("No scene object found for the given ID: '"+o+"'");(a=i.getBoundary())?n({target:{boundary:a},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut},t):t()}else n(e.boundary?{target:{boundary:a=e.boundary},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut}:e.eye||e.look?{target:{eye:e.eye,look:e.look,up:e.up},arc:e.arc,backOff:e.backOff,animationDuration:e.animationDuration,velocity:e.velocity,constrainUp:!1,cylindricalView:e.cylindricalView,easeIn:e.easeIn,easeOut:e.easeOut}:{target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut},t)},e.jumpTo=function(e,t,r){var i,a,n,s;if(t=t||function(){},r=r||function(e){Human.log.error("Human.renderer.camera.fly",e),t()},e.objectId){if(n=e.objectId,!(i=Human.scene.objects[n]))return void r("No scene object found for the given ID: '"+n+"'");(a=i.getBoundary())&&(s={target:{boundary:a},backOff:e.backOff})}else if(e.boundary)s=function(e){var t=e.backOff||0;t<0?t=0:t>1&&(t=1),t=1-t;var r=Human.math.vec3ObjToArray(Human.renderer.camera.look),i=Human.math.vec3ObjToArray(Human.renderer.camera.eye),a=vec3.create();vec3.subtract(a,i,r),vec3.normalize(a,a);var n=e.boundary,o=Human.math.getBoundaryCenter(n),s=e.stopFOV,l=vec3.length(a),c=Human.math.getBoundaryDiag(n),u=Math.abs(c/(1+.8*t)/Math.tan(s/2));return vec3.scale(a,a,u/l),vec3.add(a,o,a),{target:{eye:{x:a[0],y:a[1],z:a[2]},look:{x:o[0],y:o[1],z:o[2]},up:{x:0,y:1,z:0}}}}(e);else if(e.eye||e.look){if(!e.eye&&!e.look)return void r("incomplete parameter configuration: both 'eye' and 'look' expected");s={target:{eye:e.eye,look:e.look,up:e.up}}}else s={target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},backOff:e.backOff};s&&(o(),s.target.boundary?(s.target.stopFOV=55,Human.renderer.camera.fly.jumpTo(s.target)):Human.renderer.camera.setLookAt(s.target)),t()},e.cancel=o}(),function(){"use strict";var e=vec3.create(),t=vec3.create(),r=vec3.create();Human.renderer.camera.fly.Animation=function(i){var a=i.target,n=void 0!==i.cylindricalView?i.cylindricalView:Human.renderer.camera.fly.cylindricalView;if(this.arc=n?void 0===i.arc?1:i.arc:0,this.scaleArc=void 0===i.scaleArc?Human.renderer.camera.fly.cylindricalArcScale:i.scaleArc,this.easeIn=!!i.easeIn,this.easeOut=!1!==i.easeOut,this.constrainUp=void 0!==i.constrainUp&&i.constrainUp,!a)return Human.log.error("Human.renderer.camera.fly.Animation config missing: target"),void(i.onComplete&&i.onComplete());var o=Human.renderer.camera;this._look1=Human.math.vec3ObjToArray(o.look),this._eye1=Human.math.vec3ObjToArray(o.eye),this._up1=Human.math.vec3ObjToArray(o.up),vec3.subtract(e,this._eye1,this._look1),this._vec=vec3.create(),vec3.normalize(this._vec,e);var s=i.backOff||0;if(s<0?s=0:s>1&&(s=1),s=1-s,a.boundary){var l=a.boundary,c=a.dist||2.5,u=Math.abs(vec3.length(this._vec)),_=Human.math.getBoundaryDiag(l),h=Math.abs(_/(1+.8*s)/Math.tan(27.5))/u*c;this._look2=Human.math.getBoundaryCenter(l),a.offset&&(this._look2[0]+=a.offset[0],this._look2[1]+=a.offset[1],this._look2[2]+=a.offset[2]);var f=Human.renderer.camera.fly.cylindricalOnly;if(n){this.arc=1,Human.math.cartesianToCylindrical(this._look1,t),Human.math.cartesianToCylindrical(this._look2,r);var d=Human.math.getShortRotation(t[1],r[1]),m=r[0],p=function(e,t){var r=Human.renderer.camera.fly,i=Human.math.clamp((e-r.cylindricalRotationLerpMin)/(r.cylindricalRotationLerpMax-r.cylindricalRotationLerpMin),0,1),a=Human.math.clamp((t-r.cylindricalRadiusLerpMin)/(r.cylindricalRadiusLerpMax-r.cylindricalRadiusLerpMin),0,1);return Math.min(i,a)}(Math.abs(d),m);f?(r[0]=r[0]+h,this._eye2=Human.math.cylindricalToCartesian(r)):(r[0]=h,r[2]=0,this._eye2=Human.math.cylindricalToCartesian(r),vec3.scale(e,this._vec,h),Human.math.lerpVec3(p,0,1,e,this._eye2,e),vec3.normalize(e,e),vec3.scale(e,e,h),vec3.add(this._eye2,this._look2,e))}else vec3.scale(e,this._vec,h),this._eye2=vec3.add(vec3.create(),this._look2,e);this._up2=vec3.create(),this.constrainUp?(this._up2[0]=o.up.x,this._up2[1]=o.up.y,this._up2[2]=o.up.z):a.up?(this._up2[0]=a.up.x||0,this._up2[1]=a.up.y||0,this._up2[2]=a.up.z||0):this._up2[1]=1}else{var g=a.look,y=a.eye,v=a.up,S=Human.renderer.camera.eye,E=Human.renderer.camera.look,b=Human.renderer.camera.up;this._look2=vec3.create(),this._eye2=vec3.create(),this._up2=vec3.create(),g?(this._look2[0]=g.x||0,this._look2[1]=g.y||0,this._look2[2]=g.z||0):(this._look2[0]=E.x,this._look2[1]=E.y,this._look2[2]=E.z),y?(this._eye2[0]=y.x||0,this._eye2[1]=y.y||0,this._eye2[2]=y.z||0):(this._eye2[0]=S.x,this._eye2[1]=S.y,this._eye2[2]=S.z),v&&!this.constrainUp?(this._up2[0]=v.x||0,this._up2[1]=v.y||0,this._up2[2]=v.z||0):(this._up2[0]=b.x,this._up2[1]=b.y,this._up2[2]=b.z)}vec3.subtract(e,this._look2,this._look1);var I=Math.abs(vec3.length(e));vec3.subtract(e,this._eye2,this._eye1);var x=Math.abs(vec3.length(e));if(this.arc>0){Human.math.cartesianToCylindrical(this._eye1,t),Human.math.cartesianToCylindrical(this._eye2,r);var C=Human.math.getShortRotation(t[1],r[1]),T=(t[0]+r[0])*Math.abs(C),N=r[2]-t[1],D=Math.sqrt(T*T+N*N);x=(1-this.arc)*x+this.arc*D}this._dist=I>x?I:x,this._animationDuration=i.animationDuration?1e3*i.animationDuration:1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(i.velocity||Human.renderer.camera.fly.velocity))+1),this._onComplete=i.onComplete};var i=vec3.create(),a=vec3.create();Human.renderer.camera.fly.Animation.prototype.update=function(n){if(void 0===this._time1&&(this._time1=n,this._time2=this._time1+this._animationDuration),this._done||n>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var o,s=(n-this._time1)/this._animationDuration;if(o=this.easeIn&&this.easeOut?Human.math.easeInOut(s,0,1,1):this.easeIn?Human.math.easeIn(s,0,1,1):this.easeOut?Human.math.easeOut(s,0,1,1):s,Human.math.lerpVec3(o,0,1,this._look1,this._look2,a),this.arc>0){if(Human.math.lerpVec3Cylindrical(o,0,1,t,r,e),1!==this.scaleArc){var l=e[0],c=this.scaleArc*l;l=o<.5?Human.math.lerpScalar(o,0,.5,l,c):Human.math.lerpScalar(o,.5,1,c,l),e[0]=l}Human.math.cylindricalToCartesian(e,i),this.arc<1&&(Human.math.lerpVec3(o,0,1,this._eye1,this._eye2,e),Human.math.lerpVec3(this.arc,0,1,e,i,i))}else Human.math.lerpVec3(o,0,1,this._eye1,this._eye2,i);if(this.constrainUp)Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(a),eye:Human.math.vec3ArrayToObj(i)});else{var u=Human.math.lerpVec3(o,0,1,this._up1,this._up2,[]);Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(a),eye:Human.math.vec3ArrayToObj(i),up:Human.math.vec3ArrayToObj(u)})}},Human.renderer.camera.fly.Animation.prototype.stop=function(){}}(),function(){"use strict";var e=1,t=vec3.create();Human.properties.subscribe({propId:"camera.flyCurvePath",value:{velocity:1},callback:function(t){e=t.velocity||1}}),Human.renderer.camera.fly.CurvePathAnimation=function(t){this.easeIn=!!t.easeIn,this.easeOut=!1!==t.easeOut,this.constrainUp=void 0!==t.constrainUp&&t.constrainUp,this._eyeCurvePath=t.eyeCurvePath,this._lookCurvePath=t.lookCurvePath,this._upVecs=t.upVecs;var r=Human.renderer.camera,i=this._lookCurvePath.getParameter(1).i;this._look2=Human.math.vec3ObjToArray(this._lookCurvePath.getPosition(1).position),this._eye2=Human.math.vec3ObjToArray(this._eyeCurvePath.getPosition(1).position),this._up2=this.constrainUp?Human.math.vec3ObjToArray(r.up):this._upVecs[i+1];var a=this._eyeCurvePath.getPathLength(),n=this._lookCurvePath.getPathLength();this._dist=Math.max(a,n),this._duration=1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(t.velocity||e))+1),this._onComplete=t.onComplete},Human.renderer.camera.fly.CurvePathAnimation.prototype.update=function(e){if(void 0===this._time1&&(this._time1=e,this._time2=this._time1+this._duration),this._done||e>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var r,i=(e-this._time1)/this._duration;r=this.easeIn&&this.easeOut?Human.math.easeInOut(i,0,1,1):this.easeIn?Human.math.easeIn(i,0,1,1):this.easeOut?Human.math.easeOut(i,0,1,1):i;var a=this._lookCurvePath.getPosition(r).position,n=this._eyeCurvePath.getPosition(r).position;if(this.constrainUp)Human.renderer.camera.setLookAt({look:a,eye:n});else{var o=this._lookCurvePath.getParameter(r);Human.math.lerpVec3(o.t01,0,1,this._upVecs[o.i],this._upVecs[o.i+1],t),Human.renderer.camera.setLookAt({look:a,eye:n,up:Human.math.vec3ArrayToObj(t)})}}}(),function(){"use strict";var e=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uFocusStart;","uniform float uFocusEnd;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform sampler2D uDepth;","uniform vec2 uTexelOffset;","uniform vec2 uDepthRange;","void main() {","float ndc = 2.0 * texture2D(uDepth, vUV).r - 1.0;","float depth = -(2.0 * uDepthRange.y * uDepthRange.x) / (ndc * (uDepthRange.y - uDepthRange.x) - uDepthRange.y - uDepthRange.x);","float deltaDepth = max(depth - uFocusEnd, 0.0) + max(uFocusStart - depth, 0.0);","vec4 color = vec4(0.0);","if (ndc < 1.0 && deltaDepth > 0.0) {","float blurRadius = min(floor(uBlurCoefficient * deltaDepth), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),t={type:"dof",id:"dofHorizontal",uniforms:{uFocusStart:90,uFocusEnd:130,uBlurCoefficient:.1,uTexelOffset:new Float32Array([1/window.innerWidth,0]),uDepthRange:new Float32Array([.1,1e4])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},r={type:"dof",id:"dofVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},i=Human.renderer.postprocess.effects.dof={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,focusStart:90,focusEnd:130,blurCoefficient:.1};i.init=function(t){this.scene=t,this.supported&&t.createPostProcessType("dof",e)},i.addStage=function(e){if(this.supported){var i=e.getIOFramebuffers("final");t.uniforms.uFocusStart=this.focusStart,t.uniforms.uFocusEnd=this.focusEnd,t.uniforms.uBlurCoefficient=this.blurCoefficient,t.uniforms.uDepthRange[0]=Human.renderer.camera.near,t.uniforms.uDepthRange[1]=Human.renderer.camera.far,t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.textures.uTexture.framebuffer=i.read,t.framebuffer=i.write,i=e.getIOFramebuffers("final"),r.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,r.textures.uTexture.framebuffer=i.read,r.framebuffer=i.write,e.finalPipeline.push(t),e.finalPipeline.push(r)}},i.setFocusStart=function(e){this.focusStart=t.uniforms.uFocusStart=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uFocusStart",this.focusStart)},i.setFocusEnd=function(e){this.focusEnd=t.uniforms.uFocusEnd=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uFocusEnd",this.focusEnd)},i.setBlurCoefficient=function(e){this.blurCoefficient=t.uniforms.uBlurCoefficient=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uBlurCoefficient",this.blurCoefficient)},i.configure=function(e){(e=e||{}).focusStart=void 0===e.focusStart?90:e.focusStart,e.focusEnd=void 0===e.focusEnd?130:e.focusEnd,e.blur=void 0===e.blur?.1:e.blur,this.setFocusStart(e.focusStart),this.setFocusEnd(e.focusEnd),this.setBlurCoefficient(e.blur)},i.updateProjection=function(){t.uniforms.uDepthRange[0]=Human.renderer.camera.near,t.uniforms.uDepthRange[1]=Human.renderer.camera.far;var e=this.scene.getPostProcessStage("dofHorizontal");e&&e.setUniform("uDepthRange",t.uniforms.uDepthRange)},i.updateCanvas=function(){var e=Human.renderer.canvas;t.uniforms.uTexelOffset[0]=1/e.width,r.uniforms.uTexelOffset[1]=1/e.height;var i=this.scene.getPostProcessStage("dofHorizontal"),a=this.scene.getPostProcessStage("dofVertical");i&&a&&(i.setUniform("uTexelOffset",t.uniforms.uTexelOffset),a.setUniform("uTexelOffset",r.uniforms.uTexelOffset))}}(),function(){"use strict";var e=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","void main() {","vec4 color = vec4(0.0);","float blurRadius = min(floor(uBlurCoefficient * 100.0), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","gl_FragColor = color;","}"].join("\n"),t={type:"blur",id:"blurHorizontal",uniforms:{uBlurCoefficient:.1,uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},r={type:"blur",id:"blurVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},i=Human.renderer.postprocess.effects.blur={scene:null,blurCoefficient:.1};i.init=function(t){this.scene=t,t.createPostProcessType("blur",e)},i.addStage=function(e){var i=e.getIOFramebuffers("final");t.uniforms.uBlurCoefficient=this.blurCoefficient,t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.textures.uTexture.framebuffer=i.read,t.framebuffer=i.write,i=e.getIOFramebuffers("final"),r.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,r.textures.uTexture.framebuffer=i.read,r.framebuffer=i.write,e.finalPipeline.push(t),e.finalPipeline.push(r)},i.setBlurCoefficient=function(e){this.blurCoefficient=t.uniforms.uBlurCoefficient=e;var r=this.scene.getPostProcessStage("blurHorizontal");r&&r.setUniform("uBlurCoefficient",this.blurCoefficient)},i.configure=function(e){(e=e||{}).blur=void 0===e.blur?.1:e.blur,this.setBlurCoefficient(e.blur)},i.updateCanvas=function(){var e=Human.renderer.canvas,i=this.scene.getPostProcessStage("blurHorizontal"),a=this.scene.getPostProcessStage("blurVertical");i&&a&&(t.uniforms.uTexelOffset[0]=1/e.width,r.uniforms.uTexelOffset[1]=1/e.height,i.setUniform("uTexelOffset",t.uniforms.uTexelOffset),a.setUniform("uTexelOffset",r.uniforms.uTexelOffset))}}(),function(){"use strict";var e=new Float32Array([0,0]),t=new Float32Array(4),r=new Float32Array(3),i=new Float32Array(3),a=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform sampler2D uTexture;","uniform vec4 uBlurParams;","uniform vec3 uTexelParams;","void main() {","vec2 center = uBlurParams.xy;","float radius = uBlurParams.z;","float blurCoefficient = uBlurParams.w;","vec2 texelOffset = uTexelParams.xy;","float aspect = uTexelParams.z;","vec2 pos = vUV * 2.0 - 1.0;","pos.x *= aspect;","float r = length(pos - center);","float deltaR = max(r - radius, 0.0);","vec4 color = vec4(0.0);","if (deltaR > 0.0) {","float blurRadius = min(floor(blurCoefficient * 100.0 * deltaR), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * texelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),n={type:"radialBlur",id:"radialBlurHorizontal",uniforms:{uBlurParams:t,uTexelParams:r},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},o={type:"radialBlur",id:"radialBlurVertical",uniforms:{uTexelParams:i},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},s=Human.renderer.postprocess.effects.radialBlur={scene:null,radius:.2,center:new Float32Array(e),blurCoefficient:.1};s.init=function(e){this.scene=e,e.createPostProcessType("radialBlur",a)},s.addStage=function(e){var a=e.getIOFramebuffers("final");t.set(this.center),t[2]=this.radius,t[3]=this.blurCoefficient;var s=Human.renderer.canvas.width/Human.renderer.canvas.height;r[0]=s/Human.renderer.canvas.width,r[2]=s,i[1]=1/Human.renderer.canvas.height,i[2]=s,n.textures.uTexture.framebuffer=a.read,n.framebuffer=a.write,a=e.getIOFramebuffers("final"),o.textures.uTexture.framebuffer=a.read,o.framebuffer=a.write,e.finalPipeline.push(n),e.finalPipeline.push(o)},s.setRadius=function(e){this.radius=t[2]=e;var r=this.scene.getPostProcessStage("radialBlurHorizontal");r&&r.setUniform("uBlurParams",t)},s.setCenter=function(e,r){this.center[0]=e,this.center[1]=r,t.set(this.center);var i=this.scene.getPostProcessStage("radialBlurHorizontal");i&&i.setUniform("uBlurParams",t)},s.setBlurCoefficient=function(e){this.blurCoefficient=t[3]=e;var r=this.scene.getPostProcessStage("radialBlurHorizontal");r&&r.setUniform("uBlurParams",t)},s.configure=function(t){(t=t||{}).radius=void 0===t.radius?.2:t.radius,t.center=void 0===t.center?e:t.center,t.blur=void 0===t.blur?.1:t.blur,this.setRadius(t.radius),this.setCenter(t.center[0],t.center[1]),this.setBlurCoefficient(t.blur)},s.updateCanvas=function(){var e=Human.renderer.canvas,t=e.width/e.height;r[0]=t/e.width,r[2]=t,i[1]=1/e.height,i[2]=t;var a=this.scene.getPostProcessStage("radialBlurHorizontal"),n=this.scene.getPostProcessStage("radialBlurVertical");a&&n&&(a.setUniform("uTexelParams",r),n.setUniform("uTexelParams",i))}}(),function(){"use strict";var e=["precision highp float;","varying vec2 vUV;","uniform float uGamma;","uniform bool uToneMap;","uniform sampler2D uTexture;","vec3 toneMapReinhard(vec3 color) {","    return color / (color + 1.0);","}","void main() {","   vec4 color = texture2D(uTexture, vUV);","   if (uToneMap) {","       color.rgb = toneMapReinhard(color.rgb);","   }","   color.rgb = pow(color.rgb, vec3(1.0 / uGamma));","   gl_FragColor = color;","}"].join("\n"),t={type:"gammaCorrect",id:"gammaCorrect",uniforms:{uGamma:2.2,uToneMap:!1},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},r=Human.renderer.postprocess.effects.gammaCorrect={scene:null,gamma:2.2,toneMap:!1};r.init=function(t){this.scene=t,t.createPostProcessType("gammaCorrect",e)},r.addStage=function(e){var r=e.getIOFramebuffers("final");t.uniforms.uGamma=this.gamma,t.uniforms.uToneMap=this.toneMap,t.textures.uTexture.framebuffer=r.read,t.framebuffer=r.write,e.finalPipeline.push(t)},r.setGamma=function(e){this.gamma=t.uniforms.uGamma=e;var r=this.scene.getPostProcessStage("gammaCorrect");r&&r.setUniform("uGamma",this.gamma)},r.setToneMap=function(e){this.toneMap=t.uniforms.uToneMap=e;var r=this.scene.getPostProcessStage("gammaCorrect");r&&r.setUniform("uToneMap",this.toneMap)},r.configure=function(e){(e=e||{}).gamma=void 0===e.gamma?2.2:e.gamma,e.toneMap=void 0!==e.toneMap&&e.toneMap,this.setGamma(e.gamma),this.setToneMap(e.toneMap)}}(),function(){"use strict";var e=["precision highp float;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","varying vec2 vUV;","const float fxaaQualitySubpix = 0.75;","const float fxaaQualityEdgeThreshold = 0.125;","const float fxaaQualityEdgeThresholdMin = 0.0;","#define FXAA_QUALITY_PRESET 25","#if (FXAA_QUALITY_PRESET == 10)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 3.0","#define FXAA_QUALITY_P2 12.0","#endif","#if (FXAA_QUALITY_PRESET == 11)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 3.0","#define FXAA_QUALITY_P3 12.0","#endif","#if (FXAA_QUALITY_PRESET == 12)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 4.0","#define FXAA_QUALITY_P4 12.0","#endif","#if (FXAA_QUALITY_PRESET == 13)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 4.0","#define FXAA_QUALITY_P5 12.0","#endif","#if (FXAA_QUALITY_PRESET == 14)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 4.0","#define FXAA_QUALITY_P6 12.0","#endif","#if (FXAA_QUALITY_PRESET == 15)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 12.0","#endif","#if (FXAA_QUALITY_PRESET == 20)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 2.0","#define FXAA_QUALITY_P2 8.0","#endif","#if (FXAA_QUALITY_PRESET == 21)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 8.0","#endif","#if (FXAA_QUALITY_PRESET == 22)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 8.0","#endif","#if (FXAA_QUALITY_PRESET == 23)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 8.0","#endif","#if (FXAA_QUALITY_PRESET == 24)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 3.0","#define FXAA_QUALITY_P6 8.0","#endif","#if (FXAA_QUALITY_PRESET == 25)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 8.0","#endif","#if (FXAA_QUALITY_PRESET == 26)","#define FXAA_QUALITY_PS 9","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 4.0","#define FXAA_QUALITY_P8 8.0","#endif","#if (FXAA_QUALITY_PRESET == 27)","#define FXAA_QUALITY_PS 10","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 4.0","#define FXAA_QUALITY_P9 8.0","#endif","#if (FXAA_QUALITY_PRESET == 28)","#define FXAA_QUALITY_PS 11","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 4.0","#define FXAA_QUALITY_P10 8.0","#endif","#if (FXAA_QUALITY_PRESET == 29)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#if (FXAA_QUALITY_PRESET == 39)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.0","#define FXAA_QUALITY_P2 1.0","#define FXAA_QUALITY_P3 1.0","#define FXAA_QUALITY_P4 1.0","#define FXAA_QUALITY_P5 1.5","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#define FxaaBool bool","#define FxaaFloat float","#define FxaaFloat2 vec2","#define FxaaFloat3 vec3","#define FxaaFloat4 vec4","#define FxaaHalf float","#define FxaaHalf2 vec2","#define FxaaHalf3 vec3","#define FxaaHalf4 vec4","#define FxaaInt2 vec2","#define FxaaTex sampler2D","#define FxaaSat(x) clamp(x, 0.0, 1.0)","#define FxaaTexTop(t, p) texture2D(t, p)","#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))","FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","FxaaFloat4 FxaaPixelShader(","FxaaFloat2 pos,","FxaaTex tex,","FxaaFloat2 fxaaQualityRcpFrame,","FxaaFloat fxaaQualitySubpix,","FxaaFloat fxaaQualityEdgeThreshold,","FxaaFloat fxaaQualityEdgeThresholdMin",") {","FxaaFloat2 posM;","posM.x = pos.x;","posM.y = pos.y;","FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","#define lumaM rgbyM.y","FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat maxSM = max(lumaS, lumaM);","FxaaFloat minSM = min(lumaS, lumaM);","FxaaFloat maxESM = max(lumaE, maxSM);","FxaaFloat minESM = min(lumaE, minSM);","FxaaFloat maxWN = max(lumaN, lumaW);","FxaaFloat minWN = min(lumaN, lumaW);","FxaaFloat rangeMax = max(maxWN, maxESM);","FxaaFloat rangeMin = min(minWN, minESM);","FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","FxaaFloat range = rangeMax - rangeMin;","FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","FxaaBool earlyExit = range < rangeMaxClamped;","if(earlyExit)","return rgbyM;","FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNS = lumaN + lumaS;","FxaaFloat lumaWE = lumaW + lumaE;","FxaaFloat subpixRcpRange = 1.0/range;","FxaaFloat subpixNSWE = lumaNS + lumaWE;","FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","FxaaFloat lumaNESE = lumaNE + lumaSE;","FxaaFloat lumaNWNE = lumaNW + lumaNE;","FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","FxaaFloat lumaNWSW = lumaNW + lumaSW;","FxaaFloat lumaSWSE = lumaSW + lumaSE;","FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","FxaaBool horzSpan = edgeHorz >= edgeVert;","FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","if(!horzSpan) lumaN = lumaW;","if(!horzSpan) lumaS = lumaE;","if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","FxaaFloat gradientN = lumaN - lumaM;","FxaaFloat gradientS = lumaS - lumaM;","FxaaFloat lumaNN = lumaN + lumaM;","FxaaFloat lumaSS = lumaS + lumaM;","FxaaBool pairN = abs(gradientN) >= abs(gradientS);","FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","if(pairN) lengthSign = -lengthSign;","FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","FxaaFloat2 posB;","posB.x = posM.x;","posB.y = posM.y;","FxaaFloat2 offNP;","offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","if(!horzSpan) posB.x += lengthSign * 0.5;","if( horzSpan) posB.y += lengthSign * 0.5;","FxaaFloat2 posN;","posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","FxaaFloat2 posP;","posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","FxaaFloat subpixE = subpixC * subpixC;","FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","if(!pairN) lumaNN = lumaSS;","FxaaFloat gradientScaled = gradient * 1.0/4.0;","FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","FxaaFloat subpixF = subpixD * subpixE;","FxaaBool lumaMLTZero = lumaMM < 0.0;","lumaEndN -= lumaNN * 0.5;","lumaEndP -= lumaNN * 0.5;","FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","FxaaBool doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","#if (FXAA_QUALITY_PS > 3)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","#if (FXAA_QUALITY_PS > 4)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","#if (FXAA_QUALITY_PS > 5)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","#if (FXAA_QUALITY_PS > 6)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","#if (FXAA_QUALITY_PS > 7)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","#if (FXAA_QUALITY_PS > 8)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","#if (FXAA_QUALITY_PS > 9)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","#if (FXAA_QUALITY_PS > 10)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","#if (FXAA_QUALITY_PS > 11)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","#if (FXAA_QUALITY_PS > 12)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","FxaaFloat dstN = posM.x - posN.x;","FxaaFloat dstP = posP.x - posM.x;","if(!horzSpan) dstN = posM.y - posN.y;","if(!horzSpan) dstP = posP.y - posM.y;","FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","FxaaFloat spanLength = (dstP + dstN);","FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","FxaaFloat spanLengthRcp = 1.0/spanLength;","FxaaBool directionN = dstN < dstP;","FxaaFloat dst = min(dstN, dstP);","FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","FxaaFloat subpixG = subpixF * subpixF;","FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","return FxaaTexTop(tex, posM);","}","void main() {","gl_FragColor = FxaaPixelShader(","vUV,","uTexture,","uTexelOffset,","fxaaQualitySubpix,","fxaaQualityEdgeThreshold,","fxaaQualityEdgeThresholdMin);","}"].join("\n"),t={type:"fxaa",id:"fxaa",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},r=Human.renderer.postprocess.effects.fxaa={scene:null};r.init=function(t){this.scene=t,t.createPostProcessType("fxaa",e)},r.addStage=function(e){var r=e.getIOFramebuffers("final");t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,t.textures.uTexture.framebuffer=r.read,t.framebuffer=r.write,e.finalPipeline.push(t)},r.configure=function(){},r.updateCanvas=function(){t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height;var e=this.scene.getPostProcessStage("fxaa");e&&e.setUniform("uTexelOffset",t.uniforms.uTexelOffset)}}(),function(){"use strict";var e=["#extension GL_OES_standard_derivatives : require","precision highp float;","#define PI2 6.283185","#define TAU (PI2 * 2.0)","#define NUM_SAMPLES 16.0","#define SAMPLE_WEIGHT (1.0 / NUM_SAMPLES)","#define EPSILON 0.0001","varying vec2 vUV;","uniform float uSampleRadius;","uniform float uIntensity;","uniform float uContrast;","uniform float uBias;","uniform vec2 uTexelOffset;","uniform vec3 uDepthParams;","uniform vec3 uXYParams;","uniform sampler2D uDepthBuffer;","vec3 getPosition(float fragDepth, vec2 uv) {","vec2 clipCoord = uv * 2.0 - 1.0;","float zView = uDepthParams.x / (fragDepth * uDepthParams.y + uDepthParams.z);","return vec3(","clipCoord.x * zView * uXYParams.x * uXYParams.y,","clipCoord.y * zView * uXYParams.y,","zView",");","}","vec2 packDepth(float viewZ) {","    float d = viewZ / -uDepthParams.z;","float temp = floor(d * 256.0);","return vec2(","    temp / 256.0,","    d * 256.0 - temp",");","}","void main() {","float fragDepth = texture2D(uDepthBuffer, vUV).x;","if (fragDepth == 1.0) { discard; }","vec3 position = getPosition(fragDepth, vUV);","vec3 normal = normalize(cross(dFdx(position), dFdy(position)));","float ssRadius = min((uXYParams.z * uSampleRadius) / (position.z + EPSILON), 32.0);","if (ssRadius < 4.0) { discard; }","float occlusion = 0.0;","for (int i = 0; i < int(NUM_SAMPLES); ++i) {","   float a = (float(i) + 0.5) * SAMPLE_WEIGHT;","   float h = ssRadius * a;","   float theta = a * TAU;","   vec2 u = vec2(cos(theta), sin(theta));","   vec2 uv = vUV + h * u * uTexelOffset;","   fragDepth = texture2D(uDepthBuffer, uv).x;","   vec3 samplePosition = getPosition(fragDepth, uv);","   vec3 dir = samplePosition - position;","   float len2 = dot(dir, dir);","   float f = max(0.0, uSampleRadius * uSampleRadius - len2);","   occlusion += f * f * f * max(0.0, dot(dir, normal) - uBias) / (len2 + EPSILON);","}","occlusion = max(0.0, occlusion * 2.0 * uIntensity * SAMPLE_WEIGHT);","vec2 odd = mod(gl_FragCoord.xy, 2.0);","if (abs(dFdx(position.z)) < 0.02) {","    occlusion -= dFdx(occlusion) * (odd.x - 0.5);","}","if (abs(dFdy(position.z)) < 0.02) {","    occlusion -= dFdy(occlusion) * (odd.y - 0.5);","}","gl_FragColor.r = occlusion;","gl_FragColor.gb = packDepth(position.z);","}"].join("\n"),t=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform vec2 uTexelOffset;","float unpackDepth(vec2 p) {","    return p.x + p.y / 256.0;","}","void main() {","float gaussian[5];","gaussian[0] = 0.153170;","gaussian[1] = 0.144893;","gaussian[2] = 0.122649;","gaussian[3] = 0.092902;","gaussian[4] = 0.062970;","vec3 centerValue = texture2D(uColorBuffer, vUV).rgb;","float totalWeight = gaussian[0];","float sum = centerValue.r * totalWeight;","float centerDepth = unpackDepth(centerValue.gb);","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * -float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","gl_FragColor.r = sum / (totalWeight + 0.0001);","}"].join("\n"),r=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform sampler2D uOcclusionBuffer;","uniform float uOcclusionScale;","uniform float uOcclusionCutoff;","void main() {","vec4 color = texture2D(uColorBuffer, vUV);","float ambient = 1.0 - smoothstep(uOcclusionCutoff, 1.0, texture2D(uOcclusionBuffer, vUV).r) * uOcclusionScale;","gl_FragColor = vec4(color.rgb * ambient, color.a);","}"].join("\n"),i={type:"sao",id:"sao",uniforms:{uSampleRadius:.4,uIntensity:8,uBias:.001,uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight]),uXYParams:new Float32Array(3),uDepthParams:new Float32Array(3)},textures:{uDepthBuffer:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"__BDS_SAO"},a={type:"saoblur",id:"saohblur",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uColorBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"---SET_ME---"},n={type:"saoblur",id:"saovblur",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"__BDS_SAO"},o={type:"saoblend",id:"saoblend",uniforms:{uOcclusionScale:.9,uOcclusionCutoff:.3},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"},uOcclusionBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"--SET_ME---"},s=Human.renderer.postprocess.effects.sao={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,fbInitialized:!1,sampleRadius:.9,intensity:50,bias:.1,scale:.9};s.init=function(i){this.scene=i,this.supported&&(i.createPostProcessType("sao",e),i.createPostProcessType("saoblur",t),i.createPostProcessType("saoblend",r))},s.addStage=function(e){if(this.supported){this.fbInitialized||this.scene.createFramebuffer("__BDS_SAO",{depthAttachment:!1});var t=this.scene.getProjection(),r=t.aspect,s=t.fov*Math.PI/180,l=t.near,c=t.far,u=-Math.tan(.5*s),_=-Human.renderer.canvas.height/(2*Math.tan(.5*s)),h=Human.renderer.canvas.width,f=Human.renderer.canvas.height,d=e.getIOFramebuffers("opaque"),m=d.read,p=d.write;i.uniforms.uSampleRadius=this.sampleRadius,i.uniforms.uIntensity=this.intensity,i.uniforms.uBias=this.bias,i.uniforms.uTexelOffset[0]=1/h,i.uniforms.uTexelOffset[1]=1/f,i.uniforms.uXYParams[0]=r,i.uniforms.uXYParams[1]=u,i.uniforms.uXYParams[2]=_,i.uniforms.uDepthParams[0]=-l*c,i.uniforms.uDepthParams[1]=l-c,i.uniforms.uDepthParams[2]=c,a.uniforms.uTexelOffset[0]=1/h,a.uniforms.uTexelOffset[1]=0,a.framebuffer=p,n.uniforms.uTexelOffset[0]=0,n.uniforms.uTexelOffset[1]=1/f,n.textures.uColorBuffer.framebuffer=p,o.uniforms.uOcclusionScale=this.scale,o.textures.uColorBuffer.framebuffer=m,o.framebuffer=p,e.opaquePipeline.push(i),e.opaquePipeline.push(a),e.opaquePipeline.push(n),e.opaquePipeline.push(o)}},s.setSampleRadius=function(e){this.sampleRadius=i.uniforms.uSampleRadius=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uSampleRadius",this.sampleRadius)},s.setIntensity=function(e){this.intensity=i.uniforms.uIntensity=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uIntensity",this.intensity)},s.setBias=function(e){this.bias=i.uniforms.uBias=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uBias",this.bias)},s.setOcclusionScale=function(e){this.scale=o.uniforms.uOcclusionScale=e;var t=this.scene.getPostProcessStage("saoblend");t&&t.setUniform("uOcclusionScale",this.scale)},s.setOcclusionCutoff=function(e){this.cutoff=o.uniforms.uOcclusionCutoff=e;var t=this.scene.getPostProcessStage("saoblend");t&&t.setUniform("uOcclusionCutoff",this.cutoff)},s.configure=function(e){(e=e||{}).sampleRadius=void 0===e.sampleRadius?.9:e.sampleRadius,e.intensity=void 0===e.intensity?50:e.intensity,e.bias=void 0===e.bias?.1:e.bias,e.scale=void 0===e.scale?.9:e.scale,e.cutoff=void 0===e.cutoff?.3:e.cutoff,this.setSampleRadius(e.sampleRadius),this.setIntensity(e.intensity),this.setBias(e.bias),this.setOcclusionScale(e.scale),this.setOcclusionCutoff(e.cutoff)},s.updateProjection=function(){var e=this.scene.getProjection(),t=e.aspect,r=e.fov*Math.PI/180,a=e.near,n=e.far,o=-Math.tan(.5*r),s=-Human.renderer.canvas.height/(2*Math.tan(.5*r));i.uniforms.uXYParams[0]=t,i.uniforms.uXYParams[1]=o,i.uniforms.uXYParams[2]=s,i.uniforms.uDepthParams[0]=-a*n,i.uniforms.uDepthParams[1]=a-n,i.uniforms.uDepthParams[2]=n;var l=this.scene.getPostProcessStage("sao");l&&(l.setUniform("uXYParams",i.uniforms.uXYParams),l.setUniform("uDepthParams",i.uniforms.uDepthParams))},s.updateCanvas=function(){var e=Human.renderer.canvas.width,t=Human.renderer.canvas.height,r=this.scene.getProjection(),o=r.aspect,s=r.fov*Math.PI/180,l=-Math.tan(.5*s),c=-Human.renderer.canvas.height/(2*Math.tan(.5*s));i.uniforms.uTexelOffset[0]=1/e,i.uniforms.uTexelOffset[1]=1/t,i.uniforms.uXYParams[0]=o,i.uniforms.uXYParams[1]=l,i.uniforms.uXYParams[2]=c,a.uniforms.uTexelOffset[0]=1/e,n.uniforms.uTexelOffset[1]=1/t;var u=this.scene.getPostProcessStage("sao"),_=this.scene.getPostProcessStage("saohblur"),h=this.scene.getPostProcessStage("saovblur");u&&_&&h&&(u.setUniform("uXYParams",i.uniforms.uXYParams),u.setUniform("uTexelOffset",i.uniforms.uTexelOffset),_.setUniform("uTexelOffset",a.uniforms.uTexelOffset),h.setUniform("uTexelOffset",n.uniforms.uTexelOffset))}}(),function(){"use strict";var e=new Human.utils.selection.GraphMatcher,t=Human.scene={};function r(e,t){var i,a,n=e.matrixDirty,o=n||t,s=o;if(n&&e.buildMatrix(),o&&(e.parent?mat4.multiply(e.worldMatrix,e.parent.worldMatrix,e.localMatrix):e.worldMatrix.set(e.localMatrix),e.matrixDirty=!1),e.isLeaf())return o?(e.compileXform(),!0):!!e.geoDirty&&(e.compileBoundary(),e.geoDirty=!1,!0);for(i=0,a=e.objects.length;i<a;++i)r(e.objects[i],o)&&(s=!0);if(s){for(e.boundary.xmin=Number.POSITIVE_INFINITY,e.boundary.ymin=Number.POSITIVE_INFINITY,e.boundary.zmin=Number.POSITIVE_INFINITY,e.boundary.xmax=Number.NEGATIVE_INFINITY,e.boundary.ymax=Number.NEGATIVE_INFINITY,e.boundary.zmax=Number.NEGATIVE_INFINITY,i=0,a=e.objects.length;i<a;++i){var l=e.objects[i].getBoundary();e.boundary.xmin=Math.min(e.boundary.xmin,l.xmin),e.boundary.ymin=Math.min(e.boundary.ymin,l.ymin),e.boundary.zmin=Math.min(e.boundary.zmin,l.zmin),e.boundary.xmax=Math.max(e.boundary.xmax,l.xmax),e.boundary.ymax=Math.max(e.boundary.ymax,l.ymax),e.boundary.zmax=Math.max(e.boundary.zmax,l.zmax)}e.center[0]=.5*(e.boundary.xmin+e.boundary.xmax),e.center[1]=.5*(e.boundary.ymin+e.boundary.ymax),e.center[2]=.5*(e.boundary.zmin+e.boundary.zmax)}return s}t.rootObjects=[],t.modelObjects={},t.objects={},t.colorModPriorities={__HIGHLIGHT:Number.POSITIVE_INFINITY},t.objectsByFMAID={},t.objectsForTags={},t._kdTree=null,t.kdTreeDirty=!0,t.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},t.center=vec3.create(),t.enabledObjects={},t._leavesCache={},t.createObject=function(e){if(e.objectId){if(!t.objects[e.objectId]){var r=e.parentObjectId?t.objects[e.parentObjectId]:null,i=e.modelId;e.tags=e.tags||[];var a,n=r?t._inheritTags(e.tags,r):e.tags;return e.modelId=i,e.parent=r,e.tags=n,r&&(e.reflectedX=r.reflectedX,e.reflectedY=r.reflectedY,e.reflectedZ=r.reflectedZ),a=e.group?new Human.scene.Group(e):new Human.scene.Object(e),t.objects[e.objectId]=a,a.fmaId&&(t.objectsByFMAID[a.fmaId]=a),r?r.objects.push(a):t.rootObjects.push(a),(t.modelObjects[i]=t.modelObjects[i]||{})[e.objectId]=a,t._registerObjectForTags(a),Human.events.fire("scene.objectCreated",{moduleId:e.moduleId,modelId:i,objectId:a.objectId,name:a.displayName,description:a.description,displayName:a.displayName,fmaId:a.fmaId,tags:a.tags,parentObjectId:r?r.objectId:null}),void 0!==e.shown&&(a.show(e.shown),e.shown&&(t.enabledObjects[e.objectId]=a)),t._leavesCache={},a}Human.log.error("Scene.createObject","Param: objectId already in use")}else Human.log.error("Scene.createObject","Param expected: objectId")},t._inheritTags=function(e,t){var r,i=e||[],a=t.tags,n=[];if(i){for(var o=0,s=a.length;o<s;o++){r=a[o];for(var l=!0,c=0,u=i.length;c<u;c++)i[c]===r&&(l=!1);l&&n.push(r)}return i.concat(n)}return i},t._registerObjectForTags=function(e){for(var r,i,a=e.tags,n=0,o=a.length;n<o;n++)(i=t.objectsForTags[r=a[n]])||(i=t.objectsForTags[r]={}),i[e.objectId]=e},t._deregisterObjectForTags=function(e){for(var r,i=e.tags,a=0,n=i.length;a<n;a++)(r=t.objectsForTags[i[a]])&&delete r[e.objectId]},t.setEnabledObjects=function(e){var r={},i=e.fetchAssets?[]:null;t.setEnabledSubtree(Human.scene.rootObjects,e.objects||e.objectIds,!e.replace&&void 0,i,r),i&&Human.scene.graph.attachAssetSetsToSubtree(i),Human.utils.isEmpty(r)||Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:r})},t.setEnabledSubtree=function(e,r,i,a,n){for(var o=0,s=e.length;o<s;++o){var l=e[o],c=void 0!==r[l.objectId]?r[l.objectId]:i;l.isLeaf()?!0===c?t.enabledObjects[l.objectId]||(t.enabledObjects[l.objectId]=l,n[l.objectId]=!0,l.show(!0),a&&!l.isRenderable()&&a.push(l)):!1===c&&t.enabledObjects[l.objectId]&&(delete t.enabledObjects[l.objectId],n[l.objectId]=!1,l.show(!1)):t.setEnabledSubtree(l.objects,r,c,a,n)}},t.setColorModPriority=function(e,t){this.colorModPriorities[e]=t;for(var r=this.getLeaves(),i=0,a=r.length;i<a;++i)Human.scene.objects[r[i]].colorModPrioritiesDirty()},t.getLeaves=function(e){var r=t._leavesCache[e];if(!r){if(r=[],e){var i=t.objects[e];i&&t._getLeaves([i],r)}else t._getLeaves(Human.scene.rootObjects,r);t._leavesCache[e]=r}return r},t._getLeaves=function(e,r){for(var i,a=0,n=e.length;a<n;a++)0===(i=e[a]).objects.length?r.push(i.objectId):t._getLeaves(i.objects,r)},t.getEnabledLeaves=function(e){var r;if(e){var i=t.objects[e];r=[],i&&t._getEnabledLeaves([i],r)}else r=Object.keys(t.enabledObjects);return r},t._getEnabledLeaves=function(e,r){for(var i,a=0,n=e.length;a<n;a++)0===(i=e[a]).objects.length?t.enabledObjects.hasOwnProperty(i.objectId)&&r.push(i.objectId):t._getEnabledLeaves(i.objects,r)},t._getKeys=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(r[r]=t);return{}},t.destroyObject=function(e){var r=t.objects[e];if(r&&!r._destroyed){var i,a;for(i=0,a=t.rootObjects.length;i<a;i++)if(t.rootObjects[i].objectId===e){t.rootObjects.splice(i,1);break}delete t.objects[e],r.fmaId&&delete t.objectsByFMAID[r.fmaId],delete t.enabledObjects[e],r.parent&&r.parent._removeObject(e);var n=r.objects.slice(0);for(i=0,a=n.length;i<a;i++)t.destroyObject(n[i].objectId);r.isLeaf()&&r.destroyNodes(),delete t.modelObjects[r.modelId][r.objectId],t._deregisterObjectForTags(r),t._leavesCache={},Human.events.fire("scene.objectDestroyed",{objectId:e})}},t.getBoundary=function(e){if(!e)return this.boundary;var r,i,a,n;if((e=e||{}).objectIds){a={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};for(var o=e.objectIds,s=0,l=o.length;s<l;s++)(r=t.objects[o[s]])&&0===r.objects.length&&((n=r.getBoundary()).xmin<a.xmin&&(a.xmin=n.xmin),n.ymin<a.ymin&&(a.ymin=n.ymin),n.zmin<a.zmin&&(a.zmin=n.zmin),n.xmax>a.xmax&&(a.xmax=n.xmax),n.ymax>a.ymax&&(a.ymax=n.ymax),n.zmax>a.zmax&&(a.zmax=n.zmax))}else if(e.objects){a={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};var c=e.objects;for(i in c)c[i]&&t.objects[i]&&0===(r=t.objects[i]).objects.length&&((n=r.getBoundary()).xmin<a.xmin&&(a.xmin=n.xmin),n.ymin<a.ymin&&(a.ymin=n.ymin),n.zmin<a.zmin&&(a.zmin=n.zmin),n.xmax>a.xmax&&(a.xmax=n.xmax),n.ymax>a.ymax&&(a.ymax=n.ymax),n.zmax>a.zmax&&(a.zmax=n.zmax))}else a=e.clipped?Human.utils.deepClone(this.boundary):this.boundary;if(e.clipped){var u=Human.renderer.clip.getBoundary();a.xmin=Math.max(a.xmin,u.xmin),a.xmax=Math.min(a.xmax,u.xmax),a.ymin=Math.max(a.ymin,u.ymin),a.ymax=Math.min(a.ymax,u.ymax),a.zmin=Math.max(a.zmin,u.zmin),a.zmax=Math.min(a.zmax,u.zmax)}return a},t.getKdTree=function(){if(this.kdTreeDirty){for(var e=Human.scene.rootObjects,t=[],r=function(e){e.shown&&0===e.objects.length&&t.push(e)},a=0,n=e.length;a<n;++a)e[a].traverseDown(r);this._kdTree=function e(t,r,a){var n,o,s,l,c=vec3.create(),u=vec3.create(),_={objects:t,left:null,right:null,bb:{min:c,max:u}};if(0===t.length)return _;for(c[0]=c[1]=c[2]=Number.POSITIVE_INFINITY,u[0]=u[1]=u[2]=Number.NEGATIVE_INFINITY,s=0,l=t.length;s<l;++s)(o=(n=t[s]).getBoundary()).xmin<c[0]&&(c[0]=o.xmin),o.xmax>u[0]&&(u[0]=o.xmax),o.ymin<c[1]&&(c[1]=o.ymin),o.ymax>u[1]&&(u[1]=o.ymax),o.zmin<c[2]&&(c[2]=o.zmin),o.zmax>u[2]&&(u[2]=o.zmax);if(a>10)return _;var h=i[r],f=(c[r]+u[r])/2,d=new Array(t.length),m=0,p=new Array(t.length),g=0;for(s=0,l=t.length;s<l;++s)(o=(n=t[s]).getBoundary())[h]<=f?d[m++]=n:p[g++]=n;return m<1||g<1?_:(d.length=m,p.length=g,_.left=e(d,(r+1)%3,a+1),_.right=e(p,(r+1)%3,a+1),_)}(t,0,0),this.kdTreeDirty=!1}return this._kdTree},t.access=function(e){return t.getLeaves(e)},t.select=function(r){return e.match(t,r)},t.setObjectProperties=function(e){e=e||{};var r={},i={},a={},n={transform:!0},o=Human.scene.rootObjects;function s(o){var s=r[o.objectId]=e[o.objectId]||{};if(o.parent){var l=r[o.parent.objectId];for(var c in l)void 0!==s[c]||n[c]||(s[c]=l[c]);s.glassFactor=o.glassFactor,s.murkiness=o.murkiness}s.hasOwnProperty("shown")&&o.shown!==s.shown&&o.isLeaf()&&(i[o.objectId]=s.shown),o.isLeaf()&&(s.shown?(a[o.objectId]=o,t.enabledObjects[o.objectId]=o):delete t.enabledObjects[o.objectId],o.clearColorModifiers(),o.clearOpacityModifiers(),o.setProperties(s))}for(var l=0,c=o.length;l<c;l++)o[l].traverseDown(s);Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:i,showSelectedObjects:t.showSelectedObjects}),Human.events.fire("scene.objectPropertiesSet",{instructions:e})},t.onFrame=function(){var e,t,i=!1;for(e=0,t=this.rootObjects.length;e<t;++e)r(this.rootObjects[e],!1)&&(i=!0);if(i){for(this.boundary.xmin=Number.POSITIVE_INFINITY,this.boundary.ymin=Number.POSITIVE_INFINITY,this.boundary.zmin=Number.POSITIVE_INFINITY,this.boundary.xmax=Number.NEGATIVE_INFINITY,this.boundary.ymax=Number.NEGATIVE_INFINITY,this.boundary.zmax=Number.NEGATIVE_INFINITY,e=0,t=this.rootObjects.length;e<t;++e){var a=this.rootObjects[e].getBoundary();this.boundary.xmin=Math.min(this.boundary.xmin,a.xmin),this.boundary.ymin=Math.min(this.boundary.ymin,a.ymin),this.boundary.zmin=Math.min(this.boundary.zmin,a.zmin),this.boundary.xmax=Math.max(this.boundary.xmax,a.xmax),this.boundary.ymax=Math.max(this.boundary.ymax,a.ymax),this.boundary.zmax=Math.max(this.boundary.zmax,a.zmax)}this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)}},t.cull=function(){!function e(t,r,i){var a,n,o=t.bb.min,s=t.bb.max,c=1,u=1;if(r&&(c=Human.math.intersections.planesAabb(r,o,s)),i&&(u=Human.math.intersections.planesAabb(i,o,s)),-1!==u)if(-1!==c)if(1===c&&(r=null),1===u&&(i=null),0===c||0===u)if(t.left)e(t.left,r,i),e(t.right,r,i);else for(a=0,n=t.objects.length;a<n;++a)l(t.objects[a],r,i);else for(a=0,n=t.objects.length;a<n;++a)t.objects[a].frustumCull(!1),t.objects[a].clipCull(!1);else for(a=0,n=t.objects.length;a<n;++a)t.objects[a].frustumCull(!0);else for(a=0,n=t.objects.length;a<n;++a)t.objects[a].clipCull(!0)}(this.getKdTree(),Human.renderer.camera.getFrustum(),Human.renderer.clip.getActiveClips())};var i=["xmin","ymin","zmin"],a=vec3.create(),n=vec3.create(),o=new Array(6),s=[];function l(e,t,r){var i=e.getBoundary();a[0]=i.xmin,a[1]=i.ymin,a[2]=i.zmin,n[0]=i.xmax,n[1]=i.ymax,n[2]=i.zmax;var l=1,c=1,u=!1;if(t&&(l=Human.math.intersections.planesAabb(t,a,n,o)),r){s.length=r.length,c=Human.math.intersections.planesAabb(r,a,n,s);for(var _=0,h=s.length;_<h&&void 0!==s[_];++_)if(0===s[_]&&r[_].fade){u=!0;break}}e.frustumCull(-1===l),e.clipCull(-1===c),-1!==l&&-1!==c&&(e.clipFade(u),e.setVisiblyClipped(0===l&&0===o[Human.renderer.camera.FRUSTUM_NEAR]||0===c))}}(),function(){"use strict";Human.scene.Group=function(e){this.modelId=e.modelId,this.objectId=e.objectId,this.fmaId=e.fmaId,this.layer=e.layer,this.displayName=e.displayName,this.description=e.description,this.parent=e.parent,this.tags=e.tags,this.anonymous=e.anonymous,this.objects=[],this.reflectedX=e.reflectedX||!1,this.reflectedY=e.reflectedY||!1,this.reflectedZ=e.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=e.transformId,this.transformInitialized=!e.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,(e.pivot||e.translate||e.scale||e.rotate)&&this.setTransform(e)},Human.scene.Group.prototype.checkRenderable=function(){for(var e=0,t=this.objects.length;e<t;++e)this.objects[e].checkRenderable()},Human.scene.Group.prototype.isVisible=function(){var e=this.getLeafObjects().length;return this.getShownObjects().length===e&&this.getRenderableObjects().length===e},Human.scene.Group.prototype.isLeaf=function(){return!1},Human.scene.Group.prototype.setTransform=function(e){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),e.pivot&&(void 0!==e.pivot.x&&(this.pivot.x=e.pivot.x),void 0!==e.pivot.y&&(this.pivot.y=e.pivot.y),void 0!==e.pivot.z&&(this.pivot.z=e.pivot.z)),e.translate&&(void 0!==e.translate.x&&(this.translate.x=e.translate.x),void 0!==e.translate.y&&(this.translate.y=e.translate.y),void 0!==e.translate.z&&(this.translate.z=e.translate.z)),e.scale&&(void 0!==e.scale.x&&(this.scale.x=e.scale.x),void 0!==e.scale.y&&(this.scale.y=e.scale.y),void 0!==e.scale.z&&(this.scale.z=e.scale.z),e.scale.x<0&&this.setReflectedX(!0),e.scale.y<0&&this.setReflectedY(!0),e.scale.z<0&&this.setReflectedZ(!0)),e.rotate&&(void 0!==e.rotate.x&&(this.rotate.x=e.rotate.x),void 0!==e.rotate.y&&(this.rotate.y=e.rotate.y),void 0!==e.rotate.z&&(this.rotate.z=e.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var e=mat4.create(),t=mat4.create(),r=mat4.create(),i=mat4.create(),a=mat4.create(),n=mat4.create();Human.scene.Group.prototype.buildMatrix=function(){var o=this.pivot,s=this.translate;mat4.fromTranslation(e,[-o.x,-o.y,-o.z]);var l=this.scale;mat4.fromScaling(t,[l.x,l.y,l.z]),mat4.fromTranslation(r,[s.x+o.x,s.y+o.y,s.z+o.z]);var c=this.rotate;mat4.fromRotation(i,c.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(a,c.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(n,c.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,e,this.localMatrix),mat4.multiply(this.localMatrix,t,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,a,this.localMatrix),mat4.multiply(this.localMatrix,i,this.localMatrix),mat4.multiply(this.localMatrix,r,this.localMatrix),this.matrixDirty=!1},Human.scene.Group.prototype.reflectedTransform=function(){var e=0;return this.reflectedX&&++e,this.reflectedY&&++e,this.reflectedZ&&++e,e%2==1},Human.scene.Group.prototype.getBoundary=function(){return this.boundary},Human.scene.Group.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Group.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Group.prototype.getCenter=function(){return this.center},Human.scene.Group.prototype.setReflectedX=function(e){this.reflectedX=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedX(e)},Human.scene.Group.prototype.setReflectedY=function(e){this.reflectedY=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedY(e)},Human.scene.Group.prototype.setReflectedZ=function(e){this.reflectedZ=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedZ(e)},Human.scene.Group.prototype._removeObject=function(e){for(var t=0,r=this.objects.length;t<r;t++)if(this.objects[t].objectId===e)return void this.objects.splice(t,1)},Human.scene.Group.prototype.isRenderable=function(){for(var e=0,t=this.objects.length;e<t;++e)if(!this.objects[e].isRenderable())return!1;return!0},Human.scene.Group.prototype.isPinnable=function(){for(var e=0,t=this.objects.length;e<t;++e)if(!this.objects[e].isPinnable())return!1;return!0},Human.scene.Group.prototype.getDefaultProperties=function(){return{shown:!1,pickable:!0,backfaces:!1,glassFactor:0,murkiness:1,opacity:1}},Human.scene.Group.prototype.traverseUp=function(e){e(this),this.parent&&this.parent.traverseUp(e)},Human.scene.Group.prototype.traverseDown=function(e){e(this);for(var t=0,r=this.objects.length;t<r;t++)this.objects[t].traverseDown(e)},Human.scene.Group.prototype.getLeafObjects=function(e){var t=[];return this.traverseDown((function(r){r.isLeaf()&&(t.push(r),e&&e(r))})),t},Human.scene.Group.prototype.getRenderableObjects=function(e){var t=[];return this.getLeafObjects((function(r){r.isRenderable()&&(t.push(r),e&&e(r))})),t},Human.scene.Group.prototype.getShownObjects=function(e){var t=[];return this.getLeafObjects((function(r){r.shown&&(t.push(r),e&&e(r))})),t}}(),function(){"use strict";var e=window.ColorFresnel,t=window.ScalarFresnel;function r(r,i){var a=r.constructor.name;return a===i.constructor.name&&("Number"===a||"Boolean"===a?r===i:"Array"===a||"Float32Array"===a?r.reduce((function(e,t,r){return e&&t===i[r]}),!0):"ScalarFresnel"===a?t.prototype.isEqual(r,i):"ColorFresnel"===a&&e.prototype.isEqual(r,i))}function i(r){var i=r.constructor.name;return"Array"===i?r.slice(0):"ColorFresnel"===i?new e(r.center,r.edge,r.centerBias,r.edgeBias,r.power):"ScalarFresnel"===i?new t(r.center,r.edge,r.centerBias,r.edgeBias,r.power):r}Human.scene.Object=function(e){if(this.modelId=e.modelId,this.objectId=e.objectId,this.anonymous=e.anonymous,this.fmaId=e.fmaId,this.layer=parseInt(e.layer,10)||0,this.displayName=e.displayName,this.description=e.description,this.parent=e.parent,this.shown=!1,this.culledByFrustum=!1,this.culledByClip=!1,this.fadeByClip=!1,this.pickable=!0,this.clippable=!0,this.xray=!1,this.opacity=void 0!==e.opacity?e.opacity:1,this.glassFactor=1,this.murkiness=1,this.highlight=!1,this.tintColor=new Float32Array([1,1,1]),this.saturation=0,this.contrast=0,this.brightness=0,this.colorModifiers={},this.colorModifierList=[],this.colorModifierConfigs=[],this.opacityModifiers={},this.opacityModifierConfigs=[],this.backfaces=!1,this.visiblyClipped=!1,this.windingOrder="ccw",this.tags=e.tags,this.objects=[],this.reflectedX=e.reflectedX||!1,this.reflectedY=e.reflectedY||!1,this.reflectedZ=e.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=e.transformId,this.transformInitialized=!e.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,this._rootNode=null,this._renderableRoot=null,this.renderables=[],this.anonymousIdToRenderableIndex=e.anonymousIdToRenderableIndex||{},e.renderables){this.initRenderables();for(var t=0,r=e.renderables.length;t<r;++t)this.addRenderable(e.renderables[t])}(e.geometryId||e.morphId)&&(this.initRenderables(),this.addRenderable(e)),(e.pivot||e.translate||e.scale||e.rotate)&&this.setTransform(e),this._checkFlippedWinding(),this._propertiesNode&&this._propertiesNode.setSolidColor(e.capColor||{r:.7,g:.7,b:.7})},Human.scene.Object.prototype.initRenderables=function(){if(!this._rootNode){this._rootNode=this._transformNode=Human.renderer.graph.createSubtree({type:"xform"});var e=this.getDefaultFlags();this._xrayBackfaces=!1,e.enabled=!1,e.pickable=!0,e.solid=Human.scene.enableSolidObjects,e.layer=this.layer||0,e.name=this.objectId,e.xray=!1,e.highlight=!1,e.opacity=this.opacity,e.glassFactor=this.glassFactor,e.murkiness=this.murkiness,e.xrayEnabled=!0,this._renderableRoot=this._propertiesNode=Human.renderer.graph.insertNode(this._rootNode,{type:"properties",properties:e})}},Human.scene.Object.prototype.addRenderable=function(e){this.renderables.push(new Human.scene.Renderable(this,e))},Human.scene.Object.prototype.detachAsset=function(e){var t,r;switch(e){case"geometry":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachGeometry();break;case"material":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachMaterial();break;case"morph":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachMorph()}},Human.scene.Object.prototype.checkRenderable=function(){this.isRenderable()&&Human.events.fire("scene.objectRenderable",{objectId:this.objectId})},Human.scene.Object.prototype.isRenderable=function(){for(var e=0,t=this.renderables.length;e<t;++e)if(!this.renderables[e].isRenderable())return!1;for(var r=this;r;){if(r.transformId&&!r.transformInitialized)return!1;r=r.parent}return!0},Human.scene.Object.prototype.isVisible=function(){return this.shown&&this.isRenderable()},Human.scene.Object.prototype.isLeaf=function(){return!0},Human.scene.Object.prototype.setTransform=function(e){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),e.pivot&&(void 0!==e.pivot.x&&(this.pivot.x=e.pivot.x),void 0!==e.pivot.y&&(this.pivot.y=e.pivot.y),void 0!==e.pivot.z&&(this.pivot.z=e.pivot.z)),e.translate&&(void 0!==e.translate.x&&(this.translate.x=e.translate.x),void 0!==e.translate.y&&(this.translate.y=e.translate.y),void 0!==e.translate.z&&(this.translate.z=e.translate.z)),e.scale&&(void 0!==e.scale.x&&(this.scale.x=e.scale.x),void 0!==e.scale.y&&(this.scale.y=e.scale.y),void 0!==e.scale.z&&(this.scale.z=e.scale.z),e.scale.x<0&&this.setReflectedX(!0),e.scale.y<0&&this.setReflectedY(!0),e.scale.z<0&&this.setReflectedZ(!0)),e.rotate&&(void 0!==e.rotate.x&&(this.rotate.x=e.rotate.x),void 0!==e.rotate.y&&(this.rotate.y=e.rotate.y),void 0!==e.rotate.z&&(this.rotate.z=e.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var a=mat4.create(),n=mat4.create(),o=mat4.create(),s=mat4.create(),l=mat4.create(),c=mat4.create();Human.scene.Object.prototype.buildMatrix=function(){var e=this.pivot,t=this.translate;mat4.fromTranslation(a,[-e.x,-e.y,-e.z]);var r=this.scale;mat4.fromScaling(n,[r.x,r.y,r.z]),mat4.fromTranslation(o,[t.x+e.x,t.y+e.y,t.z+e.z]);var i=this.rotate;mat4.fromRotation(s,i.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(l,i.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(c,i.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,a,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,c,this.localMatrix),mat4.multiply(this.localMatrix,l,this.localMatrix),mat4.multiply(this.localMatrix,s,this.localMatrix),mat4.multiply(this.localMatrix,o,this.localMatrix),this.matrixDirty=!1},Human.scene.Object.prototype.compileXform=function(){this._transformNode&&(this._transformNode.setElements(this.worldMatrix),this.compileBoundary())},Human.scene.Object.prototype.compileBoundary=function(){Human.scene.kdTreeDirty=!0,Human.renderer.camera.nearFarDirty=!0;var e=this._getBoundary(this.worldMatrix);this.boundary.xmin=e.xmin,this.boundary.ymin=e.ymin,this.boundary.zmin=e.zmin,this.boundary.xmax=e.xmax,this.boundary.ymax=e.ymax,this.boundary.zmax=e.zmax,this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)},Human.scene.Object.prototype.reflectedTransform=function(){var e=0;return this.reflectedX&&++e,this.reflectedY&&++e,this.reflectedZ&&++e,e%2==1},Human.scene.Object.prototype._checkFlippedWinding=function(){if(this._propertiesNode){var e=this.reflectedTransform();this._propertiesNode.setFrontface(e?"ccw"===this.windingOrder?"cw":"ccw":this.windingOrder)}},Human.scene.Object.prototype.getBoundary=function(){return this.boundary},Human.scene.Object.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Object.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Object.prototype.getCenter=function(){return this.center};var u=vec3.create(),_=vec3.create();function h(e,t){e._propertiesNode&&(e.tintColor=t,e.setColorModifier("__TINT_COLOR",{applyTo:"tintColor",value:e.tintColor}))}Human.scene.Object.prototype._getBoundary=function(e){for(var t,r,i,a=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=0,f=this.renderables.length;h<f;++h){var d=this.renderables[h],m=d.boundary;if(d.isRenderable()){if(this._propertiesNode.getSkybox()){var p=Human.renderer.camera.eye;_[0]=p.x,_[1]=p.y,_[2]=p.z}else _[0]=0,_[1]=0,_[2]=0;for(var g=0;g<8;g++)u[0]=1&g?m.xmin:m.xmax,u[1]=2&g?m.ymin:m.ymax,u[2]=4&g?m.zmin:m.zmax,vec3.transformMat4(u,u,e),(t=u[0]-_[0])<a&&(a=t),(r=u[1]-_[1])<n&&(n=r),(i=u[2]-_[2])<o&&(o=i),t>s&&(s=t),r>l&&(l=r),i>c&&(c=i)}}return{xmin:a,ymin:n,zmin:o,xmax:s,ymax:l,zmax:c}},Human.scene.Object.prototype.show=function(e){this.shown!==e&&(this.shown=e,this._propertiesNode&&(m(this),Human.scene.kdTreeDirty=!0,Human.events.fire("scene.object"+(this.shown?"Shown":"Hidden"),{objectId:this.objectId})))},Human.scene.Object.prototype.frustumCull=function(e){this.culledByFrustum!==e&&this._propertiesNode&&(this.culledByFrustum=e,m(this))},Human.scene.Object.prototype.clipCull=function(e){this.culledByClip!==e&&this._propertiesNode&&(this.culledByClip=e,m(this))},Human.scene.Object.prototype.clipFade=function(e){this.fadeByClip!==e&&this._propertiesNode&&(this.fadeByClip=e,this._propertiesNode.setProperties({forceTransparent:e,partiallyOpaque:e}))},Human.scene.Object.prototype.setOpacity=function(e){!1!==e?(e=i(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),r(this.opacity,e)||(this.opacity=e,this._propertiesNode&&this.setOpacityModifier("__OPACITY",{value:this.opacity}))):this.clearOpacityModProperties({opacity:!0})},Human.scene.Object.prototype.setXRay=function(e){this.setXRayColors(e),this.xray=e},Human.scene.Object.prototype.setXRayColors=function(e){this._propertiesNode&&(this._propertiesNode.setProperties({xray:e}),p(this))},Human.scene.Object.prototype.setGlassFactor=function(e){this.glassFactor=e,this._propertiesNode&&this._propertiesNode.setProperties({glassFactor:e})},Human.scene.Object.prototype.setMurkiness=function(e){this.murkiness=e,this._propertiesNode&&this._propertiesNode.setProperties({murkiness:e})},Human.scene.Object.prototype.setPickable=function(e){this.pickable!==e&&(this._propertiesNode&&this._propertiesNode.setPicking(e),this.pickable=e)},Human.scene.Object.prototype.setClippable=function(e){this.clippable!==e&&(this._propertiesNode&&this._propertiesNode.setClipping(e),this.clippable=e)},Human.scene.Object.prototype.setColorModifier=function(e,t){if(this._propertiesNode){var r=!1;if(null===t)delete this.colorModifiers[e],r=!0;else if(this.colorModifiers[e]){var i=this.colorModifiers[e];void 0!==t.applyTo&&(i.params.applyTo=t.applyTo),void 0!==t.value&&(i.params.value=t.value),i.params.range=void 0!==t.range?t.range:null}else this.colorModifiers[e]={priority:Human.scene.colorModPriorities[e]||0,params:{applyTo:t.applyTo,value:t.value,range:t.range||null}},r=!0;r&&y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})}},Human.scene.Object.prototype.clearColorModifiers=function(){this._propertiesNode&&(this.colorModifiers={},y(this),this.tintColor=new Float32Array(f.tintColor.value),this.brightness=f.brightness.value,this.saturation=f.saturation.value,this.contrast=f.contrast.value,this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.clearColorModProperties=function(e){this._propertiesNode&&(e&&!e.tintColor||(delete this.colorModifiers.__TINT_COLOR,this.tintColor=new Float32Array(f.tintColor.value)),e&&!e.brightness||(delete this.colorModifiers.__BRIGHTNESS,this.brightness=f.brightness.value),e&&!e.saturation||(delete this.colorModifiers.__SATURATION,this.saturation=f.saturation.value),e&&!e.contrast||(delete this.colorModifiers.__CONTRAST,this.contrast=f.contrast.value),y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.setOpacityModifier=function(e,t){if(this._propertiesNode){var r=!1;if(null===t)delete this.opacityModifiers[e],r=!0;else if(this.opacityModifiers[e]){var i=this.opacityModifiers[e];void 0!==t.value&&(i.value=t.value),i.range=void 0!==t.range?t.range:null}else this.opacityModifiers[e]={value:t.value,range:t.range||null},r=!0;r&&v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs})}},Human.scene.Object.prototype.clearOpacityModifiers=function(){this._propertiesNode&&(this.opacityModifiers={},this.opacity=f.opacity.value,v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.clearOpacityModProperties=function(e){this._propertiesNode&&(e&&!e.opacity||(delete this.opacityModifiers.__OPACITY,this.opacity=f.opacity.value),v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.colorModPrioritiesDirty=function(){for(var e in this.colorModifiers)this.colorModifiers[e].priority=Human.scene.colorModPriorities[e]||0;y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})},Human.scene.Object.prototype.setHighlight=function(e){if(this._propertiesNode){if(e){var t=Human.renderer.highlightColor;this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:t})}else this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:Human.math.VEC3_ONES});this.highlight=e}},Human.scene.Object.prototype.setTintColor=function(t){var a;!1!==t?(3===arguments.length?a=[arguments[0],arguments[1],arguments[2]]:(a=i(arguments[0]),Array.isArray(a)&&5===a.length&&(a=new e(a))),r(this.tintColor,a)||h(this,a)):this.clearColorModProperties({tintColor:!0})},Human.scene.Object.prototype.setContrast=function(e){!1!==e?(e=i(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.contrast,e)&&(this.contrast=e,this.setColorModifier("__CONTRAST",{applyTo:"contrast",value:this.contrast}))):this.clearColorModProperties({contrast:!0})},Human.scene.Object.prototype.setSaturation=function(e){!1!==e?(e=i(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.saturation,e)&&(this.saturation=e,this.setColorModifier("__SATURATION",{applyTo:"saturation",value:this.saturation}))):this.clearColorModProperties({saturation:!0})},Human.scene.Object.prototype.setBrightness=function(e){!1!==e?(e=i(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.brightness,e)&&(this.brightness=e,this.setColorModifier("__BRIGHTNESS",{applyTo:"brightness",value:this.brightness}))):this.clearColorModProperties({brightness:!0})},Human.scene.Object.prototype.setPartiallyOpaque=function(e){this._propertiesNode&&this._propertiesNode.setProperties({partiallyOpaque:e})},Human.scene.Object.prototype.setBackfaces=function(e){this.backfaces!==e&&(this.backfaces=e,p(this))},Human.scene.Object.prototype.setVisiblyClipped=function(e){this.visiblyClipped!==e&&this.hasRenderObjects()&&(this.visiblyClipped=e,p(this))},Human.scene.Object.prototype.setReflectedX=function(e){this.reflectedX=e,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedY=function(e){this.reflectedY=e,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedZ=function(e){this.reflectedZ=e,this._checkFlippedWinding()},Human.scene.Object.prototype.destroyNodes=function(){this._rootNode&&(Human.renderer.graph.destroySubtree(this._rootNode),this.renderables.length=0,this._rootNode=null)};var f={shown:{setter:Human.scene.Object.prototype.show,value:!1,keyable:!0,type:"boolean"},pickable:{setter:Human.scene.Object.prototype.setPickable,value:!0,keyable:!1,type:"boolean"},backfaces:{setter:Human.scene.Object.prototype.setBackfaces,value:!1,keyable:!1,type:"boolean"},glassFactor:{setter:Human.scene.Object.prototype.setGlassFactor,value:0,keyable:!1,type:"number"},murkiness:{setter:Human.scene.Object.prototype.setMurkiness,value:1,keyable:!1,type:"number"},opacity:{setter:Human.scene.Object.prototype.setOpacity,value:1,keyable:!0,type:"number"},tintColor:{setter:Human.scene.Object.prototype.setTintColor,value:new Float32Array([1,1,1]),keyable:!1,type:"Float32Array"},saturation:{setter:Human.scene.Object.prototype.setSaturation,value:0,keyable:!1,type:"number"},brightness:{setter:Human.scene.Object.prototype.setBrightness,value:0,keyable:!1,type:"number"},contrast:{setter:Human.scene.Object.prototype.setContrast,value:0,keyable:!1,type:"number"}},d=Object.keys(f);function m(e){e._propertiesNode.setEnabled(e.shown&&!e.culledByFrustum&&!e.culledByClip)}function p(e){for(var t=e.renderables,r=0,i=t.length;r<i;++r)t[r].setBackfaces(!1)}function g(e,t){return e.priority-t.priority}function y(e){for(var t in e.colorModifierList.length=0,e.colorModifiers)e.colorModifierList.push(e.colorModifiers[t]);e.colorModifierList.sort(g),e.colorModifierConfigs.length=e.colorModifierList.length;for(var r=0,i=e.colorModifierList.length;r<i;++r)e.colorModifierConfigs[r]=e.colorModifierList[r].params}function v(e){for(var t in e.opacityModifierConfigs.length=0,e.opacityModifiers)e.opacityModifierConfigs.push(e.opacityModifiers[t])}Human.scene.Object.prototype.getDefaultFlags=function(){return{picking:this.pickable,enabled:!1,specular:!0,backfaces:!1,reflection:!0,solid:Human.scene.enableSolidObjects}},Human.scene.Object.prototype.getDefaultProperties=function(){for(var e={},t=0,r=d.length;t<r;t++){var i=d[t];e[i]=f[i].value}return e},Human.scene.Object.prototype.getProperties=function(){for(var e={},t=0,r=d.length;t<r;t++){var i=d[t];e[i]=this[i]}return e},Human.scene.Object.prototype.setProperties=function(e){var t,i,a,n;for(e=e||{},this.clearColorModifiers(),this.clearOpacityModifiers(),a=0,n=d.length;a<n;a++){var o=d[a];t=f[o],r(this[o],i=void 0!==e[o]?e[o]:t.value)||t.setter.call(this,i)}var s,l=Human.scene.colorRecipes.getRecipes();for(a=0;a<l.length;a++)s=l[a],Human.scene.colorRecipes.setObjectRecipe(this.objectId,s,e[s]||!1)},Human.scene.Object.prototype.barycentricToModelSpace=function(e,t,r,i){if(this.renderables.length<=e)return!1;var a=this.renderables[e].getRenderObject();return!!a&&(a.barycentricToCartesian(t,r,i),i)},Human.scene.Object.prototype.barycentricToWorldSpace=function(e,t,r,i){return this.barycentricToModelSpace(e,t,r,i),!!i&&(vec3.transformMat4(i,i,this.getWorldMatrix()),i)},Human.scene.Object.prototype.isPinnable=function(){return this.hasRenderObjects()},Human.scene.Object.prototype.hasRenderObjects=function(){for(var e=0,t=this.renderables.length;e<t;++e)if(!this.renderables[e].getRenderObject())return!1;return!0},Human.scene.Object.prototype.serialize=function(){var i={};for(var a in f)if(!r(f[a].value,this[a])){var n,o=this[a];n=o instanceof t||o instanceof e?JSON.parse(JSON.stringify([o.center,o.edge,o.centerBias,o.edgeBias,o.power])):JSON.parse(JSON.stringify(o)),i[a]=n}return i},Human.scene.Object.prototype.traverseUp=function(e){e(this),this.parent&&this.parent.traverseUp(e)},Human.scene.Object.prototype.traverseDown=function(e){e(this)},Human.scene.Object.prototype.getLeafObjects=function(e){return e&&e(this),[this]}}(),function(){"use strict";var e=0,t=Human.scene.Renderable=function(t,r){this.id=e++,this.object=t,this.rootNode=t._renderableRoot.addNode(),this.geometryId=r.geometryId||null,this.materialId=r.materialId||null,this.morphId=r.morphId||null,this.drawTexture=null,this.geometryAttached=!1,this.materialAttached=!1,this.morphAttached=!1,this.geometryNode=null,this.materialNode=null,this.textureNodes=null,this.fresnelNodes=null,this.reflectionNode=null,this.lightMapNode=null,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.backfaces=!1,this.addBlend=!1,this.layer=r.layer||0};t.prototype.attachAsset=function(e,t){var r=this.isRenderable();this[e+"Attached"]=!0,r!==this.isRenderable()?(this.compileMaterial(),this.compileGeometry(),this.morphAttached&&this.compileMorph(),this.setBackfaces(this.backfaces),this.setAddBlend(this.addBlend),this.setLayer(this.layer),this.object.checkRenderable()):this.isRenderable()&&this.compileMorph(),("morph"===e||"geometry"===e&&!this.morph)&&(this.boundary=t.boundary)},t.prototype.detachGeometry=function(){this.geometryNode&&(this.geometryNode.splice(),this.geometryNode.destroy(),this.geometryNode=null,this.geometryAttached=!1,Human.assets.putAsset(this.geometryId))},t.prototype.detachMaterial=function(){if(this.materialNode&&(this.materialNode.splice(),this.materialNode.destroy(),this.materialNode=null),this.textureNodes){for(var e=0,t=this.textureNodes.length;e<t;++e)this.textureNodes[e].splice(),this.textureNodes[e].destroy();this.textureNodes=null}if(this.fresnelNodes){for(var r in this.fresnelNodes)this.fresnelNodes[r].splice(),this.fresnelNodes[r].destroy();this.fresnelNodes=null}this.reflectionNode&&(this.reflectionNode.splice(),this.reflectionNode.destroy(),this.reflectionNode=null),this.lightMapNode&&(this.lightMapNode.splice(),this.lightMapNode.destroy(),this.lightMapNode=null),this.materialAttached=!1,Human.assets.putAsset(this.materialId)},t.prototype.detachMorph=function(){this.morphNode&&(this.morphNode.splice(),this.morphNode.destroy(),this.morphNode=null,this.morphAttached=!1,Human.assets.putAsset(this.morphId))},t.prototype.disconnectGeometry=function(){this.geometryNode&&(Human.renderer.graph.disconnectNode(this.geometryNode),this.geometryNode=null,this.geometryAttached=!1)},t.prototype.disconnectMaterial=function(){if(this.materialNode&&(Human.renderer.graph.disconnectNode(this.materialNode),this.materialNode=null),this.textureNodes){for(var e=0,t=this.textureNodes.length;e<t;++e)Human.renderer.graph.disconnectNode(this.textureNodes[e]);this.textureNodes=null}if(this.fresnelNodes){for(var r in this.fresnelNodes)Human.renderer.graph.disconnectNode(this.fresnelNodes[r]);this.fresnelNodes=null}this.reflectionNode&&(Human.renderer.graph.disconnectNode(this.reflectionNode),this.reflectionNode=null),this.lightMapNode&&(Human.renderer.graph.disconnectNode(this.lightMapNode),this.lightMapNode=null),this.materialAttached=!1},t.prototype.disconnectMorph=function(){this.morphNode&&(Human.renderer.graph.disconnectNode(this.morphNode),this.morphNode=null,this.morphAttached=!1)},t.prototype.isRenderable=function(){return!(!this.materialAttached||!this.geometryAttached)},t.prototype.getRenderObject=function(){return this.geometryNode?this.geometryNode.getObject():null},t.prototype.isTransparent=function(){var e=this.getRenderObject();return!!e&&e.isTransparent()},t.prototype.setBackfaces=function(e){e=e&&!this.isTransparent(),this.backfaces=e,this.geometryNode&&this.geometryNode.setBackfaces(this.backfaces)},t.prototype.setAddBlend=function(e){this.addBlend=e,this.geometryNode&&this.geometryNode.setAddBlend(this.addBlend)},t.prototype.setLayer=function(e){this.layer=e,this.geometryNode&&this.geometryNode.setLayer(this.layer)},t.prototype.setGeometry=function(e){this.disconnectGeometry(),this.geometryId=e,this.geometryAttached=!0,this.compileGeometry()},t.prototype.setMaterial=function(e){this.disconnectMaterial(),this.materialId=e,this.materialAttached=!0,this.compileMaterial()},t.prototype.attachDrawTexture=function(e){this.drawTexture=Human.renderer.graph.insertNode(this.rootNode,e)},t.prototype.compileGeometry=function(){var e=Human.assets.geometries.geometries[this.geometryId];if(e){this.geometryNode=Human.renderer.graph.insertNode(this.rootNode,{type:"geometry",coreId:e.geometry.getCoreId()});var t=this;this.geometryNode.onObjectCreate=function(e){t.isTransparent()&&t.setBackfaces(t.backfaces),e.sortTieBreaker=t.id},this.object.geoDirty=!0}},t.prototype.compileMaterial=function(){var e=Human.assets.materials.materials[this.materialId];if(e){if(e.textures){var t,r,i=e.textures;for(this.textureNodes=[],t=0,r=i.length;t<r;t++)i[t]&&this.textureNodes.push(Human.renderer.graph.insertNode(this.rootNode,{type:"texture",coreId:i[t].getCoreId()}))}if(e.material&&(this.materialNode=Human.renderer.graph.insertNode(this.rootNode,{type:"material",coreId:e.material.getCoreId()})),e.flags){var a=Human.utils.apply(e.flags,this.object._propertiesNode.getProperties());void 0!==a.frontface&&(this.object.windingOrder=a.frontface),void 0!==a.backfaces&&this.setBackfaces(a.backfaces),void 0!==a.addBlend&&this.setAddBlend(a.addBlend),this.object._propertiesNode.setProperties(a)}if(e.reflection&&(this.reflectionNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:e.reflection.getCoreId()})),e.lightmap&&(this.lightMapNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:e.lightmap.getCoreId()})),e.fresnels){var n=e.fresnels;for(var o in this.fresnelNodes={},n)n.hasOwnProperty(o)&&(this.fresnelNodes[o]=Human.renderer.graph.insertNode(this.rootNode,{type:"fresnel",coreId:n[o].getCoreId()}))}void 0!==e.glassFactor&&this.object.setGlassFactor(e.glassFactor),void 0!==e.murkiness&&this.object.setMurkiness(e.murkiness)}},t.prototype.compileMorph=function(){var e=Human.assets.morphs.morphs[this.morphId];e&&(this.morphNode=Human.renderer.graph.insertNode(this.rootNode,{type:"morphGeometry",coreId:e.morphGeometry.getCoreId()}),this.object.geoDirty=!0)},t.prototype.isAttached=function(){return this.object.renderables.indexOf(this)>-1}}(),function(){"use strict";var e=Human.scene.sets={},t=function(e,t){var r=[null,void 0];return r.indexOf(t)<0?t:r.indexOf(e)<0?e:null},r=function(e,t){return t===e};e.keys=function(e,t){t=t||!1;var r=Object.keys(e),i=[];return t?r.forEach((function(e){t(e)&&i.push(e)})):i=r,i},e.filterKeys=function(t,r){var i;if(r instanceof RegExp)i=r;else try{i=new RegExp(r)}catch(a){return{}}return e.keys(t).filter((function(e){return i.test(e)}))},e.keysWhere=function(e,t){var r=[];for(var i in e)e.hasOwnProperty(i)&&t(e[i])&&r.push(i);return r},e.hasKey=function(t,r){return e.keys(t).indexOf(r)>=0},e.getSetIterator=function(t){var r=0,i=e.keys(t),a=i.length;return{next:function(){if(!this.hasNext())return null;var e=i[r];return r++,{key:e,value:t[e]}},hasNext:function(){return r<a},rewind:function(){return r=0,t[i[0]]},current:function(){return t[i[r]]}}},e.values=function(t){var r=e.keys(t),i=[];return r.forEach((function(e){i.push(t[e])})),i},e.jointKeys=function(t,r){var i={},a=function(e){i[e]=!0},n=e.keys(t),o=e.keys(r);return n.forEach(a),o.forEach(a),e.keys(i)},e.commonKeys=function(t,r){var i={},a=e.keys(t),n=e.keys(r);return a.forEach((function(e){i[e]=1})),n.forEach((function(e){i[e]=(i[e]||0)+1})),e.keysWhere(i,(function(e){return e>1}))},e.uniqueKeys=function(t,r){var i={},a=e.keys(t),n=e.keys(r);return a.forEach((function(e){i[e]=1})),n.forEach((function(e){i[e]=0})),e.keysWhere(i,(function(e){return e>0}))},e.union=function(r,i,a){var n={},o=null;return a||(a=t),e.jointKeys(r,i).forEach((function(e){null!==(o=a(r[e],i[e]))&&(n[e]=o)})),n},e.intersection=function(r,i,a){var n={},o=null;return a||(a=t),e.commonKeys(r,i).forEach((function(e){null!==(o=a(r[e],i[e]))&&(n[e]=o)})),n},e.difference=function(r,i,a){var n=e.uniqueKeys(r,i),o=null;a||(a=t);var s={};return n.forEach((function(e){null!==(o=a(r[e]))&&(s[e]=o)})),s},e.isin=function(t,i,a){a||(a=r);for(var n,o=!1,s=e.getSetIterator(i);s.hasNext()&&!o;)o=a(t,(n=s.next()).key,n.value);return o}}(),function(){"use strict";var e=Human.scene.graph={},t={},r=0,i=0,a=0,n={};function o(e,t){var r=e.objectId,i=e.geometryId||null,a=e.morphId||null,n=e.materialId||null,o=e.transformId||null;if(Human.scene.objects[r])return null;void 0===e.layer&&(e.layer=t?t.layer:0),e.objectId=r,e.parent=t,e.parentObjectId=t?t.objectId:null,e.materialId=n,e.geometryId=i,e.morphId=a,e.transformId=o,e.tags=e.tags||[],e.capColor=function(e,t,r){return r?null!=t[e]?t[e]:r[e]:t[e]}("capColor",e,t),e.modelId=e.objectId.split("-")[0];var s=Human.scene.createObject(e);return void 0!==e.opacity&&s.setOpacity(e.opacity),void 0!==e.shown&&s.show(e.shown),s}function s(e){n.geometryId&&e.detachAsset("geometry"),n.materialId&&e.detachAsset("material"),n.transformId&&e.detachAsset("transform"),n.morphId&&e.detachAsset("morph")}function l(e,t,r){for(var i=0,a=t.length;i<a;i++){var n=t[i];if("transform"===n){var o=e.transformId;o&&!e.transformInitialized&&(r.transform=r.transform||{},(r.transform[o]=r.transform[o]||[]).push(e))}else if(e.renderables)for(var s=0,l=e.renderables.length;s<l;++s){var c=e.renderables[s],u=c[n+"Id"];u&&!c[n+"Attached"]&&(r[n]=r[n]||{},(r[n][u]=r[n][u]||[]).push(c))}}return r}function c(e,a,n,o){0===r&&Human.events.fire("graph.assetAttach.start"),r++,Human.assets.getAsset(e,a,(function(s){if(s)for(var l=0,c=n.length;l<c;l++)if("transform"===a){var u=n[l];Human.scene.objects[u.objectId]&&u.setTransform(s)}else n[l].attachAsset(a,s);(function(e,a,n,o){i++,Human.events.fire("graph.assetAttach.progress",{assetId:e,targetObjects:n,assetType:a,nullAsset:o}),t[a]||(t[a]=[]),o||t[a].push(e),r===i&&(Human.events.fire("graph.assetAttach.finish",t),t={},r=0,i=0)})(e,a,n,!s),o(s)}))}function u(e){if(e.objects&&e.objectId){for(var t,r=0,i=e.objects.length;r<i;++r)if(!e.objects[r].objectId){t=[];break}t&&function e(t){if(!t.objects)return!0;for(var r=0,i=t.objects.length;r<i;++r){var a=t.objects[r];if(a.transformId||a.objectId||a.pivot||a.translate||a.scale||a.rotate||!e(a))return!1}return!0}(e)&&(e.anonymousIdToRenderableIndex={},function e(t,r,i){if(t.objects)for(var n=0,o=t.objects.length;n<o;++n){var s=t.objects[n];void 0===s.layer&&(s.layer=t.layer),s.geometryId?(i.anonymousIdToRenderableIndex[i.objectId+a++]=r.length,r.push({geometryId:s.geometryId,materialId:s.materialId,morphId:s.morphId,layer:s.layer})):(a++,e(s,r,i))}}(e,t,e),e.renderables=t,e.objects.length=0)}}e.buildGraph=function(t,r){if(t){var i,n;r||(a=0);for(var s=0;s<t.length;s++)u(i=t[s]),i.objectId||(i.objectId=r.objectId+a++,i.anonymous=!0),i.group=i.objects&&i.objects.length>0,null!==(n=o(i,r))&&i.objects&&e.buildGraph(i.objects,n)}},e.gatherAssetIdsFromObject=function(e,t,r){Array.isArray(e)||(e=[e]),t=t||["geometry","material","transform","morph"],r=r||{};for(var i=0,a=e.length;i<a;i++)l(e[i],t,r);return r},e.attachAssetsToObject=function(t,r,i){"function"==typeof r&&(i=r,r=null),Array.isArray(t)||(t=[t]),r=r||["geometry","material","transform","morph"];var a=0;function n(){0==--a&&i&&i()}for(var o=0,s=t.length;o<s;o++){var l=e.gatherAssetIdsFromObject(t[o],r);a++,e.attachAssets(l,n)}},e.attachAssetSetsToSubtree=function(t,r,i){"function"==typeof r&&(i=r,r=null),Array.isArray(t)||(t=[t]),r=r||[["geometry","material","transform"],["morph"]];var a,n,o={},s=[],l={};function c(e){l[e.objectId]=e}function u(e){o[e.objectId]||(s.push(e),o[e.objectId]=!0)}for(var _=0;_<t.length;_++)t[_].getLeafObjects(c);for(a in l)l.hasOwnProperty(a)&&(n=l[a])&&n.traverseUp(u);!function t(r,i,a,n){var o=i.shift();!function(t,r,i){var a=t.length;if(0!==a)for(var n=0,o=a;n<o;n++)e.attachAssetsToObject(t[n],r,s);else i&&Human.utils.async(i);function s(){0==--a&&i&&i()}}(r,o,(function(){if(n){for(var e={},s=0,l=o.length;s<l;s++)e[o[s]]=!0;n(e,a,!i.length)}i.length&&t(r,i,a+1,n)}))}(s,r,0,i)},e.attachAssets=function(e,t){var r=0;function i(){0==--r&&t&&t()}var a=Object.keys(e);if(0!==a.length)for(var n=0,o=a.length;n<o;n++){var s=a[n],l=e[s];if(l)for(var u in l)l.hasOwnProperty(u)&&(r++,c(u,s,l[u],i))}else t&&Human.utils.async(t)},e.destroySubtree=function(e){var t,r;for(Array.isArray(e)||(e=[e]),t=0,r=e.length;t<r;t++)Human.scene.destroyObject(e[t].objectId)},e.unloadSubtree=function(e,t,r){var i,a;for(Array.isArray(e)||(e=[e]),n={},t.indexOf("geometries")>=0&&(n.geometryId=!0),t.indexOf("transforms")>=0&&(n.transformId=!0),t.indexOf("morphs")>=0&&(n.morphId=!0),t.indexOf("materials")>=0&&(n.materialId=!0),t.indexOf("morph")>=0&&(n.morphId=!0),i=0,a=e.length;i<a;i++)e[i].getLeafObjects(s);r&&r()}}(),function(){"use strict";var e=Human.scene.markers={},t=0,r=0;e.markers={};var i={},a=!1,n=vec3.fromValues(.33,.33,.33),o=vec3.create(),s=vec3.create(),l=mat4.create(),c=vec3.create(),u=function(e){var r,o;if(this.id=e.id||(r="marker_"+t,t++,r),this.pos=vec3.create(),this.viewPos=vec3.create(),this.dir=vec3.create(),e.pos&&(this.pos[0]=e.pos[0],this.pos[1]=e.pos[1],this.pos[2]=e.pos[2]),e.dir&&(this.dir[0]=e.dir[0],this.dir[1]=e.dir[1],this.dir[2]=e.dir[2],vec3.normalize(this.dir,this.dir)),this.viewAngle=0,this.canvasPos=vec2.fromValues(0,0),this.built=!1,this.occluded=!1,this.objectCentered=!1,this.renderableIndex=-1,this.primitiveIndex=-1,this.barycentric=null,e.objectId&&Human.scene.objects[e.objectId]){if(this.object=Human.scene.objects[e.objectId],this.modelPos=vec3.create(),void 0!==e.primitiveIndex){this.renderableIndex=void 0!==e.renderableIndex?e.renderableIndex:0,this.primitiveIndex=e.primitiveIndex;var s=e.barycentric||n;this.barycentric=vec3.fromValues(s[0],s[1],s[2])}else e.pos||(this.objectCentered=!0);this.object.isRenderable()?this.build():(i[o=e.objectId]?i[o].push(this):i[o]=[this],a=!0)}else{if(!e.pos)return void Human.log.error("Human.scene.marker","marker configuration requires 'objectId' or 'pos' parameter.");this.build()}};u.prototype.build=function(){if(!this.built){if(-1!==this.primitiveIndex)this.object.barycentricToModelSpace(this.renderableIndex,this.primitiveIndex,this.barycentric,this.modelPos),vec3.transformMat4(this.pos,this.modelPos,this.object.getWorldMatrix());else if(this.object&&!this.objectCentered)mat4.invert(l,this.object.getWorldMatrix()),vec3.transformMat4(this.modelPos,this.pos,l);else if(this.objectCentered){var e=this.object.getCenter();this.pos[0]=e[0],this.pos[1]=e[1],this.pos[2]=e[2],mat4.invert(l,this.object.getWorldMatrix()),vec3.transformMat4(this.modelPos,this.pos,l)}this.updatePosition(),this.updateViewAngle(),this.updateOcclusion(),this.built=!0}},u.prototype.updatePosition=function(){-1!==this.primitiveIndex&&this.object.barycentricToModelSpace(this.renderableIndex,this.primitiveIndex,this.barycentric,this.modelPos),this.modelPos&&vec3.transformMat4(this.pos,this.modelPos,this.object.getWorldMatrix()),vec3.transformMat4(this.viewPos,this.pos,Human.renderer.getViewMat()),Human.renderer.worldPositionToCanvas(this.pos,this.canvasPos)},u.prototype.updateViewAngle=function(){if(this.objectCentered)this.viewAngle=0;else{var e=Human.renderer.camera.eye;c.set([e.x,e.y,e.z]),vec3.subtract(o,c,this.pos),vec3.normalize(o,o);var t=Math.min(vec3.dot(o,this.dir),1);this.viewAngle=57.2957795*Math.acos(t)}},u.prototype.updateOcclusion=function(){this.occluded=this.isOccludedByObject()||this.isOffScreen()},u.prototype.isOccludedByObject=function(){return!this.objectCentered&&(e=Human.renderer.camera.eye,o[0]=e.x,o[1]=e.y,o[2]=e.z,vec3.sub(s,this.pos,o),t=vec3.length(s),r=Math.min(.1*t,.5),s[0]*=i=1/t,s[1]*=i,s[2]*=i,!!((a=Human.math.intersections.rayScene(o,s,(function(e){return e.shown&&!e.culled}),(function(e){return!e.isTransparent()})))&&a.length&&a[0].t+r<t));var e,t,r,i,a},u.prototype.isOffScreen=function(){var e=this.canvasPos,t=Human.renderer.canvas.width,r=Human.renderer.canvas.height;return e[0]<0||e[0]>t||e[1]<0||e[1]>r},e.create=function(t){var r=new u(t);return e.markers[r.id]=r,Human.events.fire("scene.markers.added",{id:r.id}),r.built&&Human.events.fire("scene.markers.built",{id:[r.id]}),r},e.delete=function(t){delete e.markers[t],Human.events.fire("scene.markers.deleted",{id:t})},e.buildByObjectId=function(e){var t=[];if(i[e]){var r,a;for(r=0;r<i[e].length;r++)(a=i[e][r]).build(),t.push(a.id);delete i[e]}Human.events.fire("scene.markers.built",{id:t})},e.onFrame=function(){var t;r=(r+1)%2,a&&function(){var e,t,r,n,o=0;for(e in i)if(++o,n=i[e],(t=Human.scene.objects[e])&&t.isVisible()){for(r=0;r<n.length;r++)n[r].build();delete i[e],--o}a=o>0}();var n=0;for(var o in e.markers)(t=e.markers[o])&&t.built&&(t.updatePosition(),t.updateViewAngle(),0===r&&t.updateOcclusion(),++n);n>0&&Human.events.fire("scene.markers.updated")}}(),function(){"use strict";var e=Human.scene.colorRecipes={},t=window.ColorFresnel,r=window.ScalarFresnel,i=16,a=8,n=4,o=2,s=1,l={};function c(e){var t=0,r=[];return e.colorMods.forEach((function(e){"tintColor"===e.applyTo?(t+=i,e.value.forEach((function(e){r.push(e)}))):"saturation"===e.applyTo?(t+=a,r.push(e.value[0])):"contrast"===e.applyTo?(t+=n,r.push(e.value[0])):"brightness"===e.applyTo&&(t+=o,r.push(e.value[0]))})),e.opacityMods.forEach((function(e){"opacity"===e.applyTo&&(t+=s,r.push(e.value[0]))})),{channels:t,mods:r}}function u(e,t){return e+"_"+t}e.createConfigFromMods=function(e){return c(e)},e.getRecipes=function(){return Object.keys(l)},e.getRecipeMods=function(e){return l.hasOwnProperty(e)?Human.utils.shallowClone(l[e]):void Human.log.error("Human.scene.color-recipes","No such color recipe : "+e)},e.registerRecipe=function(e,c){l.hasOwnProperty(e)?Human.log.error("Human.scene.color-recipes","Color mod recipe already exists : "+e):l[e]=function(e){var l=e.channels,c=e.mods,u=e.fresnelChannels,_=e.fresnelMods,h=[],f=[],d=0;if(null!=l&&(l&i&&h.push({applyTo:"tintColor",value:c.slice(d,d+=3)}),l&a&&h.push({applyTo:"saturation",value:c.slice(d,d+=1)[0]}),l&n&&h.push({applyTo:"contrast",value:c.slice(d,d+=1)[0]}),l&o&&h.push({applyTo:"brightness",value:c.slice(d,d+=1)[0]}),l&s&&f.push({applyTo:"opacity",value:c.slice(d,d+=1)[0]})),d=0,null!=u){if(u&i){var m=_.slice(d,d+=9);h.push({applyTo:"tintColor",value:new t([m[0],m[1],m[2]],[m[3],m[4],m[5]],m[6],m[7],m[8])})}if(u&a){var p=_.slice(d,d+=5);h.push({applyTo:"saturation",value:new r(p[0],p[1],p[2],p[3],p[4])})}if(u&n){var g=_.slice(d,d+=5);h.push({applyTo:"contrast",value:new r(g[0],g[1],g[2],g[3],g[4])})}if(u&o){var y=_.slice(d,d+=5);h.push({applyTo:"brightness",value:new r(y[0],y[1],y[2],y[3],y[4])})}if(u&s){var v=_.slice(d,d+=5);f.push({applyTo:"opacity",value:new r(v[0],v[1],v[2],v[3],v[4])})}}return{colorMods:h,opacityMods:f}}(c)},e.clearRecipes=function(){l={}},e.removeRecipe=function(e){delete l[e]},e.setObjectRecipe=function(e,t,r){var i,a,n,o=Human.scene.objects[e],s=l[t];if(o&&s){for(i=0;i<s.colorMods.length;i++)n=u(t,(a=s.colorMods[i]).applyTo),o.setColorModifier(n,r?a:null);for(i=0;i<s.opacityMods.length;i++)n=u(t,(a=s.opacityMods[i]).applyTo),r?o.setOpacityModifier(n,a):!r&&o.opacityModifiers[n]&&o.setOpacityModifier(n,null)}},e.hasTarget=function(e,t){var r=Human.scene.objects[t];if(r&&l[e]){var i=Object.keys(r.colorModifiers).reduce((function(t,r){return t||r.startsWith(e)}),!1);return Object.keys(r.opacityModifiers).reduce((function(t,r){return t||r.startsWith(e)}),i)}},e.serializeRecipe=function(t){return c(e.getRecipeMods(t))}}(),function(){"use strict";var e,t,r,i,a=Human.timeline={objectVisibilityUpdates:{}};a.animations={},a.leafTimelines={},a.branchTimelines={},a.rootTimelines={},a.activeRoot=null,a.FRAME_LENGTH=.033,a.TIME_CONSTANT=.001,a.borderConditions={start:{which:"second",direction:a.direction},middle:{which:"both",direction:a.direction},end:{which:"first",direction:a.direction}},a.playing=!1,a.playfree=!0,a._lastWorldTime=0,a._time1=0,a._time2=0,a._freeTime=0,a.time=0,a.playQueue=[],a.loop=!1,a.scale=1,a.direction="forwards",a._playParams=null,a._scrubParams=null,a.chapters={},a.addAnimation=function(e,t){t.update?(a.animations[e]&&a.removeAnimation(e),a.animations[e]=t,Human.events.fire("Timeline.Loaded")):Human.log.error("Human.timeline.addAnimation","Param expected: update")},a.removeAnimation=function(e){var t=a.animations[e];t?(delete a.animations[e],t.destroy&&t.destroy(),Human.utils.isEmpty(a.animations)&&Human.events.fire("Timeline.Empty")):Human.log.warn("Human.timeline.removeAnimation","Animation not found: "+e)};var n=function(){return"forwards"===a.direction?a._time1:a._time2};a.initTransparencies=function(){Human.log.error("timeline.initTransparencies() is deprecated and no longer required for loading")},a.onFrame=function(){if(null!=(e=a.activeRoot)){if(t=(new Date).getTime(),r=(t-a._lastWorldTime)*a.TIME_CONSTANT/a.FRAME_LENGTH,a._lastWorldTime=t,a.time>a._time2?a.time=a._time2:a.time<a._time1&&(a.time=a._time1),a.playfree&&(e.updateFreeAnimations(a._freeTime),a._freeTime+=a.scale*r*a.FRAME_LENGTH),a.playing){i=a.borderConditions.middle;var o=!0;a.time===("forwards"===a.direction?a._time2:a._time1)?!0===a.loop?(i=a.borderConditions.start,a.time=n()):(i=a.borderConditions.end,o=!1):(s=n(),a.time===s&&(i=a.borderConditions.start)),e.update(a.time,i),o?(a.playing=!0,Human.events.fire("timeline.playing",{time:a.time}),a.time+=a.scale*r*a.FRAME_LENGTH):(Human.events.fire("timeline.completed"),a.playing=!1,Human.events.fire("timeline.stopped",{time:a.time}))}var s;Human.renderer.camera.fly.onFrame(),Human.utils.isEmpty(a.objectVisibilityUpdates)||(Human.scene.setEnabledObjects({objectIds:a.objectVisibilityUpdates,replace:!1}),a.objectVisibilityUpdates={})}},Human.events.on("timeline.stopped",(function(){a.playQueue.shift(),a.playQueue.length>0?a._play(a.playQueue[0]):Human.events.fire("timeline.paused",{time:Human.timeline.time})})),a.parsePlayInstruction=function(e){var t,r,i,n,s,l,c=(e=e||{}).root||a.activeRoot,u="forwards";c.getTimeFrame();var _=null,h=null,f=null,d=!e.hasOwnProperty("align")||e.align,m=null,p=!1;switch(a._playParams=e,t=o(["nextChapter","prevChapter","startChapterId","startTime"],e)[0]||"default",r=o(["nextChapter","prevChapter","finishChapterId","finishTime","numChapters"],e)[0]||"default",t){case"nextChapter":n=0,i=c.getNeighborChapter(c._nowBranch,"next");break;case"prevChapter":n=0,i=c.getNeighborChapter(c._nowBranch,"previous");break;case"startChapterId":if(n=0,i=c.getBranch({id:e.startChapterId}),Human.utils.isEmpty(i))return void Human.log.warn("timeline.play","Invalid chapter id: "+e.startChapterId);break;case"startTime":i=(m=c.mapGlobalTime(e.startTime,{tie:"later"})).branch,n=m.time;break;case"default":i=c._chapters[0],n=0}switch(r){case"nextChapter":case"prevChapter":l=(s=i).getTimeFrame().lastTime;break;case"finishChapterId":if(s=c.getBranch({id:e.finishChapterId}),Human.utils.isEmpty(s))return void Human.log.warn("timeline.play","Invalid chapter id: "+e.finishChapterId);l=s.getTimeFrame().lastTime;break;case"finishTime":0===e.finishTime?(s=c._chapters[0],l=0):(s=(m=c.mapGlobalTime(e.finishTime,{tie:"earlier"})).branch,l=m.time);break;case"numChapters":var g=c.whereIsBranch(i,{chapters:!0}),y=e.numChapters||1;y=Math.min(y,c._chapters.length-g),l=(s=c._chapters[g+y-1]).getTimeFrame().lastTime;break;case"default":s=c._chapters[c._chapters.length-1],l="end"}return(_=c.mapBranchTime(i,n))<=(h=c.mapBranchTime(s,l))?(u="forwards",f=_):(m=_,_=h,f=h=m,u="backwards"),d&&("forwards"===u?(_=c.mapBranchTime(i,0),h=c.mapBranchTime(s,"end")):"backwards"===u&&(_=c.mapBranchTime(s,0),h=c.mapBranchTime(i,"end"))),e.hasOwnProperty("loop")?p=e.loop:["startChapterId","nextChapter","prevChapter"].indexOf(t)>=0&&["numChapters","nextChapter","finishChapterId"].indexOf(r)>=0&&i.id===s.id&&(p=i.animation.loop),{t:f,t1:_,t2:h,loop:p,direction:u}},a.play=function(e){(e=e||{}).queue&&a.playing?a.playQueue.push(e):(a.playQueue=[e],a._play(e))},a._play=function(e){var t=a.parsePlayInstruction(e||{});a._time1=t.t1,a._time2=t.t2,a.time=t.t,a.loop=t.loop,function(e){var t={},r="backwards"===e?-1:1;if(["forwards","backwards"].indexOf(e)<0)return Human.log.warn("timeline.setBorderConditions","invalid direction :"+e),null;t.start={which:"second",direction:e},t.middle={which:"both",direction:e},t.end={which:"first",direction:e},a.direction=e,a.borderConditions=t,a.scale=r*Math.abs(a.scale)}(t.direction),a.playing=!0,a._lastWorldTime=(new Date).getTime(),Human.events.fire("timeline.played",{time:a.time})};var o=function(e,t){var r=Object.keys(t);return e.filter((function(e){return r.indexOf(e)>=0}))};a.stop=function(){a.playing=!1,a.playQueue=[],Human.events.fire("timeline.stopped",{time:a.time})},a.scrub=function(e){var t,r=a.activeRoot,i=0,n={which:"first",direction:"forwards"};if(a.playQueue=[],a._scrubParams=e,e.hasOwnProperty("time"))i=e.time;else if(e.hasOwnProperty("chapterId")){var o=r.getBranch({id:e.chapterId});o?(i=r.mapBranchTime(o,0),n={which:"second",direction:"forwards"}):i=a.time}else i=a.time;if(e.hasOwnProperty("borderCondition")){var s=e.borderCondition;["first","both","second"].indexOf(s.which)>=0&&(n.which=s.which),["forwards","backwards"].indexOf(s.direction)>=0&&(n.direction=s.direction)}0===i?n={which:"second",direction:"forwards"}:i===r.getTimeFrame.lastTime&&(n={which:"first",direction:"forwards"}),(i<a._time1||i>a._time2)&&(t=r.mapGlobalTime(i,n),a._time1=r.mapBranchTime(t.branch,0),a._time2=r.mapBranchTime(t.branch,"end")),a.playing=!1,a.time=i,r.update(i,n),Human.events.fire("timeline.scrubbed",{time:a.time})},a.next=function(){var e=a.activeRoot,t=Human.properties.properties["timeline.prevNextMode"],r=e._nowBranch,i=e.getNeighborChapter(r,"next");if(e.isLast(r))Human.log.warn("timeline.next","can't proceed beyond last chapter");else{var n,o=e.mapBranchTime(r,"end")+.001;"play"===t?(n=i.animation.loop?{startTime:e.mapBranchTime(i,0),align:!0,finishTime:e.mapBranchTime(i,"end"),loop:i.animation.loop,queue:!1}:{startTime:a.time,align:!1,finishTime:o,loop:!1,queue:!1},a.play(n)):a.scrub({time:o})}},a.prev=function(){var e=a.activeRoot,t=Human.properties.properties["timeline.prevNextMode"],r=e._nowBranch;if(e.isFirst(r))Human.log.warn("timeline.next","can't go to chapter before first chapter");else{var i,n=e.getNeighborChapter(r,"previous"),o=e.mapBranchTime(n,"start")+.001;"play"===t?(i=r.animation.loop?{startTime:e.mapBranchTime(n,"start"),align:!0,finishTime:e.mapBranchTime(n,"end"),loop:n.animation.loop,queue:!1}:{startTime:e.mapBranchTime(n,"end"),align:!1,finishTime:e.mapBranchTime(n,"start"),loop:!1,queue:!1},a.play(i)):a.scrub({time:o})}},a.getBookmark=function(){var e={};return Human.timeline.activeRoot&&(e.rootName=Human.timeline.activeRoot.id),a.playing?(e.play=a._playParams,e.play.root&&delete e.play.root):e.scrub=a._scrubParams,e},a.setBookmark=function(e){if(e.rootName&&a.rootTimelines.hasOwnProperty(e.rootName))a.activeRoot=a.rootTimelines[e.rootName];else if(e.modules&&e.modules.activeModules){var t=e.modules.activeModules;(t=t.filter((function(e){return Human.timeline.rootTimelines.hasOwnProperty(e)}))).length>1&&(t=t.filter((function(e){return!Human.modules.isBaseModule(e)}))),Human.timeline.activeRoot=Human.timeline.rootTimelines[t[0]]}else Human.log.warn("Human.timeline.setBookmark: Unable to set appropriate root timeline")},a.pause=function(){a.playing=!1,Human.events.fire("timeline.paused",{time:a.time})},a.unpause=function(){a.play({startTime:a.time,numChapters:1,loop:a.loop}),Human.events.fire("timeline.unpaused",{time:a.time})},a.playFreeAnimations=function(){a.playfree=!0},a.pauseFreeAnimations=function(){a.playfree=!1},a.getTimeFrame=function(){return Human.utils.isEmpty(a.activeRoot)?0:a.activeRoot.getTimeFrame()},a.getCurrentChapterCamera=function(){return Human.timeline.activeRoot._nowBranch.getCamera(0)},a._convertPlayParams=function(e){var t=e;return e.hasOwnProperty("endTime")&&(t.finishTime=t.endTime),e.hasOwnProperty("endChapterId")&&(t.finishChapterId=e.endChapterId),t},a.query=function(){return a.activeRoot?{chapters:a.activeRoot._assembleQueryChapters(),time:a.time,timeFrame:a.getTimeFrame(),playing:a.playing,paused:!a.playing}:{}},a.destroyChapterSet=function(e){if(a.stop(),a.rootTimelines.hasOwnProperty(e))a.rootTimelines[e].destroy();else if(e)for(var t in a.rootTimelines)a.rootTimelines.hasOwnProperty(t)&&(Human.modules.isBaseModule(t)||a.rootTimelines[t].destroy());else Human.log.warn("timeline.destoryChapterSet","Invalid argument: "+e)},Human.events.on("timeline.chapters.updated",(function(e){var t=0;if(a.chapters={},null!==a.activeRoot)for(t=0;t<e.length;t++)a.chapters[a.activeRoot._chapters[t].id]=e[t]}))}(),function(){"use strict";Human.timeline.TweenAnimation=function(e){var t;this._options=e.options||{},this._tweens=e.tweens,this.timeline=e.timeline,this.firstTime=1e6,this.lastTime=-1e6;for(var r=0,i=this._tweens.length;r<i;r++)(t=this._tweens[r]).firstTime<this.firstTime&&(this.firstTime=t.firstTime),t.lastTime>this.lastTime&&(this.lastTime=t.lastTime)},Human.timeline.TweenAnimation.prototype.update=function(e,t){for(var r=0,i=this._tweens.length;r<i;r++)this._tweens[r].update(e,t)},Human.timeline.TweenAnimation.prototype.destroy=function(){for(var e,t=0,r=this._tweens.length;t<r;t++)(e=this._tweens[t]).destroy&&e.destroy()}}(),function(){"use strict";function e(e){for(var t in e)if(e.hasOwnProperty(t)&&!Human.utils.isObject(e[t]))return!1;return!0}Human.timeline.Tween=function(t){this._control=t.control,this._tweenList=[];for(var r,i,a,n,o,s={},l=0,c=t.targets.length;l<c;l++)for(var u in r=t.targets[l],i=t.keys[l],Human.utils.isObject(r.attr)&&e(r.attr)&&(r=r.attr),a=r)a.hasOwnProperty(u)&&(n=a[u],(o=s[u])||(o=new Human.timeline.TweenAttr(this._control.attr[u],t.options),s[u]=o,this._tweenList.push(o)),o.addTarget(i,n));this.firstTime=t.keys[0],this.lastTime=t.keys[t.keys.length-1]},Human.timeline.Tween.prototype._run=function(e,t){for(var r=0,i=this._tweenList,a=0,n=i.length;a<n;a++)i[a].update(e,t)&&r++;return r},Human.timeline.Tween.prototype.query=function(e,t){return this._run(e,t),this._control.attr},Human.timeline.Tween.prototype.update=function(e,t){this._run(e,t)>0&&this._control.update(e)}}(),function(){"use strict";function e(e,t,r,i){"number"!=typeof r&&(r=r.value);var a=e.controlPoints,n=Math.floor(50*(t-i));e.bezier=new Human.math.bezier(i,r,a.x[0],a.y[0],a.x[1],a.y[1],t,e.value),e.lookUp=e.bezier.getLUT(n)}function t(e,t,r,i,a){return i+(e-t)/(r-t)*(a-i)}function r(e,r){var i,a,n,o=r.lookUp,s=0,l=o.length-1;if(e<=o[s].x)return o[s].y;if(e>=o[l].x)return o[l].y;for(;s<=l;){if(n=o[(i=Math.floor((s+l)/2))+1],(a=o[i]).x<=e&&n.x>=e)return t(e,a.x,n.x,a.y,n.y);a.x>e?l=i-1:s=i+1}}Human.timeline.TweenAttr=function(e,t){this.attr=e,this.attrNames=null,t=t||{},this.keys=[],this.attrTargetLists={},this._tweens=[],this._key1=0,this._key2=1,this._firstKey=null,this._lastKey=null,this._keyDiff=null,this._loop=!!t.loop,this._timeOffset=t.timeOffset||0,this._paddingDirty=!0},Human.timeline.TweenAttr.prototype.addTarget=function(t,r){this.keys.push(t+=this._timeOffset);var i,a,n,o,s,l=this.keys.length-1;for(var c in r)if(r.hasOwnProperty(c)){if(!(i=this.attrTargetLists[c])){if(this.keys.length>1)throw"First target in tween must contain a value for each animated attribute on target";i=this.attrTargetLists[c]=[]}if(i[l]=n=r[c],"number"!=typeof n&&e(n,t,i[l-1],this.keys[l-1]),l>0)for(a=!1,o=l-1;!a&&o>=0;)void 0===(s=i[o])&&null===s?(i[o]=n,o--):a=!0}(null===this._firstKey||this._firstKey>t)&&(this._firstKey=t),(null===this._lastKey||this._lastKey<t)&&(this._lastKey=t),this._keyDiff=this._lastKey-this._firstKey,this._paddingDirty=!1},Human.timeline.TweenAttr.prototype._padTargets=function(){var e,t,r,i=this.attrTargetLists,a=this.keys.length;for(e in i)if(i.hasOwnProperty(e)){if((t=i[e]).length===a)continue;for(r=t[t.length-1];t.length<a;)t.push(r)}this._paddingDirty=!1},Human.timeline.TweenAttr.prototype.update=function(e,i){this._paddingDirty&&this._padTargets();var a=this.keys,n=this.attrNames?this.attrNames:this.attrNames=Object.keys(this.attrTargetLists);if(this._loop)i=this._firstKey+i%this._keyDiff;else{if(i<a[0])return this._key1=0,this._key2=1,this._clampToTarget(n,0),!0;if(i>a[a.length-1])return this._key1=a.length-2,this._key2=this._key1+1,this._clampToTarget(n,this.keys.length-1),!0}for(;a[this._key1]>i;)this._key1--,this._key2--;for(;a[this._key2]<i;)this._key1++,this._key2++;var o,s,l,c,u,_,h=this.attrTargetLists,f=this._key1,d=this._key2,m=this.attr,p=!1;for(c=0,u=n.length;c<u;c++)"number"!=typeof(s=(o=h[_=n[c]])[f])&&(s=s.value),l="number"==typeof o[d]?t(i,a[f],a[d],s,o[d]):r(i,o[d]),m[_]=l,p=!0;return p},Human.timeline.TweenAttr.prototype._clampToTarget=function(e,t){var r,i,a,n,o=this.attr,s=this.attrTargetLists;for(i=0,a=e.length;i<a;i++)"number"!=typeof(r=s[n=e[i]][t])&&(r=r.value),o[n]=r}}(),function(){"use strict";Human.timeline.Switch=function(e){this._keys=e.keys,this._targets=e.targets,this._control=e.control,this._options=e.options||{},this._key=0,this._lastKey=null,this.firstTime=e.keys[0],this.lastTime=e.keys[e.keys.length-1]},Human.timeline.Switch.prototype.query=function(e,t){return this._findTarget(t),this._targets[this._key]},Human.timeline.Switch.prototype.update=function(e,t){switch(this._findTarget(t)){case 1:return}this._control.attr=this._targets[this._key],this._control.update(e),this._lastKey=this._key},Human.timeline.Switch.prototype._findTarget=function(e){if(e<this._keys[0])return this._key=0,1;if(e===this._keys[0])return this._key=0,2;if(e>this._keys[this._keys.length-1])return this._key=this._keys.length-1,3;for(;this._keys[this._key]>e;)this._key--;for(;null!=this._keys[this._key+1]&&this._keys[this._key+1]<e;)this._key++;return 4}}(),function(){"use strict";Human.timeline.CameraControl=function(){this.attr={up:{x:0,y:1,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0}}},Human.timeline.CameraControl.prototype.update=function(e){if(!1!==e.cameraEnabled)return Human.renderer.camera.setLookAt(this.attr),!0}}(),function(){"use strict";Human.timeline.MaterialControl=function(e){var t;this._materialId=e.modelId+"/"+e.materialId,this.attr={},e.attributes.hasOwnProperty("attr")&&(e.attributes=e.attributes.attr);var r={r:0,g:0,b:0,a:1},i={r:1,g:1,b:1},a={r:0,g:0,b:0},n={float:1};for(t in e.attributes)e.attributes.hasOwnProperty(t)&&("baseColor"===t?this.attr.baseColor=r:"specularColor"===t?this.attr.specularColor=i:"emitColor"===t?this.attr.emitColor=a:"alphaColor"===t&&(this.attr.alphaColor=n))},Human.timeline.MaterialControl.prototype.update=function(){var e=Human.assets.materials.materials[this._materialId];if(e){if(e.material){var t=e.material,r=this.attr;return r.baseColor&&t.setBaseColor(r.baseColor),r.specularColor&&t.setSpecularColor(r.specularColor),r.emitColor&&t.setEmitColor(r.emitColor),r.alphaColor&&t.setAlpha(r.alphaColor.float),!0}}else this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.ObjectControl=function(e){for(var t=null,r=0,i=(t=e.objectId?[e.objectId]:e.objectIds).length;r<i;++r){var a=t[r];a.indexOf(".")<0&&a.indexOf("-")<0&&(t[r]=e.modelId+"-"+a)}this._objectIds=t,this.id=e.id,this.attr={attr:{},tnt:{},cst:{},sat:{},brt:{},o:{}}},Human.timeline.ObjectControl.prototype.update=function(){for(var e=0,t=this._objectIds.length;e<t;++e){var i=this._objectIds[e],a=Human.scene.objects[i];if(!a)return void(this._targetMissing||(Human.log.warn("Human.timeline.TweenAnimation","'lerp:objectAttr' tween can't find object: "+i),this._targetMissing=!0));var n=Human.timeline.activeRoot._nowBranch.synchronization[i];n&&!1===n.shown||r(a,this.attr,this.id)}};var e={applyTo:null,value:0,range:null},t={value:0,range:null};function r(i,a,n){var o=a.attr,s=a.tnt,l=a.cst,c=a.sat,u=a.brt,_=a.o;if(o&&(void 0!==o.pickable&&i.setPickable(o.pickable),void 0!==o.opacity&&i.setOpacity(o.opacity),void 0!==o.shown&&(Human.timeline.objectVisibilityUpdates[i.objectId]=o.shown)),_&&void 0!==_.val&&(t.value=_.val,void 0!==_.x&&(t.range={center:[_.x,_.y,_.z],minRadius:_.rmin,maxRadius:_.rmax}),i.setOpacityModifier("__OPACITY_TWEEN_"+n,t)),s&&void 0!==s.r&&(e.applyTo="tintColor",e.value=[s.r,s.g,s.b],void 0!==s.x&&(e.range={center:[s.x,s.y,s.z],minRadius:s.rmin,maxRadius:s.rmax}),i.setColorModifier("__TINT_COLOR_TWEEN_"+n,e)),l&&void 0!==l.val&&(e.applyTo="contrast",e.value=l.val,void 0!==l.x&&(e.range={center:[l.x,l.y,l.z],minRadius:l.rmin,maxRadius:l.rmax}),i.setColorModifier("_CONTRAST_TWEEN_"+n,e)),c&&void 0!==c.val&&(e.applyTo="saturation",e.value=c.val,void 0!==c.x&&(e.range={center:[c.x,c.y,c.z],minRadius:c.rmin,maxRadius:c.rmax}),i.setColorModifier("__SATURATION_TWEEN_"+n,e)),u&&void 0!==u.val&&(e.applyTo="brightness",e.value=u.val,void 0!==u.x&&(e.range={center:[u.x,u.y,u.z],minRadius:u.rmin,maxRadius:u.rmax}),i.setColorModifier("__BRIGHTNESS_TWEEN_"+n,e)),i.objects.length>0)for(var h=i.objects,f=0,d=h.length;f<d;f++)r(h[f],a,n)}}(),function(){"use strict";Human.timeline.ObjectTransformControl=function(e){var t=e.objectId,r=e.initial;t.indexOf(".")<0&&t.indexOf("-")<0&&(t=e.modelId+"-"+e.objectId),this._objectId=t;var i=this.attr={};["translate","rotate","scale","pivot"].forEach((function(e){var t="scale"===e?1:0;void 0!==r[e]&&(i[e]={},void 0!==r[e].x&&(i[e].x=t),void 0!==r[e].y&&(i[e].y=t),void 0!==r[e].z&&(i[e].z=t))}))},Human.timeline.ObjectTransformControl.prototype.update=function(){var e=Human.scene.objects[this._objectId];e?e.setTransform(this.attr):this._targetMissing||(Human.log.warn("Human.timeline.ObjectTransformControl","Can't find object: "+this._objectId),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.TextureControl=function(e){this._material=e.modelId+"/"+e.materialId,null!=e.targetLayer?(this._targetLayer=e.targetLayer,this.attr={rotate:{z:0},translate:{x:0,y:0},scale:{x:1,y:1},blend:{factor:1}}):Human.log.error("Human.timeline.TweenAnimation","'texture' tween attribute expected: 'targetLayer'")},Human.timeline.TextureControl.prototype.update=function(){var e=Human.assets.materials.materials[this._material];if(e){var t=e.textures;if(this._targetLayer>=0&&this._targetLayer<t.length){var r=t[this._targetLayer],i=this.attr;i.scale&&r.setScale(i.scale),i.translate&&r.setTranslate(i.translate),null!=i.rotate&&r.setRotate(i.rotate.z),null!=i.blend&&r.setBlendFactor(i.blend.factor)}}else this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._material),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.FresnelControl=function(e){this._materialId=e.modelId+"/"+e.materialId,this._fresnelType=e.fresnelType,"baseFresnel"===this._fresnelType&&(this._fresnelType="colorFresnel"),this.attr={bias:{edge:0,center:.7,power:1},edge:{r:.8,g:.7,b:.7},center:{r:.05,g:.05,b:.09}}},Human.timeline.FresnelControl.prototype.update=function(){if(!this._fresnel){var e=Human.assets.materials.materials[this._materialId];if(!e)return void(this._materialMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._materialMissing=!0));var t=this._fresnelType.length<=7?this._fresnelType:this._fresnelType.substring(0,this._fresnelType.length-7);if(this._fresnel=e.fresnels[t],!this._fresnel)return void(this._fresnelMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find fresnel type: "+this._fresnelType),this._fresnelMissing=!0))}var r=this.attr.bias;return this._fresnel.setEdgeBias(r.edge),this._fresnel.setCenterBias(r.center),this._fresnel.setPower(r.power),this._fresnel.setEdgeColor(this.attr.edge),this._fresnel.setCenterColor(this.attr.center),!0}}(),function(){"use strict";Human.timeline.tweenParticleLookup=function(e){var t=Human.timeline.activeRoot._nowBranch.id,r=Object.keys(Human.modules.moduleData),i=Human.modules.moduleData[r[r.length-1]].tweenParticleLookup,a=void 0===i?e:i[t][e],n=Human.timeline.activeRoot._nowBranch.id+"/"+a;return Human.particles.systems[a]||Human.particles.systems[n]}}(),function(){"use strict";Human.timeline.ParticleSystemControl=function(e){this.particleSystemId=e.particleSystemId,this.attr={attr:{}},this._targetMissing=!1},Human.timeline.ParticleSystemControl.prototype.update=function(){var e=Human.timeline.tweenParticleLookup(this.particleSystemId);if(e){var t=this.attr.attr;e.enabled&&t&&(void 0!==t.emissionAverage&&(e.emissionAverage=t.emissionAverage),void 0!==t.emissionVariance&&(e.emissionVariance=t.emissionVariance))}else this._targetMissing||(Human.log.warn("ParticleSystemControl: can't find system: ",this.particleSystemId),this._targetMissing=!0)}}(),function(){"use strict";var e=vec3.create(),t=vec3.create();Human.timeline.ParticleComponentControl=function(e){this.particleSystemId=e.particleSystemId,this.componentId=e.componentId,this.attr={attr:{},position:{},translate:{},scale:{},rotate:{},directionAverage:{},shapeTranslate:{},shapeScale:{},shapeRotate:{}},this._targetMissing=!1},Human.timeline.ParticleComponentControl.prototype.update=function(){var r=Human.timeline.tweenParticleLookup(this.particleSystemId);if(r){var i=r.components[this.componentId];if(i){var a=i.shape;if(r.enabled){var n=this.attr.attr,o=this.attr.position,s=this.attr.translate,l=this.attr.scale,c=this.attr.rotate,u=this.attr.directionAverage,_=this.attr.shapeTranslate,h=this.attr.shapeRotate,f=this.attr.shapeScale;if(n&&(void 0!==n.average&&(i.average=n.average),void 0!==n.variance&&(i.variance=n.variance),void 0!==n.forceAverage&&(i.forceAverage=n.forceAverage),void 0!==n.forceVariance&&(i.forceVariance=n.forceVariance),void 0!==n.frequency&&(i.frequency=n.frequency),void 0!==n.friction&&(i.friction=1-n.friction),void 0!==n.radius&&(i.radius=n.radius),void 0!==n.directionVariance&&(i.directionVariance=n.directionVariance)),o&&void 0!==o.x&&(e[0]=o.x,e[1]=o.y,e[2]=o.z,i.position.set(e)),s&&void 0!==s.x&&(e[0]=s.x,e[1]=s.y,e[2]=s.z,i.translate.set(e)),(l||c)&&i.xform){var d=null,m=null;l&&void 0!==l.x&&((d=e)[0]=l.x,d[1]=l.y,d[2]=l.z),c&&void 0!==c.x&&((m=t)[0]=c.x,m[1]=c.y,m[2]=c.z),Human.math.buildRotationScaleMat3(i.xform,m,d)}u&&void 0!==u.x&&(e[0]=u.x,e[1]=u.y,e[2]=u.z,vec3.normalize(i.directionAverage,e)),a&&(_&&void 0!==_.x&&(e[0]=_.x,e[1]=_.y,e[2]=_.z,a.translate.set(e)),h&&void 0!==h.x&&(e[0]=h.x,e[1]=h.y,e[2]=h.z,a.rotate.set(e)),f&&void 0!==f.x&&(e[0]=f.x,e[1]=f.y,e[2]=f.z,a.scale.set(e)),a.updateXform())}}else this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find component: "+this.componentId),this._targetMissing=!0)}else this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find system: ",this.particleSystemId),this._targetMissing=!0)}}(),function(){"use strict";var e=Human.timeline.LeafTimeline=function(e,t){t=t||{},this.level="leaf",this.id=e,this.animations={},this.timelineAnimations={},this.freeAnimations={},this.cameraTween=null,this.animationCtx={cameraEnabled:!0},Human.timeline.leafTimelines[this.id]=this};e.prototype.addAnimation=function(e,t){if(t)if(t.update){if(this.animations[e]&&this.removeAnimation(e),this.animations[e]=t,!1===t.timeline?this.freeAnimations[e]=t:this.timelineAnimations[e]=t,!this.cameraTween){var r,i,a,n=!1,o=t._tweens||[],s=Human.timeline.CameraControl;for(r=0,i=o.length;r<i&&!n;r++)(a=o[r])._control&&a._control instanceof s&&(n=!0,this.cameraTween=a)}Human.events.fire("Timeline.Loaded")}else Human.log.error("LeafTimeline.addAnimation","Param expected: update");else Human.log.error("LeafTimeline.addAnimation","null or undefined animation object")},e.prototype.removeAnimation=function(e){var t=this.animations[e];t?(e in this.freeAnimations?delete this.freeAnimations[e]:delete this.timelineAnimations[e],delete this.animations[e],t.destroy&&t.destroy()):Human.log.warn("Human.timeline.LeafTimeline.removeAnimation","Animation not found: "+e)},e.prototype.getTimeFrame=function(){var e=0,t=this.timelineAnimations;for(var r in t)t.hasOwnProperty(r)&&(e=Math.max(e,t[r].lastTime));return{firstTime:0,lastTime:e}},e.prototype.update=function(e,t,r){r=r||{};var i,a={cameraEnabled:!1===e?e:this.animationCtx.cameraEnabled},n=this.timelineAnimations;for(var o in n)n.hasOwnProperty(o)&&("lerp:camera"===(i=n[o]).type?i.update(t):i.update(a,t))},e.prototype.destroy=function(){this.animations={},this.freeAnimations={},this.timelineAnimations={},this.cameraTween=null,delete Human.timeline.leafTimelines[this.id]},e.prototype.unload=function(e){var t,r="tweens"===e?Human.timeline.TweenAnimation:Human.assets.morphs.Animation;for(t in this.animations)this.animations.hasOwnProperty(t)&&this.animations[t]instanceof r&&(delete this.animations[t],Human.timeline.removeAnimation(t))},e.prototype.getCamera=function(e){return null==this.cameraTween?null:this.cameraTween.query(this.cameraTween._control,e)}}(),function(){"use strict";var e=Human.timeline.BranchTimeline=function(e){var t=this;for(var r in t._onEndOptions=["loop","freeze"],t.level="branch",t.timeRange=null,t.id=e.id,t.maps={},e.timelineMap.forEach((function(e,r){t.makeMapComponent(e,r)})),t.media={},e.media)e.media.hasOwnProperty(r)&&t.addClip(r,e.media[r]);t.info={displayName:e.displayName||"",description:e.description||""},t.synchronization=e.synchronization,t.properties=e.properties||{},t.annotations=e.annotations||[],t.hotspots=e.hotspots||[],"alphaToCoverage"===e.transparencyMode&&(e.transparencyMode=null),t.transparencyMode=e.transparencyMode||"alpha","weightedOIT"!==t.transparencyMode||SceneJS.WEBGL_INFO.floatTexturesSupported||(t.transparencyMode=e.fallbackTransparency||"alpha"),t.viewModes=e.viewModes||{},t.options=e.options||{},e.hasOwnProperty("xray")&&(t.viewModes.xray=e.xray),t.camera={},e.camera?t.camera=e.camera:(e.jumpTo?(t.camera.action="jumpTo",t.camera.location=e.jumpTo,e.jumpTo.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.jumpTo.screenPan),e.jumpTo.hasOwnProperty("rotationCenter")&&(t.camera.rotationCenter=e.jumpTo.rotationCenter)):e.flyTo&&(t.camera.action="flyTo",t.camera.location=e.flyTo,e.flyTo.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.flyTo.screenPan),e.flyTo.hasOwnProperty("rotationCenter")&&(t.camera.rotationCenter=e.flyTo.rotationCenter)),e.options&&e.options.screenPan?t.camera.screenPan=e.options.screenPan:e.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.screenPan)),t.animation={loop:!1},e.loop&&(t.animation.loop=!0),t.background=e.background||{},t.clippingPlanes=e.clippingPlanes||{},t.effects=e.effects,t.ui=e.ui||{},t.lights=e.lights;var i=e.environment||e;i.reflectionMap&&i.reflectionMap.length>0&&(t.reflection=i.reflectionMap[0]),i.lightMap&&i.lightMap.length>0&&(t.lightmap=i.lightMap[0]),t.graph=e.graph||{},t.firstUpdate=!0,t.initializedCamera=!1,t.initializedAnnotations=!1,t.initializedProperties=!1,t.initializedGraph=!1,t.initializedHotspots=!1,t.initializedParticles=!1,t.initializedClippingPlanes=!1,t.initializedPostprocess=!1,t.initializedTransparencyMode=!1,t.customData=e.customData||{},t.particleSystems=t.customData.particleSystems||[],t.ssaa=!!t.customData.ssaa,t.postprocess=t.customData.postprocess||[],window.localContentOnly&&t.postprocess.push({effect:"fxaa"}),t.translations=t.translations||{},Human.timeline.branchTimelines[t.id]=t};e.prototype.addClip=function(e,t){this.media.hasOwnProperty(e)&&delete this.media[e],this.media[e]={data:t,published:!1,publish:function(){Human.events.fire(t.streamType+".suggestedClipInfo",this.data),Human.events.fire(t.streamType+".suggestedClips",[this.data.clipId],!0),this.published=!0},update:function(e){this.data.time1<=e&&e<=this.data.time2&&(this.published||this.publish())}}},e.prototype.makeMapComponent=function(e,t){var r,i,a={};if(a.mapId=e.data.timeline+"_"+t,a.start=e.start,a.end=e.end,a.data=e.data,Human.timeline.leafTimelines.hasOwnProperty(e.data.timeline))a.data.timeline=Human.timeline.leafTimelines[e.data.timeline];else{var n=new Human.timeline.LeafTimeline(e.data.timeline);a.data.timeline=n}a.data.fit?(r=(a.data.end-a.data.start)/(a.end-a.start),i=a.data.start,a.calcChildTime=function(e){return r*(e-a.start)+i}):(r=1,i=a.data.start,"freeze"===a.data.onEnd?a.calcChildTime=function(e){return Math.min(r*(e-a.start)+i,a.data.end)}:"loop"===a.data.onEnd?a.calcChildTime=function(e){var t=a.data.end-a.data.start,r=e-a.start;return r-t*Math.floor(r/t)+i}:Human.log.warn("WARNING: invalid onEnd property for branch timeline map data.")),this.maps[a.mapId]=a,this.timeRange=this.getTimeFrame()},e.prototype._getAudio=function(){var e=[];for(var t in this.media)this.media.hasOwnProperty(t)&&"audio"===this.media[t].data.streamType&&e.push(this.media[t].data);return e},e.prototype.getTimeFrame=function(){var e=0;for(var t in this.maps)this.maps.hasOwnProperty(t)&&this.maps[t].end>e&&(e=this.maps[t].end);return 0===e&&(e=2),{firstTime:0,lastTime:e}},e.prototype.getCamera=function(e){"end"===e?e=this.getTimeFrame().lastTime:"start"===e&&(e=0);var t=this.getAnimatedCamera(e);if(t)return t.screenPan=t.screenPan||this.options.screenPan,t;if(!Human.utils.isEmpty(this.camera))return(t=this.camera.location).screenPan=this.options.screenPan,t;var r=Human.renderer.camera._startcamera;return r.screenPan=this.options.screenPan,r},e.prototype.getAnimatedCamera=function(e){var t=this.getTimeFrame();"start"===e||e<t.startTime?e=t.startTime:("end"===e||"last"===e||e>t.lastTime)&&(e=t.lastTime);var r=this.whichCameraMap(0);if(null==r)return null;if(!(e>=r.start&&e<=r.end))return null;var i=r.data.timeline,a=r.calcChildTime(e),n=i.getCamera(a);return null!=n?n:void 0},e.prototype.whichCameraMap=function(e){var t,r=this.whichMaps(e);for(t=0;t<r.length;t++)if(r[t].map.data.timeline.cameraTween)return r[t].map;return null},e.prototype.reset=function(){this.firstUpdate=!0,this.initializedGraph=!1,this.initializedCamera=!1,this.initializedHotspots=!1,this.initializedProperties=!1,this.initializedAnnotations=!1,this.initializedParticles=!1,this.initializedClippingPlanes=!1,this.initializedPostprocess=!1,this.initializedTransparencyMode=!1;var e,t=this.media;for(e in t)t.hasOwnProperty(e)&&(t[e].published=!1)},e.prototype.whichMaps=function(e){var t=this,r=[],i=[];for(var a in"start"===e?e=0:"end"===e&&(e=t.getTimeFrame().lastTime),t.maps)if(t.maps.hasOwnProperty(a)){var n=t.maps[a];e>=n.start&&e<=n.end&&r.push(a)}return r.every((function(e){var r=t.maps[e],a={map:r};return"leaf"===r.data.timeline.level?(a.camera=!0,i.push(a)):(a.camera=!1,i.unshift(a)),!0})),i},e.prototype.getChildLeafTimelines=function(e){var t=this.whichMaps(e),r={};return t.every((function(t){var i=t.map.data.timeline.id,a=t.map.calcChildTime(e);return r[i]=a,!0})),r},e.prototype.getUniqueLeafTimelines=function(){var e={};for(var t in this.maps)if(this.maps.hasOwnProperty(t)){var r=this.maps[t];e[r.data.timeline.id]=r.data.timeline}return e},e.prototype.initCamera=function(e,t){var r=this,i=r.whichCameraMap(e);i||r.camera.ignore?i?"flyTo"===r.camera.action?Human.renderer.camera.fly.flyTo(r.getCamera(e),(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):Human.renderer.camera.fly.jumpTo(r.getCamera(e),(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):t&&t():(r.camera.screenPan&&Human.renderer.camera.setScreenPan(r.camera.screenPan),"flyTo"===r.camera.action?Human.renderer.camera.fly.flyTo(r.camera.location,(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):Human.renderer.camera.fly.jumpTo(r.camera.location,(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})))},e.prototype.initAnnotations=function(e){var t=this;Human.view&&(Human.view.annotations.clearAnnotations(),e.forEach((function(e,r){var i="___"+t.id+"."+r;if(!e.pos&&e.objectId){var a=Human.scene.objects[e.objectId];a&&(e.pos=a.getCenter())}e.annotationId=i,e.title=e.title||"",e.description=e.description||"",e.dir=e.pinVec||e.dir,e.type=e.type||"default",e.enabled="secondary"!==e.type,e.shown="secondary"!==e.type,e.labelShown="secondary"!==e.type,e.labelOffset=e.labelOffset||null,e.saved=!0,Human.view.annotations.createAnnotation(e)})))},e.prototype.initGraph=function(e){Human.scene.setObjectProperties(e)},e.prototype.initProperties=function(){Human.renderer.lights.clearEnabled(),Human.renderer.lights.setEnabled(unpackChapterLights(this.lights));var e=Human.renderer.getScene();e.deactivateReflection(),this.reflection&&e.activateReflection(this.reflection),e.deactivateLightmap(),this.lightmap&&e.activateLightmap(this.lightmap),Human.view&&Human.view.setViewModes(this.viewModes),Human.properties.applyDefaults(),Human.properties.set(this.properties)},e.prototype.initParticles=function(){for(var e=0,t=this.particleSystems.length;e<t;++e)Human.particles.enable(this.particleSystems[e])},e.prototype.initClippingPlanes=function(){var e;for(e in Human.renderer.clip.reset(),this.clippingPlanes.clips)if(this.clippingPlanes.clips.hasOwnProperty(e)){var t=Human.utils.shallowClone(this.clippingPlanes.clips[e]);t.boundary=this.clippingPlanes.boundary,Human.renderer.clip.setClip(t)}},e.prototype.initPostprocess=function(){Human.renderer.postprocess.parse(this.postprocess)},e.prototype.initTransparencyMode=function(){Human.renderer.setTransparencyMode(this.transparencyMode)},e.prototype.init=function(e,t,r){Human.events.fire("timeline.chapters.activate.start",{chapterId:this.id,params:t}),this.timeRange=this.getTimeFrame(),t.camera&&!this.initializedCamera&&(this.initializedCamera=!0,this.initCamera(e,t.cameraCallback||function(){})),t.graph&&!this.initializedGraph&&(this.initializedGraph=!0,this.initGraph(this.synchronization)),t.properties&&!this.initializedProperties&&(this.initializedProperties=!0,this.initProperties()),t.particles&&!this.initializedParticles&&(Human.particles.disableAll(),Human.particles.resetAll(),this.initializedParticles=!0,this.initParticles()),t.clipping&&!this.initializedClippingPlanes&&(this.initializedClippingPlanes=!0,this.initClippingPlanes()),t.postprocess&&!this.initializedPostprocess&&(this.initializedPostprocess=!0,this.initPostprocess()),t.transparencyMode&&!this.initializedTransparencyMode&&(this.initializedTransparencyMode=!0,this.initTransparencyMode()),this.ssaa?Human.renderer.getResolutionScalingSupported()&&Human.renderer.setResolutionScaling(2):Human.renderer.setResolutionScaling(1),Human.events.fire("timeline.chapters.initializing",{chapterId:this.id,params:t}),r&&r(),Human.events.fire("timeline.chapters.activate.finish",{chapterId:this.id})},e.prototype.uninit=function(e,t){Human.events.fire("timeline.chapter.deactivate.start"),this.initGraph({}),this.initAnnotations([]),t&&t(),Human.events.fire("timeline.chapter.deactivate.finish")},e.prototype.update=function(e,t,r){t=t||{},this.firstUpdate&&(this.firstUpdate=!1,t.hasOwnProperty("camera")||(t.camera=!this.initializedCamera),t.hasOwnProperty("annotations")||(t.annotations=!this.initializedAnnotations),t.hasOwnProperty("properties")||(t.properties=!this.initializedProperties),t.hasOwnProperty("graph")||(t.graph=!this.initializedGraph),t.hasOwnProperty("particles")||(t.particles=!this.initializedParticles),t.hasOwnProperty("clipping")||(t.clipping=!this.initializedClippingPlanes),t.hasOwnProperty("postprocess")||(t.postprocess=!this.initializedPostprocess),t.hasOwnProperty("transparencyMode")||(t.transparencyMode=!this.initializedTransparencyMode),this.init(e,t,(function(){}))),this._update2(e),r&&r()},e.prototype._update2=function(e){null==this.timeRange&&(this.timeRange=this.getTimeFrame());var t=this.timeRange;"start"===e||e<t.startTime?e=t.startTime:("end"===e||"last"===e||e>t.lastTime)&&(e=t.lastTime);var r=this.whichMaps(e);for(var i in r.forEach((function(t){var r=t.map,i=t.camera,a=r.data.timeline,n=r.calcChildTime(e);return a.update(i,n),!0})),this.media)this.media.hasOwnProperty(i)&&this.media[i].update(e)},e.prototype.destroy=function(){var e=this.getUniqueLeafTimelines();for(var t in e)e.hasOwnProperty(t)&&"dummy"!==t&&e[t].destroy();delete Human.timeline.branchTimelines[this.id]}}(),function(){"use strict";var e=Human.timeline.RootTimeline=function(e,t){t=t||{},this.id=e,this.level="root",this.animationOptions={},this._theQueue=[],this._chapters=[],this._times=[],this._timeFrame=null,this.freeAnimations={},this._firstUpdate=!0,this._prevBranch=null,this._prevTime=null,this._nowBranch=null,this._nowTime=null};e.prototype.setAnimationOptions=function(e,t){t=t||{},e.animation&&(this.animationOptions=e.animation)},e.prototype.addChapter=function(e,t){var r=!(t=t||{}).hasOwnProperty("rebuild")||t.rebuild,i=t.position||this._chapters.length;(i<0||i>this._chapters.length)&&Human.log.warn("RootTimeline.addChapter(): Invalid index "+i+"position"),this._chapters.splice(i,0,e),r&&this.build()},e.prototype.activate=function(e,t,r){Human.timeline.activeRoot=this;var i=this.mapGlobalTime(e,{which:"second",direction:"forwards"});Human.events.fire("timeline.chapters.updated",this._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:this._timeFrame.firstTime,lastTime:this._timeFrame.lastTime}),Human.timeline.stop(),i.branch.init(i.time,t,(function(){})),Human.timeline.activeRoot.update(e,{which:"second",direction:"forwards"}),Human.timeline.time=e,Human.timeline._time1=e,Human.timeline._time2=e,Human.timeline._freeTime=e,r()},e.prototype.deactivate=function(e,t){null!==Human.timeline.activeRoot&&Human.timeline.activeRoot.id===this.id&&(Human.events.fire("timeline.chapters.updated",[]),Human.events.fire("timeline.timeFrame.updated",{firstTime:0,lastTime:0}),Human.timeline.activeRoot=null,Human.timeline.stop(),Human.timeline.time=0,Human.timeline._time1=0,Human.timeline._time2=0,Human.timeline._freeTime=0,this._nowBranch.uninit(e,t))},e.prototype.getDescendentLeaves=function(){var e={};return this._chapters.forEach((function(t){var r=t.getChildLeafTimelines(0);for(var i in r)r.hasOwnProperty(i)&&(e.hasOwnProperty(i)||(e[i]=Human.timeline.leafTimelines[i]))})),e},e.prototype.getTimeFrame=function(e){e=e||{};var t=0;return this._chapters.forEach((function(e){t+=e.getTimeFrame().lastTime})),{firstTime:0,lastTime:t}},e.prototype.whereIsBranch=function(e,t){var r,i=0,a=!1,n=null;for(r=!0===(t=t||{}).chapters?this._chapters:this._theQueue;!a&&i<r.length;)(a=r[i].id===e.id)?n=i:i++;return n},e.prototype.getBranch=function(e){e=e||{};var t,r,i=!1,a=0,n={};if(Human.utils.isEmpty(e))return null;for(Object.keys(e).length>1&&Human.log.warn("timeline.RootTimeline.getBranch","too many parameters, using only the first."),r=e[t=Object.keys(e)[0]];!i&&a<this._theQueue.length;)n=this._theQueue[a],this._theQueue[a][t]===r&&(i=!0),a++;return i?n:null},e.prototype.mapGlobalTime=function(e,t){t=t||{},"end"===e?e=this.getTimeFrame().lastTime:"start"===e&&(e=0),e<0?e=0:e>this.getTimeFrame().lastTime&&(e=this.getTimeFrame().lastTime);var r="earlier";t.tie?r=t.tie:t.which&&t.direction&&("forwards"===t.direction?r="second"===t.which?"later":"earlier":"backwards"===t.direction&&(r="first"===t.which?"later":"earlier"));var i={branch:null,time:null,index:null},a=this._times.indexOf(e);if(a>=0){var n="later"!==r?a-1:a;i.branch=this._theQueue[n=(n=n<0?this._theQueue.length-1:n)>=this._times.length-1?0:n],i.time="later"!==r?e-this._times[n]:0,i.index=n}else{var o=Human.utils.binarySearch(this._times,e);i.branch=this._theQueue[o.index1],i.time=e-o.value1,i.index=o.index1}return i},e.prototype.mapBranchTime=function(e,t,r){r=r||{};var i=this.whereIsBranch(e);return"end"===t?t=e.getTimeFrame().lastTime:"start"===t&&(t=0),null===i?null:this._times[i]+t},e.prototype.getNeighborChapter=function(e,t,r){r=r||{};var i,a=null;if(t="previous"===t?"previous":"next",e instanceof Human.timeline.BranchTimeline)a=e;else{if("number"!=typeof e)return Human.log.warn("timeline.root.getNeighborChapter","invalid 'now' argument :"+JSON.stringify(e)),null;a=this.mapGlobalTime(e,{tie:"later"===r.tie?"later":"earlier"})}if(0===(i=this.whereIsBranch(a))&&"previous"===t)return null;if(i===this._theQueue.length-1&&"next"===t)return null;var n=i;return"next"===t?n++:n--,this._theQueue[n]},e.prototype.isFirst=function(e){return e.id===this._theQueue[0].id},e.prototype.isLast=function(e){return e.id===this._theQueue[this._theQueue.length-1].id},e.prototype.buildFreeAnimations=function(e){e=e||{};var t=this.getDescendentLeaves();for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].freeAnimations;for(var a in i)i.hasOwnProperty(a)&&!this.freeAnimations.hasOwnProperty(a)&&(this.freeAnimations[a]=i[a])}},e.prototype.buildQueue=function(e){var t=this;e=e||{},t._theQueue=[];var r=0;t._times=[r],t._chapters.forEach((function(e){r+=e.getTimeFrame().lastTime,t._theQueue.push(e),t._times.push(r)}))},e.prototype.build=function(e){e=e||{},this._theQueue=[],this._times=[],this.buildFreeAnimations(),this.buildQueue(),Human.timeline.rootTimelines[this.id]&&delete Human.timeline.rootTimelines[this.id],Human.timeline.rootTimelines[this.id]=this,this._timeFrame=this.getTimeFrame(),null===this._nowBranch?(this._nowBranch=this._theQueue[0],this._nowTime=0,this._prevBranch=this._nowBranch,this._prevTime=0):null===this.whereIsBranch(this._nowBranch)&&(this._nowBranch=this._theQueue[0],this._nowTime=0,null===this._prevBranch?(this._prevBranch=this._nowBranch,this._prevTime=this._nowTime):null===this.whereIsBranch(this._prevBranch)&&(this._prevBranch=this._nowBranch,this._prevTime=this._nowTime)),Human.events.fire("timeline.chapters.updated",this._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:this._timeFrame.firstTime,lastTime:this._timeFrame.lastTime})},e.prototype.destroy=function(){this._theQueue.forEach((function(e){Human.timeline.branchTimelines.hasOwnProperty(e.id)&&e.destroy()})),Human.timeline.rootTimelines.hasOwnProperty(this.id)&&delete Human.timeline.rootTimelines[this.id]},e.prototype.updateFreeAnimations=function(e){for(var t in this.freeAnimations)this.freeAnimations.hasOwnProperty(t)&&this.freeAnimations[t].update({cameraEnabled:!1},e);for(var r=this._nowBranch.particleSystems,i=0,a=r.length;i<a;++i)Human.particles.update(r[i],e)},e.prototype.update=function(e,t,r){var i=this,a={},n=[];"function"!=typeof r&&(r=function(){}),a={which:"both",direction:"forwards"},(t=t||{}).hasOwnProperty("which")&&(a.which=t.which),t.hasOwnProperty("direction")&&(a.direction=t.direction),e<0?(e=0,Human.log.warn("Time violates lower bound. Updating to time = 0.0")):e>i._timeFrame.lastTime&&(e=i._timeFrame.lastTime,Human.log.warn("Time violates upper bound. Updating to time = "+e)),n=i._getBranchesToUpdate(e,a),i._firstUpdate&&(i._nowBranch=n[0].branch,i._nowTime=n[0].time,i._firstUpdate=!1);var o=!1;n.forEach((function(e){i._prevBranch=i._nowBranch,i._prevTime=i._nowTime,o=e.branch.firstUpdate,i._nowBranch=e.branch,i._nowTime=e.time,e.branch.update(e.time,{},r),o&&Human.events.fire("timeline.chapters.activated",i._assembleChaptersActivated())})),i._prevBranch.id!==i._nowBranch.id&&i._prevBranch.reset()},e.prototype._getBranchesToUpdate=function(e,t){return this._times.indexOf(e)>=0?this._getBorderBranches(e,t):[this.mapGlobalTime(e,{tie:"earlier"})]},e.prototype._getBorderBranches=function(e,t){var r=this.mapGlobalTime(e,{tie:"earlier"}),i=this.mapGlobalTime(e,{tie:"later"}),a=[r,i];return"backwards"===t.direction&&(a=[i,r]),"first"===t.which?a.splice(1,1):"second"===t.which&&a.splice(0,1),a},e.prototype._assembleChaptersUpdated=function(){var e,t,r,i,a=[],n=this._chapters;for(e=0,t=n.length;e<t;e++)i={chapterId:(r=n[e]).id,time:this.mapBranchTime(r,0),duration:r.getTimeFrame().lastTime,displayName:r.info.displayName,description:r.info.description,loop:r.animation.loop,index:e},a.push(i);return a},e.prototype._assembleChaptersActivated=function(){var e={};return e.oldChapterIndex=this.whereIsBranch(this._prevBranch,{chapters:!0}),e.newChapterIndex=this.whereIsBranch(this._nowBranch,{chapters:!0}),e.time=this.mapBranchTime(this._nowBranch,this._nowTime),e.loop=this._nowBranch.animation.loop||!1,e.branchID=this._nowBranch.id,e},e.prototype._assembleQueryChapters=function(){var e,t,r,i=[],a=this._chapters;for(e=0,t=a.length;e<t;e++)i.push({chapterId:(r=a[e]).id,time:this.mapBranchTime(r,0),displayName:r.info.displayName,description:r.info.description,type:"branch",tags:r.tags||[],annotations:r.annotations,hotspots:null,flyTo:r.camera.location,active:this._nowBranch.id===r.id,sounds:r._getAudio(),translations:r.translations||null});return i}}(),function(){"use strict";var e=0,t=Human.particles={creators:{},updaters:{},constraints:{},shapes:{},systems:{}},r={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};function i(r,i){var a=r.id||"ps"+e++,n=r.numParticles,o={properties:r.properties,material:r.material,textures:r.textures,spriteRows:r.spriteRows||0,spriteCols:r.spriteCols||0,spriteStartFrame:r.spriteStartFrame||0,spriteEndFrame:r.spriteEndFrame||0};0===o.spriteEndFrame&&o.spriteRows>0&&o.spriteCols>0&&(o.spriteEndFrame=o.spriteRows*o.spriteCols-1);var s,l,c,u,_,h,f,d,m=[],p=[],g=[],y={},v=0,S=r.creators||[],E=r.updaters||[],b=r.constraints||[],I=0,x=null,C=null;for(l=0,c=S.length;l<c;++l)_=(f=S[l]).id||"__CR"+ ++v,y[_]?Human.log.error("Component "+_+" already exists. Skipping."):(h=new t.creators[u=f.type](f,o),m.push(h),y[_]=h,"Lifetime"===u?o.lifetimes=!0:"SolidColor"===u?o.colors=!0:"RandomScale"===u||"RandomRotation"===u?o.scaleRotations=!0:"RandomRotationSpeed"===u?(o.scaleRotations=!0,o.rotationSpeeds=!0):"SpriteAnimationDuration"===u&&(o.uvTranslates=!0,o.spriteFrameDuration=!0,o.spriteFrameCounter=!0,o.spriteCurrentTime=!0));var T=null,N=null;for(l=0,c=E.length;l<c;++l)if(_=(d=E[l]).id||"__UP"+ ++v,y[_])Human.log.error("Component "+_+" already exists. Skipping.");else{if(u=d.type,d.shape&&(x=new t.shapes[(s=d.shape).type](s),C=s.direction||"in"),T=new t.updaters[u](d,o),"AgeColorBlend"===u)o.colors=!0,o.lifetimes=!0;else if("Path"===u){N=T;for(var D=d.nodes,A=0;A<D.length;++A)T.addNode(D[A]);o.paths=!0}else"SpriteAnimation"===u&&(o.uvTranslates=!0);x&&(T.shape=x,T.shapeDirection=C),p.push(T),y[_]=T}var P=null;for(l=0,c=b.length;l<c;++l)if(_=(f=b[l]).id||"__CN"+ ++v,y[_])Human.log.error("Component "+_+" already exists. Skipping.");else{var M;switch(u=f.type,f.shape&&(x=new t.shapes[(s=f.shape).type](s),C=s.direction||"in"),f.trap?(M=I++,o.traps=!0):M=-1,u){case"LifetimeKill":case"LifetimeStop":P=new t.constraints[u](o);break;case"PathKill":case"PathRadius":case"PathStop":P=new t.constraints[u](N,o);break;case"ShapeBounce":case"ShapeStop":case"ShapeKill":P=new t.constraints[u](x,C,M,o)}g.push(P),y[_]=P}var w=o.textures||[];for(l=0,c=w.length;l<c;++l)w[l].src=window.localBaseDirectory+"content/states/"+w[l].src.replace(/^\/+/,"");Human.assets.textures.load(w,(function(){var e=new t.ParticleSystem(n,o);e.creators=m,e.updaters=p,e.constraints=g,e.components=y,void 0!==r.emissionAverage&&(e.emissionAverage=r.emissionAverage),void 0!==r.emissionVariance&&(e.emissionVariance=r.emissionVariance),void 0!==r.maxSpeed&&(e.maxSpeed=r.maxSpeed),void 0!==r.pointSize&&e.pointSize(r.pointSize),t.systems[a]=e,i&&i()}))}t.parse=function(e,t){var r=(e=Human.utils.deepClone(e)).length;if(0!==r)for(var a=0,n=e.length;a<n;++a)i(e[a],o);else t&&t();function o(){0==--r&&t&&t()}},t.getBoundary=function(){for(var e in r.xmin=Number.POSITIVE_INFINITY,r.ymin=Number.POSITIVE_INFINITY,r.zmin=Number.POSITIVE_INFINITY,r.xmax=Number.NEGATIVE_INFINITY,r.ymax=Number.NEGATIVE_INFINITY,r.zmax=Number.NEGATIVE_INFINITY,t.systems){var i=t.systems[e].getBoundary();r.xmin=Math.min(r.xmin,i.xmin),r.ymin=Math.min(r.ymin,i.ymin),r.zmin=Math.min(r.zmin,i.zmin),r.xmax=Math.max(r.xmax,i.xmax),r.ymax=Math.max(r.ymax,i.ymax),r.zmax=Math.max(r.zmax,i.zmax)}return r},t.update=function(e,r){t.systems[e]&&(t.systems[e].update(r),Human.renderer.camera.nearFarDirty=!0)},t.updateAll=function(e){for(var r in t.systems)t.systems.hasOwnProperty(r)&&t.update(r,e)},t.enable=function(e){t.systems[e].enable()},t.enableAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.enable(e)},t.disable=function(e){t.systems[e].disable()},t.disableAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.disable(e)},t.reset=function(e){t.systems[e].reset()},t.resetAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.reset(e)},t.destroy=function(e){t.systems[e]&&(t.systems[e].destroy(),delete t.systems[e])},t.destroyAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.destroy(e)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Uint8Array(4),i=new Float32Array(2),a=new Float32Array(1),n=new Float32Array(2),o={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},s=Human.particles.ParticleSystem=function(e,t){var r,i=(t=t||{}).material,a=t.textures,n=t.properties||{},o=n.layer||0,s=n.addBlend||!1,l=!!t.colors,c=!!t.lifetimes,u=!!t.paths,_=!!t.traps,h=Human.renderer.getScene(),f=!!t.scaleRotations,d=!!t.rotationSpeeds,m=!!t.uvTranslates,p=!!t.spriteFrameDuration,g=!!t.spriteFrameCounter,y=!!t.spriteCurrentTime;if(this.activeParticlesBegin=0,this.numParticles=0,this.maxSpeed=0,this.maxNumParticles=e,this.spriteRows=t.spriteRows||0,this.spriteCols=t.spriteCols||0,this.spriteStartFrame=t.spriteStartFrame||0,this.spriteEndFrame=t.spriteEndFrame||0,this.attributes={stopped:new Array(e),dead:new Array(e),positions:new Float32Array(3*e),velocities:new Float32Array(3*e),colors:l?new Uint8Array(4*this.maxNumParticles):null,lifetimes:c?new Float32Array(this.maxNumParticles):null,ages:c?new Float32Array(this.maxNumParticles):null,paths:u?new Uint8Array(this.maxNumParticles):null,traps:_?new Uint32Array(this.maxNumParticles):null,scaleRotations:f?new Float32Array(2*e):null,rotationSpeeds:d?new Float32Array(e):null,uvTranslates:m?new Float32Array(2*e):null,spriteFrameDuration:p?new Float32Array(e):null,spriteFrameCounter:g?new Uint8Array(e):null,spriteCurrentTime:y?new Float32Array(e):null},this.rootNode=null,this.properties=null,this.material=null,this.geometry=null,n.enabled=!1,n.picking=!1,!1===n.depthMask&&(n.noDepthMask=!0),this.rootNode=this.properties=r=h.addNode({type:"properties",properties:n}),i&&(i.type="material",this.material=r=r.addNode(i)),a)for(var v=0,S=a.length;v<S;++v)a[v].type="texture",a[v].src=window.localBaseDirectory+"content/states/"+a[v].src,r=r.addNode(a[v]);var E=null;this.spriteRows>0&&this.spriteCols>0&&(E=new Float32Array([1/this.spriteCols,1/this.spriteRows])),this.geometry=r.addNode({type:"geometry",positions:this.attributes.positions,colors:this.attributes.colors,pointScaleRotations:this.attributes.scaleRotations,pointUVTranslates:this.attributes.uvTranslates,pointUVScale:E,layer:o,addBlend:s,primitive:"points"}),this.enabled=!1,this.emissionAverage=0,this.emissionVariance=0,this.creators=[],this.updaters=[],this.constraints=[],this.components={},this.previousTime=null};s.prototype.pointSize=function(e){this.geometry.setPointSize(e)},s.prototype.getBoundary=function(){return o},s.prototype.update=function(e){if(this.enabled){o.xmin=Number.POSITIVE_INFINITY,o.ymin=Number.POSITIVE_INFINITY,o.zmin=Number.POSITIVE_INFINITY,o.xmax=Number.NEGATIVE_INFINITY,o.ymax=Number.NEGATIVE_INFINITY,o.zmax=Number.NEGATIVE_INFINITY;var r=Math.max,i=Math.min,a=Math.sqrt,n=Math.floor,s=Math.random;this.previousTime=this.previousTime||e;var l=i(e-this.previousTime,.04);l<0&&(this.previousTime=e,l=0);var c,u,_,h,f,d,m,p,g=this.attributes,y=g.positions,v=g.velocities,S=g.ages,E=g.lifetimes,b=!!S,I=this.maxSpeed*l,x=I*I,C=g.scaleRotations,T=g.rotationSpeeds;if(this.numParticles<this.maxNumParticles){var N=this.emissionVariance*l,D=r(this.emissionAverage*l+2*s()*N-N,0);D=D>=1?n(D):s()<D?1:0;var A=i(this.numParticles+D,this.maxNumParticles);for(c=this.numParticles;c<A;++c)p=2*c,y[_=3*c]=0,y[_+1]=0,y[_+2]=0,v[_]=0,v[_+1]=0,v[_+2]=0,g.dead[c]=!1,g.stopped[c]=!1,g.paths&&(g.paths[c]=0),g.traps&&(g.traps[c]=0),g.traps&&(g.traps[c]=0),g.scaleRotations&&(g.scaleRotations[p]=1,g.scaleRotations[p+1]=0),g.rotationSpeeds&&(g.rotationSpeeds[c]=0),g.uvTranslates&&(g.uvTranslates[p]=this.spriteStartFrame%this.spriteCols*1/this.spriteCols,g.uvTranslates[p+1]=1*(this.spriteRows-1-n(this.spriteStartFrame/this.spriteCols))/this.spriteRows),g.spriteFrameCounter&&(g.spriteFrameCounter[c]=0),g.spriteFrameDuration&&(g.spriteFrameDuration[c]=0),g.spriteCurrentTime&&(g.spriteCurrentTime[c]=0);for(u=0,h=this.creators.length;u<h;++u)this.creators[u].create(this.numParticles,A,g);this.numParticles=A}for(u=0,h=this.updaters.length;u<h;++u)this.updaters[u].update(this.activeParticlesBegin,this.numParticles,g,l);for(c=this.activeParticlesBegin;c<this.numParticles;++c){if(p=2*c,d=1+(_=3*c),m=_+2,t[0]=v[f=_]*l,t[1]=v[d]*l,t[2]=v[m]*l,x>0){var P=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(P>x){var M=I/a(P);t[0]*=M,t[1]*=M,t[2]*=M,v[f]=t[0],v[d]=t[1],v[m]=t[2]}}y[f]+=t[0],y[d]+=t[1],y[m]+=t[2],T&&(C[p+1]+=T[c]*l),o.xmin=i(o.xmin,y[f]),o.ymin=i(o.ymin,y[d]),o.zmin=i(o.zmin,y[m]),o.xmax=r(o.xmax,y[f]),o.ymax=r(o.ymax,y[d]),o.zmax=r(o.zmax,y[m]),b&&S[c]<E[c]&&(S[c]=i(S[c]+l,E[c]))}for(c=0;c<this.activeParticlesBegin;++c)d=1+(_=3*c),m=_+2,o.xmin=i(o.xmin,y[f=_]),o.ymin=i(o.ymin,y[d]),o.zmin=i(o.zmin,y[m]),o.xmax=r(o.xmax,y[f]),o.ymax=r(o.ymax,y[d]),o.zmax=r(o.zmax,y[m]);for(u=0,h=this.constraints.length;u<h;++u)this.constraints[u].constrain(this.activeParticlesBegin,this.numParticles,g);var w=g.stopped,R=g.dead;for(c=this.activeParticlesBegin;c<this.numParticles;++c)R[c]?(this.kill(c),--c):w[c]&&this.stop(c);this.geometry.setPositions(g.positions.subarray(0,3*this.numParticles)),g.colors&&this.geometry.setColors(g.colors.subarray(0,4*this.numParticles)),g.scaleRotations&&this.geometry.setPointScaleRotations(g.scaleRotations.subarray(0,2*this.numParticles)),g.uvTranslates&&this.geometry.setPointUVTranslates(g.uvTranslates.subarray(0,2*this.numParticles)),this.properties.setEnabled(this.numParticles>0),this.previousTime=e}},s.prototype.kill=function(e){var t=this.attributes,r=2*e,i=3*e,a=4*e,n=e,o=2*(this.numParticles-1),s=3*(this.numParticles-1),l=4*(this.numParticles-1),c=this.numParticles-1,u=t.positions,_=t.velocities,h=t.colors,f=t.ages,d=t.lifetimes,m=t.paths,p=t.dead,g=t.stopped,y=t.traps,v=t.scaleRotations,S=t.rotationSpeeds,E=t.uvTranslates;u[i]=u[s],u[i+1]=u[s+1],u[i+2]=u[s+2],_[i]=_[s],_[i+1]=_[s+1],_[i+2]=_[s+2],p[n]=p[c],g[n]=g[c],h&&(h[a]=h[l],h[a+1]=h[l+1],h[a+2]=h[l+2],h[a+3]=h[l+3]),v&&(v[r]=v[o],v[r+1]=v[o+1]),S&&(S[n]=S[c]),E&&(E[r]=E[o],E[r+1]=E[o+1]),d&&(f[n]=f[c],d[n]=d[c]),m&&(m[n]=m[c]),y&&(y[n]=y[c]),this.numParticles--},s.prototype.stop=function(o){var s,l=this.attributes,c=2*o,u=3*o,_=4*o,h=o,f=2*this.activeParticlesBegin,d=3*this.activeParticlesBegin,m=4*this.activeParticlesBegin,p=this.activeParticlesBegin,g=l.positions,y=l.velocities,v=l.colors,S=l.ages,E=l.lifetimes,b=l.paths,I=l.stopped,x=l.traps,C=l.scaleRotations,T=l.rotationSpeeds,N=l.uvTranslates;e[0]=g[d],e[1]=g[d+1],e[2]=g[d+2],g[d]=g[u],g[d+1]=g[u+1],g[d+2]=g[u+2],g[u]=e[0],g[u+1]=e[1],g[u+2]=e[2],t[0]=y[d],t[1]=y[d+1],t[2]=y[d+2],y[d]=y[u],y[d+1]=y[u+1],y[d+2]=y[u+2],y[u]=t[0],y[u+1]=t[1],y[u+2]=t[2],v&&(r[0]=v[m],r[1]=v[m+1],r[2]=v[m+2],r[3]=v[m+3],v[m]=v[_],v[m+1]=v[_+1],v[m+2]=v[_+2],v[m+3]=v[_+3],v[_]=r[0],v[_+1]=r[1],v[_+2]=r[2],v[_+3]=r[3]),C&&(i[0]=C[f],i[1]=C[f+1],C[f]=C[c],C[f+1]=C[c+1],C[c]=i[0],C[c+1]=i[1]),T&&(a[0]=T[p],T[p]=T[o],T[o]=a[0]),N&&(n[0]=N[f],n[1]=N[f+1],N[f]=N[c],N[f+1]=N[c+1],N[c]=n[0],N[c+1]=n[1]),E&&(s=S[p],S[p]=S[h],S[h]=s,s=E[p],E[p]=E[h],E[h]=s),b&&(s=b[p],b[p]=b[h],b[h]=s),x&&(s=x[p],x[p]=x[h],x[h]=s),I[h]=!1,this.activeParticlesBegin++},s.prototype.reset=function(){this.numParticles=0,this.activeParticlesBegin=0},s.prototype.enable=function(){this.properties.setEnabled(!0),this.enabled=!0},s.prototype.disable=function(){this.properties.setEnabled(!1),this.enabled=!1},s.prototype.destroy=function(){this.rootNode.destroy()}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.creators.DirectionalVelocity=function(e){this.directionAverage=new Float32Array(e.directionAverage),this.directionVariance=e.directionVariance||0,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,vec3.normalize(this.directionAverage,this.directionAverage)}).prototype.create=function(t,r,i){for(var a=i.velocities,n=Math.random,o=vec3.normalize,s=t;s<r;++s){var l=3*s,c=this.forceAverage+2*n()*this.forceVariance-this.forceVariance;e[0]=this.directionAverage[0]+2*n()*this.directionVariance-this.directionVariance,e[1]=this.directionAverage[1]+2*n()*this.directionVariance-this.directionVariance,e[2]=this.directionAverage[2]+2*n()*this.directionVariance-this.directionVariance,o(e,e),a[l]=e[0]*c,a[l+1]=e[1]*c,a[l+2]=e[2]*c}}}(),function(){"use strict";(Human.particles.creators.Lifetime=function(e){this.average=e.average,this.variance=e.variance||0}).prototype.create=function(e,t,r){for(var i=r.ages,a=r.lifetimes,n=Math.random,o=e;o<t;++o)i[o]=0,a[o]=this.average,this.variance>0&&(a[o]+=2*n()*this.variance-this.variance)}}(),function(){"use strict";(Human.particles.creators.PointPosition=function(e){this.position=new Float32Array(e.position)}).prototype.create=function(e,t,r){for(var i=r.positions,a=e;a<t;++a){var n=3*a;i[n]=this.position[0],i[n+1]=this.position[1],i[n+2]=this.position[2]}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.creators.RandomVelocity=function(e){this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0}).prototype.create=function(t,r,i){for(var a=i.velocities,n=Math.random,o=vec3.normalize,s=t;s<r;++s){var l=3*s,c=this.forceAverage;this.forceVariance>0&&(c+=2*n()*this.forceVariance-this.forceVariance),e[0]=2*n()-1,e[1]=2*n()-1,e[2]=2*n()-1,o(e,e),a[l]=e[0]*c,a[l+1]=e[1]*c,a[l+2]=e[2]*c}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.SpherePosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,i){for(var a=i.positions,n=Math.random,o=Math.PI,s=Math.sin,l=Math.cos,c=t;c<r;++c){var u=3*c,_=n()*o,h=n()*o*2,f=n();e[0]=f*s(_)*s(h),e[1]=f*l(_),e[2]=f*s(_)*l(h),this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),a[u]=e[0],a[u+1]=e[1],a[u+2]=e[2]}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.CubePosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,i){for(var a=i.positions,n=Math.random,o=t;o<r;++o){var s=3*o;e[0]=n()-.5,e[1]=n()-.5,e[2]=n()-.5,this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),a[s]=e[0],a[s+1]=e[1],a[s+2]=e[2]}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.CylinderPosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,i){for(var a=i.positions,n=Math.random,o=Math.PI,s=Math.sin,l=Math.cos,c=t;c<r;++c){var u=3*c,_=n()*o*2,h=n(),f=2*n()-1;e[0]=h*l(_),e[1]=f,e[2]=h*s(_),this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),a[u]=e[0],a[u+1]=e[1],a[u+2]=e[2]}}}(),function(){"use strict";(Human.particles.creators.RandomScale=function(e){this.average=e.average,this.variance=e.variance||0}).prototype.create=function(e,t,r){for(var i=r.scaleRotations,a=Math.random,n=2*t,o=2*e;o<n;o+=2){var s=this.average;this.variance>0&&(s+=2*a()*this.variance-this.variance),i[o]=s}}}(),function(){"use strict";(Human.particles.creators.RandomRotation=function(e){this.average=e.average*Human.math.TO_RADIANS,this.variance=(e.variance||0)*Human.math.TO_RADIANS}).prototype.create=function(e,t,r){for(var i=r.scaleRotations,a=Math.random,n=2*t+1,o=2*e+1;o<n;o+=2){var s=this.average;this.variance>0&&(s+=2*a()*this.variance-this.variance),i[o]=s}}}(),function(){"use strict";(Human.particles.creators.RandomRotationSpeed=function(e){this.average=e.average*Human.math.TO_RADIANS,this.variance=(e.variance||0)*Human.math.TO_RADIANS}).prototype.create=function(e,t,r){for(var i=r.rotationSpeeds,a=Math.random,n=e;n<t;n++){var o=this.average;this.variance>0&&(o+=2*a()*this.variance-this.variance),i[n]=o}}}(),function(){"use strict";(Human.particles.creators.SpriteAnimationDuration=function(e,t){this.rows=t.spriteRows,this.cols=t.spriteCols,this.startFrame=t.spriteStartFrame,this.endFrame=t.spriteEndFrame,this.average=e.average,this.variance=e.variance}).prototype.create=function(e,t,r){for(var i=r.spriteFrameDuration,a=Math.random,n=Math.max,o=e;o<t;o++){var s=this.average;this.variance>0&&(s+=2*a()*this.variance-this.variance),i[o]=n(s/(this.endFrame-this.startFrame),0)}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.BrownianMotion=function(e){this.frequency=e.frequency,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,i,a){for(var n=i.positions,o=i.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.frequency*a,_=this.forceAverage*a,h=this.forceVariance*a,f=t;f<r;++f)if((!c||this.shape[this.shapeDirection](n,f))&&s()<u){var d=3*f,m=_;h>0&&(m+=2*s()*h-h),e[0]=2*s()-1,e[1]=2*s()-1,e[2]=2*s()-1,l(e,e),o[d]+=e[0]*m,o[d+1]+=e[1]*m,o[d+2]+=e[2]*m}}}(),function(){"use strict";(Human.particles.updaters.Friction=function(e){this.friction=1-e.friction,this.shape=null,this.shapeDirection="in"}).prototype.update=function(e,t,r,i){for(var a=r.positions,n=r.velocities,o=!!this.shape,s=Math.pow(this.friction,i),l=e;l<t;++l)if(!o||this.shape[this.shapeDirection](a,l)){var c=3*l;n[c]*=s,n[c+1]*=s,n[c+2]*=s}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.UniformForce=function(e){this.directionAverage=new Float32Array(e.directionAverage),this.directionVariance=e.directionVariance||0,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in",vec3.normalize(this.directionAverage,this.directionAverage)}).prototype.update=function(t,r,i,a){for(var n=i.positions,o=i.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.forceAverage*a,_=this.forceVariance*a,h=t;h<r;++h)if(!c||this.shape[this.shapeDirection](n,h)){var f=3*h,d=u;_>0&&(d+=2*s()*_-_),e[0]=this.directionAverage[0],e[1]=this.directionAverage[1],e[2]=this.directionAverage[2],this.directionVariance&&(e[0]+=2*s()*this.directionVariance-this.directionVariance,e[1]+=2*s()*this.directionVariance-this.directionVariance,e[2]+=2*s()*this.directionVariance-this.directionVariance,l(e,e)),o[f]+=e[0]*d,o[f+1]+=e[1]*d,o[f+2]+=e[2]*d}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.RadialForce=function(e){this.position=new Float32Array(e.position),this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,i,a){for(var n=i.positions,o=i.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.forceAverage*a,_=this.forceVariance*a,h=t;h<r;++h)if(!c||this.shape[this.shapeDirection](n,h)){var f=3*h,d=u;_&&(d+=2*s()*_-_),e[0]=n[f]-this.position[0],e[1]=n[f+1]-this.position[1],e[2]=n[f+2]-this.position[2],l(e,e),o[f]+=e[0]*d,o[f+1]+=e[1]*d,o[f+2]+=e[2]*d}}}(),function(){"use strict";(Human.particles.updaters.AgeColorBlend=function(e){this.colors=new Array(e.colors.length);for(var t=0,r=e.colors.length;t<r;++t)this.colors[t]=new Uint8Array(e.colors[t]);this.shape=null,this.shapeDirection="in"}).prototype.update=function(e,t,r){for(var i=r.positions,a=r.ages,n=r.lifetimes,o=r.colors,s=!!this.shape,l=this.colors.length-1,c=Math.floor,u=e;u<t;++u)if(!s||this.shape[this.shapeDirection](i,u)){var _=4*u,h=a[u]/n[u]*l,f=c(h),d=this.colors[f],m=this.colors[f+1]||this.colors[f],p=h-f,g=1-p;o[_]=g*d[0]+p*m[0],o[_+1]=g*d[1]+p*m[1],o[_+2]=g*d[2]+p*m[2],o[_+3]=g*d[3]+p*m[3]}}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),i=Human.particles.updaters.Path=function(){this.nodes=[],this.shape=null,this.shapeDirection="in"};i.prototype.addNode=function(e){if(e.first=0===this.nodes.length,e.position=new Float32Array(e.position),e.forceVariance=e.forceVariance||0,this.nodes.push(e),e.first)e.vec=null,e.dir=null,e.length=null;else{var t=this.nodes[this.nodes.length-2];e.vec=vec3.subtract(vec3.create(),e.position,t.position),e.dir=vec3.normalize(vec3.create(),e.vec),e.length=vec3.length(e.vec)}},i.prototype.updateNode=function(e,t){var r=this.nodes[e];if(t.position&&(r.position=t.position,r.first||(vec3.subtract(r.vec,r.position,this.nodes[e-1].position),vec3.normalize(r.dir,r.vec),r.length=vec3.length(r.vec)),e<this.nodes.length-1)){var i=this.nodes[e+1];vec3.subtract(i.vec,i.position,r.position),vec3.normalize(i.dir,i.vec),i.length=vec3.length(i.vec)}t.radius&&(r.radius=t.radius),t.forceAverage&&(r.forceAverage=t.forceAverage)},i.prototype.update=function(i,a,n,o){for(var s,l=n.positions,c=n.velocities,u=n.paths,_=!!this.shape,h=Math.random,f=vec3.distance,d=vec3.normalize,m=vec3.subtract,p=vec3.dot,g=vec3.length,y=vec3.scale,v=i;v<a;++v)if((!_||this.shape[this.shapeDirection](l,v))&&(s=this.nodes[u[v]])){var S,E=3*v;if(e[0]=l[E],e[1]=l[E+1],e[2]=l[E+2],s.first){if(f(e,s.position)<s.radius&&(u[v]++,!(s=this.nodes[u[v]])))continue;d(S=m(r,s.position,e),S)}else{if(p(m(r,e,this.nodes[u[v]-1].position),s.dir)>s.length){if(u[v]++,!(s=this.nodes[u[v]]))continue;t[0]=c[E],t[1]=c[E+1],t[2]=c[E+2];var b=g(t);y(t,s.dir,b),c[E]=t[0],c[E+1]=t[1],c[E+2]=t[2]}S=s.dir}var I=s.forceVariance*o,x=s.forceAverage*o;I>0&&(x+=2*h()*I-I),c[E]+=S[0]*x,c[E+1]+=S[1]*x,c[E+2]+=S[2]*x}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.Gravity=function(e){this.position=new Float32Array(e.position),this.radius=e.radius,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,i,a){for(var n=i.positions,o=i.velocities,s=Math.random,l=Math.max,c=vec3.length,u=!!this.shape,_=this.forceAverage*a,h=this.forceVariance*a,f=t;f<r;++f)if(!u||this.shape[this.shapeDirection](n,f)){var d=3*f,m=_;h&&(m+=2*s()*h-h),e[0]=this.position[0]-n[d],e[1]=this.position[1]-n[d+1],e[2]=this.position[2]-n[d+2];var p=l(c(e),this.radius);e[0]/=p,e[1]/=p,e[2]/=p,o[d]+=e[0]*(m/=p*p),o[d+1]+=e[1]*m,o[d+2]+=e[2]*m}}}(),function(){"use strict";(Human.particles.updaters.SpriteAnimation=function(e,t){this.rows=t.spriteRows,this.cols=t.spriteCols,this.startFrame=t.spriteStartFrame,this.endFrame=t.spriteEndFrame}).prototype.update=function(e,t,r,i){for(var a=r.uvTranslates,n=r.spriteFrameCounter,o=r.spriteFrameDuration,s=r.spriteCurrentTime,l=e;l<t;l++)s[l]+=i,s[l]>=o[l]&&(s[l]=0,n[l]++,a[2*l]+=1/this.cols,1===a[2*l]&&(a[2*l]=0,a[2*l+1]-=1/this.rows),a[2*l+1]===-1/this.rows&&(a[2*l]=this.startFrame%this.cols*1/this.cols,a[2*l+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows),n[l]>this.endFrame&&(n[l]=this.startFrame,a[2*l]=this.startFrame%this.cols*1/this.cols,a[2*l+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows))}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),i=new Float32Array(3),a=new Float32Array(3);(Human.particles.updaters.AxisForce=function(e){this.position=new Float32Array(e.position),vec3.normalize(e.direction,e.direction),this.direction=new Float32Array(e.direction),this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(n,o,s,l){for(var c=s.positions,u=s.velocities,_=Math.random,h=!!this.shape,f=this.forceAverage*l,d=this.forceVariance*l,m=n;m<o;++m)if(!h||this.shape[this.shapeDirection](c,m)){var p=3*m,g=f;d&&(g+=2*_()*d-d),t[0]=c[p],t[1]=c[p+1],t[2]=c[p+2],vec3.sub(r,t,this.position);var y=vec3.dot(r,this.direction);vec3.scale(i,this.direction,y),vec3.add(a,i,this.position),vec3.sub(e,t,a),vec3.normalize(e,e),u[p]+=e[0]*g,u[p+1]+=e[1]*g,u[p+2]+=e[2]*g}}}(),function(){"use strict";(Human.particles.constraints.LifetimeKill=function(){}).prototype.constrain=function(e,t,r){for(var i=r.ages,a=r.lifetimes,n=r.dead,o=e;o<t;++o)i[o]>=a[o]&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.LifetimeStop=function(){}).prototype.constrain=function(e,t,r){for(var i=r.ages,a=r.lifetimes,n=r.stopped,o=e;o<t;++o)i[o]>=a[o]&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.ShapeKill=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(e,t,r){for(var i=r.positions,a=r.dead,n=r.traps,o=this.trap,s=this.trapMask,l=e;l<t;++l)if(this.shape[this.direction](i,l)){if(o&&0==(n[l]&s))continue;a[l]=!0}else o&&(n[l]|=s)}}(),function(){"use strict";(Human.particles.constraints.ShapeStop=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(e,t,r){for(var i=r.positions,a=r.stopped,n=r.traps,o=this.trap,s=this.trapMask,l=e;l<t;++l)if(this.shape[this.direction](i,l)){if(o&&0==(n[l]&s))continue;a[l]=!0}else o&&(n[l]|=s)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),i=new Float32Array(3),a=new Float32Array(3);(Human.particles.constraints.PathRadius=function(e){this.nodes=e.nodes}).prototype.constrain=function(n,o,s){for(var l=s.positions,c=s.paths,u=vec3.normalize,_=vec3.subtract,h=vec3.dot,f=vec3.length,d=vec3.scale,m=n;m<o;++m){var p=3*m;if(!(c[m]<1)){var g=this.nodes[c[m]];if(g){e[0]=l[p],e[1]=l[p+1],e[2]=l[p+2];var y=_(t,e,this.nodes[c[m]-1].position),v=h(y,g.dir),S=d(r,g.dir,v),E=_(i,y,S),b=f(E);if(b>g.radius){u(E,E);var I=d(a,E,g.radius-b);l[p]+=I[0],l[p+1]+=I[1],l[p+2]+=I[2]}}}}}}(),function(){"use strict";(Human.particles.constraints.PathKill=function(e){this.nodes=e.nodes}).prototype.constrain=function(e,t,r){for(var i=this.nodes.length,a=r.paths,n=r.dead,o=e;o<t;++o)a[o]>=i&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.PathStop=function(e){this.nodes=e.nodes}).prototype.constrain=function(e,t,r){for(var i=this.nodes.length,a=r.paths,n=r.stopped,o=e;o<t;++o)a[o]>=i&&(n[o]=!0)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),i=new Float32Array(3),a=new Float32Array(3);(Human.particles.constraints.ShapeBounce=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(n,o,s){for(var l=s.positions,c=s.velocities,u=s.traps,_=this.trap,h=this.trapMask,f=vec3.subtract,d=vec3.dot,m=vec3.length,p=vec3.scale,g=n;g<o;++g)if(this.shape[this.direction](l,g)){if(_&&0==(u[g]&h))continue;var y=3*g;this.shape.surfaceProjection(l,g,i,a),l.set(i,y),e[0]=c[y],e[1]=c[y+1],e[2]=c[y+2];var v=m(e);e[0]/=v,e[1]/=v,e[2]/=v;var S=d(e,a),E=p(t,a,2*S),b=f(r,e,E);p(b,b,v),c[y]=b[0],c[y+1]=b[1],c[y+2]=b[2]}else _&&(u[g]|=h)}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Sphere=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a*a+n*n+o*o<=1},t.prototype.out=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a*a+n*n+o*o>=1},t.prototype.surfaceProjection=function(e,t,r,i){var a=3*t;r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform),vec3.normalize(r,r),i.set(r),this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(i,i,this.normalXform),vec3.normalize(i,i)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=mat3.create(),i=new Float32Array([0,1,0]),a=Human.particles.shapes.Plane=function(e){this.translate=new Float32Array(e.translate||Human.math.VEC3_ZEROS),this.rotate=new Float32Array(e.rotate||Human.math.VEC3_ZEROS),this.normal=vec3.create(),this.distance=0};a.prototype.updateXform=function(){this.normal.set(i),Human.math.buildRotationScaleMat3(r,this.rotate,null),vec3.transformMat3(this.normal,this.normal,r),this.distance=vec3.dot(this.translate,this.normal)},a.prototype.in=function(e,t){var r=3*t;return e[r]*this.normal[0]+e[r+1]*this.normal[1]+e[r+2]*this.normal[2]<=this.distance},a.prototype.out=function(e,t){var r=3*t;return e[r]*this.normal[0]+e[r+1]*this.normal[1]+e[r+2]*this.normal[2]>=this.distance},a.prototype.surfaceProjection=function(r,i,a,n){var o=3*i;e[0]=r[o],e[1]=r[o+1],e[2]=r[o+2],n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],vec3.scale(t,n,this.distance-vec3.dot(e,n)),vec3.add(a,e,t)}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Cube=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a>=-.5&&a<=.5&&n>=-.5&&n<=.5&&o>=-.5&&o<=.5},t.prototype.out=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a<=-.5||a>=.5||n<=-.5||n>=.5||o<=-.5||o>=.5},t.prototype.surfaceProjection=function(e,t,r,i){var a=3*t,n=Math.abs;r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform);var o=r[0],s=r[1],l=r[2],c=n(o+.5),u=n(o-.5),_=n(s+.5),h=n(s-.5),f=n(l+.5),d=n(l-.5);c<u&&c<_&&c<h&&c<f&&c<d?(o=-.5,i[0]=-1,i[1]=0,i[2]=0):u<_&&u<h&&u<f&&u<d?(o=.5,i[0]=1,i[1]=0,i[2]=0):_<h&&_<f&&_<d?(s=-.5,i[0]=0,i[1]=-1,i[2]=0):h<f&&h<d?(s=.5,i[0]=0,i[1]=1,i[2]=0):f<d?(l=-.5,i[0]=0,i[1]=0,i[2]=-1):(l=.5,i[0]=0,i[1]=0,i[2]=1),o<-.5?o=-.5:o>.5&&(o=.5),s<-.5?s=-.5:s>.5&&(s=.5),l<-.5?l=-.5:l>.5&&(l=.5),r[0]=o,r[1]=s,r[2]=l,this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(i,i,this.normalXform),vec3.normalize(i,i)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Cylinder=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a*a+o*o<=1&&n>=-1&&n<=1},t.prototype.out=function(t,r){var i=3*r;e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var a=e[0],n=e[1],o=e[2];return a*a+o*o>=1||n<=-1||n>=1},t.prototype.surfaceProjection=function(e,t,r,i){var a=3*t;r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform);var n,o,s=r[0],l=r[1],c=r[2];l<-1?(i[0]=0,i[1]=-1,i[2]=0):l>1?(i[0]=0,i[1]=1,i[2]=0):(o=s*s+c*c,n=Math.sqrt(o),i[0]=s/n,i[1]=0,i[2]=c/n),l<-1&&(l=-1),l>1&&(l=1),(o=o||s*s+c*c)>1&&(s/=n=n||Math.sqrt(n),c/=n),r[0]=s,r[1]=l,r[2]=c,this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(i,i,this.normalXform),vec3.normalize(i,i)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),Human.media=Human.media||{},Human.media.Clips=function(e){"use strict";this._streamType=e,this.clips={},this.clipsList=[],this.libraries={},this.suggestedClips=[],Human.events.fire(this._streamType+".clips",this.clipsList,!0),this.getClipById=function(e){var t=null;return this.clipsList.forEach((function(r){r.clipId===e&&(t=r)})),t},this.createLibrary=function(e,t){if(this.libraries[e])Human.log.warn("Human.media."+this._streamType+".createLibrary","Library already loaded: "+e);else{for(var r,i,a=e.split("/"),n=a[0],o=a[1],s=this.libraries[e]={libraryId:e,clips:{}},l=0,c=t.length;l<c;l++)if((r=t[l]).clipId)if(r.type)if(r.src){null==r.time1&&(r.time1=null),null==r.time2&&(r.time2=null),this.clips[r.clipId]&&Human.log.error("Human.media."+this._streamType+".createLibrary","Clip 'clipId' clashes with another clip: '"+r.clipId+"' - replacing existing clip");var u=[n,this._streamType,o,r.src].join("/");s.clips[r.clipId]=i={clipId:r.clipId,modelId:n,streamType:this._streamType,subasset:o,displayName:r.displayName,description:r.description||"",time1:r.time1,time2:r.time2,type:r.type||"",src:r.src,fullUrl:u,alternatives:r.alternatives||[],length:r.length||0,suggested:!1,status:"closed"},this.clips[r.clipId]=i}else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: src");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: type");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: clipId");this._rebuildClipList()}},this._rebuildClipList=function(){for(var e in this.clipsList=[],this.clips)this.clips.hasOwnProperty(e)&&this._insertClipIntoList(this.clipsList,this.clips[e]);Human.events.fire(this._streamType+".clips",this.clipsList,!0)},this._insertClipIntoList=function(e,t){if(0===e.length)e.push(t);else{for(var r=e.length-1;r>=0;r--)if(e[r].time1<t.time1)return void e.splice(r+1,0,t);e.splice(0,0,t)}},this.destroyLibrary=function(e){var t=this.libraries[e];if(t){for(var r in t.clips)t.clips.hasOwnProperty(r)&&(delete this.clips[r],Human.events.fire(this._streamType+".status",{clipId:r,status:"destroyed"}));delete this.libraries[e],this._rebuildClipList()}else Human.log.warn("Human.media."+this._streamType+".destroyLibrary","Library not found: "+e)},this.open=function(e,t){Human.events.fire(this._streamType+".status",{clipId:e,status:"open"},!0),t()},this.play=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"playing"},!0)},this.scrub=function(e,t){Human.events.fire(this._streamType+".scrubbed",{clipId:e,time:t})},this.pause=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"paused"},!0)},this.stop=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"stopped"},!0)},this.close=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"closed"},!0)},this.reset=function(){for(var e in this.libraries)this.libraries.hasOwnProperty(e)&&this.destroyLibrary(e)}},Human.media.audio=new Human.media.Clips("audio"),Human.media.videos=new Human.media.Clips("videos"),function(){"use strict";var e=Human.assets={loadedAssets:{},nullAssets:{},assetUseCounts:{},libUseCounts:{}},t={geometry:"geometries",audio:"audio",videos:"video"},r={},i={},a={},n=0,o=0;function s(t){void 0!==e.libUseCounts[t]?e.libUseCounts[t]++:e.libUseCounts[t]=1}function l(t){void 0!==e.assetUseCounts[t]?e.assetUseCounts[t]++:e.assetUseCounts[t]=1}function c(e){return t[e]||e+"s"}function u(t,r,i,s){if(function(e,t){o++,Human.events.fire("assets.load.progress",{assetId:e,assetType:t,requestedAssets:n,receivedAssets:o}),o===n&&(Human.events.fire("assets.load.finish"),n=0,o=0,Human.stats.loadSequence.assetsLoaded=Human.timer.now(),Human.stats.loadTimes.assetDownload=Human.stats.loadSequence.assetsLoaded-Human.stats.loadSequence.assetsRequested,Human.renderer.resetFrameThrottling())}(r,t),i&&i!==e.server.TIMEOUT)try{if(s){var u="morph"===t||"geometry"===t,_=new XMLHttpRequest;_.open("PUT","/assets/"+r,!0),_.send(u?i:JSON.stringify(i))}if("transform"===t){for(f=0,d=(h=a[r]).length;f<d;f++)h[f](i);delete e.loadedAssets[r],delete a[r]}else Human.assets[c(t)].parseAsset(r,i,(function(t){for(e.loadedAssets[r]=t,f=0,d=(h=a[r]).length;f<d;f++)l(r),h[f](t);delete a[r]}))}catch(m){Human.log.error("Error parsing asset: "+r+" - "+m.message),e.loadedAssets[r]=null,e.nullAssets[r]=!0;for(var h,f=0,d=(h=a[r]).length;f<d;f++)h[f](null);delete a[r]}else{for(i||(e.nullAssets[r]=!0),e.loadedAssets[r]=null,f=0,d=(h=a[r]).length;f<d;f++)h[f](null);delete a[r]}}e.init=function(){this.server.init(),this.geometries.init(),this.materials.init(),this.morphs.init(),this.reflections.init()},e.getAsset=function(t,r,i){if(e.nullAssets[t])i&&Human.utils.async((function(){i(null)}));else if("LOADING"!==e.loadedAssets[t]){if(e.loadedAssets[t])return l(t),void(i&&Human.utils.async((function(){i(e.loadedAssets[t])})));if(0===n&&(Human.events.fire("assets.load.start"),Human.stats.loadSequence.assetsRequested=Human.timer.now(),Human.stats.loadTimes.preAsset=Human.stats.loadSequence.assetsRequested-Human.stats.loadSequence.startTime),n++,e.loadedAssets[t]="LOADING",a[t]=[],i&&a[t].push(i),window.localContentOnly||Human.mobile.iOS||Human.mobile.android){var o="morph"===r||"geometry"===r,s=t;window.localContentOnly&&(t=t.replace(/\|/g,"/").replace(/:/g,";")+".bda");var c=new XMLHttpRequest;c.responseType=o?"arraybuffer":"text",c.open("GET",window.localBaseDirectory+"assets/"+t,!0),c.onerror=function(){window.localContentOnly?u(r,s,null,!1):e.server.getAsset(r,s,(function(e){u(r,s,e,!0)}))},c.onload=function(){if(200===c.status||window.localContentOnly){var i=c.response,a=o?i:JSON.parse(i);window.localContentOnly&&!o&&(a=a.asset),u(r,s,a,!1)}else e.server.getAsset(r,t,(function(e){u(r,t,e,!0)}))},c.send(null)}else e.server.getAsset(r,t,(function(e){u(r,t,e,!1)}))}else i&&a[t].push(i)},e.getAssetLibrary=function(t,a,n,o,l,u){if(!i[n])return e.libUseCounts[n]?(s(n),void Human.utils.async(u)):void e.server.getAssetLibrary(a,n,o,(function(a){var o;if(!a)return i[n]=!0,void(u&&u());if(e.libUseCounts[n])return s(n),void(u&&u());if("animation"===t){if("binary"===a.format)return void(u&&u());o=Human.assets.tweens}else o=Human.assets[c(t)];o?o.parseLibrary(n,a,l,(function(){s(n),r[n]=o,u&&u()})):(Human.log.error("Unknown asset library type: "+t),u&&u())}));Human.utils.async(u)},e.putAssetLibrary=function(t){if(void 0!==e.libUseCounts[t]&&--e.libUseCounts[t]<=0){delete e.libUseCounts[t];var i=r[t];i&&i.unloadLibrary&&i.unloadLibrary(t),delete r[t]}},e.putAsset=function(t){void 0!==this.assetUseCounts[t]&&--this.assetUseCounts[t]<=0&&(Human.assets[c(e.loadedAssets[t].type)].destroyAsset(t),delete e.loadedAssets[t],delete this.assetUseCounts[t])}}(),function(){"use strict";var e,t,r,i,a=Human.assets.server={TIMEOUT:1},n="true"===Human.request.getSearchParam("__bdh_engine_draco"),o=[],s={},l=[],c={geometry:"geometry"},u={},_={},h=!1;function f(){var t=new WebSocket(i);return t.binaryType="arraybuffer",t.addEventListener("open",(function(){t.send(JSON.stringify({open:"sesame!"}));for(var e=0,r=o.length;e<r;e++)o[e]();o.length=0})),t.addEventListener("close",(function(e){Human.log.log("Socket closed",e.code,e.reason)})),t.addEventListener("error",(function(){Human.log.error("Socket error")})),t.addEventListener("message",(function(t){var r,i,a=t.data;if(e=Date.now(),"string"==typeof a){if("\ud83c\udf7a"===a)return;var n=JSON.parse(a);d(i=n.id,a),n.error?(Human.log.error("Asset not found: "+i),r=null):n.asset?r=n.asset:(Human.log.error("Null asset: "+i),r=null)}else{r=a;var o,l,c=new DataView(r);17===c.getUint32(0,!0)?(l=new Uint32Array(r,0,2)[1],o=11*Uint32Array.BYTES_PER_ELEMENT):(l=c.getUint32(4,!0),o=c.getUint32(12,!0)),function(e,t){if(Human.stats.trackingDownloadSize){var r=Human.utils.binaryGzipSize(t);Human.stats.geometryDownloadSizes[e]=r,Human.stats.geometryDownloadTotal+=r}}(i=Human.utils.atos(r,o,l).trim(),a)}var u=s[i];if(u){for(var _=0,h=u.length;_<h;_++)u[_](r);delete s[i]}})),t}function d(e,t){if(Human.stats.trackingDownloadSize){var r=Human.utils.textGzipSize(t);Human.stats.jsonDownloadSizes[e]=r,Human.stats.jsonDownloadTotal+=r}}Human.properties.subscribe({propId:"assetDomain",value:"assets-human.biodigital.com",callback:function(e){t=e}}),a.init=function(){if(!h){var c="https:"===window.location.protocol?"wss:":"ws:";(Human.mobile.android||Human.mobile.iOS)&&(c="wss:"),i=c+"//"+t+"/assets/ws"+(n?4:3),r=f(),setInterval((function(){if(0!==l.length&&(e=Date.now(),r.readyState===WebSocket.OPEN?(r.send(JSON.stringify({assets:l})),l.length=0):(o.push((function(){r.send(JSON.stringify({assets:l})),l.length=0})),(r.readyState===WebSocket.CLOSING||r.readyState===WebSocket.CLOSED)&&(r=f()))),Date.now()-e>12e4)for(var t in s)if(s.hasOwnProperty(t)){Human.log.error("Server timeout on asset: "+t);for(var i=s[t],n=0,c=i.length;n<c;n++)i[n](a.TIMEOUT);delete s[t]}}),100),h=!0}},a.cacheModuleDefinition=function(e,t){u[e]||(t?u[e]=JSON.stringify(t):a.getModuleDefinition(e))},a.getModuleDefinition=function(e,t,r){u[e]?t&&t(JSON.parse(u[e])):(Human.stats.loadSequence.moduleRequest=Human.timer.now(),Human.stats.loadTimes.preModule=Human.stats.loadSequence.moduleRequest-Human.stats.loadSequence.startTime,Human.utils.getText(window.localBaseDirectory+"content/modules/"+e,(function(r){d(e,r),u[e]=r,Human.stats.loadSequence.moduleLoaded=Human.timer.now(),Human.stats.loadTimes.moduleDownload=Human.stats.loadSequence.moduleLoaded-Human.stats.loadSequence.moduleRequest,t&&t(JSON.parse(r))}),(function(t,i,a){Human.events.fire("net.error",{id:e,type:"modules",status:t.status,statusText:t.statusText}),r&&r(a)})))},a.cacheStateIndex=function(e,t){_[e]||(t?_[e]=JSON.stringify(t):Human.utils.getText(window.localBaseDirectory+"content/states/"+e+"/index?v="+Human.VERSION+"&locale="+Human.locale,(function(t){d(e+"/index",t),_[e]=t})))},a.getStateIndex=function(e,t,r){_[e]?t&&t(JSON.parse(_[e])):Human.utils.getText(window.localBaseDirectory+"content/states/"+e+"/index?v="+Human.VERSION+"&locale="+Human.locale,(function(r){d(e+"/index",r),t(JSON.parse(r))}),r)},a.getAnimationManifest=function(e,t,r){var i=e.split("/");Human.utils.getText(window.localBaseDirectory+"content/states/"+i[0]+"/animations/"+i[1]+"/manifest",(function(r){d(e,r),t(JSON.parse(r))}),r)},a.getAsset=function(e,t,r){var i=t.split("/"),a=i[2],n=i[0]+"/"+(c[e]||e+"s")+"/"+i[1];a&&(n+="/"+a),s[n]?s[n].push(r):(s[n]=[r],l.push(n))},a.getAssetLibrary=function(e,t,r,i){var a=t.split("/");Human.utils.getJSON(window.localBaseDirectory+"content/states/"+a[0]+"/"+e+"/"+a[1]+"/"+r,i,(function(){Human.log.error("Asset library not found: "+t),i(null)}))}}(),function(){"use strict";var e=Human.assets.textures={},t=SceneJS.checkExtension("WEBGL_compressed_texture_s3tc"),r=SceneJS.checkExtension("WEBGL_compressed_texture_pvrtc"),i=SceneJS.checkExtension("WEBGL_compressed_texture_etc1"),a={add:"over",hack_add:"add"};function n(e,t){return function(r){if(Human.stats.trackingDownloadSize){var i=Human.utils.binaryGzipSize(r);Human.stats.textureDownloadSizes[e.compressedSrc]=i,Human.stats.textureDownloadTotal+=i}e.type="texture",e.compressedImage=r,e.src=null,t()}}function o(e,t){return function(){e.compressedSrc=null,s(e,t)}}function s(e,t){if(Human.stats.trackingDownloadSize){var r=e.src;Human.utils.getBinary(r,(function(e){Human.stats.textureDownloadSizes[r]=e.byteLength,Human.stats.textureDownloadTotal+=e.byteLength}))}var i=new Image;i.onload=function(e,t,r){return function(){t.type="texture",t.image=e,r()}}(i,e,t),i.onerror=t,i.src=e.src,e.src=null}function l(e){var a=e.src.replace(/(\.jpg|\.jpeg|\.png)$/,"");return t?(e.compressedSrc=a+"-dxt1.dds",void(e.containerFormat="dds")):r?(e.compressedSrc=a+"-pvrtc.pvr",void(e.containerFormat="pvr")):i?(e.compressedSrc=a+"-etc1.pvr",void(e.containerFormat="pvr")):void 0}function c(e){return e.image||e.compressedImage}e.load=function(e,t){var r=(e=e||[]).length;if(0!==r)for(var i=0;i<r;++i){var u=e[i];e[i]=u={src:u.src||u.uri,applyTo:u.applyTo,blendMode:a[u.blendMode]||u.blendMode,blendFactor:u.blendFactor,preloadColor:u.preloadColor,preloadSrc:u.preloadSrc},l(u),u.compressedSrc?Human.utils.getBinary(u.compressedSrc,n(u,_),o(u,_)):s(u,_)}else t();function _(){0==--r&&(Human.utils.filterInPlace(e,c),t())}}}(),function(){"use strict";var e=Human.assets.geometries={};e.geometries={};var t,r={1:Uint8Array,2:Uint16Array,4:Uint32Array},i={},a=new Array(2),n=0;function o(t){var r=t.data[1];1===t.data[0]?i[r](e.createGeometry(r,t.data[2])):Human.log.error("Human.assets.geometries",t.data[2]+" : "+r),delete i[r]}e.init=function(){!function(){for(var e=0;e<2;e++){var t=Human.workers.loadWorker("draco/worker.js");t.onmessage=o,a[e]=t}}(),t=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Geometry library"})},e.parseAsset=function(t,o,s){var l=new Uint32Array(o,0,1)[0],c={geometry:{primitive:"triangles"},draco:19===l,compressed:17!==l};c.draco?function(e,t,r,o){var s=new DataView(e),l=s.getUint32(12,!0),c=s.getUint32(4,!0),u=s.getUint32(8,!0),f=s.getUint8(22,!0),d=16*f,m=l+c+u,p=m+24,g=p+f*d,y=s.getUint32(16,!0),v=new Int8Array(e,g,y/Int8Array.BYTES_PER_ELEMENT);_(t,new Float32Array(e,m,24/Float32Array.BYTES_PER_ELEMENT)),f>0&&h(t,new Float32Array(e,p,d/Float32Array.BYTES_PER_ELEMENT),f),i[r]=o,a[n%2].postMessage([v,r,t],[v.buffer]),n++}(o,c,t,s):c.compressed?function(t,i,a,n){var o,s,l=new DataView(t),c=l.getUint32(4,!0),u=l.getUint32(8,!0),f=l.getUint32(12,!0),d=l.getUint32(16,!0),p=l.getUint32(20,!0),g=l.getUint32(24,!0),y=l.getUint32(28,!0),v=l.getUint16(32,!0),S=l.getUint8(34),E=l.getUint8(35),b=new Array(E);for(s=0,o=36;s<E;s++,o+=6)b[s]={uvSize:l.getUint32(o,!0),uvDecodeSize:l.getUint16(o+4,!0)};if(o=f+c+u,v>0&&(_(i,new Float32Array(t,o,v/Float32Array.BYTES_PER_ELEMENT)),o+=v),E>0&&(h(i,new Float32Array(t,o,4*E),E),o+=16*E),p>0&&(i.geometry.positions=new Uint16Array(t,o,p/Uint16Array.BYTES_PER_ELEMENT),i.boundary=m(i.geometry.positions,i.positionScale,i.positionTranslate),o+=p),E>0)for(i.geometry.uvs=new Array(E),s=0;s<E;s++)i.geometry.uvs[s]=new Uint16Array(t,o,b[s].uvSize/Uint16Array.BYTES_PER_ELEMENT),o+=b[s].uvSize;if(g>0&&(i.geometry.normals=new Int8Array(t,o,g/Int8Array.BYTES_PER_ELEMENT),o+=g),y>0){var I=r[S];i.geometry.indices=new I(t,d,y/I.BYTES_PER_ELEMENT)}n(e.createGeometry(a,i))}(o,c,t,s):function(t,r,i,a){var n=new Uint32Array(t,0,11),o=n[3],s=n[4],l=n[5],c=n[6],u=11*Uint32Array.BYTES_PER_ELEMENT+n[1]+n[2],_=u+o,h=_+s,f=h+l,d=0;o>0&&(r.geometry.positions=new Float32Array(t,u,o/Float32Array.BYTES_PER_ELEMENT),r.boundary=m(r.geometry.positions),d=r.geometry.positions.length/3),s>0&&(r.geometry.normals=new Float32Array(t,_,s/Float32Array.BYTES_PER_ELEMENT)),c>0&&(r.geometry.uv=new Float32Array(t,f,c/Float32Array.BYTES_PER_ELEMENT)),l>0&&(r.geometry.indices=new Uint32Array(t,h,l/Uint32Array.BYTES_PER_ELEMENT),d<=256?r.geometry.indices=new Uint8Array(r.geometry.indices):d<=65536&&(r.geometry.indices=new Uint16Array(r.geometry.indices))),a(e.createGeometry(i,r))}(o,c,t,s)},e.createGeometry=function(r,i){if(e.geometries[r])Human.log.error("Human.assets.geometries.createGeometry","Geometry already loaded: "+r);else{if(i.geometry){i.geometry.type="geometry";var a={geometry:t.addNode(i.geometry),type:"geometry",compressed:i.compressed},n=i.boundary;if(!n){var o=null,s=null;if(i.geometry.positionDecodeMat){var l=i.geometry.positionDecodeMat;o=new Float32Array([l[0],l[5],l[10]]),s=new Float32Array([l[12],l[13],l[14]])}n=m(i.geometry.positions,o,s)}return a.boundary=n,a.center=[.5*(n.xmax+n.xmin),.5*(n.ymax+n.ymin),.5*(n.zmax+n.zmin)],a.axisBoundary=new Float32Array([n.xmin,n.ymin,n.zmin,n.xmax,n.ymax,n.zmax]),e.geometries[r]=a,a}Human.log.error("Human.assets.geometries.createGeometry","Mandatory attribute 'geometryId' expected on geometry: "+r)}},e.getCompressionStats=function(){var t={compressed:0,uncompressed:0};for(var r in e.geometries)e.geometries.hasOwnProperty(r)&&(e.geometries[r].compressed?t.compressed++:t.uncompressed++);return t},e.destroyAsset=function(t){t?(e.geometries[t].geometry.destroy(),delete e.geometries[t]):e.reset()},e.reset=function(){for(var t in e.geometries)e.geometries.hasOwnProperty(t)&&e.destroyAsset(t)};var s=mat4.create(),l=mat4.create(),c=mat3.create(),u=mat3.create();function _(e,t){var r=t.subarray(0,3),i=t.subarray(3,6),a=mat4.create();return mat4.fromScaling(s,i),mat4.fromTranslation(l,r),mat4.multiply(a,l,s),e.positionTranslate=r,e.positionScale=i,e.geometry.positionDecodeMat=a,e}function h(e,t,r){e.geometry.uvDecodeMats=new Array(r),e.uvTranslates=new Array(r),e.uvScales=new Array(r);for(var i=0;i<r;i++){var a=4*i,n=e.uvTranslates[i]=t.subarray(a,a+2),o=e.uvScales[i]=t.subarray(a+2,a+4);mat3.fromScaling(c,o),mat3.fromTranslation(u,n),e.geometry.uvDecodeMats[i]=mat3.create(),mat3.multiply(e.geometry.uvDecodeMats[i],u,c)}return e}var f=vec3.fromValues(0,0,0),d=vec3.fromValues(1,1,1);function m(e,t,r){t=t||d,r=r||f;for(var i,a,n,o=1e5,s=1e5,l=1e5,c=-1e5,u=-1e5,_=-1e5,h=0,m=e.length-2;h<m;h+=3)(i=e[h]*t[0]+r[0])<o&&(o=i),(a=e[h+1]*t[1]+r[1])<s&&(s=a),(n=e[h+2]*t[2]+r[2])<l&&(l=n),i>c&&(c=i),a>u&&(u=a),n>_&&(_=n);return{xmin:o,ymin:s,zmin:l,xmax:c,ymax:u,zmax:_}}}(),function(){"use strict";var e,t=Human.assets.materials={};t.materials={},t.init=function(){e=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Materials library"})},t.parseAsset=function(e,r,i){var a=e.split("/"),n=a[1].split(".")[0],o=window.localBaseDirectory+"content/states/"+a[0]+"/materials/"+n+"/";t.createMaterial(e,function e(t,r,i){var a,n;switch(i=i||{},t.id&&(t.id=null),t.type){case"texture":var o;for(a=0,n=t.layers.length;a<n;a++)(o=t.layers[a]).src=o.uri||o.src,o.src=r+o.src,o.preloadURI=o.preloadURI||o.preloadSrc,o.preloadURI&&(o.preloadURI=r+o.preloadURI+"?v="+Human.VERSION),o.blendMode=o.blendMode||"over","add"===o.blendMode?o.blendMode="over":"forceAdd"===o.blendMode&&(o.blendMode="add");i&&(i.texture=t);break;case"material":if(i){var s,l,c,u;if(i.material=t,t.reflectionId){if(s=t.reflectionId,!(c=(l=Human.assets.reflections).exportedReflectionIds[s])){var _=r.split("/");_.length>3&&((c=l.exportedReflectionIds[s=_[3]+"/"+s])||Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+s))}c&&((u=Human.assets.reflections.reflections[c])?i.reflection=u.node:Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+s))}t.lightmapId&&((c=(l=Human.assets.reflections).exportedReflectionIds[t.lightmapId])&&(u=Human.assets.reflections.reflections[c])?i.lightmap=u.node:Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+s))}break;case"flags":i&&(i.flags=t)}if(t.nodes){for(a=0,n=t.nodes.length;a<n;a++)e(t.nodes[a],r,i);t.nodes=null}return i}(r,o),i)},t.findMaterial=function(e){return t.materials[e]||null},t.createMaterial=function(r,i,a){if(t.materials[r])Human.log.warn("Human.assets.materials.createMaterial","Material already loaded: "+r);else{var n,o,s,l={type:"material",textureCompressionStats:{compressed:0,uncompressed:0},hasAlphaTexture:!1,hasAlphaFresnel:!1,partiallyOpaque:!1};i.material?(l.material=e.addNode({type:"material",workflow:i.material.workflow,baseColor:i.material.baseColor,specularColor:i.material.specularColor,emitColor:i.material.emitColor,shine:i.material.shine,alpha:i.material.alpha,emit:i.material.emit,metallic:i.material.metallic,roughness:i.material.roughness,specularf0:i.material.specularf0}),l.glassFactor=null!=i.material.glassFactor?i.material.glassFactor:1,l.murkiness=null!=i.material.murkiness?i.material.murkiness:1,i.material.baseFresnel&&(n=i.material.baseFresnel,l.fresnels=l.fresnels||{},l.fresnels.color=e.addNode({type:"fresnel",applyTo:"color",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:1,g:1,b:1},centerColor:s=void 0!==n.center?n.center:{r:0,g:0,b:0},blendMode:n.blendMode||"multiply"})),i.material.alphaFresnel&&(n=i.material.alphaFresnel,l.fresnels=l.fresnels||{},l.fresnels.alpha=e.addNode({type:"fresnel",applyTo:"alpha",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:0,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:1,g:s,b:s},blendMode:n.blendMode||"multiply"}),l.hasAlphaFresnel=!0),i.material.transparencyFresnel&&(n=i.material.transparencyFresnel,l.fresnels=l.fresnels||{},l.fresnels.transparency=e.addNode({type:"fresnel",applyTo:"transparency",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:0,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:1,g:s,b:s},blendMode:n.blendMode||"multiply"}),l.hasAlphaFresnel=!0),i.material.reflectionFresnel&&(n=i.material.reflectionFresnel,l.fresnels=l.fresnels||{},l.fresnels.reflect=e.addNode({type:"fresnel",applyTo:"reflect",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:1,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:0,g:s,b:s},blendMode:n.blendMode||"multiply"})),i.material.specularFresnel&&(n=i.material.specularFresnel,l.fresnels=l.fresnels||{},l.fresnels.specular=e.addNode({type:"fresnel",applyTo:"specular",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:0,g:0,b:0},centerColor:s=void 0!==n.center?n.center:{r:1,g:1,b:1},blendMode:n.blendMode||"multiply"})),i.material.emitFresnel&&(n=i.material.emitFresnel,l.fresnels=l.fresnels||{},l.fresnels.emit=e.addNode({type:"fresnel",applyTo:"emit",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:0,g:0,b:0},centerColor:s=void 0!==n.center?n.center:{r:1,g:1,b:1},blendMode:n.blendMode||"multiply"}))):(l.glassFactor=1,l.murkiness=1),i.reflection&&(l.reflection=e.addNode({type:"cubemap",applyTo:"reflect",coreId:i.reflection.getCoreId()})),i.lightmap&&(l.lightmap=e.addNode({type:"cubemap",applyTo:"light",coreId:i.lightmap.getCoreId()})),i.flags&&i.flags.flags.skybox&&Number,i.flags&&(l.flags={skybox:i.flags.flags.skybox,billboard:i.flags.flags.billboard,frontface:i.flags.flags.frontface,backfaces:i.flags.flags.backfaces,addBlend:i.flags.flags.addBlend},l.partiallyOpaque=!!l.flags.partiallyOpaque);var c=i.texture?i.texture.layers:[];Human.assets.textures.load(c,(function(){l.textures=new Array(c.length);for(var i=0,n=c.length;i<n;++i)c[i].compressedSrc?l.textureCompressionStats.compressed++:l.textureCompressionStats.uncompressed++,"alpha"!==c[i].applyTo&&"transparency"!==c[i].applyTo||(l.hasAlphaTexture=!0),l.textures[i]=e.addNode(c[i]);t.materials[r]=l,a(l)}))}},t.getTextureCompressionStats=function(){var e={compressed:0,uncompressed:0};for(var r in t.materials)t.materials.hasOwnProperty(r)&&(e.compressed+=t.materials[r].textureCompressionStats.compressed,e.uncompressed+=t.materials[r].textureCompressionStats.uncompressed);return e},t.destroyAsset=function(e){if(e){var r=t.materials[e];for(var i in r)r.hasOwnProperty(i)&&"function"==typeof r[i].destroy&&r[i].destroy();delete t.materials[e]}else t.reset()},t.reset=function(){for(var e in t.materials)t.materials.hasOwnProperty(e)&&t.destroyAsset(e)}}(),function(){"use strict";var e,t=Human.assets.morphs={};t.morphs={},t.init=function(){e=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Morphs library"})},t.parseAsset=function(e,t,a){var n;n=17===new Uint32Array(t,0,1)[0]?function(e){for(var t,r={morphGeometry:{}},i=new Uint32Array(e,0,11),a=i[2],n=i[3],o=i[4],s=i[6],l=11*Uint32Array.BYTES_PER_ELEMENT+i[1],c=l+a,u=c+n,_=u+o+i[5],h=(r.morphGeometry.keys=Human.utils.atoj(e,l,a)).length,f=r.morphGeometry.targets=[],d=n/h,m=d/Float32Array.BYTES_PER_ELEMENT,p=o/h,g=p/Float32Array.BYTES_PER_ELEMENT,y=s/h,v=s/Float32Array.BYTES_PER_ELEMENT,S=0;S<h;S++)t={},n>0&&(t.positions=new Float32Array(e,c+S*d,m)),o>0&&(t.normals=new Float32Array(e,u+S*p,g)),s>0&&(t.uvs=new Float32Array(e,_+S*y,v)),f.push(t);return r}(t):function(e){var t,a,n={},o=new DataView(e),s=o.getUint32(4,!0),l=o.getUint32(8,!0),c=o.getUint32(12,!0),u=o.getUint32(20,!0),_=o.getUint32(24,!0),h=o.getUint16(32,!0),f=o.getUint8(34),d=new Array(f);for(a=0,t=36;a<f;a++,t+=5)d[a]={uvSize:o.getUint32(t,!0),uvDecodeSize:o.getUint8(t+4)};t=c+s,n.morphGeometry=Human.utils.atoj(e,t,l);var m,p=n.morphGeometry.keys.length,g=n.morphGeometry.targets=new Array(p);for(a=0;a<p;a++)g[a]={};n.positionTranslates=new Array(p),n.positionScales=new Array(p);var y=h/p,v=u/p,S=v/Uint16Array.BYTES_PER_ELEMENT,E=_/p,b=E/Int8Array.BYTES_PER_ELEMENT;if(t+=l,h>0)for(a=0;a<p;a++){m=g[a];var I=n.positionTranslates[a]=new Float32Array(e,t,3),x=n.positionScales[a]=new Float32Array(e,t+12,3);mat4.fromScaling(r,x),mat4.fromTranslation(i,I),m.positionDecodeMat=mat4.create(),mat4.multiply(m.positionDecodeMat,i,r),t+=y}if(u>0){for(a=0;a<p;a++)g[a].positions=new Uint16Array(e,t+a*v,S);t+=u}if(_>0)for(a=0;a<p;a++)g[a].normals=new Int8Array(e,t+a*E,b);return n}(t),a(Human.assets.morphs.createMorph(e,n))},t.findMorph=function(e){return t.morphs[e]||null},t.createMorph=function(r,i){var a=t.morphs[r];if(a)return Human.log.warn("Human.assets.morphs.createMorph","Morph already loaded: "+r),a;i.morphGeometry.type="morphGeometry";for(var n=e.addNode(i.morphGeometry),o=n.getTargets(),s={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},l=vec3.create(),c=Human.math.decompressPosition,u=0,_=o.length;u<_;++u)for(var h=o[u],f=h.positions,d=h.positionDecodeMat,m=0,p=f.length;m<p;m+=3)l[0]=f[m],l[1]=f[m+1],l[2]=f[m+2],d&&c(l,l,d),l[0]<s.xmin&&(s.xmin=l[0]),l[0]>s.xmax&&(s.xmax=l[0]),l[1]<s.ymin&&(s.ymin=l[1]),l[1]>s.ymax&&(s.ymax=l[1]),l[2]<s.zmin&&(s.zmin=l[2]),l[2]>s.zmax&&(s.zmax=l[2]);a={type:"morph",morphGeometry:n,boundary:s,center:[.5*(s.xmax+s.xmin),.5*(s.ymax+s.ymin),.5*(s.zmax+s.zmin)],positionTranslates:i.positionTranslates,positionScales:i.positionScales};var g=new Human.assets.morphs.Animation,y=i.morphGeometry.keys;g.addMorph(y[0],y[y.length-1],(function(e){a.morphGeometry.setFactor(e)})),g.calculateTimeFrame(),Human.timeline.addAnimation(r,g);var v=r.split("/")[0];return(Human.timeline.leafTimelines[v]||new Human.timeline.LeafTimeline(v)).addAnimation(r,g),t.morphs[r]=a,a},t.destroyAsset=function(e){if(e){var r=t.morphs[e];if(!r)return void Human.log.warn("Human.assets.morphs.destroyMorph","Morph not found: "+e);r.morphGeometry.destroy(),delete t.morphs[e]}else t.reset()},t.reset=function(){for(var e in t.morphs)t.morphs.hasOwnProperty(e)&&t.destroyAsset(e)};var r=mat4.create(),i=mat4.create()}(),function(){"use strict";Human.assets.morphs.Animation=function(e){e=e||{},this.type="morph-animation",this._loop=!1!==e.loop,this._morphList=[],this.timeline=e.timeline,this.firstTime=null,this.lastTime=null},Human.assets.morphs.Animation.prototype.addMorph=function(e,t,r){this._morphList.push({firstTime:e,lastTime:t,update:r})},Human.assets.morphs.Animation.prototype.calculateTimeFrame=function(){for(var e,t=1e6,r=-1e6,i=this._morphList,a=0,n=this._morphList.length;a<n;a++)(e=i[a]).firstTime<t&&(t=e.firstTime),e.lastTime>r&&(r=e.lastTime);this.firstTime=t,this.lastTime=r},Human.assets.morphs.Animation.prototype.update=function(e,t){for(var r,i,a=0,n=this._morphList.length;a<n;a++)r=this._morphList[a],this._loop?i=t===r.lastTime?t:r.firstTime+t%(r.lastTime-r.firstTime):(i<r.firstTime&&(i=r.firstTime),i>r.lastTime&&(i=r.lastTime)),r.update(i)},Human.assets.morphs.Animation.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";var e=Human.assets.lights={lightIds:{}};e.parseLibrary=function(t,r,i,a){var n=e.lightIds[t];if(n)return Human.log.warn("Human.assets.lights.parseLibrary","library already loaded"),void a();var o,s,l=r.lights;if(!l)return Human.log.error("Human.assets.lights.parseLibrary","'lights' section expected in lights library"),void a();n=e.lightIds[t]=[],Human.renderer.lights.clearEnabled();for(var c=0,u=l.length;c<u;c++)(o=l[c]).lightId?(o.lightId=s=t+"."+o.lightId,o.enabled=!0,Human.renderer.lights.addLight(o),n.push(s)):(Human.log.error("Human.assets.lights.load","'lightId' missing on light"),a());a&&a()},e.unloadLibrary=function(t){var r=e.lightIds[t];if(r){var i,a,n=Human.renderer.lights;for(i=0,a=r.length;i<a;i++)n.removeLight(r[i]);delete e.lightIds[t]}else Human.log.warn("Human.assets.lights.unloadLibrary","library not loaded")}}(),function(){"use strict";var e=Human.assets.tweens={};function t(e,t){return e&&t?t.indexOf(".")<0?e+"-"+t:t:null}e.parseLibrary=function(e,r,i,a){var n,o,s,l,c,u,_,h=r.tweens||{},f=[],d=e.split("/")[0];for(var m in Human.timeline.leafTimelines.hasOwnProperty(d)||new Human.timeline.LeafTimeline(d),h)if(h.hasOwnProperty(m)){if(!(n=h[m]).keys){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'keys'");continue}if(!n.targets){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'targets'");continue}if(n.keys.length<2||n.targets.length<2){Human.log.error("Human.timeline.tweenAnimationLoader","tween has insufficient keys or targets - minimum of two required");continue}if(n.keys.length!==n.targets.length){Human.log.error("Human.timeline.tweenAnimationLoader","tween has mismatching numbers of keys and targets");continue}if(n.options=Human.utils.applyIf(this.options,n.options||{}),!(o=n.type)){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'type'");continue}if(l=(c=o.split(":"))[1],"lerp"===(s=c[0])&&(s="tween"),!s||!l){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute invalid: 'type'");continue}switch(l){case"objectAttr":u=new Human.timeline.ObjectControl({modelId:d,objectId:t(d,n.objectId||n.targetId),objectIds:n.objectIds,id:m});break;case"objectXForm":u=new Human.timeline.ObjectTransformControl({modelId:d,objectId:t(d,n.objectId||n.targetId),initial:n.targets[0]});break;case"material":u=new Human.timeline.MaterialControl({modelId:d,materialId:t(d,n.materialId||n.targetId),attributes:n.targets[0]});break;case"texture":u=new Human.timeline.TextureControl({modelId:d,materialId:t(d,n.materialId||n.targetId),targetLayer:n.targetLayer});break;case"fresnel":u=new Human.timeline.FresnelControl({modelId:d,materialId:t(d,n.materialId),fresnelType:n.fresnelType});break;case"particleSystem":u=new Human.timeline.ParticleSystemControl({particleSystemId:n.particleSystemId});break;case"particleComponent":u=new Human.timeline.ParticleComponentControl({particleSystemId:n.particleSystemId,componentId:n.componentId});break;case"camera":u=new Human.timeline.CameraControl;break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+o);continue}switch(s){case"tween":_=new Human.timeline.Tween({keys:n.keys,targets:n.targets,control:u});break;case"switch":_=new Human.timeline.Switch({keys:n.keys,targets:n.targets,control:u});break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+o);continue}f.push(_)}if(f.length>0){var p=new Human.timeline.TweenAnimation({tweens:f});Human.timeline.addAnimation(e,p)}Human.timeline.leafTimelines[d].addAnimation(e,Human.timeline.animations[e]),a&&a()},e.unloadLibrary=function(e){var t=e.split("/")[0];Human.timeline.leafTimelines[t].unload("tweens")}}(),function(){"use strict";var e=Human.assets.reflections={},t={};e.reflections={},e.exportedReflectionIds={},e.init=function(){Human.renderer.getLibraryRoot().addNode({type:"library",data:"Reflections library"})},e.parseLibrary=function(r,i,a,n){var o=t[r];if(o)return Human.log.warn("Human.assets.reflections.parseLibrary","library already loaded"),void n();t[r]=o=[];var s,l,c,u,_=r.split("/"),h=window.localBaseDirectory+"content/states/"+_[0]+"/reflections/"+_[1]+"/",f=Human.renderer.graph;for(var d in i)if(i.hasOwnProperty(d)){if((s=i[d]).type="reflect",s.blendMode=s.blendMode||"add",!(l=s.src)){Human.log.error("Human.assets.reflections.loader","Reflection property missing: src");continue}if(!Human.utils.isArray(l)){Human.log.error("Human.assets.reflections.loader","Reflection property should be array: src");continue}for(var m=0,p=l.length;m<p;m++)l[m]=h+l[m]+"?v="+Human.VERSION;c=r+"."+d,u={applyTo:s.applyTo||"reflect",node:f.insertNode(Human.renderer.getLibraryRoot(),s)},e.reflections[c]=u,"reflect"===u.applyTo?Human.renderer.getScene().createReflection(c,{src:s.src,intensity:s.intensity,space:s.space||"world"}):Human.renderer.getScene().createLightmap(c,{src:s.src,intensity:s.intensity,space:s.space||"world"}),o.push(c)}Human.renderer.compile(),n&&n()},e.exportReflections=function(t){for(var r in t=t||{})if(t.hasOwnProperty(r)){var i=t[r];-1===i.indexOf("/")&&(t[r]=i.replace(/^([^\.]+)\./,"$1/"))}e.exportedReflectionIds=t||{}},e.unloadLibrary=function(r){var i=t[r];if(i){var a,n,o,s;for(a=0,n=i.length;a<n;a++)(s=e.reflections[o=i[a]]).node.destroy(),"reflect"===s.applyTo?Human.renderer.getScene().destroyReflection(o):Human.renderer.getScene().destroyLightmap(o);e.exportedReflectionIds={},delete t[r]}else Human.log.warn("Human.assets.reflections.unloadLibrary","library not loaded")}}(),function(){"use strict";var e=Human.assets.audio={};e.parseLibrary=function(e,t,r,i){Human.media.audio.createLibrary(e,t),i&&i()},e.unloadLibrary=function(e){Human.media.audio.destroyLibrary(e)}}(),function(){"use strict";var e=Human.assets.video={};e.parseLibrary=function(e,t,r,i){Human.media.videos.createLibrary(e,t),i&&i()},e.unloadLibrary=function(e){Human.media.videos.destroyLibrary(e)}}(),function(){"use strict";var e=Human.bookmarks={};function t(e,t){return!e||!0===e[t]}function r(){var e=Human.modules.moduleLibs,t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}function i(){var e=[];if(Human.modules.numActiveModules>0){var t=Human.modules.activeModules;for(var r in t)t.hasOwnProperty(r)&&e.push(r)}return e}function a(e){if(null===e.pivot)return null;var t={};return 0!==e.pivot.x&&(t.pivot=t.pivot||{},t.pivot.x=e.pivot.x),0!==e.pivot.y&&(t.pivot=t.pivot||{},t.pivot.y=e.pivot.y),0!==e.pivot.z&&(t.pivot=t.pivot||{},t.pivot.z=e.pivot.z),0!==e.translate.x&&(t.translate=t.translate||{},t.translate.x=e.translate.x),0!==e.translate.y&&(t.translate=t.translate||{},t.translate.y=e.translate.y),0!==e.translate.z&&(t.translate=t.translate||{},t.translate.z=e.translate.z),1!==e.scale.x&&(t.scale=t.scale||{},t.scale.x=e.scale.x),1!==e.scale.y&&(t.scale=t.scale||{},t.scale.y=e.scale.y),1!==e.scale.z&&(t.scale=t.scale||{},t.scale.z=e.scale.z),0!==e.rotate.x&&(t.rotate=t.rotate||{},t.rotate.x=e.rotate.x),0!==e.rotate.y&&(t.rotate=t.rotate||{},t.rotate.y=e.rotate.y),0!==e.rotate.z&&(t.rotate=t.rotate||{},t.rotate.z=e.rotate.z),Object.keys(t).length>0?t:null}function n(e,t){var r=0,i=Human.timeline.rootTimelines[e];if(t.timeline)if(t.timeline.hasOwnProperty("scrub"))try{r=t.timeline.scrub.time}catch(o){r=0}else if(t.timeline.hasOwnProperty("play")){var a=t.timeline.play;try{r=Human.timeline.parsePlayInstruction(a).t}catch(o){r=0}}var n=i.mapGlobalTime(r).index;i._chapters=[i._chapters[n]],i.build()}function o(e,t,r){var i,a;if(i=function(e){var t,r,i,a,n,o={};for(t in Human.scene.objects)Human.scene.objects[t]&&!Human.scene.objects[t].anonymous&&(o[t]={shown:!1});for(t in e)if(e.hasOwnProperty(t)){i=e[t],r=l(r=Human.modules.convertBaseAnatomyObjectId(t));var s=Human.scene.objects[r];if(s&&(i.hasOwnProperty("enabled")&&(i.shown=i.enabled,delete i.enabled),i.hasOwnProperty("pickable")||(i.pickable=s.pickable),i.hasOwnProperty("backfaces")||(i.backfaces=s.backfaces),i.hasOwnProperty("opacity")||(i.opacity=s.opacity),i.glassFactor=s.glassFactor,i.murkiness=s.murkiness,o[r]=i),t.match("_ID[0-9]+$"))for(a=Human.scene.getLeaves(r),n=0;n<a.length;n++)Human.scene.objects[a[n]].anonymous&&(e[a[n]]?e[a[n]].shown=i.shown:e[a[n]]={shown:i.shown})}return o}(i=e.objects),Human.scene.setObjectProperties(i),(a=e.modes)&&(null!=a.highlight&&Human.rpc.call(null,"highlight.setEnabled",{enable:a.highlight}),Human.scene.anySelected()&&a.isolate?null!=a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:a.isolate}):null!=a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:!1}),null!=a.labels&&Human.rpc.call(null,"labels.setEnabled",{enable:a.labels}),null!=a.singlePick&&Human.rpc.call(null,"pick.single.setEnabled",{enable:a.singlePick}),null!=a.multiPick&&Human.rpc.call(null,"pick.multi.setEnabled",{enable:a.multiPick}),null!=a.xray&&Human.rpc.call(null,"xray.setEnabled",{enable:a.xray})),Human.renderer.camera.fly.flyTo(e.camera,(function(){})),Human.renderer.resumeCompilation(),Human.renderer.popPause(),t&&void 0!==t){var n=function(e){var t,r=[],i={},a=e.objects;for(t in a)if(a[t].shown||a[t].enabled){var n=Human.modules.convertBaseAnatomyObjectId(t);if(!i[n]){i[n]=!0;var o=Human.scene.objects[n];if(!o){if(i[n=Human.modules.convertBaseAnatomyObjectId(l(t))])continue;i[n]=!0,o=Human.scene.objects[n]}o&&o.isLeaf()&&r.push(o)}}return r}(e);Human.modules.load(t,n,["tweens","reflections","audio","videos","lights","skyBoxes","geometry","material","transform","morph"],(function(){!function(e){var t,r,i;for(r in e=e||{})e.hasOwnProperty(r)&&(t=Human.scene.objects[r],i=e[r].transform,t&&i&&t.setTransform(c(t,i)))}(e.objects),function(e){for(var t in Human.renderer.clip.reset(),e)if(e.hasOwnProperty(t)){var r=e[t];void 0!==r.state&&("clipping"!==r.state&&3!==r.state&&"visible"!==r.state&&4!==r.state||(r.enabled=!0),"number"==typeof r.clipId&&r.clipId--),Human.renderer.clip.setClip(e[t])}}(e.clips),function(e){e.timeline?e.timeline.scrub?Human.timeline.scrub(e.timeline.scrub):e.timeline.play&&Human.timeline.play(e.timeline.play):Human.timeline.scrub({time:0})}(e),Human.events.fire("bookmarks.restored",e),r&&r()}))}else r&&r()}function s(e,t){var r=Human.timeline.rootTimelines[t];r._chapters[0].info.displayName=e.title,r._chapters[0].info.description=e.description;var i=Human.modules.modules[t].displayName,a=Human.modules.modules[t].description,n=Human.utils.shallowClone(r._chapters[0].annotations);return r._chapters[0].annotations=e.annotations,Human.modules.modules[t].displayName=e.title,Human.modules.modules[t].description=e.description,Human.modules.modules[t].chapters[0].displayName=e.title,Human.modules.modules[t].chapters[0].description=e.description,{title:i,description:a,annotations:n}}function l(e){return e.replace(/_ID[0-9]+$/,"_ID")}function c(e,t){var r=e.pivot||{x:0,y:0,z:0},i=e.translate||{x:0,y:0,z:0},a=e.scale||{x:1,y:1,z:1},n=e.rotate||{x:0,y:0,z:0};return t.pivot=t.pivot||{},t.translate=t.translate||{},t.scale=t.scale||{},t.rotate=t.rotate||{},t.pivot.x=void 0===t.pivot.x?r.x:t.pivot.x,t.pivot.y=void 0===t.pivot.y?r.y:t.pivot.y,t.pivot.z=void 0===t.pivot.z?r.z:t.pivot.z,t.translate.x=void 0===t.translate.x?i.x:t.translate.x,t.translate.y=void 0===t.translate.y?i.y:t.translate.y,t.translate.z=void 0===t.translate.z?i.z:t.translate.z,t.scale.x=void 0===t.scale.x?a.x:t.scale.x,t.scale.y=void 0===t.scale.y?a.y:t.scale.y,t.scale.z=void 0===t.scale.z?a.z:t.scale.z,t.rotate.x=void 0===t.rotate.x?n.x:t.rotate.x,t.rotate.y=void 0===t.rotate.y?n.y:t.rotate.y,t.rotate.z=void 0===t.rotate.z?n.z:t.rotate.z,t}e.capture=function(e){var n={engineVersion:Human.VERSION};t(e,"modules")&&(n.modules={moduleLibs:r(),activeModules:i()}),t(e,"camera")&&(n.camera=Human.renderer.camera.getLookAt()),t(e,"clips")&&(n.clips=Human.renderer.clip.serialize()),t(e,"objects")&&(n.objects=function(){var e,t,r,i={},n=Human.scene,o=n.objects,s=n.enabledObjects;for(var l in o)o.hasOwnProperty(l)&&(r=null,0===(e=o[l]).objects.length&&s[l]&&((r=r||{}).enabled=!0,(t=a(e))&&(r.transform=t),r.opacity=e.opacity),r&&(i[l]=r));for(var c=0;c<Human.scene.rootObjects.length;c++)l=(e=Human.scene.rootObjects[c]).objectId,e.shown||(i[l]={enabled:e.shown,opacity:e.opacity});return Human.events.fire("bookmarks.captureObjectStates",{data:i}),i}()),t(e,"timeline")&&(n.timeline=Human.timeline.getBookmark()),t(e,"background")&&(n.background={colors:Human.renderer.bg.getBGColor()}),n.plugins={};var o,s=Human.plugins;for(var l in s)s.hasOwnProperty(l)&&(o=s[l]).writeBookmark&&o.writeBookmark(n);return Human.events.fire("bookmarks.capture",{bookmark:n}),n},e.restore=function(e,t){Human.events.fire("bookmarks.restoring"),Human.utils.isObject(e.modules)||function(e){e.modules={},e.modules.activeModules=[],e.modules.moduleLibs=[],Human.utils.isObject(e.objects)||(e.objects={});var t=function(e){var t,r=null;for(var i in e)if(e.hasOwnProperty(i)&&(t=i.match(/^(fe)?maleAdult/))){r=["production",t[0],t[0]+".json"].join("/");break}return r}(e.objects);t&&e.modules.activeModules.unshift(t)}(e);for(var r=e.modules.activeModules,i=r.length>1,a=[],l=0,c=r.length;l<c;l++)a[l]=Human.modules.convertBaseAnatomyModuleId(r[l]);Human.utils.filterInPlace(a,(function(e){return!(Human.modules.activeModules[e]||i&&Human.modules.isBaseModule(e))}));var u=a[0],_={camera:!0,graph:!0,annotations:!0,properties:!0,time:!0,hotspots:!0};if(e.theModuleId=u,Human.renderer.pushPause(),Human.renderer.pauseCompilation(),u)if(Human.modules.modules.hasOwnProperty(u)){var h=Human.modules.moduleData[u];Human.modules.create(u,h,(function(){n(u,e),s(e,u),Human.modules.activate(u,0,_,(function(){o(e,u,t)}))}))}else Human.modules.fetch(u,(function(){var r=Human.modules.moduleData[u];Human.modules.create(u,r,(function(){n(u,e),s(e,u),Human.modules.activate(u,0,_,(function(){o(e,u,t)}))}))}));else o(e,u,t)}}(),function(){"use strict";var e=Human.modules={},t=new Human.utils.IDPool;function r(){void 0===window.localBaseDirectory&&(window.localBaseDirectory="/",window.localContentOnly=!1)}e.modules={},e.moduleData={},e.moduleLibs={},e.activeModules={},e.numActiveModules=0,e.history=[],e.fetch=function(t,i,a){r(),Human.events.fire("modules.fetch.start",{moduleId:t}),Human.assets.server.getModuleDefinition(t,(function(r){r.moduleId=t,e.moduleData[t]=r,Human.events.fire("modules.fetch.finish",{moduleId:t,moduleData:r}),i&&i()}),(function(e){Human.log.info("Human.modules.activateModules","Failed to activate module: '"+t+"' - "+e),a&&a(e)}))},e.create=function(t,i,a){r(),i=Human.utils.deepClone(i),Human.events.fire("modules.create.start",{moduleId:t,moduleData:i}),e.modules[t]&&delete e.modules[t];var n=new e.Module(i);n.create((function(){e.modules[t]=n,Human.events.fire("modules.created",i),Human.events.fire("modules.create.finish",{moduleId:t,module:e.modules[t]}),a&&a()})),e.history.unshift(t),e.history.length>5&&e.history.pop()},e.activate=function(t,r,i,a){Human.events.fire("modules.activate.start",{moduleId:t,config:i}),Human.events.fire("modules.activating",{moduleId:t}),e.modules[t].activate(r,i,(function(){e.activeModules[t]=e.modules[t],e.numActiveModules++,Human.events.fire("modules.activated",{moduleId:t}),Human.events.fire("modules.activate.finish",{moduleId:t}),a&&a()}))},e.load=function(t,r,i,a){Human.events.fire("modules.load.start",{moduleId:t,graphNodes:r,assetTypes:i}),e.modules[t].load(r,i,(function(){Human.renderer.prepareFrame(),Human.events.fire("modules.load.finish",{moduleId:t,graphNodes:r,assetTypes:i}),a&&a()}))},e.unload=function(t,r,i,a){Human.events.fire("modules.unload.start",{moduleId:t,graphNodes:r,assetTypes:i}),e.modules[t].unload(r,i,(function(){Human.events.fire("modules.unload.finish",{moduleId:t,graphNodes:r,assetTypes:i}),a&&a()}))},e.deactivate=function(t,r,i){Human.events.fire("modules.deactivate.start",{moduleId:t,config:r}),e.modules[t].deactivate(r,(function(){delete e.activeModules[t],e.numActiveModules--,Human.events.fire("modules.deactivated",{moduleId:t}),Human.events.fire("modules.deactivate.finish",{moduleId:t}),i&&i()}))},e.destroy=function(r,i){Human.events.fire("modules.destory.start",{moduleId:r}),e.modules[r]?e.modules[r].destroy((function(){delete e.moduleData[r],delete e.modules[r],t.putId(r),Human.events.fire("modules.destroy.finish",{moduleId:r}),i&&i()})):Human.log.warn("Human.modules.destroyModule","Module does not exist, cannot be destoryed: + "+r)},e.isBase=function(e){var t=e.match(/^(femaleAdult|maleAdult|female_complete_anatomy_[0-9]+\.json|male_complete_anatomy_[0-9]+\.json)/);return t&&t[0]},e.isBaseModule=function(t){var r=t.split("/");return!!e.isBase(r[r.length-1])&&t},e.requiresBase=function(t){for(var r=!1,i=0;i<t.length&&!(r=e.isBase(t[i]));i++);return r};var i=e.MALE_STATE_ID="maleAdult_standard",a=e.FEMALE_STATE_ID="femaleAdult_standard",n={"production/maleAdult/maleAdult.json":"production/maleAdult/maleAdult_standard.json","production/femaleAdult/femaleAdult.json":"production/femaleAdult/femaleAdult_standard.json"};e.convertBaseAnatomyModuleId=function(e){return n[e]||e},e.convertBaseAnatomyStateId=function(e){return e.replace(/^femaleAdult$/,a).replace(/^maleAdult$/,i)},e.convertBaseAnatomyObjectId=function(t){if(e.isBase(t)){var r=t.split("-");t=[e.convertBaseAnatomyStateId(r[0]),r[1]].join("-"),/_ID$/.test(t)||(t+="_ID")}return t}}(),function(){"use strict";var e=Human.modules.Module=function(e){this.moduleId=e.moduleId,this.displayName=e.displayName||"",this.description=e.description||"",this.translations=e.translations||{},this.tags=e.tags||[],this.ui=e.ui||{},this.active=!1,this.timeActivated=-1,this.rootObjects=[],this.animation=e.animation||{},this.camera=e.camera,this.jumpTo=e.jumpTo,this.flyTo=e.flyTo;var t=e.modelIds||e.stateId;for(var r in this.modelIds=t?Human.utils.isArray(t)?t:[t]:[],this.showObjects=e.showObjects,this.selectObjects=e.selectObjects,this.pickThroughObjects=e.pickThroughObjects,this.opacityObjects=e.opacityObjects,this.xray=e.xray,this.properties=e.properties,this.swapped=!1,this.swappedObjectId=null,this.background=e.background||null,this.customData=e.customData||{},this.cache=!1,this.chapters=e.chapters||null,this.sceneGraph=e.sceneGraph,this.particleSystems=e.customData&&e.customData.particleSystems?e.customData.particleSystems:[],this.assetLibraries=e.assetLibraries,this.hasAssetLights=this.assetLibraries.hasOwnProperty("lights")&&this.assetLibraries.lights.length>0,this.lights=e.lights,this.hasLights=this.hasAssetLights||!!this.lights,this.reflections=e.reflections||{},this.reflections)if(this.reflections.hasOwnProperty(r)){var i=this.reflections[r],a=i.split(".");i=a[0]+"/"+a.slice(1).join("."),Human.assets.reflections.exportedReflectionIds[r]=i}this.layers=e.layers||{},this.objectState=e.objects||{},this.clips=e.clips||{},this.modes=e.modes||{},this.colorRecipes=e.colorRecipes||{},this.loadedLibs={}};function t(e,t){var r,i;t=t||{showObjects:{},selectObjects:{},pickThroughObjects:{},colorRecipeObjects:{}};var a=e.showObjects||t.showObjects||{},n=e.selectObjects||t.selectObjects||{},o=e.pickThroughObjects||t.pickThroughObjects||{},s=e.opacityObjects||t.opacityObjects||{},l=e.colorRecipeObjects||t.colorRecipeObjects||{},c=e.synchronization||{};for(r in i="shown",a)a.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][i]=a[r]);for(r in i="selected",n)n.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][i]=n[r]);for(r in i="pickable",o)o.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][i]=!o[r]);for(r in i="opacity",s)c[r]||(c[r]={}),c[r][i]=s[r];for(var u in l)for(r in l[u])c[r]||(c[r]={}),c[r][u]=l[u][r];return c}function r(e,t,r,i,a,n,o){e[i]||(e[i]=!0,Human.assets.getAssetLibrary(t,r,i,a,n,o))}function i(e,t){e[t]&&(delete e[t],Human.assets.putAssetLibrary(t))}function a(e){return function(t){return e.indexOf(t)>-1}}e.prototype.create=function(e){var r,i,n,o;for(Human.scene.graph.buildGraph(this.sceneGraph,null,{}),r=0;r<this.sceneGraph.length;r++)this.rootObjects.push(Human.scene.objects[this.sceneGraph[r].objectId]);for(this.lights&&Human.renderer.lights.addLights(this.lights),r=0;r<this.chapters.length;r++)if((o=this.chapters[r]).lights)if(this.hasAssetLights){var s=o.lights.libraries;Human.utils.filterInPlace(s,a(this.assetLibraries.lights)),0===s.length&&s.push("default")}else o.lights.libraries=["default"];else o.lights={libraries:[],lights:[]},o.lights.libraries=this.hasAssetLights?Human.utils.deepClone(this.assetLibraries.lights):["default"];n=new Human.timeline.RootTimeline(this.moduleId);var l={showObjects:this.showObjects,pickThroughObjects:this.pickThroughObjects,selectObjects:this.selectObjects,opacityObjects:this.opacityObjects};for(r=0;r<this.chapters.length;r++)this.chapters[r].synchronization=t(this.chapters[r],l),this.chapters[r].hasOwnProperty("id")||(this.chapters[r].id=this.moduleId+"_"+r),i=new Human.timeline.BranchTimeline(this.chapters[r]),n.addChapter(i,{rebuild:!1});n.build(),this.rootTimeline=n,Human.particles.destroyAll(),Human.particles.parse(this.particleSystems,e)},e.prototype.activate=function(e,t,r){if(this.timeActivated=Date.now(),this.active=!0,this.properties&&Human.properties.set(this.properties),this.colorRecipes)for(var i in Human.scene.colorRecipes.clearRecipes(),this.colorRecipes)Human.scene.colorRecipes.registerRecipe(i,this.colorRecipes[i]);!1!==e&&this.rootTimeline.activate(e,t,r)},e.prototype.load=function(e,t,i){var a=0;this.customData.tweens&&Human.assets.tweens.parseLibrary(this.customData.tweenId,this.customData.tweens);var n=function(e,t,r){var i,a=0;for(i in e)if(e.hasOwnProperty(i)&&t.indexOf(i)>=0)for(var n=e[i],o=0;o<n.length;o++)r[n[o]]||(a+=1);return a}(this.assetLibraries,t,this.loadedLibs);if(n>0){var o=function(){0==--n&&Human.scene.graph.attachAssetSetsToSubtree(e,[t],i)};if(this.assetLibraries.tweens&&t.indexOf("tweens")>=0)for(a=0;a<this.assetLibraries.tweens.length;a++)r(this.loadedLibs,"animation","animations",this.assetLibraries.tweens[a],"manifest",{},o);if(this.assetLibraries.reflections&&t.indexOf("reflections")>=0)for(a=0;a<this.assetLibraries.reflections.length;a++)r(this.loadedLibs,"reflection","reflections",this.assetLibraries.reflections[a],"outline",{},o);if(this.assetLibraries.lights&&this.assetLibraries.lights.length>0&&t.indexOf("lights")>=0)for(a=0;a<this.assetLibraries.lights.length;a++)r(this.loadedLibs,"light","lights",this.assetLibraries.lights[a],"outline",{},o)}else Human.scene.graph.attachAssetSetsToSubtree(e,[t],i);var s=Human.renderer.getScene(),l=Human.timeline.activeRoot._nowBranch.reflection,c=Human.timeline.activeRoot._nowBranch.lightmap;s.deactivateReflection(),l&&s.activateReflection(l),s.deactivateLightmap(),c&&s.activateLightmap(c)},e.prototype.unload=function(e,t,r){var a=0;if(this.assetLibraries.tweens&&t.indexOf("tweens")>=0)for(a=0;a<this.assetLibraries.tweens.length;a++)i(this.loadedLibs,this.assetLibraries.tweens[a]);if(this.assetLibraries.reflections&&t.indexOf("reflections")>=0)for(a=0;a<this.assetLibraries.reflections.length;a++)i(this.loadedLibs,this.assetLibraries.reflections[a]);if(this.assetLibraries.lights&&t.indexOf("lights")>=0)for(a=0;a<this.assetLibraries.lights.length;a++)i(this.loadedLibs,this.assetLibraries.lights[a]);Human.scene.graph.unloadSubtree(e,t,r)},e.prototype.deactivate=function(e,t){this.timeActivated=-1,this.active=!1,this.rootTimeline.deactivate(e,t)},e.prototype.destroy=function(e){var t=this;Human.particles.destroyAll(),t.rootTimeline.destroy(),Human.scene.graph.destroySubtree(t.rootObjects),t=null,e&&e()}}(),function(){"use strict";Human.mobile={android:void 0!==window.HumanKitAndroid,iOS:void 0!==window.webkit,bundleid:void 0!==window.mobilebundleid?window.mobilebundleid:null}}(),function(){"use strict";var e=Human.workers={},t="";e.setPath=function(e){t=e},e.loadWorker=function(e){return new Worker(t+"/"+e)}}(),function(){"use strict";Human.plugins={},Human.addPlugin=function(e,t){Human.plugins[e]=t}}(),function(e){"use strict";function t(e,t,r){return t<=e&&e<=r}function r(e,t){return Math.floor(e/t)}var i=-1,a=-1;function n(e){var t=0;this.get=function(){return t>=e.length?i:Number(e[t])},this.offset=function(r){if((t+=r)<0)throw new Error("Seeking past start of the buffer");if(t>e.length)throw new Error("Seeking past EOF")},this.match=function(r){if(r.length>t+e.length)return!1;var i;for(i=0;i<r.length;i+=1)if(Number(e[t+i])!==r[i])return!1;return!0}}function o(e){var t=0;this.emit=function(r){var a,n=i;for(a=0;a<arguments.length;++a)n=Number(arguments[a]),e[t++]=n;return n}}function s(e){var r=0,i=function(){for(var r=[],i=0,a=e.length;i<e.length;){var n=e.charCodeAt(i);if(t(n,55296,57343))if(t(n,56320,57343))r.push(65533);else if(i===a-1)r.push(65533);else{var o=e.charCodeAt(i+1);t(o,56320,57343)?(i+=1,r.push(65536+((1023&n)<<10)+(1023&o))):r.push(65533)}else r.push(n);i+=1}return r}();this.offset=function(e){if((r+=e)<0)throw new Error("Seeking past start of the buffer");if(r>i.length)throw new Error("Seeking past EOF")},this.get=function(){return r>=i.length?a:i[r]}}function l(){var e="";this.string=function(){return e},this.emit=function(t){t<=65535?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode(55296+(t>>10&1023)),e+=String.fromCharCode(56320+(1023&t)))}}function c(e,t){if(e)throw new Error("EncodingError");return t||65533}function u(e){throw new Error("EncodingError")}function _(e){if(e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(f,e))return f[e];throw new Error("EncodingError: Unknown encoding: "+e)}var h={},f={};function d(e,t){return(t||[])[e]||null}function m(e,t){var r=t.indexOf(e);return-1===r?null:r}[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach((function(e){e.encodings.forEach((function(e){h[e.name]=e,e.labels.forEach((function(t){f[t]=e}))}))}));var p=e["encoding-indexes"]||{};function g(e){var r=e.fatal,n=0,o=0,s=0,l=0;this.decode=function(e){var u=e.get();if(u===i)return 0!==o?c(r):a;if(e.offset(1),0===o){if(t(u,0,127))return u;if(t(u,194,223))o=1,l=128,n=u-192;else if(t(u,224,239))o=2,l=2048,n=u-224;else{if(!t(u,240,244))return c(r);o=3,l=65536,n=u-240}return n*=Math.pow(64,o),null}if(!t(u,128,191))return n=0,o=0,s=0,l=0,e.offset(-1),c(r);if(s+=1,n+=(u-128)*Math.pow(64,o-s),s!==o)return null;var _=n,h=l;return n=0,o=0,s=0,l=0,t(_,h,1114111)&&!t(_,55296,57343)?_:c(r)}}function y(e){this.encode=function(e,n){var o,s,l=n.get();if(l===a)return i;if(n.offset(1),t(l,55296,57343))return u();if(t(l,0,127))return e.emit(l);t(l,128,2047)?(o=1,s=192):t(l,2048,65535)?(o=2,s=224):t(l,65536,1114111)&&(o=3,s=240);for(var c=e.emit(r(l,Math.pow(64,o))+s);o>0;){var _=r(l,Math.pow(64,o-1));c=e.emit(128+_%64),o-=1}return c}}function v(e,r){var n=r.fatal;this.decode=function(r){var o=r.get();if(o===i)return a;if(r.offset(1),t(o,0,127))return o;var s=e[o-128];return null===s?c(n):s}}function S(e,r){this.encode=function(r,n){var o=n.get();if(o===a)return i;if(n.offset(1),t(o,0,127))return r.emit(o);var s=m(o,e);return null===s&&u(),r.emit(s+128)}}function E(e,r){var n=r.fatal,o=0,s=0,l=0;this.decode=function(r){var u,_=r.get();if(_===i&&0===o&&0===s&&0===l)return a;if(_!==i||0===o&&0===s&&0===l||(o=0,s=0,l=0,c(n)),r.offset(1),0!==l)return u=null,t(_,48,57)&&(u=function(e){if(e>39419&&e<189e3||e>1237575)return null;var t,r=0,i=0,a=p.gb18030;for(t=0;t<a.length;++t){var n=a[t];if(!(n[0]<=e))break;r=n[0],i=n[1]}return i+e-r}(10*(126*(10*(o-129)+(s-48))+(l-129))+_-48)),o=0,s=0,l=0,null===u?(r.offset(-3),c(n)):u;if(0!==s)return t(_,129,254)?(l=_,null):(r.offset(-2),o=0,s=0,c(n));if(0!==o){if(t(_,48,57)&&e)return s=_,null;var h=o,f=null;o=0;var m=_<127?64:65;return(t(_,64,126)||t(_,128,254))&&(f=190*(h-129)+(_-m)),u=null===f?null:d(f,p.gbk),null===f&&r.offset(-1),null===u?c(n):u}return t(_,0,127)?_:128===_?8364:t(_,129,254)?(o=_,null):c(n)}}function b(e,n){this.encode=function(n,o){var s=o.get();if(s===a)return i;if(o.offset(1),t(s,0,127))return n.emit(s);var l=m(s,p.gbk);if(null!==l){var c=r(l,190)+129,_=l%190;return n.emit(c,_+(_<63?64:65))}if(null===l&&!e)return u();var h=r(r(r(l=function(e){var t,r=0,i=0,a=p.gb18030;for(t=0;t<a.length;++t){var n=a[t];if(!(n[1]<=e))break;r=n[1],i=n[0]}return i+e-r}(s),10),126),10),f=r(r(l-=10*h*126*10,10),126),d=r(l-=10*f*126,10);return n.emit(h+129,f+48,d+129,l-10*d+48)}}function I(e){var r=e.fatal,n=!1,o=0;this.decode=function(e){var s=e.get();if(s===i&&0===o)return a;if(s===i&&0!==o)return o=0,c(r);if(e.offset(1),126===o)return o=0,123===s?(n=!0,null):125===s?(n=!1,null):126===s?126:10===s?null:(e.offset(-1),c(r));if(0!==o){var l=o;o=0;var u=null;return t(s,33,126)&&(u=d(190*(l-1)+(s+63),p.gbk)),10===s&&(n=!1),null===u?c(r):u}return 126===s?(o=126,null):n?t(s,32,127)?(o=s,null):(10===s&&(n=!1),c(r)):t(s,0,127)?s:c(r)}}function x(e){var n=!1;this.encode=function(e,o){var s=o.get();if(s===a)return i;if(o.offset(1),t(s,0,127)&&n)return o.offset(-1),n=!1,e.emit(126,125);if(126===s)return e.emit(126,126);if(t(s,0,127))return e.emit(s);if(!n)return o.offset(-1),n=!0,e.emit(126,123);var l=m(s,p.gbk);if(null===l)return u();var c=r(l,190)+1,_=l%190-63;return t(c,33,126)&&t(_,33,126)?e.emit(c,_):u()}}function C(e){var r=e.fatal,n=0,o=null;this.decode=function(e){if(null!==o){var s=o;return o=null,s}var l=e.get();if(l===i&&0===n)return a;if(l===i&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var u=n,_=null;n=0;var h=l<127?64:98;if((t(l,64,126)||t(l,161,254))&&(_=157*(u-129)+(l-h)),1133===_)return o=772,202;if(1135===_)return o=780,202;if(1164===_)return o=772,234;if(1166===_)return o=780,234;var f=null===_?null:d(_,p.big5);return null===_&&e.offset(-1),null===f?c(r):f}return t(l,0,127)?l:t(l,129,254)?(n=l,null):c(r)}}function T(e){this.encode=function(e,n){var o=n.get();if(o===a)return i;if(n.offset(1),t(o,0,127))return e.emit(o);var s=m(o,p.big5);if(null===s)return u();var l=r(s,157)+129,c=s%157;return e.emit(l,c+(c<63?64:98))}}function N(e){var r=e.fatal,n=0,o=0;this.decode=function(e){var s,l,u=e.get();return u===i?0===n&&0===o?a:(n=0,o=0,c(r)):(e.offset(1),0!==o?(s=o,o=0,l=null,t(s,161,254)&&t(u,161,254)&&(l=d(94*(s-161)+u-161,p.jis0212)),t(u,161,254)||e.offset(-1),null===l?c(r):l):142===n&&t(u,161,223)?(n=0,65377+u-161):143===n&&t(u,161,254)?(n=0,o=u,null):0!==n?(s=n,n=0,l=null,t(s,161,254)&&t(u,161,254)&&(l=d(94*(s-161)+u-161,p.jis0208)),t(u,161,254)||e.offset(-1),null===l?c(r):l):t(u,0,127)?u:142===u||143===u||t(u,161,254)?(n=u,null):c(r))}}function D(e){this.encode=function(e,n){var o=n.get();if(o===a)return i;if(n.offset(1),t(o,0,127))return e.emit(o);if(165===o)return e.emit(92);if(8254===o)return e.emit(126);if(t(o,65377,65439))return e.emit(142,o-65377+161);var s=m(o,p.jis0208);if(null===s)return u();var l=r(s,94)+161;return e.emit(l,s%94+161)}}function A(e){var r=e.fatal,n=0,o=!1,s=0;this.decode=function(e){var l=e.get();switch(l!==i&&e.offset(1),n){default:case 0:return 27===l?(n=1,null):t(l,0,127)?l:l===i?a:c(r);case 1:return 36===l||40===l?(s=l,n=2,null):(l!==i&&e.offset(-1),n=0,c(r));case 2:var u=s;return s=0,36!==u||64!==l&&66!==l?36===u&&40===l?(n=3,null):40!==u||66!==l&&74!==l?40===u&&73===l?(n=6,null):(e.offset(l===i?-1:-2),n=0,c(r)):(n=0,null):(o=!1,n=4,null);case 3:return 68===l?(o=!0,n=4,null):(e.offset(l===i?-2:-3),n=0,c(r));case 4:return 10===l?(n=0,c(r,10)):27===l?(n=1,null):l===i?a:(s=l,n=5,null);case 5:if(n=4,l===i)return c(r);var _=null,h=94*(s-33)+l-33;return t(s,33,126)&&t(l,33,126)&&(_=d(h,!1===o?p.jis0208:p.jis0212)),null===_?c(r):_;case 6:return 27===l?(n=1,null):t(l,33,95)?65377+l-33:l===i?a:c(r)}}}function P(e){var n=0;this.encode=function(e,o){var s=o.get();if(s===a)return i;if(o.offset(1),(t(s,0,127)||165===s||8254===s)&&0!==n)return o.offset(-1),n=0,e.emit(27,40,66);if(t(s,0,127))return e.emit(s);if(165===s)return e.emit(92);if(8254===s)return e.emit(126);if(t(s,65377,65439)&&2!==n)return o.offset(-1),n=2,e.emit(27,40,73);if(t(s,65377,65439))return e.emit(s-65377-33);if(1!==n)return o.offset(-1),n=1,e.emit(27,36,66);var l=m(s,p.jis0208);if(null===l)return u();var c=r(l,94)+33;return e.emit(c,l%94+33)}}function M(e){var r=e.fatal,n=0;this.decode=function(e){var o=e.get();if(o===i&&0===n)return a;if(o===i&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var s=n;if(n=0,t(o,64,126)||t(o,128,252)){var l=d(188*(s-(s<160?129:193))+o-(o<127?64:65),p.jis0208);return null===l?c(r):l}return e.offset(-1),c(r)}return t(o,0,128)?o:t(o,161,223)?65377+o-161:t(o,129,159)||t(o,224,252)?(n=o,null):c(r)}}function w(e){this.encode=function(e,n){var o=n.get();if(o===a)return i;if(n.offset(1),t(o,0,128))return e.emit(o);if(165===o)return e.emit(92);if(8254===o)return e.emit(126);if(t(o,65377,65439))return e.emit(o-65377+161);var s=m(o,p.jis0208);if(null===s)return u();var l=r(s,188),c=s%188;return e.emit(l+(l<31?129:193),c+(c<63?64:65))}}function R(e){var r=e.fatal,n=0;this.decode=function(e){var o=e.get();if(o===i&&0===n)return a;if(o===i&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var s=n,l=null;if(n=0,t(s,129,198)){var u=178*(s-129);t(o,65,90)?l=u+o-65:t(o,97,122)?l=u+26+o-97:t(o,129,254)&&(l=u+26+26+o-129)}t(s,199,253)&&t(o,161,254)&&(l=12460+94*(s-199)+(o-161));var _=null===l?null:d(l,p["euc-kr"]);return null===l&&e.offset(-1),null===_?c(r):_}return t(o,0,127)?o:t(o,129,253)?(n=o,null):c(r)}}function F(e){this.encode=function(e,n){var o=n.get();if(o===a)return i;if(n.offset(1),t(o,0,127))return e.emit(o);var s,l,c=m(o,p["euc-kr"]);return null===c?u():c<12460?(s=r(c,178)+129,e.emit(s,(l=c%178)+(l<26?65:l<52?71:77))):(s=r(c-=12460,94)+199,e.emit(s,l=c%94+161))}}function L(e){var r=e.fatal,n=0,o=0;this.decode=function(e){var s=e.get();switch(s!==i&&e.offset(1),n){default:case 0:return 14===s?(n=4,null):15===s?null:27===s?(n=1,null):t(s,0,127)?s:s===i?a:c(r);case 1:return 36===s?(n=2,null):(s!==i&&e.offset(-1),n=0,c(r));case 2:return 41===s?(n=3,null):(e.offset(s===i?-1:-2),n=0,c(r));case 3:return 67===s?(n=0,null):(e.offset(s===i?-2:-3),n=0,c(r));case 4:return 10===s?(n=0,c(r,10)):14===s?null:15===s?(n=0,null):s===i?a:(o=s,n=5,null);case 5:if(n=4,s===i)return c(r);var l=null;return t(o,33,70)&&t(s,33,126)?l=d(178*(o-1)+26+26+s-1,p["euc-kr"]):t(o,71,126)&&t(s,33,126)&&(l=d(12460+94*(o-71)+(s-33),p["euc-kr"])),null!==l?l:c(r)}}}function O(e){var n=!1,o=0;this.encode=function(e,s){var l=s.get();if(l===a)return i;if(n||(n=!0,e.emit(27,36,41,67)),s.offset(1),t(l,0,127)&&0!==o)return s.offset(-1),o=0,e.emit(15);if(t(l,0,127))return e.emit(l);if(1!==o)return s.offset(-1),o=1,e.emit(14);var c,_,h=m(l,p["euc-kr"]);return null===h?u():h<12460?(_=h%178-26-26+1,t(c=r(h,178)+1,33,70)&&t(_,33,126)?e.emit(c,_):u()):(_=(h-=12460)%94+33,t(c=r(h,94)+71,71,126)&&t(_,33,126)?e.emit(c,_):u())}}function H(e,r){var n=r.fatal,o=null,s=null;this.decode=function(r){var l,u=r.get();if(u===i&&null===o&&null===s)return a;if(u===i&&(null!==o||null!==s))return c(n);if(r.offset(1),null===o)return o=u,null;if(l=e?(o<<8)+u:(u<<8)+o,o=null,null!==s){var _=s;return s=null,t(l,56320,57343)?65536+1024*(_-55296)+(l-56320):(r.offset(-2),c(n))}return t(l,55296,56319)?(s=l,null):t(l,56320,57343)?c(n):l}}function J(e,n){this.encode=function(n,o){function s(t){var r=t>>8,i=255&t;return e?n.emit(r,i):n.emit(i,r)}var l=o.get();if(l===a)return i;if(o.offset(1),t(l,55296,57343)&&u(),l<=65535)return s(l);var c=(l-65536)%1024+56320;return s(r(l-65536,1024)+55296),s(c)}}h["utf-8"].getEncoder=function(e){return new y(e)},h["utf-8"].getDecoder=function(e){return new g(e)},["ibm864","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","x-mac-cyrillic"].forEach((function(e){var t=h[e],r=p[e];t.getDecoder=function(e){return new v(r,e)},t.getEncoder=function(e){return new S(r,e)}})),h.gbk.getEncoder=function(e){return new b(!1,e)},h.gbk.getDecoder=function(e){return new E(!1,e)},h.gb18030.getEncoder=function(e){return new b(!0,e)},h.gb18030.getDecoder=function(e){return new E(!0,e)},h["hz-gb-2312"].getEncoder=function(e){return new x(e)},h["hz-gb-2312"].getDecoder=function(e){return new I(e)},h.big5.getEncoder=function(e){return new T(e)},h.big5.getDecoder=function(e){return new C(e)},h["euc-jp"].getEncoder=function(e){return new D(e)},h["euc-jp"].getDecoder=function(e){return new N(e)},h["iso-2022-jp"].getEncoder=function(e){return new P(e)},h["iso-2022-jp"].getDecoder=function(e){return new A(e)},h.shift_jis.getEncoder=function(e){return new w(e)},h.shift_jis.getDecoder=function(e){return new M(e)},h["euc-kr"].getEncoder=function(e){return new F(e)},h["euc-kr"].getDecoder=function(e){return new R(e)},h["iso-2022-kr"].getEncoder=function(e){return new O(e)},h["iso-2022-kr"].getDecoder=function(e){return new L(e)},h["utf-16"].getEncoder=function(e){return new J(!1,e)},h["utf-16"].getDecoder=function(e){return new H(!1,e)},h["utf-16be"].getEncoder=function(e){return new J(!0,e)},h["utf-16be"].getDecoder=function(e){return new H(!0,e)};var B="utf-8";function k(t,r){return this&&this!==e?(t=t?String(t):B,r=Object(r),this._encoding=_(t),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(r.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new k(t,r)}function U(t,r){return this&&this!==e?(t=t?String(t):B,r=Object(r),this._encoding=_(t),this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(r.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new U(t,r)}k.prototype={encode:function(e,t){e=e?String(e):"",t=Object(t),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(t.stream);for(var r=[],n=new o(r),l=new s(e);l.get()!==a;)this._encoder.encode(n,l);if(!this._streaming){var c;do{c=this._encoder.encode(n,l)}while(c!==i);this._encoder=null}return new Uint8Array(r)}},U.prototype={decode:function(e,t){if(e&&!("buffer"in e&&"byteOffset"in e&&"byteLength"in e))throw new TypeError("Expected ArrayBufferView");e||(e=new Uint8Array(0)),t=Object(t),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(t.stream);var r=new n(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(_(function(e,t){return t.match([255,254])?(t.offset(2),"utf-16"):t.match([254,255])?(t.offset(2),"utf-16be"):t.match([239,187,191])?(t.offset(3),"utf-8"):e}(this._encoding.name,r))!==this._encoding)throw new Error("BOM mismatch");for(var o,s=new l;r.get()!==i;)null!==(o=this._decoder.decode(r))&&o!==a&&s.emit(o);if(!this._streaming){do{null!==(o=this._decoder.decode(r))&&o!==a&&s.emit(o)}while(o!==a);this._decoder=null}return s.string()}},e.TextEncoder=e.TextEncoder||k,e.TextDecoder=e.TextDecoder||U}(this),function(){"use strict";window.HumanAPI=function e(t){var r=this;"string"==typeof t&&(t={iframeId:t}),t.onReady=function(){r._ready=!0;for(var e=0,t=r._readyCallbacks.length;t>e;e++)r._readyCallbacks[e](),r._readyCallbacks.length=0},r._rpc=new e.WindowRPCClient(t),r._ready=!1,r._readyCallbacks=[]},HumanAPI.prototype.send=function(e,t,r){return"function"==typeof t&&(r=t,t={}),"function"==typeof r&&(r=r.bind(this)),this._rpc.call(e,t||{},r),this},HumanAPI.prototype.on=function(e,t){return"function"==typeof t&&(t=t.bind(this)),"human.ready"===e?(this._ready?t():this._readyCallbacks.push(t),this):(this._rpc.call("apiEvents.on",e,t,!1),this)},HumanAPI.prototype.once=function(e,t){return"function"==typeof t&&(t=t.bind(this)),"human.ready"===e?(this._ready?t():this._readyCallbacks.push(t),this):(this._rpc.call("apiEvents.once",e,t,!0),this)}}(),function(){"use strict";HumanAPI.Map=function(e,t){this.items=e||[];var r=(t||0)+1;this.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e=arguments[1],t}for(;;){e=arguments[0];var i=r++;if(!this.items[i])return this.items[i]=e,i}},this.removeItem=function(e){delete this.items[e]}}}(),function(){"use strict";HumanAPI.WindowRPCClient=function(e){if(!e.iframeId)throw"config expected: iframeId";if(this._iframe=document.getElementById(e.iframeId),!this._iframe)throw"iframe not found: '"+e.iframeId+"'";if(!this._iframe.contentWindow)throw"element is not an iframe: '"+e.iframeId+"'";this.destroyed=!1,this._handleMap=new HumanAPI.Map({},Date.now()),this._subs={},this._ready=!1,this._messageBuffer=[],this._messageBufferConnected=[],this._connect(e.onUnsupported,e.onConnected,e.onReady)},HumanAPI.WindowRPCClient.prototype._connect=function(e,t,r){var i=null,a=this,n=function(){o(),i=setInterval((function(){return!a.destroyed&&a._iframe&&a._iframe.contentWindow?void a._iframe.contentWindow.postMessage(JSON.stringify({action:"connect"}),"*"):void o()}),100)},o=function(){i&&(clearInterval(i),i=null)};window.addEventListener("message",(function(i){var n=i.data;switch(n){case"unsupported":"function"==typeof e&&e(i.data);break;default:var s;try{s=JSON.parse(n)}catch(u){return}if(s.message)switch(s.message){case"connected":a._connected=!0,a._sendQueuedMessages(!0),"function"==typeof t&&t();break;case"status":switch(s.status){case"ready":a._ready=!0,o(),a._sendQueuedMessages(),"function"==typeof r&&r()}}if(s.results||s.response){var l=s.results||s.response;for(var c in l)l.hasOwnProperty(c)&&a._subs[c]&&a.set(c,l[c])}}}),!1),a._iframe.addEventListener("load",n),a._iframe.addEventListener("unload",o),n()},HumanAPI.WindowRPCClient.prototype._sendQueuedMessages=function(e){for(var t=e?this._messageBufferConnected:this._messageBuffer;t.length>0;){var r=t.pop();this._send(r,r.ok,r.once)}},HumanAPI.WindowRPCClient.prototype.call=function(e,t,r,i){var a={call:e,params:t,ok:r,once:i},n=t.connected?this._messageBufferConnected:this._messageBuffer;this._ready||this._connected&&t.connected?this._send(a,r,i):n.unshift(a)},HumanAPI.WindowRPCClient.prototype._send=function(e,t,r){if(t){var i=this,a=this._on((function(e){(void 0===r||!0===r)&&i._off(a),t.call(i,e)}));e.id=a,this._sendMessage(e)}else this._sendMessage(e)},HumanAPI.WindowRPCClient.prototype._sendMessage=function(e){this._onSend&&this._onSend(e),this.destroyed||this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},HumanAPI.WindowRPCClient.prototype.set=function(e,t){var r=this._subs[e];r&&r.call(this,t)},HumanAPI.WindowRPCClient.prototype._on=function(e){var t=this._handleMap.addItem();return this._subs[t]=e,t},HumanAPI.WindowRPCClient.prototype._off=function(e){delete this._subs[e],this._handleMap.removeItem(e)},HumanAPI.WindowRPCClient.prototype.destroy=function(){this.destroyed=!0}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).immer={})}(this,(function(e){function t(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function r(e){return!!e&&!!e[G]}function i(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[j]||!!e.constructor[j]||c(e)||u(e))}function a(e,t,r){void 0===r&&(r=!1),0===n(e)?(r?Object.keys:X)(e).forEach((function(r){return t(r,e[r],e)})):e.forEach((function(r,i){return t(i,r,e)}))}function n(e){var t=e[G];return t?t.t>3?t.t-4:t.t:Array.isArray(e)?1:c(e)?2:u(e)?3:0}function o(e,t){return 2===n(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){return 2===n(e)?e.get(t):e[t]}function l(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function c(e){return B&&e instanceof Map}function u(e){return k&&e instanceof Set}function _(e){return e.i||e.u}function h(e,r){if(void 0===r&&(r=!1),Array.isArray(e))return e.slice();var i=Object.create(Object.getPrototypeOf(e));return a(e,(function(a){if(a!==G){var n=Object.getOwnPropertyDescriptor(e,a),o=n.value;n.get&&(r||t(1),o=n.get.call(e)),n.enumerable?i[a]=o:Object.defineProperty(i,a,{value:o,writable:!0,configurable:!0})}})),i}function f(e,t){r(e)||m(e)||!i(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=d),Object.freeze(e),t&&a(e,(function(e,t){return f(t,!0)}),!0))}function d(){t(2)}function m(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function p(e){var r=Y[e];return r||t(19,e),r}function g(e,t){Y[e]=t}function y(){return H}function v(e,t){t&&(p("Patches"),e.o=[],e.v=[],e.s=t)}function S(e){E(e),e.p.forEach(I),e.p=null}function E(e){e===H&&(H=e.h)}function b(e){return H={p:[],h:H,l:e,_:!0,m:0}}function I(e){var t=e[G];0===t.t||1===t.t?t.j():t.O=!0}function x(e,r){r.m=r.p.length;var a=r.p[0],n=void 0!==e&&e!==a;return r.l.S||p("ES5").P(r,e,n),n?(a[G].M&&(S(r),t(4)),i(e)&&(e=C(r,e),r.h||N(r,e)),r.o&&p("Patches").g(a[G],e,r.o,r.v)):e=C(r,a,[]),S(r),r.o&&r.s(r.o,r.v),e!==V?e:void 0}function C(e,t,r){if(m(t))return t;var i=t[G];if(!i)return a(t,(function(a,n){return T(e,i,t,a,n,r)}),!0),t;if(i.A!==e)return t;if(!i.M)return N(e,i.u,!0),i.u;if(!i.R){i.R=!0,i.A.m--;var n=4===i.t||5===i.t?i.i=h(i.k,!0):i.i;a(n,(function(t,a){return T(e,i,n,t,a,r)})),N(e,n,!1),r&&e.o&&p("Patches").F(i,r,e.o,e.v)}return i.i}function T(e,t,a,c,u,_){if(r(u)){var h=C(e,u,_&&t&&3!==t.t&&!o(t.D,c)?_.concat(c):void 0);if(d=c,m=h,2===(p=n(f=a))?f.set(d,m):3===p?(f.delete(d),f.add(m)):f[d]=m,!r(h))return;e._=!1}var f,d,m,p;if((!t||!l(u,s(t.u,c)))&&i(u)){if(!e.l.J&&e.m<1)return;C(e,u),t&&t.A.h||N(e,u)}}function N(e,t,r){void 0===r&&(r=!1),e.l.J&&e._&&f(t,r)}function D(e,t){var r=e[G],i=Reflect.getOwnPropertyDescriptor(r?_(r):e,t);return i&&i.value}function A(e){if(!e.M){if(e.M=!0,0===e.t||1===e.t){var t=e.i=h(e.u);a(e.p,(function(e,r){t[e]=r})),e.p=void 0}e.h&&A(e.h)}}function P(e){e.i||(e.i=h(e.u))}function M(e,t,r){var i=c(t)?p("MapSet").K(t,r):u(t)?p("MapSet").N(t,r):e.S?function(e,t){var r=Array.isArray(e),i={t:r?1:0,A:t?t.A:y(),M:!1,R:!1,D:{},h:t,u:e,k:null,p:{},i:null,j:null,$:!1},a=i,n=W;r&&(a=[i],n=q);var o=Proxy.revocable(a,n),s=o.revoke,l=o.proxy;return i.k=l,i.j=s,l}(t,r):p("ES5").C(t,r);return(r?r.A:y()).p.push(i),i}function w(e,t){e.S?A(t):p("ES5").I(t)}function R(){function e(e,t){var r=e[G];if(r&&!r.W){r.W=!0;var i=e[t];return r.W=!1,i}return e[t]}function n(e){e.M||(e.M=!0,e.h&&n(e.h))}function s(e){e.i||(e.i=c(e.u))}function c(e){var t=e&&e[G];if(t){t.W=!0;var r=h(t.k,!0);return t.W=!1,r}return h(e)}function u(e){for(var t=e.length-1;t>=0;t--){var r=e[t][G];if(!r.M)switch(r.t){case 5:d(r)&&n(r);break;case 4:f(r)&&n(r)}}}function f(e){for(var t=e.u,r=e.k,i=Object.keys(r),a=i.length-1;a>=0;a--){var n=i[a],s=t[n];if(void 0===s&&!o(t,n))return!0;var c=r[n],u=c&&c[G];if(u?u.u!==s:!l(c,s))return!0}return i.length!==Object.keys(t).length}function d(e){var t=e.k;if(t.length!==e.u.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}function m(e){e.O&&t(3,JSON.stringify(_(e)))}var p={};g("ES5",{C:function(t,r){var o=Array.isArray(t),u=c(t);a(u,(function(r){!function(t,r,a){var o=p[r];o?o.enumerable=a:p[r]=o={enumerable:a,get:function(){return function(t,r){m(t);var a=e(_(t),r);return t.W?a:a===e(t.u,r)&&i(a)?(s(t),t.i[r]=M(t.A.l,a,t)):a}(this[G],r)},set:function(t){!function(t,r,i){if(m(t),t.D[r]=!0,!t.M){if(l(i,e(_(t),r)))return;n(t),s(t)}t.i[r]=i}(this[G],r,t)}},Object.defineProperty(t,r,o)}(u,r,o||function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(!r||!r.enumerable)}(t,r))}));var h={t:o?5:4,A:r?r.A:y(),M:!1,W:!1,R:!1,D:{},h:r,u:t,k:u,i:null,O:!1,$:!1};return Object.defineProperty(u,G,{value:h,writable:!0}),u},I:n,P:function(e,t,i){e.p.forEach((function(e){e[G].W=!0})),i?r(t)&&t[G].A===e&&u(e.p):(e.o&&function e(t){if(t&&"object"==typeof t){var r=t[G];if(r){var i=r.u,s=r.k,l=r.D,c=r.t;if(4===c)a(s,(function(t){t!==G&&(void 0!==i[t]||o(i,t)?l[t]||e(s[t]):(l[t]=!0,n(r)))})),a(i,(function(e){void 0!==s[e]||o(s,e)||(l[e]=!1,n(r))}));else if(5===c){if(d(r)&&(n(r),l.length=!0),s.length<i.length)for(var u=s.length;u<i.length;u++)l[u]=!1;else for(var _=i.length;_<s.length;_++)l[_]=!0;for(var h=Math.min(s.length,i.length),f=0;f<h;f++)void 0===l[f]&&e(s[f])}}}}(e.p[0]),u(e.p))}})}function F(){function e(t){if(!t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);if(c(t))return new Map(Array.from(t.entries()).map((function(t){return[t[0],e(t[1])]})));if(u(t))return new Set(Array.from(t).map(e));var r=Object.create(Object.getPrototypeOf(t));for(var i in t)r[i]=e(t[i]);return r}function i(t){return r(t)?e(t):t}var l="add";g("Patches",{X:function(r,i){return i.forEach((function(i){for(var a=i.path,o=i.op,c=r,u=0;u<a.length-1;u++)"object"!=typeof(c=s(c,a[u]))&&t(15,a.join("/"));var _=n(c),h=e(i.value),f=a[a.length-1];switch(o){case"replace":switch(_){case 2:return c.set(f,h);case 3:t(16);default:return c[f]=h}case l:switch(_){case 1:return c.splice(f,0,h);case 2:return c.set(f,h);case 3:return c.add(h);default:return c[f]=h}case"remove":switch(_){case 1:return c.splice(f,1);case 2:return c.delete(f);case 3:return c.delete(i.value);default:return delete c[f]}default:t(17,o)}})),r},F:function(e,t,r,n){switch(e.t){case 0:case 4:case 2:return function(e,t,r,n){var c=e.u,u=e.i;a(e.D,(function(e,a){var _=s(c,e),h=s(u,e),f=a?o(c,e)?"replace":l:"remove";if(_!==h||"replace"!==f){var d=t.concat(e);r.push("remove"===f?{op:f,path:d}:{op:f,path:d,value:h}),n.push(f===l?{op:"remove",path:d}:"remove"===f?{op:l,path:d,value:i(_)}:{op:"replace",path:d,value:i(_)})}}))}(e,t,r,n);case 5:case 1:return function(e,t,r,a){var n=e.u,o=e.D,s=e.i;if(s.length<n.length){var c=[s,n];n=c[0],s=c[1];var u=[a,r];r=u[0],a=u[1]}for(var _=s.length-n.length,h=0;n[h]===s[h]&&h<n.length;)++h;for(var f=n.length;f>h&&n[f-1]===s[f+_-1];)--f;for(var d=h;d<f;++d)if(o[d]&&s[d]!==n[d]){var m=t.concat([d]);r.push({op:"replace",path:m,value:i(s[d])}),a.push({op:"replace",path:m,value:i(n[d])})}for(var p=r.length,g=f+_-1;g>=f;--g){var y=t.concat([g]);r[p+g-f]={op:l,path:y,value:i(s[g])},a.push({op:"remove",path:y})}}(e,t,r,n);case 3:return function(e,t,r,i){var a=e.u,n=e.i,o=0;a.forEach((function(e){if(!n.has(e)){var a=t.concat([o]);r.push({op:"remove",path:a,value:e}),i.unshift({op:l,path:a,value:e})}o++})),o=0,n.forEach((function(e){if(!a.has(e)){var n=t.concat([o]);r.push({op:l,path:n,value:e}),i.unshift({op:"remove",path:n,value:e})}o++}))}(e,t,r,n)}},g:function(e,t,r,i){r.push({op:"replace",path:[],value:t}),i.push({op:"replace",path:[],value:e.u})}})}function L(){function e(e,t){function r(){this.constructor=e}o(e,t),e.prototype=(r.prototype=t.prototype,new r)}function r(e){e.i||(e.D=new Map,e.i=new Map(e.u))}function a(e){e.i||(e.i=new Set,e.u.forEach((function(t){if(i(t)){var r=M(e.A.l,t,e);e.p.set(t,r),e.i.add(r)}else e.i.add(t)})))}function n(e){e.O&&t(3,JSON.stringify(_(e)))}var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},s=function(){function t(e,t){return this[G]={t:2,h:t,A:t?t.A:y(),M:!1,R:!1,i:void 0,D:void 0,u:e,k:this,$:!1,O:!1},this}e(t,Map);var a=t.prototype;return Object.defineProperty(a,"size",{get:function(){return _(this[G]).size}}),a.has=function(e){return _(this[G]).has(e)},a.set=function(e,t){var i=this[G];return n(i),_(i).get(e)!==t&&(r(i),w(i.A.l,i),i.D.set(e,!0),i.i.set(e,t),i.D.set(e,!0)),this},a.delete=function(e){if(!this.has(e))return!1;var t=this[G];return n(t),r(t),w(t.A.l,t),t.D.set(e,!1),t.i.delete(e),!0},a.clear=function(){var e=this[G];return n(e),r(e),w(e.A.l,e),e.D=new Map,e.i.clear()},a.forEach=function(e,t){var r=this;_(this[G]).forEach((function(i,a){e.call(t,r.get(a),a,r)}))},a.get=function(e){var t=this[G];n(t);var a=_(t).get(e);if(t.R||!i(a))return a;if(a!==t.u.get(e))return a;var o=M(t.A.l,a,t);return r(t),t.i.set(e,o),o},a.keys=function(){return _(this[G]).keys()},a.values=function(){var e,t=this,r=this.keys();return(e={})[z]=function(){return t.values()},e.next=function(){var e=r.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},a.entries=function(){var e,t=this,r=this.keys();return(e={})[z]=function(){return t.entries()},e.next=function(){var e=r.next();if(e.done)return e;var i=t.get(e.value);return{done:!1,value:[e.value,i]}},e},a[z]=function(){return this.entries()},t}(),l=function(){function t(e,t){return this[G]={t:3,h:t,A:t?t.A:y(),M:!1,R:!1,i:void 0,u:e,k:this,p:new Map,O:!1,$:!1},this}e(t,Set);var r=t.prototype;return Object.defineProperty(r,"size",{get:function(){return _(this[G]).size}}),r.has=function(e){var t=this[G];return n(t),t.i?!!t.i.has(e)||!(!t.p.has(e)||!t.i.has(t.p.get(e))):t.u.has(e)},r.add=function(e){var t=this[G];return n(t),this.has(e)||(a(t),w(t.A.l,t),t.i.add(e)),this},r.delete=function(e){if(!this.has(e))return!1;var t=this[G];return n(t),a(t),w(t.A.l,t),t.i.delete(e)||!!t.p.has(e)&&t.i.delete(t.p.get(e))},r.clear=function(){var e=this[G];return n(e),a(e),w(e.A.l,e),e.i.clear()},r.values=function(){var e=this[G];return n(e),a(e),e.i.values()},r.entries=function(){var e=this[G];return n(e),a(e),e.i.entries()},r.keys=function(){return this.values()},r[z]=function(){return this.values()},r.forEach=function(e,t){for(var r=this.values(),i=r.next();!i.done;)e.call(t,i.value,i.value,this),i=r.next()},t}();g("MapSet",{K:function(e,t){return new s(e,t)},N:function(e,t){return new l(e,t)}})}var O,H,J="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),B="undefined"!=typeof Map,k="undefined"!=typeof Set,U="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,V=J?Symbol("immer-nothing"):((O={})["immer-nothing"]=!0,O),j=J?Symbol("immer-draftable"):"__$immer_draftable",G=J?Symbol("immer-state"):"__$immer_state",z="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",X="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Y={},W={get:function(e,t){if(t===G)return e;var r=e.p;if(!e.M&&o(r,t))return r[t];var a=_(e)[t];if(e.R||!i(a))return a;if(e.M){if(a!==D(e.u,t))return a;r=e.i}return r[t]=M(e.A.l,a,e)},has:function(e,t){return t in _(e)},ownKeys:function(e){return Reflect.ownKeys(_(e))},set:function(e,t,r){if(!e.M){var i=D(e.u,t);if(r?l(i,r)||r===e.p[t]:l(i,r)&&t in e.u)return!0;P(e),A(e)}return e.D[t]=!0,e.i[t]=r,!0},deleteProperty:function(e,t){return void 0!==D(e.u,t)||t in e.u?(e.D[t]=!1,P(e),A(e)):e.D[t]&&delete e.D[t],e.i&&delete e.i[t],!0},getOwnPropertyDescriptor:function(e,t){var r=_(e),i=Reflect.getOwnPropertyDescriptor(r,t);return i&&(i.writable=!0,i.configurable=1!==e.t||"length"!==t),i},defineProperty:function(){t(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.u)},setPrototypeOf:function(){t(12)}},q={};a(W,(function(e,t){q[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),q.deleteProperty=function(e,t){return W.deleteProperty.call(this,e[0],t)},q.set=function(e,t,r){return W.set.call(this,e[0],t,r,e[0])};var Q=function(){function e(e){this.S=U,this.J=!1,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var a=e.prototype;return a.produce=function(e,r,a){if("function"==typeof e&&"function"!=typeof r){var n=r;r=e;var o=this;return function(e){var t=this;void 0===e&&(e=n);for(var i=arguments.length,a=Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return o.produce(e,(function(e){var i;return(i=r).call.apply(i,[t,e].concat(a))}))}}var s;if("function"!=typeof r&&t(6),void 0!==a&&"function"!=typeof a&&t(7),i(e)){var l=b(this),c=M(this,e,void 0),u=!0;try{s=r(c),u=!1}finally{u?S(l):E(l)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return v(l,a),x(e,l)}),(function(e){throw S(l),e})):(v(l,a),x(s,l))}if((s=r(e))!==V)return void 0===s&&(s=e),this.J&&f(s,!0),s},a.produceWithPatches=function(e,t){var r,i,a=this;return"function"==typeof e?function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return a.produceWithPatches(t,(function(t){return e.apply(void 0,[t].concat(i))}))}:[this.produce(e,t,(function(e,t){r=e,i=t})),r,i]},a.createDraft=function(e){i(e)||t(8);var r=b(this),a=M(this,e,void 0);return a[G].$=!0,E(r),a},a.finishDraft=function(e,t){var r=(e&&e[G]).A;return v(r,t),x(void 0,r)},a.setAutoFreeze=function(e){this.J=e},a.setUseProxies=function(e){U||t(20),this.S=e},a.applyPatches=function(e,t){var i;for(i=t.length-1;i>=0;i--){var a=t[i];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}var n=p("Patches").X;return r(e)?n(e,t):this.produce(e,(function(e){return n(e,t.slice(i+1))}))},e}(),K=new Q,Z=K.produce,$=K.produceWithPatches.bind(K),ee=K.setAutoFreeze.bind(K),te=K.setUseProxies.bind(K),re=K.applyPatches.bind(K),ie=K.createDraft.bind(K),ae=K.finishDraft.bind(K);e.Immer=Q,e.applyPatches=re,e.castDraft=function(e){return e},e.castImmutable=function(e){return e},e.createDraft=ie,e.default=Z,e.enableAllPlugins=function(){R(),L(),F()},e.enableES5=R,e.enableMapSet=L,e.enablePatches=F,e.finishDraft=ae,e.immerable=j,e.isDraft=r,e.isDraftable=i,e.nothing=V,e.original=function(e){if(e&&e[G])return e[G].u},e.produce=Z,e.produceWithPatches=$,e.setAutoFreeze=ee,e.setUseProxies=te,Object.defineProperty(e,"__esModule",{value:!0})}));