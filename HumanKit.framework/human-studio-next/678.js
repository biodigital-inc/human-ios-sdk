(self.webpackChunkweb=self.webpackChunkweb||[]).push([[678],{57535:(ie,j,o)=>{"use strict";o.d(j,{C6:()=>g,DT:()=>b,EA:()=>ve,Fg:()=>$,Fq:()=>s,Ir:()=>u,MH:()=>oe,Mj:()=>O,U8:()=>x,Vs:()=>w,hG:()=>S,jQ:()=>z,qA:()=>B,qg:()=>A,t0:()=>q,xM:()=>V,yB:()=>M});var e=o(38970),h=o(49204),a=o(59429);const T={type:e.Po.Cube,direction:e.zu.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},B=[e.lc.ShapeBounce,e.lc.ShapeKill,e.lc.ShapeStop],$={[e.lc.LifetimeKill]:{type:e.lc.LifetimeKill},[e.lc.LifetimeStop]:{type:e.lc.LifetimeStop},[e.lc.PathKill]:{type:e.lc.PathKill},[e.lc.PathStop]:{type:e.lc.PathStop},[e.lc.PathRadius]:{type:e.lc.PathRadius},[e.lc.ShapeBounce]:{type:e.lc.ShapeBounce,trap:!1,shape:{...T}},[e.lc.ShapeKill]:{type:e.lc.ShapeKill,trap:!1,shape:{...T}},[e.lc.ShapeStop]:{type:e.lc.ShapeStop,trap:!1,shape:{...T}}},O={[e.Uy.DirectionalVelocity]:{type:e.Uy.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[e.Uy.Lifetime]:{type:e.Uy.Lifetime,average:2.5,variance:1},[e.Uy.PointPosition]:{type:e.Uy.PointPosition,position:[0,0,0]},[e.Uy.RandomVelocity]:{type:e.Uy.RandomVelocity,forceAverage:5,forceVariance:0},[e.Uy.SpherePosition]:{type:e.Uy.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.CylinderPosition]:{type:e.Uy.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.CubePosition]:{type:e.Uy.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.RandomRotation]:{type:e.Uy.RandomRotation,average:0,variance:0},[e.Uy.RandomRotationSpeed]:{type:e.Uy.RandomRotationSpeed,average:0,variance:180},[e.Uy.RandomScale]:{type:e.Uy.RandomScale,average:1,variance:0},[e.Uy.SpriteAnimationDuration]:{type:e.Uy.SpriteAnimationDuration,average:1,variance:0}},U={[e.$t.AgeColorBlend]:{type:e.$t.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[e.$t.BrownianMotion]:{type:e.$t.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[e.$t.UniformForce]:{type:e.$t.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[e.$t.RadialForce]:{type:e.$t.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[e.$t.Friction]:{type:e.$t.Friction,friction:.1},[e.$t.Gravity]:{type:e.$t.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[e.$t.Path]:{type:e.$t.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[e.$t.AxisForce]:{type:e.$t.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[e.$t.SpriteAnimation]:{type:e.$t.SpriteAnimation}},g={type:e.Po.Sphere,direction:e.zu.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},b={baseColor:{r:1,g:0,b:0},alpha:1},M={spriteRows:8,spriteCols:8,spriteStartFrame:0,spriteEndFrame:63},s={layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},d={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{...s},constraints:[$[e.lc.LifetimeKill]],creators:[O[e.Uy.PointPosition],O[e.Uy.RandomVelocity],O[e.Uy.Lifetime]],updaters:[U[e.$t.AgeColorBlend],U[e.$t.Friction]]},f={...d,material:b,...M};function w(){const v=JSON.parse(JSON.stringify(d)),{constraints:X,creators:C,updaters:k}=v;return{...v,constraints:X.map((N,re)=>({...N,id:a.u.idWithPrefix("constraint")})),creators:C.map((N,re)=>({...N,id:a.u.idWithPrefix("creator")})),updaters:k.map((N,re)=>({...N,id:a.u.idWithPrefix("updater")}))}}function S(v){return{...$[v]}}function x(v){return{...O[v]}}function z(v){return{...U[v]}}function Z(v){return(0,h.omitBy)(v,h.isNil)}function u(v){return Z(function le(v){return Object.keys(f).reduce((X,C)=>(X[C]=v[C],X),{})}(v))}function A(v,X){return Z(function he(v,X){const{id:C,name:k,shape:N,trap:re}=X;return B.includes(v)?{id:C,name:k,type:v,trap:re,shape:N}:{id:C,name:k,type:v}}(v,X))}function V(v,X){return Z(function L(v,X){const{id:C,name:k,directionAverage:N,forceAverage:re,directionVariance:pe,forceVariance:E,average:D,variance:P,position:F,scale:_,rotate:se,translate:R}=X;switch(v){case e.Uy.DirectionalVelocity:return{id:C,name:k,type:v,directionAverage:N,forceAverage:re,directionVariance:pe,forceVariance:E};case e.Uy.Lifetime:return{id:C,name:k,type:v,average:D,variance:P};case e.Uy.PointPosition:return{id:C,name:k,type:v,position:F};case e.Uy.RandomVelocity:return{id:C,name:k,type:v,forceAverage:re,forceVariance:E};case e.Uy.SpherePosition:case e.Uy.CylinderPosition:case e.Uy.CubePosition:return{id:C,name:k,type:v,scale:_,rotate:se,translate:R};case e.Uy.RandomRotation:case e.Uy.RandomRotationSpeed:case e.Uy.RandomScale:case e.Uy.SpriteAnimationDuration:return{id:C,name:k,type:v,average:D,variance:P};default:return}}(v,X))}function oe(v,X){return Z(function p(v,X){const{id:C,name:k,colors:N,position:re,direction:pe,friction:E,frequency:D,forceAverage:P,radius:F,forceVariance:_,nodes:se,shape:R,directionAverage:H,directionVariance:ue}=X;switch(v){case e.$t.AgeColorBlend:return{id:C,name:k,type:v,colors:N,shape:R};case e.$t.BrownianMotion:return{id:C,name:k,type:v,frequency:D,forceAverage:P,forceVariance:_,shape:R};case e.$t.UniformForce:return{id:C,name:k,type:v,directionAverage:H,forceAverage:P,directionVariance:ue,forceVariance:_,shape:R};case e.$t.RadialForce:return{id:C,name:k,type:v,position:re,forceAverage:P,forceVariance:_,shape:R};case e.$t.Friction:return{id:C,name:k,type:v,friction:E,shape:R};case e.$t.Gravity:return{id:C,name:k,type:v,position:re,radius:F,forceAverage:P,forceVariance:_,shape:R};case e.$t.Path:return{id:C,name:k,type:v,nodes:se,shape:R};case e.$t.AxisForce:return{id:C,name:k,type:v,position:re,direction:pe,forceAverage:P,forceVariance:_,shape:R};case e.$t.SpriteAnimation:return{id:C,name:k,type:v};default:return}}(v,X))}function q(v,X){return![e.lc.PathKill,e.lc.PathRadius,e.lc.PathStop].includes(X)||v.updaters.some(N=>N.type===e.$t.Path)}function ve(v){return(0,h.omit)(v,["materialId","material","textures"])}},97307:(ie,j,o)=>{"use strict";o.d(j,{_:()=>K});var e=o(54438),h=o(92014),m=o(47610),a=o(76304),T=o(85052),B=o(29160),$=o(76718),O=o(82656),U=o(35426),g=o(2573),b=o(14264),M=o(17365),s=o(37925),d=o(87996),f=o(36110),w=o(94909),S=o(81027),x=o(15210),z=o(66196),Z=o(67584),le=o(8360),he=o(17106),L=o(82733),u=o(1670),A=o(21082),V=o(2094),oe=o(79805),q=o(24418),ve=o(3266),v=o(4664),X=o(47555),C=o(94495),k=o(60286),N=o(7431),re=o(57021),pe=o(3829),E=o(62943),D=o(13409),P=o(515),F=o(65294),_=o(22679),se=o(30327),R=o(20458),H=o(13878),ue=o(49188),ae=o(27180),Pe=o(61295),Oe=o(63365),ee=o(49204),Ce=o(28931),De=o(12921);class Be{constructor(t,i){this.store=t,this.particleSystemsService=i,this.ngUnsubscribe=new T.B,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const t=this.store.select(De.B.getParticleSystems),i=this.store.select(De.B.getVisisbleParticleSystems);(0,O.z)([t,i]).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(([n])=>{const r=this.store.selectSnapshot(C.N.getSelectedChapterId),l=this.store.selectSnapshot(De.B.getVisibleParticleSystemsForChapter(r));this.particleSystemsService.setEngineParticles(n,r,l)})}}var Le=o(38753),ke=o(95419),we=o(17215),$e=o(93815),Xe=o(46799),Ve=o(76724),Ne=o(35650),Ee=o(11724),je=o(12215),Ke=o(66056),We=o(12347),Te=o(41373),Ye=o(41623),ze=o(38472),Qe=o(51196),Re=o(32724),_e=o(46842),Ge=o(38645),He=o(83621),Ze=o(18617),Ue=o(60177),Je=o(81391),qe=o(25209),et=o(76037),tt=o(82109),nt=o(77428);let it=(()=>{class c{constructor(i,n){this.store=i,this.changeDetectorRef=n,this.ngUnsubscribe=new T.B,this.storyLoadProgress=0}ngOnInit(){const i=this.store.select(tt.N.getChaptersLoadProgress),n=this.store.select(_.t.getLoadingChapter);(0,O.z)(i,n).pipe((0,b.p)(()=>{const r=this.store.selectSnapshot(_.t.getLoadChapters);return!(0,ee.isNil)(r)&&r.length>0}),(0,s.Q)(this.ngUnsubscribe)).subscribe(([r,l])=>{const y=this.store.selectSnapshot(C.N.getSelectedChapterId),I=!(0,ee.isNil)(l)&&l.chapterId===y;this.storyLoadProgress=I?r[y]??0:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(h.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-engine-progress"]],decls:1,vars:3,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(n,r){1&n&&e.nrm(0,"app-progress",0),2&n&&(e.Y8G("value",r.storyLoadProgress)("total",1),e.BMQ("data-progress",r.storyLoadProgress))},dependencies:[nt.X],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0})}return c})();var te=o(49969);function st(c,t){if(1&c){const i=e.RV6();e.j41(0,"div",1),e.bIt("@show.done",function(){e.eBV(i);const r=e.XpG();return e.Njj(r.onShowDone())}),e.j41(1,"div",2),e.EFF(2,"Use control + scroll to zoom"),e.k0s()()}2&c&&e.Y8G("@show",void 0)}let ot=(()=>{class c{constructor(i,n){this.actions=i,this.changeDetectorRef=n,this.ngUnsubscribe=new T.B,this.show=!1}ngOnInit(){this.actions.pipe((0,h.xi)(m.JK),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(h.En),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(n,r){1&n&&e.DNE(0,st,3,1,"div",0),2&n&&e.Y8G("ngIf",r.show)},dependencies:[Ue.bT],styles:[".engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:#10182380;font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,te.hZ)("show",[(0,te.kY)(":enter",[(0,te.K2)([(0,te.iF)({opacity:"*"}),(0,te.i0)("500ms ease-in-out",(0,te.iF)({opacity:1})),(0,te.i0)("500ms 2000ms ease-in-out",(0,te.iF)({opacity:0}))])])])]},changeDetection:0})}return c})();const rt=(c,t)=>({backgroundColor:c,duration:t}),at=(c,t)=>({value:c,params:t}),ct=(0,te.lY)([(0,te.iF)({opacity:"0",backgroundColor:"*"}),(0,te.K2)([(0,te.i0)("{{ duration }}ms {{ easing }}",(0,te.iF)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,te.i0)("250ms 500ms ease-in",(0,te.iF)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let lt=(()=>{class c{constructor(i,n,r){this.actions=i,this.changeDetectorRef=n,this.store=r,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new T.B}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,h.xi)(m.zW),(0,s.Q)(this.ngUnsubscribe)).subscribe(i=>{this.fadeIn(i.color,i.duration)})}handleFadeComplete(){this.store.dispatch(new m.In),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(i,n){this.isVisible=!0,this.color=i,this.duration=1e3*n,this.changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(h.En),e.rXU(e.gRc),e.rXU(h.il))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(n,r){1&n&&(e.j41(0,"div",0),e.bIt("@fade.done",function(){return r.handleFadeComplete()}),e.k0s()),2&n&&e.Y8G("@fade",e.l_i(4,at,r.isVisible,e.l_i(1,rt,r.color,r.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,te.hZ)("fade",[(0,te.kY)("* => true",(0,te.sM)(ct))])]},changeDetection:0})}return c})();var ht=o(9065),pt=o(81642);let dt=(()=>{class c{constructor(i,n,r,l){this.engineService=i,this.cameraService=n,this.numberService=r,this.changeDetectionRef=l,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(P.X.CameraUpdated).pipe((0,ht.Z)(50)).subscribe(i=>{const n=this.numberService.roundModel(i.eye,0),{x:r,y:l,z:y}=n,I=Math.floor(100*this.cameraService.getCameraZoom()),Y=this.numberService.roundNumber(i.dist,0);this.camera={x:r,y:l,z:y,zoom:I,dist:Y},this.changeDetectionRef.markForCheck()})}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(oe.y),e.rXU(ve.j),e.rXU(pt.D),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(n,r){1&n&&(e.j41(0,"div",0),e.EFF(1),e.k0s()),2&n&&(e.R7$(),e.SjE(" X:",null==r.camera?null:r.camera.x," Y:",null==r.camera?null:r.camera.y," Z:",null==r.camera?null:r.camera.z," Dist:",null==r.camera?null:r.camera.dist," Zoom:",null==r.camera?null:r.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0})}return c})();var Ae=o(90413);let ut=(()=>{class c{constructor(i){this.store=i}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger().openMenu()}onNodeActionsClosed(){this.store.dispatch(new m.fZ(null,null))}getNodeActionsStyles(){const i=this.hit?.canvasPos;return{"left.px":i?.x??0,"top.px":i?.y??0}}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(h.il))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-engine-contextmenu"]],viewQuery:function(n,r){if(1&n&&e.GBs(Ae.D,7),2&n){let l;e.mGM(l=e.lsd())&&(r.nodeActionsComponent=l.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"nodeActionsClosed","ngStyle","node"]],template:function(n,r){1&n&&(e.j41(0,"div",0)(1,"app-node-actions",1),e.bIt("nodeActionsClosed",function(){return r.onNodeActionsClosed()}),e.k0s()()),2&n&&(e.R7$(),e.Y8G("ngStyle",r.getNodeActionsStyles())("node",r.node))},dependencies:[Ue.B3,Ae.D],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]})}return c})();var Q=function(c,t,i,n){var y,r=arguments.length,l=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(c,t,i,n);else for(var I=c.length-1;I>=0;I--)(y=c[I])&&(l=(r<3?y(l):r>3?y(t,i,l):y(t,i))||l);return r>3&&l&&Object.defineProperty(t,i,l),l},G=function(c,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(c,t)};const gt=["engine"],ft=c=>({"engine--hidden":c});function mt(c,t){1&c&&e.nrm(0,"div",2)}function vt(c,t){1&c&&e.nrm(0,"app-labels")}function yt(c,t){if(1&c&&e.nrm(0,"app-engine-contextmenu",3),2&c){const i=e.XpG();e.Y8G("node",i.contextMenuNode)("hit",i.contextMenuHit)}}function bt(c,t){1&c&&e.nrm(0,"div",4)}function St(c,t){1&c&&e.nrm(0,"app-engine-progress",5)}function Pt(c,t){if(1&c&&(e.j41(0,"div",6),e.nrm(1,"app-engine-stats",7),e.nI1(2,"async"),e.k0s()),2&c){const i=e.XpG(),n=e.sdS(1);e.Y8G("cdkDragBoundary",n),e.R7$(),e.Y8G("theme",i.isBackgroundLight?"light":"dark")("showAdvancedTools",e.bMT(2,3,i.showAdvancedTools$))}}function Ct(c,t){1&c&&e.nrm(0,"app-engine-camera-position")}var Se=function(c){return c[c.Pan=.4]="Pan",c[c.PanSlow=.04]="PanSlow",c[c.Zoom=5]="Zoom",c[c.ZoomSlow=1]="ZoomSlow",c[c.Rotate=.3]="Rotate",c[c.RotateSlow=.03]="RotateSlow",c}(Se||{}),fe=function(c){return c[c.Rotate=6]="Rotate",c[c.Pan=1.75]="Pan",c[c.Zoom=2.5]="Zoom",c}(fe||{}),ne=function(c){return c[c.Zoom=-6]="Zoom",c[c.TrackZoom=.5]="TrackZoom",c[c.Pan=1.25]="Pan",c[c.Rotate=1.5]="Rotate",c[c.Friction=.85]="Friction",c[c.ZoomFriction=.85]="ZoomFriction",c[c.FrictionThreshold=.002]="FrictionThreshold",c}(ne||{}),ye=function(c){return c.Fade="engine--cursor-fade",c.Hide="engine--cursor-hide",c.Label="engine--cursor-label",c.Paint="engine--cursor-paint",c.Eyedropper="engine--cursor-eyedropper",c.Crosshair="engine--cursor-crosshair",c.Default="",c}(ye||{}),Fe=function(c){return c[c.None=0]="None",c[c.Left=1]="Left",c[c.Right=2]="Right",c[c.LeftAndRight=4]="LeftAndRight",c}(Fe||{});const Ie=1e3/60;class K{wheel(t){const i=this.store.selectSnapshot(a.S.getScrollMode),n=t.ctrlKey;i===H.M.DoNotCaptureShowMessage&&!n&&this.store.dispatch(new m.JK(!0)),(i===H.M.Capture||n)&&(t.preventDefault(),this.handleWheel(t))}onContextMenu(t){this.contextMenuEnable()&&this.handleContextMenu(t)}onMouseOut(){this.handleMouseOut()}onDocumentClick(t){const i=t.target,n=document.getElementById("container");this.hasFocus=n.contains(i)}constructor(t,i,n,r,l,y,I,Y,W,J,ce,de,be,ge,Me,me,xe,Mt){this.actions=t,this.activatedRoute=i,this.animationService=n,this.cameraService=r,this.changeDetecton=l,this.engineService=y,this.xrService=I,this.sceneService=Y,this.mediaService=W,this.paintService=J,this.renderer=ce,this.storageService=de,this.store=be,this.applicationEventService=ge,this.particleSystemsService=Me,this.engineRendererService=me,this.clippingPlanesService=xe,this.liveAnnouncer=Mt,this.VERSION=Ee.VERSION,this.hasFocus=!1,this.flyCamera=!0,this.visible=!1,this.application=ae.c,this.cursorClass=ye.Default,this.chapterReady=!1,this.ngUnsubscribe=new T.B,this.display=!1,this.engineVisible=!0,this.inputEnabled=(0,e.hFB)(!0),this.contextMenuEnable=(0,e.hFB)(!0),this.background=new B.t(null),this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,q.c.application===ae.c.Loft&&o.e(361).then(o.t.bind(o,5361,23)).then(Ut=>{window.pako=Ut}),this.showDebug=q.c.application===ae.c.Loft||"true"===this.storageService.getLocalItem(we.UT.CameraDebug),q.c.deploy===je.Z.Production&&(q.c.application===ae.c.Studio||q.c.application===ae.c.Viewer)||console.table({Commit:Ee.COMMIT,Time:new Date(Ee.TIMESTAMP).toLocaleString(),Version:Ee.VERSION})}convertToLeafStateMap(t,i){const n={};return Object.entries(i).forEach(([r,l])=>{n[r]={},n[r][t]=l}),n}ngOnInit(){this.particleStateListener=new Be(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initVideo(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.particleStateListener.destroy(),this.engineService.destroyEngine(),this.animationService.destroyPlayer(),this.xrService.destroyXR(),this.canvas?.remove(),this.canvas=null,this.changeDetecton.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const t=this.store.selectSnapshot(a.S.getWebGLContextName),i=this.activatedRoute.snapshot.queryParams.disableTextureCompression,n="true"===i||i?.split(",").reduce((r,l)=>({...r,[l.trim().toLowerCase()]:!0}),{});this.engineService.initEngine({contextName:t,disableTextureCompression:n}),this.canvas=this.engineRendererService.getCanvas(),this.canvas.style.zIndex="1",this.canvas.dataset.test="engineCanvas",this.engineElement.nativeElement.prepend(this.canvas),this.xrEnabled$.pipe((0,b.p)(r=>r),(0,M.s)(1),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.xrService.initXR(this.engineService.engine)})}bindEngineEvents(){this.engineService.getEvent(P.X.Loaded).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new m.AU(!0))}),this.engineService.getEvent(P.X.TimelineChapterTransition).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(F.F.LabelsChapterInfo,this.store.selectSnapshot(Le.y.getChapterLabels))}),(0,$.h)(this.engineService.getEvent(P.X.TimelinePlayed),this.engineService.getEvent(P.X.TimelinePaused)).pipe((0,s.Q)(this.ngUnsubscribe),(0,b.p)(()=>null!=this.store.selectSnapshot(C.N.getSelectedChapterId)),(0,d.B)(50),(0,f.T)(()=>this.animationService.isPlaying())).subscribe(t=>{this.store.dispatch(new m.jM(t))}),this.engineService.getEvent(P.X.Tick).pipe((0,b.p)(()=>this.visible&&!(0,ee.isNil)(this.engineService.engine?.story)),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.inputEnabled()&&this.handleMouseInputEngineTick(t),this.handleCameraTick(t),this.deltaTime=window.performance.now()}),this.engineService.getEvent(P.X.TweenVisibilityUpdate).pipe((0,w.E)(this.store.select(C.N.getIsChapterAnimated),this.store.select(C.N.getSelectedChapterModelReady)),(0,b.p)(([t,i,n])=>i&&n&&Object.keys(t).length>0),(0,s.Q)(this.ngUnsubscribe)).subscribe(([t])=>{const i=[],n=[];Object.entries(t).forEach(([r,l])=>{l?i.push(r):n.push(r)}),i.length>0&&this.store.dispatch(new Pe.LV(!0,i)),n.length>0&&this.store.dispatch(new Pe.LV(!1,n)),this.applyShownPatches(t,!1)}),this.engineService.getEvent(P.X.VariantsUpdate).pipe((0,b.p)(t=>Object.keys(t).length>0),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applyVariantPatches(t,!0,!1,!1)}),this.engineService.getEvent(P.X.SceneObjectRenderable).pipe(function p(c,...t){var i,n;const r=null!==(i=(0,he.lI)(t))&&void 0!==i?i:le.E,l=null!==(n=t[0])&&void 0!==n?n:null,y=t[1]||1/0;return(0,x.N)((I,Y)=>{let W=[],J=!1;const ce=ge=>{const{buffer:Me,subs:me}=ge;me.unsubscribe(),(0,Z.o)(W,ge),Y.next(Me),J&&de()},de=()=>{if(W){const ge=new S.yU;Y.add(ge);const me={buffer:[],subs:ge};W.push(me),(0,L.N)(ge,r,()=>ce(me),c)}};null!==l&&l>=0?(0,L.N)(Y,r,de,l,!0):J=!0,de();const be=(0,z._)(Y,ge=>{const Me=W.slice();for(const me of Me){const{buffer:xe}=me;xe.push(ge),y<=xe.length&&ce(me)}},()=>{for(;W?.length;)Y.next(W.shift().buffer);be?.unsubscribe(),Y.complete(),Y.unsubscribe()},void 0,()=>W=null);I.subscribe(be)})}(1e3),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t.length){const i={};t.forEach(n=>{i[n.objectId]={renderable:!0}}),this.store.dispatch(new m.GT(i))}}),this.engineService.getEvent(P.X.AssetsLoadProgress).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(({chapterId:t,chapterProgress:i})=>{const n=this.store.selectSnapshot(_.t.getLoadChapters).length,y=1/n,W=i*y+(n-Math.max(this.store.selectSnapshot(_.t.getLoadChaptersRemaining).length,1))*y;this.progress=W.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new se.m(W,t,i))}),this.engineService.getEvent(P.X.CameraUpdated).pipe((0,b.p)(()=>!this.cameraAnimating),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(P.X.CameraRested).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,h.xi)(Ke.dC),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,b.p)(t=>null!=t),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.enginePosition=t,this.repositionEngine(t)}),this.store.select(a.S.getXrayModeEnabled).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=this.store.selectSnapshot(D.z.getCheckedNodes),n=this.store.selectSnapshot(D.z.getNodes),r=this.store.selectSnapshot(a.S.getViewGraph);!1===t?(Object.keys(n||[]).forEach(l=>{this.paintService.paint(r,l,n[l].paint)}),i.forEach(l=>this.paintService.highlight(r,l.objectId,!0))):(this.paintService.paintAll(r,Object.keys(n),R.EC),this.paintService.paintAll(r,i.map(l=>l.objectId),R.NR))}),this.actions.pipe((0,h.xi)(m.K6),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.display=t,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.engineVisible=t,this.changeDetecton.markForCheck()}),this.contextMenu$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.contextMenuNode=t.node,this.contextMenuHit=t.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,b.p)(t=>!(0,ee.isNil)(t)),(0,u.J)(),(0,s.Q)(this.ngUnsubscribe)).subscribe(([t,i])=>{const n=this.store.selectSnapshot(a.S.getChapter);if(this.store.selectSnapshot(C.N.getSelectedChapterReadyState).model){const y=i.id;if(t.id===y&&n===y)return;this.animationService.setChapter(y).then(()=>{this.store.dispatch(new Pe.IA(y)),(0,ue.q)(this.store,this.engineService),this.store.dispatch(new N.Yp(void 0))})}}),(0,O.z)([this.clippingPlanes$,this.readyState$]).pipe((0,b.p)(([t,i])=>!(0,ee.isNil)(t)&&!0===i?.model),(0,A.F)(ee.isEqual),(0,d.B)(0),(0,s.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.clippingPlanesService.setClippingPlanes(t)}),(0,O.z)([this.selectedChapterId$,this.readyState$,this.autoplay$,this.prefersReducedMotion$]).pipe((0,b.p)(([t,i,n,r])=>!((0,ee.isNil)(t)||(0,ee.isNil)(i)||(0,ee.isNil)(n)||(0,ee.isNil)(r))),(0,s.Q)(this.ngUnsubscribe)).subscribe(([,t,i,n])=>{const r=(0,ee.get)(t,"animation",!1),l=this.store.selectSnapshot(C.N.getSelectedChapter),y=(0,ee.get)(l,"ui.play.autoplay",!0),I=r&&i&&y&&!n;this.store.dispatch(new m.A6),this.store.dispatch(new m.dE(I))})}bindCameraEvents(){this.actions.pipe((0,h.xi)(N.Ih,m.W6),(0,b.p)(t=>!!(t instanceof N.Ih?t.camera:t.objectId)),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=!this.store.selectSnapshot(_e.U.getPrefersReducedMotion)&&t.animate;let n;n=t instanceof N.Ih?i?this.flyToCamera(t.camera,t.animationDuration):this.jumpToCamera(t.camera):i?this.flyToObject(t.objectId,t.animationDuration):this.jumpToObject(t.objectId),n.then(()=>{this.liveAnnouncer.announce("Camera Postion Updated"),this.store.dispatch(new N.Nz),t instanceof N.Ih&&t.rotationCenter&&this.cameraService.setCameraRotationCenter(t.rotationCenter)})}),this.actions.pipe((0,h.xi)(N.bB),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.panCameraStatic(t.x,t.y,t.z)}),this.actions.pipe((0,h.xi)(N.RJ),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.rotateCameraStatic(t.x,t.y)}),this.actions.pipe((0,h.xi)(N.F5),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.setAbsoluteZoom(t.value)})}bindToolEvents(){this.activeTool$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(Object.values(ye).forEach(i=>{i&&this.renderer.removeClass(this.engineElement.nativeElement,i)}),t){case X.s.Fade:this.renderer.addClass(this.engineElement.nativeElement,ye.Fade);break;case X.s.Hide:this.renderer.addClass(this.engineElement.nativeElement,ye.Hide);break;case X.s.Label:this.renderer.addClass(this.engineElement.nativeElement,ye.Label);break;case X.s.Paint:this.renderer.addClass(this.engineElement.nativeElement,ye.Paint);break;case X.s.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,ye.Eyedropper)}})}bindMouseEvents(){this.mouseMove$=(0,U.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleMousePan(t)}),this.mouseMove$.pipe((0,w.E)(this.store.select(a.S.getHoverPickEnabled)),(0,V.c)(10),(0,b.p)(([,t])=>t),(0,s.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.handleMouseHover(t)}),this.mouseLeave$=(0,U.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,V.c)(10),(0,s.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(t){return(0,U.R)(window,t).pipe((0,b.p)(()=>this.hasFocus))}bindKeyEvents(){const t=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((r,l)=>(r[l]=!1,r),{}),i=new B.t(t);let n;this.bindWindowKeyEvent("keydown").pipe((0,b.p)(r=>!(r.repeat||r.metaKey||r.ctrlKey)),(0,b.p)(r=>{const y=r.target.nodeName.toLowerCase();return!(["input","textarea","select","option","button"].indexOf(y)>=0)}),(0,s.Q)(this.ngUnsubscribe)).subscribe(r=>{i.next({...i.value,[r.key.toLowerCase()]:!0,shiftKey:r.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,b.p)(r=>!!r.key),(0,s.Q)(this.ngUnsubscribe)).subscribe(r=>{1===Object.values(n).filter(y=>!0===y).length?(this.applyMotion(n,!0),i.next({...i.value,[r.key.toLowerCase()]:!1,shiftKey:r.shiftKey,hasMomentum:!1===n.shiftKey})):i.next({...i.value,[r.key.toLowerCase()]:!1,shiftKey:r.shiftKey,hasMomentum:!1})}),i.pipe((0,b.p)(()=>this.inputEnabled()),(0,s.Q)(this.ngUnsubscribe)).subscribe(r=>{n=r,!1===r.hasMomentum&&this.applyMotion(r,!1)})}applyMotion(t,i){const n=new re.x,r=t.shiftKey?Se.ZoomSlow:Se.Zoom,l=t.shiftKey?Se.PanSlow:Se.Pan,y=t.shiftKey?Se.RotateSlow:Se.Rotate;n.zoom+=t.c||t["-"]||t._?r:0,n.zoom-=t.e||t["="]||t["+"]?r:0,n.panX-=t.d?l:0,n.panX+=t.a?l:0,n.panY+=t.w?l:0,n.panY-=t.s?l:0,n.rotateX-=t.arrowright?y:0,n.rotateX+=t.arrowleft?y:0,n.rotateY+=t.arrowup?y:0,n.rotateY-=t.arrowdown?y:0,n.applyFriction=i,this.store.dispatch(new N.P4(n))}initChangeListener(){this.nodeStatePatches$.pipe((0,b.p)(t=>t.length>0),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=t.reduce((J,ce)=>{const de=ce.path[ce.path.length-1];return void 0!==J[de]&&J[de].push(ce),J},{available:[],shown:[],checked:[],paint:[],pickable:[],variant:[]}),n=J=>i[J].reduce((ce,de)=>(ce[de.path[2]]=de.value,ce),{}),r=n("available"),l=n("checked"),y=n("shown"),I=n("paint"),Y=n("pickable"),W=n("variant");(0,ee.isEmpty)(r)||this.applyAvailablePatches(r),(0,ee.isEmpty)(y)||this.applyShownPatches(y,!0),(0,ee.isEmpty)(l)||this.applyCheckedPatches(l),(0,ee.isEmpty)(I)||this.applyPaintPatches(I),(0,ee.isEmpty)(Y)||this.applyPickablePatches(Y),(0,ee.isEmpty)(W)||this.applyVariantPatches(W,!1,!0,!0)})}initBackgroundListener(){(0,O.z)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(([t,i,n])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",(0,E.tH)(t)),this.isBackgroundCheckered(t)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",i?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",n?1:0)}),this.background$.pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.isBackgroundLight=(0,E.T4)(t),this.changeDetecton.markForCheck()})}initPlaybackSpeedListener(){this.store.select(a.S.getPlaybackSpeed).pipe((0,b.p)(()=>this.store.selectSnapshot(C.N.getSelectedChapterAnimationReady)),(0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{this.animationService.setPlaybackRate(t)})}repositionEngine(t){const i=this.engineElement.nativeElement,{top:n,left:r,width:l,height:y,visibility:I,scale:Y,viewportWidth:W,viewportHeight:J}=t;this.renderer.setStyle(i,"left",`${r}px`),this.renderer.setStyle(i,"top",`${n}px`),this.renderer.setStyle(i,"width",`${l}px`),this.renderer.setStyle(i,"height",`${y}px`),this.renderer.setStyle(i,"transform",`scale(${Y})`),this.renderer.setStyle(i,"zIndex",`${I}`),this.renderer.setStyle(i,"visibility",I===v.g.Shown?"visible":"hidden"),W!==l||J!==y||1!==Y?this.renderer.addClass(i,"engine--scaled"):this.renderer.removeClass(i,"engine--scaled");const ce=Math.max(1,Math.floor(1/Y));i?.style?.setProperty("--engine-border-width",`${ce}px`),this.visible=I===v.g.Shown,this.engineService.fireEvent(P.X.CanvasResized)}bindHumanInteractions(){this.hammerManager=new Ce.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new Ce.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new Ce.Tap({event:"singletap"})),this.hammerManager.add(new Ce.Pan({event:"pan",pointers:0})),this.hammerManager.add(new Ce.Pinch({event:"pinch"})),this.hammerManager.add(new Ce.Press({time:500})),this.hammerManager.on("singletap",n=>{this.store.selectSnapshot(a.S.getClickPickEnabled)&&this.handleTap(n)}),this.hammerManager.on("doubletap",n=>{this.handleDoubleTap(n)}),this.hammerManager.on("press",n=>{n.preventDefault(),n.srcEvent.stopImmediatePropagation(),this.handlePress(n)}),this.hammerManager.on("pan",n=>{n.preventDefault(),this.handlePan(n)}),this.hammerManager.on("panend",n=>{this.handlePanEnd(n)}),this.hammerManager.on("pinchend",n=>{this.handlePinchEnd(n)});let t=0,i=0;this.hammerManager.on("pinchstart",n=>{t=n.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",n=>{if(this.pinchTicks>0)return;const r=Math.abs(n.deltaX)>60||Math.abs(n.deltaY)>60,l=n.scale>1.25||n.scale<.75;this.pinchMode?("pan"===this.pinchMode&&l&&!r&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&r&&!l&&(this.pinchMode="pan")):this.pinchMode=l?"pinch":"pan";const y=n.scale-t;t=n.scale;const I=i;i=0===y?0:y>0?1:-1,this.cameraService.setCameraPan(n.velocityX*ne.Pan,n.velocityY*ne.Pan),i+I!==0&&this.cameraService.setRelativeZoom(y*ne.Zoom)})}handleMouseHover(t){if(t.buttons!==Fe.None)return;const{offsetX:i,offsetY:n}=t,r=this.pickAtCanvasPosition(i,n,!1);if(r.objectId){const l=this.store.selectSnapshot(a.S.getViewGraph),y=this.sceneService.getViewNode(l,r.objectId),I=this.store.selectSnapshot(a.S.getHoveredNode);(!I||I.id!==y.id)&&this.store.dispatch(new m.DZ(y,r))}else null!=this.store.selectSnapshot(a.S.getHoveredNode)&&this.store.dispatch(new m.DZ(null))}handleMouseLeave(){this.store.dispatch(new m.DZ(null))}handleMousePan(t){if(2===t.buttons||4===t.buttons){let{movementX:i,movementY:n}=t;i/=16,n/=16,this.cameraService.setCameraPan(i,n)}}handleMouseOut(){this.store.dispatch(new m.DZ(null))}handleWheel(t){let i=0;0===t.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(t.deltaY)<10?"trackpad":"wheel"),i="trackpad"===this.scrollType?t.deltaY*ne.TrackZoom:Math.sign(t.deltaY)*fe.Zoom):(this.scrollType="wheel",i=t.deltaY*fe.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(i)>40&&(i=40*Math.sign(i)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(i):this.zoomWithVelocity(i)}zoomWithVelocity(t){this.cameraService.setCameraZoom(t),requestAnimationFrame(()=>{t*=.85,Math.abs(t)>1&&this.zoomWithVelocity(t)})}handleContextMenu(t){t.preventDefault();const{offsetX:i,offsetY:n}=t,r=this.pickAtCanvasPosition(i,n),l=this.getNodeFromHit(r);this.store.dispatch(new m.fZ(l,r))}handlePanEnd(t){const i=this.store.selectSnapshot(pe.x.getCameraMotion);if(this.pinchTicks>0||i.panX===t.velocityX&&i.panY===t.velocityY)return;const n=this.store.selectSnapshot(pe.x.getPanMode);t.srcEvent.shiftKey||"pan"===n?(i.panX=t.velocityX*ne.Pan,i.panY=t.velocityY*ne.Pan):(i.rotateX=t.velocityX*ne.Rotate,i.rotateY=t.velocityY*ne.Rotate),i.applyFriction=!0,this.store.dispatch(new N.P4(i))}handlePinchEnd(t){const i=this.store.selectSnapshot(pe.x.getCameraMotion);if("pan"===this.pinchMode)i.panX=t.velocityX*ne.Pan,i.panY=t.velocityY*ne.Pan;else{const n=t.velocity>0?1:-1;i.zoom=Math.sqrt(t.velocityX*t.velocityX+t.velocityY*t.velocityY)*-n*ne.Zoom}i.applyFriction=!0,this.store.dispatch(new N.P4(i)),this.pinchTicks=10}handleTap(t){const{offsetX:i,offsetY:n}=this.getOffset(t),r=this.pickAtCanvasPosition(i,n),l=this.getNodeFromHit(r);this.store.dispatch(new m.zE(l,t,r))}handleDoubleTap(t){const{offsetX:i,offsetY:n}=this.getOffset(t),r=this.pickAtCanvasPosition(i,n),l=this.getNodeFromHit(r);l&&this.store.dispatch(new m.W6(l.id))}handlePress(t){const{offsetX:i,offsetY:n}=this.getOffset(t),r=this.pickAtCanvasPosition(i,n),l=this.getNodeFromHit(r);l&&this.store.dispatch(new m.W6(l.id))}handlePan(t){if(this.pinchTicks>0)return;const i=this.store.selectSnapshot(pe.x.getPanMode),{velocityX:n,velocityY:r}=t;t.srcEvent.shiftKey||"pan"===i?this.cameraService.setCameraPan(n*ne.Pan,r*ne.Pan):this.cameraService.setCameraRotation(n*ne.Rotate,r*ne.Rotate)}handleMouseInputEngineTick(t){const i=this.cameraService.tickCameraRotation(),n=this.cameraService.tickCameraPan(),r=this.cameraService.tickCameraZoom(),l=Math.min(15,(window.performance.now()-this.deltaTime)/Ie);if((i.vx||i.vy)&&this.cameraService.rotateCameraStatic(0!==i.vx?l*i.vx*fe.Rotate:0,0!==i.vy?l*i.vy*fe.Rotate:0),n.x||n.y){const y=this.cameraService.getLookDistance(),I=Math.max(y/80,.01);this.cameraService.panCameraStatic(l*n.x*I*fe.Pan,l*n.y*I*fe.Pan,l*n.z*I*fe.Pan)}0!==r&&this.cameraService.setRelativeZoom(l*r*fe.Zoom)}handleCameraTick(t){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const i=this.store.selectSnapshot(pe.x.getCameraMotion);this.cameraService.setCameraPan(i.panX,i.panY),this.cameraService.setCameraRotation(i.rotateX,i.rotateY),this.cameraService.setCameraZoom(i.zoom),this.cameraService.tickCamera(t)}applyCheckedPatches(t){this.engineService.fireEvent(P.X.SceneObjectsSelected,{selectedObjectsUpdate:t});const i=this.store.selectSnapshot(a.S.getViewGraph),n=this.store.selectSnapshot(a.S.getXrayModeEnabled);Object.entries(t).forEach(([r,l])=>{n?this.paintService.paint(i,r,!0===l?R.NR:R.EC):this.paintService.highlight(i,r,l)})}applyShownPatches(t,i){const n=Object.keys(t),r=this.sceneService.getObjectsById(n),l=n.reduce((W,J)=>(this.sceneService.isLeaf(r[J])&&(W[J]=t[J]),W),{});this.engineService.fireEvent(P.X.SceneObjectsShown,{enabledObjectsUpdate:l});const y=this.store.selectSnapshot(D.z.getNodes),I=Object.values(y).reduce((W,J)=>(W[J.objectId]=J.shown,W),{});i&&this.sceneService.setNodesVisible(I);const Y=this.convertToLeafStateMap("shown",I);this.store.dispatch(new m.A0(Y,y))}applyPaintPatches(t){Object.entries(t).forEach(([i,n])=>{this.paintService.colorObject(i,(0,Oe.Sf)(n))})}applyPickablePatches(t){const i=this.store.selectSnapshot(D.z.getNodes),n=Object.values(i).reduce((r,l)=>(r[l.objectId]=l.pickable,r),{});this.sceneService.setNodesProperty(n,"pickable"),this.store.dispatch(new m.$V(this.convertToLeafStateMap("pickable",n),i))}applyAvailablePatches(t){const i=this.store.selectSnapshot(D.z.getNodes),n=this.convertToLeafStateMap("available",t);this.store.dispatch(new m.Rc(n,i))}applyVariantPatches(t,i,n,r){if(i&&this.store.dispatch(new Pe._n(t,r)),n){const{anatomyObjects:l}=this.sceneService.getAnatomySceneGraph();Object.entries(t).forEach(([y,I])=>{this.sceneService.setObjectVariant(l,y,I)})}}getFriction(t){if(0===t)return 0;const i=(window.performance.now()-this.deltaTime)/Ie;let r=t*Math.max(0,ne.Friction+.1*(1-i));return Math.abs(r)<ne.FrictionThreshold&&(r=0),r}applyFriction(){const t=this.store.selectSnapshot(pe.x.getCameraMotion);!0===t.applyFriction&&(t.rotateX=this.getFriction(t.rotateX),t.rotateY=this.getFriction(t.rotateY),t.panX=this.getFriction(t.panX),t.panY=this.getFriction(t.panY),t.zoom=this.getFriction(t.zoom),0===t.rotateX&&0===t.rotateY&&0===t.panX&&0===t.panY&&0===t.zoom&&(t.applyFriction=!1),this.store.dispatch(new N.P4(t)))}flyToObject(t,i){return this.cameraService.flyToObject(t,i)}flyToCamera(t,i){return this.cameraService.flyToCamera(t,i)}jumpToObject(t){return this.cameraService.jumpToObject(t)}jumpToCamera(t){return this.cameraService.jumpToCamera(t)}getNodeFromHit(t){let i;if(t.objectId){const n=this.store.selectSnapshot(a.S.getViewGraph);i=this.sceneService.getViewNode(n,t.objectId)}return i}pickAtCanvasPosition(t,i,n=!0){const r=this.enginePosition?.scale??1;if(1!==r){const l=1/r,y=Ee.vec3Pool.get();[t,i]=ze.scale(y,[t,i,0],l),Ee.vec3Pool.release(y)}return this.engineRendererService.pick(t,i,n)}getOffset(t){let i=0,n=0;t.center?(i=t.center.x,n=t.center.y):(i=t.clientX,n=t.clientY);const l=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:i-l.left,offsetY:n-l.top}}isTransparentBackground(t){return!!t&&(0,E.ty)(this.background.getValue())}isBackgroundCheckered(t){return q.c.application!==ae.c.Viewer&&this.isTransparentBackground(t)}playChapterFromStart(){this.store.selectSnapshot(C.N.getSelectedChapterReadyState).animation&&(this.store.dispatch(new m.A6),this.store.dispatch(new m.dE(!0)))}initVideo(){this.mediaService.getVideoEvents().pipe((0,s.Q)(this.ngUnsubscribe)).subscribe(t=>{const{id:i,event:n}=t;"play"===n&&this.store.dispatch(new Te.F(i)),this.store.selectSnapshot(Ye.Y.getCurrentVideo)===i&&("pause"===n||"ended"===n)&&this.store.dispatch(new Te.F(null))})}static#e=this.\u0275fac=function(i){return new(i||K)(e.rXU(h.En),e.rXU(Ge.nX),e.rXU(We.O),e.rXU(ve.j),e.rXU(e.gRc),e.rXU(oe.y),e.rXU(Qe.S),e.rXU(Ne.w),e.rXU(ke.u),e.rXU(k.s),e.rXU(e.sFG),e.rXU(we.n$),e.rXU(h.il),e.rXU(He.S),e.rXU($e.c),e.rXU(Xe.z),e.rXU(Ve.h),e.rXU(Ze.Ai))};static#t=this.\u0275cmp=e.VBU({type:K,selectors:[["app-engine"]],viewQuery:function(i,n){if(1&i&&e.GBs(gt,7),2&i){let r;e.mGM(r=e.lsd())&&(n.engineElement=r.first)}},hostBindings:function(i,n){1&i&&e.bIt("wheel",function(l){return n.wheel(l)})("contextmenu",function(l){return n.onContextMenu(l)})("mouseout",function(l){return n.onMouseOut(l)})("click",function(l){return n.onDocumentClick(l)},!1,e.EBC)},inputs:{inputEnabled:[1,"inputEnabled"],contextMenuEnable:[1,"contextMenuEnable"]},decls:17,vars:27,consts:[["engine",""],["id","container","data-test","engine","aria-label","3D scene","role","complementary",1,"engine",3,"ngClass"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"],["cdkDrag","",1,"engine__stats",3,"cdkDragBoundary"],[3,"theme","showAdvancedTools"]],template:function(i,n){if(1&i&&(e.j41(0,"div",1,0),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,mt,1,0,"div",2),e.nI1(5,"async"),e.DNE(6,vt,1,0,"app-labels"),e.nI1(7,"async"),e.DNE(8,yt,1,2,"app-engine-contextmenu",3)(9,bt,1,0,"div",4)(10,St,1,0,"app-engine-progress",5),e.nI1(11,"async"),e.nrm(12,"app-engine-scroll")(13,"app-engine-fade"),e.DNE(14,Pt,3,5,"div",6),e.nI1(15,"async"),e.DNE(16,Ct,1,0,"app-engine-camera-position"),e.k0s()),2&i){const r=e.sdS(1);e.Y8G("ngClass",e.eq3(25,ft,"screen"===e.bMT(2,13,n.overlayType$))),e.BMQ("data-progress",n.progress)("data-chapter-ready",n.chapterReady)("data-camera-animating",n.cameraAnimating)("data-story-id",e.bMT(3,15,n.storyId$))("data-engine-version",n.VERSION),e.R7$(4),e.vxM(e.bMT(5,17,n.watermarkEnabled$)?4:-1),e.R7$(2),e.vxM(!1===e.bMT(7,19,n.xrActive$)?6:-1),e.R7$(2),e.vxM(n.contextMenuNode?8:-1),e.R7$(),e.vxM(n.inputEnabled()?-1:9),e.R7$(),e.vxM(e.bMT(11,21,n.showProgressBar$)?10:-1),e.R7$(4),e.vxM(e.bMT(15,23,n.statsEnabled$)?14:-1),e.R7$(2),e.vxM(n.showDebug&&r?16:-1)}},dependencies:[Ue.YU,Je.T1,qe.H,et.J,it,ot,lt,dt,ut,Ue.Jj],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--hidden[_ngcontent-%COMP%]{display:none!important}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.svg) 7 20,pointer}.engine--cursor-fade[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-fade.svg) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.svg) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.svg) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea),linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea)}.engine--scaled[_ngcontent-%COMP%]{outline:var(--engine-border-width, 1px) solid #d7e0ea}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}.engine__stats[_ngcontent-%COMP%]{position:absolute;width:fit-content;max-height:calc(100vh - 32px);overflow:auto;top:16px;right:16px;z-index:2}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0})}Q([(0,h.l6)(a.S.getEnginePosition),G("design:type",g.c)],K.prototype,"enginePosition$",void 0),Q([(0,h.l6)(a.S.getHoveredNode),G("design:type",g.c)],K.prototype,"hoveredNode$",void 0),Q([(0,h.l6)(D.z.getPatches),G("design:type",g.c)],K.prototype,"nodeStatePatches$",void 0),Q([(0,h.l6)(a.S.getActiveTool),G("design:type",g.c)],K.prototype,"activeTool$",void 0),Q([(0,h.l6)(a.S.getDisplay),G("design:type",g.c)],K.prototype,"engineDisplay$",void 0),Q([(0,h.l6)(a.S.getVisible),G("design:type",g.c)],K.prototype,"engineVisible$",void 0),Q([(0,h.l6)(a.S.getShowProgressBar),G("design:type",g.c)],K.prototype,"showProgressBar$",void 0),Q([(0,h.l6)(a.S.getContextMenu),G("design:type",g.c)],K.prototype,"contextMenu$",void 0),Q([(0,h.l6)(a.S.getAutoplay),G("design:type",g.c)],K.prototype,"autoplay$",void 0),Q([(0,h.l6)(_.t.getStoryId),G("design:type",g.c)],K.prototype,"storyId$",void 0),Q([(0,h.l6)(C.N.getSelectedChapter),G("design:type",g.c)],K.prototype,"selectedChapter$",void 0),Q([(0,h.l6)(C.N.getSelectedChapterId),G("design:type",g.c)],K.prototype,"selectedChapterId$",void 0),Q([(0,h.l6)(C.N.getSelectedChapterReadyState),G("design:type",g.c)],K.prototype,"readyState$",void 0),Q([(0,h.l6)(C.N.getSelectedChapterClippingPlanes),G("design:type",g.c)],K.prototype,"clippingPlanes$",void 0),Q([(0,h.l6)(C.N.getSelectedChapterBackground),G("design:type",g.c)],K.prototype,"background$",void 0),Q([(0,h.l6)(a.S.getWatermarkEnabled),G("design:type",g.c)],K.prototype,"watermarkEnabled$",void 0),Q([(0,h.l6)(a.S.getStatsEnabled),G("design:type",g.c)],K.prototype,"statsEnabled$",void 0),Q([(0,h.l6)(a.S.getShowAdvancedStatsTools),G("design:type",g.c)],K.prototype,"showAdvancedTools$",void 0),Q([(0,h.l6)(Re.U.getXROverlayType),G("design:type",g.c)],K.prototype,"overlayType$",void 0),Q([(0,h.l6)(_e.U.getPrefersReducedMotion),G("design:type",g.c)],K.prototype,"prefersReducedMotion$",void 0),Q([(0,h.l6)(Re.U.getXREnabled),G("design:type",g.c)],K.prototype,"xrEnabled$",void 0),Q([(0,h.l6)(Re.U.getXRActive),G("design:type",g.c)],K.prototype,"xrActive$",void 0)},93815:(ie,j,o)=>{"use strict";o.d(j,{c:()=>g});var e=o(57535),h=o(35939),m=o(12921),a=o(59429),T=o(79805),B=o(49204),O=o(54438),U=o(92014);let g=(()=>{class b{constructor(s,d){this.engineService=s,this.store=d}createParticleSystem(s){const d={...(0,e.Vs)(),id:a.u.idWithPrefix("system")};this.store.dispatch(new h.u.NewParticleSystem(d,s))}duplicateParticleSystem(s,d){this.store.dispatch(new h.u.DuplicateParticleSystem(s,d))}resetParticleSystem(s){const d={...(0,e.Vs)(),id:s};this.store.dispatch(new h.u.UpdateParticleSystem(s,d))}toggleParticleSystemVisible(s,d){const f=this.isParticleSystemVisible(s,d);this.store.dispatch(new h.u.SetParticleSystemVisible(s,!f,d))}isParticleSystemVisible(s,d){return this.store.selectSnapshot(m.B.getVisibleParticleSystemsForChapter(d)).includes(s)}addChapterParticleSystem(s,d){this.store.dispatch(new h.u.AssignParticle(s,d))}removeChapterParticleSystem(s,d){this.store.dispatch(new h.u.UnassignParticle(s,d))}removeAllChapterParticleSystem(s){this.store.selectSnapshot(m.B.particleSystemsForChapter(s)).forEach(f=>{this.removeChapterParticleSystem(f.id,s)})}createNewConstraint(s,d){const{id:f,constraints:w}=s;this.store.dispatch(new h.u.UpdateParticleSystem(f,{...s,constraints:[...w,{...(0,e.hG)(d),id:a.u.idWithPrefix("constraint")}]}))}duplicateConstraint(s,d){s.constraints=[...s.constraints,{...(0,e.qg)(d.type,d),id:a.u.idWithPrefix("constraint")}],this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleConstraint(s.constraints.length-1))}resetConstraint(s,d){const f=s.constraints[d],{id:w,type:S}=f;s.constraints[d]={...(0,e.hG)(S),id:w},this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}resetConstraints(s){s.constraints=s.constraints.map(d=>{const{id:f,type:w}=d;return{...(0,e.hG)(w),id:f}}),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}removeConstraint(s,d){s.constraints.splice(d,1),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleConstraint(-1))}createNewCreator(s,d){const{id:f,creators:w}=s;this.store.dispatch(new h.u.UpdateParticleSystem(f,{...s,creators:[...w,{...(0,e.U8)(d),id:a.u.idWithPrefix("creator")}]}))}duplicateCreator(s,d){s.creators=[...s.creators,{...(0,e.xM)(d.type,d),id:a.u.idWithPrefix("creator")}],this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleCreator(s.creators.length-1))}resetCreator(s,d){const f=s.creators[d],{id:w,type:S}=f;s.creators[d]={...(0,e.U8)(S),id:w},this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}resetCreators(s){s.creators=s.creators.map(d=>{const{id:f,type:w}=d;return{...(0,e.U8)(w),id:f}}),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}removeCreator(s,d){s.creators.splice(d,1),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleConstraint(-1))}createNewUpdater(s,d){const{id:f,updaters:w}=s;this.store.dispatch(new h.u.UpdateParticleSystem(f,{...s,updaters:[...w,{...(0,e.jQ)(d),id:a.u.idWithPrefix("updater")}]}))}duplicateUpdater(s,d){s.updaters=[...s.updaters,{...(0,e.MH)(d.type,d),id:a.u.idWithPrefix("updater")}],this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleUpdater(s.updaters.length-1))}resetUpdater(s,d){const f=s.updaters[d],{id:w,type:S}=f;s.updaters[d]={...(0,e.jQ)(S),id:w},this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}resetUpdaters(s){s.updaters=s.updaters.map(d=>{const{id:f,type:w}=d;return{...(0,e.jQ)(w),id:f}}),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s))}removeUpdater(s,d){s.updaters.splice(d,1),this.store.dispatch(new h.u.UpdateParticleSystem(s.id,s)),this.store.dispatch(new h.u.SelectParticleConstraint(-1))}setEngineParticles(s,d,f){const w=this.engineService.engine?.story,S=w?.chapters?.find(x=>x.id===d);(0,B.isNil)(S)||(w.particleSystemDefs.forEach((x,z)=>{(0,B.isNil)(s[z])&&w.particleSystemDefs.delete(z)}),Object.entries(s).forEach(([x,z])=>{const Z=w.particleSystemDefs.get(x);((0,B.isNil)(Z)||!(0,B.isEqual)(Z,z))&&w.particleSystemDefs.set(x,z)}),S.particleSystemIds.forEach(x=>{f.includes(x)||S.particleSystemIds.delete(x)}),f.forEach(x=>{S.particleSystemIds.has(x)||S.particleSystemIds.add(x)}))}static#e=this.\u0275fac=function(d){return new(d||b)(O.KVO(T.y),O.KVO(U.il))};static#t=this.\u0275prov=O.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},24484:(ie,j,o)=>{"use strict";o(43753)},3909:(ie,j,o)=>{"use strict";o.d(j,{M:()=>M});var e=o(47632),h=o(47610),m=o(61295),a=o(91003),T=o(33013),B=o(93915),$=o(66056),O=o(75069),U=o(7431),g=o(54438),b=o(92014);let M=(()=>{class s{constructor(f,w){this.store=f,this.positionsService=w}resetScene(){this.store.dispatch(new h.lQ),this.store.dispatch(new m.Yn),this.store.dispatch(new O.a.Reset),this.store.dispatch(new e.sN(null)),this.store.dispatch(new T.FN),this.store.dispatch(new h.u3("")),this.store.dispatch(new B.$y),this.store.dispatch(new h.w8),this.store.dispatch(new h.B9),this.store.dispatch(new $.jj),this.positionsService.clearAllClipboards(),this.store.dispatch(new U.Cy)}static#e=this.\u0275fac=function(w){return new(w||s)(g.KVO(b.il),g.KVO(a.c))};static#t=this.\u0275prov=g.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})()},4763:(ie,j,o)=>{"use strict";o.d(j,{n:()=>O});var e=o(54438),h=o(72026),m=o(60177),a=o(26779);const T=(U,g,b,M)=>({"badge--blue":U,"badge--green":g,"badge--inline":b,"badge--block":M});function B(U,g){if(1&U&&(e.j41(0,"div",1),e.nrm(1,"app-icon",3),e.k0s()),2&U){const b=e.XpG();e.R7$(),e.Y8G("icon",b.icon())}}function $(U,g){if(1&U&&(e.j41(0,"div",2),e.EFF(1),e.k0s()),2&U){const b=e.XpG();e.R7$(),e.JRh(b.label())}}let O=(()=>{class U{constructor(){this.display=(0,e.hFB)("inline"),this.theme=(0,e.hFB)("none"),this.icon=(0,e.hFB)(""),this.label=(0,e.hFB)("")}static#e=this.\u0275fac=function(M){return new(M||U)};static#t=this.\u0275cmp=e.VBU({type:U,selectors:[["app-badge"]],inputs:{display:[1,"display"],theme:[1,"theme"],icon:[1,"icon"],label:[1,"label"]},standalone:!0,features:[e.aNF],decls:3,vars:8,consts:[[1,"badge","flex","items-center",3,"ngClass"],[1,"badge__check"],[1,"badge__label"],[3,"icon"]],template:function(M,s){1&M&&(e.j41(0,"div",0),e.DNE(1,B,2,1,"div",1)(2,$,2,1,"div",2),e.k0s()),2&M&&(e.Y8G("ngClass",e.ziG(3,T,"blue"===s.theme(),"green"===s.theme(),"inline"===s.display(),"block"===s.display())),e.R7$(),e.vxM(s.icon()?1:-1),e.R7$(),e.vxM(s.label()?2:-1))},dependencies:[m.MD,m.YU,h.o,a.R],styles:[".badge{gap:8px;padding:4px 8px 4px 4px;border-radius:12px}.badge__check{display:flex;align-items:center;justify-content:center;border-radius:100%;width:14px;height:14px;font-size:.625rem;line-height:.75rem}.badge__label{font-size:.75rem;line-height:1rem;font-weight:500}.badge--inline{display:inline-flex}.badge--block{display:flex}.badge--blue{background-color:#a6dfff66;color:#1c5ab9}.badge--blue .badge__check{background-color:#2d72dc;color:#fff}.badge--green{background-color:#c1efdf66;color:#095922}.badge--green .badge__check{background-color:#138032;color:#fff}\n"],encapsulation:2,changeDetection:0})}return U})()},77428:(ie,j,o)=>{"use strict";o.d(j,{X:()=>U});var e=o(38645),h=o(85052),m=o(37925),a=o(54438),T=o(60177);const B=(g,b,M,s,d)=>({"progress--small":g,"progress--medium":b,"progress--large":M,"progress--light":s,"progress--dark":d}),$=g=>({"progress__bar--complete":g}),O=g=>({width:g});let U=(()=>{class g{get value(){return this._value}set value(M){this._value=M,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}constructor(M,s){this.router=M,this.changeDetector=s,this.total=100,this._value=0,this.size="small",this.disableComplete=!1,this.theme="dark",this.percentWidth=0,this.ngUnsubscribe=new h.B}ngOnInit(){this.router.events.pipe((0,m.Q)(this.ngUnsubscribe)).subscribe(M=>{M instanceof e.Z&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#e=this.\u0275fac=function(s){return new(s||g)(a.rXU(e.Ix),a.rXU(a.gRc))};static#t=this.\u0275cmp=a.VBU({type:g,selectors:[["app-progress"]],inputs:{total:"total",value:"value",size:"size",disableComplete:"disableComplete",theme:"theme"},decls:2,vars:14,consts:[[1,"progress",3,"ngClass"],["role","progressbar","aria-label","content loading progress","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(s,d){1&s&&(a.j41(0,"div",0),a.nrm(1,"div",1),a.k0s()),2&s&&(a.Y8G("ngClass",a.s1E(4,B,"small"===d.size,"medium"===d.size,"large"===d.size,"light"===d.theme,"dark"===d.theme)),a.R7$(),a.Y8G("ngClass",a.eq3(10,$,!d.disableComplete&&100===d.percentWidth))("ngStyle",a.eq3(12,O,d.percentWidth+"%")),a.BMQ("aria-valuenow",d.percentWidth))},dependencies:[T.YU,T.B3],styles:["[_ngcontent-%COMP%]:root{--app-progress-color: transparent;--app-progress-success-color: #38de38}@keyframes _ngcontent-%COMP%_progressSuccess{0%{width:100%!important;background:var(--app-progress-success-color)}50%{opacity:1;background:var(--app-progress-success-color)}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;width:100%}.progress__bar[_ngcontent-%COMP%]{background:var(--app-progress-color);height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressSuccess 2s linear forwards}.progress--small[_ngcontent-%COMP%]{height:4px}.progress--medium[_ngcontent-%COMP%]{height:8px}.progress--large[_ngcontent-%COMP%]{height:12px}.progress--light[_ngcontent-%COMP%]{--app-progress-color: #ffffff}.progress--dark[_ngcontent-%COMP%]{--app-progress-color: #de3535}"],changeDetection:0})}return g})()},42887:(ie,j,o)=>{"use strict";o.d(j,{x:()=>m});var e=o(60177),h=o(54438);let m=(()=>{class a{static#e=this.\u0275fac=function($){return new($||a)};static#t=this.\u0275mod=h.$C({type:a});static#n=this.\u0275inj=h.G2t({imports:[e.MD]})}return a})()},32258:(ie,j,o)=>{"use strict";o.d(j,{W:()=>B});var e=o(85052),h=o(76718),m=o(35426),a=o(36110),T=o(37925);class B{constructor(O,U,g){this.overlay=O,this.content=U,this.data=g,this.afterClosed=new e.B,this.afterClosed$=this.afterClosed.asObservable(),O.backdropClick().subscribe(()=>this._close("backdropClick",g)),this.entered$=(0,h.h)((0,m.R)(O.overlayElement,"mouseenter"),(0,m.R)(O.overlayElement,"mouseleave")).pipe((0,a.T)(b=>"mouseenter"===b.type),(0,T.Q)(this.afterClosed$))}close(O){this._close("close",O)}_close(O,U){this.overlay.dispose(),this.afterClosed.next({type:O,data:U}),this.afterClosed.complete()}}},5025:(ie,j,o)=>{"use strict";o.d(j,{k:()=>M,O:()=>d});var e=o(47987),h=o(32258),m=o(76939),a=o(54438),T=o(60177);function B(f,w){if(1&f&&a.nrm(0,"div",4),2&f){const S=a.XpG();a.Y8G("innerHTML",S.content,a.npT)}}function $(f,w){1&f&&a.eu8(0)}function O(f,w){if(1&f&&(a.qex(0),a.DNE(1,$,1,0,"ng-container",5),a.bVm()),2&f){const S=a.XpG();a.R7$(),a.Y8G("ngTemplateOutlet",S.content)("ngTemplateOutletContext",S.context)}}function U(f,w){1&f&&a.eu8(0)}function g(f,w){if(1&f&&(a.qex(0),a.DNE(1,U,1,0,"ng-container",6),a.bVm()),2&f){const S=a.XpG();a.R7$(),a.Y8G("ngComponentOutlet",S.content)}}let b=(()=>{class f{constructor(S){this.popupRef=S,this.renderMethod="component"}ngOnInit(){this.content=this.popupRef.content,"string"==typeof this.content?this.renderMethod="text":this.content instanceof a.C4Q&&(this.renderMethod="template",this.context={close:this.popupRef.close.bind(this.popupRef)})}static#e=this.\u0275fac=function(x){return new(x||f)(a.rXU(h.W))};static#t=this.\u0275cmp=a.VBU({type:f,selectors:[["app-popup"]],decls:5,vars:4,consts:[[1,"popup"],[3,"ngSwitch"],[3,"innerHTML",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"innerHTML"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet"]],template:function(x,z){1&x&&(a.j41(0,"div",0),a.qex(1,1),a.DNE(2,B,1,1,"div",2)(3,O,2,2,"ng-container",3)(4,g,2,1,"ng-container",3),a.bVm(),a.k0s()),2&x&&(a.R7$(),a.Y8G("ngSwitch",z.renderMethod),a.R7$(),a.Y8G("ngSwitchCase","text"),a.R7$(),a.Y8G("ngSwitchCase","template"),a.R7$(),a.Y8G("ngSwitchCase","component"))},dependencies:[T.OI,T.T3,T.ux,T.e1],styles:["[_nghost-%COMP%]{width:100%;height:100%}.popup[_ngcontent-%COMP%]{background:#fff;border-radius:4px;padding:24px;overflow-y:auto;width:100%;height:100%;overflow-y:scroll;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}"],changeDetection:0})}return f})();var M=function(f){return f.Above="above",f.Below="below",f.Left="left",f.Right="right",f}(M||{});const s={[M.Above]:{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-12},[M.Below]:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:12},[M.Left]:{originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-12},[M.Right]:{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:12}};let d=(()=>{class f{constructor(S,x){this.overlay=S,this.injector=x}open(S){const{origin:x,content:z,data:Z,width:le,height:he,maxHeight:L,maxWidth:p,hasBackdrop:u,positions:A}=S,V=this.overlay.create(this.getOverlayConfig({origin:x,width:le,height:he,maxHeight:L,maxWidth:p,hasBackdrop:u,positions:A})),oe=new h.W(V,z,Z),q=this.createInjector(oe,this.injector);return V.attach(new m.A8(b,null,q)),oe}createInjector(S,x){const z=new WeakMap([[h.W,S]]);return new m.JP(x,z)}getPositionStrategy(S,x){return this.overlay.position().flexibleConnectedTo(S).withPositions(this.getPositions(x))}getOverlayConfig({origin:S,width:x,height:z,maxHeight:Z,maxWidth:le,hasBackdrop:he,positions:L}){return new e.rR({width:x,height:z,maxHeight:Z,maxWidth:le,hasBackdrop:he??!0,backdropClass:"popup-scrim",positionStrategy:this.getOverlayPosition(S,L),scrollStrategy:this.overlay.scrollStrategies.reposition()})}getOverlayPosition(S,x){return x=x||[M.Above,M.Below,M.Left,M.Right],this.overlay.position().flexibleConnectedTo(S).withPositions(this.getPositions(x)).withPush(!0)}getPositions(S){return S.map(x=>s[x])}static#e=this.\u0275fac=function(x){return new(x||f)(a.KVO(e.hJ),a.KVO(a.zZn))};static#t=this.\u0275prov=a.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},34763:(ie,j,o)=>{"use strict";function e(m){if(null==m)return"";const a=new RegExp(/[^a-zA-Z0-9_]/,"gi");return m.replace(a,"_")}function h(m){let a=m;for(;a;){if(a.scrollHeight>a.clientHeight)return a;a=a.parentElement}}o.d(j,{C:()=>h,w:()=>e})},91442:(ie,j,o)=>{"use strict";o.d(j,{R:()=>a,W:()=>m});var e=o(49204);function m(T,B,$){const O=[...T],U=O.splice(B,1);return O.splice($,0,...U),O}function a(T,B,$){const O=B.findIndex((g,b)=>!(0,e.isEqual)(T[b],g)),U=B[O];return B.map((g,b)=>(0,e.isEqual)(U,g)&&b!==O?$:g)}},73828:(ie,j,o)=>{var e;!function(h,m){if(h){for(var U,T={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},B={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},$={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},O={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g=1;g<20;++g)T[111+g]="f"+g;for(g=0;g<=9;++g)T[g+96]=g.toString();L.prototype.bind=function(p,u,A){var V=this;return V._bindMultiple.call(V,p=p instanceof Array?p:[p],u,A),V},L.prototype.unbind=function(p,u){return this.bind.call(this,p,function(){},u)},L.prototype.trigger=function(p,u){var A=this;return A._directMap[p+":"+u]&&A._directMap[p+":"+u]({},p),A},L.prototype.reset=function(){var p=this;return p._callbacks={},p._directMap={},p},L.prototype.stopCallback=function(p,u){if((" "+u.className+" ").indexOf(" mousetrap ")>-1||he(u,this.target))return!1;if("composedPath"in p&&"function"==typeof p.composedPath){var V=p.composedPath()[0];V!==p.target&&(u=V)}return"INPUT"==u.tagName||"SELECT"==u.tagName||"TEXTAREA"==u.tagName||u.isContentEditable},L.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},L.addKeycodes=function(p){for(var u in p)p.hasOwnProperty(u)&&(T[u]=p[u]);U=null},L.init=function(){var p=L(m);for(var u in p)"_"!==u.charAt(0)&&(L[u]=function(A){return function(){return p[A].apply(p,arguments)}}(u))},L.init(),h.Mousetrap=L,ie.exports&&(ie.exports=L),void 0!==(e=function(){return L}.call(j,o,j,ie))&&(ie.exports=e)}function b(p,u,A){p.addEventListener?p.addEventListener(u,A,!1):p.attachEvent("on"+u,A)}function M(p){if("keypress"==p.type){var u=String.fromCharCode(p.which);return p.shiftKey||(u=u.toLowerCase()),u}return T[p.which]?T[p.which]:B[p.which]?B[p.which]:String.fromCharCode(p.which).toLowerCase()}function s(p,u){return p.sort().join(",")===u.sort().join(",")}function S(p){return"shift"==p||"ctrl"==p||"alt"==p||"meta"==p}function z(p,u,A){return A||(A=function x(){if(!U)for(var p in U={},T)p>95&&p<112||T.hasOwnProperty(p)&&(U[T[p]]=p);return U}()[p]?"keydown":"keypress"),"keypress"==A&&u.length&&(A="keydown"),A}function le(p,u){var A,V,oe,q=[];for(A=function Z(p){return"+"===p?["+"]:(p=p.replace(/\+{2}/g,"+plus")).split("+")}(p),oe=0;oe<A.length;++oe)O[V=A[oe]]&&(V=O[V]),u&&"keypress"!=u&&$[V]&&(V=$[V],q.push("shift")),S(V)&&q.push(V);return{key:V,modifiers:q,action:u=z(V,q,u)}}function he(p,u){return null!==p&&p!==m&&(p===u||he(p.parentNode,u))}function L(p){var u=this;if(p=p||m,!(u instanceof L))return new L(p);u.target=p,u._callbacks={},u._directMap={};var V,A={},oe=!1,q=!1,ve=!1;function v(E){E=E||{};var P,D=!1;for(P in A)E[P]?D=!0:A[P]=0;D||(ve=!1)}function X(E,D,P,F,_,se){var R,H,ue=[],ae=P.type;if(!u._callbacks[E])return[];for("keyup"==ae&&S(E)&&(D=[E]),R=0;R<u._callbacks[E].length;++R)H=u._callbacks[E][R],!F&&H.seq&&A[H.seq]!=H.level||ae!=H.action||("keypress"!=ae||P.metaKey||P.ctrlKey)&&!s(D,H.modifiers)||((!F&&H.combo==_||F&&H.seq==F&&H.level==se)&&u._callbacks[E].splice(R,1),ue.push(H));return ue}function C(E,D,P,F){u.stopCallback(D,D.target||D.srcElement,P,F)||!1===E(D,P)&&(function f(p){p.preventDefault?p.preventDefault():p.returnValue=!1}(D),function w(p){p.stopPropagation?p.stopPropagation():p.cancelBubble=!0}(D))}function k(E){"number"!=typeof E.which&&(E.which=E.keyCode);var D=M(E);if(D){if("keyup"==E.type&&oe===D)return void(oe=!1);u.handleKey(D,function d(p){var u=[];return p.shiftKey&&u.push("shift"),p.altKey&&u.push("alt"),p.ctrlKey&&u.push("ctrl"),p.metaKey&&u.push("meta"),u}(E),E)}}function pe(E,D,P,F,_){u._directMap[E+":"+P]=D;var R,se=(E=E.replace(/\s+/g," ")).split(" ");se.length>1?function re(E,D,P,F){function _(ae){return function(){ve=ae,++A[E],function N(){clearTimeout(V),V=setTimeout(v,1e3)}()}}function se(ae){C(P,ae,E),"keyup"!==F&&(oe=M(ae)),setTimeout(v,10)}A[E]=0;for(var R=0;R<D.length;++R){var ue=R+1===D.length?se:_(F||le(D[R+1]).action);pe(D[R],ue,F,E,R)}}(E,se,D,P):(R=le(E,P),u._callbacks[R.key]=u._callbacks[R.key]||[],X(R.key,R.modifiers,{type:R.action},F,E,_),u._callbacks[R.key][F?"unshift":"push"]({callback:D,modifiers:R.modifiers,action:R.action,seq:F,level:_,combo:E}))}u._handleKey=function(E,D,P){var _,F=X(E,D,P),se={},R=0,H=!1;for(_=0;_<F.length;++_)F[_].seq&&(R=Math.max(R,F[_].level));for(_=0;_<F.length;++_)if(F[_].seq){if(F[_].level!=R)continue;H=!0,se[F[_].seq]=1,C(F[_].callback,P,F[_].combo,F[_].seq)}else H||C(F[_].callback,P,F[_].combo);var ue="keypress"==P.type&&q;P.type==ve&&!S(E)&&!ue&&v(se),q=H&&"keydown"==P.type},u._bindMultiple=function(E,D,P){for(var F=0;F<E.length;++F)pe(E[F],D,P)},b(p,"keypress",k),b(p,"keydown",k),b(p,"keyup",k)}}(typeof window<"u"?window:null,typeof window<"u"?document:null)},2094:(ie,j,o)=>{"use strict";o.d(j,{c:()=>O});var e=o(8360),h=o(15210),m=o(66196),a=o(81954);const T={leading:!0,trailing:!1};var $=o(43654);function O(U,g=e.E,b=T){const M=(0,$.O)(U,g);return function B(U,g=T){return(0,h.N)((b,M)=>{const{leading:s,trailing:d}=g;let f=!1,w=null,S=null,x=!1;const z=()=>{S?.unsubscribe(),S=null,d&&(he(),x&&M.complete())},Z=()=>{S=null,x&&M.complete()},le=L=>S=(0,a.Tg)(U(L)).subscribe((0,m._)(M,z,Z)),he=()=>{if(f){f=!1;const L=w;w=null,M.next(L),!x&&le(L)}};b.subscribe((0,m._)(M,L=>{f=!0,w=L,(!S||S.closed)&&(s?he():le(L))},()=>{x=!0,(!(d&&f&&S)||S.closed)&&M.complete()}))})}(()=>M,b)}}}]);