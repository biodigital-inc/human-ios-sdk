<html>
    <head>
<script src="human-api.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
      margin: 0;
      width:100vw;
      height:100vh;
    }

    #embeddedHuman {
      position: absolute;
      border: none;
      width: 100vw;
      height: 100vh;
    }
</style>
</head>
<body>
    <iframe
        id="embeddedHuman"
        allowFullScreen="true"
        class="fullscreen"
        src="">
    </iframe>
</body>
<script>
    var human = new HumanAPI("embeddedHuman");
    
    window.webkit.messageHandlers.messageHandler.postMessage("HI GARY!");

    human.on( 'labels.created', function(labelData) {
        window.webkit.messageHandlers.messageHandler.postMessage("labels.created event: " + JSON.stringify(labelData));
    });

human.on( 'labels.destroyed', function(labelData) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.destroyed event: " + JSON.stringify(labelData));
});


human.on( 'labels.chapterInfo', function(labelData) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.chapterInfo event: " + JSON.stringify(labelData));
});

human.on('labels.moved', function(annoPosition) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.moved event:" + JSON.stringify(annoPosition));
});

human.on('labels.entered', function(annoPosition) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.entered event: " + JSON.stringify(annoPosition));
});

human.on('labels.left', function(annoPosition) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.left event: " + JSON.stringify(annoPosition));
});

human.on('labels.picked', function(annoPosition) {
    window.webkit.messageHandlers.messageHandler.postMessage("labels.picked event: " + JSON.stringify(annoPosition));
});


    // send a chapter transition message
    human.on( 'timeline.chapterTransition', function(chapterData) {
        window.webkit.messageHandlers.chapterHandler.postMessage(chapterData);
    });

    // camera updated callback
    human.on( 'camera.updated', function(cameraData) {
        window.webkit.messageHandlers.cameraUpdateHandler.postMessage(cameraData);
    });
    
    var sceneLoaded = false

    human.on('scene.loaded', function() {
        if (!sceneLoaded) {
            sceneLoaded = true;
            window.webkit.messageHandlers.messageHandler.postMessage("ASSETS LOADED");
            window.webkit.messageHandlers.assetsHandler.postMessage("loaded");
        }
    });

    human.on('scene.xrayEnabled', function() {
        window.webkit.messageHandlers.xrayHandler.postMessage(true);
    });
    
    human.on('native.share', function(data) {
        window.webkit.messageHandlers.messageHandler.postMessage("got native share " + JSON.stringify(data.type));
        window.webkit.messageHandlers.nativeShareHandler.postMessage(data);
    });

    human.on('native.debugMessage', function(message) {
        window.webkit.messageHandlers.messageHandler.postMessage("$$$ got debug messsage " + JSON.stringify(message));
    });

    human.on('scene.xrayDisabled', function() {
         window.webkit.messageHandlers.xrayHandler.postMessage(false);
    });

    human.on('scene.restored', function() {
         window.webkit.messageHandlers.sceneRestoredHandler.postMessage("boo");
    });

    human.on( 'scene.objectsShown' , function(objects) {
         window.webkit.messageHandlers.objectsShownHandler.postMessage(objects);
    });

    human.on( 'scene.objectsSelected' , function(objects) {
        window.webkit.messageHandlers.messageHandler.postMessage(JSON.stringify(objects));
        window.webkit.messageHandlers.selectHandler.postMessage(objects);
        lastPick = '';
    });
    
    var progressDone = false;
    
    // send an animation update message
    human.on('timeline.playing', function(animationTime) {
//        window.webkit.messageHandlers.messageHandler.postMessage("timeline.playing: " + JSON.stringify(animationTime));
        window.webkit.messageHandlers.timelineHandler.postMessage(animationTime.time);
        if (animationTime.time > 0.0 && progressDone === false) {
            window.webkit.messageHandlers.messageHandler.postMessage("$$$$$$$$ caught missed loaded message");
            window.webkit.messageHandlers.assetsHandler.postMessage("loaded");
            progressDone = true;
        }
    });

    human.on('timeline.completed', function() {
        window.webkit.messageHandlers.timelineHandler.postMessage('done');
    });

    var lastPick = '';

    human.on( 'scene.picked' , function (event) {
        if (event.position !== undefined && event.objectId !== lastPick) {
            lastPick = event.objectId;
            window.webkit.messageHandlers.messageHandler.postMessage('scene.picked ' + JSON.stringify(event));
            window.webkit.messageHandlers.pickHandler.postMessage(event);
        }
    });

    human.on( 'annotations.created' , function (anno) {
        window.webkit.messageHandlers.annoCreateHandler.postMessage(anno);
    });

    human.on( 'annotations.shown' , function () {
        window.webkit.messageHandlers.messageHandler.postMessage("**** GOT ANNOS SHOWN");
        window.webkit.messageHandlers.annotationsShownHandler.postMessage(true);
    });

human.on( 'labels.enabled' , function () {
    window.webkit.messageHandlers.messageHandler.postMessage("**** GOT labels shown all ");
});

human.on( 'labels.disabled' , function () {
    window.webkit.messageHandlers.messageHandler.postMessage("**** GOT labels hidden all ");
});

    human.on('annotations.destroyed', function (event) {
        window.webkit.messageHandlers.annoDestroyHandler.postMessage(event);
    });

    human.on('annotations.hidden', function () {
        window.webkit.messageHandlers.messageHandler.postMessage("**** GOT ANNOS HIDDEN");
        window.webkit.messageHandlers.annotationsShownHandler.postMessage(false);
    });

    human.on('hotspots.positionUpdated', function(annoPosition) {
//        window.webkit.messageHandlers.messageHandler.postMessage("hotspots.positionUpdated " + JSON.stringify(annoPosition));
        window.webkit.messageHandlers.annotationsMovedHandler.postMessage(annoPosition);
    });

    human.on('scene.ready', function () {
        sceneLoaded = false;
        window.webkit.messageHandlers.messageHandler.postMessage("GH: scene.ready");
        human.send('scene.metadata', function(metadata) {
            window.webkit.messageHandlers.sceneMetaHandler.postMessage(metadata);
        });
        human.send('scene.info', function(scenedata) {
            window.webkit.messageHandlers.sceneInfoHandler.postMessage(scenedata);
        });
//
    });

    window.webkit.messageHandlers.messageHandler.postMessage("API object created, listeners registered params:" + window.bd_urlparams);
    window.webkit.messageHandlers.humanHandler.postMessage("ready" );
    
    var iframe = document.getElementById("embeddedHuman");
    iframe.src = "http://localhost:" + window.sdkPort + "/?id=models/9OR" + window.bd_urlparams;
    window.webkit.messageHandlers.messageHandler.postMessage("src=" + iframe.src);
</script>
</html>
