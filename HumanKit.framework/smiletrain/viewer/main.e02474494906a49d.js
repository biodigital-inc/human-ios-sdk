(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[792],{7153:(Dt,Xe,S)=>{"use strict";S.d(Xe,{E:()=>tt,fQ:()=>be,n3:()=>c}),S(1217);var t=S(234);const c={[t.a.WoltersKluwer]:"Wolters Kluwer",[t.a.Zspace]:"zSpace"},be={[t.a.WoltersKluwer]:"https://tools.ovid.com/support/index_inner.html",[t.a.Zspace]:"https://support.zspace.com/s/contactsupport"};function tt(je){return!je?.organizations[0]?.external_account?.is_external_account&&function et(je){return!0===je?.premium_account_valid||"group"===je?.premium_account_type}(je)}},1217:(Dt,Xe,S)=>{"use strict";S.d(Xe,{P:()=>z});var z=function(t){return t.User="user",t.Organization="organization",t}(z||{})},5189:(Dt,Xe,S)=>{"use strict";S.d(Xe,{G:()=>w});var z=S(5887),t=S(4109),Ne=S(2765),c=S(6600),be=S(8834),de=S(5951),ke=S(2798),et=S(9115),tt=S(5911),Zt=S(5571),Xn=S(4006),Mn=S(4823),ni=S(5416),Rn=S(1997),je=S(882),$e=S(7575),Gn=(S(8931),S(5478)),Ht=S(1391),J=S(7987),He=S(6939),oe=S(450),X=S(4438);const At={disabled:!0,animation:{enterDuration:0,exitDuration:0}},Xo={...(0,Mn.zi)(),touchGestures:"off",disableTooltipInteractivity:!0};let w=(()=>{var pe;class bt{}return(pe=bt).\u0275fac=function(En){return new(En||pe)},pe.\u0275mod=X.$C({type:pe}),pe.\u0275inj=X.G2t({providers:[{provide:ni.x6,useValue:{duration:3e3}},{provide:c.$E,useValue:At},{provide:Mn.sM,useValue:Xo}],imports:[Ht.ad,z.N0,Ne.g7,Ne.g7,be.Hl,de.Wk,ke.Ve,et.Cn,tt.s5,Zt.Vg,Xn.hM,Mn.uc,ni._T,Rn.w,je.vg,Gn.E9,J.z_,He.jc,oe.mV,Ht.ad,z.N0,t.Dc,Ne.g7,Ne.g7,be.Hl,de.Wk,ke.Ve,et.Cn,tt.s5,Zt.Vg,Xn.hM,Mn.uc,ni._T,Rn.w,je.vg,Gn.E9,J.z_,He.jc,oe.mV,$e.PO]}),bt})()},234:(Dt,Xe,S)=>{"use strict";S.d(Xe,{O:()=>t,a:()=>z});var z=function(Ne){return Ne.WoltersKluwer="wolters_kluwer",Ne.Zspace="zspace",Ne}(z||{}),t=function(Ne){return Ne.None="none",Ne.Subscription="subcription",Ne.Device="device",Ne}(t||{})},1007:(Dt,Xe,S)=>{"use strict";S.d(Xe,{Q:()=>Xn});var z=S(4438),t=S(2542);const Ne=["app-button",""],c=["*"],de={[t.P.Light]:{default:"text-gray-800 hover:bg-gray-900/10",flat:"text-gray-700 bg-gray-200 hover:text-black",outline:"border border-solid border-gray-300 text-gray-800 hover:bg-gray-900/10 text-gray-900",primary:"bg-red-700 text-white hover:bg-red-600",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-900 hover:text-gray-800"},[t.P.Dark]:{default:"text-gray-200 hover:bg-gray-800",flat:"bg-gray-700 hover:bg-gray-600",outline:"border border-solid border-gray-600 text-gray-200 hover:bg-white/10 hover:text-white",primary:"bg-red-700 text-white hover:bg-red-600",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-500"}},ke={default:"rounded px-4",rounded:"rounded-3xl px-4",circle:"rounded-full",square:"rounded"},et={"2xs":"h-5",xs:"h-6",sm:"h-8",md:"h-9",lg:"h-11",xl:"h-12"},tt={"2xs":"w-5",xs:"w-6",sm:"w-8",md:"w-9",lg:"w-11",xl:"w-12"},Zt={"2xs":"text-2xs",xs:"text-2xs",sm:"text-xs",md:"text-xs",lg:"text-sm",xl:"text-sm"};let Xn=(()=>{var Mn;class ni{constructor(){this.buttonSize=(0,z.hFB)("md"),this.buttonType=(0,z.hFB)("default"),this.buttonTheme=(0,z.hFB)(t.P.Dark),this.buttonShape=(0,z.hFB)("default"),this.buttonAlign=(0,z.hFB)("center"),this.uppercase=(0,z.hFB)(!0),this.disabled=(0,z.hFB)(!1),this.classes=(0,z.EWP)(()=>{const je=[];switch(je.push("flex items-center justify-center font-sans transition-colors"),je.push(this.disabled()?"opacity-50":"cursor-pointer"),this.uppercase()&&je.push("uppercase"),je.push("left"===this.buttonAlign()?"text-left":"text-center"),je.push(de[this.buttonTheme()][this.buttonType()]),je.push(et[this.buttonSize()]),je.push(Zt[this.buttonSize()]),je.push(ke[this.buttonShape()]),this.buttonShape()){case"circle":case"square":je.push(tt[this.buttonSize()])}return je.join(" ")})}get hostDisabled(){return this.disabled()}get hostButtonType(){return this.buttonType()}}return(Mn=ni).\u0275fac=function(je){return new(je||Mn)},Mn.\u0275cmp=z.VBU({type:Mn,selectors:[["button","app-button",""],["a","app-button",""]],hostVars:2,hostBindings:function(je,$e){2&je&&(z.Mr5("disabled",$e.hostDisabled),z.BMQ("data-button-type",$e.hostButtonType))},inputs:{buttonSize:[z.Mj6.SignalBased,"buttonSize"],buttonType:[z.Mj6.SignalBased,"buttonType"],buttonTheme:[z.Mj6.SignalBased,"buttonTheme"],buttonShape:[z.Mj6.SignalBased,"buttonShape"],buttonAlign:[z.Mj6.SignalBased,"buttonAlign"],uppercase:[z.Mj6.SignalBased,"uppercase"],disabled:[z.Mj6.SignalBased,"disabled"]},attrs:Ne,ngContentSelectors:c,decls:2,vars:2,template:function(je,$e){1&je&&(z.NAR(),z.j41(0,"span"),z.SdG(1),z.k0s()),2&je&&z.HbH($e.classes())},styles:["a[app-button],button[app-button]{border-color:transparent;background:none;border-width:0;padding:0;border-radius:4px;outline:0 none}a[app-button]:focus,button[app-button]:focus{--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-opacity: 1;--tw-ring-color: rgb(45 114 220 / var(--tw-ring-opacity))}a[app-button][buttonshape=circle],a[app-button][ng-reflect-button-shape=circle],button[app-button][buttonshape=circle],button[app-button][ng-reflect-button-shape=circle]{border-radius:.25rem;border-radius:9999px}a[app-button]:not([disabled]):hover,button[app-button]:not([disabled]):hover{cursor:pointer}\n"],encapsulation:2,changeDetection:0}),ni})()},1818:(Dt,Xe,S)=>{"use strict";S.d(Xe,{C:()=>be});var z=S(177),t=S(2026),Ne=S(5189),c=S(4438);let be=(()=>{var de;class ke{}return(de=ke).\u0275fac=function(tt){return new(tt||de)},de.\u0275mod=c.$C({type:de}),de.\u0275inj=c.G2t({imports:[z.MD,t.o,Ne.G]}),ke})()},2996:(Dt,Xe,S)=>{"use strict";S.d(Xe,{z:()=>c});var z=S(177),t=S(9162),Ne=S(4438);let c=(()=>{var be;class de{}return(be=de).\u0275fac=function(et){return new(et||be)},be.\u0275mod=Ne.$C({type:be}),be.\u0275inj=Ne.G2t({imports:[z.MD,t.M]}),de})()},2026:(Dt,Xe,S)=>{"use strict";S.d(Xe,{o:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},6315:(Dt,Xe,S)=>{"use strict";S.d(Xe,{H:()=>de});var z=S(177),t=S(9417),Ne=S(5189),c=S(2026),be=S(4438);let de=(()=>{var ke;class et{}return(ke=et).\u0275fac=function(Zt){return new(Zt||ke)},ke.\u0275mod=be.$C({type:ke}),ke.\u0275inj=be.G2t({imports:[Ne.G,t.YN,z.MD,c.o]}),et})()},3272:(Dt,Xe,S)=>{"use strict";S.d(Xe,{D:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},1488:(Dt,Xe,S)=>{"use strict";S.d(Xe,{f:()=>c});var z=S(177),t=S(2026),Ne=S(4438);let c=(()=>{var be;class de{}return(be=de).\u0275fac=function(et){return new(et||be)},be.\u0275mod=Ne.$C({type:be}),be.\u0275inj=Ne.G2t({imports:[z.MD,t.o]}),de})()},2192:(Dt,Xe,S)=>{"use strict";S.d(Xe,{G:()=>ke});var z=S(177),t=S(5189),Ne=S(2026),c=S(1818),be=S(9511),de=S(4438);let ke=(()=>{var et;class tt{}return(et=tt).\u0275fac=function(Xn){return new(Xn||et)},et.\u0275mod=de.$C({type:et}),et.\u0275inj=de.G2t({imports:[z.MD,be.h,t.G,c.C,Ne.o]}),tt})()},6374:(Dt,Xe,S)=>{"use strict";S.d(Xe,{b:()=>de});var z=S(177),t=S(1818),Ne=S(5189),c=S(2026),be=S(4438);let de=(()=>{var ke;class et{}return(ke=et).\u0275fac=function(Zt){return new(Zt||ke)},ke.\u0275mod=be.$C({type:ke}),ke.\u0275inj=be.G2t({imports:[z.MD,t.C,Ne.G,c.o]}),et})()},9162:(Dt,Xe,S)=>{"use strict";S.d(Xe,{M:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},7424:(Dt,Xe,S)=>{"use strict";S.d(Xe,{j:()=>be});var z=S(4438),t=S(177);const Ne=["*"];function c(de,ke){1&de&&(z.j41(0,"div"),z.SdG(1),z.k0s())}let be=(()=>{var de;class ke{get isActive(){return this._isActive}set isActive(tt){this._isActive=tt,this.changeDetector.markForCheck()}constructor(tt){this.changeDetector=tt,this.hide=!1,this._isActive=!1}ngOnInit(){}}return(de=ke).\u0275fac=function(tt){return new(tt||de)(z.rXU(z.gRc))},de.\u0275cmp=z.VBU({type:de,selectors:[["app-tab"]],inputs:{label:"label",hide:"hide"},ngContentSelectors:Ne,decls:1,vars:1,consts:[[4,"ngIf"]],template:function(tt,Zt){1&tt&&(z.NAR(),z.DNE(0,c,2,0,"div",0)),2&tt&&z.Y8G("ngIf",Zt.isActive)},dependencies:[t.bT],changeDetection:0}),ke})()},9464:(Dt,Xe,S)=>{"use strict";S.d(Xe,{j:()=>c});var z=S(177),t=S(5189),Ne=S(4438);let c=(()=>{var be;class de{}return(be=de).\u0275fac=function(et){return new(et||be)},be.\u0275mod=Ne.$C({type:be}),be.\u0275inj=Ne.G2t({imports:[z.MD,t.G]}),de})()},7018:(Dt,Xe,S)=>{"use strict";S.d(Xe,{O:()=>Ci});var z=S(4438),t=S(7424),Ne=S(9160),c=S(5052),be=S(7925),de=S(1670),ke=S(4264),et=S(177),tt=S(1997);const Zt=["tabButton"],Xn=["*"],Mn=(nn,Gn,Ht,J)=>({"tabs--small":nn,"tabs--medium":Gn,"tabs--scrollable":Ht,"tabs--padded":J}),ni=(nn,Gn,Ht,J,He,oe)=>({"tabs__label--dark":nn,"tabs__label--light":Gn,"tabs__label--dark-active":Ht,"tabs__label--light-active":J,"tabs__label--blue":He,"tabs__label--red":oe});function Rn(nn,Gn){if(1&nn){const Ht=z.RV6();z.j41(0,"button",7,1),z.bIt("click",function(){const He=z.eBV(Ht).$implicit,oe=z.XpG();return z.Njj(oe.handleTabSelect(He))}),z.EFF(2),z.k0s()}if(2&nn){const Ht=Gn.$implicit,J=z.XpG();z.Y8G("ngClass",z.l4e(4,ni,"dark"===J.tabTheme,"light"===J.tabTheme,"dark"===J.tabTheme&&J.isTabActive(Ht),"light"===J.tabTheme&&J.isTabActive(Ht),"blue"===J.tabColor,"red"===J.tabColor)),z.BMQ("aria-selected",J.isTabActive(Ht))("tabIndex",J.isTabActive(Ht)?0:-1),z.R7$(2),z.SpI(" ",Ht.label," ")}}function je(nn,Gn){1&nn&&z.nrm(0,"mat-divider")}let Ci=(()=>{var nn;class Gn{get activeTab(){return this._activeTab.value}set activeTab(J){null!=J&&("string"==typeof J&&(J=J.toUpperCase()),this._activeTab.next(J))}get tabItems(){return this._tabItems}set tabItems(J){this._tabItems=J}constructor(J){this.changeDetector=J,this.display="normal",this.tabTheme="dark",this.activeTabChange=new z.bkB,this._activeTab=new Ne.t(0),this.tabSize="small",this.tabAlign="default",this.tabColor="blue",this.tabUnderline=!1,this.tabPadded=!1,this.scrollable=!1,this.ngUnsubscribe=new c.B}ngAfterContentInit(){this._tabs.changes.pipe((0,be.Q)(this.ngUnsubscribe)).subscribe(J=>{this.mapTabs(),this.changeDetector.markForCheck()}),this.mapTabs(),this._activeTab.pipe((0,be.Q)(this.ngUnsubscribe)).subscribe(J=>{this.showTab(J)}),this._activeTab.pipe((0,de.J)(),(0,ke.p)(([J,He])=>J!==He),(0,be.Q)(this.ngUnsubscribe)).subscribe(([J,He])=>{this.activeTabChange.next(He)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTabSelect(J){this._activeTab.next(J.index)}mapTabs(){this.tabItems=this._tabs.map((J,He)=>({index:He,label:J.label||`Item ${He}`,tab:J}))}showTab(J){this._tabs.forEach((He,oe)=>{switch(typeof J){case"number":He.isActive=J===oe;break;case"string":He.isActive=J.toString().toUpperCase()===He.label.toUpperCase()}}),this.changeDetector.markForCheck()}isTabActive(J){return("string"==typeof this._activeTab.value?J.label.toUpperCase():J.index)===this._activeTab.value}shiftTab(J){const oe=(this.tabItems.find(X=>this.isTabActive(X)).index+J+this.tabItems.length)%this.tabItems.length;this._activeTab.next(oe),this._buttonRefs.toArray()[oe].nativeElement.focus()}}return(nn=Gn).\u0275fac=function(J){return new(J||nn)(z.rXU(z.gRc))},nn.\u0275cmp=z.VBU({type:nn,selectors:[["app-tabs"]],contentQueries:function(J,He,oe){if(1&J&&z.wni(oe,t.j,4),2&J){let X;z.mGM(X=z.lsd())&&(He._tabs=X)}},viewQuery:function(J,He){if(1&J&&z.GBs(Zt,5),2&J){let oe;z.mGM(oe=z.lsd())&&(He._buttonRefs=oe)}},inputs:{display:"display",tabTheme:"tabTheme",activeTab:"activeTab",tabSize:"tabSize",tabAlign:"tabAlign",tabColor:"tabColor",tabUnderline:"tabUnderline",tabPadded:"tabPadded",scrollable:"scrollable"},outputs:{activeTabChange:"activeTabChange"},ngContentSelectors:Xn,decls:7,vars:10,consts:[["tabElements",""],["tabButton",""],[1,"tabs",3,"ngClass"],["role","tablist",1,"tabs__labels",3,"keyup.arrowright","keyup.arrowleft"],["class","tabs__label","role","tab","type","button","data-test","tabButton",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"tabs__content"],["role","tab","type","button","data-test","tabButton",1,"tabs__label",3,"click","ngClass"]],template:function(J,He){if(1&J){const oe=z.RV6();z.NAR(),z.j41(0,"div",2)(1,"div",3,0),z.bIt("keyup.arrowright",function(){return z.eBV(oe),z.Njj(He.shiftTab(1))})("keyup.arrowleft",function(){return z.eBV(oe),z.Njj(He.shiftTab(-1))}),z.DNE(3,Rn,3,11,"button",4)(4,je,1,0,"mat-divider",5),z.k0s(),z.j41(5,"div",6),z.SdG(6),z.k0s()()}2&J&&(z.Y8G("ngClass",z.ziG(5,Mn,"small"===He.tabSize,"medium"===He.tabSize,He.scrollable,He.tabPadded)),z.R7$(),z.AVh("tabs__labels--center","center"===He.tabAlign),z.R7$(2),z.Y8G("ngForOf",He.tabItems),z.R7$(),z.Y8G("ngIf",He.tabUnderline))},dependencies:[et.YU,et.Sq,et.bT,tt.q],styles:['.tabs__labels[_ngcontent-%COMP%]{margin-bottom:8px}.tabs__labels--center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.tabs__label[_ngcontent-%COMP%]{padding:2px 4px 4px;margin-right:8px;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:500;-webkit-user-select:none;user-select:none;position:relative;background:none;border:none}.tabs__label[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid;margin-top:4px;width:0;transition:.25s ease;position:absolute;bottom:0;left:0}.tabs__label[_ngcontent-%COMP%]:hover{cursor:pointer}.tabs__label--blue[_ngcontent-%COMP%]:after{border-color:#2d72dc}.tabs__label--red[_ngcontent-%COMP%]:after{border-color:#de3535}.tabs__label--dark[_ngcontent-%COMP%]{color:#96a8c0}.tabs__label--dark[_ngcontent-%COMP%]:hover, .tabs__label--dark-active[_ngcontent-%COMP%]{color:#fff}.tabs__label--dark-active[_ngcontent-%COMP%]:after{width:100%}.tabs__label--light[_ngcontent-%COMP%]{color:#374a68}.tabs__label--light[_ngcontent-%COMP%]:hover, .tabs__label--light-active[_ngcontent-%COMP%]{color:#283853}.tabs__label--light-active[_ngcontent-%COMP%]:after{width:100%}.tabs--medium[_ngcontent-%COMP%]   .tabs__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tabs--scrollable[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:100%}.tabs--scrollable[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{overflow:auto;flex:1 1 auto}.tabs--padded[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{padding:20px 4px}'],changeDetection:0}),Gn})()},4026:(Dt,Xe,S)=>{"use strict";S.d(Xe,{m:()=>c});var z=S(177),t=S(1818),Ne=S(4438);let c=(()=>{var be;class de{}return(be=de).\u0275fac=function(et){return new(et||be)},be.\u0275mod=Ne.$C({type:be}),be.\u0275inj=Ne.G2t({imports:[z.MD,t.C]}),de})()},8824:(Dt,Xe,S)=>{"use strict";S.d(Xe,{j:()=>be});var z=S(177),t=S(1818),Ne=S(2026),c=S(4438);let be=(()=>{var de;class ke{}return(de=ke).\u0275fac=function(tt){return new(tt||de)},de.\u0275mod=c.$C({type:de}),de.\u0275inj=c.G2t({imports:[z.MD,t.C,Ne.o]}),ke})()},5584:(Dt,Xe,S)=>{"use strict";S.d(Xe,{d:()=>c});var z=S(177),t=S(2026),Ne=S(4438);let c=(()=>{var be;class de{}return(be=de).\u0275fac=function(et){return new(et||be)},be.\u0275mod=Ne.$C({type:be}),be.\u0275inj=Ne.G2t({imports:[z.MD,t.o]}),de})()},556:(Dt,Xe,S)=>{"use strict";S.d(Xe,{f:()=>et});var z=S(177),t=S(5189),Ne=S(9511),c=S(2026),be=S(2192),de=S(1818),ke=S(4438);let et=(()=>{var tt;class Zt{}return(tt=Zt).\u0275fac=function(Mn){return new(Mn||tt)},tt.\u0275mod=ke.$C({type:tt}),tt.\u0275inj=ke.G2t({imports:[z.MD,c.o,t.G,de.C,be.G,Ne.h]}),Zt})()},4218:(Dt,Xe,S)=>{"use strict";S.d(Xe,{H:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},9511:(Dt,Xe,S)=>{"use strict";S.d(Xe,{h:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},3287:(Dt,Xe,S)=>{"use strict";S.d(Xe,{H:()=>Ne});var z=S(2573),t=S(4902);function Ne(c,be,de=!0){const ke=new t.F,et=[];return de&&et.push(be.map(tt=>tt.label)),c.forEach(tt=>{const Zt=be.map(Xn=>tt[Xn.field]);et.push(Zt)}),new z.c(tt=>{const Zt=ke.unparse(et,{quotes:!0,header:!1});tt.next(Zt),tt.complete()})}},2542:(Dt,Xe,S)=>{"use strict";S.d(Xe,{P:()=>z});var z=function(t){return t.Dark="dark",t.Light="light",t}(z||{})},6049:(Dt,Xe,S)=>{"use strict";S.d(Xe,{Y:()=>Ne});var z=S(177),t=S(4438);let Ne=(()=>{var c;class be{}return(c=be).\u0275fac=function(ke){return new(ke||c)},c.\u0275mod=t.$C({type:c}),c.\u0275inj=t.G2t({imports:[z.MD]}),be})()},5056:(Dt,Xe,S)=>{"use strict";S.d(Xe,{G:()=>ms});var z=S(177),t=S(1562),Ne=S(6315),c=S(5189),be=S(9417),de=S(4438);let ke=(()=>{var Ke;class sn{}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[z.MD,be.YN]}),sn})();class et{}var tt=S(9204),Zt=S(7153);let Mn=(()=>{var Ke;class sn{constructor(Le){if(!Le.accountUrl)throw new Error("Missing accountUrl. Please set in app config via ZendeskWidgetProvider");this.window=function Xn(){return window}();let Hn=this.window;Hn.zEmbed||function(ut,El){var ee,m,ao,fs,Tl=[],Ss=document.createElement("iframe");Hn.zEmbed=function(){Tl.push(arguments)},Hn.zE=Hn.zE||Hn.zEmbed,Ss.src="javascript:false",Ss.title="",Ss.style.cssText="display: none",(ao=(ao=document.getElementsByTagName("script"))[ao.length-1]).parentNode.insertBefore(Ss,ao),fs=Ss.contentWindow.document;try{m=fs}catch{ee=document.domain,Ss.src='javascript:var d=document.open();d.domain="'+ee+'";void(0);',m=fs}m.open()._l=function(){var bs=this.createElement("script");ee&&(this.domain=ee),bs.id="js-iframe-async",bs.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost=Le.accountUrl,this.zEQueue=Tl,this.body.appendChild(bs)},m.write('<body onload="document._l();">'),m.close()}(),this.window.zE(()=>{Le.beforePageLoad(this.window.zE)})}setLocale(Le){this.window.zE(()=>{this.window.zE.setLocale(Le)})}identify(Le){this.window.zE(()=>{(0,tt.isNil)(Le)?this.window.zE("webWidget","clear"):this.window.zE.identify({name:this.getUserFullName(Le),email:Le.email})})}hide(){this.window.zE(()=>{this.window.zE.hide()})}show(){this.window.zE(()=>{this.window.zE.show()})}activate(Le){this.window.zE(()=>{this.window.zE.activate(Le)})}showWidget(Le="help"){this.hide(),this.setSettings({webWidget:{helpCenter:{suppress:"contact"===Le}}}),this.activate({hideOnClose:!0})}setHelpCenterSuggestions(Le){this.window.zE(()=>{this.window.zE.setHelpCenterSuggestions(Le)})}setSettings(Le){this.window.zE(()=>{this.window.zE("webWidget","updateSettings",Le)})}updateFromProfile(Le){const Hn=[];if(null!=Le){const{premium_account:El,premium_account_type:ee,developer_account:m,subscription:ao}=Le;El?(Hn.push(`premium_account_${ee}`),ao&&Hn.push(`subscription_${ao.subscription_provider}`)):Hn.push("free_account"),m&&Hn.push("developer_account")}const ut=(0,Zt.E)(Le);this.setSettings({webWidget:{position:{horizontal:"right",vertical:"bottom"},offset:{horizontal:"0px",vertical:"0px"},contactForm:{suppress:!ut,tags:Hn,fields:[{id:"name",prefill:{"*":this.getUserFullName(Le)}}]}}})}getUserFullName(Le){if(Le){const{first_name:Hn,last_name:ut}=Le;return`${Hn} ${ut}`}return""}}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)(de.KVO(et))},Ke.\u0275prov=de.jDH({token:Ke,factory:Ke.\u0275fac,providedIn:"root"}),sn})(),ni=(()=>{var Ke;class sn{static forRoot(Le){return{ngModule:sn,providers:[{provide:Le,useClass:Le},{provide:Mn,useClass:Mn,deps:[Le]}]}}}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[z.MD]}),sn})();class Rn extends et{constructor(){super(...arguments),this.accountUrl="biodigital.zendesk.com"}beforePageLoad(sn){sn.setLocale("en"),sn.hide()}}let je=(()=>{var Ke;class sn{}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[ni.forRoot(Rn)]}),sn})();var $e=S(1818),Ci=S(556),nn=S(3272),Gn=S(9511),Ht=S(9162),J=S(6049),He=S(6374),oe=S(9464),X=S(2996),At=S(2026),Xo=S(2192),w=S(5286),pe=S(1488),bt=S(8645);let yt=(()=>{var Ke;class sn{}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[z.MD,At.o]}),sn})(),En=(()=>{var Ke;class sn{}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[z.MD,Ne.H,At.o]}),sn})();var ro=S(8824),he=S(9529),Y_=S(5584),q_=S(4218),In=S(4026);let ms=(()=>{var Ke;class sn{}return(Ke=sn).\u0275fac=function(Le){return new(Le||Ke)},Ke.\u0275mod=de.$C({type:Ke}),Ke.\u0275inj=de.G2t({imports:[bt.iI,$e.C,t.YG,X.z,z.MD,Gn.h,At.o,nn.D,Ne.H,c.G,pe.f,Xo.G,He.b,J.Y,Ht.M,be.X1,ke,oe.j,yt,Ci.f,je,ro.j,he.bU,Y_.d,q_.H,w.y2.forChild(),In.m,$e.C,X.z,Gn.h,nn.D,At.o,Ne.H,pe.f,Xo.G,J.Y,He.b,En,Ht.M,ke,oe.j,yt,Ci.f,Y_.d,q_.H,In.m]}),sn})()},4768:(Dt,Xe,S)=>{"use strict";var z=S(345),t=S(4438),Ne=S(728),c=S(5763);class de{}let ke=(()=>{class e{constructor(i,s,r){this.hostingURL=i,this.embedded=s,this.widgetConfig=r}}return e.type="[Widget] Setup Widget",e})(),et=(()=>{class e{}return e.type="[Widget] Reset",e})(),tt=(()=>{class e{constructor(i){this.enabled=i}}return e.type="[Widget] Set Input Enabled",e})(),Zt=(()=>{class e{constructor(i){this.config=i}}return e.type="[Widget] Set API Config",e})(),Xn=(()=>{class e{constructor(i){this.productAccountId=i}}return e.type="[Widget] Get Widget Product Settings",e})(),Mn=(()=>{class e{constructor(i){this.widgetSettings=i}}return e.type="[Widget] Set Widget Product Settings",e})();var ni=function(n){return n[n.User=0]="User",n[n.Developer=1]="Developer",n}(ni||{}),Rn=function(n){return n.Widget="widget",n.WidgetAPI="widgetapi",n}(Rn||{}),je=S(470),$e=S(1626);let Ci=(()=>{var n;class e{constructor(i){this.http=i}getWidgetSettings(i){return this.http.get(`/ws/product/account/settings?product_acctid=${i}`)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class nn{}class Ht{}var J=S(8407),He=S(9160),oe=S(5052),X=S(4264),At=S(1756),Xo=S(215),w=S(7925),pe=function(n){return n.Started="started",n.Loaded="loaded",n.Tick="tick",n.HumanReady="human.ready",n.HumanStarted="started",n.Error="error",n.HumanError="human.error",n.CanvasResized="canvas.resized",n.HumanCanvasResized="human.canvasResized",n.LogDebug="_log.debug",n.LogError="_log.error",n.LogInfo="_log.info",n.LogWarn="_log.warn",n.SceneLoaded="scene.loaded",n.HumanProgress="human.progress",n.AssetsLoadFinish="assets.load.finish",n.AssetsLoadProgress="assets.load.progress",n.AssetsLoadStart="assets.load.start",n.CameraRested="camera.rested",n.CameraUpdated="camera.updated",n.ModuleInteractive="module.interactive",n.ModulesActivateFinish="modules.activate.finish",n.ModulesCreateFinish="modules.create.finish",n.ModulesDestroyFinish="modules.destroy.finish",n.ModulesFetchStart="modules.fetch.start",n.PickPicked="pick.picked",n.SceneMarkersUpdated="scene.markers.updated",n.SceneObjectRenderable="scene.objectRenderable",n.SceneObjectsSelected="scene.objectsSelected",n.SceneObjectsShown="scene.objectsShown",n.ScenePicked="scene.picked",n.SceneRestored="scene.restored",n.SceneXrayEnabled="scene.xrayEnabled",n.SceneXrayDisabled="scene.xrayDisabled",n.SceneReady="scene.ready",n.TimelineChapterTransition="timeline.chapterTransition",n.TimelinePlaying="timeline.playing",n.TimelineScrubbed="timeline.scrubbed",n.TimelinePlayed="timeline.played",n.TimelinePaused="timeline.paused",n.TimelineCompleted="timeline.completed",n.TimelineTimeFrameUpdated="timeline.timeFrame.updated",n.TimelineAnimatingStart="timeline.animating.start",n.TimelineAnimatingEnd="timeline.animating.end",n.GraphAssetAttachFinish="graph.assetAttach.finish",n.TweenVisibilityUpdate="TweenVisibilityUpdate",n.VariantsUpdate="VariantsUpdate",n}(pe||{}),bt=function(n){return n.Loft="Loft",n.Studio="Studio",n.Viewer="Viewer",n.All="",n}(bt||{}),yt=function(n){return n.Bookmark="bookmark",n.Module="module",n.Internal="internal",n}(yt||{}),En=function(n){return n.Local="Local",n.QA="QA",n.Staging="Staging",n.Production="Production",n}(En||{}),ro=function(n){return n.Web="web",n.SDK="sdk",n}(ro||{});const he={production:!0,assetDomain:"assets-human.biodigital.com",supportEmail:"support@biodigital.com",productKey:"wa_mvMQjb23",googleAuthKey:"66261904577-061oin26uo7sor0vrqc8dnn105irq82n.apps.googleusercontent.com",googleAnalyticsId:"UA-1141985-29",linkedinId:"2641938",pendoId:"3a783681-e53b-4ebd-69c0-788bbae48f13",rollbarToken:"eccc0d971b014ed6abaf2d3172d2c709",hubspotId:"23868815",recaptchaV3Key:"6LdvZvcUAAAAAM0Z1St9WQXwvSYd__hMUY2WZ6um",recaptchaV2Key:"6LdtyhsUAAAAAF-hCYS1co8ZhnAEnzHlNhRMHSxE",application:bt.Viewer,deploy:En.Production,platform:ro.Web,exportType:yt.Bookmark,offline:!1,native:!1,minPasswordLength:8};var Y_=S(9989);class q_ extends Y_.Ay{constructor(){super("HumanDatabase"),this.version(2).stores({keyValue:",value",analytics:"message"}),this.open(),this.keyValue=this.table("keyValue"),this.analytics=this.table("analytics")}}var In=function(n){return n.WidgetOptions="widgetOptions",n.SnapshotOptions="snapshotOptions",n.Locale="locale",n.GroupRestriction="GroupRestriction",n.UserAppId="userAppId",n.RememberMeEmail="rememberMeEmail",n.LabelConversionSeen="labelConversionSeen",n.DefaultGroupEdit="defaultGroupEdit",n.DefaultCollectionId="defaultCollectionId",n.GettingStartedTutorial="gettingStartedTutorial",n.SystemMessage="systemMessage",n.ExploreRedesignMessage="exploreRedesignMessage",n.Iphone12Warning="iphone12Warning",n.RecentRecipes="recentRecipes",n.TeamTrialExpirationSeen="teamTrialExpiredSeen",n.ProExpirationSeen="proExpirationSeen",n.PaintPalettes="paintPalettes",n.RecentSearchConfig="recentSearchConfig",n.CameraDebug="cameraDebug",n.TeamWelcomeTourSeen="teamWelcomeTourSeen",n.UserJoinPromptSeen="userJoinPromptSeen",n.UserJoinNotificationInteracted="userJoinNotificationInteracted",n.ZSpaceDevice="zSpaceDevice",n.EnableAdvancedStats="enableAdvancedStats",n.XREnabled="xrEnabled",n}(In||{}),ms=function(n){return n.UserMessagesSeen="userMessagesSeen",n.PreviewSize="previewSize",n.GPUAnalyticsStored="gpuAnalyticsStored",n}(ms||{}),Ke=function(n){return n.PreviewStory="previewStory",n.PreviewBookmark="previewBookmark",n}(Ke||{});class Oi{constructor(){this._data={}}get keys(){return Object.keys(this._data)}get length(){return this.keys.length}clear(){this._data={}}getItem(e){return this._data[e]}key(e){return this.keys[e]}removeItem(e){delete this._data[e]}setItem(e,o){this._data[e]=o}}let Le=(()=>{var n;class e{constructor(){this._localStorage=this.getStorage("localStorage"),this._sessionStorage=this.getStorage("sessionStorage"),this._indexedStorage=new q_}getLocalItem(i){return this._localStorage.getItem(`${i}`)}getLocalJSON(i){const s=this.getLocalItem(i);return s?JSON.parse(s):null}setLocalItem(i,s){const r="object"==typeof s?JSON.stringify(s):`${s}`;try{return this._localStorage.setItem(`${i}`,r),!0}catch{return!1}}removeLocalItem(i){this._localStorage.removeItem(`${i}`)}getSessionItem(i){const s=this._sessionStorage.getItem(`${i}`);return s?JSON.parse(s):null}setSessionItem(i,s){const r=JSON.stringify(s);try{return this._sessionStorage.setItem(`${i}`,r),!0}catch{return!1}}removeSessionItem(i){this._sessionStorage.removeItem(`${i}`)}setDatabaseItem(i,s){return this._indexedStorage.keyValue.put(s,i)}setDatabaseAnalyticItem(i){var s=this;(0,J.A)(function*(){yield s._indexedStorage.analytics.put(i)})()}getDatabaseOfflineAnalytics(i){var s=this;(0,J.A)(function*(){const r=yield s._indexedStorage.analytics.toArray();s._indexedStorage.analytics.clear(),i(r)})()}getDatabaseOfflineAnalyticsCount(i){var s=this;(0,J.A)(function*(){const r=yield s._indexedStorage.analytics.toArray();i(r.length)})()}getDatabaseItem(i){return this._indexedStorage.keyValue.get(i)}clearStorage(){this.clearLocalStorage(),this.clearSessionStorage()}clearLocalStorage(){this._localStorage.clear()}clearSessionStorage(){this._sessionStorage.clear()}getStorage(i){try{return window[i]||new Oi}catch{return new Oi}}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Hn=function(n){return n.Content="content",n.Engine="engine",n}(Hn||{}),ut=S(8645);let El=(()=>{var n;class e{constructor(i){this.router=i}redirectToErrorPage(i,s,r){(this.router.url||"").match("/error")||this.router.navigateByUrl(he.application===bt.Viewer?"/error":"/view/error",{skipLocationChange:!0,state:{errorType:i,errorCode:s,error:r,errorUrl:this.router.url}})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(ut.Ix))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ee=S(1724),m=S(9204);const ao={[ee.FogModeNumericEnum.Linear]:"linear",[ee.FogModeNumericEnum.Exponential]:"exp",[ee.FogModeNumericEnum.ExponentialSquared]:"exp2"};var K_=S(7015);const fs=ee.VERSION;function bs(){return window.matchMedia("(hover: hover)").matches}function BS(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}const UO={accessToken:he.rollbarToken,captureUncaught:!1,captureUnhandledRejections:!1,autoInstrument:{log:!1},payload:{environment:he.deploy.toLowerCase(),application:he.application,engineVersion:fs,webGLEnabled:function Ss(){const n=document.createElement("canvas"),e=n.getContext("webgl")||n.getContext("experimental-webgl"),o=e instanceof WebGLRenderingContext;return o&&e.getExtension("WEBGL_lose_context")?.loseContext(),o}()}},Ru=new t.nKC("rollbar");class xO{error(e){console.error(e)}}const GO=(n,e)=>(0,ee.joinPath)(n,"assets",e),ku=1e3,Du=30;function zS(n){return new Promise(e=>setTimeout(e,n))}function Lu(n,e,o,i){return Uu.apply(this,arguments)}function Uu(){return(Uu=(0,J.A)(function*(n,e,o,i,s=0){if(s>=Du)return console.warn("fetch timeout for ",o),null;const r=GO(e,o);try{const a=yield fetch(r,{signal:n});return a.ok?i(a):null}catch{}return yield zS(ku),Lu(n,e,o,i,s+1)})).apply(this,arguments)}function WS(n,e,o){return Lu(n,e,o,function(){var i=(0,J.A)(function*(s){return s.json()});return function(s){return i.apply(this,arguments)}}())}function XS(n,e,o){return Lu(n,e,o,function(){var i=(0,J.A)(function*(s){return s.arrayBuffer()});return function(s){return i.apply(this,arguments)}}())}const $O={material:WS,morph:XS,geometry:XS,transform:WS};class FO{constructor(e,o,i={}){let s=new ee.BioDigitalWebSocketServer(o,i);const r=typeof AbortController>"u"?null:new ee.MultiKeyMap;function l(p,u,g=0){if(g>=Du)return console.warn("fetch PUT timeout for ",p),null;fetch("/assets/"+p,u).catch(()=>{setTimeout(()=>l(p,u,g+1),ku)})}function _(p,u,g,y){return d.apply(this,arguments)}function d(){return(d=(0,J.A)(function*(p,u,g,y,C=0){const O=g.split("/"),L=(0,ee.joinPath)(p,"content/states",O[0],u,O[1],y);if(C>=Du)throw new Error("asset library fetch timeout for "+L);try{return(yield fetch(L)).json()}catch{}return yield zS(ku),_(p,u,g,y,C+1)})).apply(this,arguments)}this.getAsset=function(){var p=(0,J.A)(function*(u,g){const y=$O[u];if(!y)throw new Error("BioDigitalHybridServer: Unsupported type '$type'");let C=null;r&&(C=new AbortController,r.set(u,g,C));let O=yield y(C?.signal,e,g);return null===O&&(O=yield function a(){return s||(s=new ee.BioDigitalWebSocketServer(o,i)),s}().getAsset(u,g),l(g,{method:"PUT",body:"morph"===u||"geometry"===u?O:JSON.stringify(O)})),r&&r?.delete(u,g),O});return function(u,g){return p.apply(this,arguments)}}(),this.getAssetLibrary=_,this.destroy=()=>{r&&(r.forEach(p=>p.abort()),r.clear()),s&&s.destroy()}}}class HS{constructor(){this._subjects={}}getEvent(e){return(this._subjects[e]=this._subjects[e]??new oe.B).asObservable()}fireEvent(e,o){const i=this._subjects[e];i&&i.next(o)}}let BO=(()=>{var n;class e extends HS{}return(n=e).\u0275fac=(()=>{let o;return function(s){return(o||(o=t.xGo(n)))(s||n)}})(),n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Lt=(()=>{var n;class e{get engine(){return this._engine}get server(){return this._server}get serverBaseDirectory(){return typeof localBaseDirectory>"u"?"/":localBaseDirectory}constructor(i,s,r,a,l){this.errorService=i,this.storageService=s,this.engineEventService=r,this.http=a,this.rollbar=l,this.events={},this.errorLogged=!1,this._engineCreated=new He.t(void 0),this._engineDestroyed=new oe.B,this.registerEngineWorkers(),this.events=Object.values(pe).reduce((_,d)=>(_[d]=this.engineEventService.getEvent(d),_),{}),this.engineCreated$=this._engineCreated.asObservable().pipe((0,X.p)(_=>!(0,m.isNil)(_))),this.engineDestroyed$=this._engineDestroyed.asObservable(),this.engineCreated$.pipe((0,At.Z)(_=>this.getGPUCapabilities(_))).subscribe(_=>{this.gpuCapabilities=_}),this.initEngineErrorHandling()}getEvent(i){return this.events[i]}fireEvent(i,s){this.engineEventService.fireEvent(i,s)}initEngine(i){return this.createServerInstance(),this.createEngineInstance(i),this.fireEvent(pe.Loaded),this.engine}destroyEngine(){this._engine&&(this._engineCreated.next(void 0),this._engineDestroyed.next(),this._engine.destroy(),this._engine=null),this._server&&(this._server.destroy(),this._server=null)}setStory(i){this.engine.setStory(i),he.offline&&(this._server.moduleId=i.moduleId,typeof requiresFileExtensions<"u"&&(this._server.requiresFileExtensions=requiresFileExtensions)),this.engine.story.chapters.forEach(s=>{s.on("progress",()=>{const{id:r,loadProgress:a}=s;this.fireEvent(pe.AssetsLoadProgress,{chapterId:r,chapterProgress:a})})})}getWEBGLInfo(){return this.gpuCapabilities?.webgl?.params}setProperties(i){const{story:s,renderer:r}=this.engine,a=s?.activeChapter,l=s?.cameraController;(0,m.isNil)(a)||(this.setFogProperties(r,a,i),this.setCameraProperties(r,a,l,i))}setFogProperties(i,s,r){Object.entries(r).forEach(([l,_])=>{if(l.startsWith("fog.")&&((0,m.has)(i.environment,l)&&(0,m.set)(s.properties,l,_),(0,m.has)(i.environment,l)))switch(l){case"fog.density":i.environment.fog.density=_/ee.BIODIGITAL_SCENE_SCALE;break;case"fog.mode":i.environment.fog.mode=ao[_];break;case"fog.start":i.environment.fog.start=_*ee.BIODIGITAL_SCENE_SCALE;break;case"fog.end":i.environment.fog.end=_*ee.BIODIGITAL_SCENE_SCALE;break;default:(0,m.set)(i.environment,l,_)}}),!1===r["fog.enabled"]&&(i.environment.fog.mode="")}setCameraProperties(i,s,r,a){Object.entries(a).forEach(([d,p])=>{if(d.startsWith("camera."))switch(d){case"camera.optics.near":s.properties.camera.optics.near=p;break;case"camera.optics.far":s.properties.camera.optics.far=p;break;case"camera.optics.fov":s.properties.camera.optics.fov=p;break;case"camera.zoomLimits":s.properties.camera.zoomLimits=p}});const{optics:l,zoomLimits:_}=s.properties.camera;i.camera.fov=l.fov*Math.PI/180,i.camera.far=l.far*ee.BIODIGITAL_SCENE_SCALE,i.camera.near=l.near*ee.BIODIGITAL_SCENE_SCALE,i.camera.dirtyProjection(),r.minDistance=_.min*ee.BIODIGITAL_SCENE_SCALE,r.maxDistance=_.max*ee.BIODIGITAL_SCENE_SCALE}getGPUCapabilities(i){var s=this;return(0,J.A)(function*(){return s.gpuCapabilities=s.gpuCapabilities??(yield i.renderer.getGPUCapabilities()),s.gpuCapabilities})()}initAnalytics(i,s,r,a){var l=this;return(0,J.A)(function*(){l.gpuAnalytic={version:4,app_producttype:i,app_productkey:s,gpu_data:{},acct_cred_type:r,acct_cred_id:a,offline_event:he.offline?1:0};const _=yield(0,Xo._)(l.engineCreated$),d=yield l.getGPUCapabilities(_);if(l.gpuAnalytic={...l.gpuAnalytic,gpu_data:{...d}},!l.storageService.getSessionItem(ms.GPUAnalyticsStored)){const u=he.offline?{...l.gpuAnalytic,event_timestamp:(new Date).toISOString().substring(0,19)}:l.gpuAnalytic;he.offline?fetch("https://human.biodigital.com/ws/product/analytic/gpu-event",{method:"POST",body:JSON.stringify(u),headers:new Headers({"Content-Type":"application/json; charset=utf-8"}),mode:"no-cors"}).then(()=>{l.storageService.setSessionItem(ms.GPUAnalyticsStored,Date.now())}):l.http.post("/ws/product/analytic/gpu-event",u,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(()=>{l.storageService.setSessionItem(ms.GPUAnalyticsStored,Date.now())})}})()}createServerInstance(){if(this._server)throw new Error("Websocket server already exists");this._server=he.offline?new ee.BioDigitalFileServer(this.serverBaseDirectory):he.native?new FO(this.serverBaseDirectory,he.assetDomain,{timeout:6e5,socketProtocol:"wss"}):new ee.BioDigitalWebSocketServer(he.assetDomain,{timeout:6e5})}createEngineInstance(i){if(this._engine)throw new Error("Engine is already instantiated");try{const s=typeof localBaseDirectory>"u"?"/":localBaseDirectory;this._engine=new ee.BioDigitalEngine(this._server,{...i,baseUrl:s}),this.initEngineTickEvent(this._engine),this.initTweenVisibilityEvent(this._engine),this._engineCreated.next(this._engine)}catch(s){const r=s??new Error("There was an error creating the engine");this.fireEvent(pe.HumanError,r)}}initEngineErrorHandling(){this.getEvent(pe.HumanError).pipe((0,X.p)(i=>!(0,m.isNil)(i))).subscribe(i=>{this.handleFatalEngineErrors(i)})}initEngineTickEvent(i){const s=r=>{this.fireEvent(pe.Tick,r)};i.renderer.on("animate",s),i.on("destroy",()=>{i.renderer.off("animate",s)})}initTweenVisibilityEvent(i){let s={shown:{},shownSetByTween:{},variant:{}},r=!1;this.getEvent(pe.TimelineAnimatingStart).pipe((0,w.Q)(this._engineDestroyed)).subscribe(()=>{r=!0,s={shown:{},shownSetByTween:{},variant:{}}}),this.getEvent(pe.TimelinePlaying).pipe((0,w.Q)(this._engineDestroyed)).subscribe(()=>{const{shownSetByTween:a,variant:l}=s;Object.keys(a).length>0&&this.fireEvent(pe.TweenVisibilityUpdate,a),Object.keys(l).length>0&&this.fireEvent(pe.VariantsUpdate,l),r=!1,s={shown:{},shownSetByTween:{},variant:{}}}),i.on("changestory",()=>{const a=_=>{const d=_?.property,p=_?.object,u=p?.objectId;if(d in s&&(s[d][u]=p[d],"shown"===d&&r)){const{shown:y}=p;s.shownSetByTween[u]=y}},{anatomyObjects:l}=i.story.anatomySceneGraph;l.forEach(_=>{_.on("change",a)})}),i.on("changechapter",()=>{const{anatomyObjects:a}=i.story.anatomySceneGraph,l={shown:{},shownSetByTween:{},variant:{}};a.forEach(d=>function zO(n,e){for(const o in n)o in e&&(n[o][e.objectId]=e[o])}(l,d));const{variant:_}=l;this.fireEvent(pe.VariantsUpdate,_)})}registerEngineWorkers(){new Worker(S.tu(new URL(S.p+S.u(401),S.b))),(0,ee.registerWorker)("geometry",()=>new Worker(S.tu(new URL(S.p+S.u(762),S.b)))),(0,ee.registerWorker)("texture",()=>new Worker(S.tu(new URL(S.p+S.u(235),S.b)))),(0,ee.registerWorker)("simulation",()=>new Worker(S.tu(new URL(S.p+S.u(513),S.b))))}handleFatalEngineErrors(i){const{message:s,name:r,stack:a}=i,l={name:r,message:s,stack:a},_={...this.gpuAnalytic,error_category:r,error_message:JSON.stringify({message:s,stack:a})};he.offline&&(_.event_timestamp=(new Date).toISOString().substring(0,19)),this.errorLogged||(this.rollbar.error(i),this.http.post("/ws/product/error/gpu-event",_,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(),this.errorLogged=!0),this.errorService.redirectToErrorPage(Hn.Engine,void 0,l)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(El),t.KVO(Le),t.KVO(BO),t.KVO($e.Qq),t.KVO(Ru))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ur,ii=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Je=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const QS={userType:ni.User,authenticating:!1,authenticated:!1,widgetUrlConfig:{id:"",type:""},widgetApiConfig:null,parentUrl:{full:"",domain:""},embedded:!1,engineVersion:"",engineAPIVersion:"",inputEnabled:!0,widgetSettings:void 0};let Qt=((ur=class{static getWidgetState(e){return e}static getUserType(e){return e.userType}static getWidgetAuthenticating(e){return e.authenticating}static getWidgetAuthenticated(e){return e.authenticated}static getInputEnabled(e){return e.inputEnabled}static getEmbedded(e){return e.embedded}static getBypassAnalytics(e){return e.widgetUrlConfig["bypass-analytics"]}static getParentURL(e){return e.parentUrl.full}static getWidgetUrlConfig(e){return e.widgetUrlConfig}static getWidgetApiUIConfig(e){return e.widgetApiConfig}static getWidgetSettings(e){return e.widgetSettings}setupWidget(e,{hostingURL:o,embedded:i,widgetConfig:s}){const r=o.match(/:\/\/(.[^/]+)/);e.patchState({userType:s.uaid?ni.User:ni.Developer,embedded:i,widgetUrlConfig:s,parentUrl:{full:o,domain:r&&r[1]?r[1]:o}})}getWidgetProductSettings(e,{productAccountId:o}){this.widgetConfigService.getWidgetSettings(o).subscribe(({settings:i})=>{e.dispatch(new Mn(i))})}setWidgetProductSettings(e,{widgetSettings:o}){e.patchState({widgetSettings:o})}resetWidget(e){e.setState(QS)}buildAppActivityData(e){const{engineVersion:o,engineAPIVersion:i,widgetUrlConfig:s}=e,r={engine_version:o,api_version:i};return Object.entries(s).filter(([a])=>"dk"!==a).forEach(([a,l])=>{r[`url_param_${a}`]=l}),(0,je.bj)(nn,r)}setInputEnabled(e,o){e.patchState({inputEnabled:o.enabled})}setWidgetApiConfig(e,o){e.patchState({widgetApiConfig:o.config})}buildUserAnalytic(e,o,i){const{widgetUrlConfig:s,parentUrl:r}=e,a=s.uaid,l=r.domain,_={...this.buildAppActivityData(e),parent_analytic_identifier:a,referer_domain:l,[`${o}_source`]:i};return(0,je.bj)(Ht,{analytic_platform:Rn.Widget,analytic_type:o,analytic_data:_})}ngxsOnInit(e){e.patchState({engineVersion:fs,engineAPIVersion:"2.0.1"})}constructor(e,o){this.widgetConfigService=e,this.engineService=o}}).\u0275fac=function(e){return new(e||ur)(t.KVO(Ci),t.KVO(Lt))},ur.\u0275prov=t.jDH({token:ur,factory:ur.\u0275fac}),ur);ii([(0,c.rc)(ke),Je("design:type",Function),Je("design:paramtypes",[Object,ke]),Je("design:returntype",void 0)],Qt.prototype,"setupWidget",null),ii([(0,c.rc)(Xn),Je("design:type",Function),Je("design:paramtypes",[Object,Xn]),Je("design:returntype",void 0)],Qt.prototype,"getWidgetProductSettings",null),ii([(0,c.rc)(Mn),Je("design:type",Function),Je("design:paramtypes",[Object,Mn]),Je("design:returntype",void 0)],Qt.prototype,"setWidgetProductSettings",null),ii([(0,c.rc)(et),Je("design:type",Function),Je("design:paramtypes",[Object]),Je("design:returntype",void 0)],Qt.prototype,"resetWidget",null),ii([(0,c.rc)(tt),Je("design:type",Function),Je("design:paramtypes",[Object,tt]),Je("design:returntype",void 0)],Qt.prototype,"setInputEnabled",null),ii([(0,c.rc)(Zt),Je("design:type",Function),Je("design:paramtypes",[Object,Zt]),Je("design:returntype",void 0)],Qt.prototype,"setWidgetApiConfig",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getWidgetState",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getUserType",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getWidgetAuthenticating",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getWidgetAuthenticated",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getInputEnabled",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getEmbedded",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getBypassAnalytics",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getParentURL",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getWidgetUrlConfig",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",void 0)],Qt,"getWidgetApiUIConfig",null),ii([(0,c.MD)(),Je("design:type",Function),Je("design:paramtypes",[de]),Je("design:returntype",Array)],Qt,"getWidgetSettings",null),Qt=ii([(0,c.Uw)({name:"widget",defaults:QS}),Je("design:paramtypes",[Ci,Lt])],Qt);var D,n,f=S(2573),Ho=function(n){return n[n.Basics=0]="Basics",n[n.All=1]="All",n[n.Shortcuts=2]="Shortcuts",n}(Ho||{});(n=D||(D={})).SetAutoplay=(()=>{class j{constructor(me){this.autoplay=me}}return j.type="[View] Set Autoplay",j})(),n.SetContentMode=(()=>{class j{constructor(me){this.column=me}}return j.type="[View] Set Content Mode",j})(),n.SetCanHover=(()=>{class j{constructor(me){this.canHover=me}}return j.type="[View] Set Can Hover",j})(),n.SetCanTouch=(()=>{class j{constructor(me){this.canTouch=me}}return j.type="[View] Set Can Touch",j})(),n.SetCanFullscreen=(()=>{class j{constructor(me){this.canFullscreen=me}}return j.type="[View] Set Can Fullscreen",j})(),n.SetInputEnabled=(()=>{class j{constructor(me){this.enabled=me}}return j.type="[View] Set Input Enabled",j})(),n.SetSearchDisplayMode=(()=>{class j{constructor(me){this.mode=me}}return j.type="[View] Set Search Display Mode",j})(),n.TogglePresentation=(()=>{class j{constructor(me){this.active=me}}return j.type="[View] Toggle Presentation",j})(),n.SetInteractType=(()=>{class j{constructor(me){this.interactType=me}}return j.type="[View] Set Interact Type",j})(),n.SetForceAudio=(()=>{class j{constructor(me){this.forceAudio=me}}return j.type="[View] Set Force Audio",j})(),n.SetOnDemand=(()=>{class j{constructor(me){this.onDemand=me}}return j.type="[View] Set On Demand",j})(),n.SetLayout=(()=>{class j{constructor(me){this.layout=me}}return j.type="[View] Set Layout",j})(),n.ToggleHelpTab=(()=>{class j{constructor(me=Ho.Basics){this.tab=me}}return j.type="[View] Toggle Help Tab",j})(),n.SetInputMode=(()=>{class j{constructor(me){this.inputMode=me}}return j.type="[View] Set Input Mode",j})(),n.SetTutorial=(()=>{class j{constructor(me){this.tutorial=me}}return j.type="[View] Set Tutorial",j})(),n.SetIsMobileWeb=(()=>{class j{constructor(me){this.isMobileWeb=me}}return j.type="[View] Set Is Mobile Web",j})(),n.StartTutorial=(()=>{class j{constructor(me){this.intro=me}}return j.type="[View] Start Tutorial",j})(),n.TutorialSeen=(()=>{class j{constructor(me){this.seen=me}}return j.type="[View] Tutorial Seen",j})(),n.TutorialNext=(()=>{class j{constructor(){}}return j.type="[View] Tutorial Next",j})(),n.TutorialPrevious=(()=>{class j{constructor(){}}return j.type="[View] Tutorial Previous",j})(),n.ToggleNodeInfo=(()=>{class j{constructor(me){this.show=me}}return j.type="[View] Toggle Node Info",j})(),n.SetViewLanguage=(()=>{class j{constructor(me){this.lang=me}}return j.type="[View] Set View Language",j})(),n.SetNodeInfoConfig=(()=>{class j{constructor(me){this.fallback=me}}return j.type="[View] Set Node Info Config",j})(),n.SetMultiPickModeEnabled=(()=>{class j{constructor(me){this.enabled=me}}return j.type="[View] Set multi pick mode enabled",j})(),n.SetLabelBreakpoint=(()=>{class j{constructor(me){this.labelsBreakpoint=me}}return j.type="[View] Set Label Breakpoint",j})(),n.SetPlaythrough=(()=>{class j{constructor(me){this.playthrough=me}}return j.type="[View] Set Playthrough",j})(),n.SetPlaythroughEnabled=(()=>{class j{constructor(me){this.enabled=me}}return j.type="[View] Set Playthrough Enabled",j})(),n.SetStartingColumn=(()=>{class j{constructor(me){this.column=me}}return j.type="[View] Set Starting Column",j})(),n.SetPreferredColumn=(()=>{class j{constructor(me){this.column=me}}return j.type="[View] Set Preferred Column",j})(),n.SetStartingTool=(()=>{class j{constructor(me){this.tool=me}}return j.type="[View] Set Starting Tool",j})(),n.SetFadeout=(()=>{class j{constructor(me){this.fadeout=me}}return j.type="[View] Set Fadeout",j})(),n.PauseFadeout=(()=>{class j{constructor(me=!0){this.pause=me}}return j.type="[View] Pause Fadeout",j})(),n.SetUsePrintImage=(()=>{class j{constructor(me){this.usePrintImage=me}}return j.type="[View] Set Use Print Image",j})(),n.SetWindows=(()=>{class j{constructor(me){this.windows=me}}return j.type="[View] Set Windows",j})(),n.OpenWindow=(()=>{class j{constructor(me){this.window=me}}return j.type="[View] Open Window",j})(),n.CloseWindow=(()=>{class j{constructor(me){this.window=me}}return j.type="[View] Close Window",j})(),n.ToggleWindow=(()=>{class j{constructor(me,FS){this.window=me,this.show=FS}}return j.type="[View] Toggle Window",j})(),n.ToggleMenu=(()=>{class j{constructor(me){this.open=me}}return j.type="[View] Toggle Menu",j})(),n.SetWhiteboardEnabled=(()=>{class j{constructor(me){this.enabled=me}}return j.type="[View] Whiteboard Enabled",j})(),n.SetWhiteboardLocked=(()=>{class j{constructor(me){this.locked=me}}return j.type="[View] Whiteboard locked",j})(),n.SetWhiteboardBrushSize=(()=>{class j{constructor(me){this.brushSize=me}}return j.type="[View] Whiteboard Brush Size",j})(),n.SetWhiteboardBrushColor=(()=>{class j{constructor(me){this.brushColor=me}}return j.type="[View] Whiteboard Brush Color",j})(),n.SetWhiteboardTextSize=(()=>{class j{constructor(me){this.size=me}}return j.type="[View] Whiteboard Text Size",j})(),n.SetWhiteboardEraserSize=(()=>{class j{constructor(me){this.eraserSize=me}}return j.type="[View] Whiteboard Eraser Size",j})(),n.SetWhiteboardAnnotateMode=(()=>{class j{constructor(me){this.mode=me}}return j.type="[View] Whiteboard Annotate Mode",j})(),n.SetWhiteboardHasPaint=(()=>{class j{constructor(me){this.hasPaint=me}}return j.type="[View] Whiteboard Has Paint",j})(),n.SetWhiteboardHasText=(()=>{class j{constructor(me){this.hasText=me}}return j.type="[View] Whiteboard Has Text",j})(),n.ShowScrim=(()=>{class j{constructor(me,FS){this.showSpinner=me,this.label=FS}}return j.type="[View] Show Scrim",j})(),n.HideScrim=(()=>{class j{constructor(){}}return j.type="[View] Hide Scrim",j})(),n.SetChapterCallToActionSeen=(()=>{class j{constructor(me){this.chapterCallToActionSeen=me}}return j.type="[View] Set Chapter Call To Action Seen",j})(),n.ResetViewState=(()=>{class j{constructor(){}}return j.type="[View] Reset View State",j})();var WO=S(7145);function Vu(n,e=!1){return(e?function YS(n){return n.filter(e=>Object.values(e).some(o=>!(0,m.isNil)(o.value)&&""!==o.value))}(n):n).reduce((i,s)=>({...i,...s}),{})}class XO{}var F=S(6110),qS=S(6938);class HO{}class gr{constructor(){this.type=yt.Bookmark,this.favorite=!1,this.unavailable=!1}}!function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,qS.Z)(()=>HO),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],gr.prototype,"group_access",void 0);var ji=function(n){return n.All="",n.Quiz="mode-quiz",n.Content="mode-content",n}(ji||{});function ga(n){const{id:e,type:o}=n;if("module"===o&&(n.id=function qO(n){return n.replace("Condition.content.","").replace(".json","").split(".").join("/")}(e)),n.tour=n.tags.includes("tour"),n.animated=n.tags.includes("animated"),n.quiz=n.tags.includes("quiz"),n.lowDefinition=n.tags.includes("low definition"),!n.viewMode){const i=Object.values(ji).find(s=>n.tags.includes(s));n.viewMode=i??ji.All}return n}var ju=function(n){return n.IdAsc="+collection_id",n.IdDesc="-collection_id",n.NameAsc="+collection_name",n.NameDesc="-collection_name",n.UpdateDateAsc="+collection_updatedate",n.UpdateDateDesc="-collection_updatedate",n.CreateDateAsc="+collection_createdate",n.CreateDateDesc="-collection_createdate",n.CustomAsc="+custom_sort_order",n.CustomDesc="-custom_sort_order",n}(ju||{});function xu(n){return"?"+Object.entries(n).filter(([e,o])=>!(0,m.isNil)(o)).map(([e,o])=>`${e}=${encodeURIComponent(o)}`).join("&")}var Z_=S(6860),ed=function(n){return n.Web="web",n.Android="mobile_android",n.iOS="mobile_ios",n}(ed||{});let Si=(()=>{var n;class e{constructor(i){this.platform=i}get productKey(){return he.productKey}get productType(){if(he.native){if(this.platform.ANDROID)return ed.Android;if(this.platform.IOS)return ed.iOS}return ed.Web}get productHeader(){return{"Bd-Product-Ua":`BD/Product/${this.productType}/${this.productKey}`}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Z_.OD))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const ha="/ws/organization/collection",Gu="/ws/organization/join/domains";let Qo=(()=>{var n;class e{constructor(i,s){this.http=i,this.productService=s}createOrganization(i){return this.http.post("/ws/organization/create",i)}updateOrganization(i){return this.http.post("/ws/organization/update",i)}deleteOrganization(i){return this.http.request("delete","/ws/organization/delete",{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i}})}getCollections(i){i.sort_order||(i.sort_order=[ju.CustomAsc,ju.NameDesc]);const s=xu(i);return this.http.get(`${ha}${s}`).pipe((0,F.T)(r=>(0,je.bj)(XO,r).map(a=>this.normalizeCollectionModel(a))))}getCollectionContent(i,s,r="",a="en"){const l=r.toLocaleLowerCase().split(" ");return this.getCollections({group_id:i,collection_id:s,include_content:1,ol:a}).pipe((0,F.T)(_=>_[0].collection_content.map(p=>(0,je.bj)(gr,p)).filter(p=>{let u=!0;return l.length&&p.title&&l.forEach(g=>{u=u&&p.title.toLocaleLowerCase().indexOf(g)>=0}),u=u&&!0!==p.unavailable,u})))}addCollection(i,s){return this.http.post(ha,{group_id:i,collection_name:s})}removeCollection(i){return this.http.request("DELETE",ha,{body:{group_id:i.group_id,collection_id:i.collection_id}})}renameCollection(i,s){return this.http.post(ha,{group_id:i.group_id,collection_id:i.collection_id,collection_name:s})}reorderCollections(i,s){return this.http.post(`${ha}/sort-order`,{group_id:i,collection_id_sort_list:s.map(r=>r.collection_id)})}updateCollectionContent(i,s,r){return this.http.post(`${ha}/content`,{group_id:i,add_content:s,remove_content:r})}getOrganizationAttribute(i,s,r){return i.find(a=>a.type===s&&a.name===r)}getPublicProfile(i){return this.http.get("/ws/organization/public/profile",{params:{...i}}).pipe((0,F.T)(s=>s))}normalizeCollectionModel(i){return i.collection_content&&i.collection_content.forEach(s=>{ga(s)}),i}isNewJoinDomain(i){return(0,m.isNil)(i.join_domain_id)}checkJoinDomains(i){return this.http.post("/ws/organization/join/domain/check",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:i}).pipe((0,F.T)(r=>{const a=r.email_domains_checked;return i.map(l=>a[l].is_blacklisted)}))}getJoinDomains(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new $e.Nl({fromObject:{...s}});return this.http.get(Gu,{params:r})}postJoinDomains(i){return this.http.post(Gu,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:i})}deleteJoinDomains(i){return this.http.request("delete",Gu,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_domain_ids:i}})}generateGroupCode(i){return this.http.post("/ws/organization/generate/groupcode",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Si))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Qn=(()=>{var n;class e{constructor(i,s,r,a){this.config=i,this.router=s,this.route=r,this.organizationsService=a,this.appended=!1,this.initialized=!1,this.sessionEvents={},this.pageEvents={},this.queuedEvents=[],this.initRouteListener()}appendScripts(){!this.config.enabled||this.appended||(this.appendPendo(),this.appendHubspot(),this.appended=!0)}initialize(i,s){this.config.enabled&&(pendo.initialize({visitor:i,account:s}),this.flushQueuedEvents(),this.initialized=!0)}identify(i,s){this.config.enabled&&(pendo.identify({visitor:i,account:s}),this.hubspotIdentify({...i,account:s}))}createVisitorData(i){const s={},r=Vu(i.account_settings),a=(0,m.get)(i,"organizations[0].user_role.role_display_name",null);if((0,m.has)(i,"id")&&(s.id=this.getPrefixedId(i.id.toString())),(0,m.has)(i,"email")&&(s.email=i.email),(0,m.has)(i,"first_name")&&(0,m.has)(i,"last_name")&&(s.full_name=`${i.first_name} ${i.last_name}`),(0,m.has)(i,"registration_date")&&(s.registration_date=i.registration_date),(0,m.has)(i,"premium_account")&&(s.premium=i.premium_account),(0,m.has)(i,"user_is_developer")&&(s.developer=i.user_is_developer),(0,m.has)(i,"subscription")&&(s.subscriptionType=i.subscription?i.subscription.subscription_type:null),(0,m.has)(i,"is_third_party")&&(s.thirdParty=i.is_third_party),(0,m.has)(r,"account_purpose")&&(s.purpose=r.account_purpose?r.account_purpose.value:null),(0,m.has)(r,"account_role")&&(s.role=r.account_role?r.account_role.value:null),(0,m.has)(r,"account_field")&&(s.field=r.account_field?r.account_field.value:null),(0,m.has)(r,"email_marketing_optin")){const l=(0,m.get)(r,"email_marketing_optin.value",!1);s.emailMarketing=!!l}return a&&(s.teamRole=a),s}createAccountData(i){const s=(0,m.get)(i,"group_attributes",null);return{id:this.getPrefixedId((0,m.get)(i,"id",null)),name:(0,m.get)(i,"name",null),subscriptionType:(0,m.get)(i,"subscription.type",null),subscriptionEndDate:(0,m.get)(i,"subscription.paid_through_date",null),usersCount:(0,m.get)(i,"users_count",null),purpose:this.getGroupAttributeValue(s,"account_purpose"),field:this.getGroupAttributeValue(s,"account_field"),companyWebsite:this.getGroupAttributeValue(s,"account_company_website"),companySize:this.getGroupAttributeValue(s,"account_company_size"),externalAccountProvider:(0,m.get)(i,"external_account.external_account_provider",null)}}updateVisitorData(i){if(!this.config.enabled)return;const s=this.createVisitorData(i);pendo.updateOptions({visitor:s}),this.hubspotIdentify(s,!0)}updateAccountData(i){if(!this.config.enabled)return;const s=this.createAccountData(i);pendo.updateOptions({account:s})}flushQueuedEvents(){this.queuedEvents.forEach(i=>{this.track(i.trackType,i.metadata)})}track(i,s){this.config.enabled&&(this.initialized?pendo.track(i,s):this.queuedEvents.push({trackType:i,metadata:s}))}trackOncePerSession(i,s){this.sessionEvents[i]||this.config.enabled&&(this.track(i,s),this.sessionEvents[i]=!0)}trackOncePerPage(i,s){this.pageEvents[i]||this.config.enabled&&(this.track(i,s),this.pageEvents[i]=!0)}trackSignIn(i){this.trackSignInSignUp("Sign In - Success",i)}trackSignUp(i){this.trackSignInSignUp("Sign Up - Success",i)}trackSignInSignUp(i,s){const r=this.route.snapshot.queryParams;this.track(i,{type:s,referrer:document.referrer,refParam:r.ref||null,groupInvite:(0,m.has)(r,"group_invite"),groupCode:(0,m.has)(r,"group")&&(0,m.has)(r,"code")})}initRouteListener(){this.router.events.pipe((0,X.p)(i=>i instanceof ut.wF),(0,WO.i)(1)).subscribe(i=>{this.pageEvents={},this.hubspotTrackPageView(i.urlAfterRedirects)})}getPrefixedId(i){return i&&`${(0,m.get)(this.config,`idPrefixes[${he.deploy}]`,"")}${i}`}getGroupAttributeValue(i,s){if(!i)return null;const r=this.organizationsService.getOrganizationAttribute(i,"account_settings",s);return r?r.value:null}appendPendo(){const i=`\n      (function(apiKey){\n        (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];\n        v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){\n            o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);\n            y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';\n            z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');\n      })('${this.config.pendoId}');\n    `,s=document.createElement("script");s.textContent=i,document.body.appendChild(s)}appendHubspot(){_hsq=window._hsq=window._hsq||[];const i=`${location.pathname}${location.search}${location.hash}`;_hsq.push(["setPath",i]);const s=document.createElement("script");s.async=!0,s.defer=!0,s.src=`//js.hs-scripts.com/${this.config.hubspotId}.js`,document.body.appendChild(s)}hubspotIdentify(i,s=!1){window._hsq?.push(["identify",i]);const r=s?"Visitor Updated":"Visitor Identified";window._hsq?.push(["trackCustomBehavioralEvent",{name:r}])}hubspotTrackPageView(i){window._hsq?.push(["setPath",i]),window._hsq?.push(["trackPageView"])}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO("vendorAnalyticsConfig"),t.KVO(ut.Ix),t.KVO(ut.nX),t.KVO(Qo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();S(6579),S(5067);const KS={ja:"ja-JP","pt-PT":"pt-BR"},Zi={title:"English",lang:"en",country:"us",id:"en-US",direction:"ltr",applications:[bt.All]},Cl=[Zi,{title:"Espa\xf1ol",lang:"es",country:"es",id:"es-ES",direction:"ltr",applications:[bt.All]},{title:"\u4e2d\u6587(\u7b80\u4f53)",lang:"zh",country:"cn",id:"zh-CN",direction:"ltr",applications:[bt.All]},{title:"Fran\xe7ais",lang:"fr",country:"fr",id:"fr-FR",direction:"ltr",applications:[bt.All]},{title:"Deutsch",lang:"de",country:"de",id:"de-DE",direction:"ltr",applications:[bt.All]},{title:"Italiano",lang:"it",country:"it",id:"it-IT",direction:"ltr",applications:[bt.All]},{title:"\u65e5\u672c\u8a9e",lang:"ja",country:"ja",id:"ja",direction:"ltr",applications:[bt.All]},{title:"Portugu\xeas",lang:"pt",country:"pt",id:"pt-PT",direction:"ltr",applications:[bt.All]},{title:"\u05e2\u05b4\u05d1\u05e8\u05b4\u05d9\u05ea",lang:"he",country:"il",id:"he-IL",direction:"rtl",applications:[bt.Viewer]}].filter(n=>n.applications.includes(bt.All)||n.applications.includes(he.application));function Ol(n){return Cl.find(e=>e.id===n)}function JS(n){return Cl.find(e=>e.lang===n)}function ZS(){return JS(new URLSearchParams(window.location.search).get("lang"))??Zi}function eb(){return(he.application===bt.Viewer?ZS():function KO(){let n="";try{n=localStorage.getItem("locale")}catch{}return Ol(n)||Zi}()).id}let td=(()=>{class e{constructor(i,s,r=Zi.lang,a=!1){this.id=i,this.type=s,this.lang=r,this.preview=a}}return e.type="[Story] Load Current Story",e})(),tb=(()=>{class e{constructor(i){this.story=i}}return e.type="[Story] Replace the Story",e})(),nb=(()=>{class e{constructor(i){this.id=i}}return e.type="[Story] Set the Story ID",e})(),ib=(()=>{class e{constructor(i){this.displayName=i}}return e.type="[Story] Set Story Text",e})(),ob=(()=>{class e{constructor(i){this.tags=i}}return e.type="[Story] Set Story Tags",e})(),sb=(()=>{class e{constructor(i){this.playthroughSettings=i}}return e.type="[Story] Set Story Playthrough",e})(),rb=(()=>{class e{constructor(i){this.sourceInfo=i}}return e.type="[Story] Set Story Source Info",e})(),ab=(()=>{class e{constructor(i){this.lightLibs=i}}return e.type="[Story] Set Story Light Libs",e})(),JO=(()=>{class e{}return e.type="[Story] Load Manifests",e})(),nd=(()=>{class e{constructor(i,s,r){this.id=i,this.type=s,this.reset=r}}return e.type="[Story] Set Incoming Story Id",e})(),$u=(()=>{class e{constructor(){}}return e.type="[Story] Load Story Chunk",e})(),Fu=(()=>{class e{constructor(i){this.chapterId=i}}return e.type="[Story] Reorder Load Chunks",e})(),ma=(()=>{class e{constructor(i){this.chapter=i}}return e.type="[Story] Load Story Chunk Success",e})(),Bu=(()=>{class e{constructor(i,s,r,a,l=!0){this.id=i,this.story=s,this.type=r,this.chapterIdx=a,this.replaceActiveStory=l}}return e.type="[Story] Build Story In Engine From Story Model",e})(),lb=(()=>{class e{constructor(i,s,r){this.story=i,this.id=s,this.type=r}}return e.type="[Story] Build Story Success",e})(),id=(()=>{class e{constructor(i,s,r,a){this.story=i,this.id=s,this.type=r,this.lang=a}}return e.type="[Story] Load Success",e})(),cb=(()=>{class e{constructor(i,s){this.id=i,this.type=s}}return e.type="[Story] Load Fail",e})(),_b=(()=>{class e{constructor(i,s,r=Zi.lang){this.id=i,this.type=s,this.lang=r}}return e.type="[Story] Import",e})(),zu=(()=>{class e{constructor(i,s,r){this.story=i,this.id=s,this.type=r}}return e.type="[Story] Import Success",e})(),db=(()=>{class e{constructor(){}}return e.type="[Story] Clear",e})(),ZO=(()=>{class e{constructor(){}}return e.type="[Story] Synchronize Chapters",e})(),pb=(()=>{class e{constructor(){}}return e.type="[Story] Human Ready (Web)",e})(),Wu=(()=>{class e{constructor(){}}return e.type="[Story] Human Ready (SDK)",e})(),ew=(()=>{class e{constructor(i){this.story=i}}return e.type="[Story] Merge Bridge Module Success",e})();class on{}let ub=(()=>{class e{constructor(){}}return e.type="[Engine] Load",e})(),Xu=(()=>{class e{constructor(i){this.result=i}}return e.type="[Engine] Load Success",e})(),Hu=(()=>{class e{constructor(i){this.ready=i}}return e.type="[Engine] Set Ready",e})(),od=(()=>{class e{constructor(i){this.display=i}}return e.type="[Engine] Set Display of 3D Scene",e})(),sd=(()=>{class e{constructor(i){this.scrollMode=i}}return e.type="[Engine] Set Zoom via scroll Allowed",e})(),gb=(()=>{class e{constructor(i){this.shown=i}}return e.type="[Engine] Set Scroll Alert Shwon",e})(),fa=(()=>{class e{constructor(i){this.visible=i}}return e.type="[Engine] Set Visibility of 3D Scene",e})(),hb=(()=>{class e{constructor(i,s){this.color=i,this.duration=s}}return e.type="[Engine] Fade",e})(),tw=(()=>{class e{constructor(){}}return e.type="[Engine] Fade Complete",e})(),ys=(()=>{class e{constructor(i){this.graph=i}}return e.type="[Engine] Set Graph",e})(),nw=(()=>{class e{constructor(){}}return e.type="[Engine] Clear Graph",e})(),rd=(()=>{class e{constructor(i){this.enabled=i}}return e.type="[Engine] Set Xray Mode",e})(),Qu=(()=>{class e{constructor(i){this.chapterId=i}}return e.type="[Engine] Set Engine Chapter",e})(),ad=(()=>{class e{constructor(i,s,r){this.node=i,this.event=s,this.hit=r}}return e.type="[Engine] Click Node",e})(),wl=(()=>{class e{constructor(i,s){this.node=i,this.hit=s}}return e.type="[Engine] Set Contextmenu",e})(),To=(()=>{class e{constructor(i,s=!0,r){this.objectId=i,this.animate=s,this.animationDuration=r}}return e.type="[Engine] Fly To Object",e})(),Yu=(()=>{class e{constructor(i,s){this.leafVisibilityState=i,this.nodes=s}}return e.type="[Engine] Synchronize Visible Nodes On Tree",e})(),qu=(()=>{class e{constructor(i){this.leafRenderableState=i}}return e.type="[Engine] Synchronize Renderable State of Nodes On Tree",e})(),Ku=(()=>{class e{constructor(i,s){this.leafPickableState=i,this.nodes=s}}return e.type="[Engine] Synchronize Pickable State of Nodes On Tree",e})(),Ju=(()=>{class e{constructor(i,s){this.leafAvailableState=i,this.nodes=s}}return e.type="[Engine] Synchronize Available State of Nodes On Tree",e})(),mb=(()=>{class e{constructor(i){this.show=i}}return e.type="[Engine] Toggle Camera Bar",e})(),Zu=(()=>{class e{constructor(i){this.show=i}}return e.type="[Engine] Toggle Progress Bar",e})(),Sa=(()=>{class e{constructor(i){this.show=i}}return e.type="[Engine] Toggle Labels",e})(),hr=(()=>{class e{constructor(i){this.tool=i}}return e.type="[Engine] Set active tool",e})(),ld=(()=>{class e{constructor(){}}return e.type="[Engine] Play chapter animation",e})(),Yo=(()=>{class e{constructor(i=!0){this.play=i}}return e.type="[Engine] Play animation",e})(),eg=(()=>{class e{constructor(i){this.playing=i}}return e.type="[Engine] Set animation playing",e})(),Ml=(()=>{class e{constructor(i){this.speed=i}}return e.type="[Engine] Set playback speed",e})(),fb=(()=>{class e{constructor(){}}return e.type="[Engine] Play chapter from start",e})(),tg=(()=>{class e{constructor(i){this.enable=i}}return e.type="[Engine] Set autoplay",e})(),ng=(()=>{class e{constructor(i,s){this.nodes=i,this.layer=s}}return e.type="[Engine] Set object layer order",e})(),ig=(()=>{class e{constructor(i,s){this.nodeId=i,this.displayName=s}}return e.type="[Engine] Set object display name",e})(),Sb=(()=>{class e{constructor(){}}return e.type="[Engine] Auto Sort object layer orders",e})(),bb=(()=>{class e{constructor(){}}return e.type="[Engine] Reset object layer orders",e})(),og=(()=>{class e{constructor(i){this.position=i}}return e.type="[Engine] Set Engine Position",e})(),sg=(()=>{class e{constructor(){}}return e.type="[Engine] Reset Engine Position",e})(),yb=(()=>{class e{constructor(i){this.effects=i}}return e.type="[Engine] Set Post Processing Effects",e})(),vb=(()=>{class e{constructor(i){this.properties=i}}return e.type="[Engine] Set Properties",e})(),Eb=(()=>{class e{constructor(i){this.mode=i}}return e.type="[Engine] Set Transparency Mode",e})(),ba=(()=>{class e{constructor(i){this.node=i}}return e.type="[Engine] Expand ViewTree Node",e})(),cd=(()=>{class e{constructor(i){this.node=i}}return e.type="[Engine] Collapse ViewTree Node",e})(),Tb=(()=>{class e{constructor(){}}return e.type="[Engine] Collapse All ViewTree Nodes",e})(),ya=(()=>{class e{constructor(i,s){this.node=i,this.hit=s}}return e.type="[Engine] Hover Node",e})(),_d=(()=>{class e{constructor(i){this.node=i}}return e.type="[Engine] Set Label Edit Node",e})(),dd=(()=>{class e{constructor(i,s){this.node=i,this.info=s}}return e.type="[Engine] Set Node Info",e})(),rg=(()=>{class e{constructor(i,s,r){this.node=i,this.fallback=s,this.lang=r}}return e.type="[Engine] Query Node Info",e})(),ag=(()=>{class e{constructor(i,s){this.node=i,this.info=s}}return e.type="[Engine] Query Node Info Success",e})(),iw=(()=>{class e{constructor(i){this.node=i}}return e.type="[Engine Nodes] Query Node Info Failure",e})(),lg=(()=>{class e{constructor(i){this.enabled=i}}return e.type="[Engine] Set Watermark Enabled",e})(),cg=(()=>{class e{constructor(i){this.context=i}}return e.type="[Engine] Set Engine WebGL Context",e})(),_g=(()=>{class e{constructor(i,s){this.enabled=i,this.showAdvancedTools=s}}return e.type="[Engine] Set Engine Stats Enabled",e})(),dg=(()=>{class e{constructor(i){this.pickState=i}}return e.type="[Engine] Set Pick State",e})();class sw{}function ud(n=[]){return{available:()=>!0,shown:()=>!1,selected:()=>!1,pickable:()=>!0,renderable:()=>!1,expanded:()=>!1,...n.reduce((e,o)=>(e[o]=()=>!1,e),{})}}function Cb(n,e){n.nodes[e.id]||(n.nodes[e.id]=e)}function xi(n,e){return n.nodes[e]??null}function va(n,e){return n.predecessors[e]??null}function Co(n,e){return[...n.successors[e]||[]]}function gd(n,e,o){const i={},s=xi(n,e);return Object.entries(s.boolState).forEach(([r,a])=>{o&&o.includes(r)&&(i[r]=a)}),Object.entries(s.numState).forEach(([r,a])=>{o&&o.includes(r)&&(i[r]=a)}),i}function Il(n,e){return!!n.nodes[e]&&void 0===n.successors[e]}function pg(n){return Object.keys(n.roots)}function Ob(n,e,o,i,s){const r=function ow(n){return{id:n,depth:0,boolState:{},numState:{}}}(o.objectId);r.depth=s,function _w(n,e,o){Object.entries(o).forEach(([i,s])=>{const r=s(e.objectId);"boolean"==typeof r?n.boolState[i]=r:"number"==typeof r?n.numState[i]=r:n[i]=r})}(r,o,i),n.nodes[r.id]=r,e?(n.successors[e]=[...n.successors[e]||[],r.id],n.predecessors[r.id]=e):n.roots[r.id]=r,s+=1,o.children.forEach(l=>{Ob(n,r.id,l,i,s)})}function hd(n,e,o){o?(e(o),Co(n,o).forEach(i=>{(0,m.isNil)(i)||hd(n,e,i)})):pg(n).forEach(i=>{e(i),hd(n,e,i)})}function ug(n,e){const i={nodes:{},successors:{},predecessors:{},roots:{}};return n.forEach(s=>{Ob(i,null,s,e,0)}),i}function gg(n,e,o){const i=[];for(const s of n){const r=e[s.objectId],a=void 0===r?o:r,l=gg(s.children||[],e,a);if(a){const _={...s};_.children=l,i.push(_)}else l.forEach(_=>i.push(_))}return i}function wb(n,e,o,i){const s=e?.[n];if("boolean"==typeof s)return s;{const r=o(n);return r?.length>0?wb(r,e,o,i):i}}function Mb(n,e,o,i){const s=o(n);return 0===s.length?i:s.some(a=>!0===e?.[a])||s.some(a=>Mb(a,e,o,i))}function Ib(n,e,o,i){const s=Mb(n,e,i,void 0);return!(!1===wb(n,e,o,void 0)&&(!1===s||void 0===s))}function Ab(n,e,o){return n.reduce((i,s)=>(i[s]=i[s]??!1,i),{...e,...o})}function Pb(n,e=!0){const{roots:o,successors:i,predecessors:s,nodes:r}=n,a={nodes:{},roots:{},successors:{},predecessors:{}};for(const l in r){const _=r[l];if(_.boolState.available===e){a.nodes[l]=_;const p=s[l];p&&(a.predecessors[l]=p);const u=i[l];u&&(a.successors[l]=u);const g=o[l];g&&(a.roots[l]=g)}}return a}function Nb(n){const e={};for(const o in n){const i=n[o];i.available&&(e[o]=i)}return e}var Ai=function(n){return n.MajorityWins="majorityWins",n.TrueWins="trueWins",n.FalseWins="falseWins",n}(Ai||{});const dw={trueWins:n=>({result:n.votesFor.length>0,dissenters:[...n.votesAgainst]}),falseWins:n=>({result:n.votesAgainst.length>0,dissenters:[...n.votesFor]}),majorityWins:n=>{const e=n.votesFor.length>n.votesAgainst.length;return{result:e,dissenters:e?[...n.votesAgainst]:[...n.votesFor]}}};function Al(n,e){return n.reduce((o,i)=>(o[i]=e[i]||!1,o),{})}function hg(n,e,o){return function lw(n,e){const o=new Set;return e.forEach(i=>{const s=va(n,i);s&&o.add(s)}),Array.from(o)}(n,e).filter(s=>s&&xi(n,s).depth===o)}function Rb(n,e,o){return Object.keys(e).reduce((s,r)=>{const a=e[r],l=o[r]||Ai.MajorityWins,{result:_,dissenters:d}=dw[l](a);return s[r]={id:n,result:_,dissenters:d,voters:[...a.votesFor,...a.votesAgainst]},s},{})}class fw{}let lo=(()=>{var n;class e{serializeNode(i,s,r={},a=(l=>!0)){const l={};return l.id=s.id,Object.entries(s.boolState).forEach(([_,d])=>{r.hasOwnProperty(_)&&(l[_]=d)}),Object.entries(s.numState).forEach(([_,d])=>{r.hasOwnProperty(_)&&(l[_]=d)}),i.successors[s.id]&&(l.children=[],i.successors[s.id].forEach(_=>{a(_)&&l.children.push(this.serializeNode(i,i.nodes[_],r,a))},this)),l}getAllSiblingsFromList(i,s,r){const a=[];let l;for(l=0;l<s.length;l++)this.getSiblings(i,s[l],r).forEach(_=>{a.includes(_)||a.push(_)});return a}getElectionResults(i,s,r,a){class l extends fw{constructor(y,C){super(),Object.entries(y).forEach(([O,L])=>{this[O]={votesFor:[],votesAgainst:[]},Object.entries(C).forEach(([$,q])=>{q[O]?this[O].votesFor.push($):this[O].votesAgainst.push($)},this)},this)}}let _,d;const p=Object.keys(a),u=[];return r.forEach(g=>{d={},Co(i,g).forEach(O=>{d[O]=s[O]||Al(p,gd(i,O,p)),delete s[O]},this),_=new l(a,d);const y=Rb(g,_,a);u.push(y);const C={};Object.entries(y).forEach(([O,L])=>{C[O]=L.result}),s[g]=C},this),u}updateGraphStateRecord(i,s,r,a,l=!0){r.forEach(_=>{const d=_[a[0]].id,p=gd(i,d,a),u={};let g=!1;a.forEach(y=>{(l||_[y].result!==p[y])&&(u[y]=_[y].result,g=!0)}),g&&(s[d]=u)},this)}nodeExists(i,s){return!!i.nodes[s]}getLeaves(i){const s=[];return Object.entries(i.nodes).forEach(([r,a])=>{i.successors[r]||s.push(r)}),s}getDescendants(i,s,r=!1){const a=[];return function _(d){Co(i,d).forEach(p=>{a.push(p),_(p)})}(s),r&&a.push(s),a}getLeafDescendants(i,s,r=!1){const a=this.getDescendants(i,s,r).filter(l=>Il(i,l));return(Il(i,s)||r)&&a.push(s),a}getAllLeafDescendants(i,s){const r=[];s.forEach(l=>{Il(i,l)?r.push(l):r.push(...this.getLeafDescendants(i,l,!1))});const a=new Set(r.sort());return Array.from(a)}getInverseSelection(i,s){const r=this.getAllLeafDescendants(i,s);return this.getLeaves(i).filter(a=>r.indexOf(a)<0)}getSiblings(i,s,r=!1){const a=i.predecessors[s];let l=[];if(l=a?Co(i,a):pg(i),!r){const _=l.indexOf(s);_>=0&&l.splice(_,1)}return l}getNodes(i,s){const r=[];return s.forEach(a=>{i.nodes[a]&&r.push(i.nodes[a])}),r}setState(i,s,r){const a=xi(i,s),l={};return Object.entries(r).forEach(([_,d])=>{"boolean"==typeof d&&a.boolState[_]!==d?(a.boolState[_]=d,l[_]=d):"number"==typeof d&&a.numState[_]!==d&&(a.numState[_]=d,l[_]=d)}),l}synchronize(i,s,r){const a=this.calculateGraphStateMap(i,s,r);return Object.entries(a).forEach(([l,_])=>{this.setState(i,l,_)},this),a}calculateGraphStateMap(i,s,r,a=!r){let l=[];const _={};let d=[];const p={},u=Object.keys(s);let g=0;for(r?Object.entries(r).forEach(([y,C])=>{_[y]=Al(u,r[y]),p[y]={..._[y]},g=Math.max(g,xi(i,y).depth)},this):this.getLeaves(i).forEach(y=>{_[y]=Al(u,xi(i,y).boolState),p[y]={..._[y]},g=Math.max(g,xi(i,y).depth)},this),g-=1,l=hg(i,Object.keys(_),g);g>=0;)d=this.getElectionResults(i,_,l,s),this.updateGraphStateRecord(i,p,d,u,a),g-=1,l=hg(i,Object.keys(_),g);return p}filterGraphAccessors(i,s){const a=this.getNodes(i,s).sort((d,p)=>d.depth-p.depth),l=new Map;return a.filter(d=>!l.has(d.id)&&(this.getDescendants(i,d.id,!0).forEach(p=>l.set(p,!0)),!0)).map(d=>d.id)}resetDepth(i){hd(i,r=>{let a=0;i.predecessors[r]&&(a=xi(i,i.predecessors[r]).depth+1),xi(i,r).depth=a})}deleteNode(i,s,r=!0){if(!this.nodeExists(i,s))return;delete i.nodes[s];const a=i.predecessors[s];a&&(delete i.predecessors[s],i.successors[a]&&(i.successors[a]=i.successors[a].filter(_=>_!==s)));const l=i.successors[s];l&&(delete i.successors[s],r&&l.forEach(_=>{this.deleteNode(i,_)},this)),i.roots[s]&&delete i.roots[s]}sanitizeNodeID(i){const s=new RegExp(/\|:/,"gi");return i.replace(s,"_")}resetAsLeaf(i,s){let r=[];return i.nodes[s]&&!Il(i,s)&&(r=this.getDescendants(i,s),delete i.successors[s],r.forEach(a=>{delete i.nodes[a],delete i.successors[a],delete i.predecessors[a]})),r}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class mg{constructor(e,o,i,s,r,a,l,_){this.viewportWidth=e,this.viewportHeight=o,this.left=i,this.top=s,this.width=r,this.height=a,this.visibility=l,this.scale=_}}var Pl=function(n){return n[n.Hidden=-1]="Hidden",n[n.Shown=1]="Shown",n}(Pl||{});class Nl{}let kb=(()=>{class e{constructor(i){this.id=i}}return e.type="[Engine Camera] Clear Camera",e})(),Db=(()=>{class e{constructor(i,s){this.id=i,this.camera=s}}return e.type="[Engine Camera] Store Camera",e})(),di=(()=>{class e{constructor(i,s=!0,r,a){this.camera=i,this.animate=s,this.animationDuration=r,this.rotationCenter=a}}return e.type="[Engine Camera] Set Camera",e})(),fg=(()=>{class e{constructor(){}}return e.type="[Engine Camera] Set Camera Success",e})(),md=(()=>{class e{constructor(i){this.enabled=i}}return e.type="[Engine Camera] Set Chapter Camera Enabled",e})(),Ea=(()=>{class e{constructor(i){this.cameraMotion=i}}return e.type="[Engine Camera] Move Camera",e})(),Rl=(()=>{class e{constructor(){}}return e.type="[Engine Camera] Reset Camera",e})(),Lb=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Zoom Camera",e})(),Sg=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Zoom Camera Static",e})(),Ub=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Pan Camera X",e})(),Vb=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Pan Camera Y",e})(),jb=(()=>{class e{constructor(i,s,r){this.x=i,this.y=s,this.z=r}}return e.type="[Engine Camera] Pan Camera Static",e})(),xb=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Rotate Camera X",e})(),Gb=(()=>{class e{constructor(i){this.value=i}}return e.type="[Engine Camera] Rotate Camera Y",e})(),$b=(()=>{class e{constructor(i,s){this.x=i,this.y=s}}return e.type="[Engine Camera] Rotate Camera Static",e})(),fd=(()=>{class e{constructor(i){this.mode=i}}return e.type="[Engine Camera] Set Camera Mode",e})(),bg=(()=>{class e{constructor(i){this.zoomed=i}}return e.type="[Engine Camera] Set Zoomed",e})(),yg=(()=>{class e{constructor(i){this.lock=i}}return e.type="[Engine Camera] Lock camera",e})(),Sd=(()=>{class e{constructor(i){this.camera=i}}return e.type="[Engine Camera] Set Camera Fly To",e})(),bd=(()=>{class e{constructor(i){this.patches=i}}return e.type="[Engine Camera] Patch Camera State",e})();class Yt{static toArray(e){return[e.x,e.y,e.z]}static fromArray(e){return{x:e[0],y:e[1],z:e[2]}}}var Sw=S(6017),bw=S(5913);function vg(n){const{xmin:e,ymin:o,zmin:i,xmax:s,ymax:r,zmax:a}=n;return{min:[e,o,i],max:[s,r,a]}}function Fb(n){if((0,m.isNil)(n))return!1;{const e=Object.values(n);return 6===e.length&&e.every(o=>Number.isFinite(o))}}var Ee=S(8472);function Eg(n,e){const o=Ee.create();return Ee.add(o,e,n),Ee.scale(o,o,.5),o}function Tg(n,e,o,i,s,r){const a=(n-e)/(o-e);return(r=r??Ee.create())[0]=i[0]+a*(s[0]-i[0]),r[1]=i[1]+a*(s[1]-i[1]),r[2]=i[2]+a*(s[2]-i[2]),r}const Bb=1/ee.BIODIGITAL_SCENE_SCALE,zb=new ee.AABB,Ew={shown:Ai.TrueWins,renderable:Ai.FalseWins,pickable:Ai.TrueWins};let cn=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.graphService=s}getObjects(){const i={};return this.getAnatomySceneGraph()?.anatomyObjects.forEach((r,a)=>i[a]=r),i}getObjectById(i){return this.getAnatomySceneGraph()?.anatomyObjects?.get(i)}getObjectsById(i){const r=this.getAnatomySceneGraph()?.anatomyObjects;return i.reduce((a,l)=>{const _=r?.get(l);return _&&(a[_.objectId]=_),a},{})}isObjectLoaded(i){return!0===this.getObjectById(i)?.loaded}isObjectCulledByClip(i,s){if(0===s.length)return!1;const r=s.map(a=>a.plane);return i.renderables.some(a=>(0,ee.boxIntersectsPlaneBounds)(r,a.meshNode.worldBounds))}getRootObjects(){return this.getAnatomySceneGraph()?.anatomyRoots??[]}getSceneBoundary(){const{rootNode:i}=this.engineService.engine;return this.getSceneNodeBoundaryModel([i],zb)}getObjectBoundary(i){const s=i.map(r=>this.getObjectById(r).sceneNode);return this.getSceneNodeBoundaryModel(s,zb)}getObjectBoundaryCenter(i){const s=this.getObjectBoundary([i]),{min:r,max:a}=vg(s);return Eg(r,a)}setShownObjects(i){const{replace:s,showObjects:r}=i,a=this.getRootObjects();this.setObjectsShown(a,r,!s&&void 0)}getLeavesByObject(i){const s=i.children??[];return 0===s.length?[i]:s.map(r=>this.getLeavesByObject(r)).flat()}getLeaves(i){if(i){const s=this.getObjectById(i);return s?this.getLeavesByObject(s):[]}return this.getRootObjects().map(r=>this.getLeavesByObject(r)).flat()}getLeafIds(i){return this.getLeaves(i).map(s=>s.objectId)}getEnabledLeafIds(){return this.getLeaves().filter(i=>!0===i?.shown).map(i=>i.objectId)}isLeaf(i){return 0===i.children.length}transformObject(i,s){const r=this.getObjectById(i)?.sceneNode;r?(0,ee.applyTransform)(r,s):console.error(`Scene node not found: '${i}'`)}setNodesVisible(i,s=!1){const r={replace:s,showObjects:{...i}};this.setShownObjects(r)}setNodesProperty(i,s){Object.keys(i).forEach(r=>{const a=this.getObjectById(r);(this.isLeaf(a)?[r]:this.getLeafIds(r)).forEach(_=>{this.getObjectById(_)[s]=i[r]})})}setObjectLayer(i,s,r){i.get(s).layer=r}setObjectVariant(i,s,r){i.get(s).variant=r}getObjectLayerValues(i){const s={},r=this.getSceneBoundary();return i.forEach(a=>{const l=this.getObjectById(a),_=this.getObjectBoundary([a]),d=Math.min(_.xmin-r.xmin,r.xmax-_.xmax),p=2*Math.min(_.ymin-r.ymin,r.ymax-_.ymax),u=Math.min(_.zmin-r.zmin,r.zmax-_.zmax),g=l.layer;s[g]=s[g]??[],s[g].push({nodeId:a,value:Math.min(d,p,u)})}),s}getWorldPosition(i,s,r,a=0){const _=this.getObjectById(i)?.renderables[a]?.meshNode;if((0,m.isNil)(_))return;const d=_.worldMatrix,p=Ee.create(),u=ee.vec3Pool.get(),g=ee.vec3Pool.get(),y=ee.vec3Pool.get();return(0,ee.getTrianglePositions)(_,s,u,g,y),(0,ee.cartesianCoord)(p,r,u,g,y),Ee.transformMat4(p,p,d),Ee.scale(p,p,1/ee.BIODIGITAL_SCENE_SCALE),ee.vec3Pool.release(u),ee.vec3Pool.release(g),ee.vec3Pool.release(y),p}getSceneGraph(i){const{anatomyObjects:s}=this.getAnatomySceneGraph(),a=ug(i,{...ud(),shown:l=>!0===s.get(l)?.shown,pickable:l=>!0===s.get(l)?.pickable,label:l=>s.get(l)?.displayName??"",layer:l=>s.get(l)?.layer??0});return this.graphService.synchronize(a,Ew),a}createViewGraph({availableObjects:i,showObjects:s,includeRoot:r=!1}){const a=this.getRootObjects(),l=s?gg(a,s):a,_=l.reduce((p,u)=>{const g=!r&&u.objectId.includes("-root");return p[u.objectId]=!g,g&&u.children.forEach(y=>{p[y.objectId]=!0}),p},{}),d=this.getSceneGraph(gg(l,_));return this.graphService.resetDepth(d),(0,m.isEmpty)(i)||this.computeObjectAvailable(d,i),d}computeObjectAvailable(i,s){const{anatomyObjects:r}=this.getAnatomySceneGraph(),a=_=>r.get(_).parent?.objectId,l=_=>{const d=r.get(_);return d?d.children.map(p=>p.objectId):[]};Object.entries(i.nodes).forEach(([_,d])=>{d.boolState.available=Ib(_,s,a,l)})}getViewNode(i,s){return this.graphService.nodeExists(i,s)?xi(i,s):null}setObjectsShown(i,s,r){i.forEach(a=>{const _=s[a.objectId]??r;"boolean"==typeof _&&a.shown!==_&&(a.shown=_),this.setObjectsShown(a.children,s,r)})}getSceneNodeBoundaryModel(i,s){const{min:r,max:a}=this.getSceneNodeBounds(i,s);return Ee.scale(r,r,Bb),Ee.scale(a,a,Bb),{xmin:r[0],ymin:r[1],zmin:r[2],xmax:a[0],ymax:a[1],zmax:a[2]}}getSceneNodeBounds(i,s){return s.clear(),i.forEach(r=>{(0,ee.traverseSceneNodes)(r,a=>{a instanceof ee.MeshNode&&s.expand(a.worldBounds)})}),s}getChapterIndex(i){return this.engineService.engine.story?.chapters?.findIndex(a=>a.id===i)}getChapter(i){const s=this.engineService.engine?.story,r=s?.chapters,a=s?.activeChapterIndex;return r?.[i??a]}getAnatomySceneGraph(){return this.engineService.engine?.story?.anatomySceneGraph}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(lo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const Wb={backOff:0,stopFOV:55,dist:2.5};function Xb(n,e,o,i=Wb){const s={...Wb,...i},r=s.dist,a=s.stopFOV,l=1-(0,m.clamp)(s.backOff,0,1),_=function yw(n,e){const o=Ee.create();return Ee.sub(o,e,n),Ee.length(o)}(n,e);return Math.abs(_/(1+.8*l)/Math.tan(a/2))/o*r}function Hb(n,e,o){const i=Yt.toArray(n.look),s=Yt.toArray(n.eye),r=Ee.create();Ee.subtract(r,s,i);const a=Ee.create();Ee.normalize(a,r);const l=Math.abs(Ee.length(a)),{min:_,max:d}=vg(e),p=Xb(_,d,l,o),u=Eg(_,d);Ee.scale(r,a,p);const g=Ee.add(Ee.create(),u,r);return{eye:Yt.fromArray(g),look:Yt.fromArray(u),up:Yt.fromArray([0,1,0])}}class Qb{constructor(e,o){this.tempVec=Ee.create(),this.eyeVec=Ee.create(),this.lookVec=Ee.create(),this.cameraService=e;const{targetCamera:i,targetBoundary:s}=o,r=e.getCamera();if(this.initialLook=Yt.toArray(r.look),this.initialEye=Yt.toArray(r.eye),this.initialUp=Yt.toArray(r.up),s){Ee.subtract(this.tempVec,this.initialEye,this.initialLook);const d=Ee.create();Ee.normalize(d,this.tempVec);const p=Math.abs(Ee.length(d)),{min:u,max:g}=vg(s),y=Xb(u,g,p,o);Ee.scale(this.tempVec,d,y),this.targetLook=Eg(u,g),this.targetEye=Ee.add(Ee.create(),this.targetLook,this.tempVec),this.targetUp=Ee.fromValues(0,1,0)}i&&(this.targetLook=Yt.toArray(i.look),this.targetEye=Yt.toArray(i.eye),this.targetUp=Yt.toArray(i.up)),Ee.subtract(this.tempVec,this.targetLook,this.initialLook);const a=Math.abs(Ee.length(this.tempVec));Ee.subtract(this.tempVec,this.targetEye,this.initialEye);const l=Math.abs(Ee.length(this.tempVec));this.animationDuration=o.animationDuration?1e3*o.animationDuration:1e3*((a>l?a:l)/(200*(o.velocity||1))+1),this.onComplete=o.onComplete}update(e){if(void 0===this.startTime&&(this.startTime=e,this.endTime=this.startTime+this.animationDuration),this.animationDone||e>this.endTime)return this.animationDone||this.cameraService.setCamera({eye:Yt.fromArray(this.targetEye),look:Yt.fromArray(this.targetLook),up:Yt.fromArray(this.targetUp)}),this.animationDone=!0,void this.onComplete(this);const i=function vw(n,e,o){const i=n*n;return e+o*(-1*i*i+i*n*4+-6*i+4*n)}((e-this.startTime)/this.animationDuration,0,1);Tg(i,0,1,this.initialLook,this.targetLook,this.lookVec),Tg(i,0,1,this.initialEye,this.targetEye,this.eyeVec),Tg(i,0,1,this.initialUp,this.targetUp),this.cameraService.setCamera({eye:Yt.fromArray(this.eyeVec),look:Yt.fromArray(this.lookVec),up:Yt.fromArray(this.targetUp)})}stop(){}}let Cg=(()=>{var n;class e{constructor(){}roundModel(i,s){const r={...i};return Object.keys(i).filter(a=>"number"==typeof i[a]).forEach(a=>{r[a]=this.roundNumber(i[a],s)}),r}roundNumber(i,s){return Math.round(i*Math.pow(10,s))/Math.pow(10,s)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const Yb=180/Math.PI,yd=1/ee.BIODIGITAL_SCENE_SCALE,Ta=ee.BIODIGITAL_SCENE_SCALE;let Pi=(()=>{var n;class e{get cameraController(){const i=this.engineService.engine?.story?.cameraController;if(!i)throw new Error("Story not instantiated, cannot get camera controller");return i}constructor(i,s,r){this.engineService=i,this.numberService=s,this.sceneService=r,this.rotation={vx:0,vy:0},this.pan={x:0,y:0,z:0},this.zoom=0,this.animationCallbacks=[],this.initCameraEvents()}tickCamera(i){this.animation&&this.animation.update(performance.now())}getCamera(){const{up:i,target:s,position:r}=this.cameraController,a=ee.vec3Pool.get(),l=ee.vec3Pool.get();Ee.scale(a,r,yd),Ee.scale(l,s,yd);const _={eye:Yt.fromArray(a),look:Yt.fromArray(l),up:Yt.fromArray(i)};return ee.vec3Pool.release(a),ee.vec3Pool.release(l),_}setCamera(i,s=!1){const{cameraController:r}=this,{eye:a,look:l,up:_}=i;let d,p,u;a&&(d=ee.vec3Pool.get(),Ee.scale(d,Yt.toArray(a),Ta)),l&&(p=ee.vec3Pool.get(),Ee.scale(p,Yt.toArray(l),Ta)),_&&(u=Yt.toArray(_)),r.setCamera(d??r.position,p??r.target,u),d&&ee.vec3Pool.release(d),p&&ee.vec3Pool.release(p),l&&!s&&this.setCameraRotationCenter(l)}getLookDirection(){const{target:i,position:s}=this.cameraController,r=Ee.create();return Ee.sub(r,i,s),Ee.normalize(r,r),r}getLookDistance(){return this.cameraController.distance*yd}getCameraZoom(){return this.cameraController.zoom}captureCamera(){return{lookAt:this.getCamera(),zoom:this.getCameraZoom()}}getDirection(i){const{position:s}=this.cameraController,r=Ee.create();return Ee.sub(r,s,i.worldPos),Ee.normalize(r,r),[r[0],r[1],r[2]]}rotateCameraStatic(i,s){this.cameraController.orbit(i/Yb,s/Yb)}panCameraStatic(i,s,r){this.cameraController.pan(i*Ta,s*Ta,r*Ta)}setRelativeZoom(i){this.cameraController.dolly(i)}setAbsoluteZoom(i){this.cameraController.zoom=i}getCameraRotationCenter(){const i=ee.vec3Pool.get();Ee.scale(i,this.cameraController.center,yd);const s=Yt.fromArray(i);return ee.vec3Pool.release(i),s}setCameraRotationCenter(i){const s=ee.vec3Pool.get(),r=Array.isArray(i)?i:Yt.toArray(i);Ee.scale(s,r,Ta),Ee.copy(this.cameraController.center,s),ee.vec3Pool.release(s)}setCameraRotation(i,s){this.rotation.vx=s,this.rotation.vy=-i}setCameraPan(i,s){this.pan.x=i,this.pan.y=s}setCameraZoom(i){this.zoom=.03*i}setCameraZoomWithVelocity(i){this.setCameraZoom(i),requestAnimationFrame(()=>{i*=.85,Math.abs(i)>1&&this.setCameraZoomWithVelocity(i)})}tickCameraRotation(){return this.rotation.vx=this.checkEpsilon(this.rotation.vx),this.rotation.vy=this.checkEpsilon(this.rotation.vy),this.rotation}tickCameraPan(){return this.pan.x=this.checkEpsilon(this.pan.x),this.pan.y=this.checkEpsilon(this.pan.y),this.pan.z=this.checkEpsilon(this.pan.z),this.pan}tickCameraZoom(){return this.zoom=this.checkEpsilon(this.zoom),this.zoom}areCamerasEqual(i,s){return this.compareXYZ(i.eye,s.eye)&&this.compareXYZ(i.look,s.look)&&this.compareXYZ(i.up,s.up)}compareXYZ(i,s){return i.x===s.x&&i.y===s.y&&i.z===s.z}roundCamera(i,s){const{eye:r,look:a,up:l}=i;return{eye:this.numberService.roundModel(r,s),look:this.numberService.roundModel(a,s),up:this.numberService.roundModel(l,s)}}flyToObject(i,s){return new Promise(r=>{const a=this.sceneService.getObjectBoundary([i]);Fb(a)?(this.animationCallbacks.push(r),this.animation=new Qb(this,{targetBoundary:a,animationDuration:s,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())):r(void 0)})}flyToCamera(i,s){return new Promise(r=>{this.animationCallbacks.push(r),this.animation=new Qb(this,{targetCamera:i,animationDuration:s,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())})}jumpToObject(i){const s=this.sceneService.getObjectBoundary([i]);if(Fb(s)){const a=Hb(this.getCamera(),s);return this.jumpToCamera(a)}return new Promise(r=>r(void 0))}jumpToCamera(i){return new Promise(s=>{this.finishAnimation(),this.setCamera(i),s(void 0)})}getCameraAfterFlyTo(i){return Hb(this.getCamera(),i)}checkEpsilon(i){return Math.abs(i)<.001?0:i}initCameraEvents(){const i=new oe.B,s=i.asObservable();s.subscribe(l=>{this.engineService.fireEvent(pe.CameraUpdated,l)});const a=this.engineService.getEvent(pe.Tick).pipe((0,Sw.S)(2));s.pipe((0,bw.s)(()=>a)).subscribe(l=>{this.engineService.fireEvent(pe.CameraRested,l)}),this.engineService.engineCreated$.subscribe(l=>{l.camera.on("updateWorldMatrix",_=>{if(!l?.story)return;const u={...this.getCamera(),dist:this.getLookDistance()};i.next(u)})})}finishAnimation(){for(this.animation&&(this.animation.stop(),this.animation=null);this.animationCallbacks.length>0;)this.animationCallbacks.pop()()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(Cg),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class Og{constructor(e=0,o=0,i=0,s=0,r=0,a=!1){this.zoom=e,this.panX=o,this.panY=i,this.rotateX=s,this.rotateY=r,this.applyFriction=a}}var qo=S(9705);class wt{}let Ca=(()=>{class e{constructor(i){this.patches=i}}return e.type="[Story Chapter] Apply Patch",e})(),qb=(()=>{class e{constructor(){}}return e.type="[Story Chapter] Next Chapter",e})(),Kb=(()=>{class e{constructor(){}}return e.type="[Story Chapter] Previous Chapter",e})(),Mw=(()=>{class e{constructor(){}}return e.type="[Story Chapter] First Chapter",e})(),wg=(()=>{class e{constructor(){}}return e.type="[Story Chapter] Last Chapter",e})(),eo=(()=>{class e{constructor(i){this.chapter=i}}return e.type="[Story Chapter] Select Chapter",e})(),kl=(()=>{class e{constructor(i){this.chapterId=i}}return e.type="[Story Chapter] Select Chapter by chapter id",e})(),Dl=(()=>{class e{constructor(i){this.chapters=i}}return e.type="[Story Chapter] Set Chapters",e})(),Jb=(()=>{class e{constructor(i,s){this.chapterId=i,this.cameraAction=s}}return e.type="[Story Chapter] Set Chapter Camera Action",e})(),Mg=(()=>{class e{constructor(i,s){this.chapterId=i,this.title=s}}return e.type="[Story Chapter] Set Chapter Camera Title",e})(),Zb=(()=>{class e{constructor(i,s){this.chapterId=i,this.ui=s}}return e.type="[Story Chapter] Set Chapter UI",e})(),ey=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.description=s,this.displayName=r}}return e.type="[Story Chapter] Set Chapter Info",e})(),ty=(()=>{class e{constructor(i,s){this.chapterId=i,this.legend=s}}return e.type="[Story Chapter] Set Chapter Legend",e})(),ny=(()=>{class e{constructor(i,s){this.chapterId=i,this.legend=s}}return e.type="[Story Chapter] Add To Chapter Legend",e})(),iy=(()=>{class e{constructor(i,s){this.previousIndex=i,this.currentIndex=s}}return e.type="[Story Chapter] Reorder Chapters",e})(),vd=(()=>{class e{constructor(i,s){this.chapterId=i,this.readyState=s}}return e.type="[Story Chapter] Set Readystate",e})(),Ig=(()=>{class e{constructor(i){this.chapterId=i}}return e.type="[Story Chapter] Build Chapter Visibility Layers",e})(),oy=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.effects=s,this.properties=r}}return e.type="[Story Chapter] Set Chapter PostProcessing",e})(),sy=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.transition=s,this.key=r}}return e.type="[Story Chapter] Set Chapter Transitions",e})(),ry=(()=>{class e{constructor(i,s){this.chapterIds=i,this.properties=s}}return e.type="[Story Chapter] Set Chapter Properties",e})(),ay=(()=>{class e{constructor(i,s){this.chapterIds=i,this.properties=s}}return e.type="[Story Chapter] Remove Chapter Properties",e})(),ly=(()=>{class e{constructor(i,s){this.chapterId=i,this.transparencyMode=s}}return e.type="[Story Chapter] Set Chapter Transparency Mode",e})(),cy=(()=>{class e{constructor(i,s,r,a){this.chapterId=i,this.clips=s,this.enabled=r,this.record=a}}return e.type="[Story Chapter] Set Chapter Clipping Planes",e})(),mr=(()=>{class e{constructor(i,s){this.chapterId=i,this.background=s}}return e.type="[Story Chapter] Set Chapter Background",e})(),Ed=(()=>{class e{constructor(i){this.background=i}}return e.type="[Story Chapter] Set All Chapters Background",e})(),_y=(()=>{class e{constructor(){}}return e.type="[Story Chapter] Reset Selected Chapter Background",e})(),dy=(()=>{class e{constructor(i){this.background=i}}return e.type="[Story Chapter] Set Selected Chapter Background",e})(),py=(()=>{class e{constructor(i,s,r){this.story=i,this.chapter=s,this.chapterId=r}}return e.type="[Story Chapter] Duplicate An Existing Chapter",e})(),uy=(()=>{class e{constructor(i){this.chapter=i}}return e.type="[Story Chapter] Remove Chapter",e})(),Ag=(()=>{class e{constructor(){}}return e.type="[Story Chapter] Reset",e})(),Td=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.camera=s,this.rotationCenter=r}}return e.type="[Story Chapters] Record Camera",e})(),Pg=(()=>{class e{constructor(i,s,r,a){this.chapterId=i,this.index=s,this.position=r,this.record=a}}return e.type="[Story Chapters] Set the current visibility layers index and position",e})(),Ng=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.targetGroups=s,this.record=r}}return e.type="[Story Chapters] Set the current group layers position",e})(),gy=(()=>{class e{constructor(i,s){this.chapterId=i,this.media=s}}return e.type="[Story Chapters] Set the media object",e})(),Rg=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.contentBlocks=s,this.record=r}}return e.type="[Story Chapters] Set the content blocks",e})(),kg=(()=>{class e{constructor(i){this.timelineMaps=i}}return e.type="[Story Chapters] Add to timelineMap array",e})(),hy=(()=>{class e{constructor(i){this.updates=i}}return e.type="[Story Chapters] Update timelineMap array",e})(),my=(()=>{class e{constructor(i){this.timelineMapIds=i}}return e.type="[Story Chapters] Remove from timelineMap array",e})(),fy=(()=>{class e{constructor(i,s){this.chapterId=i,this.lightLibId=s}}return e.type="[Story Chapters] Set the lights",e})(),Sy=(()=>{class e{constructor(i){this.timelineMaps=i}}return e.type="[Story Chapters] set chapter timeline with data from the engine",e})();var An,_n=function(n){return n.Default="default",n.Plus="plus",n.Minus="minus",n.PlusMinus="plusMinus",n.Sequential="sequential",n.None="None",n}(_n||{}),$n=function(n){return n.Annotation="annotation",n.Classic="classic",n.StudioNext="studioNext",n.Context="context",n}($n||{}),co=function(n){return n.Alphabetical="alphabetical",n.Numerical="numerical",n}(co||{});class Cd{constructor(e){this.pinType=_n.PlusMinus,this.sequentialType=co.Alphabetical,this.theme=$n.StudioNext,this.expandTag=!0,this.showDescription=!0,this.collapseDescription=!1,this.pinGlow=!1,this.hideWire=!1,this.hideTag=!1,this.title=e}}!function(n){function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const s=16*Math.random()|0;return("x"===i?s:3&s|8).toString(16)})}n.getUuid=e,n.idWithPrefix=function o(i){return i?`${i}-${e()}`:e()}}(An||(An={}));var Oo=function(n){return n.classicAnnotation="classic-annotation",n.classicHotspot="classic-hotspot",n.studioNext="studio-light",n}(Oo||{});class vs{constructor(){this.title=null,this.description=null,this.errands=[]}}var Ni=function(n){return n.flyToChapter="flyToChapter",n.flyToObject="flyToObject",n.flyToCamera="flyToCamera",n}(Ni||{});class Ll{constructor(e){this.type=Ni.flyToObject,this.value=e}}class by{constructor(e){this.type=Ni.flyToCamera,this.value=e}}var Ko=function(n){return n.Circle="circle",n.CirclePlus="circle-plus",n.CircleMinus="circle-minus",n.Label="label",n.CircleLabel="circle-label",n}(Ko||{});class Ul{constructor(){this.type=Ni.flyToChapter,this.value=null}}let bi=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.store=s,this.fps=30}setChapter(i,s=!1){var r=this;return(0,J.A)(function*(){const{story:a}=r.engineService.engine,{chapters:l,activeChapter:_}=a;if(i&&(i!==_?.id||s)){const p=l.findIndex(u=>u.id===i);return a.activateChapter(p).then(u=>(r.initPlayer(u),u.id))}return i})()}initPlayer(i){this.destroyPlayer();const{animationSystem:s}=i;this._animationPlayer=new ee.BioDigitalAnimationPlayer(s),this.engineService.engine.renderer.on("animate",()=>{this.engineService.fireEvent(pe.TimelineAnimatingStart),this._animationPlayer.update(),this.engineService.fireEvent(pe.TimelineAnimatingEnd)}),this._animationPlayer.on("timeupdate",()=>{this.engineService.fireEvent(pe.TimelinePlaying,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("play",()=>{this.engineService.fireEvent(pe.TimelinePlayed,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("pause",()=>{this.engineService.fireEvent(pe.TimelinePaused,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("ended",()=>{this.engineService.fireEvent(pe.TimelineCompleted)}),this._animationPlayer.on("ratechange",({playBackRate:O})=>{const L=this.engineService.engine?.story;L&&(L.playBackRate=O)});const r=this.store.selectSnapshot(U.getPlaybackSpeed);this.setPlaybackRate(r);const a=[];i.timelineMap.forEach((O,L)=>{const $={id:L,...O};$.name=$.name??"",a.push($)}),this.store.dispatch(new Sy(a)),i.timelineMap.on("change",()=>{this.engineService.fireEvent(pe.TimelineTimeFrameUpdated)}),this.store.dispatch(new vd(i.id,{model:!0,animation:!0}));const l=this.store.selectSnapshot(U.getChapter),_=this.store.selectSnapshot(E.getStoryChapters),d=_.findIndex(O=>O.id===l),p=_.findIndex(O=>O.id===i.id),y=-1===(this.store.selectSnapshot(E.getChapter(i.id))?.ui?.play?.count??0);this.setAnimationLoop(y),d!==p&&this.engineService.fireEvent(pe.TimelineChapterTransition,{oldChapterIndex:d,newChapterIndex:p,time:0}),this.store.dispatch(new Qu(i.id))}destroyPlayer(){this._animationPlayer?.pause(),this._animationPlayer?.destroy(),this._animationPlayer=null}isChapterAnimated(i){return!!i?.timelineMap&&function Iw(n){return n.some(e=>"dummy"!==e?.data?.timeline&&"dummy"!==e?.name)}(i.timelineMap)}isChapterLooped(i){return!0===(0,m.get)(i,"loop")||-1===(0,m.get)(i,"ui.play.count")}restart(){if((0,m.isNil)(this._animationPlayer))return;const i=this.isPlaying();i&&this.pause(),this._animationPlayer.currentTime=0,i&&this.play()}play(){this._animationPlayer?.play(),this.playParticles()}pause(){this._animationPlayer?.pause(),this.pauseParticles()}unpause(){this._animationPlayer&&(this.hasChapterFinished()&&this.scrub(0),this.play())}scrub(i){this._animationPlayer&&(this._animationPlayer.currentTime=(0,m.clamp)(i,0,this._animationPlayer.duration),this.engineService.fireEvent(pe.TimelineScrubbed,{time:this._animationPlayer.currentTime}))}scrubRelative(i,s){this._animationPlayer&&(s&&this.isPlaying()?(this.pause(),this.scrub(this.getTime()+i),setTimeout(()=>this.unpause())):this.scrub(this.getTime()+i))}scrubFrame(i){const s="next"===i?1:-1,r=this.getTime(),l=this.secondsToFrames(r)+s,_=this.framesToSeconds(l);this.scrub(_)}secondsToFrames(i){return Math.round(i*this.fps)}framesToSeconds(i){return i/this.fps}getNearestFrameTime(i){return this.framesToSeconds(this.secondsToFrames(i))}formatTime(i){const s=p=>{const u=i<0?Math.ceil:Math.floor;return Math.abs(u(p)).toString().padStart(2,"0")},a=s(i/60),l=s(i%60),_=(p=>Math.abs(this.secondsToFrames(p%1)).toString().padStart(2,"0"))(i%1);return`${i<0?"-":""}${a}:${l}:${_}`}parseFormattedTime(i){const s=/^-/,r=s.test(i)?-1:1;-1===r&&(i=i.replace(s,""));const a=i.split(":").reverse();let l=parseInt(a[0],10),_=parseInt(a[1],10),d=parseInt(a[2],10);return isNaN(l)&&(l=0),isNaN(_)&&(_=0),isNaN(d)&&(d=0),(60*d+_+this.framesToSeconds(l))*r}updateTimelineClips(i){const s=this.engineService.engine.story.activeChapter;i.forEach(r=>{s.timelineMap.set(r.id,r)})}deleteTimelineClips(i){const s=this.engineService.engine.story.activeChapter;i.forEach(r=>{s.timelineMap.delete(r)})}addChapter(i,s){}setPlaybackRate(i){this._animationPlayer.playBackRate=i}getStoryAnimationNames(){const i=this.store.selectSnapshot(E.getStoryChapters),s=[];return i.forEach(r=>{r.timelineMap.forEach(a=>{const l=a.data.timeline;s.includes(l)||s.push(l)})}),s}getChapterTimeFrame(i){return{firstTime:0,lastTime:this.getChapterDuration(i)}}getChapterDuration(i){return(0,m.isNil)(i)?(0,m.isNil)(this._animationPlayer)?0:this._animationPlayer.duration:this.engineService.engine.story.chapters.find(l=>l.id===i)?.animationSystem?.duration??0}getTime(){return(0,m.isNil)(this._animationPlayer)?0:this._animationPlayer.currentTime}isPlaying(){return!(0,m.isNil)(this._animationPlayer)&&!this._animationPlayer.paused}hasChapterFinished(){return!(0,m.isNil)(this._animationPlayer)&&this._animationPlayer.currentTime===this._animationPlayer.duration}setAnimationLoop(i){if(!this._animationPlayer)throw new Error("Animation player is not initialized");this._animationPlayer.loop=i}mapChapterGlobalTime(i,s){let r=s;if((0,m.isNil)(r))return 0;const a=this.store.selectSnapshot(E.getStoryChapters),l=a.findIndex(_=>_.id===i);for(let _=0;_<l;_++){let p=0;a[_].timelineMap.forEach(u=>{u.end>p&&(p=u.end)}),r-=p}return r}mapGlobalTimeToChapterId(i){let s=0;const r=this.store.selectSnapshot(E.getStoryChapters);let a;for(let l=0;l<r.length;l++){const _=r[l],d=this.getChapterDuration(_.id);if(i>=s&&i<s+d){a=_.id;break}s+=d}return i===s&&!a&&(a=r[r.length-1].id),a}getGlobalTime(){const i=this.store.selectSnapshot(E.getSelectedChapterIndex),s=this.store.selectSnapshot(E.getStoryChapters);let r=this._animationPlayer.currentTime;for(let a=0;a<i;a++){let _=0;s[a].timelineMap.forEach(d=>{d.end>_&&(_=d.end)}),r+=_}return r}playParticles(){this.engineService.engine?.story?.activeChapter?.start()}pauseParticles(){this.engineService.engine?.story?.activeChapter?.stop()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const Aw={flyToCamera:"flyTo",flyToChapter:"flyTo"};let fr=(()=>{var n;class e{constructor(i,s){this.animationService=i,this.sceneService=s,this.convertActionToErrand=(r,a,l)=>{const _=new RegExp("^flyTo(Async)?"),d=new RegExp("^flyToObject(Async)?"),p=new RegExp("^flyTo[w.:]+currentChapter.[flyTo|jumpTo]"),u=l.split(":").slice(0,2),g=r;let y=u[1];/currentChapter/.test(y)&&(y=y.replace("currentChapter",`chapters[${a}]`));let C=null;return d.test(u[0])?C=new Ll((0,m.get)(g,y)):_.test(u[0])?C=new by((0,m.get)(g,y)):p.test(u[0])&&(C=new Ul),C},this.convertErrandToAction=(r,a)=>{const l=An.idWithPrefix("errand").replace(/-/g,"_"),_={};let d="";const p=function Pw(n){return Aw[n]||n}(a.type);return a.type===Ni.flyToChapter||(d=`${p}Async:currentChapter.customData.${l}`,_[l]=a.value),{action:d,data:_}}}filterHotspot(i,s,r){const a=new RegExp("^(flyTo|flyToObject|hideHotspot|showHotspot|resetHotspots)"),l=this.getHotspotAction(i,r),_=l.filter(d=>a.test(d));return l.length===_.length}deserializeAnnotation(i,s,r){const a=new Cd(i.title||"");return a.id=i.annotationId||An.idWithPrefix("label"),a.chapterId=s.id,a.expandTag=!0,a.showDescription=!0,a.collapseDescription=!1,a.pinGlow=!1,a.hideWire=!1,a.hideTag=!1,r===$n.Annotation?(a.theme=$n.Annotation,a.pinType=_n.Default,a.flyTo=!1,a.states=[]):(a.theme=$n.StudioNext,a.pinType=_n.PlusMinus,a.flyTo=!0,a.states=[new vs,new vs],a.states[0].errands=[new Ul],a.states[1].errands=[new Ll(i.objectId)]),a.occludable=!1!==i.occludable,a.renderableIndex=i.renderableIndex||0,i.objectId&&Object.prototype.hasOwnProperty.call(i,"barycentric")?(a.objectId=i.objectId,a.primitiveIndex=i.primitiveIndex,a.barycentric=i.barycentric):Object.prototype.hasOwnProperty.call(i,"pos")&&(Object.prototype.hasOwnProperty.call(i,"objectId")&&(a.objectId=i.objectId),a.pos=i.pos),i.dir&&Array.isArray(i.dir)?a.dir=i.dir:i.dir&&i.dir instanceof Object&&(a.dir=Object.values(i.dir)),a.description=i.description||"",a.offset=i.labelOffset||[40,40],a.shown=!1!==i.shown,a.labelShown=!1!==i.labelShown,a}deserializeHotspots(i,s,r,...a){const[l,_]=a,d=new Cd(l.title||"");switch(d.id=An.idWithPrefix("hotspot"),d.objectId=l.objectId,d.chapterId=s.id,d.description=l.description||"",d.pinType=/plus|minus/.test(l.className)?_n.PlusMinus:/sequential/.test(l.className)?_n.Sequential:/none/.test(l.className)?_n.None:_n.Default,/alphabetical/.test(l.className)?d.sequentialType=co.Alphabetical:/numerical/.test(l.className)&&(d.sequentialType=co.Numerical),d.pinGlow=/pulse/.test(l.className),d.occludable=!0,d.shown=l.shown,d.offset=l.labelOffset?l.labelOffset:[22,-17],(/left/.test(l.className)&&d.offset[0]>0||/right/.test(l.className)&&d.offset[0]<0)&&(d.offset[0]*=-1),Object.prototype.hasOwnProperty.call(l,"barycentric")?(d.renderableIndex=l.renderableIndex||0,d.barycentric=l.barycentric,d.primitiveIndex=l.primitiveIndex):d.pos=l.pos,d.dir=l.dir,l.theme=l.theme?l.theme:Oo.classicHotspot,l.theme){case Oo.classicAnnotation:d.theme=$n.Annotation,d.showDescription=!0,d.collapseDescription=/collapsible/g.test(l.className),d.expandTag=l.expandTag??!0,d.hideTag=l.hideTag??!1,d.hideWire=!/leader-line/.test(l.className);break;case Oo.classicHotspot:d.theme=$n.Classic,d.showDescription=/label/.test(l.className),d.expandTag=/label/.test(l.className),d.hideTag=!d.expandTag,d.collapseDescription=!1,d.hideWire=!/leader-line/.test(l.className);break;case Oo.studioNext:d.theme=$n.StudioNext,d.showDescription=this.hasContent(l),d.collapseDescription=/collapsible/g.test(l.className),d.hideTag=l.hideTag??!1,d.expandTag=l.expandTag??!0,d.hideWire=!/leader-line/.test(l.className)}d.flyTo=!1,d.flyToTarget=null,d.states=[];const p=this.filterHotspotActions(this.getHotspotAction(i,l)),u=_?this.filterHotspotActions(this.getHotspotAction(i,_)):[],g=new vs,y=new vs;p.length&&(g.errands=p.map(O=>this.convertActionToErrand(i,r,O))),u.length&&(y.errands=u.map(O=>this.convertActionToErrand(i,r,O))),d.states=[y,g],g.errands.length>0&&(d.flyTo=!0,d.flyToTarget=g.errands[0].type,g.errands[0].type===Ni.flyToCamera&&(d.cameraPosition=g.errands[0].value));const C=l.contentBlocks;return C&&(d.contentBlocks=JSON.parse(JSON.stringify(C))),d}makeDefaultStudioLabel(i){const s=i?{...i}:new Cd("");return s.pinType=_n.PlusMinus,s.theme=$n.StudioNext,s.expandTag=!0,s.showDescription=!0,s.collapseDescription=!1,s.pinGlow=!1,s.hideWire=!1,s.hideTag=!1,s.occludable=!0,s.flyTo=!0,s.description="",s.shown=!0,s.states=[new vs,new vs],s}makeAnnotationLabel(i){const s=i?{...i}:new Cd("");return s.pinType=_n.Default,s.theme=$n.Annotation,s.expandTag=!0,s.showDescription=!0,s.collapseDescription=!1,s.pinGlow=!1,s.hideWire=!1,s.hideTag=!1,s.states=[],s}serializeLabel(i,s){const r={symbol:void 0,className:void 0,dir:void 0,objectId:void 0,shown:void 0,type:void 0},a=(0,je.uK)(i),l=["circle","draggable"];if(r.shown=!0,i.objectId&&(r.objectId=a.objectId),i.objectId&&i.primitiveIndex&&i.barycentric)r.renderableIndex=i.renderableIndex||0,r.primitiveIndex=i.primitiveIndex,r.barycentric=i.barycentric;else{if(!i.objectId)return{data:{},hotspots:[]};r.pos=a.pos}switch((Array.isArray(i.dir)||ArrayBuffer.isView(i.dir))&&(r.dir=Array.prototype.slice.call(i.dir)),r.labelOffset=i.offset,i.theme){case $n.Annotation:r.theme=Oo.classicAnnotation;break;case $n.Classic:r.theme=Oo.classicHotspot;break;default:r.theme=Oo.studioNext}r.hideTag=a.hideTag,r.expandTag=a.expandTag,""!==a.title||""!==a.description?(r.title=a.title,r.description=a.description,r.type=Ko.CircleLabel):r.type=Ko.Circle,i.pinGlow&&l.push("pulse"),i.pinType===_n.PlusMinus&&l.push("plus"),i.pinType===_n.Sequential&&(l.push("sequential"),l.push(i.sequentialType===co.Alphabetical?"alphabetical":"numerical")),i.pinType===_n.None&&l.push("none"),i.hideWire||l.push("leader-line"),i.hideTag||l.push("label"),i.collapseDescription&&l.push("collapsible collapsed"),r.className=l.join(" ");let _={};r.actions=[];const d=[r],p=i.states.length;i.states.forEach((g,y)=>{if(y===p-1)d[0].actions.push("resetHotspots"),g.errands.forEach(C=>{const O=this.convertErrandToAction(i,C);d[0].actions.push(O.action),_={..._,...O.data}});else{const C=(0,m.cloneDeep)(r);C.actions=[],C.className=C.className.replace("plus","minus"),g.errands.forEach(O=>{const L=this.convertErrandToAction(i,O);C.actions.push(L.action),_={..._,...L.data}}),d.push(C)}}),2===d.length&&(d[0].actions.push(`hideHotspots:currentChapter.hotspots[${s}]`),d[0].actions.push(`showHotspots:currentChapter.hotspots[${s+1}]`),d[1].actions.push(`hideHotspots:currentChapter.hotspots[${s+1}]`),d[1].actions.push(`showHotspots:currentChapter.hotspots[${s}]`),d[0].shown=!0,d[1].shown=!1),2===d.length&&i.collapseDescription&&(d[1].className+=d[1].className.replace("collapsed","")),d.forEach(g=>{r.labelOffset[0]<0?g.className=g.className.replace("right","")+" left":r.labelOffset[0]>0&&(g.className=g.className.replace("left","")+" right")});const u=i.contentBlocks;return u&&(r.contentBlocks=JSON.parse(JSON.stringify(u))),{data:_,hotspots:d}}setLabelContainer(i){this._labelContainer=i}getLabelContainer(){return this._labelContainer}hasContent(i){const{description:s,contentBlocks:r}=i;return!!s||!(0,m.isNil)(r)&&r.length>0}getHotspotAction(i,s){const r=s.actionSrc?(0,m.get)(i,s.actionSrc):s.actions?s.actions:[];return Array.isArray(r)?r:[]}filterHotspotActions(i){const s=new RegExp("^(flyTo|flyToObject)");return i.filter(r=>s.test(r))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(bi),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function Lw(n,e,o){const i=Object.keys(e),s=Object.keys(o),r=function pw(n,e){return Object.keys(n).reduce((i,s)=>(i[s]=Al(e,n[s]),i),{})}(o,i),a=function uw(n,e){const i=n.map(r=>xi(e,r).depth);return Math.max(0,...i)-1}(s,n),l=(0,m.range)(a,-1).reduce((p,u)=>{const g=hg(n,Object.keys(p.remainingVoters),u),y=function mw(n,e,o,i){const s=Object.keys(i);return{results:o.reduce((a,l)=>{const _=Co(n,l),d=_.map(g=>({[g]:e[g]||Al(s,gd(n,g,s))}));_.forEach(g=>{delete e[g]});const u=Rb(l,function gw(n,e){return n.reduce((o,i)=>{const s=function hw(n,e){return n.reduce((o,i)=>{const s=Object.keys(i)[0];return i[s][e]?o.votesFor.push(s):o.votesAgainst.push(s),o},{votesFor:[],votesAgainst:[]})}(e,i);return o[i]=s,o},{})}(s,d),i);return e[l]=Object.entries(u).reduce((g,[y,C])=>(g[y]=C.result,g),{}),a.push(u),a},[]),remainingVoters:e}}(n,p.remainingVoters,g,e),C=function kw(n){return n.reduce((e,o)=>{const r=Object.keys(o).map(a=>function Rw(n,e,o,i){const s=i.reduce((r,a)=>(r[a]={[n]:!o},r),{});return s[e]={[n]:o},s}(a,o[a].id,o[a].result,o[a].dissenters)).reduce((a,l)=>(0,m.merge)(a,l),{});return Object.keys(r).forEach(a=>{e[a]=r[a]}),e},{})}(y.results);return Object.keys(C).forEach(O=>{p.syncGraph[O]=C[O]}),p.remainingVoters=y.remainingVoters,p},{syncGraph:{},remainingVoters:r}).syncGraph;return function Dw(n,e,o,i){const s=e.reduce((r,a)=>{const _=n[a],d=n[i.predecessors[a]];for(const p of o)_[p]===d[p]&&r.push({successorId:a,prop:p});return r},[]);for(const r of s)delete n[r.successorId][r.prop],0===Object.keys(n[r.successorId]).length&&delete n[r.successorId];return n}(l,Object.keys(l).filter(p=>!n.roots[p]&&!!n.successors[p]),i,n)}class Od{}let yy=(()=>{class e{constructor(){}}return e.type="[Engine Nodes] Reset",e})(),Dg=(()=>{class e{constructor(i){this.nodeState=i}}return e.type="[Engine Nodes] init nodes",e})(),wo=(()=>{class e{constructor(i){this.patches=i}}return e.type="[Engine Nodes] patch nodes",e})(),Oa=(()=>{class e{constructor(i){this.activeChapterId=i}}return e.type="[Engine Nodes] set active chapter",e})(),vy=(()=>{class e{constructor(i,s){this.originalChapterId=i,this.copyChapterId=s}}return e.type="[Engine Nodes] Duplicate node state",e})(),wd=(()=>{class e{constructor(i,s){this.show=i,this.objectIds=s}}return e.type="[Engine Nodes] update tween nodes shown",e})(),kn=(()=>{class e{constructor(i,s,r,a=!0,l=!1,_=!1){this.show=i,this.objectIds=s,this.patch=r,this.record=a,this.setByTween=l,this.includeUnavailable=_}}return e.type="[Engine Nodes] update nodes shown",e})(),Sr=(()=>{class e{constructor(i){this.objectId=i}}return e.type="[Engine Nodes] update nodes selected",e})(),un=(()=>{class e{constructor(i,s,r){this.checked=i,this.objectIds=s,this.patch=r}}return e.type="[Engine Nodes] update nodes checked",e})(),Vl=(()=>{class e{constructor(i,s,r){this.pickable=i,this.objectIds=s,this.patch=r}}return e.type="[Engine Nodes] update nodes pickable",e})(),Mo=(()=>{class e{constructor(i,s,r,a=!0){this.recipe=i,this.objectIds=s,this.patch=r,this.record=a}}return e.type="[Engine Nodes] update nodes paint",e})(),Lg=(()=>{class e{constructor(i,s,r){this.available=i,this.objectIds=s,this.patch=r}}return e.type="[Engine Nodes] update nodes available",e})(),Ug=(()=>{class e{constructor(i,s){this.objectIds=i,this.sourceChapterId=s}}return e.type="[Engine Nodes] copy nodes paint",e})(),jl=(()=>{class e{constructor(i,s=!0){this.objectVariants=i,this.record=s}}return e.type="[Engine Nodes] update node variants",e})();var Ut;function Vg(n,e){const o=e.children;return 0===o.length?[]:(0,m.flattenDeep)(o.map(i=>[i.objectId,...Vg(n,n.getObjectById(i.objectId))]))}function br(n,e,o,i,s){const r=n.getObjectById(e);Vg(n,r).forEach(l=>{l in o&&(o[l][i]=s)})}function Ey(n,e,o,i){e[o][i]=(0,m.cloneDeep)(n[o][i])}!function(n){n.Reset=(()=>{class l{constructor(){}}return l.type="[Undo] Reset",l})(),n.Undo=(()=>{class l{constructor(d){this.chapterId=d}}return l.type="[Undo] Undo",l})(),n.UndoAll=(()=>{class l{constructor(d){this.chapterId=d}}return l.type="[Undo] Undo All",l})(),n.Redo=(()=>{class l{constructor(d){this.chapterId=d}}return l.type="[Undo] Redo",l})(),n.SavePatches=(()=>{class l{constructor(d){this.patches=d}}return l.type="[Undo] Store Patches",l})()}(Ut||(Ut={}));var re=S(1025);function jg(n,e,o){if(!n.activeChapterId||!n.nodeState)return;const{objectIds:i,patch:s,setByTween:r,show:a,includeUnavailable:l}=e,[_,d,p]=re.vI(n,g=>{const y=g.nodeState[g.activeChapterId],C=l?y:Nb(y);s?Object.entries(s).forEach(([O,L])=>{O in C&&(C[O].shown=L)}):(i??Object.keys(C)).forEach(L=>{L in C&&(C[L].shown=a,C[L].shownSetByTween=r,i&&(br(o,L,C,"shown",a),!0===r&&br(o,L,C,"shownSetByTween",r)))})});return{finalState:re.jM(_,g=>{g.patches=d,g.patchesForChapter[g.activeChapterId].push(...d)}),patches:d,inversePatches:p}}class Ty{constructor(e={center:[0,0,0],edge:[1,1,1],centerBias:1,edgeBias:0,power:1}){const{edge:o,center:i,centerBias:s,edgeBias:r,power:a}=e;this.edge=o,this.center=i,this.centerBias=s,this.edgeBias=r,this.power=a}static toEngine(e){const{center:o,edge:i,centerBias:s,edgeBias:r,power:a}=e;return[[...o],[...i],s,r,a]}}class wa{constructor(e={center:0,edge:1,centerBias:1,edgeBias:0,power:1}){const{edge:o,center:i,centerBias:s,edgeBias:r,power:a}=e;this.edge=o,this.center=i,this.centerBias=s,this.edgeBias=r,this.power=a}static toEngine(e){const{center:o,edge:i,centerBias:s,edgeBias:r,power:a}=e;return[o,i,s,r,a]}static isFresnelObject(e){let o=!1;return e&&(o="center,centerBias,edge,edgeBias,power"==Object.keys(e).sort().toString()),o}}function Md(n,e){switch(!0){case void 0===n[e]:return;case!1===n[e]:return!1;case"number"==typeof n[e]:return 100*n[e];default:return new wa({center:n[e][0],edge:n[e][1],centerBias:n[e][2],edgeBias:n[e][3],power:n[e][4]})}}function Jo(n){return!(0,m.isNil)(n)&&Object.prototype.hasOwnProperty.call(n,"edge")&&Object.prototype.hasOwnProperty.call(n,"edgeBias")&&Object.prototype.hasOwnProperty.call(n,"center")&&Object.prototype.hasOwnProperty.call(n,"centerBias")&&Object.prototype.hasOwnProperty.call(n,"power")}function xg(n){return{tintColor:(()=>{switch(!0){case void 0===n.tintColor:return;case!1===n.tintColor:return!1;case Array.isArray(n.tintColor):return 3===n.tintColor.length?[...n.tintColor]:new Ty({center:n.tintColor[0],edge:n.tintColor[1],centerBias:n.tintColor[2],edgeBias:n.tintColor[3],power:n.tintColor[4]})}})(),saturation:Md(n,"saturation"),brightness:Md(n,"brightness"),contrast:Md(n,"contrast"),opacity:Md(n,"opacity")}}function yr(n){let e=!1!==n.tintColor&&void 0,o=!1!==n.saturation&&void 0,i=!1!==n.brightness&&void 0,s=!1!==n.contrast&&void 0,r=!1!==n.opacity&&void 0;return Array.isArray(n.tintColor)?e=[...n.tintColor]:Jo(n.tintColor)&&(e=Ty.toEngine(n.tintColor)),"number"==typeof n.saturation?o=n.saturation/100:Jo(n.saturation)&&(o=wa.toEngine(n.saturation)),"number"==typeof n.brightness?i=n.brightness/100:Jo(n.brightness)&&(i=wa.toEngine(n.brightness)),"number"==typeof n.contrast?s=n.contrast/100:Jo(n.contrast)&&(s=wa.toEngine(n.contrast)),"number"==typeof n.opacity?r=n.opacity/100:Jo(n.opacity)&&(r=wa.toEngine(n.opacity)),{tintColor:e,saturation:o,brightness:i,contrast:s,opacity:r}}function Cy(n,e){const o=Object.assign({},n);for(const[i,s]of Object.entries(e))typeof s<"u"&&(o[i]=s);return o}class Oy{}let Gg=(()=>{class e{constructor(i){this.showUnavailableNodes=i}}return e.type="[Engine Config] Set Show Unavailable Nodes",e})();var vr,Id=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Zo=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let Io=((vr=class{static getPerChapterTreeEnabled(e){return e.perChapterTreeEnabled}static getShowUnavailableNodes(e){return e.showUnavailableNodes}setShowUnavailableNodes(e,{showUnavailableNodes:o}){e.patchState({showUnavailableNodes:o})}}).\u0275fac=function(e){return new(e||vr)},vr.\u0275prov=t.jDH({token:vr,factory:vr.\u0275fac}),vr);Id([(0,c.rc)(Gg),Zo("design:type",Function),Zo("design:paramtypes",[Object,Gg]),Zo("design:returntype",void 0)],Io.prototype,"setShowUnavailableNodes",null),Id([(0,c.MD)(),Zo("design:type",Function),Zo("design:paramtypes",[Oy]),Zo("design:returntype",void 0)],Io,"getPerChapterTreeEnabled",null),Id([(0,c.MD)(),Zo("design:type",Function),Zo("design:paramtypes",[Oy]),Zo("design:returntype",void 0)],Io,"getShowUnavailableNodes",null),Io=Id([(0,c.Uw)({name:"engineConfig",defaults:{showUnavailableNodes:!1,perChapterTreeEnabled:!0}})],Io);var Er,rn=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Oe=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let Re=(Er=class{static getAllNodeState(e){return e.nodeState}static getActiveChapter(e){return e.activeChapterId}static getPatches(e){return e.patches}static getNodes(e,o){return e?.[o]??{}}static getAvailableNodes(e,o){return o?e:Nb(e)}static getNodePaint(e){return o=>e.nodeState[e.activeChapterId][o].paint}static getNodeIds(e){return Object.keys(e)}static getCheckedNodeIds(e){return e.map(o=>o.objectId)}static getCheckedNodesCount(e){return e.length}static getCheckedNodes(e){return Object.values(e).filter(o=>o.checked)}static getSelectedNode(e){return Object.values(e).find(o=>o.selected)}reset(e,o){e.patchState(re.jM(e.getState(),i=>{i.activeChapterId=void 0,i.nodeState=void 0,i.patches=[],i.patchesForChapter={}}))}applyPatch(e,o){const i=re.$i(e.getState(),o.patches),s=re.jM(i,r=>{r.patchesForChapter[r.activeChapterId].push(...o.patches),r.patches=o.patches});e.patchState(s)}initNodeState(e,o){e.patchState({nodeState:o.nodeState})}setActiveChapter(e,o){const i=e.getState(),s=re.jM(i,r=>{r.activeChapterId=o.activeChapterId,r.patchesForChapter[o.activeChapterId]=r.patchesForChapter[o.activeChapterId]||[],r.patches=r.patchesForChapter[o.activeChapterId]});e.patchState(s)}duplicateNodeState(e,o){const i=e.getState(),s=re.jM(i,r=>{r.nodeState[o.copyChapterId]=r.nodeState[o.originalChapterId],r.patchesForChapter[o.copyChapterId]=r.patchesForChapter[o.originalChapterId].map(l=>(l.path[1]=o.copyChapterId,l))});e.patchState(s)}updateTweenNodesShown(e,o){const i=e.getState(),{finalState:s}=jg(i,{...o,record:!1,setByTween:!0,includeUnavailable:!0},this.sceneService),{nodeState:r}=s;e.patchState({nodeState:r})}updateNodesShown(e,o){const i=e.getState(),{finalState:s,patches:r,inversePatches:a}=jg(i,o,this.sceneService);e.patchState(s),o.record&&e.dispatch(new Ut.SavePatches([{forward:r,inverse:a,patchAction:wo}]))}updateNodesSelected(e,o){const i=e.getState();if(!i)return;const s=re.jM(i,r=>{const a=r.nodeState?.[r.activeChapterId]??{},l=Object.keys(a);void 0===o.objectId?l.forEach(_=>a[_].selected=!1):(l.forEach(_=>a[_].selected=!1),a[o.objectId].selected=!0)});e.patchState(s)}updateNodesChecked(e,o){const i=e.getState(),[s,r,a]=re.vI(i,_=>{const d=_.nodeState?.[_.activeChapterId]??{};void 0===o.patch?(o.objectIds||Object.keys(d)).forEach(u=>{d[u].checked=o.checked,o.objectIds&&br(this.sceneService,u,d,"checked",o.checked)}):Object.entries(o.patch).forEach(([p,u])=>d[p].checked=u)}),l=re.jM(s,_=>{_.patches=r});e.patchState(l)}updateNodesPickable(e,o){const i=e.getState(),[s,r,a]=re.vI(i,_=>{const d=_.nodeState?.[_.activeChapterId]??{};o.patch?Object.entries(o.patch).forEach(([p,u])=>d[p].pickable=u):(o.objectIds||Object.keys(d)).forEach(u=>{d[u].pickable=o.pickable,o.objectIds&&br(this.sceneService,u,d,"pickable",o.pickable)})}),l=re.jM(s,_=>{_.patches=r,_.patchesForChapter[_.activeChapterId].push(...r)});e.patchState(l),e.dispatch(new Ut.SavePatches([{forward:r,inverse:a,patchAction:wo}]))}updateNodesPaint(e,o){const i=e.getState(),[s,r,a]=re.vI(i,_=>{const d=_.nodeState?.[_.activeChapterId]??{},p=o.objectIds||Object.keys(d);o.patch?Object.entries(o.patch).forEach(([u,g])=>{const y=Cy(d[u].paint,g);d[u].paint=y}):p.forEach(u=>{const g=Cy(d[u].paint,o.recipe);d[u].paint=g,o.objectIds&&br(this.sceneService,u,d,"paint",g)})}),l=re.jM(s,_=>{_.patches=r,_.patchesForChapter[_.activeChapterId].push(...r)});e.patchState(l),o.record&&e.dispatch(new Ut.SavePatches([{forward:r,inverse:a,patchAction:wo}]))}updateNodesAvailable(e,o){const i=e.getState(),[s,r,a]=re.vI(i,_=>{const d=_.nodeState?.[_.activeChapterId]??{};if(o.patch)Object.entries(o.patch).forEach(([p,u])=>{d[p].available=u,d[p].pickable=u});else{const{available:p,objectIds:u}=o;(u??Object.keys(d)).forEach(y=>{d[y].available=p,d[y].pickable=p,u&&(br(this.sceneService,y,d,"available",p),br(this.sceneService,y,d,"pickable",p))})}}),l=re.jM(s,_=>{_.patches=r,_.patchesForChapter[_.activeChapterId].push(...r)});e.patchState(l),e.dispatch(new Ut.SavePatches([{forward:r,inverse:a,patchAction:wo}]))}updateNodeVariants(e,{objectVariants:o,record:i}){const s=e.getState(),[r,a,l]=re.vI(s,d=>{const p=d.nodeState?.[d.activeChapterId]??{};Object.entries(o).forEach(([u,g])=>{p[u].variant=g})}),_=re.jM(r,d=>{d.patches=a,d.patchesForChapter[d.activeChapterId].push(...a)});e.patchState(_),i&&e.dispatch(new Ut.SavePatches([{forward:a,inverse:l,patchAction:wo}]))}copyNodesPaint(e,{sourceChapterId:o,objectIds:i}){const s=e.getState(),[r,a,l]=re.vI(s,d=>{!function Uw(n,e,o,i,s){i.forEach(r=>{const a=n.getObjectById(r),l=Vg(n,a);Ey(e,o,r,s),l.forEach(_=>{Ey(e,o,_,s)})})}(this.sceneService,d.nodeState?.[o]??{},d.nodeState?.[d.activeChapterId]??{},i,"paint")}),_=re.jM(r,d=>{d.patches=a,d.patchesForChapter[d.activeChapterId].push(...a)});e.patchState(_),e.dispatch(new Ut.SavePatches([{forward:a,inverse:l,patchAction:wo}]))}constructor(e){this.sceneService=e}},Er.\u0275fac=function(e){return new(e||Er)(t.KVO(cn))},Er.\u0275prov=t.jDH({token:Er,factory:Er.\u0275fac}),Er);rn([(0,c.rc)(yy),Oe("design:type",Function),Oe("design:paramtypes",[Object,yy]),Oe("design:returntype",void 0)],Re.prototype,"reset",null),rn([(0,c.rc)(wo),Oe("design:type",Function),Oe("design:paramtypes",[Object,wo]),Oe("design:returntype",void 0)],Re.prototype,"applyPatch",null),rn([(0,c.rc)(Dg),Oe("design:type",Function),Oe("design:paramtypes",[Object,Dg]),Oe("design:returntype",void 0)],Re.prototype,"initNodeState",null),rn([(0,c.rc)(Oa),Oe("design:type",Function),Oe("design:paramtypes",[Object,Oa]),Oe("design:returntype",void 0)],Re.prototype,"setActiveChapter",null),rn([(0,c.rc)(vy),Oe("design:type",Function),Oe("design:paramtypes",[Object,vy]),Oe("design:returntype",void 0)],Re.prototype,"duplicateNodeState",null),rn([(0,c.rc)(wd),Oe("design:type",Function),Oe("design:paramtypes",[Object,wd]),Oe("design:returntype",void 0)],Re.prototype,"updateTweenNodesShown",null),rn([(0,c.rc)(kn),Oe("design:type",Function),Oe("design:paramtypes",[Object,kn]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesShown",null),rn([(0,c.rc)(Sr),Oe("design:type",Function),Oe("design:paramtypes",[Object,Sr]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesSelected",null),rn([(0,c.rc)(un),Oe("design:type",Function),Oe("design:paramtypes",[Object,un]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesChecked",null),rn([(0,c.rc)(Vl),Oe("design:type",Function),Oe("design:paramtypes",[Object,Vl]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesPickable",null),rn([(0,c.rc)(Mo),Oe("design:type",Function),Oe("design:paramtypes",[Object,Mo]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesPaint",null),rn([(0,c.rc)(Lg),Oe("design:type",Function),Oe("design:paramtypes",[Object,Lg]),Oe("design:returntype",void 0)],Re.prototype,"updateNodesAvailable",null),rn([(0,c.rc)(jl),Oe("design:type",Function),Oe("design:paramtypes",[Object,jl]),Oe("design:returntype",void 0)],Re.prototype,"updateNodeVariants",null),rn([(0,c.rc)(Ug),Oe("design:type",Function),Oe("design:paramtypes",[Object,Ug]),Oe("design:returntype",void 0)],Re.prototype,"copyNodesPaint",null),rn([(0,c.MD)(),Oe("design:type",Function),Oe("design:paramtypes",[Od]),Oe("design:returntype",void 0)],Re,"getAllNodeState",null),rn([(0,c.MD)(),Oe("design:type",Function),Oe("design:paramtypes",[Od]),Oe("design:returntype",void 0)],Re,"getActiveChapter",null),rn([(0,c.MD)(),Oe("design:type",Function),Oe("design:paramtypes",[Od]),Oe("design:returntype",void 0)],Re,"getPatches",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getAllNodeState,Re.getActiveChapter]),Oe("design:type",Function),Oe("design:paramtypes",[Object,String]),Oe("design:returntype",void 0)],Re,"getNodes",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getNodes,Io.getShowUnavailableNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Object,Boolean]),Oe("design:returntype",Object)],Re,"getAvailableNodes",null),rn([(0,c.MD)(),Oe("design:type",Function),Oe("design:paramtypes",[Od]),Oe("design:returntype",void 0)],Re,"getNodePaint",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",void 0)],Re,"getNodeIds",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getCheckedNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Array]),Oe("design:returntype",void 0)],Re,"getCheckedNodeIds",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getCheckedNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Array]),Oe("design:returntype",void 0)],Re,"getCheckedNodesCount",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getAvailableNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",void 0)],Re,"getCheckedNodes",null),rn([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([Re.getAvailableNodes]),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",void 0)],Re,"getSelectedNode",null),Re=rn([(0,c.Uw)({name:"engineNodes",defaults:{activeChapterId:void 0,nodeState:void 0,patches:[],patchesForChapter:{}}}),Oe("design:paramtypes",[cn])],Re);const Ma={label:"Original",tintColor:!1,saturation:!1,contrast:!1,brightness:!1,opacity:!1},Es={label:"Fade",tintColor:[0,0,0],contrast:!1,brightness:55,saturation:-100,opacity:new wa({edge:1,center:0,edgeBias:0,centerBias:1,power:1})};function Ad(n,e,o){const i=Co(n,e);if(0===i.length)return!1;for(const s of i)if(!0===o[s])return!0;return i.some(s=>Ad(n,s,o))}function Pd(n,e,o){switch(o[e]){case!0:return!0;case!1:return!1;case void 0:{const i=va(n,e);return!!i&&Pd(n,i,o)}}}function Ay(n,e,o){if((0,m.isNil)(o))return!0;switch(o[e]){case!0:return!1;case!1:return!0;case void 0:{const i=va(n,e);return!i||Ay(n,i,o)}}}function Py(n,e,o){if(o&&o[e]&&function Hw(n){return"tintColor"in n||"opacity"in n||"brightness"in n||"saturation"in n||"contrast"in n}(o[e]))return xg(o[e]);const i=va(n,e);return i?Py(n,i,o):Ma}function Qw(n,e,o,i,s){function r(l){const _=function Xw(n,e,o){return Ib(e,o,i=>va(n,i),i=>Co(n,i))}(n,l,o),d=function Ww(n,e,o){return Pd(n,e,o)||Ad(n,e,o)}(n,l,e),p=Ay(n,l,i);return{objectId:l,checked:!1,selected:!1,paint:Py(n,l,s),pickable:p,shown:d,shownSetByTween:!1,available:_,variant:0}}return Object.keys(n.nodes).reduce((l,_)=>(l[_]=r(_),l),{})}var Ue,Ia,es;!function(n){n.SetParticleState=(()=>{class k{constructor(R,Z,te){this.particleSystems=R,this.assignedParticles=Z,this.tweenParticleLookup=te}}return k.type="[Engine Particles] Set Particle State",k})(),n.NewParticleSystem=(()=>{class k{constructor(R,Z){this.particleSystem=R,this.chapterId=Z}}return k.type="[Engine Particles] New Particle System",k})(),n.DuplicateParticleSystem=(()=>{class k{constructor(R,Z){this.id=R,this.targetChapterId=Z}}return k.type="[Engine Particles] Duplicate Particle System",k})(),n.DuplicateParticleSystemSuccess=(()=>{class k{constructor(R,Z){this.id=R,this.targetChapterId=Z}}return k.type="[Engine Particles] Duplicate Particle System Success",k})(),n.UpdateParticleSystem=(()=>{class k{constructor(R,Z){this.id=R,this.particleSystem=Z}}return k.type="[Engine Particles] Update Particle System",k})(),n.SetParticleSystemsVisible=(()=>{class k{constructor(R,Z){this.visible=R,this.chapterId=Z}}return k.type="[Engine Particles] Set Particle Systems Visible",k})(),n.SetParticleSystemVisible=(()=>{class k{constructor(R,Z,te){this.id=R,this.visible=Z,this.chapterId=te}}return k.type="[Engine Particles] Set Particle System Visible",k})(),n.AssignParticle=(()=>{class k{constructor(R,Z){this.id=R,this.chapterId=Z}}return k.type="[Engine Particles] Assign Particle",k})(),n.UnassignParticle=(()=>{class k{constructor(R,Z){this.id=R,this.chapterId=Z}}return k.type="[Engine Particles] Unassign Particle",k})(),n.DeleteParticleSystem=(()=>{class k{constructor(R){this.id=R}}return k.type="[Engine Partiles] Delete Particle System",k})(),n.SelectParticleSystem=(()=>{class k{constructor(R){this.id=R}}return k.type="[Engine Partiles] Select Particle System",k})(),n.SelectParticleConstraint=(()=>{class k{constructor(R){this.index=R}}return k.type="[Engine Partiles] Select Particle Constraint",k})(),n.SelectParticleCreator=(()=>{class k{constructor(R){this.index=R}}return k.type="[Engine Partiles] Select Particle Creator",k})(),n.SelectParticleUpdater=(()=>{class k{constructor(R){this.index=R}}return k.type="[Engine Partiles] Select Particle Updater",k})(),n.UpdateTweenParticleLookupChapters=(()=>{class k{constructor(R){this.chapterMap=R}}return k.type="[Engine Particles] Update Lookup Chapters",k})(),n.SetLookupForChapter=(()=>{class k{constructor(R,Z){this.chapterId=R,this.lookup=Z}}return k.type="[Engine Particles] Set Lookup for chapter",k})(),n.DeleteChapterLookup=(()=>{class k{constructor(R){this.chapterId=R}}return k.type="[Engine Particles] Delete chapter lookup",k})(),n.ApplyPatch=(()=>{class k{constructor(R){this.patches=R}}return k.type="[Engine Particles] Apply Patch",k})()}(Ue||(Ue={})),function(n){n.updateChapterIds=function e(r,a){return Object.keys(r).reduce((d,p)=>(d[a[p]]=r[p],d),{})},n.duplicateChapter=function o(r,a,l){return{...l,[a]:l[r]}},n.deleteChapter=function i(r,a){const l={...a};return delete l[r],l},n.addEntryForChapter=function s(r,a,l){return l[r]={...l[r],...a},l}}(Ia||(Ia={})),function(n){function e(i){return i.split("-")[0].replace(/_particle$/,"")}n.getParticleIdRoot=e,n.generateParticleId=function o(i,s=An.getUuid){return`${e(i)}-${s()}`}}(es||(es={}));var Ts,Cs,$t=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},fe=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let St=(Ts=class{static particleSystemIdExists(e){return(0,c.Mz)([Cs],o=>void 0!==o.particleSystems[e])}static particleSystemsForChapter(e){return(0,c.Mz)([Cs],o=>(o.assignedParticles[e]||[]).map(s=>o.particleSystems[s]))}static getVisibleParticleSystemsForChapter(e){return(0,c.Mz)([Cs],o=>{const s=o.visibleParticleSystems[e]||{};return(o.assignedParticles[e]||[]).filter(r=>!1!==s[r])})}static getTweenParticleLookup(e){return e.tweenParticleLookup}static getParticleSystems(e){return e.particleSystems}static getVisisbleParticleSystems(e){return e.visibleParticleSystems}static getParticleSystemsList(e){return Object.values(e.particleSystems)}static getAssignedParticleSystems(e){return e.assignedParticles}static getSelectedParticleSystemId(e){return e.particleSelection.selectedParticle}static getSelectedParticleSystem(e){const{particleSystems:o,particleSelection:i}=e;return o[i.selectedParticle]}static getSelectedParticleConstraintIndex(e){return e.particleSelection.selectedConstraint}static getSelectedParticleConstraint(e){const o=Cs.getSelectedParticleSystem(e);return o?o.constraints[e.particleSelection.selectedConstraint]:null}static getSelectedParticleCreatorIndex(e){return e.particleSelection.selectedCreator}static getSelectedParticleCreator(e){const o=Cs.getSelectedParticleSystem(e);return o?o.creators[e.particleSelection.selectedCreator]:null}static getSelectedParticleUpdaterIndex(e){return e.particleSelection.selectedUpdater}static getSelectedParticleUpdater(e){const o=Cs.getSelectedParticleSystem(e);return o?o.updaters[e.particleSelection.selectedUpdater]:null}applyPatch(e,o){const i=re.$i(e.getState(),o.patches);e.patchState(i)}setParticleState(e,o){e.patchState(re.jM(e.getState(),i=>{i.particleSystems=o.particleSystems.reduce((s,r)=>(s[r.id]=r,s),{}),i.assignedParticles=o.assignedParticles,i.tweenParticleLookup=o.tweenParticleLookup,i.visibleParticleSystems={}}))}setParticlesVisible(e,{visible:o,chapterId:i}){e.patchState(re.jM(e.getState(),s=>{const a=(s.assignedParticles[i]||[]).reduce((l,_)=>(l[_]=o,l),{});s.visibleParticleSystems={...s.visibleParticleSystems,[i]:a}}))}setParticleVisible(e,{id:o,visible:i,chapterId:s}){e.patchState(re.jM(e.getState(),r=>{r.visibleParticleSystems[s]={...r.visibleParticleSystems[s]||{},[o]:i}}))}newParticleSystem(e,o){const{particleSystem:i,chapterId:s}=o,r=i.id,[a,l,_]=re.vI(e.getState(),d=>{d.particleSystems[r]=i,d.assignedParticles[s]=[...d.assignedParticles[s]||[],r]});e.patchState(a)}duplicateParticleSystem(e,o){const{id:i,targetChapterId:s}=o,r=es.generateParticleId(i);e.patchState(re.jM(e.getState(),a=>{a.particleSystems[r]=JSON.parse(JSON.stringify(a.particleSystems[i])),a.particleSystems[r].id=r,a.assignedParticles[s].push(r);const l=es.getParticleIdRoot(i);a.tweenParticleLookup[s]&&a.tweenParticleLookup[s][l]&&(a.tweenParticleLookup=Ia.addEntryForChapter(s,{[l]:r},a.tweenParticleLookup))})),e.dispatch(new Ue.DuplicateParticleSystemSuccess(r,s))}updateParticleSystem(e,o){const i=re.jM(e.getState(),s=>{s.particleSystems[o.id]=o.particleSystem});e.patchState({...i,particleSystems:{...i.particleSystems}})}deleteChapterLookup(e,o){e.patchState(re.jM(e.getState(),i=>{delete i.tweenParticleLookup[o.chapterId]}))}setLookupForChapter(e,o){e.patchState(re.jM(e.getState(),i=>{i.tweenParticleLookup[o.chapterId]=o.lookup}))}assignParticle(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.assignedParticles[o.chapterId]||[],r=es.getParticleIdRoot(o.id);i.assignedParticles[o.chapterId]=s.concat(o.id),i.tweenParticleLookup=Ia.addEntryForChapter(o.chapterId,{[r]:o.id},i.tweenParticleLookup),i.particleSystems={...i.particleSystems}}))}unassignParticle(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.assignedParticles[o.chapterId]||[],r=es.getParticleIdRoot(o.id);i.assignedParticles[o.chapterId]=s.filter(a=>a!==o.id),i.tweenParticleLookup[o.chapterId]&&delete i.tweenParticleLookup[o.chapterId][r],i.particleSystems={...i.particleSystems}}))}deleteParticleSystem(e,o){e.patchState(re.jM(e.getState(),i=>{delete i.particleSystems[o.id],Object.keys(i.assignedParticles).forEach(s=>{i.assignedParticles[s]=i.assignedParticles[s].filter(r=>r!==o.id)}),Object.keys(i.tweenParticleLookup).forEach(s=>{delete i.tweenParticleLookup[s][es.getParticleIdRoot(o.id)]})}))}selectParticleSystem(e,o){e.patchState(re.jM(e.getState(),i=>{i.particleSelection={selectedParticle:o.id}}))}selectParticleConstraint(e,o){const s=e.getState().particleSelection;e.patchState(re.jM(e.getState(),r=>{r.particleSelection={...s,selectedConstraint:o.index}}))}selectParticleCreator(e,o){const s=e.getState().particleSelection;e.patchState(re.jM(e.getState(),r=>{r.particleSelection={...s,selectedCreator:o.index}}))}selectParticleUpdater(e,o){const s=e.getState().particleSelection;e.patchState(re.jM(e.getState(),r=>{r.particleSelection={...s,selectedUpdater:o.index}}))}updateTweenParticleLookupChapters(e,o){e.patchState(re.jM(e.getState(),i=>{i.tweenParticleLookup=Ia.updateChapterIds(i.tweenParticleLookup,o.chapterMap)}))}constructor(){}},Cs=Ts,Ts.\u0275fac=function(e){return new(e||Ts)},Ts.\u0275prov=t.jDH({token:Ts,factory:Ts.\u0275fac}),Ts);var Te;$t([(0,c.rc)(Ue.ApplyPatch),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.ApplyPatch]),fe("design:returntype",void 0)],St.prototype,"applyPatch",null),$t([(0,c.rc)(Ue.SetParticleState),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SetParticleState]),fe("design:returntype",void 0)],St.prototype,"setParticleState",null),$t([(0,c.rc)(Ue.SetParticleSystemsVisible),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SetParticleSystemsVisible]),fe("design:returntype",void 0)],St.prototype,"setParticlesVisible",null),$t([(0,c.rc)(Ue.SetParticleSystemVisible),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SetParticleSystemVisible]),fe("design:returntype",void 0)],St.prototype,"setParticleVisible",null),$t([(0,c.rc)(Ue.NewParticleSystem),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.NewParticleSystem]),fe("design:returntype",void 0)],St.prototype,"newParticleSystem",null),$t([(0,c.rc)(Ue.DuplicateParticleSystem),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.DuplicateParticleSystem]),fe("design:returntype",void 0)],St.prototype,"duplicateParticleSystem",null),$t([(0,c.rc)(Ue.UpdateParticleSystem),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.UpdateParticleSystem]),fe("design:returntype",void 0)],St.prototype,"updateParticleSystem",null),$t([(0,c.rc)(Ue.DeleteChapterLookup),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.DeleteChapterLookup]),fe("design:returntype",void 0)],St.prototype,"deleteChapterLookup",null),$t([(0,c.rc)(Ue.SetLookupForChapter),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SetLookupForChapter]),fe("design:returntype",void 0)],St.prototype,"setLookupForChapter",null),$t([(0,c.rc)(Ue.AssignParticle),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.AssignParticle]),fe("design:returntype",void 0)],St.prototype,"assignParticle",null),$t([(0,c.rc)(Ue.UnassignParticle),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.UnassignParticle]),fe("design:returntype",void 0)],St.prototype,"unassignParticle",null),$t([(0,c.rc)(Ue.DeleteParticleSystem),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.DeleteParticleSystem]),fe("design:returntype",void 0)],St.prototype,"deleteParticleSystem",null),$t([(0,c.rc)(Ue.SelectParticleSystem),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SelectParticleSystem]),fe("design:returntype",void 0)],St.prototype,"selectParticleSystem",null),$t([(0,c.rc)(Ue.SelectParticleConstraint),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SelectParticleConstraint]),fe("design:returntype",void 0)],St.prototype,"selectParticleConstraint",null),$t([(0,c.rc)(Ue.SelectParticleCreator),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SelectParticleCreator]),fe("design:returntype",void 0)],St.prototype,"selectParticleCreator",null),$t([(0,c.rc)(Ue.SelectParticleUpdater),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.SelectParticleUpdater]),fe("design:returntype",void 0)],St.prototype,"selectParticleUpdater",null),$t([(0,c.rc)(Ue.UpdateTweenParticleLookupChapters),fe("design:type",Function),fe("design:paramtypes",[Object,Ue.UpdateTweenParticleLookupChapters]),fe("design:returntype",void 0)],St.prototype,"updateTweenParticleLookupChapters",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getTweenParticleLookup",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getParticleSystems",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getVisisbleParticleSystems",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getParticleSystemsList",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getAssignedParticleSystems",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleSystemId",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleSystem",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleConstraintIndex",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleConstraint",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleCreatorIndex",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleCreator",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleUpdaterIndex",null),$t([(0,c.MD)(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",void 0)],St,"getSelectedParticleUpdater",null),St=Cs=$t([(0,c.Uw)({name:"engineParticles",defaults:{particleSelection:{},particleSystems:{},visibleParticleSystems:{},assignedParticles:{},tweenParticleLookup:{}}}),fe("design:paramtypes",[])],St),function(n){n.SetQuizState=(()=>{class R{constructor(te){this.quizState=te}}return R.type="[Quiz] Set Quiz State",R})(),n.ResetQuizState=(()=>{class R{constructor(){}}return R.type="[Quiz] Reset Quiz State",R})(),n.SetQuizSettings=(()=>{class R{constructor(te){this.quizSettings=te}}return R.type="[Quiz] Set Quiz Settings",R})(),n.SetQuizActive=(()=>{class R{constructor(te){this.active=te}}return R.type="[Quiz] Set Quiz Active",R})(),n.SetQuizLocked=(()=>{class R{constructor(te){this.locked=te}}return R.type="[Quiz] Set Quiz Locked",R})(),n.SetEnableQuizRetake=(()=>{class R{constructor(te){this.enable=te}}return R.type="[Quiz] Set Enable Quiz Retake",R})(),n.SetQuizQuestionsMode=(()=>{class R{constructor(te){this.mode=te}}return R.type="[Quiz] Set Quiz Questions Mode",R})(),n.ReorderQuestions=(()=>{class R{constructor(te){this.chapterIds=te}}return R.type="[Quiz] Reoder Quiz Questions",R})(),n.AddQuestion=(()=>{class R{constructor(te){this.question=te}}return R.type="[Quiz] Add Quiz Question",R})(),n.SetQuestions=(()=>{class R{constructor(te){this.questions=te}}return R.type="[Quiz] Set Quiz Questions",R})(),n.RemoveQuestions=(()=>{class R{constructor(te){this.questionIds=te}}return R.type="[Quiz] Remove Quiz Questions",R})(),n.SetQuestion=(()=>{class R{constructor(te){this.question=te}}return R.type="[Quiz] Set Quiz Question",R})(),n.SubmitQuestionAnswer=(()=>{class R{constructor(te){this.submission=te}}return R.type="[Quiz] Submit Question Answer",R})(),n.NextQuestion=(()=>{class R{constructor(){}}return R.type="[Quiz] Advance Question",R})(),n.PreviousQuestion=(()=>{class R{constructor(){}}return R.type="[Quiz] Previous Question",R})(),n.ClearSubmissions=(()=>{class R{constructor(){}}return R.type="[Quiz] Clear Submissions",R})(),n.SetActiveQuestion=(()=>{class R{constructor(te){this.questionId=te}}return R.type="[Quiz] Set Active Question",R})(),n.SetQuizPickMode=(()=>{class R{constructor(te){this.pickMode=te}}return R.type="[Quiz] Set Pick Mode",R})(),n.SetActiveSubmission=(()=>{class R{constructor(te){this.submission=te}}return R.type="[Quiz] Set Active QuestionAnswer",R})(),n.SetQuizLifecycle=(()=>{class R{constructor(te){this.lifecycle=te}}return R.type="[Quiz] Set Quiz Lifecycle",R})()}(Te||(Te={}));var ot=function(n){return n.MultipleChoice="multiple-choice",n.SelectAnatomy="select-anatomy",n.LabelAnatomy="label-anatomy",n.Instructions="text-only",n}(ot||{});const Yw={[ot.MultipleChoice]:"Multiple Choice",[ot.SelectAnatomy]:"Select Anatomy in 3D",[ot.LabelAnatomy]:"Label Anatomy",[ot.Instructions]:"Instructions"};var Fn=function(n){return n.Markdown="markdown",n.Images="images",n.Ticker="ticker",n.Videos="videos",n.Positions="positions",n}(Fn||{});function Ry(n){const e=n.map(o=>(o.quizQuestions||[]).map(s=>({...s,chapterId:s.chapterId||o.id})));return[].concat(...e)}function Kw(n,e,o){return n===ot.LabelAnatomy?function Jw(n,e){return{...n,options:n.options.map(o=>({...o,label:{...o.label,chapterId:e}}))}}(e,o):(0,m.cloneDeep)(e)}function Dy(n){return"string"==typeof n.data.correctAnswer?[n.data.correctAnswer]:n.data.correctAnswer}function Tr(n,e){const o=Dy(n);switch(n.type){case ot.LabelAnatomy:return(0,m.isEqual)(o,e);case ot.MultipleChoice:return(0,m.isEqual)(o.sort(),e.sort());case ot.SelectAnatomy:if(void 0===n.data.selectType||"all"===n.data.selectType)return(0,m.isEqual)(o.sort(),e.sort());if("any"===n.data.selectType)return 0===(0,m.difference)(e,o).length&&e.length>0}}function Ly(n,e){const o=n.filter(u=>u.type!==ot.Instructions),i=n.reduce((u,g)=>(u[g.id]=function Zw(n,e){const o=n.find(i=>i.questionId===e);return o?o.answer:void 0}(e,g.id),u),{}),s=n.reduce((u,g)=>(u[g.id]=Dy(g),u),{}),r=o.filter(u=>{const g=i[u.id];return Tr(u,typeof g>"u"?[]:"string"==typeof g?[g]:g)}),a=n.length,l=o.length,_=r.length,d=a-_;return{score:a>0?Math.round(_/l*100):0,total:a,scorableTotal:l,correctTotal:_,incorrectTotal:d,questionAnswers:i,correctQuestionAnswers:s}}var Os,Nd,_o=function(n){return n[n.Question=0]="Question",n[n.Explanation=1]="Explanation",n[n.Review=2]="Review",n}(_o||{}),gt=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Q=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)},$g=function(n){return n[n.Learning=0]="Learning",n[n.Assessment=1]="Assessment",n}($g||{});const Fg={quizModeActive:!1,quizModeLocked:!1,quizQuestionsMode:"all",enableQuizRetake:!0,launchMode:$g.Learning,questions:[],activeQuestionId:void 0,activeSubmission:void 0,questionSubmissions:[],quizSettings:{enabled:!0,showSummary:!0,showExplanation:!0,showSubmit:!0,showProgress:!0},pickMode:"single",lifecycle:_o.Question};function Vy(n,e){return n.filter(o=>o.chapterId===e)}function Bg(n,e){const o=e.map(s=>Vy(n,s));return[].concat(...o)}function zg(n){const e=function nM(n){return[...new Set(n.map(e=>e.chapterId))]}(n);return Bg(n,e)}let G=(Nd=Os=class{static getQuizQuestionsByChapter(e){return(0,c.Mz)([Nd],o=>Vy(o.questions,e))}static getLifecycle(e){return e.lifecycle}static getQuizSettings(e){return e.quizSettings}static getQuizModeActive(e){return e.quizModeActive}static getQuizModeLocked(e){return e.quizModeLocked}static getEnableQuizRetake(e){return e.enableQuizRetake}static getQuizReviewEnabled(e){const{quizModeLocked:o,quizQuestionsMode:i,questions:s,quizSettings:r}=e;return!(o&&!r.showSummary||o&&"restricted"===i&&1===s.length)}static globalSceneConfig(e){return e.sceneConfig}static hasQuiz(e){return e.questions.length>0}static getQuizEnabled(e){return!1!==e.quizSettings.enabled}static getAllQuestions(e){return e.questions}static getAllSubmissions(e){return e.questionSubmissions}static getActiveSubmitted(e){const{questionSubmissions:o,activeQuestionId:i}=e;return o.find(s=>s.questionId===i)}static getActiveSubmission(e){return e.activeSubmission}static getActiveQuestion(e){return e.questions.find(o=>o.id===e.activeQuestionId)}static getActiveQuestionId(e){return e.activeQuestionId}static getActiveQuestionLabels(e){const o=e.questions.find(i=>i.id===e.activeQuestionId);return o&&o.type===ot.LabelAnatomy?o.data.options:[]}static getActiveQuestionIndex(e){return e.questions.findIndex(o=>o.id===e.activeQuestionId)}static getQuestionIndex(e,o){return(0,c.Mz)([Nd],i=>Bg(i.questions,e).findIndex(s=>s.id===o))}static getQuestionTotal(e){return e.questions.length}static getCorrectAnswerTotal(e){const{questionSubmissions:o,questions:i}=e;return o.filter(r=>Tr(i.find(l=>l.id===r.questionId),r.answer)).length}static getQuestionsRemaining(e){const{questions:o,questionSubmissions:i}=e;return o.length-i.length}static hasQuestionRemaining(e){const{questions:o,questionSubmissions:i}=e;return i.length<o.length}static getPickMode(e){return e.pickMode}resetQuizState(e,o){e.setState({...Fg})}setQuizState(e,{quizState:o}){e.setState({...Fg,...o})}setQuizSettings(e,{quizSettings:o}){e.patchState({quizSettings:o})}setQuizActive(e,o){e.patchState({quizModeActive:o.active,activeQuestionId:!1===o.active?void 0:e.getState().activeQuestionId})}setQuizLocked(e,o){e.patchState({quizModeLocked:o.locked})}setEnableQuizRetake(e,o){e.patchState({enableQuizRetake:o.enable})}setQuizQuestionsMode(e,o){e.patchState({quizQuestionsMode:o.mode})}reorderQuestions(e,{chapterIds:o}){e.patchState({questions:Bg(e.getState().questions,o)})}addQuestion(e,o){const i=[...e.getState().questions,o.question];e.patchState({questions:zg(i)})}setQuestions(e,{questions:o}){e.patchState({questions:zg(o)})}setQuestion(e,o){const i=e.getState().questions.map(s=>s.id===o.question.id?o.question:s);e.patchState({questions:i})}removeQuestions(e,o){const i=e.getState(),s=null!=o.questionIds?o.questionIds:i.questions.map(a=>a.id),r=i.questions.filter(a=>!s.includes(a.id));e.patchState({questions:zg(r)})}submitQuestionAnswer(e,o){const i=[...e.getState().questionSubmissions],s=i.findIndex(a=>a.questionId===o.submission.questionId);s>-1?i[s]=o.submission:i.push(o.submission),e.patchState({questionSubmissions:i})}nextQuestion(e){const{questions:o,activeQuestionId:i}=e.getState(),s=e.getState().questions.findIndex(a=>a.id===i),r=o[s+1]?.id||void 0;void 0!==r&&e.patchState({activeQuestionId:r})}previousQuestion(e){const{questions:o,activeQuestionId:i}=e.getState(),s=e.getState().questions.findIndex(a=>a.id===i),r=o[s-1]?.id||void 0;void 0!==r&&e.patchState({activeQuestionId:r})}clearSubmissions(e){e.patchState({questionSubmissions:[]})}setActiveQuestion(e,o){e.patchState({activeQuestionId:o.questionId})}setQuizPickMode(e,{pickMode:o}){e.patchState({pickMode:o})}setActiveSubmission(e,{submission:o}){e.patchState({activeSubmission:o})}setQuizLifecycle(e,o){e.patchState({lifecycle:o.lifecycle})}},Os.\u0275fac=function(e){return new(e||Os)},Os.\u0275prov=t.jDH({token:Os,factory:Os.\u0275fac}),Os);gt([(0,c.rc)(Te.ResetQuizState),Q("design:type",Function),Q("design:paramtypes",[Object,Te.ResetQuizState]),Q("design:returntype",void 0)],G.prototype,"resetQuizState",null),gt([(0,c.rc)(Te.SetQuizState),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizState]),Q("design:returntype",void 0)],G.prototype,"setQuizState",null),gt([(0,c.rc)(Te.SetQuizSettings),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizSettings]),Q("design:returntype",void 0)],G.prototype,"setQuizSettings",null),gt([(0,c.rc)(Te.SetQuizActive),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizActive]),Q("design:returntype",void 0)],G.prototype,"setQuizActive",null),gt([(0,c.rc)(Te.SetQuizLocked),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizLocked]),Q("design:returntype",void 0)],G.prototype,"setQuizLocked",null),gt([(0,c.rc)(Te.SetEnableQuizRetake),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetEnableQuizRetake]),Q("design:returntype",void 0)],G.prototype,"setEnableQuizRetake",null),gt([(0,c.rc)(Te.SetQuizQuestionsMode),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizQuestionsMode]),Q("design:returntype",void 0)],G.prototype,"setQuizQuestionsMode",null),gt([(0,c.rc)(Te.ReorderQuestions),Q("design:type",Function),Q("design:paramtypes",[Object,Te.ReorderQuestions]),Q("design:returntype",void 0)],G.prototype,"reorderQuestions",null),gt([(0,c.rc)(Te.AddQuestion),Q("design:type",Function),Q("design:paramtypes",[Object,Te.AddQuestion]),Q("design:returntype",void 0)],G.prototype,"addQuestion",null),gt([(0,c.rc)(Te.SetQuestions),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuestions]),Q("design:returntype",void 0)],G.prototype,"setQuestions",null),gt([(0,c.rc)(Te.SetQuestion),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuestion]),Q("design:returntype",void 0)],G.prototype,"setQuestion",null),gt([(0,c.rc)(Te.RemoveQuestions),Q("design:type",Function),Q("design:paramtypes",[Object,Te.RemoveQuestions]),Q("design:returntype",void 0)],G.prototype,"removeQuestions",null),gt([(0,c.rc)(Te.SubmitQuestionAnswer),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SubmitQuestionAnswer]),Q("design:returntype",void 0)],G.prototype,"submitQuestionAnswer",null),gt([(0,c.rc)(Te.NextQuestion),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G.prototype,"nextQuestion",null),gt([(0,c.rc)(Te.PreviousQuestion),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G.prototype,"previousQuestion",null),gt([(0,c.rc)(Te.ClearSubmissions),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G.prototype,"clearSubmissions",null),gt([(0,c.rc)(Te.SetActiveQuestion),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetActiveQuestion]),Q("design:returntype",void 0)],G.prototype,"setActiveQuestion",null),gt([(0,c.rc)(Te.SetQuizPickMode),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizPickMode]),Q("design:returntype",void 0)],G.prototype,"setQuizPickMode",null),gt([(0,c.rc)(Te.SetActiveSubmission),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetActiveSubmission]),Q("design:returntype",void 0)],G.prototype,"setActiveSubmission",null),gt([(0,c.rc)(Te.SetQuizLifecycle),Q("design:type",Function),Q("design:paramtypes",[Object,Te.SetQuizLifecycle]),Q("design:returntype",void 0)],G.prototype,"setQuizLifecycle",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getLifecycle",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Object)],G,"getQuizSettings",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getQuizModeActive",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getQuizModeLocked",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getEnableQuizRetake",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Boolean)],G,"getQuizReviewEnabled",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"globalSceneConfig",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"hasQuiz",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getQuizEnabled",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getAllQuestions",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getAllSubmissions",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getActiveSubmitted",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getActiveSubmission",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getActiveQuestion",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getActiveQuestionId",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Array)],G,"getActiveQuestionLabels",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getActiveQuestionIndex",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getQuestionTotal",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getCorrectAnswerTotal",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getQuestionsRemaining",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"hasQuestionRemaining",null),gt([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],G,"getPickMode",null),G=Nd=gt([(0,c.Uw)({name:"quiz",defaults:Fg})],G);const Aa={colors:[245,245,245,1,245,245,245,1],gradientType:"radial",colorStops:[0,100]};var Gi=function(n){return n.JPEG="image/jpeg",n.PNG="image/png",n}(Gi||{});let Rd=(()=>{class e{constructor(i){this.thumbnails=i}}return e.type="[Story Chapters] Register thumbnail URLs from story",e})(),Wg=(()=>{class e{constructor(i,s){this.chapterId=i,this.thumbnail=s}}return e.type="[Story Chapters] Set chapter thumbnail",e})(),Cr=(()=>{class e{constructor(i,s=Aa,r=Gi.JPEG,a=.92,l,_="original",d,p,u=[]){this.chapterId=i,this.background=s,this.imageType=r,this.imageQuality=a,this.dimensions=l,this.crop=_,this.includeLabels=d,this.includeCopyright=p,this.layers=u}}return e.type="[Story Chapters] Take picture",e})(),Pa=(()=>{class e{constructor(i,s,r){this.chapterId=i,this.blob=s,this.dimensions=r}}return e.type="[Story Chapters] Take picture success",e})();const xl=`https://www.biodigital.com?utm_source=${he.native?"human_mobile":"human_web"}&utm_medium=PLG&utm_campaign=poweredby&ref=poweredby`,Xg={default:"./assets/images/powered-by-biodigital-color.svg",human_app:{default:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:xl}},viewer:{viewer_logo_setting:null,full_dark:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:xl},full_light:{logo_url:"./assets/images/powered-by-biodigital-white.svg",logo_linkout_url:xl},square_dark:{logo_url:"./assets/images/logo-color.svg",logo_linkout_url:xl},square_light:{logo_url:"./assets/images/logo-white.svg",logo_linkout_url:xl}}};function Hg(n,e,o){const{full_dark:i,full_light:s,square_dark:r,square_light:a}=n.viewer;switch(e){case"full":return"color"===o?i:s;case"small":return"color"===o?r:a}}var ts;function kd(n){if(!n||!n.colors)return!1;const e=n.colors,o=e[3];return e.length<=4?0===o:0===o&&0===e[7]}function Qg(n){const e=n?.colors;if(Array.isArray(e)){const o=e.slice(0,3);return ts.isLight(o)}return!1}!function(n){const o=/(\s*[\d\.]+\s*,){2,15}\s*[\d\.]+\s*/g;function s(k){for(let A=0;A<3;A++)if(parseFloat(`${k[A]}`)>1)return!0;return!1}function a(k){const A=document.createElement("div");A.style.backgroundColor=k,document.documentElement.appendChild(A);const R=window.getComputedStyle(A).backgroundColor.replace(/\s/g,"");return window.document.documentElement.removeChild(A),R}function l(k){const A=k.slice(0,4);3===A.length&&A.push(1);for(let R=0;R<4;R++)A[R]=parseFloat(`${A[R]}`),A[R]<0&&(A[R]=0),A[R]>255&&(A[R]=255);return A[3]>1&&(A[3]=1),A}function _(k){let A;if(Array.isArray(k))A=l(k);else if("string"==typeof k){let R=k.match(o);R?A=l(R[0].split(",")):(R=a(k).match(o),R&&(A=l(R[0].split(","))))}return A}function d(k){const A=_(k);if(!A)throw new TypeError("Invalid color input.");const R=u(A);return{1:s(A)?R:A,255:s(A)?A:R}}function u(k){const A=s(k),R=[];for(let Z=0;Z<3;Z++){let te=A?k[Z]/255:255*k[Z];te=A?Math.round(100*te)/100:Math.round(te),R.push(te)}return 4===k.length&&R.push(k[3]),R}function g(k,A=!1){k=k.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(st,We,ln,Ie)=>[We,We,ln,ln,Ie,Ie].join("")).replace(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,(st,We,ln,Ie)=>[We,ln,Ie,"ff"].join(""));const R=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(k),Z=parseInt(R[1],16),te=parseInt(R[2],16),se=parseInt(R[3],16),ge=parseInt(R[4],16)/255;if(A){const st=$([Z,te,se]);return[st[0],st[1],st[2],ge]}return[Z,te,se,ge]}function O(k){const[A,R,Z]=k;return Math.sqrt(A*A*.299+R*R*.587+Z*Z*.114)}function $(k){return k.map(R=>R/255)}function q(k){return k.map(R=>Math.round(255*R))}function x(k){return`#${k.map(R=>{const Z=R.toString(16);return Z.length%2?`0${Z}`:Z}).join("")}`}n.is255=s,n.isLight=function r(k,A){return A||(A=[...k]),(O(k)+O(A))/2>140.25},n.getComputedColor=a,n.convertChannels=l,n.convert=_,n.getColor=d,n.getColors=function p(k){let A=[];if("string"==typeof k){const R=k.match(o);R&&(k=R.join(",")),k=k.split(",")}if(Array.isArray(k))if(Array.isArray(k[0])&&Array.isArray(k[1]))A=k;else if(k.length<=2)A=1===k.length?k.concat(k):k;else{const Z=Math.floor(k.length/2);A=k.length>4?[k.slice(0,Z),k.slice(Z)]:[k,k]}return A.map(R=>d(R))},n.scaleColor=u,n.hexToRgba=g,n.hexToRgb=function y(k,A=!1){const R=g(k,A);return[R[0],R[1],R[2]]},n.rgbToHex=function C(k,A=!1){return x(A?q(k):k)},n.rgbToHSP=O,n.rgbaToHex=function L(k,A=!1){const R=k[0],Z=k[1],te=k[2],se=255*k[3];return x(A?[...q([R,Z,te]),se]:[R,Z,te,se])},n.rgbToDecimal=$,n.rgbFromDecimal=q}(ts||(ts={}));const xy={imageType:Gi.JPEG,crop:"original",copyrightEnabled:!1,copyrightImagePath:Xg.viewer.full_dark.logo_url,copyrightPosition:{x:"left",y:"bottom"},copyrightOffset:{x:12,y:-12},imageQuality:1},Yg={small:{width:256,height:256},medium:{width:512,height:512},large:{width:1024,height:1024}};var Gy;class lM{constructor(){this[Gy]=!0}}Gy=re.lE;class Na extends lM{}var Ri,Ra=S(1472),Qe=S(5877),cM=S(5892),_M=S(5533),pi=S(8577),Dd=S(7678),dM=S(7092);!function(n){function l(){return(l=(0,J.A)(function*(p,u,g,y=!1){return _(p,yield u.parse(g),y)})).apply(this,arguments)}function _(p,u,g=!1){const y=p.createElement("div");return p.setProperty(y,"innerHTML",u),g&&y.querySelectorAll("p").forEach(O=>{p.setProperty(O,"textContent",O.textContent+" ")}),(0,m.trim)(y.textContent)}n.normalize=function e(p){return`${p||""}`.replace(/&#(\d+);/g,(g,y)=>String.fromCharCode(y)).replace(/(&.+;)/gi,(g,y)=>String.fromCharCode(g.charCodeAt(0)))},n.prettyPrint=function o(p){return`${p||""}`.trim().replace(/([A-Z])/g," $1").replace(/^./,g=>g.toUpperCase()).trim()},n.parseEmails=function i(p){return p.split(/[,\r\n]/).map(u=>u.trim()).filter(u=>!!u)},n.validateEmail=function s(p){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(p)},n.toTitleCase=function r(p){return p.replace(/\w\S*/g,u=>u.charAt(0).toUpperCase()+u.substring(1).toLowerCase())},n.getPlainTextFromMarkdown=function a(p,u,g){return l.apply(this,arguments)},n.getPlainTextFromHTML=_,n.splitTextByCharacterCount=function d(p,u){for(var g=[];p.length>u;){var y=p.substring(0,u).lastIndexOf(" ");g.push(p.substring(0,y=y<=0?u:y));var C=p.indexOf(" ",y)+1;(C<y||C>y+u)&&(C=y),p=p.substring(C)}return g.push(p),g}}(Ri||(Ri={}));var po,pM=S(7662);!function(n){function r(){return(r=(0,J.A)(function*(u,g=!1){return(0,pM.mo)(u,{pixelRatio:1,skipFonts:!0,...g?{backgroundColor:"transparent"}:{}})})).apply(this,arguments)}n.exportImage=function e(u,g,y,C){const O="string"==typeof u?n.base64ToBlob(u,g):u;return C?(0,dM.r)(O,C).then(function(L){(0,Dd.saveAs)(L,y)}):(0,Dd.saveAs)(O,y),(0,Qe.of)(!0)},n.canvasToBlob=function o(u,g,y){return new f.c(C=>{u.toBlob(O=>{C.next(O),C.complete()},g,y)})},n.fitCanvas=function i(u,g,y){const C=document.createElement("canvas");C.width=g,C.height=y;const O=C.getContext("2d"),x=Math.max(.5*(u.width-C.width/C.height*u.height),0);return O.drawImage(u,x,0,C.width,C.height),C},n.elementToCanvas=function s(u){return r.apply(this,arguments)},n.combineCanvasElements=function a(u){const g=Math.max(0,...u.map(L=>L.width)),y=Math.max(0,...u.map(L=>L.height)),C=document.createElement("canvas");C.width=g,C.height=y;const O=C.getContext("2d");return u.forEach(L=>{O.drawImage(L,0,0)}),C},n.base64ToBlob=function l(u,g){const y=atob(u.split(",")[1]),C=new ArrayBuffer(y.length),O=new Uint8Array(C);for(let L=0;L<y.length;L++)O[L]=y.charCodeAt(L);return new Blob([C],{type:g})},n.blobToBase64=function _(u){return new f.c(g=>{const y=new FileReader;y.addEventListener("load",()=>{g.next(y.result),g.complete()}),y.readAsDataURL(u)})},n.blobToCanvas=function d(u,g,y){return new f.c(C=>{const O=document.createElement("canvas");O.width=g,O.height=y;const L=O.getContext("2d"),$=new Image,q=URL.createObjectURL(u);$.addEventListener("load",()=>{L.drawImage($,0,0),URL.revokeObjectURL(q),C.next(O),C.complete()}),$.src=q})},n.createModelFileName=function p(u,g,y,C){let O=u||g||"";return u&&g&&u!==g&&(O=`${u}_${g}`),`${Ri.normalize(O).replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}${C?`_${C}`:""}.${y.replace(".","")}`}}(po||(po={}));let qg=(()=>{var n;class e{constructor(i){this.engineService=i}setPostProcessingFeatures(i){const{renderer:s,story:r}=this.engineService.engine;r?.activeChapter&&(r.activeChapter.postProcess.length=0,r.activeChapter.postProcess.push(...i)),s.setPostProcessingPipeline(i)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Ld=S(5133);const uM={stats:{textures:{baseColor:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},alpha:{"1024x1024":1,memory:1e6,"512x512":1},normals:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},emit:{"1024x1024":1,memory:1e6,"512x512":1,"256x256":1},roughness:{"512x512":1,memory:1e6,"1024x1024":1}}}},$y=Ld.create(),Gl=Ld.create();let ws=(()=>{var n;class e{get canvas(){if(!this.engineService.engine)throw new Error("Engine not defined, cannot use canvas");return this.engineService.engine.renderer.canvas}constructor(i){this.engineService=i}forceRenderFrame(){this.engineService.engine.renderer.render()}getCanvas(){return this.canvas}getScene(){return uM}getViewMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.worldMatrixInverse)}getProjMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.projectionMatrix)}pick(i,s,r=!0){const a=this.engineService.engine,l=a.story?.anatomySceneGraph,_=a.rayCastCamera(i,s,{filter:d=>l?.findAnatomyObject(d)?.pickable});if(_){const d=this.generateHitModel(l,i,s,_,r);return this.engineService.fireEvent(pe.PickPicked,d),d}return{canvasPos:{x:i,y:s}}}setTransparencyMode(i){this.engineService.engine.renderer.transparencyMode=i}scaleAndNormalizeMatrix(i){return Ld.copy(Gl,i),Gl[12]*=ee.BIODIGITAL_SCENE_SCALE,Gl[13]*=ee.BIODIGITAL_SCENE_SCALE,Gl[14]*=ee.BIODIGITAL_SCENE_SCALE,Gl}generateHitModel(i,s,r,a,l){const{triIndex:_,intersection:d,object:p}=a,u=i.findAnatomyObject(p),{objectId:g,renderables:y}=u,C=y.findIndex(q=>q.meshNode===p),O=y[C]?.meshNode,$={canvasPos:{x:s,y:r},objectId:g,renderableIndex:C,triIndex:_};if(l){const q=this.getBarycentricCoordinate(O,d,_),x=this.getTriangleNormal(O,_);return Ee.scale(d,d,1/ee.BIODIGITAL_SCENE_SCALE),{...$,barycentric:q,worldPos:d,normal:x}}return $}getBarycentricCoordinate(i,s,r){const a=Ee.create(),l=ee.vec3Pool.get(),_=ee.vec3Pool.get(),d=ee.vec3Pool.get(),p=ee.vec3Pool.get();return Ld.invert($y,i.worldMatrix),Ee.transformMat4(l,s,$y),(0,ee.getTrianglePositions)(i,r,_,d,p),(0,ee.barycentricCoord)(a,l,_,d,p),Ee.transformMat4(_,_,i.worldMatrix),Ee.transformMat4(d,d,i.worldMatrix),Ee.transformMat4(p,p,i.worldMatrix),ee.vec3Pool.release(l),ee.vec3Pool.release(_),ee.vec3Pool.release(d),ee.vec3Pool.release(p),a}getTriangleNormal(i,s){const r=Ee.create(),a=ee.vec3Pool.get(),l=ee.vec3Pool.get(),_=ee.vec3Pool.get();return(0,ee.getTrianglePositions)(i,s,a,l,_),Ee.transformMat4(a,a,i.worldMatrix),Ee.transformMat4(l,l,i.worldMatrix),Ee.transformMat4(_,_,i.worldMatrix),(0,ee.triangleNormal)(r,a,l,_),ee.vec3Pool.release(a),ee.vec3Pool.release(l),ee.vec3Pool.release(_),r}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Kg=(()=>{var n;class e{constructor(i,s,r,a,l){this.labelsService=i,this.postProcessingService=s,this.engineRendererService=r,this.cameraService=a,this.store=l}localResize(i,s){const r=this.engineRendererService.getCanvas(),a=r.parentNode,l=a.clientWidth,_=a.clientHeight;return r.width=i,r.height=s,a.style.width=`${i}px`,a.style.height=`${s}px`,[l,_]}canvasToImage(i,s="original",r){var a=this;return(0,J.A)(function*(){const{width:l,height:_}=i,d=i.getContext("2d"),p=a.labelsService.getLabelContainer().nativeElement,u=i.width/i.height,g=a.engineRendererService.getCanvas();let{width:y,height:C}=g,O=.5*(g.width-y),L=0;switch(s){case"square":C>y?C=y:y=C,O=.5*(g.width-y),L=.5*(g.height-C);break;case"original":y=u*C}return a.engineRendererService.forceRenderFrame(),d.drawImage(g,O,L,y,C,0,0,l,_),r&&p?new Promise(requestAnimationFrame).then((0,J.A)(function*(){const $=yield po.elementToCanvas(p,!0);return d.drawImage($,O,L,y,C,0,0,l,_),i})):i})()}canvasToImageWithResize(i,s){var r=this;return(0,J.A)(function*(){const{width:a,height:l}=i,_=r.engineRendererService.getCanvas(),d=i.getContext("2d"),p=r.labelsService.getLabelContainer().nativeElement,[u,g]=r.localResize(a,l);return r.engineRendererService.forceRenderFrame(),d.drawImage(_,0,0,a,l),s&&p?new Promise(requestAnimationFrame).then((0,J.A)(function*(){const y=yield po.elementToCanvas(p,!0);return d.drawImage(y,0,0,a,l),r.localResize(u,g),i})):(r.localResize(u,g),i)})()}drawRadialGradient(i,s){const r=s.colors,[l,_]=s.colorStops.map(y=>((y,C,O)=>{const[L,$]=[Math.pow(C/2,2),Math.pow(O/2,2)];return y/100*Math.pow(L+$,.5)})(y,i.width,i.height)),d=i.getContext("2d"),[p,u]=[i.width/2,i.height/2],g=d.createRadialGradient(p,u,l,p,u,_);g.addColorStop(s.colorStops[0]/100,`rgba(${r.slice(0,4).join(",")})`),g.addColorStop(s.colorStops[1]/100,`rgba(${r.slice(4,8).join(",")})`),d.fillStyle=g,d.fillRect(0,0,i.width,i.height)}drawLinearGradient(i,s){const r=s.colors,a=i.getContext("2d"),[l,_]=[i.width/2,i.height/2],d=a.createLinearGradient(l,_,l,i.height);d.addColorStop(s.colorStops[0]/100,`rgba(${r.slice(0,4).join(",")})`),d.addColorStop(s.colorStops[1]/100,`rgba(${r.slice(4,8).join(",")})`),a.fillStyle=d,a.fillRect(0,0,i.width,i.height)}takeSnapshot(i,s,r,a,l,_,d=1){const{imageType:p,imageQuality:u,copyrightEnabled:g,crop:y}=_,C=document.createElement("canvas");C.width=i,C.height=s,"radial"===r.gradientType?this.drawRadialGradient(C,r):"linear"===r.gradientType&&this.drawLinearGradient(C,r);const O=this.engineRendererService.getCanvas(),$=[],q=1!==d||C.height>O.height||C.width>O.width?this.canvasToImageWithResize(C,l):this.canvasToImage(C,y,l),x=(0,Ra.H)(q);$.push(x);const k=[...a];return $.push(...k.map(A=>(A instanceof HTMLCanvasElement?(0,Qe.of)(A):(0,Ra.H)(po.elementToCanvas(A,!0))).pipe((0,F.T)(Z=>po.fitCanvas(Z,i,s))))),this.engineRendererService.forceRenderFrame(),(0,cM.x)($).pipe((0,_M.p)(),(0,F.T)(A=>po.combineCanvasElements(A)),(0,At.Z)(A=>g?this.writeLogoToCanvas(A,_):(0,Qe.of)(A)),(0,At.Z)(A=>po.canvasToBlob(A,p,u)))}writeLogoToCanvas(i,s){return this.getLogoImage(s.copyrightImagePath).pipe((0,F.T)(r=>{let{width:a,height:l}=r;const{width:_,height:d}=i;if(.1*_>a){const y=l/a;a=.1*_,l=y*a}const{xOffset:p,yOffset:u}=this.getLogoPosition(_,d,a,l,s);return i.getContext("2d").drawImage(r,p,u,a,l),i}),(0,pi.W)(()=>(0,Qe.of)(i)))}getLogoImage(i){return new f.c(s=>{const r=new Image;r.onload=()=>{s.next(r),s.complete()},r.onerror=()=>s.error(),r.src=i})}getLogoPosition(i,s,r,a,l){const{copyrightPosition:_,copyrightOffset:d}=l;let p,u;switch(_.x){case"right":p=i-r;break;case"center":p=i/2-r/2;break;default:p=0}switch(_.y){case"bottom":u=s-a;break;case"center":u=s/2-a/2;break;default:u=0}return{xOffset:p+d.x,yOffset:u+d.y}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(fr),t.KVO(qg),t.KVO(ws),t.KVO(Pi),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class Fy{}let Ud=(()=>{class e{constructor(i){this.logoConfig=i}}return e.type="[AppConfig] Set View Logos",e})(),By=(()=>{class e{constructor(i){this.logoConfig=i}}return e.type="[AppConfig] Set Header Logos",e})(),zy=(()=>{class e{constructor(){}}return e.type="[AppConfig] Reset",e})();var Or,ka=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},wi=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const Wy={viewLogoConfig:Xg,headerLogoConfig:Xg};let uo=((Or=class{static getViewLogoConfig(e){return e.viewLogoConfig}static getHeaderLogoConfig(e){return e.headerLogoConfig}setLogos(e,{logoConfig:o}){e.patchState({viewLogoConfig:o})}setAppHeaderLogos(e,{logoConfig:o}){e.patchState({headerLogoConfig:o})}resetAppConfig(e){e.setState({...Wy})}}).\u0275fac=function(e){return new(e||Or)},Or.\u0275prov=t.jDH({token:Or,factory:Or.\u0275fac}),Or);ka([(0,c.rc)(Ud),wi("design:type",Function),wi("design:paramtypes",[Object,Ud]),wi("design:returntype",void 0)],uo.prototype,"setLogos",null),ka([(0,c.rc)(By),wi("design:type",Function),wi("design:paramtypes",[Object,Ud]),wi("design:returntype",void 0)],uo.prototype,"setAppHeaderLogos",null),ka([(0,c.rc)(zy),wi("design:type",Function),wi("design:paramtypes",[Object]),wi("design:returntype",void 0)],uo.prototype,"resetAppConfig",null),ka([(0,c.MD)(),wi("design:type",Function),wi("design:paramtypes",[Fy]),wi("design:returntype",void 0)],uo,"getViewLogoConfig",null),ka([(0,c.MD)(),wi("design:type",Function),wi("design:paramtypes",[Fy]),wi("design:returntype",void 0)],uo,"getHeaderLogoConfig",null),uo=ka([(0,c.Uw)({name:"appConfig",defaults:{...Wy}})],uo);var wr,Da=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},yi=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const gM={thumbnails:new Map};let oi=(wr=class{static getRegisteredThumbnails(e){return e.thumbnails}registerChapterThumbnails(e,o){e.patchState(re.jM(e.getState(),i=>{i.thumbnails=new Map(o.thumbnails)}))}setChapterThumbnail(e,o){e.patchState(re.jM(e.getState(),i=>{i.thumbnails.set(o.chapterId,o.thumbnail)}))}takeChapterPicture(e,o){const{background:i,chapterId:s,includeLabels:r,includeCopyright:a,dimensions:l,imageType:_,imageQuality:d,crop:p,layers:u}=o,g=l||Yg.large,{width:y,height:C}=g,O=function aM(n,e){return n===Gi.PNG?e||Aa:e&&!kd(e)?e:Aa}(_,i),L=i.colors.slice(0,3),$=ts.isLight(L),x=Hg(this.store.selectSnapshot(uo.getViewLogoConfig),"full",$?"color":"white"),k={...xy,crop:p,imageType:_,imageQuality:d,copyrightEnabled:a,copyrightImagePath:x.logo_url};this.snapshotService.takeSnapshot(y,C,O,u,r,k).subscribe(A=>{e.dispatch(new Pa(s,A,g))})}takeChapterPictureSuccess(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.thumbnails.get(o.chapterId)||new Na;s.snapshot=URL.createObjectURL(o.blob),i.thumbnails.set(o.chapterId,s)}))}constructor(e,o){this.snapshotService=e,this.store=o}},wr.\u0275fac=function(e){return new(e||wr)(t.KVO(Kg),t.KVO(c.il))},wr.\u0275prov=t.jDH({token:wr,factory:wr.\u0275fac}),wr);Da([(0,c.rc)(Rd),yi("design:type",Function),yi("design:paramtypes",[Object,Rd]),yi("design:returntype",void 0)],oi.prototype,"registerChapterThumbnails",null),Da([(0,c.rc)(Wg),yi("design:type",Function),yi("design:paramtypes",[Object,Wg]),yi("design:returntype",void 0)],oi.prototype,"setChapterThumbnail",null),Da([(0,c.rc)(Cr),yi("design:type",Function),yi("design:paramtypes",[Object,Cr]),yi("design:returntype",void 0)],oi.prototype,"takeChapterPicture",null),Da([(0,c.rc)(Pa),yi("design:type",Function),yi("design:paramtypes",[Object,Pa]),yi("design:returntype",void 0)],oi.prototype,"takeChapterPictureSuccess",null),Da([(0,c.MD)(),yi("design:type",Function),yi("design:paramtypes",[class iM{}]),yi("design:returntype",void 0)],oi,"getRegisteredThumbnails",null),oi=Da([(0,c.Uw)({name:"storyThumbnails",defaults:gM}),yi("design:paramtypes",[Kg,c.il])],oi);let Mr=(()=>{var n;class e{constructor(i,s){this.graphService=i,this.sceneService=s,this.highlightDisabled=!1}colorObject(i,s){const r=this.sceneService.getObjectById(i);if(this.sceneService.isLeaf(r)){const a=r.modifiers;Object.keys(s).forEach(l=>{const _=s[l];if(!1===_)a.delete(l);else if(Array.isArray(_)&&5===_.length){const[d,p,u,g,y]=_;a.set(l,{applyTo:l,fresnel:{center:d,edge:p,centerBias:u,edgeBias:g,power:y}})}else a.set(l,{applyTo:l,value:_})})}}getColor(i){return function hM(n,e){const o=n.getObjectById(e);if(n.isLeaf(o)){const s={};return o.modifiers.forEach(r=>{s[r.applyTo]=r.fresnel??r.value}),s}return null}(this.sceneService,i)}uncolorObject(i){const s=this.sceneService.getObjectById(i);this.sceneService.isLeaf(s)&&s.modifiers.clear()}unpaint(i,s){this.graphService.getLeafDescendants(i,s.id).forEach(r=>{const a=this.sceneService.getObjectById(r);this.sceneService.isLeaf(a)&&a.modifiers.clear()})}paint(i,s,r){const a=yr(r);this.graphService.getLeafDescendants(i,s).forEach(l=>{this.colorObject(l,a)})}highlight(i,s,r){(!1===this.highlightDisabled||!1===r)&&this.graphService.getLeafDescendants(i,s).forEach(a=>{const l=this.sceneService.getObjectById(a);this.sceneService.isLeaf(l)&&(l.selected=r)})}paintAll(i,s,r){s.forEach(a=>this.paint(i,a,r))}unpaintAll(i,s){s.forEach(r=>{this.unpaint(i,r)})}highlightAll(i,s,r){s.forEach(a=>this.highlight(i,a,r))}disableHighlight(){this.highlightDisabled=!0}enableHighlight(){this.highlightDisabled=!1}setHighlightColor(i){}getColorRecipes(){return[]}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(lo),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function Ir(n){return!!("lights"in n&&Array.isArray(n?.lights.libraries)||"environment"in n&&!(0,m.isEmpty)(n?.environment))}function Vd(n){return"lightLibraryId"in n}var La=function(n){return n.JumpTo="jumpTo",n.FlyTo="flyTo",n}(La||{});const Xy=$localize`Starting Position`,fM={play:{count:1}};let Hy=(()=>{var n;class e{constructor(i,s,r){this.store=i,this.labelService=s,this.paintService=r}getMinimumGraphSync(i,s,r){const a=this.paintService.getColorRecipes(),l=Object.keys(ud(a)),_=function Nw(n,e,o){const i={},s={};return hd(n,a=>{s[a]=function cw(n,e){return n.roots.hasOwnProperty(e)||!1}(n,a)?{...gd(n,a,o),...e[a]||{}}:{...s[n.predecessors[a]],...e[a]||{}},Il(n,a)&&(i[a]=s[a])}),i}(i,s,l),d=function mM(n){return n.reduce((e,o)=>(e[o]=Ai.MajorityWins,e),{available:Ai.MajorityWins,shown:Ai.MajorityWins,selected:Ai.MajorityWins,pickable:Ai.MajorityWins})}(a),p=Lw(i,d,_);Object.entries(s).forEach(([g,y])=>{const C=(0,m.omit)(y,l);(0,m.isEmpty)(C)||(p[g]={...p[g]||{},...C})});const u=new sw;return Object.entries(p).forEach(([g,y])=>{u[this.switchNamespace(g,r)]=y},this),u}convertGraphSync(i){const s={},r={},a={},l={},_={};return Object.entries(i).forEach(([d,p])=>{Object.entries(p).forEach(([u,g])=>{"available"===u?s[d]=g:"shown"===u?r[d]=g:"selected"===u?a[d]=g:"pickable"===u?l[d]=!g:_[d]={..._[d]||{},[u]:g}},this)},this),{availableObjects:s,showObjects:r,selectObjects:a,pickThroughObjects:l,synchronization:_}}switchNamespace(i,s){return s[i]||i}serializeHotspots(i,s){let r=[...i.hotspots],a={};return s.filter(_=>_.chapterId===i.id).forEach(_=>{const d=this.labelService.serializeLabel(_,r.length);r=[...r,...d.hotspots],a={...a,...d.data}}),{customData:a,hotspots:r}}calcMinimumPaintState(i,s){function r(a,l=!0){const d=(i.successors[a]||[]).reduce((p,u)=>({...p,...r(u,!(0,m.isEqual)(s[a],s[u]))}),{});return l?{[a]:s[a],...d}:d}return Object.keys(i.roots).reduce((a,l)=>({...a,...r(l)}),{})}serializeVisibilityLayers(i,s){const a={...i};return Array.isArray(i?.layers)&&(a.layers=i.layers.map(l=>({...l,objectIds:l.objectIds.filter(_=>Object.prototype.hasOwnProperty.call(s.nodes,_))})).filter(l=>l.objectIds.length>0)),a}serializeCamera(i){return{[i.action]:{...i.location,title:i.title===Xy?void 0:i.title},cameraRotationCenter:i.rotationCenter}}duplicateTimelineMap(i){return i?i.map(s=>{const r=(0,m.cloneDeep)(s);return delete r.id,r}):[]}duplicateQuizQuestions(i){return this.store.selectSnapshot(G.getQuizQuestionsByChapter(i)).map(s=>{const r=(0,m.cloneDeep)(s);return delete r.chapterId,r})}serializeChapter(i,s,r,a,l){const _=this.serializeHotspots(s,a),d=this.store.selectSnapshot(St.particleSystemsForChapter(s.id)),u={...(0,m.pickBy)(s.customData,(k,A)=>!A.startsWith("errand")),..._.customData,particleSystems:d.map(k=>k.id)},g=l[s.id],y=this.store.selectSnapshot(oi.getRegisteredThumbnails),C=y.get(g)?.urls||y.get(s.id)?.urls||null,O={id:g,createdFrom:s.createdFrom,displayName:s.displayName,description:s.description,...this.serializeCamera(s.camera),background:s.background??{},hotspots:_.hotspots,clippingPlanes:{clips:s.clippingPlanes.clips,boundary:s.clippingPlanes.boundary},ui:(0,m.isEmpty)(s.ui)?fM:s.ui,media:s.media,timelineMap:this.duplicateTimelineMap(s.timelineMap),customData:u,transparencyMode:s.transparencyMode||null,fallbackTransparency:s.fallbackTransparency,properties:s.properties,transitions:s.transitions,legend:s.legend||[],visibilityLayers:this.serializeVisibilityLayers(s.sliderLayers.src,i),contentBlocks:s.contentBlocks||[],thumbnails:{default:"",...C},quizQuestions:this.duplicateQuizQuestions(s.id),synchronization:void 0};if(Vd(s))O.lightLibraryId=s.lightLibraryId;else if(Ir(s)){const k=O;k.lights=s.lights,k.environment=s.environment}const $=this.store.selectSnapshot(Re.getAllNodeState)[s.id],q=Object.entries($).reduce((k,[A,R])=>{const Z=R.shownSetByTween?Pd(i,A,s.showObjects)||Ad(i,A,s.showObjects):R.shown;return k.boolState[A]={shown:Z,pickable:R.pickable,available:R.available},k.paintState[A]=yr(R.paint),k},{boolState:{},paintState:{}}),x=this.getMinimumGraphSync(i,q.boolState,r);return Object.entries(this.convertGraphSync(x)).forEach(([k,A])=>{O[k]=A}),O.synchronization=this.calcMinimumPaintState(i,q.paintState),O}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(fr),t.KVO(Mr))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function jd(n,e){return n.reduce((o,i)=>(o[i.id]=!0===e?Jg():i.id,o),{})}function Jg(){return An.idWithPrefix("chapter")}const SM={enabled:!1,clips:{left:{clipId:0,enabled:!1,fade:!1,fadeDistance:0,progress:0},right:{clipId:1,enabled:!1,fade:!1,fadeDistance:0,progress:0},back:{clipId:5,enabled:!1,fade:!1,fadeDistance:0,progress:0},front:{clipId:4,enabled:!1,fade:!1,fadeDistance:0,progress:0},top:{clipId:3,enabled:!1,fade:!1,fadeDistance:0,progress:0},bottom:{clipId:2,enabled:!1,fade:!1,fadeDistance:0,progress:0}}},bM={0:"left",1:"right",2:"bottom",3:"top",4:"front",5:"back"};let Ar=(()=>{var n;class e{isTickerBlock(i){return i.type===Fn.Ticker}isEmptyBlock(i){switch(i.type){case Fn.Markdown:return 0===i.markdown.length;case Fn.Images:case Fn.Ticker:return 0===i.images.length;case Fn.Videos:return 0===i.videos.length;case Fn.Positions:return 0===i.positions.length}}filterEmptyBlocks(i){return i.filter(s=>!this.isEmptyBlock(s))}filterContentBlocksByType(i,s=[],r=[]){return i.filter(a=>!s.length||s.includes(a.type)).filter(a=>!r.length||!r.includes(a.type))}findContentBlockByType(i,s){return this.filterContentBlocksByType(i,[s])[0]}extractContentBlockText(i,s=""){return i?i.filter(r=>r.type===Fn.Markdown).map(r=>r.markdown).join(s):""}hasContentBlockText(i){return""!==this.extractContentBlockText(i)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),$l=(()=>{var n;class e{constructor(i,s,r,a,l){this.serializeChapterService=i,this.labelService=s,this.paintService=r,this.sceneService=a,this.contentBlocksService=l}processChapterForEngine(i){const s=jd([i],!1),d=ug(this.sceneService.getRootObjects(),ud(this.paintService.getColorRecipes()));return{...this.serializeChapterService.serializeChapter(d,i,{},[],s),sliderLayers:i.sliderLayers}}copyChapter(i,s){const r=(0,m.cloneDeep)(i);return r.id=s,r.readyState={model:!0,animation:!1},r}getChapter(i,s,r,a,l){const _=a.id||Jg();let d;(0,m.isNil)(a.background)||(d=function sM(n){if(!Object.keys(n).length)return null;const e=[...n.colors];e.forEach((r,a)=>{e[a]=(a+1)%4&&r<=1?Math.round(255*r):r});const o=/radial|linear/.test(n.gradientType)?n.gradientType:"radial",i=n.colorStops,s=Array.isArray(i)&&2===i.length?[i[0],i[1]]:[0,100];return{colors:e,gradientType:o,colorStops:s}}(a.background));const p=a.transparencyMode||ee.TransparencyModeEnum.Alpha,u=this.deserializeCamera(a);let g=!1;const y=a.timelineMap;let C;y.forEach(Jt=>{"dummy"!==Jt.name&&"dummy"!==Jt.data.timeline&&(g=!0)});const O=a.animation?.loop??s.animation?.loop??!1;if(a.ui&&!(0,m.isEmpty)(a.ui))C=a.ui;else{let Jt=0;g&&O?Jt=-1:g&&!O&&(Jt=1),C={play:{count:Jt}}}const L=$n.Annotation,$=[...a.annotations||[]].map(Jt=>this.labelService.deserializeAnnotation(Jt,a,L)),q=[],k=this.groupHotspots([...a.hotspots||[]].filter(Jt=>{const Wo=this.labelService.filterHotspot(s,a,Jt);return Wo?Jt.theme||(Jt.theme=r===yt.Module?Oo.studioNext:Oo.classicHotspot):q.push(Jt),Wo})).map(Jt=>this.labelService.deserializeHotspots(s,a,l,...Jt)),A=a.labels?.length>0?a.labels:[...$,...k],R=q,Z=(0,m.isEmpty)(a.clippingPlanes)?SM:this.sanitizeClippingPlanes(a.clippingPlanes),te=this.deserializeContentBlocks(a.contentBlocks),se=a.legend??[],st=(a.quizQuestions??[]).map(Jt=>function qw(n,e,o){return{...n,id:e,chapterId:o,data:Kw(n.type,n.data,o)}}(Jt,Jt.id,a.id)),We=a.media??{};Object.values(We).forEach(Jt=>{Jt&&(0,m.isEmpty)(Jt.lang)&&(Jt.lang="en")});const Ie=a.thumbnails,_r=i.map(Jt=>Jt.objectId),{availableObjects:zo,showObjects:dr}=a,pr=(0,m.isEmpty)(zo)?Ab(_r,dr,zo):zo;return{...a,id:_,background:d,camera:u,timelineMap:y,loop:O,ui:C,labels:A,hotspots:R,clippingPlanes:Z,contentBlocks:te,legend:se,quizQuestions:st,media:We,readyState:{model:!1,animation:!1},thumbnails:Ie,transparencyMode:p,sliderLayers:{src:{},currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]},availableObjects:pr}}deserializeContentBlocks(i=[]){return i.map(s=>(this.contentBlocksService.isTickerBlock(s)&&(s.enable=s.enable??!0),s))}deserializeCamera(i){const s=i.jumpTo?La.JumpTo:La.FlyTo,{eye:r,look:a,up:l,title:_}=i[s],d={action:s,location:{eye:r,look:a,up:l},title:_??Xy};return i.cameraRotationCenter&&(d.rotationCenter=i.cameraRotationCenter),i.camera&&Array.isArray(i.camera.rotationCenter)&&(d.rotationCenter=Yt.fromArray(i.camera.rotationCenter)),d}getChapterTweenStates(i){const s=i.timelineMap.filter(r=>"dummy"!==r.data.timeline).map(r=>r.data.timeline);return Array.from(new Set(s))}getChapterLightLibraries(i){return Ir(i)?(i.lights?.libraries??[]).filter(r=>"default"!==r):[]}getChapterReflectionLibraries(i){if(Ir(i)){const r=i.environment&&i.environment.reflectionMap||[],a=_=>_.split(".")[0],l=(i.environment&&i.environment.lightMap||[]).map(a).concat(r.map(a));return Array.from(new Set(l))}return[]}hasVisibilityLayers(i){return Array.isArray(i)&&i.length>0}buildVisibilityLayers(i){const s=i.visibilityLayers,r=i.showObjects,a={src:s,currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]};if(s&&this.hasVisibilityLayers(s.layers)){const l=s.initIndex||0,_=this.unpackLayers(s.layers),d=this.buildShownObjectsSet(r),p=this.buildCurrentLayers(_,d),u=this.buildLayerGrouping(p);a.src={layers:s.layers,initIndex:l},a.currentLayers={layers:p,index:l,position:0},a.sourceLayerGroups=(0,m.cloneDeep)(u),a.currentLayerGroups=(0,m.cloneDeep)(u)}return a}buildShownObjectsSet(i){const s=this.sceneService.getSceneGraph(this.sceneService.getRootObjects()),r=Object.keys(s.nodes).filter(a=>Pd(s,a,i)||Ad(s,a,i));return new Set(r)}unpackLayers(i){const s=[];return i.forEach(r=>{let a=[];r.objectIds.forEach(_=>{const d=this.sceneService.getObjectById(_);if(d){const p=this.sceneService.getLeaves(d.objectId);a=a.concat(p.map(u=>u.objectId))}}),s.push({name:r.name,objectIds:a})}),s}buildCurrentLayers(i,s){const r=[];return i.forEach((a,l)=>{let _=!1;a.objectIds.forEach(d=>{s.has(d)&&(_?r[r.length-1].objectIds.push(d):(r.push({name:i[l].name,objectIds:[d]}),_=!0))})}),r}buildLayerGrouping(i){return i.reduce((s,r,a)=>{const{name:l}=r;let _=s.find(d=>d.name===l);return _||(_={name:l,position:0,layers:[]},s.push(_)),_.layers.push(r),_.position=_.layers.length,s},[])}sanitizeClippingPlanes(i){const s=Object.values(i.clips).some(a=>a.progress>0),r=(0,m.mapKeys)(i.clips,(a,l)=>bM[l]||l);return{...i,clips:r,enabled:s}}groupHotspots(i){const s={},r=l=>l.primitiveIndex?l.primitiveIndex.toFixed(0):l.pos?l.pos.map(_=>_.toFixed(3)).join(":"):Math.random().toFixed(3),a=l=>RegExp("^circle-(plus|minus)").test(l)?"pair":"single";return i.forEach(l=>{const _=[a(l.type),l.objectId,r(l)].join("|");_ in s?s[_].push(l):s[_]=[l]}),Object.values(s)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Hy),t.KVO(fr),t.KVO(Mr),t.KVO(cn),t.KVO(Ar))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Pr=function(n){return n.Toggle="toggle",n.None="none",n}(Pr||{});let Zg=(()=>{class e{constructor(i){this.patches=i}}return e.type="[Story Labels] Patch Labels",e})(),eh=(()=>{class e{constructor(i,s){this.labelId=i,this.offset=s}}return e.type="[Story Labels] Set label Offset",e})(),Ua=(()=>{class e{constructor(i){this.labels=i}}return e.type="[Story Labels] Set Labels",e})(),Nr=(()=>{class e{constructor(i,s=!1){this.label=i,this.record=s}}return e.type="[Story Labels] Add Label",e})(),th=(()=>{class e{constructor(i){this.label=i}}return e.type="[Story Labels] Set Contexdt Label",e})(),Va=(()=>{class e{constructor(i){this.label=i}}return e.type="[Story Labels] Remove Label",e})(),ns=(()=>{class e{constructor(){}}return e.type="[Story Labels] Remove Context Label",e})(),nh=(()=>{class e{constructor(i,s=!1){this.chapter=i,this.record=s}}return e.type="[Story Labels] Remove All Chapter Labels",e})(),Rr=(()=>{class e{constructor(i,s=!1){this.label=i,this.record=s}}return e.type="[Story Labels] Set Label",e})(),Qy=(()=>{class e{constructor(i,s){this.id=i,this.states=s}}return e.type="[Story Labels] Set Label States",e})(),xd=(()=>{class e{constructor(i){this.scale=i}}return e.type="[Story Labels] Set Label Scale",e})(),is=(()=>{class e{constructor(i){this.label=i}}return e.type="[Story Labels] Select Label",e})(),ih=(()=>{class e{constructor(){}}return e.type="[Story Labels] Reset",e})(),Yy=(()=>{class e{constructor(i,s){this.labels=i,this.fields=s}}return e.type="[Story Labels] Convert",e})(),oh=(()=>{class e{constructor(i,s=!0,r=!0,a=!0){this.enable=i,this.enableInfo=s,this.enableActions=r,this.enableAudio=a}}return e.type="[Story Labels] Enable Context Label",e})(),os=(()=>{class e{constructor(i,s){this.labels=i,this.shown=s}}return e.type="[Story Labels] Set Labels Shown",e})(),Fl=(()=>{class e{constructor(i){this.show=i}}return e.type="[Story Labels] Set All Labels Shown",e})(),sh=(()=>{class e{constructor(i,s=Pr.None){this.collapsed=i,this.collapsedMode=s}}return e.type="[Story Labels] Set Labels Collapsed",e})(),rh=(()=>{class e{constructor(i){this.draggable=i}}return e.type="[Story Labels] Set Draggable",e})();var Bl=S(1391);let qy=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.store=s}getGeometries(){return{}}getGeometryCompressionSupported(){return!0}getLoadedAssets(){return{}}getLights(){return{}}getMaterials(){return{}}getTextureCompressionSupported(){return!0}getMorphs(){return{}}getAssetLibrary(i,s,r){const{server:a,serverBaseDirectory:l}=this.engineService;return a.getAssetLibrary(l,i,s,r)}getAssetNamespaces(){const i={},s=this.getLoadedAssets();return Object.keys(s).map(r=>r.split("/")[0]).forEach(r=>{i[r]=!0}),Object.keys(i)}enableLightLib(i){const r=this.getLights()[i];if(Array.isArray(r)){const a={};r.forEach(l=>{a[l]=!0}),console.warn("Enabling of lights in real-time not yet implemented.")}}setBranchLights(i,s){const r=this.store.selectSnapshot(E.getSelectedChapter);Ir(r)&&r.lights.libraries[0]!==s&&(r.lights.libraries[0]=s,this.enableLightLib(s))}loadLightLib(i){var s=this;return(0,J.A)(function*(){return s.getAssetLibrary("lights",i,"outline").then(r=>({type:"physicalImageLight"in r?"physical":"legacy",libId:i,asset:r}))})()}getLightingLibs(i){var s=this;return(0,J.A)(function*(){return Promise.all(i.map(r=>s.loadLightLib(r)))})()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var si=S(6104),zl=S(8399);class $i{}class yM{}const Ky=["ui-bd.class","ui-play-pause","ui-camera-mode","ui-center","ui-cross-section","ui-dissect","ui-fs","ui-tools-display","ui-tree","ui-zoom","ui-zoom-in","ui-zoom-out","ui-pan","ui-share","ui-keys","ui-slider","o","background.color-stops","background.gradient-type","dd","dn","image-display","imageDisplay","imageSrc","pre","referrer"];function ah(n){const{id:e,s:o,m:i,be:s,b:r}=n;let a="";if(e)a=e;else if(s)a=s;else if(r){const l=parseInt(r,10);a=Number.isNaN(l)?"":function TM(n){const o=(a,l)=>[Math.floor(a/l),a%l],i=[];let r,s=n;for(;s>0;)[s,r]=o(s,62),i.unshift("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[r]);return i.join("")}(l)}else i&&(a=function CM(n,e="male"){return n.includes("/")?n:`production/${e}Adult/${n}`}(i,"female"===o?"female":"male"));return Wl(a)}function Wl(n){return n.replace(/\.json$/,"")}function Jy(n){return ah(n).includes("/")?"module":"bookmark"}const Zy={type:n=>Jy(n),id:n=>ah(n),background:n=>n.bgstd||n["background.colors"]||n.background};function lh(n){if(3===n.length){const{0:e,1:o,2:i}=n;return{x:e,y:o,z:i}}return null}const AM={camera:function MM(n){const e=n.split(",").map(i=>parseFloat(i));if(e.length%3!=0||e.some(i=>Number.isNaN(i)))return null;{const i=e.slice(0,3),s=e.slice(3,6),r=e.slice(6,9);return{eye:lh(i),look:lh(s),up:lh(r)}}},background:function IM(n){const e=ts.getColors(n);return e?{colors:[...e[0][255],...e[1][255]],gradientType:"radial",colorStops:[0,100]}:null}};function PM(n){const e=o=>{if(o){const i=o.toLowerCase();if("true"===i)return!0;if("false"===i)return!1;if(!isNaN(Number(i)))return Number(i)}return o};return Object.keys(n).reduce((o,i)=>{const r=(AM[i]||e)(n[i]);return"load-rotate"===i&&isNaN(Number(r))||(o[i]=r),o},{})}function ev(n,e,o){return e===yt.Bookmark?`/search/bookmarks/tr/${o}/${n}`:`/tr/${o}/${n}.json`}let kr=(()=>{var n;class e{constructor(i,s,r,a,l,_){this.http=i,this.animationService=s,this.engineService=r,this.chapterService=a,this.contentBlocksService=l,this.store=_}getLoadChapter(i,s){const r=new yM;return r.activate=!1,r.chapterId=s.id,r.readyState={model:!0,animation:!0},r}getStory(i,s,r="en"){const a=s===yt.Bookmark?this.getBookmark(i):this.getContent(i);if("en"===r)return a;{let l;return a.pipe((0,zl.q)(_=>(l=_,this.getStoryTranslation(i,s,r)))).pipe((0,F.T)(_=>this.translateStory(l,_)),(0,pi.W)(()=>a))}}getContentRoot(){return!0===he.offline?typeof localBaseDirectory>"u"?"":localBaseDirectory:"/"}getContent(i){return this.http.get(this.getContentRoot()+`content/modules/${i}.json`).pipe((0,F.T)(s=>this.normalizeStory(s)))}getBookmark(i){return this.http.get("/search/bookmarks/data",{params:{be:i}}).pipe((0,F.T)(s=>this.normalizeStory(s.bookmark)))}addContentRecord(i,s){s.createdFrom||(s.createdFrom=[]),s.createdFrom.unshift({id:Wl(i),timestamp:Date.now()})}checkStoryIdChange(i,s){return Wl(i)!==Wl(s)}getMorphManifest(i){return this.http.get(`/content/states/${i}/animations/morphs/manifest`).pipe((0,F.T)(s=>[i,s]))}getLargestKeyFromManifest(i){const s=Object.values(i.morphs).map(r=>r.keys[r.keys.length-1]);return Math.max(...s)}findMorphEndTimes(i){const s=new Set;if(i.forEach(r=>{r.renderables.filter(({morphId:a})=>!(0,m.isNil)(a)).forEach(({morphId:a})=>{s.add(a.split("/")[0])})}),0===s.size)return(0,Qe.of)({});{const r=Array.from(s).map(a=>this.getMorphManifest(a));return(0,si.p)(r).pipe((0,F.T)(a=>a.reduce((l,[_,d])=>(l[_]=this.getLargestKeyFromManifest(d),l),{})))}}getTweenEndTimes(){const s={};return this.engineService.engine.story.chapters.forEach(r=>{const{tweens:a}=r;Object.keys(a).forEach(l=>{const _=Object.values(a[l].tweens),d=Math.max(..._.map(u=>u.keys).flat()),p=l.split("/")[0];d>(s[p]??0)&&(s[p]=d)})}),s}getStoryChapters(i,s,r){return s.chapters.map((a,l)=>this.chapterService.getChapter(i,s,r,a,l))}getStoryLoadChapters(i){return i.chapters.map(r=>this.getLoadChapter(i,r))}loadChapter(i){var s=this;return(0,J.A)(function*(){const r=s.engineService.engine.story.chapters,a=s.store.selectSnapshot(E.getStoryChapters),l=s.store.selectSnapshot(E.getSelectedChapterIndex),_=a.findIndex(p=>p.id===i.chapterId),d=r[_];return d.load().then(()=>_===l?s.animationService.setChapter(i.chapterId):d.id)})()}addChapterToEngine(i,s){var r=this;return(0,J.A)(function*(){const l=r.chapterService.processChapterForEngine(i),_=r.engineService.engine.story.createChapter(l,s);return r.engineService.engine.story.chapters[_].load().then(()=>{r.store.dispatch(new eo(i))})})()}removeChapterFromEngine(i){this.engineService.engine.story.chapters.splice(i,1)}moveChapterInEngine(i,s){var r=this;return(0,J.A)(function*(){const a=r.engineService.engine?.story?.activeChapter?.id,l=r.engineService.engine?.story?.chapters.splice(i,1).pop();if(r.engineService.engine.story.chapters.splice(s,0,l),l.id===a)return r.animationService.setChapter(l.id,!0).then(()=>l.id)})()}getStoryTranslation(i,s,r){const a=ev(i,s,r);return this.http.get(a)}getStoryLang(i,s,r){if("en"===r)return(0,Qe.of)("en");const a=ev(i,s,r);return this.http.head(a).pipe((0,F.T)(()=>!0),(0,pi.W)(()=>(0,Qe.of)(!1)),(0,F.T)(l=>l?r:"en"))}getStoryType(i){return i.indexOf("/")>=0?yt.Module:yt.Bookmark}translateStory(i,s){const a=i.chapters||[],l=i.sceneGraph||[],_=s.objects||{},d=s.chapters||[];return i.displayName=s.displayName||i.displayName,i.description=s.description||i.description,l.forEach(p=>{(p.objects||[]).forEach(g=>{this.translateObject(g,_)})}),a.forEach((p,u)=>{const g=d[u];if(g){this.translateMetaInfo(p,g);const C=g.annotations||[];(p.annotations||[]).forEach((A,R)=>{const Z=C[R];Z&&this.translateMetaInfo(A,Z)});const L=g.hotspots||[];(p.hotspots||[]).forEach((A,R)=>{const Z=L[R];Z&&this.translateMetaInfo(A,Z)});const q=g.quizQuestions||[];(p.quizQuestions||[]).forEach((A,R)=>{const Z=q[R];Z&&this.translateQuizQuestion(A,Z)});const x=p?.contentBlocks,k=g?.contentBlocks;Array.isArray(x)&&Array.isArray(k)&&x.forEach((A,R)=>{const Z=k[R];Z&&this.translateContentBlock(A,Z)})}}),i}translateQuizQuestion(i,s){if(s.nextLabel&&(i.nextLabel=s.nextLabel),["questionPrompt","explanation"].forEach(r=>{const l=s[r]||[];(i[r]||[]).forEach((_,d)=>{const p=l[d];p&&(_.markdown=p.markdown)})}),i.data&&s.data){const a=s.data.options||[];(i.data.options||[]).forEach((l,_)=>{const d=a[_];d&&(i.type===ot.LabelAnatomy?this.translateMetaInfo(l.label,d.label):l.label=d.label)})}}translateMetaInfo(i,s){const{title:r,description:a}=s;i.hasOwnProperty("displayName")&&(i.displayName=r),i.hasOwnProperty("title")&&(i.title=r),i.hasOwnProperty("description")&&(i.description=a)}translateObject(i,s){const a=s[i.objectId];a&&(i.displayName=a);const l=i.objects;l&&l.forEach(_=>{this.translateObject(_,s)})}translateContentBlock(i,s){(0,m.merge)(i,s)}exportWrittenContent(i,s,r){const a=[];return a.push(`\n${i.displayName}\n    `),s.forEach((l,_)=>{a.push(`\n---\n\n# Chapter ${_+1}: ${l.displayName||"-No Title-"}\n\n${l.description||"-No Description-"}\n      `),l.legend.length&&(a.push("\n## Legend\n"),l.legend.forEach(p=>{a.push(`\n* ${p.label} (${ts.rgbToHex(p.colors,!0)})\n`)}));const d=r.filter(p=>p.chapterId===l.id);d.length&&(a.push("\n## Labels\n"),d.forEach(p=>{a.push(`\n* ${p.title}\n`),p.description&&a.push(`\n  > ${p.description}\n`)}))}),a.join("")}exportQuizKey(i){const s=[];return i.forEach((r,a)=>{switch(s.push(`\n# QUESTION ${a+1} (${Yw[r.type]})\n\n## PROMPT\n${this.contentBlocksService.extractContentBlockText(r.questionPrompt)}\n      `),r.type){case ot.MultipleChoice:r.data.options.forEach((l,_)=>{s.push(`\n## ANSWER ${_+1} ${r.data.correctAnswer===l.value?"- CORRECT":""}\n${l.label}\n            `)});break;case ot.SelectAnatomy:s.push("\n## ANSWERS\n          "),r.data.correctAnswer.forEach((l,_)=>{s.push(`\n${l}\n            `)});break;case ot.LabelAnatomy:r.data.options.forEach((l,_)=>{s.push(`\n## ANSWER ${_+1}\n${l.label.title}\n            `)})}this.contentBlocksService.extractContentBlockText(r.explanation).length&&s.push(`\n  \n## EXPLANATION\n${this.contentBlocksService.extractContentBlockText(r.explanation)}\n        `),s.push("\n\n\n      ")}),s.join("")}normalizeStory(i){return i.chapters.forEach(s=>{s.id||(s.id=Jg())}),i}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(bi),t.KVO(Lt),t.KVO($l),t.KVO(Ar),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Ms,gn,we=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},M=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const tv={loading:!1,chapters:[],chaptersViewed:[],selectedChapter:null,isChapterAnimated:!1,thumbnails:new Map,patches:[],inversePatches:[]};let E=(Ms=class{static getStoryChapters(e){return e.chapters}static getChaptersViewed(e){return e.chaptersViewed}static getChapter(e){return(0,c.Mz)([gn],o=>o.chapters.find(i=>i.id===e))}static getSelectedChapterId(e){return e.selectedChapter}static getSelectedChapter(e){return e.chapters.find(o=>o.id===e.selectedChapter)||null}static getSelectedChapterTitle(e){const o=e.chapters.find(i=>i.id===e.selectedChapter)||null;return Ri.normalize(o?.displayName)}static getNextChapter(e){const o=(0,ee.clamp)(gn.getSelectedChapterIndex(e)+1,0,e.chapters.length-1);return e.chapters[o]}static getPreviousChapter(e){const o=(0,ee.clamp)(gn.getSelectedChapterIndex(e)-1,0,e.chapters.length-1);return e.chapters[o]}static getSelectedChapterIndex(e){return e.chapters.findIndex(o=>o.id===e.selectedChapter)}static getChapterCount(e){return e.chapters.length}static getChapterPagination(e){const o=e.chapters.findIndex(i=>i.id===e.selectedChapter);return{count:e.chapters.length,index:o,label:`${o+1} ${$localize`of`} ${e.chapters.length}`}}static getChapterCompletionPercent(e){return(e.chapters.findIndex(i=>i.id===e.selectedChapter)+1)/e.chapters.length*100}static getRegisteredThumbnails(e){return e.thumbnails}static getIsChapterAnimated(e){return e.isChapterAnimated}static getSelectedChapterReadyState(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.readyState??{model:!1,animation:!1,audio:!1}}static getChaptersLoaded(e){return{count:e.chapters.length,modelChapters:e.chapters.filter(o=>o.readyState.model),animationChapters:e.chapters.filter(o=>o.readyState.animation)}}static getAllChaptersModelsReady(e){return e.chapters.length>0&&e.chapters.every(o=>o.readyState.model)}static getSelectedChapterModelReady(e){const o=gn.getSelectedChapterReadyState(e);return!(0,m.isNil)(o)&&o.model}static getAllChaptersAnimationsReady(e){return e.chapters.length>0&&e.chapters.every(o=>o.readyState.animation)}static getSelectedChapterAnimationReady(e){const o=gn.getSelectedChapterReadyState(e);return!(0,m.isNil)(o)&&o.animation}static getSelectedChapterBackground(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.background??Aa}static getAllChaptersBackground(e){return e.chapters.map(o=>o?.background)}static getSelectedChapterAllAudio(e){const o=e.chapters.find(i=>i.id===e.selectedChapter);return o&&o.media?Object.values(o.media).filter(s=>"audio"===s.streamType):[]}static getSelectedChapterLegend(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.legend??[]}static getSelectedChapterClippingPlanes(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.clippingPlanes}static getChapterCamera(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.camera?.location}static findChapter(e,o){return e.find(i=>i.id===o)}static getAllChaptersCurrentLayers(e){return e.chapters.map(o=>o?.sliderLayers?.currentLayers?.layers??[])}static getSelectedChapterSrcLayers(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.src?.layers??[]}static getSelectedChapterSourceLayerGroups(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.sourceLayerGroups??[]}static getSelectedChapterLayerGroups(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.currentLayerGroups??[]}static getSelectedChapterCurrentLayers(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.currentLayers?.layers??[]}static getSelectedChapterCurrentLayersIndex(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.currentLayers?.index}static getSelectedChapterCurrentLayersPosition(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.sliderLayers?.currentLayers?.position}static getSelectedChapterContentBlocks(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.contentBlocks??[]}static getSelectedChapterTimelineMap(e){const{chapters:o,selectedChapter:i}=e;return gn.findChapter(o,i)?.timelineMap??[]}static isLastChapter(e){return gn.getSelectedChapterIndex(e)+1===e.chapters.length}setChapters(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters=o.chapters}))}SetChapterCameraAction(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).camera.action=o.cameraAction}))}setChapterCameraTitle(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).camera.title=o.title}))}setChapterUI(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).ui=o.ui}))}setChapterInfo(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===o.chapterId);s.description=o.description,s.displayName=o.displayName}))}setChapterLegend(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).legend=o.legend}))}addToChapterLegend(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).legend.push(o.legend)}))}ReorderChapters(e,o){var i=this;return(0,J.A)(function*(){return i.storyService.moveChapterInEngine(o.previousIndex,o.currentIndex).then(s=>{if(s){const a=e.getState().chapters.find(l=>l.id===s);e.dispatch(new eo(a)),e.dispatch(new Oa(s))}e.patchState(re.jM(e.getState(),a=>{(0,Bl.HD)(a.chapters,o.previousIndex,o.currentIndex)}));const r=e.getState().chapters.map(a=>a.id);e.dispatch(new Te.ReorderQuestions(r))})})()}SetChapterReadyState(e,o){const i=re.jM(e.getState(),s=>{if(o.chapterId){const r=s.chapters.find(a=>a.id===o.chapterId);r&&(r.readyState={...r.readyState,...o.readyState})}});e.patchState(i)}BuildChapterVisibilityLayers(e,o){const i=re.jM(e.getState(),s=>{if(o.chapterId){const r=s.chapters.findIndex(l=>l.id===o.chapterId),a=s.chapters[r];a.sliderLayers=this.chapterService.buildVisibilityLayers(a)}});e.patchState(i)}SetChapterPostProcessing(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(l=>l.id===o.chapterId),a=s.properties||{};s.customData={...s.customData?s.customData:{},postprocess:o.effects},s.properties={...a,...o.properties}}))}SetChapterTransitions(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===o.chapterId);s.transitions=s.transitions||{},s.transitions[o.key]=o.transition}))}setChapterProperties(e,o){const i=o.chapterIds,s=o.properties;e.patchState(re.jM(e.getState(),r=>{r.chapters.filter(a=>i.includes(a.id)).forEach(a=>{a.properties={...a.properties??{},...s}})}))}removeChapterProperties(e,o){const i=o.chapterIds,s=o.properties;e.patchState(re.jM(e.getState(),r=>{r.chapters.filter(a=>i.includes(a.id)).forEach(a=>{a?.properties&&s.forEach(l=>{delete a.properties[l]})})}))}SetChapterTransparencyMode(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).transparencyMode=o.transparencyMode}))}applyChapterPatch(e,o){const i=re.$i(e.getState(),o.patches);e.patchState(re.jM(i,s=>{s.patches=[],s.inversePatches=[]}))}setChapterClippingPlane(e,o){const[i,s,r]=re.vI(e.getState(),l=>{const _=l.chapters.find(d=>d.id===o.chapterId);_.clippingPlanes.clips=o.clips,_.clippingPlanes.enabled=o.enabled,_.clippingPlanes.boundary=_.clippingPlanes.boundary??this.sceneService.getSceneBoundary()}),a=re.jM(i,l=>{l.patches.push(...s),l.inversePatches.push(...r)});o.record&&e.dispatch(new Ut.SavePatches([{forward:a.patches,inverse:[...a.inversePatches].reverse(),patchAction:Ca}])),e.patchState(o.record?re.jM(a,l=>{l.patches=[],l.inversePatches=[]}):a)}setChapterBackground(e,o){o.background&&e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).background=o.background}))}setAllChaptersBackground(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.forEach(s=>{s.background=o.background})}))}resetSelectedChapterBackground(e,o){const{selectedChapter:i}=e.getState();this.store.dispatch(new mr(i,Aa))}setSelectedChapterBackground(e,{background:o}){const i=e.getState().selectedChapter;this.store.dispatch(new mr(i,o))}selectChapter(e,o){if(!o.chapter)return;this.store.dispatch([new un(!1),new Sr]);const i=this.animationService.isChapterAnimated(o.chapter);this.store.dispatch(new fa(!!o.chapter));const s=re.jM(e.getState(),r=>{r.chaptersViewed.some(a=>o.chapter.id===a)||r.chaptersViewed.push(o.chapter.id),r.selectedChapter=o.chapter?o.chapter.id:null,r.isChapterAnimated=i});e.patchState(s)}selectChapterById(e,{chapterId:o}){this.store.dispatch(new fa(!0)),e.patchState({selectedChapter:o})}duplicateChapter(e,o){const i=o.chapter,s=this.chapterService.copyChapter(i,o.chapterId),r=this.store.selectSnapshot(gn.getSelectedChapterBackground),a=this.store.selectSnapshot(oi.getRegisteredThumbnails),l=a.get(i.id);if((0,m.isNil)(l))if(i.thumbnails){const p=new Na;p.chapterId=s.id,p.snapshot=i.thumbnails.default,a.set(s.id,p)}else e.dispatch(new Cr(s.id,r,Gi.JPEG,92,Yg.medium,"square"));else a.set(s.id,l);const d=e.getState().chapters.findIndex(p=>p.id==i.id)+1;e.patchState(re.jM(e.getState(),p=>{p.chapters.splice(d,0,s)})),this.storyService.addChapterToEngine(s,d).then(()=>{}).catch(p=>{console.error(`Error importing chapter "${s.id}":`,p)})}nextChapter(e,o){const i=this.store.selectSnapshot(gn.getNextChapter);e.dispatch(new eo(i))}previousChapter(e,o){const i=this.store.selectSnapshot(gn.getPreviousChapter);e.dispatch(new eo(i))}lastChapter(e,o){const i=e.getState().chapters;e.dispatch(new eo(i[i.length-1]))}firstChapter(e,o){const i=e.getState().chapters;e.dispatch(new eo(i[0]))}removeChapter(e,o){const{chapters:i,selectedChapter:s}=e.getState();if(1===i.length)return;const r=i.findIndex(a=>a.id===o.chapter.id);if(this.storyService.removeChapterFromEngine(r),e.patchState(re.jM(e.getState(),a=>{a.chapters.splice(r,1)})),o.chapter.id===s){const a=e.getState().chapters,l=Math.min(r,a.length-1);e.dispatch(new eo(a[l]))}e.dispatch(new nh(o.chapter,!1))}resetStoryChaptersState(e,o){e.setState(tv)}RecordCamera(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===o.chapterId);s.camera.location=o.camera,o.rotationCenter&&(s.camera.rotationCenter=o.rotationCenter)}))}setChapterCurrentLayersIndexPosition(e,o){const[i,s,r]=re.vI(e.getState(),l=>{const d=l.chapters.find(p=>p.id===o.chapterId).sliderLayers.currentLayers;d.index=o.index,d.position=o.position}),a=re.jM(i,l=>{l.patches.push(...s),l.inversePatches.push(...r)});e.patchState(a),o.record&&e.dispatch(new Ut.SavePatches([{forward:a.patches,inverse:a.inversePatches,patchAction:Ca}]))}setChapterCurrentGroupLayersPosition(e,o){const[i,s,r]=re.vI(e.getState(),l=>{const _=l.chapters.find(d=>d.id===o.chapterId);_&&(_.sliderLayers.currentLayerGroups=_.sliderLayers.currentLayerGroups.map(d=>{const p=o.targetGroups.find(u=>u.name===d.name);return{...d,position:p?.position??d.position}}))}),a=re.jM(i,l=>{l.patches.push(...s),l.inversePatches.push(...r)});e.patchState(a),o.record&&e.dispatch(new Ut.SavePatches([{forward:a.patches,inverse:a.inversePatches,patchAction:Ca}]))}setChapterMedia(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===o.chapterId).media=o.media}))}setChapterContentBlocks(e,o){o.contentBlocks=[...o.contentBlocks.filter(l=>l.type===Fn.Ticker),...o.contentBlocks.filter(l=>l.type!==Fn.Ticker)];const[i,s,r]=re.vI(e.getState(),l=>{l.chapters.find(d=>d.id===o.chapterId).contentBlocks=o.contentBlocks}),a=re.jM(i,l=>{l.patches.push(...s),l.inversePatches.push(...r)});e.patchState(a),o.record&&e.dispatch(new Ut.SavePatches([{forward:a.patches,inverse:a.inversePatches,patchAction:Ca}]))}setChapterTimelineMap(e,o){e.patchState(re.jM(e.getState(),i=>{i.chapters.find(r=>r.id===i.selectedChapter).timelineMap=o.timelineMaps}))}addChapterTimelineMap(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===i.selectedChapter);o.timelineMaps.forEach(r=>{s.timelineMap.push(r)})}))}updateChapterTimelineMap(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===i.selectedChapter);o.updates.forEach(r=>{const a=s.timelineMap.findIndex(l=>l.id===r.id);s.timelineMap.splice(a,1),s.timelineMap.push(r)})}))}removeFromChapterTimelineMap(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.chapters.find(r=>r.id===i.selectedChapter);o.timelineMapIds.forEach(r=>{const a=s.timelineMap.findIndex(l=>l.id===r);s.timelineMap.splice(a,1)})}))}SetChapterLights(e,{chapterId:o,lightLibId:i}){e.patchState(re.jM(e.getState(),s=>{const r=s.chapters.find(a=>a.id===o);Vd(r)?r.lightLibraryId=i:Ir(r)&&(r.lights.libraries=[i],this.assetService.setBranchLights(o,i))}))}constructor(e,o,i,s,r,a){this.store=e,this.chapterService=o,this.animationService=i,this.assetService=s,this.sceneService=r,this.storyService=a}},gn=Ms,Ms.\u0275fac=function(e){return new(e||Ms)(t.KVO(c.il),t.KVO($l),t.KVO(bi),t.KVO(qy),t.KVO(cn),t.KVO(kr))},Ms.\u0275prov=t.jDH({token:Ms,factory:Ms.\u0275fac}),Ms);we([(0,c.rc)(Dl),M("design:type",Function),M("design:paramtypes",[Object,Dl]),M("design:returntype",void 0)],E.prototype,"setChapters",null),we([(0,c.rc)(Jb),M("design:type",Function),M("design:paramtypes",[Object,Jb]),M("design:returntype",void 0)],E.prototype,"SetChapterCameraAction",null),we([(0,c.rc)(Mg),M("design:type",Function),M("design:paramtypes",[Object,Mg]),M("design:returntype",void 0)],E.prototype,"setChapterCameraTitle",null),we([(0,c.rc)(Zb),M("design:type",Function),M("design:paramtypes",[Object,Zb]),M("design:returntype",void 0)],E.prototype,"setChapterUI",null),we([(0,c.rc)(ey),M("design:type",Function),M("design:paramtypes",[Object,ey]),M("design:returntype",void 0)],E.prototype,"setChapterInfo",null),we([(0,c.rc)(ty),M("design:type",Function),M("design:paramtypes",[Object,ty]),M("design:returntype",void 0)],E.prototype,"setChapterLegend",null),we([(0,c.rc)(ny),M("design:type",Function),M("design:paramtypes",[Object,ny]),M("design:returntype",void 0)],E.prototype,"addToChapterLegend",null),we([(0,c.rc)(iy),M("design:type",Function),M("design:paramtypes",[Object,iy]),M("design:returntype",Promise)],E.prototype,"ReorderChapters",null),we([(0,c.rc)(vd),M("design:type",Function),M("design:paramtypes",[Object,vd]),M("design:returntype",void 0)],E.prototype,"SetChapterReadyState",null),we([(0,c.rc)(Ig),M("design:type",Function),M("design:paramtypes",[Object,Ig]),M("design:returntype",void 0)],E.prototype,"BuildChapterVisibilityLayers",null),we([(0,c.rc)(oy),M("design:type",Function),M("design:paramtypes",[Object,oy]),M("design:returntype",void 0)],E.prototype,"SetChapterPostProcessing",null),we([(0,c.rc)(sy),M("design:type",Function),M("design:paramtypes",[Object,sy]),M("design:returntype",void 0)],E.prototype,"SetChapterTransitions",null),we([(0,c.rc)(ry),M("design:type",Function),M("design:paramtypes",[Object,ry]),M("design:returntype",void 0)],E.prototype,"setChapterProperties",null),we([(0,c.rc)(ay),M("design:type",Function),M("design:paramtypes",[Object,ay]),M("design:returntype",void 0)],E.prototype,"removeChapterProperties",null),we([(0,c.rc)(ly),M("design:type",Function),M("design:paramtypes",[Object,ly]),M("design:returntype",void 0)],E.prototype,"SetChapterTransparencyMode",null),we([(0,c.rc)(Ca),M("design:type",Function),M("design:paramtypes",[Object,Ca]),M("design:returntype",void 0)],E.prototype,"applyChapterPatch",null),we([(0,c.rc)(cy),M("design:type",Function),M("design:paramtypes",[Object,cy]),M("design:returntype",void 0)],E.prototype,"setChapterClippingPlane",null),we([(0,c.rc)(mr),M("design:type",Function),M("design:paramtypes",[Object,mr]),M("design:returntype",void 0)],E.prototype,"setChapterBackground",null),we([(0,c.rc)(Ed),M("design:type",Function),M("design:paramtypes",[Object,Ed]),M("design:returntype",void 0)],E.prototype,"setAllChaptersBackground",null),we([(0,c.rc)(_y),M("design:type",Function),M("design:paramtypes",[Object,_y]),M("design:returntype",void 0)],E.prototype,"resetSelectedChapterBackground",null),we([(0,c.rc)(dy),M("design:type",Function),M("design:paramtypes",[Object,Object]),M("design:returntype",void 0)],E.prototype,"setSelectedChapterBackground",null),we([(0,c.rc)(eo),M("design:type",Function),M("design:paramtypes",[Object,eo]),M("design:returntype",void 0)],E.prototype,"selectChapter",null),we([(0,c.rc)(kl),M("design:type",Function),M("design:paramtypes",[Object,Object]),M("design:returntype",void 0)],E.prototype,"selectChapterById",null),we([(0,c.rc)(py),M("design:type",Function),M("design:paramtypes",[Object,py]),M("design:returntype",void 0)],E.prototype,"duplicateChapter",null),we([(0,c.rc)(qb),M("design:type",Function),M("design:paramtypes",[Object,qb]),M("design:returntype",void 0)],E.prototype,"nextChapter",null),we([(0,c.rc)(Kb),M("design:type",Function),M("design:paramtypes",[Object,Kb]),M("design:returntype",void 0)],E.prototype,"previousChapter",null),we([(0,c.rc)(wg),M("design:type",Function),M("design:paramtypes",[Object,wg]),M("design:returntype",void 0)],E.prototype,"lastChapter",null),we([(0,c.rc)(Mw),M("design:type",Function),M("design:paramtypes",[Object,wg]),M("design:returntype",void 0)],E.prototype,"firstChapter",null),we([(0,c.rc)(uy),M("design:type",Function),M("design:paramtypes",[Object,uy]),M("design:returntype",void 0)],E.prototype,"removeChapter",null),we([(0,c.rc)(Ag),M("design:type",Function),M("design:paramtypes",[Object,Ag]),M("design:returntype",void 0)],E.prototype,"resetStoryChaptersState",null),we([(0,c.rc)(Td),M("design:type",Function),M("design:paramtypes",[Object,Td]),M("design:returntype",void 0)],E.prototype,"RecordCamera",null),we([(0,c.rc)(Pg),M("design:type",Function),M("design:paramtypes",[Object,Pg]),M("design:returntype",void 0)],E.prototype,"setChapterCurrentLayersIndexPosition",null),we([(0,c.rc)(Ng),M("design:type",Function),M("design:paramtypes",[Object,Ng]),M("design:returntype",void 0)],E.prototype,"setChapterCurrentGroupLayersPosition",null),we([(0,c.rc)(gy),M("design:type",Function),M("design:paramtypes",[Object,gy]),M("design:returntype",void 0)],E.prototype,"setChapterMedia",null),we([(0,c.rc)(Rg),M("design:type",Function),M("design:paramtypes",[Object,Rg]),M("design:returntype",void 0)],E.prototype,"setChapterContentBlocks",null),we([(0,c.rc)(Sy),M("design:type",Function),M("design:paramtypes",[Object,kg]),M("design:returntype",void 0)],E.prototype,"setChapterTimelineMap",null),we([(0,c.rc)(kg),M("design:type",Function),M("design:paramtypes",[Object,kg]),M("design:returntype",void 0)],E.prototype,"addChapterTimelineMap",null),we([(0,c.rc)(hy),M("design:type",Function),M("design:paramtypes",[Object,hy]),M("design:returntype",void 0)],E.prototype,"updateChapterTimelineMap",null),we([(0,c.rc)(my),M("design:type",Function),M("design:paramtypes",[Object,my]),M("design:returntype",void 0)],E.prototype,"removeFromChapterTimelineMap",null),we([(0,c.rc)(fy),M("design:type",Function),M("design:paramtypes",[Object,fy]),M("design:returntype",void 0)],E.prototype,"SetChapterLights",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getStoryChapters",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChaptersViewed",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterId",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapter",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterTitle",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getNextChapter",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getPreviousChapter",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterIndex",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChapterCount",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChapterPagination",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChapterCompletionPercent",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getRegisteredThumbnails",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getIsChapterAnimated",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterReadyState",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChaptersLoaded",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getAllChaptersModelsReady",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterModelReady",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getAllChaptersAnimationsReady",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterAnimationReady",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterBackground",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getAllChaptersBackground",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterAllAudio",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterLegend",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getSelectedChapterClippingPlanes",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"getChapterCamera",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getAllChaptersCurrentLayers",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterSrcLayers",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterSourceLayerGroups",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterLayerGroups",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterCurrentLayers",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Number)],E,"getSelectedChapterCurrentLayersIndex",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Number)],E,"getSelectedChapterCurrentLayersPosition",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterContentBlocks",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",Array)],E,"getSelectedChapterTimelineMap",null),we([(0,c.MD)(),M("design:type",Function),M("design:paramtypes",[wt]),M("design:returntype",void 0)],E,"isLastChapter",null),E=gn=we([(0,c.Uw)({name:"storyChapters",defaults:tv}),M("design:paramtypes",[c.il,$l,bi,qy,cn,kr])],E);var Is,ch,vi=S(8617),Dn=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ge=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const RM={storedCameras:{},cameraMotion:new Og,panMode:"rotate",zoomed:!1,lockCamera:!1,cameraFlyTo:void 0,chapterCameraEnabled:!0};let vt=(ch=Is=class{static getStoredCamera(e){return(0,c.Mz)([ch],o=>o.storedCameras[e]||null)}static getCameraMotion(e){return e.cameraMotion}static getPanMode(e){return e.panMode}static getZoomed(e){return e.zoomed}static getLockCamera(e){return e.lockCamera}static getChapterCameraEnabled(e){return e.chapterCameraEnabled}storeCamera(e,o){const i=o.camera||this.cameraService.getCamera(),s=e.getState().storedCameras;s[o.id]={...i},e.patchState({storedCameras:{...s}})}clearCamera(e,o){const i=e.getState().storedCameras;delete i[o.id],e.patchState({storedCameras:{...i}})}setCameraFlyTo(e,o){e.patchState(re.jM(e.getState(),i=>{i.cameraFlyTo=o.camera}))}applyCameraPatch(e,o){const i=re.$i(e.getState(),o.patches);e.patchState(i);const s=void 0===i.cameraFlyTo?this.store.selectSnapshot(E.getChapterCamera):i.cameraFlyTo;e.dispatch(new di(s,!0,1))}moveCamera(e,o){e.patchState({cameraMotion:{...o.cameraMotion}})}resetCamera(e,o){const i=this.store.selectSnapshot(E.getSelectedChapter),s=this.cameraService.flyToCamera(i.camera.location);return(0,Ra.H)(s).pipe((0,qo.M)(()=>{e.patchState({cameraMotion:new Og})}))}zoomCamera(e,o){const{cameraMotion:i}=e.getState();i.zoom=o.value,e.patchState({cameraMotion:{...i}})}panCameraX(e,o){const{cameraMotion:i}=e.getState();i.panX=o.value,e.patchState({cameraMotion:{...i}})}panCameraY(e,o){const{cameraMotion:i}=e.getState();i.panY=o.value,e.patchState({cameraMotion:{...i}})}rotateCameraX(e,o){const{cameraMotion:i}=e.getState();e.patchState({cameraMotion:{...i,rotateX:o.value}})}rotateCameraY(e,o){const{cameraMotion:i}=e.getState();i.rotateY=o.value,e.patchState({cameraMotion:{...i}})}SetCameraMode(e,o){e.patchState({panMode:o.mode}),this.liveAnnouncer.announce(`Switched to ${o.mode} mode`)}setZoomed(e,o){e.patchState({zoomed:o.zoomed})}lockCamera(e,o){e.patchState({lockCamera:o.lock})}setChapterCameraEnabled(e,o){e.patchState({chapterCameraEnabled:o.enabled})}constructor(e,o,i,s){this.cameraService=e,this.liveAnnouncer=o,this.store=i,this.actions=s}},Is.\u0275fac=function(e){return new(e||Is)(t.KVO(Pi),t.KVO(vi.Ai),t.KVO(c.il),t.KVO(c.En))},Is.\u0275prov=t.jDH({token:Is,factory:Is.\u0275fac}),Is);Dn([(0,c.rc)(Db),Ge("design:type",Function),Ge("design:paramtypes",[Object,Db]),Ge("design:returntype",void 0)],vt.prototype,"storeCamera",null),Dn([(0,c.rc)(kb),Ge("design:type",Function),Ge("design:paramtypes",[Object,kb]),Ge("design:returntype",void 0)],vt.prototype,"clearCamera",null),Dn([(0,c.rc)(Sd),Ge("design:type",Function),Ge("design:paramtypes",[Object,Sd]),Ge("design:returntype",void 0)],vt.prototype,"setCameraFlyTo",null),Dn([(0,c.rc)(bd),Ge("design:type",Function),Ge("design:paramtypes",[Object,bd]),Ge("design:returntype",void 0)],vt.prototype,"applyCameraPatch",null),Dn([(0,c.rc)(Ea),Ge("design:type",Function),Ge("design:paramtypes",[Object,Ea]),Ge("design:returntype",void 0)],vt.prototype,"moveCamera",null),Dn([(0,c.rc)(Rl),Ge("design:type",Function),Ge("design:paramtypes",[Object,Rl]),Ge("design:returntype",void 0)],vt.prototype,"resetCamera",null),Dn([(0,c.rc)(Lb),Ge("design:type",Function),Ge("design:paramtypes",[Object,Lb]),Ge("design:returntype",void 0)],vt.prototype,"zoomCamera",null),Dn([(0,c.rc)(Ub),Ge("design:type",Function),Ge("design:paramtypes",[Object,Ub]),Ge("design:returntype",void 0)],vt.prototype,"panCameraX",null),Dn([(0,c.rc)(Vb),Ge("design:type",Function),Ge("design:paramtypes",[Object,Vb]),Ge("design:returntype",void 0)],vt.prototype,"panCameraY",null),Dn([(0,c.rc)(xb),Ge("design:type",Function),Ge("design:paramtypes",[Object,xb]),Ge("design:returntype",void 0)],vt.prototype,"rotateCameraX",null),Dn([(0,c.rc)(Gb),Ge("design:type",Function),Ge("design:paramtypes",[Object,Gb]),Ge("design:returntype",void 0)],vt.prototype,"rotateCameraY",null),Dn([(0,c.rc)(fd),Ge("design:type",Function),Ge("design:paramtypes",[Object,fd]),Ge("design:returntype",void 0)],vt.prototype,"SetCameraMode",null),Dn([(0,c.rc)(bg),Ge("design:type",Function),Ge("design:paramtypes",[Object,bg]),Ge("design:returntype",void 0)],vt.prototype,"setZoomed",null),Dn([(0,c.rc)(yg),Ge("design:type",Function),Ge("design:paramtypes",[Object,yg]),Ge("design:returntype",void 0)],vt.prototype,"lockCamera",null),Dn([(0,c.rc)(md),Ge("design:type",Function),Ge("design:paramtypes",[Object,md]),Ge("design:returntype",void 0)],vt.prototype,"setChapterCameraEnabled",null),Dn([(0,c.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[Nl]),Ge("design:returntype",void 0)],vt,"getCameraMotion",null),Dn([(0,c.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[Nl]),Ge("design:returntype",void 0)],vt,"getPanMode",null),Dn([(0,c.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[Nl]),Ge("design:returntype",void 0)],vt,"getZoomed",null),Dn([(0,c.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[Nl]),Ge("design:returntype",void 0)],vt,"getLockCamera",null),Dn([(0,c.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[Nl]),Ge("design:returntype",void 0)],vt,"getChapterCameraEnabled",null),vt=ch=Dn([(0,c.Uw)({name:"engineCamera",defaults:RM}),Ge("design:paramtypes",[Pi,vi.Ai,c.il,c.En])],vt);var Ct=function(n){return n.Select="Select",n.Hide="Hide",n.Paint="Paint",n.Eyedropper="Eyedropper",n.Label="Label",n.Isolate="Isolate",n.Fade="Fade",n.Positions="Positions",n.Quiz="Quiz",n.Image="Image",n.Dimensions="Dimensions",n.Background="Background",n}(Ct||{}),As=function(n){return n.Capture="capture",n.DoNotCaptureShowMessage="do_not_capture_show_message",n.DoNotCapture="do_not_capture",n}(As||{}),Ye=S(5152),_h=S(5326),dh=function(n){return n.BioDigital="biodigital",n.Wikipedia="wikipedia",n.NCIT="ncit",n}(dh||{});let ph=(()=>{var n;class e{constructor(i){this.http=i,this.nodeInfoCache=new Map}queryNodeInfo(i,s,r="en",a=!0){if(he.offline)return(0,Qe.of)(void 0);const _=`/search/descriptions?name=${i}&plan=${s===dh.Wikipedia?"wiki":s}&ol=${r}`,d=_;if(a&&this.nodeInfoCache.has(d)){const p=this.nodeInfoCache.get(d);return(0,Qe.of)(p)}return this.http.get(_).pipe((0,F.T)(p=>({label:i,latinLabel:p.latin_term,description:p.description,source:p.source,sourceLink:p.url})),(0,pi.W)(p=>404===p.status?(0,Qe.of)(void 0):(0,_h.$)(p)),(0,qo.M)(p=>this.nodeInfoCache.set(d,p)))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Ps,ja,Fi=function(n){return n[n.Tiny=0]="Tiny",n[n.Small=1]="Small",n[n.Standard=2]="Standard",n}(Fi||{}),Me=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},I=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const kM=new mg(0,0,0,0,0,0,Pl.Hidden,1);let U=(Ps=class{static getEngine(e){return e.engine}static getReady(e){return e.ready}static getDisplay(e){return e.display}static getScrollMode(e){return e.scrollMode}static getVisible(e){return e.visible}static getViewGraph(e){return e.viewGraph}static getTreeGraph(e,o){return o?e:Pb(e)}static getViewGraphNode(e){return o=>e.viewGraph.nodes[o]}static getEnginePosition(e){return e.enginePosition}static getCanvasHeightBreakpoint(e){return e?.height<375?Fi.Tiny:e?.height<480?Fi.Small:Fi.Standard}static getChapter(e){return e.chapter}static getActiveTool(e){return e.activeTool}static getShowCameraBar(e){return e.showCameraBar}static getShowProgressBar(e){return e.showProgressBar}static getShowLabels(e){return e.showLabels}static getAnimationPlaying(e){return e.animationPlaying}static getAutoplay(e){return e.autoplay}static getXrayModeEnabled(e){return e.xrayModeEnabled}static getHoveredNode(e){return e.hoveredNode}static getLabelEditNode(e){return e.labelEditNode}static getQuerying(e){return e.queryingAnatomy}static getContextmenu(e){return e.contextmenu}static getPlaybackSpeed(e){return e.playbackSpeed}static getWatermarkEnabled(e){return e.watermarkEnabled}static getWebGLContextName(e){return e.webGLContextName}static getStatsEnabled(e){return e.stats.enabled}static getShowAdvancedStatsTools(e){return e.stats.showAdvancedTools}static getClickPickEnabled(e){return e.pickState.clickEnabled}static getHoverPickEnabled(e){return e.pickState.hoverEnabled}load(e,o){e.dispatch(new Xu("engine"))}loadSuccess({patchState:e},o){e({engine:o.result})}setReady(e,o){e.patchState({ready:o.ready})}setDisplay(e,o){e.patchState({display:o.display})}setZoomViaScrollAllowed(e,o){e.patchState({scrollMode:o.scrollMode})}setVisible(e,o){e.patchState({visible:o.visible})}setEnginePosition(e,o){e.patchState({enginePosition:{...o.position,right:o.position.left+o.position.width,bottom:o.position.top+o.position.height}})}resetEnginePosition(e,o){e.patchState({enginePosition:kM})}setChapter(e,o){e.patchState({chapter:o.chapterId})}setActiveTool(e,o){e.patchState({activeTool:o.tool})}setGraph(e,o){e.patchState({viewGraph:{...o.graph}})}clearGraph(e,o){e.patchState({viewGraph:{nodes:{},successors:{},predecessors:{},roots:{}}})}setXrayMode(e,o){e.patchState({xrayModeEnabled:o.enabled})}toggleProgressBar(e,o){e.patchState({showProgressBar:o.show})}toggleCameraBar(e,o){e.patchState({showCameraBar:o.show})}toggleLabels(e,o){const i=null!=o.show?o.show:!e.getState().showLabels;e.patchState({showLabels:i})}synchronizeVisibleNodes(e,o){const i=e.getState().viewGraph,s=this.stateMapToNodeIds(i,o.leafVisibilityState),r={};s.forEach(a=>{const _=this.sceneService.getLeafIds(a).reduce((d,p)=>d||o.nodes[p].shown,!1);r[a]={shown:_}}),this.graphService.synchronize({...i},{shown:Ai.TrueWins},r),e.patchState({viewGraph:{...i}})}synchronizeRenderableNodes(e,o){const i=e.getState().viewGraph,s=this.stateMapToNodeIds(i,o.leafRenderableState),r={};s.forEach(a=>{r[a]={renderable:!0}}),this.graphService.synchronize(i,{renderable:Ai.FalseWins},r)}synchronizePickableNodes(e,o){const i=e.getState().viewGraph,s=this.stateMapToNodeIds(i,o.leafPickableState),r={};s.forEach(a=>{const _=this.sceneService.getLeafIds(a).reduce((d,p)=>d||this.sceneService.getObjectById(p).pickable,!1);r[a]={pickable:_}}),this.graphService.synchronize(i,{pickable:Ai.TrueWins},r),e.patchState({viewGraph:{...i}})}synchronizeAvailableNodes(e,o){const i=e.getState().viewGraph,s=this.stateMapToNodeIds(i,o.leafAvailableState),r={};s.forEach(a=>{const _=this.sceneService.getLeafIds(a).reduce((d,p)=>d||o.nodes[p].available,!1);r[a]={available:_}}),this.graphService.synchronize(i,{available:Ai.TrueWins},r),e.patchState({viewGraph:{...i}})}playChapterAnimation(e,o){this.animationService.restart(),e.getState().animationPlaying||this.animationService.pause()}toggleAnimation(e,o){o.play?this.animationService.unpause():this.animationService.pause()}setAnimationPlaying(e,o){e.patchState({animationPlaying:o.playing})}setPlaybackSpeed(e,o){e.patchState({playbackSpeed:o.speed})}setAutoplay(e,o){e.patchState({autoplay:o.enable})}setObjectLayerOrder(e,o){const i=e.getState().viewGraph,s=isNaN(o.layer)?0:o.layer,{anatomyObjects:r}=this.sceneService.getAnatomySceneGraph();let a=[];o.nodes.forEach(l=>{const _=this.graphService.getDescendants(i,l.id,!0);a=a.concat(_)}),a.forEach(l=>{this.sceneService.setObjectLayer(r,l,s),this.graphService.setState(i,l,{layer:s})}),e.patchState({viewGraph:{...i}})}setObjectDisplayName(e,o){const i=this.sceneService.getObjectById(o.nodeId);i&&(i.displayName=o.displayName)}autoSortObjectLayers(e,o){const i=e.getState().viewGraph;let r=0;const a=this.sceneService.getEnabledLeafIds(),l=this.sceneService.getObjectLayerValues(a),{anatomyObjects:_}=this.sceneService.getAnatomySceneGraph();Object.keys(l).map(d=>parseInt(d,10)).sort((d,p)=>d-p).forEach(d=>{l[d].sort((p,u)=>u.value-p.value).forEach(p=>{const u=20*r;this.sceneService.setObjectLayer(_,p.nodeId,u),this.graphService.setState(i,p.nodeId,{layer:u}),r++})}),e.patchState({viewGraph:{...i}})}resetObjectLayers(e,o){const i=e.getState().viewGraph,s=this.sceneService.getEnabledLeafIds(),{anatomyObjects:r}=this.sceneService.getAnatomySceneGraph();s.forEach(a=>{this.sceneService.setObjectLayer(r,a,0),this.graphService.setState(i,a,{layer:0})}),e.patchState({viewGraph:{...i}})}setPostProcessingEffects(e,{effects:o}){this.postProcessingService.setPostProcessingFeatures(o)}setProperties(e,{properties:o}){this.engineService.setProperties({...o})}setTransparencyMode(e,{mode:o}){this.engineRendererService.setTransparencyMode(o)}expandNode(e,o){const i=this.store.selectSnapshot(ja.getViewGraph);(function aw(n,e,o=!1,i="ascending"){const s=o?[e]:[];let r=n.predecessors[e];for(;r;)s.push(r),r=n.predecessors[r];return"descending"===i&&s.reverse(),s})(i,o.node.id,!0).forEach(r=>{i.nodes[r].boolState.expanded=!0}),this.store.dispatch(new ys(i))}collapseNode(e,o){const i=this.store.selectSnapshot(ja.getViewGraph);i.nodes[o.node.id].boolState.expanded=!1,this.store.dispatch(new ys(i))}collapseAllViewTreeNodes(e,o){const i=this.store.selectSnapshot(ja.getViewGraph);Object.values(i.nodes).forEach(s=>{s.boolState.expanded=!1}),this.store.dispatch(new ys(i))}hoverNode(e,o){e.patchState({hoveredNode:o.node})}setLabelEditNode(e,o){e.patchState({labelEditNode:o.node})}queryNodeInfo(e,{node:o,fallback:i,lang:s}){e.patchState({queryingAnatomy:!0}),this.contentInfoService.queryNodeInfo(o.label,i,s).pipe((0,Ye.j)(()=>e.patchState({queryingAnatomy:!1}))).subscribe(r=>e.dispatch(new ag(o,r)),()=>e.dispatch(new iw(o)))}queryNodeInfoSuccess(e,{node:o,info:i}){e.dispatch(new dd(o,i))}setNodeInfo(e,{node:o,info:i}){const s=this.store.selectSnapshot(ja.getViewGraph),r=s.nodes[o.id];r&&i&&(r.description=i.description,r.info=i,this.store.dispatch(new ys(s)))}setContextMenu(e,o){e.patchState({contextmenu:{node:o.node,hit:o.hit}})}setWatermarkEnabled(e,{enabled:o}){e.patchState({watermarkEnabled:o})}setWebGLContext(e,o){e.patchState({webGLContextName:o.context})}setEngineStatsEnabled(e,{enabled:o,showAdvancedTools:i}){e.patchState({stats:{enabled:o,showAdvancedTools:i}})}setHoverPick(e,o){e.patchState({pickState:{...e.getState().pickState,...o.pickState}})}stateMapToNodeIds(e,o){const i=Object.keys(o).map(s=>this.sceneService.getViewNode(e,s)).filter(s=>!!s).map(s=>s.id);return new Set(i)}constructor(e,o,i,s,r,a,l,_){this.store=e,this.graphService=o,this.engineService=i,this.contentInfoService=s,this.animationService=r,this.postProcessingService=a,this.engineRendererService=l,this.sceneService=_}},ja=Ps,Ps.\u0275fac=function(e){return new(e||Ps)(t.KVO(c.il),t.KVO(lo),t.KVO(Lt),t.KVO(ph),t.KVO(bi),t.KVO(qg),t.KVO(ws),t.KVO(cn))},Ps.\u0275prov=t.jDH({token:Ps,factory:Ps.\u0275fac}),Ps);function VM(n,e){const o=g=>void 0!==g.objectId,[i,s]=(0,m.partition)(n,o),[r,a]=(0,m.partition)(e,o),l=function LM(n,e){return e.reduce((o,i)=>{for(const s of n)(0,m.isEqual)(s,i)||o.push(i);return o},n)}(s,a),{sceneGraph:_,graphsMerged:d,objectIdsUniqueToNew:p,objectIdsUniqueToOriginal:u}=function UM(n,e){const o=n.reduce((r,a)=>(r[a.objectId]=a,r),{}),i=e.reduce((r,a)=>{if(void 0===r.nodes[a.objectId])return r.nodes[a.objectId]=a,r;if(!(0,m.isEqual)(a,r.nodes[a.objectId])){const l=function DM(n,e){const o={},i={};return{root:function s(a,l){if(a.objectId!==l.objectId)return o[l.objectId]=!0,[a,l];if(void 0===a.objects&&l.objects){for(const p of l.objects)o[p.objectId]=!0;return[{...l}]}if(a.objects&&void 0===l.objects){for(const p of a.objects)i[p.objectId]=!0;return[{...a}]}if(void 0===a.objects&&void 0===l.objects)return[{...a}];const _=[];for(const p of a.objects){const u=l.objects.find(g=>g.objectId===p.objectId);u?_.push(s(p,u)):(i[p.objectId]=!0,_.push(p))}for(const p of l.objects)a.objects.find(g=>g.objectId===p.objectId)||(o[p.objectId]=!0,_.push(p));const d={...a};return d.objects=(0,m.flatten)(_),[d]}(n,e),objectIdsUniqueToNew:o,objectIdsUniqueToOriginal:i}}(r.nodes[a.objectId],a);r.nodes[a.objectId]=l.root[0],r.graphsMerged.push(a.objectId),r.objectIdsUniqueToNew[a.objectId]=l.objectIdsUniqueToNew,r.objectIdsUniqueToOriginal[a.objectId]=l.objectIdsUniqueToOriginal}return r},{nodes:o,graphsMerged:[],objectIdsUniqueToNew:{},objectIdsUniqueToOriginal:{}});return{sceneGraph:Object.keys(i.nodes).reduce((r,a)=>(r.push(i.nodes[a]),r),[]),graphsMerged:i.graphsMerged,objectIdsUniqueToNew:i.objectIdsUniqueToNew,objectIdsUniqueToOriginal:i.objectIdsUniqueToOriginal}}(i,r);return{sceneGraph:[...l,..._],graphsMerged:d,objectIdsUniqueToNew:p,objectIdsUniqueToOriginal:u}}function nv(n,e,o){const i=function jM(n,e,o){const i={};for(const s of n){const r=Object.keys(e[s]);for(const a of r)i[a]=o}return i}(e,o,!1);return n.map(s=>({...s,availableObjects:{...s.availableObjects,...i},showObjects:{...s.showObjects,...i},selectObjects:{...s.selectObjects,...i},pickThroughObjects:{...s.pickThroughObjects,...i}}))}function Gd(n){return n.split("/").length>1?yt.Module:yt.Bookmark}function iv(n,e){return n.map(o=>{if(Vd(o)||Ir(o)&&!(0,m.isEmpty)(o.lights))return o;const i={libraries:[...e],lights:[]};return{...o,lights:i}})}function ov(n){return n.reduce((e,o)=>(e[o.id]=o,e),{})}function sv(n){return n.reduce((e,o)=>{const i=o.id,s=o.customData?.particleSystems??[];return s.length>0&&(e[i]=function BM(n){return n.reduce((e,o)=>(e[es.getParticleIdRoot(o)]=o,e),{})}(s)),e},{})}function rv(n,e){return n.map(o=>{const i=o.customData?.particleSystems??[];return i.length&&(o.customData.particleSystems=i.map(s=>e[s]?.id??s)),o})}function av(n){if((0,m.isEmpty)(n))return;const{audit:e,reviewed:o,collaborated:i,references:s}=n,r=s?.filter(l=>l.label.trim().length>0)??[],a={};return r.length>0&&(a.references=r),he.application!==bt.Loft||(o?.enabled&&(a.reviewed=o),i?.enabled&&(a.collaborated=i)),e?.enabled&&(a.audit=e),(0,m.isEmpty)(a)?void 0:a}function XM(n,e,o,i,s=yt.Bookmark,r=An.idWithPrefix){const{sceneGraph:a,graphsMerged:l,objectIdsUniqueToNew:_,objectIdsUniqueToOriginal:d}=VM(n.sceneGraph,o.sceneGraph),p=function FM(n,e){const o=(a,l)=>(0,m.uniq)([...a,...l]);return{lights:o(n.lights,e.lights),tweens:o(n.tweens,e.tweens),reflections:o(n.reflections,e.reflections)}}(n.assetLibraries,o.assetLibraries),u=function $M(n,e,o,i){e=e||{};const s=(r,a)=>a.includes("/")?a:`${function GM(n){return Gd(n)===yt.Bookmark?n:n.split("/").pop()}(r)}/${a}`;return{...(0,m.mapKeys)(n=n||{},(r,a)=>s(o,a)),...(0,m.mapKeys)(e,(r,a)=>s(i,a))}}(n.reflections,o.reflections,e,i),g=iv(n.chapters,n.assetLibraries.lights),y=iv(o.chapters,o.assetLibraries.lights),$=function zM(n,e,o,i,s){const r=n.customData?.particleSystems??[],a=e.customData?.particleSystems??[],l=ov(r),_=ov(a);Object.entries(_).forEach(([C,O])=>{const L=l[C];(0,m.isNil)(L)||(_[C]=(0,m.isEqual)(L,O)?L:{...(0,m.cloneDeep)(O),id:es.generateParticleId(C,s)})});const d=Array.from(new Set([...Object.values(l),...Object.values(_)])),p=rv(o,l),u=rv(i,_),g={...sv(p),...sv(u)};return{mergedParticles:d,currentChapters:p,importedChapters:u,tweenParticleLookup:(0,m.pickBy)(g,C=>!(0,m.isEmpty)(C))}}(n,o,nv(g,l,_),nv(y,l,d).map(Z=>{const te=Z.createdFrom??[];return te.unshift({id:Wl(i),timestamp:Date.now()}),{...Z,id:r("chapter"),createdFrom:te}}),r),x=function xM(n,e){const o=n.map(i=>i.objectId);return e.map(i=>{const s=i.showObjects??{},r=i.availableObjects??{};return{...i,availableObjects:Ab(o,s,r)}})}(a,[...$.currentChapters,...$.importedChapters]),k={...n.customData,particleSystems:$.mergedParticles},A="module"===s?n.tags:[],R=function WM(n,e){const o=[...n?.references??[],...e?.references??[]];if(o.length>0)return{references:o,audit:{enabled:!0===n?.audit?.enabled&&!0===e?.audit?.enabled}}}(n.sourceInfo,o.sourceInfo);return{...n,assetLibraries:p,chapters:x,sceneGraph:a,customData:k,tags:A,reflections:u,stateId:(0,m.uniq)([...n.stateId,...o.stateId]),tweenParticleLookup:$.tweenParticleLookup,sourceInfo:R}}Me([(0,c.rc)(ub),I("design:type",Function),I("design:paramtypes",[Object,ub]),I("design:returntype",void 0)],U.prototype,"load",null),Me([(0,c.rc)(Xu),I("design:type",Function),I("design:paramtypes",[Object,Xu]),I("design:returntype",void 0)],U.prototype,"loadSuccess",null),Me([(0,c.rc)(Hu),I("design:type",Function),I("design:paramtypes",[Object,Hu]),I("design:returntype",void 0)],U.prototype,"setReady",null),Me([(0,c.rc)(od),I("design:type",Function),I("design:paramtypes",[Object,od]),I("design:returntype",void 0)],U.prototype,"setDisplay",null),Me([(0,c.rc)(sd),I("design:type",Function),I("design:paramtypes",[Object,sd]),I("design:returntype",void 0)],U.prototype,"setZoomViaScrollAllowed",null),Me([(0,c.rc)(fa),I("design:type",Function),I("design:paramtypes",[Object,fa]),I("design:returntype",void 0)],U.prototype,"setVisible",null),Me([(0,c.rc)(og),I("design:type",Function),I("design:paramtypes",[Object,og]),I("design:returntype",void 0)],U.prototype,"setEnginePosition",null),Me([(0,c.rc)(sg),I("design:type",Function),I("design:paramtypes",[Object,sg]),I("design:returntype",void 0)],U.prototype,"resetEnginePosition",null),Me([(0,c.rc)(Qu),I("design:type",Function),I("design:paramtypes",[Object,Qu]),I("design:returntype",void 0)],U.prototype,"setChapter",null),Me([(0,c.rc)(hr),I("design:type",Function),I("design:paramtypes",[Object,hr]),I("design:returntype",void 0)],U.prototype,"setActiveTool",null),Me([(0,c.rc)(ys),I("design:type",Function),I("design:paramtypes",[Object,ys]),I("design:returntype",void 0)],U.prototype,"setGraph",null),Me([(0,c.rc)(nw),I("design:type",Function),I("design:paramtypes",[Object,ys]),I("design:returntype",void 0)],U.prototype,"clearGraph",null),Me([(0,c.rc)(rd),I("design:type",Function),I("design:paramtypes",[Object,rd]),I("design:returntype",void 0)],U.prototype,"setXrayMode",null),Me([(0,c.rc)(Zu),I("design:type",Function),I("design:paramtypes",[Object,Zu]),I("design:returntype",void 0)],U.prototype,"toggleProgressBar",null),Me([(0,c.rc)(mb),I("design:type",Function),I("design:paramtypes",[Object,mb]),I("design:returntype",void 0)],U.prototype,"toggleCameraBar",null),Me([(0,c.rc)(Sa),I("design:type",Function),I("design:paramtypes",[Object,Sa]),I("design:returntype",void 0)],U.prototype,"toggleLabels",null),Me([(0,c.rc)(Yu),I("design:type",Function),I("design:paramtypes",[Object,Yu]),I("design:returntype",void 0)],U.prototype,"synchronizeVisibleNodes",null),Me([(0,c.rc)(qu),I("design:type",Function),I("design:paramtypes",[Object,qu]),I("design:returntype",void 0)],U.prototype,"synchronizeRenderableNodes",null),Me([(0,c.rc)(Ku),I("design:type",Function),I("design:paramtypes",[Object,Ku]),I("design:returntype",void 0)],U.prototype,"synchronizePickableNodes",null),Me([(0,c.rc)(Ju),I("design:type",Function),I("design:paramtypes",[Object,Ju]),I("design:returntype",void 0)],U.prototype,"synchronizeAvailableNodes",null),Me([(0,c.rc)(ld),I("design:type",Function),I("design:paramtypes",[Object,ld]),I("design:returntype",void 0)],U.prototype,"playChapterAnimation",null),Me([(0,c.rc)(Yo),I("design:type",Function),I("design:paramtypes",[Object,Yo]),I("design:returntype",void 0)],U.prototype,"toggleAnimation",null),Me([(0,c.rc)(eg),I("design:type",Function),I("design:paramtypes",[Object,eg]),I("design:returntype",void 0)],U.prototype,"setAnimationPlaying",null),Me([(0,c.rc)(Ml),I("design:type",Function),I("design:paramtypes",[Object,Ml]),I("design:returntype",void 0)],U.prototype,"setPlaybackSpeed",null),Me([(0,c.rc)(tg),I("design:type",Function),I("design:paramtypes",[Object,tg]),I("design:returntype",void 0)],U.prototype,"setAutoplay",null),Me([(0,c.rc)(ng),I("design:type",Function),I("design:paramtypes",[Object,ng]),I("design:returntype",void 0)],U.prototype,"setObjectLayerOrder",null),Me([(0,c.rc)(ig),I("design:type",Function),I("design:paramtypes",[Object,ig]),I("design:returntype",void 0)],U.prototype,"setObjectDisplayName",null),Me([(0,c.rc)(Sb),I("design:type",Function),I("design:paramtypes",[Object,Sb]),I("design:returntype",void 0)],U.prototype,"autoSortObjectLayers",null),Me([(0,c.rc)(bb),I("design:type",Function),I("design:paramtypes",[Object,bb]),I("design:returntype",void 0)],U.prototype,"resetObjectLayers",null),Me([(0,c.rc)(yb),I("design:type",Function),I("design:paramtypes",[Object,yb]),I("design:returntype",void 0)],U.prototype,"setPostProcessingEffects",null),Me([(0,c.rc)(vb),I("design:type",Function),I("design:paramtypes",[Object,vb]),I("design:returntype",void 0)],U.prototype,"setProperties",null),Me([(0,c.rc)(Eb),I("design:type",Function),I("design:paramtypes",[Object,Eb]),I("design:returntype",void 0)],U.prototype,"setTransparencyMode",null),Me([(0,c.rc)(ba),I("design:type",Function),I("design:paramtypes",[Object,ba]),I("design:returntype",void 0)],U.prototype,"expandNode",null),Me([(0,c.rc)(cd),I("design:type",Function),I("design:paramtypes",[Object,cd]),I("design:returntype",void 0)],U.prototype,"collapseNode",null),Me([(0,c.rc)(Tb),I("design:type",Function),I("design:paramtypes",[Object,Tb]),I("design:returntype",void 0)],U.prototype,"collapseAllViewTreeNodes",null),Me([(0,c.rc)(ya),I("design:type",Function),I("design:paramtypes",[Object,ya]),I("design:returntype",void 0)],U.prototype,"hoverNode",null),Me([(0,c.rc)(_d),I("design:type",Function),I("design:paramtypes",[Object,_d]),I("design:returntype",void 0)],U.prototype,"setLabelEditNode",null),Me([(0,c.rc)(rg),I("design:type",Function),I("design:paramtypes",[Object,rg]),I("design:returntype",void 0)],U.prototype,"queryNodeInfo",null),Me([(0,c.rc)(ag),I("design:type",Function),I("design:paramtypes",[Object,ag]),I("design:returntype",void 0)],U.prototype,"queryNodeInfoSuccess",null),Me([(0,c.rc)(dd),I("design:type",Function),I("design:paramtypes",[Object,dd]),I("design:returntype",void 0)],U.prototype,"setNodeInfo",null),Me([(0,c.rc)(wl),I("design:type",Function),I("design:paramtypes",[Object,wl]),I("design:returntype",void 0)],U.prototype,"setContextMenu",null),Me([(0,c.rc)(lg),I("design:type",Function),I("design:paramtypes",[Object,lg]),I("design:returntype",void 0)],U.prototype,"setWatermarkEnabled",null),Me([(0,c.rc)(cg),I("design:type",Function),I("design:paramtypes",[Object,cg]),I("design:returntype",void 0)],U.prototype,"setWebGLContext",null),Me([(0,c.rc)(_g),I("design:type",Function),I("design:paramtypes",[Object,_g]),I("design:returntype",void 0)],U.prototype,"setEngineStatsEnabled",null),Me([(0,c.rc)(dg),I("design:type",Function),I("design:paramtypes",[Object,dg]),I("design:returntype",void 0)],U.prototype,"setHoverPick",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getEngine",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getReady",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getDisplay",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getScrollMode",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getVisible",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getViewGraph",null),Me([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([U.getViewGraph,Io.getShowUnavailableNodes]),I("design:type",Function),I("design:paramtypes",[Object,Boolean]),I("design:returntype",Object)],U,"getTreeGraph",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getViewGraphNode",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getEnginePosition",null),Me([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([U.getEnginePosition]),I("design:type",Function),I("design:paramtypes",[mg]),I("design:returntype",Number)],U,"getCanvasHeightBreakpoint",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getChapter",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getActiveTool",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getShowCameraBar",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getShowProgressBar",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getShowLabels",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getAnimationPlaying",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getAutoplay",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getXrayModeEnabled",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getHoveredNode",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getLabelEditNode",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getQuerying",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getContextmenu",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getPlaybackSpeed",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getWatermarkEnabled",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getWebGLContextName",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getStatsEnabled",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getShowAdvancedStatsTools",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getClickPickEnabled",null),Me([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[on]),I("design:returntype",void 0)],U,"getHoverPickEnabled",null),U=ja=Me([(0,c.Uw)({name:"engine",defaults:{loading:!1,ready:!1,viewGraph:{nodes:{},successors:{},predecessors:{},roots:{}},hoveredNode:void 0,labelEditNode:void 0,queryingAnatomy:!1,engine:"",chapter:"",showProgressBar:!0,showCameraBar:!0,showLabels:!0,activeTool:Ct.Select,animationPlaying:!1,autoplay:!0,display:!0,visible:!0,scrollMode:As.Capture,playbackSpeed:1,xrayModeEnabled:!1,contextmenu:{node:null,hit:null},watermarkEnabled:!1,stats:{enabled:!1,showAdvancedTools:!1},webGLContextName:void 0,pickState:{clickEnabled:!0,hoverEnabled:!0},xrRequesting:!1},children:[vt]}),I("design:paramtypes",[c.il,lo,Lt,ph,bi,qg,ws,cn])],U);var Ns,Yn,go=S(2914);function lv(n){return function QM(n){return new f.c(e=>{const o=new Image;o.onload=()=>{const i=function HM(n){const e=document.createElement("canvas"),o=e.getContext("2d");return e.width=n.naturalWidth,e.height=n.naturalHeight,o.drawImage(n,0,0),e}(o);e.next(i),e.complete()},o.onerror=()=>{const i=document.createElement("canvas");e.next(i),e.complete()},o.src=n})}(n).pipe((0,X.p)(e=>!(0,m.isNil)(e)),(0,go.n)(e=>new f.c(o=>{e.toBlob(i=>{o.next(i),o.complete()},"image/jpeg",100)})))}!function(n){function i(a,l){const _=new Na;if(a.thumbnails)_.legacy=!1,_.storyId=l,_.chapterId=a.id,_.urls={...a.thumbnails};else{const p=`/thumbs/${yt.Bookmark===Gd(l)?"bookmarks":"modules"}/${l.replace(".json","")}`;_.legacy=!0,_.storyId=l,_.chapterId=a.id,_.urls={small:`${p}/small/chapters/${a.id}.jpg`,large:`${p}/large/chapters/${a.id}.jpg`}}return _}n.generateLegacyThumbnail=function e(a,l){const p=`/thumbs/${yt.Bookmark===Gd(a)?"bookmarks":"modules"}/${a.replace(".json","")}`;return{small:`${p}/small/chapters/${l}.jpg`,large:`${p}/large/chapters/${l}.jpg`}},n.generateThumbnails=function o(a){return a.reduce((l,{originalChapterId:_,newChapterId:d,originalStoryId:p})=>{const u=yt.Bookmark===Gd(p),g=new Na;g.storyId=p,g.chapterId=_;const C=`/thumbs/${u?"bookmarks":"modules"}/${p.replace(".json","")}`;return g.urls={small:`${C}/small/chapters/${_}.jpg`,large:`${C}/large/chapters/${_}.jpg`},l.set(d,g),l},new Map)},n.getChapterThumbnail=i,n.getChapterThumbnails=function s(a,l){return l.reduce((_,d)=>{const p=i(d,a);return _.set(d.id,p),_},new Map)},n.makeFreshThumbnail=function r(a,l,_){return lv(_).pipe((0,X.p)(d=>!(0,m.isNil)(d)),(0,F.T)(d=>{const p=new Na;return p.snapshot=URL.createObjectURL(d),p.chapterId=l,p.storyId=a,p}))}}(Ns||(Ns={})),function(n){function e(r,a){const l=Object.entries(a);return l.sort((_,d)=>_[0].length===d[0].length?0:_[0].length<d[0].length?1:-1),l.reduce((_,[d,p])=>{if(_.startsWith(d)){const u=new RegExp(`^${d}`);_=_.replace(u,p)}return _},r||"")}n.renamespaceValue=e,n.renamespaceKeys=function o(r,a){return Object.entries(r).reduce((l,[_,d])=>(l[e(_,a)]=d,l),{})},n.renamespaceAssetLibrary=function i(r,a,l){if(!l)return r;const _=r.tweens.map(p=>e(p,a)),d=r.reflections.map(p=>e(p,a));return{...r,tweens:_,reflections:d}},n.renamespaceReflections=function s(r,a,l){return l?(0,m.mapValues)(r,_=>e(_,a)):r}}(Yn||(Yn={}));var Mt=function(n){return n.DirectionalVelocity="DirectionalVelocity",n.Lifetime="Lifetime",n.PointPosition="PointPosition",n.RandomVelocity="RandomVelocity",n.SpherePosition="SpherePosition",n.CylinderPosition="CylinderPosition",n.CubePosition="CubePosition",n.RandomRotation="RandomRotation",n.RandomRotationSpeed="RandomRotationSpeed",n.RandomScale="RandomScale",n.SpriteAnimationDuration="SpriteAnimationDuration",n}(Mt||{}),Ft=function(n){return n.AgeColorBlend="AgeColorBlend",n.BrownianMotion="BrownianMotion",n.UniformForce="UniformForce",n.RadialForce="RadialForce",n.Friction="Friction",n.Gravity="Gravity",n.Path="Path",n.AxisForce="AxisForce",n.SpriteAnimation="SpriteAnimation",n}(Ft||{}),Ln=function(n){return n.LifetimeKill="LifetimeKill",n.LifetimeStop="LifetimeStop",n.PathKill="PathKill",n.PathStop="PathStop",n.PathRadius="PathRadius",n.ShapeBounce="ShapeBounce",n.ShapeKill="ShapeKill",n.ShapeStop="ShapeStop",n}(Ln||{}),uh=function(n){return n.Sphere="Sphere",n.Plane="Plane",n.Cube="Cube",n.Cylinder="Cylinder",n}(uh||{}),gh=function(n){return n.In="in",n.Out="out",n}(gh||{});const qM=["objectId","displayName","geometryId","morphId","materialId","transformId"],KM=["geometryId","materialId","morphId"];function cv(n,e){return{availableObjects:(0,m.mapKeys)(n.availableObjects,(l,_)=>Yn.renamespaceValue(_,e)),showObjects:(0,m.mapKeys)(n.showObjects,(l,_)=>Yn.renamespaceValue(_,e)),selectObjects:(0,m.mapKeys)(n.selectObjects,(l,_)=>Yn.renamespaceValue(_,e)),pickThroughObjects:(0,m.mapKeys)(n.pickThroughObjects,(l,_)=>Yn.renamespaceValue(_,e)),synchronization:(0,m.mapKeys)(n.synchronization,(l,_)=>Yn.renamespaceValue(_,e))}}function JM(n,e){const o=i=>i.map(s=>s.type===Ni.flyToChapter||s.type===Ni.flyToObject?{...s,value:Yn.renamespaceValue(s.value,e)}:s);return(n||[]).map(i=>({...i,objectId:Yn.renamespaceValue(i.objectId,e),states:i.states.map(s=>({...s,errands:o(s.errands)}))}))}function ZM(n,e){return(n||[]).map(o=>(o.data.timeline=e[o.data.timeline]||o.data.timeline,o))}function eI(n,e){return(n||[]).map(o=>(o.objectId&&(o.objectId=Yn.renamespaceValue(o.objectId,e)),o))}function tI(n,e){return n?{xray:(0,m.mapKeys)(n.xray,(o,i)=>Yn.renamespaceValue(i,e)),highlight:(0,m.mapKeys)(n.highlight,(o,i)=>Yn.renamespaceValue(i,e))}:{}}function nI(n,e){const i={...n};return Array.isArray(n?.layers)&&(i.layers=n.layers.map(s=>({...s,objectIds:s.objectIds.map(r=>Yn.renamespaceValue(r,e))}))),i}function _v(n,e){return n.forEach(o=>{qM.forEach(i=>{const s=o[i];s&&"string"==typeof s&&(o[i]=Yn.renamespaceValue(s,e))}),o.renderables?.forEach(i=>{KM.forEach(s=>{const r=i[s];r&&"string"==typeof r&&(i[s]=Yn.renamespaceValue(r,e))})}),o.objects&&_v(o.objects,e)}),n}function sI(n,e){function o(r=[]){return r.map(a=>({...a,src:Yn.renamespaceValue(a.src,e)}))}let s=[];return n&&Array.isArray(n.particleSystems)&&(s=n.particleSystems.map(function i(r){return function YM(n){return"material"in n&&!("workflow"in n.material)}(r)?{...r,textures:o(r.textures)}:{...r}})),s}function rI(n,e){const o=function oI(n,e){return"string"==typeof n?[e[n]||n]:n.map(o=>e[o]||o)}(n.stateId,e),i=n.assetLibraries.tweens.map(d=>Yn.renamespaceValue(d,e)),s=n.assetLibraries.reflections.map(d=>Yn.renamespaceValue(d,e)),r=(0,m.mapValues)(n.reflections,(d,p)=>Yn.renamespaceValue(d,e)),a=function iI(n,e){return n.map(o=>({...o,...cv(o,e),colorRecipeObjects:tI(o.colorRecipeObjects,e),timelineMap:ZM(o.timelineMap,e),labels:JM(o.labels,e),hotspots:eI(o.hotspots,e),visibilityLayers:nI(o.visibilityLayers,e)}))}(n.chapters,e),l=_v(n.sceneGraph,e),_={...n.customData,particleSystems:sI(n.customData,e)};return{...n,stateId:o,...cv(n,e),assetLibraries:{...n.assetLibraries,tweens:i,reflections:s},reflections:r,chapters:a,sceneGraph:l,customData:_}}const $d="context-label";class Bi{}let Xl=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.sceneService=s,this.markers=new Map,this.initMarkerEvents()}getMarkerWorldPosition(i){if((0,m.isNil)(i))return;const s=Ee.clone(i.marker3D.position);return Ee.scale(s,s,1/ee.BIODIGITAL_SCENE_SCALE),s}getMarkerById(i){return this.markers.get(i)}createMarker(i){const{id:s,objectId:r,primitiveIndex:a,renderableIndex:l,barycentric:_,pos:d}=i,{engine:p}=this.engineService,{activeChapter:u,chapters:g}=p.story,y=g.find(x=>x.id===i.chapterId)??u,C=a>=0?"primitive":"object";if(!r)return console.warn("An object id is required for creating a marker.",{id:s}),null;const O=this.sceneService.getObjectById(r);if((0,m.isNil)(O))return console.warn("A valid object id is required for creating a marker.",{id:s,objectId:r}),null;let L=d?Ee.clone(d):void 0;"object"===C&&(0,m.isNil)(L)&&(L=this.sceneService.getObjectBoundaryCenter(r)),(0,m.isNil)(L)||Ee.scale(L,L,ee.BIODIGITAL_SCENE_SCALE);const q=new ee.BioDigitalScreenMarker(p,y,{object:O,trackingMode:C,renderableIndex:l||0,primitiveIndex:a,barycenter:_||[1/3,1/3,1/3],worldPosition:L,variantIndex:O.variant},s);return this.markers.set(s,q),q.update(),q}deleteMarker(i){this.markers.get(i)?.destroy(),this.markers.delete(i)}deleteMarkers(){this.markers.forEach(i=>i.destroy()),this.markers.clear()}initMarkerEvents(){this.engineService.engineCreated$.subscribe(i=>{i.renderer.on("update",()=>{this.updateMarkers()})})}updateMarkers(){0!==this.markers.size&&(this.markers.forEach(i=>i.update()),this.engineService.fireEvent(pe.SceneMarkersUpdated,this.markers))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Rs,xa,kt=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},ce=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const dv={enableContextLabel:{enable:!0,enableInfo:!0,enableActions:!0,enableAudio:!0},loading:!1,labelsCollapsed:!1,labelsCollapsedMode:Pr.None,labelScale:null,labels:[],contextLabel:null,selectedLabel:null,draggable:{pin:!0,tag:!0}};let ye=(Rs=class{static getLabels(e){return e.labels}static getLabelsCollapsed(e){return e.labelsCollapsed}static getLabelsCollapsedMode(e){return e.labelsCollapsedMode}static getSelectedLabelId(e){return e.selectedLabel}static getSelectedLabel(e){return e.labels.find(o=>o.id===e.selectedLabel)||null}static getContextLabel(e){return e.contextLabel}static getChapterLabels(e,o){return e.labels.filter(i=>i.chapterId===o.selectedChapter)}static getChapterSequentialLabels(e){return(0,c.Mz)([xa,E],(o,i)=>o.labels.filter(s=>s.chapterId===i.selectedChapter&&s.pinType===_n.Sequential&&s.sequentialType===e))}static getLabelSequence(e){return(0,c.Mz)([xa,xa.getChapterSequentialLabels(co.Alphabetical),xa.getChapterSequentialLabels(co.Numerical)],(o,i,s)=>{if(e.pinType!==_n.Sequential)return null;switch(e.sequentialType){case co.Alphabetical:{const r=i.findIndex(a=>a.id===e.id);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(r)}case co.Numerical:return s.findIndex(r=>r.id===e.id)+1}})}static getEnableContextLabel(e){return e.enableContextLabel.enable}static getEnableContextLabelInfo(e){return e.enableContextLabel.enableInfo}static getEnableContextLabelActions(e){return e.enableContextLabel.enableActions}static getEnableContextLabelAudio(e){return e.enableContextLabel.enableAudio}static getLabelsDraggable(e){return e.draggable}static getLabelScale(e){return e.labelScale}PatchLabels(e,o){const i=re.$i(e.getState(),o.patches);e.patchState(i)}setLabelOffset(e,o){const[i,s,r]=re.vI(e.getState(),a=>{const l=a.labels.find(_=>_.id===o.labelId);l&&(l.offset=o.offset)});e.patchState(i),this.savePatches(s,r)}setLabels(e,o){e.patchState(re.jM(e.getState(),i=>{i.labels=o.labels}))}setLabel(e,o){const[i,s,r]=re.vI(e.getState(),a=>{a.labels=a.labels.map(l=>l.id===o.label.id?o.label:l)});e.patchState(i),o.record&&this.savePatches(s,r)}setLabelStates(e,o){const[i,s,r]=re.vI(e.getState(),a=>{a.labels.find(_=>_.id===o.id).states=o.states});e.patchState(i),this.savePatches(s,r)}setLabelScale(e,o){e.patchState({labelScale:o.scale})}addLabel(e,o){const[i,s,r]=re.vI(e.getState(),a=>{const l=o.label.id||An.idWithPrefix("label"),_={...o.label,id:l};a.labels.push(_)});e.patchState(i),o.record&&this.savePatches(s,r)}addContextLabel(e,o){const i=re.jM(e.getState(),s=>{s.contextLabel={...o.label,id:$d}});e.patchState(i)}removeLabel(e,o){const[i,s,r]=re.vI(e.getState(),a=>{a.labels=a.labels.filter(l=>l.id!==o.label.id)});e.patchState(i),this.markerService.deleteMarker(o.label.id),this.savePatches(s,r)}removeContextLabel(e,o){const i=re.jM(e.getState(),s=>{s.contextLabel=void 0});this.markerService.deleteMarker($d),e.patchState(i)}removeAllChapterLabels(e,o){const[i,s,r]=re.vI(e.getState(),a=>{const[l,_]=(0,m.partition)(a.labels,d=>d.chapterId!==o.chapter.id);_.forEach(d=>this.markerService.deleteMarker(d.id)),a.labels=l});e.patchState(i),o.record&&this.savePatches(s,r)}selectLabel(e,o){e.patchState({selectedLabel:o.label?o.label.id:null})}resetLabels(e,o){const i=e.getState();this.markerService.deleteMarker($d),i.labels.forEach(s=>{this.markerService.deleteMarker(s.id)}),e.setState(re.jM(e.getState(),s=>{}))}convertLabels(e,o){const[i,s,r]=re.vI(e.getState(),a=>{o.labels.forEach(l=>{const _=a.labels.findIndex(d=>d.id===l.id);a.labels[_]={...a.labels[_],...o.fields}})});e.setState({...i}),this.savePatches(s,r)}enableContextLabel(e,o){e.patchState({enableContextLabel:{...o}})}setLabelsShown(e,{labels:o,shown:i}){const s=e.getState().labels.map(r=>{const a=o.some(l=>l.id===r.id);return{...r,shown:a?i:r.shown}});e.patchState({labels:[...s]})}setAllLabelsShown(e,{show:o}){const i=e.getState().labels;e.dispatch(new os(i,o))}setLabelsCollapsed(e,{collapsed:o,collapsedMode:i}){e.patchState({labelsCollapsed:o,labelsCollapsedMode:i})}setLabelsDraggable(e,o){e.patchState({draggable:{...o.draggable}})}savePatches(e,o){this.store.dispatch(new Ut.SavePatches([{forward:e,inverse:o,patchAction:Zg}]))}constructor(e,o){this.store=e,this.markerService=o}},xa=Rs,Rs.\u0275fac=function(e){return new(e||Rs)(t.KVO(c.il),t.KVO(Xl))},Rs.\u0275prov=t.jDH({token:Rs,factory:Rs.\u0275fac}),Rs);kt([(0,c.rc)(Zg),ce("design:type",Function),ce("design:paramtypes",[Object,Zg]),ce("design:returntype",void 0)],ye.prototype,"PatchLabels",null),kt([(0,c.rc)(eh),ce("design:type",Function),ce("design:paramtypes",[Object,eh]),ce("design:returntype",void 0)],ye.prototype,"setLabelOffset",null),kt([(0,c.rc)(Ua),ce("design:type",Function),ce("design:paramtypes",[Object,Ua]),ce("design:returntype",void 0)],ye.prototype,"setLabels",null),kt([(0,c.rc)(Rr),ce("design:type",Function),ce("design:paramtypes",[Object,Rr]),ce("design:returntype",void 0)],ye.prototype,"setLabel",null),kt([(0,c.rc)(Qy),ce("design:type",Function),ce("design:paramtypes",[Object,Qy]),ce("design:returntype",void 0)],ye.prototype,"setLabelStates",null),kt([(0,c.rc)(xd),ce("design:type",Function),ce("design:paramtypes",[Object,xd]),ce("design:returntype",void 0)],ye.prototype,"setLabelScale",null),kt([(0,c.rc)(Nr),ce("design:type",Function),ce("design:paramtypes",[Object,Nr]),ce("design:returntype",void 0)],ye.prototype,"addLabel",null),kt([(0,c.rc)(th),ce("design:type",Function),ce("design:paramtypes",[Object,th]),ce("design:returntype",void 0)],ye.prototype,"addContextLabel",null),kt([(0,c.rc)(Va),ce("design:type",Function),ce("design:paramtypes",[Object,Va]),ce("design:returntype",void 0)],ye.prototype,"removeLabel",null),kt([(0,c.rc)(ns),ce("design:type",Function),ce("design:paramtypes",[Object,ns]),ce("design:returntype",void 0)],ye.prototype,"removeContextLabel",null),kt([(0,c.rc)(nh),ce("design:type",Function),ce("design:paramtypes",[Object,nh]),ce("design:returntype",void 0)],ye.prototype,"removeAllChapterLabels",null),kt([(0,c.rc)(is),ce("design:type",Function),ce("design:paramtypes",[Object,is]),ce("design:returntype",void 0)],ye.prototype,"selectLabel",null),kt([(0,c.rc)(ih),ce("design:type",Function),ce("design:paramtypes",[Object,ih]),ce("design:returntype",void 0)],ye.prototype,"resetLabels",null),kt([(0,c.rc)(Yy),ce("design:type",Function),ce("design:paramtypes",[Object,Yy]),ce("design:returntype",void 0)],ye.prototype,"convertLabels",null),kt([(0,c.rc)(oh),ce("design:type",Function),ce("design:paramtypes",[Object,oh]),ce("design:returntype",void 0)],ye.prototype,"enableContextLabel",null),kt([(0,c.rc)(os),ce("design:type",Function),ce("design:paramtypes",[Object,os]),ce("design:returntype",void 0)],ye.prototype,"setLabelsShown",null),kt([(0,c.rc)(Fl),ce("design:type",Function),ce("design:paramtypes",[Object,Fl]),ce("design:returntype",void 0)],ye.prototype,"setAllLabelsShown",null),kt([(0,c.rc)(sh),ce("design:type",Function),ce("design:paramtypes",[Object,sh]),ce("design:returntype",void 0)],ye.prototype,"setLabelsCollapsed",null),kt([(0,c.rc)(rh),ce("design:type",Function),ce("design:paramtypes",[Object,rh]),ce("design:returntype",void 0)],ye.prototype,"setLabelsDraggable",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getLabels",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getLabelsCollapsed",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getLabelsCollapsedMode",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getSelectedLabelId",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getSelectedLabel",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getContextLabel",null),kt([(0,c.MD)([E]),ce("design:type",Function),ce("design:paramtypes",[Bi,wt]),ce("design:returntype",void 0)],ye,"getChapterLabels",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getEnableContextLabel",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getEnableContextLabelInfo",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getEnableContextLabelActions",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getEnableContextLabelAudio",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getLabelsDraggable",null),kt([(0,c.MD)(),ce("design:type",Function),ce("design:paramtypes",[Bi]),ce("design:returntype",void 0)],ye,"getLabelScale",null),ye=xa=kt([(0,c.Uw)({name:"labels",defaults:dv}),ce("design:paramtypes",[c.il,Xl])],ye);let pv=(()=>{var n;class e{constructor(i){this.engineService=i}createEngineClippingPlanes(i){return(0,ee.makeClippingPlanes)(i)}setClippingPlanes(i){const{renderer:s,story:r}=this.engineService.engine,{activeChapter:a}=r;if((0,m.isNil)(a))return;const l=this.createEngineClippingPlanes(i);a.clippingPlanes.length=0,a.clippingPlanes.push(...l),s.setClippingPlanes(l)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const hh=1e-4;function Fd(n,e){const o={};return Math.abs(n[0]-e)>=hh&&(o.x=n[0]),Math.abs(n[1]-e)>=hh&&(o.y=n[1]),Math.abs(n[2]-e)>=hh&&(o.z=n[2]),o.x||o.y||o.z?o:null}function uv(n,e){if(e[n.objectId])return null;let o={objectId:n.objectId,displayName:n.displayName,layer:n.layer};return n.transformId?o.transformId=n.transformId:o=function aI(n,e){const o=ee.vec3Pool.get();Ee.scale(o,n.sceneNode.rotation,180/Math.PI);const i={translate:Fd(n.sceneNode.position,0),rotate:Fd(o,0),scale:Fd(n.sceneNode.scale,1),pivot:Fd(n.sceneNode.origin,0)};return ee.vec3Pool.release(o),(0,m.isNull)(i.translate)||(e.translate=i.translate),(0,m.isNull)(i.rotate)||(e.rotate=i.rotate),(0,m.isNull)(i.scale)||(e.scale=i.scale),(0,m.isNull)(i.pivot)||(e.pivot=i.pivot),e.transformId&&(console.error("There should not be a transform"),delete e.transformId),e}(n,o),o=function lI(n,e){const i=gv(n.renderables??[]);return 1===i.length?(0,m.merge)(e,i[0]):i.length>1&&(e.renderables=i),e}(n,o),n.children&&n.children.length&&(o.objects=[]),n.children.forEach(i=>{const s=uv(i,e);null!==s&&o.objects.push(s)},this),n.variants?.length>1&&(o.variants=n.variants.map(i=>gv(i))),o}function gv(n){return n.map(e=>{const{geometryId:o,morphId:i,materialId:s,layer:r}=e;return{geometryId:o,morphId:i,materialId:s,layer:r}})}let mh=(()=>{var n;class e{constructor(i,s,r,a,l,_,d,p){this.store=i,this.engineService=s,this.chapterSerializer=r,this.animationService=a,this.chapterService=l,this.paintService=_,this.clippingPlanesService=d,this.sceneService=p}serializeUI(i){const s={...i.ui};return i.chapters.length>1&&(s.scrubber=!1,s.playPause=!1,s.tour={chapters:!0}),s}serializeAnimation(i){return this.animationService.isChapterAnimated(i)?{play:{startTime:i.timelineMap[0].start,loop:!1!==i.loop,numChapters:1}}:{}}getClippedObjects(){const i=this.store.selectSnapshot(E.getSelectedChapterClippingPlanes),s=this.clippingPlanesService.createEngineClippingPlanes(i);return 0===s.length?{}:this.sceneService.getLeafIds().reduce((r,a)=>{const l=this.sceneService.getObjectById(a);return this.sceneService.isObjectCulledByClip(l,s)&&(r[a]=!0),r},{})}generateTrimObjectMap(i){const s={};if(i.graph.unavailable){const a=this.store.selectSnapshot(Re.getAllNodeState);Object.values(a).forEach(l=>{Object.entries(l).forEach(([_,d])=>{!1!==s[_]&&(s[_]=!d.available)})})}if(i.graph.hidden){const a=this.store.selectSnapshot(Re.getAllNodeState);Object.values(a).forEach(l=>{Object.entries(l).forEach(([_,d])=>{!1!==s[_]&&(s[_]=!(d.shown||d.shownSetByTween))})})}const r=i.graph.clipped?this.getClippedObjects():{};return{...s,...r}}trimObjects(i,s){if(s[i.objectId])return null;const r=[];return i.children.forEach(a=>{const l=this.trimObjects(a,s);(0,m.isNil)(l)||r.push(l)}),i.children=r,i}serialize(i,s,r=!1,a,l,_){const d=(0,m.cloneDeep)(a),p=this.generateTrimObjectMap(s),u=this.sceneService.getRootObjects();d.sceneGraph=function cI(n,e){const o=[];return Object.entries(n).forEach(([i,s])=>{const r=uv(s,e);null!==r&&o.push(r)},this),o}(u,p);const g=[];Object.values(u).forEach(te=>{const se=this.trimObjects(te,p);null!==se&&g.push(se)},this);const y=ud(this.paintService.getColorRecipes()),C=ug(g,y),O=this.store.selectSnapshot(ye.getLabels);d.chapters=l.map(te=>this.chapterSerializer.serializeChapter(C,te,i,O,_)),d.ui=this.serializeUI(d),d.animation=this.serializeAnimation(l[0]),d.customData={...d.customData,particleSystems:this.store.selectSnapshot(St.getParticleSystemsList)},d.sourceInfo=av(d.sourceInfo);const L=this.store.selectSnapshot(G.getAllQuestions),$=this.store.selectSnapshot(G.getQuizSettings);$&&L.length>0?d.quizSettings=$:delete d.quizSettings,d.playthroughSettings=a.playthroughSettings,d.tweenParticleLookup=this.store.selectSnapshot(St.getTweenParticleLookup);const q=l.reduce((te,se)=>te.concat(this.chapterService.getChapterLightLibraries(se)),[]),x=Array.from(new Set(q));d.assetLibraries.lights.forEach(te=>{x.includes(te)||x.push(te)}),d.assetLibraries.lights=x;const k=this.getReflectionLibraries(d.reflections),A=l.reduce((te,se)=>te.concat(this.chapterService.getChapterReflectionLibraries(se)),[]);d.assetLibraries.reflections=Array.from(new Set(k.concat(A)));const R=[...Object.values(d.assetLibraries)].flat(),Z=this.getSceneGraphStateIds(d.sceneGraph);return d.stateId=Array.from(new Set(R.map(this.getStateId).concat(Z))),(0,m.isEmpty)(a.variantSchemas)?delete d.variantSchemas:d.variantSchemas=a.variantSchemas,{story:r?rI(d,i):d}}getReflectionLibraries(i){return i=i||{},Object.values(i).map(r=>{const a=r.split(".");return[a[0],a[1]].join("/")})}getSceneGraphStateIds(i){return i.map(s=>s.objectId.split("-")[0])}getStateId(i){return i.split("/")[0]}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(Lt),t.KVO(Hy),t.KVO(bi),t.KVO($l),t.KVO(Mr),t.KVO(pv),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class hv{constructor(){this.graph={unavailable:!1,hidden:!1,clipped:!1}}}var ks,Bd,Pt=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},le=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const mv={loading:!1,incoming:{id:void 0,type:void 0},storyId:void 0,storyType:void 0,storyLang:void 0,loadingChapter:null,loadChapters:[],loadChaptersRemaining:[],thumbnailLookup:[],manifestsMaxTimes:void 0};let Pe=(Bd=ks=class{static getStory(e){return e.story}static getStoryId(e){return e.storyId}static getStoryType(e){return e.storyType}static getLoadingChapter(e){return e.loadingChapter}static getLoadChapters(e){return e.loadChapters}static getLoadChaptersRemaining(e){return e.loadChaptersRemaining}static getStoryInfo(e){return{id:e.storyId,type:e.storyType}}static getIncomingStoryInfo(e){return e.incoming}static getStoryTags(e){return e?.story?.tags??[]}static getStoryLanguage(e){return e.storyLang??Zi.lang}static getAnimationManifests(e){return e.manifestsMaxTimes}static getStorySourceInfo(e){return e.story?.sourceInfo}static getVariantSchemas(e){return e.story?.variantSchemas??{}}static getVariantSchema(e){return(0,c.Mz)([Bd.getVariantSchemas],o=>o[e])}setStoryText(e,o){const i=e.getState().story;i&&e.patchState({story:{...i,displayName:o.displayName}})}setStoryTags(e,{tags:o}){const i=e.getState().story;i&&e.patchState({story:{...i,tags:o}})}setStoryPlaythrough(e,{playthroughSettings:o}){const i=e.getState().story;i&&e.patchState({story:{...i,playthroughSettings:o}})}setStorySourceInfo(e,{sourceInfo:o}){const i=e.getState().story;i&&e.patchState({story:{...i,sourceInfo:o}})}loadManifests(e){e.patchState({manifestsMaxTimes:void 0});const o=this.storyService.getTweenEndTimes(),i=Object.values(this.sceneService.getObjects());this.storyService.findMorphEndTimes(i).subscribe(s=>{e.patchState({manifestsMaxTimes:{...s,...o}})})}setStoryLightLibs(e,o){const i=e.getState().story;i&&e.patchState({story:{...i,assetLibraries:{...i.assetLibraries,lights:o.lightLibs}}})}setStory(e,o){e.patchState({story:o.story})}SetStoryId(e,o){e.patchState({storyId:o.id})}setIncomingStory(e,o){const i=e.getState(),{id:s,type:r,reset:a}=o;(s!==i.storyId||a)&&e.patchState({incoming:{id:s,type:r}})}loadStory(e,o){const i=o.preview?(0,Ra.H)(this.storageService.getDatabaseItem(Ke.PreviewStory)):this.storyService.getStory(o.id,o.type,o.lang),s=this.storyService.getStoryLang(o.id,o.type,o.lang);(0,si.p)([i,s]).subscribe(([r,a])=>{e.dispatch(new id(r,o.id,o.type,a))},()=>{!0===this.reload?(this.reload=!1,this.loadStory(e,o)):e.dispatch(new cb(o.id,o.type))})}loadStorySuccess(e,{story:o,id:i,type:s,lang:r}){e.patchState({story:o,storyId:i,storyType:s,storyLang:r}),e.dispatch(new Bu(i,o,s))}buildStoryWorkflow(e,o,i,s,r=0,a=new Map,l=!0){if((0,m.isNil)(this.engineService.engine))return;l&&(i.moduleId=o,this.engineService.setStory(i),e.patchState({storyId:o,story:i})),this.engineService.engine.start();const _=this.sceneService.getRootObjects(),d=this.storyService.getStoryChapters(_,i,s);let p=[];d.forEach(q=>{p=[...p,...q.labels]});const u=this.storyService.getStoryLoadChapters(i);e.patchState({loadChapters:u,loadChaptersRemaining:u,incoming:{id:void 0,type:void 0}});const g=this.sceneService.getSceneGraph(_),y=d.reduce((q,x)=>(q[x.id]=Qw(g,x.showObjects,x.availableObjects,x.pickThroughObjects,x.synchronization),q),{});d.forEach(q=>{((0,m.isNil)(q.createdFrom)||0===q.createdFrom.length)&&(q.createdFrom=[{id:o,timestamp:Date.now()}])}),e.dispatch(new Dg(y)),e.dispatch(new Oa(d[r].id)),e.dispatch(new Dl(d)),e.dispatch(new Rd(a)),e.dispatch(new Ua(p)),e.dispatch(new eo(d[r]));const C=i.tweenParticleLookup??{},O=i.customData?.particleSystems??[],L=d.reduce((q,x)=>(q[x.id]=x.customData?.particleSystems??[],q),{});e.dispatch(new Ue.SetParticleState(O,L,C)),e.dispatch(new Te.ResetQuizState),i.quizSettings&&e.dispatch(new Te.SetQuizSettings(i.quizSettings));const $=Ry(d);e.dispatch(new Te.SetQuestions($)),e.dispatch(new Wu),e.dispatch(new D.SetChapterCallToActionSeen(!1)),e.dispatch(new lb(i,o,s)),e.dispatch(new $u)}importStorySuccess(e,o){const i=e.getState(),s=i.storyType,r=i.storyId,l=new hv,d=this.store.selectSnapshot(Bd.getStory),p=this.store.selectSnapshot(E.getStoryChapters),u=jd(p,!1),g=this.serializeModuleService.serialize({},l,!1,d,p,u).story,y=XM(g,r,o.story,o.id,he.exportType),C=y.chapters.slice(g.chapters.length).reduce((L,$,q)=>(L[o.story.chapters[q].id]=$.id,L),{}),O=o.story.chapters.reduce((L,$)=>{const q=$.thumbnails?$.thumbnails.large:Ns.generateLegacyThumbnail(o.id,$.id).large,x=Ns.makeFreshThumbnail(r,C[$.id],q);return L.push(x),L},[]);(0,si.p)(O).subscribe(L=>{const $=this.store.selectSnapshot(oi.getRegisteredThumbnails);L.forEach(q=>{$.set(q.chapterId,q)}),this.buildStoryWorkflow(e,r,y,s,y.chapters.length-1,$)})}buildStory(e,o){const i=Ns.getChapterThumbnails(o.id,o.story.chapters);this.buildStoryWorkflow(e,o.id,o.story,o.type,o.chapterIdx||0,i,o.replaceActiveStory)}loadChapter(e){const o=e.getState().loadChaptersRemaining[0];if(!o)return;e.patchState({loadingChapter:o});let i=!1;this.storyService.loadChapter(o).then(()=>{}).catch(s=>{(0,m.isNil)(this.engineService.engine?.story)?i=!0:console.error(s)}).finally(()=>{i?console.warn(`Loading of chapter ${o.chapterId} cancelled.`):e.dispatch([new ma(o),new $u])})}reorderLoadChapters(e,o){const{loadChaptersRemaining:i}=e.getState(),[s,r]=(0,m.partition)(i,a=>a.chapterId===o.chapterId);e.patchState({loadChaptersRemaining:[...s,...r]})}loadChapterSuccess(e,o){const i=e.getState().loadChaptersRemaining.filter(s=>s.chapterId!==o.chapter.chapterId);e.patchState({loadingChapter:null,loadChaptersRemaining:i}),e.dispatch(new vd(o.chapter.chapterId,{model:!0,animation:!1,...o.chapter.readyState})),e.dispatch(new Ig(o.chapter.chapterId))}synchronizeChapters(e){const o=this.store.selectSnapshot(E.getStoryChapters),{story:i}=e.getState();e.patchState({story:{...i,chapters:[...o]}})}importStory(e,o){this.storyService.getStory(o.id,o.type,o.lang).subscribe(i=>{e.dispatch(new zu(i,o.id,o.type))})}resetStory(e){e.setState(mv)}mergeBridgeModuleSuccess(e,{story:o}){const i=e.getState(),s=this.store.selectSnapshot(E.getSelectedChapterIndex),r=Ns.getChapterThumbnails(i.storyId,o.chapters);this.buildStoryWorkflow(e,i.storyId,o,yt.Module,s,r)}constructor(e,o,i,s,r,a){this.store=e,this.storyService=o,this.serializeModuleService=i,this.storageService=s,this.sceneService=r,this.engineService=a,this.reload=he.native}},ks.\u0275fac=function(e){return new(e||ks)(t.KVO(c.il),t.KVO(kr),t.KVO(mh),t.KVO(Le),t.KVO(cn),t.KVO(Lt))},ks.\u0275prov=t.jDH({token:ks,factory:ks.\u0275fac}),ks);Pt([(0,c.rc)(ib),le("design:type",Function),le("design:paramtypes",[Object,ib]),le("design:returntype",void 0)],Pe.prototype,"setStoryText",null),Pt([(0,c.rc)(ob),le("design:type",Function),le("design:paramtypes",[Object,ob]),le("design:returntype",void 0)],Pe.prototype,"setStoryTags",null),Pt([(0,c.rc)(sb),le("design:type",Function),le("design:paramtypes",[Object,sb]),le("design:returntype",void 0)],Pe.prototype,"setStoryPlaythrough",null),Pt([(0,c.rc)(rb),le("design:type",Function),le("design:paramtypes",[Object,rb]),le("design:returntype",void 0)],Pe.prototype,"setStorySourceInfo",null),Pt([(0,c.rc)(JO),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],Pe.prototype,"loadManifests",null),Pt([(0,c.rc)(ab),le("design:type",Function),le("design:paramtypes",[Object,ab]),le("design:returntype",void 0)],Pe.prototype,"setStoryLightLibs",null),Pt([(0,c.rc)(tb),le("design:type",Function),le("design:paramtypes",[Object,tb]),le("design:returntype",void 0)],Pe.prototype,"setStory",null),Pt([(0,c.rc)(nb),le("design:type",Function),le("design:paramtypes",[Object,nb]),le("design:returntype",void 0)],Pe.prototype,"SetStoryId",null),Pt([(0,c.rc)(nd),le("design:type",Function),le("design:paramtypes",[Object,nd]),le("design:returntype",void 0)],Pe.prototype,"setIncomingStory",null),Pt([(0,c.rc)(td),le("design:type",Function),le("design:paramtypes",[Object,td]),le("design:returntype",void 0)],Pe.prototype,"loadStory",null),Pt([(0,c.rc)(id),le("design:type",Function),le("design:paramtypes",[Object,id]),le("design:returntype",void 0)],Pe.prototype,"loadStorySuccess",null),Pt([(0,c.rc)(zu),le("design:type",Function),le("design:paramtypes",[Object,zu]),le("design:returntype",void 0)],Pe.prototype,"importStorySuccess",null),Pt([(0,c.rc)(Bu),le("design:type",Function),le("design:paramtypes",[Object,Bu]),le("design:returntype",void 0)],Pe.prototype,"buildStory",null),Pt([(0,c.rc)($u),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],Pe.prototype,"loadChapter",null),Pt([(0,c.rc)(Fu),le("design:type",Function),le("design:paramtypes",[Object,Fu]),le("design:returntype",void 0)],Pe.prototype,"reorderLoadChapters",null),Pt([(0,c.rc)(ma),le("design:type",Function),le("design:paramtypes",[Object,ma]),le("design:returntype",void 0)],Pe.prototype,"loadChapterSuccess",null),Pt([(0,c.rc)(ZO),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],Pe.prototype,"synchronizeChapters",null),Pt([(0,c.rc)(_b),le("design:type",Function),le("design:paramtypes",[Object,_b]),le("design:returntype",void 0)],Pe.prototype,"importStory",null),Pt([(0,c.rc)(db),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],Pe.prototype,"resetStory",null),Pt([(0,c.rc)(ew),le("design:type",Function),le("design:paramtypes",[Object,Object]),le("design:returntype",void 0)],Pe.prototype,"mergeBridgeModuleSuccess",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStory",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStoryId",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStoryType",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getLoadingChapter",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getLoadChapters",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getLoadChaptersRemaining",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStoryInfo",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getIncomingStoryInfo",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStoryTags",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStoryLanguage",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getAnimationManifests",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",void 0)],Pe,"getStorySourceInfo",null),Pt([(0,c.MD)(),le("design:type",Function),le("design:paramtypes",[$i]),le("design:returntype",Object)],Pe,"getVariantSchemas",null),Pe=Bd=Pt([(0,c.Uw)({name:"story",defaults:mv}),le("design:paramtypes",[c.il,kr,mh,Le,cn,Lt])],Pe);var Po,Tt=S(2656),Vt=S(7365),hn=S(5426),Ao=S(6718),Hl=S(5160);!function(n){function o(d){r()&&(d||(d=document.body),d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen())}function i(){r()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function s(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}function r(){return!!s()||(console.warn("Fullscreen is not enabled"),!1)}function a(){return document.fullscreenElement||document.webkitFullscreenElement}function l(){return!(0,m.isNil)(a())}n.toggleFullscreen=function e(d){const p=a();(0,m.isNil)(p)?o(d):i()},n.requestFullscreen=o,n.exitFullscreen=i,n.canFullscreen=s,n.checkFullscreenSupport=r,n.getFullscreenElement=a,n.isFullscreen=l,n.onFullscreenChange=function _(){const d=["mozfullscreenchange","webkitfullscreenchange","fullscreenchange"].map(p=>(0,hn.R)(document.body,p));return(0,Ao.h)(...d).pipe((0,F.T)(()=>l()),(0,Hl.Z)(l()))}}(Po||(Po={}));var Ds=function(n){return n.None="none",n.Play="play",n.Button="button",n.Hand="hand",n.Summary="summary",n}(Ds||{}),en=function(n){return n[n.OnDemand=0]="OnDemand",n[n.Interact=1]="Interact",n[n.Loader=2]="Loader",n[n.Tutorial=3]="Tutorial",n[n.Whiteboard=4]="Whiteboard",n[n.Help=5]="Help",n}(en||{}),No=function(n){return n.Text="text",n.Paint="paint",n.Erase="erase",n}(No||{});const fv=[4,8,12,16,24,32],fh=n=>n.slice(0).reverse().map(e=>({label:`${e}`,size:e})),Sv=fh(fv),bv=fh([8,12,16,20,24,32]),yv=fh(fv),Sh={color:"#000000"},vv={color:"#ffffff"},dI=Sv[4],pI=Sh,uI=bv[3],gI=yv[4],hI=Sh,mI=vv;var Ls,bh,Dr=function(n){return n.Mouse="mouse",n.Touch="touch",n}(Dr||{}),zd=function(n){return n[n.Default=0]="Default",n.DrawerOnly="drawer",n.ColumnOnly="column",n}(zd||{}),ui=function(n){return n[n.List=0]="List",n[n.Tree=1]="Tree",n}(ui||{}),lt=function(n){return n.NodeInfo="nodeInfo",n.LabelInfo="labelInfo",n.ChapterInfo="chapterInfo",n.Quiz="Quiz",n.Search="Search",n.Chapters="Chapters",n.VisibilityLayers="VisibilityLayers",n}(lt||{}),_e=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},v=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class dt{}const Ev={autoplay:!1,contentMode:lt.ChapterInfo,lang:"en",canFullscreen:!1,canHover:!1,canTouch:!1,drawerCoversContent:!1,fadeout:3e3,fadeoutPaused:!1,forceAudio:!1,fullscreenActive:!1,help:{tab:Ho.Basics},inputEnabled:!0,inputMode:Dr.Mouse,interactType:Ds.Play,isMobileWeb:!1,onDemand:!1,layout:zd.Default,labelsBreakpoint:480,menuOpen:!1,multiPickModeEnabled:!1,openWindows:[en.Loader],playthroughSettings:{enabled:!1,countdown:3e3,countdownDelay:2e3,forceAudio:!0,loop:!1,minimum:1e4},presentationActive:!1,searchDisplayMode:ui.Tree,startingColumn:"info",preferredColumn:null,startingTool:null,nodeInfo:{show:!1,fallback:dh.Wikipedia},tutorial:{pageSize:0,pageIndex:-1},tutorialSeen:!0,usePrintImage:!1,whiteboard:{enabled:!1,locked:!1,hasPaint:!1,hasText:!1,brushSize:dI.size,brushColor:pI.color,textSize:uI.size,eraserSize:gI.size,annotateMode:No.Paint},scrim:{show:!1,label:""},chapterCallToActionSeen:!1};let P=(bh=Ls=class{static getAutoplay(e){return e.autoplay}static getContentMode(e){return e.contentMode}static getLabelsBreakpoint(e){return e.labelsBreakpoint}static getInputEnabled(e){return e.inputEnabled}static getIsMobileWeb(e){return e.isMobileWeb}static getFullscreenActive(e){return e.fullscreenActive}static getPresentationActive(e){return e.presentationActive}static getDrawerCoversContent(e){return e.drawerCoversContent}static getShowNodeInfo(e){return e.nodeInfo.show}static getNodeInfoFallback(e){return e.nodeInfo.fallback}static getViewLanguage(e){return e.lang}static getInteractType(e){return e.interactType}static getForceAudio(e){return e.forceAudio}static getOnDemand(e){return e.onDemand}static getFadeout(e){return e.fadeout}static getFadeoutPaused(e){return e.fadeoutPaused}static getPlaythroughSettings(e){return e.playthroughSettings}static getPlaythroughEnabled(e){return e.playthroughSettings.enabled}static getPreferredColumn(e){return e.preferredColumn}static getStartingColumn(e){return e.startingColumn}static getStartingTool(e){return e.startingTool}static getLayout(e){return e.layout}static getInputMode(e){return e.inputMode}static getShowHelpTab(e){return e.help.tab}static getTutorial(e){return e.tutorial}static getTutorialSeen(e){return e.tutorialSeen}static getWhiteboardEnabled(e){return e.whiteboard.enabled}static isWhiteboardLocked(e){return e.whiteboard.locked}static getWhiteboardBrushSize(e){return e.whiteboard.brushSize}static getWhiteboardTextSize(e){return e.whiteboard.textSize}static getWhiteboardEraserSize(e){return e.whiteboard.eraserSize}static getWhiteboardAnnotateMode(e){return e.whiteboard.annotateMode}static getWhiteboardBrushColor(e){return e.whiteboard.brushColor}static getWhiteboardHasPaint(e){return e.whiteboard.hasPaint}static getWhiteboardHasText(e){return e.whiteboard.hasText}static getCanTouch(e){return e.canTouch}static getCanHover(e){return e.canHover}static getMultiPickModeEnabled(e){return e.multiPickModeEnabled}static getSearchDisplayMode(e){return e.searchDisplayMode}static getUsePrintImage(e){return e.usePrintImage}static getOpenWindow(e){return e.openWindows.length>0?e.openWindows.sort()[0]:null}static getMenuOpen(e){return e.menuOpen}static getScrim(e){return e.scrim}static getChapterCallToActionSeen(e){return e.chapterCallToActionSeen}static shouldWindowOpen(e){return(0,c.Mz)([bh],o=>o.openWindows.indexOf(e)>=0)}setAutoplay(e,o){e.patchState({autoplay:o.autoplay})}setContentMode(e,o){e.patchState({contentMode:o.column})}setInputEnabled(e,o){e.patchState({inputEnabled:o.enabled})}setCanHover(e,o){e.patchState({canHover:o.canHover})}setCanTouch(e,o){e.patchState({canTouch:o.canTouch})}setCanFullscreen(e,o){e.patchState({canFullscreen:o.canFullscreen})}setSearchDisplayMode(e,o){e.patchState({searchDisplayMode:o.mode})}setViewLanguage(e,{lang:o}){e.patchState({lang:o})}toggleNodeInfo(e,{show:o}){e.patchState({nodeInfo:{...e.getState().nodeInfo,show:o}})}setNodeInfoConfig(e,{fallback:o}){e.patchState({nodeInfo:{...e.getState().nodeInfo,fallback:o}})}togglePresentation(e,o){e.patchState({presentationActive:o.active})}toggleHelp(e,o){e.patchState({help:{tab:o.tab}})}setFadeout(e,o){e.patchState({fadeout:o.fadeout})}pauseFadeout(e,o){e.patchState({fadeoutPaused:o.pause})}setPlaythrough(e,o){const i=e.getState().playthroughSettings;(0,m.mergeWith)(i,o.playthrough,(s,r)=>{if(!(0,m.isNil)(r))return r}),e.patchState({playthroughSettings:i})}setPlaythroughEnabled(e,o){let i=e.getState().playthroughSettings;i={...i,enabled:o.enabled},e.patchState({playthroughSettings:i})}setStartingColumn(e,o){e.patchState({startingColumn:o.column})}setPreferredColumn(e,o){e.patchState({preferredColumn:o.column})}setStartingTool(e,o){e.patchState({startingTool:o.tool})}setLoaderType(e,o){e.patchState({interactType:o.interactType})}setForceAudio(e,o){e.patchState({forceAudio:o.forceAudio})}setOnDemand(e,o){e.patchState({onDemand:o.onDemand})}setInputMode(e,{inputMode:o}){e.patchState({inputMode:o})}SetLayout(e,o){e.patchState({layout:o.layout})}setTutorial(e,o){const i=e.getState().tutorial;e.patchState({tutorial:{...i,...o.tutorial}})}startTutorial(e,o){e.patchState({tutorial:{...e.getState().tutorial,pageIndex:o.intro?-1:0}}),e.dispatch(new D.TutorialSeen(!0))}tutorialSeen(e,o){this.storageService.setLocalItem(In.GettingStartedTutorial,o.seen),e.patchState({tutorialSeen:o.seen})}tutorialPrevious(e,o){const i=e.getState().tutorial,s=Math.max(i.pageIndex-1,0);e.dispatch(new D.SetTutorial({...i,pageIndex:s}))}tutorialNext(e,o){const i=e.getState().tutorial,s=Math.min(i.pageIndex+1,i.pageSize-1);e.dispatch(new D.SetTutorial({...i,pageIndex:s}))}setWhiteboardEnabled(e,{enabled:o}){e.patchState({whiteboard:{...e.getState().whiteboard,enabled:o}})}setWhiteboardLocked(e,{locked:o}){e.patchState({whiteboard:{...e.getState().whiteboard,locked:o}})}setWhiteboardBrushSize(e,{brushSize:o}){e.patchState({whiteboard:{...e.getState().whiteboard,brushSize:o}})}setWhiteboardTextSize(e,{size:o}){e.patchState({whiteboard:{...e.getState().whiteboard,textSize:o}})}setWhiteboardEraserSize(e,{eraserSize:o}){e.patchState({whiteboard:{...e.getState().whiteboard,eraserSize:o}})}setWhiteboardAnnotateMode(e,{mode:o}){e.patchState({whiteboard:{...e.getState().whiteboard,annotateMode:o}})}setWhiteboardBrushColor(e,{brushColor:o}){e.patchState({whiteboard:{...e.getState().whiteboard,brushColor:o}})}setWhiteboardHasPaint(e,{hasPaint:o}){e.patchState({whiteboard:{...e.getState().whiteboard,hasPaint:o}})}setWhiteboardHasText(e,{hasText:o}){e.patchState({whiteboard:{...e.getState().whiteboard,hasText:o}})}setMultiPickModeEnabled(e,o){e.patchState({multiPickModeEnabled:o.enabled})}setLabelBreakpoint(e,o){e.patchState({labelsBreakpoint:o.labelsBreakpoint})}setUsePrintImage(e,o){e.patchState({usePrintImage:o.usePrintImage})}setWindows(e,o){e.patchState({openWindows:o.windows})}setIsMobileWeb(e,o){e.patchState({isMobileWeb:o.isMobileWeb})}openWindow(e,o){const i=e.getState().openWindows;i.indexOf(o.window)<0&&e.patchState({openWindows:[o.window,...i]})}closeWindow(e,o){let i=e.getState().openWindows;null!=o.window?i=i.filter(s=>s!==o.window):i.shift(),e.patchState({openWindows:[...i]})}toggleWindow(e,o){const i=e.getState().openWindows.indexOf(o.window)>=0;e.dispatch((null!=o.show?o.show:!i)?new D.OpenWindow(o.window):new D.CloseWindow(o.window))}toggleMenu(e,o){e.patchState({menuOpen:o.open})}showScrim(e,o){e.patchState({scrim:{show:!0,label:o.label}})}hideScrim(e,o){e.patchState({scrim:{show:!1,label:""}})}setChapterCallToActionSeen(e,o){e.patchState({chapterCallToActionSeen:o.chapterCallToActionSeen})}ResetViewState(e,o){e.setState({...Ev})}constructor(e,o,i){this.storageService=e,this.store=o,this.platform=i}ngxsOnInit(e){Po.onFullscreenChange().subscribe(o=>{e.patchState({fullscreenActive:o})}),e.patchState({tutorialSeen:this.storageService.getLocalJSON(In.GettingStartedTutorial)||!1})}},Ls.\u0275fac=function(e){return new(e||Ls)(t.KVO(Le),t.KVO(c.il),t.KVO(Z_.OD))},Ls.\u0275prov=t.jDH({token:Ls,factory:Ls.\u0275fac}),Ls);_e([(0,c.rc)(D.SetAutoplay),v("design:type",Function),v("design:paramtypes",[Object,D.SetAutoplay]),v("design:returntype",void 0)],P.prototype,"setAutoplay",null),_e([(0,c.rc)(D.SetContentMode),v("design:type",Function),v("design:paramtypes",[Object,D.SetContentMode]),v("design:returntype",void 0)],P.prototype,"setContentMode",null),_e([(0,c.rc)(D.SetInputEnabled),v("design:type",Function),v("design:paramtypes",[Object,D.SetInputEnabled]),v("design:returntype",void 0)],P.prototype,"setInputEnabled",null),_e([(0,c.rc)(D.SetCanHover),v("design:type",Function),v("design:paramtypes",[Object,D.SetCanHover]),v("design:returntype",void 0)],P.prototype,"setCanHover",null),_e([(0,c.rc)(D.SetCanTouch),v("design:type",Function),v("design:paramtypes",[Object,D.SetCanTouch]),v("design:returntype",void 0)],P.prototype,"setCanTouch",null),_e([(0,c.rc)(D.SetCanFullscreen),v("design:type",Function),v("design:paramtypes",[Object,D.SetCanFullscreen]),v("design:returntype",void 0)],P.prototype,"setCanFullscreen",null),_e([(0,c.rc)(D.SetSearchDisplayMode),v("design:type",Function),v("design:paramtypes",[Object,D.SetSearchDisplayMode]),v("design:returntype",void 0)],P.prototype,"setSearchDisplayMode",null),_e([(0,c.rc)(D.SetViewLanguage),v("design:type",Function),v("design:paramtypes",[Object,D.SetViewLanguage]),v("design:returntype",void 0)],P.prototype,"setViewLanguage",null),_e([(0,c.rc)(D.ToggleNodeInfo),v("design:type",Function),v("design:paramtypes",[Object,D.ToggleNodeInfo]),v("design:returntype",void 0)],P.prototype,"toggleNodeInfo",null),_e([(0,c.rc)(D.SetNodeInfoConfig),v("design:type",Function),v("design:paramtypes",[Object,D.SetNodeInfoConfig]),v("design:returntype",void 0)],P.prototype,"setNodeInfoConfig",null),_e([(0,c.rc)(D.TogglePresentation),v("design:type",Function),v("design:paramtypes",[Object,D.TogglePresentation]),v("design:returntype",void 0)],P.prototype,"togglePresentation",null),_e([(0,c.rc)(D.ToggleHelpTab),v("design:type",Function),v("design:paramtypes",[Object,D.ToggleHelpTab]),v("design:returntype",void 0)],P.prototype,"toggleHelp",null),_e([(0,c.rc)(D.SetFadeout),v("design:type",Function),v("design:paramtypes",[Object,D.SetFadeout]),v("design:returntype",void 0)],P.prototype,"setFadeout",null),_e([(0,c.rc)(D.PauseFadeout),v("design:type",Function),v("design:paramtypes",[Object,D.PauseFadeout]),v("design:returntype",void 0)],P.prototype,"pauseFadeout",null),_e([(0,c.rc)(D.SetPlaythrough),v("design:type",Function),v("design:paramtypes",[Object,D.SetPlaythrough]),v("design:returntype",void 0)],P.prototype,"setPlaythrough",null),_e([(0,c.rc)(D.SetPlaythroughEnabled),v("design:type",Function),v("design:paramtypes",[Object,D.SetPlaythroughEnabled]),v("design:returntype",void 0)],P.prototype,"setPlaythroughEnabled",null),_e([(0,c.rc)(D.SetStartingColumn),v("design:type",Function),v("design:paramtypes",[Object,D.SetStartingColumn]),v("design:returntype",void 0)],P.prototype,"setStartingColumn",null),_e([(0,c.rc)(D.SetPreferredColumn),v("design:type",Function),v("design:paramtypes",[Object,D.SetPreferredColumn]),v("design:returntype",void 0)],P.prototype,"setPreferredColumn",null),_e([(0,c.rc)(D.SetStartingTool),v("design:type",Function),v("design:paramtypes",[Object,D.SetStartingTool]),v("design:returntype",void 0)],P.prototype,"setStartingTool",null),_e([(0,c.rc)(D.SetInteractType),v("design:type",Function),v("design:paramtypes",[Object,D.SetInteractType]),v("design:returntype",void 0)],P.prototype,"setLoaderType",null),_e([(0,c.rc)(D.SetForceAudio),v("design:type",Function),v("design:paramtypes",[Object,D.SetForceAudio]),v("design:returntype",void 0)],P.prototype,"setForceAudio",null),_e([(0,c.rc)(D.SetOnDemand),v("design:type",Function),v("design:paramtypes",[Object,D.SetOnDemand]),v("design:returntype",void 0)],P.prototype,"setOnDemand",null),_e([(0,c.rc)(D.SetInputMode),v("design:type",Function),v("design:paramtypes",[Object,D.SetInputMode]),v("design:returntype",void 0)],P.prototype,"setInputMode",null),_e([(0,c.rc)(D.SetLayout),v("design:type",Function),v("design:paramtypes",[Object,D.SetLayout]),v("design:returntype",void 0)],P.prototype,"SetLayout",null),_e([(0,c.rc)(D.SetTutorial),v("design:type",Function),v("design:paramtypes",[Object,D.SetTutorial]),v("design:returntype",void 0)],P.prototype,"setTutorial",null),_e([(0,c.rc)(D.StartTutorial),v("design:type",Function),v("design:paramtypes",[Object,D.StartTutorial]),v("design:returntype",void 0)],P.prototype,"startTutorial",null),_e([(0,c.rc)(D.TutorialSeen),v("design:type",Function),v("design:paramtypes",[Object,D.TutorialSeen]),v("design:returntype",void 0)],P.prototype,"tutorialSeen",null),_e([(0,c.rc)(D.TutorialPrevious),v("design:type",Function),v("design:paramtypes",[Object,D.TutorialPrevious]),v("design:returntype",void 0)],P.prototype,"tutorialPrevious",null),_e([(0,c.rc)(D.TutorialNext),v("design:type",Function),v("design:paramtypes",[Object,D.TutorialNext]),v("design:returntype",void 0)],P.prototype,"tutorialNext",null),_e([(0,c.rc)(D.SetWhiteboardEnabled),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardEnabled]),v("design:returntype",void 0)],P.prototype,"setWhiteboardEnabled",null),_e([(0,c.rc)(D.SetWhiteboardLocked),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardLocked]),v("design:returntype",void 0)],P.prototype,"setWhiteboardLocked",null),_e([(0,c.rc)(D.SetWhiteboardBrushSize),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardBrushSize]),v("design:returntype",void 0)],P.prototype,"setWhiteboardBrushSize",null),_e([(0,c.rc)(D.SetWhiteboardTextSize),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardTextSize]),v("design:returntype",void 0)],P.prototype,"setWhiteboardTextSize",null),_e([(0,c.rc)(D.SetWhiteboardEraserSize),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardEraserSize]),v("design:returntype",void 0)],P.prototype,"setWhiteboardEraserSize",null),_e([(0,c.rc)(D.SetWhiteboardAnnotateMode),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardAnnotateMode]),v("design:returntype",void 0)],P.prototype,"setWhiteboardAnnotateMode",null),_e([(0,c.rc)(D.SetWhiteboardBrushColor),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardBrushColor]),v("design:returntype",void 0)],P.prototype,"setWhiteboardBrushColor",null),_e([(0,c.rc)(D.SetWhiteboardHasPaint),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardHasPaint]),v("design:returntype",void 0)],P.prototype,"setWhiteboardHasPaint",null),_e([(0,c.rc)(D.SetWhiteboardHasText),v("design:type",Function),v("design:paramtypes",[Object,D.SetWhiteboardHasText]),v("design:returntype",void 0)],P.prototype,"setWhiteboardHasText",null),_e([(0,c.rc)(D.SetMultiPickModeEnabled),v("design:type",Function),v("design:paramtypes",[Object,D.SetMultiPickModeEnabled]),v("design:returntype",void 0)],P.prototype,"setMultiPickModeEnabled",null),_e([(0,c.rc)(D.SetLabelBreakpoint),v("design:type",Function),v("design:paramtypes",[Object,D.SetLabelBreakpoint]),v("design:returntype",void 0)],P.prototype,"setLabelBreakpoint",null),_e([(0,c.rc)(D.SetUsePrintImage),v("design:type",Function),v("design:paramtypes",[Object,D.SetUsePrintImage]),v("design:returntype",void 0)],P.prototype,"setUsePrintImage",null),_e([(0,c.rc)(D.SetWindows),v("design:type",Function),v("design:paramtypes",[Object,D.SetWindows]),v("design:returntype",void 0)],P.prototype,"setWindows",null),_e([(0,c.rc)(D.SetIsMobileWeb),v("design:type",Function),v("design:paramtypes",[Object,D.SetIsMobileWeb]),v("design:returntype",void 0)],P.prototype,"setIsMobileWeb",null),_e([(0,c.rc)(D.OpenWindow),v("design:type",Function),v("design:paramtypes",[Object,D.OpenWindow]),v("design:returntype",void 0)],P.prototype,"openWindow",null),_e([(0,c.rc)(D.CloseWindow),v("design:type",Function),v("design:paramtypes",[Object,D.CloseWindow]),v("design:returntype",void 0)],P.prototype,"closeWindow",null),_e([(0,c.rc)(D.ToggleWindow),v("design:type",Function),v("design:paramtypes",[Object,D.ToggleWindow]),v("design:returntype",void 0)],P.prototype,"toggleWindow",null),_e([(0,c.rc)(D.ToggleMenu),v("design:type",Function),v("design:paramtypes",[Object,D.ToggleMenu]),v("design:returntype",void 0)],P.prototype,"toggleMenu",null),_e([(0,c.rc)(D.ShowScrim),v("design:type",Function),v("design:paramtypes",[Object,D.ShowScrim]),v("design:returntype",void 0)],P.prototype,"showScrim",null),_e([(0,c.rc)(D.HideScrim),v("design:type",Function),v("design:paramtypes",[Object,D.HideScrim]),v("design:returntype",void 0)],P.prototype,"hideScrim",null),_e([(0,c.rc)(D.SetChapterCallToActionSeen),v("design:type",Function),v("design:paramtypes",[Object,D.SetChapterCallToActionSeen]),v("design:returntype",void 0)],P.prototype,"setChapterCallToActionSeen",null),_e([(0,c.rc)(D.ResetViewState),v("design:type",Function),v("design:paramtypes",[Object,D.ResetViewState]),v("design:returntype",void 0)],P.prototype,"ResetViewState",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getAutoplay",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getContentMode",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getLabelsBreakpoint",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getInputEnabled",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getIsMobileWeb",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getFullscreenActive",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getPresentationActive",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getDrawerCoversContent",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getShowNodeInfo",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getNodeInfoFallback",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getViewLanguage",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getInteractType",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getForceAudio",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getOnDemand",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getFadeout",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getFadeoutPaused",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getPlaythroughSettings",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getPlaythroughEnabled",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getPreferredColumn",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getStartingColumn",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getStartingTool",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getLayout",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getInputMode",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getShowHelpTab",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getTutorial",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getTutorialSeen",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardEnabled",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"isWhiteboardLocked",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardBrushSize",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardTextSize",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardEraserSize",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardAnnotateMode",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardBrushColor",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardHasPaint",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getWhiteboardHasText",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getCanTouch",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getCanHover",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getMultiPickModeEnabled",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getSearchDisplayMode",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getUsePrintImage",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getOpenWindow",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getMenuOpen",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getScrim",null),_e([(0,c.MD)(),v("design:type",Function),v("design:paramtypes",[dt]),v("design:returntype",void 0)],P,"getChapterCallToActionSeen",null),P=bh=_e([(0,c.Uw)({name:"view",defaults:Ev}),v("design:paramtypes",[Le,c.il,Z_.OD])],P);var Ve=function(n){return n.Hide="hide",n.Show="show",n.Collapse="collapse",n}(Ve||{}),Ql=function(n){return n[n.Content=0]="Content",n[n.Label=1]="Label",n[n.Tools=2]="Tools",n[n.Search=3]="Search",n[n.Help=4]="Help",n[n.NodeInfo=5]="NodeInfo",n[n.LabelInfo=6]="LabelInfo",n}(Ql||{});let SI=(()=>{var n;class e{constructor(i){this.store=i}chapterHasTransition(i,s){const a=(0,m.get)(i,s?"transitions.pre":"transitions.post");return!!a&&(s?a.onPrevious:a.onNext)}searchChapterTransitions(i,s,r){let a=[...r],l=a.findIndex(u=>u.id===i),_=a.findIndex(u=>u.id===s);const d=_<l;if(d&&(a=a.reverse(),l=a.findIndex(u=>u.id===i),_=a.findIndex(u=>u.id===s)),l<0||_<0||l===_)return null;const p=a.slice(l,_).find(u=>this.chapterHasTransition(u,d));return p?d?p.transitions.pre:p.transitions.post:null}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Us;!function(n){n.SetHorizontalBreakpoint=(()=>{class s{constructor(a){this.breakpoint=a}}return s.type="[View] Set Horizontal Breakpoint",s})(),n.SetVerticalBreakpoint=(()=>{class s{constructor(a){this.breakpoint=a}}return s.type="[View] Set Vertical Breakpoint",s})()}(Us||(Us={}));var Lr,Un=function(n){return n[n.XSmall=0]="XSmall",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n[n.Large=3]="Large",n[n.XLarge=4]="XLarge",n}(Un||{}),Wd=function(n){return n[n.Tiny=0]="Tiny",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n}(Wd||{}),Tv=S(9327),Vn=S(1082),Ur=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},qn=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class Xd{}let mn=((Lr=class{static getHorizontalBreakpoint(e){return e.horizontalBreakpoint}static getHorizontalBreakpointLabel(e){return["(max-width: 374px)","(max-width: 599px)","(max-width: 959px)","(max-width: 1439px)","(min-width: 1440px)"][e.horizontalBreakpoint]}static getVerticalBreakpoint(e){return e.verticalBreakpoint}static getVerticalBreakpointLabel(e){return["(max-height: 479px)","(min-height: 480px)","(min-height: 375px)"][e.verticalBreakpoint]}setBreakpoint(e,o){e.patchState({horizontalBreakpoint:o.breakpoint})}setVerticalBreakpoint(e,o){e.patchState({verticalBreakpoint:o.breakpoint})}constructor(e,o){this.breakpointObserver=e,this.store=o}ngxsOnInit(e){this.initHorizontalBreakpointObserver(e),this.initVerticalBreakpointObserver(e)}initHorizontalBreakpointObserver(e){const o=this.breakpointObserver.observe(["(max-width: 374px)"]),i=this.breakpointObserver.observe(["(max-width: 599px)"]),s=this.breakpointObserver.observe(["(max-width: 959px)"]),r=this.breakpointObserver.observe(["(max-width: 1439px)"]),a=this.breakpointObserver.observe(["(min-width: 1440px)"]);(0,Tt.z)([o,i,s,r,a]).pipe((0,F.T)(([l,_,d,p,u])=>l.matches?Un.XSmall:_.matches?Un.Small:d.matches?Un.Medium:p.matches?Un.Large:u.matches?Un.XLarge:null),(0,Vn.F)(),(0,X.p)(l=>null!=l)).subscribe(l=>{e.dispatch(new Us.SetHorizontalBreakpoint(l))})}initVerticalBreakpointObserver(e){const o=this.breakpointObserver.observe(["(max-height: 374px)"]),i=this.breakpointObserver.observe(["(max-height: 479px)"]),s=this.breakpointObserver.observe(["(min-height: 480px)"]);(0,Tt.z)([o,i,s]).pipe((0,F.T)(([r,a,l])=>r.matches?Wd.Tiny:a.matches?Wd.Small:l.matches?Wd.Medium:null),(0,Vn.F)(),(0,X.p)(r=>null!=r)).subscribe(r=>{e.dispatch(new Us.SetVerticalBreakpoint(r))})}}).\u0275fac=function(e){return new(e||Lr)(t.KVO(Tv.QP),t.KVO(c.il))},Lr.\u0275prov=t.jDH({token:Lr,factory:Lr.\u0275fac}),Lr);Ur([(0,c.rc)(Us.SetHorizontalBreakpoint),qn("design:type",Function),qn("design:paramtypes",[Object,Us.SetHorizontalBreakpoint]),qn("design:returntype",void 0)],mn.prototype,"setBreakpoint",null),Ur([(0,c.rc)(Us.SetVerticalBreakpoint),qn("design:type",Function),qn("design:paramtypes",[Object,Us.SetVerticalBreakpoint]),qn("design:returntype",void 0)],mn.prototype,"setVerticalBreakpoint",null),Ur([(0,c.MD)(),qn("design:type",Function),qn("design:paramtypes",[Xd]),qn("design:returntype",void 0)],mn,"getHorizontalBreakpoint",null),Ur([(0,c.MD)(),qn("design:type",Function),qn("design:paramtypes",[Xd]),qn("design:returntype",void 0)],mn,"getHorizontalBreakpointLabel",null),Ur([(0,c.MD)(),qn("design:type",Function),qn("design:paramtypes",[Xd]),qn("design:returntype",void 0)],mn,"getVerticalBreakpoint",null),Ur([(0,c.MD)(),qn("design:type",Function),qn("design:paramtypes",[Xd]),qn("design:returntype",void 0)],mn,"getVerticalBreakpointLabel",null),mn=Ur([(0,c.Uw)({name:"breakpoint",defaults:{horizontalBreakpoint:null,verticalBreakpoint:null}}),qn("design:paramtypes",[Tv.QP,c.il])],mn);var h=function(n){return n.AnatomyLabels="anatomyLabels",n.Audio="audio",n.Camera="camera",n.Column="column",n.ColumnToggle="columnToggle",n.ContextActions="contextActions",n.Description="description",n.Drawer="drawer",n.DrawerToggle="drawerToggle",n.Fullscreen="fullscreen",n.Help="help",n.LabelList="labelList",n.Labels="labels",n.VisibilityLayers="visibilityLayers",n.VisibilityLayersMode="visibilityLayersMode",n.SkinLayers="skinLayers",n.Layout="layout",n.Legend="legend",n.Loader="loader",n.Logo="logo",n.Media="media",n.ToolbarOverflow="toolbarOverflow",n.NodeInfo="nodeInfo",n.NodeAudio="nodeAudio",n.Pagination="pagination",n.Playthrough="playthrough",n.QuizPrompt="quizPrompt",n.Search="search",n.TitleOnly="titleOnly",n.ToggleLabels="toggleLabels",n.Toolbar="toolbar",n.Tools="tools",n.Tutorial="tutorial",n.Undo="undo",n.Whiteboard="whiteboard",n}(h||{}),ss=function(n){return n.None="none",n.Circle="circle",n.Bar="bar",n}(ss||{});const yh=he.application===bt.Viewer?ss.Bar:ss.Circle;var Bn=function(n){return n.Drawer="drawer",n.Column="column",n}(Bn||{});let vh=(()=>{class e{constructor(i,s,r){this.storyLoadProgress=i,this.chapterId=s,this.chapterProgress=r}}return e.type="[Engine Progress] Set Progress",e})(),Hd=(()=>{class e{constructor(){}}return e.type="[Engine Progress] Reset Progress",e})();var Vr,Yl=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},zi=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const Cv={storyLoadProgress:0,chapterLoadProgress:{}};let ki=((Vr=class{constructor(){}static getStoryLoadProgress(e){return e.storyLoadProgress}static getChaptersLoadProgress(e){return e.chapterLoadProgress}setProgress(e,o){const{storyLoadProgress:i,chapterId:s,chapterProgress:r}=o;e.patchState({storyLoadProgress:i,chapterLoadProgress:{...e.getState().chapterLoadProgress,[s]:r}})}resetProgress(e,o){e.setState({...Cv})}}).\u0275fac=function(e){return new(e||Vr)},Vr.\u0275prov=t.jDH({token:Vr,factory:Vr.\u0275fac}),Vr);Yl([(0,c.rc)(vh),zi("design:type",Function),zi("design:paramtypes",[Object,vh]),zi("design:returntype",void 0)],ki.prototype,"setProgress",null),Yl([(0,c.rc)(Hd),zi("design:type",Function),zi("design:paramtypes",[Object,Hd]),zi("design:returntype",void 0)],ki.prototype,"resetProgress",null),Yl([(0,c.MD)(),zi("design:type",Function),zi("design:paramtypes",[Object]),zi("design:returntype",void 0)],ki,"getStoryLoadProgress",null),Yl([(0,c.MD)(),zi("design:type",Function),zi("design:paramtypes",[Object]),zi("design:returntype",void 0)],ki,"getChaptersLoadProgress",null),ki=Yl([(0,c.Uw)({name:"engineProgress",defaults:Cv}),zi("design:paramtypes",[])],ki);var Tn,Wi=function(n){return n.None="none",n.Small="small",n.Full="full",n}(Wi||{}),jr=function(n){return n.Single="single",n.Group="group",n}(jr||{});class jt{constructor(e=Ve.Hide,o=!0){this.status=e,this.enable=o}}class Ov extends jt{constructor(e){super(),this.userStatusPreference=e}}!function(n){n.ToggleVisible=(()=>{class r{constructor(l){this.settings=l}}return r.type="[ViewUI] Toggle Visible",r})(),n.SetUI=(()=>{class r{constructor(l){this.ui=l}}return r.type="[ViewUI] Set UI",r})(),n.SetInitialUI=(()=>{class r{constructor(l){this.ui=l}}return r.type="[ViewUI] Set Initial UI",r})()}(Tn||(Tn={}));var Vs,Qd,xr=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Kn=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const Eh={[h.Audio]:new jt,[h.AnatomyLabels]:new jt,[h.Camera]:new jt,[h.Column]:new Ov(null),[h.ColumnToggle]:new jt,[h.ContextActions]:new jt,[h.Description]:new jt,[h.Drawer]:new Ov(null),[h.DrawerToggle]:new jt,[h.Fullscreen]:new jt,[h.Help]:new jt,[h.Labels]:new class CI extends jt{constructor(e=!0){super(),this.shown=e}},[h.LabelList]:new jt(Ve.Show,!1),[h.Legend]:new jt,[h.Loader]:new class TI extends jt{constructor(e=yh){super(),this.template=e}},[h.Logo]:new class vI extends jt{constructor(e=!0){super(),this.isHyperLink=e}},[h.Media]:new class EI extends jt{constructor(e=Wi.Full,o=Ve.Hide){super(o),this.template=e,this.status=o}},[h.NodeInfo]:new jt(Ve.Hide,!1),[h.NodeAudio]:new jt,[h.Playthrough]:new jt(Ve.Hide,!1),[h.Pagination]:new jt,[h.QuizPrompt]:new jt,[h.Search]:new jt,[h.TitleOnly]:new jt,[h.ToggleLabels]:new jt,[h.Toolbar]:new jt,[h.ToolbarOverflow]:new jt(Ve.Show,!1),[h.Tools]:new jt,[h.Tutorial]:new jt(Ve.Hide,!1),[h.Undo]:new jt,[h.VisibilityLayers]:new class OI extends jt{constructor(e=jr.Single){super(),this.layersMode=e}},[h.SkinLayers]:new jt(Ve.Show,!0),[h.Whiteboard]:new jt};class Th{}const wI={visible:{[h.Audio]:!1,[h.AnatomyLabels]:!1,[h.Camera]:!1,[h.Column]:!1,[h.ColumnToggle]:!1,[h.ContextActions]:!1,[h.Description]:!1,[h.Drawer]:!1,[h.DrawerToggle]:!1,[h.Fullscreen]:!1,[h.Help]:!1,[h.Labels]:!1,[h.LabelList]:!1,[h.Legend]:!1,[h.Logo]:!1,[h.Media]:!1,[h.ToolbarOverflow]:!1,[h.NodeInfo]:!1,[h.NodeAudio]:!1,[h.Pagination]:!1,[h.Playthrough]:!1,[h.QuizPrompt]:!1,[h.Search]:!1,[h.ToggleLabels]:!1,[h.TitleOnly]:!1,[h.Toolbar]:!1,[h.Tools]:!1,[h.Tutorial]:!1,[h.Undo]:!1,[h.VisibilityLayers]:!1,[h.SkinLayers]:!1,[h.Whiteboard]:!1},ui:Eh,initialUI:Eh};let ue=(Qd=Vs=class{static getVisible(e){return(0,c.Mz)([Qd],o=>o.visible[e])}static getUIEntry(e){return(0,c.Mz)([Qd],o=>o.ui[e])}static getSearchStatus(e){return e.ui.search.status}static getUI(e){return e.ui}static getInitialUI(e){return e.initialUI}toggleVisible(e,o){const i=e.getState().visible;Object.entries(o.settings).forEach(([s,r])=>{i[s]=r}),e.patchState({visible:i})}setUI(e,o){const i=e.getState().ui;e.patchState({ui:{...i,...o.ui}})}setInitialUI(e,o){const i=e.getState().ui;e.patchState({initialUI:{...i,...o.ui}})}constructor(){}},Vs.\u0275fac=function(e){return new(e||Vs)},Vs.\u0275prov=t.jDH({token:Vs,factory:Vs.\u0275fac}),Vs);xr([(0,c.rc)(Tn.ToggleVisible),Kn("design:type",Function),Kn("design:paramtypes",[Object,Tn.ToggleVisible]),Kn("design:returntype",void 0)],ue.prototype,"toggleVisible",null),xr([(0,c.rc)(Tn.SetUI),Kn("design:type",Function),Kn("design:paramtypes",[Object,Tn.SetUI]),Kn("design:returntype",void 0)],ue.prototype,"setUI",null),xr([(0,c.rc)(Tn.SetUI),Kn("design:type",Function),Kn("design:paramtypes",[Object,Tn.SetUI]),Kn("design:returntype",void 0)],ue.prototype,"setInitialUI",null),xr([(0,c.MD)(),Kn("design:type",Function),Kn("design:paramtypes",[Th]),Kn("design:returntype",void 0)],ue,"getSearchStatus",null),xr([(0,c.MD)(),Kn("design:type",Function),Kn("design:paramtypes",[Th]),Kn("design:returntype",void 0)],ue,"getUI",null),xr([(0,c.MD)(),Kn("design:type",Function),Kn("design:paramtypes",[Th]),Kn("design:returntype",void 0)],ue,"getInitialUI",null),ue=Qd=xr([(0,c.Uw)({name:"viewUI",defaults:wI}),Kn("design:paramtypes",[])],ue);var MI=S(7953);class II{get currentPlayer(){return this.players[this.index]}constructor(e){this.players=e,this.index=0,this.isPlaying=!1,this.eventSubject=new oe.B,this.ngUnsubscribe=new oe.B,this.loadState="unloaded",this.totalDuration=0,this.init()}state(){return this.loadState}duration(){return this.totalDuration}play(){this.currentPlayer&&this.currentPlayer.play()}pause(){this.currentPlayer&&this.currentPlayer.pause()}stop(){this.currentPlayer&&this.currentPlayer.stop(),this.index=0}seek(e){if(this.currentPlayer)return this.currentPlayer.seek(e)}rate(e){if(this.currentPlayer)return this.currentPlayer.rate(e)}mute(e){if(this.currentPlayer){if((0,m.isNil)(e))return this.currentPlayer.mute();this.currentPlayer.mute(e)}}playing(){return!!this.currentPlayer&&this.currentPlayer.playing()}on(e,o){this.eventSubject.asObservable().pipe((0,X.p)(i=>i===e),(0,w.Q)(this.ngUnsubscribe)).subscribe(o)}load(){this.players.forEach(e=>e.load())}unload(){this.players.forEach(e=>e.unload()),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){const e=this.players.length;let o=0;this.players.forEach((i,s)=>{i.on("load",()=>{this.totalDuration+=i.duration(),o++,o>=e&&(this.eventSubject.next("load"),this.loadState="loaded")}),i.on("play",()=>{"unloaded"===this.loadState&&(this.loadState="loading"),this.isPlaying||this.eventSubject.next("play"),this.isPlaying=!0,this.index=s}),i.on("pause",()=>{this.isPlaying=!1,this.eventSubject.next("pause")}),i.on("end",()=>{if(this.isPlaying){const a=this.players[s+1];a?a.play():(this.isPlaying=!1,this.index=0,this.eventSubject.next("end"))}}),i.on("stop",()=>{this.isPlaying=!1,this.eventSubject.next("stop")}),i.on("loaderror",()=>{this.eventSubject.next("loaderror")}),i.on("playerror",()=>{this.eventSubject.next("playerror")})})}}Math.pow(1024,2),Math.pow(1024,2),Math.pow(1024,3);const wv={".svg":["image/svg+xml"],".jpg":["image/jpeg"],".jpeg":["image/jpeg"],".png":["image/png"],".aac":["audio/aac"],".m4a":["audio/mp4","audio/x-m4a"],".mp3":["audio/mpeg"],".webm":["video/webm"],".mpg":["video/mpeg"],".mp2":["video/mpeg"],".mpeg":["video/mpeg"],".mpe":["video/mpeg"],".mpv":["video/x-mpv"],".ogg":["video/ogg"],".mp4":["video/mp4"],".m4p":["video/mp4","video/x-m4p"],".m4v":["video/mp4","video/x-m4v"],".avi":["video/x-msvideo"],".wmv":["video/x-ms-wmv"],".mov":["video/quicktime"],".qt":["video/quicktime"],".flv":["video/x-flv"],".swf":["application/x-shockwave-flash"],".mpd":["application/dash+xml"],".m3u8":["application/x-mpegURL"]},DI=0,Mv={eng:"en",spa:"es",cmn:"zh",fra:"fr",deu:"de",ita:"it",jpn:"ja",por:"pt"},LI=Object.keys(Mv);function Iv(n){return Ch.apply(this,arguments)}function Ch(){return Ch=(0,J.A)(function*(n){return S.e(17).then(S.bind(S,8398)).then(e=>function UI(n,e){const o=n.franc(e,{minLength:DI,only:LI}),i=Mv[o];return Cl.find(r=>r.lang===i)?.id}(e,n))}),Ch.apply(this,arguments)}const VI="mp3",Pv={voiceId:"Amy",voiceLocaleId:"en-GB",supportedLocaleIds:["en-US"],engine:"neural"},jI=[Pv,{voiceId:"Mia",voiceLocaleId:"es-MX",supportedLocaleIds:["es-ES"],engine:"neural"},{voiceId:"Zhiyu",voiceLocaleId:"cmn-CN",supportedLocaleIds:["zh-CN"],engine:"neural"},{voiceId:"Lea",voiceLocaleId:"fr-FR",supportedLocaleIds:[],engine:"neural"},{voiceId:"Vicki",voiceLocaleId:"de-DE",supportedLocaleIds:[],engine:"neural"},{voiceId:"Bianca",voiceLocaleId:"it-IT",supportedLocaleIds:[],engine:"neural"},{voiceId:"Takumi",voiceLocaleId:"ja-JP",supportedLocaleIds:["ja"],engine:"neural"},{voiceId:"Camila",voiceLocaleId:"pt-BR",supportedLocaleIds:["pt-PT"],engine:"neural"}];function Nv(n,e){return(n.length>3e3?Ri.splitTextByCharacterCount(n,3e3):[n]).map(s=>function xI(n,e){const s=function GI(n){return jI.find(e=>{const{voiceLocaleId:o,supportedLocaleIds:i}=e;return o===n||i.includes(n)})}(e)??Pv,{voiceId:r,engine:a,voiceLocaleId:l}=s;return`/ws/polly/synthesize?text=${encodeURIComponent(n)}&voice_id=${r}&format=${VI}&lang=${l}&engine=${a}&version=2`}(s,e))}var Ei,ri=function(n){return n.File="file",n.TTS="tts",n.None="none",n}(ri||{});!function(n){n.SetAudioMuted=(()=>{class r{constructor(l){this.mute=l}}return r.type="[Media] Set Audio Muted",r})(),n.SetAutoplayAudio=(()=>{class r{constructor(l){this.autoplay=l}}return r.type="[Media] Set Autoplay Audio",r})(),n.ResetAudio=(()=>{class r{constructor(){}}return r.type="[Media] Reset Audio",r})()}(Ei||(Ei={}));var Ti=S(5286);const Rv="/media/audio",BI=new RegExp(`^${Rv}/(.*)/.*$`),zI=["aac","m4a","mp3","ogg"],kv={aac:"audio/aac",m4a:"audio/mp4",mp3:"audio/mpeg",ogg:"audio/ogg"};Howler.autoUnlock=!1;let Di=(()=>{var n;class e{constructor(i,s,r,a,l){this.http=s,this.markdownService=r,this.animationService=a,this.store=l,this.audioPromises=new Map,this.audioPlayers=new Map,this.audioEventSubject=new oe.B,this.videoPlayers=new Map,this.videoEventSubject=new oe.B,this.videoSources=new Map,this.renderer=i.createRenderer(null,null)}addAudioPlayer(i,s,r,a={}){var l=this;return(0,J.A)(function*(){l.removeAudioPlayer(i);const _=s.then(u=>l.createAudioPlayer(u,r,a));l.audioPromises.set(i,_);const d=yield _,p=()=>{d.playing()&&(l.audioEventSubject.next({event:"playing",id:i,data:{time:d.seek()}}),requestAnimationFrame(p))};return d.on("load",()=>{l.audioEventSubject.next({event:"load",id:i})}),d.on("play",()=>{l.audioEventSubject.next({event:"play",id:i}),p()}),d.on("pause",()=>{l.audioEventSubject.next({event:"pause",id:i})}),d.on("stop",()=>{l.audioEventSubject.next({event:"stop",id:i})}),d.on("seek",()=>{l.audioEventSubject.next({event:"seek",id:i,data:{time:d.seek()}})}),d.on("end",()=>{l.audioEventSubject.next({event:"end",id:i})}),d.on("playerror",()=>{l.audioEventSubject.next({event:"playerror",id:i})}),l.audioPlayers.set(i,d),d})()}createAudioPlayer(i,s,r){var a=this;return(0,J.A)(function*(){if(s){const l=yield a.createAudioDataUrl(i);return a.createSinglePlayer(l,r)}return i.length>1?a.createSinglePlayer(i[0],r):a.createMultiPlayer(i,r)})()}createSinglePlayer(i,s){return new MI.Howl({...s,src:i,format:zI})}createMultiPlayer(i,s){const r=i.map(a=>this.createSinglePlayer(a,s));return new II(r)}removeAudioPlayer(i){var s=this;return(0,J.A)(function*(){const r=s.audioPromises.get(i);if(s.audioPromises.delete(i),s.audioPlayers.delete(i),r)return r.then(a=>a.unload())})()}getAudioPlayer(i){var s=this;return(0,J.A)(function*(){return s.audioPromises.get(i)})()}hasAudioPlayer(i){return this.audioPromises.has(i)}removeAllAudioPlayers(){this.audioPromises.forEach((i,s)=>this.removeAudioPlayer(s))}createAudioUploadEvent(i){return{type:"uploadFile",url:"/ws/media/audio/upload",method:"POST",file:i}}getAudioEvents(){return this.audioEventSubject.asObservable()}getAudioClips(i){return Object.values(i).filter(s=>"audio"===s.streamType)}createAudioClip(i,s,r){const a=this.getAudioUUID(s),{firstTime:l,lastTime:_}=this.animationService.getChapterTimeFrame();return[a,{clipId:a,streamType:"audio",fullUrl:s,time1:l,time2:_,lang:r}]}createAudioDataUrl(i){return(0,J.A)(function*(){const s=i.map(r=>fetch(r).then(a=>a.blob()));return Promise.all(s).then(r=>{const a=i[0].split(".").pop();return URL.createObjectURL(new Blob(r,{type:kv[a]||kv.mp3}))})})()}getDuration(i){return(0,J.A)(function*(){return"loaded"===i.state()?i.duration():new Promise(s=>{i.on("load",()=>{s(i.duration())})})})()}getTTSSources(i,s=Zi.id){var r=this;return(0,J.A)(function*(){const a=yield Ri.getPlainTextFromMarkdown(r.renderer,r.markdownService,i||"",!0);return Nv(a,(yield Iv(a))||s)})()}getAudioUUID(i){return i.match(BI)[1]}getAudioSrc(i){return i.match(Rv)?i:`/content/states/${i}`}muteAudio(){this.audioPlayers.forEach(i=>{i.mute(!0)})}unmuteAudio(i){const s=this.audioPlayers.get(i);s&&(s.mute(!1),this.store.dispatch(new Ei.SetAudioMuted(!1)))}stopAllAudio(){this.stopAudio()}stopAllOtherAudio(i){this.stopAudio(i)}stopAudio(i){this.audioPlayers.forEach((s,r)=>{(!i||r!==i)&&s.stop()})}playAudio(i,s){this.getAudioPlayer(i).then(r=>{r&&((0,m.isNil)(s)||(r.mute(s),this.store.dispatch(new Ei.SetAudioMuted(s))),r.play())})}playChapterAudio(i){this.stopAllAudio(),this.playAudio(i,!1),this.store.dispatch(new Ei.SetAutoplayAudio(!0)),this.store.dispatch(new Ei.SetAudioMuted(!1))}getPlayingAudio(){const i=[];return this.audioPlayers.forEach(s=>{s.playing()&&i.push(s)}),i}getChapterAudioPlayer(i,s,r=!1){var a=this;return(0,J.A)(function*(){return a.getChapterAudioPlaybackType(i,s,r)!==ri.None?a.hasAudioPlayer(i.id)?yield a.getAudioPlayer(i.id):yield a.createChapterAudioPlayer(i,s,r):null})()}createChapterAudioPlayer(i,s,r=!1){var a=this;return(0,J.A)(function*(){const l=a.getChapterAudioPlaybackType(i,s,r),_=a.buildChapterAudioSources(i,l,s);return l===ri.None?null:yield a.addAudioPlayer(i.id,_,!0,{preload:!0,mute:!0})})()}buildChapterAudioSources(i,s,r){var a=this;return(0,J.A)(function*(){const _=a.getChapterAudioInLanguage(i,r)?.fullUrl??"",d=i?.description,p=Cl.find(u=>u.lang===r);switch(s){case ri.File:return _?[a.getAudioSrc(_)]:[];case ri.TTS:return a.getTTSSources(d,p?.id);default:return[]}})()}getChapterAudioList(i){return i.media?Object.values(i.media).filter(r=>"audio"===r.streamType):[]}getChapterAudioInLanguage(i,s){return this.getChapterAudioList(i).find(a=>a.lang===s)}getChapterAudioPlaybackType(i,s,r=!1){let a=i?.ui?.config?.audio??ri.File;const l=!(0,m.isNil)(this.getChapterAudioList(i).find(d=>d.lang===s));r&&!l&&a!==ri.TTS&&(a=ri.TTS);const _=(0,m.trim)(i?.description??"").length>0;switch(a){case ri.File:return l?ri.File:ri.None;case ri.TTS:return _?ri.TTS:ri.None;default:return ri.None}}chapterHasAudio(i,s){return this.getChapterAudioPlaybackType(i,s)!==ri.None}getVideoPlayer(i){return this.videoPlayers.get(i)}createVideoPlayer(i,s){return(0,J.A)(function*(){return(0,(yield S.e(78).then(S.bind(S,4697))).default)(i,s)})()}getVideoEvents(){return this.videoEventSubject.asObservable()}addVideoPlayer(i,s){var r=this;return(0,J.A)(function*(){const a=yield r.createVideoPlayer(i,s),l=a.id();return a.on("play",()=>{r.videoEventSubject.next({event:"play",id:l})}),a.on("pause",()=>{r.videoEventSubject.next({event:"pause",id:l})}),a.on("seeking",()=>{r.videoEventSubject.next({event:"seeking",id:l})}),a.on("ended",()=>{r.videoEventSubject.next({event:"ended",id:l})}),a.on("error",()=>{r.videoEventSubject.next({event:"error",id:l})}),r.videoPlayers.set(l,a),l})()}removeVideoPlayer(i){const s=this.getVideoPlayer(i);s&&(s.dispose(),this.videoPlayers.delete(i))}getVideoUrls(i){return this.http.post("/ws/mc/video/upload/authorize",{filename:i})}checkVideoStatus(i){return this.videoSources.has(i)?new f.c(s=>{s.next(this.videoSources.get(i)),s.complete()}):this.http.get(i).pipe((0,F.T)(s=>{const r=s.listing.map(a=>({src:a,type:this.getFileMIMEType(a)}));return this.videoSources.set(i,r),r}),(0,pi.W)(()=>(0,Qe.of)(!1)))}getFileMIMEType(i){const s=i.split(".").pop(),r=wv[`.${s}`];return r?r[0]:""}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(t._9s),t.KVO($e.Qq),t.KVO(Ti.Rl),t.KVO(bi),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class to{}let Dv=(()=>{class e{constructor(i,s){this.query=i,this.lang=s}}return e.type="[Bookmarks] Load",e})(),Lv=(()=>{class e{constructor(i,s,r){this.organizationId=i,this.query=s,this.lang=r}}return e.type="[Bookmarks] Load Organization Bookmarks",e})(),Uv=(()=>{class e{constructor(i,s,r,a){this.organizationId=i,this.collectionId=s,this.query=r,this.lang=a}}return e.type="[Bookmarks] Load Collection Bookmarks",e})(),Oh=(()=>{class e{constructor(i,s,r=!1){this.id=i,this.type=s,this.preview=r}}return e.type="[Bookmarks] Select Bookmark",e})(),wh=(()=>{class e{constructor(i){this.bookmark=i}}return e.type="[Bookmarks] Select Bookmark Success",e})(),ql=(()=>{class e{constructor(i){this.result=i}}return e.type="[Bookmarks] Load Success",e})(),Vv=(()=>{class e{constructor(i){this.bookmarkId=i}}return e.type="[Bookmarks] Delete Bookmark",e})(),Mh=(()=>{class e{constructor(i){this.bookmarkId=i}}return e.type="[Bookmarks] Bookmark Delete Success",e})(),WI=(()=>{class e{constructor(i,s){this.bookmarkId=i,this.error=s}}return e.type="[Bookmarks] Bookmark Delete Fail",e})(),jv=(()=>{class e{constructor(i,s,r=!0){this.bookmarkEntry=i,this.inplace=s,this.includeIndex=r}}return e.type="[Bookmarks] Save Bookmark",e})(),Yd=(()=>{class e{constructor(i,s,r){this.bookmark=i,this.story=s,this.method=r}}return e.type="[Bookmarks] Bookmark Saved",e})(),Ih=(()=>{class e{constructor(i,s){this.bookmarkEntry=i,this.error=s}}return e.type="[Bookmarks] Bookmark Save Failed",e})(),xv=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Cancel Save Bookmark",e})(),Ah=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Reset",e})(),Gv=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Clear Bookmarks",e})(),$v=(()=>{class e{constructor(i){this.sort=i}}return e.type="[Bookmarks] Sort",e})(),Fv=(()=>{class e{constructor(i,s){this.id=i,this.checked=s}}return e.type="[Bookmarks] Check Bookmark",e})(),Bv=(()=>{class e{constructor(i){this.ids=i}}return e.type="[Bookmarks] Set Checked Bookmarks",e})(),zv=(()=>{class e{constructor(i,s,r,a,l,_,d,p,u){this.bookmarks=i,this.organizationId=s,this.collections=r,this.widgetURL=a,this.userLanguage=l,this.userApp=_,this.widgetOptions=d,this.offlineEnabled=p,this.productAccountId=u}}return e.type="[Bookmarks] Export Bookmarks",e})(),XI=(()=>{class e{constructor(i){this.bookmarks=i}}return e.type="[Bookmarks] Export Bookmarks Success",e})(),HI=(()=>{class e{constructor(i){this.bookmarks=i}}return e.type="[Bookmarks] Export Bookmarks Error",e})(),Ph=(()=>{class e{constructor(i,s=[],r=new Map){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return e.type="[Bookmarks] Update Bookmark Collections",e})(),Wv=(()=>{class e{constructor(i,s,r){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return e.type="[Bookmarks] Update Bookmark Collections Success",e})(),Xv=(()=>{class e{constructor(i,s,r){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return e.type="[Bookmarks] Update Bookmark Collections Error",e})(),QI=(()=>{class e{constructor(i,s){this.bookmark=i,this.collections=s}}return e.type="[Bookmarks] Add Bookmark Collections Success",e})(),YI=(()=>{class e{constructor(i,s){this.bookmark=i,this.collections=s}}return e.type="[Bookmarks] Add Bookmark Collections Error",e})(),Nh=(()=>{class e{constructor(i,s){this.bookmark=i,this.collections=s}}return e.type="[Bookmarks] Remove Bookmark Collections Success",e})(),qI=(()=>{class e{constructor(i,s){this.bookmark=i,this.collections=s}}return e.type="[Bookmarks] Remove Bookmark Collections Error",e})(),Hv=(()=>{class e{constructor(i,s,r,a=Zi.lang,l,_){this.id=i,this.title=s,this.type=r,this.lang=a,this.groupAccess=l,this.collections=_}}return e.type="[Bookmarks] Copy Bookmark",e})(),KI=(()=>{class e{constructor(i){this.newBookmark=i}}return e.type="[Bookmarks] Copy Bookmark Success",e})(),JI=(()=>{class e{constructor(i,s){this.id=i,this.error=s}}return e.type="[Bookmarks] Copy Bookmark Failure",e})(),Qv=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Cancel Copy Bookmark",e})(),Yv=(()=>{class e{constructor(i){this.title=i}}return e.type="[Bookmarks] Set Bookmark Text",e})(),qv=(()=>{class e{constructor(i){this.viewMode=i}}return e.type="[Bookmarks] Set Bookmark View Mode",e})(),Kv=(()=>{class e{constructor(i){this.category=i}}return e.type="[Bookmarks] Set Selected Category",e})(),Kl=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Get Bookmark Jobs",e})(),Rh=(()=>{class e{constructor(i){this.bookmarkJobs=i}}return e.type="[Bookmarks] Set Bookmark Jobs",e})(),kh=(()=>{class e{constructor(i){this.bookmarkJobs=i}}return e.type="[Bookmarks] Get Bookmark Jobs Success",e})(),ZI=(()=>{class e{constructor(i){this.error=i}}return e.type="[Bookmarks] Get Bookmark Jobs Failure",e})(),Jv=(()=>{class e{constructor(i,s){this.jobId=i,this.jobType=s}}return e.type="[Bookmarks] Cancel Bookmark Job",e})(),eA=(()=>{class e{constructor(i,s){this.jobId=i,this.jobType=s}}return e.type="[Bookmarks] Cancel Bookmark Job Success",e})(),tA=(()=>{class e{constructor(i,s,r){this.jobId=i,this.jobType=s,this.error=r}}return e.type="[Bookmarks] Cancel Bookmark Job Fail",e})(),Zv=(()=>{class e{constructor(i){this.copyBookmarkModels=i}}return e.type="[Bookmarks] Bulk Copy Bookmarks",e})(),nA=(()=>{class e{constructor(i,s){this.copyBookmarkModels=i,this.jobId=s}}return e.type="[Bookmarks] Bulk Copy Bookmarks Processing",e})(),e0=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Bulk Copy Bookmarks Error",e})(),t0=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Bulk Copy Bookmarks Complete",e})(),iA=(()=>{class e{constructor(i,s){this.copyBookmarkModels=i,this.error=s}}return e.type="[Bookmarks] Bulk Copy Bookmarks Failure",e})(),n0=(()=>{class e{constructor(i){this.bookmarkIds=i}}return e.type="[Bookmarks] Bulk Delete Bookmark",e})(),oA=(()=>{class e{constructor(i,s){this.deleteBookmarkIds=i,this.jobId=s}}return e.type="[Bookmarks] Bookmark Bulk Delete Processing",e})(),i0=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Bookmark Bulk Delete Complete",e})(),sA=(()=>{class e{constructor(i,s){this.bookmarkIds=i,this.error=s}}return e.type="[Bookmarks] Bookmark Bulk Delete Fail",e})(),o0=(()=>{class e{constructor(){}}return e.type="[Bookmarks] Bulk Delete Bookmarks Error",e})(),s0=(()=>{class e{constructor(i,s){this.groupId=i,this.updates=s}}return e.type="[Bookmarks] Bulk Update Bookmark Collections",e})(),rA=(()=>{class e{constructor(i){this.updates=i}}return e.type="[Bookmarks] Bulk Update Bookmark Collections Success",e})(),aA=(()=>{class e{constructor(i,s){this.updates=i,this.error=s}}return e.type="[Bookmarks] Bulk Update Bookmark Collections Error",e})();var qd=S(4346),Ga=S(9833);class lA{}var $a=function(n){return n.UserGeneratedTour="user_generated_tour",n.Animated="animated",n.Quiz="quiz",n.ModeQuiz="mode_quiz",n.ModeContent="mode_content",n}($a||{}),js=function(n){return n.Private="private",n.Group="enterprise",n.Public="public",n}(js||{});let Dh=(()=>{class e{constructor(){}}return e.type="[Auth] Is Logged In",e})(),Kd=(()=>{class e{constructor(i){this.sessionType=i}}return e.type="[Auth] Is Logged In Success",e})(),Jd=(()=>{class e{constructor(i){this.sessionType=i}}return e.type="[Auth] Is Logged In Failure",e})(),r0=(()=>{class e{constructor(i,s){this.login=i,this.verification=s}}return e.type="[Auth] Login With Biodigital",e})(),a0=(()=>{class e{constructor(){}}return e.type="[Auth] Initialize Google Auth",e})(),cA=(()=>{class e{constructor(i){this.credential=i}}return e.type="[Auth] Authenticate With Google",e})(),_A=(()=>{class e{constructor(){}}return e.type="[Auth] Prompt With Google",e})(),Lh=(()=>{class e{constructor(i){this.promptResult=i}}return e.type="[Auth] Prompt With Google Success",e})(),l0=(()=>{class e{constructor(i){this.login=i}}return e.type="[Auth] Login With Google",e})(),c0=(()=>{class e{constructor(i){this.login=i}}return e.type="[Auth] Login With Group",e})(),Jl=(()=>{class e{constructor(i,s){this.loginType=i,this.response=s}}return e.type="[Auth] Login Success",e})(),Zl=(()=>{class e{constructor(i,s,r){this.loginType=i,this.error=s,this.login=r}}return e.type="[Auth] Login Failure",e})(),_0=(()=>{class e{constructor(){}}return e.type="[Auth] Logout",e})(),Uh=(()=>{class e{constructor(){}}return e.type="[Auth] Logout Success",e})(),dA=(()=>{class e{constructor(){}}return e.type="[Auth] Logout Failure",e})(),d0=(()=>{class e{constructor(){}}return e.type="[Auth] Get Environment Settings",e})(),Vh=(()=>{class e{constructor(i){this.environmentSettings=i}}return e.type="[Auth] Get Environment Settings Success",e})(),pA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Get Environment Settings Failure",e})(),jh=(()=>{class e{constructor(){}}return e.type="[Auth] Get Group User Profile",e})(),xh=(()=>{class e{constructor(i){this.groupUserProfile=i}}return e.type="[Auth] Get Group User Profile Success",e})(),uA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Get Group User Profile Failure",e})(),Gh=(()=>{class e{constructor(i=!1){this.hardCheck=i}}return e.type="[Auth] Get User Profile",e})(),$h=(()=>{class e{constructor(i){this.userProfile=i}}return e.type="[Auth] Get User Profile Success",e})(),gA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Get User Profile Failure",e})(),Fh=(()=>{class e{constructor(i){this.userProfile=i}}return e.type="[Auth] Update User Profile",e})(),p0=(()=>{class e{constructor(i){this.userProfile=i}}return e.type="[Auth] Update User Profile Success",e})(),hA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Update User Profile Failure",e})(),u0=(()=>{class e{constructor(){}}return e.type="[Auth] Delete User Profile",e})(),mA=(()=>{class e{constructor(i){this.userEmail=i}}return e.type="[Auth] Delete User Profile Success",e})(),fA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Delete User Profile Failure",e})(),g0=(()=>{class e{constructor(i){this.email=i}}return e.type="[Auth] Check Profile",e})(),Bh=(()=>{class e{constructor(i){this.profile=i}}return e.type="[Auth] Check Profile Success",e})(),SA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Check Profile Failure",e})(),Zd=(()=>{class e{constructor(){}}return e.type="[Auth] Get User Roles",e})(),h0=(()=>{class e{constructor(i){this.email=i}}return e.type="[Auth] Reset Password",e})(),bA=(()=>{class e{constructor(i){this.email=i}}return e.type="[Auth] Reset Password Success",e})(),yA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Reset Password Failure",e})(),m0=(()=>{class e{constructor(i){this.email=i}}return e.type="[Auth] Transfer Facebook Account",e})(),vA=(()=>{class e{constructor(i){this.email=i}}return e.type="[Auth] Transfer Facebook Account Success",e})(),f0=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Transfer Facebook Account Failure",e})(),S0=(()=>{class e{constructor(i,s,r){this.currentPassword=i,this.newPassword=s,this.confirmNewPassword=r}}return e.type="[Auth] Update Password",e})(),EA=(()=>{class e{constructor(){}}return e.type="[Auth] Update Password Success",e})(),TA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Update Password Failure",e})(),ep=(()=>{class e{constructor(){}}return e.type="[Auth] Check Session",e})(),b0=(()=>{class e{constructor(i,s){this.value=i,this.verification=s}}return e.type="[Auth] Sign Up",e})(),zh=(()=>{class e{constructor(i){this.response=i}}return e.type="[Auth] Sign Up Success",e})(),Wh=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Sign Up Failure",e})(),Xh=(()=>{class e{constructor(i,s){this.locale=i,this.reload=s}}return e.type="[Auth] Set User Locale",e})(),Hh=(()=>{class e{constructor(i){this.locale=i}}return e.type="[Auth] Set User Locale Success",e})(),Fa=(()=>{class e{constructor(){}}return e.type="[Auth] Check Locale",e})(),Qh=(()=>{class e{constructor(){}}return e.type="[Auth] Get User Apps",e})(),Yh=(()=>{class e{constructor(i){this.apps=i}}return e.type="[Auth] Set User Apps",e})(),tp=(()=>{class e{constructor(){}}return e.type="[Auth] Check Selected App",e})(),np=(()=>{class e{constructor(i){this.appId=i}}return e.type="[Auth] Set Selected User App",e})(),y0=(()=>{class e{constructor(i){this.message=i}}return e.type="[Auth] Send User Message",e})(),CA=(()=>{class e{constructor(i){this.message=i}}return e.type="[Auth] Send User Message Success",e})(),OA=(()=>{class e{constructor(i){this.err=i}}return e.type="[Auth] Send User Message Fail",e})(),v0=(()=>{class e{constructor(i,s){this.type=i,this.mode=s}}return e.type="[Auth] Get User Message",e})(),wA=(()=>{class e{constructor(i){this.message=i}}return e.type="[Auth] Get User Message Success",e})(),MA=(()=>{class e{constructor(i){this.type=i}}return e.type="[Auth] Get User Message Fail",e})(),E0=(()=>{class e{constructor(i){this.messageSeenId=i}}return e.type="[Auth] Set Message Viewed",e})(),IA=(()=>{class e{constructor(){}}return e.type="[Auth] Set Message Viewed Success",e})(),AA=(()=>{class e{constructor(){}}return e.type="[Auth] Set Message Viewed Fail",e})(),Ba=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Verify Fail",e})(),qh=(()=>{class e{constructor(){}}return e.type="[Auth] Reset",e})(),T0=(()=>{class e{constructor(i,s){this.email=i,this.token=s}}return e.type="[Auth] Request Verification Code",e})(),PA=(()=>{class e{constructor(i){this.response=i}}return e.type="[Auth] Request Verification Code Success",e})(),NA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Request Verification Code Fail",e})(),C0=(()=>{class e{constructor(i,s,r){this.email=i,this.token=s,this.code=r}}return e.type="[Auth] Verify Profile",e})(),O0=(()=>{class e{constructor(i){this.response=i}}return e.type="[Auth] Verify Profile Success",e})(),Kh=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Verify Profile Fail",e})(),w0=(()=>{class e{constructor(i,s){this.contentId=i,this.contentType=s}}return e.type="[Auth] Set Content Viewed",e})(),RA=(()=>{class e{constructor(){}}return e.type="[Auth] Set Content Viewed Success",e})(),Jh=(()=>{class e{constructor(){}}return e.type="[Auth] Check Content Viewed",e})(),kA=(()=>{class e{constructor(i){this.contentViews=i}}return e.type="[Auth] Check Content Viewed Success",e})(),M0=(()=>{class e{constructor(i){this.isDeveloperReferral=i}}return e.type="[Auth] Set Developer Referral",e})(),DA=(()=>{class e{}return e.type="[Auth] Get User Notices",e})(),LA=(()=>{class e{constructor(i){this.userNotices=i}}return e.type="[Auth] Get User Notices Success",e})(),UA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Get User Notices Fail",e})(),I0=(()=>{class e{constructor(i){this.noticeId=i}}return e.type="[Auth] Mark User Notice As Seen",e})(),VA=(()=>{class e{constructor(i){this.noticeId=i}}return e.type="[Auth] Mark User Notice As Seen Success",e})(),jA=(()=>{class e{constructor(i){this.error=i}}return e.type="[Auth] Mark User Notice As Seen Fail",e})();class A0{}class Zh{}!function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,qS.Z)(()=>A0),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],Zh.prototype,"organizations",void 0);class em{static fromJSON(e){const o=new em;return o.isUser=e.is_user,o.email=e.user_email,o.firstName=e.user_first_name,o.lastName=e.user_last_name,o.name=`${e.user_first_name} ${e.user_last_name}`,o.isDeveloper=e.user_is_developer,o.isDeveloperActive=e.user_is_developer_active,o.isDeveloperVerified=e.user_is_developer_verified,o.isThirdParty=e.user_is_third_party,o.thirdPartyProvider=e.user_third_party_provider,o.isTeamMember=e.user_is_team_member,o}}class tm{static fromJSON(e){const o=new tm;return o.google=e.google_api_key,o}}class ip{constructor(){this.version=5,this.groupInviteMode=0,this.groupCodeMode=0}}class FA extends ip{static toJSON(e){return{version:e.version,app_producttype:e.app_producttype,app_productkey:e.app_productkey,email:e.email,password:e.password,first_name:e.firstName,last_name:e.lastName,group_invite_mode:e.groupInviteMode,group_invite_key:e.groupInviteKey,group_code_mode:e.groupCodeMode,group_code:e.groupCode,group_ovid_mode:e.groupOvidMode,group_ovid_osptok:e.groupOvidOsptok,platform:e.platform,return_to:e.returnTo,brand_id:e.brandId,locale_id:e.localeId,timestamp:e.timestamp,site_verify_response:e.site_verify_response}}}class BA extends ip{constructor(e){super(),this.token=e}static toJSON(e){return{id_token:e.token,version:e.version,app_producttype:e.app_producttype,app_productkey:e.app_productkey,group_invite_mode:e.groupInviteMode,group_invite_key:e.groupInviteKey,group_code_mode:e.groupCodeMode,group_code:e.groupCode,group_ovid_mode:e.groupOvidMode,group_ovid_osptok:e.groupOvidOsptok,platform:e.platform,return_to:e.returnTo,brand_id:e.brandId,locale_id:e.localeId,timestamp:e.timestamp,site_verify_response:e.site_verify_response}}}class zA extends ip{constructor(e,o,i){super(),this.email=e,this.password=o,this.rememberMe=i}static toJSON(e){return{id_token:e.token,version:e.version,app_producttype:e.app_producttype,app_productkey:e.app_productkey,group_invite_mode:e.groupInviteMode,group_invite_key:e.groupInviteKey,group_code_mode:e.groupCodeMode,group_code:e.groupCode,group_ovid_mode:e.groupOvidMode,group_ovid_osptok:e.groupOvidOsptok,email:e.email,password:e.password,email_remember_me:e.rememberMe,platform:e.platform,return_to:e.returnTo,brand_id:e.brandId,locale_id:e.localeId,timestamp:e.timestamp,site_verify_response:e.site_verify_response}}}var P0=S(9242),N0=function(n){return n.Zendesk="zendesk",n}(N0||{});class nm{}var qt=function(n){return n.AssignRole="assignRole",n.RemoveUser="removeUser",n.TransferContent="transferContent",n.CreateCollection="createCollection",n.DeleteCollection="deleteCollection",n.EditTeamAccount="editTeamAccount",n.EditTeamBookmarks="editTeamBookmarks",n.EditAllTeamBookmarks="editAllTeamBookmarks",n.AddTeamBookmarks="addTeamBookmarks",n.RemoveTeamBookmarks="removeTeamBookmarks",n.EditBookmarks="editBookmarks",n.PublishBookmarks="publishBookmarks",n.SavePrivateBookmarks="savePrivateBookmarks",n.CopyUrl="copyURL",n.ViewBookmarks="viewBookmarks",n.InviteUsers="inviteUsers",n.ViewUsers="viewUsers",n.ExportCSV="exportCSV",n.DuplicateTeamBookmarks="duplicateTeamBookmarks",n.BulkManageTeamBookmarks="bulkManageTeamBookmarks",n.ManageJoinRequests="manageJoinRequests",n}(qt||{}),no=function(n){return n.Admin="admin",n.Creator="creator",n.Viewer="viewer",n}(no||{});const R0=[qt.ViewBookmarks,qt.CopyUrl,qt.SavePrivateBookmarks,qt.ExportCSV],im=[...R0,qt.ViewUsers,qt.InviteUsers,qt.PublishBookmarks,qt.EditBookmarks,qt.EditTeamBookmarks,qt.RemoveTeamBookmarks,qt.AddTeamBookmarks,qt.DuplicateTeamBookmarks,qt.BulkManageTeamBookmarks],WA=[...im,qt.EditTeamAccount,qt.EditAllTeamBookmarks,qt.CreateCollection,qt.TransferContent,qt.RemoveUser,qt.AssignRole,qt.ManageJoinRequests],op=[no.Viewer,no.Creator,no.Admin],ec={role_id:void 0,role_name:no.Creator,role_display_name:"",role_description:"",permissions:[...im]},XA={permissions:[qt.ViewBookmarks,qt.SavePrivateBookmarks,qt.PublishBookmarks,qt.EditBookmarks]},HA={[no.Viewer]:R0,[no.Creator]:im,[no.Admin]:WA},QA={[no.Viewer]:"Can view team content and edit personal content",[no.Creator]:"Can edit and view team content",[no.Admin]:"Can manage team settings and edit all content"};function YA(n){return HA[n]||[]}function tc(n){const e=n?.role_name??ec.role_name,o=n?.role_description??QA[e],i=n?.permissions;return{...n,role_description:o,permissions:(0,m.isNil)(i)?YA(e):i}}class qA{}class KA{}class JA{}var za=function(n){return n.DomainAlert="join_group_through_domain_alert",n.WelcomeTour="welcome_tour_alert",n.CompleteProfileAlert="complete_profile_alert",n}(za||{});let om=(()=>{var n;class e{constructor(i,s){this.http=i,this.storageService=s}getUserMessage(i,s="",r=!0){const a=this.getCachedMessage(i);return r&&a?(0,Qe.of)(a):this.http.get(`/ws/user/message?version=2&type=${i}&mode=${s}`).pipe((0,F.T)(l=>{const{message_seen_id:_,show_alert:d}=l;let p;switch(i){case za.DomainAlert:p=(0,je.bj)(A0,l.join_organization);break;case za.WelcomeTour:p=`${l.tour_version}`;break;case za.CompleteProfileAlert:const{is_new_user:u,is_team_user:g}=l||{};p=(0,je.bj)(JA,{is_new_user:u,is_team_user:g})}return{messageSeenId:_,messageType:i,showUserAlert:d,messageData:p}}),(0,qo.M)(l=>{l.showUserAlert||this.addCachedMessage(l)}))}setUserMessageViewed(i){return this.http.post("/ws/user/message",{version:2,message_seen_id:i})}sendMessage(i){return this.http.post("/ws/user/message",i)}getCachedMessage(i){return this.getCachedMessages().find(r=>r.messageType===i)}getCachedMessages(){return this.storageService.getSessionItem(ms.UserMessagesSeen)||[]}addCachedMessage(i){if(!this.getCachedMessage(i.messageType)){const s=this.getCachedMessages();this.storageService.setSessionItem(ms.UserMessagesSeen,[...s,i])}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Le))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class ZA extends ip{constructor(e,o,i,s){super(),this.app_producttype=e,this.app_productkey=o,this.groupOvidMode=i,this.groupOvidOsptok=s}static toJSON(e){return{version:e.version,app_producttype:e.app_producttype,app_productkey:e.app_productkey,group_ovid_mode:e.groupOvidMode,group_ovid_osptok:e.groupOvidOsptok,ignore_ovid_exp:he.application===bt.Studio&&he.deploy!==En.Production&&!1===he.native?1:0}}}const eP=["harvard.edu","liberty.edu"];let Wa=(()=>{var n;class e{constructor(i,s,r,a,l){this.http=i,this.reCaptchaV3Service=s,this.userMessageService=r,this.productService=a,this.RECAPTCHA_V3_SITE_KEY=l}loginWithBiodigital(i){return this.http.post("/ws/user/sign/in",zA.toJSON(i),{headers:this.productService.productHeader})}loginWithGoogle(i){return this.http.post("/ws/user/sign/in/google",BA.toJSON(i),{headers:this.productService.productHeader})}loginWithGroup(i){return this.http.post("/ws/organization/sign/in",ZA.toJSON(i),{headers:this.productService.productHeader})}logout(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/user/sign/out")}logoutGroup(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/organization/sign/out",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}checkProfile(i){return this.http.post("/ws/user/profile/check",{version:5,email:i,app_producttype:this.productService.productType,app_productkey:this.productService.productKey},{headers:this.productService.productHeader}).pipe((0,F.T)(l=>em.fromJSON(l)))}getUserProfile(i){return this.http.get("/ws/user/profile",{params:{version:2,subscription_hard_check:i?1:0}}).pipe((0,F.T)(a=>{const l=(0,je.bj)(Zh,a);return l.organizations.forEach(_=>{const d=(0,m.get)(_,"user_role",ec);_.user_role=tc(d)}),l}))}getUserRoles(){return this.http.get("/ws/organization/user/roles").pipe((0,F.T)(i=>i.user_roles.map(s=>tc((0,je.bj)(nm,s)))))}getGroupUserProfile(){return this.http.get("/ws/organization/profile",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}updaterUserProfile(i){return this.http.post("/ws/user/profile?version=2",i)}deleteUserProfile(){return this.http.post("/ws/user/profile/delete",{}).pipe((0,F.T)(i=>i.deleted_user_email))}getEnvironmentSettings(){return this.http.get("/ws/environment/settings?version=2").pipe((0,F.T)(i=>tm.fromJSON(i)))}getUserApps(){return this.http.get("/ws/developer/apps/profile").pipe((0,F.T)(i=>i&&i.apps?JSON.parse(i.apps):[]))}getGroupConfigFromRoute(i){const r=i.queryParams.code||"",a=i.queryParams.group_invite||"",l=i.queryParams.osptok||"";return{group:i.queryParams.group||"",groupCode:r,groupCodeMode:r?1:0,groupInviteMode:a?1:0,groupInviteKey:a,groupOvidMode:l?1:0,groupOvidOsptok:l}}getPlatformConfigFromRoute(i){const{zendesk_signin:s,return_to:r,brand_id:a,locale_id:l,timestamp:_}=i.queryParams;if("1"===s)return{platform:N0.Zendesk,returnTo:r,brandId:a,localeId:l,timestamp:_}}isLoggedIn(){return this.http.get("/ws/product/account/is/signed-in",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}getProfileRestrictions(i){let s=!1,r=!1,a="";return i.organizations.forEach(l=>{s||r||(a=l.name,s=l.user_is_subscribed&&l.email_domain_restriction&&!l.user_has_email_domain_access,r=l.user_is_subscribed&&l.ip_address_restriction&&!l.user_has_domain_access)}),{organizationName:a,email:s,ip:r}}resetPassword(i){return this.http.post("/ws/user/password/forgot",{email:i})}deactivateFacebook(i){return this.http.post("/ws/user/sign/in/facebook/deactivate",i)}updatePassword(i,s,r){return this.http.post("/ws/user/password/change",{current_password:i,new_password:s,confirm_new_password:r})}signUp(i){return this.http.post("/ws/user/sign/up",FA.toJSON(i),{headers:this.productService.productHeader})}verifyToken(i,s){return this.http.post("/ws/recaptcha/siteverify",{recaptcha_reponse_token:i,recaptcha_version:s})}verifyReCaptcha(i,s){return s&&grecaptcha.reset(this.RECAPTCHA_V3_SITE_KEY),this.reCaptchaV3Service.execute(i).pipe((0,At.Z)(r=>this.verifyToken(r,"v3")),(0,F.T)(r=>({isHuman:r.action===i&&r.score>.2,verification:r})))}isReCaptchaWhiteListed(i){return eP.some(s=>new RegExp(`${s}$`,"i").test(i))}verifyIsHuman(i,s,r=!1){return this.isReCaptchaWhiteListed(s)?(0,Qe.of)({isHuman:!0}):this.verifyReCaptcha(i,r)}isValidGoogleDomain(){return new Set(["human-qa.biodigital.com","human-staging.biodigital.com","human.biodigital.com","loft.biodigital.com","loft-qa.biodigital.com","qa.biodigital.com","localhost:4200","localhost:4201"]).has(window.location.host)}requestVerificationCode(i){const s={...i,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/request",s).pipe((0,F.T)(r=>(0,je.bj)(qA,r)))}verifyProfile(i){const s={...i,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/confirm",s).pipe((0,F.T)(r=>(0,je.bj)(KA,r)))}checkProfileIncomplete(){return this.userMessageService.getUserMessage(za.CompleteProfileAlert,"v2",!1).pipe((0,pi.W)(()=>(0,Qe.of)({messageType:za.CompleteProfileAlert,messageData:{},showUserAlert:!1})))}getUserNotices(){const s=new $e.Nl({fromObject:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}});return this.http.get("ws/user/notices",{params:s})}markUserNoticeAsSeen(i){return this.http.post("ws/user/notices/seen",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,notice_id:i})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(P0.ob),t.KVO(om),t.KVO(Si),t.KVO(P0.gq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),sp=(()=>{class e{constructor(i){this.organizations=i}}return e.type="[Organizations] Set Organizations",e})(),k0=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Organizations] Select Organization",e})(),D0=(()=>{class e{constructor(i){this.collection=i}}return e.type="[Organizations] Select Collection",e})(),sm=(()=>{class e{constructor(i){this.organizationId=i}}return e.type="[Organizations] Get Collections",e})(),rm=(()=>{class e{constructor(i){this.collections=i}}return e.type="[Organizations] Get Collections Success",e})(),L0=(()=>{class e{constructor(i,s){this.organizationId=i,this.collectionName=s}}return e.type="[Organizations] Add Collection",e})(),am=(()=>{class e{constructor(i,s){this.organizationId=i,this.collectionName=s}}return e.type="[Organizations] Add Collection Success",e})(),lm=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Add Collection Error",e})(),U0=(()=>{class e{constructor(i){this.collection=i}}return e.type="[Organizations] Remove Collection",e})(),cm=(()=>{class e{constructor(i){this.collection=i}}return e.type="[Organizations] Remove Collection Success",e})(),_m=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Remove Collection Error",e})(),V0=(()=>{class e{constructor(i){this.collection=i}}return e.type="[Organizations] Set Collection Rename Mode",e})(),j0=(()=>{class e{constructor(i,s){this.collection=i,this.collectionName=s}}return e.type="[Organizations] Rename Collection",e})(),dm=(()=>{class e{constructor(i,s){this.collection=i,this.collectionName=s}}return e.type="[Organizations] Rename Collection Success",e})(),pm=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Rename Collection Error",e})(),x0=(()=>{class e{constructor(i,s){this.organizationId=i,this.collections=s}}return e.type="[Organizations] Reorder Collections",e})(),um=(()=>{class e{constructor(i,s){this.organizationId=i,this.collections=s}}return e.type="[Organizations] Reorder Collections Success",e})(),tP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Reorder Collections Error",e})(),gm=(()=>{class e{constructor(){}}return e.type="[Organizations] Reset",e})(),G0=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Organizations] Create Organization",e})(),$0=(()=>{class e{constructor(){}}return e.type="[Organizations] Create Organization Success",e})(),hm=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Create Organization Fail",e})(),F0=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Organizations] Update Organization",e})(),nP=(()=>{class e{constructor(){}}return e.type="[Organizations] Update Organization Success",e})(),iP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Update Organization Fail",e})(),B0=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Organizations] Delete Organization",e})(),oP=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Organizations] Delete Organization Success",e})(),sP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Delete Organization Fail",e})(),z0=(()=>{class e{constructor(i){this.request=i}}return e.type="[Organizations] Get Organization Profile",e})(),mm=(()=>{class e{constructor(i){this.organizationProfile=i}}return e.type="[Organizations] Get Organization Profile Success",e})(),rP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Get Organization Profile Fail",e})(),W0=(()=>{class e{constructor(){}}return e.type="[Organizations] Clear Organization Profile",e})(),X0=(()=>{class e{constructor(i){this.params=i}}return e.type="[Organizations] Get Join Domains",e})(),fm=(()=>{class e{constructor(i){this.joinDomains=i}}return e.type="[Organizations] Get Join Domains Success",e})(),H0=(()=>{class e{constructor(i){this.emailDomains=i}}return e.type="[Organizations] Post Join Domains",e})(),aP=(()=>{class e{constructor(i){this.emailDomains=i}}return e.type="[Organizations] Post Join Domains Success",e})(),lP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Post Join Domains Fail",e})(),Q0=(()=>{class e{constructor(i){this.joinDomainIds=i}}return e.type="[Organizations] Delete Join Domains",e})(),cP=(()=>{class e{constructor(i){this.joinDomainIds=i}}return e.type="[Organizations] Delete Join Domains Success",e})(),_P=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Delete Join Domains Fail",e})(),Y0=(()=>{class e{constructor(i){this.groupId=i}}return e.type="[Organizations] Generate Group Code",e})(),Sm=(()=>{class e{constructor(i){this.groupCode=i}}return e.type="[Organizations] Generate Group Code Success",e})(),dP=(()=>{class e{constructor(i){this.error=i}}return e.type="[Organizations] Generate Group Code Fail",e})();var pP=S(5801);const uP={"en-US":!0,"en-GB":!0,"es-ES":!0,"es-MX":!0,"fr-FR":!0,"it-IT":!0,"pt-PT":!0,"pt-BR":!0,"de-DE":!1,"zh-CN":!1,"cmn-CN":!1,ja:!1,"ja-JP":!1,"he-IL":!1};function K0(n,e){return()=>{if(e===Zi.id)return(0,Qe.of)({});const o=KS[e]??e;return function q0(n,e){const o=KS[e]??e;return uP[o]??1?n.get(`assets/locales/${o}.json`).pipe((0,pi.W)(()=>(0,Qe.of)(void 0))):(0,Qe.of)(void 0)}(n,e).pipe((0,go.n)(i=>{const s=i?.translations;return(0,m.isNil)(s)?console.warn(`Translations not found for locale: ${o}`):(0,pP.Zi)(s),(0,Qe.of)(i)}))}}let gP=(()=>{class e{constructor(i){this.view=i}}return e.type="[Edit] Set view",e})(),hP=(()=>{class e{constructor(){}}return e.type="[Edit] Reset",e})();var fn;!function(n){n.SetTheme=(()=>{class p{constructor(g){this.theme=g}}return p.type="[Layout] Set Theme",p})(),n.SetSidenav=(()=>{class p{constructor(g){this.sidenav=g}}return p.type="[Layout] Set Sidenav",p})(),n.ToggleSidenav=(()=>{class p{constructor(g){this.open=g}}return p.type="[Layout] Toggle Sidenav",p})(),n.SetHeader=(()=>{class p{constructor(g){this.siteHeaderType=g}}return p.type="[Layout] Set Header",p})(),n.SetFooter=(()=>{class p{constructor(g){this.siteFooterType=g}}return p.type="[Layout] Set Footer",p})(),n.SetHeaderHeight=(()=>{class p{constructor(g){this.height=g}}return p.type="[Layout] Set Header Height",p})(),n.SetFooterHeight=(()=>{class p{constructor(g){this.height=g}}return p.type="[Layout] Set Footer Height",p})(),n.ResetLayout=(()=>{class p{constructor(){}}return p.type="[Layout] Reset",p})()}(fn||(fn={}));class mP{constructor(e,o,i){this.category=e,this.message=o,this.log=i}}let J0=(()=>{var n;class e{constructor(i){this.http=i,this.log={}}logError(i,s=!1){const r=`${i.category}${i.message}`;return s&&this.log[r]?(0,Qe.of)():(this.log[r]=!0,this.http.post("/ws/human-error",i))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ct;!function(n){n.SetSearchMode=(()=>{class ge{constructor(We){this.searchMode=We}}return ge.type="[Gallery] Set Search Mode",ge})(),n.SetViewMode=(()=>{class ge{constructor(We){this.viewMode=We}}return ge.type="[Gallery] Set View Mode",ge})(),n.ShowFilters=(()=>{class ge{constructor(We,ln=!1){this.show=We,this.triggerDrawer=ln}}return ge.type="[Gallery] Show Filters",ge})(),n.GetStudioOptions=(()=>{class ge{constructor(We){this.organizationId=We}}return ge.type="[Gallery] Get Studio Options",ge})(),n.GetStudioOptionsSuccess=(()=>{class ge{constructor(We){this.options=We}}return ge.type="[Gallery] Get Studio Options Success",ge})(),n.SearchLoft=(()=>{class ge{constructor(We){this.config=We}}return ge.type="[Gallery] Search Loft",ge})(),n.SearchLoftSuccess=(()=>{class ge{constructor(We){this.bookmarks=We}}return ge.type="[Gallery] Search Loft Success",ge})(),n.SetSearchConfig=(()=>{class ge{constructor(We,ln){this.config=We,this.options=ln}}return ge.type="[Gallery] Set Search Config",ge})(),n.SetSearchOptions=(()=>{class ge{constructor(We){this.options=We}}return ge.type="[Gallery] Set Search Options",ge})(),n.SetActiveTags=(()=>{class ge{constructor(We){this.activeTags=We}}return ge.type="[Gallery] Set Active Tags",ge})(),n.SearchCategory=(()=>{class ge{constructor(We){this.categoryId=We}}return ge.type="[Gallery] Search Category",ge})(),n.SearchStudio=(()=>{class ge{constructor(){}}return ge.type="[Gallery] Search Studio",ge})(),n.SearchStudioSuccess=(()=>{class ge{constructor(We){this.bookmarks=We}}return ge.type="[Gallery] Search Studio Success",ge})(),n.SearchSuccess=(()=>{class ge{constructor(We){this.bookmarks=We}}return ge.type="[Gallery] Search Success",ge})(),n.SelectBookmark=(()=>{class ge{constructor(We){this.result=We}}return ge.type="[Gallery] Select Bookmark",ge})(),n.SetSidenav=(()=>{class ge{constructor(We){this.sidenav=We}}return ge.type="[Gallery] Set Sidenav",ge})(),n.SetBulkActions=(()=>{class ge{constructor(We){this.bulkActions=We}}return ge.type="[Gallery] Set Bulk Actions",ge})(),n.SetCardActions=(()=>{class ge{constructor(We){this.cardActions=We}}return ge.type="[Gallery] Set Card Actions",ge})(),n.ClearResults=(()=>{class ge{constructor(){}}return ge.type="[Gallery] Clear Results",ge})(),n.CheckItem=(()=>{class ge{constructor(We,ln){this.id=We,this.checked=ln}}return ge.type="[Gallery] Check Item",ge})(),n.CheckAll=(()=>{class ge{constructor(){}}return ge.type="[Gallery] Check All",ge})(),n.UncheckAll=(()=>{class ge{constructor(){}}return ge.type="[Gallery] Uncheck All",ge})(),n.SetCheckedItems=(()=>{class ge{constructor(We){this.ids=We}}return ge.type="[Gallery] Set Checked Items",ge})(),n.Reset=(()=>{class ge{constructor(){}}return ge.type="[Gallery] Reset",ge})()}(ct||(ct={}));var Z0=function(n){return n.Web="web",n.Mobile="mobilesdk",n}(Z0||{});let SP=(()=>{class e{}return e.type="[Subscription] Reset Subscription State",e})();const bP={"Sign in":"3971305","Sign up":"3971297"};let eE=(()=>{var n;class e{constructor(i){this.config=i,this.initialized=!1}initialize(){if(!this.config.enabled||this.initialized)return;const i=`\n      _linkedin_partner_id = "${this.config.linkedinId}"; \n      window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || []; \n      window._linkedin_data_partner_ids.push(_linkedin_partner_id);\n      (function(){var s = document.getElementsByTagName("script")[0]; var b = document.createElement("script"); b.type = "text/javascript";b.async = true; b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js"; s.parentNode.insertBefore(b, s);})();\n    `,s=document.createElement("script");s.textContent=i,document.body.appendChild(s),this.initialized=!0}track(i){const s=bP[i];if(s){const r=document.createElement("img");r.height=1,r.width=1,r.style.display="none",r.alt="",r.src=`https://px.ads.linkedin.com/collect/?pid=${this.config.linkedinId}&conversionId=${s}&fmt=gif`,document.body.appendChild(r)}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO("linkedinConfig"))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var nc=function(n){return n.Free="free",n.Premium="premium",n.Team="team",n}(nc||{});let bm=(()=>{var n;class e{constructor(i,s){this.http=i,this.productService=s}trackContentPublish(i,s){return this.http.post("/ws/user/analytics/content/inapp/publish",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:s,content_id:i})}trackContentView(i,s){return this.http.post("/ws/user/analytics/content/inapp/view",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:s,content_id:i})}checkContentView(){return this.http.get("/ws/user/content/inapp/view/check")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Si))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ko=function(n){return n.Private="Private",n.TeamView="Team - View Only",n.TeamEdit="Team - View & Edit",n}(ko||{});function io(n,e){return(0,m.get)(n,"permissions",[]).includes(e)}function ym(n){return Xa(n)&&!0===n.group_access[0].visible}function nE(n){return Xa(n)&&!0===n.group_access[0].member_edit}function vm(n){return!(0,m.isNil)(n.module_accessor_level)}function Xa(n){return Array.isArray(n.group_access)&&n.group_access.length>0}var Em=S(1217);function iE(n,e){return{type:n,data:e}}var oE=S(7153),Li=S(234);const Tm=oE.fQ[Li.a.WoltersKluwer],IP={};function xs(n,e){const o=function PP(n){return n instanceof Error?"":n?.error?.error?.error_id??""}(n),i=n instanceof Error?n.message:n?.error?.error?.message,s=function AP(n,e){switch(n){case"OPPH01.00126":case"SUH01.00040":return"This invite code is invalid or has expired. Please reach out to your administrator for a new code.";case"OPPH01.00122":case"SUH01.00122":case"SIH01.00122":case"FSH01.00122":case"GSH01.00122":return`We were unable to find an account associated with your institution. \n      Please contact your administrator [here](${Tm}) and provide this error ID: ${n}.`;case"OPPH01.00123":case"SUH01.00123":case"SIH01.00123":case"FSH01.00123":case"GSH01.00123":return`There are multiple team accounts associated with your institution. \n      Please contact your administrator [here](${Tm}) and provide this error ID: ${n}.`;case"OPPH01.00124":case"OPPH01.00125":case"OPPH01.00110":case"OPPH01.00111":case"OPPH01.00112":case"SUH01.00124":case"SUH01.00110":case"SUH01.00111":case"SUH01.00112":case"SIH01.00124":case"SIH01.00110":case"SIH01.00111":case"SIH01.00112":case"FSH01.00124":case"FSH01.00125":case"FSH01.00110":case"FSH01.00111":case"FSH01.00112":case"GSH01.00124":case"GSH01.00110":case"GSH01.00111":case"GSH01.00112":return`There was an issue with retrieving information from your institution. \n      Please try again or contact your administrator [here](${Tm}) and provide this error ID: ${n}.`;case"OSIH01.00111":case"OSIH01.00112":return"We were unable to load this page due to an invalid Ovid token";default:return IP[n]||""}}(o);return s||(i?i.replace(/^\[(.+)\]$/,"$1").replace(/^\'(.+)\'$/,"$1"):"")}class Do extends Error{constructor(){super("reCAPTCHA error. Please complete the form to continue.")}}var Gs,ic,Se=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},T=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const rp=he.application===bt.Studio,sE={signed_in:!1},Cm={loading:!1,requestingCode:!1,profileStatus:"ready",auth2:null,googleCredential:null,googlePromptResult:null,loggedIn:sE,userLocale:null,userRoles:[],contentViews:{limit_reached:!1,inapp_view_limit:0,inapp_view_count:0},developerReferral:!1};let ne=(Gs=class{static getLoggedIn(e){return!0===e.loggedIn?.signed_in}static getLoggedInState(e){return e.loggedIn}static getEnvironmentSettings(e){return e.environmentSettings}static getProfile(e){const{userProfile:o,groupUserProfile:i}=e;return(0,m.isNil)(o)?(0,m.isNil)(i)?void 0:iE(Em.P.Organization,i):iE(Em.P.User,o)}static getUserProfile(e){return e.userProfile}static getGroupUserProfile(e){return e.groupUserProfile}static getUserRole(e){return(0,m.isNil)(e.userProfile)?(0,m.isNil)(e.groupUserProfile)?void 0:XA:e.userProfile?.organizations[0]?.user_role??ec}static getUserRoles(e){return e.userRoles}static getSystemDefaultRole(e){return(e.userRoles??[]).find(s=>s.role_name===ec.role_name)??ec}static getUserType(e){if(!(0,m.isNil)(e.userProfile)){const{premium_account:o,premium_account_type:i}=e.userProfile;if(o)return"group"===i?nc.Team:nc.Premium}return nc.Free}static getUserSessionType(e){return e.loggedIn?.session_type}static canInviteUsers(e){if(!(0,m.isNil)(e.userProfile)){const o=ic.getUserType(e);return io(ic.getUserRole(e),qt.InviteUsers)&&o===nc.Team}return!1}static getUserAccountSettings(e){return e?.userProfile?.account_settings??[]}static getAuth2(e){return e.auth2}static getGooglePromptResult(e){return e.googlePromptResult}static getProfileCheck(e){return e.profileCheck}static getLoading(e){return e.loading}static getVerifyingProfile(e){return"verifying"===e.profileStatus}static getProfileUpdating(e){return"updating"===e.profileStatus}static getProfileDeleting(e){return"deleting"===e.profileStatus}static getUserLocale(e){return e.userLocale}static getUserLanguage(e){return e.userLocale?.lang||Zi.lang}static getUserApps(e){return e?.userApps??[]}static getSelectedUserApp(e){return(e.userApps||[]).find(i=>i.id===e.selectedAppId)}static getUserFullName(e){return(0,m.isNil)(e.userProfile)?null:(0,m.trim)([e.userProfile.first_name??"",e.userProfile.last_name??""].join(" "))}static getUserEmail(e){return(0,m.isNil)(e.userProfile)?null:e.userProfile.email}static isPrivateUser(e){return!(0,m.isNil)(e.userProfile)&&0===(e?.userProfile?.organizations??[]).length}static isPremiumUser(e){return!0===e?.userProfile?.premium_account_valid}static isAdmin(e){const o=this.getUserRole(e);return!!o&&o.role_name===no.Admin}static isDeveloperReferral(e){return e.developerReferral}static getContentViews(e){return e.contentViews}static getContentViewsReached(e){return!ic.isPremiumUser(e)&&e.contentViews.limit_reached}static hasActiveDeveloperAccount(e){return!(0,m.isNil)(e.userProfile)&&e.userProfile.developer_account&&(e.userProfile.developer_account_active||e.userProfile.developer_account_verified)&&e.userProfile.developer_has_apps}static getUserNotices(e){return e.userNotices}static canStartFreeTrial(e){return e.userProfile?.premium_account_eligibility.group_free_trial??!1}initializeGoogleAuth(e){const o=navigator.userAgent.indexOf("Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:")>=0&&navigator.userAgent.indexOf("0) Gecko/20100101 Firefox")>=0,i={client_id:he.googleAuthKey,itp_support:!1};o?(i.ux_mode="redirect",i.login_uri="https://"+window.location.host+"/ws/google/to/auth"):(i.ux_mode="popup",i.callback=s=>{e.patchState({googleCredential:s.credential}),e.dispatch(new cA(s.credential))}),google.accounts.id.initialize(i)}promptWithGoogle(e){google.accounts.id.prompt(o=>{const i={dismissedReason:o.getDismissedReason(),momentType:o.getMomentType(),notDisplayedReason:o.getNotDisplayedReason(),skippedReason:o.getSkippedReason()};e.dispatch(new Lh(i))})}promptWithGoogleSuccess(e,o){e.patchState({googlePromptResult:o.promptResult})}isLoggedIn(e,o){e.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{const{signed_in:s,session_type:r}=i;e.dispatch(s?new Kd(r):new Jd(r))})}isLoggedInSuccess(e,o){e.patchState({loggedIn:{signed_in:!0,session_type:o.sessionType}})}isLoggedInFailure(e,o){e.patchState({loggedIn:sE})}login(e,o){const{login:i,verification:s}=o,{email:r}=i;e.patchState({loading:!0}),(s?.isHuman?(0,Qe.of)(s):this.authService.verifyIsHuman("studio_login",r)).pipe((0,At.Z)(({isHuman:l,verification:_})=>{if(!l)throw new Do;return this.authService.loginWithBiodigital({...i,..._?{site_verify_response:_}:null})}),(0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe({next:l=>{e.dispatch(new Jl("biodigital",l))},error:l=>{l instanceof Do&&e.dispatch(new Ba(l)),this.logFailure("LOGIN_FAILURE",l),e.dispatch(new Zl("biodigital",l,i))}})}loginWithGoogle(e,o){e.patchState({loading:!0}),this.authService.loginWithGoogle(o.login).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new Jl("google",i))},i=>{(1===o.login.groupCodeMode||1===o.login.groupInviteMode)&&this.logFailure("GOOGLE_SIGNUP_FAILURE",i),e.dispatch(new Zl("google",i,o.login))})}loginWithGroup(e,o){e.patchState({loading:!0}),this.authService.loginWithGroup(o.login).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new Jl("group",i))},i=>{e.dispatch(new Zl("group",i,o.login))})}loginSuccess(e,o){rp&&(this.linkedinInsights.track("Sign in"),"google"===o.loginType&&"signup"===o.response.authentication_type?this.vendorAnalyticsService.trackSignUp(o.loginType):this.vendorAnalyticsService.trackSignIn(o.loginType)),e.dispatch(new Dh),e.dispatch(new Fa)}loginFailure(e,o){rp&&this.vendorAnalyticsService.track("Sign In - Failure",{type:o.loginType,error:xs(o.error)||"There was an error logging in.",statusCode:o.error?.status})}logout(e,o){e.patchState({loading:!0}),("organization"===e.getState().loggedIn?.session_type?this.authService.logoutGroup():this.authService.logout()).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(()=>e.dispatch(new Uh),()=>e.dispatch(new dA))}logoutSuccess(e,o){e.setState(Cm),e.dispatch(new qh),e.dispatch(new SP),e.dispatch(new Ah),e.dispatch(new hP),e.dispatch(new sg),e.dispatch(new ih),e.dispatch(new fn.ResetLayout),e.dispatch(new gm),e.dispatch(new db),e.dispatch(new Ag),e.dispatch(new ct.Reset),e.dispatch(new zy),this.storageService.clearSessionStorage()}checkProfile(e,o){return e.patchState({loading:!0}),this.authService.checkProfile(o.email).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new Bh(i))},i=>{e.dispatch(new SA(i))})}checkProfileSuccess(e,o){e.patchState({profileCheck:o.profile})}getGroupUserProfileAction(e,o){return e.patchState({loading:!0}),this.authService.getGroupUserProfile().pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new xh(i))},i=>{e.dispatch(new uA(i))})}getGroupUserProfileSuccess(e,{groupUserProfile:o}){e.patchState({userProfile:null,groupUserProfile:o}),e.dispatch(new sp(o.organizations)),e.dispatch(new Fa)}getUserProfile(e,{hardCheck:o}){return e.patchState({loading:!0}),this.authService.getUserProfile(o).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new $h(i))},i=>{e.dispatch(new gA(i))})}getUserProfileSuccess(e,o){e.patchState({userProfile:o.userProfile,groupUserProfile:null}),e.dispatch(new sp(o.userProfile.organizations)),e.dispatch(new Qh),e.dispatch(new Fa)}updateUserProfile(e,{userProfile:o}){e.patchState({profileStatus:"updating"}),this.authService.updaterUserProfile(o).pipe((0,Ye.j)(()=>e.patchState({profileStatus:"ready"}))).subscribe(()=>{e.dispatch(new p0(o))},i=>{e.dispatch(new hA(i))})}updateUserProfileSuccess(e,{userProfile:o}){this.vendorAnalyticsService.updateVisitorData(o)}deleteUserProfile(e,o){e.patchState({profileStatus:"deleting"}),this.authService.deleteUserProfile().pipe((0,Ye.j)(()=>e.patchState({profileStatus:"ready"}))).subscribe(i=>{e.dispatch(new mA(i))},i=>{e.dispatch(new fA(i))})}getUserRoles(e,o){this.authService.getUserRoles().subscribe(i=>{e.patchState({userRoles:i})})}getUserApps(e,o){this.authService.getUserApps().subscribe(i=>{e.dispatch(new Yh(i)),e.dispatch(new tp)},i=>{})}setUserApps(e,{apps:o}){e.patchState({userApps:o})}setSelectedUserApp(e,{appId:o}){e.patchState({selectedAppId:o}),null!==o?this.storageService.setLocalItem(In.UserAppId,o):this.storageService.removeLocalItem(In.UserAppId)}checkSelectedUserApp(e,o){const i=e.getState().userApps,s=this.storageService.getLocalItem(In.UserAppId);if(s){const r=parseInt(s,10);e.dispatch(new np(r))}else if(i&&i.length){const r=i.find(a=>a.app_platform.some(l=>l.type===Z0.Web));e.dispatch(new np(r?r.id:void 0))}}checkSession(e,o){e.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{const{signed_in:s,session_type:r}=i;s?(e.dispatch(new Kd(r)),"organization"===r?e.dispatch(new jh):(e.dispatch(new Gh),e.dispatch(new Zd))):e.dispatch(new Jd(r))})}getEnvironmentSettings(e,o){return e.patchState({loading:!0}),this.authService.getEnvironmentSettings().pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new Vh(i))},i=>{e.dispatch(new pA(i))})}GetEnvironmentSettingsSuccess(e,o){e.patchState({environmentSettings:o.environmentSettings})}resetPassword(e,o){e.patchState({loading:!0}),this.authService.resetPassword(o.email).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(()=>{e.dispatch(new bA(o.email))},i=>{e.dispatch(new yA(i))})}transferFacebookAccount(e,o){e.patchState({loading:!0}),this.authService.verifyIsHuman("deactivate_facebook",o.email).pipe((0,At.Z)(({isHuman:i,verification:s})=>{if(!i)throw new Do;return this.authService.deactivateFacebook({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...s?{site_verify_response:s}:null,user_email:o.email})}),(0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe({next:i=>{e.dispatch(i.conversion_complete&&i.reset_password_email_sent?new vA(o.email):new f0(new Error("Facebook deactivation failed")))},error:i=>{i instanceof Do&&e.dispatch(new Ba(i)),e.dispatch(new f0(i))}})}updatePassword(e,o){const{currentPassword:i,newPassword:s,confirmNewPassword:r}=o;this.authService.updatePassword(i,s,r).subscribe(()=>{e.dispatch(new EA)},a=>{e.dispatch(new TA(a))})}signUp(e,o){const{value:i,verification:s}=o,{email:r}=i;e.patchState({loading:!0}),(s?.isHuman?(0,Qe.of)(s):this.authService.verifyIsHuman("studio_signup",r)).pipe((0,At.Z)(({isHuman:l,verification:_})=>{if(!l)throw new Do;return this.authService.signUp({...i,..._?{site_verify_response:_}:null})}),(0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe({next:l=>{e.dispatch(new zh(l))},error:l=>{l instanceof Do&&e.dispatch(new Ba(l)),e.dispatch(new Wh(l))}})}signUpSuccess(e,o){rp&&this.vendorAnalyticsService.trackSignUp("biodigital")}signUpFailure(e,o){rp&&this.vendorAnalyticsService.track("Sign Up - Failure",{error:xs(o?.error)||"There was an error signing up.",statusCode:o.error?.status}),this.logFailure("BIODIGITAL_SIGNUP_FAILURE",o)}setUserLocale(e,{locale:o,reload:i}){this.storageService.setLocalItem(In.Locale,o.id),i?window.location.reload():(e.patchState({userLocale:o}),e.dispatch(new Hh(o)))}setUserLocaleSuccess(e,{locale:o}){K0(this.httpClient,o.id)().subscribe(()=>{})}checkLocale(e,o){const i=eb(),s=Cl.find(r=>r.id===i)||Zi;e.dispatch(new Xh(s))}sendUserMessage(e,{message:o}){this.userMessageService.sendMessage(o).subscribe(()=>{e.dispatch(new CA(o))},i=>{e.dispatch(new OA(i))})}getUserMessage(e,{type:o,mode:i}){this.userMessageService.getUserMessage(o,i).subscribe(s=>{e.dispatch(new wA(s))},()=>{e.dispatch(new MA(o))})}setUserMessageViewed(e,{messageSeenId:o}){this.userMessageService.setUserMessageViewed(o).subscribe(()=>e.dispatch(new IA),()=>e.dispatch(new AA))}resetAuth(e,o){e.setState(Cm)}requestVerificationCode(e,{email:o,token:i}){e.patchState({requestingCode:!0}),this.authService.requestVerificationCode({user_email:o,verification_jwt:i}).pipe((0,Ye.j)(()=>e.patchState({requestingCode:!1}))).subscribe(s=>{e.dispatch(new PA(s))},s=>{e.dispatch(new NA(s))})}verifyProfile(e,{email:o,token:i,code:s}){const r=s.toUpperCase();e.patchState({profileStatus:"verifying"}),this.authService.verifyProfile({user_email:o,verification_code:r,verification_jwt:i}).pipe((0,Ye.j)(()=>e.patchState({profileStatus:"ready"}))).subscribe(a=>{e.dispatch(new O0(a)),e.dispatch(new ep)},a=>{e.dispatch(new Kh(a))})}verifyProfileSuccess(e){this.vendorAnalyticsService.track("Email Verify - Success",{platform:this.productService.productType})}verifyProfileFail(e,o){this.vendorAnalyticsService.track("Email Verify - Failure",{error:xs(o?.error)||"There was an error with email verification.",statusCode:o.error?.status})}setContentView(e,{contentId:o,contentType:i}){this.contentViewService.trackContentView(o,i).subscribe(()=>{e.dispatch(new RA),e.dispatch(new Jh)})}checkContentViews(e,o){this.contentViewService.checkContentView().subscribe(i=>{e.patchState({contentViews:i}),e.dispatch(new kA(i))})}setDeveloperReferral(e,o){e.patchState({developerReferral:o.isDeveloperReferral})}logFailure(e,o){const i=o?.message||"",s=xs(o)||"";this.errorLoggingService.logError(new mP(e,i,s)).subscribe()}getUserNotices(e){this.authService.getUserNotices().subscribe({next:o=>{const i=o.notices;e.patchState({userNotices:i}),e.dispatch(new LA(i))},error:o=>e.dispatch(new UA(o))})}markUserNoticeAsSeen(e,{noticeId:o}){this.authService.markUserNoticeAsSeen(o).subscribe({next:()=>{const i=e.getState().userNotices;if(i){const s=i.findIndex(r=>r.notice_id===o);i.splice(s,1),e.patchState({userNotices:[...i]}),e.dispatch(new VA(o))}},error:i=>e.dispatch(new jA(i))})}constructor(e,o,i,s,r,a,l,_,d){this.authService=e,this.userMessageService=o,this.storageService=i,this.errorLoggingService=s,this.linkedinInsights=r,this.vendorAnalyticsService=a,this.contentViewService=l,this.productService=_,this.httpClient=d}ngxsOnInit(e){e.dispatch(new ep),e.dispatch(new Fa),e.dispatch(new tp),e.dispatch(new a0)}},ic=Gs,Gs.\u0275fac=function(e){return new(e||Gs)(t.KVO(Wa),t.KVO(om),t.KVO(Le),t.KVO(J0),t.KVO(eE),t.KVO(Qn),t.KVO(bm),t.KVO(Si),t.KVO($e.Qq))},Gs.\u0275prov=t.jDH({token:Gs,factory:Gs.\u0275fac}),Gs);Se([(0,c.rc)(a0),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne.prototype,"initializeGoogleAuth",null),Se([(0,c.rc)(_A),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne.prototype,"promptWithGoogle",null),Se([(0,c.rc)(Lh),T("design:type",Function),T("design:paramtypes",[Object,Lh]),T("design:returntype",void 0)],ne.prototype,"promptWithGoogleSuccess",null),Se([(0,c.rc)(Dh),T("design:type",Function),T("design:paramtypes",[Object,Dh]),T("design:returntype",void 0)],ne.prototype,"isLoggedIn",null),Se([(0,c.rc)(Kd),T("design:type",Function),T("design:paramtypes",[Object,Kd]),T("design:returntype",void 0)],ne.prototype,"isLoggedInSuccess",null),Se([(0,c.rc)(Jd),T("design:type",Function),T("design:paramtypes",[Object,Jd]),T("design:returntype",void 0)],ne.prototype,"isLoggedInFailure",null),Se([(0,c.rc)(r0),T("design:type",Function),T("design:paramtypes",[Object,r0]),T("design:returntype",void 0)],ne.prototype,"login",null),Se([(0,c.rc)(l0),T("design:type",Function),T("design:paramtypes",[Object,l0]),T("design:returntype",void 0)],ne.prototype,"loginWithGoogle",null),Se([(0,c.rc)(c0),T("design:type",Function),T("design:paramtypes",[Object,c0]),T("design:returntype",void 0)],ne.prototype,"loginWithGroup",null),Se([(0,c.rc)(Jl),T("design:type",Function),T("design:paramtypes",[Object,Jl]),T("design:returntype",void 0)],ne.prototype,"loginSuccess",null),Se([(0,c.rc)(Zl),T("design:type",Function),T("design:paramtypes",[Object,Zl]),T("design:returntype",void 0)],ne.prototype,"loginFailure",null),Se([(0,c.rc)(_0),T("design:type",Function),T("design:paramtypes",[Object,_0]),T("design:returntype",void 0)],ne.prototype,"logout",null),Se([(0,c.rc)(Uh),T("design:type",Function),T("design:paramtypes",[Object,Uh]),T("design:returntype",void 0)],ne.prototype,"logoutSuccess",null),Se([(0,c.rc)(g0),T("design:type",Function),T("design:paramtypes",[Object,g0]),T("design:returntype",void 0)],ne.prototype,"checkProfile",null),Se([(0,c.rc)(Bh),T("design:type",Function),T("design:paramtypes",[Object,Bh]),T("design:returntype",void 0)],ne.prototype,"checkProfileSuccess",null),Se([(0,c.rc)(jh),T("design:type",Function),T("design:paramtypes",[Object,jh]),T("design:returntype",void 0)],ne.prototype,"getGroupUserProfileAction",null),Se([(0,c.rc)(xh),T("design:type",Function),T("design:paramtypes",[Object,xh]),T("design:returntype",void 0)],ne.prototype,"getGroupUserProfileSuccess",null),Se([(0,c.rc)(Gh),T("design:type",Function),T("design:paramtypes",[Object,Gh]),T("design:returntype",void 0)],ne.prototype,"getUserProfile",null),Se([(0,c.rc)($h),T("design:type",Function),T("design:paramtypes",[Object,$h]),T("design:returntype",void 0)],ne.prototype,"getUserProfileSuccess",null),Se([(0,c.rc)(Fh),T("design:type",Function),T("design:paramtypes",[Object,Fh]),T("design:returntype",void 0)],ne.prototype,"updateUserProfile",null),Se([(0,c.rc)(p0),T("design:type",Function),T("design:paramtypes",[Object,Fh]),T("design:returntype",void 0)],ne.prototype,"updateUserProfileSuccess",null),Se([(0,c.rc)(u0),T("design:type",Function),T("design:paramtypes",[Object,u0]),T("design:returntype",void 0)],ne.prototype,"deleteUserProfile",null),Se([(0,c.rc)(Zd),T("design:type",Function),T("design:paramtypes",[Object,Zd]),T("design:returntype",void 0)],ne.prototype,"getUserRoles",null),Se([(0,c.rc)(Qh),T("design:type",Function),T("design:paramtypes",[Object,Qh]),T("design:returntype",void 0)],ne.prototype,"getUserApps",null),Se([(0,c.rc)(Yh),T("design:type",Function),T("design:paramtypes",[Object,Yh]),T("design:returntype",void 0)],ne.prototype,"setUserApps",null),Se([(0,c.rc)(np),T("design:type",Function),T("design:paramtypes",[Object,np]),T("design:returntype",void 0)],ne.prototype,"setSelectedUserApp",null),Se([(0,c.rc)(tp),T("design:type",Function),T("design:paramtypes",[Object,tp]),T("design:returntype",void 0)],ne.prototype,"checkSelectedUserApp",null),Se([(0,c.rc)(ep),T("design:type",Function),T("design:paramtypes",[Object,ep]),T("design:returntype",void 0)],ne.prototype,"checkSession",null),Se([(0,c.rc)(d0),T("design:type",Function),T("design:paramtypes",[Object,d0]),T("design:returntype",void 0)],ne.prototype,"getEnvironmentSettings",null),Se([(0,c.rc)(Vh),T("design:type",Function),T("design:paramtypes",[Object,Vh]),T("design:returntype",void 0)],ne.prototype,"GetEnvironmentSettingsSuccess",null),Se([(0,c.rc)(h0),T("design:type",Function),T("design:paramtypes",[Object,h0]),T("design:returntype",void 0)],ne.prototype,"resetPassword",null),Se([(0,c.rc)(m0),T("design:type",Function),T("design:paramtypes",[Object,m0]),T("design:returntype",void 0)],ne.prototype,"transferFacebookAccount",null),Se([(0,c.rc)(S0),T("design:type",Function),T("design:paramtypes",[Object,S0]),T("design:returntype",void 0)],ne.prototype,"updatePassword",null),Se([(0,c.rc)(b0),T("design:type",Function),T("design:paramtypes",[Object,b0]),T("design:returntype",void 0)],ne.prototype,"signUp",null),Se([(0,c.rc)(zh),T("design:type",Function),T("design:paramtypes",[Object,zh]),T("design:returntype",void 0)],ne.prototype,"signUpSuccess",null),Se([(0,c.rc)(Wh),T("design:type",Function),T("design:paramtypes",[Object,Wh]),T("design:returntype",void 0)],ne.prototype,"signUpFailure",null),Se([(0,c.rc)(Xh),T("design:type",Function),T("design:paramtypes",[Object,Xh]),T("design:returntype",void 0)],ne.prototype,"setUserLocale",null),Se([(0,c.rc)(Hh),T("design:type",Function),T("design:paramtypes",[Object,Hh]),T("design:returntype",void 0)],ne.prototype,"setUserLocaleSuccess",null),Se([(0,c.rc)(Fa),T("design:type",Function),T("design:paramtypes",[Object,Fa]),T("design:returntype",void 0)],ne.prototype,"checkLocale",null),Se([(0,c.rc)(y0),T("design:type",Function),T("design:paramtypes",[Object,y0]),T("design:returntype",void 0)],ne.prototype,"sendUserMessage",null),Se([(0,c.rc)(v0),T("design:type",Function),T("design:paramtypes",[Object,v0]),T("design:returntype",void 0)],ne.prototype,"getUserMessage",null),Se([(0,c.rc)(E0),T("design:type",Function),T("design:paramtypes",[Object,E0]),T("design:returntype",void 0)],ne.prototype,"setUserMessageViewed",null),Se([(0,c.rc)(qh),T("design:type",Function),T("design:paramtypes",[Object,qh]),T("design:returntype",void 0)],ne.prototype,"resetAuth",null),Se([(0,c.rc)(T0),T("design:type",Function),T("design:paramtypes",[Object,T0]),T("design:returntype",void 0)],ne.prototype,"requestVerificationCode",null),Se([(0,c.rc)(C0),T("design:type",Function),T("design:paramtypes",[Object,C0]),T("design:returntype",void 0)],ne.prototype,"verifyProfile",null),Se([(0,c.rc)(O0),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne.prototype,"verifyProfileSuccess",null),Se([(0,c.rc)(Kh),T("design:type",Function),T("design:paramtypes",[Object,Kh]),T("design:returntype",void 0)],ne.prototype,"verifyProfileFail",null),Se([(0,c.rc)(w0),T("design:type",Function),T("design:paramtypes",[Object,w0]),T("design:returntype",void 0)],ne.prototype,"setContentView",null),Se([(0,c.rc)(Jh),T("design:type",Function),T("design:paramtypes",[Object,Jh]),T("design:returntype",void 0)],ne.prototype,"checkContentViews",null),Se([(0,c.rc)(M0),T("design:type",Function),T("design:paramtypes",[Object,M0]),T("design:returntype",void 0)],ne.prototype,"setDeveloperReferral",null),Se([(0,c.rc)(DA),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne.prototype,"getUserNotices",null),Se([(0,c.rc)(I0),T("design:type",Function),T("design:paramtypes",[Object,I0]),T("design:returntype",void 0)],ne.prototype,"markUserNoticeAsSeen",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getLoggedIn",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Object)],ne,"getLoggedInState",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getEnvironmentSettings",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Object)],ne,"getProfile",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Zh)],ne,"getUserProfile",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",class NP{})],ne,"getGroupUserProfile",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",nm)],ne,"getUserRole",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Array)],ne,"getUserRoles",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",nm)],ne,"getSystemDefaultRole",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",String)],ne,"getUserType",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserSessionType",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Boolean)],ne,"canInviteUsers",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Array)],ne,"getUserAccountSettings",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Object)],ne,"getAuth2",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",Object)],ne,"getGooglePromptResult",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getProfileCheck",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getLoading",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getVerifyingProfile",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getProfileUpdating",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getProfileDeleting",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserLocale",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",String)],ne,"getUserLanguage",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserApps",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getSelectedUserApp",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserFullName",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserEmail",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"isPrivateUser",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"isPremiumUser",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"isAdmin",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"isDeveloperReferral",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getContentViews",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getContentViewsReached",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"hasActiveDeveloperAccount",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"getUserNotices",null),Se([(0,c.MD)(),T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],ne,"canStartFreeTrial",null),ne=ic=Se([(0,c.Uw)({name:"auth",defaults:Cm}),T("design:paramtypes",[Wa,om,Le,J0,eE,Qn,bm,Si,$e.Qq])],ne);class Ot{}var oc=function(n){return n.Enabled="enabled",n.Disabled="disabled",n.Locked="locked",n}(oc||{});class Om{constructor(){this.background={colors:null},this.uiAnnotations=!1,this.uiAudio=!0,this.uiMedia=Wi.Full,this.uiInfo=!0,this.uiFullscreen=!0,this.uiScrubber=!1,this.uiHelp=!0,this.uiBd="",this.loadRotate=null,this.initial={button:!1,handHint:!1,play:!1,summary:!1},this.disableScroll={alert:!1,overlay:!1},this.uiQuiz={mode:oc.Enabled,number:void 0},this.autoLoad=!0,this.playthrough=!1,this.uiTour=!1,this.uiNav=!0,this.uiSearch=!0,this.uiTools=!0,this.uiUndo=!0,this.uiLabelList=!0,this.uiChapterList=!1,this.all=!1,this.collapseLabel=null,this.uiMenu=!0,this.uiAnatomyDescriptions=!0,this.uiAnatomyPronunciations=!0,this.uiTutorial=!1,this.uiLegend=!0,this.uiLoader=yh,this.uiWhiteboard=!0,this.uiVisibilityLayers=!0,this.uiSkinLayers=!0,this.uiAnatomyLabels=!0}}var sc=function(n){return n.Responsive="responsive",n.Fixed="fixed",n}(sc||{});const rE={title:"Desktop",type:"desktop",dimensions:{width:700,height:550},orientation:"vertical"};function ap(n,e=300,o=2){return parseFloat((n/e).toFixed(o))}ap(300),ap(300),ap(5120),ap(2880);var DP=S(3287),b=S(177);const Mm=new t.nKC(""),_E=new t.nKC(""),dE=he.deploy===En.Production?"https://human.biodigital.com":window.location.origin,LP=he.deploy===En.Local?"https://localhost:4202":`${dE}/viewer`;let UP=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({providers:[{provide:Mm,useValue:dE},{provide:_E,useValue:LP}],imports:[c.rK.forFeature([uo]),b.MD]}),e})();var ho=S(5416),rc=function(n){return n.Single="share.widget.link",n.Bulk="share.widget.export",n}(rc||{});const pE={headers:new $e.Lr({"Content-Type":"application/json; charset=utf-8"})},Ha=new Om,Im={id:"embedded-human",dimensions:rE.dimensions,fullScreen:!0};let Qa=(()=>{var n;class e{constructor(i,s,r,a,l,_,d,p){this.http=i,this.cameraService=s,this.numberService=r,this.orgnanizationService=a,this.contentViewService=l,this.matSnackbar=_,this.APP_BASE_URL=d,this.VIEWER_BASE_URL=p}exportBookmarks(i,s,r,a,l,_,d,p,u=!1,g=""){this.matSnackbar.open(`Exporting ${i.length} models to CSV...`);const y=[{label:"Title",field:"title"},{label:"ID",field:"id"},{label:"Collection",field:"collection"},{label:"URL",field:"url"},{label:"iFrame",field:"iFrame"},{label:"Author",field:"author"},{label:"Thumbnail URL",field:"thumbnail_url"},{label:"Created Date",field:"create_date_time"},{label:"Updated Date",field:"update_date_time"}];u&&y.push({label:"Offline Package URL",field:"offline_url"});const C=p?(0,Qe.of)(null):this.getUAID(rc.Bulk),O=u?this.getDownloadURLs(i):(0,Qe.of)([]),L=new Map,$=r.length?(0,si.p)(r.map(q=>this.orgnanizationService.getCollectionContent(s,q.collection_id,"",d).pipe((0,F.T)(x=>{x.forEach(k=>{L.set(k.id,q)})})))):(0,Qe.of)(!0);return(0,si.p)([C,O,$]).pipe((0,F.T)(([q,x])=>i.map((k,A)=>{const{id:R,title:Z,author:te,thumbnail_url:se,create_date_time:ge,update_date_time:st}=k,We=L.get(k.id)?.collection_name??"",ln=this.getWidgetURL(k,a,l,null,q,d,p,g),Ie=this.getWidgetEmbed(ln,_),_r=this.buildThumbnailURL(se),zo=x[A]||"";return{title:Z,id:R,collection:We,url:ln,iFrame:Ie,author:te,thumbnail_url:_r,create_date_time:(0,b.Yq)(new Date(ge),"shortDate","en"),update_date_time:(0,b.Yq)(new Date(st),"shortDate","en"),offline_url:zo}})),(0,go.n)(q=>(0,DP.H)(q,y)),(0,go.n)(q=>{const k=`BioDigital-Widgets-${(new Date).toISOString().split("T")[0]}-export.csv`,A=new Blob([q],{type:"text/csv;charset=utf-8"});return(0,Dd.saveAs)(A,k),(0,Qe.of)(!0)}))}generateWidgetURL(i,s,r,a,l,_,d,p){const u=d||!l?(0,Qe.of)(null):this.getUAID(l);return(0,si.p)([u,this.contentViewService.trackContentPublish(i.id,i.type)]).pipe((0,F.T)(([g])=>this.getWidgetURL(i,s,r,a,g,_,d,p)))}getWidgetURL(i,s,r,a,l,_="en",d,p){r=r||Ha;const u="bookmark"===i.type,g={};g[u?"id":"m"]=`${u?i.id:i.module_name}`;const O={...g,...this.getParamsForUIOptions(r||Ha),...this.getParamsForLoadingExperience(r||Ha),...this.getParamsForScrollMode(r||Ha),...this.getParamsForLoadRotate(r||Ha),...this.getParamsForLabelScale(r||Ha)},L=(0,m.get)(r,"background.colors");if(Array.isArray(L)&&L.length>=3){const q=L.slice(0,4).map(x=>this.numberService.roundNumber(x,3));O["background.colors"]=`${q}`}if(a){const{eye:q,look:x,up:k}=this.cameraService.roundCamera(a,3);O.camera=`${[q.x,q.y,q.z,x.x,x.y,x.z,k.x,k.y,k.z]}`}d?O.dk=d.app_apikey:l&&(O.uaid=l),_&&"en"!==_&&(O.lang=_),p&&(O.paid=p);const $=this.isCustomWidget(i.embed_url_path)?i.embed_url_path:s;return this.buildWidgetURL($,O)}generateWidgetEmbed(i,s,r,a,l,_,d,p,u){return this.generateWidgetURL(i,s,r,l,_,d,p,u).pipe((0,F.T)(g=>this.getWidgetEmbed(g,a)))}getWidgetEmbed(i,s){const{width:r,height:a,type:l}=s||Im.dimensions;let _="";return _=l===sc.Responsive?`style="aspect-ratio: ${r} / ${a}; width: 100%"`:`width="${r}" height="${a}"`,`<iframe id="${Im.id}" frameBorder="0" ${_} allowFullScreen="${Im.fullScreen}" loading="lazy" src="${i}"></iframe>`}getImageEmbed(i,s,r){const a=`BioDigital Human: ${i}`.replace(/"/g,"&quot;");return`<a href="${s}" target="_blank"><img src="${r}" alt="${a}" title="${a}" /></a>`}getUAID(i){return this.http.post("/ws/user/analytics",{analytic_type:`${i}`,analytic_platform:"app"},pE).pipe((0,F.T)(r=>r.id))}getDownloadURLs(i){const s=i.filter(r=>!r.favorite&&!r.unavailable).map(r=>({type:r.type,id:"module"===r.type?r.module_name:r.id}));return this.http.post("/ws/download/reserve",{content:s},{headers:{"Content-Type":"application/json"}}).pipe((0,F.T)(r=>{const a=r.tokens;return i.map(l=>{const _=l.type,d="module"===l.type?l.module_name:l.id,p=a.find(u=>u.type===_&&u.id===d);return p&&p.token?this.buildDownloadURL(p.token):""})}),(0,pi.W)(()=>(0,Qe.of)(i.map(()=>""))))}extendWidgetOptions(i,s){const r=this.expandWidgetOptions(s);return this.deepExtendWidgetOptions(i,r),i}getWidgetConfig(i){const s={};return Object.keys(i).forEach(a=>{const l=i[a];if(null!==l){const _=this.getConfigName(a);s[_]=l}}),s}getConfigName(i){const r=this.camelToDashCase(i).replace(/^ui-/g,"");return this.dashCaseToCamelCase(r)}getParamsForLoadingExperience(i){const s={};return i.autoLoad||(s["auto-load"]=!1),i.initial.button?s["initial.button"]=!0:i.initial.handHint?s["initial.hand"]=!0:i.initial.play?s["initial.play"]=!0:i.initial.summary?s["initial.summary"]=!0:s["initial.none"]=!0,i.playthrough&&(s.playthrough=!0),s}getParamsForScrollMode(i){return i.disableScroll.alert?{"disable-scroll.alert":!0}:i.disableScroll.overlay?{"disable-scroll":!0}:{"disable-scroll":!1}}getParamsForLoadRotate(i){return"number"==typeof i.loadRotate?{"load-rotate":i.loadRotate}:{}}getParamsForLabelScale(i){return{}}getParamsForUIOptions(i){return{"ui-anatomy-descriptions":i.uiAnatomyDescriptions,"ui-anatomy-pronunciations":i.uiAnatomyPronunciations,"ui-anatomy-labels":i.uiAnatomyLabels,"ui-audio":i.uiAudio,"ui-chapter-list":i.uiChapterList,"ui-fullscreen":i.uiFullscreen,"ui-help":i.uiHelp,"ui-info":i.uiInfo,"ui-label-list":i.uiLabelList,"ui-layers":i.uiVisibilityLayers,"ui-skin-layers":i.uiSkinLayers,"ui-loader":i.uiLoader,"ui-media-controls":i.uiMedia,"ui-menu":i.uiMenu,"ui-nav":i.uiNav,"ui-search":i.uiSearch,"ui-tools":i.uiTools,"ui-tutorial":i.uiTutorial,"ui-undo":i.uiUndo,"ui-whiteboard":i.uiWhiteboard,...this.getParamsForUIQuiz(i)}}getParamsForUIQuiz(i){const s={},r=(0,m.get)(i,"uiQuiz.mode"),a=(0,m.get)(i,"uiQuiz.number");return r===oc.Disabled&&(s["ui-quiz"]=!1),r===oc.Locked&&(s["ui-quiz-locked"]=!0),(0,m.isNil)(a)||(s["ui-quiz-start"]=a,s["ui-quiz-end"]=a),s}camelToDashCase(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}dashCaseToCamelCase(i){return i.replace(/-([a-z])/g,s=>s[1].toUpperCase())}isCustomWidget(i){return/widgets\/([^\/]+)\//.test(i)}saveUserImage(i,s="jpeg"){return this.http.post("/ws/user/image/v1-0",{image_src:i,image_type:s},pE).pipe((0,F.T)(r=>r.url))}buildWidgetURL(i,s){const r=Object.entries(s).map(([l,_])=>`${l}=${_}`).join("&");let a=i.replace(/^\/|\/$/g,"");return!1===s["auto-load"]&&"viewer"===a&&(a="tiny-viewer"),he.deploy===En.Local?`${this.VIEWER_BASE_URL}/?${r}`:`${this.APP_BASE_URL}/${a}/?${r}`}buildThumbnailURL(i){return`${this.APP_BASE_URL}${i}`}buildDownloadURL(i){return`${this.APP_BASE_URL}/download?t=${i}`}deepExtendWidgetOptions(i,s){Object.entries(i).forEach(([r,a])=>{const l=typeof a;[r,this.camelToDashCase(r),this.getConfigName(r)].forEach(d=>{if(s.hasOwnProperty(d)&&null!==s[d]){const p=s[d];null===a?i[r]=p:l===typeof p&&("object"===l?this.deepExtendWidgetOptions(a,p):i[r]=p)}})})}expandWidgetOptions(i){const s={};return Object.entries(i).forEach(([r,a])=>{const l=r.split(".");if(l.length>1){const _=l[0],d=l.slice(1).join(".");(null===s[_]||"object"!=typeof s[_])&&(s[_]={}),s[_][d]=a}else s[r]=i[r]}),s}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Pi),t.KVO(Cg),t.KVO(Qo),t.KVO(bm),t.KVO(ho.UG),t.KVO(Mm),t.KVO(_E))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Am=(()=>{class e{constructor(i){this.widgetURL=i}}return e.type="[Publish] Set Widget URL",e})(),uE=(()=>{class e{constructor(i){this.dimensions=i}}return e.type="[Publish] Set Dimensions",e})(),gE=(()=>{class e{constructor(i,s,r,a){this.model=i,this.widgetOptions=s,this.camera=r,this.dimensions=a}}return e.type="[Publish] Get iFrame",e})(),Pm=(()=>{class e{constructor(i){this.embed=i}}return e.type="[Publish] Get iFrame Success",e})(),VP=(()=>{class e{constructor(){}}return e.type="[Publish] Get iFrame Fail",e})(),hE=(()=>{class e{constructor(i,s,r){this.model=i,this.widgetOptions=s,this.camera=r}}return e.type="[Publish] Get URL",e})(),Nm=(()=>{class e{constructor(i,s){this.model=i,this.url=s}}return e.type="[Publish] Get URL Success",e})(),Rm=(()=>{class e{constructor(i){this.model=i}}return e.type="[Publish] Get URL Fail",e})(),mE=(()=>{class e{constructor(i){this.publishing=i}}return e.type="[Publish] Set Publishing",e})(),fE=(()=>{class e{constructor(){}}return e.type="[Publish] Reset Publishing",e})(),SE=(()=>{class e{constructor(i,s="jpeg"){this.imageData=i,this.imageType=s}}return e.type="[Publish] Save Publish Image",e})(),km=(()=>{class e{constructor(i){this.imageURL=i}}return e.type="[Publish] Save Publish Image Success",e})(),jP=(()=>{class e{constructor(){}}return e.type="[Publish] Save Publish Image Fail",e})(),bE=(()=>{class e{constructor(i,s,r,a,l){this.model=i,this.imageData=s,this.fileType=r,this.widgetOptions=a,this.camera=l}}return e.type="[Publish] Get Publish Image Code",e})(),xP=(()=>{class e{constructor(i){this.embed=i}}return e.type="[Publish] Get Publish Image Code Success",e})(),GP=(()=>{class e{constructor(){}}return e.type="[Publish] Get Publish Image Code Fail",e})();var Gr,Ae=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},N=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const yE={joinDomains:[],loading:!1,creating:!1,updating:!1,deleting:!1,loadingJoinDomains:!1,addingJoinDomains:!1,removingJoinDomains:!1,generatingGroupCode:!1,loadingCollections:!1,addingCollection:!1,reorderingCollections:!1,removingCollection:!1,updatingCollection:!1,collectionRenaming:null};let ve=(Gr=class{static getOrganizations(e){return e.organizations}static getOrganization(e){return e.organization}static getOrganizationLogo(e){return e.organization?.group_logos?.human_app?.default?.logo_url??""}static getSelectedOrganization(e){return e.selectedOrganization}static getSelectedOrganizationProductAccountId(e){return(0,m.get)(e,"organization.product_acctid")}static getOrganizationProfile(e){return e.organizationProfile}static getOrganizationGroupAttributes(e){return(0,m.get)(e,"organization.group_attributes",[])}static getOrganizationAccountSettings(e){return function $P(n,e){return n.filter(o=>o.type===e).map(o=>{const{name:i,value:s}=o;return{[i]:{value:s}}})}(this.getOrganizationGroupAttributes(e),"account_settings")}static getDefaultUserRole(e,o){const s=this.getOrganizationGroupAttributes(e).find(r=>"default_user_role"===r.name);return(0,m.get)(s,"value",ne.getSystemDefaultRole(o))}static getOrganizationGroupCode(e){return(0,m.get)(e,"organization.group_code","")}static getCollections(e){return e.collections}static getSelectedCollection(e){return e.selectedCollection}static getReorderingCollections(e){return e.reorderingCollections}static getAddingCollection(e){return e.addingCollection}static getRemovingCollection(e){return e.removingCollection}static getUpdatingCollection(e){return e.updatingCollection}static getCollectionRenaming(e){return e.collectionRenaming}static getGeneratingGroupCode(e){return e.generatingGroupCode}static getWidgetURL(e){return e.widgetURL}static getWidgetOptions(e){return e.widgetOptions}static getAppFeatures(e){return e.appFeatures}static getCreating(e){return e.creating}static getUpdating(e){return e.updating}static getDeleting(e){return e.deleting}static getLoading(e){return e.loading}static getCollectionsLoading(e){return e.loadingCollections}static getLoadingJoinDomains(e){return e.loadingJoinDomains}static getAddingJoinDomains(e){return e.addingJoinDomains}static getRemovingJoinDomains(e){return e.removingJoinDomains}static hasOrganization(e){return!(0,m.isNil)(e.organization)}static isTrial(e){return(0,m.get)(e,"organization.subscription.free_trial",!1)}static isSubscriptionExpired(e){return!0===(0,m.get)(e,"organization.subscription.expired",!1)}static getSubscriptionEndDate(e){const o=(0,m.get)(e,"organization.subscription.paid_through_date_time");return(0,m.isNil)(o)?void 0:new Date(o)}static getExternalAccount({organization:e}){return e?.external_account}static isValidPaidSubscription(e){return this.hasOrganization(e)&&!this.isTrial(e)&&!this.isSubscriptionExpired(e)}static getJoinDomains(e){return e.joinDomains}static isZSpaceAccount(e){return this.getExternalAccount(e).external_account_provider===Li.a.Zspace}static getOrganizationAddOns(e){return e?.organization?.subscription?.addons}selectOrganization(e,o){const i=o.organization;e.patchState({selectedOrganization:i,selectedCollection:null}),i&&e.dispatch(new sm(i.id))}setOrganizations(e,o){const i=o.organizations||[],s=i[0];let r,a=null,l={...e.getState().appFeatures};if(s&&s.group_attributes){const _=s.group_attributes,d=this.organizationsService.getOrganizationAttribute(_,"widget_settings","widget_custom_url_path");d&&d.value&&(r=d.value);const p=this.organizationsService.getOrganizationAttribute(_,"widget_settings","widget_url_params");p&&p.value&&(a=this.publishService.extendWidgetOptions(new Om,p.value));const u=this.organizationsService.getOrganizationAttribute(_,"app_settings","web_app_features");u&&(l={...l,...u.value})}e.patchState({organization:s,organizations:i,widgetURL:r,widgetOptions:a,appFeatures:l}),e.dispatch(new Am(r)),s&&this.vendorAnalyticsService.updateAccountData(s)}getCollections(e,o){e.patchState({loadingCollections:!0}),this.organizationsService.getCollections({group_id:o.organizationId}).pipe((0,Ye.j)(()=>e.patchState({loadingCollections:!1}))).subscribe(i=>{e.dispatch(new rm(i))})}getCollectionsSuccess(e,o){e.patchState({collections:o.collections})}selectCollection(e,o){const{organization:i,selectedOrganization:s}=e.getState();e.patchState({selectedOrganization:s||i,selectedCollection:o.collection})}addCollection(e,o){e.patchState({addingCollection:!0}),this.organizationsService.addCollection(o.organizationId,o.collectionName).pipe((0,Ye.j)(()=>{e.patchState({addingCollection:!1})})).subscribe(()=>{e.dispatch(new am(o.organizationId,o.collectionName))},i=>{e.dispatch(new lm(i))})}addCollectionSuccess(e,o){this.vendorAnalyticsService.track("Add Collection - Success",{platform:this.productService.productType})}addCollectionError(e,o){this.vendorAnalyticsService.track("Add Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection creation."})}removeCollection(e,o){e.patchState({removingCollection:!0}),this.organizationsService.removeCollection(o.collection).pipe((0,Ye.j)(()=>{e.patchState({removingCollection:!1})})).subscribe(()=>{e.dispatch(new cm(o.collection))},i=>{e.dispatch(new _m(i))})}removeCollectionSuccess(e,o){this.vendorAnalyticsService.track("Remove Collection - Success",{platform:this.productService.productType})}removeCollectionError(e,o){this.vendorAnalyticsService.track("Remove Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection removal."})}setCollectionRenameMode(e,o){e.patchState({collectionRenaming:o.collection})}renameCollection(e,o){e.patchState({updatingCollection:!0}),this.organizationsService.renameCollection(o.collection,o.collectionName).pipe((0,Ye.j)(()=>{e.patchState({updatingCollection:!1})})).subscribe(()=>{e.dispatch(new dm(o.collection,o.collectionName))},i=>{e.dispatch(new pm(i))})}renameCollectionSuccess(e,o){this.vendorAnalyticsService.track("Rename Collection - Success",{platform:this.productService.productType})}renameCollectionError(e,o){this.vendorAnalyticsService.track("Rename Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection renaming."})}reorderCollections(e,o){e.patchState({reorderingCollections:!0}),this.organizationsService.reorderCollections(o.organizationId,o.collections).pipe((0,Ye.j)(()=>{e.patchState({reorderingCollections:!1})})).subscribe(()=>{e.dispatch(new um(o.organizationId,o.collections))},i=>{e.dispatch(new tP(i))})}reorderCollectionsSuccess(e,o){e.patchState({collections:[...o.collections]})}resetOrganizations(e,o){e.setState(yE)}createOrganization(e,{organization:o}){e.patchState({creating:!0}),this.organizationsService.createOrganization(o).pipe((0,Ye.j)(()=>e.patchState({creating:!1}))).subscribe(()=>e.dispatch(new $0),i=>e.dispatch(new hm(i)))}createOrganizationSuccess(e){this.vendorAnalyticsService.track("Team Creation - Success",{platform:this.productService.productType})}createOrganizationFail(e,o){this.vendorAnalyticsService.track("Team Creation - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with team creation."})}updateOrganization(e,{organization:o}){e.patchState({updating:!0}),this.organizationsService.updateOrganization(o).pipe((0,Ye.j)(()=>e.patchState({updating:!1}))).subscribe(()=>e.dispatch(new nP),i=>e.dispatch(new iP(i)))}deleteOrganization(e,{organization:o}){e.patchState({deleting:!0}),this.organizationsService.deleteOrganization(o.id).pipe((0,Ye.j)(()=>e.patchState({deleting:!1}))).subscribe({next:()=>e.dispatch(new oP(o)),error:i=>e.dispatch(new sP(i))})}getOrganizationProfile(e,{request:o}){e.patchState({loading:!0}),this.organizationsService.getPublicProfile(o).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>e.dispatch(new mm(i)),i=>e.dispatch(new rP(i)))}getOrganizationProfileSuccess(e,{organizationProfile:o}){e.patchState({organizationProfile:o})}clearOrganizationProfile(e,o){e.patchState({organizationProfile:void 0})}getJoinDomains(e,o){e.patchState({loadingJoinDomains:!0}),this.organizationsService.getJoinDomains(o.params).pipe((0,Ye.j)(()=>e.patchState({loadingJoinDomains:!1}))).subscribe(i=>{e.dispatch(new fm(i.email_domains))})}getJoinDomainsSuccess(e,{joinDomains:o}){e.patchState({joinDomains:o})}postJoinDomains(e,o){e.patchState({addingJoinDomains:!0}),this.organizationsService.postJoinDomains(o.emailDomains).pipe((0,Ye.j)(()=>e.patchState({addingJoinDomains:!1}))).subscribe({next:()=>{e.dispatch(new aP(o.emailDomains))},error:i=>{e.dispatch(new lP(i))}})}deleteJoinDomains(e,o){e.patchState({removingJoinDomains:!0}),this.organizationsService.deleteJoinDomains(o.joinDomainIds).pipe((0,Ye.j)(()=>e.patchState({removingJoinDomains:!1}))).subscribe({next:()=>{e.dispatch(new cP(o.joinDomainIds))},error:i=>{e.dispatch(new _P(i))}})}generateGroupCode(e,o){e.patchState({generatingGroupCode:!0}),this.organizationsService.generateGroupCode(o.groupId).pipe((0,Ye.j)(()=>e.patchState({generatingGroupCode:!1}))).subscribe({next:i=>e.dispatch(new Sm(i.group_code)),error:i=>e.dispatch(new dP(i))})}generateGroupCodeSuccess(e,o){const i={...e.getState().organization,group_code:o.groupCode};e.patchState({organization:i})}constructor(e,o,i,s){this.organizationsService=e,this.publishService=o,this.vendorAnalyticsService=i,this.productService=s}},Gr.\u0275fac=function(e){return new(e||Gr)(t.KVO(Qo),t.KVO(Qa),t.KVO(Qn),t.KVO(Si))},Gr.\u0275prov=t.jDH({token:Gr,factory:Gr.\u0275fac}),Gr);Ae([(0,c.rc)(k0),N("design:type",Function),N("design:paramtypes",[Object,k0]),N("design:returntype",void 0)],ve.prototype,"selectOrganization",null),Ae([(0,c.rc)(sp),N("design:type",Function),N("design:paramtypes",[Object,sp]),N("design:returntype",void 0)],ve.prototype,"setOrganizations",null),Ae([(0,c.rc)(sm),N("design:type",Function),N("design:paramtypes",[Object,sm]),N("design:returntype",void 0)],ve.prototype,"getCollections",null),Ae([(0,c.rc)(rm),N("design:type",Function),N("design:paramtypes",[Object,rm]),N("design:returntype",void 0)],ve.prototype,"getCollectionsSuccess",null),Ae([(0,c.rc)(D0),N("design:type",Function),N("design:paramtypes",[Object,D0]),N("design:returntype",void 0)],ve.prototype,"selectCollection",null),Ae([(0,c.rc)(L0),N("design:type",Function),N("design:paramtypes",[Object,L0]),N("design:returntype",void 0)],ve.prototype,"addCollection",null),Ae([(0,c.rc)(am),N("design:type",Function),N("design:paramtypes",[Object,am]),N("design:returntype",void 0)],ve.prototype,"addCollectionSuccess",null),Ae([(0,c.rc)(lm),N("design:type",Function),N("design:paramtypes",[Object,lm]),N("design:returntype",void 0)],ve.prototype,"addCollectionError",null),Ae([(0,c.rc)(U0),N("design:type",Function),N("design:paramtypes",[Object,U0]),N("design:returntype",void 0)],ve.prototype,"removeCollection",null),Ae([(0,c.rc)(cm),N("design:type",Function),N("design:paramtypes",[Object,cm]),N("design:returntype",void 0)],ve.prototype,"removeCollectionSuccess",null),Ae([(0,c.rc)(_m),N("design:type",Function),N("design:paramtypes",[Object,_m]),N("design:returntype",void 0)],ve.prototype,"removeCollectionError",null),Ae([(0,c.rc)(V0),N("design:type",Function),N("design:paramtypes",[Object,V0]),N("design:returntype",void 0)],ve.prototype,"setCollectionRenameMode",null),Ae([(0,c.rc)(j0),N("design:type",Function),N("design:paramtypes",[Object,j0]),N("design:returntype",void 0)],ve.prototype,"renameCollection",null),Ae([(0,c.rc)(dm),N("design:type",Function),N("design:paramtypes",[Object,dm]),N("design:returntype",void 0)],ve.prototype,"renameCollectionSuccess",null),Ae([(0,c.rc)(pm),N("design:type",Function),N("design:paramtypes",[Object,pm]),N("design:returntype",void 0)],ve.prototype,"renameCollectionError",null),Ae([(0,c.rc)(x0),N("design:type",Function),N("design:paramtypes",[Object,x0]),N("design:returntype",void 0)],ve.prototype,"reorderCollections",null),Ae([(0,c.rc)(um),N("design:type",Function),N("design:paramtypes",[Object,um]),N("design:returntype",void 0)],ve.prototype,"reorderCollectionsSuccess",null),Ae([(0,c.rc)(gm),N("design:type",Function),N("design:paramtypes",[Object,gm]),N("design:returntype",void 0)],ve.prototype,"resetOrganizations",null),Ae([(0,c.rc)(G0),N("design:type",Function),N("design:paramtypes",[Object,G0]),N("design:returntype",void 0)],ve.prototype,"createOrganization",null),Ae([(0,c.rc)($0),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],ve.prototype,"createOrganizationSuccess",null),Ae([(0,c.rc)(hm),N("design:type",Function),N("design:paramtypes",[Object,hm]),N("design:returntype",void 0)],ve.prototype,"createOrganizationFail",null),Ae([(0,c.rc)(F0),N("design:type",Function),N("design:paramtypes",[Object,F0]),N("design:returntype",void 0)],ve.prototype,"updateOrganization",null),Ae([(0,c.rc)(B0),N("design:type",Function),N("design:paramtypes",[Object,B0]),N("design:returntype",void 0)],ve.prototype,"deleteOrganization",null),Ae([(0,c.rc)(z0),N("design:type",Function),N("design:paramtypes",[Object,z0]),N("design:returntype",void 0)],ve.prototype,"getOrganizationProfile",null),Ae([(0,c.rc)(mm),N("design:type",Function),N("design:paramtypes",[Object,mm]),N("design:returntype",void 0)],ve.prototype,"getOrganizationProfileSuccess",null),Ae([(0,c.rc)(W0),N("design:type",Function),N("design:paramtypes",[Object,W0]),N("design:returntype",void 0)],ve.prototype,"clearOrganizationProfile",null),Ae([(0,c.rc)(X0),N("design:type",Function),N("design:paramtypes",[Object,X0]),N("design:returntype",void 0)],ve.prototype,"getJoinDomains",null),Ae([(0,c.rc)(fm),N("design:type",Function),N("design:paramtypes",[Object,fm]),N("design:returntype",void 0)],ve.prototype,"getJoinDomainsSuccess",null),Ae([(0,c.rc)(H0),N("design:type",Function),N("design:paramtypes",[Object,H0]),N("design:returntype",void 0)],ve.prototype,"postJoinDomains",null),Ae([(0,c.rc)(Q0),N("design:type",Function),N("design:paramtypes",[Object,Q0]),N("design:returntype",void 0)],ve.prototype,"deleteJoinDomains",null),Ae([(0,c.rc)(Y0),N("design:type",Function),N("design:paramtypes",[Object,Y0]),N("design:returntype",void 0)],ve.prototype,"generateGroupCode",null),Ae([(0,c.rc)(Sm),N("design:type",Function),N("design:paramtypes",[Object,Sm]),N("design:returntype",void 0)],ve.prototype,"generateGroupCodeSuccess",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getOrganizations",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getOrganization",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",String)],ve,"getOrganizationLogo",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getSelectedOrganization",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",String)],ve,"getSelectedOrganizationProductAccountId",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getOrganizationProfile",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getOrganizationGroupAttributes",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",Array)],ve,"getOrganizationAccountSettings",null),Ae([(0,c.MD)([ne]),N("design:type",Function),N("design:paramtypes",[Ot,Object]),N("design:returntype",void 0)],ve,"getDefaultUserRole",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getOrganizationGroupCode",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getCollections",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getSelectedCollection",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getReorderingCollections",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getAddingCollection",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getRemovingCollection",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getUpdatingCollection",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getCollectionRenaming",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getGeneratingGroupCode",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getWidgetURL",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getWidgetOptions",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getAppFeatures",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getCreating",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getUpdating",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getDeleting",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getLoading",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getCollectionsLoading",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getLoadingJoinDomains",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getAddingJoinDomains",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getRemovingJoinDomains",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"hasOrganization",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"isTrial",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"isSubscriptionExpired",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getSubscriptionEndDate",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",Object)],ve,"getExternalAccount",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"isValidPaidSubscription",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"getJoinDomains",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",void 0)],ve,"isZSpaceAccount",null),Ae([(0,c.MD)(),N("design:type",Function),N("design:paramtypes",[Ot]),N("design:returntype",Object)],ve,"getOrganizationAddOns",null),ve=Ae([(0,c.Uw)({name:"organizations",defaults:yE}),N("design:paramtypes",[Qo,Qa,Qn,Si])],ve);const ac={title:"Tags",tags:["Animated","Tour","Quiz","featured","new",Li.a.Zspace]},Dm={title:"Gender",tags:["male","female"]},Lm={title:"Pregnancy",tags:["First Trimester","Second Trimester","Third Trimester"]},lc={title:"Regions",tags:["Head and Neck","Thorax","Abdomen","Back","Upper Limb","Pelvis","Lower Limb"]},Um={title:"Type (Deprecated)",tags:["Anatomy","Disease","Pharmacology","Physiology","Procedure"]},dn={title:"Type",tags:["Healthy Anatomy and Physiology","Conditions","Procedures and Treatments"]},lp={title:"Level of Detail",tags:["Gross Anatomy","Tissue","Cellular","Molecular"]},OE={title:"Downloaded",tags:["Downloaded"]},wE={title:"Permissions",tags:["My Models","View & Edit","View Only"]},FP=[{title:"Status",tags:["Live","obsolete"]},{title:"Platform",tags:["web platform","ios platform","android platform"]},ac,Dm,dn,Um,lp,{title:"Anatomy Categories",tags:["complete anatomy","system","regional","Bony Landmarks","Cross Section","Cross Section and Micro Anatomy","Guided Anatomy","Micro Anatomy","Origins and Insertions"]},{title:"Clinical Specialty",tags:["Allergy and Immunology","Cardiology","Dentistry","Dermatology","Endocrinology","Gastroenterology and Hepatology","Gynecology","Hematology","Infectious Disease","Nephrology","Neurology and Psychiatry","Obstetrics","Oncology","Ophthalmology","Orthopedics","Otolaryngology","Pediatrics","Physical Therapy","Primary Care","Pulmonology and Respiratory","Rheumatology","Urology"]},OE,wE,lc,Lm],BP=[{title:"zSpace Models",id:Li.a.Zspace,type:"Category",image:"zspace"}],cp={main:[{title:"All Models",id:"all",type:"Category",image:"all-models",tabTags:dn,translations:{es:{title:"Todas las Categor\xedas"},zh:{title:"\u6240\u6709\u7c7b\u522b"},fr:{title:"Toutes les cat\xe9gories"},de:{title:"Alle Kategorien"},it:{title:"Tutte le categorie"},ja:{title:"\u3059\u3079\u3066\u306e\u30ab\u30c6\u30b4\u30ea"},pt:{title:"Todas as categorias"}}}],categories:[{title:"Anatomy by Regions",id:"regional",type:"Category",image:"anatomy-by-regions",tabTags:lc,translations:{es:{title:"Anatom\xeda regional"},zh:{title:"\u5c40\u90e8\u89e3\u5256"},fr:{title:"Anatomie r\xe9gionale"},de:{title:"Regionale Anatomie"},it:{title:"Anatomia regionale"},ja:{title:"\u5404\u90e8\u4f4d\u306e\u69cb\u9020"},pt:{title:"Anatomia Regional"}}},{title:"Anatomy by Systems",id:"system",type:"Category",image:"anatomy-by-systems",tabTags:Dm,translations:{es:{title:"Anatom\xeda sistem\xe1tica"},zh:{title:"\u7cfb\u7edf\u89e3\u5256"},fr:{title:"Anatomie du syst\xe8me"},de:{title:"Systematische Anatomie"},it:{title:"Anatomia sistemica"},ja:{title:"\u5404\u5668\u5b98\u7cfb\u306e\u69cb\u9020"},pt:{title:"Anatomia do Sistema"}}},{title:"Complete Anatomy",id:"complete anatomy",type:"Category",image:"complete-anatomy",translations:{de:{title:"Vollst\xe4ndige Anatomie"},es:{title:"Anatom\xeda completa"},fr:{title:"Anatomie compl\xe8te"},it:{title:"Anatomia completa"},ja:{title:"\u4eba\u4f53\u306e\u5168\u4f53\u69cb\u9020"},pt:{title:"Anatomia Completa"},zh:{title:"\u5b8c\u6574\u89e3\u5256"}}},{title:"Bony Landmarks",id:"Bony Landmarks",type:"Category",image:"bony-landmarks",translations:{de:{title:"Kn\xf6cherne Orientierungspunkte"},es:{title:"Puntos de referencia \xf3seos"},fr:{title:"Rep\xe8res osseux"},it:{title:"Punti di repere ossei"},ja:{title:"\u9aa8\u306e\u30e9\u30f3\u30c9\u30de\u30fc\u30af"},pt:{title:"Marcos \xd3sseos"},zh:{title:"\u9aa8\u6027\u6807\u5fd7"}}},{title:"Cross Sections & Micro Anatomy",id:"Cross Section and Micro Anatomy",type:"Category",image:"cross-sections-and-micro-anatomy",translations:{de:{title:"Querschnitte und mikroskopische Anatomie"},es:{title:"Cortes transversales y microanatom\xeda"},fr:{title:"Coupes transversales et micro anatomie"},it:{title:"Sezioni trasversali & anatomia microscopica"},ja:{title:"\u65ad\u9762\u56f3\u30fb\u30de\u30a4\u30af\u30ed\u89e3\u5256\u5b66"},pt:{title:"Sec\xe7\xf5es Transversais e Microanatomia"},zh:{title:"\u6a2a\u65ad\u9762&\u663e\u5fae\u89e3\u5256"}}},{title:"Origins & Insertions",id:"Origins and Insertions",type:"Category",image:"origins-and-insertions",translations:{de:{title:"Urspr\xfcnge und Ans\xe4tze"},es:{title:"Or\xedgenes e inserciones"},fr:{title:"Origines et insertions"},it:{title:"Origini & inserzioni"},ja:{title:"\u8d77\u59cb\u30fb\u505c\u6b62"},pt:{title:"Origens e Inser\xe7\xf5es"},zh:{title:"\u8d77\u6e90\u4e0e\u63d2\u5165"}}},{title:"Anatomy Quizzes",id:"quiz",type:"Category",image:"quizzes-and-assessments",tabTags:lc,translations:{de:{title:"Anatomie Quizfragen"},es:{title:"Pruebas de anatom\xeda"},fr:{title:"Quizz d'anatomie"},it:{title:"Domande di anatomia"},ja:{title:"\u89e3\u5256\u5b66\u30af\u30a4\u30ba"},pt:{title:"Question\xe1rios de Anatomia"},zh:{title:"\u89e3\u5256\u5b66\u6d4b\u9a8c"}}}],specialties:[{title:"Allergy & Immunology",id:"Allergy and Immunology",type:"Category",image:"allergy-and-immunology",tabTags:dn,translations:{de:{title:"Allergie und Immunologie"},es:{title:"Alergia e inmunolog\xeda"},fr:{title:"Allergie et immunologie"},it:{title:"Allergologia & immunologia"},ja:{title:"\u30a2\u30ec\u30eb\u30ae\u30fc\u3068\u514d\u75ab\u5b66"},pt:{title:"Alergia e Imunologia"},zh:{title:"\u8fc7\u654f\u4e0e\u514d\u75ab\u5b66"}}},{title:"Cardiology",id:"Cardiology",type:"Category",image:"cardiology",tabTags:dn,translations:{de:{title:"Kardiologie"},es:{title:"Cardiolog\xeda"},fr:{title:"Cardiologie"},it:{title:"Cardiologia"},ja:{title:"\u5fc3\u81d3\u75c5\u5b66"},pt:{title:"Cardiologia"},zh:{title:"\u5fc3\u810f\u79d1"}}},{title:"Dentistry",id:"Dentistry",type:"Category",image:"dentistry",tabTags:dn,translations:{de:{title:"Zahnmedizin"},es:{title:"Odontolog\xeda"},fr:{title:"Dentisterie"},it:{title:"Odontoiatria"},ja:{title:"\u6b6f\u5b66"},pt:{title:"Odontologia"},zh:{title:"\u7259\u79d1"}}},{title:"Dermatology",id:"Dermatology",type:"Category",image:"dermatology",tabTags:dn,translations:{de:{title:"Dermatologie"},es:{title:"Dermatolog\xeda"},fr:{title:"Dermatologie"},it:{title:"Dermatologia"},ja:{title:"\u76ae\u819a\u5b66"},pt:{title:"Dermatologia"},zh:{title:"\u76ae\u80a4\u79d1"}}},{title:"Endocrinology",id:"Endocrinology",type:"Category",image:"endocrinology",tabTags:dn,translations:{de:{title:"Endokrinologie"},es:{title:"Endocrinolog\xeda"},fr:{title:"Endocrinologie"},it:{title:"Endocrinologia"},ja:{title:"\u5185\u5206\u6ccc\u5b66"},pt:{title:"Endocrinologia"},zh:{title:"\u5185\u5206\u6ccc\u79d1"}}},{title:"Gastroenterology",id:"Gastroenterology and Hepatology",type:"Category",image:"gastroenterology",tabTags:dn,translations:{de:{title:"Gastroenterologie"},es:{title:"Gastroenterolog\xeda"},fr:{title:"Gastroent\xe9rologie"},it:{title:"Gastroenterologia"},ja:{title:"\u80c3\u8178\u5b66"},pt:{title:"Gastroenterologia"},zh:{title:"\u80c3\u80a0\u75c5\u5b66"}}},{title:"Gynecology",id:"Gynecology",type:"Category",image:"gynecology",tabTags:dn,translations:{de:{title:"Gyn\xe4kologie"},es:{title:"Ginecolog\xeda"},fr:{title:"Gyn\xe9cologie"},it:{title:"Ginecologia"},ja:{title:"\u5a66\u4eba\u79d1\u5b66"},pt:{title:"Ginecologia"},zh:{title:"\u5987\u79d1"}}},{title:"Hematology",id:"Hematology",type:"Category",image:"hematology",tabTags:dn,translations:{de:{title:"H\xe4matologie"},es:{title:"Hematolog\xeda"},fr:{title:"H\xe9matologie"},it:{title:"Ematologia"},ja:{title:"\u8840\u6db2\u5b66"},pt:{title:"Hematologia"},zh:{title:"\u8840\u6db2\u79d1"}}},{title:"Infectious Disease",id:"Infectious Disease",type:"Category",image:"infectious-disease",tabTags:dn,translations:{de:{title:"Infektionskrankheit"},es:{title:"Enfermedades infecciosas"},fr:{title:"Maladies infectieuses"},it:{title:"Malattie infettive"},ja:{title:"\u611f\u67d3\u75c7"},pt:{title:"Doen\xe7a Infecciosa"},zh:{title:"\u4f20\u67d3\u75c5"}}},{title:"Nephrology",id:"Nephrology",type:"Category",image:"nephrology",tabTags:dn,translations:{de:{title:"Nephrologie"},es:{title:"Nefrolog\xeda"},fr:{title:"N\xe9phrologie"},it:{title:"Nefrologia"},ja:{title:"\u814e\u81d3\u5b66"},pt:{title:"Nefrologia"},zh:{title:"\u80be\u79d1"}}},{title:"Neurology & Psychiatry",id:"Neurology and Psychiatry",type:"Category",image:"neurology-and-psychiatry",tabTags:dn,translations:{de:{title:"Neurologie und Psychiatrie"},es:{title:"Neurolog\xeda y psiquiatr\xeda"},fr:{title:"Neurologie et psychiatrie"},it:{title:"Neurologia & psichiatria"},ja:{title:"\u795e\u7d4c\u5b66\u30fb\u7cbe\u795e\u533b\u5b66"},pt:{title:"Neurologia e Psiquiatria"},zh:{title:"\u795e\u7ecf\u79d1&\u7cbe\u795e\u79d1"}}},{title:"Obstetrics",id:"Obstetrics",type:"Category",image:"obstetrics",tabTags:Lm,translations:{de:{title:"Geburtshilfe"},es:{title:"Obstetricia "},fr:{title:"Obst\xe9trique"},it:{title:"Ostetricia"},ja:{title:"\u7523\u79d1\u5b66"},pt:{title:"Obstetr\xedcia"},zh:{title:"\u4ea7\u79d1"}}},{title:"Oncology",id:"Oncology",type:"Category",image:"oncology",tabTags:dn,translations:{de:{title:"Onkologie"},es:{title:"Oncolog\xeda"},fr:{title:"Oncologie"},it:{title:"Oncologia"},ja:{title:"\u816b\u760d\u5b66"},pt:{title:"Oncologia"},zh:{title:"\u80bf\u7624\u79d1"}}},{title:"Ophthalmology",id:"Ophthalmology",type:"Category",image:"ophtalmology",tabTags:dn,translations:{de:{title:"Ophthalmologie"},es:{title:"Oftalmolog\xeda"},fr:{title:"Ophtalmologie"},it:{title:"Oftalmologia"},ja:{title:"\u773c\u79d1\u5b66"},pt:{title:"Oftalmologia"},zh:{title:"\u773c\u79d1"}}},{title:"Orthopedics",id:"Orthopedics",type:"Category",image:"orthopedics",tabTags:dn,translations:{de:{title:"Orthop\xe4die"},es:{title:"Ortopedia"},fr:{title:"Orthop\xe9die"},it:{title:"Ortopedia"},ja:{title:"\u6574\u5f62\u5916\u79d1\u5b66"},pt:{title:"Ortopedia"},zh:{title:"\u9aa8\u79d1"}}},{title:"Otolaryngology",id:"Otolaryngology",type:"Category",image:"otolarygngology",tabTags:dn,translations:{de:{title:"Otolaryngologie"},es:{title:"Otorrinolaringolog\xeda"},fr:{title:"Otorhinolaryngologie"},it:{title:"Otorinolaringoiatria"},ja:{title:"\u8033\u9f3b\u79d1\u5b66"},pt:{title:"Otorrinolaringologia"},zh:{title:"\u8033\u9f3b\u5589\u79d1"}}},{title:"Pediatrics",id:"Pediatrics",type:"Category",image:"pediatrics",tabTags:dn,translations:{de:{title:"P\xe4diatrie"},es:{title:"Pediatr\xeda"},fr:{title:"P\xe9diatrie"},it:{title:"Pediatria"},ja:{title:"\u5c0f\u5150\u79d1\u5b66"},pt:{title:"Pediatria"},zh:{title:"\u513f\u79d1"}}},{title:"Physical Therapy",id:"Physical Therapy",type:"Category",image:"physical-therapy",tabTags:dn,translations:{de:{title:"Physiotherapie"},es:{title:"Fisioterapia"},fr:{title:"Kin\xe9sith\xe9rapie"},it:{title:"Fisioterapia"},ja:{title:"\u7406\u5b66\u7642\u6cd5"},pt:{title:"Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597"}}},{title:"Primary Care",id:"Primary Care",type:"Category",image:"primary-care",tabTags:dn,translations:{de:{title:"Prim\xe4rversorgung"},es:{title:"Atenci\xf3n primaria"},fr:{title:"Soins de sant\xe9 primaires"},it:{title:"Assistenza sanitaria di base"},ja:{title:"\u30d7\u30e9\u30a4\u30de\u30ea\u30fc\u30b1\u30a2"},pt:{title:"Aten\xe7\xe3o Prim\xe1ria"},zh:{title:"\u521d\u7ea7\u536b\u751f\u4fdd\u5065"}}},{title:"Pulmonology",id:"Pulmonology and Respiratory",type:"Category",image:"pulmonology",tabTags:dn,translations:{de:{title:"Pulmonologie"},es:{title:"Neumolog\xeda"},fr:{title:"Pneumologie"},it:{title:"Pneumologia"},ja:{title:"\u547c\u5438\u5668\u5b66"},pt:{title:"Pneumologia"},zh:{title:"\u80ba\u75c5\u79d1"}}},{title:"Rheumatology",id:"Rheumatology",type:"Category",image:"rheumatology",tabTags:dn,translations:{de:{title:"Rheumatologie"},es:{title:"Reumatolog\xeda"},fr:{title:"Rhumatologie"},it:{title:"Reumatologia"},ja:{title:"\u30ea\u30a6\u30de\u30c1\u5b66"},pt:{title:"Reumatologia"},zh:{title:"\u98ce\u6e7f\u79d1"}}},{title:"Urology",id:"Urology",type:"Category",image:"urology",tabTags:dn,translations:{de:{title:"Urologie"},es:{title:"Urolog\xeda"},fr:{title:"Urologie"},it:{title:"Urologia"},ja:{title:"\u6ccc\u5c3f\u5668\u79d1\u5b66"},pt:{title:"Urologia"},zh:{title:"\u6ccc\u5c3f\u5916\u79d1"}}}],community:[{title:"Community Bookmarks",id:"public",type:"Community",image:"community-bookmarks",translations:{de:{title:"Community-Lesezeichen"},es:{title:"Destacados por la comunidad"},fr:{title:"Signets communautaires"},it:{title:"Segnalibri della community"},ja:{title:"\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306e\u30d6\u30c3\u30af\u30de\u30fc\u30af"},pt:{title:"Favoritos da comunidade"},zh:{title:"\u793e\u533a\u4e66\u7b7e"}}}]};function Vm(n){return[...rs(cp.main,n),...rs(cp.categories,n),...rs(BP,n),...rs(cp.specialties,n),...rs(cp.community,n)]}function rs(n,e){return n.map(o=>{const i={id:o.id,title:o.title,type:o.type,image:o.image,tabTags:o.tabTags};return e&&(i.title=(0,m.get)(o,`translations.${e}.title`,i.title)),i})}const Ya=1e4,jm="/ws/user/bookmark/v4",cc={headers:new $e.Lr({"Content-Type":"application/json; charset=utf-8"})};let _c=(()=>{var n;class e{constructor(i,s,r,a,l,_){this.store=i,this.http=s,this.serializeModuleService=r,this.storyService=a,this.productService=l,this.storageService=_}getBookmarkData(i){return this.http.get(`/search/bookmarks/data?be=${i}`).pipe((0,qd.l)(s=>s.pipe((0,Ga.c)(1e3),(0,Vt.s)(3))),(0,F.T)(s=>((s=s.bookmark).moduleId=s.customData?s.customData.moduleId:s.modules.activeModules[0],(0,je.bj)(lA,s))))}getBookmarkModel(i){return this.http.get(`/ws/search/bookmarks?eid=${i}`).pipe((0,qd.l)(s=>s.pipe((0,Ga.c)(1e3),(0,Vt.s)(3))),(0,F.T)(s=>(0,je.bj)(gr,s.bookmark_info)),(0,F.T)(s=>ga(s)))}getUserBookmarks(i,s="",r=Ya,a,l){const _={q:s,page_size:`${r}`,ol:a};return(0,m.isNil)(l)||(_.is_owner=""+(l?1:0)),this.http.get(`/ws/search/bookmarks/${i}`,{params:_}).pipe((0,qd.l)(d=>d.pipe((0,Ga.c)(1e3),(0,Vt.s)(3))),(0,F.T)(d=>d.map(p=>(0,je.bj)(gr,p)).map(p=>ga(p))))}getUserConditions(i,s="",r,a,l=Ya){let _="";switch(i){case js.Private:_="user";break;case js.Group:_="group"}return this.http.get(`/ws/search/conditions/private?q=${s}&page_size=${l}&ol=${r}`).pipe((0,F.T)(d=>d.filter(p=>p.module_accessor_level===_&&(!a||p.module_accessor_id===a))),(0,F.T)(d=>(0,je.bj)(gr,d)),(0,F.T)(d=>d.map(p=>ga(p))))}getPrivateBookmarks(i="",s,r=Ya){return this.getUserBookmarks(js.Private,i,r,s,!0)}getPrivateConditions(i="",s){return this.getUserConditions(js.Private,i,s)}getOrganizationBookmarks(i,s="",r=Ya,a){return this.getUserBookmarks(js.Private,s,r,a).pipe((0,F.T)(l=>l.filter(_=>_.tags.includes("enterprise")).filter(_=>_.group_access.some(d=>d.group_id===i))))}getOrganizationConditions(i,s="",r){return this.getUserConditions(js.Group,s,r,i)}getOrganizationContent(i,s="",r){return(0,si.p)([this.getOrganizationBookmarks(i,s,Ya,r),this.getOrganizationConditions(i,s,r)]).pipe((0,F.T)(([a,l])=>[...a,...l]))}getPrivateContent(i="",s){return(0,si.p)([this.getPrivateBookmarks(i,s),this.getPrivateConditions(i,s)]).pipe((0,F.T)(([r,a])=>[...r,...a]))}createBookmarkStory(i,s){return this.serializeModuleService.serialize({},new hv,!1,{...this.store.selectSnapshot(Pe.getStory),displayName:i},this.store.selectSnapshot(E.getStoryChapters),s)}getPublicBookmarks(i="",s){return this.getUserBookmarks(js.Public,i,Ya,s)}saveBookmark(i){const s=this.getNormalizedBookmarkEntry(i);let r;return r=this.http.post(i.id?`${jm}/update`:`${jm}/save`,s,cc),r.pipe((0,zl.q)(a=>this.getBookmarkModel(a.id)))}bulkCopyBookmarks(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/bookmark/bulk/copy",{version:1,app_producttype:s,app_productkey:r,source_content:i},cc)}getBookmarkJobs(i={}){const{productType:s,productKey:r}=this.productService;return this.http.get("/ws/user/jobs",{params:{version:1,app_producttype:s,app_productkey:r,...i}}).pipe((0,F.T)(a=>a?.jobs??[]))}cancelBookmarkJob(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/jobs/cancel",{version:1,app_producttype:s,app_productkey:r,job_id:i},cc)}deleteBookmark(i){return this.http.delete(`${jm}/delete`,{params:{eid:i,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}).pipe((0,pi.W)(a=>{const l=xs(a);return(0,_h.$)(()=>l)}))}bulkDeleteBookmarks(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/bookmark/bulk/delete",{version:1,app_producttype:s,app_productkey:r,eids:i},cc)}atMaxFreeBookmarkCount(){return this.http.get("/ws/user/content/limit/check?version=2").pipe((0,pi.W)(i=>(0,Qe.of)({limit_reached:!1})))}filterByTags(i,s,r=!1){return i.filter(a=>r?s.every(l=>a.tags.includes(l)):s.some(l=>a.tags.includes(l)))}getTags(i){if(i){const s=[],a=function vP(n,e){const o=io(n,qt.EditBookmarks);return!!o&&(e.type===yt.Module?o:!(!0!==e.is_owner)||!!Xa(e)&&function tE(n,e){if(io(n,qt.EditAllTeamBookmarks))return!0;const i=io(n,qt.EditTeamBookmarks),s=Xa(e)&&e.group_access[0].member_edit;return i&&s}(n,e))}(this.store.selectSnapshot(ne.getUserRole),i),l=i.type===yt.Bookmark&&!a;return this.isZSpaceModel(i)&&s.push(oE.n3[Li.a.Zspace]),l&&s.push("View Only"),i.animated&&s.push("Animated"),i.tour&&s.push("Tour"),i.quiz&&s.push("Quiz"),s}return[]}getCategories(i,s="en"){const r=Vm(s),a=[];return i.type===yt.Module?(i.tags.forEach(l=>{const _=r.find(d=>d.id===l);_&&a.push(_)}),a):null}isZSpaceModel(i){return!!(0,m.isArray)(i.tags)&&i.tags.includes(Li.a.Zspace)}getZSpaceRestriction(){return he.application===bt.Loft?Li.O.None:!this.store.selectSnapshot(ve.hasOrganization)||this.store.selectSnapshot(ve.isSubscriptionExpired)?Li.O.Subscription:"true"!==this.storageService.getLocalItem(In.ZSpaceDevice)?Li.O.Device:Li.O.None}getShowcase(i,s,r="en"){const a=[];if(!(0,m.isNil)(i)&&i.type===Em.P.User){const l=this.getUserShowcase(r);a.push(l)}if(!(0,m.isNil)(s)){const l=this.getOrganizationShowcase(s,r);a.push(l)}return a.length?(0,si.p)(a):(0,Qe.of)([])}getUserShowcase(i="en"){return this.getPrivateBookmarks("",i,10).pipe((0,F.T)(s=>this.createPrivateShowcase(s)))}getOrganizationShowcase(i,s="en"){return this.getOrganizationBookmarks(i.id,"",10,s).pipe((0,F.T)(r=>this.createOrganizationShowcase(r,i)))}createMockBookmark(i){return{author:"",author_first_name:"",author_last_name:"",cost:0,create_date_time:new Date,description:"",id:"",is_owner:!0,last_editor:"",last_editor_first_name:"",last_editor_last_name:"",tags:[],thumbnail_url:"",title:"",update_date_time:new Date,type:yt.Bookmark,...i?{animated:!0,tour:!0}:{}}}createMockBookmarks(i=5){return[...Array(i).keys()].map(s=>this.createMockBookmark(s%2==0))}createPrivateShowcase(i){return{title:"Pick up where you left off",description:"",url:"/results/bookmarks?type=Private",bookmarks:i}}createOrganizationShowcase(i,s){return{title:`Recently added to ${s.name}`,description:"Recently added models to your Team library.",url:`/results/bookmarks?organizationId=${s.id}&type=Organization`,bookmarks:i}}translateBookmark(i,s,r,a){const l=r===yt.Module||r===yt.Internal?s.replace(".json",""):s;return(0,si.p)([this.storyService.getStory(i,yt.Bookmark),this.storyService.getStoryTranslation(l,r,a)]).pipe((0,F.T)(([_,d])=>this.storyService.translateStory(_,d)),(0,zl.q)(_=>this.saveBookmark({isOwner:!0,title:_.displayName.substr(0,60),id:i,index:_})),(0,F.T)(_=>_.id),(0,pi.W)(_=>404===_.status?(0,Qe.of)(i):(0,_h.$)(_)))}getNormalizedBookmarkEntry(i){let s,r,a,l;if(i.isOwner){if(s=i.add_group_access?this.getGroupAccess(i.add_group_access):[],i.remove_group_access&&i.remove_group_access.forEach(_=>{const d=this.getNormalizeGroupAccess({group_id:_.group_id,remove:!0});s.push(d)}),r=this.getNormalizedBool(i.public_access),i.index){a={},i.index.chapters&&(a[$a.UserGeneratedTour]=this.getNormalizedBool(i.index.chapters.length>1));const _=(i.index.tags||[]).includes("animated");a[$a.Animated]=this.getNormalizedBool(_),a[$a.ModeQuiz]=this.getNormalizedBool(i.viewMode===ji.Quiz),a[$a.ModeContent]=this.getNormalizedBool(i.viewMode===ji.Content),a[$a.Quiz]=this.getNormalizedBool(i.index?.quizSettings?.enabled??!1)}l=this.getNormalizedBool(i.is_content_copy)}return{eid:i.id,name:i.title,description:i.description,index:i.index,group_access:s,public_access:r,flags:a,is_content_copy:l,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}getGroupAccess(i){return i.map(s=>this.getNormalizeGroupAccess(s))}getNormalizeGroupAccess(i){const{group_id:s,group_name:r,member_edit:a,visible:l,remove:_}=i;return{group_id:s,group_name:r,member_edit:this.getNormalizedBool(a),visibility:this.getNormalizedBool(l),remove:this.getNormalizedBool(_)}}getNormalizedBool(i){return!0===i?"1":!1===i?"0":""}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO($e.Qq),t.KVO(mh),t.KVO(kr),t.KVO(Si),t.KVO(Le))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const ME={label:"Relevance",fields:[],ascending:!0},_p={label:"Most Recent",fields:["collection_content_createdate","update_date_time","create_date_time"],ascending:!1},dc={label:"Title (A-Z)",fields:["title"],ascending:!0},dp={label:"Title (Z-A)",fields:["title"],ascending:!1},IE={label:"Author (A-Z)",fields:["author"],ascending:!0},AE={label:"Author (Z-A)",fields:["author"],ascending:!1};var Cn=function(n){return n.Organization="Organization",n.Collection="Collection",n.Private="Private",n.Category="Category",n.Community="Community",n.Internal="Internal",n.Loft="Loft",n}(Cn||{});const zP=`/results/modules?categoryId=${Li.a.Zspace}&type=Category`;class WP{constructor(e,o=[],i=""){this.categoryId=e,this.tags=o,this.query=i,this.type=Cn.Category}}class XP{constructor(e="",o=[]){this.query=e,this.tags=o,this.categoryId="public",this.type=Cn.Community}}const HP=["live"];let pp=(()=>{var n;class e{constructor(i){this.http=i}searchInternal(i="",s=""){return this.http.get(`/ws/search/internal?k=${i}&dir=${s}`).pipe((0,F.T)(r=>this.resultsToBookmarks(r)))}getAnatomyCategory(i,s,r=[],a=!1,l="en"){return this.search(i,[s,...r],a,l)}getConditionModel(i){if(he.offline)return(0,Qe.of)(null);const s=this.toDatabaseContentId(i);return this.http.get(`/search/conditions?q=${s}`).pipe((0,qd.l)(r=>r.pipe((0,Ga.c)(1e3),(0,Vt.s)(3))),(0,F.T)(r=>this.resultsToBookmarks(r)),(0,F.T)(r=>r[0]))}getShowcase(i){return this.http.get(`/ws/product/app/settings/homepage-showcase?ol=${i}`).pipe((0,F.T)(s=>(s.forEach(r=>(r.bookmarks=this.resultsToBookmarks(r.bookmarks),r)),s)))}getZSpaceShowcase(){return this.getAnatomyCategory("",Li.a.Zspace,[],!0).pipe((0,F.T)(i=>({title:"zSpace Models",description:" ",url:zP,bookmarks:i})))}createMockShowcase(i){return{title:" ",description:" ",url:"",bookmarks:[...i],loading:!0}}createMockShowcases(i,s){return[...Array(i).keys()].map(()=>this.createMockShowcase(s))}search(i="",s,r,a){const l=i.split(/[ ]+/).join("+"),_=HP.concat(s).filter(d=>""!==d&&null!=d).map(d=>`"${d}"`).join("+");return this.http.get(`/search/ai?k=${l}&t=${_}&zspace=${r}&il=${a}&ol=${a}&odns=true`).pipe((0,F.T)(d=>this.resultsToBookmarks(d)))}resultsToBookmarks(i){return i.forEach(s=>{s=ga(s)}),(0,je.bj)(gr,i)}getStoryCategory(i){if(!i.tags)return null;const s=Vm().map(r=>r.id.toLocaleLowerCase());return i.tags.find(r=>s.includes(r.toLocaleLowerCase()))}toAppContentId(i){return i.replace("Condition.content.","").replace(".json","").split(".").join("/")}toDatabaseContentId(i){return i.match("Condition.content")?i:`Condition.content.${i.replace(".json","").split("/").join(".")}.json`}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function PE(n,e,o){const i=e.map(s=>n[s]).filter(s=>!(0,m.isNil)(s));return o?i.sort().shift():i.sort().pop()}function xm(n,e,o){if(0===e.length)return n;const i=new Intl.Collator("en-US",{sensitivity:"base"});return n.sort((s,r)=>{const a=PE(s,e,o)||"",l=PE(r,e,o)||"";return(o?1:-1)*i.compare(a.toString(),l.toString())})}class QP{}let up=(()=>{var n;class e{constructor(i){this.http=i}generateFreshChapterImages(i,s,r=!1){const a=[];return i.forEach(l=>{const _=Ns.getChapterThumbnail(l,s);(_.legacy||r)&&a.push(Ns.makeFreshThumbnail(_.storyId,_.chapterId,_.urls.large))}),a.length?(0,si.p)(a):(0,Qe.of)([])}saveChapterThumbnails(i,s,r){return i.reduce((l,_)=>{const u=s.get(r[_.id]),g=(0,m.get)(u,"snapshot");return g&&l.push(this.saveNewChapterImage(_.id,g)),l},[])}saveNewChapterImage(i,s){return new f.c(r=>{lv(s).pipe((0,go.n)(a=>this.saveImageBlob(a)),(0,F.T)(a=>({chapterId:i,...a}))).subscribe(a=>{r.next(a),r.complete()},()=>{r.next(null),r.complete()})})}getIndexThumbnail(i,s="large"){return`${typeof localBaseDirectory>"u"?"":localBaseDirectory}thumbs/modules/${i}/${s}/index.jpg`}saveImageBlob(i){const r=new File([i],"image.jpg",{type:"image/jpeg"}),a=new FormData;return a.append("file",r),this.http.post("/ws/media/images/upload",a)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var $r,nt=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},B=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function NE(n,e,o,i,s,r){return r?(0,Ra.H)(o.getDatabaseItem(Ke.PreviewBookmark)):s===yt.Bookmark?n.getBookmarkModel(i):e.getConditionModel(i)}const RE={loading:!0,exporting:!1,copying:!1,saving:!1,bookmarks:[],selectedBookmark:null,sort:_p,checkedBookmarks:[],selectedCategory:null,bookmarkJobs:[]};let xe=(($r=class{static getBookmarks(e){const{bookmarks:o,sort:i}=e,{ascending:s,fields:r}=i;return xm(o,r,s)}static getCheckedBookmarks(e){return e.checkedBookmarks}static getSelectedBookmark(e){return e.selectedBookmark}static getSelectedBookmarkViewMode(e){return e.selectedBookmark.viewMode||ji.All}static getLoading(e){return e.loading}static getExporting(e){return e.exporting}static getSaving(e){return e.saving}static getCopying(e){return e.copying}static getSort(e){return e.sort}static getSelectedCategory(e){return e.selectedCategory}static getBookmarkJobs(e){return e.bookmarkJobs}static getActiveBookmarkJob(e){const o=["aborted","complete","error"];return e.bookmarkJobs.find(i=>!o.includes(i.job_status))}loadBookmarks(e,o){e.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),(0,si.p)(this.bookmarksService.getPrivateBookmarks(o.query,o.lang),this.bookmarksService.getPrivateConditions(o.query,o.lang)).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(([i,s])=>{e.dispatch(new ql([...i,...s]))})}loadOrganizationBookmarks(e,{organizationId:o,query:i,lang:s}){e.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.bookmarksService.getOrganizationContent(o,i,s).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(r=>{e.dispatch(new ql(r))})}loadCollectionBookmarks(e,o){e.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.organizationsService.getCollectionContent(o.organizationId,o.collectionId,o.query,o.lang).pipe((0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(i=>{e.dispatch(new ql(i))})}loadSuccess({patchState:e},o){e({bookmarks:o.result})}selectBookmark(e,o){const{id:i,type:s,preview:r}=o;NE(this.bookmarksService,this.exploreService,this.storageService,i,s,r).subscribe(l=>{e.dispatch(new wh(l))})}selectBookmarkSuccess(e,o){let{bookmark:i}=o;i&&(i=ga(i)),e.patchState({selectedBookmark:i})}saveBookmark(e,o){var i=this;return(0,J.A)(function*(){let s;e.patchState({saving:!0});const r=o.bookmarkEntry,a=r.id?"update":"save",l=i.store.selectSnapshot(E.getStoryChapters),_=!1===o.inplace,d=jd(l,_);_&&(yield(0,Xo._)(i.store.dispatch(new Ue.UpdateTweenParticleLookupChapters(d)))),o.includeIndex&&(s=i.bookmarksService.createBookmarkStory(r.title,d),"save"===a&&i.storyService.addContentRecord(i.store.selectSnapshot(Pe.getStoryId),s.story),r.index=s.story);let p=(0,Qe.of)([]);if(o.includeIndex){const u=i.store.selectSnapshot(oi.getRegisteredThumbnails),g=i.imagesService.saveChapterThumbnails(r.index.chapters,u,(0,m.invert)(d));g.length&&(p=(0,si.p)(g))}p.pipe((0,At.Z)(u=>{const g=i.store.selectSnapshot(oi.getRegisteredThumbnails);return u.forEach(y=>{const C=new Na;C.storyId=r.id,C.chapterId=y.chapterId,C.urls={small:y.uris.small,large:y.uris.large},g.set(y.chapterId,C);const O=r.index.chapters.findIndex(L=>L.id===y.chapterId);O>=0&&(r.index.chapters[O].thumbnails={...y.uris})}),e.dispatch(new Rd(g)),i.bookmarksService.saveBookmark(r)}),(0,Ye.j)(()=>e.patchState({saving:!1}))).subscribe({next:u=>{const g=Array.isArray(r.addCollections)&&r.addCollections.length>0,y=r.removeCollections&&Array.from(r.removeCollections.keys()).length>0;g||y?(i.actions.pipe((0,c.xi)(Wv,Xv),(0,Vt.s)(1)).subscribe(()=>{e.dispatch(new Yd(u,r.index,a))}),e.dispatch(new Ph(u,r.addCollections,r.removeCollections))):e.dispatch(new Yd(u,r.index,a))},error:u=>{e.dispatch(new Ih(r,u))}}),i.vendorAnalyticsService.track("Bookmark Save - Start")})()}saveBookmarkSuccess(e,o){const i=o.bookmark,s=e.getState().bookmarks,r=s.findIndex(a=>a.id===i.id);-1!==r&&(s[r]=i,e.patchState({bookmarks:[...s]})),"save"===o.method&&e.patchState({selectedBookmark:o.bookmark}),this.vendorAnalyticsService.track("Bookmark Save - Success",{id:i.id,chapters:o.story.chapters.length,tour:i.tour,animated:i.animated,quiz:i.quiz,edit:this.router.url.startsWith("/edit")})}saveBookmarkFail(e,o){const i=o.bookmarkEntry?.id||"",s=i.includes("/")?yt.Module:yt.Bookmark,r=xs(o.error),a=o.error?.status;this.vendorAnalyticsService.track("Bookmark Save - Failure",{contentId:i,contentType:s,error:r,statusCode:a,application:he.application})}deleteBookmark(e,o){const i=o.bookmarkId;this.bookmarksService.deleteBookmark(i).subscribe(()=>{e.dispatch(new Mh(i))},s=>{e.dispatch(new WI(i,s))})}deleteBookmarkSuccess(e,o){const i=e.getState().bookmarks.filter(s=>s.id!==o.bookmarkId);e.patchState({bookmarks:[...i]}),this.snackbar.open("Successfully deleted 3D model")}bulkDeleteBookmark(e,{bookmarkIds:o}){this.vendorAnalyticsService.track("Bulk Delete - Start"),this.bookmarksService.bulkDeleteBookmarks(o).subscribe({next:i=>{e.dispatch(new oA(o,i.job_id)),e.dispatch(new Kl)},error:i=>{this.vendorAnalyticsService.track("Bulk Delete - Error"),e.dispatch(new sA(o,i))}})}bulkDeleteBookmarkComplete(e,o){this.vendorAnalyticsService.track("Bulk Delete - Complete")}bulkDeleteBookmarksError(e,o){this.vendorAnalyticsService.track("Bulk Delete - Error")}sortBookmarks(e,o){const i=e.getState().bookmarks;e.patchState({sort:o.sort,bookmarks:[...i]})}clearBookmarks(e,o){e.patchState({bookmarks:[],checkedBookmarks:[]})}resetBookmarks(e,o){e.setState(RE)}checkBookmark(e,o){let i=e.getState().checkedBookmarks;const s=i.some(r=>r===o.id);o.checked&&!s?i=[...i,o.id]:o.checked||(i=i.filter(r=>r!==o.id)),e.patchState({checkedBookmarks:i})}setCheckedBookmarks(e,o){e.patchState({checkedBookmarks:o.ids})}exportBookmarks(e,o){const{bookmarks:i,organizationId:s,collections:r,widgetURL:a,widgetOptions:l,offlineEnabled:_,productAccountId:d}=o,p=l||new Om;e.patchState({exporting:!0}),this.publishService.exportBookmarks(i,s,r,a,p,null,o.userLanguage,o.userApp,_,d).pipe((0,Ye.j)(()=>{e.patchState({exporting:!1})})).subscribe(u=>{e.dispatch(u?new XI(i):new HI(i))})}postUpdateBookmarkCollections(e,o){const i=new Map,s=new Map;o.forEach(({bookmark:l,addCollections:_,removeCollections:d})=>{_.forEach(p=>{const u=p.collection_id,g={content_type:l.type,content_id:l.id},y=i.get(u)??[];y.push(g),i.set(u,y)}),d.forEach((p,u)=>{const g=u.collection_id,y=s.get(g)??[];y.push(p),s.set(g,y)})});const r=Array.from(i).map(([l,_])=>({collection_id:l,content_list:_})),a=Array.from(s).map(([l,_])=>({collection_id:l,collection_content_id_list:_}));return this.organizationsService.updateCollectionContent(e,r,a)}bulkUpdateBookmarkCollections(e,{groupId:o,updates:i}){this.vendorAnalyticsService.track("Bulk Move/Remove - Start"),this.postUpdateBookmarkCollections(o,i).subscribe({next:()=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Success"),e.dispatch(new rA(i))},error:s=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Error"),e.dispatch(new aA(i,s))}})}updateBookmarkCollections(e,o){const i=o.addCollections,s=i.map(_=>({collection_id:_.collection_id,content_list:[{content_type:o.bookmark.type,content_id:o.bookmark.id}]})),r=Array.from(o.removeCollections.keys()),a=r.map(_=>({collection_id:_.collection_id,collection_content_id_list:[o.removeCollections.get(_)]})),l=i.concat(r)[0].group_id;this.organizationsService.updateCollectionContent(l,s,a).subscribe(()=>{i.length>0&&e.dispatch(new QI(o.bookmark,i)),r.length>0&&e.dispatch(new Nh(o.bookmark,r)),e.dispatch(new Wv(o.bookmark,i,r))},()=>{i.length>0&&e.dispatch(new YI(o.bookmark,i)),r.length>0&&e.dispatch(new qI(o.bookmark,r)),e.dispatch(new Xv(o.bookmark,i,r))})}removeBookmarkCollectionSuccess(e,o){const{bookmarks:i,selectedCategory:s}=e.getState();if("collection"===s){const r=o.bookmark.id,a=i.filter(l=>l.id!==r);e.patchState({bookmarks:[...a]})}}copyBookmark(e,o){this.vendorAnalyticsService.track("Bookmark Copy - Start");const{groupAccess:i,collections:s}=o;let r,a,l,_,d;e.patchState({copying:!0,saving:!0});const p=NE(this.bookmarksService,this.exploreService,this.storageService,o.id,o.type,!1),u=this.storyService.getStory(o.id,o.type,o.lang);(0,si.p)([p,u]).pipe((0,F.T)(([g,y])=>{a=(0,m.cloneDeep)(y),l=(0,m.cloneDeep)(y),this.storyService.addContentRecord(o.id,l),_=jd(a.chapters,!0),l.chapters.forEach(C=>{C.id=_[C.id]}),o.type?delete l.sourceInfo:l.sourceInfo=av(l.sourceInfo),l.tweenParticleLookup&&(l.tweenParticleLookup=Ia.updateChapterIds(l.tweenParticleLookup,_)),d=g.viewMode}),(0,go.n)(()=>this.imagesService.generateFreshChapterImages(a.chapters,o.id)),(0,go.n)(g=>{const y=g.map(C=>this.imagesService.saveNewChapterImage(C.chapterId,C.snapshot));return y.length?(0,si.p)(y):(0,Qe.of)([])}),(0,F.T)(g=>{g.forEach(y=>{y.chapterId=_[y.chapterId]}),l.chapters.forEach(y=>{const C=g.find(O=>O.chapterId===y.id);C&&(y.thumbnails={...C.uris})})}),(0,go.n)(()=>{const g=new QP;return g.title=o.title,g.isOwner=!0,g.index=l,g.viewMode=d,g.is_content_copy=!0,i&&(g.add_group_access=[i]),this.bookmarksService.saveBookmark(g)}),(0,qo.M)(g=>{r=g}),(0,go.n)(()=>{if(i&&s&&s.length>0){const g=s[0].group_id,y=s.map(C=>({collection_id:C.collection_id,content_list:[{content_type:r.type,content_id:r.id}]}));return this.organizationsService.updateCollectionContent(g,y,[])}return(0,Qe.of)(!0)}),(0,Ye.j)(()=>{e.patchState({copying:!1,saving:!1})})).subscribe(()=>{this.vendorAnalyticsService.track("Bookmark Copy - Success",{id:r.id,chapters:l.chapters.length,tour:r.tour,animated:r.animated,quiz:r.quiz,edit:this.router.url.startsWith("/edit")}),e.dispatch(new KI(r))},g=>{this.vendorAnalyticsService.track("Bookmark Copy - Failure"),e.dispatch(new JI(o.id,g))})}copyBookmarks(e,{copyBookmarkModels:o}){this.vendorAnalyticsService.track("Bulk Add - Start"),e.patchState({copying:!0}),this.bookmarksService.bulkCopyBookmarks(o).pipe((0,Ye.j)(()=>{e.patchState({copying:!1})})).subscribe({next:i=>{e.dispatch(new nA(o,i.job_id)),e.dispatch(new Kl)},error:i=>{this.vendorAnalyticsService.track("Bulk Add - Error"),e.dispatch(new iA(o,i))}})}bulkCopyBookmarksComplete(e,o){this.vendorAnalyticsService.track("Bulk Add - Success")}BulkCopyBookmarksError(e,o){this.vendorAnalyticsService.track("Bulk Add - Error")}getBookmarkJobs(e,o){this.bookmarksService.getBookmarkJobs().subscribe({next:i=>{e.dispatch(new kh(i))},error:i=>{e.dispatch(new ZI(i))}})}setBookmarkJobs(e,{bookmarkJobs:o}){e.patchState({bookmarkJobs:o})}getBookmarkJobsSuccess(e,{bookmarkJobs:o}){e.dispatch(new Rh(o))}cancelBookmarkJob(e,{jobId:o,jobType:i}){this.vendorAnalyticsService.track(("bookmark_copy"===i?"Bulk Add":"Bulk Delete")+" - Stopped"),this.bookmarksService.cancelBookmarkJob(o).subscribe({next:()=>{e.dispatch(new eA(o,i)),e.dispatch(new Kl)},error:s=>{e.dispatch(new tA(o,i,s))}})}setBookmarkText(e,o){const i=e.getState().selectedBookmark;e.patchState({selectedBookmark:{...i,title:o.title}})}setBookmarkViewMode(e,o){const i=e.getState().selectedBookmark;e.patchState({selectedBookmark:{...i,viewMode:o.viewMode}})}setSelectedCategory(e,{category:o}){e.patchState({selectedCategory:o||null})}cancelSaveBookmark(e,o){e.patchState({saving:!1})}cancelCopyBookmark(e,o){e.patchState({copying:!1})}constructor(e,o,i,s,r,a,l,_,d,p,u,g){this.store=e,this.actions=o,this.bookmarksService=i,this.imagesService=s,this.storyService=r,this.exploreService=a,this.publishService=l,this.organizationsService=_,this.snackbar=d,this.vendorAnalyticsService=p,this.storageService=u,this.router=g}}).\u0275fac=function(e){return new(e||$r)(t.KVO(c.il),t.KVO(c.En),t.KVO(_c),t.KVO(up),t.KVO(kr),t.KVO(pp),t.KVO(Qa),t.KVO(Qo),t.KVO(ho.UG),t.KVO(Qn),t.KVO(Le),t.KVO(ut.Ix))},$r.\u0275prov=t.jDH({token:$r,factory:$r.\u0275fac}),$r);nt([(0,c.rc)(Dv),B("design:type",Function),B("design:paramtypes",[Object,Dv]),B("design:returntype",void 0)],xe.prototype,"loadBookmarks",null),nt([(0,c.rc)(Lv),B("design:type",Function),B("design:paramtypes",[Object,Lv]),B("design:returntype",void 0)],xe.prototype,"loadOrganizationBookmarks",null),nt([(0,c.rc)(Uv),B("design:type",Function),B("design:paramtypes",[Object,Uv]),B("design:returntype",void 0)],xe.prototype,"loadCollectionBookmarks",null),nt([(0,c.rc)(ql),B("design:type",Function),B("design:paramtypes",[Object,ql]),B("design:returntype",void 0)],xe.prototype,"loadSuccess",null),nt([(0,c.rc)(Oh),B("design:type",Function),B("design:paramtypes",[Object,Oh]),B("design:returntype",void 0)],xe.prototype,"selectBookmark",null),nt([(0,c.rc)(wh),B("design:type",Function),B("design:paramtypes",[Object,wh]),B("design:returntype",void 0)],xe.prototype,"selectBookmarkSuccess",null),nt([(0,c.rc)(jv),B("design:type",Function),B("design:paramtypes",[Object,jv]),B("design:returntype",Promise)],xe.prototype,"saveBookmark",null),nt([(0,c.rc)(Yd),B("design:type",Function),B("design:paramtypes",[Object,Yd]),B("design:returntype",void 0)],xe.prototype,"saveBookmarkSuccess",null),nt([(0,c.rc)(Ih),B("design:type",Function),B("design:paramtypes",[Object,Ih]),B("design:returntype",void 0)],xe.prototype,"saveBookmarkFail",null),nt([(0,c.rc)(Vv),B("design:type",Function),B("design:paramtypes",[Object,Vv]),B("design:returntype",void 0)],xe.prototype,"deleteBookmark",null),nt([(0,c.rc)(Mh),B("design:type",Function),B("design:paramtypes",[Object,Mh]),B("design:returntype",void 0)],xe.prototype,"deleteBookmarkSuccess",null),nt([(0,c.rc)(n0),B("design:type",Function),B("design:paramtypes",[Object,n0]),B("design:returntype",void 0)],xe.prototype,"bulkDeleteBookmark",null),nt([(0,c.rc)(i0),B("design:type",Function),B("design:paramtypes",[Object,i0]),B("design:returntype",void 0)],xe.prototype,"bulkDeleteBookmarkComplete",null),nt([(0,c.rc)(o0),B("design:type",Function),B("design:paramtypes",[Object,o0]),B("design:returntype",void 0)],xe.prototype,"bulkDeleteBookmarksError",null),nt([(0,c.rc)($v),B("design:type",Function),B("design:paramtypes",[Object,$v]),B("design:returntype",void 0)],xe.prototype,"sortBookmarks",null),nt([(0,c.rc)(Gv),B("design:type",Function),B("design:paramtypes",[Object,Gv]),B("design:returntype",void 0)],xe.prototype,"clearBookmarks",null),nt([(0,c.rc)(Ah),B("design:type",Function),B("design:paramtypes",[Object,Ah]),B("design:returntype",void 0)],xe.prototype,"resetBookmarks",null),nt([(0,c.rc)(Fv),B("design:type",Function),B("design:paramtypes",[Object,Fv]),B("design:returntype",void 0)],xe.prototype,"checkBookmark",null),nt([(0,c.rc)(Bv),B("design:type",Function),B("design:paramtypes",[Object,Bv]),B("design:returntype",void 0)],xe.prototype,"setCheckedBookmarks",null),nt([(0,c.rc)(zv),B("design:type",Function),B("design:paramtypes",[Object,zv]),B("design:returntype",void 0)],xe.prototype,"exportBookmarks",null),nt([(0,c.rc)(s0),B("design:type",Function),B("design:paramtypes",[Object,s0]),B("design:returntype",void 0)],xe.prototype,"bulkUpdateBookmarkCollections",null),nt([(0,c.rc)(Ph),B("design:type",Function),B("design:paramtypes",[Object,Ph]),B("design:returntype",void 0)],xe.prototype,"updateBookmarkCollections",null),nt([(0,c.rc)(Nh),B("design:type",Function),B("design:paramtypes",[Object,Nh]),B("design:returntype",void 0)],xe.prototype,"removeBookmarkCollectionSuccess",null),nt([(0,c.rc)(Hv),B("design:type",Function),B("design:paramtypes",[Object,Hv]),B("design:returntype",void 0)],xe.prototype,"copyBookmark",null),nt([(0,c.rc)(Zv),B("design:type",Function),B("design:paramtypes",[Object,Zv]),B("design:returntype",void 0)],xe.prototype,"copyBookmarks",null),nt([(0,c.rc)(t0),B("design:type",Function),B("design:paramtypes",[Object,t0]),B("design:returntype",void 0)],xe.prototype,"bulkCopyBookmarksComplete",null),nt([(0,c.rc)(e0),B("design:type",Function),B("design:paramtypes",[Object,e0]),B("design:returntype",void 0)],xe.prototype,"BulkCopyBookmarksError",null),nt([(0,c.rc)(Kl),B("design:type",Function),B("design:paramtypes",[Object,Kl]),B("design:returntype",void 0)],xe.prototype,"getBookmarkJobs",null),nt([(0,c.rc)(Rh),B("design:type",Function),B("design:paramtypes",[Object,Rh]),B("design:returntype",void 0)],xe.prototype,"setBookmarkJobs",null),nt([(0,c.rc)(kh),B("design:type",Function),B("design:paramtypes",[Object,kh]),B("design:returntype",void 0)],xe.prototype,"getBookmarkJobsSuccess",null),nt([(0,c.rc)(Jv),B("design:type",Function),B("design:paramtypes",[Object,Jv]),B("design:returntype",void 0)],xe.prototype,"cancelBookmarkJob",null),nt([(0,c.rc)(Yv),B("design:type",Function),B("design:paramtypes",[Object,Yv]),B("design:returntype",void 0)],xe.prototype,"setBookmarkText",null),nt([(0,c.rc)(qv),B("design:type",Function),B("design:paramtypes",[Object,qv]),B("design:returntype",void 0)],xe.prototype,"setBookmarkViewMode",null),nt([(0,c.rc)(Kv),B("design:type",Function),B("design:paramtypes",[Object,Kv]),B("design:returntype",void 0)],xe.prototype,"setSelectedCategory",null),nt([(0,c.rc)(xv),B("design:type",Function),B("design:paramtypes",[Object,xv]),B("design:returntype",void 0)],xe.prototype,"cancelSaveBookmark",null),nt([(0,c.rc)(Qv),B("design:type",Function),B("design:paramtypes",[Object,Qv]),B("design:returntype",void 0)],xe.prototype,"cancelCopyBookmark",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getBookmarks",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getCheckedBookmarks",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getSelectedBookmark",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getSelectedBookmarkViewMode",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getLoading",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getExporting",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getSaving",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getCopying",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getSort",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getSelectedCategory",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getBookmarkJobs",null),nt([(0,c.MD)(),B("design:type",Function),B("design:paramtypes",[to]),B("design:returntype",void 0)],xe,"getActiveBookmarkJob",null),xe=nt([(0,c.Uw)({name:"bookmarks",defaults:RE}),B("design:paramtypes",[c.il,c.En,_c,up,kr,pp,Qa,Qo,ho.UG,Qn,Le,ut.Ix])],xe);class qa{}var Fr,kE=function(n){return n.Light="theme-light",n.Dark="theme-dark",n}(kE||{}),$s=function(n){return n[n.Application=0]="Application",n[n.Search=1]="Search",n[n.View=2]="View",n[n.Hide=3]="Hide",n[n.Share=4]="Share",n[n.Logo=5]="Logo",n}($s||{}),DE=function(n){return n[n.Mobile=0]="Mobile",n[n.None=1]="None",n}(DE||{}),Mi=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},mt=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const LE={theme:kE.Light,sidenav:{enabled:!0,open:!1},siteHeader:$s.Application,siteFooter:DE.None,siteHeaderHeight:56,siteFooterHeight:56};let Kt=((Fr=class{static getTheme(e){return e.theme}static getSidenav(e){return e.sidenav}static getSiteHeader(e){return e.siteHeader}static getSiteHeaderHeight(e){return e.siteHeaderHeight}static getSiteFooter(e){return e.siteFooter}static getSiteFooterHeight(e){return e.siteFooterHeight}setTheme({patchState:e},{theme:o}){e({theme:o})}setHeader(e,o){e.patchState({siteHeader:o.siteHeaderType})}setFooter(e,o){e.patchState({siteFooter:o.siteFooterType})}setHeaderHeight(e,o){e.patchState({siteHeaderHeight:o.height})}setFooterHeight(e,o){e.patchState({siteFooterHeight:o.height})}setSidenav(e,o){e.patchState({sidenav:{...o.sidenav}})}toggleSidenav(e,o){const i=e.getState().sidenav;e.patchState({sidenav:{...i,open:o.open}})}resetLayout(e,o){e.setState(LE)}}).\u0275fac=function(e){return new(e||Fr)},Fr.\u0275prov=t.jDH({token:Fr,factory:Fr.\u0275fac}),Fr);function Gm(n,e,o=!0){return.01*(window.innerHeight-(o&&n!==$s.Hide?e:0))}function gp(n){return n===$s.Logo||he.application!==bt.Viewer}Mi([(0,c.rc)(fn.SetTheme),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetTheme]),mt("design:returntype",void 0)],Kt.prototype,"setTheme",null),Mi([(0,c.rc)(fn.SetHeader),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetHeader]),mt("design:returntype",void 0)],Kt.prototype,"setHeader",null),Mi([(0,c.rc)(fn.SetFooter),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetFooter]),mt("design:returntype",void 0)],Kt.prototype,"setFooter",null),Mi([(0,c.rc)(fn.SetHeaderHeight),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetHeaderHeight]),mt("design:returntype",void 0)],Kt.prototype,"setHeaderHeight",null),Mi([(0,c.rc)(fn.SetFooterHeight),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetFooterHeight]),mt("design:returntype",void 0)],Kt.prototype,"setFooterHeight",null),Mi([(0,c.rc)(fn.SetSidenav),mt("design:type",Function),mt("design:paramtypes",[Object,fn.SetSidenav]),mt("design:returntype",void 0)],Kt.prototype,"setSidenav",null),Mi([(0,c.rc)(fn.ToggleSidenav),mt("design:type",Function),mt("design:paramtypes",[Object,fn.ToggleSidenav]),mt("design:returntype",void 0)],Kt.prototype,"toggleSidenav",null),Mi([(0,c.rc)(fn.ResetLayout),mt("design:type",Function),mt("design:paramtypes",[Object,fn.ResetLayout]),mt("design:returntype",void 0)],Kt.prototype,"resetLayout",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getTheme",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getSidenav",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getSiteHeader",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getSiteHeaderHeight",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getSiteFooter",null),Mi([(0,c.MD)(),mt("design:type",Function),mt("design:paramtypes",[qa]),mt("design:returntype",void 0)],Kt,"getSiteFooterHeight",null),Kt=Mi([(0,c.Uw)({name:"layout",defaults:LE})],Kt);let hp=(()=>{var n;class e{constructor(i,s,r,a){this.store=i,this.chapterService=s,this.animationService=r,this.mediaService=a,this.ui=null,this.horizontalBreakpoint=null}getBase(){return{ui:this.store.selectSnapshot(ue.getUI),layout:this.store.selectSnapshot(P.getLayout),horizontalBreakpoint:this.store.selectSnapshot(mn.getHorizontalBreakpoint),canvasHeightBreakpoint:this.store.selectSnapshot(U.getCanvasHeightBreakpoint),quizActive:this.store.selectSnapshot(G.getQuizModeActive),hideUI:this.isUIHidden()}}isUIHidden(){const i=this.store.selectSnapshot(P.getOpenWindow),s=this.store.selectSnapshot(E.getSelectedChapterIndex),r=this.store.selectSnapshot(ue.getUI),a=i===en.Loader&&s<=0&&r.loader.template===ss.Circle,l=this.store.selectSnapshot(ki.getStoryLoadProgress);return a||0===l||i===en.OnDemand||i===en.Interact||i===en.Tutorial||i===en.Whiteboard}isDrawerVisible(){const{layout:i,quizActive:s,hideUI:r}=this.getBase();if(r||this.getViewLayout(i)!==Bn.Drawer)return!1;if(s)return!0;const a=this.store.selectSnapshot(P.getContentMode);return!(a===lt.ChapterInfo&&"full"!==this.getVisibleContent(lt.ChapterInfo)||a===lt.Quiz&&"full"!==this.getVisibleContent(lt.Quiz)||a===lt.LabelInfo&&"none"===this.getVisibleContent(lt.LabelInfo))&&this.isUIVisible(h.Drawer)}isDrawerToggleVisible(){const{ui:i,layout:s,quizActive:r}=this.getBase(),a=this.getVisibleContent(lt.ChapterInfo);return this.getViewLayout(s)===Bn.Drawer&&"full"===a&&!1!==i.drawer.enable&&!r&&this.isUIVisible(h.DrawerToggle)}isColumnVisible(){const{layout:i,ui:s}=this.getBase();if(s.column.status===Ve.Collapse||this.getViewLayout(i)!==Bn.Column)return!1;const r=this.store.selectSnapshot(P.getContentMode);return(r!==lt.ChapterInfo&&r!==lt.Chapters||"full"===this.getVisibleContent(lt.ChapterInfo))&&(r!==lt.Quiz||"full"===this.getVisibleContent(lt.Quiz))&&this.isUIVisible(h.Column)}isColumnToggleVisible(){const{hideUI:i,layout:s,ui:r}=this.getBase();if(i||this.getViewLayout(s)!==Bn.Column)return!1;const a=this.store.selectSnapshot(P.getContentMode);return!(a===lt.ChapterInfo&&"full"!==this.getVisibleContent(lt.ChapterInfo)||a===lt.Quiz&&"full"!==this.getVisibleContent(lt.Quiz))&&r.column.enable}isTitleOnlyVisible(){const{hideUI:i,ui:s,layout:r}=this.getBase();if(i)return!1;const a=this.getViewLayout(r),l=this.getVisibleContent(lt.ChapterInfo),_=this.isPaginationVisible();let d=!0;return!(this.store.selectSnapshot(G.getQuizModeActive)||a===Bn.Column&&(!1===s.column.enable&&!1===_||!1===s.column.enable&&"titleOnly"===l&&!1===_||s.column.enable&&"full"===l&&s.column.status!==Ve.Collapse))&&(a===Bn.Drawer&&(d=s.drawer.enable||_),d)}isToggleLabelsVisible(){return 0!==this.store.selectSnapshot(ye.getChapterLabels).length&&this.isUIVisible(h.ToggleLabels)}isToolsVisible(){return this.isUIVisible(h.Tools)}isToolbarVisible(){return this.isUIVisible(h.Toolbar)}isFullScreenVisible(){return!this.store.selectSnapshot(P.getIsMobileWeb)&&this.isUIVisible(h.Fullscreen)}isLogoVisible(){const{ui:i}=this.getBase();if(this.store.selectSnapshot(P.getOpenWindow)===en.OnDemand)return!1;const s=this.store.selectSnapshot(P.getIsMobileWeb),r=this.store.selectSnapshot(ue.getUIEntry(h.Media));return!(this.isMediaVisible()&&"show"===r.status&&!s)&&i.logo.enable}isCameraVisible(){return this.isUIVisible(h.Camera)}isPaginationVisible(){return!(this.store.selectSnapshot(E.getChapterCount)<=1)&&this.isUIVisible(h.Pagination)}isMediaVisible(){const{hideUI:i,ui:s}=this.getBase(),r=s.media.enable,a=this.store.selectSnapshot(E.getSelectedChapter);return!(this.store.selectSnapshot(U.getCanvasHeightBreakpoint)===Fi.Tiny||i||!r||!a?.id||!this.animationService.isChapterAnimated(a))&&this.isUIVisible(h.Media)}isPlaythroughVisible(){const i=this.store.selectSnapshot(E.getChapterCount)>1;return!(this.store.selectSnapshot(xe.getSelectedBookmarkViewMode)===ji.Quiz||!i)&&this.isUIVisible(h.Playthrough)}isToolbarOverflowVisible(){const{canvasHeightBreakpoint:i}=this.getBase(),s=this.isUIVisible(h.Help),r=this.isToggleLabelsVisible(),a=this.store.selectSnapshot(G.hasQuiz),l=this.store.selectSnapshot(G.getQuizEnabled),_=this.isUIVisible(h.QuizPrompt),d=this.store.selectSnapshot(G.getQuizModeLocked),p=this.store.selectSnapshot(xe.getSelectedBookmarkViewMode),u=this.store.selectSnapshot(P.getIsMobileWeb);if(i>Fi.Tiny&&(s||r||a&&_&&l&&!1===d&&p!==ji.Content&&u))return!0;const y=this.isUIVisible(h.Tools),C=this.isUIVisible(h.VisibilityLayers),O=this.isUIVisible(h.Search),L=this.isUIVisible(h.Whiteboard);return!!(i<=Fi.Tiny&&(y||C||O||L))||this.isUIVisible(h.ToolbarOverflow)}isNodeInfoColumnVisible(){const{hideUI:i,ui:s,horizontalBreakpoint:r}=this.getBase();return!i&&(!!(r>=Un.Large&&this.isUIVisible(h.NodeInfo))||(r<Un.Large?!s.drawer.enable&&this.isUIVisible(h.NodeInfo):void 0))}isNodeInfoVisible(i){const{hideUI:s,horizontalBreakpoint:r}=this.getBase();return!s&&(r>=Un.Large&&i===Bn.Column||r<Un.Large&&i===Bn.Drawer)&&this.isUIVisible(h.NodeInfo)}isAudioVisible(){const{hideUI:i,ui:s}=this.getBase(),r=this.store.selectSnapshot(P.getViewLanguage),a=this.store.selectSnapshot(E.getSelectedChapter),l=this.store.selectSnapshot(P.getForceAudio);return!(0,m.isNil)(a)&&this.mediaService.getChapterAudioPlaybackType(a,r,l)!==ri.None&&!i&&s[h.Audio].status!==Ve.Hide&&(s[h.Audio].enable||l)}isQuizPromptVisible(){const{hideUI:i}=this.getBase();return!i&&this.isUIVisible(h.QuizPrompt)}isSearchVisible(){return this.store.selectSnapshot(U.getCanvasHeightBreakpoint)!==Fi.Tiny&&this.isUIVisible(h.Search)}isUndoVisible(){const{hideUI:i,ui:s}=this.getBase();return!i&&s.undo.enable}isSkinLayersVisible(){const i=this.store.selectSnapshot(Pe.getVariantSchema("skin"));return!(0,m.isEmpty)(i)&&this.store.selectSnapshot(U.getCanvasHeightBreakpoint)!==Fi.Tiny&&this.isUIVisible(h.SkinLayers)}isVisibilityLayersVisible(){const i=this.store.selectSnapshot(E.getSelectedChapterSrcLayers),s=this.isSkinLayersVisible();return!(!this.chapterService.hasVisibilityLayers(i)&&!s||this.store.selectSnapshot(U.getCanvasHeightBreakpoint)===Fi.Tiny)&&(this.isUIVisible(h.VisibilityLayers)||this.isSkinLayersVisible())}isWhiteboardVisible(){return this.isUIVisible(h.Whiteboard)}isVisible(i){switch(i){case h.Audio:return this.isAudioVisible();case h.Camera:return this.isCameraVisible();case h.Column:return this.isColumnVisible();case h.ColumnToggle:return this.isColumnToggleVisible();case h.Drawer:return this.isDrawerVisible();case h.DrawerToggle:return this.isDrawerToggleVisible();case h.Fullscreen:return this.isFullScreenVisible();case h.Logo:return this.isLogoVisible();case h.Media:return this.isMediaVisible();case h.ToolbarOverflow:return this.isToolbarOverflowVisible();case h.QuizPrompt:return this.isQuizPromptVisible();case h.Pagination:return this.isPaginationVisible();case h.Playthrough:return this.isPlaythroughVisible();case h.Search:return this.isSearchVisible();case h.TitleOnly:return this.isTitleOnlyVisible();case h.ToggleLabels:return this.isToggleLabelsVisible();case h.Tools:return this.isToolsVisible();case h.Toolbar:return this.isToolbarVisible();case h.Undo:return this.isUndoVisible();case h.VisibilityLayers:return this.isVisibilityLayersVisible();case h.SkinLayers:return this.isSkinLayersVisible();case h.Whiteboard:return this.isWhiteboardVisible();default:return this.isUIVisible(i)}}isUIVisible(i){const{hideUI:s,ui:r}=this.getBase();return r[i]?!s&&r[i].enable&&r[i].status!==Ve.Hide:(console.warn("Attempting to check visibility of a non-existent element: ${element}"),!1)}isUIEnabled(i){const{ui:s}=this.getBase();return s[i].enable}getChapterVisibility(){const{ui:i}=this.getBase(),s=this.store.selectSnapshot(ye.getChapterLabels),r=this.store.selectSnapshot(E.getSelectedChapter),a=r?.displayName,l=null!=a&&(0,m.trim)(a).length>0,_=(0,m.get)(r,"contentBlocks",[]).length>0,d=i.labelList.enable&&s.length>0,p=r?.description,u=null!=p&&(0,m.trim)(p).length>0,g=(0,m.get)(r,"legend",[]);return d||u||i.legend.enable&&g.length>0||_?"full":l?"titleOnly":"none"}getQuizVisibility(){return this.store.selectSnapshot(G.getQuizModeActive)?"full":"none"}getLabelInfoVisibility(){const i=this.store.selectSnapshot(ye.getSelectedLabel);if((0,m.isNil)(i))return"none";const s=i?.title,r=null!=s&&(0,m.trim)(s).length>0;return(0,m.trim)(i.description).length>0||i.contentBlocks?.length>0?"full":r?"titleOnly":"none"}getVisibleContent(i){switch(i){case lt.ChapterInfo:return this.getChapterVisibility();case lt.LabelInfo:return this.getLabelInfoVisibility();case lt.Quiz:return this.getQuizVisibility()}}getViewLayout(i){const{innerHeight:s,innerWidth:r}=window,a=r/s>=1?"landscape":"portrait",{horizontalBreakpoint:l}=this.getBase(),_=this.store.selectSnapshot(Kt.getSiteHeader),d=this.store.selectSnapshot(Kt.getSiteHeaderHeight),u=384+(gp(_)?d:0);switch(i){case zd.ColumnOnly:return Bn.Column;case zd.DrawerOnly:return Bn.Drawer;default:return"portrait"===a?Bn.Drawer:l>=Un.Large||s<=u&&r>=708?Bn.Column:Bn.Drawer}}getMediaTemplate(){const{ui:i}=this.getBase();return i.media.template}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO($l),t.KVO(bi),t.KVO(Di))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class Ka{}const Bt=(n,e)=>(0,m.isNil)(n)?e:n;function Nt(...n){return!!n.some(e=>!0===e)||!n.some(e=>!1===e)&&void 0}function $m(n,e,o){const i=Fm(o,Object.values(Wi));return(0,m.isNil)(i)?!1===n?Wi.None:null!=e?e?Wi.Full:Wi.Small:null:i}function mp(n){return Fm(n,Object.values(ss))}function fp(n,e){return!0===e?jr.Group:Fm(n,Object.values(jr))}function Fm(n,e){return e.includes(n)?n:null}function UE(n){const e={all:void 0,anatomyLabels:n.anatomyLabels.enable,audio:n.audio.enable,cameraMode:n.camera.enable,center:n.camera.enable,contextActions:n.contextActions.enable,fullscreen:n.fullscreen.enable,help:n.help.enable,info:n.column.enable||n.drawer.enable,infoExpand:void 0,legend:n.legend.enable,loader:mp(n.loader.template),nav:n.camera.enable,objectTree:n.search.enable,playPause:n.media.enable,"scrubber.chapters":n.media.enable,scrubber:n.media.enable,"tools-display":n.tools.enable,tools:n.tools.enable,"tour.chapters":n.pagination.enable,tour:n.pagination.enable,visibilityLayers:n.visibilityLayers.enable,visibilityLayersMode:n.visibilityLayers.layersMode,skinLayers:n.skinLayers.enable,whiteboard:n.whiteboard.enable,zoomIn:n.camera.enable,zoomOut:n.camera.enable,share:!1,dissect:!1,xray:!1,annotations:!1,crossSection:!1,isolate:!1};return(0,m.pickBy)(e,o=>!(0,m.isNil)(o))}function VE(n){const e=null!=n["ui-all"]?jE(n["ui-all"]):new Ka;return Br({[h.Layout]:n["ui-layout"],[h.Loader]:mp(n["ui-loader"]),[h.NodeInfo]:n["ui-anatomy-descriptions"],[h.NodeAudio]:n["ui-anatomy-pronunciations"],[h.Tools]:n["ui-tools"],[h.Media]:$m(null,Nt(n["ui-scrubber"],n["ui-scrubber.chapters"],n["ui-scrubber.tour"]),n["ui-media-controls"]),[h.Audio]:n["ui-audio"],[h.Fullscreen]:n["ui-fullscreen"],[h.Help]:n["ui-help"],[h.Camera]:n["ui-nav"],[h.Toolbar]:Nt(n["ui-toolbar"],n["ui-menu"]),[h.Pagination]:n["ui-tour"],[h.Search]:Nt(n["ui-search"],n["ui-object-tree"]),[h.Column]:Nt(n["ui-info"],n["ui-panel"]),[h.Drawer]:Nt(n["ui-info"],n["ui-panel"]),[h.Description]:Nt(n["ui-info"]),[h.TitleOnly]:Nt(n["ui-info"]),[h.Logo]:Nt(n["ui-bd"],n["ui-logo"]),logoIsHyperLink:Nt(n["ui-bd.link"],n["ui-logo.islink"]),[h.Labels]:n["ui-labels"],[h.LabelList]:n["ui-label-list"],all:n["ui-all"],drawerExpanded:n["ui-info-expand"],fadeout:n["ui-fadeout"],startingColumn:n["ui-starting-column"],startingTool:n["ui-starting-tool"],[h.AnatomyLabels]:Nt(n["ui-anatomy-labels"]),[h.Tutorial]:Nt(n["ui-tutorial"]),[h.Legend]:Nt(n["ui-legend"]),[h.Undo]:Nt(n["ui-undo"],n["ui-reset"]),[h.Whiteboard]:Nt(n["ui-whiteboard"]),[h.VisibilityLayers]:Nt(n["ui-visibility-layers"],n["ui-layers"]),[h.VisibilityLayersMode]:fp(n["ui-visibility-layers-mode"],n["ui-skin-layers"]),[h.SkinLayers]:Nt(n["ui-skin-layers"]),[h.ContextActions]:Nt(n["ui-context-actions"]),[h.ToggleLabels]:void 0,[h.QuizPrompt]:n["ui-quiz"],[h.Playthrough]:Nt(n.playthrough,n.autoplay)},e)}function jE(n){return{all:n,drawerExpanded:null,logoIsHyperLink:null,fadeout:null,startingColumn:null,[h.AnatomyLabels]:null,[h.Audio]:n,[h.Camera]:n,[h.Column]:n,[h.ContextActions]:n,[h.Drawer]:n,[h.Fullscreen]:n,[h.Help]:n,[h.LabelList]:n,[h.Labels]:null,[h.Legend]:!0,[h.Loader]:n?yh:ss.None,[h.Logo]:!0,[h.Media]:n?Wi.Full:Wi.None,[h.NodeAudio]:n,[h.NodeInfo]:n,[h.Pagination]:n,[h.QuizPrompt]:n,[h.Search]:n,[h.TitleOnly]:n,[h.ToggleLabels]:!0,[h.Toolbar]:n,[h.Tools]:n,[h.Tutorial]:null,[h.Undo]:n,[h.VisibilityLayers]:n,[h.VisibilityLayersMode]:null,[h.SkinLayers]:n,[h.Whiteboard]:n}}function Br(n,e){return null==e?n:(0,m.uniq)([...Object.keys(n),...Object.keys(e)]).reduce((i,s)=>(i[s]=null==n[s]?e[s]:n[s],i),new Ka)}function xE(n,e){const o=JSON.parse(JSON.stringify(n)),i={...Eh};return o.loader.enable=Bt(e[h.Loader]!==ss.None,i.loader.enable),null!=e[h.Loader]&&(o.loader.template=e[h.Loader]),o.anatomyLabels.enable=Bt(e[h.AnatomyLabels],i.anatomyLabels.enable),o.audio.enable=Bt(e[h.Audio],i.audio.enable),o.camera.enable=Bt(e[h.Camera],i.camera.enable),o.column.enable=Bt(e[h.Column],i.column.enable),o.contextActions.enable=Bt(e[h.ContextActions],i.contextActions.enable),o.description.enable=Bt(e[h.Description],i.description.enable),o.drawer.enable=Bt(e[h.Drawer],i.drawer.enable),o.fullscreen.enable=Bt(e[h.Fullscreen],i.fullscreen.enable),o.help.enable=Bt(e[h.Help],i.help.enable),o.labelList.enable=Bt(e[h.LabelList],i.labelList.enable),o.labels.enable=Bt(e[h.Labels],i.labels.enable),o.logo.enable=Bt(e[h.Logo],i.logo.enable),o.logo.isHyperLink=Bt(e.logoIsHyperLink,i.logo.isHyperLink),o.media.enable=Bt(e[h.Media]!==Wi.None,i.media.enable),o.media.template=e[h.Media],o.nodeAudio.enable=Bt(e[h.NodeAudio],i.nodeAudio.enable),o.nodeInfo.enable=Bt(e[h.NodeInfo],i.nodeInfo.enable),o.pagination.enable=Bt(e[h.Pagination],i.pagination.enable),o.playthrough.enable=Bt(e[h.Playthrough],i.playthrough.enable),o.quizPrompt.enable=Bt(e[h.QuizPrompt],i.quizPrompt.enable),o.search.enable=Bt(e[h.Search],i.search.enable),o.titleOnly.enable=Bt(e[h.TitleOnly],i.titleOnly.enable),o.toggleLabels.enable=Bt(e[h.ToggleLabels],i.toggleLabels.enable),o.toolbar.enable=Bt(e[h.Toolbar],i.toolbar.enable),o.tools.enable=Bt(e[h.Tools],i.tools.enable),o.tutorial.enable=Bt(e[h.Tutorial],i.tutorial.enable),o.undo.enable=Bt(e[h.Undo],i.undo.enable),o.visibilityLayers.enable=Bt(e[h.VisibilityLayers],i.visibilityLayers.enable),o.visibilityLayers.layersMode=fp(e[h.VisibilityLayersMode]??i.visibilityLayers.layersMode,e[h.SkinLayers]),o.skinLayers.enable=Bt(e[h.SkinLayers],i.skinLayers.enable),o.whiteboard.enable=Bt(e[h.Whiteboard],i.whiteboard.enable),o}var pt=S(4006);let qe=(()=>{var n;class e{get iconClass(){let s=`${this.custom?"fak":"fas"} fa-${this.icon}`;return this.size&&(s+=` fa-${this.size}`),s}constructor(){this.custom=!1}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-icon"]],inputs:{icon:"icon",size:"size",custom:"custom"},decls:1,vars:1,consts:[[3,"ngClass"]],template:function(i,s){1&i&&t.nrm(0,"i",0),2&i&&t.Y8G("ngClass",s.iconClass)},dependencies:[b.YU],styles:["[_nghost-%COMP%]{display:inline-block}"],changeDetection:0}),e})();var GE=S(7424),$E=S(7018);let o2=(()=>{var n;class e{transform(i){return i.split(" ").map(r=>`<kbd>${r}</kbd>`).join("")}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=t.EJ8({name:"kbd",type:n,pure:!0}),e})();function s2(n,e){if(1&n&&(t.j41(0,"label",12),t.EFF(1),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.JRh(o.pronunciation)}}function r2(n,e){if(1&n&&(t.j41(0,"span"),t.nrm(1,"kbd",10),t.nI1(2,"kbd"),t.DNE(3,s2,2,1,"label",11),t.k0s()),2&n){const o=e.$implicit;t.R7$(),t.Y8G("innerHTML",t.bMT(2,3,o.shortcut),t.npT),t.BMQ("aria-hidden",o.hasOwnProperty("pronunciation")),t.R7$(2),t.Y8G("ngIf",o.hasOwnProperty("pronunciation"))}}function a2(n,e){if(1&n&&(t.j41(0,"tr")(1,"th",8),t.EFF(2),t.k0s(),t.j41(3,"td",9),t.DNE(4,r2,4,5,"span",7),t.k0s()()),2&n){const o=e.$implicit;t.R7$(2),t.JRh(o.label),t.R7$(2),t.Y8G("ngForOf",o.keys)}}function l2(n,e){if(1&n&&(t.j41(0,"div",3)(1,"h2",4),t.EFF(2),t.k0s(),t.j41(3,"table",5)(4,"tr"),t.nrm(5,"th"),t.j41(6,"th",6),t.pXf(7,0),t.k0s()(),t.DNE(8,a2,5,2,"tr",7),t.k0s()()),2&n){const o=e.$implicit;t.R7$(2),t.JRh(o.label),t.R7$(6),t.Y8G("ngForOf",o.shortcuts)}}var as=function(n){return n.Left="\u2190",n.Right="\u2192",n.Up="\u2191",n.Down="\u2193",n.Command="\u2318",n}(as||{});let c2=(()=>{var n;class e{constructor(){this.shortcutGroups=[{label:$localize`Navigation`,shortcuts:[{keys:[{shortcut:",",pronunciation:"Comma."},{shortcut:"Pg-Up",pronunciation:"page-up"}],label:$localize`Previous chapter`},{keys:[{shortcut:".",pronunciation:"Period."},{shortcut:"Pg-Down",pronunciation:"Page-down."}],label:$localize`Next chapter`},{keys:[{shortcut:"/",pronunciation:"Forward slash."}],label:$localize`Open Search`},{keys:[{shortcut:"Ctrl + Enter"}],label:$localize`Enter Fullscreen`},{keys:[{shortcut:"Ctrl/Cmd + ,",pronunciation:"Control or command plus comma."}],label:$localize`Toggle Description`},{keys:[{shortcut:"Shift + /"}],label:$localize`Open Help`}]},{label:$localize`Tools`,shortcuts:[{keys:[{shortcut:"1"}],label:$localize`Use "Select" tool`},{keys:[{shortcut:"2"}],label:$localize`Use "Hide" tool`},{keys:[{shortcut:"3"}],label:$localize`Use "Fade" tool`},{keys:[{shortcut:"del",pronunciation:"Delete."},{shortcut:"backspace"}],label:$localize`Hide selected structure`},{keys:[{shortcut:"Shift + R"}],label:$localize`Reset chapter`},{keys:[{shortcut:"P"}],label:$localize`Toggle between pan and rotate mode`},{keys:[{shortcut:"Ctrl/Cmd + Z",pronunciation:"Control or command plus z."}],label:$localize`Undo`},{keys:[{shortcut:"Ctrl/Cmd + Shift + Z",pronunciation:"Control or command plus shift pluz z."},{shortcut:"Ctrl/Cmd + Y",pronunciation:"Control or command plus y."}],label:$localize`Redo`}]},{label:$localize`Pan`,shortcuts:[{keys:[{shortcut:"W"}],label:$localize`Pan up`},{keys:[{shortcut:"S"}],label:$localize`Pan down`},{keys:[{shortcut:"A"}],label:$localize`Pan left`},{keys:[{shortcut:"D"}],label:$localize`Pan right`},{keys:[{shortcut:"Shift + W"}],label:$localize`Slow pan up`},{keys:[{shortcut:"Shift + S"}],label:$localize`Slow pan down`},{keys:[{shortcut:"Shift + A"}],label:$localize`Slow pan left`},{keys:[{shortcut:"Shift + D"}],label:$localize`Slow pan right`}]},{label:$localize`Rotate`,shortcuts:[{keys:[{shortcut:as.Up}],label:$localize`Rotate up`},{keys:[{shortcut:as.Down}],label:$localize`Rotate down`},{keys:[{shortcut:as.Left}],label:$localize`Rotate left`},{keys:[{shortcut:as.Right}],label:$localize`Rotate right`},{keys:[{shortcut:`Shift + ${as.Up}`}],label:$localize`Slow rotate up`},{keys:[{shortcut:`Shift + ${as.Down}`}],label:$localize`Slow rotate down`},{keys:[{shortcut:`Shift + ${as.Left}`}],label:$localize`Slow rotate left`},{keys:[{shortcut:`Shift + ${as.Right}`}],label:$localize`Slow rotate right`}]},{label:$localize`Zoom`,shortcuts:[{keys:[{shortcut:"E"},{shortcut:"=",pronunciation:"Equals."}],label:$localize`Zoom in`},{keys:[{shortcut:"C"},{shortcut:"-",pronunciation:"Hyphen."}],label:$localize`Zoom out`},{keys:[{shortcut:"Shift + E"},{shortcut:"Shift + =",pronunciation:"Shift plus equals."}],label:$localize`Slow zoom in`},{keys:[{shortcut:"Shift + C"},{shortcut:"Shift + -",pronunciation:"Shift plus hyphen."}],label:$localize`Slow zoom out`}]},{label:$localize`Interact`,shortcuts:[{keys:[{shortcut:"Shift + H"}],label:$localize`Hide selected objects`},{keys:[{shortcut:"Shift + I"}],label:$localize`Isolate selected objects`},{keys:[{shortcut:"Shift + F"}],label:$localize`Fade selected objects`},{keys:[{shortcut:"J"}],label:$localize`Rewind 1 second`},{keys:[{shortcut:"L"}],label:$localize`Fast forward 1 second`},{keys:[{shortcut:"K"},{shortcut:"space"}],label:$localize`Play / pause animation`}]}]}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-shortcuts"]],decls:2,vars:1,consts:()=>{let o;return o=$localize`:d915cce8099a3ad92c444a138ba5996cfcc108d5688644717663616739:Keyboard Shortcut`,[o,[1,"view-shortcuts"],["class","view-shortcuts__group",4,"ngFor","ngForOf"],[1,"view-shortcuts__group"],[1,"view-shortcuts__label","font-bold"],[1,"view-shortcuts__table"],["scope","col",1,"view-shortcuts__cell-header"],[4,"ngFor","ngForOf"],["scope","row",1,"view-shortcuts__cell-header"],[1,"view-shortcuts__cell","view-shortcuts__cell--key"],[1,"view-shortcuts__key",3,"innerHTML"],["class","sr-only",4,"ngIf"],[1,"sr-only"]]},template:function(i,s){1&i&&(t.j41(0,"div",1),t.DNE(1,l2,9,2,"div",2),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.shortcutGroups))},dependencies:[b.Sq,b.bT,o2],styles:[".view-shortcuts{display:flex;flex-direction:column}.view-shortcuts__group{width:100%;padding-bottom:32px;margin-top:32px}.view-shortcuts__label{padding:8px 0 12px}.view-shortcuts__table{width:100%}.view-shortcuts__cell{padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__cell-header{text-align:start;padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__key{border-radius:4px;display:inline-flex;padding:4px;margin-right:4px;background:#000;color:#fff;justify-content:center;align-items:center;font-family:monospace;font-size:16px}.view-shortcuts__key>kbd{margin-inline-end:8px}.view-shortcuts__key>kbd:last-child{margin-inline-end:0}\n"],encapsulation:2,changeDetection:0}),e})();var pc;const p2=["viewHelp"];class Bm{constructor(e,o,i,s){this.dialogRef=e,this.renderer=o,this.store=i,this.data=s,this.helpTypeEnum=Ho,this.activeTab=Ho.Basics,this.ngUnsubscribe=new oe.B,this.activeTab=s.tab}ngOnInit(){this.initWindowSizeObserver()}ngAfterViewInit(){this.updateViewHeight()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWindowSizeObserver(){this.renderer.listen("window","resize",()=>{this.updateViewHeight()})}updateViewHeight(){const i=Gm(this.store.selectSnapshot(Kt.getSiteHeader),this.store.selectSnapshot(Kt.getSiteHeaderHeight),!1);this.viewHelp.nativeElement.style.setProperty("--vh",`${i}px`)}handleCloseClick(){this.dialogRef.close()}}(pc=Bm).\u0275fac=function(e){return new(e||pc)(t.rXU(pt.CP),t.rXU(t.sFG),t.rXU(c.il),t.rXU(pt.Vh))},pc.\u0275cmp=t.VBU({type:pc,selectors:[["app-help-dialog"]],viewQuery:function(e,o){if(1&e&&t.GBs(p2,7),2&e){let i;t.mGM(i=t.lsd())&&(o.viewHelp=i.first)}},decls:147,vars:1,consts:()=>{let n,e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z,te,se,ge,st,We,ln,Ie,_r,zo,dr,pr,yl,Jt,Wo,vl,bu,yu,vu,Eu,Tu,Cu,Ou,wu,Mu,Iu,Au,Pu,Nu,V,j;return n=$localize`:fe6f57177418d5e7beb3165189f76d610996162d7676085147402388734:Navigation Basics`,e=$localize`:429597f3d7d1d78213dcf7dd66eebfde0d86678e6253898756323650322:A heart with an arrow wrapped around it, which symbolises objects being rotated withing the 3D viewport.`,o=$localize`:e18d3340208bca7ddf2d94f70d0a660dbd42385d5773019152243041254:A heart with left and right arrows pointing away from it, which symbolises objects being panned within the 3D viewport`,i=$localize`:d39dadf537d9b0839ce21a28536327f9f5a686c74934730967388350918:A heart with a magnifying glass over it, which symbolises zooming into and out from an object within the 3D viewport.`,s=$localize`:304ad8b02639512724d4bd74a4e0948235755937354592426013976576:A heart with a smaller region colored in blue and a popup window specifying that the Right Ventricle is selected.`,r=$localize`:6cfe97f88f0ed2276b3712e9f9f3afa30a5202816061724875357600922:All Controls`,a=$localize`:18a94681247b809ceced9eb0f694ae4c0d312da46414411281097606478:A mouse with the left button being held in.`,l=$localize`:1170cfcc8c84af3864f78a0492ec1fd7802843688257874423928835005:A mouse with the right button being held in.`,_=$localize`:7af3be3703c527b268af7bdf41dbea65aa79a6ec9056964158501440909:A mouse with the left button being clicked.`,d=$localize`:2060ac29b56620ac4dee9e60c192070663dbe8ae1011682562656049028:A mouse with the left button being double clicked.`,p=$localize`:3151632192d235a3f169dca7cc9ef84780febe866187030666890085624:A mouse with the left button being held in for a long duration.`,u=$localize`:966f12391c5738cf46c32d1cb6a5f5a8340486424740543999988156181:The arrow keys.`,g=$localize`:6ba68416157f6fe2131511ecdd079903b2eeefb78470097694829285611:The W, A, S and D keys.`,y=$localize`:0ac7f1fedebf3949fc40233a13c6eb4e0e0406644819033955395086119:The plus and minus keys grouped together or the E and C keys grouped together.`,C=$localize`:2b78dffe01cdcaf46976e26b031c327066fff0fa6264224730837738660:The shift key.`,O=$localize`:a302d6da0d4e760ae27cb11470852686dc8472914683038358223678995:A finger clicking the trackpad once.`,L=$localize`:ed595e7bcf6f65d4bfcb7302f8436fdc171e87a12262651993298779843:A finger clicking the trackpad twice.`,$=$localize`:23c69f01719b0c53dea3a4f38b7b6b20b1a68f354216705101587735156:A finger pressing for a long duration on the trackpad.`,q=$localize`:58f7f1cfc7494c3ad8af6f045a100569af8e763d3981109811663390815:Two fingers pressing the trackpad while moving vertically.`,x=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,k=$localize`:85b79c9064aed1ead31ace985f31aa1363f6bdaf7911416166208830577:Help`,A=$localize`:0ce04cf84ced2fc10b64d8d01c93254302fae7208819530610784848299:Close help modal`,R=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,Z=$localize`:b2ba3edf1e4f930372c8c0648a80cd8540824bb27927106883889636493:Click and drag or use one finger to change the viewing angle.`,te=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,se=$localize`:5f2421818b14ff6b2b6760f657072c9d1edf54c0875857706935138088:Hold the shift key and drag or use two fingers to move the model's position.`,ge=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,st=$localize`:943378a26adbb00b393fc72f7d8751a3d154419f2968417613352515367:Scroll up and down or pinch with two fingers to zoom in or out.`,We=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,ln=$localize`:1e2bffd4aecf789df7c101eec013ece36ac4d1b13307141625837320493:Click or tap an anatomic structure or label to learn more.`,Ie=$localize`:06525f75da53823cbe1725093bc86cd88ade8597728862926652618704:Mouse`,_r=$localize`:c3cee0bf85850fda5c38ee3e4d1bff10de4ce5c57193182677599035399:Hold left button to rotate`,zo=$localize`:23c0d0956b66d711cfe7df58ef6a7b4d07075b004504766784431323465:Hold right button to pan`,dr=$localize`:430665e380a10950da6951cf7f4002d0cc8dd1575037804585803260848:Single-click left button to select a structure`,pr=$localize`:45cebd73bba4b4553ff774400b20119e5a9d97ff2243293724382272862:Double-click left button to auto-focus on a structure`,yl=$localize`:7e25565e229d4feddc9c05e1738729a9aac57a287760284646478975781:Long-click to fly to a structure`,Jt=$localize`:50b412747cc527764294a1b903ec5c1d62844a111724029931462476938:Rotate with arrows`,Wo=$localize`:07614e55f8def77bf252040fc41cc9453e0fa34d8399776404178179481:Pan up (W), left (A), down (S), right(D)`,vl=$localize`:064d015bd99ad65866112d59a58eb66cd4ed3dcf2527063424056268537:Zoom out (-, C) and zoom in (+, E)`,bu=$localize`:6b1e5719efa1db70ea28a09765b11b1488dc3dcb3479840639285374289:Hold with any previous key to slow down motion`,yu=$localize`:3b12deb58592fad9559bee11b1c81a314f6c0dfd5453789791073353804:Trackpad`,vu=$localize`:03e5f4b8f37c3498d675cce895d5cbbe14f001dd8732399774338102812:Single-tap to auto-focus a structure`,Eu=$localize`:fa6d739684a57595169beedef230af0de5e835f8893674047997882971:Double-tap to select a structure`,Tu=$localize`:38d81be3a0506d3d76acab0eb9ba6d756e643b9e6955199594650294227:Long-press to fly to a structure`,Cu=$localize`:bbc241c56a687bd4b728277bbbfc5714fe71564d8600401187735507174:Scroll up and down to zoom`,Ou=$localize`:2d2c5215cbb8cb0c926c8d132668eb16275558b08973369245527156970:In-App`,wu=$localize`:74d17ea41b9374ceefcf8f7c763a1176cd96dbae491840984763060870: The plus symbol, which represents zooming in in the camera control menu. `,Mu=$localize`:e28ee80cd3a124e109793180dfd1f8d8067dcc6b6500061599200357251:Zoom in`,Iu=$localize`:402a1f359e7c008f0aef6b084fafaf2f49ce56d3399413764515891152: The minus symbol, which represents zooming out in the camera control menu. `,Au=$localize`:a3dfc58748f790fa096cf3c5fc331f90846e1772944767796496567082:Zoom out`,Pu=$localize`:c4f9fc3dd4d06c87f09dc68e8e0a3b38ae4948ff7289327967342552784: The map pin symbol, which resets the camera in the camera control menu. `,Nu=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,V=$localize`:5108bd6e5963ccd847b1a768fd214262ccfbc81d8038524584906192988: Arrows pointing in four directions, which represents panning in the camera control menu. `,j=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,[["viewHelp",""],k,A,R,Z,te,se,ge,st,We,ln,Ie,_r,zo,dr,pr,yl,Jt,Wo,vl,bu,yu,vu,Eu,Tu,Cu,Ou,wu,Mu,Iu,Au,Pu,Nu,V,j,["role","dialog","aria-labelledby","helpTitle",1,"view-help"],["id","helpTitle",1,"view-help__header"],["type","button",1,"view-help__close",3,"click"],["icon","times","aria-hidden","true"],[1,"sr-only"],[1,"view-help__inner"],["tabSize","medium","tabAlign","center","cdkFocusInitial","",3,"activeTab"],["label",n,"id","helpBasics","aria-controls","basicsPanel"],["role","tabpanel","aria-labelledby","helpBasics","tabindex","0","id","basicsPanel"],[1,"view-help__group"],[1,"view-help__item"],[1,"view-help__image"],["src","assets/images/widget/help-rotate.svg","alt",e],[1,"view-help__label"],["src","assets/images/widget/help-pan.svg","alt",o],["src","assets/images/widget/help-zoom.svg","alt",i],["src","assets/images/widget/help-learn.svg","alt",s],["label",r,"id","helpAll","aria-controls","allPanel"],["role","tabpanel","aria-labelledby","helpAll","tabindex","0","id","allPanel"],[1,"view-help__section-header"],["src","assets/images/widget/help-mouse-hold-left.svg","alt",a],["src","assets/images/widget/help-mouse-hold-right.svg","alt",l],["src","assets/images/widget/help-mouse-single-click-left.svg","alt",_],["src","assets/images/widget/help-mouse-double-click-left.svg","alt",d],["src","assets/images/widget/help-mouse-long-press-left.svg","alt",p],["src","assets/images/widget/help-keyboard-rotate.svg","alt",u],["src","assets/images/widget/help-keyboard-pan.svg","alt",g],["src","assets/images/widget/help-keyboard-zoom.svg","alt",y],["src","assets/images/widget/help-keyboard-slow-motion.svg","alt",C],["src","assets/images/widget/help-trackpad-single-tap.svg","alt",O],["src","assets/images/widget/help-trackpad-double-tap.svg","alt",L],["src","assets/images/widget/help-trackpad-long-press.svg","alt",$],["src","assets/images/widget/help-trackpad-scroll.svg","alt",q],["icon","plus","aria-hidden","true",1,"view-help__icon"],["icon","minus","aria-hidden","true",1,"view-help__icon"],["icon","location","aria-hidden","true",1,"view-help__icon"],["icon","arrows","aria-hidden","true",1,"view-help__icon"],["label",x,"id","helpShortcuts","aria-controls","shortcutsPanel"],["role","tabpanel","aria-labelledby","helpShortcuts","tabindex","0","id","shortcutsPanel"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",35,0)(2,"h2",36),t.pXf(3,1),t.k0s(),t.j41(4,"button",37),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleCloseClick())}),t.nrm(5,"app-icon",38),t.j41(6,"span",39),t.pXf(7,2),t.k0s()(),t.j41(8,"div",40)(9,"app-tabs",41)(10,"app-tab",42)(11,"div",43)(12,"ul",44)(13,"li",45)(14,"div",46),t.nrm(15,"img",47),t.k0s(),t.j41(16,"div",48),t.pXf(17,3),t.k0s(),t.qex(18),t.pXf(19,4),t.bVm(),t.k0s(),t.j41(20,"li",45)(21,"div",46),t.nrm(22,"img",49),t.k0s(),t.j41(23,"div",48),t.pXf(24,5),t.k0s(),t.qex(25),t.pXf(26,6),t.bVm(),t.k0s(),t.j41(27,"li",45)(28,"div",46),t.nrm(29,"img",50),t.k0s(),t.j41(30,"div",48),t.pXf(31,7),t.k0s(),t.qex(32),t.pXf(33,8),t.bVm(),t.k0s(),t.j41(34,"li",45)(35,"div",46),t.nrm(36,"img",51),t.k0s(),t.j41(37,"div",48),t.pXf(38,9),t.k0s(),t.qex(39),t.pXf(40,10),t.bVm(),t.k0s()()()(),t.j41(41,"app-tab",52)(42,"div",53)(43,"h3",54),t.pXf(44,11),t.k0s(),t.j41(45,"ul",44)(46,"li",45)(47,"div",46),t.nrm(48,"img",55),t.k0s(),t.qex(49),t.pXf(50,12),t.bVm(),t.k0s(),t.j41(51,"li",45)(52,"div",46),t.nrm(53,"img",56),t.k0s(),t.qex(54),t.pXf(55,13),t.bVm(),t.k0s(),t.j41(56,"li",45)(57,"div",46),t.nrm(58,"img",57),t.k0s(),t.qex(59),t.pXf(60,14),t.bVm(),t.k0s(),t.j41(61,"li",45)(62,"div",46),t.nrm(63,"img",58),t.k0s(),t.qex(64),t.pXf(65,15),t.bVm(),t.k0s(),t.j41(66,"li",45)(67,"div",46),t.nrm(68,"img",59),t.k0s(),t.qex(69),t.pXf(70,16),t.bVm(),t.k0s()(),t.j41(71,"h3",54),t.EFF(72,"Keyboard"),t.k0s(),t.j41(73,"ul",44)(74,"li",45)(75,"div",46),t.nrm(76,"img",60),t.k0s(),t.qex(77),t.pXf(78,17),t.bVm(),t.k0s(),t.j41(79,"li",45)(80,"div",46),t.nrm(81,"img",61),t.k0s(),t.qex(82),t.pXf(83,18),t.bVm(),t.k0s(),t.j41(84,"li",45)(85,"div",46),t.nrm(86,"img",62),t.k0s(),t.qex(87),t.pXf(88,19),t.bVm(),t.k0s(),t.j41(89,"li",45)(90,"div",46),t.nrm(91,"img",63),t.k0s(),t.qex(92),t.pXf(93,20),t.bVm(),t.k0s()(),t.j41(94,"h3",54),t.pXf(95,21),t.k0s(),t.j41(96,"ul",44)(97,"li",45)(98,"div",46),t.nrm(99,"img",64),t.k0s(),t.qex(100),t.pXf(101,22),t.bVm(),t.k0s(),t.j41(102,"li",45)(103,"div",46),t.nrm(104,"img",65),t.k0s(),t.qex(105),t.pXf(106,23),t.bVm(),t.k0s(),t.j41(107,"li",45)(108,"div",46),t.nrm(109,"img",66),t.k0s(),t.qex(110),t.pXf(111,24),t.bVm(),t.k0s(),t.j41(112,"li",45)(113,"div",46),t.nrm(114,"img",67),t.k0s(),t.qex(115),t.pXf(116,25),t.bVm(),t.k0s()(),t.j41(117,"h3",54),t.pXf(118,26),t.k0s(),t.j41(119,"ul",44)(120,"li",45),t.nrm(121,"app-icon",68),t.j41(122,"span",39),t.pXf(123,27),t.k0s(),t.qex(124),t.pXf(125,28),t.bVm(),t.k0s(),t.j41(126,"li",45),t.nrm(127,"app-icon",69),t.j41(128,"span",39),t.pXf(129,29),t.k0s(),t.qex(130),t.pXf(131,30),t.bVm(),t.k0s(),t.j41(132,"li",45),t.nrm(133,"app-icon",70),t.j41(134,"span",39),t.pXf(135,31),t.k0s(),t.qex(136),t.pXf(137,32),t.bVm(),t.k0s(),t.j41(138,"li",45),t.nrm(139,"app-icon",71),t.j41(140,"span",39),t.pXf(141,33),t.k0s(),t.qex(142),t.pXf(143,34),t.bVm(),t.k0s()()()(),t.j41(144,"app-tab",72)(145,"div",73),t.nrm(146,"app-view-shortcuts"),t.k0s()()()()()}2&e&&(t.R7$(9),t.Y8G("activeTab",o.activeTab))},dependencies:[qe,GE.j,$E.O,c2],styles:[".view-help{background-color:#101823e6;color:#fff;display:flex;align-items:center;flex-direction:column;position:fixed;top:0;left:0;right:0;z-index:10000;height:100vh;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:auto}.view-help__inner{width:100%;max-width:1140px;height:99vh;height:calc(var(--vh, 1vh) * 99);padding:32px;position:relative}.view-help__close{color:#fff;width:40px;height:40px;display:flex;align-items:center;justify-content:center;position:fixed;right:8px;top:8px;z-index:10;border:none;background:none}.view-help__header{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__section-header{font-size:.75rem;line-height:1rem;border-bottom:1px solid rgba(255,255,255,.3);font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__label{font-size:.875rem;line-height:1.25rem;font-weight:600;margin-bottom:12px}.view-help__group{display:flex;justify-content:space-around;flex-wrap:wrap}.view-help__item{font-size:.75rem;line-height:1rem;display:flex;flex-flow:column;text-align:center;padding:20px;flex:0 1 180px}.view-help__image{justify-content:center;margin-bottom:16px;width:160px;height:100px}.view-help__icon{font-size:24px;margin-bottom:16px}\n"],encapsulation:2,changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(P.getCanTouch),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Bm.prototype,"canTouch$",void 0);var zr,Sp=function(n){return n.DiscoveredChapterNav="Discovered Chapter Nav",n}(Sp||{}),Ja=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ii=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class FE{}const BE={audioMuted:!0,autoplayAudio:!1};let Xi=((zr=class{static getAudioMuted(e){return e.audioMuted}static getAutoplayAudio(e){return e.autoplayAudio}setAudioMuted(e,o){const i=re.jM(e.getState(),s=>{s.audioMuted=o.mute});e.setState(i)}setAutoplayAudio(e,o){const i=re.jM(e.getState(),s=>{s.autoplayAudio=o.autoplay});e.setState(i)}resetAudio(e,o){e.setState(BE)}}).\u0275fac=function(e){return new(e||zr)},zr.\u0275prov=t.jDH({token:zr,factory:zr.\u0275fac}),zr);Ja([(0,c.rc)(Ei.SetAudioMuted),Ii("design:type",Function),Ii("design:paramtypes",[Object,Ei.SetAudioMuted]),Ii("design:returntype",void 0)],Xi.prototype,"setAudioMuted",null),Ja([(0,c.rc)(Ei.SetAutoplayAudio),Ii("design:type",Function),Ii("design:paramtypes",[Object,Ei.SetAutoplayAudio]),Ii("design:returntype",void 0)],Xi.prototype,"setAutoplayAudio",null),Ja([(0,c.rc)(Ei.ResetAudio),Ii("design:type",Function),Ii("design:paramtypes",[Object,Ei.ResetAudio]),Ii("design:returntype",void 0)],Xi.prototype,"resetAudio",null),Ja([(0,c.MD)(),Ii("design:type",Function),Ii("design:paramtypes",[FE]),Ii("design:returntype",void 0)],Xi,"getAudioMuted",null),Ja([(0,c.MD)(),Ii("design:type",Function),Ii("design:paramtypes",[FE]),Ii("design:returntype",void 0)],Xi,"getAutoplayAudio",null),Xi=Ja([(0,c.Uw)({name:"media",defaults:BE})],Xi);let zt=(()=>{var n;class e{constructor(i,s,r,a,l,_,d,p,u){this.dialog=i,this.store=s,this.location=r,this.transitionService=a,this.mediaService=l,this.sceneService=_,this.viewUIService=d,this.vendorAnalyticsService=p,this.liveAnnouncer=u}initStory(i,s,r){const a="preview"===i;this.store.dispatch(new Oh(i,s,a)),this.store.dispatch(new nd(i,s,!0));const l=this.store.select(U.getReady),_=this.store.select(Pe.getIncomingStoryInfo);(0,Tt.z)([l,_]).pipe((0,X.p)(([d,p])=>d&&!!p.id),(0,Vt.s)(1)).subscribe(()=>{this.store.dispatch(new eo),this.store.dispatch(new td(i,s,r,a))})}nextChapter(i){const s=this.store.selectSnapshot(E.getSelectedChapterIndex),r=this.store.selectSnapshot(E.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Sp.DiscoveredChapterNav,{source:i,breakpoint:this.store.selectSnapshot(mn.getHorizontalBreakpointLabel)});const a=r[s+1];a&&this.selectChapter(a)}previousChapter(i){const s=this.store.selectSnapshot(E.getSelectedChapterIndex),r=this.store.selectSnapshot(E.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Sp.DiscoveredChapterNav,{source:i,breakpoint:this.store.selectSnapshot(mn.getHorizontalBreakpointLabel)});const a=r[s-1];a&&this.selectChapter(a)}firstChapter(i){const s=this.store.selectSnapshot(E.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(i,{source:i,breakpoint:this.store.selectSnapshot(mn.getHorizontalBreakpointLabel)});const r=s[0];r&&this.selectChapter(r)}selectChapter(i){var s=this;return(0,J.A)(function*(){if(!s.store.selectSnapshot(G.getQuizModeActive)){const l=s.store.selectSnapshot(E.getSelectedChapterId),_=i.id,d=s.store.selectSnapshot(E.getStoryChapters),p=s.transitionService.searchChapterTransitions(l,_,d);s.vendorAnalyticsService.trackOncePerSession(Sp.DiscoveredChapterNav,{source:"Chapter List",breakpoint:s.store.selectSnapshot(mn.getHorizontalBreakpointLabel)}),p&&(yield s.chapterTransition(p)),s.store.dispatch([new Fu(i.id),new eo(i)])}const a=document.getElementById("chapter-title");a&&setTimeout(()=>a.querySelector("button").focus(),200)})()}chapterTransition(i){return new Promise(s=>{i.camera&&this.store.dispatch(new di(i.camera,!0,i.duration)),i.fadeColor&&this.store.dispatch(new hb(i.fadeColor,i.duration)),setTimeout(()=>{s(!0)},1e3*i.duration)})}hideSelectedStructures(){const i=this.store.selectSnapshot(Re.getCheckedNodeIds);this.store.dispatch(new kn(!1,i))}selectTool(i){this.store.selectSnapshot(G.getQuizModeActive)&&i===Ct.Select&&(i=Ct.Quiz),this.store.dispatch(new hr(i))}toggleAutoplay(i){i=i??!this.store.selectSnapshot(P.getAutoplay),this.store.dispatch(new D.SetAutoplay(i))}toggleAnimation(){const i=this.store.selectSnapshot(U.getAnimationPlaying);this.store.dispatch(new Yo(!i))}toggleMedia(i){const s=this.store.selectSnapshot(ue.getUI);s.media.status=(i=i??s.media.status!==Ve.Show)?Ve.Show:Ve.Collapse,this.store.dispatch(new Tn.SetUI(s))}toggleDrawer(i,s=!1){const r=this.store.selectSnapshot(ue.getUI);null==i&&(i=r.drawer.status==Ve.Hide?Ve.Show:Ve.Hide),r.drawer.status=i,s&&(r.drawer.userStatusPreference=r.drawer.status),this.store.dispatch(new Tn.SetUI(r))}toggleColumn(i){const s=this.store.selectSnapshot(ue.getUI);null==i&&(i=s.column.status!==Ve.Show),s.column.status=i?Ve.Show:Ve.Collapse,s.column.userStatusPreference=s.column.status,this.store.dispatch(new Tn.SetUI(s))}togglePresentation(){this.store.selectSnapshot(P.getPresentationActive)?this.stopPresentation():this.startPresentation()}startPresentation(){this.store.dispatch(new D.TogglePresentation(!0))}stopPresentation(){this.store.dispatch(new D.TogglePresentation(!1))}toggleHelp(i=Ho.Basics){0===this.dialog.openDialogs.length&&this.dialog.open(Bm,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{tab:i}})}toggleInteract(i){this.store.dispatch(new D.ToggleWindow(en.Interact,i))}toggleOnDemand(i){this.store.dispatch(new D.SetOnDemand(i)),this.store.dispatch(new D.ToggleWindow(en.OnDemand,i))}togglePlaythrough(i,s){this.store.dispatch(new D.SetPlaythroughEnabled(i)),(0,m.isNil)(s)||this.store.dispatch(new D.SetForceAudio(s))}toggleTutorial(i){this.store.dispatch(new D.ToggleWindow(en.Tutorial,i)),i&&this.store.dispatch(new D.StartTutorial(!0))}toggleWhiteboard(i){this.store.dispatch(new D.ToggleWindow(en.Whiteboard,i)),i&&this.store.dispatch(new D.SetWhiteboardEnabled(!0))}showLabels(i){const s=this.store.selectSnapshot(ue.getUI);i=(0,m.isNil)(i)?!s.labels.shown:i,s.labels.shown=i,this.store.dispatch(new Tn.SetUI(s))}toggleLabels(i){this.store.dispatch(new Sa(i))}togglePan(){const i="pan"===this.store.selectSnapshot(vt.getPanMode)?"rotate":"pan";this.store.dispatch(new fd(i))}toggleSearch(i=ui.Tree,s){const r=this.store.selectSnapshot(ue.getUI);r.search.status=(s=s??r.search.status!==Ve.Show)?Ve.Show:Ve.Collapse,s&&(r.visibilityLayers.status=Ve.Collapse,r.nodeInfo.status=Ve.Hide),this.store.dispatch(new D.SetSearchDisplayMode(i)),this.store.dispatch(new Tn.SetUI(r))}toggleLayers(i){const s=this.store.selectSnapshot(P.getLayout);this.viewUIService.getViewLayout(s)===Bn.Drawer?this.toggleLayersDrawer(i):this.toggleLayersColumn(i)}toggleLayersColumn(i){const s=this.store.selectSnapshot(ue.getUI);s.visibilityLayers.status=(i=i??s.visibilityLayers.status!==Ve.Show)?Ve.Show:Ve.Collapse,i&&(s.search.status=Ve.Collapse,s.nodeInfo.status=Ve.Hide),this.store.dispatch(new Tn.SetUI(s))}toggleLayersDrawer(i){const s=this.store.selectSnapshot(ue.getVisible(h.Drawer)),r=(i=i??!s)?Ve.Show:Ve.Hide;this.setContentMode(lt.VisibilityLayers),this.toggleDrawer(r)}toggleNodeInfo(i){this.setContentMode(i?lt.NodeInfo:null)}toggleLabelInfo(i){const s=this.store.selectSnapshot(ue.getVisible(h.Drawer)),r=this.store.selectSnapshot(P.getContentMode);i=(0,m.isNull)(i)?!s:i;const a=this.store.selectSnapshot(ye.getSelectedLabel),l=this.store.selectSnapshot(ue.getVisible(h.LabelList)),_=s&&l;if(i&&a)this.toggleDrawer(_&&r===lt.ChapterInfo||a?.description||a.contentBlocks?.length>0?Ve.Show:Ve.Collapse),_||this.setContentMode(lt.LabelInfo);else{if(_&&r===lt.ChapterInfo)return;this.toggleDrawer(Ve.Hide)}}playChapterAudio(i=!1){const s=this.store.selectSnapshot(P.getViewLanguage),r=this.store.selectSnapshot(E.getSelectedChapter);this.mediaService.stopAllAudio(),this.mediaService.getChapterAudioPlayer(r,s,i).then(a=>{if((this.store.selectSnapshot(Xi.getAutoplayAudio)||i)&&this.store.selectSnapshot(E.getSelectedChapterId)===r.id){const d=this.store.selectSnapshot(Xi.getAudioMuted);this.mediaService.playAudio(r.id,d)}})}setContentMode(i){i||(i=lt.ChapterInfo),this.store.dispatch(new D.SetContentMode(i))}delegateNodeClick(i,s){if(this.clearSelectedLabel(),i||s.srcEvent.shiftKey)if(s.srcEvent.shiftKey||this.store.selectSnapshot(P.getMultiPickModeEnabled))this.checkNode(i);else switch(this.store.selectSnapshot(U.getActiveTool)){case Ct.Hide:this.hideNode(i);break;case Ct.Select:this.selectNode(i);break;case Ct.Isolate:this.isolateNode(i);break;case Ct.Fade:this.fadeNode(i)}else this.clearSelectedNodes()}clearSelectedLabel(){this.store.dispatch(new is)}clearSelectedNodes(){this.store.dispatch(new Sr),this.store.dispatch(new un(!1))}clearFadedNodes(){const i=this.store.selectSnapshot(E.getSelectedChapterId);this.store.dispatch(new Ut.UndoAll(i))}checkNode(i,s){void 0!==i&&(null==s&&(s=this.store.selectSnapshot(Re.getNodes)[i.id].checked),this.store.dispatch(new un(!s,[i.id])),this.store.dispatch(new Sr(i.id)))}fadeNode(i){this.store.dispatch(new Mo(Es,[i.id]))}isolateNode(i){this.store.dispatch(new kn(!1)),this.store.dispatch(new kn(!0,[i.id]))}selectNode(i){const s=!this.store.selectSnapshot(Re.getNodes)[i.id].checked;this.store.dispatch(new un(!1)),s&&(this.store.dispatch(new un(!0,[i.id])),this.store.dispatch(new Sr(i.id))),this.store.dispatch(new ba(i));const r=this.store.selectSnapshot(P.getNodeInfoFallback),a=this.store.selectSnapshot(P.getViewLanguage);this.store.dispatch(new rg(i,r,a))}hideNode(i){this.store.dispatch(new kn(!1,[i.id])),this.store.dispatch(new un(!1))}selectLabel(i,s=!1){const{objectId:r,states:a}=i;this.store.dispatch(new is(i)),s&&r&&0===a.length&&this.store.dispatch(new To(r,!0))}applyChapterCamera(i){this.store.selectSnapshot(vt.getChapterCameraEnabled)&&this.store.dispatch(new di(i.camera.location,i.camera.action===La.FlyTo,void 0,i.camera.rotationCenter))}applyChapterScenegraph(i){const s=this.sceneService.createViewGraph({availableObjects:i.availableObjects});this.store.dispatch(new ys(s)),this.store.dispatch(new Oa(i.id))}playChapterFromStart(){this.store.dispatch(new fb)}resetCamera(){const s=this.store.selectSnapshot(E.getSelectedChapter)?.camera?.location;(0,m.isNil)(s)||this.store.dispatch(new di(s))}resetChapter(){this.resetCamera();const i=this.store.selectSnapshot(E.getSelectedChapterId);this.store.dispatch(new Ut.UndoAll(i)).subscribe(()=>{this.liveAnnouncer.announce("reset complete")}),this.store.dispatch(new un(!1)),this.store.dispatch(new ns)}resetUI(){const i=this.store.selectSnapshot(ue.getUI);this.viewUIService.isUIHidden()?Object.keys(i).forEach(s=>{i[s].status=Ve.Hide}):(this.store.selectSnapshot(G.getQuizModeActive)||(i.drawer.status=Ve.Hide),Object.keys(i).forEach(r=>{i[r].userStatusPreference?i[r].status=i[r].userStatusPreference:r!==h.Drawer&&(i[r].status=Ve.Show)}),i.search.status=Ve.Collapse,i.visibilityLayers.status=Ve.Collapse,i.nodeInfo.status=Ve.Hide,i.media.status=Ve.Collapse,i.quizPrompt.status=this.store.selectSnapshot(G.hasQuiz)?Ve.Show:Ve.Hide),this.store.dispatch(new Tn.SetUI(i))}resetContentMode(){const i=this.store.selectSnapshot(G.getQuizModeActive),s=this.store.selectSnapshot(E.getChapterCount),r=this.store.selectSnapshot(P.getLayout),a=this.viewUIService.getViewLayout(r),l={info:lt.ChapterInfo,chapters:lt.Chapters},_=this.store.selectSnapshot(P.getPreferredColumn),d=this.store.selectSnapshot(P.getStartingColumn);let p=_||d;1===s&&"chapters"===p&&(p="info"),a===Bn.Drawer&&(p="info"),this.store.dispatch(new D.SetContentMode(i?lt.Quiz:l[p]))}undo(){this.store.dispatch(new Ut.Undo(this.store.selectSnapshot(E.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("undo complete")})}redo(){this.store.dispatch(new Ut.Redo(this.store.selectSnapshot(E.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("redo complete")})}toggleTools(i){const s=this.store.selectSnapshot(ue.getUI);s.tools.status=(i=i??s.tools.status!==Ve.Show)?Ve.Show:Ve.Collapse,this.store.dispatch(new Tn.SetUI(s))}closeToolbar(){const i=this.store.selectSnapshot(ue.getUI);i.media.status=Ve.Hide,i.tools.status=Ve.Hide,i.visibilityLayers.status=Ve.Hide,this.selectTool(Ct.Select),this.store.dispatch(new Tn.SetUI(i))}normalizeQueryParams(i){const s={...i};return{id:ah(s),type:Jy(s),lang:i.lang}}sanitizeRouteId(i){return i=i.replace(/\.json$/,""),this.location.replaceState("view",`?id=${i}`),i}openInNewTab(){const i=window.document.location.href;window.open(i)}getComputedTransform(i){const a=getComputedStyle(i).transform.replace("matrix3d","").replace("matrix","").replace("(","").replace(")","").split(",").map(d=>d.trim()).map(d=>parseInt(d,10)),l=16===a.length?a[12]:a[4],_=16===a.length?a[13]:a[5];return Number.isNaN(l)||Number.isNaN(_)?null:{x:l,y:_}}inferDrawerMode(i){return Ql.Content}setUI(i){let s=new Ka;s=Br(s,i.quizUIConfig),s=Br(s,i.apiUIConfig),s=Br(s,i.urlUIConfig),s=Br(s,i.chapterUIConfig),s=Br(s,i.baseUIConfig);const a=xE(this.store.selectSnapshot(ue.getUI),s);this.store.dispatch(new Tn.SetUI(a))}setViewLanguage(i="en"){this.store.dispatch(new D.SetViewLanguage(i))}setViewLogos(i){this.store.dispatch(new Ud(i))}setHeaderLogos(i){this.store.dispatch(new By(i))}setAnatomyDescriptionFallback(i){this.store.dispatch(new D.SetNodeInfoConfig(i))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(pt.bZ),t.KVO(c.il),t.KVO(b.aZ),t.KVO(SI),t.KVO(Di),t.KVO(cn),t.KVO(hp),t.KVO(Qn),t.KVO(vi.Ai))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),u2=(()=>{var n;class e{constructor(i){this.viewService=i}initialize(){window.BDGlobalActions={toggleTutorial:i=>this.viewService.toggleTutorial(i)}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(zt))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var uc,bp=function(n){return n.APIKey="apikey",n.UserAnalyticId="uaid",n.ProductKey="productkey",n.UserId="userid",n}(bp||{});class zm{constructor(e,o,i,s,r,a){this.store=e,this.router=o,this.vendorAnalyticsService=i,this.globalActionsService=s,this.engineService=r,this.productService=a,this.title="Biodigital Human",this.ngUnsubscribe=new oe.B}ngOnInit(){this.initVendorAnalytics(),this.initPageAnalytics(),this.initInputObserver(),this.initGPUAnalytics(),this.initStats(),this.globalActionsService.initialize()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initVendorAnalytics(){this.vendorAnalyticsService.appendScripts(),this.vendorAnalyticsService.initialize({},{})}initInputObserver(){this.inputEnabled$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.store.dispatch(new D.SetInputEnabled(e))})}initPageAnalytics(){this.router.events.pipe((0,X.p)(e=>e instanceof ut.wF),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{})}initGPUAnalytics(){const{dk:e,uaid:o,"app-productkey":i}=this.store.selectSnapshot(Qt.getWidgetUrlConfig);let a,l;e?(a=bp.APIKey,l=e):o?(a=bp.UserAnalyticId,l=o):i&&(a=bp.ProductKey,l=i),this.engineService.initAnalytics(this.productService.productType,i||this.productService.productKey,a,l)}initStats(){const e=new URLSearchParams(window.location.search),o="true"===e.get("ui-stats");this.store.dispatch(new _g(o,!0));const i=e.get("engine-context");("webgl"===i||"webgl2"===i)&&this.store.dispatch(new cg(i))}}(uc=zm).\u0275fac=function(e){return new(e||uc)(t.rXU(c.il),t.rXU(ut.Ix),t.rXU(Qn),t.rXU(u2),t.rXU(Lt),t.rXU(Si))},uc.\u0275cmp=t.VBU({type:uc,selectors:[["app-root"]],decls:1,vars:0,template:function(e,o){1&e&&t.nrm(0,"router-outlet")},dependencies:[ut.n3],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(Qt.getInputEnabled),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],zm.prototype,"inputEnabled$",void 0);var m2=S(1027),Pn=S(7996),ls=S(9065),Wr=S(1670),ai=S(3828),f2=S(8465),zE=function(n){return n[n.Main=0]="Main",n[n.Media=1]="Media",n[n.Tools=2]="Tools",n[n.Whiteboard=3]="Whiteboard",n[n.VisibilityLayers=4]="VisibilityLayers",n[n.Empty=5]="Empty",n}(zE||{}),yp=function(n){return n.All="all",n.iOS="ios",n.Android="android",n}(yp||{}),Ce=function(n){return n.AnnotationsCreated="annotations.created",n.AnnotationsDestroyed="annotations.destroyed",n.AnnotationsHidden="annotations.hidden",n.AnnotationsShown="annotations.shown",n.QuizEntered="quiz.entered",n.QuizExited="quiz.exited",n.QuizQuestionLoaded="quiz.questionLoaded",n.QuizAnswerSelected="quiz.answerSelected",n.QuizAnswerSubmitted="quiz.answerSubmitted",n.QuizCompleted="quiz.completed",n.LabelsCreated="labels.created",n.LabelsUpdated="labels.updated",n.LabelsMoved="labels.moved",n.LabelsDestroyed="labels.destroyed",n.LabelsChapterInfo="labels.chapterInfo",n.LabelsShown="labels.shown",n.LabelsHidden="labels.hidden",n.LabelsEnabled="labels.enabled",n.LabelsDisabled="labels.disabled",n.LabelsEntered="labels.entered",n.LabelsLeft="labels.left",n.LabelsPicked="labels.picked",n.HotspotsDisplayUpdated="hotspots.displayUpdated",n.HotspotsEntered="hotspots.entered",n.HotspotsLeft="hotspots.left",n.HotspotsPicked="hotspots.picked",n.HotspotsPositionUpdated="hotspots.positionUpdated",n.NativeDeleteData="native.deleteData",n.NativeUpgrade="native.upgrade",n.NativeRestore="native.restore",n.NativeShare="native.share",n.NativeGoogleSignUp="native.googleSignUp",n.NativeDebugMessage="native.debugMessage",n.NativeSetSdkOffline="native.setSdkOffline",n.NativeSetBaseDirectory="native.setBaseDirectory",n.WhiteboardDrawingStarted="whiteboard.drawingStarted",n.WhiteboardDrawingFinished="whiteboard.drawingFinished",n.WhiteboardModeUpdated="whiteboard.modeUpdated",n.UIUpdated="ui.updated",n.UIWindowUpdated="ui.windowUpdated",n}(Ce||{});let mo=(()=>{var n;class e extends HS{}return(n=e).\u0275fac=(()=>{let o;return function(s){return(o||(o=t.xGo(n)))(s||n)}})(),n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Za=(()=>{var n;class e{constructor(i,s,r){this.store=i,this.viewService=s,this.applicationEventService=r}startQuiz(){this.viewService.toggleColumn(!0),this.viewService.toggleLabels(!1),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Rl),this.viewService.setContentMode(lt.Quiz),this.store.dispatch(new Te.SetQuizActive(!0));const i=this.store.selectSnapshot(G.getAllQuestions)[0].id;this.store.dispatch(new Te.SetActiveQuestion(i))}resetQuiz(){this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Rl),this.store.dispatch(new Te.SetQuizActive(!1)),this.store.dispatch(new Te.SetActiveSubmission(void 0)),this.store.dispatch(new Te.ClearSubmissions),this.store.dispatch(new Te.SetQuizLifecycle(_o.Question))}exitQuiz(){this.resetQuiz(),this.viewService.setContentMode(lt.ChapterInfo),this.viewService.toggleLabels(!0),this.viewService.toggleDrawer(Ve.Hide),setTimeout(()=>{this.store.dispatch(new di(this.store.selectSnapshot(E.getChapterCamera),!1))})}submitQuestion(i,s){const r=this.store.selectSnapshot(G.getAllQuestions).find(d=>d.id===i),{launchMode:a,quizSettings:l}=this.store.selectSnapshot(G);this.store.dispatch(new Te.SubmitQuestionAnswer({questionId:r.id,answer:s})),this.store.dispatch(new Te.SetActiveSubmission({questionId:r.id,answer:s})),this.applicationEventService.fireEvent(Ce.QuizAnswerSubmitted,{questionId:r.id,answer:s}),a===$g.Learning&&r.type!==ot.Instructions&&!1!==l.showExplanation?this.store.dispatch(new Te.SetQuizLifecycle(_o.Explanation)):this.nextQuestion()}nextQuestion(){this.store.dispatch(new Te.SetActiveSubmission(void 0)),this.store.selectSnapshot(G.hasQuestionRemaining)?(this.store.dispatch(new Te.SetQuizLifecycle(_o.Question)),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Te.NextQuestion)):(this.store.dispatch(new Te.SetQuizLifecycle(_o.Review)),this.applicationEventService.fireEvent(Ce.QuizCompleted,!0))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(zt),t.KVO(mo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function S2(n){return new f.c(e=>{const o=new ResizeObserver(i=>{e.next(i)});return o.observe(n),function(){o.unobserve(n)}})}let XE=(()=>{var n;class e{constructor(i,s,r){this.mediaService=i,this.animationService=s,this.store=r,this.countdownStatus=new He.t("inactive"),this.countdownChanged=new oe.B,this.countdownComplete=new oe.B,this.audioObserver=new f.c,this.audioSubject=new He.t({current:0,duration:0,complete:!1}),this.animationSubject=new He.t({current:0,duration:0,complete:!1}),this.readingSubject=new He.t({current:0,duration:0,complete:!1}),this.minimumSubject=new He.t({current:0,duration:0,complete:!1})}startChapterTimers(i,s=!1){var r=this;return(0,J.A)(function*(){const l={current:0,duration:0,complete:!1},_=r.store.selectSnapshot(P.getViewLanguage);if(r.clearChapterTimers(),r.clearCountdown(),(s||r.mediaService.chapterHasAudio(i,_))&&(r.audioRef=yield r.mediaService.getChapterAudioPlayer(i,_,s)),r.audioRef){const p=yield r.mediaService.getDuration(r.audioRef);r.audioSubject.next({current:0,duration:p,complete:!1}),r.audioRef.on("end",()=>{r.audioSubject.next({...r.audioSubject.value,complete:!0})}),r.audioRef.on("stop",()=>{r.audioSubject.next({...r.audioSubject.value,complete:!1})}),r.audioRef.on("play",()=>{r.audioSubject.next({current:r.audioRef?.seek(),duration:p,complete:!1})})}else r.audioSubject.next({current:0,duration:0,complete:!0});r.animationSubject.next({current:r.animationService.getTime(),duration:r.animationService.getChapterDuration(),complete:!1}),r.readingSubject.next({current:0,duration:r.calculateChapterReadingTime(i),complete:!1});const{minimum:d}=r.store.selectSnapshot(P.getPlaythroughSettings);r.minimumSubject.next({current:0,duration:d,complete:!1}),r.interval=setInterval(()=>{r.audioSubject.next(r.audioRef?{...r.audioSubject.value,current:r.audioRef?.seek()}:{...l,complete:!0}),r.animationService.isChapterAnimated(i)?r.animationService.isChapterLooped(i)?r.animationSubject.next({...r.animationSubject.value,current:r.animationSubject.value.current+.05,complete:r.animationSubject.value.current>=r.animationSubject.value.duration}):r.animationSubject.next({...r.animationSubject.value,current:r.animationService.getTime(),complete:r.animationService.hasChapterFinished()}):r.animationSubject.next({...l,complete:!0}),r.readingSubject.next({...r.readingSubject.value,current:r.readingSubject.value.current+50,complete:r.readingSubject.value.current>=r.readingSubject.value.duration}),r.minimumSubject.next({...r.minimumSubject.value,current:r.minimumSubject.value.current+50,complete:r.minimumSubject.value.current>=r.minimumSubject.value.duration})},50)})()}clearChapterTimers(){clearInterval(this.interval),this.audioRef=null;const i={current:0,duration:0,complete:!1};this.animationSubject.next({...i}),this.audioSubject.next({...i}),this.readingSubject.next({...i}),this.minimumSubject.next({...i})}calculateMaximumRemainingTime(){return[{...this.audioSubject.getValue(),type:"audio"},{...this.animationSubject.getValue(),type:"animation"},{...this.readingSubject.getValue(),type:"reading"},{...this.minimumSubject.getValue(),type:"minimum"}].reduce((i,s)=>(s.complete||(("audio"===s.type||"animation"===s.type)&&(s={...s,current:1e3*s.current,duration:1e3*s.duration}),s.duration-s.current>i.duration-i.current&&(i={...s})),i),{complete:!0,current:0,duration:0})}calculateChapterReadingTime(i){return 1e3*Math.floor((i.description??"").split(" ").length/200*60)}preloadAudio(i,s=!1){var r=this;return(0,J.A)(function*(){const a=r.store.selectSnapshot(P.getViewLanguage);for(const l of i)yield r.mediaService.getChapterAudioPlayer(l,a,s)})()}startCountdown(){this.clearCountdown(),this.countdownStatus.next("active");let{countdown:i}=this.store.selectSnapshot(P.getPlaythroughSettings);this.countdownInterval=setInterval(()=>{i-=50,this.countdownChanged.next(i),i<=0&&(this.countdownComplete.next(),this.clearCountdown())},50)}delayCountdown(){const{countdownDelay:i}=this.store.selectSnapshot(P.getPlaythroughSettings);this.countdownInterval&&(this.clearCountdown(),clearTimeout(this.countdownDelay),this.countdownStatus.next("delay"),this.countdownDelay=setTimeout(()=>{this.startCountdown()},i))}clearCountdown(){const{countdown:i}=this.store.selectSnapshot(P.getPlaythroughSettings);clearInterval(this.countdownInterval),clearTimeout(this.countdownDelay),this.countdownChanged.next(i),this.countdownStatus.next("inactive")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Di),t.KVO(bi),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var HE=S(2529);const y2=["viewButton"],v2=["app-view-button",""],E2=["*"],T2=(n,e,o,i,s,r,a,l)=>({"view-button__toggle--direction-up":n,"view-button__toggle--direction-down":e,"view-button__toggle--direction-left":o,"view-button__toggle--direction-right":i,"view-button__toggle--position-top":s,"view-button__toggle--position-bottom":r,"view-button__toggle--position-left":a,"view-button__toggle--position-right":l});function C2(n,e){if(1&n&&(t.j41(0,"div",4),t.nrm(1,"app-icon",5),t.k0s()),2&n){const o=t.XpG();t.Y8G("ngClass",t.lV(1,T2,"up"===o.buttonToggleDirection,"down"===o.buttonToggleDirection,"left"===o.buttonToggleDirection,"right"===o.buttonToggleDirection,"top"===o.buttonTogglePosition,"bottom"===o.buttonTogglePosition,"left"===o.buttonTogglePosition,"right"===o.buttonTogglePosition))}}var vp=function(n){return n.Rounded="rounded",n.Square="square",n.Narrow="narrow",n.Squat="squat",n}(vp||{}),Xr=function(n){return n.Default="default",n.Fill="fill",n.Small="small",n}(Xr||{});const O2={transparent:{background:"transparent",color:"inherit",border:"transparent",borderWidth:"0"},"transparent-fill":{background:"transparent",color:"#374A68",border:"transparent"},"blue-fill":{background:"#2d72dc",color:"#ffffff",border:"transparent",focusBorder:"#1C2A3F"},"red-fill":{background:"#f44336",color:"#ffffff",border:"transparent"},"dark-gray-fill":{background:"#283853",color:"#ffffff",border:"transparent",disabledColor:"#374a68"},"light-gray-fill":{background:"#d7e0ea",color:"#000000",border:"trasparent"},"white-outline":{background:"transparent",color:"#ffffff",border:"#ffffff",borderWidth:"1px"},white:{background:"transparent",color:"#ffffff",border:"transparent"},"light-gray-outline":{background:"transparent",color:"#000000",border:"#d7e0ea",borderWidth:"1px"}};let xt=(()=>{var n;class e{constructor(i,s){this.tabindex=i,this.hostElement=s,this.selected=!1,this.thin=!1,this.short=!1,this.buttonSize=Xr.Default,this.buttonShape=vp.Square,this.addFocusStyle=!1,this.buttonTheme="transparent-fill",this.buttonToggleDirection="",this.buttonTogglePosition="top",this.hasFocus=!1}ngOnInit(){this.styleButton()}ngOnChanges(){this.styleButton()}get attrAriaDisabled(){return this.disabled}onFocus(){this.hasFocus=!0,this.styleButton()}onBlur(){this.hasFocus=!1,this.styleButton()}styleButton(){const i=this.viewButton.nativeElement.style,s=O2[this.buttonTheme??"transparent-fill"];switch(i.setProperty("border-color",s.border||"transparent"),i.setProperty("border-width",s.borderWidth||"2px"),i.setProperty("background-color",s.background),i.setProperty("color",s.color),(this.hasFocus||this.addFocusStyle)&&i.setProperty("border-color",s.focusBorder||"#2d72dc"),this.buttonShape){case vp.Rounded:i.setProperty("border-radius","4px");break;case vp.Square:i.setProperty("border-radius","0")}switch(this.buttonSize){case Xr.Small:i.setProperty("min-height","40px"),i.setProperty("min-width","40px");break;case Xr.Fill:i.setProperty("min-height","100%"),i.setProperty("min-width","100%");break;default:i.setProperty("min-height","48px"),i.setProperty("min-width","48px")}this.thin&&i.setProperty("min-width","28px"),this.short&&i.setProperty("min-height","28px"),this.disabled&&i.setProperty("color",s.disabledColor||"#d7e0ea")}focus(){this.hostElement.nativeElement.focus()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.kS0("tabindex"),t.rXU(t.aKT))},n.\u0275cmp=t.VBU({type:n,selectors:[["button","app-view-button",""]],viewQuery:function(i,s){if(1&i&&t.GBs(y2,7),2&i){let r;t.mGM(r=t.lsd())&&(s.viewButton=r.first)}},hostVars:2,hostBindings:function(i,s){1&i&&t.bIt("focus",function(){return s.onFocus()})("blur",function(){return s.onBlur()}),2&i&&(t.Mr5("disabled",s.disabled),t.BMQ("aria-disabled",s.attrAriaDisabled))},inputs:{disabled:"disabled",selected:"selected",thin:"thin",short:"short",buttonSize:"buttonSize",buttonShape:"buttonShape",addFocusStyle:"addFocusStyle",buttonTheme:"buttonTheme",buttonToggleDirection:"buttonToggleDirection",buttonTogglePosition:"buttonTogglePosition"},features:[t.OA$],attrs:v2,ngContentSelectors:E2,decls:5,vars:1,consts:[["viewButton",""],[1,"view-button"],[1,"view-button__content"],["class","view-button__toggle",3,"ngClass",4,"ngIf"],[1,"view-button__toggle",3,"ngClass"],["icon","angle-up","size","xs",1,"view-button__toggle-icon"]],template:function(i,s){1&i&&(t.NAR(),t.j41(0,"div",1,0)(2,"span",2),t.SdG(3),t.k0s(),t.DNE(4,C2,2,10,"div",3),t.k0s()),2&i&&(t.R7$(4),t.Y8G("ngIf",s.buttonToggleDirection))},dependencies:[b.YU,b.bT,qe],styles:['button[app-view-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all;position:relative;font-size:14px}button[app-view-button]::-moz-focus-inner{border:0}button[app-view-button]:not(:disabled):hover{cursor:pointer}button[app-view-button]:hover:not(:disabled):after{content:" ";pointer-events:none;position:absolute;inset:0;background-color:#0000000d}button[app-view-button]:disabled .view-button{color:#61779e}.view-button{--background-color: transparent;--color: $gray-20;--border-color: transparent;--border-radius: 0;--border-width: 2px;--min-width: 48px;--min-height: 48px;background:var(--background-color);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);color:var(--color);display:flex;align-items:center;justify-content:center;-webkit-user-select:none;user-select:none;pointer-events:none;min-width:var(--min-width);min-height:var(--min-height);height:100%;width:100%;transition:background-color .15s ease-out,border-color .15s ease-out,color .15s ease-out}.view-button--focus{--border-color: #2d72dc !important}.view-button__content{width:100%;transition:all .15s ease-out}.view-button__toggle{position:absolute;pointer-events:none;display:flex;width:100%;height:100%;z-index:2;padding:4px}.view-button__toggle--position-top{justify-content:center;align-items:flex-start}.view-button__toggle--position-bottom{justify-content:center;align-items:flex-end}.view-button__toggle--direction-down .view-button__toggle-icon{transform:rotate(180deg)}.view-button__toggle--position-left{justify-content:flex-start;align-items:center}.view-button__toggle--direction-left .view-button__toggle-icon{transform:rotate(270deg)}.view-button__toggle--position-right{justify-content:flex-end;align-items:center}.view-button__toggle--direction-right .view-button__toggle-icon{transform:rotate(90deg)}\n'],encapsulation:2,changeDetection:0}),e})();var gc;function I2(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleAction("takeQuiz"))}),t.pXf(1,2),t.k0s()}}class Wm{constructor(e){this.dialogRef=e}ngOnInit(){}handleAction(e){this.dialogRef.close(e)}}(gc=Wm).\u0275fac=function(e){return new(e||gc)(t.rXU(HE.ce))},gc.\u0275cmp=t.VBU({type:gc,selectors:[["app-view-playthrough-modal"]],decls:10,vars:3,consts:()=>{let n,e,o;return n=$localize`:1cbfa5d1bd6e6c717ce755355bc69d490bacec684369858959634679447:${"\ufffd#4\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#4\ufffd"}:CLOSE_TAG_APP_ICON: Explore on Your Own `,e=$localize`:1a4ef7deae63552688d7b8d2aa530d0ed9addf038508351863775798459:${"\ufffd#9\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#9\ufffd"}:CLOSE_TAG_APP_ICON: Play Again `,o=$localize`:3453239ade2e7a669baf13d6322db6a7dcc276882019708727875402043: Take Quiz `,[n,e,o,[1,"view-playthrough-modal"],[1,"view-playthrough-modal__buttons"],["app-view-button","","buttonTheme","blue-fill","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","arrow-pointer","aria-hidden","true"],["app-view-button","","class","view-playthrough-modal__button","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",3,"click",4,"ngIf"],["app-view-button","","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","rotate-left","aria-hidden","true"]]},template:function(e,o){1&e&&(t.j41(0,"div",3)(1,"div",4)(2,"button",5),t.bIt("click",function(){return o.handleAction("explore")}),t.PLo(3,0),t.nrm(4,"app-icon",6),t.YFu(),t.k0s(),t.DNE(5,I2,2,0,"button",7),t.nI1(6,"async"),t.j41(7,"button",8),t.bIt("click",function(){return o.handleAction("playAgain")}),t.PLo(8,1),t.nrm(9,"app-icon",9),t.YFu(),t.k0s()()()),2&e&&(t.R7$(5),t.Y8G("ngIf",t.bMT(6,1,o.hasQuiz$)))},dependencies:[xt,b.bT,qe,b.Jj],styles:["[_nghost-%COMP%]{display:flex;background:#1018238c;width:100%;height:100%;justify-content:center;align-items:center;transition:background .3 ease-out}.view-playthrough-modal__button[_ngcontent-%COMP%]{width:280px}.view-playthrough-modal__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(G.hasQuiz),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Wm.prototype,"hasQuiz$",void 0);var tl,el=S(4909),hc=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},mc=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class cs{constructor(e,o,i){this.store=e,this.sceneService=o,this.paintService=i,this.nodeChapterOpacities={}}initObservables(){this.nodesLayerIndex=0,this.objectsLayerIndex=0,this.nodeChapterOpacities={},this.destroyObservables(),this.ngUnsubscribe=new oe.B,(0,Tt.z)([this.selectedChapterId$,this.selectedEngineChapterId$]).pipe((0,X.p)(([e,o])=>e&&(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{this.updateNodeChapterOpacities(e)}),this.selectedChapterCurrentLayers$.pipe((0,el.E)(this.selectedChapterCurrentLayersIndex$),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,e])=>{this.nodesLayerIndex=this.objectsLayerIndex=e}),(0,Tt.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)&&!(0,m.isNil)(o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{this.syncLayersToScene(i,e,o,!0)})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayersToState(e,o,i){this.store.dispatch(new Pg(e,o,i,!0))}syncLayersToScene(e,o,i,s){this.updateLayerIndex(o,e,s),this.updateLayerPosition(i,e,s)}fractionToIndex(e,o){const i=this.getThreshold(e),s=Math.floor(o/i);return Math.max(0,Math.min(e.length-2,s))}fractionToPosition(e,o,i){const s=this.getThreshold(e);return Math.max(0,Math.min((o-s*i)/s,1))}indexPositionToFraction(e,o,i){const s=this.getThreshold(e);return o*s+i*s}fractionToPercent(e){return Math.round(100*(1-e))}percentToFraction(e){return 1-e/100}getThreshold(e){return e.length>1?1/(e.length-1):1}getCurrentLayerIndexProp(e){return e?"nodesLayerIndex":"objectsLayerIndex"}updateLayerIndex(e,o,i){const s=this.getCurrentLayerIndexProp(i);e!==this[s]&&(this.restoreLayers(e,this[s],o,i),i&&(this.nodesLayerIndex=e),this.objectsLayerIndex=e)}updateLayerPosition(e,o,i){const s=this.getCurrentLayerIndexProp(i),r=o[this[s]]?.objectIds;r?.length>0&&this.setObjectsOpacity(r,1-e)}restoreLayers(e,o,i,s){const a=(e-o)/Math.abs(e-o);let l=[],_=o;for(;_!==e;)l=l.concat(i[_].objectIds),_+=a;const p=-1===a;this.setObjectsOpacity(l,1===a?0:1),s?this.setNodesShown(l,p):this.setObjectsShown(l,p),-1===a&&(s?this.setNodesShown(i[e].objectIds,!0):this.setObjectsShown(i[e].objectIds,!0))}setObjectsOpacity(e,o){e.forEach(i=>{const s=this.nodeChapterOpacities[i];let r;Array.isArray(s)?(r=s.slice(),r[0]=o*s[0],r[1]=o*s[1]):r=o*s,this.paintService.colorObject(i,{opacity:r})})}updateNodeChapterOpacities(e){const i=this.store.selectSnapshot(Re.getAllNodeState)[e];this.nodeChapterOpacities={},Object.entries(i).forEach(([s,r])=>{if(this.nodeChapterOpacities[s]=1,r.paint&&Object.prototype.hasOwnProperty.call(r.paint,"opacity")){const a=yr(r.paint);!1!==a.opacity&&(this.nodeChapterOpacities[s]=a.opacity)}})}setObjectsShown(e,o){const i={};for(let s=0;s<e.length;s++)i[e[s]]=o;this.sceneService.setShownObjects({showObjects:i})}setNodesShown(e,o){this.store.dispatch(new kn(o,e,void 0,!1))}}(tl=cs).\u0275fac=function(e){return new(e||tl)(t.KVO(c.il),t.KVO(cn),t.KVO(Mr))},tl.\u0275prov=t.jDH({token:tl,factory:tl.\u0275fac,providedIn:"root"}),hc([(0,c.l6)(E.getSelectedChapterCurrentLayers),mc("design:type",f.c)],cs.prototype,"selectedChapterCurrentLayers$",void 0),hc([(0,c.l6)(E.getSelectedChapterCurrentLayersIndex),mc("design:type",f.c)],cs.prototype,"selectedChapterCurrentLayersIndex$",void 0),hc([(0,c.l6)(E.getSelectedChapterCurrentLayersPosition),mc("design:type",f.c)],cs.prototype,"selectedChapterCurrentLayersPosition$",void 0),hc([(0,c.l6)(E.getSelectedChapterId),mc("design:type",f.c)],cs.prototype,"selectedChapterId$",void 0),hc([(0,c.l6)(U.getChapter),mc("design:type",f.c)],cs.prototype,"selectedEngineChapterId$",void 0);var nl,fc=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Sc=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class _s{constructor(e,o,i){this.store=e,this.actions=o,this.sceneService=i}initObservables(){this.destroyObservables(),this.ngUnsubscribe=new oe.B,(0,Tt.z)([this.selectedChapterId$,this.selectedEngineChapterId$]).pipe((0,X.p)(([o,i])=>o&&(0,m.isEqual)(o,i)),(0,Vn.F)((o,i)=>(0,m.isEqual)(o,i)),(0,w.Q)(this.ngUnsubscribe)).pipe((0,el.E)(this.sourceLayerGroups$,this.currentLayerGroups$,this.visibilityLayersUI$),(0,X.p)(([,o,i,s])=>s?.layersMode===jr.Group&&o.length>0&&!(0,m.isEqual)(o,i)),(0,Pn.B)(0),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,,o])=>{this.syncLayerGroupsToScene(o)}),this.actions.pipe((0,c.xi)(Ut.Redo,Ut.Undo,Ut.UndoAll),(0,go.n)(()=>this.currentLayerGroups$),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.syncLayerGroupsToScene(o)})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayerGroupsToScene(e){const o=this.getObjectVisibilityFromGroups(e);this.sceneService.setShownObjects({showObjects:o})}syncLayerGroupsToState(e,o,i){const s=this.getObjectVisibilityFromGroups(o);this.store.dispatch(new kn(!1,[],s,!1)),this.store.dispatch(new Ng(e,o,i))}computeGroupPositionsByFraction(e,o){const s=e.map(l=>l.layers).flat().length,r=Math.round(s*(0,m.clamp)(o,0,1));let a=s;for(let l=0;l<e.length;l++){const _=e[l];_.position=0;for(let d=_.layers.length,p=d-1,u=d;p>=0;p--,u--,a--)a<=r&&0===_.position&&(_.position=u)}return e}getObjectVisibilityFromGroups(e){const o={};return e.forEach(({layers:i,position:s})=>{const r=i.length-s;i.forEach((a,l)=>{const{objectIds:_}=a,d=r<=l;_.forEach(p=>o[p]=d)})}),o}}(nl=_s).\u0275fac=function(e){return new(e||nl)(t.KVO(c.il),t.KVO(c.En),t.KVO(cn))},nl.\u0275prov=t.jDH({token:nl,factory:nl.\u0275fac,providedIn:"root"}),fc([(0,c.l6)(E.getSelectedChapterId),Sc("design:type",f.c)],_s.prototype,"selectedChapterId$",void 0),fc([(0,c.l6)(U.getChapter),Sc("design:type",f.c)],_s.prototype,"selectedEngineChapterId$",void 0),fc([(0,c.l6)(E.getSelectedChapterSourceLayerGroups),Sc("design:type",f.c)],_s.prototype,"sourceLayerGroups$",void 0),fc([(0,c.l6)(E.getSelectedChapterLayerGroups),Sc("design:type",f.c)],_s.prototype,"currentLayerGroups$",void 0),fc([(0,c.l6)(ue.getUIEntry(h.VisibilityLayers)),Sc("design:type",f.c)],_s.prototype,"visibilityLayersUI$",void 0);class Fs{}let Xm=(()=>{class e{constructor(i){this.colorRecipe=i}}return e.type="[Edit Paint] Set Color Recipe",e})(),QE=(()=>{class e{constructor(i){this.brushMode=i}}return e.type="[Edit Paint] Set Paint Brush Mode",e})(),Hm=(()=>{class e{constructor(){}}return e.type="[Edit Paint] Clear Current Recipe",e})(),YE=(()=>{class e{constructor(){}}return e.type="[Edit Paint] Reset Paint",e})(),qE=(()=>{class e{constructor(i){this.recipe=i}}return e.type="[Edit Paint] Add Recent Recipe",e})(),KE=(()=>{class e{constructor(i){this.recipes=i}}return e.type="[Edit Paint] Set Recent Recipes",e})(),JE=(()=>{class e{constructor(){}}return e.type="[Edit Paint] Reset Story Recipes",e})(),ZE=(()=>{class e{constructor(i,s){this.chapterId=i,this.recipes=s}}return e.type="[Edit Paint] Set Story Recipes For Chapter",e})(),e1=(()=>{class e{constructor(i){this.palette=i}}return e.type="[Edit Paint] Add Palette",e})(),t1=(()=>{class e{constructor(i){this.paletteId=i}}return e.type="[Edit Paint] Remove Palette",e})(),n1=(()=>{class e{constructor(i){this.palette=i}}return e.type="[Edit Paint] Update Palette",e})(),Hr=(()=>{class e{constructor(i){this.palettes=i}}return e.type="[Edit Paint] Set Palettes",e})(),i1=(()=>{class e{constructor(i,s){this.recipe=i,this.paletteId=s}}return e.type="[Edit Paint] Add Recipe to Palette",e})(),o1=(()=>{class e{constructor(i,s){this.paletteId=i,this.open=s}}return e.type="[Edit Paint] Toggle Palette",e})();var s1=function(n){return n[n.Modify=0]="Modify",n[n.Replace=1]="Replace",n}(s1||{});function R2(n,e){try{const o=r1(n),i=r1(e),s=!1===n.opacity?1:n.opacity,r=!1===e.opacity?1:e.opacity;return o===i?s===r?n.saturation===e.saturation?n.brightness===e.brightness?n.contrast>e.contrast?o+4:o-4:n.brightness>e.brightness?o+3:o-3:n.saturation>e.saturation?o+2:o-2:s>r?o+1:o-1:o-i}catch{return 0}}function r1(n){if(!n.tintColor)return-10;const e=n.tintColor[0],o=n.tintColor[1],i=n.tintColor[2],s=Math.max(e,o,i),a=s-Math.min(e,o,i);let l=0;return l=s===e?(o-i)/a:s===o?2+(i-e)/a:4+(e-o)/a,l*=60,l<0&&(l+=360),l}function a1(n){const e=new Map;return n.filter(i=>{const s=JSON.stringify(i,Object.keys(i));return!e.has(s)&&(e.set(s,!0),!0)})}var Bs,Qm,On=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},De=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const l1={currentRecipe:{tintColor:[1,0,0],saturation:!1,contrast:!1,brightness:!1,opacity:!1},brushMode:s1.Replace,storyRecipes:{},recentRecipes:[],uniqueStoryRecipes:[],palettes:[]};let pn=(Bs=class{static getCurrentRecipe(e){return e.currentRecipe}static getCurrentRecipeForEngine(e){return yr(e.currentRecipe)}static getPaintBrushMode(e){return e.brushMode}static getRecentRecipes(e){return e.recentRecipes}static getStoryRecipes(e){return e.storyRecipes}static getUniqueStoryRecipes(e){return e.uniqueStoryRecipes}static getPalettes(e){return e.palettes}static getCurrentChapterRecipes(e,o){return e.storyRecipes[o.selectedChapter]}static getChapterRecipes(e){return(0,c.Mz)([Qm],o=>o.storyRecipes[e])}setCurrentRecipe(e,{colorRecipe:o}){e.patchState({currentRecipe:o})}setBrushMode(e,o){e.patchState({brushMode:o.brushMode})}clearCurrentRecipe(e,o){e.patchState({currentRecipe:null})}resetPaint(e,o){e.setState(l1)}addRecentRecipe(e,o){let i=e.getState().recentRecipes;i.some(r=>function P2(n,e){return!(!n||!e)&&JSON.stringify(n,Object.keys(n).sort())===JSON.stringify(e,Object.keys(e).sort())}(r,o.recipe))||(i.splice(0,0,o.recipe),i.length>14&&(i=i.slice(0,14)),this.storageService.setLocalItem(In.RecentRecipes,i),e.patchState({recentRecipes:[...i]}))}setRecentRecipes(e,o){const i=(0,m.isNil)(o.recipes)?[]:[...o.recipes];e.patchState({recentRecipes:i}),this.storageService.setLocalItem(In.RecentRecipes,i)}setStoryRecipesForChapter(e,o){const i=a1(o.recipes),s=e.getState().storyRecipes;s[o.chapterId]=[...i],e.patchState({storyRecipes:s});const a=a1(Object.values(s).reduce((l,_)=>[...l,..._],[])).sort(R2);e.patchState({uniqueStoryRecipes:a})}resetStoryRecipes(e,o){e.patchState({storyRecipes:{}})}addPalette(e,o){o.palette.id=An.idWithPrefix("palette");const i=[...e.getState().palettes,o.palette];e.dispatch(new Hr(i))}updatePalette(e,o){const i=e.getState().palettes,s=i.findIndex(r=>r.id===o.palette.id);s>=0&&(i[s]={...o.palette}),e.dispatch(new Hr(i))}removePalette(e,o){const i=[...e.getState().palettes.filter(s=>s.id!==o.paletteId)];e.dispatch(new Hr(i))}setPalettes(e,o){const i=(0,m.cloneDeep)(o.palettes?[...o.palettes]:[]);e.patchState({palettes:i}),localStorage.setItem(In.PaintPalettes,JSON.stringify(i))}addRecipeToPalette(e,o){const i=e.getState().palettes,s=i.findIndex(r=>r.id===o.paletteId);s>=0&&i[s].recipes.push(o.recipe),e.dispatch(new Hr(i))}togglePalette(e,o){const i=e.getState().palettes,s=i.findIndex(r=>r.id===o.paletteId);s>=0&&(i[s].open=(0,m.isNil)(o.open)?!i[s].open:o.open,e.dispatch(new Hr(i)))}ngxsOnInit(e){}constructor(e){this.storageService=e}},Qm=Bs,Bs.\u0275fac=function(e){return new(e||Bs)(t.KVO(Le))},Bs.\u0275prov=t.jDH({token:Bs,factory:Bs.\u0275fac}),Bs);On([(0,c.rc)(Xm),De("design:type",Function),De("design:paramtypes",[Object,Xm]),De("design:returntype",void 0)],pn.prototype,"setCurrentRecipe",null),On([(0,c.rc)(QE),De("design:type",Function),De("design:paramtypes",[Object,QE]),De("design:returntype",void 0)],pn.prototype,"setBrushMode",null),On([(0,c.rc)(Hm),De("design:type",Function),De("design:paramtypes",[Object,Hm]),De("design:returntype",void 0)],pn.prototype,"clearCurrentRecipe",null),On([(0,c.rc)(YE),De("design:type",Function),De("design:paramtypes",[Object,YE]),De("design:returntype",void 0)],pn.prototype,"resetPaint",null),On([(0,c.rc)(qE),De("design:type",Function),De("design:paramtypes",[Object,qE]),De("design:returntype",void 0)],pn.prototype,"addRecentRecipe",null),On([(0,c.rc)(KE),De("design:type",Function),De("design:paramtypes",[Object,KE]),De("design:returntype",void 0)],pn.prototype,"setRecentRecipes",null),On([(0,c.rc)(ZE),De("design:type",Function),De("design:paramtypes",[Object,ZE]),De("design:returntype",void 0)],pn.prototype,"setStoryRecipesForChapter",null),On([(0,c.rc)(JE),De("design:type",Function),De("design:paramtypes",[Object,JE]),De("design:returntype",void 0)],pn.prototype,"resetStoryRecipes",null),On([(0,c.rc)(e1),De("design:type",Function),De("design:paramtypes",[Object,e1]),De("design:returntype",void 0)],pn.prototype,"addPalette",null),On([(0,c.rc)(n1),De("design:type",Function),De("design:paramtypes",[Object,n1]),De("design:returntype",void 0)],pn.prototype,"updatePalette",null),On([(0,c.rc)(t1),De("design:type",Function),De("design:paramtypes",[Object,t1]),De("design:returntype",void 0)],pn.prototype,"removePalette",null),On([(0,c.rc)(Hr),De("design:type",Function),De("design:paramtypes",[Object,Hr]),De("design:returntype",void 0)],pn.prototype,"setPalettes",null),On([(0,c.rc)(i1),De("design:type",Function),De("design:paramtypes",[Object,i1]),De("design:returntype",void 0)],pn.prototype,"addRecipeToPalette",null),On([(0,c.rc)(o1),De("design:type",Function),De("design:paramtypes",[Object,o1]),De("design:returntype",void 0)],pn.prototype,"togglePalette",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getCurrentRecipe",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getCurrentRecipeForEngine",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getPaintBrushMode",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getRecentRecipes",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getStoryRecipes",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getUniqueStoryRecipes",null),On([(0,c.MD)(),De("design:type",Function),De("design:paramtypes",[Fs]),De("design:returntype",void 0)],pn,"getPalettes",null),On([(0,c.MD)([E]),De("design:type",Function),De("design:paramtypes",[Fs,wt]),De("design:returntype",void 0)],pn,"getCurrentChapterRecipes",null),pn=Qm=On([(0,c.Uw)({name:"editPaint",defaults:l1}),De("design:paramtypes",[Le])],pn);let Ym=(()=>{var n;class e{constructor(i,s,r,a,l){this.store=i,this.graphService=s,this.cameraService=r,this.sceneService=a,this.liveAnnouncer=l}applyCurrentRecipe(i){const s=this.store.selectSnapshot(pn.getCurrentRecipe);if(!s)return;Object.entries(s).forEach(([a,l])=>{typeof l>"u"&&(s[a]=!1)}),this.store.dispatch(new Mo(s,i));const r=i.reduce((a,l)=>(a[l]=!1,a),{});this.sceneService.setNodesProperty(r,"selected")}fadeInverse(i){const s=this.store.selectSnapshot(U.getViewGraph),r=this.graphService.getInverseSelection(s,i),a=this.graphService.getNodes(s,r);this.store.dispatch(new Mo(Es,a.map(l=>l.id))).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}fade(i){this.store.dispatch(new Mo(Es,i)).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}hideInverse(i){const s=this.store.selectSnapshot(U.getViewGraph),r=this.graphService.getAllLeafDescendants(s,i),a=this.graphService.getInverseSelection(s,i),l={};r.forEach(C=>{l[C]=!0}),a.forEach(C=>{l[C]=!1});const _=new kn(void 0,void 0,l),d=jg(this.store.selectSnapshot(Re),_,this.sceneService);this.store.dispatch(new wo(d.patches));const p=this.sceneService.getObjectBoundary(i),u=this.cameraService.getCameraAfterFlyTo(p),g=new Sd(u),y=function A2(n,e){const[o,i,s]=re.vI(n,r=>{r.cameraFlyTo=e.camera});return{nextState:o,patches:i,inversePatches:s}}(this.store.selectSnapshot(vt),g);this.store.dispatch(new bd(y.patches)).subscribe(()=>{this.liveAnnouncer.announce("Isolate complete")}),this.store.dispatch(new Sr),this.store.dispatch(new un(!1)),this.store.dispatch(new Ut.SavePatches([{forward:d.patches,inverse:d.inversePatches,patchAction:wo},{forward:y.patches,inverse:y.inversePatches,patchAction:bd}]))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(lo),t.KVO(Pi),t.KVO(cn),t.KVO(vi.Ai))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Ep=(()=>{var n;class e{constructor(i,s,r){this.templateRef=i,this.viewContainer=s,this.router=r,this._appFlagApplicationMode="include"}get appFlagApplication(){return this._appFlagApplication}set appFlagApplication(i){this._appFlagApplication=i}get appFlagApplicationMode(){return this._appFlagApplicationMode}set appFlagApplicationMode(i){this._appFlagApplicationMode=i}get appFlagApplicationPage(){return this._appFlagApplicationPage}set appFlagApplicationPage(i){this._appFlagApplicationPage=i}get appFlagApplicationPlatform(){return this._appFlagApplicationPlatform}set appFlagApplicationPlatform(i){this._appFlagApplicationPlatform=i}get appFlagApplicationNative(){return this._appFlagApplicationNative}set appFlagApplicationNative(i){this._appFlagApplicationNative=i}ngOnInit(){this.update()}update(){let i=!1,s=!1,r=!1,a=!1,l=!1;if(""===this.appFlagApplication?s=!0:Array.isArray(this.appFlagApplication)?s=this.appFlagApplication.some(d=>d===he.application):"string"==typeof this.appFlagApplication&&(s=this.appFlagApplication===he.application),null==this.appFlagApplicationPage)r=!0;else{const d=this.router.url;Array.isArray(this.appFlagApplicationPage)?r=this.appFlagApplicationPage.some(p=>d.indexOf(p)>=0):"string"==typeof this.appFlagApplicationPage&&(r=d.indexOf(this.appFlagApplicationPage)>=0)}if(null==this.appFlagApplicationPlatform)a=!0;else{const d=he.platform;Array.isArray(this.appFlagApplicationPlatform)?a=this.appFlagApplicationPlatform.some(p=>d.indexOf(p)>=0):"string"==typeof this.appFlagApplicationPlatform&&(a=d.indexOf(this.appFlagApplicationPlatform)>=0)}null==this.appFlagApplicationNative?l=!0:(l=he.native,(Array.isArray(this.appFlagApplicationNative)?this.appFlagApplicationNative:[this.appFlagApplicationNative]).includes(yp.iOS)&&(l=he.native&&void 0!==window.webkit)),i=s&&r&&a&&l,i&&"include"===this.appFlagApplicationMode||!i&&"exclude"===this.appFlagApplicationMode?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.C4Q),t.rXU(t.c1b),t.rXU(ut.Ix))},n.\u0275dir=t.FsC({type:n,selectors:[["","appFlagApplication",""]],inputs:{appFlagApplication:"appFlagApplication",appFlagApplicationMode:"appFlagApplicationMode",appFlagApplicationPage:"appFlagApplicationPage",appFlagApplicationPlatform:"appFlagApplicationPlatform",appFlagApplicationNative:"appFlagApplicationNative"}}),e})(),Qr=(()=>{var n;class e{onEnter(i){this.store.dispatch(new D.PauseFadeout(!0))}onLeave(i){this.store.dispatch(new D.PauseFadeout(!1))}constructor(i){this.store=i}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275dir=t.FsC({type:n,selectors:[["","appPreventFadeout",""]],hostBindings:function(i,s){1&i&&t.bIt("mouseenter",function(){return s.onEnter()})("mouseleave",function(){return s.onLeave()})}}),e})(),Hi=(()=>{var n;class e{constructor(i,s){this.localeId=i,this.el=s}ngOnInit(){"rtl"===Ol(this.localeId).direction&&(this.el.nativeElement.style.scale="-1 1")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.xe9),t.rXU(t.aKT))},n.\u0275dir=t.FsC({type:n,selectors:[["","appLogicalDir",""]]}),e})();var k2=S(3609),c1=S(2094);function qm(n,e){return n.dispatch(new rd(!1)),e.fireEvent(pe.SceneXrayDisabled),!0}var Jn=S(8931);class D2{constructor(e,o){this.store=e,this.particleSystemsService=o,this.ngUnsubscribe=new oe.B,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const e=this.store.select(St.getParticleSystems),o=this.store.select(St.getVisisbleParticleSystems);(0,Tt.z)([e,o]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const s=this.store.selectSnapshot(E.getSelectedChapterId),r=this.store.selectSnapshot(St.getVisibleParticleSystemsForChapter(s));this.particleSystemsService.setEngineParticles(i,s,r)})}}const Km={type:uh.Cube,direction:gh.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},L2=[Ln.ShapeBounce,Ln.ShapeKill,Ln.ShapeStop],_1={[Ln.LifetimeKill]:{type:Ln.LifetimeKill},[Ln.LifetimeStop]:{type:Ln.LifetimeStop},[Ln.PathKill]:{type:Ln.PathKill},[Ln.PathStop]:{type:Ln.PathStop},[Ln.PathRadius]:{type:Ln.PathRadius},[Ln.ShapeBounce]:{type:Ln.ShapeBounce,trap:!1,shape:{...Km}},[Ln.ShapeKill]:{type:Ln.ShapeKill,trap:!1,shape:{...Km}},[Ln.ShapeStop]:{type:Ln.ShapeStop,trap:!1,shape:{...Km}}},Tp={[Mt.DirectionalVelocity]:{type:Mt.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[Mt.Lifetime]:{type:Mt.Lifetime,average:2.5,variance:1},[Mt.PointPosition]:{type:Mt.PointPosition,position:[0,0,0]},[Mt.RandomVelocity]:{type:Mt.RandomVelocity,forceAverage:5,forceVariance:0},[Mt.SpherePosition]:{type:Mt.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Mt.CylinderPosition]:{type:Mt.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Mt.CubePosition]:{type:Mt.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Mt.RandomRotation]:{type:Mt.RandomRotation,average:0,variance:0},[Mt.RandomRotationSpeed]:{type:Mt.RandomRotationSpeed,average:0,variance:180},[Mt.RandomScale]:{type:Mt.RandomScale,average:1,variance:0},[Mt.SpriteAnimationDuration]:{type:Mt.SpriteAnimationDuration,average:1,variance:0}},Jm={[Ft.AgeColorBlend]:{type:Ft.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[Ft.BrownianMotion]:{type:Ft.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[Ft.UniformForce]:{type:Ft.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[Ft.RadialForce]:{type:Ft.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[Ft.Friction]:{type:Ft.Friction,friction:.1},[Ft.Gravity]:{type:Ft.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[Ft.Path]:{type:Ft.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[Ft.AxisForce]:{type:Ft.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[Ft.SpriteAnimation]:{type:Ft.SpriteAnimation}},d1={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},constraints:[_1[Ln.LifetimeKill]],creators:[Tp[Mt.PointPosition],Tp[Mt.RandomVelocity],Tp[Mt.Lifetime]],updaters:[Jm[Ft.AgeColorBlend],Jm[Ft.Friction]]};function p1(){const n=JSON.parse(JSON.stringify(d1)),{constraints:e,creators:o,updaters:i}=n;return{...n,constraints:e.map((s,r)=>({...s,id:An.idWithPrefix("constraint")})),creators:o.map((s,r)=>({...s,id:An.idWithPrefix("creator")})),updaters:i.map((s,r)=>({...s,id:An.idWithPrefix("updater")}))}}function Zm(n){return{..._1[n]}}function ef(n){return{...Tp[n]}}function tf(n){return{...Jm[n]}}function Cp(n){return(0,m.omitBy)(n,m.isNil)}function B2(n,e){return Cp(function G2(n,e){const{id:o,name:i,shape:s,trap:r}=e;return L2.includes(n)?{id:o,name:i,type:n,trap:r,shape:s}:{id:o,name:i,type:n}}(n,e))}function z2(n,e){return Cp(function $2(n,e){const{id:o,name:i,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:l,average:_,variance:d,position:p,scale:u,rotate:g,translate:y}=e;switch(n){case Mt.DirectionalVelocity:return{id:o,name:i,type:n,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:l};case Mt.Lifetime:return{id:o,name:i,type:n,average:_,variance:d};case Mt.PointPosition:return{id:o,name:i,type:n,position:p};case Mt.RandomVelocity:return{id:o,name:i,type:n,forceAverage:r,forceVariance:l};case Mt.SpherePosition:case Mt.CylinderPosition:case Mt.CubePosition:return{id:o,name:i,type:n,scale:u,rotate:g,translate:y};case Mt.RandomRotation:case Mt.RandomRotationSpeed:case Mt.RandomScale:case Mt.SpriteAnimationDuration:return{id:o,name:i,type:n,average:_,variance:d};default:return}}(n,e))}function W2(n,e){return Cp(function F2(n,e){const{id:o,name:i,colors:s,position:r,direction:a,friction:l,frequency:_,forceAverage:d,radius:p,forceVariance:u,nodes:g,shape:y,directionAverage:C,directionVariance:O}=e;switch(n){case Ft.AgeColorBlend:return{id:o,name:i,type:n,colors:s,shape:y};case Ft.BrownianMotion:return{id:o,name:i,type:n,frequency:_,forceAverage:d,forceVariance:u,shape:y};case Ft.UniformForce:return{id:o,name:i,type:n,directionAverage:C,forceAverage:d,directionVariance:O,forceVariance:u,shape:y};case Ft.RadialForce:return{id:o,name:i,type:n,position:r,forceAverage:d,forceVariance:u,shape:y};case Ft.Friction:return{id:o,name:i,type:n,friction:l,shape:y};case Ft.Gravity:return{id:o,name:i,type:n,position:r,radius:p,forceAverage:d,forceVariance:u,shape:y};case Ft.Path:return{id:o,name:i,type:n,nodes:g,shape:y};case Ft.AxisForce:return{id:o,name:i,type:n,position:r,direction:a,forceAverage:d,forceVariance:u,shape:y};case Ft.SpriteAnimation:return{id:o,name:i,type:n};default:return}}(n,e))}let X2=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.store=s}createParticleSystem(i){const s={...p1(),id:An.idWithPrefix("system")};this.store.dispatch(new Ue.NewParticleSystem(s,i))}duplicateParticleSystem(i,s){this.store.dispatch(new Ue.DuplicateParticleSystem(i,s))}resetParticleSystem(i){const s={...p1(),id:i};this.store.dispatch(new Ue.UpdateParticleSystem(i,s))}toggleParticleSystemVisible(i,s){const r=this.isParticleSystemVisible(i,s);this.store.dispatch(new Ue.SetParticleSystemVisible(i,!r,s))}isParticleSystemVisible(i,s){return this.store.selectSnapshot(St.getVisibleParticleSystemsForChapter(s)).includes(i)}addChapterParticleSystem(i,s){this.store.dispatch(new Ue.AssignParticle(i,s))}removeChapterParticleSystem(i,s){this.store.dispatch(new Ue.UnassignParticle(i,s))}removeAllChapterParticleSystem(i){this.store.selectSnapshot(St.particleSystemsForChapter(i)).forEach(r=>{this.removeChapterParticleSystem(r.id,i)})}createNewConstraint(i,s){const{id:r,constraints:a}=i;this.store.dispatch(new Ue.UpdateParticleSystem(r,{...i,constraints:[...a,{...Zm(s),id:An.idWithPrefix("constraint")}]}))}duplicateConstraint(i,s){i.constraints=[...i.constraints,{...B2(s.type,s),id:An.idWithPrefix("constraint")}],this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleConstraint(i.constraints.length-1))}resetConstraint(i,s){const r=i.constraints[s],{id:a,type:l}=r;i.constraints[s]={...Zm(l),id:a},this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}resetConstraints(i){i.constraints=i.constraints.map(s=>{const{id:r,type:a}=s;return{...Zm(a),id:r}}),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}removeConstraint(i,s){i.constraints.splice(s,1),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleConstraint(-1))}createNewCreator(i,s){const{id:r,creators:a}=i;this.store.dispatch(new Ue.UpdateParticleSystem(r,{...i,creators:[...a,{...ef(s),id:An.idWithPrefix("creator")}]}))}duplicateCreator(i,s){i.creators=[...i.creators,{...z2(s.type,s),id:An.idWithPrefix("creator")}],this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleCreator(i.creators.length-1))}resetCreator(i,s){const r=i.creators[s],{id:a,type:l}=r;i.creators[s]={...ef(l),id:a},this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}resetCreators(i){i.creators=i.creators.map(s=>{const{id:r,type:a}=s;return{...ef(a),id:r}}),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}removeCreator(i,s){i.creators.splice(s,1),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleConstraint(-1))}createNewUpdater(i,s){const{id:r,updaters:a}=i;this.store.dispatch(new Ue.UpdateParticleSystem(r,{...i,updaters:[...a,{...tf(s),id:An.idWithPrefix("updater")}]}))}duplicateUpdater(i,s){i.updaters=[...i.updaters,{...W2(s.type,s),id:An.idWithPrefix("updater")}],this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleUpdater(i.updaters.length-1))}resetUpdater(i,s){const r=i.updaters[s],{id:a,type:l}=r;i.updaters[s]={...tf(l),id:a},this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}resetUpdaters(i){i.updaters=i.updaters.map(s=>{const{id:r,type:a}=s;return{...tf(a),id:r}}),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i))}removeUpdater(i,s){i.updaters.splice(s,1),this.store.dispatch(new Ue.UpdateParticleSystem(i.id,i)),this.store.dispatch(new Ue.SelectParticleConstraint(-1))}setEngineParticles(i,s,r){const a=this.engineService.engine?.story,l=a?.chapters?.find(_=>_.id===s);(0,m.isNil)(l)||(a.particleSystemDefs.forEach((_,d)=>{(0,m.isNil)(i[d])&&a.particleSystemDefs.delete(d)}),Object.entries(i).forEach(([_,d])=>{const p=a.particleSystemDefs.get(_);((0,m.isNil)(p)||!(0,m.isEqual)(p,d))&&a.particleSystemDefs.set(_,d)}),l.particleSystemIds.forEach(_=>{r.includes(_)||l.particleSystemIds.delete(_)}),r.forEach(_=>{l.particleSystemIds.has(_)||l.particleSystemIds.add(_)}))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),Op=(()=>{class e{constructor(i){this.currentVideo=i}}return e.type="[Story Video] Set current video",e})();var Yr,nf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},qr=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let il=((Yr=class{static getCurrentVideo(e){return e.currentVideo}SetCurrentVideo(e,o){e.patchState(re.jM(e.getState(),i=>{const s=i.currentVideo;i.currentVideo=o.currentVideo;const r=this.mediaService.getVideoPlayer(s);r&&r.pause()}))}constructor(e){this.mediaService=e}}).\u0275fac=function(e){return new(e||Yr)(t.KVO(Di))},Yr.\u0275prov=t.jDH({token:Yr,factory:Yr.\u0275fac}),Yr);nf([(0,c.rc)(Op),qr("design:type",Function),qr("design:paramtypes",[Object,Op]),qr("design:returntype",void 0)],il.prototype,"SetCurrentVideo",null),nf([(0,c.MD)(),qr("design:type",Function),qr("design:paramtypes",[Object]),qr("design:returntype",void 0)],il,"getCurrentVideo",null),il=nf([(0,c.Uw)({name:"storyVideo",defaults:{currentVideo:null}}),qr("design:paramtypes",[Di])],il);var gi,Y2=S(9556);!function(n){n.SetEnabled=(()=>{class l{constructor(d){this.enabled=d}}return l.type="[XR] Set XR Enabled",l})(),n.SetSession=(()=>{class l{constructor(d,p,u,g){this.active=d,this.session=p,this.sessionMode=u,this.supportedModes=g}}return l.type="[XR] Set XR Session",l})(),n.SetXRState=(()=>{class l{constructor(d){this.value=d}}return l.type="[XR] Set XR State",l})(),n.EnterXR=(()=>{class l{constructor(d="immersive-vr"){this.sessionMode=d}}return l.type="[XR] Enter XR",l})(),n.ExitXR=(()=>{class l{constructor(d=!1){this.closeTab=d}}return l.type="[XR] Exit XR",l})()}(gi||(gi={}));const q2=[120,120,120,255].map(n=>n/255);let sf=(()=>{var n;class e{constructor(i){this.store=i,this.presentingXR=null,this.xrState=new He.t(void 0)}initXR(i){var s=this;const{renderer:r}=i,a={"immersive-ar":!1,"immersive-vr":!1},l=function(){var _=(0,J.A)(function*(){if(s.presentingXR){const d=s.presentingXR,p=yield s.getRefSpace(d.session,i);d===s.presentingXR&&(r.xrRefSpace=p)}});return function(){return _.apply(this,arguments)}}();if(!this._xr){const _=g=>(0,J.A)(function*(){const{presenting:y,session:C,sessionMode:O,supported:L}=g;if(C&&!r.xrSession){const $=yield s.getRefSpace(C,i);r.xrRefSpace=$,r.xrSession=C,C.addEventListener("reset",l)}y?s.presentingXR=g:g===s.presentingXR&&(s.presentingXR=null,r.xrSession=null,r.xrRefSpace=null),y&&"immersive-vr"===O?i.renderer.setXRClearColor(...q2):i.renderer.setXRClearColor(0,0,0,0),s.xrInputCollection&&(s.xrInputCollection.session=C),a[O]=L,s.store.dispatch(new gi.SetSession(null!==s.presentingXR,C,s.presentingXR?.sessionMode||null,a))}),d=["local-floor","bounded-floor","hand-tracking"];r.extensions.includes("OCULUS_multiview")&&d.push("layers");const p=new ee.XR("immersive-vr",{optionalFeatures:d}),u=new ee.XR("immersive-ar",{requiredFeatures:["local-floor"],optionalFeatures:["dom-overlay"],domOverlay:{root:document.getElementById("viewContainer")}});this._xr={"immersive-vr":p,"immersive-ar":u},p.on("*",_(p)),u.on("*",_(u))}}destroyXR(){this._xr?.["immersive-ar"].destroy(),this._xr?.["immersive-vr"].destroy(),this._xr=null,this.presentingXR=null}enterXR(i="immersive-vr"){if(!this._xr)throw new Error("Cannot enter XR. XR service has been destroyed.");return this._xr[i].enter()}exitXR(){this.presentingXR?.exit()}initInput(i){}getRefSpace(i,s){return(0,J.A)(function*(){let r=null;try{r=yield i.requestReferenceSpace("bounded-floor")}catch{r=yield i.requestReferenceSpace("local-floor")}const{bounds:a,story:l}=s,{module:_}=l,d=Ee.distance(a.min,a.max),p=l.module.chapters[l.activeChapterIndex],u=p.jumpTo||p.flyTo||_.camera,g=ee.vec3Pool.get(),y=ee.vec3Pool.get(),C=ee.vec3Pool.get(),O=ee.vec3Pool.get(),L=u?.eye||_.camera?.eye;if(L){const{x:se,y:ge,z:st}=L;Ee.set(g,se,ge,st),Ee.scale(g,g,ee.BIODIGITAL_SCENE_SCALE)}const $=u?.look||_.camera?.look;if($){const{x:se,y:ge,z:st}=$;Ee.set(y,se,ge,st),Ee.scale(y,y,ee.BIODIGITAL_SCENE_SCALE)}Ee.subtract(C,g,y),Ee.set(O,C[0],C[1],0);const q=[0,0,0,1],x=-Math.atan2(C[0],C[2]);Y2.fromEuler(q,0,180*x/Math.PI,0);const k={x:q[0],y:q[1],z:q[2],w:q[3]},A=Math.max(.6,.6*d,Ee.length(O)),Z={x:0,y:Math.max(1.6-g[1],-a.min[1]),z:-A,w:1};ee.vec3Pool.release(O),ee.vec3Pool.release(C),ee.vec3Pool.release(y),ee.vec3Pool.release(g);const te=new XRRigidTransform(Z,k);return r.getOffsetReferenceSpace(te)})()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Kr,Qi=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},It=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let Nn=((Kr=class{constructor(e,o){this.xrService=e,this.storageService=o}ngxsOnInit(e){e.patchState({enabled:"true"===this.storageService.getLocalItem(In.XREnabled)})}static getXREnabled(e){return e.enabled}static getXRActive(e){return e.active}static getXROverlayType(e){return e.session?.domOverlayState?.type||""}static getXRSessionMode(e){return e.sessionMode||""}static getXRSupportedModes(e){return e.supportedModes||{"immersive-ar":!1,"immersive-vr":!1}}static getXRError(e){return!0===e.error}static getXRRequesting(e){return e.requesting}setXRState(e,o){e.setState(o.value)}setEnabled(e,o){e.patchState({enabled:o.enabled}),this.storageService.setLocalItem(In.XREnabled,o.enabled)}enterXR(e,o){e.patchState({requesting:!0}),this.xrService.enterXR(o.sessionMode).then(()=>{console.log("Enter XR Success"),e.patchState({error:!1})}).catch(i=>{console.warn("Enter XR Fail",i),e.patchState({error:!0})}).finally(()=>{e.patchState({requesting:!1})})}exitXR(e,{closeTab:o}){this.xrService.exitXR(),o&&window.close(),console.log("Exit XR Success")}setSession(e,o){e.patchState({active:o.active,session:o.session,sessionMode:o.sessionMode,supportedModes:o.supportedModes,error:!1})}}).\u0275fac=function(e){return new(e||Kr)(t.KVO(sf),t.KVO(Le))},Kr.\u0275prov=t.jDH({token:Kr,factory:Kr.\u0275fac}),Kr);Qi([(0,c.rc)(gi.SetXRState),It("design:type",Function),It("design:paramtypes",[Object,gi.SetXRState]),It("design:returntype",void 0)],Nn.prototype,"setXRState",null),Qi([(0,c.rc)(gi.SetEnabled),It("design:type",Function),It("design:paramtypes",[Object,gi.SetEnabled]),It("design:returntype",void 0)],Nn.prototype,"setEnabled",null),Qi([(0,c.rc)(gi.EnterXR),It("design:type",Function),It("design:paramtypes",[Object,gi.EnterXR]),It("design:returntype",void 0)],Nn.prototype,"enterXR",null),Qi([(0,c.rc)(gi.ExitXR),It("design:type",Function),It("design:paramtypes",[Object,gi.ExitXR]),It("design:returntype",void 0)],Nn.prototype,"exitXR",null),Qi([(0,c.rc)(gi.SetSession),It("design:type",Function),It("design:paramtypes",[Object,gi.SetSession]),It("design:returntype",void 0)],Nn.prototype,"setSession",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXREnabled",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXRActive",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXROverlayType",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXRSessionMode",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXRSupportedModes",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXRError",null),Qi([(0,c.MD)(),It("design:type",Function),It("design:paramtypes",[Object]),It("design:returntype",void 0)],Nn,"getXRRequesting",null),Nn=Qi([(0,c.Uw)({name:"xr",defaults:{enabled:!1,active:!1,requesting:!1,error:!1,session:null,sessionMode:"",supportedModes:{"immersive-ar":!1,"immersive-vr":!1}}}),It("design:paramtypes",[sf,Le])],Nn);var zs=S(8203),hi=S(1007);function nN(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.playAudio())}),t.nrm(1,"app-icon",10),t.k0s()}}function iN(n,e){if(1&n&&(t.j41(0,"div",11),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.JRh(o.latinLabel)}}function oN(n,e){if(1&n&&(t.nrm(0,"div",12),t.nI1(1,"markdown"),t.nI1(2,"async")),2&n){const o=t.XpG();t.Y8G("innerHTML",t.bMT(2,3,t.bMT(1,1,o.description)),t.npT)}}let sN=(()=>{var n;class e{constructor(i,s,r){this.dialogRef=i,this.mediaService=s,this.data=r,this.title=r.title,this.audioPlayer=r.audioPlayer,this.latinLabel=r.latinLabel,this.description=r.description}ngOnDestroy(){this.audioPlayer&&(this.audioPlayer=null)}handleCloseClick(){this.dialogRef.close()}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(Di),t.rXU(pt.Vh))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-context-label-dialog"]],decls:11,vars:9,consts:[[1,"context-label-dialog","flex","flex-col"],[1,"flex","flex-row","justify-between","items-start"],[1,"flex","flex-row","items-start"],[1,"context-label-dialog__title","mt-2","mr-2",3,"innerHTML"],["class","context-label-dialog__audio","type","button","app-button","","buttonTheme","light","buttonSize","md",3,"click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"context-label-dialog__close",3,"click"],["icon","times","size","lg"],["class","context-label-dialog__latin-label mt-1",4,"ngIf"],["class","context-label-dialog__description mt-6",3,"innerHTML",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","md",1,"context-label-dialog__audio",3,"click"],["icon","volume-up","appLogicalDir",""],[1,"context-label-dialog__latin-label","mt-1"],[1,"context-label-dialog__description","mt-6",3,"innerHTML"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.nrm(3,"div",3),t.nI1(4,"markdown"),t.nI1(5,"async"),t.DNE(6,nN,2,0,"button",4),t.k0s(),t.j41(7,"button",5),t.bIt("click",function(){return s.handleCloseClick()}),t.nrm(8,"app-icon",6),t.k0s()(),t.DNE(9,iN,2,1,"div",7)(10,oN,3,5,"div",8),t.k0s()),2&i&&(t.R7$(3),t.Y8G("innerHTML",t.bMT(5,7,t.bMT(4,5,s.title)),t.npT),t.R7$(3),t.Y8G("ngIf",s.audioPlayer),t.R7$(),t.BMQ("aria-label","Close"),t.R7$(2),t.Y8G("ngIf",s.latinLabel),t.R7$(),t.Y8G("ngIf",s.description))},dependencies:[b.bT,hi.Q,Hi,qe,b.Jj,Ti.i0],styles:[".context-label-dialog{height:100%;padding:24px}.context-label-dialog__title{font-weight:700;font-size:20px;word-break:break-word}.context-label-dialog__latin-label{font-style:italic;font-weight:400;font-size:14px;letter-spacing:.02em}.context-label-dialog__description{font-size:14px;line-height:20px;overflow:auto;margin-right:-24px;padding-right:24px}.context-label-dialog__description p{padding-bottom:12px}\n"],encapsulation:2}),e})();var jn=S(9115);let bc=(()=>{var n;class e{onClick(i){return i.stopPropagation(),i.stopImmediatePropagation(),i.target instanceof HTMLInputElement&&"checkbox"===i.target.type}onEnterUp(i){return i.stopPropagation(),i.stopImmediatePropagation(),!1}onPointerdown(i){i.stopPropagation(),i.stopImmediatePropagation()}onMouseDown(i){i.stopPropagation(),i.stopImmediatePropagation()}onMousUp(i){return i.stopPropagation(),i.stopImmediatePropagation(),!1}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275dir=t.FsC({type:n,selectors:[["","appEventFence",""]],hostBindings:function(i,s){1&i&&t.bIt("click",function(a){return s.onClick(a,a.target)})("keyup.enter",function(a){return s.onEnterUp(a,a.target)})("pointerdown",function(a){return s.onPointerdown(a,a.target)})("mousedown",function(a){return s.onMouseDown(a,a.target)})("mouseup",function(a){return s.onMousUp(a,a.target)})}}),e})();const rN=(n,e,o,i)=>({"label-pin--light":n,"label-pin--dark":e,"label-pin--none":o,"label-pin--selected":i}),aN=(n,e)=>({"label-pin__text--white":n,"label-pin__text--black":e});function lN(n,e){1&n&&t.nrm(0,"img",9)}function cN(n,e){1&n&&t.nrm(0,"img",9)}function _N(n,e){1&n&&t.nrm(0,"img",10)}function dN(n,e){1&n&&t.nrm(0,"img",11)}function pN(n,e){if(1&n&&(t.qex(0),t.DNE(1,lN,1,0,"img",6)(2,cN,1,0,"img",6)(3,_N,1,0,"img",7)(4,dN,1,0,"img",8),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Default||o.label.pinType===o.labelPinType.None&&o.showOnNone),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Sequential),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Plus||o.label.pinType===o.labelPinType.PlusMinus&&!o.selected),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Minus||o.label.pinType===o.labelPinType.PlusMinus&&o.selected)}}function uN(n,e){1&n&&t.nrm(0,"img",15)}function gN(n,e){1&n&&t.nrm(0,"img",15)}function hN(n,e){1&n&&t.nrm(0,"img",16)}function mN(n,e){1&n&&t.nrm(0,"img",17)}function fN(n,e){if(1&n&&t.DNE(0,uN,1,0,"img",12)(1,gN,1,0,"img",12)(2,hN,1,0,"img",13)(3,mN,1,0,"img",14),2&n){const o=t.XpG();t.Y8G("ngIf",o.label.pinType===o.labelPinType.Default||o.label.pinType===o.labelPinType.None&&o.showOnNone),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Sequential),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Plus||o.label.pinType===o.labelPinType.PlusMinus&&!o.selected),t.R7$(),t.Y8G("ngIf",o.label.pinType===o.labelPinType.Minus||o.label.pinType===o.labelPinType.PlusMinus&&o.selected)}}function SN(n,e){if(1&n&&(t.qex(0),t.j41(1,"div",18),t.EFF(2),t.k0s(),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngClass",t.l_i(2,aN,o.labelTheme===o.labelThemeEnum.StudioNext,o.labelTheme===o.labelThemeEnum.Annotation)),t.R7$(),t.SpI(" ",o.sequence," ")}}let u1=(()=>{var n;class e{constructor(){this.labelPinType=_n,this.labelThemeEnum=$n,this.labelTheme=$n.StudioNext,this.selected=!1,this.showOnNone=!1}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-label-pin"]],inputs:{label:"label",labelTheme:"labelTheme",selected:"selected",sequence:"sequence",showOnNone:"showOnNone"},decls:7,vars:9,consts:[["pin",""],["lightPins",""],[1,"label-pin",3,"ngClass"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"label__glow"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg",1,"label-pin__image"],[1,"label-pin__text",3,"ngClass"]],template:function(i,s){if(1&i&&(t.j41(0,"div",2,0),t.DNE(2,pN,5,4,"ng-container",3)(3,fN,4,4,"ng-template",null,1,t.C5r)(5,SN,3,5,"ng-container",4),t.nrm(6,"div",5),t.k0s()),2&i){const r=t.sdS(4);t.Y8G("ngClass",t.ziG(4,rN,s.labelTheme===s.labelThemeEnum.StudioNext,s.labelTheme===s.labelThemeEnum.Annotation,s.label.pinType===s.labelPinType.None&&!s.showOnNone,s.selected)),t.R7$(2),t.Y8G("ngIf",s.labelTheme===s.labelThemeEnum.Annotation)("ngIfElse",r),t.R7$(3),t.Y8G("ngIf",s.label.pinType===s.labelPinType.Sequential)}},dependencies:[b.YU,b.bT],styles:['.label-pin[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;position:relative;transition:background-color .12s;z-index:10}.label-pin__text[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;top:0;z-index:10;width:100%;height:100%;justify-content:center;align-items:center;font-size:10px!important;color:#101823}.label-pin[_ngcontent-%COMP%]:before{content:" ";background-color:transparent;border:2px solid transparent;border-radius:50%;box-sizing:border-box;display:block;position:absolute;top:0;left:0;z-index:-2;height:100%;width:100%;transition:all .15s ease-out}.label-pin--light.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label-pin--light.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#101823}.label-pin--dark.label-pin[_ngcontent-%COMP%]:before{background-color:#000000bf}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#2d72dc}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:after{background-color:#2d72dc}.label-pin--dark.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#fff}.label-pin--none.label-pin[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),e})();var yc,g1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},h1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const bN=["labelContainerEl"],yN=["labelEl"],vN=["wire"],EN=["tag"],TN=["pin"],CN=["title"],ON=[[["","label-header",""]],[["","label-actions",""]],[["","label-more",""]],[["","label-body",""]]],MN=(n,e,o,i,s,r,a,l,_)=>({"label--selected":n,"label--glow":e,"label--annotation":o,"label--invert":i,"label--studio":s,"label--context":r,"label--screenshot-mode":a,"label--auto-fit":l,"label--opaque":_}),IN=n=>({"label__wire--collapse":n}),AN=(n,e,o,i)=>({"label__tag--collapse":n,"label__tag--collapsible":e,"label__tag--floating":o,"label__tag--draggable":i}),PN=n=>({"label__body--collapse":n});function NN(n,e){1&n&&(t.j41(0,"div",18),t.nrm(1,"img",19),t.k0s())}function RN(n,e){if(1&n&&(t.j41(0,"div",20),t.SdG(1,3),t.k0s()),2&n){const o=t.XpG();t.Y8G("ngClass",t.eq3(1,PN,o.isCollapsed||o.descriptionCollapsed))}}class ol{get label(){return this._label}set label(e){const o=(0,m.isEmpty)(e),i=(0,m.isEmpty)(this.label);o&&!i?(this._label=null,this.destroyLabel()):o||(this._label={...e},this.initLabel(this.label))}set selected(e){this._selected=e}get selected(){return this._selected}constructor(e,o,i,s,r,a,l,_,d,p){this.renderer=e,this.labelsService=o,this.engineService=i,this.cameraService=s,this.engineRendererService=r,this.store=a,this.actions=l,this.changeDetection=_,this.markerService=d,this.localeId=p,this.labelPinType=_n,this.labelSequentialType=co,this.labelUpdated=new t.bkB,this.offsetUpdated=new t.bkB,this.pinClicked=new t.bkB,this.tagClicked=new t.bkB,this.displayUpdated=new t.bkB,this.positionUpdated=new t.bkB,this.hoverStart=new t.bkB,this.hoverEnd=new t.bkB,this.labelOffsetUpdated=new t.bkB,this.fit="fixed",this.opaque=!1,this.fixedScale=0,this.isCollapsed=!1,this.tagCollapsed=!1,this.theme="classic",this.pinDraggable=!0,this.tagDraggable=!0,this._selected=!1,this.enginePosition=null,this.isBackgroundDark=!1,this.pinDragging=!1,this.screenshotMode=!1,this.hammerManagers=[],this.displayUpdated$=new oe.B,this.positionUpdated$=new oe.B,this.ngUnsubscribe=new oe.B,this.dir=Ol(this.localeId).direction}ngOnInit(){this.initListeners()}ngAfterViewInit(){this.bindTagEvents(),this.bindPinEvents(),this.bindHoverEvents()}ngOnDestroy(){this.destroyLabel(),this.emitDisplayUpdated({id:this.label.id,inView:!1,shown:!1,objectShown:this.objectShown}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}destroyLabel(){this.hammerManagers.forEach(e=>e.destroy()),this.hammerManagers=[],this.deleteMarker(this.marker)}initListeners(){this.enginePosition$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.enginePosition=e}),this.engineService.getEvent(pe.Tick).pipe((0,X.p)(()=>!(0,m.isNil)(this.label)&&!(0,m.isNil)(this.enginePosition)),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setCanvasPos()}),this.displayUpdated$.pipe((0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.displayUpdated.next(e)}),this.positionUpdated$.pipe((0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.positionUpdated.next(e)}),this.background$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=e.colors.slice(0,3),i=e.colors.slice(4,7);this.isBackgroundDark=!ts.isLight(o,i),this.changeDetection.markForCheck()}),this.actions.pipe((0,c.xi)(Cr),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!0,this.changeDetection.detectChanges()}),this.actions.pipe((0,c.rM)(Pa),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!1,this.changeDetection.markForCheck()})}bindTagEvents(){const e=new Jn.Manager(this.tagRef.nativeElement,{domEvents:!0});e.add(new Jn.Pan({direction:Jn.DIRECTION_ALL,threshold:3})),e.add(new Jn.Tap({event:"tap"})),e.on("pan",o=>{if(!this.tagDraggable)return;o.srcEvent.stopPropagation(),this.cachedTagOffset||(this.cachedTagOffset=this.label.offset);const i=[this.cachedTagOffset[0]+o.deltaX,this.cachedTagOffset[1]+o.deltaY];this.label.offset=i,o.isFinal&&(this.cachedTagOffset=null,this.offsetUpdated.next({labelId:this.label.id,offset:i}))}),e.on("tap",o=>{o.srcEvent.preventDefault(),o.srcEvent.stopPropagation(),this.tagClicked.next(o)}),this.hammerManagers.push(e)}bindPinEvents(){const e=new Jn.Manager(this.pinRef.nativeElement);e.add(new Jn.Pan({direction:Jn.DIRECTION_ALL,threshold:4})),e.add(new Jn.Tap({event:"tap"})),e.on("pan",o=>{if(!this.pinDraggable)return;o.srcEvent.stopPropagation(),this.pinDragging=!0;let{layerX:i,layerY:s}=o.changedPointers[0];if(i-=16,s-=16,this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${i}px, ${s}px)`),o.isFinal){this.pinDragging=!1;const r={...this.label},a=this.engineRendererService.pick(i,s),l="string"==typeof a.objectId;l&&(r.dir=this.cameraService.getDirection(a),r.objectId=a.objectId,r.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],r.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],r.primitiveIndex=a.triIndex),this.labelUpdated.next({label:r,shouldPreserve:l})}}),e.on("tap",o=>{o.srcEvent.preventDefault(),o.srcEvent.stopImmediatePropagation(),this.pinClicked.next(o)}),this.hammerManagers.push(e)}bindHoverEvents(){const e=this.labelRef.nativeElement;this.renderer.listen(e,"mouseenter",()=>{this.hoverStart.next({labelId:this.label.id})}),this.renderer.listen(e,"mouseleave",()=>{this.hoverEnd.next({labelId:this.label.id})})}initLabel(e){this.initMarker(e),this.ensureObjectId(e),this.initObjectSubscription(e)}initMarker(e){this.marker&&this.deleteMarker(this.marker),this.marker=this.markerService.createMarker(e)}checkLabelDisplay(){return{id:this.label.id,shown:this.label.shown,inView:this.isOnCanvas(),objectShown:!0}}ensureObjectId(e){if(!e.objectId&&this.marker){const[o,i]=this.marker.canvasPosition,s=this.engineRendererService.pick(o,i);s.objectId&&(e.objectId=s.objectId,e.states.forEach(r=>{r.errands.forEach(a=>{a.type===Ni.flyToObject&&(a.value=s.objectId)})}),this.labelUpdated.next({label:e,shouldPreserve:void 0}))}}initObjectSubscription(e){this.object$&&this.object$.unsubscribe(),e.objectId&&(this.object$=this.store.select(U.getViewGraphNode).pipe((0,F.T)(o=>o(e.objectId)),(0,X.p)(o=>!!o),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.objectShown=o.boolState.shown}))}deleteMarker(e){this.markerService.deleteMarker(e?.id),this.marker=null}setCanvasPos(){if(this.pinDragging||!this.marker)return void((0,m.isNil)(this.marker)&&this.setDisplay(!1));const e=this.isOccluded(),o=this.isOcclusionIgnored(),i=this.isOnCanvas(),s=e&&!o,r=void 0===this.objectShown?i&&!s:i&&this.objectShown&&!s;r!==this.shown&&(this.shown=r,this.setDisplay(r)),this.setElementPosition(),this.setElementScale(),this.setTagPosition(),this.setWirePosition();const[l,_]=this.marker.canvasPosition;this.positionUpdated$.next({positionUpdate:{id:this.label.id,canvasPos:{x:l,y:_},occluded:s},onCanvas:i})}isOcclusionIgnored(){return this.selected||!this.label.occludable}isOccluded(){return this.marker?.occluded}isOnCanvas(){if(!this.marker)return!1;const{offsetWidth:e,offsetHeight:o}=this.labelsService.getLabelContainer().nativeElement,[i,s]=this.marker.canvasPosition;return i>0&&s>0&&i<e&&s<o}setDisplay(e){this.renderer.setStyle(this.labelRef.nativeElement,"visibility",e?"visible":"hidden"),this.emitDisplayUpdated({id:this.label.id,inView:this.isOnCanvas(),shown:e,objectShown:this.objectShown})}setElementPosition(){const[e,o]=this.marker?.canvasPosition??[0,0];this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${e}px, ${o}px)`)}setElementScale(){let e;if(this.fixedScale)e=this.fixedScale;else{const i=this.store.selectSnapshot(U.getEnginePosition).width;e=i>1440?i/1440:1}const o=32*e-32;this.renderer.setStyle(this.labelRef.nativeElement,"transform-origin","top left"),this.renderer.setStyle(this.labelRef.nativeElement,"transform",`translate(-${o/2}px, -${o/2}px) scale(${e}, ${e})`)}setTagPosition(){const[e,o]=this.label.offset,i=this.tagRef.nativeElement.offsetWidth;let s;switch(s=this.label.pinType===_n.None&&this.label.hideWire||e>0?"left":"right",s){case"left":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+e}px, ${o}px)`);break;case"right":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+e-i}px, ${o}px)`)}}setWirePosition(){let[e,o]=this.label.offset;switch(this.label.theme){case $n.Annotation:case $n.Classic:o+=this.titleRef.nativeElement.offsetHeight-16-2}const i=Math.sqrt(e*e+o*o);this.renderer.setStyle(this.wireRef.nativeElement,"width",`${i}px`),this.renderer.setStyle(this.wireRef.nativeElement,"transform",`rotate(${Math.atan2(o,e)}rad)`)}emitDisplayUpdated(e){this.label.id!==$d&&(null==e.inView||null==e.shown||this.displayUpdated$.next(e))}}(yc=ol).\u0275fac=function(e){return new(e||yc)(t.rXU(t.sFG),t.rXU(fr),t.rXU(Lt),t.rXU(Pi),t.rXU(ws),t.rXU(c.il),t.rXU(c.En),t.rXU(t.gRc),t.rXU(Xl),t.rXU(t.xe9))},yc.\u0275cmp=t.VBU({type:yc,selectors:[["app-generic-label"]],viewQuery:function(e,o){if(1&e&&(t.GBs(bN,7),t.GBs(yN,7),t.GBs(vN,7),t.GBs(EN,7),t.GBs(TN,7),t.GBs(CN,7)),2&e){let i;t.mGM(i=t.lsd())&&(o.labelContainerRef=i.first),t.mGM(i=t.lsd())&&(o.labelRef=i.first),t.mGM(i=t.lsd())&&(o.wireRef=i.first),t.mGM(i=t.lsd())&&(o.tagRef=i.first),t.mGM(i=t.lsd())&&(o.pinRef=i.first),t.mGM(i=t.lsd())&&(o.titleRef=i.first)}},hostVars:2,hostBindings:function(e,o){2&e&&t.AVh("selected",o.selected)},inputs:{fit:"fit",opaque:"opaque",fixedScale:"fixedScale",sequence:"sequence",hasContent:"hasContent",label:"label",isCollapsed:"isCollapsed",descriptionCollapsed:"descriptionCollapsed",tagCollapsed:"tagCollapsed",selected:"selected",theme:"theme",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},outputs:{labelUpdated:"labelUpdated",offsetUpdated:"offsetUpdated",pinClicked:"pinClicked",tagClicked:"tagClicked",displayUpdated:"displayUpdated",positionUpdated:"positionUpdated",hoverStart:"hoverStart",hoverEnd:"hoverEnd",labelOffsetUpdated:"labelOffsetUpdated"},ngContentSelectors:["[label-header]","[label-actions]","[label-more]","[label-body]"],decls:21,vars:27,consts:[["labelContainerEl",""],["labelEl",""],["pin",""],["wire",""],["tag",""],["title",""],["data-test","labelContainer",1,"label-container"],["data-test","labelElement",1,"label",3,"ngClass"],[1,"label__pin"],[3,"label","labelTheme","selected","sequence"],[1,"label__glow"],[1,"label__wire",3,"ngClass"],["aria-hidden","true",1,"label__tag",3,"dir","ngClass"],[1,"label__header"],["data-test","labelTitle",1,"label__title"],["class","label__more","appLogicalDir","",4,"ngIf"],["appEventFence","",1,"label__actions"],["class","label__body",3,"ngClass",4,"ngIf"],["appLogicalDir","",1,"label__more"],["src","./assets/images/labels/caret-right.svg"],[1,"label__body",3,"ngClass"]],template:function(e,o){1&e&&(t.NAR(ON),t.j41(0,"div",6,0)(2,"div",7,1)(4,"div",8,2),t.nrm(6,"app-label-pin",9)(7,"div",10),t.k0s(),t.nrm(8,"div",11,3),t.j41(10,"div",12,4)(12,"div",13)(13,"div",14,5),t.SdG(15),t.k0s(),t.DNE(16,NN,2,0,"div",15),t.j41(17,"div",16),t.SdG(18,1),t.k0s()(),t.DNE(19,RN,2,3,"div",17),t.SdG(20,2),t.k0s()()()),2&e&&(t.R7$(2),t.Y8G("ngClass",t.zJS(10,MN,[o.selected,o.label.pinGlow,"annotation"===o.label.theme||"classic"===o.label.theme,o.isBackgroundDark,"studioNext"===o.label.theme,"context"===o.label.theme,o.screenshotMode,"auto"===o.fit,o.opaque])),t.R7$(4),t.Y8G("label",o.label)("labelTheme",o.label.theme)("selected",o.selected)("sequence",o.sequence),t.R7$(2),t.Y8G("ngClass",t.eq3(20,IN,o.isCollapsed||o.tagCollapsed||o.label.hideWire)),t.R7$(2),t.Y8G("dir",o.dir)("ngClass",t.ziG(22,AN,o.isCollapsed||o.tagCollapsed,o.label.collapseDescription,o.label.hideWire,o.tagDraggable)),t.R7$(6),t.Y8G("ngIf",o.hasContent&&o.label.collapseDescription),t.R7$(3),t.Y8G("ngIf",o.hasContent))},dependencies:[b.YU,b.bT,bc,Hi,zs.ig,u1],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{opacity:1;display:block}}@keyframes _ngcontent-%COMP%_fadeOut{0%{display:block;opacity:1}99%{opacity:0}to{opacity:0;display:none}}@keyframes _ngcontent-%COMP%_glow{0%{box-shadow:0 0 #ffffff80}50%{box-shadow:0 0 8px 2px #ffffff80}to{box-shadow:0 0 #ffffff80}}@keyframes _ngcontent-%COMP%_classic-glow{0%{transform:scale(.5)}10%{transform:scale(.5)}50%{transform:scale(1)}90%{transform:scale(.5)}to{transform:scale(.5)}}[_nghost-%COMP%], .label-container[_ngcontent-%COMP%]{display:block;position:absolute;z-index:10;width:200px;pointer-events:all;pointer-events:none}[_nghost-%COMP%]:hover, .label-container[_ngcontent-%COMP%]:hover{z-index:12}.selected[_nghost-%COMP%]{z-index:11}.label-container[_ngcontent-%COMP%]{left:-16px;top:-16px}.label[_ngcontent-%COMP%]{display:block;overflow:visible;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;height:32px}.label--screenshot-mode[_ngcontent-%COMP%]{text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:before, .label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:after{box-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{box-shadow:none!important;text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:none!important}.label--auto-fit[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:max-content;padding:0!important}.label--auto-fit[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding:0!important}.label__glow[_ngcontent-%COMP%]{display:none;position:absolute;width:32px;height:32px;border-radius:50%;z-index:0;top:0;left:0}.label--selected[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{transform:rotate(45deg)}.label__more[_ngcontent-%COMP%]{color:#374a68;display:none;flex:0 0 16px;height:16px;align-items:center;justify-content:center;transition:transform .15s ease-in-out}.label__pin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;position:absolute;pointer-events:all;transition:background-color .12s;z-index:10}.label__pin[_ngcontent-%COMP%]:hover{cursor:pointer}.label__pin--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__pin--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__wire[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;height:0;transform-origin:0 100%;pointer-events:none;z-index:1}.label__wire--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]{display:inline-block;left:16px;top:0;z-index:10;max-width:160px;pointer-events:all}.label__tag[_ngcontent-%COMP%]:hover{cursor:pointer}.label__tag--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__tag--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__tag--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important;border-radius:4px}.label__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;line-height:140%;align-self:center}.label__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;padding-top:12px}.label__body--collapse[_ngcontent-%COMP%]{display:none}.label__icon[_ngcontent-%COMP%]{margin:0 -4px 0 4px}.label__actions[_ngcontent-%COMP%]{padding-left:4px}.label--studio.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--studio.label--opaque[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#ffffffd9!important}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#2d72dc}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600}.label--studio.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid rgba(16,24,35,.8);box-shadow:0 0 0 1px #f9fafd40}.label--studio.label[_ngcontent-%COMP%]   .label__wire--collapse[_ngcontent-%COMP%]{display:none}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background:#ffffff8c;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:4px 8px;border-radius:4px;max-width:200px}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc}.label--studio.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#101823;flex:1 1 auto}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#374a68;padding-top:4px}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.label--studio.label[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex}.label--annotation.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff40;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite;top:-1px;left:-1px}.label--annotation.label--none[_ngcontent-%COMP%]{display:none}.label--annotation.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:10px;color:#eee}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--floating[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:none}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:focus{outline-offset:4px}.label--annotation.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;min-height:18px;width:100%;padding-bottom:4px;margin-bottom:-2px;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding-top:4px;color:#333}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#eee}.label--context.label[_ngcontent-%COMP%]{pointer-events:none}.label--context.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--context.label[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%], .label--context.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{display:none}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;background:#ffffffb3;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:0;border-radius:4px;width:-moz-fit-content;width:fit-content;min-width:200px;max-width:none;min-height:75px;opacity:1;transition:width .25s,opacity .1s}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc;cursor:grab}.label--context.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{padding:4px 8px 0}.label--context.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;color:#101823}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid #eaeff5;color:#101823;overflow-x:hidden;padding-top:8px}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.context-label--large[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:300px}@media (min-width: 960px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:400px}}@media (max-width: 959px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{opacity:0}}"],changeDetection:0}),g1([(0,c.l6)(U.getEnginePosition),h1("design:type",f.c)],ol.prototype,"enginePosition$",void 0),g1([(0,c.l6)(E.getSelectedChapterBackground),h1("design:type",f.c)],ol.prototype,"background$",void 0);var vc,rf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},af=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const kN=["labelDescription"];function DN(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.playAudio())}),t.nrm(1,"app-icon",21),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("disabled",o.audioPlayerLoading)}}function LN(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleReadMoreClick())}),t.nrm(1,"app-icon",23),t.k0s()}if(2&n){const o=t.XpG(2);t.R7$(),t.AVh("context-label__info--expanded",o.expanded)}}function UN(n,e){if(1&n&&(t.j41(0,"div",17),t.DNE(1,DN,2,1,"button",18)(2,LN,2,2,"button",19),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.enableAudio),t.R7$(),t.Y8G("ngIf",o.enableInfo&&(null==o.node||null==o.node.info?null:o.node.info.description))}}function VN(n,e){if(1&n&&(t.j41(0,"i",24),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.node.info.latinLabel," ")}}function jN(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",25,2),t.nI1(2,"markdown"),t.nI1(3,"async"),t.bIt("pointerdown",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleDescriptionPointerDown(s))})("wheel",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.stopPropagation(s))}),t.k0s()}if(2&n){const o=t.XpG();t.AVh("context-label__description--expanded",o.expanded),t.Y8G("innerHTML",t.bMT(3,5,t.bMT(2,3,o.node.info.description)),t.npT)}}function xN(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",26)(1,"button",27),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.hideNode())}),t.pXf(2,5),t.k0s(),t.j41(3,"button",28),t.qex(4),t.pXf(5,6),t.bVm(),t.nrm(6,"app-icon",29),t.k0s(),t.j41(7,"button",27),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.hideInverseNodes())}),t.pXf(8,7),t.k0s()()}if(2&n){t.XpG();const o=t.sdS(12);t.R7$(3),t.Y8G("matMenuTriggerFor",o)}}const GN=["es-ES","en-US"];class Ec{set label(e){this._label=e,this.largeTitle=this._label.title.length>60,this.removeAudioPlayer(),this.setLabelNode(),this.changeDetectorRef.markForCheck()}get label(){return this._label}get enableAudio(){return GN.includes(this.localeCode)&&this._enableAudio}set enableAudio(e){this._enableAudio=e,this.removeAudioPlayer(),this.changeDetectorRef.markForCheck()}constructor(e,o,i,s,r,a,l,_,d){this.store=e,this.actions=o,this.sceneService=i,this.dialog=s,this.nodeService=r,this.mediaService=a,this.renderer2=l,this.markdownService=_,this.changeDetectorRef=d,this.largeTitle=!1,this.expanded=!1,this.ngUnsubscribe=new oe.B,this.id=An.getUuid()}ngOnInit(){this.initInfoListeners(),this.initBreakpointListeners(),this.initLocale()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.removeAudioPlayer()}setLabelNode(){const e=(0,m.get)(this.label,"objectId");if(e){const o=this.store.selectSnapshot(U.getViewGraph);this.node=this.sceneService.getViewNode(o,e)}else this.node=null;this.expanded=!1,this.changeDetectorRef.markForCheck()}initInfoListeners(){this.actions.pipe((0,c.rM)(dd),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setLabelNode()})}initBreakpointListeners(){this.horizontalBreakpoint$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.expanded&&(e<Un.Large&&!this.curDialog?this.openContextLabelDialog():e>=Un.Large&&this.curDialog&&this.curDialog?.close(!0))})}initLocale(){var e=this;return(0,J.A)(function*(){e.localeCode=yield e.getLocaleCode(),e.changeDetectorRef.markForCheck()})()}handleReadMoreClick(){this.node&&(this.expanded=!this.expanded,this.expanded&&this.store.selectSnapshot(mn.getHorizontalBreakpoint)<Un.Large&&this.openContextLabelDialog())}stopPropagation(e){e.stopPropagation()}handleDescriptionPointerDown(e){const o=this.labelDescription.nativeElement,i=o.offsetWidth-o.clientWidth;if(i>0){const r=o.getBoundingClientRect().right-i;e.clientX>r&&this.stopPropagation(e)}}playAudio(){var e=this;return(0,J.A)(function*(){(0,m.isNil)(e.audioPlayer)&&(yield e.setAudioPlayer(e.localeCode)),e.audioPlayer.stop(),e.audioPlayer.play()})()}setAudioPlayer(e){var o=this;return(0,J.A)(function*(){o.removeAudioPlayer(),o.audioPlayerLoading=!0,o.changeDetectorRef.markForCheck(),o.audioPlayer=yield o.mediaService.addAudioPlayer(o.id,o.getAudioSource(e),!1),o.audioPlayerLoading=!1,o.changeDetectorRef.markForCheck()})()}getAudioSource(e){var o=this;return(0,J.A)(function*(){return Nv(yield Ri.getPlainTextFromMarkdown(o.renderer2,o.markdownService,o._label.title,!0),e)})()}getLocaleCode(){var e=this;return(0,J.A)(function*(){const o=e.store.selectSnapshot(Pe.getStoryInfo);let i=Zi.id;if(o.type===yt.Bookmark){let r=e.store.selectSnapshot(Pe.getStory).chapters.map(a=>a.description||"").join(" ").trim();if(!r){const a=e.store.selectSnapshot(U.getViewGraph);r=Object.values(a.nodes).map(_=>_.label).join(", ").trim()}return Iv(r)}return i=JS(e.store.selectSnapshot(Pe.getStoryLanguage)).id,i})()}removeAudioPlayer(){this.mediaService.removeAudioPlayer(this.id),this.audioPlayer=null}hideNode(){this.store.dispatch(new kn(!1,[this.node.id]))}fadeInverseNodes(){this.nodeService.fadeInverse([this.node.id])}fadeNode(){this.nodeService.fade([this.node.id])}hideInverseNodes(){this.nodeService.hideInverse([this.node.id])}openContextLabelDialog(){this.curDialog=this.dialog.open(sN,{width:"calc(100% - 80px)",maxWidth:"100%",height:"calc(100% - 80px)",maxHeight:"100%",data:{title:this.label.title,audioPlayer:this.audioPlayer,latinLabel:this.node.info.latinLabel,description:this.node.info.description}}),this.curDialog.afterClosed().subscribe(e=>{this.curDialog=void 0,e||(this.expanded=!1,this.changeDetectorRef.markForCheck())})}}(vc=Ec).\u0275fac=function(e){return new(e||vc)(t.rXU(c.il),t.rXU(c.En),t.rXU(cn),t.rXU(pt.bZ),t.rXU(Ym),t.rXU(Di),t.rXU(t.sFG),t.rXU(Ti.Rl),t.rXU(t.gRc))},vc.\u0275cmp=t.VBU({type:vc,selectors:[["app-context-label"]],viewQuery:function(e,o){if(1&e&&t.GBs(kN,5),2&e){let i;t.mGM(i=t.lsd())&&(o.labelDescription=i.first)}},inputs:{label:"label",enableInfo:"enableInfo",enableActions:"enableActions",enableAudio:"enableAudio"},decls:17,vars:17,consts:()=>{let n,e,o,i,s;return n=$localize`:b759baf42e7a90ef5e8c645babba3f7737e6a5265489525302847889282: Fade This `,e=$localize`:1eeab5878ca4b21288c9610b9837d0cf81cc64a06683889227007993247: Fade Everything Else `,o=$localize`:ccf7390cbf933d13bbd3558c3f16040691f3f5c37951634674386802910: Hide `,i=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,s=$localize`:bfe7e779289d630d424893f857357ae741f6acfd8086714388799643845: Isolate `,[["title",""],["fadeActions","matMenu"],["labelDescription",""],n,e,o,i,s,[1,"context-label",3,"fixedScale","label"],["label-header","",1,"context-label__header","html",3,"innerHTML"],["class","context-label__actions","label-actions","",4,"ngIf"],["label-more",""],["class","context-label__latin",4,"ngIf"],["class","context-label__description",3,"context-label__description--expanded","innerHTML","pointerdown","wheel",4,"ngIf"],["class","context-label__node-actions",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["label-actions","",1,"context-label__actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"disabled","click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click","disabled"],["icon","volume-up","appLogicalDir",""],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click"],["icon","info-circle",1,"context-label__info"],[1,"context-label__latin"],[1,"context-label__description",3,"pointerdown","wheel","innerHTML"],[1,"context-label__node-actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"click"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"app-generic-label",8),t.nI1(1,"async"),t.nrm(2,"div",9,0),t.nI1(4,"markdown"),t.nI1(5,"async"),t.DNE(6,UN,3,2,"div",10),t.qex(7,11),t.DNE(8,VN,2,1,"i",12)(9,jN,4,7,"div",13)(10,xN,9,1,"div",14),t.j41(11,"mat-menu",null,1)(13,"button",15),t.bIt("click",function(){return t.eBV(i),t.Njj(o.fadeNode())}),t.pXf(14,3),t.k0s(),t.j41(15,"button",16),t.bIt("click",function(){return t.eBV(i),t.Njj(o.fadeInverseNodes())}),t.pXf(16,4),t.k0s()(),t.bVm(),t.k0s()}2&e&&(t.AVh("context-label--expanded",o.expanded)("context-label--large",o.largeTitle),t.Y8G("fixedScale",t.bMT(1,11,o.labelScale$))("label",o.label),t.R7$(2),t.Y8G("innerHTML",t.bMT(5,15,t.bMT(4,13,o.label.title)),t.npT),t.R7$(4),t.Y8G("ngIf",o.node),t.R7$(2),t.Y8G("ngIf",o.node&&(null==o.node.info?null:o.node.info.latinLabel)),t.R7$(),t.Y8G("ngIf",o.enableInfo&&(null==o.node||null==o.node.info?null:o.node.info.description)),t.R7$(),t.Y8G("ngIf",o.node))},dependencies:[b.bT,hi.Q,Hi,qe,jn.kk,jn.fb,jn.Cp,ol,b.Jj,Ti.i0],styles:[".context-label[_ngcontent-%COMP%]{z-index:12}.context-label__header[_ngcontent-%COMP%]{word-break:break-word}.context-label__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;min-height:24px}.context-label__info--expanded[_ngcontent-%COMP%]{color:#2d72dc}.context-label__latin[_ngcontent-%COMP%]{display:block;padding:0 8px 4px;font-size:.625rem;line-height:.75rem;font-style:italic}.context-label__description[_ngcontent-%COMP%]{max-height:0;margin:0;overflow:auto;font-size:12px;line-height:18px;transition:max-height .25s,margin .25s}.context-label__node-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid rgba(16,24,35,.5);margin-top:4px;white-space:nowrap}.context-label__node-action[_ngcontent-%COMP%]{border-radius:0;border-inline-end:1px solid rgba(16,24,35,.5);flex:1}.context-label__node-action[_ngcontent-%COMP%]:last-child{border-inline-end:0}@media (min-width: 960px){.context-label__description--expanded[_ngcontent-%COMP%]{margin:8px;max-height:200px}}"],changeDetection:0}),rf([(0,c.l6)(U.getQuerying),af("design:type",f.c)],Ec.prototype,"querying$",void 0),rf([(0,c.l6)(ye.getLabelScale),af("design:type",f.c)],Ec.prototype,"labelScale$",void 0),rf([(0,c.l6)(mn.getHorizontalBreakpoint),af("design:type",f.c)],Ec.prototype,"horizontalBreakpoint$",void 0);var Cc,Tc=function(n){return n.Normal="normal",n.Compact="compact",n}(Tc||{}),f1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},S1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const $N=["image"],FN=["imagePre"],BN=["imagePost"],zN=["imageContainer"];function WN(n,e){if(1&n&&(t.nrm(0,"div",10),t.nI1(1,"markdown"),t.nI1(2,"async")),2&n){const o=t.XpG();t.Y8G("innerHTML",t.bMT(2,3,t.bMT(1,1,o.label)),t.npT)}}function XN(n,e){if(1&n&&t.nrm(0,"img",11,2),2&n){const o=t.XpG();t.Y8G("src",o.imageUrl,t.B4B)}}function HN(n,e){if(1&n&&t.nrm(0,"img",12,3),2&n){const o=t.XpG();t.Y8G("src",o.imageUrl,t.B4B)}}class wp{constructor(e,o,i,s){this.renderer=e,this.engineService=o,this.animationService=i,this.store=s,this.ngUnsubscribe=new oe.B,this.loopImage=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,X.p)(e=>!!e.animation),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}initTimelineListener(){(0,Ao.h)(this.engineService.getEvent(pe.TimelineScrubbed),this.engineService.getEvent(pe.TimelinePlaying)).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.getChapterPercent();this.moveImage(o)})}handleClick(e){const o=this.store.selectSnapshot(U.getAnimationPlaying);o&&this.animationService.pause(),this.scrub(e),setTimeout(()=>{o&&this.animationService.unpause()})}scrub(e){if(e.currentTarget instanceof HTMLElement){const o=e.currentTarget.getBoundingClientRect(),r=this.timerange.lastTime-this.timerange.firstTime,l=(e.clientX-o.left-o.width/2)*(r/this.getImageWidth());let _=this.animationService.getTime()+l;this.loopImage&&(_<0?_=r+_:_>r&&(_-=r)),_>=0&&_<=r&&this.animationService.scrub(_)}}moveImage(e){const o=this.getImageWidth();this.renderer.setStyle(this.imageContainer.nativeElement,"transform",`translate(${e/100*-o}px, 0)`),this.loopImage&&(this.renderer.setStyle(this.imagePre.nativeElement,"transform",`translate(${-o}px, 0)`),this.renderer.setStyle(this.imagePost.nativeElement,"transform",`translate(${o}px, 0)`))}getImageWidth(){return this.image.nativeElement.getBoundingClientRect().width}getChapterPercent(){if((0,m.isNil)(this.timerange))return 0;const{firstTime:e,lastTime:o}=this.timerange,i=this.animationService.getTime();return Math.max(e,Math.min(i,o))/o*100}}var Oc;(Cc=wp).\u0275fac=function(e){return new(e||Cc)(t.rXU(t.sFG),t.rXU(Lt),t.rXU(bi),t.rXU(c.il))},Cc.\u0275cmp=t.VBU({type:Cc,selectors:[["app-ticker-block-item"]],viewQuery:function(e,o){if(1&e&&(t.GBs($N,7),t.GBs(FN,5),t.GBs(BN,5),t.GBs(zN,7)),2&e){let i;t.mGM(i=t.lsd())&&(o.image=i.first),t.mGM(i=t.lsd())&&(o.imagePre=i.first),t.mGM(i=t.lsd())&&(o.imagePost=i.first),t.mGM(i=t.lsd())&&(o.imageContainer=i.first)}},inputs:{label:"label",imageUrl:"imageUrl",loopImage:"loopImage"},decls:8,vars:4,consts:[["imageContainer",""],["image",""],["imagePre",""],["imagePost",""],[1,"ticker-block-item",3,"click"],["class","ticker-block-item__label html",3,"innerHTML",4,"ngIf"],[1,"ticker-block-item__image-container"],["class","ticker-block-item__image ticker-block-item__image--pre",3,"src",4,"ngIf"],["class","ticker-block-item__image ticker-block-item__image--post",3,"src",4,"ngIf"],[1,"ticker-block-item__image",3,"src"],[1,"ticker-block-item__label","html",3,"innerHTML"],[1,"ticker-block-item__image","ticker-block-item__image--pre",3,"src"],[1,"ticker-block-item__image","ticker-block-item__image--post",3,"src"]],template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",4),t.bIt("click",function(r){return t.eBV(i),t.Njj(o.handleClick(r))}),t.DNE(1,WN,3,5,"div",5),t.j41(2,"div",6,0),t.DNE(4,XN,2,1,"img",7)(5,HN,2,1,"img",8),t.nrm(6,"img",9,1),t.k0s()()}2&e&&(t.R7$(),t.Y8G("ngIf",o.label),t.R7$(3),t.Y8G("ngIf",o.loopImage),t.R7$(),t.Y8G("ngIf",o.loopImage),t.R7$(),t.Y8G("src",o.imageUrl,t.B4B))},dependencies:[b.bT,b.Jj,Ti.i0],styles:['.ticker-block-item[_ngcontent-%COMP%]{--label-height: 24px;background:#f9fafd;background:linear-gradient(90deg,#f9fafd 20%,#fff0,#fff,#f9fafd 80%);overflow:hidden;padding-left:50%;position:relative;cursor:pointer}.ticker-block-item[_ngcontent-%COMP%]:hover   .ticker-block-item__label[_ngcontent-%COMP%]{background:#ffffffe6}.ticker-block-item[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;left:50%;top:0;height:100%;width:1px;background:red;box-shadow:0 0 0 4px #f003;z-index:10}.ticker-block-item__label[_ngcontent-%COMP%]{position:absolute;height:var(--label-height);left:0;top:0;width:100%;display:flex;align-items:center;font-size:12px;z-index:10;background:#ffffff8c}.ticker-block-item__image-container[_ngcontent-%COMP%]{position:relative;margin-top:var(--label-height);pointer-events:none;-webkit-user-select:none;user-select:none}.ticker-block-item__image[_ngcontent-%COMP%]{display:block;max-width:none}.ticker-block-item__image--pre[_ngcontent-%COMP%], .ticker-block-item__image--post[_ngcontent-%COMP%]{position:absolute;top:0;left:0}'],changeDetection:0}),f1([(0,c.l6)(U.getAnimationPlaying),S1("design:type",f.c)],wp.prototype,"animationPlaying$",void 0),f1([(0,c.l6)(E.getSelectedChapterReadyState),S1("design:type",f.c)],wp.prototype,"chapterReadyState$",void 0);const qN=["guideline"];function KN(n,e){if(1&n&&t.nrm(0,"app-ticker-block-item",11),2&n){const o=e.$implicit,i=t.XpG(2);t.Y8G("imageUrl",o.urls.default)("label",o.caption)("loopImage",i.tickerBlock.loopImage)}}function JN(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",3)(1,"div",4),t.bIt("mouseenter",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleMouseEnter())})("mouseleave",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleMouseLeave())})("mousemove",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleMouseMove(s))}),t.DNE(2,KN,1,3,"app-ticker-block-item",5),t.nrm(3,"div",6,0),t.k0s(),t.j41(5,"button",7),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handlePlayClick())}),t.j41(6,"span",8),t.EFF(7),t.nI1(8,"async"),t.k0s(),t.nrm(9,"app-icon",9),t.nI1(10,"async"),t.j41(11,"span",10),t.pXf(12,1),t.nI1(13,"async"),t.k0s()()()}if(2&n){const o=t.XpG();t.R7$(2),t.Y8G("ngForOf",o.tickerBlock.images),t.R7$(5),t.JRh(o.getAnimationPlayingTooltip(t.bMT(8,4,o.animationPlaying$))),t.R7$(2),t.Y8G("icon",t.bMT(10,6,o.animationPlaying$)?"pause":"play"),t.R7$(4),t.uP7(t.bMT(13,8,o.animationPlaying$)?"Pause":"Play"),t.nnv(12)}}class lf{constructor(e,o){this.store=e,this.renderer=o,this.ngUnsubscribe=new oe.B}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayClick(){const e=this.store.selectSnapshot(U.getAnimationPlaying);this.store.dispatch(new Yo(!e))}getAnimationPlayingTooltip(e){return e?$localize`Pause Animation`:$localize`Play Animation`}handleMouseMove(e){const o=this.guideline.nativeElement,s=o.parentElement.getBoundingClientRect();this.renderer.setStyle(o,"transform",`translate(${e.clientX-s.left}px, 0)`)}handleMouseEnter(){this.renderer.setStyle(this.guideline.nativeElement,"display","block")}handleMouseLeave(){this.renderer.setStyle(this.guideline.nativeElement,"display","none")}}(Oc=lf).\u0275fac=function(e){return new(e||Oc)(t.rXU(c.il),t.rXU(t.sFG))},Oc.\u0275cmp=t.VBU({type:Oc,selectors:[["app-ticker-block"]],viewQuery:function(e,o){if(1&e&&t.GBs(qN,5),2&e){let i;t.mGM(i=t.lsd())&&(o.guideline=i.first)}},inputs:{tickerBlock:"tickerBlock"},decls:1,vars:1,consts:()=>{let n;return n=$localize`:026d242c5f68dd78d7735a118cb96c4d3ed15eb6793165009929591137:${"\ufffd0\ufffd"}:INTERPOLATION: Animation`,[["guideline",""],n,["class","ticker-block",4,"ngIf"],[1,"ticker-block"],[1,"ticker-block__item-container",3,"mouseenter","mouseleave","mousemove"],[3,"imageUrl","label","loopImage",4,"ngFor","ngForOf"],[1,"ticker-block__guideline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"ticker-block__play",3,"click"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"],[1,"ml-2","text-uppercase","text-10"],[3,"imageUrl","label","loopImage"]]},template:function(e,o){1&e&&t.DNE(0,JN,14,10,"div",2),2&e&&t.Y8G("ngIf",o.tickerBlock)},dependencies:[b.Sq,b.bT,xt,qe,wp,b.Jj],styles:[".ticker-block__item-container[_ngcontent-%COMP%]{position:relative}.ticker-block__guideline[_ngcontent-%COMP%]{display:none;position:absolute;pointer-events:none;left:0;top:0;height:100%;width:1px;background:red;z-index:10}.ticker-block__play[_ngcontent-%COMP%]{width:100%;margin:12px 0}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(U.getAnimationPlaying),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],lf.prototype,"animationPlaying$",void 0);let Ws=(()=>{var n;class e{constructor(i,s){var r=this;this.domSanitizer=i,this.markdownService=s,this.html=(0,t.hFB)(""),this.markdownText=(0,t.hFB)(""),this.safeHTML=(0,t.vPA)(""),(0,t.QZP)((0,J.A)(function*(){const a=r.html(),l=r.markdownText(),_=a||(yield r.markdownService.parse(l))||"",d=r.domSanitizer.bypassSecurityTrustHtml(_);r.safeHTML.set(d)}))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(z.up),t.rXU(Ti.Rl))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-html"]],inputs:{html:[t.Mj6.SignalBased,"html"],markdownText:[t.Mj6.SignalBased,"markdownText"]},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[[1,"html",3,"innerHTML"]],template:function(i,s){1&i&&t.nrm(0,"div",0),2&i&&t.Y8G("innerHTML",s.safeHTML(),t.npT)},encapsulation:2,changeDetection:0}),e})(),ZN=(()=>{var n;class e{constructor(){this.layout=Tc.Normal}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-markdown-block"]],inputs:{markdownBlock:"markdownBlock",layout:"layout"},decls:2,vars:1,consts:[[1,"markdown-block"],[3,"markdownText"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"app-html",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("markdownText",s.markdownBlock.markdown))},dependencies:[Ws],encapsulation:2,changeDetection:0}),e})();var Sn=S(4823);const eR=(n,e,o)=>[n,e,o];function tR(n,e){if(1&n&&(t.j41(0,"div",3),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.label," ")}}var b1=function(n){return n.Small="small",n.Medium="medium",n.Large="large",n.Huge="huge",n}(b1||{}),y1=function(n){return n.Horizontal="horizontal",n.Vertical="vertical",n}(y1||{}),v1=function(n){return n.Inline="inline",n.Block="block",n.Fill="fill",n}(v1||{});let Jr=(()=>{var n;class e{constructor(){this.size=b1.Medium,this.label="",this.direction=y1.Horizontal,this.render=v1.Fill}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-spinner"]],inputs:{size:"size",label:"label",direction:"direction",render:"render"},decls:3,vars:6,consts:[[1,"spinner","spinner--horizontal",3,"ngClass"],[1,"spinner__circle"],["class","spinner__label",4,"ngIf"],[1,"spinner__label"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"div",1),t.DNE(2,tR,2,1,"div",2),t.k0s()),2&i&&(t.Y8G("ngClass",t.sMw(2,eR,"spinner--"+s.size,"spinner--"+s.render,"spinner--"+s.direction)),t.R7$(2),t.Y8G("ngIf",s.label.length))},dependencies:[b.YU,b.bT],styles:['@keyframes _ngcontent-%COMP%_spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:14px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:16px}.spinner--horizontal[_ngcontent-%COMP%]{flex-direction:row}.spinner--vertical[_ngcontent-%COMP%]{align-items:center;flex-direction:column}.spinner--vertical[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{padding:8px 0 0}.spinner--inline[_ngcontent-%COMP%]{display:inline-flex}.spinner--block[_ngcontent-%COMP%]{display:flex}.spinner--fill[_ngcontent-%COMP%]{display:flex;height:100%}.spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:50%;border:2px solid rgba(16,24,35,.1);position:relative}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{border-color:#fff6}.spinner__circle[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_spinner .4s linear infinite;content:" ";border-radius:50%;border:2px solid transparent;border-top-color:#fff3;border-right-color:#10182333;box-sizing:border-box;position:absolute;display:block;width:14px;height:14px;top:-2px;left:-2px}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{border-top-color:#fff;border-right-color:#fff}.spinner__label[_ngcontent-%COMP%]{padding-left:8px;font-size:14px;text-transform:uppercase}.theme-dark[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#fff3}.theme-light[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#10182399}'],changeDetection:0}),e})();function nR(n,e){1&n&&(t.j41(0,"div",5),t.nrm(1,"app-spinner",6),t.k0s())}let iR=(()=>{var n;class e{constructor(i,s,r){this.dialogRef=i,this.data=s,this.changeRef=r,this.config=s}ngOnInit(){}handleCloseClick(){this.dialogRef.close()}handleImageLoaded(){this.imageLoaded=!0,this.changeRef.markForCheck()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(pt.Vh),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-image-dialog"]],decls:5,vars:6,consts:[["role","dialog","aria-modal","true",1,"image-dialog",3,"click","keyup.enter"],["class","image-dialog__loading flex flex-col p-8",4,"ngIf"],[1,"image-dialog__image",3,"load","src","title","alt"],["type","button","app-view-button","","buttonColor","gray-dark","buttonShape","rounded","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"image-dialog__close",3,"click"],["icon","times"],[1,"image-dialog__loading","flex","flex-col","p-8"],["size","huge"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.bIt("click",function(){return s.handleCloseClick()})("keyup.enter",function(){return s.handleCloseClick()}),t.DNE(1,nR,2,0,"div",1),t.j41(2,"img",2),t.bIt("load",function(){return s.handleImageLoaded()}),t.k0s(),t.j41(3,"button",3),t.bIt("click",function(){return s.handleCloseClick()}),t.nrm(4,"app-icon",4),t.k0s()()),2&i&&(t.BMQ("aria-label",(s.config.title||s.config.alt||"")+" Image Dialog"),t.R7$(),t.Y8G("ngIf",!s.imageLoaded),t.R7$(),t.Y8G("src",s.config.src,t.B4B)("title",s.config.title||"")("alt",s.config.alt||""),t.BMQ("aria-label",s.config.title||""))},dependencies:[b.bT,Sn.oV,xt,qe,Jr],styles:[".image-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.image-dialog__loading[_ngcontent-%COMP%]{position:absolute}.image-dialog__image[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}.image-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;right:24px}"],changeDetection:0}),e})();var Lo=function(n){return n.AboutDialog="AboutDialog",n.AddTeamModelDialog="AddTeamModelDialog",n.AssignUserRoleDialog="AssignUserRoleDialog",n.BulkUpdateDialog="BulkUpdateDialog",n.BookmarkAccessDialog="BookmarkAccessDialog",n.ShareUrlDialog="ShareUrlDialog",n.ConfirmDialog="ConfirmDialog",n.ContactDialog="ContactDialog",n.GroupRestrictionDialog="GroupRestrictionDialog",n.ImageDialog="ImageDialog",n.VideoDialog="VideoDialog",n.ImportDialog="ImportDialog",n.JoinDomainDialog="JoinDomainDialog",n.LimitDialog="LimitDialog",n.ManageDialog="ManageDialog",n.PremiumContentDialog="PremiumContentDialog",n.PricingDialog="PricingDialog",n.ProfileDialog="ProfileDialog",n.QuizSettingsDialog="QuizSettingsDialog",n.SaveAsBookmarkDialog="SaveAsBookmarkDialog",n.SaveBookmarkDialog="SaveBookmarkDialog",n.SaveModuleDialog="SaveModuleDialog",n.TransferUserContentDialog="TransferUserContentDialog",n.RemoveUserDialog="RemoveUserDialog",n.MergeModuleDialog="MergeModuleDialog",n.MergeConflictDialog="MergeConflictDialog",n.WelcomeTourDialog="WelcomeTourDialog",n.TrialExpiredDialog="TrialExpiredDialog",n.PremiumAccessDialog="PremiumAccessDialog",n.ConfirmRoleDialog="ConfirmRoleDialog",n.CollectionNameDialog="CollectionNameDialog",n.PublicViewGateDialog="PublicViewGateDialog",n.BookmarkJobsDialog="BookmarkJobsDialog",n.BulkAddModelDialog="BulkAddModelDialog",n.BulkDeleteModelDialog="BulkDeleteModelDialog",n}(Lo||{});const oR=["imageView"];let sR=(()=>{var n;class e{constructor(i){this.dialog=i,this.fit="normal",this.fullscreenEnabled=!1}handleFullscreen(i){this.dialog.open(iR,{id:Lo.ImageDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{src:this.fullscreenSrc||this.src,alt:this.alt||""}}),i.stopPropagation()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.bZ))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-image-view"]],viewQuery:function(i,s){if(1&i&&t.GBs(oR,7),2&i){let r;t.mGM(r=t.lsd())&&(s.imageView=r.first)}},inputs:{fit:"fit",fitSize:"fitSize",src:"src",fullscreenSrc:"fullscreenSrc",alt:"alt"},decls:7,vars:8,consts:()=>{let o,i;return o=$localize`:1f332ec66f3bc8d943c248091be7f92772ba280f1359092845802014498:Expand`,i=$localize`:18f469ed5b239831a3f607f35e2faa3ccd9527d63521332303708985940:Click to expand the image`,[["imageView",""],i,["role","button","tabindex","0","matTooltip",o,1,"image-view",3,"click","keyup.enter"],[1,"sr-only"],[1,"image-view__image",3,"src"],["aria-hidden","true",1,"image-view__overlay"],["icon","expand-alt",1,"image-view__icon"]]},template:function(i,s){if(1&i){const r=t.RV6();t.j41(0,"div",2,0),t.bIt("click",function(l){return t.eBV(r),t.Njj(s.handleFullscreen(l))})("keyup.enter",function(l){return t.eBV(r),t.Njj(s.handleFullscreen(l))}),t.j41(2,"span",3),t.pXf(3,1),t.k0s(),t.nrm(4,"img",4),t.j41(5,"div",5),t.nrm(6,"app-icon",6),t.k0s()()}2&i&&(t.AVh("image-view--auto-fit","auto"===s.fit),t.R7$(4),t.xc7("max-width","auto"===s.fit&&s.fitSize?s.fitSize+"px":"100%")("max-height","auto"===s.fit&&s.fitSize?s.fitSize+"px":"100%"),t.Y8G("src",s.src,t.B4B),t.BMQ("alt",s.alt))},dependencies:[qe,Sn.oV],styles:[".image-view[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:inherit;min-height:32px;position:relative;background-color:#f9fafd}.image-view__image[_ngcontent-%COMP%]{width:auto;height:auto}.image-view--auto-fit[_ngcontent-%COMP%]   .image-view__image[_ngcontent-%COMP%]{max-width:100%;height:auto}.image-view__overlay[_ngcontent-%COMP%]{background:#1c2a3f4d;color:#fff;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px;position:absolute;inset:0;opacity:0;transition:opacity .25s}.image-view__icon[_ngcontent-%COMP%]{text-shadow:0 0 2px rgba(0,0,0,.6)}.image-view[_ngcontent-%COMP%]:hover{cursor:pointer}.image-view[_ngcontent-%COMP%]:hover   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}.image-view[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.image-view[_ngcontent-%COMP%]:focus   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),e})();function rR(n,e){if(1&n&&(t.j41(0,"div",6),t.nrm(1,"app-image-view",7),t.k0s()),2&n){const o=t.XpG(2);t.AVh("mb-3",o.currentImage.caption),t.R7$(),t.Y8G("src",o.currentImage.urls.small)("fullscreenSrc",o.currentImage.urls.default)("alt",o.currentImage.alt)("fit",o.fit)("fitSize",o.fitSize)}}function aR(n,e){if(1&n&&t.nrm(0,"app-html",8),2&n){const o=t.XpG(2);t.Y8G("markdownText",o.currentImage.caption)}}function lR(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",9)(1,"button",10),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handlePrevClick())}),t.nrm(2,"app-icon",11),t.k0s(),t.j41(3,"button",12),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleNextClick())}),t.nrm(4,"app-icon",13),t.k0s()()}}function cR(n,e){if(1&n&&(t.j41(0,"div",1)(1,"div",2),t.DNE(2,rR,2,7,"div",3)(3,aR,1,1,"app-html",4)(4,lR,5,0,"div",5),t.k0s()()),2&n){const o=t.XpG();t.AVh("images-block--slideshow",o.images&&o.images.length>1),t.R7$(2),t.Y8G("ngIf",o.currentImage.urls),t.R7$(),t.Y8G("ngIf",o.currentImage.caption),t.R7$(),t.Y8G("ngIf",o.images.length>1)}}let dR=(()=>{var n;class e{get imagesBlock(){return this._imagesBlock}set imagesBlock(i){this._imagesBlock=i;const s=(0,m.get)(i,"images",[]);s.length&&(this.images=s,this.currentImage=this.images[0])}get fit(){return"compact"===this.layout?"auto":"normal"}get fitSize(){return"compact"===this.layout?100:void 0}constructor(){this.layout=Tc.Normal}ngOnInit(){}handlePrevClick(){let i=this.getCurrentImageIndex();i--,i<0&&(i=this.images.length-1),this.currentImage=this.images[i]}handleNextClick(){let i=this.getCurrentImageIndex();i++,i>=this.images.length&&(i=0),this.currentImage=this.images[i]}getCurrentImageIndex(){return this.images.indexOf(this.currentImage)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-images-block"]],inputs:{imagesBlock:"imagesBlock",layout:"layout"},decls:1,vars:1,consts:()=>{let o,i,s,r;return o=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,i=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,s=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,r=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,[["class","imagesBlock","data-test","images-block",3,"images-block--slideshow",4,"ngIf"],["data-test","images-block",1,"imagesBlock"],[1,"images-block__content"],["class","images-block__image-container",3,"mb-3",4,"ngIf"],["class","images-block__caption",3,"markdownText",4,"ngIf"],["class","images-block__actions",4,"ngIf"],[1,"images-block__image-container"],[1,"images-block__image-view",3,"src","fullscreenSrc","alt","fit","fitSize"],[1,"images-block__caption",3,"markdownText"],[1,"images-block__actions"],["type","button","app-view-button","","buttonSize","sm","matTooltip",o,"aria-label",i,3,"click"],["icon","chevron-left"],["type","button","app-view-button","","buttonSize","sm","matTooltip",s,"aria-label",r,3,"click"],["icon","chevron-right"]]},template:function(i,s){1&i&&t.DNE(0,cR,5,5,"div",0),2&i&&t.Y8G("ngIf",s.currentImage)},dependencies:[b.bT,xt,qe,Ws,sR,Sn.oV],styles:[".images-block__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.images-block__label{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;color:#374a68;font-weight:600;display:flex;align-items:center;min-height:28px}.images-block__image-container{display:flex;justify-content:center;background-color:#f9fafd}.images-block__image-view{display:flex;height:100%;min-height:32px}.images-block__caption{font-size:12px;margin-top:12px}.images-block__actions{display:flex;justify-content:flex-end;margin-top:14px}.images-block--slideshow .images-block__image-container{height:200px}\n"],encapsulation:2,changeDetection:0}),e})();const pR=["target"];var Mp=function(n){return n.Basic="basic",n.Full="full",n}(Mp||{});const uR={[Mp.Basic]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay"],[Mp.Full]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","customControlSpacer","pictureInPictureToggle","fullscreenToggle"]};let E1=(()=>{var n;class e{constructor(i){this.mediaService=i}ngOnInit(){var i=this;return(0,J.A)(function*(){i.playerId=yield i.mediaService.addVideoPlayer(i.target.nativeElement,{preload:"metadata",sources:i.sources,fluid:!0,controls:!0,responsive:!0,controlBar:{volumePanel:{inline:!1},children:uR[i.mode]},breakpoints:{tiny:200}})})()}ngOnDestroy(){this.playerId&&this.mediaService.removeVideoPlayer(this.playerId)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(Di))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-video-view"]],viewQuery:function(i,s){if(1&i&&t.GBs(pR,7),2&i){let r;t.mGM(r=t.lsd())&&(s.target=r.first)}},inputs:{sources:"sources",mode:"mode"},decls:2,vars:0,consts:[["target",""]],template:function(i,s){1&i&&t.nrm(0,"video-js",null,0)},styles:['@charset "UTF-8";.vjs-modal-dialog .vjs-modal-dialog-content,.video-js .vjs-modal-dialog,.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{text-align:center}@font-face{font-family:VideoJS;src:url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABDkAAsAAAAAG6gAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPgAAAFZRiV3hY21hcAAAAYQAAADaAAADPv749/pnbHlmAAACYAAAC3AAABHQZg6OcWhlYWQAAA3QAAAAKwAAADYZw251aGhlYQAADfwAAAAdAAAAJA+RCLFobXR4AAAOHAAAABMAAACM744AAGxvY2EAAA4wAAAASAAAAEhF6kqubWF4cAAADngAAAAfAAAAIAE0AIFuYW1lAAAOmAAAASUAAAIK1cf1oHBvc3QAAA/AAAABJAAAAdPExYuNeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS7wTiBgZWBgaWQ5RkDA8MvCM0cwxDOeI6BgYmBlZkBKwhIc01hcPjI+FGJHcRdyA4RZgQRADK3CxEAAHic7dFZbsMgAEXRS0ycyZnnOeG7y+qC8pU1dHusIOXxuoxaOlwZYWQB0Aea4quIEN4E9LzKbKjzDeM6H/mua6Lmc/p8yhg0lvdYx15ZG8uOLQOGjMp3EzqmzJizYMmKNRu27Nhz4MiJMxeu3Ljz4Ekqm7T8P52G8PP3lnTOVk++Z6iN6QZzNN1F7ptuN7eGOjDUoaGODHVsuvU8MdTO9Hd5aqgzQ50b6sJQl4a6MtS1oW4MdWuoO0PdG+rBUI+GejLUs6FeDPVqqDdDvRvqw1CfhpqM9At0iFLaAAB4nJ1YDXBTVRZ+5/22TUlJ8we0pHlJm7RJf5O8F2j6EymlSPkpxaL8U2xpa3DKj0CBhc2IW4eWKSokIoLsuMqssM64f+jA4HSdWXXXscBq67IOs3FXZ1ZYWVyRFdo899yXtIBQZ90k7717zz3v3HPPOfd854YCCj9cL9dL0RQFOqCbGJnrHb5EayiKIWN8iA/hWBblo6hUWm8TtCDwE80WMJus/irwyxOdxeB0MDb14VNJHnXYoLLSl6FfCUYO9nYPTA8Epg9090LprfbBbZ2hY0UlJUXHQp3/vtWkS6EBv8+rPMq5u9692f/dNxJNiqwC1xPE9TCUgCsSdQWgE3XQD25lkG4CN2xmTcOXWBOyser6RN6KnGbKSbmQ3+d0OI1m2W8QzLLkI2sykrWAgJJEtA8vGGW/2Q+CmT3n8zS9wZwu2DCvtuZKZN3xkrLh36yCZuUomQSqGpY8t/25VfHVhw8z4ebGBtfLb0ya9PCaDc+8dGTvk2dsh6z7WzvowlXKUSWo9MJ15a3KrEP2loOr2Ojhw6iW6hf2BDdEccQvZGpaAy7YovSwq8kr7HGllxpd71rkS6G0Sf11sl9OvMK1+jwPPODxjUwkOim9CU3ix1wNjXDfmJSEn618Bs6lpWwUpU+8PCqLMY650zjq8VhCIP17NEKTx3eaLL+s5Pi6yJWaWjTHLR1jYzPSV9VF/6Ojdb/1kO3Mk3uhHC0x6gc1BjlKQ+nQFxTYdaJkZ7ySVxLBbhR1dsboNXp1tCYKW2LRaEzpYcIx2BKNxaL0ZaUnSqfFoiNhHKR/GkX6PWUSAaJelQaqZL1EpoHNsajSEyPSoJ9IjhIxTdjHLmwZvhRDOiFTY/YeQnvrVZmiTQtGncECXtFTBZLOVwwMRgoXHAkXzMzPn1nAJJ8jYSbMDaqN2waGLzNhih/bZynUBMpIWSg7VYi7DRx2m8ALkIdRCJwI6ArJx2EI8kaDWeTQKeAFk9fjl/1AvwktjQ1P7NjyMGQyfd4vjipX6M/i52D7Cq80kqlcxEcGXRr/FEcgs0u5uGgB4VWuMFfpdn2Re6Hi3PqzmxWKsz6+ae2Pn9hXXw/fqM859UiGC0oKYYILJBqJrsn1Z1E5qOs9rQCiUQRREjm8yJcbHF5cUJufX1vAHlefw0XgUoboS3ETfQlTxBC4SOtuE8VPRJTBSCQSjZCpk7Gqzu+masaZ2y7Zjehho4F3g82BNDkAHpORG4+OCS+f6JTPmtRn/PH1kch6d04sp7AQb25aQ/pqUyXeQ8vrebG8OYQdXOQ+585u0sdW9rqalzRURiJ+9F4MweRFrKUjl1GUYhH1A27WOHw5cTFSFPMo9EeUIGnQTZHIaJ7AHLaOKsOODaNF9jkBjYG2QEsQ2xjMUAx2bBEbeTBWMHwskBjngq56S/yfgkBnWBa4K9sqKtq2t1UI8S9He5XuBRbawAdatrQEAi30Aks2+LM8WeCbalVZkWNylvJ+dqJnzVb+OHlSoKW8nPCP7Rd+CcZ2DdWAGqJ2CBFOphgywFFCFBNtfAbGtNPBCwxvygHeYMZMY9ZboBqwq/pVrsbgN5tkv152ODlbMfiqwGMBgxa4Exz3QhovRIUp6acqZmQzRq0ypDXS2TPLT02YIkQETnOE445oOGxOmXAqUJNNG7XgupMjPq2ua9asrj5yY/yuKteO1Kx0YNJTufrirLe1mZnat7OL6rnUdCWenpW6I8mAnbsY8KWs1PuSovCW9A/Z25PQ24a7cNOqgmTkLmBMgh4THgc4b9k2IVv1/g/F5nGljwPLfOgHAzJzh45V/4+WenTzmMtR5Z7us2Tys909UHqrPY7KbckoxRvRHhmVc3cJGE97uml0R1S0jdULVl7EvZtDFVBF35N9cEdjpgmAiOlFZ+Dtoh93+D3zzHr8RRNZQhnCNMNbcegOvpEwZoL+06cJQ07h+th3fZ/7PVbVC6ngTAV/KoLFuO6+2KFcU651gEb5ugPSIb1D+Xp8V4+k3sEIGnw5mYe4If4k1lFYr6SCzmM2EQ8iWtmwjnBI9kTwe1TlfAmXh7H02by9fW2gsjKwtv0aaURKil4OdV7rDL1MXIFNrhdxohcZXYTnq47WisrKitaObbf5+yvkLi5J6lCNZZ+B6GC38VNBZBDidSS/+mSvh6s+srgC8pyKMvDtt+de3c9fU76ZPfuM8ud4Kv0fyP/LqfepMT/3oZxSqpZaTa1DaQYLY8TFsHYbWYsPoRhRWfL5eSSQbhUGgGC3YLbVMk6PitTFNGpAsNrC6D1VNBKgBHMejaiuRWEWGgsSDBTJjqWIl8kJLlsaLJ2tXDr6xGfT85bM2Q06a46x2HTgvdnV8z5YDy/27J4zt6x2VtkzjoYpkq36kaBr4eQSg7tyiVweWubXZugtadl58ydapfbORfKsDTuZ0OBgx4cfdjCf5tbWNITnL120fdOi1RV1C3uKGzNdwYLcMvZ3BxoPyTOCD1XvXTp7U10gWCVmTV9b3r2z0SkGWovb2hp9I89O8a2smlyaO8muMU+dRmtzp60IzAoFpjLr1n388boLyf0dRvxhsHZ0qbWqDkwqvvpkj4l0fY6EIXRi5sQSrAvsVYwXRy4qJ2EVtD1AN7a0HWth9ymvL1xc3WTUKK/TAHA/bXDVtVWfOMfuGxGZv4Ln/jVr9jc3j1yMv0tndmyt9Vq88Y9gH1wtLX3KWjot5++jWHgAoZZkQ14wGQ20Fli71UmKJAy4xKMSTGbVdybW7FDDAut9XpD5AzWrYO7zQ8qffqF8+Ynd/clrHcdyxGy3a/3+mfNnzC/cBsveTjnTvXf1o6vzOlZw7WtqtdmPK/Errz/6NNtD72zmNOZfbmYdTGHfoofqI79Oc+R2n1lrnL6pOm0Up7kwxhTW12Amm7WYkXR2qYrF2AmgmbAsxZjwy1xpg/m1Je2vrp8v/nz2xpmlBg4E9hrMU341wVpTOh/OfmGvAnra8q6uctr60ZQHV3Q+WMQJykMj8ZsWn2QBOmmHMB+m5pDIpTFonYigiaKAhGEiAHF7EliVnQkjoLVIMPtJpBKHYd3A8GYH9jJzrWwmHx5Qjp7vDAX0suGRym1vtm/9W1/HyR8vczfMs6Sk8DSv855/5dlX9oQq52hT8syyp2rx5Id17IAyAM3wIjQPMOHzytEB64q6D5zT91yNbnx3V/nqnd017S9Y0605k3izoXLpsxde2n38yoOV9s1LcjwzNjbdX6asnBVaBj/6/DwKwPkpcqbDG7BnsXoSqWnUAmottYF6jMSdVyYZh3zVXCjwTiwwHH6sGuRiEHQGzuRX6whZkp123oy1BWE2mEfJ/tvIRtM4ZM5bDXiMsPMaAKOTyc5uL57rqyyc5y5JE5pm1i2S2iUX0CcaQ6lC6Zog7JqSqZmYlosl2K6pwNA84zRnQW6SaALYZQGW5lhCtU/W34N6o+bKfZ8cf3/Cl/+iTX3wBzpOY4mRkeNf3rptycGSshQWgGbYt5jFc2e0+DglIrwl6DVWQ7BuwaJ3Xk1J4VL5urnLl/Wf+gHU/hZoZdKNym6lG+I34FaNeZKcSpJIo2IeCVvpdsDGfKvzJnAwmeD37Ow65ZWwSowpgwX5T69s/rB55dP5BcpgDKFV8p7q2sn/1uc93bVzT/w6UrCqDTWvfCq/oCD/qZXNoUj8BL5Kp6GU017frfNXkAtiiyf/SOCEeLqnd8R/Ql9GlCRfctS6k5chvIBuQ1zCCjoCHL2DHNHIXxMJ3kQeO8lbsUXONeSfA5EjcG6/E+KdhN4bP04vBhdi883+BFBzQbxFbvZzQeY9LNBZc0FNfn5NwfDn6rCTnTw6R8o+gfpf5hCom33cRuiTlss3KHmZjD+BPN+5gXuA2ziS/Q73mLxUkpbKN/eqwz5uK0X9F3h2d1V4nGNgZGBgAOJd776+iue3+crAzc4AAje5Bfcg0xz9YHEOBiYQBQA8FQlFAHicY2BkYGBnAAGOPgaG//85+hkYGVCBMgBGGwNYAAAAeJxjYGBgYB8EmKOPgQEAQ04BfgAAAAAAAA4AaAB+AMwA4AECAUIBbAGYAcICGAJYArQC4AMwA7AD3gQwBJYE3AUkBWYFigYgBmYGtAbqB1gIEghYCG4IhAi2COh4nGNgZGBgUGYoZWBnAAEmIOYCQgaG/2A+AwAYCQG2AHicXZBNaoNAGIZfE5PQCKFQ2lUps2oXBfOzzAESyDKBQJdGR2NQR3QSSE/QE/QEPUUPUHqsvsrXjTMw83zPvPMNCuAWP3DQDAejdm1GjzwS7pMmwi75XngAD4/CQ/oX4TFe4Qt7uMMbOzjuDc0EmXCP/C7cJ38Iu+RP4QEe8CU8pP8WHmOPX2EPz87TPo202ey2OjlnQSXV/6arOjWFmvszMWtd6CqwOlKHq6ovycLaWMWVydXKFFZnmVFlZU46tP7R2nI5ncbi/dDkfDtFBA2DDXbYkhKc+V0Bqs5Zt9JM1HQGBRTm/EezTmZNKtpcAMs9Yu6AK9caF76zoLWIWcfMGOSkVduvSWechqZsz040Ib2PY3urxBJTzriT95lipz+TN1fmAAAAeJxtkMl2wjAMRfOAhABlKm2h80C3+ajgCKKDY6cegP59TYBzukAL+z1Zsq8ctaJTTKPrsUQLbXQQI0EXKXroY4AbDDHCGBNMcYsZ7nCPB8yxwCOe8IwXvOIN7/jAJ76wxHfUqWX+OzgumWAjJMV17i0Ndlr6irLKO+qftdT7i6y4uFSUvCknay+lFYZIZaQcmfH/xIFdYn98bqhra1aKTM/6lWMnyaYirx1rFUQZFBkb2zJUtoXeJCeg0WnLtHeSFc3OtrnozNwqi0TkSpBMDB1nSde5oJXW23hTS2/T0LilglXX7dmFVxLnq5U0vYATHFk3zX3BOisoQHNDFDeZnqKDy9hRNawN7Vh727hFzcJ5c8TILrKZfH7tIPxAFP0BpLeJPA==) format("woff");font-weight:400;font-style:normal}.vjs-icon-play,.video-js .vjs-play-control .vjs-icon-placeholder,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play:before,.video-js .vjs-play-control .vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{content:"\\f101"}.vjs-icon-play-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play-circle:before{content:"\\f102"}.vjs-icon-pause,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pause:before,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f103"}.vjs-icon-volume-mute,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mute:before,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f104"}.vjs-icon-volume-low,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-low:before,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder:before{content:"\\f105"}.vjs-icon-volume-mid,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mid:before,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder:before{content:"\\f106"}.vjs-icon-volume-high,.video-js .vjs-mute-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-high:before,.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f107"}.vjs-icon-fullscreen-enter,.video-js .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-enter:before,.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f108"}.vjs-icon-fullscreen-exit,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-exit:before,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f109"}.vjs-icon-square{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-square:before{content:"\\f10a"}.vjs-icon-spinner{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-spinner:before{content:"\\f10b"}.vjs-icon-subtitles,.video-js .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-subtitles-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-subtitles:before,.video-js .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-subtitles-button .vjs-icon-placeholder:before{content:"\\f10c"}.vjs-icon-captions,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-captions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-captions:before,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-captions-button .vjs-icon-placeholder:before{content:"\\f10d"}.vjs-icon-chapters,.video-js .vjs-chapters-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-chapters:before,.video-js .vjs-chapters-button .vjs-icon-placeholder:before{content:"\\f10e"}.vjs-icon-share{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-share:before{content:"\\f10f"}.vjs-icon-cog{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cog:before{content:"\\f110"}.vjs-icon-circle,.vjs-seek-to-live-control .vjs-icon-placeholder,.video-js .vjs-volume-level,.video-js .vjs-play-progress{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle:before,.vjs-seek-to-live-control .vjs-icon-placeholder:before,.video-js .vjs-volume-level:before,.video-js .vjs-play-progress:before{content:"\\f111"}.vjs-icon-circle-outline{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-outline:before{content:"\\f112"}.vjs-icon-circle-inner-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-inner-circle:before{content:"\\f113"}.vjs-icon-hd{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-hd:before{content:"\\f114"}.vjs-icon-cancel,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cancel:before,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder:before{content:"\\f115"}.vjs-icon-replay,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-replay:before,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f116"}.vjs-icon-facebook{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-facebook:before{content:"\\f117"}.vjs-icon-gplus{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-gplus:before{content:"\\f118"}.vjs-icon-linkedin{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-linkedin:before{content:"\\f119"}.vjs-icon-twitter{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-twitter:before{content:"\\f11a"}.vjs-icon-tumblr{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-tumblr:before{content:"\\f11b"}.vjs-icon-pinterest{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pinterest:before{content:"\\f11c"}.vjs-icon-audio-description,.video-js .vjs-descriptions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio-description:before,.video-js .vjs-descriptions-button .vjs-icon-placeholder:before{content:"\\f11d"}.vjs-icon-audio,.video-js .vjs-audio-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio:before,.video-js .vjs-audio-button .vjs-icon-placeholder:before{content:"\\f11e"}.vjs-icon-next-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-next-item:before{content:"\\f11f"}.vjs-icon-previous-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-previous-item:before{content:"\\f120"}.vjs-icon-picture-in-picture-enter,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-enter:before,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f121"}.vjs-icon-picture-in-picture-exit,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-exit:before,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f122"}.video-js{display:block;vertical-align:top;box-sizing:border-box;color:#fff;background-color:#000;position:relative;padding:0;font-size:10px;line-height:1;font-weight:400;font-style:normal;font-family:Arial,Helvetica,sans-serif;word-break:initial}.video-js:-moz-full-screen{position:absolute}.video-js:-webkit-full-screen{width:100%!important;height:100%!important}.video-js[tabindex="-1"]{outline:none}.video-js *,.video-js *:before,.video-js *:after{box-sizing:inherit}.video-js ul{font-family:inherit;font-size:inherit;line-height:inherit;list-style-position:outside;margin:0}.video-js.vjs-fluid,.video-js.vjs-16-9,.video-js.vjs-4-3,.video-js.vjs-9-16,.video-js.vjs-1-1{width:100%;max-width:100%}.video-js.vjs-fluid:not(.vjs-audio-only-mode),.video-js.vjs-16-9:not(.vjs-audio-only-mode),.video-js.vjs-4-3:not(.vjs-audio-only-mode),.video-js.vjs-9-16:not(.vjs-audio-only-mode),.video-js.vjs-1-1:not(.vjs-audio-only-mode){height:0}.video-js.vjs-16-9:not(.vjs-audio-only-mode){padding-top:56.25%}.video-js.vjs-4-3:not(.vjs-audio-only-mode){padding-top:75%}.video-js.vjs-9-16:not(.vjs-audio-only-mode){padding-top:177.7777777778%}.video-js.vjs-1-1:not(.vjs-audio-only-mode){padding-top:100%}.video-js.vjs-fill:not(.vjs-audio-only-mode){width:100%;height:100%}.video-js .vjs-tech{position:absolute;top:0;left:0;width:100%;height:100%}.video-js.vjs-audio-only-mode .vjs-tech{display:none}body.vjs-full-window{padding:0;margin:0;height:100%}.vjs-full-window .video-js.vjs-fullscreen{position:fixed;overflow:hidden;z-index:1000;inset:0}.video-js.vjs-fullscreen:not(.vjs-ios-native-fs){width:100%!important;height:100%!important;padding-top:0!important}.video-js.vjs-fullscreen.vjs-user-inactive{cursor:none}.vjs-hidden{display:none!important}.vjs-disabled{opacity:.5;cursor:default}.video-js .vjs-offscreen{height:1px;left:-9999px;position:absolute;top:0;width:1px}.vjs-lock-showing{display:block!important;opacity:1!important;visibility:visible!important}.vjs-no-js{padding:20px;color:#fff;background-color:#000;font-size:18px;font-family:Arial,Helvetica,sans-serif;text-align:center;width:300px;height:150px;margin:0 auto}.vjs-no-js a,.vjs-no-js a:visited{color:#66a8cc}.video-js .vjs-big-play-button{font-size:3em;line-height:1.5em;height:1.63332em;width:3em;display:block;position:absolute;top:10px;left:10px;padding:0;cursor:pointer;opacity:1;border:.06666em solid #fff;background-color:#2b333f;background-color:#2b333fb3;border-radius:.3em;transition:all .4s}.vjs-big-play-centered .vjs-big-play-button{top:50%;left:50%;margin-top:-.81666em;margin-left:-1.5em}.video-js:hover .vjs-big-play-button,.video-js .vjs-big-play-button:focus{border-color:#fff;background-color:#73859f;background-color:#73859f80;transition:all 0s}.vjs-controls-disabled .vjs-big-play-button,.vjs-has-started .vjs-big-play-button,.vjs-using-native-controls .vjs-big-play-button,.vjs-error .vjs-big-play-button{display:none}.vjs-has-started.vjs-paused.vjs-show-big-play-button-on-pause .vjs-big-play-button{display:block}.video-js button{background:none;border:none;color:inherit;display:inline-block;font-size:inherit;line-height:inherit;text-transform:none;text-decoration:none;transition:none;-webkit-appearance:none;appearance:none}.vjs-control .vjs-button{width:100%;height:100%}.video-js .vjs-control.vjs-close-button{cursor:pointer;height:3em;position:absolute;right:0;top:.5em;z-index:2}.video-js .vjs-modal-dialog{background:#000c;background:linear-gradient(180deg,#000c,#fff0);overflow:auto}.video-js .vjs-modal-dialog>*{box-sizing:border-box}.vjs-modal-dialog .vjs-modal-dialog-content{font-size:1.2em;line-height:1.5;padding:20px 24px;z-index:1}.vjs-menu-button{cursor:pointer}.vjs-menu-button.vjs-disabled{cursor:default}.vjs-workinghover .vjs-menu-button.vjs-disabled:hover .vjs-menu{display:none}.vjs-menu .vjs-menu-content{display:block;padding:0;margin:0;font-family:Arial,Helvetica,sans-serif;overflow:auto}.vjs-menu .vjs-menu-content>*{box-sizing:border-box}.vjs-scrubbing .vjs-control.vjs-menu-button:hover .vjs-menu{display:none}.vjs-menu li{list-style:none;margin:0;padding:.2em 0;line-height:1.4em;font-size:1.2em;text-align:center;text-transform:lowercase}.vjs-menu li.vjs-menu-item:focus,.vjs-menu li.vjs-menu-item:hover,.js-focus-visible .vjs-menu li.vjs-menu-item:hover{background-color:#73859f;background-color:#73859f80}.vjs-menu li.vjs-selected,.vjs-menu li.vjs-selected:focus,.vjs-menu li.vjs-selected:hover,.js-focus-visible .vjs-menu li.vjs-selected:hover{background-color:#fff;color:#2b333f}.video-js .vjs-menu *:not(.vjs-selected):focus:not(:focus-visible),.js-focus-visible .vjs-menu *:not(.vjs-selected):focus:not(.focus-visible){background:none}.vjs-menu li.vjs-menu-title{text-align:center;text-transform:uppercase;font-size:1em;line-height:2em;padding:0;margin:0 0 .3em;font-weight:700;cursor:default}.vjs-menu-button-popup .vjs-menu{display:none;position:absolute;bottom:0;width:10em;left:-3em;height:0em;margin-bottom:1.5em;border-top-color:#2b333fb3}.vjs-menu-button-popup .vjs-menu .vjs-menu-content{background-color:#2b333f;background-color:#2b333fb3;position:absolute;width:100%;bottom:1.5em;max-height:15em}.vjs-layout-tiny .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:5em}.vjs-layout-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:10em}.vjs-layout-medium .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:14em}.vjs-layout-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-huge .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:25em}.vjs-workinghover .vjs-menu-button-popup.vjs-hover .vjs-menu,.vjs-menu-button-popup .vjs-menu.vjs-lock-showing{display:block}.video-js .vjs-menu-button-inline{transition:all .4s;overflow:hidden}.video-js .vjs-menu-button-inline:before{width:2.222222222em}.video-js .vjs-menu-button-inline:hover,.video-js .vjs-menu-button-inline:focus,.video-js .vjs-menu-button-inline.vjs-slider-active,.video-js.vjs-no-flex .vjs-menu-button-inline{width:12em}.vjs-menu-button-inline .vjs-menu{opacity:0;height:100%;width:auto;position:absolute;left:4em;top:0;padding:0;margin:0;transition:all .4s}.vjs-menu-button-inline:hover .vjs-menu,.vjs-menu-button-inline:focus .vjs-menu,.vjs-menu-button-inline.vjs-slider-active .vjs-menu{display:block;opacity:1}.vjs-no-flex .vjs-menu-button-inline .vjs-menu{display:block;opacity:1;position:relative;width:auto}.vjs-no-flex .vjs-menu-button-inline:hover .vjs-menu,.vjs-no-flex .vjs-menu-button-inline:focus .vjs-menu,.vjs-no-flex .vjs-menu-button-inline.vjs-slider-active .vjs-menu{width:auto}.vjs-menu-button-inline .vjs-menu-content{width:auto;height:100%;margin:0;overflow:hidden}.video-js .vjs-control-bar{display:none;width:100%;position:absolute;bottom:0;left:0;right:0;height:3em;background-color:#2b333f;background-color:#2b333fb3}.vjs-has-started .vjs-control-bar,.vjs-audio-only-mode .vjs-control-bar{display:flex;visibility:visible;opacity:1;transition:visibility .1s,opacity .1s}.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{visibility:visible;opacity:0;pointer-events:none;transition:visibility 1s,opacity 1s}.vjs-controls-disabled .vjs-control-bar,.vjs-using-native-controls .vjs-control-bar,.vjs-error .vjs-control-bar{display:none!important}.vjs-audio.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar,.vjs-audio-only-mode.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{opacity:1;visibility:visible;pointer-events:auto}.vjs-has-started.vjs-no-flex .vjs-control-bar{display:table}.video-js .vjs-control{position:relative;text-align:center;margin:0;padding:0;height:100%;width:4em;flex:none}.video-js .vjs-control.vjs-visible-text{width:auto;padding-left:1em;padding-right:1em}.vjs-button>.vjs-icon-placeholder:before{font-size:1.8em;line-height:1.67}.vjs-button>.vjs-icon-placeholder{display:block}.video-js .vjs-control:focus:before,.video-js .vjs-control:hover:before,.video-js .vjs-control:focus{text-shadow:0em 0em 1em white}.video-js *:not(.vjs-visible-text)>.vjs-control-text{border:0;clip:rect(0 0 0 0);height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.vjs-no-flex .vjs-control{display:table-cell;vertical-align:middle}.video-js .vjs-custom-control-spacer{display:none}.video-js .vjs-progress-control{cursor:pointer;flex:auto;display:flex;align-items:center;min-width:4em;touch-action:none}.video-js .vjs-progress-control.disabled{cursor:default}.vjs-live .vjs-progress-control{display:none}.vjs-liveui .vjs-progress-control{display:flex;align-items:center}.vjs-no-flex .vjs-progress-control{width:auto}.video-js .vjs-progress-holder{flex:auto;transition:all .2s;height:.3em}.video-js .vjs-progress-control .vjs-progress-holder{margin:0 10px}.video-js .vjs-progress-control:hover .vjs-progress-holder{font-size:1.6666666667em}.video-js .vjs-progress-control:hover .vjs-progress-holder.disabled{font-size:1em}.video-js .vjs-progress-holder .vjs-play-progress,.video-js .vjs-progress-holder .vjs-load-progress,.video-js .vjs-progress-holder .vjs-load-progress div{position:absolute;display:block;height:100%;margin:0;padding:0;width:0}.video-js .vjs-play-progress{background-color:#fff}.video-js .vjs-play-progress:before{font-size:.9em;position:absolute;right:-.5em;top:-.3333333333em;z-index:1}.video-js .vjs-load-progress{background:#73859f80}.video-js .vjs-load-progress div{background:#73859fbf}.video-js .vjs-time-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-progress-holder:focus .vjs-time-tooltip{display:none}.video-js .vjs-progress-control:hover .vjs-time-tooltip,.video-js .vjs-progress-control:hover .vjs-progress-holder:focus .vjs-time-tooltip{display:block;font-size:.6em;visibility:visible}.video-js .vjs-progress-control.disabled:hover .vjs-time-tooltip{font-size:1em}.video-js .vjs-progress-control .vjs-mouse-display{display:none;position:absolute;width:1px;height:100%;background-color:#000;z-index:1}.vjs-no-flex .vjs-progress-control .vjs-mouse-display{z-index:0}.video-js .vjs-progress-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-progress-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-progress-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-time-tooltip{color:#fff;background-color:#000;background-color:#000c}.video-js .vjs-slider{position:relative;cursor:pointer;padding:0;margin:0 .45em;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;background-color:#73859f;background-color:#73859f80}.video-js .vjs-slider.disabled{cursor:default}.video-js .vjs-slider:focus{text-shadow:0em 0em 1em white;box-shadow:0 0 1em #fff}.video-js .vjs-mute-control{cursor:pointer;flex:none}.video-js .vjs-volume-control{cursor:pointer;margin-right:1em;display:flex}.video-js .vjs-volume-control.vjs-volume-horizontal{width:5em}.video-js .vjs-volume-panel .vjs-volume-control{visibility:visible;opacity:0;width:1px;height:1px;margin-left:-1px}.video-js .vjs-volume-panel{transition:width 1s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control,.video-js .vjs-volume-panel:active .vjs-volume-control,.video-js .vjs-volume-panel:focus .vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control:active,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active{visibility:visible;opacity:1;position:relative;transition:visibility .1s,opacity .1s,height .1s,width .1s,left 0s,top 0s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-horizontal,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-horizontal{width:5em;height:3em;margin-right:0}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-vertical,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-vertical{left:-3.5em;transition:left 0s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active{width:10em;transition:width .1s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-mute-toggle-only{width:4em}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:8em;width:3em;left:-3000em;transition:visibility 1s,opacity 1s,height 1s 1s,width 1s 1s,left 1s 1s,top 1s 1s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{transition:visibility 1s,opacity 1s,height 1s 1s,width 1s,left 1s 1s,top 1s 1s}.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{width:5em;height:3em;visibility:visible;opacity:1;position:relative;transition:none}.video-js.vjs-no-flex .vjs-volume-control.vjs-volume-vertical,.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{position:absolute;bottom:3em;left:.5em}.video-js .vjs-volume-panel{display:flex}.video-js .vjs-volume-bar{margin:1.35em .45em}.vjs-volume-bar.vjs-slider-horizontal{width:5em;height:.3em}.vjs-volume-bar.vjs-slider-vertical{width:.3em;height:5em;margin:1.35em auto}.video-js .vjs-volume-level{position:absolute;bottom:0;left:0;background-color:#fff}.video-js .vjs-volume-level:before{position:absolute;font-size:.9em;z-index:1}.vjs-slider-vertical .vjs-volume-level{width:.3em}.vjs-slider-vertical .vjs-volume-level:before{top:-.5em;left:-.3em;z-index:1}.vjs-slider-horizontal .vjs-volume-level{height:.3em}.vjs-slider-horizontal .vjs-volume-level:before{top:-.3em;right:-.5em}.video-js .vjs-volume-panel.vjs-volume-panel-vertical{width:4em}.vjs-volume-bar.vjs-slider-vertical .vjs-volume-level{height:100%}.vjs-volume-bar.vjs-slider-horizontal .vjs-volume-level{width:100%}.video-js .vjs-volume-vertical{width:3em;height:8em;bottom:8em;background-color:#2b333f;background-color:#2b333fb3}.video-js .vjs-volume-horizontal .vjs-menu{left:-2em}.video-js .vjs-volume-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-volume-control:hover .vjs-volume-tooltip,.video-js .vjs-volume-control:hover .vjs-progress-holder:focus .vjs-volume-tooltip{display:block;font-size:1em;visibility:visible}.video-js .vjs-volume-vertical:hover .vjs-volume-tooltip,.video-js .vjs-volume-vertical:hover .vjs-progress-holder:focus .vjs-volume-tooltip{left:1em;top:-12px}.video-js .vjs-volume-control.disabled:hover .vjs-volume-tooltip{font-size:1em}.video-js .vjs-volume-control .vjs-mouse-display{display:none;position:absolute;width:100%;height:1px;background-color:#000;z-index:1}.video-js .vjs-volume-horizontal .vjs-mouse-display{width:1px;height:100%}.vjs-no-flex .vjs-volume-control .vjs-mouse-display{z-index:0}.video-js .vjs-volume-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-volume-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-volume-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-volume-tooltip{color:#fff;background-color:#000;background-color:#000c}.vjs-poster{display:inline-block;vertical-align:middle;background-repeat:no-repeat;background-position:50% 50%;background-size:contain;background-color:#000;cursor:pointer;margin:0;padding:0;position:absolute;inset:0;height:100%}.vjs-has-started .vjs-poster,.vjs-using-native-controls .vjs-poster{display:none}.vjs-audio.vjs-has-started .vjs-poster,.vjs-has-started.vjs-audio-poster-mode .vjs-poster{display:block}.video-js .vjs-live-control{display:flex;align-items:flex-start;flex:auto;font-size:1em;line-height:3em}.vjs-no-flex .vjs-live-control{display:table-cell;width:auto;text-align:left}.video-js:not(.vjs-live) .vjs-live-control,.video-js.vjs-liveui .vjs-live-control{display:none}.video-js .vjs-seek-to-live-control{align-items:center;cursor:pointer;flex:none;display:inline-flex;height:100%;padding-left:.5em;padding-right:.5em;font-size:1em;line-height:3em;width:auto;min-width:4em}.vjs-no-flex .vjs-seek-to-live-control{display:table-cell;width:auto;text-align:left}.video-js.vjs-live:not(.vjs-liveui) .vjs-seek-to-live-control,.video-js:not(.vjs-live) .vjs-seek-to-live-control{display:none}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge{cursor:auto}.vjs-seek-to-live-control .vjs-icon-placeholder{margin-right:.5em;color:#888}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge .vjs-icon-placeholder{color:red}.video-js .vjs-time-control{flex:none;font-size:1em;line-height:3em;min-width:2em;width:auto;padding-left:1em;padding-right:1em}.vjs-live .vjs-time-control,.video-js .vjs-current-time,.vjs-no-flex .vjs-current-time,.video-js .vjs-duration,.vjs-no-flex .vjs-duration{display:none}.vjs-time-divider{display:none;line-height:3em}.vjs-live .vjs-time-divider{display:none}.video-js .vjs-play-control{cursor:pointer}.video-js .vjs-play-control .vjs-icon-placeholder{flex:none}.vjs-text-track-display{position:absolute;inset:0 0 3em;pointer-events:none}.video-js.vjs-controls-disabled .vjs-text-track-display,.video-js.vjs-user-inactive.vjs-playing .vjs-text-track-display{bottom:1em}.video-js .vjs-text-track{font-size:1.4em;text-align:center;margin-bottom:.1em}.vjs-subtitles{color:#fff}.vjs-captions{color:#fc6}.vjs-tt-cue{display:block}video::-webkit-media-text-track-display{transform:translateY(-3em)}.video-js.vjs-controls-disabled video::-webkit-media-text-track-display,.video-js.vjs-user-inactive.vjs-playing video::-webkit-media-text-track-display{transform:translateY(-1.5em)}.video-js .vjs-picture-in-picture-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-picture-in-picture-control{display:none}.video-js .vjs-fullscreen-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-fullscreen-control{display:none}.vjs-playback-rate>.vjs-menu-button,.vjs-playback-rate .vjs-playback-rate-value{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-playback-rate .vjs-playback-rate-value{pointer-events:none;font-size:1.5em;line-height:2;text-align:center}.vjs-playback-rate .vjs-menu{width:4em;left:0}.vjs-error .vjs-error-display .vjs-modal-dialog-content{font-size:1.4em;text-align:center}.vjs-error .vjs-error-display:before{color:#fff;content:"X";font-family:Arial,Helvetica,sans-serif;font-size:4em;left:0;line-height:1;margin-top:-.5em;position:absolute;text-shadow:.05em .05em .1em #000;text-align:center;top:50%;vertical-align:middle;width:100%}.vjs-loading-spinner{display:none;position:absolute;top:50%;left:50%;margin:-25px 0 0 -25px;opacity:.85;text-align:left;border:6px solid rgba(43,51,63,.7);box-sizing:border-box;background-clip:padding-box;width:50px;height:50px;border-radius:25px;visibility:hidden}.vjs-seeking .vjs-loading-spinner,.vjs-waiting .vjs-loading-spinner{display:block;animation:vjs-spinner-show 0s linear .3s forwards}.vjs-loading-spinner:before,.vjs-loading-spinner:after{content:"";position:absolute;margin:-6px;box-sizing:inherit;width:inherit;height:inherit;border-radius:inherit;opacity:1;border:inherit;border-color:transparent;border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:before,.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:after{animation:vjs-spinner-spin 1.1s cubic-bezier(.6,.2,0,.8) infinite,vjs-spinner-fade 1.1s linear infinite}.vjs-seeking .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:before{border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:after{border-top-color:#fff;animation-delay:.44s}@keyframes vjs-spinner-show{to{visibility:visible}}@keyframes vjs-spinner-spin{to{transform:rotate(360deg)}}@keyframes vjs-spinner-fade{0%{border-top-color:#73859f}20%{border-top-color:#73859f}35%{border-top-color:#fff}60%{border-top-color:#73859f}to{border-top-color:#73859f}}.video-js.vjs-audio-only-mode .vjs-captions-button{display:none}.vjs-chapters-button .vjs-menu ul{width:24em}.video-js.vjs-audio-only-mode .vjs-descriptions-button{display:none}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:"\\f10d";font-size:1.5em;line-height:inherit}.video-js.vjs-audio-only-mode .vjs-subs-caps-button{display:none}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:" \\f11d";font-size:1.5em;line-height:inherit}.video-js.vjs-layout-small .vjs-current-time,.video-js.vjs-layout-small .vjs-time-divider,.video-js.vjs-layout-small .vjs-duration,.video-js.vjs-layout-small .vjs-remaining-time,.video-js.vjs-layout-small .vjs-playback-rate,.video-js.vjs-layout-small .vjs-volume-control,.video-js.vjs-layout-x-small .vjs-current-time,.video-js.vjs-layout-x-small .vjs-time-divider,.video-js.vjs-layout-x-small .vjs-duration,.video-js.vjs-layout-x-small .vjs-remaining-time,.video-js.vjs-layout-x-small .vjs-playback-rate,.video-js.vjs-layout-x-small .vjs-volume-control,.video-js.vjs-layout-tiny .vjs-current-time,.video-js.vjs-layout-tiny .vjs-time-divider,.video-js.vjs-layout-tiny .vjs-duration,.video-js.vjs-layout-tiny .vjs-remaining-time,.video-js.vjs-layout-tiny .vjs-playback-rate,.video-js.vjs-layout-tiny .vjs-volume-control{display:none}.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover{width:auto;width:initial}.video-js.vjs-layout-x-small .vjs-progress-control,.video-js.vjs-layout-tiny .vjs-progress-control{display:none}.video-js.vjs-layout-x-small .vjs-custom-control-spacer{flex:auto;display:block}.video-js.vjs-layout-x-small.vjs-no-flex .vjs-custom-control-spacer{width:auto}.vjs-modal-dialog.vjs-text-track-settings{background-color:#2b333f;background-color:#2b333fbf;color:#fff;height:70%}.vjs-text-track-settings .vjs-modal-dialog-content{display:table}.vjs-text-track-settings .vjs-track-settings-colors,.vjs-text-track-settings .vjs-track-settings-font,.vjs-text-track-settings .vjs-track-settings-controls{display:table-cell}.vjs-text-track-settings .vjs-track-settings-controls{text-align:right;vertical-align:bottom}@supports (display: grid){.vjs-text-track-settings .vjs-modal-dialog-content{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;padding:20px 24px 0}.vjs-track-settings-controls .vjs-default-button{margin-bottom:20px}.vjs-text-track-settings .vjs-track-settings-controls{grid-column:1/-1}.vjs-layout-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-x-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-tiny .vjs-text-track-settings .vjs-modal-dialog-content{grid-template-columns:1fr}}.vjs-track-setting>select{margin-right:1em;margin-bottom:.5em}.vjs-text-track-settings fieldset{margin:5px;padding:3px;border:none}.vjs-text-track-settings fieldset span{display:inline-block}.vjs-text-track-settings fieldset span>select{max-width:7.3em}.vjs-text-track-settings legend{color:#fff;margin:0 0 5px}.vjs-text-track-settings .vjs-label{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);display:block;margin:0 0 5px;padding:0;border:0;height:1px;width:1px;overflow:hidden}.vjs-track-settings-controls button:focus,.vjs-track-settings-controls button:active{outline-style:solid;outline-width:medium;background-image:linear-gradient(0deg,#fff 88%,#73859f)}.vjs-track-settings-controls button:hover{color:#2b333fbf}.vjs-track-settings-controls button{background-color:#fff;background-image:linear-gradient(-180deg,#fff 88%,#73859f);color:#2b333f;cursor:pointer;border-radius:2px}.vjs-track-settings-controls .vjs-default-button{margin-right:1em}@media print{.video-js>*:not(.vjs-tech):not(.vjs-poster){visibility:hidden}}.vjs-resize-manager{position:absolute;top:0;left:0;width:100%;height:100%;border:none;z-index:-1000}.js-focus-visible .video-js *:focus:not(.focus-visible){outline:none}.video-js *:focus:not(:focus-visible){outline:none}.video-js.vjs-fluid{width:1280px}.video-js .vjs-time-control{padding:0 4px!important;min-width:auto!important;height:30px!important;font-size:12px;align-items:center}.video-js .vjs-volume-control,.video-js .vjs-time-control{display:flex!important}.video-js :not(.vjs-has-started) .vjs-big-play-button{display:flex}.video-js .vjs-icon-placeholder:before{font-family:"Font Awesome 6 Pro"}.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{font-family:VideoJS}.video-js .vjs-big-play-button{align-items:center;justify-content:center;border:none!important;border-radius:50%!important;background-color:#101823cc!important;top:50%;left:50%;height:60px!important;width:60px!important;margin-left:-30px;margin-top:-30px;font-size:24px;transition:none!important}.video-js .vjs-big-play-button .vjs-icon-placeholder{margin-right:-8%}.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:static;content:"\\f04b";font-family:"Font Awesome 6 Pro";font-weight:900}.video-js .vjs-play-control .vjs-icon-placeholder:before{content:"\\f04b"}.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f04c"}.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f2ea"}.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f6a8"}.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f2e2"}.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f065"}.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f066"}.video-js .vjs-control-bar{flex-wrap:wrap;height:5em}.video-js .vjs-control{height:3em}.video-js .vjs-progress-control{width:100%!important;height:2em!important}.video-js .vjs-custom-control-spacer{display:block;flex:auto}.video-js .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.5em;line-height:2em}.video-js.vjs-layout-tiny .vjs-control-bar{height:4.5em}.video-js.vjs-layout-tiny .vjs-control{height:2.5em;width:2.5em}.video-js.vjs-layout-tiny .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.2em;line-height:2.2em}.video-js.vjs-layout-tiny .vjs-button>.vjs-icon-placeholder:before{font-size:1.6em}.video-js.vjs-layout-tiny .vjs-progress-control{display:flex!important}.video-js.vjs-layout-tiny .vjs-progress-control .vjs-progress-holder{margin:0 8px}.video-js.vjs-layout-tiny .vjs-time-control{display:none!important}.video-js.vjs-layout-tiny .vjs-volume-bar.vjs-slider-vertical{height:4em!important}.video-js.vjs-layout-tiny .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:6em!important;bottom:6em!important;width:2.5em!important}.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-2.5em!important}.video-js.vjs-layout-tiny .vjs-big-play-button{height:48px!important;width:48px!important;margin-left:-24px;margin-top:-24px;font-size:18px}.video-js.vjs-layout-x-small .vjs-progress-control{display:flex!important}.video-js.vjs-layout-x-small .vjs-control{width:3em}.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-3em!important}.vjs-error .vjs-error-display:before{content:"";display:none}\n'],encapsulation:2,changeDetection:0}),e})();function gR(n,e){if(1&n&&t.nrm(0,"app-video-view",10),2&n){const o=t.XpG(),i=o.$implicit,s=o.index,r=t.XpG(2);t.AVh("videos-block__video--next-sibling",s>0),t.Y8G("sources",i.sources)("mode",r.mode)}}function hR(n,e){1&n&&(t.j41(0,"div",15),t.pXf(1,1),t.k0s())}function mR(n,e){if(1&n&&(t.j41(0,"div",11)(1,"div",12)(2,"div",13),t.pXf(3,0),t.k0s(),t.DNE(4,hR,2,0,"div",14),t.k0s()()),2&n){const o=t.XpG().index,i=t.XpG(2);t.AVh("videos-block__video--next-sibling",o>0),t.R7$(4),t.Y8G("ngIf",i.emailMessage)}}function fR(n,e){if(1&n&&t.nrm(0,"app-html",16),2&n){const o=t.XpG().$implicit;t.Y8G("markdownText",o.caption)}}function SR(n,e){if(1&n&&(t.j41(0,"div"),t.qex(1,6),t.DNE(2,gR,1,4,"app-video-view",7)(3,mR,5,3,"div",8),t.bVm(),t.DNE(4,fR,1,1,"app-html",9),t.k0s()),2&n){const o=e.$implicit;t.R7$(),t.Y8G("ngSwitch",o.transcoded),t.R7$(),t.Y8G("ngSwitchCase",!0),t.R7$(),t.Y8G("ngSwitchCase",!1),t.R7$(),t.Y8G("ngIf",o.caption)}}function bR(n,e){if(1&n&&(t.j41(0,"div",3)(1,"div",4),t.DNE(2,SR,5,4,"div",5),t.k0s()()),2&n){const o=t.XpG();t.HbH("videos-block--"+o.layout),t.R7$(2),t.Y8G("ngForOf",o.videos)("ngForTrackBy",o.trackVideo)}}let yR=(()=>{var n;class e{get videosBlock(){return this._videosBlock}set videosBlock(i){this._videosBlock=i,this.videos=(0,m.get)(i,"videos",[]).map(s=>{const r={...s};return this.checkTranscodingStatus(r),r}),this.hasVideos=this.videos.length>0}constructor(i,s){this.mediaService=i,this.changeRef=s,this.layout=Tc.Normal,this.mode=Mp.Full,this.emailMessage=!1,this.videos=[],this.hasVideos=!1}checkTranscodingStatus(i){this.mediaService.checkVideoStatus(i.url).pipe((0,Vt.s)(1)).subscribe(s=>{s&&"boolean"!=typeof s?(i.sources=s,i.transcoded=!0):i.transcoded=!1,this.changeRef.markForCheck()})}trackVideo(i,s){return s.url}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(Di),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-videos-block"]],inputs:{layout:"layout",mode:"mode",emailMessage:"emailMessage",videosBlock:"videosBlock"},decls:1,vars:1,consts:()=>{let o,i;return o=$localize`:76807dc051a8773b9486978f33c7f05090c566fb2265850775265912967:Processing Video`,i=$localize`:3e4738ac862bbcd7a02a7355fe93de2f32521c544720931509138129579:Check your email for updates.`,[o,i,["class","videos-block","data-test","videoBlock",3,"class",4,"ngIf"],["data-test","videoBlock",1,"videos-block"],[1,"videos-block__content"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],["class","videos-block__video videos-block__video-view",3,"sources","mode","videos-block__video--next-sibling",4,"ngSwitchCase"],["class","videos-block__video videos-block__video-processing",3,"videos-block__video--next-sibling",4,"ngSwitchCase"],["class","videos-block__video-caption",3,"markdownText",4,"ngIf"],[1,"videos-block__video","videos-block__video-view",3,"sources","mode"],[1,"videos-block__video","videos-block__video-processing"],[1,"videos-block__video-processing-content"],[1,"text-xs","font-semibold"],["class","text-2xs mt-1",4,"ngIf"],[1,"text-2xs","mt-1"],[1,"videos-block__video-caption",3,"markdownText"]]},template:function(i,s){1&i&&t.DNE(0,bR,3,4,"div",2),2&i&&t.Y8G("ngIf",s.hasVideos)},dependencies:[b.Sq,b.bT,b.ux,b.e1,Ws,E1],styles:[".videos-block[_ngcontent-%COMP%]{color:#374a68}.videos-block__video[_ngcontent-%COMP%]{display:block}.videos-block__video--next-sibling[_ngcontent-%COMP%]{margin-top:20px}.videos-block__video-processing[_ngcontent-%COMP%]{padding-top:56.25%;position:relative;display:flex;justify-content:center;background-color:#fff;text-align:center;border:1px solid #96a8c0;border-radius:4px;min-width:180px}.videos-block__video-processing-content[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:0 8px}.videos-block__video-caption[_ngcontent-%COMP%]{display:block;font-size:12px;margin-top:12px}.videos-block--compact[_ngcontent-%COMP%]   .videos-block__video-caption[_ngcontent-%COMP%]{font-size:10px;margin-top:4px}"],changeDetection:0}),e})();class vR{constructor(){this.type=Fn.Positions,this.positions=[]}}const ER=["thumbnailView"];let TR=(()=>{var n;class e{get thumbnail(){return this._thumbnail}set thumbnail(i){(0,m.isEqual)(this._thumbnail,i)||(this._thumbnail=i,null!=i?this.setImageStyle():this.clearImageStyle())}constructor(i){this.renderer=i}setImageStyle(){let i=this.thumbnail.snapshot||this.thumbnail.urls.small;const s=(new Date).valueOf();i.startsWith("blob:")||(i=`${i}?cb=${s}&uncached=true`);const r=new Image;r.src=i,r.onload=()=>{this.renderer.setStyle(this.thumbnailView.nativeElement,"background-size","cover"),this.renderer.setStyle(this.thumbnailView.nativeElement,"background-image",`url(${i})`)}}clearImageStyle(){this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-size"),this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-image")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-thumbnail-view"]],viewQuery:function(i,s){if(1&i&&t.GBs(ER,7,t.aKT),2&i){let r;t.mGM(r=t.lsd())&&(s.thumbnailView=r.first)}},inputs:{thumbnail:"thumbnail"},decls:2,vars:0,consts:[["thumbnailView",""],[1,"thumbnail-view"]],template:function(i,s){1&i&&t.nrm(0,"div",1,0)},styles:[".thumbnail-view[_ngcontent-%COMP%]{background-color:#283853;background-image:url(/assets/images/logo-dark-transparent.svg);background-position:center center;background-repeat:no-repeat;background-size:25% 25%;border-radius:4px;height:100%;width:100%}.theme-light[_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%]{background-color:#eaeff5}"],changeDetection:0}),e})();function CR(n,e){if(1&n){const o=t.RV6();t.j41(0,"li",2)(1,"button",3),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.handlePositionClick(s))}),t.j41(2,"div",4),t.nrm(3,"app-thumbnail-view",5),t.k0s(),t.j41(4,"div",6),t.EFF(5),t.k0s()()()}if(2&n){const o=e.$implicit;t.R7$(3),t.Y8G("thumbnail",o.thumbnail),t.R7$(2),t.JRh(o.title)}}let OR=(()=>{var n;class e{constructor(i){this.store=i}handlePositionClick(i){this.store.dispatch(new di(i.camera.location,i.camera.action===La.FlyTo,void 0,i.camera.rotationCenter))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-position-block"]],inputs:{positionBlock:"positionBlock"},decls:2,vars:1,consts:[[1,"view-positions"],["class","view-positions__list-item",4,"ngFor","ngForOf"],[1,"view-positions__list-item"],[1,"view-positions__item",3,"click"],[1,"view-positions__thumbnail"],[3,"thumbnail"],[1,"view-positions__title"]],template:function(i,s){1&i&&(t.j41(0,"ul",0),t.DNE(1,CR,6,2,"li",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.positionBlock.positions))},dependencies:[b.Sq,TR],styles:[".view-positions__list-item[_ngcontent-%COMP%]{padding-bottom:8px}.view-positions__item[_ngcontent-%COMP%]{background:none;border:0;display:flex;padding:12px 12px 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:start;align-items:center}.view-positions__item[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.view-positions__item[_ngcontent-%COMP%]:hover, .view-positions__item--selected[_ngcontent-%COMP%]:hover{background-color:#131c2a0d}.view-positions__item--selected[_ngcontent-%COMP%]   .view-positions__title[_ngcontent-%COMP%]{font-weight:600}.view-positions__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-inline-end:12px;border:1px solid #eaeff5;border-radius:4px}.view-positions__title[_ngcontent-%COMP%]{color:#131c2a;font-size:.875rem;line-height:1.25rem;word-break:break-word}"],changeDetection:0}),e})();function wR(n,e){if(1&n&&t.nrm(0,"app-ticker-block",9),2&n){const o=t.XpG(2).$implicit;t.Y8G("tickerBlock",o)}}function MR(n,e){if(1&n&&(t.qex(0),t.DNE(1,wR,1,1,"app-ticker-block",8),t.bVm()),2&n){const o=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",o.enable)}}function IR(n,e){if(1&n&&t.nrm(0,"app-markdown-block",10),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.Y8G("markdownBlock",o)("layout",i.layout)}}function AR(n,e){if(1&n&&t.nrm(0,"app-images-block",11),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.Y8G("imagesBlock",o)("layout",i.layout)}}function PR(n,e){if(1&n&&t.nrm(0,"app-videos-block",12),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.Y8G("videosBlock",o)("layout",i.layout)}}function NR(n,e){if(1&n&&t.nrm(0,"app-position-block",13),2&n){const o=t.XpG().$implicit;t.Y8G("positionBlock",o)}}function RR(n,e){if(1&n&&(t.j41(0,"div"),t.qex(1,2),t.DNE(2,MR,2,1,"ng-container",3)(3,IR,1,2,"app-markdown-block",4)(4,AR,1,2,"app-images-block",5)(5,PR,1,2,"app-videos-block",6)(6,NR,1,1,"app-position-block",7),t.bVm(),t.k0s()),2&n){const o=e.$implicit,i=e.index,s=t.XpG(2);t.AVh("mt-6",i>0),t.R7$(),t.Y8G("ngSwitch",o.type),t.R7$(),t.Y8G("ngSwitchCase",s.contentBlockTypes.Ticker),t.R7$(),t.Y8G("ngSwitchCase",s.contentBlockTypes.Markdown),t.R7$(),t.Y8G("ngSwitchCase",s.contentBlockTypes.Images),t.R7$(),t.Y8G("ngSwitchCase",s.contentBlockTypes.Videos),t.R7$(),t.Y8G("ngSwitchCase",s.contentBlockTypes.Positions)}}function kR(n,e){if(1&n&&(t.qex(0),t.DNE(1,RR,7,8,"div",1),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.contentBlocks)("ngForTrackBy",o.trackContentBlock)}}let sl=(()=>{var n;class e{get contentBlocks(){return this.contentBlocksService.filterContentBlocksByType(this._contentBlocks,this.include,this.exclude)}set contentBlocks(i){this._contentBlocks=i}constructor(i){this.contentBlocksService=i,this.contentBlockTypes=Fn,this._contentBlocks=[],this.layout=Tc.Normal,this.include=[],this.exclude=[]}trackContentBlock(i,s){return s.type}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(Ar))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-content-blocks"]],inputs:{contentBlocks:"contentBlocks",layout:"layout",include:"include",exclude:"exclude"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"mt-6",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"markdownBlock","layout",4,"ngSwitchCase"],[3,"imagesBlock","layout",4,"ngSwitchCase"],[3,"videosBlock","layout",4,"ngSwitchCase"],[3,"positionBlock",4,"ngSwitchCase"],[3,"tickerBlock",4,"ngIf"],[3,"tickerBlock"],[3,"markdownBlock","layout"],[3,"imagesBlock","layout"],[3,"videosBlock","layout"],[3,"positionBlock"]],template:function(i,s){1&i&&t.DNE(0,kR,2,2,"ng-container",0),2&i&&t.Y8G("ngIf",s.contentBlocks.length>0)},dependencies:[b.Sq,b.bT,b.ux,b.e1,lf,ZN,dR,yR,OR],encapsulation:2,changeDetection:0}),e})();var wc,T1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},C1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const DR=["body"];function LR(n,e){if(1&n&&(t.nrm(0,"div",6),t.nI1(1,"markdown"),t.nI1(2,"async")),2&n){const o=t.XpG();t.Y8G("innerHTML",t.bMT(2,3,t.bMT(1,1,o.label.description)),t.npT)}}function UR(n,e){if(1&n&&(t.j41(0,"div",7),t.nrm(1,"app-content-blocks",8),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("contentBlocks",o.label.contentBlocks)("layout","compact")}}class Ip{get isCollapsed(){if(this.collapsedMode===Pr.Toggle){const e=this.store.selectSnapshot(ye.getSelectedLabelId)===this.label.id;return this.collapsed&&!e}return this.collapsed}get hasContent(){return this.labelsService.hasContent(this.label)}constructor(e,o,i,s){this.changeDetectorRef=e,this.labelsService=o,this.store=i,this.applicationEventService=s,this.emitEvents=!0,this.collapsedMode=Pr.None,this.collapsed=!1,this.pinDraggable=!1,this.tagDraggable=!1,this.descriptionCollapsed=!1,this.tagCollapsed=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.selectedLabel$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>this.handleLabelSelected(o)),this.store.select(ye.getChapterLabels).pipe((0,w.Q)(this.ngUnsubscribe),(0,Pn.B)(100)).subscribe(()=>{this.sequence=this.store.selectSnapshot(ye.getLabelSequence(this.label)),this.changeDetectorRef.markForCheck()}),this.descriptionCollapsed=this.label.collapseDescription,this.tagCollapsed=this.label.hideTag||!(this.label.title||this.hasContent)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleLabelUpdated(e){const{label:o,shouldPreserve:i}=e;this.store.dispatch(new Rr(o,i))}handleOffsetUpdated(e){const{labelId:o,offset:i}=e;this.store.dispatch(new eh(o,i))}handlePinClicked(e){this.selectLabel()}handleTagClicked(e){this.selectLabel()}selectLabel(){const e=this.store.selectSnapshot(ye.getSelectedLabel);this.store.dispatch(new is(e&&e.id===this.label.id?null:this.label)),this.emitEvent(Ce.HotspotsPicked,{id:this.label.id}),this.emitEvent(Ce.LabelsPicked,{labelId:this.label.id})}emitEvent(e,o){this.emitEvents&&this.applicationEventService.fireEvent(e,o)}handleDisplayUpdated(e){this.setBodyOpacity(e.shown),this.emitEvent(Ce.HotspotsDisplayUpdated,e)}handlePositionUpdated(e){this.emitEvent(Ce.HotspotsPositionUpdated,e.positionUpdate),this.emitEvent(Ce.LabelsMoved,{labelId:e.positionUpdate.id,canvasPosition:[e.positionUpdate.canvasPos.x,e.positionUpdate.canvasPos.y],occluded:e.positionUpdate.occluded||!e.onCanvas})}handleHoverStart(e){this.emitEvent(Ce.HotspotsEntered,{id:e.labelId}),this.emitEvent(Ce.LabelsEntered,{labelId:e.labelId})}handleHoverEnd(e){this.emitEvent(Ce.HotspotsLeft,{id:e.labelId}),this.emitEvent(Ce.LabelsLeft,{labelId:e.labelId})}handleLabelSelected(e){const o=e&&e.id===this.label.id,i=(0,m.get)(e,"states[1].errands"),s=this.store.selectSnapshot(vt.getLockCamera);o&&i&&!s&&i.forEach(a=>{switch(a.type){case Ni.flyToObject:this.store.dispatch(new To(a.value));break;case Ni.flyToCamera:this.store.dispatch(new di(a.value))}this.store.dispatch(new bg(!0))}),this.tagCollapsed=!this.label.title&&!this.hasContent||(this.label.expandTag&&this.label.hideTag?!o:this.label.hideTag),this.descriptionCollapsed=this.label.showDescription&&this.label.collapseDescription?!o:this.label.collapseDescription}handleBodyPointerDown(e){const o=this.body.nativeElement,i=o.offsetWidth-o.clientWidth;if(i>0){const r=o.getBoundingClientRect().right-i;e.clientX>r&&e.stopPropagation()}}handleBodyWheel(e){const o=this.body.nativeElement;o.scrollHeight>o.clientHeight&&e.stopPropagation()}setBodyOpacity(e){const o=this.body.nativeElement;e?o.style.removeProperty("opacity"):o.style.opacity="0"}}(wc=Ip).\u0275fac=function(e){return new(e||wc)(t.rXU(t.gRc),t.rXU(fr),t.rXU(c.il),t.rXU(mo))},wc.\u0275cmp=t.VBU({type:wc,selectors:[["app-story-label"]],viewQuery:function(e,o){if(1&e&&t.GBs(DR,7),2&e){let i;t.mGM(i=t.lsd())&&(o.body=i.first)}},inputs:{label:"label",emitEvents:"emitEvents",collapsedMode:"collapsedMode",collapsed:"collapsed",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},decls:10,vars:20,consts:[["body",""],[1,"story-label",3,"labelUpdated","offsetUpdated","tagClicked","pinClicked","keydown.enter","displayUpdated","positionUpdated","hoverStart","hoverEnd","label","selected","fixedScale","sequence","isCollapsed","tagCollapsed","pinDraggable","tagDraggable","descriptionCollapsed","hasContent"],["label-header","",1,"html",3,"innerHTML"],["label-body","",1,"story-label__body","html",3,"pointerdown","wheel"],["data-test","labelDescription",3,"innerHTML",4,"ngIf"],["class","my-1","appEventFence","","style","cursor: auto",4,"ngIf"],["data-test","labelDescription",3,"innerHTML"],["appEventFence","",1,"my-1",2,"cursor","auto"],[3,"contentBlocks","layout"]],template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"app-generic-label",1),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("labelUpdated",function(r){return t.eBV(i),t.Njj(o.handleLabelUpdated(r))})("offsetUpdated",function(r){return t.eBV(i),t.Njj(o.handleOffsetUpdated(r))})("tagClicked",function(r){return t.eBV(i),t.Njj(o.handleTagClicked(r))})("pinClicked",function(r){return t.eBV(i),t.Njj(o.handlePinClicked(r))})("keydown.enter",function(r){return t.eBV(i),t.Njj(o.handleTagClicked(r))})("displayUpdated",function(r){return t.eBV(i),t.Njj(o.handleDisplayUpdated(r))})("positionUpdated",function(r){return t.eBV(i),t.Njj(o.handlePositionUpdated(r))})("hoverStart",function(r){return t.eBV(i),t.Njj(o.handleHoverStart(r))})("hoverEnd",function(r){return t.eBV(i),t.Njj(o.handleHoverEnd(r))}),t.nrm(3,"div",2),t.nI1(4,"markdown"),t.nI1(5,"async"),t.j41(6,"div",3,0),t.bIt("pointerdown",function(r){return t.eBV(i),t.Njj(o.handleBodyPointerDown(r))})("wheel",function(r){return t.eBV(i),t.Njj(o.handleBodyWheel(r))}),t.DNE(8,LR,3,5,"div",4)(9,UR,2,2,"div",5),t.k0s()()}if(2&e){let i;t.Y8G("label",o.label)("selected",(null==(i=t.bMT(1,12,o.selectedLabel$))?null:i.id)===o.label.id)("fixedScale",t.bMT(2,14,o.labelScale$))("sequence",o.sequence)("isCollapsed",o.isCollapsed)("tagCollapsed",o.tagCollapsed)("pinDraggable",o.pinDraggable)("descriptionCollapsed",o.descriptionCollapsed)("hasContent",o.hasContent),t.R7$(3),t.Y8G("innerHTML",t.bMT(5,18,t.bMT(4,16,o.label.title)),t.npT),t.R7$(5),t.Y8G("ngIf",o.label.description),t.R7$(),t.Y8G("ngIf",o.label.contentBlocks)}},dependencies:[b.bT,bc,sl,ol,b.Jj,Ti.i0],styles:[".story-label__body[_ngcontent-%COMP%]{max-height:120px;overflow-x:hidden;overflow-y:auto;margin-right:-8px;padding-right:8px}"],changeDetection:0}),T1([(0,c.l6)(ye.getLabelScale),C1("design:type",f.c)],Ip.prototype,"labelScale$",void 0),T1([(0,c.l6)(ye.getSelectedLabel),C1("design:type",f.c)],Ip.prototype,"selectedLabel$",void 0);var K=S(9417);let VR=(()=>{var n;class e{get control(){return this.formControl||this.controlContainer.control.get(this.formControlName)}constructor(i){this.controlContainer=i}registerOnTouched(i){this.formControlDirective.valueAccessor.registerOnTouched(i)}registerOnChange(i){this.formControlDirective.valueAccessor.registerOnChange(i)}writeValue(i){this.formControlDirective.valueAccessor.writeValue(i)}setDisabledState(i){this.formControlDirective.valueAccessor.setDisabledState(i)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(K.ZU))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-base-accessor-control"]],viewQuery:function(i,s){if(1&i&&t.GBs(K.l_,7),2&i){let r;t.mGM(r=t.lsd())&&(s.formControlDirective=r.first)}},inputs:{formControl:"formControl",formControlName:"formControlName"},decls:0,vars:0,template:function(i,s){},encapsulation:2}),e})(),jR=(()=>{var n;class e{get value(){return this._value}set value(i){(0,m.isEqual)(this._value,i)||(this._value=i,this.setFormValues(i),this.onChange(i))}constructor(){}onChange(i){}onTouched(){}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}writeValue(i){this.value=i}setDisabledState(i){this.disabled=i}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-abstract-input-control"]],inputs:{value:"value",disabled:"disabled"},decls:0,vars:0,template:function(i,s){},encapsulation:2}),e})();function xR(n,e){if(1&n&&(t.j41(0,"option",9),t.EFF(1),t.k0s()),2&n){const o=e.$implicit;t.Y8G("value",o.value),t.R7$(),t.SpI(" ",o.label.title," ")}}function GR(n,e){if(1&n&&(t.j41(0,"select",6)(1,"option",7),t.EFF(2,"Select"),t.k0s(),t.DNE(3,xR,2,2,"option",8),t.k0s()),2&n){const o=t.XpG();t.R7$(3),t.Y8G("ngForOf",o.options)}}let O1=(()=>{var n;class e extends jR{get options(){return this._options}set options(i){const s=(0,m.clone)(i);this._options=s.sort((r,a)=>r.label.title.localeCompare(a.label.title)),this.changeRef.markForCheck()}constructor(i,s){super(),this.formBuilder=i,this.changeRef=s,this.outline=!0,this.valueChange=new t.bkB,this.ngUnsubscribe=new oe.B,this.form=this.formBuilder.group({value:[""]}),this.valueControl=this.form.get("value")}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({value:i})=>{this.writeValue(i),this.valueChange.next(i)})}setDisabledState(i){super.setDisabledState(i),i?this.form.disable():this.form.enable(),this.changeRef.markForCheck()}setFormValues(i){this.valueControl.setValue(i),this.changeRef.markForCheck()}getSelectedOption(){const i=this.valueControl.value;return this.options.find(s=>s.value===i)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(K.ze),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-quiz-label-anatomy-select"]],inputs:{options:"options",outline:"outline"},outputs:{valueChange:"valueChange"},features:[t.Jv_([{provide:K.kq,useExisting:(0,t.Rfq)(()=>n),multi:!0}]),t.Vt3],decls:7,vars:5,consts:[[1,"label",3,"formGroup"],[1,"label__select-label","flex","text-xs"],[1,"flex","justify-between","p-2","flex-auto"],[1,"mr-2"],["icon","caret-down","size","lg"],["class","input label__select","placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",4,"ngIf"],["placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",1,"input","label__select"],["value","","data-test","questionAnswerOption"],["class","label__option","data-test","questionAnswerOption",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswerOption",1,"label__option",3,"value"]],template:function(i,s){if(1&i&&(t.j41(0,"div",0)(1,"label",1)(2,"div",2)(3,"div",3),t.EFF(4),t.k0s(),t.nrm(5,"app-icon",4),t.k0s(),t.DNE(6,GR,4,1,"select",5),t.k0s()()),2&i){let r;t.AVh("label--empty",""===s.valueControl.value),t.Y8G("formGroup",s.form),t.R7$(4),t.JRh((null==(r=s.getSelectedOption())||null==r.label?null:r.label.title)||"Select"),t.R7$(2),t.Y8G("ngIf",!s.disabled)}},dependencies:[b.Sq,b.bT,qe,K.xH,K.y7,K.wz,K.BC,K.cb,K.j4,K.JD],styles:[".label[_ngcontent-%COMP%]{overflow:hidden}.label__select-label[_ngcontent-%COMP%]{color:#101823;position:relative}.label__select[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;opacity:.01}.label--empty[_ngcontent-%COMP%]   .label__select-label[_ngcontent-%COMP%]{color:#96a8c0}"],changeDetection:0}),e})();var Zr;function BR(n,e){1&n&&t.nrm(0,"app-icon",8)}function zR(n,e){1&n&&t.nrm(0,"app-icon",9)}function WR(n,e){if(1&n&&(t.j41(0,"div",10)(1,"em",11),t.EFF(2),t.k0s(),t.EFF(3,". "),t.k0s()),2&n){const o=t.XpG(2);t.R7$(2),t.JRh(o.option.label.title)}}function XR(n,e){if(1&n&&(t.j41(0,"div",10)(1,"p",12),t.EFF(2," You selected "),t.j41(3,"em",11),t.EFF(4),t.k0s(),t.EFF(5,". "),t.k0s(),t.j41(6,"p"),t.EFF(7," This is the "),t.j41(8,"em",11),t.EFF(9),t.k0s(),t.EFF(10,". "),t.k0s()()),2&n){let o;const i=t.XpG(2);t.R7$(4),t.JRh(null==(o=i.getSelectedLabel(i.options,i.control.value))?null:o.title.trim()),t.R7$(5),t.JRh(i.option.label.title.trim())}}function HR(n,e){if(1&n&&(t.j41(0,"div",4),t.DNE(1,BR,1,0,"app-icon",5)(2,zR,1,0,"app-icon",6)(3,WR,4,1,"div",7)(4,XR,11,2,"div",7),t.k0s()),2&n){const o=t.XpG();t.Y8G("ngSwitch",o.correct),t.R7$(),t.Y8G("ngSwitchCase",!0),t.R7$(),t.Y8G("ngSwitchCase",!1),t.R7$(),t.Y8G("ngSwitchCase",!0),t.R7$(),t.Y8G("ngSwitchCase",!1)}}class cf extends VR{constructor(){super(...arguments),this.sequence=0,this.labelUpdated=new t.bkB}ngOnInit(){}handleLabelUpdated(e){this.labelUpdated.next(e.label)}handleOffsetUpdated(e){this.labelUpdated.next({...this.option.label,offset:e.offset})}getSelectedLabel(e,o){const i=this.options.find(s=>s.value===o);return i?i.label:void 0}}(Zr=cf).\u0275fac=(()=>{let n;return function(o){return(n||(n=t.xGo(Zr)))(o||Zr)}})(),Zr.\u0275cmp=t.VBU({type:Zr,selectors:[["app-quiz-label"]],inputs:{sequence:"sequence",collapsed:"collapsed",options:"options",option:"option",correct:"correct",mode:"mode"},outputs:{labelUpdated:"labelUpdated"},features:[t.Jv_([{provide:K.kq,useExisting:(0,t.Rfq)(()=>Zr),multi:!0}]),t.Vt3],decls:5,vars:17,consts:[[1,"label","theme-light",3,"labelUpdated","offsetUpdated","label","fit","opaque","fixedScale","pinDraggable","tagDraggable","isCollapsed","descriptionCollapsed","hasContent","sequence"],["label-body","",1,"label__body"],[3,"outline","hidden","options","formControl"],["class","label__summary flex items-start",3,"ngSwitch",4,"ngIf"],[1,"label__summary","flex","items-start",3,"ngSwitch"],["class","label__icon label__icon--correct","style","font-size: 16px","icon","check-circle",4,"ngSwitchCase"],["class","label__icon label__icon--incorrect","style","font-size: 16px","icon","times-circle",4,"ngSwitchCase"],["class","label__text pl-2",4,"ngSwitchCase"],["icon","check-circle",1,"label__icon","label__icon--correct",2,"font-size","16px"],["icon","times-circle",1,"label__icon","label__icon--incorrect",2,"font-size","16px"],[1,"label__text","pl-2"],[1,"font-semibold"],[1,"pb-2"]],template:function(e,o){1&e&&(t.j41(0,"app-generic-label",0),t.nI1(1,"async"),t.bIt("labelUpdated",function(s){return o.handleLabelUpdated(s)})("offsetUpdated",function(s){return o.handleOffsetUpdated(s)}),t.j41(2,"div",1),t.nrm(3,"app-quiz-label-anatomy-select",2),t.DNE(4,HR,5,5,"div",3),t.k0s()()),2&e&&(t.Y8G("label",o.option.label)("fit","summary"===o.mode?"fixed":"auto")("opaque",!0)("fixedScale",t.bMT(1,15,o.labelScale$))("pinDraggable","edit"===o.mode)("tagDraggable",!0)("isCollapsed",o.collapsed)("descriptionCollapsed",!1)("hasContent",!0)("sequence",o.sequence),t.R7$(3),t.Y8G("outline",!1)("hidden","summary"===o.mode)("options",o.options)("formControl",o.control),t.R7$(),t.Y8G("ngIf","summary"===o.mode))},dependencies:[b.bT,b.ux,b.e1,qe,K.BC,K.l_,O1,ol,b.Jj],styles:[".label__body[_ngcontent-%COMP%]{color:#101823;min-width:142px;max-width:200px}.label__icon[_ngcontent-%COMP%]{position:relative;flex-basis:0 0 20px;justify-content:center}.label__icon--correct[_ngcontent-%COMP%]{color:#83e692}.label__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}.label__text[_ngcontent-%COMP%]{flex-wrap:wrap}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(ye.getLabelScale),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],cf.prototype,"labelScale$",void 0);var Mc,rl=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},al=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function QR(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"app-quiz-label",3),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"async"),t.bIt("labelUpdated",function(s){const r=t.eBV(o).index,a=t.XpG();return t.Njj(a.handleLabelUpdated(s,r))}),t.k0s(),t.bVm()}if(2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.R7$(),t.Y8G("mode",s.mode)("formControl",o)("option",t.bMT(2,7,s.quizLabels$)[i])("options",t.bMT(3,9,s.quizLabels$))("sequence",i+1)("correct",s.isCorrect(t.bMT(4,11,s.quizLabels$)[i],t.bMT(5,13,s.activeSubmitted$),i))("collapsed",t.bMT(6,15,s.labelsCollapsed$))}}class Xs{constructor(e,o,i,s){this.store=e,this.formBuilder=o,this.changeRef=i,this.router=s,this.ngUnsubscribe=new oe.B,this.mode="edit",this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.initQuizSubmissionListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.quizLabels$.pipe((0,Vn.F)((e,o)=>{const i=e.map(r=>r.value),s=o.map(r=>r.value);return(0,m.isEqual)(i,s)}),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.store.selectSnapshot(G.getQuizModeActive);this.buildFormOptions(e,o),this.changeRef.markForCheck()}),(0,Tt.z)([this.quizModeActive$,this.quizLabels$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{this.setFormEnabled(e),this.changeRef.markForCheck()})}initQuizSubmissionListeners(){this.activeSubmission$.pipe((0,X.p)(e=>!(0,m.isNil)(e)&&!(0,m.isNil)(e.answer)&&Array.isArray(e.answer)),(0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const i=e.answer;(0,m.isEqual)(this.form.value.options,i)||(this.form.patchValue({options:i},{emitEvent:!1,onlySelf:!0}),this.changeRef.markForCheck())}),this.form.valueChanges.pipe((0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.store.selectSnapshot(G.getActiveQuestionId),i=this.store.selectSnapshot(G.getActiveSubmitted),s=this.store.selectSnapshot(G.getActiveSubmission),r=(0,m.isNil)(s)?[]:s.answer,a=e.options;(0,m.isNil)(i)&&((0,m.isEqual)(a,r)||this.store.dispatch(new Te.SetActiveSubmission({questionId:o,answer:a})),this.changeRef.markForCheck())}),(0,Tt.z)([this.quizModeActive$,this.activeSubmitted$]).subscribe(([e,o])=>{this.mode=this.router.url.includes("/edit")?"edit":e&&!(0,m.isNil)(o)?"summary":"view",this.changeRef.markForCheck()})}isCorrect(e,o,i){if(!(0,m.isNil)(o))return o.answer[i]===e.value}handleLabelUpdated(e,o){const i=this.store.selectSnapshot(G.getActiveQuestion);i.data.options[o].label=e,this.store.dispatch(new Te.SetQuestion(i))}buildFormOptions(e,o){this.optionsArray.clear(),e.forEach(i=>{this.optionsArray.push(this.formBuilder.control(o?"":i.value))})}setFormEnabled(e){e?this.optionsArray.enable():this.optionsArray.disable()}}(Mc=Xs).\u0275fac=function(e){return new(e||Mc)(t.rXU(c.il),t.rXU(K.ze),t.rXU(t.gRc),t.rXU(ut.Ix))},Mc.\u0275cmp=t.VBU({type:Mc,selectors:[["app-quiz-labels"]],decls:3,vars:2,consts:[["data-test","quizLabelsElement",3,"formGroup"],["formArrayName","options"],[4,"ngFor","ngForOf"],["data-test","appQuizLabel",3,"labelUpdated","mode","formControl","option","options","sequence","correct","collapsed"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,QR,7,17,"ng-container",2),t.k0s()()),2&e&&(t.Y8G("formGroup",o.form),t.R7$(2),t.Y8G("ngForOf",o.optionsArray.controls))},dependencies:[b.Sq,K.BC,K.cb,K.l_,K.j4,K.v8,cf,b.Jj],changeDetection:0}),rl([(0,c.l6)(ye.getLabelsCollapsed),al("design:type",f.c)],Xs.prototype,"labelsCollapsed$",void 0),rl([(0,c.l6)(G.getActiveQuestionLabels),al("design:type",f.c)],Xs.prototype,"quizLabels$",void 0),rl([(0,c.l6)(G.getQuizModeActive),al("design:type",f.c)],Xs.prototype,"quizModeActive$",void 0),rl([(0,c.l6)(G.getAllSubmissions),al("design:type",f.c)],Xs.prototype,"allSubmissions$",void 0),rl([(0,c.l6)(G.getActiveSubmission),al("design:type",f.c)],Xs.prototype,"activeSubmission$",void 0),rl([(0,c.l6)(G.getActiveSubmitted),al("design:type",f.c)],Xs.prototype,"activeSubmitted$",void 0);var Ic,mi=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},fi=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function YR(n,e){if(1&n&&(t.nrm(0,"app-context-label",5),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async")),2&n){let o,i,s;const r=t.XpG(3);t.Y8G("label",t.bMT(1,4,r.contextLabel$))("enableInfo",t.bMT(2,6,r.enableContextLabelInfo$)&&(null==(o=t.bMT(3,8,r.viewUI$))?null:o.nodeInfo.enable))("enableActions",t.bMT(4,10,r.enableContextLabelActions$)&&(null==(i=t.bMT(5,12,r.viewUI$))?null:i.contextActions.enable))("enableAudio",t.bMT(6,14,r.enableContextLabelAudio$)&&(null==(s=t.bMT(7,16,r.viewUI$))?null:s.nodeAudio.enable))}}function qR(n,e){if(1&n&&(t.qex(0),t.nrm(1,"app-story-label",6),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.bVm()),2&n){let o,i;const s=e.$implicit,r=t.XpG(3);t.R7$(),t.AVh("labels__label--hidden",!s.shown),t.Y8G("pinDraggable",null==(o=t.bMT(2,7,r.draggable$))?null:o.pin)("tagDraggable",null==(i=t.bMT(3,9,r.draggable$))?null:i.tag)("label",s)("collapsed",t.bMT(4,11,r.labelsCollapsed$))("collapsedMode",t.bMT(5,13,r.labelsCollapsedMode$))}}function KR(n,e){if(1&n&&(t.qex(0),t.DNE(1,YR,8,18,"app-context-label",3),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,qR,6,15,"ng-container",4),t.nI1(5,"async"),t.bVm()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,3,o.enableContextLabel$)&&t.bMT(3,5,o.contextLabel$)),t.R7$(3),t.Y8G("ngForOf",t.bMT(5,7,o.labels$))("ngForTrackBy",o.trackLabel)}}function JR(n,e){1&n&&(t.qex(0),t.nrm(1,"app-quiz-labels"),t.bVm())}function ZR(n,e){if(1&n&&(t.j41(0,"div",1),t.DNE(1,KR,6,9,"ng-container",2)(2,JR,2,0,"ng-container",2),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.showAnatomyLabels),t.R7$(),t.Y8G("ngIf",o.showQuizLabels)}}class Zn{constructor(e,o,i,s,r,a,l,_){this.action$=e,this.cameraService=o,this.changeDetector=i,this.elRef=s,this.labelsService=r,this.router=a,this.store=l,this.applicationEventService=_,this.interactive=!1,this.showAnatomyLabels=!1,this.showQuizLabels=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.bindEngineEvents(),this.bindApplicationEvents(),this.labelsService.setLabelContainer(this.elRef)}ngOnDestroy(){this.labelsService.setLabelContainer(null),this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}bindApplicationEvents(){this.action$.pipe((0,c.xi)(ad),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.handleClickNode(o)}),this.action$.pipe((0,c.xi)(wl),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{o.node&&this.store.dispatch(new ns)}),this.labels$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.changeDetector.markForCheck()}),this.selectedLabel$.pipe((0,X.p)(o=>null==o),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(vt.getZoomed),i=this.store.selectSnapshot(vt.getLockCamera);o&&!i&&this.resetCamera()});const e=(0,Tt.z)([this.activeTool$,this.activeQuestion$]).pipe((0,w.Q)(this.ngUnsubscribe),(0,F.T)(([o,i])=>{const s=this.router.url.indexOf("/edit")>=0,r=(0,m.get)(i,"type")===ot.LabelAnatomy;return s?o===Ct.Quiz:r}));(0,Tt.z)([this.showLabels$,e,this.activeQuestion$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([o,i,s])=>{const r=(0,m.get)(s,"showChapterLabels");this.showQuizLabels=i,this.showAnatomyLabels=!this.showQuizLabels&&o||r,this.changeDetector.markForCheck()}),this.store.select(E.getSelectedChapterReadyState).pipe((0,X.p)(o=>null!=o),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.interactive=o.model,this.changeDetector.markForCheck()})}bindEngineEvents(){this.action$.pipe((0,c.xi)(Sa,Fl),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(e.show?Ce.LabelsEnabled:Ce.LabelsDisabled,null)}),this.action$.pipe((0,c.xi)(Nr),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(Ce.LabelsCreated,e.label)}),this.action$.pipe((0,c.xi)(Rr),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(Ce.LabelsUpdated,e.label)}),this.action$.pipe((0,c.xi)(os),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{e.labels.forEach(o=>{this.applicationEventService.fireEvent(e.shown?Ce.LabelsShown:Ce.LabelsHidden,{labelId:o.id})})}),this.action$.pipe((0,c.xi)(Va),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(Ce.LabelsDestroyed,e.label)})}handleClickNode(e){const o=this.store.selectSnapshot(U.getActiveTool);if((0,m.isNil)(e.node))this.store.dispatch(new is(null)),this.store.dispatch(new ns);else{const i=this.store.selectSnapshot(ye.getEnableContextLabel);o===Ct.Label?this.addLabel(e.hit,e.node):i&&setTimeout(()=>{this.toggleContextLabel(e.hit,e.node)})}}addLabel(e,o){const i=this.cameraService.getDirection(e),s=this.getLabelDefaults(e.objectId),r=s.hideWire?20:32;s.title=o.label,s.offset=[r,0],s.objectId=e.objectId,s.barycentric=[e.barycentric[0],e.barycentric[1],e.barycentric[2]],s.pos=[e.worldPos[0],e.worldPos[1],e.worldPos[2]],s.primitiveIndex=e.triIndex,s.renderableIndex=e.renderableIndex||0,s.dir=i,s.chapterId=this.store.selectSnapshot(E.getSelectedChapter).id,s.occludable=!0,s.shown=!0,this.store.dispatch(new Nr(s,!0)),this.store.dispatch(new is(s))}toggleContextLabel(e,o){const i=this.store.selectSnapshot(Re.getCheckedNodeIds);if(!this.store.selectSnapshot(U.getContextmenu).node&&i.some(r=>r===o.id)){const r=this.cameraService.getDirection(e),a=this.labelsService.makeDefaultStudioLabel();a.theme=$n.Context,a.title=o.label,a.offset=[32,0],a.objectId=e.objectId,a.barycentric=[e.barycentric[0],e.barycentric[1],e.barycentric[2]],a.pos=[e.worldPos[0],e.worldPos[1],e.worldPos[2]],a.primitiveIndex=e.triIndex,a.renderableIndex=e.renderableIndex||0,a.dir=r,a.occludable=!1,a.hideWire=!0,a.pinType=_n.None,this.store.dispatch(new th(a))}else this.store.dispatch(new ns)}getLabelDefaults(e){let o=this.store.selectSnapshot(ye.getSelectedLabel);if(null==o){let i=this.store.selectSnapshot(ye.getChapterLabels);(!i||0===i.length)&&(i=this.store.selectSnapshot(ye.getLabels)),i.length&&(o=(0,m.cloneDeep)(i[i.length-1]))}if(null!=o){const i=this.labelsService.makeDefaultStudioLabel();switch(i.hideWire=o.hideWire,i.pinGlow=o.pinGlow,i.pinType=o.pinType,i.theme=o.theme,i.sequentialType=o.sequentialType,i.states[0].errands[0]=new Ul,(0,m.get)(o,"states[1].errands[0].type")){case Ni.flyToObject:case Ni.flyToCamera:i.states[1].errands[0]=new Ll(e)}return i}{const i=this.labelsService.makeDefaultStudioLabel();return i.states[0].errands[0]=new Ul,i.states[1].errands[0]=new Ll(e),i}}trackLabel(e,o){const{id:i,shown:s,theme:r}=o;return`${i}${s}${r}`}resetCamera(){const o=this.store.selectSnapshot(E.getSelectedChapter)?.camera?.location;(0,m.isNil)(o)||this.store.dispatch(new di(o))}}function ll(n){return n/1048576}(Ic=Zn).\u0275fac=function(e){return new(e||Ic)(t.rXU(c.En),t.rXU(Pi),t.rXU(t.gRc),t.rXU(t.aKT),t.rXU(fr),t.rXU(ut.Ix),t.rXU(c.il),t.rXU(mo))},Ic.\u0275cmp=t.VBU({type:Ic,selectors:[["app-labels"]],decls:1,vars:1,consts:[["class","labels","data-test","labelsElement","dir","ltr",4,"ngIf"],["data-test","labelsElement","dir","ltr",1,"labels"],[4,"ngIf"],[3,"label","enableInfo","enableActions","enableAudio",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"label","enableInfo","enableActions","enableAudio"],["data-test","appStoryLabel",1,"labels__label",3,"pinDraggable","tagDraggable","label","collapsed","collapsedMode"]],template:function(e,o){1&e&&t.DNE(0,ZR,3,2,"div",0),2&e&&t.Y8G("ngIf",o.interactive)},dependencies:[b.Sq,b.bT,zs.ig,Ec,Ip,Xs,b.Jj],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;position:relative}.labels[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2;pointer-events:none}.labels__label--hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),mi([(0,c.l6)(ue.getUI),fi("design:type",f.c)],Zn.prototype,"viewUI$",void 0),mi([(0,c.l6)(ye.getChapterLabels),fi("design:type",f.c)],Zn.prototype,"labels$",void 0),mi([(0,c.l6)(G.getQuizModeActive),fi("design:type",f.c)],Zn.prototype,"quizModeActive$",void 0),mi([(0,c.l6)(U.getActiveTool),fi("design:type",f.c)],Zn.prototype,"activeTool$",void 0),mi([(0,c.l6)(G.getActiveQuestion),fi("design:type",f.c)],Zn.prototype,"activeQuestion$",void 0),mi([(0,c.l6)(E.getSelectedChapter),fi("design:type",f.c)],Zn.prototype,"selectedChapter$",void 0),mi([(0,c.l6)(ye.getSelectedLabel),fi("design:type",f.c)],Zn.prototype,"selectedLabel$",void 0),mi([(0,c.l6)(ye.getLabelsCollapsed),fi("design:type",f.c)],Zn.prototype,"labelsCollapsed$",void 0),mi([(0,c.l6)(ye.getLabelsCollapsedMode),fi("design:type",f.c)],Zn.prototype,"labelsCollapsedMode$",void 0),mi([(0,c.l6)(ye.getContextLabel),fi("design:type",f.c)],Zn.prototype,"contextLabel$",void 0),mi([(0,c.l6)(U.getShowLabels),fi("design:type",f.c)],Zn.prototype,"showLabels$",void 0),mi([(0,c.l6)(vt.getZoomed),fi("design:type",f.c)],Zn.prototype,"zoomed$",void 0),mi([(0,c.l6)(ye.getEnableContextLabel),fi("design:type",f.c)],Zn.prototype,"enableContextLabel$",void 0),mi([(0,c.l6)(ye.getEnableContextLabelInfo),fi("design:type",f.c)],Zn.prototype,"enableContextLabelInfo$",void 0),mi([(0,c.l6)(ye.getEnableContextLabelActions),fi("design:type",f.c)],Zn.prototype,"enableContextLabelActions$",void 0),mi([(0,c.l6)(ye.getEnableContextLabelAudio),fi("design:type",f.c)],Zn.prototype,"enableContextLabelAudio$",void 0),mi([(0,c.l6)(ye.getLabelsDraggable),fi("design:type",f.c)],Zn.prototype,"draggable$",void 0);var Hs=S(2542);function w1(n){return n.toLocaleString()}const Ap={totalVisibleLeafObjects:{title:"Visible Objects",description:"This value represents the number of visible objects in current chapter.",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},geometries:{title:"Geometry + Morphs",description:"",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},materials:{title:"Material Count",description:"This value represents the number of materials downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},textures:{title:"Texture Count",description:"This value represents the number of textures downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},duration:{title:"Time to Load (s)",description:"This value represents the number of seconds it takes for the entire BioDigital scene (Materials + Textures + Vertices + etc) to load when the page is refreshed.",thresholds:{stable:[0,4],warning:[4,10],danger:[10,Number.MAX_SAFE_INTEGER]}},drawCalls:{title:"Draw Call Count",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},drawVertices:{title:"Vertex Count",description:"",thresholds:{stable:[0,25e4],warning:[25e4,5e5],danger:[5e5,Number.MAX_SAFE_INTEGER]}},cpuTime:{title:"CPU Time (ms)",description:"",thresholds:{stable:[0,8],warning:[8,12],danger:[12,Number.MAX_SAFE_INTEGER]}},frameRate:{title:"Frame Rate (fps)",description:"",thresholds:{stable:[58,Number.MAX_SAFE_INTEGER],warning:[45,58],danger:[0,45]}},downloadGeometry:{title:"Geometry Data",description:"",thresholds:{stable:[0,10],warning:[10,25],danger:[25,Number.MAX_SAFE_INTEGER]}},downloadMorph:{title:"Morph Data",description:"",thresholds:{stable:[0,5],warning:[5,10],danger:[10,Number.MAX_SAFE_INTEGER]}},downloadMaterial:{title:"Material Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},downloadTransform:{title:"Transform Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},memoryUsage:{title:"Active Memory Usage",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},chapterPeakMemory:{title:"Chapter Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},scenePeakMemory:{title:"Scene Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}}};function ik(n){return Ap[n]?.title??""}function ok(n){const o=Ap[n]?.thresholds,i=[];if(o){const r=Object.entries(o).reduce((a,[l,_])=>(a.push(`${l.toUpperCase()}: ${function tk(n){const[e,o]=n;let i=w1(e);e===Number.MIN_SAFE_INTEGER&&(i="min");let s=w1(o);return o===Number.MAX_SAFE_INTEGER&&(s="max"),`[${i} - ${s}]`}(_)}`),a),[]).join(" ");i.push(r)}return i.join(" ")}function sk(n,e){const o=Ap[n]?.thresholds;if(o){const{stable:i,warning:s,danger:r}=o;if((0,m.inRange)(e,...i))return"stable";if((0,m.inRange)(e,...s))return"warning";if((0,m.inRange)(e,...r))return"danger"}return"stable"}var Pp=S(3272),Yi=S(1818),M1=S(2765),Ui=S(2026);const rk=["labelEl"],ak=["*",[["","form-field-help",""]]],lk=["*","[form-field-help]"],ck=(n,e,o,i)=>({"field--light":n,"field--dark":e,"field--inline":o,"field--compact":i});function _k(n,e){1&n&&t.eu8(0)}function dk(n,e){if(1&n&&(t.j41(0,"label",4,1),t.DNE(2,_k,1,0,"ng-container",5),t.k0s()),2&n){const o=t.XpG(),i=t.sdS(4);t.BMQ("aria-label",o.label),t.R7$(2),t.Y8G("ngTemplateOutlet",i)}}function pk(n,e){1&n&&t.eu8(0)}function uk(n,e){if(1&n&&(t.j41(0,"div",4),t.DNE(1,pk,1,0,"ng-container",5),t.k0s()),2&n){const o=t.XpG(),i=t.sdS(4);t.BMQ("aria-label",o.label),t.R7$(),t.Y8G("ngTemplateOutlet",i)}}function gk(n,e){if(1&n&&(t.j41(0,"div",10),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.AVh("uppercase",o.uppercase),t.R7$(),t.SpI(" ",o.label," ")}}function hk(n,e){if(1&n&&(t.j41(0,"div",11),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.labelHelp," ")}}function mk(n,e){if(1&n&&(t.DNE(0,gk,2,3,"div",6)(1,hk,2,1,"div",7),t.j41(2,"div",8),t.SdG(3),t.j41(4,"div",9),t.SdG(5,1),t.k0s()()),2&n){const o=t.XpG();t.Y8G("ngIf",o.label),t.R7$(),t.Y8G("ngIf",o.labelHelp)}}let I1=(()=>{var n;class e{constructor(){this.display="block",this.theme="dark",this.uppercase=!0,this.isCompact=!1,this.labelElement=!0,this.ngUnsubscribe=new oe.B}ngOnInit(){}ngAfterViewInit(){this.labelEl&&this.initLabel()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLabel(){this.labelEl.nativeElement.querySelectorAll("[contenteditable]").length>0&&(0,hn.R)(this.labelEl.nativeElement,"click").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(r=>{r.preventDefault()})}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-form-field"]],viewQuery:function(i,s){if(1&i&&t.GBs(rk,5),2&i){let r;t.mGM(r=t.lsd())&&(s.labelEl=r.first)}},inputs:{label:"label",labelHelp:"labelHelp",display:"display",theme:"theme",uppercase:"uppercase",isCompact:"isCompact",labelElement:"labelElement"},ngContentSelectors:lk,decls:5,vars:8,consts:[["contentTemplate",""],["labelEl",""],["data-test","formField",1,"field",3,"ngClass"],["class","field__container",4,"ngIf"],[1,"field__container"],[4,"ngTemplateOutlet"],["class","field__label text-2xs","data-test","formFieldLabel",3,"uppercase",4,"ngIf"],["class","text-xs text-gray-400 my-1",4,"ngIf"],[1,"field__input"],[1,"field__help","text-gray-400","text-xs"],["data-test","formFieldLabel",1,"field__label","text-2xs"],[1,"text-xs","text-gray-400","my-1"]],template:function(i,s){1&i&&(t.NAR(ak),t.j41(0,"div",2),t.DNE(1,dk,3,2,"label",3)(2,uk,2,2,"div",3)(3,mk,6,2,"ng-template",null,0,t.C5r),t.k0s()),2&i&&(t.Y8G("ngClass",t.ziG(3,ck,"light"===s.theme,"dark"===s.theme,"inline"===s.display,s.isCompact)),t.R7$(),t.Y8G("ngIf",s.labelElement),t.R7$(),t.Y8G("ngIf",!s.labelElement))},dependencies:[b.YU,b.bT,b.T3],styles:[".field[_ngcontent-%COMP%]{padding-bottom:16px;display:block;width:100%}.field__input[_ngcontent-%COMP%]{margin-top:4px}.field--light[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#374a68}.field--dark[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#96a8c0}.field--inline[_ngcontent-%COMP%]   .field__container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:auto}.field--inline[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{margin-right:8px}.field--inline[_ngcontent-%COMP%]   .field__input[_ngcontent-%COMP%]{margin-top:auto}.field--compact[_ngcontent-%COMP%]{padding-bottom:0}.field__help[_ngcontent-%COMP%]:not(:empty){padding-top:4px}"],changeDetection:0}),e})();var Ac,A1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},P1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const fk=(n,e)=>({"engine-stats--light":n,"engine-stats--dark":e,"engine-stats--advanced":!0});function Sk(n,e){if(1&n&&(t.j41(0,"a",1)(1,"span",7),t.EFF(2," Documentation"),t.k0s(),t.nrm(3,"app-icon",8),t.k0s()),2&n){const o=t.XpG(2);t.BMQ("href",o.statsSupportUrl,t.B4B)}}function bk(n,e){if(1&n&&(t.j41(0,"section",3)(1,"table",4)(2,"caption",5),t.EFF(3," Download Size (Total) "),t.k0s(),t.j41(4,"tr")(5,"th",6),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.nI1(9,"number"),t.k0s()(),t.j41(10,"tr")(11,"th",6),t.EFF(12),t.k0s(),t.j41(13,"td"),t.EFF(14),t.nI1(15,"number"),t.k0s()(),t.j41(16,"tr")(17,"th",6),t.EFF(18),t.k0s(),t.j41(19,"td"),t.EFF(20),t.nI1(21,"number"),t.k0s()(),t.j41(22,"tr")(23,"th",6),t.EFF(24),t.k0s(),t.j41(25,"td"),t.EFF(26),t.nI1(27,"number"),t.k0s()()()()),2&n){const o=t.XpG(2);t.R7$(5),t.Y8G("matTooltip",o.getStatDescription("downloadGeometry")),t.R7$(),t.SpI(" ",o.getStatTitle("downloadGeometry")," "),t.R7$(),t.HbH(o.getStatCSS("downloadGeometry",o.engineStats.downloadGeometry)),t.R7$(),t.SpI(" ",t.i5U(9,20,o.engineStats.downloadGeometry,"1.2-2")," MB "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("downloadMorph")),t.R7$(),t.SpI(" ",o.getStatTitle("downloadMorph")," "),t.R7$(),t.HbH(o.getStatCSS("downloadMorph",o.engineStats.downloadMorph)),t.R7$(),t.SpI(" ",t.i5U(15,23,o.engineStats.downloadMorph,"1.2-2")," MB "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("downloadMaterial")),t.R7$(),t.SpI(" ",o.getStatTitle("downloadMaterial")," "),t.R7$(),t.HbH(o.getStatCSS("downloadMaterial",o.engineStats.downloadMaterial)),t.R7$(),t.SpI(" ",t.i5U(21,26,o.engineStats.downloadMaterial,"1.2-2")," MB "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("downloadTransform")),t.R7$(),t.SpI(" ",o.getStatTitle("downloadTransform")," "),t.R7$(),t.HbH(o.getStatCSS("downloadTransform",o.engineStats.downloadTransform)),t.R7$(),t.SpI(" ",t.i5U(27,29,o.engineStats.downloadTransform,"1.2-2")," MB ")}}function yk(n,e){if(1&n&&(t.j41(0,"section",3)(1,"table",4)(2,"caption",5),t.EFF(3," Memory "),t.k0s(),t.j41(4,"tr")(5,"th",6),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.nI1(9,"number"),t.k0s()(),t.j41(10,"tr")(11,"th",6),t.EFF(12),t.k0s(),t.j41(13,"td"),t.EFF(14),t.nI1(15,"number"),t.k0s()(),t.j41(16,"tr")(17,"th",6),t.EFF(18),t.k0s(),t.j41(19,"td"),t.EFF(20),t.nI1(21,"number"),t.k0s()()()()),2&n){const o=t.XpG(3);t.R7$(5),t.Y8G("matTooltip",o.getStatDescription("memoryUsage")),t.R7$(),t.SpI(" ",o.getStatTitle("memoryUsage")," "),t.R7$(),t.HbH(o.getStatCSS("memoryUsage",o.currentAppStat.memoryUsage)),t.R7$(),t.SpI(" ",t.i5U(9,15,o.currentAppStat.memoryUsage,"1.0-0")," MB "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("chapterPeakMemory")),t.R7$(),t.SpI(" ",o.getStatTitle("chapterPeakMemory")," "),t.R7$(),t.HbH(o.getStatCSS("chapterPeakMemory",o.currentAppStat.chapterPeakMemory)),t.R7$(),t.SpI(" ",t.i5U(15,18,o.currentAppStat.chapterPeakMemory,"1.0-0")," MB "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("scenePeakMemory")),t.R7$(),t.SpI(" ",o.getStatTitle("scenePeakMemory")," "),t.R7$(),t.HbH(o.getStatCSS("scenePeakMemory",o.currentAppStat.scenePeakMemory)),t.R7$(),t.SpI(" ",t.i5U(21,21,o.currentAppStat.scenePeakMemory,"1.0-0")," MB ")}}function vk(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",21),t.bIt("click",function(){t.eBV(o);const s=t.XpG(4);return t.Njj(s.viewReportClick())}),t.EFF(1," View Report "),t.k0s()}if(2&n){const o=t.XpG(4);t.Y8G("buttonTheme",o.theme())}}function Ek(n,e){if(1&n){const o=t.RV6();t.j41(0,"section",3)(1,"h2",5),t.EFF(2,"Profiler"),t.k0s(),t.j41(3,"form",9)(4,"div",10)(5,"app-form-field",11)(6,"select",12)(7,"option",13),t.EFF(8,"DOM"),t.k0s(),t.j41(9,"option",14),t.EFF(10,"Markers"),t.k0s(),t.j41(11,"option",15),t.EFF(12,"None"),t.k0s()()(),t.j41(13,"app-form-field",16)(14,"mat-checkbox",17),t.EFF(15," Hover Pick Enabled "),t.k0s()()(),t.j41(16,"div",18)(17,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.toggleCaptureClick())}),t.EFF(18),t.k0s(),t.DNE(19,vk,2,1,"button",20),t.k0s()()(),t.j41(20,"section",3)(21,"h2",5),t.EFF(22,"Tools"),t.k0s(),t.j41(23,"div",18)(24,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.rayPickClick())}),t.EFF(25," Start Ray Picking "),t.k0s(),t.j41(26,"button",21),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.runSpectorJSClick())}),t.EFF(27," Run SpectorJS "),t.k0s()()()}if(2&n){const o=t.XpG(3);t.R7$(3),t.Y8G("formGroup",o.form),t.R7$(2),t.Y8G("isCompact",!0),t.R7$(8),t.Y8G("isCompact",!0),t.R7$(4),t.Y8G("buttonTheme",o.theme())("disabled",o.rayPicking),t.R7$(),t.SpI(" ",o.capturing?"Stop":"Start"," Capture "),t.R7$(),t.vxM(19,!o.capturing&&o.capturedStats.length>0?19:-1),t.R7$(5),t.Y8G("buttonTheme",o.theme())("disabled",o.capturing||o.rayPicking),t.R7$(2),t.Y8G("buttonTheme",o.theme())}}function Tk(n,e){if(1&n&&t.DNE(0,yk,22,24,"section",3)(1,Ek,28,10),2&n){const o=t.XpG(2);t.vxM(0,null!=o.currentAppStat&&o.currentAppStat.memoryUsage?0:-1),t.R7$(),t.vxM(1,o.showAdvancedTools()?1:-1)}}function Ck(n,e){if(1&n&&(t.j41(0,"div",0),t.DNE(1,Sk,4,1,"a",1),t.j41(2,"div",2)(3,"section",3)(4,"table",4)(5,"caption",5),t.EFF(6," Per Module "),t.k0s(),t.j41(7,"tr")(8,"th",6),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.nI1(12,"number"),t.k0s()(),t.j41(13,"tr")(14,"th",6),t.EFF(15),t.k0s(),t.j41(16,"td"),t.EFF(17),t.nI1(18,"number"),t.k0s()(),t.j41(19,"tr")(20,"th",6),t.EFF(21),t.k0s(),t.j41(22,"td"),t.EFF(23),t.nI1(24,"number"),t.k0s()(),t.j41(25,"tr")(26,"th",6),t.EFF(27),t.k0s(),t.j41(28,"td"),t.EFF(29),t.nI1(30,"number"),t.k0s()(),t.j41(31,"tr")(32,"th",6),t.EFF(33),t.k0s(),t.j41(34,"td"),t.EFF(35),t.nI1(36,"number"),t.k0s()()()(),t.j41(37,"section",3)(38,"table",4)(39,"caption",5),t.EFF(40),t.k0s(),t.j41(41,"tr")(42,"th",6),t.EFF(43),t.k0s(),t.j41(44,"td"),t.EFF(45),t.nI1(46,"number"),t.k0s()(),t.j41(47,"tr")(48,"th",6),t.EFF(49),t.k0s(),t.j41(50,"td"),t.EFF(51),t.nI1(52,"number"),t.k0s()(),t.j41(53,"tr")(54,"th",6),t.EFF(55),t.k0s(),t.j41(56,"td"),t.EFF(57),t.nI1(58,"number"),t.k0s()(),t.j41(59,"tr")(60,"th",6),t.EFF(61),t.k0s(),t.j41(62,"td"),t.EFF(63),t.nI1(64,"number"),t.k0s()()()(),t.DNE(65,bk,28,32,"section",3)(66,Tk,2,2),t.nI1(67,"async"),t.k0s()()),2&n){const o=t.XpG();t.Y8G("ngClass",t.l_i(79,fk,"light"===o.theme(),"dark"===o.theme())),t.R7$(),t.vxM(1,o.enableAdvancedStats?1:-1),t.R7$(7),t.Y8G("matTooltip",o.getStatDescription("totalVisibleLeafObjects")),t.R7$(),t.SpI(" ",o.getStatTitle("totalVisibleLeafObjects")," "),t.R7$(),t.HbH(o.getStatCSS("totalVisibleLeafObjects",o.engineStats.totalVisibleLeafObjects)),t.R7$(),t.SpI(" ",t.i5U(12,50,o.engineStats.totalVisibleLeafObjects,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("geometries")),t.R7$(),t.SpI(" ",o.getStatTitle("geometries")," "),t.R7$(),t.HbH(o.getStatCSS("geometries",o.engineStats.geometries)),t.R7$(),t.SpI(" ",t.i5U(18,53,o.engineStats.geometries,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("materials")),t.R7$(),t.SpI(" ",o.getStatTitle("materials")," "),t.R7$(),t.HbH(o.getStatCSS("materials",o.engineStats.materials)),t.R7$(),t.SpI(" ",t.i5U(24,56,o.engineStats.materials,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("textures")),t.R7$(),t.SpI(" ",o.getStatTitle("textures")," "),t.R7$(),t.HbH(o.getStatCSS("textures",o.engineStats.textures)),t.R7$(),t.SpI(" ",t.i5U(30,59,o.engineStats.textures,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("duration")),t.R7$(),t.SpI(" ",o.getStatTitle("duration")," "),t.R7$(),t.HbH(o.getStatCSS("duration",null==o.currentAppStat?null:o.currentAppStat.duration)),t.R7$(),t.SpI(" ",t.i5U(36,62,null==o.currentAppStat?null:o.currentAppStat.duration,"1.1-1")," "),t.R7$(5),t.SpI(" Per Frame",o.statsCached?" (cached)":""," "),t.R7$(2),t.Y8G("matTooltip",o.getStatDescription("drawCalls")),t.R7$(),t.SpI(" ",o.getStatTitle("drawCalls")," "),t.R7$(),t.HbH(o.getStatCSS("drawCalls",o.engineStats.drawCalls)),t.R7$(),t.SpI(" ",t.i5U(46,65,o.engineStats.drawCalls,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("drawVertices")),t.R7$(),t.SpI(" ",o.getStatTitle("drawVertices")," "),t.R7$(),t.HbH(o.getStatCSS("drawVertices",o.engineStats.drawVertices)),t.R7$(),t.SpI(" ",t.i5U(52,68,o.engineStats.drawVertices,"1.0")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("cpuTime")),t.R7$(),t.SpI(" ",o.getStatTitle("cpuTime")," "),t.R7$(),t.HbH(o.getStatCSS("cpuTime",o.engineStats.cpuTime)),t.R7$(),t.SpI(" ",t.i5U(58,71,o.engineStats.cpuTime,"1.3-3")," "),t.R7$(3),t.Y8G("matTooltip",o.getStatDescription("frameRate")),t.R7$(),t.SpI(" ",o.getStatTitle("frameRate")," "),t.R7$(),t.HbH(o.getStatCSS("frameRate",o.engineStats.frameRate)),t.R7$(),t.SpI(" ",t.i5U(64,74,o.engineStats.frameRate,"1.0-0")," "),t.R7$(2),t.vxM(65,o.enableAdvancedStats?65:-1),t.R7$(),t.vxM(66,o.enableAdvancedStats&&t.bMT(67,77,o.chapterReady$)?66:-1)}}const Ok=["cpuTime","gpuTime","postProcessTime","frameTime","frameRate"];class Pc{get engineStats(){return this.engineStats$.value}constructor(e,o,i,s,r,a,l){this.store=e,this.engineService=o,this.rendererService=i,this.markerService=s,this.storageService=r,this.dialog=a,this.changeRef=l,this.statsSupportUrl="https://www.notion.so/biodigital/Performance-Panel-Help-Doc-WIP-c0e54dfc39f2465383a18e33a97bdb4c",this.getStatTitle=ik,this.getStatDescription=ok,this.enableAdvancedStats=!1,this.theme=(0,t.hFB)(Hs.P.Dark),this.showAdvancedTools=(0,t.hFB)(!0),this.capturedStats=[],this.engineStats$=new He.t(void 0),this.capturing=!1,this.rayPicking=!1,this.initialLabels=[],this.initialSceneMemory=0,this.initialMemoryByChapter={},this.peakMemoryByChapter={},this.chapterLoadStats={},this.ngUnsubscribe=new oe.B,this.initState()}ngOnInit(){this.initFormListeners(),this.initStatsListeners(),this.initMemoryListeners();const e=new URLSearchParams(window.location.search),o="true"===e.get("ui-stats-capture"),i="false"!==e.get("ui-stats-hover"),s=e.get("ui-stats-label")||"dom";this.form.setValue({hoverPickEnabled:i,labelsMode:s}),o&&this.toggleCapture(!0),this.enableAdvancedStats=he.application===bt.Loft||he.deploy!==En.Production||"true"===this.storageService.getLocalItem(In.EnableAdvancedStats),this.changeRef.markForCheck()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}rayPickClick(){confirm("Please note, this may take upto 10+ seconds to run and will lock your browser temporarily. Continue?")&&(this.rayPicking=!0,this.changeRef.markForCheck(),setTimeout(()=>{this.runRayPickSuite().then(e=>{this.rayPicking=!1,this.changeRef.markForCheck();const{startMemoryUsage:o,endMemoryUsage:i,meanRayPickTime:s}=e,r={startMemoryUsage:`${o.toFixed(0)} MB`,endMemoryUsage:`${i.toFixed(0)} MB`,meanRayPickTime:`${s.toFixed(2)} ms`};alert(JSON.stringify(r,null,2))})},1))}runRayPickSuite(){var e=this;return(0,J.A)(function*(){return new Promise(o=>{const{offsetWidth:i,offsetHeight:s}=e.rendererService.getCanvas(),r=e.currentAppStat.memoryUsage,a=[];for(let _=0;_<s;_+=5)for(let d=0;d<i;d+=5){const p=performance.now();e.rendererService.pick(d,_,!0);const g=performance.now()-p;a.push(g)}const l=(0,m.mean)(a);a.length=0,setTimeout(()=>{o({startMemoryUsage:r,endMemoryUsage:e.currentAppStat.memoryUsage,meanRayPickTime:l})},1e3)})})()}toggleCaptureClick(){if(!this.capturing&&confirm("Do you want to reload the page to ensure accurate profiling? Otherwise the profiler will start immediately.")){const{hoverPickEnabled:o,labelsMode:i}=this.form.value,s=new URLSearchParams(window.location.search);s.set("ui-stats-capture","true"),s.set("ui-stats-hover",`${o}`),s.set("ui-stats-label",`${i}`);const r=`${location.pathname}?${s.toString()}`;window.location.href=r}else this.toggleCapture(!this.capturing)}toggleCapture(e){this.capturing=e,this.capturing?(this.capturedStats.length=0,this.capturing=!0):(this.capturing=!1,this.viewReport()),this.changeRef.markForCheck()}getStatCSS(e,o){return["engine-stats-row",`engine-stats-row--${sk(e,o)}`]}runSpectorJSClick(){this.runSpectorJS()}runSpectorJS(){var e=this;return(0,J.A)(function*(){S.e(492).then(S.t.bind(S,7492,23)).then(({EmbeddedFrontend:o,Spector:i})=>{e.spector||(e.spector=new i,e.spector.onCapture.add(r=>{console.log("specture captured",r,e.spector),console.log({EmbeddedFrontend:o});const a=new o.ResultView;a.display(),a.addCapture(r)}),e.spector.onError.add(r=>{console.warn("specture error",r,e.spector)})),e.spector.captureNextFrame(e.engineService.engine.renderer.canvas,!1)})})()}viewReportClick(){var e=this;return(0,J.A)(function*(){e.viewReport()})()}viewReport(){var e=this;return(0,J.A)(function*(){const o=e.capturedStats,i=e.store.selectSnapshot(E.getStoryChapters),{StatsDialogComponent:s}=yield S.e(608).then(S.bind(S,6608));e.dialog.open(s,{width:"90vw",panelClass:"bd-publish-dialog-panel",data:{chapters:i,appStats:o,chapterLoadStats:e.chapterLoadStats}}).afterClosed().pipe((0,w.Q)(e.ngUnsubscribe)).subscribe()})()}initState(){const e=performance?.memory?.usedJSHeapSize??0;this.initialSceneMemory=ll(e),this.form=new K.gE({hoverPickEnabled:new K.MJ(!0),labelsMode:new K.MJ("dom")}),this.store.select(ye.getLabels).pipe((0,X.p)(o=>o?.length>0),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.initialLabels=o;const{labelsMode:i}=this.form.value;this.toggleLabelsMode(i)})}initFormListeners(){this.form.valueChanges.pipe((0,F.T)(e=>e.hoverPickEnabled),(0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.toggleHoverPick(e)}),this.form.valueChanges.pipe((0,F.T)(e=>e.labelsMode),(0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.toggleLabelsMode(e)})}initStatsListeners(){this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const{chapterId:o,chapterProgress:i}=e,s=this.chapterLoadStats[o]??{chapterId:o,startTime:performance.now()};1===i&&(s.endTime=performance.now(),s.duration=(s.endTime-s.startTime)/1e3),this.chapterLoadStats[o]=s}),this.engineService.engineCreated$.pipe((0,At.Z)(e=>{const o=this.engineService.server;return function ek(n,e){const{renderer:o}=n;return new f.c(i=>{let s=performance.now(),r=s,a=0,l=0,_=0,d=0,p=0,u=0,g=0,y=0,C=0,O=0,L=0;const $=function(){var x=(0,J.A)(function*(){l++;const k=performance.now();a=k-s,k>=r+1e3&&(d=1e3*l/(k-r),r=k,l=0),s=k;const A=performance?.memory?.usedJSHeapSize??0;_=ll(A),y=ll(e?.dataSize?.material??0),C=ll(e?.dataSize?.morph??0),O=ll(e?.dataSize?.geometry??0),L=ll(e?.dataSize?.transform??0),i.next({...o.stats,totalObjects:p,totalLeafObjects:u,totalVisibleLeafObjects:g,frameRate:d,frameTime:a,memoryUsage:_,downloadMaterial:y,downloadMorph:C,downloadGeometry:O,downloadTransform:L})});return function(){return x.apply(this,arguments)}}(),q=()=>{n&&(n.off("destroy",q),o.off("end",$)),i.next({...o.stats,totalObjects:p,totalLeafObjects:u,totalVisibleLeafObjects:g,frameRate:d,frameTime:a,memoryUsage:_,downloadMaterial:y,downloadMorph:C,downloadGeometry:O,downloadTransform:L}),i.complete()};o.on("end",$),n.on("changestory",()=>{const{anatomyObjects:x}=n.story.anatomySceneGraph;p=x.size;const k=()=>{u=0,g=0,x.forEach(R=>{!R.children?.length&&(u++,R.shown&&g++)})},A=R=>{"shown"===R?.property&&k()};k(),x.forEach(R=>{R.on("change",A)})}),n.on("destroy",q),i.add(q)})}(e,o instanceof ee.BioDigitalWebSocketServer?o:void 0)}),(0,ls.Z)(100),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.statsCached=!1;const o=this.engineStats,i=Object.entries(e).reduce((s,[r,a])=>{const l=r;if(!Ok.includes(l)){const _=o?.[l];!a&&_&&(s[l]=_,this.statsCached=!0)}return s},{...o,...e});this.engineStats$.next(i),this.changeRef.markForCheck()})}initMemoryListeners(){(0,Tt.z)([this.engineStats$,this.chapterId$,this.chapterReady$]).pipe((0,X.p)(([e,,o])=>!(0,m.isNil)(e)&&o),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{const i=this.initialSceneMemory,s=e.memoryUsage,r=s-i;this.initialMemoryByChapter[o]=this.initialMemoryByChapter[o]??s;const _=Math.max(this.peakMemoryByChapter[o]??0,s);this.peakMemoryByChapter[o]=_;const d=Object.values(this.peakMemoryByChapter).reduce((O,L)=>Math.max(O,L),0),p={chapterInitialMemory:this.initialMemoryByChapter[o],chapterPeakMemory:this.peakMemoryByChapter[o],chapterDeltaMemory:r,sceneInitialMemory:i,scenePeakMemory:d},u=this.chapterLoadStats[o]??{},g=performance.now(),{labelsMode:y,hoverPickEnabled:C}=this.form.value;this.currentAppStat={...e,...u,...p,timestamp:g,chapterId:o,labelsMode:y,hoverPickEnabled:C},this.capturing&&this.capturedStats.push(this.currentAppStat),this.changeRef.markForCheck()})}toggleLabelsMode(e){switch(this.store.dispatch(new Ua([])),this.markerService.deleteMarkers(),e){case"dom":this.store.dispatch(new Ua(this.initialLabels));break;case"marker":this.initialLabels.forEach(o=>this.markerService.createMarker(o))}}toggleHoverPick(e){this.store.dispatch(new dg({hoverEnabled:e}))}}(Ac=Pc).\u0275fac=function(e){return new(e||Ac)(t.rXU(c.il),t.rXU(Lt),t.rXU(ws),t.rXU(Xl),t.rXU(Le),t.rXU(pt.bZ),t.rXU(t.gRc))},Ac.\u0275cmp=t.VBU({type:Ac,selectors:[["app-engine-stats"]],inputs:{theme:[t.Mj6.SignalBased,"theme"],showAdvancedTools:[t.Mj6.SignalBased,"showAdvancedTools"]},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[[1,"engine-stats",3,"ngClass"],["target","_blank","rel","noreferrer nofollow",1,"self-end","text-xs","text-link","text-semibold"],[1,"engine-stats__sections"],[1,"engine-stats__section"],[1,"engine-stats__table"],[1,"engine-stats__section-header"],["scope","row","matTooltipPosition","left",3,"matTooltip"],[1,"text-underline"],["icon","arrow-up-right-from-square",1,"ml-1"],[1,"flex","flex-col","text-xs",3,"formGroup"],[1,"flex","flex-row","justify-between"],["label","Labels",1,"my-1",3,"isCompact"],["formControlName","labelsMode",1,"input"],["value","dom",1,"my-1"],["value","marker",1,"my-1"],["value","none",1,"my-1"],["label","Input",1,"my-1","ml-1",3,"isCompact"],["formControlName","hoverPickEnabled"],[1,"my-1","engine-stats__buttons"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme","disabled"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"buttonTheme"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme"]],template:function(e,o){1&e&&t.DNE(0,Ck,68,82,"div",0),2&e&&t.vxM(0,o.engineStats?0:-1)},dependencies:[b.MD,b.YU,b.Jj,b.QX,K.X1,K.qT,K.xH,K.y7,K.wz,K.BC,K.cb,K.j4,K.JD,Pp.D,I1,M1.So,Sn.oV,Yi.C,hi.Q,Ui.o,qe],styles:[":root{--engine-stats-color: #374a68;--engine-stats-background-color: #ffffff;--engine-stats-border-color: #eaeff5}.engine-stats{display:flex;flex-direction:column;padding:8px;text-align:left;border-radius:4px;color:var(--engine-stats-color);background-color:var(--engine-stats-background-color);border:1px solid var(--engine-stats-border-color)}.engine-stats__sections{display:flex;flex-direction:column;gap:16px}.engine-stats__section{display:flex;flex-direction:column;font-size:.75rem;line-height:1rem}.engine-stats__section-header{padding-top:.25rem;padding-bottom:.25rem;text-align:left;font-size:.875rem;line-height:1.25rem;font-weight:600}.engine-stats__buttons{display:flex;flex-direction:column;gap:8px}.engine-stats table th{width:60%;border-right:1px solid var(--engine-stats-border-color);font-weight:500;text-align:right}.engine-stats table td{font-weight:600}.engine-stats table th,.engine-stats table td{padding:2px 4px}.engine-stats table tr{border-top:1px solid var(--engine-stats-border-color);border-bottom:1px solid var(--engine-stats-border-color);border-collapse:collapse}.engine-stats-row--warning{background-color:#ffb92e;color:#374a68}.engine-stats-row--danger{background-color:#de3535;color:#d7e0ea}.engine-stats--dark{--engine-stats-color: #d7e0ea;--engine-stats-background-color: #283853;--engine-stats-border-color: #1c2a3f}.engine-stats--advanced{width:260px}\n"],encapsulation:2,changeDetection:0}),A1([(0,c.l6)(U.getChapter),P1("design:type",f.c)],Pc.prototype,"chapterId$",void 0),A1([(0,c.l6)(E.getSelectedChapterModelReady),P1("design:type",f.c)],Pc.prototype,"chapterReady$",void 0);const wk=(n,e,o)=>({"progress--small":n,"progress--medium":e,"progress--large":o}),Mk=n=>({"progress__bar--complete":n}),Ik=n=>({width:n});let Ak=(()=>{var n;class e{get value(){return this._value}set value(i){this._value=i,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}constructor(i,s){this.router=i,this.changeDetector=s,this.total=100,this._value=0,this.size="small",this.disableComplete=!1,this.percentWidth=0,this.ngUnsubscribe=new oe.B}ngOnInit(){this.router.events.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{i instanceof ut.Z&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(ut.Ix),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-progress"]],inputs:{total:"total",value:"value",size:"size",disableComplete:"disableComplete"},decls:2,vars:12,consts:[[1,"progress",3,"ngClass"],["role","progressbar","aria-label","content loading progress","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"div",1),t.k0s()),2&i&&(t.Y8G("ngClass",t.sMw(4,wk,"small"===s.size,"medium"===s.size,"large"===s.size)),t.R7$(),t.Y8G("ngClass",t.eq3(8,Mk,!s.disableComplete&&100===s.percentWidth))("ngStyle",t.eq3(10,Ik,s.percentWidth+"%")),t.BMQ("aria-valuenow",s.percentWidth))},dependencies:[b.YU,b.B3],styles:["@keyframes _ngcontent-%COMP%_progressSuccess{0%{width:100%!important;background:#38de38}50%{opacity:1;background:#38de38}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;width:100%}.progress__bar[_ngcontent-%COMP%]{background:#de3535;height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressSuccess 2s linear forwards}.progress--small[_ngcontent-%COMP%]{height:4px}.progress--medium[_ngcontent-%COMP%]{height:8px}.progress--large[_ngcontent-%COMP%]{height:12px}"],changeDetection:0}),e})(),Pk=(()=>{var n;class e{constructor(i,s){this.store=i,this.changeDetectorRef=s,this.ngUnsubscribe=new oe.B,this.storyLoadProgress=0}ngOnInit(){const i=this.store.select(ki.getChaptersLoadProgress),s=this.store.select(Pe.getLoadingChapter);(0,Tt.z)(i,s).pipe((0,X.p)(()=>{const r=this.store.selectSnapshot(Pe.getLoadChapters);return!(0,m.isNil)(r)&&r.length>0}),(0,w.Q)(this.ngUnsubscribe)).subscribe(([r,a])=>{const l=this.store.selectSnapshot(E.getSelectedChapterId),_=!(0,m.isNil)(a)&&a.chapterId===l;this.storyLoadProgress=_?r[l]??0:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-engine-progress"]],decls:1,vars:3,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(i,s){1&i&&t.nrm(0,"app-progress",0),2&i&&(t.Y8G("value",s.storyLoadProgress)("total",1),t.BMQ("data-progress",s.storyLoadProgress))},dependencies:[Ak],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0}),e})();var ie=S(9969);function Nk(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",1),t.bIt("@show.done",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.onShowDone())}),t.j41(1,"div",2),t.EFF(2,"Use control + scroll to zoom"),t.k0s()()}2&n&&t.Y8G("@show",void 0)}let Rk=(()=>{var n;class e{constructor(i,s){this.actions=i,this.changeDetectorRef=s,this.ngUnsubscribe=new oe.B,this.show=!1}ngOnInit(){this.actions.pipe((0,c.xi)(gb),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.En),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(i,s){1&i&&t.DNE(0,Nk,3,1,"div",0),2&i&&t.Y8G("ngIf",s.show)},dependencies:[b.bT],styles:[".engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:#10182380;font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,ie.hZ)("show",[(0,ie.kY)(":enter",[(0,ie.K2)([(0,ie.iF)({opacity:"*"}),(0,ie.i0)("500ms ease-in-out",(0,ie.iF)({opacity:1})),(0,ie.i0)("500ms 2000ms ease-in-out",(0,ie.iF)({opacity:0}))])])])]},changeDetection:0}),e})();const kk=(n,e)=>({backgroundColor:n,duration:e}),Dk=(n,e)=>({value:n,params:e}),Lk=(0,ie.lY)([(0,ie.iF)({opacity:"0",backgroundColor:"*"}),(0,ie.K2)([(0,ie.i0)("{{ duration }}ms {{ easing }}",(0,ie.iF)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,ie.i0)("250ms 500ms ease-in",(0,ie.iF)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let Uk=(()=>{var n;class e{constructor(i,s,r){this.actions=i,this.changeDetectorRef=s,this.store=r,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,c.xi)(hb),(0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.fadeIn(i.color,i.duration)})}handleFadeComplete(){this.store.dispatch(new tw),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(i,s){this.isVisible=!0,this.color=i,this.duration=1e3*s,this.changeDetectorRef.markForCheck()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.En),t.rXU(t.gRc),t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.bIt("@fade.done",function(){return s.handleFadeComplete()}),t.k0s()),2&i&&t.Y8G("@fade",t.l_i(4,Dk,s.isVisible,t.l_i(1,kk,s.color,s.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,ie.hZ)("fade",[(0,ie.kY)("* => true",(0,ie.sM)(Lk))])]},changeDetection:0}),e})(),Vk=(()=>{var n;class e{constructor(i,s,r,a){this.engineService=i,this.cameraService=s,this.numberService=r,this.changeDetectionRef=a,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(pe.CameraUpdated).pipe((0,ls.Z)(50)).subscribe(i=>{const s=this.numberService.roundModel(i.eye,0),{x:r,y:a,z:l}=s,_=Math.floor(100*this.cameraService.getCameraZoom()),d=this.numberService.roundNumber(i.dist,0);this.camera={x:r,y:a,z:l,zoom:_,dist:d},this.changeDetectionRef.markForCheck()})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(Lt),t.rXU(Pi),t.rXU(Cg),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&i&&(t.R7$(),t.SjE(" X:",null==s.camera?null:s.camera.x," Y:",null==s.camera?null:s.camera.y," Z:",null==s.camera?null:s.camera.z," Dist:",null==s.camera?null:s.camera.dist," Zoom:",null==s.camera?null:s.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0}),e})(),Np=(()=>{var n;class e{constructor(i){this.applicationEventService=i}getClipboardAPISupport(){return"clipboard"in navigator}getClipboardAPI(){return navigator.clipboard}nativeShareLink(i){(!0===he.native||he.platform===ro.SDK)&&this.applicationEventService.fireEvent(Ce.NativeShare,{type:"shareLinkModel",value:JSON.stringify(i)})}copyToClipboard(i,s){if(!0===he.native||he.platform===ro.SDK)return new f.c(r=>{this.applicationEventService.fireEvent(Ce.NativeShare,{type:s,value:i}),r.next(!0),r.complete()});if(this.getClipboardAPISupport()){const r=this.getClipboardAPI();return new f.c(a=>{r.writeText(i).then(()=>{a.next(!0),a.complete()}).catch(l=>{a.next(!1),a.complete()})})}return(0,Qe.of)(!1)}copyInputFieldValue(i){i.select();let s=!1;try{s=document.execCommand("copy")}catch{s=!1}return s}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(mo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var Nc,N1=function(n){return n.Chapter="chapter",n.Label="label",n.Paint="paint",n.Positions="positions",n.Quiz="quiz",n.Image="image",n}(N1||{}),jk=S(1997),df=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},pf=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const xk=["nodeActionsTrigger"];function Gk(n,e){if(1&n&&(t.qex(0),t.j41(1,"button",67),t.pXf(2,22),t.k0s(),t.nrm(3,"mat-divider"),t.bVm()),2&n){t.XpG();const o=t.sdS(31);t.R7$(),t.Y8G("matMenuTriggerFor",o)}}function $k(n,e){1&n&&(t.qex(0),t.pXf(1,23),t.bVm())}function Fk(n,e){1&n&&(t.qex(0),t.pXf(1,24),t.bVm())}function Bk(n,e){if(1&n&&(t.qex(0),t.nrm(1,"mat-divider"),t.j41(2,"button",68),t.pXf(3,25),t.k0s(),t.bVm()),2&n){t.XpG();const o=t.sdS(50);t.R7$(2),t.Y8G("matMenuTriggerFor",o)}}function zk(n,e){if(1&n&&(t.qex(0),t.nrm(1,"mat-divider"),t.j41(2,"button",69),t.pXf(3,26),t.k0s(),t.bVm()),2&n){t.XpG(2);const o=t.sdS(57);t.R7$(2),t.Y8G("matMenuTriggerFor",o)}}function Wk(n,e){if(1&n&&(t.qex(0),t.DNE(1,zk,4,1,"ng-container",48),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("appFlagApplication",o.application.Loft)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit")}}function Xk(n,e){1&n&&t.nrm(0,"mat-divider")}function Hk(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",70),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.editNodeLabel(s.node))}),t.pXf(1,27),t.k0s()}}function Qk(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"button",65),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.copy(s.node.label))}),t.pXf(2,28),t.k0s(),t.bVm()}}function Yk(n,e){if(1&n&&(t.j41(0,"button",73),t.pXf(1,30),t.k0s()),2&n){t.XpG(2);const o=t.sdS(70);t.Y8G("matMenuTriggerFor",o)}}function qk(n,e){if(1&n&&(t.qex(0),t.j41(1,"button",71),t.pXf(2,29),t.k0s(),t.DNE(3,Yk,2,1,"button",72),t.bVm()),2&n){const o=t.XpG(),i=t.sdS(61);t.R7$(),t.Y8G("matMenuTriggerFor",i),t.R7$(2),t.Y8G("ngIf",o.node.boolState.available)}}function Kk(n,e){if(1&n){const o=t.RV6();t.qex(0),t.nrm(1,"mat-divider"),t.j41(2,"button",74),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.samplePaint(s.node))}),t.pXf(3,31),t.k0s(),t.bVm()}}function Jk(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",75),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.toggleVisible(s.node,!0))}),t.pXf(1,32),t.k0s()}}function Zk(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",76),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.toggleVisible(s.node,!1))}),t.pXf(1,33),t.k0s()}}function e3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",77),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.togglePickable(s.node,!1))}),t.pXf(1,34),t.k0s()}}function t3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",78),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.togglePickable(s.node,!0))}),t.pXf(1,35),t.k0s()}}function n3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",79),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.toggleAvailable(s.node,!1))}),t.pXf(1,36),t.k0s()}}function i3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",80),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.toggleAvailable(s.node,!0))}),t.pXf(1,37),t.k0s()}}function o3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",63),t.bIt("click",function(){t.eBV(o);const s=t.XpG().$implicit,r=t.XpG();return t.Njj(r.copyChapterPaint(r.node,s.id))}),t.pXf(1,38),t.k0s()}if(2&n){const o=t.XpG().index;t.R7$(),t.uP7(o+1),t.nnv(1)}}function s3(n,e){if(1&n&&(t.qex(0),t.DNE(1,o3,2,1,"button",81),t.nI1(2,"async"),t.bVm()),2&n){const o=e.$implicit,i=t.XpG();t.R7$(),t.Y8G("ngIf",o.id!==t.bMT(2,1,i.selectedChapterId$))}}class ea{get node(){return this._node}set node(e){this._node=e;const o=this.node.id.split("-");this.shortId=2===o.length?o[1]:o[0]}constructor(e,o,i,s,r,a){this.store=e,this.clipboardService=o,this.snackbar=i,this.liveAnnouncer=s,this.nodeService=r,this.changeDetectorRef=a,this.application=bt,this.shortId="",this.theme="dark",this.eventCategory="",this.nodeActionsClosed=new t.bkB}isNodeChecked(e){return this.store.selectSnapshot(Re.getNodes)[e].checked}isNodeShown(e){return this.store.selectSnapshot(Re.getNodes)[e].shown}checkNode(e,o){const i=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new un(i,[e.id]))}checkInverse(e){this.store.dispatch(new un(!0)),this.store.dispatch(new un(!1,[e.id]))}setCheckedNodes(e,o){this.store.dispatch(new un(!1));const i=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new un(i,[e.id]))}flyToNode(e){this.store.dispatch(new To(e.id)).subscribe(()=>{this.liveAnnouncer.announce("Fly to complete")})}hideNode(e){this.store.dispatch(new kn(!1,[e.id]))}showNode(e){this.store.dispatch(new kn(!0,[e.id])),this.changeDetectorRef.markForCheck()}toggleVisible(e,o){const i=void 0===o?this.isNodeShown(e.id):o;this.store.dispatch(new kn(i,[e.id])),this.changeDetectorRef.markForCheck()}togglePickable(e,o){this.store.dispatch(new Vl(o,[e.id])),this.changeDetectorRef.markForCheck()}makeEverythingElseUnpickale(e){this.store.dispatch(new Vl(!1)),this.store.dispatch(new Vl(!0,[e.id]))}toggleAvailable(e,o){this.store.dispatch(new Lg(o,[e.id])),this.changeDetectorRef.markForCheck()}hideInverse(e){this.nodeService.hideInverse([e.id])}fadeNode(e){this.nodeService.fade([e.id])}fadeInverseNodes(e){this.nodeService.fadeInverse([e.id])}editNodeLabel(e){this.store.dispatch(new ba(e)),this.store.dispatch(new _d(e))}copy(e){this.clipboardService.copyToClipboard(e,"text").subscribe(()=>{this.snackbar.open(`Copied ${e} to clipboard.`)})}onMenuClosed(){this.nodeActionsClosed.emit()}samplePaint(e){const o=this.store.selectSnapshot(Re.getNodePaint)(e.id);!function N2(n){return!(0,m.isNil)(n)&&(!(0,m.isNil)(n.brightness)&&!1!==n.brightness||!(0,m.isNil)(n.contrast)&&!1!==n.contrast||!(0,m.isNil)(n.opacity)&&!1!==n.opacity||!(0,m.isNil)(n.saturation)&&!1!==n.saturation||!(0,m.isNil)(n.tintColor)&&!1!==n.tintColor)}(yr(o))?this.store.dispatch(new Hm):this.store.dispatch(new Xm(o)),this.store.dispatch(new hr(Ct.Paint)),this.store.dispatch(new gP(N1.Paint))}copyChapterPaint(e,o){this.store.dispatch(new Ug([e.id],o))}}(Nc=ea).\u0275fac=function(e){return new(e||Nc)(t.rXU(c.il),t.rXU(Np),t.rXU(ho.UG),t.rXU(vi.Ai),t.rXU(Ym),t.rXU(t.gRc))},Nc.\u0275cmp=t.VBU({type:Nc,selectors:[["app-node-actions"]],viewQuery:function(e,o){if(1&e&&t.GBs(xk,7),2&e){let i;t.mGM(i=t.lsd())&&(o.nodeActionsTrigger=i.first)}},inputs:{node:"node",theme:"theme",eventCategory:"eventCategory"},outputs:{nodeActionsClosed:"nodeActionsClosed"},decls:73,vars:40,consts:()=>{let n,e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z,te,se,ge,st,We,ln;return n=$localize`:8973bc8c23a3f7c42aa9bd447386a3b0d26b74bc278590554940342755:menu`,e=$localize`:0a1d519b102495c607707a8de3e121d9777eb8f57459515625406813591: Isolate `,o=$localize`:3f42464a5a50bfc4200a744e960b2193b395d8336476624779946658339: Fade `,i=$localize`:23054cc1a12bc2f02ce35c53dda0a85a599c42b91462430833776684733: Fly To `,s=$localize`:54cc524c29eb42615ed3660dbda137e40d9dd5027873649950229208086: Select This `,r=$localize`:0fffdd57d53d51daf33ea3051cfee157555f7a052795853712015890159: Select Everything Else `,a=$localize`:0ef9e3fa378a368d7def26850536752a3de491cf5280042464648975457: Fade This `,l=$localize`:b8640b44be68c687650962b406f6363a3b8758d76392506384252263496: Fade Everything Else `,_=$localize`:59e0b28333dd6b25a8fccbe60b09a1e3be64c3eb4950300091124319961:Hide Everything Else`,d=$localize`:3cea94df167f2ab21fb6fbca0ac24da30254ab374608376353419364284: Make Everything Else Unselectable `,p=$localize`:70b9aca63f75c39c1c4a5a05b2ba3023a77a2b089128837186595333201: Copy Short ID `,u=$localize`:f9220e31a995fb0f115662c3b630782b55a205069004635034659549721: Copy Full ID `,g=$localize`:0a3f724079cb80043738d1f0784a7563106faddc2488186665405139057: Copy Display Name `,y=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,C=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,O=$localize`:2aba1e87039819aca3b70faa9aa848c12bf139ca8461842260159597706:Show`,L=$localize`:864421378feb1d521cd7a7174c792db76b43a2187629795719386983652: Selectable / Unselectable `,$=$localize`:f8552086e072958cbd175fce6ca62724c5f313bb4966413469492836967: Available / Unavailable `,q=$localize`:9ca20604245c07d56b1413d9e67a151a3ab2022d55699984583421362: Edit Display Name `,x=$localize`:db693767fd3d7ba3a7c6d19faf21fbacf09226512283300174173662646: Copy Display Name `,k=$localize`:353d39004ad14e085967669d05448251baab93a72821938014126744982: Copy `,A=$localize`:644238bce83ec578114cd3dd5bd26e436a5aa0994734822556615828661: Paint `,R=$localize`:28fc8508c6148c461ec04013970b2ed628bfc06e6750409730286190445: Sample Paint `,Z=$localize`:aecae3f15a1dcdaef6539af8742254268df2d8fc949649479424487283: Show This `,te=$localize`:a7e8fe945555dbaaa18d78f0de8c801524b510987893207454373836104: Hide This `,se=$localize`:8c0df0e959cce8510ca03e8bbd132b2fe106da366427053438587731451: Make Unselectable `,ge=$localize`:aad0c7bff65b576a47774f760c833686175957917620688434813021267: Make Selectable `,st=$localize`:705d20573ba656825fb85ea9a3821f4fc44d7c785350126757457915086: Make Unavailable `,We=$localize`:b7f2a4fed5d25c8fa73d89b4372d1e23c99e791e291603103988720452: Make Available `,ln=$localize`:86e8ded1a3a2365307810870677f7999fdb4baa93668102966349990426: Apply Chapter ${"\ufffd0\ufffd"}:INTERPOLATION: Paint `,[["nodeActionsTrigger","matMenuTrigger"],["nodeActions","matMenu"],["selectActions","matMenu"],["fadeActions","matMenu"],["showHideActions","matMenu"],["pickableActions","matMenu"],["availableActions","matMenu"],["copyActions","matMenu"],["paintActions","matMenu"],n,e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z,te,se,ge,st,We,ln,["app-button","","data-test","nodeActionsTrigger","buttonSize","xs","buttonShape","square",3,"menuClosed","buttonTheme","matMenuTriggerFor"],["icon","ellipsis-v","aria-hidden","true"],[1,"sr-only"],[3,"overlapTrigger"],[4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsHideShow",3,"click"],[4,"ngIf"],["mat-menu-item","","data-test","nodeActionsIsolate",3,"click"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationPage"],["mat-menu-item","","data-test","nodeActionsFlyTo",3,"click"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click",4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsSelectThis",3,"click"],["mat-menu-item","","data-test","nodeActionsSelectEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsEverythingElseUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsAvailable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsCopyShortID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyFullID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyDisplayName",3,"click"],[4,"ngFor","ngForOf"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPickableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsAvailableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPaintTrigger",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsPaintTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsSamplePaint",3,"click"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable",3,"click"],["mat-menu-item","","data-test","nodeActionsAvailable",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyShortID",3,"click",4,"ngIf"]]},template:function(e,o){if(1&e){const i=t.RV6();t.qex(0),t.j41(1,"button",39,0),t.bIt("menuClosed",function(){return t.eBV(i),t.Njj(o.onMenuClosed())}),t.nrm(3,"app-icon",40),t.j41(4,"span",41),t.EFF(5),t.qex(6),t.pXf(7,9),t.bVm(),t.k0s()(),t.j41(8,"mat-menu",42,1),t.DNE(10,Gk,4,1,"ng-container",43),t.j41(11,"button",44),t.bIt("click",function(){return t.eBV(i),t.Njj(o.toggleVisible(o.node,!o.node.boolState.shown))}),t.DNE(12,$k,2,0,"ng-container",45)(13,Fk,2,0,"ng-container",45),t.k0s(),t.j41(14,"button",46),t.bIt("click",function(){return t.eBV(i),t.Njj(o.hideInverse(o.node))}),t.pXf(15,10),t.k0s(),t.nrm(16,"mat-divider"),t.j41(17,"button",47),t.pXf(18,11),t.k0s(),t.DNE(19,Bk,4,1,"ng-container",48)(20,Wk,2,3,"ng-container",45),t.nI1(21,"async"),t.nrm(22,"mat-divider"),t.j41(23,"button",49),t.bIt("click",function(){return t.eBV(i),t.Njj(o.flyToNode(o.node))}),t.pXf(24,12),t.k0s(),t.DNE(25,Xk,1,0,"mat-divider",43)(26,Hk,2,0,"button",50)(27,Qk,3,0,"ng-container",43)(28,qk,4,2,"ng-container",43)(29,Kk,4,0,"ng-container",43),t.k0s(),t.j41(30,"mat-menu",null,2)(32,"button",51),t.bIt("click",function(){return t.eBV(i),t.Njj(o.checkNode(o.node,!0))}),t.pXf(33,13),t.k0s(),t.j41(34,"button",52),t.bIt("click",function(){return t.eBV(i),t.Njj(o.checkInverse(o.node))}),t.pXf(35,14),t.k0s()(),t.j41(36,"mat-menu",null,3)(38,"button",53),t.bIt("click",function(){return t.eBV(i),t.Njj(o.fadeNode(o.node))}),t.pXf(39,15),t.k0s(),t.j41(40,"button",54),t.bIt("click",function(){return t.eBV(i),t.Njj(o.fadeInverseNodes(o.node))}),t.pXf(41,16),t.k0s()(),t.j41(42,"mat-menu",null,4),t.DNE(44,Jk,2,0,"button",55)(45,Zk,2,0,"button",56),t.nrm(46,"mat-divider"),t.j41(47,"button",57),t.bIt("click",function(){return t.eBV(i),t.Njj(o.hideInverse(o.node))}),t.pXf(48,17),t.k0s()(),t.j41(49,"mat-menu",null,5),t.DNE(51,e3,2,0,"button",58)(52,t3,2,0,"button",59),t.nrm(53,"mat-divider"),t.j41(54,"button",60),t.bIt("click",function(){return t.eBV(i),t.Njj(o.makeEverythingElseUnpickale(o.node))}),t.pXf(55,18),t.k0s()(),t.j41(56,"mat-menu",null,6),t.DNE(58,n3,2,0,"button",61)(59,i3,2,0,"button",62),t.k0s(),t.j41(60,"mat-menu",null,7)(62,"button",63),t.bIt("click",function(){return t.eBV(i),t.Njj(o.copy(o.shortId))}),t.pXf(63,19),t.k0s(),t.j41(64,"button",64),t.bIt("click",function(){return t.eBV(i),t.Njj(o.copy(o.node.id))}),t.pXf(65,20),t.k0s(),t.nrm(66,"mat-divider"),t.j41(67,"button",65),t.bIt("click",function(){return t.eBV(i),t.Njj(o.copy(o.node.label))}),t.pXf(68,21),t.k0s()(),t.j41(69,"mat-menu",null,8),t.DNE(71,s3,3,3,"ng-container",66),t.nI1(72,"async"),t.k0s(),t.bVm()}if(2&e){const i=t.sdS(9),s=t.sdS(37);t.R7$(),t.Y8G("buttonTheme",o.theme)("matMenuTriggerFor",i),t.R7$(4),t.SpI("",o.node.label," "),t.R7$(3),t.Y8G("overlapTrigger",!0),t.R7$(2),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(2),t.Y8G("ngIf",o.node.boolState.shown),t.R7$(),t.Y8G("ngIf",!o.node.boolState.shown),t.R7$(4),t.Y8G("matMenuTriggerFor",s),t.R7$(2),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit"),t.R7$(),t.Y8G("ngIf",t.bMT(21,36,o.perChapterTreeEnabled$)),t.R7$(5),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(),t.Y8G("appFlagApplication",o.application.Studio)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(),t.Y8G("appFlagApplication",o.application.Loft)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),t.R7$(15),t.Y8G("ngIf",!o.node.boolState.shown),t.R7$(),t.Y8G("ngIf",o.node.boolState.shown),t.R7$(6),t.Y8G("ngIf",o.node.boolState.pickable),t.R7$(),t.Y8G("ngIf",!o.node.boolState.pickable),t.R7$(6),t.Y8G("ngIf",o.node.boolState.available),t.R7$(),t.Y8G("ngIf",!o.node.boolState.available),t.R7$(12),t.Y8G("ngForOf",t.bMT(72,38,o.chapters$))}},dependencies:[b.Sq,b.bT,Ep,jn.kk,jn.fb,jn.Cp,jk.q,hi.Q,qe,b.Jj],changeDetection:0}),df([(0,c.l6)(Io.getPerChapterTreeEnabled),pf("design:type",f.c)],ea.prototype,"perChapterTreeEnabled$",void 0),df([(0,c.l6)(E.getStoryChapters),pf("design:type",f.c)],ea.prototype,"chapters$",void 0),df([(0,c.l6)(E.getSelectedChapterId),pf("design:type",f.c)],ea.prototype,"selectedChapterId$",void 0);let r3=(()=>{var n;class e{constructor(i){this.store=i}ngOnInit(){}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger.openMenu()}onNodeActionsClosed(){this.store.dispatch(new wl(null,null))}getNodeActionsStyles(){return{"left.px":this.hit?this.hit.canvasPos.x:0,"top.px":this.hit?this.hit.canvasPos.y:0}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-engine-contextmenu"]],viewQuery:function(i,s){if(1&i&&t.GBs(ea,7),2&i){let r;t.mGM(r=t.lsd())&&(s.nodeActionsComponent=r.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"nodeActionsClosed","ngStyle","node"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"app-node-actions",1),t.bIt("nodeActionsClosed",function(){return s.onNodeActionsClosed()}),t.k0s()()),2&i&&(t.R7$(),t.Y8G("ngStyle",s.getNodeActionsStyles())("node",s.node))},dependencies:[b.B3,ea],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]}),e})();var Rc,bn=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},yn=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const a3=["engine"],l3=n=>({"engine--hidden":n});function c3(n,e){1&n&&t.nrm(0,"div",8)}function _3(n,e){if(1&n&&t.nrm(0,"app-engine-contextmenu",9),2&n){const o=t.XpG();t.Y8G("node",o.contextmenuNode)("hit",o.contextmenuHit)}}function d3(n,e){1&n&&t.nrm(0,"div",10)}function p3(n,e){1&n&&t.nrm(0,"app-engine-progress",11)}function u3(n,e){if(1&n&&(t.j41(0,"div",12),t.nrm(1,"app-engine-stats",13),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG(),i=t.sdS(1);t.Y8G("cdkDragBoundary",i),t.R7$(),t.Y8G("theme",o.isBackgroundLight?"light":"dark")("showAdvancedTools",t.bMT(2,3,o.showAdvancedTools$))}}function g3(n,e){1&n&&(t.qex(0),t.nrm(1,"app-engine-camera-position"),t.bVm())}var ta=function(n){return n[n.Pan=.4]="Pan",n[n.PanSlow=.04]="PanSlow",n[n.Zoom=5]="Zoom",n[n.ZoomSlow=1]="ZoomSlow",n[n.Rotate=.3]="Rotate",n[n.RotateSlow=.03]="RotateSlow",n}(ta||{}),ds=function(n){return n[n.Rotate=6]="Rotate",n[n.Pan=1.75]="Pan",n[n.Zoom=2.5]="Zoom",n}(ds||{}),li=function(n){return n[n.Zoom=-6]="Zoom",n[n.TrackZoom=.5]="TrackZoom",n[n.Pan=1.25]="Pan",n[n.Rotate=1.5]="Rotate",n[n.Friction=.85]="Friction",n[n.ZoomFriction=.85]="ZoomFriction",n[n.FrictionThreshold=.002]="FrictionThreshold",n}(li||{}),Qs=function(n){return n.Fade="engine--cursor-fade",n.Hide="engine--cursor-hide",n.Label="engine--cursor-label",n.Paint="engine--cursor-paint",n.Eyedropper="engine--cursor-eyedropper",n.Crosshair="engine--cursor-crosshair",n.Default="",n}(Qs||{}),R1=function(n){return n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.LeftAndRight=4]="LeftAndRight",n}(R1||{});const k1=1e3/60;class an{wheel(e){const o=this.store.selectSnapshot(U.getScrollMode),i=e.ctrlKey;o===As.DoNotCaptureShowMessage&&!i&&this.store.dispatch(new gb(!0)),(o===As.Capture||i)&&(e.preventDefault(),this.handleWheel(e))}contextmenu(e){this.handleContextMenu(e)}mouseout(){this.handleMouseOut()}constructor(e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q){this.actions=e,this.activatedRoute=o,this.animationService=i,this.cameraService=s,this.changeDetecton=r,this.engineService=a,this.xrService=l,this.sceneService=_,this.mediaService=d,this.paintService=p,this.renderer=u,this.storageService=g,this.store=y,this.applicationEventService=C,this.particleSystemsService=O,this.engineRendererService=L,this.clippingPlanesService=$,this.liveAnnouncer=q,this.VERSION=ee.VERSION,this.flyCamera=!0,this.visible=!1,this.application=bt,this.cursorClass=Qs.Default,this.chapterReady=!1,this.ngUnsubscribe=new oe.B,this.display=!1,this.engineVisible=!0,this.background=new He.t(null),this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,this.inputEnabled=!0,he.application===bt.Loft&&S.e(361).then(S.t.bind(S,5361,23)).then(k=>{window.pako=k}),this.showDebug=he.application===bt.Loft||"true"===this.storageService.getLocalItem(In.CameraDebug),he.deploy===En.Production&&(he.application===bt.Studio||he.application===bt.Viewer)||console.table({Commit:ee.COMMIT,Time:new Date(ee.TIMESTAMP).toLocaleString(),Version:ee.VERSION})}convertToLeafStateMap(e,o){const i={};return Object.entries(o).forEach(([s,r])=>{i[s]={},i[s][e]=r}),i}ngOnInit(){this.particleStateListener=new D2(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initVideo(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.particleStateListener.destroy(),this.engineService.destroyEngine(),this.animationService.destroyPlayer(),this.xrService.destroyXR(),this.canvas?.remove(),this.canvas=null,this.changeDetecton.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const e=this.store.selectSnapshot(U.getWebGLContextName),o=this.activatedRoute.snapshot.queryParams.disableTextureCompression,i="true"===o||o?.split(",").reduce((r,a)=>({...r,[a.trim().toLowerCase()]:!0}),{});this.engineService.initEngine({contextName:e,disableTextureCompression:i}),this.canvas=this.engineRendererService.getCanvas(),this.canvas.style.zIndex="1",this.canvas.dataset.test="engineCanvas",this.engineElement.nativeElement.prepend(this.canvas),this.xrService.initXR(this.engineService.engine)}bindEngineEvents(){this.engineService.getEvent(pe.Loaded).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Hu(!0))}),this.engineService.getEvent(pe.TimelineChapterTransition).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(Ce.LabelsChapterInfo,this.store.selectSnapshot(ye.getChapterLabels))}),(0,Ao.h)(this.engineService.getEvent(pe.TimelinePlayed),this.engineService.getEvent(pe.TimelinePaused)).pipe((0,w.Q)(this.ngUnsubscribe),(0,X.p)(()=>null!=this.store.selectSnapshot(E.getSelectedChapterId)),(0,Pn.B)(50),(0,F.T)(()=>this.animationService.isPlaying())).subscribe(e=>{this.store.dispatch(new eg(e))}),this.engineService.getEvent(pe.Tick).pipe((0,X.p)(()=>this.visible&&!(0,m.isNil)(this.engineService.engine?.story)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.inputEnabled&&this.handleMouseInputEngineTick(e),this.handleCameraTick(e),this.deltaTime=window.performance.now()}),this.engineService.getEvent(pe.TweenVisibilityUpdate).pipe((0,el.E)(this.store.select(E.getIsChapterAnimated),this.store.select(E.getSelectedChapterModelReady)),(0,X.p)(([e,o,i])=>o&&i&&Object.keys(e).length>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{const o=[],i=[];Object.entries(e).forEach(([s,r])=>{r?o.push(s):i.push(s)}),o.length>0&&this.store.dispatch(new wd(!0,o)),i.length>0&&this.store.dispatch(new wd(!1,i)),this.applyShownPatches(e,!1)}),this.engineService.getEvent(pe.VariantsUpdate).pipe((0,X.p)(e=>Object.keys(e).length>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applyVariantPatches(e,!0,!1,!1)}),this.engineService.getEvent(pe.SceneObjectRenderable).pipe((0,k2.w)(1e3),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{if(e.length){const o={};e.forEach(i=>{o[i.objectId]={renderable:!0}}),this.store.dispatch(new qu(o))}}),this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({chapterId:e,chapterProgress:o})=>{const i=this.store.selectSnapshot(Pe.getLoadChapters).length,a=1/i,d=o*a+(i-Math.max(this.store.selectSnapshot(Pe.getLoadChaptersRemaining).length,1))*a;this.progress=d.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new vh(d,e,o))}),this.engineService.getEvent(pe.CameraUpdated).pipe((0,X.p)(()=>!this.cameraAnimating),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(pe.CameraRested).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,c.xi)(ma),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,X.p)(e=>null!=e),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.enginePosition=e,this.repositionEngine(e)}),this.store.select(U.getXrayModeEnabled).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.store.selectSnapshot(Re.getCheckedNodes),i=this.store.selectSnapshot(Re.getNodes),s=this.store.selectSnapshot(U.getViewGraph);!1===e?(Object.keys(i||[]).forEach(r=>{this.paintService.paint(s,r,i[r].paint)}),o.forEach(r=>this.paintService.highlight(s,r.objectId,!0))):(this.paintService.paintAll(s,Object.keys(i),Es),this.paintService.paintAll(s,o.map(r=>r.objectId),Ma))}),this.actions.pipe((0,c.xi)(fb),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.display=e,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.engineVisible=e,this.changeDetecton.markForCheck()}),this.contextmenu$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.contextmenuNode=e.node,this.contextmenuHit=e.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,X.p)(e=>!(0,m.isNil)(e)),(0,Wr.J)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{const i=this.store.selectSnapshot(U.getChapter);if(this.store.selectSnapshot(E.getSelectedChapterReadyState).model){const a=o.id;if(e.id===a&&i===a)return;this.animationService.setChapter(a).then(()=>{this.store.dispatch(new Oa(a)),qm(this.store,this.engineService),this.store.dispatch(new Sd(void 0))})}}),(0,Tt.z)([this.clippingPlanes$,this.readyState$]).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)&&!0===o?.model),(0,Vn.F)(m.isEqual),(0,Pn.B)(0),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{this.clippingPlanesService.setClippingPlanes(e)}),(0,Tt.z)([this.selectedChapterId$,this.readyState$,this.autoplay$]).pipe((0,X.p)(([e,o,i])=>!(0,m.isNil)(e)&&!(0,m.isNil)(o)&&!(0,m.isNil)(i)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,e,o])=>{const i=(0,m.get)(e,"animation",!1),s=this.store.selectSnapshot(E.getSelectedChapter),r=(0,m.get)(s,"ui.play.autoplay",!0),a=i&&o&&r;a&&(this.store.dispatch(new ld),this.store.dispatch(new Yo(a)))})}bindCameraEvents(){this.actions.pipe((0,c.xi)(di),(0,X.p)(e=>!(0,m.isNil)(e.camera)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{(e.animate?this.flyToCamera(e.camera,e.animationDuration):this.jumpToCamera(e.camera)).then(()=>{this.liveAnnouncer.announce("Camera Postion Updated"),this.store.dispatch(new fg),e.rotationCenter&&this.cameraService.setCameraRotationCenter(e.rotationCenter)})}),this.actions.pipe((0,c.xi)(jb),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.cameraService.panCameraStatic(e.x,e.y,e.z)}),this.actions.pipe((0,c.xi)($b),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.cameraService.rotateCameraStatic(e.x,e.y)}),this.actions.pipe((0,c.xi)(Sg),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.cameraService.setAbsoluteZoom(e.value)}),this.actions.pipe((0,c.xi)(To),(0,X.p)(e=>!!e.objectId),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.liveAnnouncer.announce("Camera position updated"),(e.animate?this.flyToObject(e.objectId,e.animationDuration):this.jumpToObject(e.objectId)).then(()=>{this.store.dispatch(new fg)})})}bindToolEvents(){this.activeTool$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{switch(Object.values(Qs).forEach(o=>{o&&this.renderer.removeClass(this.engineElement.nativeElement,o)}),e){case Ct.Fade:this.renderer.addClass(this.engineElement.nativeElement,Qs.Fade);break;case Ct.Hide:this.renderer.addClass(this.engineElement.nativeElement,Qs.Hide);break;case Ct.Label:this.renderer.addClass(this.engineElement.nativeElement,Qs.Label);break;case Ct.Paint:this.renderer.addClass(this.engineElement.nativeElement,Qs.Paint);break;case Ct.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,Qs.Eyedropper)}})}bindMouseEvents(){this.mouseMove$=(0,hn.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.handleMousePan(e)}),this.mouseMove$.pipe((0,el.E)(this.store.select(U.getHoverPickEnabled)),(0,c1.c)(10),(0,X.p)(([,e])=>e),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{this.handleMouseHover(e)}),this.mouseLeave$=(0,hn.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,c1.c)(10),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(e){return(0,hn.R)(window,e).pipe((0,X.p)(o=>(0,m.isEmpty)(document.querySelectorAll(".cdk-overlay-pane"))))}bindKeyEvents(){const e=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((s,r)=>(s[r]=!1,s),{}),o=new He.t(e);let i;this.bindWindowKeyEvent("keydown").pipe((0,X.p)(s=>!(s.repeat||s.metaKey||s.ctrlKey)),(0,X.p)(s=>{const a=s.target.nodeName.toLowerCase();return!(["input","textarea","select","option","button"].indexOf(a)>=0)}),(0,w.Q)(this.ngUnsubscribe)).subscribe(s=>{o.next({...o.value,[s.key.toLowerCase()]:!0,shiftKey:s.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,X.p)(s=>!!s.key),(0,w.Q)(this.ngUnsubscribe)).subscribe(s=>{1===Object.values(i).filter(a=>!0===a).length?(this.applyMotion(i,!0),o.next({...o.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1===i.shiftKey})):o.next({...o.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1})}),o.pipe((0,X.p)(()=>this.inputEnabled),(0,w.Q)(this.ngUnsubscribe)).subscribe(s=>{i=s,!1===s.hasMomentum&&this.applyMotion(s,!1)})}applyMotion(e,o){const i=new Og,s=e.shiftKey?ta.ZoomSlow:ta.Zoom,r=e.shiftKey?ta.PanSlow:ta.Pan,a=e.shiftKey?ta.RotateSlow:ta.Rotate;i.zoom+=e.c||e["-"]||e._?s:0,i.zoom-=e.e||e["="]||e["+"]?s:0,i.panX-=e.d?r:0,i.panX+=e.a?r:0,i.panY+=e.w?r:0,i.panY-=e.s?r:0,i.rotateX-=e.arrowright?a:0,i.rotateX+=e.arrowleft?a:0,i.rotateY+=e.arrowup?a:0,i.rotateY-=e.arrowdown?a:0,i.applyFriction=o,this.store.dispatch(new Ea(i))}initChangeListener(){this.nodeStatePatches$.pipe((0,X.p)(e=>e.length>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=e.reduce((p,u)=>{const g=u.path[u.path.length-1];return void 0!==p[g]&&p[g].push(u),p},{available:[],shown:[],checked:[],paint:[],pickable:[],variant:[]}),i=p=>o[p].reduce((u,g)=>(u[g.path[2]]=g.value,u),{}),s=i("available"),r=i("checked"),a=i("shown"),l=i("paint"),_=i("pickable"),d=i("variant");(0,m.isEmpty)(s)||this.applyAvailablePatches(s),(0,m.isEmpty)(a)||this.applyShownPatches(a,!0),(0,m.isEmpty)(r)||this.applyCheckedPatches(r),(0,m.isEmpty)(l)||this.applyPaintPatches(l),(0,m.isEmpty)(_)||this.applyPickablePatches(_),(0,m.isEmpty)(d)||this.applyVariantPatches(d,!1,!0,!0)})}initBackgroundListener(){(0,Tt.z)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",function rM(n){const e=n.colors,o=`rgba(${e[0]},${e[1]}, ${e[2]}, ${e[3]}) ${n.colorStops[0]}%`,i=`rgba(${e[4]},${e[5]}, ${e[6]}, ${e[7]}) ${n.colorStops[1]}%`;return"radial"===n.gradientType?`radial-gradient(circle, ${o}, ${i})`:`linear-gradient(180deg, ${o}, ${i})`}(e)),this.isBackgroundCheckered(e)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",o?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",i?1:0)}),this.background$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.isBackgroundLight=Qg(e),this.changeDetecton.markForCheck()})}initPlaybackSpeedListener(){this.store.select(U.getPlaybackSpeed).pipe((0,X.p)(()=>this.store.selectSnapshot(E.getSelectedChapterAnimationReady)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.animationService.setPlaybackRate(e)})}repositionEngine(e){const o=this.engineElement.nativeElement,{top:i,left:s,width:r,height:a,visibility:l,scale:_,viewportWidth:d,viewportHeight:p}=e;this.renderer.setStyle(o,"left",`${s}px`),this.renderer.setStyle(o,"top",`${i}px`),this.renderer.setStyle(o,"width",`${r}px`),this.renderer.setStyle(o,"height",`${a}px`),this.renderer.setStyle(o,"transform",`scale(${_})`),this.renderer.setStyle(o,"zIndex",`${l}`),this.renderer.setStyle(o,"visibility",l===Pl.Shown?"visible":"hidden"),d!==r||p!==a||1!==_?this.renderer.addClass(o,"engine--scaled"):this.renderer.removeClass(o,"engine--scaled");const u=Math.max(1,Math.floor(1/_));o?.style?.setProperty("--engine-border-width",`${u}px`),this.visible=l===Pl.Shown,this.engineService.fireEvent(pe.CanvasResized)}bindHumanInteractions(){this.hammerManager=new Jn.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new Jn.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new Jn.Tap({event:"singletap"})),this.hammerManager.add(new Jn.Pan({event:"pan",pointers:0})),this.hammerManager.add(new Jn.Pinch({event:"pinch"})),this.hammerManager.add(new Jn.Press({time:500})),this.hammerManager.on("singletap",i=>{this.store.selectSnapshot(U.getClickPickEnabled)&&this.handleTap(i)}),this.hammerManager.on("doubletap",i=>{this.handleDoubleTap(i)}),this.hammerManager.on("press",i=>{i.preventDefault(),i.srcEvent.stopImmediatePropagation(),this.handlePress(i)}),this.hammerManager.on("pan",i=>{i.preventDefault(),this.handlePan(i)}),this.hammerManager.on("panend",i=>{this.handlePanEnd(i)}),this.hammerManager.on("pinchend",i=>{this.handlePinchEnd(i)});let e=0,o=0;this.hammerManager.on("pinchstart",i=>{e=i.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",i=>{if(this.pinchTicks>0)return;const s=Math.abs(i.deltaX)>60||Math.abs(i.deltaY)>60,r=i.scale>1.25||i.scale<.75;this.pinchMode?("pan"===this.pinchMode&&r&&!s&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&s&&!r&&(this.pinchMode="pan")):this.pinchMode=r?"pinch":"pan";const a=i.scale-e;e=i.scale;const l=o;o=0===a?0:a>0?1:-1,this.cameraService.setCameraPan(i.velocityX*li.Pan,i.velocityY*li.Pan),o+l!==0&&this.cameraService.setRelativeZoom(a*li.Zoom)})}handleMouseHover(e){if(e.buttons!==R1.None)return;const{offsetX:o,offsetY:i}=e,s=this.pickAtCanvasPosition(o,i,!1);if(s.objectId){const r=this.store.selectSnapshot(U.getViewGraph),a=this.sceneService.getViewNode(r,s.objectId),l=this.store.selectSnapshot(U.getHoveredNode);(!l||l.id!==a.id)&&this.store.dispatch(new ya(a,s))}else null!=this.store.selectSnapshot(U.getHoveredNode)&&this.store.dispatch(new ya(null))}handleMouseLeave(){this.store.dispatch(new ya(null))}handleMousePan(e){if(2===e.buttons||4===e.buttons){let{movementX:o,movementY:i}=e;o/=16,i/=16,this.cameraService.setCameraPan(o,i)}}handleMouseOut(){this.store.dispatch(new ya(null))}handleWheel(e){let o=0;0===e.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(e.deltaY)<10?"trackpad":"wheel"),o="trackpad"===this.scrollType?e.deltaY*li.TrackZoom:Math.sign(e.deltaY)*ds.Zoom):(this.scrollType="wheel",o=e.deltaY*ds.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(o)>40&&(o=40*Math.sign(o)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(o):this.zoomWithVelocity(o)}zoomWithVelocity(e){this.cameraService.setCameraZoom(e),requestAnimationFrame(()=>{e*=.85,Math.abs(e)>1&&this.zoomWithVelocity(e)})}handleContextMenu(e){e.preventDefault();const{offsetX:o,offsetY:i}=e,s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);this.store.dispatch(new wl(r,s))}handlePanEnd(e){const o=this.store.selectSnapshot(vt.getCameraMotion);if(this.pinchTicks>0||o.panX===e.velocityX&&o.panY===e.velocityY)return;const i=this.store.selectSnapshot(vt.getPanMode);e.srcEvent.shiftKey||"pan"===i?(o.panX=e.velocityX*li.Pan,o.panY=e.velocityY*li.Pan):(o.rotateX=e.velocityX*li.Rotate,o.rotateY=e.velocityY*li.Rotate),o.applyFriction=!0,this.store.dispatch(new Ea(o))}handlePinchEnd(e){const o=this.store.selectSnapshot(vt.getCameraMotion);if("pan"===this.pinchMode)o.panX=e.velocityX*li.Pan,o.panY=e.velocityY*li.Pan;else{const i=e.velocity>0?1:-1;o.zoom=Math.sqrt(e.velocityX*e.velocityX+e.velocityY*e.velocityY)*-i*li.Zoom}o.applyFriction=!0,this.store.dispatch(new Ea(o)),this.pinchTicks=10}handleTap(e){const{offsetX:o,offsetY:i}=this.getOffset(e),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);this.store.dispatch(new ad(r,e,s))}handleDoubleTap(e){const{offsetX:o,offsetY:i}=this.getOffset(e),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);r&&this.store.dispatch(new To(r.id))}handlePress(e){const{offsetX:o,offsetY:i}=this.getOffset(e),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);r&&this.store.dispatch(new To(r.id))}handlePan(e){if(this.pinchTicks>0)return;const o=this.store.selectSnapshot(vt.getPanMode),{velocityX:i,velocityY:s}=e;e.srcEvent.shiftKey||"pan"===o?this.cameraService.setCameraPan(i*li.Pan,s*li.Pan):this.cameraService.setCameraRotation(i*li.Rotate,s*li.Rotate)}handleMouseInputEngineTick(e){const o=this.cameraService.tickCameraRotation(),i=this.cameraService.tickCameraPan(),s=this.cameraService.tickCameraZoom(),r=Math.min(15,(window.performance.now()-this.deltaTime)/k1);if((o.vx||o.vy)&&this.cameraService.rotateCameraStatic(0!==o.vx?r*o.vx*ds.Rotate:0,0!==o.vy?r*o.vy*ds.Rotate:0),i.x||i.y){const a=this.cameraService.getLookDistance(),l=Math.max(a/80,.01);this.cameraService.panCameraStatic(r*i.x*l*ds.Pan,r*i.y*l*ds.Pan,r*i.z*l*ds.Pan)}0!==s&&this.cameraService.setRelativeZoom(r*s*ds.Zoom)}handleCameraTick(e){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const o=this.store.selectSnapshot(vt.getCameraMotion);this.cameraService.setCameraPan(o.panX,o.panY),this.cameraService.setCameraRotation(o.rotateX,o.rotateY),this.cameraService.setCameraZoom(o.zoom),this.cameraService.tickCamera(e)}applyCheckedPatches(e){this.engineService.fireEvent(pe.SceneObjectsSelected,{selectedObjectsUpdate:e});const o=this.store.selectSnapshot(U.getViewGraph),i=this.store.selectSnapshot(U.getXrayModeEnabled);Object.entries(e).forEach(([s,r])=>{i?this.paintService.paint(o,s,!0===r?Ma:Es):this.paintService.highlight(o,s,r)})}applyShownPatches(e,o){const i=Object.keys(e),s=this.sceneService.getObjectsById(i),r=i.reduce((d,p)=>(this.sceneService.isLeaf(s[p])&&(d[p]=e[p]),d),{});this.engineService.fireEvent(pe.SceneObjectsShown,{enabledObjectsUpdate:r});const a=this.store.selectSnapshot(Re.getNodes),l=Object.values(a).reduce((d,p)=>(d[p.objectId]=p.shown,d),{});o&&this.sceneService.setNodesVisible(l);const _=this.convertToLeafStateMap("shown",l);this.store.dispatch(new Yu(_,a))}applyPaintPatches(e){Object.entries(e).forEach(([o,i])=>{this.paintService.colorObject(o,yr(i))})}applyPickablePatches(e){const o=this.store.selectSnapshot(Re.getNodes),i=Object.values(o).reduce((s,r)=>(s[r.objectId]=r.pickable,s),{});this.sceneService.setNodesProperty(i,"pickable"),this.store.dispatch(new Ku(this.convertToLeafStateMap("pickable",i),o))}applyAvailablePatches(e){const o=this.store.selectSnapshot(Re.getNodes),i=this.convertToLeafStateMap("available",e);this.store.dispatch(new Ju(i,o))}applyVariantPatches(e,o,i,s){if(o&&this.store.dispatch(new jl(e,s)),i){const{anatomyObjects:r}=this.sceneService.getAnatomySceneGraph();Object.entries(e).forEach(([a,l])=>{this.sceneService.setObjectVariant(r,a,l)})}}getFriction(e){if(0===e)return 0;const o=(window.performance.now()-this.deltaTime)/k1;let s=e*Math.max(0,li.Friction+.1*(1-o));return Math.abs(s)<li.FrictionThreshold&&(s=0),s}applyFriction(){const e=this.store.selectSnapshot(vt.getCameraMotion);!0===e.applyFriction&&(e.rotateX=this.getFriction(e.rotateX),e.rotateY=this.getFriction(e.rotateY),e.panX=this.getFriction(e.panX),e.panY=this.getFriction(e.panY),e.zoom=this.getFriction(e.zoom),0===e.rotateX&&0===e.rotateY&&0===e.panX&&0===e.panY&&0===e.zoom&&(e.applyFriction=!1),this.store.dispatch(new Ea(e)))}flyToObject(e,o){return this.cameraService.flyToObject(e,o)}flyToCamera(e,o){return this.cameraService.flyToCamera(e,o)}jumpToObject(e){return this.cameraService.jumpToObject(e)}jumpToCamera(e){return this.cameraService.jumpToCamera(e)}getNodeFromHit(e){let o;if(e.objectId){const i=this.store.selectSnapshot(U.getViewGraph);o=this.sceneService.getViewNode(i,e.objectId)}return o}pickAtCanvasPosition(e,o,i=!0){const s=this.enginePosition?.scale??1;if(1!==s){const r=1/s,a=ee.vec3Pool.get();[e,o]=Ee.scale(a,[e,o,0],r),ee.vec3Pool.release(a)}return this.engineRendererService.pick(e,o,i)}getOffset(e){let o=0,i=0;e.center?(o=e.center.x,i=e.center.y):(o=e.clientX,i=e.clientY);const r=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:o-r.left,offsetY:i-r.top}}isTransparentBackground(e){return!!e&&kd(this.background.getValue())}isBackgroundCheckered(e){return he.application!==bt.Viewer&&this.isTransparentBackground(e)}playChapterFromStart(){this.store.selectSnapshot(E.getSelectedChapterReadyState).animation&&(this.store.dispatch(new ld),this.store.dispatch(new Yo(!0)))}initVideo(){this.mediaService.getVideoEvents().pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const{id:o,event:i}=e;"play"===i&&this.store.dispatch(new Op(o)),this.store.selectSnapshot(il.getCurrentVideo)===o&&("pause"===i||"ended"===i)&&this.store.dispatch(new Op(null))})}}(Rc=an).\u0275fac=function(e){return new(e||Rc)(t.rXU(c.En),t.rXU(ut.nX),t.rXU(bi),t.rXU(Pi),t.rXU(t.gRc),t.rXU(Lt),t.rXU(sf),t.rXU(cn),t.rXU(Di),t.rXU(Mr),t.rXU(t.sFG),t.rXU(Le),t.rXU(c.il),t.rXU(mo),t.rXU(X2),t.rXU(ws),t.rXU(pv),t.rXU(vi.Ai))},Rc.\u0275cmp=t.VBU({type:Rc,selectors:[["app-engine"]],viewQuery:function(e,o){if(1&e&&t.GBs(a3,7),2&e){let i;t.mGM(i=t.lsd())&&(o.engineElement=i.first)}},hostBindings:function(e,o){1&e&&t.bIt("wheel",function(s){return o.wheel(s)})("contextmenu",function(s){return o.contextmenu(s)})("mouseout",function(s){return o.mouseout(s)})},inputs:{inputEnabled:"inputEnabled"},decls:16,vars:24,consts:[["engine",""],["id","container","data-test","engine","role","complementary",1,"engine",3,"ngClass"],["class","engine__watermark","role","img","aria-label","watermark","data-test","engineWatermark",4,"ngIf"],[3,"node","hit",4,"ngIf"],["data-test","engineInputBlocker","class","engine__input-blocking",4,"ngIf"],["data-test","engineProgressBar",4,"ngIf"],["class","engine__stats","cdkDrag","",3,"cdkDragBoundary",4,"ngIf"],[4,"ngIf"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"],["cdkDrag","",1,"engine__stats",3,"cdkDragBoundary"],[3,"theme","showAdvancedTools"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1,0),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,c3,1,0,"div",2),t.nI1(5,"async"),t.nrm(6,"app-labels"),t.DNE(7,_3,1,2,"app-engine-contextmenu",3)(8,d3,1,0,"div",4)(9,p3,1,0,"app-engine-progress",5),t.nI1(10,"async"),t.nrm(11,"app-engine-scroll")(12,"app-engine-fade"),t.DNE(13,u3,3,5,"div",6),t.nI1(14,"async"),t.DNE(15,g3,2,0,"ng-container",7),t.k0s()),2&e){const i=t.sdS(1);t.Y8G("ngClass",t.eq3(22,l3,"screen"===t.bMT(2,12,o.overlayType$))),t.BMQ("data-progress",o.progress)("data-chapter-ready",o.chapterReady)("data-camera-animating",o.cameraAnimating)("data-story-id",t.bMT(3,14,o.storyId$))("data-engine-version",o.VERSION),t.R7$(4),t.Y8G("ngIf",t.bMT(5,16,o.watermarkEnabled$)),t.R7$(3),t.Y8G("ngIf",o.contextmenuNode),t.R7$(),t.Y8G("ngIf",!o.inputEnabled),t.R7$(),t.Y8G("ngIf",t.bMT(10,18,o.showProgressBar$)),t.R7$(4),t.Y8G("ngIf",t.bMT(14,20,o.statsEnabled$)),t.R7$(2),t.Y8G("ngIf",o.showDebug&&i)}},dependencies:[b.YU,b.bT,Bl.T1,Zn,Pc,Pk,Rk,Uk,Vk,r3,b.Jj],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--hidden[_ngcontent-%COMP%]{display:none!important}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.svg) 7 20,pointer}.engine--cursor-fade[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-fade.svg) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.svg) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.svg) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea),linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea)}.engine--scaled[_ngcontent-%COMP%]{outline:var(--engine-border-width, 1px) solid #d7e0ea}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}.engine__stats[_ngcontent-%COMP%]{position:absolute;width:-moz-fit-content;width:fit-content;max-height:calc(100vh - 32px);overflow:auto;top:16px;right:16px;z-index:2}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0}),bn([(0,c.l6)(U.getReady),yn("design:type",f.c)],an.prototype,"ready$",void 0),bn([(0,c.l6)(U.getViewGraph),yn("design:type",f.c)],an.prototype,"viewGraph$",void 0),bn([(0,c.l6)(U.getEnginePosition),yn("design:type",f.c)],an.prototype,"enginePosition$",void 0),bn([(0,c.l6)(U.getHoveredNode),yn("design:type",f.c)],an.prototype,"hoveredNode$",void 0),bn([(0,c.l6)(U.getChapter),yn("design:type",f.c)],an.prototype,"chapter$",void 0),bn([(0,c.l6)(Re.getPatches),yn("design:type",f.c)],an.prototype,"nodeStatePatches$",void 0),bn([(0,c.l6)(U.getActiveTool),yn("design:type",f.c)],an.prototype,"activeTool$",void 0),bn([(0,c.l6)(U.getAnimationPlaying),yn("design:type",f.c)],an.prototype,"animationPlaying$",void 0),bn([(0,c.l6)(U.getDisplay),yn("design:type",f.c)],an.prototype,"engineDisplay$",void 0),bn([(0,c.l6)(U.getVisible),yn("design:type",f.c)],an.prototype,"engineVisible$",void 0),bn([(0,c.l6)(U.getShowProgressBar),yn("design:type",f.c)],an.prototype,"showProgressBar$",void 0),bn([(0,c.l6)(U.getContextmenu),yn("design:type",f.c)],an.prototype,"contextmenu$",void 0),bn([(0,c.l6)(U.getAutoplay),yn("design:type",f.c)],an.prototype,"autoplay$",void 0),bn([(0,c.l6)(Pe.getStoryId),yn("design:type",f.c)],an.prototype,"storyId$",void 0),bn([(0,c.l6)(E.getSelectedChapter),yn("design:type",f.c)],an.prototype,"selectedChapter$",void 0),bn([(0,c.l6)(E.getSelectedChapterId),yn("design:type",f.c)],an.prototype,"selectedChapterId$",void 0),bn([(0,c.l6)(E.getSelectedChapterReadyState),yn("design:type",f.c)],an.prototype,"readyState$",void 0),bn([(0,c.l6)(E.getSelectedChapterClippingPlanes),yn("design:type",f.c)],an.prototype,"clippingPlanes$",void 0),bn([(0,c.l6)(vt.getCameraMotion),yn("design:type",f.c)],an.prototype,"cameraMotion$",void 0),bn([(0,c.l6)(E.getSelectedChapterBackground),yn("design:type",f.c)],an.prototype,"background$",void 0),bn([(0,c.l6)(U.getWatermarkEnabled),yn("design:type",f.c)],an.prototype,"watermarkEnabled$",void 0),bn([(0,c.l6)(U.getStatsEnabled),yn("design:type",f.c)],an.prototype,"statsEnabled$",void 0),bn([(0,c.l6)(U.getShowAdvancedStatsTools),yn("design:type",f.c)],an.prototype,"showAdvancedTools$",void 0),bn([(0,c.l6)(Nn.getXROverlayType),yn("design:type",f.c)],an.prototype,"overlayType$",void 0);const m3=(n,e)=>({"pillbox-divider--horizontal":n,"pillbox-divider--vertical":e});let Rp=(()=>{var n;class e{constructor(){this.orientation="horizontal"}ngOnInit(){}get justifySelf(){return"vertical"===this.orientation?"stretch":""}get alignSelf(){return"horizontal"===this.orientation?"stretch":""}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-pillbox-divider"]],hostVars:4,hostBindings:function(i,s){2&i&&t.xc7("justify-self",s.justifySelf)("align-self",s.alignSelf)},inputs:{orientation:"orientation"},decls:1,vars:4,consts:[[1,"pillbox-divider",3,"ngClass"]],template:function(i,s){1&i&&t.nrm(0,"div",0),2&i&&t.Y8G("ngClass",t.l_i(1,m3,"horizontal"===s.orientation,"vertical"===s.orientation))},dependencies:[b.YU],styles:["[_nghost-%COMP%]{display:flex}.pillbox-divider[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.pillbox-divider--horizontal[_ngcontent-%COMP%]{height:100%;border-right:1px solid #d7e0ea}.pillbox-divider--vertical[_ngcontent-%COMP%]{width:40px;border-bottom:1px solid #d7e0ea}"],changeDetection:0}),e})();const f3=["*"],S3=(n,e)=>({"pillbox--vertical":n,"pillbox--horizontal":e});function b3(n,e){if(1&n){const o=t.RV6();t.qex(0),t.nrm(1,"app-pillbox-divider"),t.j41(2,"button",2),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExitClick())}),t.nrm(3,"app-icon",3),t.k0s(),t.bVm()}if(2&n){const o=t.XpG();t.R7$(2),t.Y8G("matTooltip","Close "+o.name),t.BMQ("aria-label","Close "+o.name)}}let Uo=(()=>{var n;class e{constructor(){this.canExit=!1,this.padding="normal",this.orientation="horizontal",this.name="",this.exit=new t.bkB}ngOnInit(){}handleExitClick(){this.exit.emit()}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-pillbox"]],inputs:{canExit:"canExit",padding:"padding",orientation:"orientation",name:"name"},outputs:{exit:"exit"},ngContentSelectors:f3,decls:3,vars:5,consts:[[1,"pillbox",3,"ngClass"],[4,"ngIf"],["data-test","closePillboxButton","app-view-button","",3,"click","matTooltip"],["icon","times"]],template:function(i,s){1&i&&(t.NAR(),t.j41(0,"div",0),t.SdG(1),t.DNE(2,b3,4,2,"ng-container",1),t.k0s()),2&i&&(t.Y8G("ngClass",t.l_i(2,S3,"vertical"===s.orientation,"horizontal"===s.orientation)),t.R7$(2),t.Y8G("ngIf",s.canExit))},dependencies:[b.YU,b.bT,xt,Sn.oV,qe,Rp],styles:[":host{display:inline-block}.pillbox{box-shadow:0 1px 4px 1px #0500380a;border:1px solid #d7e0ea;pointer-events:all;background:#fffffff2;border-radius:4px;display:flex;overflow:hidden;transition:all .1s ease-out}.pillbox:empty{border:0;box-shadow:none}.pillbox:hover{background:#fff}.pillbox--vertical{flex-direction:column;align-items:center}.pillbox--horizontal{flex-direction:row}\n"],encapsulation:2,changeDetection:0}),e})();var kc,D1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},L1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function y3(n,e){1&n&&t.nrm(0,"app-icon",16)}function v3(n,e){1&n&&t.nrm(0,"app-icon",17),2&n&&t.Y8G("custom",!0)}function E3(n,e){1&n&&(t.j41(0,"span",8),t.pXf(1,2),t.k0s())}function T3(n,e){1&n&&(t.j41(0,"span",8),t.pXf(1,3),t.k0s())}function C3(n,e){if(1&n){const o=t.RV6();t.j41(0,"li")(1,"button",18),t.bIt("touchend",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("in"))})("mouseup",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("in"))})("keyup.enter",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("in"))}),t.nrm(2,"app-icon",19),t.k0s()()}}function O3(n,e){if(1&n){const o=t.RV6();t.j41(0,"li")(1,"button",20),t.bIt("touchend",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("out"))})("mouseup",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("out"))})("keyup.enter",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.setZoomFixed("out"))}),t.nrm(2,"app-icon",21),t.k0s()()}}function w3(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"li")(2,"button",12),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.togglePan())}),t.DNE(4,y3,1,0,"app-icon",13),t.nI1(5,"async"),t.DNE(6,v3,1,1,"app-icon",14),t.nI1(7,"async"),t.DNE(8,E3,2,0,"span",15),t.nI1(9,"async"),t.DNE(10,T3,2,0,"span",15),t.nI1(11,"async"),t.k0s()(),t.DNE(12,C3,3,0,"li",11),t.nI1(13,"async"),t.DNE(14,O3,3,0,"li",11),t.nI1(15,"async"),t.bVm()}if(2&n){const o=t.XpG();t.R7$(2),t.Y8G("matTooltip",o.cameraModeTooltip),t.BMQ("aria-pressed","pan"===t.bMT(3,8,o.panMode$)),t.R7$(2),t.Y8G("ngIf","pan"===t.bMT(5,10,o.panMode$)),t.R7$(2),t.Y8G("ngIf","rotate"===t.bMT(7,12,o.panMode$)),t.R7$(2),t.Y8G("ngIf","pan"===t.bMT(9,14,o.panMode$)),t.R7$(2),t.Y8G("ngIf","rotate"===t.bMT(11,16,o.panMode$)),t.R7$(2),t.Y8G("ngIf",t.bMT(13,18,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny),t.R7$(2),t.Y8G("ngIf",t.bMT(15,20,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny)}}class kp{get cameraToggleTooltip(){return this.collapsed?$localize`Open 3D Controls`:$localize`Close 3D Controls`}constructor(e,o,i,s,r){this.store=e,this.cameraService=o,this.viewService=i,this.liveAnnouncer=s,this.changeDetectorRef=r,this.collapsed=!0,this.canCollapse=!0,this.viewLayout=h,this.toolEnum=Ct,this.expandNav=!1,this.breakpointEnum=Un,this.canvasHeightBreakpoint=Fi,this.padding="none",this.ngUnsubscribe=new oe.B,this.initTooltips()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTooltips(){this.panMode$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.cameraModeTooltip="pan"===e?$localize`Change to Rotate Mode`:$localize`Change to Pan Mode`}),this.changeDetectorRef.markForCheck()}setZoomFixed(e){this.cameraService.setCameraZoomWithVelocity("in"===e?-8:8);const i=(100*this.cameraService.getCameraZoom()).toFixed(0);this.liveAnnouncer.announce(`zoomed ${e} to ${i}%`)}returnToChapterCamera(){const e=this.store.selectSnapshot(E.getSelectedChapter);this.store.dispatch(new di(e.camera.location)).subscribe(()=>{this.liveAnnouncer.announce("recenter complete")})}resetChapter(){this.returnToChapterCamera();const e=this.store.selectSnapshot(E.getSelectedChapterId);this.store.dispatch(new Ut.UndoAll(e)),this.store.dispatch(new un(!1)),this.store.dispatch(new ns)}togglePan(){this.viewService.togglePan()}toggleCameraBar(){this.collapsed=!this.collapsed}}(kc=kp).\u0275fac=function(e){return new(e||kc)(t.rXU(c.il),t.rXU(Pi),t.rXU(zt),t.rXU(vi.Ai),t.rXU(t.gRc))},kc.\u0275cmp=t.VBU({type:kc,selectors:[["app-engine-camera-bar"]],inputs:{collapsed:"collapsed",canCollapse:"canCollapse"},decls:13,vars:4,consts:()=>{let n,e,o,i,s,r,a,l,_;return n=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,e=$localize`:0c6b2042f7ade77091a6e0b314f5797a51644835918403358406080994:Toggle 3D navigation controls`,o=$localize`:0459da369b661293df2216dab6d5504bc0ae736d4770948314010072135:Clicking this button will reset the camera viewing the 3D model`,i=$localize`:240d93ec4b5179c4fd189688280eaa63b0d6d7836492222661583280:Pan mode active, change to rotate mode`,s=$localize`:e583fc810e521ceb2967fc19734fed46a2540c944140573029148607220:Rotate mode active, change to pan mode`,r=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,a=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,l=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,_=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,[e,o,i,s,["direction","vertical","data-test","cameraBar","direction","vertical","appPreventFadeout",""],["aria-label","Camera Control Buttons"],["app-view-button","","buttonSize","small","tabIndex","0","data-test","cameraToggleBar","matTooltipPosition","left",3,"click","short","matTooltip"],["size","sm",3,"icon"],[1,"sr-only"],["app-view-button","","buttonSize","small","tabIndex","0","matTooltip",n,"matTooltipPosition","left","data-test","cameraReset",3,"click"],["size","lg","icon","location-crosshairs"],[4,"ngIf"],["app-view-button","","buttonSize","small","tabIndex","0","matTooltipPosition","left","data-test","cameraPan",3,"click","matTooltip"],["size","lg","icon","arrows-up-down-left-right",4,"ngIf"],["size","lg","icon","rotate",3,"custom",4,"ngIf"],["class","sr-only",4,"ngIf"],["size","lg","icon","arrows-up-down-left-right"],["size","lg","icon","rotate",3,"custom"],["app-view-button","","buttonSize","small","tabIndex","0","data-test","cameraZoomIn","aria-label",r,"matTooltip",a,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","plus"],["app-view-button","","buttonSize","small","tabIndex","0","data-test","cameraZoomOut","aria-label",l,"matTooltip",_,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","minus"]]},template:function(e,o){1&e&&(t.j41(0,"app-pillbox",4)(1,"ul",5)(2,"li")(3,"button",6),t.bIt("click",function(){return o.toggleCameraBar()}),t.nrm(4,"app-icon",7),t.j41(5,"span",8),t.pXf(6,0),t.k0s()()(),t.j41(7,"li")(8,"button",9),t.bIt("click",function(){return o.returnToChapterCamera()}),t.nrm(9,"app-icon",10),t.j41(10,"span",8),t.pXf(11,1),t.k0s()()(),t.DNE(12,w3,16,22,"ng-container",11),t.k0s()()),2&e&&(t.R7$(3),t.Y8G("short",!0)("matTooltip",o.cameraToggleTooltip),t.R7$(),t.Y8G("icon",o.collapsed?"angle-up":"angle-down"),t.R7$(8),t.Y8G("ngIf",!o.collapsed))},dependencies:[b.bT,Qr,Sn.oV,xt,qe,Uo,b.Jj],encapsulation:2,data:{animation:[(0,ie.hZ)("expand",[(0,ie.kY)(":enter",[(0,ie.K2)([(0,ie.iF)({height:0}),(0,ie.i0)("150ms ease-in-out",(0,ie.iF)({height:"*"}))])]),(0,ie.kY)(":leave",[(0,ie.K2)([(0,ie.i0)("150ms ease-in-out",(0,ie.iF)({height:"0"}))])])]),(0,ie.hZ)("show",[(0,ie.kY)(":enter",[(0,ie.K2)([(0,ie.iF)({height:"0"}),(0,ie.i0)("125ms ease-in-out",(0,ie.iF)({height:"*"}))])]),(0,ie.kY)(":leave",[(0,ie.K2)([(0,ie.i0)("125ms 125ms ease-in-out",(0,ie.iF)({height:"0"}))])])])]},changeDetection:0}),D1([(0,c.l6)(vt.getPanMode),L1("design:type",f.c)],kp.prototype,"panMode$",void 0),D1([(0,c.l6)(U.getCanvasHeightBreakpoint),L1("design:type",f.c)],kp.prototype,"canvasHeightBreakpoint$",void 0);const M3=["scrubber"],I3=["track"],A3=["bar"],P3=["handle"],N3=(n,e,o,i)=>({"view-slider--immediate":n,"view-slider--show-track":e,"view-slider--x":o,"view-slider--y":i});let U1=(()=>{var n;class e{get percent(){return this._percent}set percent(i){this._percent=i,this.dragging||(this.setScrubberBar(i),this.setScrubberHandle(i))}get dragging(){return this._dragging}set dragging(i){i!=this.dragging&&(i?this.dragStarted.emit(this.percent):this.dragEnded.emit(this.percent)),this._dragging=i,this.draggingChanged.emit(i)}constructor(i,s){this.renderer=i,this.changeDetectorRef=s,this.accessibleLabel="",this.sliderAxis="x",this.showTrack=!1,this._percent=0,this.percentChanged=new t.bkB,this._dragging=!1,this.animate=!0,this.draggingChanged=new t.bkB,this.dragStarted=new t.bkB,this.dragEnded=new t.bkB,this.trackClicked=new t.bkB,this.ngUnsubscribe=new oe.B,this.trackWidth=0,this.dragPosition={x:0,y:0}}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.setScrubberBar(this.percent),this.setScrubberHandle(this.percent)}),this.initDragListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initDragListener(){this.dragInstance.moved.pipe((0,ls.Z)(20),(0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.percent=this.calculateHandlePercent(),this.setScrubberBar(this.percent),this.percentChanged.emit(this.percent)})}handleDragStart(){this.dragging=!0,this.animate=!1}handleDragEnd(){this.dragging=!1,this.animate=!0}handleTrackClick(i){this.animate=!1,this.changeDetectorRef.markForCheck(),setTimeout(()=>{this.percent=this.getClickPercent(i),this.trackClicked.emit(this.percent),this.percentChanged.emit(this.percent),setTimeout(()=>{this.animate=!0})})}handleKeyDown(i){switch(i.key){case"Home":this.increment(-100),i.stopPropagation();break;case"End":this.increment(100),i.stopPropagation();break;case"PageDown":this.increment(-10),i.stopPropagation();break;case"PageUp":this.increment(10),i.stopPropagation();break;case"ArrowLeft":case"ArrowDown":this.increment(-1),i.stopPropagation();break;case"ArrowRight":case"ArrowUp":this.increment(1),i.stopPropagation()}}increment(i){this.percent+=i,this.percent>100&&(this.percent=100),this.percent<0&&(this.percent=0),this.percentChanged.emit(this.percent)}getClickPercent(i){const{height:s,width:r}=this.track.nativeElement.getBoundingClientRect();let a=0;switch(this.sliderAxis){case"x":a=i.offsetX/r*100;break;case"y":a=(s-i.offsetY)/s*100}return a>100&&(a=100),a<0&&(a=0),a}calculateHandlePercent(){const i=this.getTrackWidth(),s=this.scrubber.nativeElement.getBoundingClientRect().left,r=this.handle.nativeElement.getBoundingClientRect().left,a=this.getTrackHeight(),l=this.scrubber.nativeElement.getBoundingClientRect().top,_=this.handle.nativeElement.getBoundingClientRect().top;let d=0;switch(this.sliderAxis){case"x":d=(r-s)/i*100;break;case"y":d=100-(_-l)/a*100}return Math.min(Math.max(d,0),100)}setScrubberBar(i){switch(this.sliderAxis){case"x":this.renderer.setStyle(this.bar.nativeElement,"width",`${i}%`);break;case"y":this.renderer.setStyle(this.bar.nativeElement,"height",`${i}%`)}this.changeDetectorRef.markForCheck()}setScrubberHandle(i){let s,r;switch(this.sliderAxis){case"x":s=this.getTrackWidth(),this.dragPosition={...this.dragPosition,x:s*(i/100)};break;case"y":r=this.getTrackHeight(),this.dragPosition={...this.dragPosition,y:r-r*(i/100)}}this.changeDetectorRef.markForCheck()}getTrackWidth(){const{left:i,right:s}=this.scrubber.nativeElement.getBoundingClientRect();return s-i-this.handle.nativeElement.offsetWidth}getTrackHeight(){const{height:i}=this.scrubber.nativeElement.getBoundingClientRect();return i-this.handle.nativeElement.offsetHeight}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-slider"]],viewQuery:function(i,s){if(1&i&&(t.GBs(M3,7),t.GBs(I3,7),t.GBs(A3,7),t.GBs(P3,7),t.GBs(Bl.T1,5)),2&i){let r;t.mGM(r=t.lsd())&&(s.scrubber=r.first),t.mGM(r=t.lsd())&&(s.track=r.first),t.mGM(r=t.lsd())&&(s.bar=r.first),t.mGM(r=t.lsd())&&(s.handle=r.first),t.mGM(r=t.lsd())&&(s.dragInstance=r.first)}},inputs:{accessibleLabel:"accessibleLabel",sliderAxis:"sliderAxis",showTrack:"showTrack",percent:"percent"},outputs:{percentChanged:"percentChanged",draggingChanged:"draggingChanged",dragStarted:"dragStarted",dragEnded:"dragEnded",trackClicked:"trackClicked"},decls:8,vars:10,consts:[["scrubber",""],["track",""],["bar",""],["handle",""],[1,"view-slider",3,"ngClass"],[1,"view-slider__track",3,"click"],[1,"view-slider__bar"],["cdkDrag","","cdkDragBoundary",".view-slider","role","slider","tabindex","0","aria-valuemin","0","aria-valuemax","100",1,"view-slider__handle",3,"cdkDragStarted","cdkDragEnded","keydown","cdkDragLockAxis","cdkDragFreeDragPosition"]],template:function(i,s){if(1&i){const r=t.RV6();t.j41(0,"div",4,0)(2,"div",5,1),t.bIt("click",function(l){return t.eBV(r),t.Njj(s.handleTrackClick(l))}),t.nrm(4,"div",6,2),t.k0s(),t.j41(6,"div",7,3),t.bIt("cdkDragStarted",function(){return t.eBV(r),t.Njj(s.handleDragStart())})("cdkDragEnded",function(){return t.eBV(r),t.Njj(s.handleDragEnd())})("keydown",function(l){return t.eBV(r),t.Njj(s.handleKeyDown(l))}),t.k0s()()}2&i&&(t.Y8G("ngClass",t.ziG(5,N3,!s.animate,s.showTrack,"x"===s.sliderAxis,"y"===s.sliderAxis)),t.R7$(6),t.Y8G("cdkDragLockAxis",s.sliderAxis)("cdkDragFreeDragPosition",s.dragPosition),t.BMQ("aria-label",s.accessibleLabel)("aria-valuenow",s.percent))},dependencies:[b.YU,Bl.T1],styles:['.view-slider[_ngcontent-%COMP%]{--height: 28px;--width: 100%;--track-height: 4px;--track-width: 100%;--bar-height: 4px;--bar-width: 0;--handle-height: 28px;--handle-width: 32px;--handle-bulb-size: 12px;--track-color: #d7e0ea;--bar-color: #374a68;--handle-color: transparent;--bar-hover-color: #2d72dc;--handle-hover-color: #2d72dc;--track-hover-color: #d7e0ea;--half-width: calc(var(--handle-width) / 2);--half-height: calc(var(--handle-height) / 2);position:relative;display:flex;justify-content:center;align-items:center;height:var(--height);width:var(--width)}.view-slider[_ngcontent-%COMP%]:hover, .view-slider.view-slider--show-track[_ngcontent-%COMP%]{cursor:pointer}.view-slider[_ngcontent-%COMP%]:hover.view-slider--x, .view-slider.view-slider--show-track.view-slider--x[_ngcontent-%COMP%]{--bar-height: 6px;--track-height: 6px}.view-slider[_ngcontent-%COMP%]:hover.view-slider--y, .view-slider.view-slider--show-track.view-slider--y[_ngcontent-%COMP%]{--bar-width: 6px;--track-width: 6px}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__bar[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{background:var(--bar-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{opacity:1}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]:after{background:var(--handle-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__track[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]:after{background:var(--track-hover-color)}.view-slider--x[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{left:var(--half-width);right:var(--half-width)}.view-slider--y[_ngcontent-%COMP%]{--height: 100%;--width: 28px;--track-height: 100%;--track-width: 4px;--bar-height: 0;--bar-width: 4px;--handle-height: 32px;--handle-width: 28px;flex-direction:column-reverse;justify-content:flex-end}.view-slider--y[_ngcontent-%COMP%]:hover{--bar-width: 6px;--track-width: 6px}.view-slider--y[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{left:auto}.view-slider--y[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{flex-direction:column-reverse;top:var(--half-height);bottom:var(--half-height)}.view-slider--immediate[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%], .view-slider--immediate[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{transition:none!important}.view-slider__track[_ngcontent-%COMP%]{display:flex;align-items:center;position:absolute;inset:0}.view-slider__track[_ngcontent-%COMP%]:after{content:" ";background:var(--track-color);height:var(--track-height);width:var(--track-width);transition:all .2s ease-in-out,width 50ms}.view-slider__bar[_ngcontent-%COMP%]{border-radius:2px;position:absolute;background:var(--bar-color);height:var(--bar-height);width:var(--bar-width);z-index:2;left:0;transition:all .2s ease-in-out,width 50ms;pointer-events:none}.view-slider__handle[_ngcontent-%COMP%]{width:var(--handle-width);height:var(--handle-height);margin-left:-calc(var(--handle-width)/2);left:0;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2;opacity:0;transition:transform 50ms linear}.view-slider__handle[_ngcontent-%COMP%]:hover:after{transform:scale(1.3)}.view-slider__handle[_ngcontent-%COMP%]:after{opacity:1;content:"";width:var(--handle-bulb-size);height:var(--handle-bulb-size);border-radius:50%;background:var(--handle-color);transition:opacity .25s,transform ease-out .15s}.view-slider__handle-touch[_ngcontent-%COMP%]:after{opacity:1}'],changeDetection:0}),e})();var Dc,Lc,Uc,Dp=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Lp=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class cl{constructor(e,o,i,s){this.store=e,this.animationService=o,this.engineService=i,this.changeDetetorRef=s,this.ngUnsubscribe=new oe.B,this.duration=0,this.wasPlaying=!0,this.percent=0,this.accessibleLabel=$localize`media slider`}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePercentChanged(e){this.percent=e,this.scrubToPercent(e)}initChapterListener(){this.chapterReadyState$.pipe((0,X.p)(e=>!(0,m.isNil)(e)&&e.animation),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(this.animationService.getTime())})}initTimelineListener(){this.engineService.getEvent(pe.TimelinePlaying).pipe((0,ls.Z)(20),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.tick(e.time)}),this.engineService.getEvent(pe.TimelineScrubbed).pipe((0,ls.Z)(20),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.percent=this.getPercent(e.time)})}handleDragStart(){this.wasPlaying=this.store.selectSnapshot(U.getAnimationPlaying),this.animationService.pause()}handleTrackClick(e){const o=this.store.selectSnapshot(U.getAnimationPlaying);o&&this.animationService.pause(),this.percent=e,this.scrubToPercent(e),setTimeout(()=>{o&&this.animationService.unpause()})}handleDragEnd(){this.wasPlaying&&this.animationService.play()}tick(e){this.percent=this.getPercent(e),this.changeDetetorRef.markForCheck()}getPercent(e){return this.timerange?.lastTime>0?e/this.timerange.lastTime*100:0}scrubToPercent(e){this.timerange?.lastTime>0&&this.animationService.scrub(e/100*this.timerange.lastTime)}}(Dc=cl).\u0275fac=function(e){return new(e||Dc)(t.rXU(c.il),t.rXU(bi),t.rXU(Lt),t.rXU(t.gRc))},Dc.\u0275cmp=t.VBU({type:Dc,selectors:[["app-view-scrubber"]],decls:1,vars:2,consts:[["data-test","viewMediaScrubber",3,"dragStarted","dragEnded","trackClicked","percentChanged","percent","accessibleLabel"]],template:function(e,o){1&e&&(t.j41(0,"app-view-slider",0),t.bIt("dragStarted",function(){return o.handleDragStart()})("dragEnded",function(){return o.handleDragEnd()})("trackClicked",function(s){return o.handleTrackClick(s)})("percentChanged",function(s){return o.handlePercentChanged(s)}),t.k0s()),2&e&&t.Y8G("percent",o.percent)("accessibleLabel",o.accessibleLabel)},dependencies:[U1],encapsulation:2}),Dp([(0,c.l6)(E.getSelectedChapterId),Lp("design:type",f.c)],cl.prototype,"selectedChapterId$",void 0),Dp([(0,c.l6)(U.getAnimationPlaying),Lp("design:type",f.c)],cl.prototype,"animationPlaying$",void 0),Dp([(0,c.l6)(E.getSelectedChapterReadyState),Lp("design:type",f.c)],cl.prototype,"chapterReadyState$",void 0),Dp([(0,c.l6)(P.getCanTouch),Lp("design:type",f.c)],cl.prototype,"canTouch$",void 0);class uf{constructor(e){this.store=e}setPlaybackSpeed(e){this.store.dispatch(new Ml(e))}}(Lc=uf).\u0275fac=function(e){return new(e||Lc)(t.rXU(c.il))},Lc.\u0275cmp=t.VBU({type:Lc,selectors:[["app-view-playback-speed"]],decls:18,vars:4,consts:()=>{let n,e,o;return n=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,e=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,o=$localize`:077e90416bdae39a40441d0b94c5a9e8fcad45143080483882937310852:Normal`,[["playbackMenu","matMenu"],e,o,["app-view-button","","buttonSize","small","data-test","viewPlaybackSpeed","matTooltip",n,"matTooltipPosition","above",3,"matMenuTriggerFor"],[1,"px-2"],[1,"sr-only"],[1,"text-xs"],["icon","angle-up","size","xs",1,"ml-2"],["mat-menu-item","",3,"click"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"button",3)(1,"div",4)(2,"span",5),t.pXf(3,1),t.k0s(),t.j41(4,"span",6),t.EFF(5),t.nI1(6,"async"),t.k0s(),t.nrm(7,"app-icon",7),t.k0s()(),t.j41(8,"mat-menu",null,0)(10,"button",8),t.bIt("click",function(){return t.eBV(i),t.Njj(o.setPlaybackSpeed(1))}),t.pXf(11,2),t.k0s(),t.j41(12,"button",8),t.bIt("click",function(){return t.eBV(i),t.Njj(o.setPlaybackSpeed(.5))}),t.EFF(13,"0.5"),t.k0s(),t.j41(14,"button",8),t.bIt("click",function(){return t.eBV(i),t.Njj(o.setPlaybackSpeed(.25))}),t.EFF(15,"0.25"),t.k0s(),t.j41(16,"button",8),t.bIt("click",function(){return t.eBV(i),t.Njj(o.setPlaybackSpeed(.1))}),t.EFF(17,"0.1"),t.k0s()()}if(2&e){const i=t.sdS(9);t.Y8G("matMenuTriggerFor",i),t.R7$(5),t.SpI("",t.bMT(6,2,o.playbackSpeed$),"x ")}},dependencies:[xt,jn.kk,jn.fb,jn.Cp,Sn.oV,qe,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(U.getPlaybackSpeed),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],uf.prototype,"playbackSpeed$",void 0);class Up{constructor(e){this.store=e}handlePlayClick(){const e=this.store.selectSnapshot(U.getAnimationPlaying);this.store.dispatch(new Yo(!e))}getAnimationPlayingTooltip(e){return e?$localize`Pause Animation`:$localize`Play Animation`}}(Uc=Up).\u0275fac=function(e){return new(e||Uc)(t.rXU(c.il))},Uc.\u0275cmp=t.VBU({type:Uc,selectors:[["app-view-play"]],decls:7,vars:9,consts:[["app-view-button","","buttonSize","small","data-test","viewMediaPlay","matTooltipPosition","above",3,"click","matTooltip"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"]],template:function(e,o){1&e&&(t.j41(0,"button",0),t.nI1(1,"async"),t.bIt("click",function(){return o.handlePlayClick()}),t.j41(2,"span",1),t.EFF(3),t.nI1(4,"async"),t.k0s(),t.nrm(5,"app-icon",2),t.nI1(6,"async"),t.k0s()),2&e&&(t.Y8G("matTooltip",o.getAnimationPlayingTooltip(t.bMT(1,3,o.animationPlaying$))),t.R7$(3),t.JRh(o.getAnimationPlayingTooltip(t.bMT(4,5,o.animationPlaying$))),t.R7$(2),t.Y8G("icon",t.bMT(6,7,o.animationPlaying$)?"pause":"play"))},dependencies:[xt,Sn.oV,qe,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(U.getAnimationPlaying),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Up.prototype,"animationPlaying$",void 0);var Vc,_l=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},dl=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const U3=["mediaPlayButton"];function V3(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handlePlayChapterFromStartClick())}),t.j41(1,"span",7),t.pXf(2,0),t.k0s(),t.nrm(3,"app-icon",8),t.k0s()}}function j3(n,e){1&n&&t.nrm(0,"app-view-scrubber",9)}function x3(n,e){if(1&n&&(t.j41(0,"div",10),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.timeLabel," ")}}function G3(n,e){1&n&&t.nrm(0,"app-view-playback-speed")}class Ys{set autoFocus(e){e&&!this.triedToFocus&&setTimeout(()=>{this.playButton.focus()},0),this.triedToFocus=!0}constructor(e,o,i,s,r){this.animationService=e,this.engineService=o,this.viewService=i,this.store=s,this.changeDetectorRef=r,this.viewLayout=h,this.mediaEnum=Wi,this.buttonSize=Xr.Default,this.mediaTemplate=Wi.None,this.showScrubber=!0,this.showSpeed=!0,this.triedToFocus=!1,this.ngUnsubscribe=new oe.B,this.timeLabel="0:00 / 0:00",this.viewUI=h}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,X.p)(e=>!(0,m.isNil)(e)&&e.animation),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(0)})}initTimelineListener(){this.engineService.getEvent(pe.TimelinePlaying).pipe((0,ls.Z)(500),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.tick(e.time)})}handlePlayClick(){this.viewService.toggleAnimation()}handlePlayChapterFromStartClick(){this.viewService.playChapterFromStart()}setPlaybackSpeed(e){this.store.dispatch(new Ml(e))}tick(e){this.timerange&&(this.timeLabel=`${this.getFormattedTime(e)} / ${this.getFormattedTime(this.timerange.lastTime)}`,this.changeDetectorRef.markForCheck())}getFormattedTime(e){return`${Math.floor(Math.floor(e)/60)}:${(0,m.padStart)((Math.floor(e)%60).toString(),2,"0")}`}}var jc;function B3(n,e){1&n&&t.nrm(0,"app-spinner",3)}function z3(n,e){if(1&n&&(t.nrm(0,"app-icon",4),t.nI1(1,"async")),2&n){const o=t.XpG();t.Y8G("icon",t.bMT(1,1,o.muted$)?"volume-slash":"volume")}}(Vc=Ys).\u0275fac=function(e){return new(e||Vc)(t.rXU(bi),t.rXU(Lt),t.rXU(zt),t.rXU(c.il),t.rXU(t.gRc))},Vc.\u0275cmp=t.VBU({type:Vc,selectors:[["app-view-media-bar"]],viewQuery:function(e,o){if(1&e&&t.GBs(U3,5),2&e){let i;t.mGM(i=t.lsd())&&(o.playButton=i.first)}},inputs:{buttonSize:"buttonSize",mediaTemplate:"mediaTemplate",showScrubber:"showScrubber",showSpeed:"showSpeed",autoFocus:"autoFocus"},decls:10,vars:12,consts:()=>{let n,e;return n=$localize`:623c2eb512dd08c852fcda4f15379224c8c971337851550536336238650:Play Chapter From Start`,e=$localize`:b3e95ffdcd71216e76228de060aaa7fd8662266c162780291567006895:Play Chapter from Start`,[e,["data-test","viewMediaBar",1,"view-media-bar"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",n,"matTooltipPosition","above",3,"click",4,"ngIf"],["class","view-media-bar__scrubber",4,"ngIf"],["class","view-media-bar__time","data-test","viewMediaTime",4,"ngIf"],[4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",n,"matTooltipPosition","above",3,"click"],[1,"sr-only"],["size","lg","icon","step-backward","aria-hidden","true"],[1,"view-media-bar__scrubber"],["data-test","viewMediaTime",1,"view-media-bar__time"]]},template:function(e,o){if(1&e&&(t.j41(0,"div",1),t.nrm(1,"app-view-play"),t.DNE(2,V3,4,0,"button",2),t.nI1(3,"async"),t.DNE(4,j3,1,0,"app-view-scrubber",3),t.nI1(5,"async"),t.DNE(6,x3,2,1,"div",4),t.nI1(7,"async"),t.DNE(8,G3,1,0,"app-view-playback-speed",5),t.nI1(9,"async"),t.k0s()),2&e){let i,s,r,a;t.R7$(2),t.Y8G("ngIf","full"===(null==(i=t.bMT(3,4,o.mediaUI$))?null:i.template)),t.R7$(2),t.Y8G("ngIf","full"===(null==(s=t.bMT(5,6,o.mediaUI$))?null:s.template)&&o.showScrubber),t.R7$(2),t.Y8G("ngIf","full"===(null==(r=t.bMT(7,8,o.mediaUI$))?null:r.template)&&o.showScrubber),t.R7$(2),t.Y8G("ngIf","full"===(null==(a=t.bMT(9,10,o.mediaUI$))?null:a.template)&&o.showSpeed)}},dependencies:[b.bT,xt,Sn.oV,qe,cl,uf,Up,b.Jj],styles:[".view-media-bar[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;position:relative}.view-media-bar__scrubber[_ngcontent-%COMP%]{flex:1}.view-media-bar__scrubber--disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.view-media-bar__time[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:0 12px;font-size:12px;color:#374a68;height:100%;white-space:nowrap}.view-media-bar__playback[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:600}"],changeDetection:0}),_l([(0,c.l6)(E.getSelectedChapterId),dl("design:type",f.c)],Ys.prototype,"selectedChapterId$",void 0),_l([(0,c.l6)(E.getSelectedChapterReadyState),dl("design:type",f.c)],Ys.prototype,"chapterReadyState$",void 0),_l([(0,c.l6)(U.getPlaybackSpeed),dl("design:type",f.c)],Ys.prototype,"playbackSpeed$",void 0),_l([(0,c.l6)(P.getAutoplay),dl("design:type",f.c)],Ys.prototype,"autoplay$",void 0),_l([(0,c.l6)(ue.getVisible(h.Audio)),dl("design:type",f.c)],Ys.prototype,"audioVisible$",void 0),_l([(0,c.l6)(ue.getUIEntry(h.Media)),dl("design:type",f.c)],Ys.prototype,"mediaUI$",void 0);class Vp{get text(){return this.store.selectSnapshot(Xi.getAudioMuted)?$localize`Unmute`:$localize`Mute`}constructor(e,o){this.store=e,this.mediaService=o,this.buttonSize="small",this.buttonShape="square",this.buttonTheme="transparent-fill"}handleClick(){const e=this.store.selectSnapshot(E.getSelectedChapter),o=!this.store.selectSnapshot(Xi.getAudioMuted);if(this.store.dispatch(new Ei.SetAudioMuted(o)),o)this.mediaService.muteAudio();else if(this.mediaService.getPlayingAudio()?.length)this.mediaService.unmuteAudio(e.id);else{const s=this.store.selectSnapshot(P.getViewLanguage),r=this.store.selectSnapshot(P.getForceAudio);this.mediaService.getChapterAudioPlayer(e,s,r).then(()=>{this.mediaService.playChapterAudio(e.id)})}}}(jc=Vp).\u0275fac=function(e){return new(e||jc)(t.rXU(c.il),t.rXU(Di))},jc.\u0275cmp=t.VBU({type:jc,selectors:[["app-view-audio-mute"]],inputs:{disabled:"disabled",buttonSize:"buttonSize",buttonShape:"buttonShape",buttonTheme:"buttonTheme"},decls:5,vars:13,consts:()=>{let n;return n=$localize`:17517742950bb7560a3ca4c8fa23122e16b561163135353579204779711:mute audio`,[["type","button","app-view-button","","aria-label",n,"matTooltipPosition","above","data-test","viewAudioMute",1,"view-audio-mute",3,"click","buttonSize","buttonShape","buttonTheme","matTooltip","disabled"],["spinnerSize","small",4,"ngIf"],["appLogicalDir","","class","view-audio-mute__icon","aria-hidden","true",3,"icon",4,"ngIf"],["spinnerSize","small"],["appLogicalDir","","aria-hidden","true",1,"view-audio-mute__icon",3,"icon"]]},template:function(e,o){1&e&&(t.j41(0,"button",0),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("click",function(){return o.handleClick()}),t.DNE(3,B3,1,0,"app-spinner",1)(4,z3,2,3,"app-icon",2),t.k0s()),2&e&&(t.Y8G("buttonSize",o.buttonSize)("buttonShape",o.buttonShape)("buttonTheme",o.buttonTheme)("matTooltip",o.text)("disabled",o.disabled),t.BMQ("aria-pressed",!1===t.bMT(1,9,o.muted$))("data-test-muted",t.bMT(2,11,o.muted$)),t.R7$(3),t.Y8G("ngIf",o.disabled),t.R7$(),t.Y8G("ngIf",!o.disabled))},dependencies:[b.bT,xt,Sn.oV,qe,Jr,Hi,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(Xi.getAudioMuted),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Vp.prototype,"muted$",void 0);var oo=S(9079),na=S(3881);const W3=(n,e,o)=>({"justify-between":n,"justify-start":e,"gap-2":o}),X3=()=>["outline","outline-blue-600"],H3=()=>[""];function Q3(n,e){if(1&n&&t.nrm(0,"div",10),2&n){const o=t.XpG().$implicit;t.HbH(o.imageClass)}}function Y3(n,e){if(1&n&&(t.j41(0,"span",11),t.EFF(1),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.JRh(o.title)}}function q3(n,e){if(1&n){const o=t.RV6();t.j41(0,"li")(1,"button",7),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.handleThemeSelected(s))}),t.j41(2,"div",8),t.DNE(3,Q3,1,2,"div",9)(4,Y3,2,1),t.k0s()()()}if(2&n){const o=e.$implicit,i=t.XpG();t.R7$(),t.Y8G("matTooltip",o.title)("lang",i.lang()),t.BMQ("aria-label",o.arialLabel)("data-test-skin",o.id),t.R7$(),t.HbH(i.selectedTheme()===o?t.lJ4(7,X3):t.lJ4(8,H3)),t.R7$(),t.vxM(3,o.imageClass?3:4)}}function K3(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",6)(1,"mat-slider",12)(2,"input",13,0),t.bIt("valueChange",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleSliderChange(s,!1,!0))})("input",function(){t.eBV(o);const s=t.sdS(3),r=t.XpG();return t.Njj(r.handleSliderChange(s.value,!0,!1))}),t.k0s()(),t.j41(4,"div",14)(5,"span"),t.pXf(6,1),t.k0s(),t.j41(7,"span"),t.EFF(8),t.k0s()()()}if(2&n){const o=t.sdS(3),i=t.XpG();t.R7$(),t.Y8G("min",0)("max",100)("showTickMarks",!1),t.R7$(),t.Y8G("value",i.opacity()),t.R7$(6),t.SpI("",o.value,"%")}}let jp=(()=>{var n;class e{constructor(i,s,r,a){this.store=i,this.sceneService=s,this.paintService=r,this.vendorAnalyticsService=a,this.skinUIConfig={"integumentary system":{title:$localize`Integumentary System`},off:{id:"off",title:$localize`Off`,arialLabel:$localize`Off`},"dark skin":{id:"dark",title:$localize`Dark Skin`,imageClass:"dark"},"medium skin":{id:"medium",title:$localize`Medium Skin`,imageClass:"medium"},"light skin":{id:"light",title:$localize`Light Skin`,imageClass:"light"},"fair skin":{id:"fair",title:$localize`Fair Skin`,imageClass:"fair"},"transparent skin":{id:"transparent",title:$localize`Transparent Skin`,imageClass:"transparent"}},this.offSkinTheme={id:"off",title:$localize`Off`,arialLabel:$localize`Turn off Skin`,objectVariants:{}},this.lang=t.hFB.required(),this.schema=t.hFB.required(),this.contentId=t.hFB.required(),this.contentType=t.hFB.required(),this.schemaTitle=(0,t.EWP)(()=>{const l=this.schema(),_=l.title.toLowerCase();return this.skinUIConfig[_]?.title??l.title}),this.compact=(0,t.hFB)(!1),this.themes=(0,t.EWP)(()=>{const l=function J3(n,e){return n.map(o=>{const i=o.title.toLowerCase(),s=e[i],r=s?.id??i.replace(/\s/g,""),a=s?.title??o.title,l=s?.arialLabel??$localize`Switch to ${a}`,_=Object.keys(o.objectVariants).some(p=>p.includes("female"))?"female":"male";let d=s?.imageClass?`view-skin__image--${_}--${s.imageClass}`:"";return{...o,id:r,title:a,arialLabel:l,imageClass:d}})}(this.schema().themes,this.skinUIConfig);return[this.offSkinTheme,...l]}),this.selectedThemeIndex=(0,t.EWP)(()=>{const l=this.themes(),_=this.nodes();return l.findIndex((d,p)=>d===this.offSkinTheme?this.allObjectIds().every(g=>!1===_[g]?.shown):Object.entries(d.objectVariants).every(([u,g])=>_[u]?.variant===g))}),this.selectedTheme=(0,t.EWP)(()=>this.themes()[this.selectedThemeIndex()]),this.isOffThemeSelected=(0,t.EWP)(()=>this.selectedTheme()===this.offSkinTheme),this.allObjectIds=(0,t.EWP)(()=>{const _=this.themes().reduce((d,p)=>{const u=Object.keys(p.objectVariants);return d.push(...u),d},[]);return Array.from(new Set(_))}),this.selectedObjectIds=(0,t.EWP)(()=>Object.keys(this.selectedTheme()?.objectVariants??{})),this.selectedSkinId=(0,t.EWP)(()=>this.selectedObjectIds().find(l=>l.includes("skin"))),this.opacity=(0,t.EWP)(()=>{const l=this.nodes(),_=this.selectedSkinId(),p=l[_]?.paint;return this.getObjectOpacity(p?.opacity)??100}),this.nodes=(0,oo.ot)(this.store.select(Re.getNodes))}toggleVisibility(i){i||this.handleThemeSelected(this.offSkinTheme)}handleThemeSelected(i){if(i===this.offSkinTheme){const _=this.allObjectIds();this.store.dispatch(new kn(!1,_)),this.store.dispatch(new jl({}))}else{const{objectVariants:_}=i,d=Object.keys(_);this.store.dispatch(new kn(!0,d)),this.store.dispatch(new jl(_))}const s=Ri.toTitleCase(i.id),r=this.lang(),a=this.contentId(),l=this.contentType();this.vendorAnalyticsService.track("Skin Type",{skinType:s,contentId:a,contentType:l,lang:r})}handleSliderChange(i,s,r){const a=i/100,l=this.selectedObjectIds();if(s&&l.forEach(_=>{this.setObjectOpacity(_,a)}),r){const _=l.reduce((d,p)=>{const u=this.paintService.getColor(p);if(u){const g=xg(u);d[p]=g}return d},{});this.store.dispatch(new Mo(void 0,void 0,_))}}setObjectOpacity(i,s){this.sceneService.getLeafIds(i).forEach(a=>{const l=this.paintService.getColor(a)?.opacity||1;let _;Array.isArray(l)?(_=[...l],_[0]=s):"number"==typeof l&&(_=s),this.paintService.colorObject(a,{opacity:_})})}getObjectOpacity(i){if(Array.isArray(i)){const[s]=i;return s}if("number"==typeof i)return i}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(cn),t.rXU(Mr),t.rXU(Qn))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-skin-variants"]],inputs:{lang:[t.Mj6.SignalBased,"lang"],schema:[t.Mj6.SignalBased,"schema"],contentId:[t.Mj6.SignalBased,"contentId"],contentType:[t.Mj6.SignalBased,"contentType"],compact:[t.Mj6.SignalBased,"compact"]},standalone:!0,features:[t.aNF],decls:8,vars:7,consts:()=>{let o;return o=$localize`:fd09d25b9e69b686d3fc0154c0b316c7c9f45cec8036200981586016464:Opacity`,[["slider","matSliderThumb"],o,[1,"flex","flex-col","gap-1","gray-400"],[1,"uppercase","text-2xs"],[1,"flex","flex-col","gap-1","p-3","border","border-gray-200","border-solid","rounded"],[1,"flex","flex-row","item-center","text-2xs",3,"ngClass"],[1,"grow"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","transparent","matTooltipPosition","below","data-test","skinToggleButton",1,"rounded-sm","focus:rounded-sm","focus:outline","focus:outline-blue-600",3,"click","matTooltip","lang"],[1,"flex","items-center","justify-center","w-10","h-10","text-black","bg-gray-100","rounded-sm"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm",3,"class"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm"],[1,"break-words","hyphens-auto","text-2xs"],[1,"!w-full","!m-0",3,"min","max","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],[1,"flex","items-center","justify-between","uppercase","text-2xs"]]},template:function(i,s){1&i&&(t.j41(0,"div",2)(1,"div",3),t.EFF(2),t.k0s(),t.j41(3,"div",4)(4,"ul",5),t.Z7z(5,q3,5,9,"li",null,t.fX1),t.k0s(),t.DNE(7,K3,9,5,"div",6),t.k0s()()),2&i&&(t.R7$(2),t.JRh(s.schemaTitle()),t.R7$(2),t.Y8G("ngClass",t.sMw(3,W3,!s.compact(),s.compact(),s.compact())),t.R7$(),t.Dyx(s.themes()),t.R7$(2),t.vxM(7,!1===s.isOffThemeSelected()?7:-1))},dependencies:[b.MD,b.YU,na.Ez,na.IV,na.OU,Sn.uc,Sn.oV,Yi.C,xt],styles:[".view-skin__image--male--fair{background-image:url(maleskin_variants_fair.c5274f1628110390.png)}.view-skin__image--male--light{background-image:url(maleskin_variants_light.c7bbde863e708a01.png)}.view-skin__image--male--medium{background-image:url(maleskin_variants_medium.363dabd44e2e3873.png)}.view-skin__image--male--dark{background-image:url(maleskin_variants_dark.37566281e4f1d1a8.png)}.view-skin__image--male--transparent{background-image:url(maleskin_variants_transparent.e0a06da6debcc244.png)}.view-skin__image--female--fair{background-image:url(femaleskin_variants_fair.0b316d23551e64f4.png)}.view-skin__image--female--light{background-image:url(femaleskin_variants_light.67980bd1da135900.png)}.view-skin__image--female--medium{background-image:url(femaleskin_variants_medium.f5206e6e6a8683ce.png)}.view-skin__image--female--dark{background-image:url(femaleskin_variants_dark.b555791cc6a786b6.png)}.view-skin__image--female--transparent{background-image:url(femaleskin_variants_transparent.33fe36148bb7e727.png)}\n"],encapsulation:2}),e})();const Z3=(n,e)=>e.name;function eD(n,e){if(1&n&&t.nrm(0,"app-view-skin-variants",6,0),2&n){const o=t.XpG();t.Y8G("compact",o.compact())("schema",o.skinVariantsSchema())("lang",o.lang())("contentId",o.storyId())("contentType",o.storyType())}}function tD(n,e){if(1&n){const o=t.RV6();t.j41(0,"li",10)(1,"div",11),t.EFF(2),t.k0s(),t.j41(3,"div",12)(4,"button",13),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG(2);return t.Njj(r.toggleGroupVisibilityClick(s))}),t.j41(5,"div",14),t.nrm(6,"div",15),t.k0s()(),t.j41(7,"div",16)(8,"mat-slider",17)(9,"input",18,1),t.bIt("valueChange",function(s){const r=t.eBV(o).$implicit,a=t.XpG(2);return t.Njj(a.handleSliderChange(r,s,!1,!0))})("input",function(){const s=t.eBV(o).$implicit,r=t.sdS(10),a=t.XpG(2);return t.Njj(a.handleSliderChange(s,r.value,!0,!1))}),t.k0s()()()()()}if(2&n){const o=e.$implicit,i=t.XpG(2);t.AVh("view-visibility-layers__list-item--hidden",!o.visible),t.R7$(2),t.JRh(o.label),t.R7$(2),t.Y8G("buttonTheme","transparent-fill")("matTooltip",o.visible?i.hideLayersTooltip:i.showLayersTooltip),t.BMQ("aria-label",o.visible?"Hide "+o.name:"Show "+o.name),t.R7$(2),t.Y8G("className",o.imageClassName),t.R7$(2),t.Y8G("min",0)("max",o.layers.length)("step",1)("showTickMarks",!0),t.R7$(),t.Y8G("value",o.position)}}function nD(n,e){if(1&n&&(t.j41(0,"ul",7),t.Z7z(1,tD,11,12,"li",9,Z3),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Dyx(o.viewGroups())}}function iD(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",8)(1,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleAllClick(s.viewGroups(),s.allGroupsHidden()))}),t.EFF(2),t.k0s()()}if(2&n){const o=t.XpG();t.R7$(2),t.SpI(" ",o.allGroupsHidden()?o.showAllLayersTooltip:o.hideAllLayersTooltip," ")}}let gf=(()=>{var n;class e{constructor(i,s,r){this.store=i,this.viewService=s,this.visibilityLayersService=r,this.defaultSystemToImage={label:$localize`Layer`,icon:"layer"},this.systemToImage={"muscular system":{label:$localize`muscular system`,icon:"muscular-system"},"connective tissue":{label:$localize`connective tissue`,icon:"connective-tissue"},"skeletal system":{label:$localize`skeletal system`,icon:"skeletal-system"},"respiratory system":{label:$localize`respiratory system`,icon:"respiratory-system"},"endocrine system":{label:$localize`endocrine system`,icon:"endocrine-system"},"digestive system":{label:$localize`digestive system`,icon:"digestive-system"},"reproductive system":{label:$localize`reproductive system`,icon:"reproductive-system"},"urinary system":{label:$localize`urinary system`,icon:"urinary-system"},"cardiovascular system":{label:$localize`cardiovascular system`,icon:"cardiovascular-system"},"lymphatic system":{label:$localize`lymphatic system`,icon:"lymphatic-system"},"nervous system":{label:$localize`nervous system`,icon:"nervous-system"},"integumentary system":{label:$localize`integumentary system`,icon:"integumentary-system"}},this.showAllLayersTooltip=$localize`Show All Layers`,this.hideAllLayersTooltip=$localize`Hide All Layers`,this.showLayersTooltip=$localize`Show Layer`,this.hideLayersTooltip=$localize`Hide Layer`,this.skinLayersComponent=(0,t.ebz)(jp),this.selectedChapterLayerGroups=(0,oo.ot)(this.store.select(E.getSelectedChapterLayerGroups)),this.skinVariantsSchema=(0,oo.ot)(this.store.select(Pe.getVariantSchema("skin"))),this.skinLayersUI=(0,oo.ot)(this.store.select(ue.getUIEntry(h.SkinLayers))),this.visibilityLayersUI=(0,oo.ot)(this.store.select(ue.getUIEntry(h.VisibilityLayers))),this.lang=(0,oo.ot)(this.store.select(P.getViewLanguage)),this.storyId=(0,oo.ot)(this.store.select(Pe.getStoryId)),this.storyType=(0,oo.ot)(this.store.select(Pe.getStoryType)),this.compact=(0,t.hFB)(!1),this.showSkinLayers=(0,t.EWP)(()=>{const a=this.skinVariantsSchema(),l=this.skinLayersUI();return!(0,m.isNil)(a)&&l.enable}),this.showVisibilityLayers=(0,t.EWP)(()=>{const a=this.viewGroups(),l=this.visibilityLayersUI();return a.length>0&&l.enable}),this.viewGroups=(0,t.EWP)(()=>{const a=this.selectedChapterLayerGroups();return this.createViewLayerGroups(a)}),this.allGroupsHidden=(0,t.EWP)(()=>this.viewGroups().every(l=>!l.visible))}handleKeyPress(i){"Escape"===i.key&&this.viewService.toggleLayers(!1),i.stopImmediatePropagation()}handleSliderChange(i,s,r,a){this.setLayerGroupVisibility([{...i,position:s}],r,a)}toggleGroupVisibilityClick(i){const s=this.visibilityLayersService.computeGroupPositionsByFraction([i],i.visible?0:1);this.setLayerGroupVisibility(s,!0,!0)}handleToggleAllClick(i,s){this.toggleLayers(i,s)}toggleLayers(i,s){const r=this.visibilityLayersService.computeGroupPositionsByFraction(i,s?1:0);this.setLayerGroupVisibility(r,!0,!0),this.skinLayersComponent()?.toggleVisibility(s)}setLayerGroupVisibility(i,s,r){const a=this.store.selectSnapshot(E.getSelectedChapterId);s&&this.visibilityLayersService.syncLayerGroupsToScene(i),r&&this.visibilityLayersService.syncLayerGroupsToState(a,i,!0)}createViewLayerGroups(i){return i.map((s,r)=>{const{name:a}=s,l=r+1,_=0!==s.position,d=a.toLowerCase(),p=this.systemToImage[d]??this.defaultSystemToImage,u=p===this.defaultSystemToImage?`${p.label} ${l}`:p.label,y="view-visibility-layers__image",O=[y,`${y}--${p.icon}`].join(" ");return{...s,visible:_,label:u,imageClassName:O}})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(zt),t.rXU(_s))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-visibility-layers"]],viewQuery:function(i,s){1&i&&t.wEZ(s.skinLayersComponent,jp,5),2&i&&t.NyB()},hostBindings:function(i,s){1&i&&t.bIt("keydown",function(a){return s.handleKeyPress(a)},!1,t.EBC)},inputs:{compact:[t.Mj6.SignalBased,"compact"]},standalone:!0,features:[t.aNF],decls:7,vars:6,consts:()=>{let o;return o=$localize`:3acd4e3a84c66d140da3c19c36a4d0d7ce688e6a6086371624662249440: Changing the value of the sliders will modify visibility of different layers of the model `,[["skinLayers",""],["slider","matSliderThumb"],o,["role","dialog","cdkTrapFocus","",1,"view-visibility-layers",3,"cdkTrapFocusAutoCapture"],[1,"sr-only"],[1,"flex","flex-col","flex-auto","gap-4","view-visibility-layers__list-wraper"],[3,"compact","schema","lang","contentId","contentType"],[1,"view-visibility-layers__list"],[1,"view-visibility-layers__toggle"],[1,"view-visibility-layers__list-item",3,"view-visibility-layers__list-item--hidden"],[1,"view-visibility-layers__list-item"],[1,"mb-1","uppercase","text-2xs"],[1,"view-visibility-layers__slider"],["type","button","app-view-button","","buttonSize","small","buttonShape","square","data-test","viewToolsButton",1,"view-visibility-layers__slider-button",3,"click","buttonTheme","matTooltip"],[1,"relative","flex","items-center","justify-center"],["role","img",3,"className"],[1,"pl-1","pr-6","grow"],[2,"width","100% !important",3,"min","max","step","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],["app-view-button","","buttonTheme","light-gray-outline","buttonShape","rounded","buttonSize","small","cdkFocusInitial","",1,"w-full",3,"click"]]},template:function(i,s){1&i&&(t.j41(0,"div",3)(1,"span",4),t.pXf(2,2),t.k0s(),t.j41(3,"div",5),t.DNE(4,eD,2,5,"app-view-skin-variants",6)(5,nD,3,0,"ul",7),t.k0s(),t.DNE(6,iD,3,1,"div",8),t.k0s()),2&i&&(t.AVh("view-visibility-layers--overflow",!s.compact()),t.Y8G("cdkTrapFocusAutoCapture",!s.compact()),t.R7$(4),t.vxM(4,s.showSkinLayers()?4:-1),t.R7$(),t.vxM(5,s.showVisibilityLayers()?5:-1),t.R7$(),t.vxM(6,s.showVisibilityLayers()?6:-1))},dependencies:[vi.kB,Sn.uc,Sn.oV,na.Ez,na.IV,na.OU,Yi.C,xt,jp],styles:[".view-visibility-layers{display:flex;flex-direction:column;position:relative;max-height:100%}.view-visibility-layers__toggle{padding:20px 0}.view-visibility-layers__list{display:flex;flex-direction:column;gap:16px}.view-visibility-layers__list-item{color:#374a68}.view-visibility-layers__list-item--hidden{color:#8196b1}.view-visibility-layers__slider{display:flex;align-items:center;border:1px solid #d7e0ea;border-radius:4px}.view-visibility-layers__slider-button{border-right:1px solid #d7e0ea!important}.view-visibility-layers__image{display:inline-block;width:20px;height:20px;background-repeat:no-repeat;background-position:center center;background-size:contain}.view-visibility-layers__image--muscular-system{background-image:url(muscular-system.327891c539004168.svg)}.view-visibility-layers__image--connective-tissue{background-image:url(connective-tissue.4255f00d428d5cf6.svg)}.view-visibility-layers__image--skeletal-system{background-image:url(skeletal-system.45739de79257c6f9.svg)}.view-visibility-layers__image--respiratory-system{background-image:url(respiratory-system.597f79517d077b72.svg)}.view-visibility-layers__image--endocrine-system{background-image:url(endocrine-system.ee5da256bbe8c882.svg)}.view-visibility-layers__image--digestive-system{background-image:url(digestive-system.cc6c7fe5888943ff.svg)}.view-visibility-layers__image--reproductive-system{background-image:url(reproductive-system.173a46e928b8b413.svg)}.view-visibility-layers__image--urinary-system{background-image:url(urinary-system.6a7d4c50f43f5ff5.svg)}.view-visibility-layers__image--cardiovascular-system{background-image:url(cardiovascular-system.c2afd11945ed2265.svg)}.view-visibility-layers__image--lymphatic-system{background-image:url(lymphatic-system.17d1c6972cab7cc8.svg)}.view-visibility-layers__image--nervous-system{background-image:url(nervous-system.d3161775d4ecdf29.svg)}.view-visibility-layers__image--integumentary-system{background-image:url(integumentary-system.2b82995e08b33a1e.svg)}.view-visibility-layers__image--layer{background-image:url(layer.5dc57591d05834ab.svg)}.view-visibility-layers--overflow .view-visibility-layers__toggle{background-color:#fff;position:sticky!important;bottom:0}@media (hover: none){.view-visibility-layers input[type=range]{pointer-events:none!important}.view-visibility-layers input[type=range]::-webkit-slider-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-moz-range-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-ms-thumb{pointer-events:all!important}}\n"],encapsulation:2,changeDetection:0}),e})(),V1=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-button-loader"]],decls:5,vars:0,consts:()=>{let o,i,s;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["tabindex","0","type","button","aria-label",o,"type","button",1,"button-loader"],[1,"button-loader__button"],["src","assets/images/widget/loading_experience/interact-in-3d-arrow.svg","alt",i,1,"button-loader__3d-arrow"],[1,"button-loader__label"]]},template:function(i,s){1&i&&(t.j41(0,"button",1)(1,"div",2),t.nrm(2,"img",3),t.j41(3,"div",4),t.pXf(4,0),t.k0s()()())},styles:[".button-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.button-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@media print{.button-loader[_ngcontent-%COMP%]{display:none}}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__button[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__button[_ngcontent-%COMP%]{background-color:#2d72dc;transform:scale(1.1)}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__3d-arrow[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__3d-arrow[_ngcontent-%COMP%]{transform:scale(1.2)}.button-loader__button[_ngcontent-%COMP%]{display:flex;padding:12px 28px;border-radius:32px;align-items:center;transition:transform .25s,background-color .25s;background-color:#101823cc}.button-loader__3d-arrow[_ngcontent-%COMP%]{transition:transform .25s;margin-inline-end:4px}.button-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;margin-inline-start:4px}"],changeDetection:0}),e})(),j1=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-hand-loader"]],decls:6,vars:0,consts:()=>{let o,i,s;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["tabindex","0","type","button","aria-label",o,1,"hand-loader"],[1,"hand-loader__container"],[1,"hand-loader__circle"],["src","assets/images/widget/loading_experience/interact-in-3d-hand.svg","alt",i,1,"hand-loader__3d-hand"],[1,"hand-loader__label"]]},template:function(i,s){1&i&&(t.j41(0,"button",1)(1,"div",2),t.nrm(2,"div",3)(3,"img",4),t.j41(4,"div",5),t.pXf(5,0),t.k0s()()())},styles:[".hand-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.hand-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@keyframes _ngcontent-%COMP%_handKeyframes{0%{transform:scale(1.2)}25%{transform:scale(1)}40%{transform:scale(1)}60%{transform:scale(1.2)}to{transform:scale(1.2)}}@keyframes _ngcontent-%COMP%_circleKeyframes{0%{transform:scale(0)}20%{transform:scale(0);opacity:1}to{transform:scale(1);opacity:0}}.hand-loader[_ngcontent-%COMP%]:focus   .hand-loader__3d-hand[_ngcontent-%COMP%], .hand-loader[_ngcontent-%COMP%]:hover   .hand-loader__3d-hand[_ngcontent-%COMP%]{filter:drop-shadow(0 0 8px #2d72dc)}.hand-loader__container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.hand-loader__circle[_ngcontent-%COMP%]{background-color:#fff;position:absolute;left:50%;margin-left:-40.5px;margin-top:-1.5px;width:70px;height:70px;border-radius:50%;animation:_ngcontent-%COMP%_circleKeyframes 2s infinite}.hand-loader__3d-hand[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_handKeyframes 2s ease-in-out infinite;position:absolute;height:96px;width:86px;left:50%;margin-left:-43px;margin-top:27px;transition:filter .3s ease-out}.hand-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600;color:#fff;text-shadow:0px 1px 5px black;bottom:40px;position:absolute;text-align:center;width:100%}"],changeDetection:0}),e})();const oD=["circle"],sD=["progressCircle"],rD=["progressContainer"];let x1=(()=>{var n;class e{get percent(){return this._percent}set percent(i){null!=i&&(this._percent=i,this.setProgress(this.percent))}constructor(i){this.renderer=i,this.ngUnsubscribe=new oe.B,this._percent=0}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions()}initSizeObserver(){(0,hn.R)(window,"resize").pipe((0,Pn.B)(10),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(i=100){const s=this.getCircumference();return s-i/100*s}setProgress(i=0){i>=100&&(i=100);const s=this.getCircumference(),r=this.getOffset(i);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}updateDimensions(){const i=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*i),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*i),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(i-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${i}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${i}`);const s=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`),setTimeout(()=>{this.renderer.setStyle(this.progressCircleRef.nativeElement,"transition","stroke-dashoffset 300ms")})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-play-loader"]],viewQuery:function(i,s){if(1&i&&(t.GBs(oD,7),t.GBs(sD,7),t.GBs(rD,7)),2&i){let r;t.mGM(r=t.lsd())&&(s.circleRef=r.first),t.mGM(r=t.lsd())&&(s.progressCircleRef=r.first),t.mGM(r=t.lsd())&&(s.progressContainerRef=r.first)}},inputs:{percent:"percent"},decls:10,vars:0,consts:()=>{let o,i;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:4b03875d535c300d85a81c17105d24d85adadbae9093351263643113653:3D`,[["circle",""],["progressContainer",""],["progressCircle",""],i,["tabindex","0","type","button","aria-label",o,1,"play-loader"],[1,"play-loader__circle"],[1,"play-loader__ring"],[1,"play-loader__ring-inner"],["icon","play",1,"play-loader__icon"],[1,"play-loader__label"]]},template:function(i,s){1&i&&(t.j41(0,"button",4)(1,"div",5,0),t.qSk(),t.j41(3,"svg",6,1),t.nrm(5,"circle",7,2),t.k0s(),t.joV(),t.nrm(7,"app-icon",8),t.j41(8,"div",9),t.pXf(9,3),t.k0s()()())},dependencies:[qe],styles:[".play-loader[_ngcontent-%COMP%]{--buttonSize: 35vw;border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.play-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__circle[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__circle[_ngcontent-%COMP%]{background:#fffc;transform:scale(1.1)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__icon[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__icon[_ngcontent-%COMP%]{color:#2d72dc;transform:scale(1.2)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__label[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__label[_ngcontent-%COMP%]{color:#fff}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__ring[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__ring[_ngcontent-%COMP%]{stroke:#2d72dc}.play-loader__circle[_ngcontent-%COMP%]{width:var(--buttonSize);height:var(--buttonSize);border-radius:50%;background-color:#101823cc;display:flex;align-items:center;justify-content:center;position:relative;transition:background-color .25s,color .25s,transform .25s}.play-loader__icon[_ngcontent-%COMP%]{font-size:calc(var(--buttonSize) / 2);color:#ffffffe6;transition:color .25s,transform .25s;margin-right:-10%}.play-loader__label[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:2;font-weight:600}.play-loader__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;stroke-width:4;stroke:#fff;fill:transparent;transform:rotate(-90deg)}@media (min-width: 600px){.play-loader__circle[_ngcontent-%COMP%]{width:160px;height:160px}.play-loader__icon[_ngcontent-%COMP%]{font-size:80px}}"],changeDetection:0}),e})();var xc,G1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},$1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function aD(n,e){if(1&n&&(t.qex(0),t.j41(1,"span",2),t.EFF(2),t.k0s(),t.EFF(3),t.bVm()),2&n){const o=t.XpG();t.R7$(2),t.JRh(o.questionNumber),t.R7$(),t.SpI("",o.questionTotal," ")}}function lD(n,e){1&n&&(t.j41(0,"span",2),t.EFF(1,"Quiz"),t.k0s())}class Gc{constructor(e,o){this.store=e,this.changeDetectorRef=o,this.Lifecycle=_o,this.questionNumber="",this.questionTotal="",this.ngUnsubscribe=new oe.B}ngOnInit(){this.store.select(G.getActiveQuestionIndex).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.questionNumber=$localize`Question ${o+1}`,this.questionTotal=$localize` of ${this.store.selectSnapshot(G.getQuestionTotal)}`,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}(xc=Gc).\u0275fac=function(e){return new(e||xc)(t.rXU(c.il),t.rXU(t.gRc))},xc.\u0275cmp=t.VBU({type:xc,selectors:[["app-view-quiz-header"]],decls:6,vars:6,consts:[["noQuestionsTemplate",""],[4,"ngIf","ngIfElse"],[1,"font-bold"]],template:function(e,o){if(1&e&&(t.j41(0,"div"),t.DNE(1,aD,4,2,"ng-container",1),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,lD,2,0,"ng-template",null,0,t.C5r),t.k0s()),2&e){let i;const s=t.sdS(5);t.R7$(),t.Y8G("ngIf",(null==(i=t.bMT(2,2,o.quizSettings$))?null:i.showProgress)&&t.bMT(3,4,o.lifecycle$)!==o.Lifecycle.Review)("ngIfElse",s)}},dependencies:[b.bT,b.Jj],changeDetection:0}),G1([(0,c.l6)(G.getQuizSettings),$1("design:type",f.c)],Gc.prototype,"quizSettings$",void 0),G1([(0,c.l6)(G.getLifecycle),$1("design:type",f.c)],Gc.prototype,"lifecycle$",void 0);var F1=S(5951);const cD=[[["app-list-item"]]],_D=["app-list-item"];var B1=function(n){return n.Default="default",n.Commafied="commafied",n.flat="flat",n.inline="inline",n.bulleted="bulleted",n}(B1||{});let dD=(()=>{var n;class e{constructor(){this.listType=B1.Default,this.dense=!1}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-list"]],inputs:{listType:"listType",dense:"dense"},ngContentSelectors:_D,decls:2,vars:3,consts:[[1,"list",3,"ngClass"]],template:function(i,s){1&i&&(t.NAR(cD),t.j41(0,"div",0),t.SdG(1),t.k0s()),2&i&&(t.AVh("list--dense",s.dense),t.Y8G("ngClass","list--"+s.listType))},dependencies:[b.YU],styles:['@charset "UTF-8";.list{display:flex;flex-direction:column}.list--dense{padding:0!important}.list--default app-list-item{display:list-item;margin-left:16px;list-style-type:disc}.list--commafied{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--commafied app-list-item:not(:last-child):after{content:", ";float:right;padding-right:4px}.list--bulleted{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--bulleted app-list-item:not(:last-child):after{content:" \\2022  ";float:right;padding-right:4px;padding-left:4px}.list--flat app-list-item:not(:last-child){margin-bottom:4px}.list--inline{display:inline-flex;align-items:center;display:flex;flex-direction:row;flex-wrap:wrap}.list--inline app-list-item{margin:0 8px 4px 0}.list__item{display:block}\n'],encapsulation:2,changeDetection:0}),e})();const pD=["*"];let uD=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-list-item"]],ngContentSelectors:pD,decls:1,vars:0,template:function(i,s){1&i&&(t.NAR(),t.SdG(0))},encapsulation:2,changeDetection:0}),e})();function gD(n,e){if(1&n&&(t.j41(0,"app-list-item")(1,"div",1),t.EFF(2),t.k0s()()),2&n){const o=e.$implicit;t.R7$(),t.BMQ("data-id",o.id),t.R7$(),t.JRh(o.label)}}let z1=(()=>{var n;class e{get objectIds(){return this._objectIds}set objectIds(i){this._objectIds=i;const s=this.store.selectSnapshot(U.getViewGraph);this.nodes=this.graphService.getNodes(s,i),this.changeRef.markForCheck()}constructor(i,s,r){this.store=i,this.graphService=s,this.changeRef=r}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(lo),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-object-tree"]],inputs:{objectIds:"objectIds"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"text-sm","my-1"]],template:function(i,s){1&i&&(t.j41(0,"app-list"),t.DNE(1,gD,3,2,"app-list-item",0),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.nodes))},dependencies:[b.Sq,dD,uD],changeDetection:0}),e})(),W1=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-answer-number"]],inputs:{number:"number"},decls:3,vars:1,consts:[[1,"number","text-2xs"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div"),t.EFF(2),t.k0s()()),2&i&&(t.R7$(2),t.JRh(s.number))},styles:[".number[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:#131c2a;border:1px solid rgba(55,74,104,.5);border-radius:50%}"],changeDetection:0}),e})();var $c;function SD(n,e){if(1&n&&(t.j41(0,"div",3)(1,"div",4),t.nrm(2,"app-view-quiz-answer-number",5),t.k0s(),t.j41(3,"div",6),t.nrm(4,"app-quiz-label-anatomy-select",7),t.k0s()()),2&n){const o=e.index,i=t.XpG();t.R7$(2),t.Y8G("number",o+1),t.R7$(2),t.Y8G("options",i.options)("formControlName",o)}}class hf{get options(){return this._options}set options(e){(0,m.isEqual)(e,this._options)||(this._options=e,this.buildFormOptions(e))}constructor(e){this.formBuilder=e,this.valueChange=new t.bkB,this.ngUnsubscribe=new oe.B,this._options=[],this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({options:e})=>{this.valueChange.next(e)})}init(){this.activeSubmission$.pipe((0,X.p)(e=>!(0,m.isNil)(e)&&!(0,m.isNil)(e.answer)),(0,Wr.J)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{const i=function hD(n,e,o){const i=e.findIndex((r,a)=>!(0,m.isEqual)(n[a],r)),s=e[i];return e.map((r,a)=>(0,m.isEqual)(s,r)&&a!==i?o:r)}(e.answer||[],o.answer||[],"");(0,m.isEqual)(o,i)||this.form.patchValue({options:i||[]})}),this.activeSubmission$.pipe((0,X.p)(e=>!(0,m.isNil)(e)&&!(0,m.isNil)(e.answer)&&Array.isArray(e.answer)),(0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const i=e.answer;(0,m.isEqual)(this.form.value.options,i)||this.form.patchValue({options:i},{emitEvent:!1,onlySelf:!0})})}buildFormOptions(e){this.optionsArray.clear(),e.forEach(()=>{this.optionsArray.push(this.formBuilder.control(""))}),this.optionsArray.setValue(e.map(()=>""))}}($c=hf).\u0275fac=function(e){return new(e||$c)(t.rXU(K.ze))},$c.\u0275cmp=t.VBU({type:$c,selectors:[["app-view-quiz-label-anatomy"]],inputs:{options:"options"},outputs:{valueChange:"valueChange"},decls:3,vars:2,consts:[[1,"options",3,"formGroup"],["formArrayName","options"],["class","options__item","data-test","questionAnswer",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"options__item"],[1,"mr-2"],[3,"number"],[1,"options__item-select"],[3,"options","formControlName"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,SD,5,3,"div",2),t.k0s()()),2&e&&(t.Y8G("formGroup",o.form),t.R7$(2),t.Y8G("ngForOf",o.options))},dependencies:[b.Sq,K.BC,K.cb,K.j4,K.JD,K.v8,O1,W1],styles:[".options__item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-bottom:12px}.options__item-select[_ngcontent-%COMP%]{border:1px solid #96a8c0;border-radius:4px;flex:1 1 auto}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(G.getActiveSubmission),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],hf.prototype,"activeSubmission$",void 0);var pl,X1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},H1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function bD(n,e){if(1&n&&(t.j41(0,"mat-radio-button",8),t.EFF(1),t.k0s()),2&n){const o=e.$implicit;t.Y8G("value",o.value),t.R7$(),t.SpI(" ",o.label," ")}}function yD(n,e){if(1&n){const o=t.RV6();t.j41(0,"div")(1,"mat-radio-group",6),t.bIt("change",function(s){t.eBV(o);const r=t.XpG(2);return t.Njj(r.handleMultipleChoiceChange(s))}),t.DNE(2,bD,2,2,"mat-radio-button",7),t.k0s()()}if(2&n){const o=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",o.question.data.options)}}function vD(n,e){if(1&n&&(t.j41(0,"div",10),t.nrm(1,"app-view-quiz-object-tree",11),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.Y8G("objectIds",o.question.data.correctAnswer)}}function ED(n,e){if(1&n&&(t.j41(0,"div"),t.DNE(1,vD,2,1,"div",9),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",o.question.data.showAnswerList)}}function TD(n,e){if(1&n){const o=t.RV6();t.j41(0,"div")(1,"app-view-quiz-label-anatomy",12),t.bIt("valueChange",function(s){t.eBV(o);const r=t.XpG(2);return t.Njj(r.handleLabelAnatomyChanges(s))}),t.k0s()()}if(2&n){const o=t.XpG(2);t.R7$(),t.Y8G("options",o.question.data.options)}}function CD(n,e){if(1&n&&(t.j41(0,"div",1)(1,"div",2),t.nrm(2,"app-content-blocks",3),t.k0s(),t.j41(3,"div",4),t.DNE(4,yD,3,1,"div",5)(5,ED,2,1,"div",5)(6,TD,2,1,"div",5),t.k0s()()),2&n){const o=t.XpG();t.R7$(2),t.Y8G("contentBlocks",o.question.questionPrompt),t.R7$(),t.Y8G("ngSwitch",o.question.type),t.R7$(),t.Y8G("ngSwitchCase",o.QuestionType.MultipleChoice),t.R7$(),t.Y8G("ngSwitchCase",o.QuestionType.SelectAnatomy),t.R7$(),t.Y8G("ngSwitchCase",o.QuestionType.LabelAnatomy)}}class Gp{get question(){return this._question}set question(e){this._question=e,this.initQuestionListeners()}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}constructor(e,o){this.changeRef=e,this.viewService=o,this.disabled=!1,this.QuestionType=ot,this.ngUnsubscribe=new oe.B}handleMultipleChoiceChange(e){this.writeValue(e.value)}handleLabelAnatomyChanges(e){this.writeValue(e)}initQuestionListeners(){switch(this.question.type){case ot.SelectAnatomy:this.initSelectAnatomyListeners();break;case ot.Instructions:this.initInstructions()}}initSelectAnatomyListeners(){this.checkedNodesIds$.pipe((0,Vn.F)((e,o)=>(0,m.isEqual)(e,o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.writeValue(e),this.changeRef.markForCheck()})}initInstructions(){setTimeout(()=>{this.writeValue("-"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onChange(e){}onTouched(){}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}writeValue(e){this.value=e}setDisabledState(e){this.disabled=e}}(pl=Gp).\u0275fac=function(e){return new(e||pl)(t.rXU(t.gRc),t.rXU(zt))},pl.\u0275cmp=t.VBU({type:pl,selectors:[["app-view-quiz-question"]],inputs:{question:"question",value:"value"},features:[t.Jv_([{provide:K.kq,useExisting:(0,t.Rfq)(()=>pl),multi:!0}])],decls:1,vars:1,consts:[["class","view-quiz-question text-sm mb-8","data-test","question",4,"ngIf"],["data-test","question",1,"view-quiz-question","text-sm","mb-8"],["data-test","questionPrompt",1,"view-quiz-question__prompt"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"flex","flex-col",3,"change"],["data-test","questionAnswer","class","view-quiz-question__option",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"view-quiz-question__option",3,"value"],["class","ml-3",4,"ngIf"],[1,"ml-3"],[3,"objectIds"],[3,"valueChange","options"]],template:function(e,o){1&e&&t.DNE(0,CD,7,5,"div",0),2&e&&t.Y8G("ngIf",o.question)},dependencies:[b.Sq,b.bT,b.ux,b.e1,F1.VT,F1._g,sl,z1,hf],styles:[".view-quiz-question__prompt{margin-bottom:8px}.view-quiz-question__option{font-size:.875rem;line-height:1.25rem;padding:12px;white-space:normal!important}.view-quiz-question__option>*{white-space:normal!important}\n"],encapsulation:2,changeDetection:0}),X1([(0,c.l6)(Re.getCheckedNodeIds),H1("design:type",f.c)],Gp.prototype,"checkedNodesIds$",void 0),X1([(0,c.l6)(G.getActiveSubmission),H1("design:type",f.c)],Gp.prototype,"activeSubmission$",void 0);const OD=["*"];function wD(n,e){1&n&&t.nrm(0,"app-icon",6)}function MD(n,e){1&n&&t.nrm(0,"app-icon",7)}function ID(n,e){1&n&&(t.j41(0,"span",8),t.nrm(1,"span",9),t.k0s())}let mf=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-answer-option"]],inputs:{correct:"correct"},ngContentSelectors:OD,decls:7,vars:7,consts:[["data-test","answerOptionContainer",1,"option"],[1,"flex","relative",3,"ngSwitch"],["class","option__icon option__icon--correct","style","font-size: 20px","icon","check-circle",4,"ngSwitchCase"],["class","option__icon option__icon--incorrect","style","font-size: 20px","icon","times-circle",4,"ngSwitchCase"],["class","option__icon",4,"ngSwitchDefault"],[1,"pl-2"],["icon","check-circle",1,"option__icon","option__icon--correct",2,"font-size","20px"],["icon","times-circle",1,"option__icon","option__icon--incorrect",2,"font-size","20px"],[1,"option__icon"],[1,"mat-radio-outer-circle"]],template:function(i,s){1&i&&(t.NAR(),t.j41(0,"div",0)(1,"div",1),t.DNE(2,wD,1,0,"app-icon",2)(3,MD,1,0,"app-icon",3)(4,ID,2,0,"span",4),t.j41(5,"div",5),t.SdG(6),t.k0s()()()),2&i&&(t.AVh("option--correct",!0===s.correct)("option--incorrect",!1===s.correct),t.R7$(),t.Y8G("ngSwitch",s.correct),t.R7$(),t.Y8G("ngSwitchCase",!0),t.R7$(),t.Y8G("ngSwitchCase",!1))},dependencies:[b.ux,b.e1,b.fG,qe],styles:[".option[_ngcontent-%COMP%]{padding:12px;border-radius:4px;margin-bottom:8px;color:#131c2a}.option--correct[_ngcontent-%COMP%]{border:1px solid #83e692;background-color:#f0fff0}.option--incorrect[_ngcontent-%COMP%]{border:1px solid #f44336;background-color:#ffe2db}.option__icon[_ngcontent-%COMP%]{position:relative;flex:0 0 20px;justify-content:center}.option__icon--correct[_ngcontent-%COMP%]{color:#83e692}.option__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}"],changeDetection:0}),e})();function AD(n,e){if(1&n&&(t.j41(0,"div")(1,"app-view-quiz-answer-option",1)(2,"div"),t.EFF(3),t.k0s()()()),2&n){const o=e.$implicit,i=t.XpG();t.R7$(),t.Y8G("correct",i.isOptionAnswerCorrect(i.question,o.value,i.answer)),t.R7$(2),t.SpI(" ",o.label," ")}}let PD=(()=>{var n;class e{constructor(){}ngOnInit(){}isOptionAnswerCorrect(i,s,r){const a=Tr(i,[s]);return s===r[0]||a?a:void 0}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-multiple-choice-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"correct"]],template:function(i,s){1&i&&t.DNE(0,AD,4,2,"div",0),2&i&&t.Y8G("ngForOf",s.question.data.options)},dependencies:[b.Sq,mf],changeDetection:0}),e})();function ND(n,e){1&n&&(t.qex(0),t.pXf(1,1),t.bVm())}function RD(n,e){1&n&&(t.qex(0),t.pXf(1,2),t.bVm())}function kD(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",11)(1,"button",12),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectedObjectsClick(s.answer))}),t.pXf(2,3),t.k0s(),t.j41(3,"button",13),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleCorrectObjectsClick(s.question.data.correctAnswer))}),t.EFF(4," Highlight Correct Answer "),t.k0s()()}}let DD=(()=>{var n;class e{get isCorrect(){return Tr(this.question,this.answer)}constructor(i,s,r){this.graphService=i,this.viewService=s,this.store=r}fadeNonselected(i){const s=this.store.selectSnapshot(U.getViewGraph),r=this.graphService.getInverseSelection(s,i),a=this.graphService.getNodes(s,r);this.store.dispatch(new Mo(Es,a.map(l=>l.id)))}handleCorrectObjectsClick(i){this.highlightNodes(i)}handleSelectedObjectsClick(i){this.highlightNodes(i)}highlightNodes(i){const s=i.filter(r=>r&&""!==r);this.resetSelectAndFade(),this.repositionCamera(s),this.fadeNonselected(s)}repositionCamera(i){1===i.length?this.store.dispatch(new To(i[0])):this.viewService.resetCamera()}resetSelectAndFade(){this.viewService.clearSelectedNodes(),this.viewService.clearFadedNodes()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(lo),t.rXU(zt),t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-select-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:11,vars:5,consts:()=>{let o,i,s;return o=$localize`:4274205d4ae04ab28b67840a011bbbc3c207f6083164453258197222114:Correct! You selected:`,i=$localize`:86fadbb89f45c1d0fad1eae1936d43d4e59e065a682829795532587629:Incorrect! You selected:`,s=$localize`:a5dfb5defc5b4f7d9d17e3175f3a2832a33801872737293371102556031: Highlight My Answer `,[["selectAnatomyAnswer",""],o,i,s,[3,"correct"],[1,"flex","flex-col"],[1,"font-semibold"],[4,"ngIf"],[1,"mt-2","ml-2"],[3,"objectIds"],["class","mt-4",4,"ngIf"],[1,"mt-4"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightUserAnswers",1,"w-full","my-2",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightCorrectAnswers",1,"w-full","my-2",3,"click"]]},template:function(i,s){if(1&i&&(t.j41(0,"div")(1,"app-view-quiz-answer-option",4,0)(3,"div",5)(4,"div")(5,"span",6),t.DNE(6,ND,2,0,"ng-container",7)(7,RD,2,0,"ng-container",7),t.k0s()(),t.j41(8,"div",8),t.nrm(9,"app-view-quiz-object-tree",9),t.k0s()()(),t.DNE(10,kD,5,0,"div",10),t.k0s()),2&i){const r=t.sdS(2);t.R7$(),t.Y8G("correct",s.isCorrect),t.R7$(5),t.Y8G("ngIf",r.correct),t.R7$(),t.Y8G("ngIf",!r.correct),t.R7$(2),t.Y8G("objectIds",s.answer),t.R7$(),t.Y8G("ngIf",!s.summary&&!s.isCorrect)}},dependencies:[b.bT,xt,z1,mf],changeDetection:0}),e})();function LD(n,e){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.SpI(" ",o.label.title," ")}}function UD(n,e){if(1&n&&(t.j41(0,"div"),t.pXf(1,2),t.k0s(),t.j41(2,"div",11),t.pXf(3,3),t.k0s()),2&n){const o=t.XpG(),i=o.$implicit,s=o.index,r=t.XpG();t.R7$(),t.uP7(r.getSelectedUserOption(s).label.title.trim()),t.nnv(1),t.R7$(2),t.uP7(i.label.title.trim()),t.nnv(3)}}function VD(n,e){if(1&n&&(t.j41(0,"div",5)(1,"div",6),t.nrm(2,"app-view-quiz-answer-number",7),t.k0s(),t.j41(3,"div",8)(4,"app-view-quiz-answer-option",9,0),t.DNE(6,LD,2,1,"div",10)(7,UD,4,2,"ng-template",null,1,t.C5r),t.k0s()()()),2&n){const o=e.index,i=t.sdS(5),s=t.sdS(8),r=t.XpG();t.R7$(2),t.Y8G("number",o+1),t.R7$(2),t.Y8G("correct",r.isOptionAnswerCorrect(o)),t.R7$(2),t.Y8G("ngIf",i.correct)("ngIfElse",s)}}let jD=(()=>{var n;class e{constructor(){}ngOnInit(){}isOptionAnswerCorrect(i){return this.answer[i]===this.question.data.correctAnswer[i]}getSelectedUserOption(i){const s=this.answer[i];return this.question.data.options.find(r=>r.value===s)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-label-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:()=>{let o,i;return o=$localize`:a72b1c5957d49334a91017e69eb28a64b4794be93931625009645654184:You selected ${"\ufffd0\ufffd"}:INTERPOLATION:.`,i=$localize`:68452fc86b9a1e10579d11cafee518846c2acf747572660995305138875:This is the ${"\ufffd0\ufffd"}:INTERPOLATION:.`,[["answerOption",""],["falseBlock",""],o,i,["class","answers",4,"ngFor","ngForOf"],[1,"answers"],[1,"answers__number"],[3,"number"],[1,"answers__option"],[3,"correct"],[4,"ngIf","ngIfElse"],[1,"mt-1"]]},template:function(i,s){1&i&&t.DNE(0,VD,9,4,"div",4),2&i&&t.Y8G("ngForOf",s.question.data.options)},dependencies:[b.Sq,b.bT,mf,W1],styles:[".answers[_ngcontent-%COMP%]{display:flex;flex-direction:row}.answers__number[_ngcontent-%COMP%]{border-top:1px solid transparent;margin-top:12px;margin-inline-end:8px}.answers__option[_ngcontent-%COMP%]{flex:1 1 auto}"],changeDetection:0}),e})();function xD(n,e){if(1&n&&(t.j41(0,"div",7),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI("",o.questionNumber,".")}}function GD(n,e){if(1&n&&(t.j41(0,"div"),t.nrm(1,"app-view-quiz-multiple-choice-answer",8),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function $D(n,e){if(1&n&&(t.j41(0,"div"),t.nrm(1,"app-view-quiz-select-anatomy-answer",8),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function FD(n,e){if(1&n&&(t.j41(0,"div"),t.nrm(1,"app-view-quiz-label-anatomy-answer",8),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function BD(n,e){if(1&n&&(t.j41(0,"div",9),t.nrm(1,"app-content-blocks",3),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("contentBlocks",o.question.explanation)}}let Q1=(()=>{var n;class e{constructor(i,s){this.store=i,this.contentBlocksService=s,this.QuestionType=ot,this.hasExplanation=!1}ngOnInit(){this.store.dispatch(new Te.SetQuizPickMode("none")),this.hasExplanation=this.contentBlocksService.hasContentBlockText(this.question.explanation)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(Ar))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-quiz-answer"]],inputs:{question:"question",questionNumber:"questionNumber",answer:"answer",summary:"summary"},decls:10,vars:7,consts:[["data-test","answer",1,"answer"],[1,"answer__prompt"],["class","mr-1",4,"ngIf"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","answer__explanation",4,"ngIf"],[1,"mr-1"],[3,"question","answer","summary"],[1,"answer__explanation"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,xD,2,1,"div",2),t.j41(3,"div"),t.nrm(4,"app-content-blocks",3),t.k0s()(),t.j41(5,"div",4),t.DNE(6,GD,2,3,"div",5)(7,$D,2,3,"div",5)(8,FD,2,3,"div",5),t.k0s(),t.DNE(9,BD,2,1,"div",6),t.k0s()),2&i&&(t.R7$(2),t.Y8G("ngIf",s.questionNumber),t.R7$(2),t.Y8G("contentBlocks",s.question.questionPrompt),t.R7$(),t.Y8G("ngSwitch",s.question.type),t.R7$(),t.Y8G("ngSwitchCase",s.QuestionType.MultipleChoice),t.R7$(),t.Y8G("ngSwitchCase",s.QuestionType.SelectAnatomy),t.R7$(),t.Y8G("ngSwitchCase",s.QuestionType.LabelAnatomy),t.R7$(),t.Y8G("ngIf",s.hasExplanation))},dependencies:[b.bT,b.ux,b.e1,sl,PD,DD,jD],styles:[".answer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.answer__prompt[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.answer__explanation[_ngcontent-%COMP%]{padding-top:32px}"],changeDetection:0}),e})();var zD=S(391);let WD=(()=>{var n;class e{constructor(i,s,r){this.http=i,this.markdownService=s,this.store=r}downloadResultsPDF(i="",s="",r="",a,l){return this.http.post("/ws/mc/pdf",this.getPDFHTML(i,s,r,a,l),{responseType:"arraybuffer",headers:new $e.Lr({"Content-Type":"text/html; charset=utf-8"})}).pipe((0,F.T)(_=>{const d=new Blob([_],{type:"application/pdf"}),p=window.URL.createObjectURL(d),u=(r||"Quiz Results").replace(/ /g,"_").replace(/\W/g,"").toLowerCase(),g=document.createElement("a");return g.download=u,g.href=p,g.click(),!0}),(0,pi.W)(()=>(0,Qe.of)(!1)))}getPDFHTML(i,s,r,a,l){return`\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <style>\n\n          @media print {\n\n            html {\n              font-family: Arial;\n            }\n\n            body {\n              margin: 0;\n            }\n\n            ol {\n              list-style-position: inside;\n              padding-left: 0;\n            }\n\n            header {\n              position: running(header);\n              width: 100%;\n            }\n\n            header > div {\n              display: flex;\n              justify-content: space-between;\n            }\n\n            @page {\n              size: letter portrait;\n              margin: 1in;\n              \n              @top-center {\n                content: element(header);\n                width: 100%;\n              }\n\n              @bottom-center {\n                content: "Page " counter(page) " of " counter(pages);\n                font-size: 10px;\n              }\n            }\n\n          }\n          \n        </style>\n      </head>\n      <body style="font-size: 12px">\n\n        <header>\n          <div style="margin-bottom: .05in">\n            <div style="font-weight: 900">${i}</div>\n            <div style="text-align: right">\n                <span style="font-weight: 900">Score: </span>\n                <span>${l.correctTotal} out of ${l.scorableTotal}</span>\n            </div>\n          </div>\n\n          <div>\n            <div>${s}</div>\n            <div style="text-align: right">\n              <span style="font-weight: 900">Percentage: </span>\n              <span>${l.score}%</span>\n            </div>\n          </div>\n        </header>\n\n        \x3c!-- PDF CONTENT --\x3e\n\n        <div style="font-weight: 900; margin-bottom: .05in">${r}</div>\n        <div style="font-size: 10px">QUIZ RESULTS</div>\n\n        <br />\n\n        ${this.createPDFResponses(a,l)}\n        \n      </body>\n    </html>\n    `}createPDFResponses(i,s){const r=i.filter(d=>d.type!==ot.Instructions),a=this.markdownService.renderer.list,l=this.markdownService.renderer.listitem;this.markdownService.renderer.list=d=>d.replace(/,$/,""),this.markdownService.renderer.listitem=d=>` ${d},`;const _=r.map(d=>{const p=this.getNormalizedAnswer(s.questionAnswers[d.id]);return this.createPDFResponse(d,p)}).join("\n      <br />\n      <br />\n    ");return this.markdownService.renderer.list=a,this.markdownService.renderer.listitem=l,`\n      <ol>\n        ${_}\n      </ol>\n    `}getNormalizedAnswer(i){return typeof i>"u"?[]:"string"==typeof i?[i]:i}createPDFResponse(i,s){let r=this.convertContentBlockArray(i.questionPrompt);i.type===ot.SelectAnatomy&&i.data.showAnswerList&&(r=`${r} ${this.printAnatomyList(i.data.correctAnswer)}.`);const a=Tr(i,s);return`\n      <li style="font-weight: 900">\n        ${r}\n        <div style="font-weight: 400; margin-top: .1in; margin-left: .2in; line-height: .2in;">\n          <img src="${(a?"correct":"incorrect")+".svg"}" />\n          <span style="font-weight: 900; margin-left: .05in; margin-right: .05in">${a?"Correct!":"Incorrect!"}</span>\n          ${this.getResponseText(i,s,a)}\n        </div>\n        <p style="font-weight: 400; font-style: italic; margin-bottom: 0">\n          ${this.convertContentBlockArray(i.explanation)}\n        </p>\n      </li>\n    `}getResponseText(i,s,r){let a="";switch(i.type){case ot.MultipleChoice:a=`You selected: ${this.getMultipleChoiceLabel(i,s[0])}.`,r||(a=`${a} The correct answer is: ${this.getMultipleChoiceLabel(i,i.data.correctAnswer)}.`);break;case ot.LabelAnatomy:a=`You labeled the anatomy ${r?"correctly":"incorrectly. The correct answer is"}: ${this.printLabelList(i)}.`;break;case ot.SelectAnatomy:r||(a=`You selected: ${this.printAnatomyList(s)}.`)}return a}printAnatomyList(i){const s=this.store.selectSnapshot(U.getViewGraph);return i.map(r=>xi(s,r)?.label).join(", ")}printLabelList(i){return i.data.correctAnswer.map((s,r)=>`${r+1}. ${i.data.options.find(l=>l.value===s).label.title}`).join(", ")}getMultipleChoiceLabel(i,s){return i.data.options.find(a=>a.value===s)?.label}convertContentBlockArray(i){return i.filter(s=>s.type===Fn.Markdown).map(s=>{const r=this.markdownService.parse(s.markdown);return this.stripHTML(r)}).join("\n")}stripHTML(i){return(new DOMParser).parseFromString(i,"text/html").body.textContent||""}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Ti.Rl),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();const XD=["progressCircle"],HD=["*"],QD=(n,e)=>({"progress--text-small":n,"progress--animate":e});function YD(n,e){if(1&n&&(t.j41(0,"div",6),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.progress,"% ")}}function qD(n,e){1&n&&(t.j41(0,"div",7),t.SdG(1),t.k0s())}let ff=(()=>{var n;class e{get progress(){return this._progress}set progress(i){this._progress=i,this.updateCircle()}get strokeWidth(){return this._strokeWidth}set strokeWidth(i){this._strokeWidth=i}get diameter(){return this._diameter}set diameter(i){this._diameter=i}constructor(i,s){this.renderer=i,this.changeRef=s,this.textSize="default",this._progress=0,this.showPercent=!0,this.strokeColor="#2d72dc",this.fillColor="#ffffff",this.ringColor="#eaeff5",this._strokeWidth=8,this._diameter=120,this.fillOnComplete=!1,this.animate=!0}ngOnInit(){}ngAfterViewInit(){this.updateCircle()}updateCircle(){if(this.progressCircleRef){const s=2*this.progressCircleRef.nativeElement.r.baseVal.value*Math.PI,r=s-this.progress/100*s;this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}this.changeRef.markForCheck()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-progress-circle"]],viewQuery:function(i,s){if(1&i&&t.GBs(XD,7),2&i){let r;t.mGM(r=t.lsd())&&(s.progressCircleRef=r.first)}},inputs:{textSize:"textSize",progress:"progress",showPercent:"showPercent",strokeColor:"strokeColor",fillColor:"fillColor",ringColor:"ringColor",strokeWidth:"strokeWidth",diameter:"diameter",fillOnComplete:"fillOnComplete",animate:"animate"},ngContentSelectors:HD,decls:9,vars:20,consts:[["progressCircle",""],["data-test","progress",1,"progress",3,"ngClass"],["alt",""],[1,"progress__circle"],["class","progress__label","data-test","progressPercentage",4,"ngIf"],["class","progress__content","data-test","progressContent",4,"ngIf"],["data-test","progressPercentage",1,"progress__label"],["data-test","progressContent",1,"progress__content"]],template:function(i,s){1&i&&(t.NAR(),t.j41(0,"div",1),t.qSk(),t.j41(1,"svg",2)(2,"g"),t.nrm(3,"circle",3),t.k0s(),t.j41(4,"g"),t.nrm(5,"circle",3,0),t.k0s()(),t.DNE(7,YD,2,1,"div",4)(8,qD,2,0,"div",5),t.k0s()),2&i&&(t.Y8G("ngClass",t.l_i(17,QD,"small"===s.textSize,s.animate)),t.R7$(),t.BMQ("width",s.diameter)("height",s.diameter),t.R7$(2),t.BMQ("stroke",s.ringColor)("stroke-width",s.strokeWidth)("fill",s.fillColor)("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),t.R7$(2),t.BMQ("stroke",s.strokeColor)("stroke-width",s.strokeWidth)("fill",100===s.progress&&s.fillOnComplete?s.strokeColor:"transparent")("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),t.R7$(2),t.Y8G("ngIf",s.showPercent),t.R7$(),t.Y8G("ngIf",!s.showPercent))},dependencies:[b.YU,b.bT],styles:[".progress[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.progress--animate[_ngcontent-%COMP%]   .progress__circle[_ngcontent-%COMP%]{transition:stroke-dashoffset .35s,fill .35s}.progress--small[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.progress__ring[_ngcontent-%COMP%]{position:absolute;z-index:1}.progress__circle[_ngcontent-%COMP%]{transform:rotate(-90deg);transform-origin:50% 50%}.progress__label[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;font-weight:600;transform:translate(-50%,-50%);z-index:2;font-size:1.125rem;line-height:1.75rem}.progress__content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:#fff;position:absolute}"],changeDetection:0}),e})();var Fc,ps=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},us=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function KD(n,e){if(1&n&&(t.j41(0,"div",10)(1,"div",11),t.nrm(2,"app-progress-circle",12),t.j41(3,"div",13),t.pXf(4,0),t.k0s()()()),2&n){const o=t.XpG();t.R7$(2),t.Y8G("progress",null==o.quizScore?null:o.quizScore.score),t.R7$(2),t.uP7(null==o.quizScore?null:o.quizScore.correctTotal)(null==o.quizScore?null:o.quizScore.scorableTotal),t.nnv(4)}}function JD(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",19),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleResultsClick())}),t.nrm(1,"app-icon",20),t.qex(2),t.pXf(3,1),t.bVm(),t.k0s()}}function ZD(n,e){1&n&&(t.qex(0),t.pXf(1,2),t.bVm())}function eL(n,e){1&n&&(t.qex(0),t.pXf(1,3),t.bVm())}function tL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",21),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleToggleSummaryClick())}),t.DNE(1,ZD,2,0,"ng-container",8)(2,eL,2,0,"ng-container",8),t.k0s()}if(2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",o.showExplanation),t.R7$(),t.Y8G("ngIf",!o.showExplanation)}}function nL(n,e){if(1&n&&(t.j41(0,"div",24),t.nrm(1,"app-view-quiz-answer",25),t.k0s()),2&n){const o=e.$implicit,i=e.index,s=t.XpG(3);t.R7$(),t.Y8G("question",o)("questionNumber",i+1)("answer",null==s.quizScore?null:s.quizScore.questionAnswers[o.id])("summary",!0)}}function iL(n,e){if(1&n&&(t.j41(0,"div",22),t.DNE(1,nL,2,4,"div",23),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",o.questions)}}function oL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",26),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleRestartClick())}),t.pXf(1,4),t.k0s()}}function sL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleExitClick())}),t.pXf(1,5),t.k0s()}}function rL(n,e){if(1&n&&(t.qex(0),t.DNE(1,JD,4,0,"button",14)(2,tL,3,2,"button",15)(3,iL,2,1,"div",16)(4,oL,2,0,"button",17),t.nI1(5,"async"),t.DNE(6,sL,2,0,"button",18),t.nI1(7,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.showSummaryEnabled&&o.showExplanationEnabled),t.R7$(),t.Y8G("ngIf",o.showSummaryEnabled&&o.showExplanationEnabled),t.R7$(),t.Y8G("ngIf",o.showExplanationEnabled&&o.showExplanation),t.R7$(),t.Y8G("ngIf",t.bMT(5,5,o.enableQuizRetake$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(7,7,o.quizLocked$))}}function aL(n,e){1&n&&(t.j41(0,"div",28),t.nrm(1,"app-spinner",29),t.k0s())}class fo{constructor(e,o,i,s){this.changeRef=e,this.quizService=o,this.quizPDFService=i,this.snackbar=s,this.questions=[],this.showSummaryEnabled=!1,this.showExplanationEnabled=!1,this.showExplanation=!1,this.loadingPDF=!1,this.ngUnsubscribe=new oe.B,this.pdfInputs=new zD.m(1)}ngOnInit(){this.initReviewListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.pdfInputs.complete()}initReviewListeners(){(0,Tt.z)([this.userFullName$,this.userEmail$,this.story$,this.questions$,this.submissions$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i,s,r])=>{this.questions=s,this.quizScore=Ly(s,r),this.pdfInputs.next([e,o,i,s,this.quizScore]),this.changeRef.markForCheck()}),this.quizSettings$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({showSummary:e,showExplanation:o})=>{this.showSummaryEnabled=!1!==e,this.showExplanationEnabled=!1!==o,this.changeRef.markForCheck()})}handleToggleSummaryClick(){this.showExplanation=!this.showExplanation}handleResultsClick(){this.loadingPDF=!0,this.pdfInputs.pipe((0,Vt.s)(1),(0,At.Z)(([e,o,i,s,r])=>this.quizPDFService.downloadResultsPDF(e,o,i.displayName.toUpperCase(),s,r)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.loadingPDF=!1,e||this.snackbar.open("Error opening the results PDF."),this.changeRef.markForCheck()})}handleRestartClick(){this.quizService.resetQuiz(),this.quizService.startQuiz()}handleExitClick(){this.quizService.exitQuiz()}}(Fc=fo).\u0275fac=function(e){return new(e||Fc)(t.rXU(t.gRc),t.rXU(Za),t.rXU(WD),t.rXU(ho.UG))},Fc.\u0275cmp=t.VBU({type:Fc,selectors:[["app-view-quiz-review"]],decls:4,vars:3,consts:()=>{let n,e,o,i,s,r;return n=$localize`:2bba53403aac78f4e44cdb7a38216c93a0a33ab71432800600767014651: You answered ${"\ufffd0\ufffd"}:INTERPOLATION: of ${"\ufffd1\ufffd"}:INTERPOLATION_1: questions correctly. `,e=$localize`:f57ccc4608c3db5d46b9ebd75467a841f5e7599e1835089687895717278:Download Results as PDF`,o=$localize`:1f4dec9e6be75af098a539e0eedf41f86f2c8c386268957596815378507:Hide Summary`,i=$localize`:96b2e76703c8dea4c7c173b97fff2a10f45c59073866918107243977386:Show Summary`,s=$localize`:bf6eb666b88af02c4793aba88435a71da36ba5d25529862952779485373: Take Again `,r=$localize`:19411ab6ff55d914e6f229a14e03ffc1127ffccf4002907482219878023: Exit Quiz `,[n,e,o,i,s,r,["data-test","quizReview",1,"review"],["class","review__container","data-test","quizDownload",4,"ngIf"],[4,"ngIf"],["class","review__loading mt-10",4,"ngIf"],["data-test","quizDownload",1,"review__container"],["data-test","quizSummary",1,"text-center"],["strokeWidth","12","diameter","96",3,"progress"],[1,"mt-5","mb-8","text-xs","font-semibold"],["class","w-full mb-3","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",3,"click",4,"ngIf"],["class","w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",3,"click",4,"ngIf"],["class","review__summary mt-3","data-test","quizExplanation",4,"ngIf"],["class","mt-8 w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",3,"click",4,"ngIf"],["class","mt-3 w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",1,"w-full","mb-3",3,"click"],["icon","download",1,"mr-1"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",1,"w-full",3,"click"],["data-test","quizExplanation",1,"review__summary","mt-3"],["class","my-6",4,"ngFor","ngForOf"],[1,"my-6"],[3,"question","questionNumber","answer","summary"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",1,"mt-8","w-full",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",1,"mt-3","w-full",3,"click"],[1,"review__loading","mt-10"],["size","huge","direction","vertical","label","Loading"]]},template:function(e,o){1&e&&(t.j41(0,"div",6),t.DNE(1,KD,5,3,"div",7)(2,rL,8,9,"ng-container",8)(3,aL,2,0,"div",9),t.k0s()),2&e&&(t.R7$(),t.Y8G("ngIf",o.showSummaryEnabled),t.R7$(),t.Y8G("ngIf",!o.loadingPDF),t.R7$(),t.Y8G("ngIf",o.loadingPDF))},dependencies:[b.Sq,b.bT,xt,qe,Jr,ff,Q1,b.Jj],styles:[".review[_ngcontent-%COMP%]{position:relative}.review__summary[_ngcontent-%COMP%]{background-color:#f9fafd;padding:4px 12px}"],changeDetection:0}),ps([(0,c.l6)(G.getAllQuestions),us("design:type",f.c)],fo.prototype,"questions$",void 0),ps([(0,c.l6)(G.getAllSubmissions),us("design:type",f.c)],fo.prototype,"submissions$",void 0),ps([(0,c.l6)(G.getQuizSettings),us("design:type",f.c)],fo.prototype,"quizSettings$",void 0),ps([(0,c.l6)(G.getQuizModeLocked),us("design:type",f.c)],fo.prototype,"quizLocked$",void 0),ps([(0,c.l6)(G.getEnableQuizRetake),us("design:type",f.c)],fo.prototype,"enableQuizRetake$",void 0),ps([(0,c.l6)(ne.getUserProfile),us("design:type",f.c)],fo.prototype,"userProfile$",void 0),ps([(0,c.l6)(ne.getUserFullName),us("design:type",f.c)],fo.prototype,"userFullName$",void 0),ps([(0,c.l6)(ne.getUserEmail),us("design:type",f.c)],fo.prototype,"userEmail$",void 0),ps([(0,c.l6)(Pe.getStory),us("design:type",f.c)],fo.prototype,"story$",void 0);var Bc,So=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},bo=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const lL=(n,e)=>({"view-quiz--column":n,"view-quiz--drawer":e});function cL(n,e){if(1&n&&(t.nrm(0,"app-view-quiz-question",12),t.nI1(1,"async")),2&n){const o=t.XpG(2);t.Y8G("question",t.bMT(1,1,o.question$))}}function _L(n,e){if(1&n&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&n){let o;const i=t.XpG(3);t.R7$(),t.SpI(" ",(null==(o=t.bMT(2,1,i.question$))?null:o.nextLabel)||i.defaultNextButtonNext," ")}}function dL(n,e){1&n&&(t.j41(0,"div",17),t.pXf(1,0),t.k0s())}function pL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",13),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSubmit())}),t.j41(1,"div",14),t.nI1(2,"async"),t.DNE(3,_L,3,3,"div",15)(4,dL,2,0,"div",16),t.k0s()()}if(2&n){let o;const i=t.XpG(2);t.Y8G("disabled",!i.form.valid),t.R7$(),t.Y8G("ngSwitch",null==(o=t.bMT(2,3,i.question$))?null:o.type),t.R7$(2),t.Y8G("ngSwitchCase",i.quizQuestionType.Instructions)}}function uL(n,e){if(1&n&&(t.j41(0,"div",8),t.DNE(1,cL,2,3,"app-view-quiz-question",9),t.nI1(2,"async"),t.j41(3,"div",10),t.DNE(4,pL,5,5,"button",11),t.nI1(5,"async"),t.nI1(6,"async"),t.k0s()()),2&n){let o;const i=t.XpG();t.Y8G("formGroup",i.form),t.R7$(),t.Y8G("ngIf",t.bMT(2,3,i.question$)),t.R7$(3),t.Y8G("ngIf",(null==(o=t.bMT(5,5,i.quizSettings$))?null:o.showSubmit)&&t.bMT(6,7,i.lifecycle$)===i.Lifecycle.Question)}}function gL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.nextQuestion())}),t.j41(1,"div",17),t.EFF(2),t.nI1(3,"async"),t.k0s()()}if(2&n){let o;const i=t.XpG(2);t.R7$(2),t.JRh((null==(o=t.bMT(3,1,i.question$))?null:o.nextLabel)||i.defaultNextButtonNext)}}function hL(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",24),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.handleViewSummaryClick())}),t.PLo(1,1),t.nrm(2,"div",17),t.YFu(),t.k0s()}}function mL(n,e){if(1&n&&(t.qex(0),t.DNE(1,hL,3,0,"button",23),t.nI1(2,"async"),t.bVm()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,1,o.quizReviewEnabled$))}}function fL(n,e){if(1&n&&(t.qex(0),t.j41(1,"div",18),t.nrm(2,"app-view-quiz-answer",19),t.nI1(3,"async"),t.nI1(4,"async"),t.k0s(),t.qex(5,14),t.nI1(6,"async"),t.j41(7,"div",10),t.DNE(8,gL,4,3,"button",20)(9,mL,3,3,"ng-container",21),t.k0s(),t.bVm()()),2&n){const o=t.XpG();t.R7$(2),t.Y8G("question",t.bMT(3,5,o.question$))("answer",t.bMT(4,7,o.submission$).answer)("summary",!1),t.R7$(3),t.Y8G("ngSwitch",t.bMT(6,9,o.hasQuestionsRemaining$)),t.R7$(3),t.Y8G("ngSwitchCase",!0)}}function SL(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-quiz-review"),t.bVm())}function bL(n,e){if(1&n&&(t.j41(0,"div",25),t.qex(1),t.pXf(2,2),t.nI1(3,"async"),t.bVm(),t.qex(4),t.pXf(5,3),t.bVm(),t.k0s()),2&n){let o;const i=t.XpG();t.R7$(3),t.uP7(null==(o=t.bMT(3,1,i.questions$))?null:o.length),t.nnv(2)}}class Vi{constructor(e,o,i,s,r,a){this.store=e,this.actions=o,this.formBuilder=i,this.viewService=s,this.applicationEventService=r,this.viewQuizService=a,this.defaultNextButtonNext=$localize`Next Question`,this.showHeader=!0,this.mode="column",this.Lifecycle=_o,this.quizQuestionType=ot,this.sceneConfigStash={},this.ngUnsubscribe=new oe.B}ngOnInit(){if(!this.store.selectSnapshot(G.getActiveQuestionId)){const e=this.store.selectSnapshot(G).questions[0].id;this.store.dispatch(new Te.SetActiveQuestion(e))}this.form=this.formBuilder.group({question:new K.hs("",this.getQuizValidation())}),this.initQuestionObserver(),this.initAnswerObserver(),this.initEngineInteractionObserver(),this.applicationEventService.fireEvent(Ce.QuizEntered,!0)}ngOnDestroy(){Object.entries(this.sceneConfigStash).forEach(([e,o])=>{this.store.dispatch(new mr(e,o.background))}),this.applicationEventService.fireEvent(Ce.QuizExited,!0),this.viewService.selectTool(Ct.Select),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}get answer(){const e=this.form.get("question").value;return Array.isArray(e)?e:[e]}initQuestionObserver(){this.question$.pipe((0,w.Q)(this.ngUnsubscribe),(0,X.p)(e=>void 0!==e)).subscribe(e=>{const o=this.store.selectSnapshot(E.getSelectedChapterId);e.chapterId!==o&&this.store.dispatch(new kl(e.chapterId)),this.form.reset(),this.setSceneConfig(e),e.type===ot.Instructions&&this.form.get("question").setValue("-"),this.applicationEventService.fireEvent(Ce.QuizQuestionLoaded,e)})}initAnswerObserver(){this.form.get("question").valueChanges.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.store.selectSnapshot(G.getActiveQuestion),i=this.store.selectSnapshot(G.getActiveSubmission);void 0!==o&&(this.store.selectSnapshot(G.getAllSubmissions).some(s=>s.questionId===o.id)||((!i||!(0,m.isEqual)(i.answer,e))&&this.store.dispatch(new Te.SetActiveSubmission({questionId:o.id,answer:e})),(0,m.isNil)(e)||this.applicationEventService.fireEvent(Ce.QuizAnswerSelected,{questionId:o.id,answerId:e})))})}initEngineInteractionObserver(){this.viewService.selectTool(Ct.Quiz),this.actions.pipe((0,c.xi)(ad),(0,X.p)(i=>{const{node:s,event:r}=i;return!(0,m.isNil)(s)&&this.store.selectSnapshot(U.getActiveTool)===Ct.Quiz&&!r.srcEvent.shiftKey})).pipe((0,X.p)(()=>"none"!==this.store.selectSnapshot(G.getPickMode)),(0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{"single"===this.store.selectSnapshot(G.getPickMode)&&this.viewService.clearSelectedNodes();const r=(0,m.get)(i,"hit.objectId");if(r){const l=this.store.selectSnapshot(Re.getCheckedNodeIds).includes(r);this.store.dispatch(new un(!l,[r]))}}),this.question$.pipe((0,Vn.F)((i,s)=>(0,m.get)(i,"id")===(0,m.get)(s,"id")),(0,X.p)(i=>!(0,m.isNil)(i))).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>this.setQuestionPickMode(i))}setQuestionPickMode(e){const{type:o,data:i}=e;let s;s=o===ot.SelectAnatomy?i.correctAnswer.length>1&&"any"!==i.selectType?"multi":"single":"none",this.store.dispatch(new Te.SetQuizPickMode(s))}handleSubmit(){const e=this.store.selectSnapshot(G.getActiveQuestion);(this.form.valid||e.type===ot.Instructions)&&this.viewQuizService.submitQuestion(e.id,this.answer)}handleViewSummaryClick(){this.viewSummary()}handleExitClick(){this.viewQuizService.exitQuiz()}nextQuestion(){this.viewQuizService.nextQuestion()}viewSummary(){this.store.dispatch(new Te.SetQuizLifecycle(_o.Review)),this.applicationEventService.fireEvent(Ce.QuizCompleted,!0)}setSceneConfig(e){const{camera:o,background:i}=e?.sceneConfig||{},s=this.store.selectSnapshot(E.getChapter(e.chapterId));o&&(this.setStash(e.chapterId,{camera:s.camera.location}),setTimeout(()=>{this.store.dispatch(new di(o.location,!0,1))})),i&&(this.setStash(e.chapterId,{background:s.background}),this.store.dispatch(new mr(e.chapterId,i)))}setStash(e,o){this.sceneConfigStash[e]={...this.sceneConfigStash[e]||{},...o}}getQuizValidation(){return e=>{const o=e.value,i=Array.isArray(o)?o:[o],r=function eM(n){switch((0,m.get)(n,"type","")){case ot.MultipleChoice:const o=(0,m.get)(n,"data.correctAnswer","");return o&&""!==o;case ot.SelectAnatomy:case ot.LabelAnatomy:return(0,m.get)(n,"data.correctAnswer",[]).length>0;default:return!0}}(this.store.selectSnapshot(G.getActiveQuestion)),a=i.some(l=>(0,m.isNil)(l)||""===l);return r&&a?{invalidValues:a}:null}}}(Bc=Vi).\u0275fac=function(e){return new(e||Bc)(t.rXU(c.il),t.rXU(c.En),t.rXU(K.ze),t.rXU(zt),t.rXU(mo),t.rXU(Za))},Bc.\u0275cmp=t.VBU({type:Bc,selectors:[["app-view-quiz"]],inputs:{showHeader:"showHeader",mode:"mode"},decls:12,vars:22,consts:()=>{let n,e,o,i;return n=$localize`:71c77bb8cecdf11ec3eead24dd1ba506573fa9cd935187492052582731:Submit`,e=$localize`:19c0d80cbbbe6ab7d75dbe7c77ef3017ec5f4d967886851004377486562:${"\ufffd#2\ufffd"}:START_TAG_DIV:See Results${"\ufffd/#2\ufffd"}:CLOSE_TAG_DIV:`,o=$localize`:6649c9f6c298747891fb175dbe382be60e1728c66638623222432926474:{VAR_PLURAL, plural, =1 {Answer} other {Answers}}`,o=t.k04(o,{VAR_PLURAL:"\ufffd0\ufffd"}),i=$localize`:ceb65fed78c2ea1d81ce1514a244608fdc02bfca1766523863374888036:submitted`,[n,e,o,i,["data-test","quiz",1,"view-quiz",3,"ngClass"],["role","form","class","flex flex-col",3,"formGroup",4,"ngIf"],[4,"ngIf"],["class","text-base font-bold text-center",4,"ngIf"],["role","form",1,"flex","flex-col",3,"formGroup"],["formControlName","question",3,"question",4,"ngIf"],[1,"flex","flex-row-reverse"],["app-view-button","","class","view-quiz__button","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",3,"disabled","click",4,"ngIf"],["formControlName","question",3,"question"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",1,"view-quiz__button",3,"click","disabled"],[3,"ngSwitch"],["class","px-4",4,"ngSwitchCase"],["class","px-4",4,"ngSwitchDefault"],[1,"px-4"],[1,"mb-8"],[3,"question","answer","summary"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button","data-test","questionNextButton",3,"click",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionNextButton",1,"view-quiz__button",3,"click"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button",3,"click",4,"ngIf"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded",1,"view-quiz__button",3,"click"],[1,"text-base","font-bold","text-center"]]},template:function(e,o){if(1&e&&(t.j41(0,"div",4),t.DNE(1,uL,7,9,"div",5),t.nI1(2,"async"),t.DNE(3,fL,10,11,"ng-container",6),t.nI1(4,"async"),t.DNE(5,SL,2,0,"ng-container",6),t.nI1(6,"async"),t.nI1(7,"async"),t.DNE(8,bL,6,3,"div",7),t.nI1(9,"async"),t.nI1(10,"async"),t.nI1(11,"async"),t.k0s()),2&e){let i;t.Y8G("ngClass",t.l_i(19,lL,"column"===o.mode,"drawer"===o.mode)),t.R7$(),t.Y8G("ngIf",t.bMT(2,5,o.lifecycle$)===o.Lifecycle.Question),t.R7$(2),t.Y8G("ngIf",t.bMT(4,7,o.lifecycle$)===o.Lifecycle.Explanation),t.R7$(2),t.Y8G("ngIf",t.bMT(6,9,o.lifecycle$)===o.Lifecycle.Review&&t.bMT(7,11,o.quizReviewEnabled$)),t.R7$(3),t.Y8G("ngIf",!(t.bMT(9,13,o.hasQuestionsRemaining$)||t.bMT(10,15,o.quizReviewEnabled$)||null!=(i=t.bMT(11,17,o.quizSettings$))&&i.showExplanation))}},dependencies:[b.YU,b.bT,b.ux,b.e1,b.fG,xt,K.BC,K.cb,K.j4,K.JD,Gp,Q1,fo,b.Jj],styles:[".view-quiz[_ngcontent-%COMP%]{color:#374a68}.view-quiz__button[_ngcontent-%COMP%]:disabled{opacity:.5}.view-quiz--column[_ngcontent-%COMP%]   .view-quiz__button[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),So([(0,c.l6)(G.getQuizReviewEnabled),bo("design:type",f.c)],Vi.prototype,"quizReviewEnabled$",void 0),So([(0,c.l6)(G.getActiveQuestion),bo("design:type",f.c)],Vi.prototype,"question$",void 0),So([(0,c.l6)(G.getAllQuestions),bo("design:type",f.c)],Vi.prototype,"questions$",void 0),So([(0,c.l6)(G.getActiveQuestionIndex),bo("design:type",f.c)],Vi.prototype,"questionIndex$",void 0),So([(0,c.l6)(G.getQuestionTotal),bo("design:type",f.c)],Vi.prototype,"questionTotal$",void 0),So([(0,c.l6)(G.getCorrectAnswerTotal),bo("design:type",f.c)],Vi.prototype,"correctAnswerTotal$",void 0),So([(0,c.l6)(G.hasQuestionRemaining),bo("design:type",f.c)],Vi.prototype,"hasQuestionsRemaining$",void 0),So([(0,c.l6)(G.getQuizSettings),bo("design:type",f.c)],Vi.prototype,"quizSettings$",void 0),So([(0,c.l6)(G.getLifecycle),bo("design:type",f.c)],Vi.prototype,"lifecycle$",void 0),So([(0,c.l6)(G.getQuizModeLocked),bo("design:type",f.c)],Vi.prototype,"quizLocked$",void 0),So([(0,c.l6)(G.getActiveSubmission),bo("design:type",f.c)],Vi.prototype,"submission$",void 0);const yL=(n,e,o,i)=>({"badge--blue":n,"badge--green":e,"badge--inline":o,"badge--block":i});function vL(n,e){if(1&n&&(t.j41(0,"div",1),t.nrm(1,"app-icon",3),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("icon",o.icon())}}function EL(n,e){if(1&n&&(t.j41(0,"div",2),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.JRh(o.label())}}let TL=(()=>{var n;class e{constructor(){this.display=(0,t.hFB)("inline"),this.theme=(0,t.hFB)("none"),this.icon=(0,t.hFB)(""),this.label=(0,t.hFB)("")}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-badge"]],inputs:{display:[t.Mj6.SignalBased,"display"],theme:[t.Mj6.SignalBased,"theme"],icon:[t.Mj6.SignalBased,"icon"],label:[t.Mj6.SignalBased,"label"]},standalone:!0,features:[t.aNF],decls:3,vars:8,consts:[[1,"badge","flex","items-center",3,"ngClass"],[1,"badge__check"],[1,"badge__label"],[3,"icon"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,vL,2,1,"div",1)(2,EL,2,1,"div",2),t.k0s()),2&i&&(t.Y8G("ngClass",t.ziG(3,yL,"blue"===s.theme(),"green"===s.theme(),"inline"===s.display(),"block"===s.display())),t.R7$(),t.vxM(1,s.icon()?1:-1),t.R7$(),t.vxM(2,s.label()?2:-1))},dependencies:[b.MD,b.YU,Ui.o,qe],styles:[".badge{gap:8px;padding:4px 8px 4px 4px;border-radius:12px}.badge__check{display:flex;align-items:center;justify-content:center;border-radius:100%;width:14px;height:14px;font-size:.625rem;line-height:.75rem}.badge__label{font-size:.75rem;line-height:1rem;font-weight:500}.badge--inline{display:inline-flex}.badge--block{display:flex}.badge--blue{background-color:#a6dfff66;color:#1c5ab9}.badge--blue .badge__check{background-color:#2d72dc;color:#fff}.badge--green{background-color:#c1efdf66;color:#095922}.badge--green .badge__check{background-color:#138032;color:#fff}\n"],encapsulation:2,changeDetection:0}),e})();function CL(n,e){if(1&n&&(t.j41(0,"li",2)(1,"div",3),t.EFF(2),t.k0s(),t.j41(3,"div",4),t.nrm(4,"app-html",5),t.k0s()()),2&n){const o=e.$implicit,i=e.$index;t.R7$(2),t.SpI("",i+1,"."),t.R7$(2),t.Y8G("markdownText",o.label)}}let OL=(()=>{var n;class e{constructor(){this.references=t.hFB.required()}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-references"]],inputs:{references:[t.Mj6.SignalBased,"references"]},standalone:!0,features:[t.aNF],decls:4,vars:0,consts:[["data-test","view-references",1,"view-references"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-row","text-xs","gap-1"],[1,"text-xs","text-right",2,"flex","0 0 20px"],[1,"flex-auto","w-full"],[3,"markdownText"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"ol",1),t.Z7z(2,CL,5,2,"li",2,t.fX1),t.k0s()()),2&i&&(t.R7$(2),t.Dyx(s.references()))},dependencies:[Ws],styles:[".view-references{color:#374a68}\n"],encapsulation:2,changeDetection:0}),e})();function wL(n,e){1&n&&t.nrm(0,"app-badge",9)}function ML(n,e){if(1&n&&(t.j41(0,"div")(1,"span",12),t.pXf(2,0),t.k0s(),t.j41(3,"time"),t.EFF(4),t.k0s()()),2&n){const o=t.XpG(2);t.R7$(3),t.BMQ("datetime",o.updateDateTime()),t.R7$(),t.JRh(o.updateDateText())}}function IL(n,e){if(1&n&&(t.j41(0,"a",11)(1,"span",13),t.pXf(2,1),t.k0s(),t.nrm(3,"app-icon",14),t.k0s()),2&n){const o=t.XpG(2);t.BMQ("href",o.sourceInfo().reviewed.url,t.B4B)}}function AL(n,e){if(1&n&&(t.j41(0,"div")(1,"em",12),t.pXf(2,2),t.k0s(),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.SpI(" ",o.sourceInfo().collaborated.authors," ")}}function PL(n,e){if(1&n&&(t.j41(0,"div",8),t.nrm(1,"app-badge",15),t.DNE(2,AL,4,1,"div"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(2),t.vxM(2,o.sourceInfo().collaborated.authors?2:-1)}}function NL(n,e){if(1&n&&(t.j41(0,"div",7)(1,"div",8),t.DNE(2,wL,1,0,"app-badge",9),t.j41(3,"div",10),t.DNE(4,ML,5,2,"div")(5,IL,4,1,"a",11),t.k0s()(),t.DNE(6,PL,3,1,"div",8),t.k0s()),2&n){let o,i,s,r;const a=t.XpG();t.R7$(2),t.vxM(2,null!=(o=a.sourceInfo().reviewed)&&o.enabled?2:-1),t.R7$(2),t.vxM(4,null!=(i=a.sourceInfo().audit)&&i.enabled&&a.updateDate()?4:-1),t.R7$(),t.vxM(5,null!=(s=a.sourceInfo().reviewed)&&s.url?5:-1),t.R7$(),t.vxM(6,null!=(r=a.sourceInfo().collaborated)&&r.enabled?6:-1)}}function RL(n,e){if(1&n&&(t.j41(0,"div",20),t.nrm(1,"app-view-references",21),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.Y8G("references",o.references())}}function kL(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",8)(1,"button",16),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleToggleReferences(!s.referencesExpanded()))}),t.j41(2,"div",17)(3,"div"),t.pXf(4,3),t.k0s(),t.j41(5,"div",18),t.nrm(6,"app-icon",19),t.k0s()()(),t.DNE(7,RL,2,1,"div",20),t.k0s()}if(2&n){const o=t.XpG(2);t.R7$(),t.Y8G("thin",!0),t.BMQ("aria-controls","view-source-info-references")("aria-expanded",o.referencesExpanded()),t.R7$(5),t.Y8G("icon",o.referencesExpanded()?"angle-down":"angle-up"),t.R7$(),t.vxM(7,o.referencesExpanded()?7:-1)}}function DL(n,e){if(1&n&&(t.j41(0,"div")(1,"em",12),t.pXf(2,4),t.k0s(),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.SpI(" ",o.updateDateText(),"")}}function LL(n,e){if(1&n&&(t.j41(0,"div",7),t.nrm(1,"app-view-references",21),t.DNE(2,DL,4,1,"div"),t.k0s()),2&n){let o;const i=t.XpG(2);t.R7$(),t.Y8G("references",i.references()),t.R7$(),t.vxM(2,null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDateText()?2:-1)}}function UL(n,e){if(1&n&&t.DNE(0,kL,8,5,"div",8)(1,LL,3,2),2&n){const o=t.XpG();t.vxM(0,o.displaySources()?0:1)}}function VL(n,e){if(1&n&&(t.j41(0,"div")(1,"em",12),t.pXf(2,5),t.k0s(),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.SpI(" ",o.updateDateText(),"")}}function jL(n,e){if(1&n&&t.DNE(0,VL,4,1,"div"),2&n){let o;const i=t.XpG(2);t.vxM(0,null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDateText()?0:-1)}}function xL(n,e){if(1&n&&t.DNE(0,jL,1,1),2&n){const o=t.XpG();t.vxM(0,o.displaySources()?-1:0)}}let Sf=(()=>{var n;class e{constructor(){this.sourceInfo=t.hFB.required(),this.showSources=t.hFB.required(),this.referencesExpanded=(0,t.vPA)(!0),this.updateDate=t.hFB.required(),this.updateDateTime=(0,t.EWP)(()=>{const i=this.updateDate();return i?new Date(i).toISOString():void 0}),this.updateDateText=(0,t.EWP)(()=>{const i=this.updateDate();return i?new Date(i).toLocaleDateString():void 0}),this.displaySources=(0,t.EWP)(()=>{const i=this.sourceInfo();return this.showSources()&&i?.reviewed?.enabled||i?.collaborated?.enabled}),this.displayReferences=(0,t.EWP)(()=>this.references().length>0),this.references=(0,t.EWP)(()=>this.sourceInfo()?.references??[])}handleToggleReferences(i){this.referencesExpanded.set(i)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-source-info"]],inputs:{sourceInfo:[t.Mj6.SignalBased,"sourceInfo"],showSources:[t.Mj6.SignalBased,"showSources"],updateDate:[t.Mj6.SignalBased,"updateDate"]},standalone:!0,features:[t.aNF],decls:4,vars:2,consts:()=>{let o,i,s,r,a,l,_,d,p;return o=$localize`:8130925c3a61817eae8b407d5bbcdaaba8758d15429607993299883476:Medically Reviewed`,i=$localize`:c0036f237054be68e8a0cc165f3b71b2f874cbf163496578423295101:Updated on `,s=$localize`:73a9036408e67ed406a1e65fc9f406430aeee9b9872668326289090686:Read more about our review process.`,r=$localize`:d5b8a08bdd48b443f541a8477c756faa70d686d5214207563889300286:Built in Collaboration`,a=$localize`:525d654f08c7e65835ec2836814a49aa1ba604f34382887906654551268:Created with`,l=$localize`:08a477f24153062f37f2c019c1c1bada6a4ce1f35292179368358684504:Toggle References`,_=$localize`:0dc2e6fb6d0244d5024e73ede409a45d5b0c8a64449712922219700420:References`,d=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,p=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,[i,s,a,_,d,p,[1,"view-source-info","flex","flex-col","gap-6","text-xs"],[1,"flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["theme","blue","icon","check","label",o],[1,"flex","flex-col","gap-1"],["target","_blank","rel","noreferrer nofollow",1,"text-link"],[1,"font-bold"],[1,"text-underline"],["icon","arrow-up-right-from-square",1,"ml-1"],["theme","green","icon","check","label",r],["app-view-button","","buttonSize","small","aria-label",l,3,"click","thin"],[1,"view-source-info__toggle","flex","flex-row","items-center","font-bold"],[1,"ml-2"],[3,"icon"],["id","view-source-info-references"],[3,"references"]]},template:function(i,s){1&i&&(t.j41(0,"div",6),t.DNE(1,NL,7,4,"div",7)(2,UL,2,1)(3,xL,1,1),t.k0s()),2&i&&(t.R7$(),t.vxM(1,s.displaySources()?1:-1),t.R7$(),t.vxM(2,s.displayReferences()?2:3))},dependencies:[Yi.C,xt,Ui.o,qe,TL,OL],styles:[".view-source-info{color:#131c2a}.view-source-info__toggle{color:#131c2a;font-size:.75rem;line-height:1rem}\n"],encapsulation:2,changeDetection:0}),e})();var zc=S(3845);const GL=n=>({"view-chapter-tag--no-index":n});function $L(n,e){if(1&n&&(t.j41(0,"div",6),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI("",o.index,".")}}function FL(n,e){if(1&n&&(t.qex(0),t.EFF(1),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.JRh(o.chapter.displayName)}}function BL(n,e){if(1&n&&(t.qex(0),t.pXf(1,0),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.uP7(o.index+1),t.nnv(1)}}let zL=(()=>{var n;class e{constructor(i){this.store=i,this.index=null,this.showIndex=!0,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png"}ngOnInit(){}getChapterThumb(i){const r=this.store.selectSnapshot(oi.getRegisteredThumbnails).get(i);return r?r.snapshot||r.urls.small:""}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-chapter-tag"]],inputs:{chapter:"chapter",index:"index",showIndex:"showIndex",defaultImage:"defaultImage"},decls:6,vars:8,consts:()=>{let o;return o=$localize`:02e35838e3eb256d2b051997839facd9eaf88a026065571608381107982:Chapter ${"\ufffd0\ufffd"}:INTERPOLATION:`,[o,[1,"view-chapter-tag",3,"ngClass"],[1,"view-chapter-tag__thumb",3,"defaultImage","lazyLoad"],["class","view-chapter-tag__index",4,"ngIf"],[1,"view-chapter-tag__title"],[4,"ngIf"],[1,"view-chapter-tag__index"]]},template:function(i,s){1&i&&(t.j41(0,"div",1),t.nrm(1,"div",2),t.DNE(2,$L,2,1,"div",3),t.j41(3,"div",4),t.DNE(4,FL,2,1,"ng-container",5)(5,BL,2,1,"ng-container",5),t.k0s()()),2&i&&(t.Y8G("ngClass",t.eq3(6,GL,null===s.index)),t.R7$(),t.Y8G("defaultImage",s.defaultImage)("lazyLoad",s.getChapterThumb(s.chapter.id)),t.R7$(),t.Y8G("ngIf",null!==s.index&&s.showIndex),t.R7$(2),t.Y8G("ngIf",s.chapter.displayName),t.R7$(),t.Y8G("ngIf",!s.chapter.displayName))},dependencies:[b.YU,b.bT,zc.Je],styles:['[_nghost-%COMP%]{width:100%}.view-chapter-tag[_ngcontent-%COMP%]{color:#131c2a;display:grid;gap:8px;grid-template-areas:"index title thumb";grid-template-columns:20px 1fr 56px;transition:background-color 125ms,color 125ms,border 125ms;text-align:start;padding:12px;font-size:.875rem;line-height:1.25rem}.view-chapter-tag--selected[_ngcontent-%COMP%]{border-color:#2d72dc}.view-chapter-tag--no-index[_ngcontent-%COMP%]{grid-template-areas:"title thumb";grid-template-columns:1fr 56px}.view-chapter-tag__index[_ngcontent-%COMP%]{grid-area:index;display:flex;justify-content:center}.view-chapter-tag__thumb[_ngcontent-%COMP%]{grid-area:thumb;background-size:cover;background-color:#f9fafd;border-radius:4px;background-repeat:no-repeat;border:1px solid #eaeff5;height:56px;width:56px;transition:border-color .1s}.view-chapter-tag__title[_ngcontent-%COMP%]{overflow-wrap:break-word;grid-area:title;word-break:break-word;white-space:normal;font-weight:400}'],changeDetection:0}),e})();var Wc,$p=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Fp=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const WL=(n,e,o,i)=>({"view-chapter-list__progress--activated":n,"view-chapter-list__progress--complete":e,"view-chapter-list__progress--last":o,"view-chapter-list__progress--first":i}),XL=n=>({"view-chapter-list__count--complete":n});function HL(n,e){if(1&n){const o=t.RV6();t.j41(0,"li")(1,"button",4),t.nI1(2,"async"),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.handleChapterClick(s))}),t.j41(3,"div",5)(4,"div",6),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.j41(8,"app-progress-circle",7),t.nI1(9,"async"),t.nI1(10,"async"),t.j41(11,"span",8),t.nI1(12,"async"),t.EFF(13),t.k0s()()(),t.nrm(14,"app-view-chapter-tag",9),t.k0s()()()}if(2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.R7$(),t.BMQ("aria-current",t.bMT(2,12,s.selectedChapterIndex$)===i),t.R7$(3),t.Y8G("ngClass",t.ziG(26,WL,i<=t.bMT(5,14,s.selectedChapterIndex$),i<t.bMT(6,16,s.selectedChapterIndex$),i+1===t.bMT(7,18,s.chapterCount$),0===i)),t.R7$(4),t.Y8G("progress",t.bMT(9,20,s.chapterProgress)[i])("showPercent",!1)("diameter",28)("strokeWidth",3)("fillOnComplete",i<t.bMT(10,22,s.selectedChapterIndex$)),t.R7$(3),t.Y8G("ngClass",t.eq3(31,XL,i<t.bMT(12,24,s.selectedChapterIndex$))),t.R7$(2),t.JRh(i+1),t.R7$(),t.Y8G("chapter",o)("index",i)("showIndex",!1)}}class ul{constructor(e,o){this.viewService=e,this.store=o,this.progressMode="fixed",this.chapterProgress=new He.t([]),this.percent=0,this.ngUnsubscribe=new oe.B}ngOnInit(){const e=this.store.selectSnapshot(E.getChapterCount);this.chapterProgress.next([...new Array(e)].fill(0)),this.initChapterListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterClick(e){this.viewService.selectChapter(e)}getProgress(e){return e<=this.store.selectSnapshot(E.getSelectedChapterIndex)?100:0}initChapterListener(){this.selectedChapterId$.pipe((0,X.p)(e=>null!=e),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(E.getSelectedChapterIndex),o=this.chapterProgress.getValue();o.fill(100,0,e),"fixed"===this.progressMode&&(o[e]=100),o.fill(0,e+1,o.length)})}}(Wc=ul).\u0275fac=function(e){return new(e||Wc)(t.rXU(zt),t.rXU(c.il))},Wc.\u0275cmp=t.VBU({type:Wc,selectors:[["app-view-chapter-list"]],inputs:{progressMode:"progressMode"},decls:5,vars:3,consts:()=>{let n;return n=$localize`:2be2e0ec21a9620412d9a21102e7645fce9d9cc15659091765954160016:List of Chapters`,[["role","tabpanel","aria-labelledby","chaptersTab","id","chapterPanel","tabindex","0"],["aria-label",n,"data-test","viewChapterList"],[1,"view-chapter-list"],[4,"ngFor","ngForOf"],["app-view-button","",1,"w-full",3,"click"],[1,"view-chapter-list__item"],[1,"view-chapter-list__progress",3,"ngClass"],[1,"view-chapter-list__circle",3,"progress","showPercent","diameter","strokeWidth","fillOnComplete"],[1,"view-chapter-list__count",3,"ngClass"],[1,"view-chapter-list__tag",3,"chapter","index","showIndex"]]},template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"nav",1)(2,"ol",2),t.DNE(3,HL,15,33,"li",3),t.nI1(4,"async"),t.k0s()()()),2&e&&(t.R7$(3),t.Y8G("ngForOf",t.bMT(4,1,o.chapters$)))},dependencies:[xt,b.YU,b.Sq,ff,zL,b.Jj],styles:['.view-chapter-list[_ngcontent-%COMP%]{--progress-offset: 8px;--progress-size: 28px}.view-chapter-list__item[_ngcontent-%COMP%]{display:flex;position:relative;width:100%}.view-chapter-list__tag[_ngcontent-%COMP%]{flex-grow:1}.view-chapter-list__circle[_ngcontent-%COMP%]{position:absolute;top:var(--progress-offset);z-index:1}.view-chapter-list__count[_ngcontent-%COMP%]{color:#374a68;font-weight:600;font-size:10px}.view-chapter-list__count--complete[_ngcontent-%COMP%]{color:#fff}.view-chapter-list__progress[_ngcontent-%COMP%]{position:relative;display:flex;flex:0 0 var(--progress-size)}.view-chapter-list__progress[_ngcontent-%COMP%]:not(.view-chapter-list__progress--first):before{content:" ";display:block;background:#d7e0ea;width:3px;height:100%;left:calc(50% - 1.5px);position:absolute;z-index:0;top:0;height:calc(var(--progress-offset) + 1px)}.view-chapter-list__progress[_ngcontent-%COMP%]:not(.view-chapter-list__progress--last):after{content:" ";display:block;background:#d7e0ea;width:3px;height:100%;left:calc(50% - 1.5px);position:absolute;z-index:0;top:calc(var(--progress-offset) + var(--progress-size) - 2px);bottom:0}.view-chapter-list__progress--activated[_ngcontent-%COMP%]:before{background-color:#2d72dc!important}.view-chapter-list__progress--complete[_ngcontent-%COMP%]:after{background-color:#2d72dc!important}'],changeDetection:0}),$p([(0,c.l6)(E.getStoryChapters),Fp("design:type",f.c)],ul.prototype,"chapters$",void 0),$p([(0,c.l6)(E.getChapterCount),Fp("design:type",f.c)],ul.prototype,"chapterCount$",void 0),$p([(0,c.l6)(E.getSelectedChapterIndex),Fp("design:type",f.c)],ul.prototype,"selectedChapterIndex$",void 0),$p([(0,c.l6)(E.getSelectedChapterId),Fp("design:type",f.c)],ul.prototype,"selectedChapterId$",void 0);let QL=(()=>{var n;class e{constructor(i,s,r,a,l){this.store=i,this.cameraService=s,this.snapshotService=r,this.imagesService=a,this.contentBlocksService=l,this.startingPositionClipboard=null,this.additionalPositionClipboard=null,this.additionalPositionsClipboard=null}getCamera(){const i=this.cameraService.getCamera(),s=i.look,r=this.cameraService.getCameraRotationCenter();let a;return this.cameraService.compareXYZ(s,r)||(a=r),{location:i,rotationCenter:a}}getChapterStartingPosition(i){return{camera:this.store.selectSnapshot(E.getChapter(i)).camera,thumbnail:this.store.selectSnapshot(oi.getRegisteredThumbnails).get(i)}}startingPositionToAdditionalPosition(i){const{camera:s,thumbnail:r}=this.getChapterStartingPosition(i),{location:a,rotationCenter:l,title:_}=s;return{camera:{location:a,rotationCenter:l,action:La.FlyTo},thumbnail:r,title:_}}copyStartingPosition(i){let s=!1;const{camera:r,thumbnail:a}=this.getChapterStartingPosition(i);return r&&a&&(this.startingPositionClipboard=(0,m.cloneDeep)({camera:r,thumbnail:a}),s=!0),s}pasteStartingPosition(i=!1){let s=0;if(this.startingPositionClipboard){const{camera:r,thumbnail:a}=this.startingPositionClipboard,l=i?this.store.selectSnapshot(E.getStoryChapters):[this.store.selectSnapshot(E.getSelectedChapter)];l.forEach(_=>{this.store.dispatch(new Td(_.id,r.location,r.rotationCenter)),this.store.dispatch(new Mg(_.id,r.title)),this.store.dispatch(new Wg(_.id,a))}),this.store.dispatch(new di(r.location)),s=l.length}return this.clearStartingPosition(),s}clearStartingPosition(){this.startingPositionClipboard=null}copyAdditionalPosition(i){this.additionalPositionClipboard=(0,m.cloneDeep)(i)}clearAdditionalPosition(){this.additionalPositionClipboard=null}copyAdditionalPositions(i){this.additionalPositionsClipboard=(0,m.cloneDeep)(i)}pasteAdditionalPositions(i=!1){let s=0;if(this.additionalPositionsClipboard){const r=i?this.store.selectSnapshot(E.getStoryChapters):[this.store.selectSnapshot(E.getSelectedChapter)];r.forEach(a=>{let l=this.contentBlocksService.findContentBlockByType(a.contentBlocks,Fn.Positions);l||(l=new vR,a.contentBlocks.push(l)),l.positions.push(...this.additionalPositionsClipboard),this.store.dispatch(new Rg(a.id,[...a.contentBlocks],!1))}),s=r.length}return this.clearAdditionalPositions(),s}clearAdditionalPositions(){this.additionalPositionsClipboard=null}clearAllClipboards(){this.clearStartingPosition(),this.clearAdditionalPosition(),this.clearAdditionalPositions()}captureStartingPositionCamera(i){const s=this.getCamera();this.store.dispatch(new Td(i,s.location,s.rotationCenter))}captureStartingPositionThumbnail(i){const{background:s,imageType:r,imageQuality:a,dimensions:l,crop:_,includeLabels:d,includeCopyright:p,layers:u}=this.getThumbnailSettings();this.store.dispatch(new Cr(i,s,r,a,l,_,d,p,u))}captureAdditionalPositionThumbnail(){var i=this;return(0,J.A)(function*(){const{background:s,imageType:r,imageQuality:a,dimensions:l,crop:_,includeLabels:d,includeCopyright:p,layers:u}=i.getThumbnailSettings(),g={...xy,crop:_,imageType:r,imageQuality:a,copyrightEnabled:p},y=yield(0,Xo._)(i.snapshotService.takeSnapshot(l.width,l.height,s,u,d,g)),C=yield(0,Xo._)(i.imagesService.saveImageBlob(y));return{small:C.uris.small,large:C.uris.large}})()}getThumbnailSettings(){return{background:this.store.selectSnapshot(E.getSelectedChapterBackground),imageType:Gi.JPEG,imageQuality:92,dimensions:Yg.medium,crop:"square",includeLabels:!1,includeCopyright:!1,layers:[]}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(Pi),t.KVO(Kg),t.KVO(up),t.KVO(Ar))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function YL(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"button",5),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handlePlayFromBeginning())}),t.nrm(2,"app-icon",6),t.j41(3,"span",7),t.pXf(4,1),t.k0s()(),t.nrm(5,"app-view-audio-mute",8),t.bVm()}}function qL(n,e){1&n&&(t.j41(0,"button",9)(1,"div",10),t.nrm(2,"app-spinner",11),t.j41(3,"span",7),t.pXf(4,2),t.k0s()()()),2&n&&t.Y8G("disabled",!0)}let KL=(()=>{var n;class e{constructor(i,s,r,a){this.viewService=i,this.mediaService=s,this.store=r,this.changeDetectorRef=a,this.hasAudioPlayer=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initChapterPlayer()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterPlayer(){this.store.select(E.getSelectedChapter).pipe((0,qo.M)(()=>{this.hasAudioPlayer=!1,this.changeDetectorRef.markForCheck()}),(0,go.n)(i=>{const s=this.store.selectSnapshot(P.getViewLanguage),r=this.store.selectSnapshot(P.getForceAudio);return this.mediaService.getChapterAudioPlayer(i,s,r)}),(0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.hasAudioPlayer=!(0,m.isNil)(i),this.changeDetectorRef.markForCheck()})}handlePlayFromBeginning(){const i=this.store.selectSnapshot(E.getSelectedChapterId);this.mediaService.playChapterAudio(i),this.viewService.playChapterFromStart()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(zt),t.rXU(Di),t.rXU(c.il),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-audio-bar"]],decls:4,vars:2,consts:()=>{let o,i,s;return o=$localize`:5006279573e513c000899122cbef8e588b25faae2965090484617938475:play from beginning`,i=$localize`:81e8d1fd604d4f4e83ad3300e500ae3b35aa4be71494613406887362546:Play From Beginning`,s=$localize`:65026328a38cc4b6451777987b5dee29a779a10f3235113974618934655:Loading Audio`,[["loading",""],i,s,[1,"view-audio-bar"],[4,"ngIf","ngIfElse"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline","aria-label",o,"data-test","viewPlayFromBeginning",1,"view-audio-bar__play",3,"click"],["icon","rotate-left","aria-hidden","true"],[1,"ml-2","uppercase","text-2xs"],["buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"view-audio-bar__play",3,"disabled"],[1,"flex","justify-center","items-center"],["spinnerSize","small"]]},template:function(i,s){if(1&i&&(t.j41(0,"div",3),t.DNE(1,YL,6,0,"ng-container",4)(2,qL,5,1,"ng-template",null,0,t.C5r),t.k0s()),2&i){const r=t.sdS(3);t.R7$(),t.Y8G("ngIf",s.hasAudioPlayer)("ngIfElse",r)}},dependencies:[b.bT,xt,qe,Jr,Vp],styles:[".view-audio-bar[_ngcontent-%COMP%]{display:flex;gap:12px}.view-audio-bar__play[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0}),e})();var Xc,Y1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},q1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function JL(n,e){if(1&n&&(t.j41(0,"section",1),t.nrm(1,"app-html",2),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("markdownText",o.chapterDescription)}}class Bp{get isPopulated(){return this._isPopulated}set isPopulated(e){this._isPopulated=e,this.isPopulatedChange.emit(this.isPopulated)}constructor(){this.ngUnsubscribe=new oe.B,this.chapterDescription="",this._isPopulated=!1,this.isPopulatedChange=new t.bkB}ngOnInit(){this.initContentListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initContentListener(){(0,Tt.z)(this.story$,this.chapter$).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)&&!(0,m.isNil)(o)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{this.chapterDescription=(0,m.trim)(o.description),this.isPopulated=""!==this.chapterDescription})}}(Xc=Bp).\u0275fac=function(e){return new(e||Xc)},Xc.\u0275cmp=t.VBU({type:Xc,selectors:[["app-view-description"]],inputs:{isPopulated:"isPopulated"},outputs:{isPopulatedChange:"isPopulatedChange"},decls:1,vars:1,consts:[["class","view-description",4,"ngIf"],[1,"view-description"],[3,"markdownText"]],template:function(e,o){1&e&&t.DNE(0,JL,2,1,"section",0),2&e&&t.Y8G("ngIf",o.chapterDescription)},dependencies:[b.bT,Ws],styles:[".view-description{font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word;color:#374a68}\n"],encapsulation:2,changeDetection:0}),Y1([(0,c.l6)(Pe.getStory),q1("design:type",f.c)],Bp.prototype,"story$",void 0),Y1([(0,c.l6)(E.getSelectedChapter),q1("design:type",f.c)],Bp.prototype,"chapter$",void 0);var Hc,K1=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},J1=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const ZL=n=>({"view-labels__item--selected":n}),eU=n=>({"view-labels__content--shown":n});function tU(n,e){if(1&n&&(t.j41(0,"div",11),t.nrm(1,"div",12),t.nI1(2,"markdown"),t.nI1(3,"async"),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.Y8G("innerHTML",t.bMT(3,3,t.bMT(2,1,o.title)),t.npT)}}function nU(n,e){if(1&n&&(t.j41(0,"div",13),t.nrm(1,"app-icon",14),t.nI1(2,"async"),t.k0s()),2&n){let o;const i=t.XpG().$implicit,s=t.XpG();t.R7$(),t.Y8G("icon",(null==(o=t.bMT(2,1,s.selectedLabel$))?null:o.id)===i.id?"angle-up":"angle-down")}}function iU(n,e){if(1&n&&(t.j41(0,"div",18),t.nrm(1,"app-content-blocks",19),t.k0s()),2&n){const o=t.XpG(2).$implicit;t.R7$(),t.Y8G("contentBlocks",o.contentBlocks)}}function oU(n,e){if(1&n&&(t.j41(0,"div",15),t.nI1(1,"async"),t.nI1(2,"async"),t.nrm(3,"app-html",16),t.DNE(4,iU,2,1,"div",17),t.k0s()),2&n){let o,i;const s=t.XpG(),r=s.$implicit,a=s.index,l=t.XpG();t.Y8G("ngClass",t.eq3(9,eU,(null==(o=t.bMT(1,5,l.selectedLabel$))?null:o.id)===r.id)),t.BMQ("aria-hidden",(null==(i=t.bMT(2,7,l.selectedLabel$))?null:i.id)!==r.id)("id","content-"+a),t.R7$(3),t.Y8G("markdownText",r.description),t.R7$(),t.Y8G("ngIf",(null==r.contentBlocks?null:r.contentBlocks.length)>0)}}function sU(n,e){if(1&n){const o=t.RV6();t.j41(0,"li",3)(1,"button",4),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.handleLabelClick(s))}),t.j41(5,"span",5),t.pXf(6,0),t.k0s(),t.j41(7,"div",6),t.nrm(8,"app-label-pin",7),t.nI1(9,"async"),t.k0s(),t.DNE(10,tU,4,5,"div",8)(11,nU,3,3,"div",9),t.k0s(),t.DNE(12,oU,5,11,"div",10),t.k0s()}if(2&n){let o,i,s,r;const a=e.$implicit,l=e.index,_=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(20,ZL,(null==(o=t.bMT(2,12,_.selectedLabel$))?null:o.id)===a.id)),t.BMQ("aria-current",(null==(i=t.bMT(3,14,_.selectedLabel$))?null:i.id)===a.id)("aria-controls","label-list-content-"+l)("aria-expanded",(null==(s=t.bMT(4,16,_.selectedLabel$))?null:s.id)===a.id)("id","label-list-item-"+l),t.R7$(7),t.Y8G("showOnNone",!0)("selected",(null==(r=t.bMT(9,18,_.selectedLabel$))?null:r.id)===a.id)("label",a)("sequence",_.getLabelSequence(a)),t.R7$(2),t.Y8G("ngIf",a.title),t.R7$(),t.Y8G("ngIf",a.description||(null==a.contentBlocks?null:a.contentBlocks.length)>0),t.R7$(),t.Y8G("ngIf",a.description||(null==a.contentBlocks?null:a.contentBlocks.length)>0)}}class zp{constructor(e,o){this.viewService=e,this.store=o,this.labelPinType=_n,this.labelSequentialtype=co}ngOnInit(){}getLabelSequence(e){return this.store.selectSnapshot(ye.getLabelSequence(e))}handleLabelClick(e){const o=this.store.selectSnapshot(ye.getSelectedLabel);e.id===o?.id?this.viewService.clearSelectedLabel():this.viewService.selectLabel(e,!0)}}function rU(n,e){if(1&n&&(t.j41(0,"div",6),t.EFF(1),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.JRh(o.description)}}function aU(n,e){if(1&n&&(t.j41(0,"li",2),t.nrm(1,"div",3),t.j41(2,"div",4)(3,"div"),t.EFF(4),t.k0s(),t.DNE(5,rU,2,1,"div",5),t.k0s()()),2&n){const o=e.$implicit,i=t.XpG();t.R7$(),t.xc7("background-color",i.getComputedColor(o.colors)),t.R7$(3),t.JRh(o.label),t.R7$(),t.Y8G("ngIf",o.description)}}(Hc=zp).\u0275fac=function(e){return new(e||Hc)(t.rXU(zt),t.rXU(c.il))},Hc.\u0275cmp=t.VBU({type:Hc,selectors:[["app-view-labels"]],decls:3,vars:3,consts:()=>{let n;return n=$localize`:e788aaf840ca6aea39b81480b735057823a73b532641792472434523020:Navigate to description for, `,[n,["data-test","viewLabelList",1,"view-labels"],["data-test","viewLabelListItem","class","view-labels__list-item",4,"ngFor","ngForOf"],["data-test","viewLabelListItem",1,"view-labels__list-item"],["data-test","viewLabelListButton",1,"view-labels__item",3,"click","ngClass"],[1,"sr-only"],[1,"view-labels__pin"],[3,"showOnNone","selected","label","sequence"],["class","view-labels__body",4,"ngIf"],["class","view-labels__expand","data-test","viewLabelsToggle",4,"ngIf"],["class","view-labels__content","data-test","viewLabelListContent",3,"ngClass",4,"ngIf"],[1,"view-labels__body"],[1,"view-labels__title","html",3,"innerHTML"],["data-test","viewLabelsToggle",1,"view-labels__expand"],[3,"icon"],["data-test","viewLabelListContent",1,"view-labels__content",3,"ngClass"],["data-test","viewLabelListHtml",3,"markdownText"],["data-test","viewLabelListBlocks",4,"ngIf"],["data-test","viewLabelListBlocks"],[3,"contentBlocks"]]},template:function(e,o){1&e&&(t.j41(0,"ul",1),t.DNE(1,sU,13,22,"li",2),t.nI1(2,"async"),t.k0s()),2&e&&(t.R7$(),t.Y8G("ngForOf",t.bMT(2,1,o.labels$)))},dependencies:[b.YU,b.Sq,b.bT,sl,qe,Ws,u1,Ti.i0,b.Jj],styles:[".view-labels__list-item{padding-bottom:8px}.view-labels__item{background:none;border:0;display:flex;padding:12px 12px 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:left;align-items:center}.view-labels__item:focus{outline:#2d72dc solid 2px!important}.view-labels__item:hover,.view-labels__item--selected:hover{background-color:#131c2a0d}.view-labels__item--selected .view-labels__title{font-weight:600}.view-labels__pin{display:flex;align-items:center;justify-content:center;flex:0 0 18px;height:18px}.view-labels__body{flex:1 1 auto}.view-labels__expand{flex-grow:0;display:flex;justify-content:center;align-items:center;position:relative}.view-labels__title{color:#131c2a;font-size:.875rem;line-height:1.25rem}.view-labels__label{position:absolute;font-size:10px;top:3px}.view-labels__content{display:none;padding:8px 8px 24px 12px;font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word;color:#374a68}.view-labels__content--shown{display:block}\n"],encapsulation:2,changeDetection:0}),K1([(0,c.l6)(ye.getChapterLabels),J1("design:type",f.c)],zp.prototype,"labels$",void 0),K1([(0,c.l6)(ye.getSelectedLabel),J1("design:type",f.c)],zp.prototype,"selectedLabel$",void 0);let lU=(()=>{var n;class e{constructor(){}ngOnInit(){}getComputedColor(i){return ts.rgbToHex(i,!0)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-legend"]],inputs:{legend:"legend"},decls:2,vars:1,consts:()=>{let o;return o=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,[["aria-label",o,"role","complementary",1,"view-legend"],["class","view-legend__item",4,"ngFor","ngForOf"],[1,"view-legend__item"],[1,"view-legend__color"],[1,"view-legend__content","text-sm"],["class","my-2",4,"ngIf"],[1,"my-2"]]},template:function(i,s){1&i&&(t.j41(0,"ul",0),t.DNE(1,aU,6,4,"li",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.legend))},dependencies:[b.Sq,b.bT],styles:['.view-legend{display:flex;flex-direction:column}.view-legend__item{padding:12px 12px 12px 16px;display:flex;gap:12px;flex-direction:row;justify-content:flex-start;align-items:flex-start}.view-legend__content{word-break:break-word;display:flex;flex-direction:column}.view-legend__color{border:1px solid #96a8c0;content:" ";display:block;flex:0 0 18px;width:18px;height:18px;border-radius:50%}.view-legend__color:after{content:" "}\n'],encapsulation:2,changeDetection:0}),e})();const cU=["*",[["","actions",""]]],_U=["*","[actions]"],dU=(n,e)=>({"view-panel--padding-none":n,"view-panel--padding-dense":e});function pU(n,e){if(1&n&&(t.j41(0,"div",2)(1,"h2",3),t.EFF(2),t.k0s(),t.SdG(3,1,["actions","",1,"view-panel__actions"]),t.k0s()),2&n){const o=t.XpG();t.R7$(2),t.SpI(" ",o.label," ")}}let uU=(()=>{var n;class e{constructor(){this.label="",this.showHeader=!0,this.padding="normal"}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-panel"]],inputs:{label:"label",showHeader:"showHeader",padding:"padding"},ngContentSelectors:_U,decls:3,vars:5,consts:[[1,"view-panel",3,"ngClass"],["class","view-panel__header",4,"ngIf"],[1,"view-panel__header"],[1,"view-panel__label"]],template:function(i,s){1&i&&(t.NAR(cU),t.j41(0,"div",0),t.DNE(1,pU,4,1,"div",1),t.SdG(2),t.k0s()),2&i&&(t.Y8G("ngClass",t.l_i(2,dU,"none"===s.padding,"dense"===s.padding)),t.R7$(),t.Y8G("ngIf",s.showHeader))},dependencies:[b.YU,b.bT],styles:["[_nghost-%COMP%]{display:block}.view-panel--padding-none[_ngcontent-%COMP%]{padding:0;margin:0}.view-panel--padding-dense[_ngcontent-%COMP%]{padding:0 0 8px;margin:0 0 8px}.view-panel__label[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;color:#131c2a;font-weight:600}.view-panel__header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;margin-bottom:8px}"],changeDetection:0}),e})();var Qc,qs=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ks=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const gU=["contentParent"],hU=(n,e,o)=>[n,e,o];function mU(n,e){1&n&&t.nrm(0,"app-view-audio-bar",11)}function fU(n,e){if(1&n&&(t.j41(0,"div"),t.nrm(1,"app-content-blocks",12),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("contentBlocks",t.bMT(2,2,o.contentBlocks$))("include",o.contentBlockTypes.Ticker)}}function SU(n,e){if(1&n&&(t.j41(0,"div",13),t.nrm(1,"app-content-blocks",12),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("contentBlocks",t.bMT(2,2,o.contentBlocks$))("include",t.sMw(4,hU,o.contentBlockTypes.Markdown,o.contentBlockTypes.Images,o.contentBlockTypes.Videos))}}function bU(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-view-panel",6),t.DNE(1,mU,1,0,"app-view-audio-bar",7),t.nI1(2,"async"),t.DNE(3,fU,3,4,"div",8),t.nI1(4,"async"),t.j41(5,"app-view-description",9),t.mxI("isPopulatedChange",function(s){t.eBV(o);const r=t.XpG();return t.DH7(r.isPopulated,s)||(r.isPopulated=s),t.Njj(s)}),t.k0s(),t.DNE(6,SU,3,8,"div",10),t.nI1(7,"async"),t.k0s()}if(2&n){let o,i;const s=t.XpG();t.AVh("mb-10",!s.compact),t.Y8G("showHeader",!1)("hidden",!s.isPopulated),t.R7$(),t.Y8G("ngIf",t.bMT(2,8,s.audioVisible$)),t.R7$(2),t.Y8G("ngIf",(null==(o=t.bMT(4,10,s.contentBlocks$))?null:o.length)>0),t.R7$(2),t.R50("isPopulated",s.isPopulated),t.R7$(),t.Y8G("ngIf",(null==(i=t.bMT(7,12,s.contentBlocks$))?null:i.length)>0)}}function yU(n,e){if(1&n&&(t.j41(0,"app-view-panel",14),t.nrm(1,"app-view-legend",15),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("legend",t.bMT(2,1,o.chapter$).legend)}}function vU(n,e){1&n&&(t.j41(0,"app-view-panel",16),t.nrm(1,"app-view-labels"),t.k0s())}function EU(n,e){if(1&n&&(t.j41(0,"app-view-panel",17),t.nrm(1,"app-content-blocks",18),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("contentBlocks",t.bMT(2,1,o.positionBlocks$))}}class yo{constructor(e,o,i){this.store=e,this.contentBlocksService=o,this.positionsService=i,this.isTabPanel=!1,this.compact=!1,this.ngUnsubscribe=new oe.B,this.isPopulated=!0,this.contentBlockTypes=Fn}ngOnInit(){this.positionBlocks$=this.contentBlocks$.pipe((0,At.Z)(e=>{let o=this.contentBlocksService.filterContentBlocksByType(e,[Fn.Positions]);return o.length>0&&(o=this.insertStartingPosition(o)),(0,Qe.of)(o)}),(0,w.Q)(this.ngUnsubscribe)),this.isTabPanel&&(this.contentParent.nativeElement.setAttribute("role","tabpanel"),this.contentParent.nativeElement.setAttribute("aria-labeledby","chaptersTab"),this.contentParent.nativeElement.id="chapterPanel",this.contentParent.nativeElement.tabIndex=0)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}insertStartingPosition(e){return(e=(0,m.cloneDeep)(e))[0].positions.unshift(this.positionsService.startingPositionToAdditionalPosition(this.store.selectSnapshot(E.getSelectedChapterId))),e}}(Qc=yo).\u0275fac=function(e){return new(e||Qc)(t.rXU(c.il),t.rXU(Ar),t.rXU(QL))},Qc.\u0275cmp=t.VBU({type:Qc,selectors:[["app-view-content-mode"]],viewQuery:function(e,o){if(1&e&&t.GBs(gU,7,t.aKT),2&e){let i;t.mGM(i=t.lsd())&&(o.contentParent=i.first)}},inputs:{isTabPanel:"isTabPanel",compact:"compact"},decls:13,vars:18,consts:()=>{let n,e,o,i,s;return n=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,e=$localize`:2af7efecfae8d7fed3b07f718a623eca1ad8163f546766753072101168:Labels`,o=$localize`:2af7efecfae8d7fed3b07f718a623eca1ad8163f546766753072101168:Labels`,i=$localize`:7acfeb6214be6d5b9c6ca7285d689dd1402ca446529261375582544700:Positions`,s=$localize`:7acfeb6214be6d5b9c6ca7285d689dd1402ca446529261375582544700:Positions`,[["contentParent",""],["data-test","viewContentMode",1,"view-content-mode"],["role","complementary","aria-describedby","view-title",3,"showHeader","hidden","mb-10",4,"ngIf"],["class","mb-10","label",n,4,"ngIf"],["class","mb-10","label",e,"role","complementary","aria-label",o,4,"ngIf"],["class","mb-10","label",i,"role","complementary","aria-label",s,4,"ngIf"],["role","complementary","aria-describedby","view-title",3,"showHeader","hidden"],["class","block mb-4",4,"ngIf"],[4,"ngIf"],[3,"isPopulatedChange","isPopulated"],["class","mt-5",4,"ngIf"],[1,"block","mb-4"],[3,"contentBlocks","include"],[1,"mt-5"],["label",n,1,"mb-10"],[3,"legend"],["label",e,"role","complementary","aria-label",o,1,"mb-10"],["label",i,"role","complementary","aria-label",s,1,"mb-10"],[3,"contentBlocks"]]},template:function(e,o){if(1&e&&(t.j41(0,"div",1,0),t.DNE(2,bU,8,14,"app-view-panel",2),t.nI1(3,"async"),t.DNE(4,yU,3,3,"app-view-panel",3),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.DNE(8,vU,2,0,"app-view-panel",4),t.nI1(9,"async"),t.nI1(10,"async"),t.DNE(11,EU,3,3,"app-view-panel",5),t.nI1(12,"async"),t.k0s()),2&e){let i,s;t.R7$(2),t.Y8G("ngIf",t.bMT(3,4,o.descriptionVisible$)),t.R7$(2),t.Y8G("ngIf",(null==(i=t.bMT(5,6,o.chapter$))?null:i.legend)&&(null==(i=t.bMT(6,8,o.chapter$))?null:i.legend.length)>0&&t.bMT(7,10,o.legendVisible$)),t.R7$(4),t.Y8G("ngIf",(null==(s=t.bMT(9,12,o.labels$))?null:s.length)&&t.bMT(10,14,o.labelListVisible$)),t.R7$(3),t.Y8G("ngIf",t.bMT(12,16,o.positionBlocks$).length>0)}},dependencies:[b.bT,sl,KL,Bp,zp,lU,uU,b.Jj],styles:[".view-content-mode[_ngcontent-%COMP%]{padding-bottom:24px}"],changeDetection:0}),qs([(0,c.l6)(E.getStoryChapters),Ks("design:type",f.c)],yo.prototype,"chapters$",void 0),qs([(0,c.l6)(E.getSelectedChapter),Ks("design:type",f.c)],yo.prototype,"chapter$",void 0),qs([(0,c.l6)(E.getSelectedChapterContentBlocks),Ks("design:type",f.c)],yo.prototype,"contentBlocks$",void 0),qs([(0,c.l6)(ye.getChapterLabels),Ks("design:type",f.c)],yo.prototype,"labels$",void 0),qs([(0,c.l6)(ue.getVisible(h.Description)),Ks("design:type",f.c)],yo.prototype,"descriptionVisible$",void 0),qs([(0,c.l6)(ue.getVisible(h.LabelList)),Ks("design:type",f.c)],yo.prototype,"labelListVisible$",void 0),qs([(0,c.l6)(ue.getVisible(h.Legend)),Ks("design:type",f.c)],yo.prototype,"legendVisible$",void 0),qs([(0,c.l6)(ue.getVisible(h.Audio)),Ks("design:type",f.c)],yo.prototype,"audioVisible$",void 0);let Z1=(()=>{var n;class e{constructor(i,s){this.store=i,this.el=s,this.appInfoScroll=!0,this.ngUnsubscribe=new oe.B}ngOnInit(){this.store.selectSnapshot(G.hasQuiz)&&this.handleQuizScrolling(),this.handleChapterScrolling()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterScrolling(){this.store.select(E.getSelectedChapterId).pipe((0,X.p)(()=>this.appInfoScroll),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()})}handleQuizScrolling(){const i=this.store.select(G.getQuizModeActive),s=this.store.select(G.getLifecycle);i.pipe((0,X.p)(()=>this.appInfoScroll),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()}),s.pipe((0,X.p)(()=>this.appInfoScroll),(0,w.Q)(this.ngUnsubscribe)).subscribe(r=>{r===_o.Explanation?setTimeout(()=>this.scrollToBottom()):this.scrollToTop()})}scrollToTop(){this.el.nativeElement.scrollTo({top:0})}scrollToBottom(){this.el.nativeElement.scrollTo({top:this.el.nativeElement.scrollHeight,behavior:"smooth"})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(t.aKT))},n.\u0275dir=t.FsC({type:n,selectors:[["","appInfoScroll",""]],inputs:{appInfoScroll:"appInfoScroll"}}),e})();var Yc;const OU=[[["","header",""]],[["","body",""]],[["","footer",""]]],MU=n=>({"view-column--padded":n});function IU(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleToggleFooter(!s.footerExpanded))}),t.j41(1,"div",9)(2,"div"),t.EFF(3),t.k0s(),t.j41(4,"div"),t.nrm(5,"app-icon",10),t.k0s()()()}if(2&n){const o=t.XpG(2);t.Y8G("thin",!0),t.BMQ("aria-controls","view-column__footer-content-wrapper")("aria-expanded",o.footerExpanded),t.R7$(3),t.JRh(o.footerLabel),t.R7$(2),t.Y8G("icon",o.footerExpanded?"angle-down":"angle-up")}}function AU(n,e){if(1&n&&(t.j41(0,"div",4),t.DNE(1,IU,6,5,"button",5),t.j41(2,"div",6)(3,"div",7),t.SdG(4,2),t.k0s()()()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.footerLabel),t.R7$(),t.AVh("view-column__footer-content-wrapper--expanded",o.footerExpanded||!o.footerLabel)}}let Wp="-100%";const PU=(0,ie.lY)([(0,ie.iF)({transform:"translateX({{ translateX }})"}),(0,ie.i0)("150ms ease-in-out",(0,ie.iF)({transform:"*"}))],{params:{translateX:Wp}}),NU=(0,ie.lY)([(0,ie.i0)("150ms ease-in-out",(0,ie.iF)({transform:"translateX({{ translateX }})"}))],{params:{translateX:Wp}});class Xp{get show(){return{value:this.animated,params:{translateX:Wp}}}get floating(){return this._floating}set floating(e){this._floating=e,this.floating&&(this.renderer.setStyle(this.el.nativeElement,"position","absolute"),this.renderer.setStyle(this.el.nativeElement,"z-index","100"),this.renderer.setStyle(this.el.nativeElement,"top","0"),this.renderer.setStyle(this.el.nativeElement,"inset-inline-start","0"),this.renderer.setStyle(this.el.nativeElement,"bottom","0"))}constructor(e,o,i){this.el=e,this.renderer=o,this.localeId=i,this.padded=!0,this._floating=!1,this.viewContentMode=lt,this.animated=!1,this.showFooter=!1,this.footerLabel="",this.footerExpanded=!1,"rtl"===Ol(this.localeId).direction&&(Wp="100%")}handleToggleFooter(e){this.footerExpanded=e}}(Yc=Xp).\u0275fac=function(e){return new(e||Yc)(t.rXU(t.aKT),t.rXU(t.sFG),t.rXU(t.xe9))},Yc.\u0275cmp=t.VBU({type:Yc,selectors:[["app-view-column"]],hostVars:1,hostBindings:function(e,o){2&e&&t.zvX("@show",o.show)},inputs:{padded:"padded",floating:"floating",animated:"animated",showFooter:"showFooter",footerLabel:"footerLabel"},ngContentSelectors:["[header]","[body]","[footer]"],decls:8,vars:9,consts:[["data-test","viewColumn",1,"view-column",3,"ngClass"],[1,"view-column__header"],[1,"view-column__body",3,"appInfoScroll"],["class","view-column__footer",4,"ngIf"],[1,"view-column__footer"],["app-view-button","","buttonSize","small",3,"thin","click",4,"ngIf"],["id","view-column__footer-content-wrapper",1,"view-column__footer-content-wrapper"],[1,"view-column__footer-content"],["app-view-button","","buttonSize","small",3,"click","thin"],[1,"view-column__footer-toggle"],[3,"icon"]],template:function(e,o){1&e&&(t.NAR(OU),t.j41(0,"div",0)(1,"div",1),t.SdG(2),t.k0s(),t.j41(3,"div",2),t.nI1(4,"async"),t.nI1(5,"async"),t.SdG(6,1),t.k0s(),t.DNE(7,AU,5,3,"div",3),t.k0s()),2&e&&(t.Y8G("ngClass",t.eq3(7,MU,o.padded)),t.R7$(3),t.Y8G("appInfoScroll",t.bMT(4,3,o.contentMode$)===o.viewContentMode.ChapterInfo||t.bMT(5,5,o.contentMode$)===o.viewContentMode.Quiz),t.R7$(4),t.Y8G("ngIf",o.showFooter))},dependencies:[xt,b.YU,b.bT,Z1,qe,b.Jj],styles:['[_nghost-%COMP%]{position:relative;width:320px}.view-column[_ngcontent-%COMP%]{background-color:#fff;border-right:1px solid #d7e0ea;height:100%;display:grid;grid-template-areas:"header" "content" "footer";grid-template-columns:320px;grid-template-rows:auto 1fr}.view-column--padded[_ngcontent-%COMP%]   .view-column__body[_ngcontent-%COMP%]{padding:20px 24px 20px 12px}.view-column--padded[_ngcontent-%COMP%]   .view-column__footer-content[_ngcontent-%COMP%]{padding:4px 24px 24px 12px}.view-column__header[_ngcontent-%COMP%]{grid-area:header;border-bottom:1px solid #d7e0ea;border-right:1px solid #d7e0ea}.view-column__body[_ngcontent-%COMP%]{grid-area:content;overflow:auto}.view-column__footer[_ngcontent-%COMP%]{grid-area:footer;border:1px solid #d7e0ea;display:flex;flex-direction:column}.view-column__footer-toggle[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:16px 12px;color:#131c2a;font-size:.875rem;line-height:1.25rem;font-weight:600;text-transform:uppercase}.view-column__footer-content-wrapper[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:all .5s}.view-column__footer-content-wrapper--expanded[_ngcontent-%COMP%]{overflow:auto;max-height:40vh}'],data:{animation:[(0,ie.hZ)("show",[(0,ie.kY)(":enter",(0,ie.sM)(PU)),(0,ie.kY)(":leave",(0,ie.sM)(NU))])]},changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(P.getContentMode),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Xp.prototype,"contentMode$",void 0);var qc,bf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},yf=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const RU=["tabButton"];function kU(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",8,0),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.setContentMode(s.viewContentMode.Chapters))})("keyup.space",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.setContentMode(s.viewContentMode.Chapters))}),t.nrm(4,"app-icon",9),t.qex(5),t.pXf(6,2),t.bVm(),t.k0s()}if(2&n){const o=t.XpG();t.AVh("view-column-tabs__tab--selected",t.bMT(2,3,o.contentMode$)===o.viewContentMode.Chapters),t.BMQ("aria-selected",t.bMT(3,5,o.contentMode$)===o.viewContentMode.Chapters)}}class Kc{constructor(e,o){this.viewService=e,this.store=o,this.viewContentMode=lt}setContentMode(e){this.viewService.setContentMode(e),this.store.dispatch(new D.SetPreferredColumn(e===lt.ChapterInfo?"info":"chapters"))}shiftFocus(e,o){e.stopPropagation();const i=this._buttonRefs.toArray(),r=(i.findIndex(a=>a.nativeElement==document.activeElement)+o+i.length)%i.length;i[r].nativeElement.focus()}}(qc=Kc).\u0275fac=function(e){return new(e||qc)(t.rXU(zt),t.rXU(c.il))},qc.\u0275cmp=t.VBU({type:qc,selectors:[["app-view-column-tabs"]],viewQuery:function(e,o){if(1&e&&t.GBs(RU,5),2&e){let i;t.mGM(i=t.lsd())&&(o._buttonRefs=i)}},decls:11,vars:11,consts:()=>{let n,e;return n=$localize`:321e4419a943044e674beb55b8039f42a9761ca5314315645942131479:Info`,e=$localize`:d904f74acb72356dd3547977ca3cf29d6da259465096495468612049743:Chapters`,[["tabButton",""],n,e,["data-test","viewColumnTabs",1,"view-column-tabs"],["role","tablist",1,"view-column-tabs__tabs",3,"keydown.arrowleft","keydown.arrowright"],["data-test","chaptersTab","type","button","role","tab","class","view-column-tabs__tab","aria-controls","chapterPanel","id","chaptersTab",3,"view-column-tabs__tab--selected","click","keyup.space",4,"ngIf"],["data-test","infoTab","type","button","role","tab","aria-controls","infoPanel","id","infoTab",1,"view-column-tabs__tab",3,"click","keyup.space"],["size","2xl","aria-hidden","true","icon","info",1,"view-column-tabs__tab-icon",3,"custom"],["data-test","chaptersTab","type","button","role","tab","aria-controls","chapterPanel","id","chaptersTab",1,"view-column-tabs__tab",3,"click","keyup.space"],["icon","bookmark","size","2xl","aria-hidden","true",1,"view-column-tabs__tab-icon"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",3)(1,"div",4),t.bIt("keydown.arrowleft",function(r){return t.eBV(i),t.Njj(o.shiftFocus(r,-1))})("keydown.arrowright",function(r){return t.eBV(i),t.Njj(o.shiftFocus(r,1))}),t.DNE(2,kU,7,7,"button",5),t.nI1(3,"async"),t.j41(4,"button",6,0),t.nI1(6,"async"),t.nI1(7,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.setContentMode(o.viewContentMode.ChapterInfo))})("keyup.space",function(){return t.eBV(i),t.Njj(o.setContentMode(o.viewContentMode.ChapterInfo))}),t.nrm(8,"app-icon",7),t.qex(9),t.pXf(10,1),t.bVm(),t.k0s()()()}2&e&&(t.R7$(2),t.Y8G("ngIf",t.bMT(3,5,o.paginationVisible$)),t.R7$(2),t.AVh("view-column-tabs__tab--selected",t.bMT(6,7,o.contentMode$)===o.viewContentMode.ChapterInfo),t.BMQ("aria-selected",t.bMT(7,9,o.contentMode$)===o.viewContentMode.ChapterInfo),t.R7$(4),t.Y8G("custom",!0))},dependencies:[b.bT,qe,b.Jj],styles:[".view-column-tabs[_ngcontent-%COMP%]{--tab-height: 75px}.view-column-tabs__tabs[_ngcontent-%COMP%]{display:grid;grid-auto-columns:minmax(0,1fr);grid-auto-flow:column;height:var(--tab-height)}.view-column-tabs__tab[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;align-items:center;background:#eaeff5;border:0;color:#374a68;display:flex;flex-direction:column;flex:1;font-weight:400;justify-content:center;transition:all .2s ease-in-out;cursor:pointer}.view-column-tabs__tab--selected[_ngcontent-%COMP%]{background:#fff;color:#374a68;font-weight:600}.view-column-tabs__tab--selected[_ngcontent-%COMP%]   .view-column-tabs__tab-icon[_ngcontent-%COMP%]{color:#2d72dc}.view-column-tabs__tab-icon[_ngcontent-%COMP%]{margin-bottom:4px;width:24px;height:24px;display:flex;align-items:center;justify-content:center}"],changeDetection:0}),bf([(0,c.l6)(P.getContentMode),yf("design:type",f.c)],Kc.prototype,"contentMode$",void 0),bf([(0,c.l6)(xe.getSelectedBookmarkViewMode),yf("design:type",f.c)],Kc.prototype,"selectedBookmarkViewMode$",void 0),bf([(0,c.l6)(ue.getVisible(h.Pagination)),yf("design:type",f.c)],Kc.prototype,"paginationVisible$",void 0);var Jc,Zc=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},e_=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function DU(n,e){if(1&n&&(t.qex(0),t.j41(1,"div",6),t.nrm(2,"app-progress-circle",7),t.k0s(),t.j41(3,"div",6),t.nrm(4,"app-progress-circle",8),t.k0s(),t.bVm()),2&n){const o=t.XpG();t.R7$(2),t.Y8G("progress",o.chapterPercent)("showPercent",!1)("animate",!1),t.R7$(2),t.Y8G("progress",o.countdownPercent)("showPercent",!1)("animate",!1)}}class Js{constructor(e,o,i,s){this.viewService=e,this.viewPlaythroughService=o,this.store=i,this.changeDetectorRef=s,this.showCount=!0,this.showPlaythrough=!1,this.buttonSize=Xr.Default,this.buttonTheme="transparent-fill",this.interval=null,this.chapterPercent=0,this.countdownPercent=0,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initChapterListener(),this.initPlaythrough()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.stopChapterTimer()}handlePreviousClick(){this.viewService.previousChapter("Pagination")}handleNextClick(){this.viewService.nextChapter("Pagination")}initChapterListener(){this.store.select(E.getSelectedChapterId).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.stopChapterTimer()}),(0,Tt.z)([this.store.select(U.getChapter),this.store.select(P.getPlaythroughEnabled)]).pipe((0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{this.chapterPercent=0,o?this.startChapterTimer():this.stopChapterTimer()})}initPlaythrough(){this.viewPlaythroughService.countdownChanged.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const{countdown:o}=this.store.selectSnapshot(P.getPlaythroughSettings);this.countdownPercent=Math.floor(100-e/o*100),this.changeDetectorRef.markForCheck()})}startChapterTimer(){this.chapterPercent=0,this.countdownPercent=0,this.stopChapterTimer(),this.interval=setInterval(()=>{const e=this.viewPlaythroughService.calculateMaximumRemainingTime();this.chapterPercent=Math.ceil(e.current/e.duration*100),this.chapterPercent>100&&(this.chapterPercent=100),this.changeDetectorRef.markForCheck()},50)}stopChapterTimer(){this.interval&&clearInterval(this.interval),this.interval=null}}(Jc=Js).\u0275fac=function(e){return new(e||Jc)(t.rXU(zt),t.rXU(XE),t.rXU(c.il),t.rXU(t.gRc))},Jc.\u0275cmp=t.VBU({type:Jc,selectors:[["app-view-pagination"]],inputs:{showCount:"showCount",showPlaythrough:"showPlaythrough",buttonSize:"buttonSize",buttonTheme:"buttonTheme"},decls:10,vars:15,consts:()=>{let n,e;return n=$localize`:3228d65908ec43ba657d860b050c2a3871868cee8424575283863104959:Previous Chapter`,e=$localize`:95f5388846a3beaee5f870eb0996ed47d9c7819a8192680256063110394:Next Chapter`,[[1,"view-pagination"],["data-test","viewPreviousChapter","aria-label",n,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],["size","lg","icon","arrow-left","appLogicalDir",""],["data-test","viewNextChapter","aria-label",e,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],[4,"ngIf"],["size","lg","icon","arrow-right","appLogicalDir",""],[1,"view-pagination__playthrough"],["fillColor","transparent","ringColor","#eaeff5","strokeColor","#96a8c0","diameter","32","strokeWidth","3",3,"progress","showPercent","animate"],["fillColor","transparent","ringColor","transparent","strokeColor","#374a68","diameter","32","strokeWidth","3",3,"progress","showPercent","animate"]]},template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"button",1),t.nI1(2,"async"),t.bIt("click",function(){return o.handlePreviousClick()}),t.nrm(3,"app-icon",2),t.k0s(),t.j41(4,"button",3),t.nI1(5,"async"),t.nI1(6,"async"),t.bIt("click",function(){return o.handleNextClick()}),t.DNE(7,DU,5,6,"ng-container",4),t.nI1(8,"async"),t.nrm(9,"app-icon",5),t.k0s()()),2&e&&(t.R7$(),t.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",0===t.bMT(2,7,o.chapterIndex$)?"true":null),t.R7$(3),t.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",t.bMT(5,9,o.chapterIndex$)===t.bMT(6,11,o.chapterCount$)-1?"true":null),t.R7$(3),t.Y8G("ngIf",t.bMT(8,13,o.playthroughEnabled$)))},dependencies:[xt,b.bT,Hi,qe,ff,b.Jj],styles:["@keyframes _ngcontent-%COMP%_disappear{0%{top:0}to{top:100%}}.view-pagination[_ngcontent-%COMP%]{display:flex;position:relative;white-space:nowrap}.view-pagination__count[_ngcontent-%COMP%]{font-size:14px;padding:0 8px}.view-pagination__playthrough[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center}"],changeDetection:0}),Zc([(0,c.l6)(E.getSelectedChapterIndex),e_("design:type",f.c)],Js.prototype,"chapterIndex$",void 0),Zc([(0,c.l6)(E.getNextChapter),e_("design:type",f.c)],Js.prototype,"nextChapter$",void 0),Zc([(0,c.l6)(E.getPreviousChapter),e_("design:type",f.c)],Js.prototype,"previousChapter$",void 0),Zc([(0,c.l6)(E.getChapterCount),e_("design:type",f.c)],Js.prototype,"chapterCount$",void 0),Zc([(0,c.l6)(P.getPlaythroughEnabled),e_("design:type",f.c)],Js.prototype,"playthroughEnabled$",void 0);var t_,n_=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},i_=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const UU=(n,e)=>({"view-title--center":n,"view-title--ellipsis":e});function VU(n,e){if(1&n&&t.nrm(0,"h2",4),2&n){const o=t.XpG();t.Y8G("innerHTML",o.htmlMetaTitle,t.npT)}}function jU(n,e){if(1&n&&t.nrm(0,"h1",5),2&n){const o=t.XpG();t.Y8G("innerHTML",o.htmlMainTitle,t.npT)}}function xU(n,e){if(1&n&&t.nrm(0,"h2",6),2&n){const o=t.XpG();t.Y8G("innerHTML",o.htmlSubTitle,t.npT)}}class Zs{get style(){return this.sanitizer.bypassSecurityTrustStyle(this.useEllipsis?"overflow: hidden; display: flex; width: 100%;":"")}get mainTitle(){return this._mainTitle}set mainTitle(e){this._mainTitle=e,this.handleMarkdownTextUpdate(e,"htmlMainTitle")}get metaTitle(){return this._metaTitle}set metaTitle(e){this._metaTitle=e,this.handleMarkdownTextUpdate(e,"htmlMetaTitle")}get subTitle(){return this._subTitle}set subTitle(e){this._subTitle=e,this.handleMarkdownTextUpdate(e,"htmlSubTitle")}constructor(e,o,i,s){this.viewUIService=e,this.changeDetectorRef=o,this.sanitizer=i,this.markdownService=s,this.useEllipsis=!1,this.includePagination=!1,this.dynamicTitle=!1,this._mainTitle="",this.showMainTitle=!0,this._metaTitle="",this.showMetaTitle=!0,this._subTitle="",this.showSubTitle=!0,this.align="left",this.viewLayout=h,this.ngUnsubscribe=new oe.B}ngOnInit(){this.dynamicTitle&&this.initContentListener(),this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isEnabled(e){return this.viewUIService.isUIEnabled(e)}initContentListener(){(0,Tt.z)([this.story$,this.chapter$,this.pagination$]).pipe((0,X.p)(([e,o])=>null!=o&&null!=e),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{const s=Ri.normalize(e.displayName),r=o.displayName?Ri.normalize(o.displayName):$localize`Chapter`+` ${i.index+1}`;he.application===bt.Studio&&(this.metaTitle=s!==r?s:""),this.mainTitle=r,this.subTitle=this.includePagination?i?.label:""})}initLayoutListener(){this.viewUI$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.changeDetectorRef.markForCheck()})}handleMarkdownTextUpdate(e,o){var i=this;return(0,J.A)(function*(){const s=yield i.markdownService.parse(e);i[o]=i.sanitizer.bypassSecurityTrustHtml(s||""),i.changeDetectorRef.markForCheck()})()}}(t_=Zs).\u0275fac=function(e){return new(e||t_)(t.rXU(hp),t.rXU(t.gRc),t.rXU(z.up),t.rXU(Ti.Rl))},t_.\u0275cmp=t.VBU({type:t_,selectors:[["app-view-title"]],hostVars:2,hostBindings:function(e,o){2&e&&t.Aen(o.style)},inputs:{useEllipsis:"useEllipsis",includePagination:"includePagination",dynamicTitle:"dynamicTitle",mainTitle:"mainTitle",showMainTitle:"showMainTitle",metaTitle:"metaTitle",showMetaTitle:"showMetaTitle",subTitle:"subTitle",showSubTitle:"showSubTitle",align:"align"},decls:4,vars:7,consts:[[1,"view-title",3,"ngClass"],["id","view-title-meta","class","view-title__meta",3,"innerHTML",4,"ngIf"],["class","view-title__main","id","view-title",3,"innerHTML",4,"ngIf"],["class","view-title__sub","id","view-title-sub",3,"innerHTML",4,"ngIf"],["id","view-title-meta",1,"view-title__meta",3,"innerHTML"],["id","view-title",1,"view-title__main",3,"innerHTML"],["id","view-title-sub",1,"view-title__sub",3,"innerHTML"]],template:function(e,o){1&e&&(t.j41(0,"section",0),t.DNE(1,VU,1,1,"h2",1)(2,jU,1,1,"h1",2)(3,xU,1,1,"h2",3),t.k0s()),2&e&&(t.Y8G("ngClass",t.l_i(4,UU,"center"===o.align,o.useEllipsis)),t.R7$(),t.Y8G("ngIf",o.metaTitle.length>0&&o.showMetaTitle),t.R7$(),t.Y8G("ngIf",o.showMainTitle),t.R7$(),t.Y8G("ngIf",o.showSubTitle))},dependencies:[b.YU,b.bT],styles:["[_nghost-%COMP%]{display:flex}.view-title[_ngcontent-%COMP%]{overflow-wrap:break-word;color:#131c2a;border-radius:4px;transition:background-color 125ms;flex:1 1 0;display:flex;flex-direction:column;align-items:flex-start}.view-title--ellipsis[_ngcontent-%COMP%]{width:0}.view-title--ellipsis[_ngcontent-%COMP%]   .view-title__meta[_ngcontent-%COMP%], .view-title--ellipsis[_ngcontent-%COMP%]   .view-title__main[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.view-title--center[_ngcontent-%COMP%]{justify-content:center}.view-title__meta[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;font-weight:400;color:#374a68;overflow-wrap:anywhere;margin-bottom:4px}.view-title__main[_ngcontent-%COMP%]{color:#131c2a;line-height:20px;text-align:start;font-weight:600;overflow-wrap:anywhere}.view-title__sub[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;margin-top:4px;color:#374a68;font-weight:400}.view-title[_ngcontent-%COMP%]:hover   .view-title__count[_ngcontent-%COMP%]{display:none}.view-title[_ngcontent-%COMP%]:hover   .view-title__show[_ngcontent-%COMP%]{display:block}.view-title__show[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),n_([(0,c.l6)(Pe.getStory),i_("design:type",f.c)],Zs.prototype,"story$",void 0),n_([(0,c.l6)(E.getSelectedChapter),i_("design:type",f.c)],Zs.prototype,"chapter$",void 0),n_([(0,c.l6)(E.getChapterPagination),i_("design:type",f.c)],Zs.prototype,"pagination$",void 0),n_([(0,c.l6)(ue.getUI),i_("design:type",f.c)],Zs.prototype,"viewUI$",void 0),n_([(0,c.l6)(ue.getVisible(h.Pagination)),i_("design:type",f.c)],Zs.prototype,"paginationVisible$",void 0);var o_,eT=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},tT=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function GU(n,e){1&n&&(t.j41(0,"app-pillbox"),t.nrm(1,"app-view-pagination",4),t.k0s()),2&n&&(t.R7$(),t.Y8G("showCount",!1))}class Hp{constructor(){}ngOnInit(){}}(o_=Hp).\u0275fac=function(e){return new(e||o_)},o_.\u0275cmp=t.VBU({type:o_,selectors:[["app-view-column-chapter-header"]],decls:6,vars:7,consts:[["data-test","viewColumnHeader",1,"view-column-chapter-header"],[1,"view-column-chapter-header__title"],[3,"includePagination","dynamicTitle"],[4,"ngIf"],["buttonSize","small",3,"showCount"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"app-view-title",2),t.nI1(3,"async"),t.k0s(),t.DNE(4,GU,2,1,"app-pillbox",3),t.nI1(5,"async"),t.k0s()),2&e&&(t.R7$(2),t.Y8G("includePagination",t.bMT(3,3,o.chapterCount$)>1)("dynamicTitle",!0),t.R7$(2),t.Y8G("ngIf",t.bMT(5,5,o.paginationVisible$)))},dependencies:[b.bT,Uo,Js,Zs,b.Jj],styles:[".view-column-chapter-header[_ngcontent-%COMP%]{min-height:32px;padding:24px 12px 20px;display:flex;align-items:flex-start}.view-column-chapter-header__title[_ngcontent-%COMP%]{flex-grow:1;align-items:center;padding-right:12px}"],changeDetection:0}),eT([(0,c.l6)(E.getChapterCount),tT("design:type",f.c)],Hp.prototype,"chapterCount$",void 0),eT([(0,c.l6)(ue.getVisible(h.Pagination)),tT("design:type",f.c)],Hp.prototype,"paginationVisible$",void 0);var s_,vo=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Eo=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function $U(n,e){1&n&&(t.qex(0),t.j41(1,"div",8),t.nrm(2,"app-view-quiz-header"),t.k0s(),t.bVm())}function FU(n,e){1&n&&t.nrm(0,"app-view-column-tabs")}function BU(n,e){if(1&n&&(t.qex(0),t.DNE(1,FU,1,0,"app-view-column-tabs",6),t.nI1(2,"async"),t.nrm(3,"app-view-column-chapter-header"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,1,o.paginationVisible$))}}function zU(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-chapter-list"),t.bVm())}function WU(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-content-mode",9),t.bVm()),2&n&&(t.R7$(),t.Y8G("isTabPanel",!0))}function XU(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-quiz",10),t.bVm())}function HU(n,e){if(1&n&&(t.qex(0),t.nrm(1,"app-view-source-info",11),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.bVm()),2&n){let o;const i=t.XpG();t.R7$(),t.Y8G("sourceInfo",t.bMT(2,3,i.sourceInfo$))("showSources",t.bMT(3,5,i.storyType$)===i.contentTypes.Module)("updateDate",null!==(o=null==(o=t.bMT(4,7,i.selectedBookmark$))?null:o.update_date_time)&&void 0!==o?o:null==(o=t.bMT(5,9,i.selectedBookmark$))?null:o.create_date_time)}}class qi{constructor(){this.contentTypes=yt,this.viewLayout=h,this.application=bt,this.bookmarkViewMode=ji,this.viewContentMode=lt,this.viewUI=h}getShowFooter(e){return!(0,m.isNil)(e)}getFooterLabel(e){return(0,m.isNil)(e)?"":$localize`Source Information`}}(s_=qi).\u0275fac=function(e){return new(e||s_)},s_.\u0275cmp=t.VBU({type:s_,selectors:[["app-view-column-container"]],decls:19,vars:25,consts:[["data-test","viewColumnContainer",3,"padded","showFooter","footerLabel"],["header",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["body",""],[4,"ngIf"],["footer",""],[1,"pt-5","pb-4","px-3"],[3,"isTabPanel"],["mode","column"],[3,"sourceInfo","showSources","updateDate"]],template:function(e,o){1&e&&(t.j41(0,"app-view-column",0),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.qex(4,1)(5,2),t.nI1(6,"async"),t.DNE(7,$U,3,0,"ng-container",3)(8,BU,4,3,"ng-container",4),t.bVm()(),t.qex(9,5),t.DNE(10,zU,2,0,"ng-container",6),t.nI1(11,"async"),t.DNE(12,WU,2,1,"ng-container",6),t.nI1(13,"async"),t.DNE(14,XU,2,0,"ng-container",6),t.nI1(15,"async"),t.bVm(),t.qex(16,7),t.DNE(17,HU,6,11,"ng-container",6),t.nI1(18,"async"),t.bVm(),t.k0s()),2&e&&(t.Y8G("padded",t.bMT(1,9,o.contentMode$)!==o.viewContentMode.Search)("showFooter",o.getShowFooter(t.bMT(2,11,o.sourceInfo$)))("footerLabel",o.getFooterLabel(t.bMT(3,13,o.sourceInfo$))),t.R7$(5),t.Y8G("ngSwitch",t.bMT(6,15,o.contentMode$)),t.R7$(2),t.Y8G("ngSwitchCase",o.viewContentMode.Quiz),t.R7$(3),t.Y8G("ngIf",t.bMT(11,17,o.contentMode$)===o.viewContentMode.Chapters),t.R7$(2),t.Y8G("ngIf",t.bMT(13,19,o.contentMode$)===o.viewContentMode.ChapterInfo),t.R7$(2),t.Y8G("ngIf",t.bMT(15,21,o.contentMode$)===o.viewContentMode.Quiz),t.R7$(3),t.Y8G("ngIf",t.bMT(18,23,o.sourceInfo$)))},dependencies:[b.bT,b.ux,b.e1,b.fG,Gc,Vi,Sf,ul,yo,Xp,Kc,Hp,b.Jj],styles:["[_nghost-%COMP%]{position:relative}.view-column-container[_ngcontent-%COMP%]{height:100%}.view-column-container--hide-tabs[_ngcontent-%COMP%]   .view-column-container__tabs[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),vo([(0,c.l6)(Pe.getStoryType),Eo("design:type",f.c)],qi.prototype,"storyType$",void 0),vo([(0,c.l6)(Pe.getStorySourceInfo),Eo("design:type",f.c)],qi.prototype,"sourceInfo$",void 0),vo([(0,c.l6)(E.getSelectedChapter),Eo("design:type",f.c)],qi.prototype,"chapter$",void 0),vo([(0,c.l6)(E.getSelectedChapterIndex),Eo("design:type",f.c)],qi.prototype,"chapterIndex$",void 0),vo([(0,c.l6)(E.getChapterCount),Eo("design:type",f.c)],qi.prototype,"chapterCount$",void 0),vo([(0,c.l6)(E.getStoryChapters),Eo("design:type",f.c)],qi.prototype,"chapters$",void 0),vo([(0,c.l6)(P.getContentMode),Eo("design:type",f.c)],qi.prototype,"contentMode$",void 0),vo([(0,c.l6)(G.getQuizModeActive),Eo("design:type",f.c)],qi.prototype,"quizModeActive$",void 0),vo([(0,c.l6)(xe.getSelectedBookmark),Eo("design:type",f.c)],qi.prototype,"selectedBookmark$",void 0),vo([(0,c.l6)(xe.getSelectedBookmarkViewMode),Eo("design:type",f.c)],qi.prototype,"selectedBookmarkViewMode$",void 0),vo([(0,c.l6)(ue.getVisible(h.Pagination)),Eo("design:type",f.c)],qi.prototype,"paginationVisible$",void 0);var r_,vf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ef=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const QU=(n,e)=>({"rotate-180":n,"rotate-0":e});function YU(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-pillbox",1)(1,"button",2),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggle())}),t.nrm(2,"app-icon",3),t.k0s()()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("matTooltip",o.columnToggleTooltip)("matTooltipPosition",o.tooltipPosition),t.BMQ("aria-label",o.columnToggleTooltip)("aria-expanded",!o.isIn),t.R7$(),t.Y8G("ngClass",t.l_i(5,QU,o.isIn,!o.isIn))}}class a_{get columnToggleTooltip(){return this.isIn?$localize`Open Info Panel`:$localize`Close Info Panel`}constructor(e,o,i,s){this.viewService=e,this.changeDetectorRef=o,this.store=i,this.directionality=s,this.ngUnsubscribe=new oe.B,this.isIn=!1,this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}ngOnInit(){(0,Tt.z)(this.chapter$,this.viewUI$).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{this.isIn=o.column.status===Ve.Collapse,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleToggle(){const e=this.store.selectSnapshot(P.getContentMode);this.viewService.toggleColumn(),this.viewService.toggleSearch(null,!1),e===lt.NodeInfo&&this.viewService.toggleNodeInfo(!1),e===lt.LabelInfo&&this.viewService.toggleLabelInfo(!1),this.changeDetectorRef.markForCheck()}}var gl;(r_=a_).\u0275fac=function(e){return new(e||r_)(t.rXU(zt),t.rXU(t.gRc),t.rXU(c.il),t.rXU(zs.dS))},r_.\u0275cmp=t.VBU({type:r_,selectors:[["app-view-column-toggle"]],decls:2,vars:3,consts:[["orientation","vertical","appPreventFadeout","",4,"ngIf"],["orientation","vertical","appPreventFadeout",""],["app-view-button","","buttonSize","small","data-test","viewColumnToggle","tabindex","0",3,"click","matTooltip","matTooltipPosition"],["appLogicalDir","","size","lg","icon","left-to-line",1,"rotate--animate",3,"ngClass"]],template:function(e,o){1&e&&(t.DNE(0,YU,3,8,"app-pillbox",0),t.nI1(1,"async")),2&e&&t.Y8G("ngIf",t.bMT(1,1,o.columnToggleVisible$))},dependencies:[xt,b.YU,b.bT,Qr,Hi,qe,Sn.oV,Uo,b.Jj],encapsulation:2,data:{animation:[(0,ie.hZ)("show",[(0,ie.kY)(":enter",[(0,ie.iF)({opacity:0,transform:"translateX(-32px)"}),(0,ie.i0)("300ms ease-in-out",(0,ie.iF)({opacity:1,transform:"*"}))]),(0,ie.kY)(":leave",[(0,ie.i0)("300ms ease-in-out",(0,ie.iF)({transform:"translateX(-32px)",opacity:0}))])])]},changeDetection:0}),vf([(0,c.l6)(ue.getUI),Ef("design:type",f.c)],a_.prototype,"viewUI$",void 0),vf([(0,c.l6)(E.getSelectedChapter),Ef("design:type",f.c)],a_.prototype,"chapter$",void 0),vf([(0,c.l6)(ue.getVisible(h.ColumnToggle)),Ef("design:type",f.c)],a_.prototype,"columnToggleVisible$",void 0),function(n){n.slideTransition=(0,ie.lY)([(0,ie.iF)({transform:"translateY({{ from }}%)",opacity:0}),(0,ie.i0)("{{ duration }}ms ease-out",(0,ie.iF)({transform:"translateY({{ to }})",opacity:1}))]),n.fadeIn=(0,ie.lY)([(0,ie.iF)({opacity:0}),(0,ie.i0)("{{ duration }}ms ease-out",(0,ie.iF)({opacity:1}))]),n.fadeOut=(0,ie.lY)([(0,ie.iF)({opacity:"*"}),(0,ie.i0)("{{ duration }}ms ease-in",(0,ie.iF)({opacity:0}))])}(gl||(gl={}));const qU=["*"];function KU(n,e){if(1&n&&(t.j41(0,"div",7),t.nrm(1,"app-icon",8),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("icon",o.icon)}}function JU(n,e){if(1&n&&(t.j41(0,"h3",9),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.JRh(o.title)}}function ZU(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleDismissClicked())}),t.nrm(1,"app-icon",11),t.k0s()}}function e8(n,e){if(1&n&&(t.j41(0,"div",1)(1,"div",2),t.DNE(2,KU,2,1,"div",3),t.j41(3,"div",4),t.DNE(4,JU,2,1,"h3",5),t.j41(5,"p"),t.SdG(6),t.k0s()()(),t.DNE(7,ZU,2,0,"button",6),t.k0s()),2&n){const o=t.XpG();t.AVh("message-toggle--message","message"===o.type)("message-toggle--error","error"===o.type)("message-toggle--danger","danger"===o.type)("message-toggle--notification","notification"===o.type)("message-toggle--warning","warning"===o.type)("message-toggle--rounded","rounded"===o.toggleStyle)("message-toggle--light","light"===o.theme)("message-toggle--dark","dark"===o.theme)("message-toggle--left","left"===o.toggleAlign)("message-toggle--center","center"===o.toggleAlign)("message-toggle--icon-top","top"===o.alignIcon)("message-toggle--icon-center","center"===o.alignIcon)("message-toggle--icon-bottom","bottom"===o.alignIcon),t.Y8G("@show",void 0),t.R7$(2),t.Y8G("ngIf",o.icon),t.R7$(2),t.Y8G("ngIf",o.title),t.R7$(3),t.Y8G("ngIf",o.dismiss)}}let Qp=(()=>{var n;class e{get shown(){return this._shown}set shown(i){this._shown!==i&&(this._shown=i,this.shownSubject.next(i),this.changeRef.markForCheck())}constructor(i){this.changeRef=i,this.type="message",this.theme="light",this.toggleAlign="left",this.alignIcon="top",this.showDelay=0,this.hideDelay=5e3,this.dismiss=!1,this.toggleStyle="rounded",this.handleDismiss=new oe.B,this._shown=!0,this.shownSubject=new oe.B,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initViewShownListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismissClicked(){this.handleDismiss.next()}initViewShownListeners(){this.shownSubject.pipe((0,X.p)(()=>this.hideDelay>0),(0,Pn.B)(this.hideDelay),(0,X.p)(i=>i),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this._shown=!1,this.changeRef.markForCheck()})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-message-toggle"]],inputs:{type:"type",theme:"theme",toggleAlign:"toggleAlign",icon:"icon",alignIcon:"alignIcon",title:"title",showDelay:"showDelay",hideDelay:"hideDelay",dismiss:"dismiss",toggleStyle:"toggleStyle",shown:"shown"},outputs:{handleDismiss:"handleDismiss"},ngContentSelectors:qU,decls:1,vars:1,consts:[["class","message-toggle flex flex-row items-start justify-between",3,"message-toggle--message","message-toggle--error","message-toggle--danger","message-toggle--notification","message-toggle--warning","message-toggle--rounded","message-toggle--light","message-toggle--dark","message-toggle--left","message-toggle--center","message-toggle--icon-top","message-toggle--icon-center","message-toggle--icon-bottom",4,"ngIf"],[1,"message-toggle","flex","flex-row","items-start","justify-between"],[1,"message-toggle__wrapper","flex","flex-row","flex-auto"],["class","message-toggle__icon mr-3",4,"ngIf"],[1,"message-toggle__content"],["class","font-semibold mb-1",4,"ngIf"],["class","message-toggle__icon message-toggle__dismiss",3,"click",4,"ngIf"],[1,"message-toggle__icon","mr-3"],[3,"icon"],[1,"font-semibold","mb-1"],[1,"message-toggle__icon","message-toggle__dismiss",3,"click"],["icon","times"]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,e8,8,30,"div",0)),2&i&&t.Y8G("ngIf",s.shown)},dependencies:[b.bT,qe],styles:[":root{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle{padding:16px;box-sizing:border-box;font-size:13px;line-height:20px;color:var(--message-toggle-color);background-color:var(--message-toggle-background-color)}.message-toggle--rounded{border-radius:4px}.message-toggle__icon{color:#fff;font-size:16px;background:none;border:none;color:var(--message-toggle-icon-color)}.message-toggle__content{padding:0 2px;word-break:break-word}.message-toggle__dismiss{font-size:14px;color:var(--message-toggle-color);cursor:pointer}.message-toggle--left .message-toggle__content{flex:1 1 auto}.message-toggle--center .message-toggle__wrapper{justify-content:center}.message-toggle--icon-top .message-toggle__icon{align-self:flex-start}.message-toggle--icon-center .message-toggle__icon{align-self:center}.message-toggle--icon-bottom .message-toggle__icon{align-self:flex-end}.message-toggle.message-toggle--message{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0fff0;--message-toggle-icon-color: #33cd54}.message-toggle.message-toggle--notification{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle.message-toggle--warning{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fffcf0;--message-toggle-icon-color: #ffb92e}.message-toggle.message-toggle--error,.message-toggle.message-toggle--danger{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fff3f0;--message-toggle-icon-color: #f44336}.message-toggle--dark.message-toggle--message{--message-toggle-background-color: #e3ffe5}.message-toggle--dark.message-toggle--notification{--message-toggle-background-color: #d6ecff}.message-toggle--dark.message-toggle--warning{--message-toggle-background-color: #fff6d1}.message-toggle--dark.message-toggle--error,.message-toggle--dark.message-toggle--danger{--message-toggle-background-color: #ffe2db}\n"],encapsulation:2,data:{animation:[(0,ie.hZ)("show",[(0,ie.kY)(":enter",[(0,ie.sM)(gl.fadeIn,{params:{duration:300}})]),(0,ie.kY)(":leave",[(0,ie.sM)(gl.fadeOut,{params:{duration:300}})])])]},changeDetection:0}),e})();var l_,c_;function i8(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",2)(1,"app-message-toggle",3),t.bIt("handleDismiss",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleDismiss())}),t.j41(2,"div"),t.pXf(3,0),t.k0s()()()}2&n&&(t.R7$(),t.Y8G("dismiss",!0))}class Tf{constructor(e){this.changeRef=e,this.shown=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.bookmark$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=(0,m.get)(e,"tags",[]);this.shown=o.includes("complete anatomy"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismiss(){this.shown=!1,this.changeRef.markForCheck()}}(l_=Tf).\u0275fac=function(e){return new(e||l_)(t.rXU(t.gRc))},l_.\u0275cmp=t.VBU({type:l_,selectors:[["app-view-content-warning"]],decls:2,vars:3,consts:()=>{let n;return n=$localize`:971372758a4ed342c52bb48b1081e757728573664888031257194232864: This model is not optimized for use on mobile devices. For an optimal experience, please switch to a desktop device or try our Anatomy by Regions. `,[n,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(e,o){1&e&&(t.DNE(0,i8,4,1,"div",1),t.nI1(1,"async")),2&e&&t.Y8G("ngIf",t.bMT(1,1,o.bookmark$)&&o.shown)},dependencies:[b.bT,Qp,b.Jj],styles:[".warning{position:fixed;top:0;left:0;right:0;z-index:1001}\n"],encapsulation:2,changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(xe.getSelectedBookmark),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Tf.prototype,"bookmark$",void 0);class Cf{constructor(){this.toggle=new t.bkB,this.open=!1,this.fixed=!1,this.compact=!1}handleToggleClick(){this.toggle.emit()}}(c_=Cf).\u0275fac=function(e){return new(e||c_)},c_.\u0275cmp=t.VBU({type:c_,selectors:[["app-view-drawer-header"]],inputs:{open:"open",fixed:"fixed",compact:"compact"},outputs:{toggle:"toggle"},ngContentSelectors:["*"],decls:5,vars:8,consts:[["app-view-button","","buttonSize","fill","data-test","drawerToggleButton",1,"view-drawer-header",3,"click"],[1,"view-drawer-header__content"],["size","md",1,"mx-4",3,"icon"]],template:function(e,o){if(1&e&&(t.NAR(),t.j41(0,"button",0),t.bIt("click",function(){return o.handleToggleClick()}),t.j41(1,"div",1),t.SdG(2),t.nrm(3,"app-icon",2),t.nI1(4,"async"),t.k0s()()),2&e){let i;t.AVh("view-drawer-header--fixed",o.fixed)("view-drawer-header--compact",o.compact),t.BMQ("aria-expanded",o.open),t.R7$(3),t.Y8G("icon","show"===(null==(i=t.bMT(4,6,o.viewUI$))?null:i.drawer.status)?"angle-down":"angle-up")}},dependencies:[xt,qe,b.Jj],styles:[".view-drawer-header[_ngcontent-%COMP%]{--header-height: 40px;font-size:16px;width:100%;border-bottom:1px solid #d7e0ea;min-height:var(--header-height)}.view-drawer-header--fixed[_ngcontent-%COMP%]{font-size:14px;height:var(--header-height)}.view-drawer-header--compact[_ngcontent-%COMP%]{--header-height: 24px;min-height:var(--header-height);height:var(--header-height);font-size:12px}.view-drawer-header__content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 16px;margin:0 auto;max-width:520px;min-height:var(--header-height)-4px}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(ue.getUI),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Cf.prototype,"viewUI$",void 0);var __,ei=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},ti=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const a8=["viewDrawer"],l8=["viewDrawerContent"],c8=(n,e,o)=>({"view-drawer--closed":n,"view-drawer--active":e,"view-drawer--scrollable":o});function _8(n,e){if(1&n&&(t.j41(0,"div",10),t.nrm(1,"app-spinner",11),t.nI1(2,"async"),t.k0s()),2&n){let o;const i=t.XpG();t.R7$(),t.Y8G("label",null==(o=t.bMT(2,1,i.scrim$))?null:o.label)}}function d8(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"app-view-drawer-header",12),t.bIt("toggle",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleClick(s.viewContentMode.ChapterInfo))}),t.nrm(2,"app-view-title",13),t.k0s(),t.bVm()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("compact",o.scrolled&&o.scrollThreshold),t.R7$(),t.Y8G("dynamicTitle",!0)("showMetaTitle",!1)("showSubTitle",!1)("useEllipsis",o.scrolled&&o.scrollThreshold)}}function p8(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"app-view-drawer-header",14),t.bIt("toggle",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleClick(s.viewContentMode.Quiz))}),t.nrm(2,"app-view-quiz-header"),t.k0s(),t.bVm()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("fixed",!0)("compact",o.scrolled&&o.scrollThreshold)}}function u8(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"app-view-drawer-header",14),t.nI1(2,"async"),t.bIt("toggle",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleClick(s.viewContentMode.LabelInfo))}),t.nrm(3,"app-view-title",15),t.nI1(4,"async"),t.k0s(),t.bVm()}if(2&n){let o,i;const s=t.XpG();t.R7$(),t.Y8G("fixed","collapse"===(null==(o=t.bMT(2,5,s.drawerUI$))?null:o.status))("compact",s.scrolled&&s.scrollThreshold),t.R7$(2),t.Y8G("align","center")("mainTitle",null==(i=t.bMT(4,7,s.selectedLabel$))?null:i.title)("useEllipsis",s.scrolled&&s.scrollThreshold)}}function g8(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"app-view-drawer-header",14),t.nI1(2,"async"),t.bIt("toggle",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleClick(s.viewContentMode.VisibilityLayers))}),t.nrm(3,"app-view-title",16),t.k0s(),t.bVm()}if(2&n){let o;const i=t.XpG();t.R7$(),t.Y8G("fixed","collapse"===(null==(o=t.bMT(2,3,i.drawerUI$))?null:o.status))("compact",i.scrolled&&i.scrollThreshold),t.R7$(2),t.Y8G("align","left")}}function h8(n,e){if(1&n&&(t.j41(0,"div")(1,"div",19),t.pXf(2,2),t.k0s(),t.nrm(3,"app-view-source-info",20),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.k0s()),2&n){let o;const i=t.XpG(2);t.R7$(3),t.Y8G("sourceInfo",t.bMT(4,3,i.sourceInfo$))("showSources",t.bMT(5,5,i.storyType$)===i.contentTypes.Module)("updateDate",null!==(o=null==(o=t.bMT(6,7,i.selectedBookmark$))?null:o.update_date_time)&&void 0!==o?o:null==(o=t.bMT(7,9,i.selectedBookmark$))?null:o.create_date_time)}}function m8(n,e){if(1&n&&(t.qex(0),t.nrm(1,"app-view-content-mode",17),t.nI1(2,"async"),t.DNE(3,h8,8,11,"div",18),t.nI1(4,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("compact",!!t.bMT(2,2,o.sourceInfo$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,o.sourceInfo$))}}function f8(n,e){1&n&&t.nrm(0,"app-view-quiz",23)}function S8(n,e){if(1&n&&(t.j41(0,"div",21),t.DNE(1,f8,1,0,"app-view-quiz",22),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,1,o.quizModeActive$))}}function b8(n,e){if(1&n&&(t.j41(0,"div",26),t.nrm(1,"app-content-blocks",27),t.nI1(2,"async"),t.k0s()),2&n){let o;const i=t.XpG(2);t.R7$(),t.Y8G("contentBlocks",null==(o=t.bMT(2,2,i.selectedLabel$))?null:o.contentBlocks)("layout","compact")}}function y8(n,e){if(1&n&&(t.qex(0),t.DNE(1,b8,3,4,"div",24),t.nI1(2,"async"),t.nrm(3,"app-html",25),t.nI1(4,"async"),t.bVm()),2&n){let o,i;const s=t.XpG();t.R7$(),t.Y8G("ngIf",null==(o=t.bMT(2,2,s.selectedLabel$))?null:o.contentBlocks),t.R7$(2),t.Y8G("markdownText",null==(i=t.bMT(4,4,s.selectedLabel$))?null:i.description)}}function v8(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-visibility-layers",28),t.bVm()),2&n&&(t.R7$(),t.Y8G("compact",!0))}class xn{constructor(e,o,i){this.changeDetectorRef=e,this.viewService=o,this.store=i,this.contentTypes=yt,this.viewContentMode=lt,this.openChanged=new t.bkB,this.ngUnsubscribe=new oe.B,this.viewMode=Ql,this.mode=Ql.Content,this.horizontalBreakpoint=Un,this.scrolled=!1,this.scrollThreshold=!1}ngOnInit(){this.initQuizObserver(),this.initScrollObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initQuizObserver(){const e=this.selectedChapterReady$.pipe((0,F.T)(o=>o&&o.model),(0,X.p)(o=>o),(0,Pn.B)(300));(0,Tt.z)([e,this.quizModeActive$]).pipe((0,X.p)(([o])=>o),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,o])=>{setTimeout(()=>{o&&(this.viewService.toggleDrawer(Ve.Show),this.changeDetectorRef.markForCheck())})})}initScrollObserver(){(0,hn.R)(this.viewDrawerContent.nativeElement,"scroll").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentScroll())}updateViewHeight(){const e=this.store.selectSnapshot(Kt.getSiteHeader),s=Gm(e,this.store.selectSnapshot(Kt.getSiteHeaderHeight),gp(e));this.viewDrawer.nativeElement.style.setProperty("--vh",`${s}px`)}handleToggleClick(e){const o=this.store.selectSnapshot(ue.getUIEntry(h.Drawer));switch(e){case lt.LabelInfo:this.viewService.clearSelectedLabel();break;case lt.Quiz:this.viewService.toggleDrawer(o.status===Ve.Show?Ve.Collapse:Ve.Show);break;default:this.viewService.toggleDrawer()}}handleDrawerKeydown(e){("ArrowDown"===e.key||"ArrowUp"===e.key)&&e.stopPropagation()}handleLabelBack(){this.viewService.clearSelectedLabel()}handlePreviousClick(){this.viewService.previousChapter("drawer")}handleNextClick(){this.viewService.nextChapter("drawer")}handleContentScroll(){const e=this.viewDrawerContent.nativeElement.scrollTop;this.scrollThreshold=this.viewDrawerContent.nativeElement.scrollHeight-this.viewDrawerContent.nativeElement.clientHeight>21;const s=e>0;s!==this.scrolled&&(this.scrolled=s,this.changeDetectorRef.markForCheck())}}function E8(n,e){1&n&&t.nrm(0,"app-icon",6)}function T8(n,e){1&n&&t.nrm(0,"app-icon",7)}function C8(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",2),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleFullscreenClick())}),t.j41(1,"span",3),t.EFF(2),t.k0s(),t.DNE(3,E8,1,0,"app-icon",4)(4,T8,1,0,"app-icon",5),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("buttonSize",o.buttonSize)("matTooltip",o.fullscreenToggleTooltip),t.R7$(2),t.JRh(o.fullscreenToggleTooltip),t.R7$(),t.Y8G("ngIf",o.isFullscreen),t.R7$(),t.Y8G("ngIf",!o.isFullscreen)}}function O8(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleNewTabClick())}),t.nrm(1,"app-icon",10),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("buttonSize",o.buttonSize)}}function w8(n,e){if(1&n&&(t.qex(0),t.DNE(1,O8,2,1,"button",8),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",!o.canFullscreen)}}(__=xn).\u0275fac=function(e){return new(e||__)(t.rXU(t.gRc),t.rXU(zt),t.rXU(c.il))},__.\u0275cmp=t.VBU({type:__,selectors:[["app-view-drawer"]],viewQuery:function(e,o){if(1&e&&(t.GBs(a8,5),t.GBs(l8,7)),2&e){let i;t.mGM(i=t.lsd())&&(o.viewDrawer=i.first),t.mGM(i=t.lsd())&&(o.viewDrawerContent=i.first)}},outputs:{openChanged:"openChanged"},decls:22,vars:32,consts:()=>{let n,e;return n=$localize`:459baf5634e45a7173e4f0e1920265af97fce630801176277231880295:Chapter Description`,e=$localize`:5bbf2bcdb5d3aa2b328ab66786845485b997e0e75233133710285034701:Source Information`,[["viewDrawer",""],["viewDrawerContent",""],e,["data-test","viewPageDrawer",1,"view-drawer",3,"ngClass"],["class","view-drawer__scrim",4,"ngIf"],["role","region","aria-label",n,1,"view-drawer__outer",3,"keydown"],[1,"view-drawer__inner",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"view-drawer__content",3,"appInfoScroll","ngSwitch"],["class","pt-3 pb-8",4,"ngSwitchCase"],[1,"view-drawer__scrim"],["size","large",3,"label"],[3,"toggle","compact"],[3,"dynamicTitle","showMetaTitle","showSubTitle","useEllipsis"],[3,"toggle","fixed","compact"],[3,"align","mainTitle","useEllipsis"],["mainTitle","Layers",3,"align"],[1,"mt-2",3,"compact"],[4,"ngIf"],[1,"my-4","text-sm","font-semibold","text-uppercase"],[3,"sourceInfo","showSources","updateDate"],[1,"pt-3","pb-8"],["mode","drawer",4,"ngIf"],["mode","drawer"],["appEventFence","",4,"ngIf"],[1,"text-sm",3,"markdownText"],["appEventFence",""],[3,"contentBlocks","layout"],[3,"compact"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",3,0),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.DNE(5,_8,3,3,"div",4),t.nI1(6,"async"),t.j41(7,"div",5),t.bIt("keydown",function(r){return t.eBV(i),t.Njj(o.handleDrawerKeydown(r))}),t.j41(8,"div",6),t.nI1(9,"async"),t.DNE(10,d8,3,5,"ng-container",7)(11,p8,3,2,"ng-container",7)(12,u8,5,9,"ng-container",7)(13,g8,4,5,"ng-container",7),t.j41(14,"div",8,1),t.nI1(16,"async"),t.nI1(17,"async"),t.DNE(18,m8,5,6,"ng-container",7)(19,S8,3,3,"div",9)(20,y8,5,6,"ng-container",7)(21,v8,2,1,"ng-container",7),t.k0s()()()()}if(2&e){let i,s;t.Y8G("ngClass",t.sMw(28,c8,!1===t.bMT(2,14,o.drawerVisible$),t.bMT(3,16,o.drawerVisible$),"show"===(null==(i=t.bMT(4,18,o.drawerUI$))?null:i.status))),t.R7$(5),t.Y8G("ngIf",null==(s=t.bMT(6,20,o.scrim$))?null:s.show),t.R7$(3),t.Y8G("ngSwitch",t.bMT(9,22,o.contentMode$)),t.R7$(2),t.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.Quiz),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers),t.R7$(),t.Y8G("appInfoScroll",!0)("ngSwitch",t.bMT(16,24,o.contentMode$)),t.BMQ("tabindex",t.bMT(17,26,o.drawerVisible$)?0:-1),t.R7$(4),t.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.Quiz),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),t.R7$(),t.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers)}},dependencies:[b.YU,b.bT,b.ux,b.e1,sl,bc,Z1,Jr,Ws,Gc,Vi,Sf,gf,yo,Zs,Cf,b.Jj],styles:[".view-drawer{height:100%;padding-bottom:4px}.view-drawer--active,.view-drawer--closed{background-color:#fff}.view-drawer--scrollable{min-height:0}.view-drawer--scrollable .view-drawer__content{overflow-y:scroll}.view-drawer__header{position:relative;border-bottom:1px solid #eaeff5}.view-drawer__pagination,.view-drawer__media{display:flex;align-items:center;border-right:1px solid rgba(0,0,0,.1)}.view-drawer__toggle{padding:0 16px;display:flex;align-items:center;justify-content:center;width:100%;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:600}.view-drawer__inner{height:100%;display:flex;flex-direction:column}.view-drawer__outer{outline:none;height:100%}.view-drawer__content{display:flex;flex:1 1 100%;flex-direction:column;width:100%;max-width:520px;margin:0 auto;padding:8px 16px}.view-drawer__scrim{background-color:#fff;position:absolute;display:flex;justify-content:center;align-items:center;z-index:50;inset:0}.view-drawer__pagination-tooltip{position:absolute;z-index:1000;bottom:100%;left:36px}\n"],encapsulation:2,changeDetection:0}),ei([(0,c.l6)(P.getContentMode),ti("design:type",f.c)],xn.prototype,"contentMode$",void 0),ei([(0,c.l6)(P.getScrim),ti("design:type",f.c)],xn.prototype,"scrim$",void 0),ei([(0,c.l6)(Pe.getStoryType),ti("design:type",f.c)],xn.prototype,"storyType$",void 0),ei([(0,c.l6)(Pe.getStorySourceInfo),ti("design:type",f.c)],xn.prototype,"sourceInfo$",void 0),ei([(0,c.l6)(E.getSelectedChapterTitle),ti("design:type",f.c)],xn.prototype,"selectedChapterTitle$",void 0),ei([(0,c.l6)(E.getChapterPagination),ti("design:type",f.c)],xn.prototype,"pagination$",void 0),ei([(0,c.l6)(E.getSelectedChapterReadyState),ti("design:type",f.c)],xn.prototype,"selectedChapterReady$",void 0),ei([(0,c.l6)(E.getNextChapter),ti("design:type",f.c)],xn.prototype,"nextChapter$",void 0),ei([(0,c.l6)(ye.getSelectedLabel),ti("design:type",f.c)],xn.prototype,"selectedLabel$",void 0),ei([(0,c.l6)(G.getQuizModeActive),ti("design:type",f.c)],xn.prototype,"quizModeActive$",void 0),ei([(0,c.l6)(G.getActiveQuestionIndex),ti("design:type",f.c)],xn.prototype,"activeQuestionIndex$",void 0),ei([(0,c.l6)(G.getQuestionTotal),ti("design:type",f.c)],xn.prototype,"questionTotal$",void 0),ei([(0,c.l6)(G.getQuestionsRemaining),ti("design:type",f.c)],xn.prototype,"questionRemaining$",void 0),ei([(0,c.l6)(G.getQuizSettings),ti("design:type",f.c)],xn.prototype,"quizSettings$",void 0),ei([(0,c.l6)(G.getQuizModeLocked),ti("design:type",f.c)],xn.prototype,"quizLocked$",void 0),ei([(0,c.l6)(mn.getHorizontalBreakpoint),ti("design:type",f.c)],xn.prototype,"horizontalBreakpoint$",void 0),ei([(0,c.l6)(ue.getVisible(h.Drawer)),ti("design:type",f.c)],xn.prototype,"drawerVisible$",void 0),ei([(0,c.l6)(ue.getUIEntry(h.Drawer)),ti("design:type",f.c)],xn.prototype,"drawerUI$",void 0),ei([(0,c.l6)(xe.getSelectedBookmark),ti("design:type",f.c)],xn.prototype,"selectedBookmark$",void 0);let M8=(()=>{var n;class e{constructor(i,s){this.viewService=i,this.changeDetectorRef=s,this.isFullscreen=!1,this.canFullscreen=!1,this.ngUnsubscribe=new oe.B,this.viewUI=h,this.nativePlatform=yp,this.application=bt,this.buttonSize=Xr.Default}ngOnInit(){this.canFullscreen=Po.canFullscreen(),this.initFullscreenListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFullscreenClick(){Po.toggleFullscreen()}handleNewTabClick(){this.viewService.openInNewTab()}initFullscreenListener(){Po.onFullscreenChange().pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.isFullscreen=i,this.fullscreenToggleTooltip=i?$localize`Exit Fullscreen`:$localize`Enter Fullscreen`,this.changeDetectorRef.markForCheck()})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(zt),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-fullscreen"]],inputs:{buttonSize:"buttonSize"},decls:2,vars:4,consts:()=>{let o;return o=$localize`:0ced11d3928af0572f10cfd084c3f86347d3af606283253681872253092:Open in New Tab`,[["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"buttonSize","matTooltip","click",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"click","buttonSize","matTooltip"],[1,"sr-only"],["size","lg","icon","compress",4,"ngIf"],["size","lg","icon","expand",4,"ngIf"],["size","lg","icon","compress"],["size","lg","icon","expand"],["appPreventFadeout","","app-view-button","","matTooltip",o,"matTooltipPosition","left","data-test","viewNewTab",3,"buttonSize","click",4,"ngIf"],["appPreventFadeout","","app-view-button","","matTooltip",o,"matTooltipPosition","left","data-test","viewNewTab",3,"click","buttonSize"],["icon","arrow-up-right-from-square"]]},template:function(i,s){1&i&&t.DNE(0,C8,5,5,"button",0)(1,w8,2,1,"ng-container",1),2&i&&(t.Y8G("ngIf",s.canFullscreen),t.R7$(),t.Y8G("appFlagApplication",s.application.All)("appFlagApplicationMode","exclude")("appFlagApplicationNative",s.nativePlatform.All))},dependencies:[xt,b.bT,Ep,Qr,qe,Sn.oV],encapsulation:2,changeDetection:0}),e})();function I8(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",2)(1,"app-message-toggle",3),t.bIt("handleDismiss",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleDismiss())}),t.j41(2,"div"),t.pXf(3,0),t.k0s()()()}2&n&&(t.R7$(),t.Y8G("dismiss",!0))}const ia=[];let Yp,qp,P8=(()=>{var n;class e{constructor(i,s){this.storageService=i,this.changeRef=s,this.shown=!1,this.sampling=!1}ngOnInit(){this.storageService.getLocalItem(In.Iphone12Warning)||this.testDevices()}ngOnDestroy(){this.sampling=!1}testDevices(){const i=window.matchMedia("only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"),s=window.matchMedia("only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"),r=window.matchMedia("only screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"),a=i.matches||s.matches||r.matches,l=/iPhone|iPad/.test(navigator.userAgent),_=/OS\s14/.test(navigator.userAgent);a&&l&&_&&this.startFrameSampling()}startFrameSampling(){this.sampling=!0,Yp=0,qp=Date.now();const i=()=>{this.frame()?(this.shown=!0,this.changeRef.markForCheck()):this.sampling&&requestAnimationFrame(i)};requestAnimationFrame(i)}frame(){Yp++;const i=Date.now();if(i>=qp+500){const r=Math.floor(500*Yp/(i-qp)*2);if(ia.push(r),ia.length>3&&ia.shift(),3===ia.length&&(ia[0]+ia[1]+ia[2])/3<10)return!0;qp=i,Yp=0}}handleDismiss(){this.shown=!1,this.changeRef.markForCheck(),this.storageService.setLocalItem(In.Iphone12Warning,!0)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(Le),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-iphone12-warning"]],decls:1,vars:1,consts:()=>{let o;return o=$localize`:6aa3f174a7565623c9f89ee56c05a46a791742c96041509682411192729: This model appears to be performing slowly on your device. For an optimal experience, please switch to a different device or try another model. `,[o,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(i,s){1&i&&t.DNE(0,I8,4,1,"div",1),2&i&&t.Y8G("ngIf",s.shown)},dependencies:[b.bT,Qp],styles:[".warning[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1002}"],changeDetection:0}),e})();const N8=["viewLoader"],R8=["*"];let k8=(()=>{var n;class e{constructor(i,s,r,a){this.renderer=i,this.viewService=s,this.mediaService=r,this.store=a,this.ngUnsubscribe=new oe.B}handleClick(){this.renderer.addClass(this.viewLoaderRef.nativeElement,"view-loader--disappear"),this.viewService.toggleInteract(!1),this.viewService.playChapterFromStart();const i=this.store.selectSnapshot(P.getViewLanguage),s=this.store.selectSnapshot(E.getSelectedChapter);this.store.selectSnapshot(P.getPlaythroughEnabled)||this.mediaService.getChapterAudioPlayer(s,i).then(a=>{if(a){const l=this.store.selectSnapshot(E.getSelectedChapterId);this.mediaService.playChapterAudio(l)}})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG),t.rXU(zt),t.rXU(Di),t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-loader"]],viewQuery:function(i,s){if(1&i&&t.GBs(N8,7),2&i){let r;t.mGM(r=t.lsd())&&(s.viewLoaderRef=r.first)}},ngContentSelectors:R8,decls:4,vars:0,consts:[["viewLoader",""],["role","dialog",1,"view-loader"],["role","button",3,"click"]],template:function(i,s){if(1&i){const r=t.RV6();t.NAR(),t.j41(0,"div",1,0)(2,"div",2),t.bIt("click",function(){return t.eBV(r),t.Njj(s.handleClick())}),t.SdG(3),t.k0s()()}},encapsulation:2,changeDetection:0}),e})();var d_,wf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Mf=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const D8=["logoLinkRef"],L8=["logoSpanRef"],nT=(n,e,o,i)=>({"view-logo--full-color":n,"view-logo--full-white":e,"view-logo--small-color":o,"view-logo--small-white":i});function U8(n,e){if(1&n&&t.nrm(0,"a",5,0),2&n){const o=t.XpG();t.Y8G("ngClass",t.ziG(1,nT,"color"===o.logoColor&&"full"===o.logoSize,"white"===o.logoColor&&"full"===o.logoSize,"color"===o.logoColor&&"small"===o.logoSize,"white"===o.logoColor&&"small"===o.logoSize))}}function V8(n,e){if(1&n&&t.nrm(0,"span",6,1),2&n){const o=t.XpG();t.Y8G("ngClass",t.ziG(1,nT,"color"===o.logoColor&&"full"===o.logoSize,"white"===o.logoColor&&"full"===o.logoSize,"color"===o.logoColor&&"small"===o.logoSize,"white"===o.logoColor&&"small"===o.logoSize))}}class p_{get logoSize(){return this.logoSize$.value}set logoSize(e){this.logoSize$.next(e)}get logoColor(){return this.logoColor$.value}set logoColor(e){this.logoColor$.next(e)}constructor(e,o){this.renderer=e,this.changeRef=o,this.logoDisplayMode="text",this.ngUnsubscribe=new oe.B,this.logoSize$=new He.t("full"),this.logoColor$=new He.t("color")}ngOnInit(){}ngAfterViewInit(){this.initLogoListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLogoListeners(){(0,Tt.z)([this.logoUI$,this.logoConfig$,this.logoSize$,this.logoColor$]).pipe((0,X.p)(([,e])=>!(0,m.isNil)(e)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i,s])=>{const a="logo_swap"===o.viewer.viewer_logo_setting,l=Hg(o,i,s),{logo_url:_,logo_linkout_url:d}=l;this.logoDisplayMode=e?.isHyperLink&&d?"link":"text",this.changeRef.markForCheck(),setTimeout(()=>{"link"===this.logoDisplayMode?this.setHyperlinkLogo(_,d,a):this.setSpanLogo(_,a)})})}setHyperlinkLogo(e,o,i){const s=this.logoLinkRef?.nativeElement;s&&(this.renderer.setStyle(s,"background-image",`url('${e}')`),this.renderer.setAttribute(s,"href",o),i?(this.renderer.setAttribute(s,"rel","noreferrer nofollow"),this.renderer.setAttribute(s,"title",""),this.renderer.setAttribute(s,"aria-label",$localize`link opens in a new tab`)):(this.renderer.removeAttribute(s,"rel"),this.renderer.setAttribute(s,"title",$localize`Powered by BioDigital`),this.renderer.setAttribute(s,"aria-label",$localize`Powered by BioDigital (opens in a new tab)`)))}setSpanLogo(e,o){const i=this.logoSpanRef?.nativeElement;i&&(this.renderer.setStyle(i,"background-image",`url('${e}')`),this.renderer.setAttribute(i,"title",o?"":$localize`Powered by BioDigital`))}}function j8(n,e){if(1&n&&(t.j41(0,"p"),t.EFF(1),t.qex(2),t.pXf(3,0),t.bVm(),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.SpI("",o.chapterCount()," ")}}function x8(n,e){1&n&&(t.j41(0,"p"),t.pXf(1,1),t.k0s())}function G8(n,e){if(1&n&&(t.j41(0,"div",7),t.DNE(1,j8,4,1,"p")(2,x8,2,0,"p"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.vxM(1,o.hasMultiChapter()?1:-1),t.R7$(),t.vxM(2,o.hasSkinVariants()?2:-1)}}function $8(n,e){1&n&&(t.qex(0),t.pXf(1,2),t.bVm())}function F8(n,e){1&n&&(t.qex(0),t.pXf(1,3),t.bVm())}function B8(n,e){1&n&&(t.qex(0),t.pXf(1,4),t.bVm())}function z8(n,e){if(1&n&&t.DNE(0,F8,2,0,"ng-container")(1,B8,2,0),2&n){const o=t.XpG(2);t.vxM(0,o.hasMultiChapter()?0:1)}}function W8(n,e){if(1&n&&(t.j41(0,"h1",6),t.EFF(1),t.k0s(),t.DNE(2,G8,3,2,"div",7),t.j41(3,"div",8),t.DNE(4,$8,2,0)(5,z8,2,1),t.nrm(6,"app-icon",9),t.k0s()),2&n){let o;const i=t.XpG();t.R7$(),t.SpI(" ",i.story().displayName," "),t.R7$(),t.vxM(2,i.hasMultiChapter()||i.hasSkinVariants()?2:-1),t.R7$(2),t.vxM(4,(o=i.selectedBookmarkViewMode())===i.bookmarkViewMode.Quiz?4:5)}}(d_=p_).\u0275fac=function(e){return new(e||d_)(t.rXU(t.sFG),t.rXU(t.gRc))},d_.\u0275cmp=t.VBU({type:d_,selectors:[["app-view-logo"]],viewQuery:function(e,o){if(1&e&&(t.GBs(D8,5),t.GBs(L8,5)),2&e){let i;t.mGM(i=t.lsd())&&(o.logoLinkRef=i.first),t.mGM(i=t.lsd())&&(o.logoSpanRef=i.first)}},inputs:{logoSize:"logoSize",logoColor:"logoColor"},decls:3,vars:3,consts:[["logoLinkRef",""],["logoSpanRef",""],[3,"ngSwitch"],["target","_blank","class","view-logo","data-test","viewLogo",3,"ngClass",4,"ngSwitchCase"],["class","view-logo","data-test","viewLogo",3,"ngClass",4,"ngSwitchCase"],["target","_blank","data-test","viewLogo",1,"view-logo",3,"ngClass"],["data-test","viewLogo",1,"view-logo",3,"ngClass"]],template:function(e,o){1&e&&(t.qex(0,2),t.DNE(1,U8,2,6,"a",3)(2,V8,2,6,"span",4),t.bVm()),2&e&&(t.Y8G("ngSwitch",o.logoDisplayMode),t.R7$(),t.Y8G("ngSwitchCase","link"),t.R7$(),t.Y8G("ngSwitchCase","text"))},dependencies:[b.YU,b.ux,b.e1],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.view-logo[_ngcontent-%COMP%]{pointer-events:all;background-position:center center;background-repeat:no-repeat}.view-logo[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.view-logo--small-color[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-color[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo--small-white[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-white[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo[_ngcontent-%COMP%]:not([hidden]){display:flex}.view-logo[href][_ngcontent-%COMP%]:hover{cursor:pointer}"],changeDetection:0}),wf([(0,c.l6)(E.getSelectedChapterBackground),Mf("design:type",f.c)],p_.prototype,"background$",void 0),wf([(0,c.l6)(ue.getUIEntry(h.Logo)),Mf("design:type",f.c)],p_.prototype,"logoUI$",void 0),wf([(0,c.l6)(uo.getViewLogoConfig),Mf("design:type",f.c)],p_.prototype,"logoConfig$",void 0);let iT=(()=>{var n;class e{constructor(i){this.store=i,this.bookmarkViewMode=ji,this.story=(0,oo.ot)(this.store.select(Pe.getStory)),this.chapterCount=(0,oo.ot)(this.store.select(E.getChapterCount)),this.selectedBookmarkViewMode=(0,oo.ot)(this.store.select(xe.getSelectedBookmarkViewMode)),this.skinVariant=(0,oo.ot)(this.store.select(Pe.getVariantSchema("skin"))),this.hasSkinVariants=(0,t.EWP)(()=>!(0,m.isEmpty)(this.skinVariant())),this.hasMultiChapter=(0,t.EWP)(()=>this.chapterCount()>1)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-summary-loader"]],decls:2,vars:1,consts:()=>{let o,i,s,r,a,l;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:d904f74acb72356dd3547977ca3cf29d6da259465096495468612049743:Chapters`,s=$localize`:39967f284caff71af5063e41259bb4968bff203b4142145898284245309:Skin Options Available`,r=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,a=$localize`:2c55dafd02bed135add1986e10e77ae6607285332899734440722419896:Begin Interactive Tour`,l=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[i,s,r,a,l,["tabindex","0","type","button","aria-label",o,1,"summary-loader"],[1,"text-2xl","font-bold"],[1,"summary-loader__sub-title"],[1,"summary-loader__cta"],["icon","arrow-right","appLogicalDir","",1,"ml-2"]]},template:function(i,s){1&i&&(t.j41(0,"button",5),t.DNE(1,W8,7,3),t.k0s()),2&i&&(t.R7$(),t.vxM(1,s.story()?1:-1))},dependencies:[Hi,qe],styles:['.button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;align-items:center;background:none;border-color:transparent;border-radius:4px;border-width:0;color:inherit;display:flex;font-family:Inter,sans-serif;justify-content:center;margin:0;outline:0 none;padding:0 16px;position:relative;text-align:center;text-decoration:none;transition:background-color .12s;width:100%}.button[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.button[_ngcontent-%COMP%]:focus   .button--themed[_ngcontent-%COMP%]{outline:#2d72dc solid 2px!important}.button[_ngcontent-%COMP%]:after{content:" ";background-color:#283853;border-radius:4px;display:block;position:absolute;inset:0;opacity:0;z-index:1;transition:opacity .06s}.button[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.7}.button__container[_ngcontent-%COMP%]{position:relative;z-index:2;width:100%}.button--uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.button--expanded[_ngcontent-%COMP%]{display:flex;flex:1}.button--xsmall[_ngcontent-%COMP%]{height:24px;min-width:24px;padding:0 8px;font-size:.625rem;line-height:.75rem}.button--small[_ngcontent-%COMP%]{height:32px;min-width:32px;padding:0 12px;font-size:.75rem;line-height:1rem}.button--medium[_ngcontent-%COMP%]{height:36px;min-width:36px;padding:0 16px;font-size:.75rem;line-height:1rem}.button--large[_ngcontent-%COMP%]{height:48px;min-width:48px;padding:0 16px;font-size:.875rem;line-height:1.25rem}.button--no-border[_ngcontent-%COMP%]{border-radius:0!important}.button--no-border[_ngcontent-%COMP%]:after{border-radius:0!important}.button--left[_ngcontent-%COMP%]{text-align:left}.button--themed[_ngcontent-%COMP%]{color:#374a68}.button--themed[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--themed[_ngcontent-%COMP%]:after{background-color:#d7e0ea}.button--dark[_ngcontent-%COMP%]{color:#d7e0ea}.button--dark[_ngcontent-%COMP%]:hover{color:#fff}.button--dark[_ngcontent-%COMP%]:after{background-color:#283853}.button--dark.button--flat[_ngcontent-%COMP%]{background:#374a68}.button--dark.button--default[_ngcontent-%COMP%]{background:transparent}.button--dark.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #374a68;transition:border-color .12s}.button--dark.button--outline[_ngcontent-%COMP%]:hover{border-color:#96a8c0}.button--dark.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent;display:none}.button--dark.button--text[_ngcontent-%COMP%]{background:transparent;color:#d7e0ea}.button--dark.button--text[_ngcontent-%COMP%]:hover{color:#fff}.button--dark.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--dark.button--selected[_ngcontent-%COMP%]{background-color:#2d72dc;color:#fff}.button--dark.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light[_ngcontent-%COMP%]{color:#283853}.button--light[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--light[_ngcontent-%COMP%]:after{background-color:#96a8c0}.button--light[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.6}.button--light.button--flat[_ngcontent-%COMP%]{background:#d7e0ea;font-weight:500}.button--light.button--flat.button--selected[_ngcontent-%COMP%]{background-color:#96a8c0}.button--light.button--default[_ngcontent-%COMP%]{background:transparent;color:#131c2a}.button--light.button--default[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.2}.button--light.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #96a8c0;color:#283853;transition:border-color .12s}.button--light.button--outline[_ngcontent-%COMP%]:after{display:none}.button--light.button--outline[_ngcontent-%COMP%]:hover{background:#374a680d;border-color:#374a68;color:#1c2a3f}.button--light.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent}.button--light.button--selected[_ngcontent-%COMP%]{background-color:#eaeff5}.button--light.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light.button--text[_ngcontent-%COMP%]{color:#283853}.button--light.button--text[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--light.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--primary[_ngcontent-%COMP%]{background:#de3535;color:#fff}.button--primary[_ngcontent-%COMP%]:after{background:#f9fafd}.button--primary[_ngcontent-%COMP%]:not([disabled]):hover:after{opacity:.1}.button--info[_ngcontent-%COMP%]{background:#3892dc;color:#fff}.button--info[_ngcontent-%COMP%]:after{background:#f9fafd}.button--info[_ngcontent-%COMP%]:hover:after{opacity:.1}.button--selected[_ngcontent-%COMP%]{background-color:#2d72dc}.button--disabled[_ngcontent-%COMP%]{opacity:.5}.button--circle[_ngcontent-%COMP%]{border-radius:50%}.button--circle.button--xsmall[_ngcontent-%COMP%]{width:24px}.button--circle.button--small[_ngcontent-%COMP%]{width:32px;padding:0 6px}.button--circle.button--medium[_ngcontent-%COMP%]{width:36px;padding:0 8px}.button--circle.button--large[_ngcontent-%COMP%]{width:48px}.button--circle[_ngcontent-%COMP%]:after{border-radius:50%}.button--rounded[_ngcontent-%COMP%]{border-radius:18px}.button--rounded[_ngcontent-%COMP%]:after{border-radius:18px}.summary-loader[_ngcontent-%COMP%]{border-color:transparent;background:none;border-width:0;outline:none;margin:0;pointer-events:all;background:#0006108c;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000;position:absolute;padding:36px;color:#fff;display:flex;justify-content:flex-start;align-items:flex-start;flex-direction:column;gap:8px}.summary-loader[_ngcontent-%COMP%]::-moz-focus-inner{border:0}.summary-loader[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.summary-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#000610b3}.summary-loader[_ngcontent-%COMP%]:hover   .summary-loader__cta[_ngcontent-%COMP%]{background-color:#2d72dc;border-color:#2d72dc}.summary-loader__title[_ngcontent-%COMP%]{font-size:24px;line-height:1.33em;font-weight:700}.summary-loader__sub-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;font-size:16px;line-height:1.25em;letter-spacing:.02em;text-align:left;gap:8px}.summary-loader__sub-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-child){padding-left:8px;border-left:2px solid #ffffff}.summary-loader__cta[_ngcontent-%COMP%]{width:220px;height:48px;border:1px solid #ffffff;border-radius:4px;margin-top:20px;font-weight:600px;font-size:16px;display:flex;justify-content:center;align-items:center;transition:all .25s ease-in-out}'],changeDetection:0}),e})();var u_,g_;function Q8(n,e){1&n&&t.nrm(0,"app-play-loader")}function Y8(n,e){1&n&&t.nrm(0,"app-button-loader")}function q8(n,e){1&n&&t.nrm(0,"app-hand-loader")}function K8(n,e){1&n&&t.nrm(0,"app-summary-loader")}function J8(n,e){1&n&&t.nrm(0,"div",7)}class If{constructor(e,o,i,s){this.changeRef=e,this.viewService=o,this.bookmarksService=i,this.imagesService=s,this.thumbnailURL="",this.interactionType=Ds}ngOnInit(){this.setThumbnailUrl()}handleClick(){this.viewService.toggleOnDemand(!1),this.viewService.toggleInteract(!1)}setThumbnailUrl(){this.contentType===yt.Bookmark?this.bookmarksService.getBookmarkModel(this.contentId).subscribe(e=>{this.thumbnailURL=e.thumbnail_url,this.changeRef.markForCheck()}):(this.thumbnailURL=this.imagesService.getIndexThumbnail(this.contentId),this.changeRef.markForCheck())}getPoweredByUrl(){return(typeof localBaseDirectory>"u"?"":localBaseDirectory)+"assets/images/powered-by-biodigital-logo.svg"}}(u_=If).\u0275fac=function(e){return new(e||u_)(t.rXU(t.gRc),t.rXU(zt),t.rXU(_c),t.rXU(up))},u_.\u0275cmp=t.VBU({type:u_,selectors:[["app-view-ondemand"]],inputs:{contentId:"contentId",contentType:"contentType"},decls:11,vars:10,consts:[[1,"ondemand",3,"click"],[1,"ondemand__image",3,"lazyLoad"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","ondemand__blank-overlay",4,"ngSwitchCase"],[1,"ondemand__logo"],[3,"src"],[1,"ondemand__blank-overlay"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.bIt("click",function(){return o.handleClick()}),t.nrm(1,"div",1),t.j41(2,"div",2),t.nI1(3,"async"),t.DNE(4,Q8,1,0,"app-play-loader",3)(5,Y8,1,0,"app-button-loader",3)(6,q8,1,0,"app-hand-loader",3)(7,K8,1,0,"app-summary-loader",3)(8,J8,1,0,"div",4),t.k0s(),t.j41(9,"div",5),t.nrm(10,"img",6),t.k0s()()),2&e&&(t.R7$(),t.Y8G("lazyLoad",o.thumbnailURL),t.R7$(),t.Y8G("ngSwitch",t.bMT(3,8,o.interactType$)),t.R7$(2),t.Y8G("ngSwitchCase",o.interactionType.Play),t.R7$(),t.Y8G("ngSwitchCase",o.interactionType.Button),t.R7$(),t.Y8G("ngSwitchCase",o.interactionType.Hand),t.R7$(),t.Y8G("ngSwitchCase",o.interactionType.Summary),t.R7$(),t.Y8G("ngSwitchCase",o.interactionType.None),t.R7$(2),t.Y8G("src",o.getPoweredByUrl(),t.B4B))},dependencies:[b.ux,b.e1,zc.Je,V1,j1,x1,iT,b.Jj],styles:[".ondemand__blank-overlay[_ngcontent-%COMP%]{background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.ondemand__blank-overlay[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.ondemand__image[_ngcontent-%COMP%]{position:absolute;inset:0;background-size:cover;background-repeat:no-repeat;background-position:center center;filter:blur(6px);z-index:1000}.ondemand__logo[_ngcontent-%COMP%]{position:absolute;bottom:40px;justify-content:center;width:100%;z-index:20000;display:flex}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(P.getInteractType),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],If.prototype,"interactType$",void 0);class Af{beforePrint(e){this.visible=!0,this.changeDetectorRef.markForCheck()}afterPrint(e){this.visible=!1,this.changeDetectorRef.markForCheck()}constructor(e,o){this.store=e,this.changeDetectorRef=o,this.ngUnsubscribe=new oe.B,this.visible=!1}ngOnInit(){this.initImageUrlListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initImageUrlListener(){(0,Tt.z)(this.storyChapters$,this.store.select(oi.getRegisteredThumbnails)).pipe((0,X.p)(([e,o])=>e.length>0&&o.size>0),(0,F.T)(([e,o])=>o.get(e[0].id).urls.large),(0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.imageUrl=e,this.changeDetectorRef.markForCheck()})}}(g_=Af).\u0275fac=function(e){return new(e||g_)(t.rXU(c.il),t.rXU(t.gRc))},g_.\u0275cmp=t.VBU({type:g_,selectors:[["app-view-print"]],hostBindings:function(e,o){1&e&&t.bIt("beforeprint",function(){return o.beforePrint()},!1,t.tSv)("afterprint",function(){return o.afterPrint()},!1,t.tSv)},decls:3,vars:1,consts:[[1,"view-print"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",1,"view-print__scrim"],[1,"view-print__image",3,"src"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.nrm(1,"img",1)(2,"img",2),t.k0s()),2&e&&(t.R7$(2),t.Y8G("src",o.imageUrl,t.B4B))},styles:[".view-print[_ngcontent-%COMP%]{background-color:#fff;display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10000;justify-content:space-around;margin:auto;margin-top:0!important}@media print{.view-print[_ngcontent-%COMP%]{display:flex}}.view-print__scrim[_ngcontent-%COMP%]{display:block;width:100%;height:100%;position:absolute;z-index:-1;inset:0}.view-print__image[_ngcontent-%COMP%]{display:block;flex:1 1 auto;object-fit:contain;margin:0 auto;z-index:1}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(E.getStoryChapters),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Af.prototype,"storyChapters$",void 0);const t4=["circle"],n4=["progressCircle"],i4=["progressContainer"],o4=n=>({"view-progress--active":n}),s4=n=>({"view-progress__ring--pulse":n});function r4(n,e){if(1&n&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI("",o.percent,"%")}}let a4=(()=>{var n;class e{get show(){return this._show}set show(i){setTimeout(()=>{this._show=i,this.changeDetectorRef.markForCheck()})}get percent(){return Math.floor(this._percent.value)}set percent(i){null!=i&&this._percent.next(i)}constructor(i,s){this.renderer=i,this.changeDetectorRef=s,this.ngUnsubscribe=new oe.B,this.label=$localize`Loading...`,this._show=!1,this._percent=new He.t(0)}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions(),this.initPercentObserver()}initPercentObserver(){this._percent.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.label=this.getLoadingLabel(this.percent),this.renderProgress(0===this.percent?100:this.percent),this.changeDetectorRef.markForCheck()})}initSizeObserver(){(0,hn.R)(window,"resize").pipe((0,Pn.B)(10),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(i=100){const s=this.getCircumference();return s-i/100*s}renderProgress(i){i>=100&&(i=100);const s=this.getCircumference(),r=this.getOffset(i);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}getLoadingLabel(i){return 100===i?$localize`Launching...`:$localize`Loading...`}updateDimensions(){const i=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*i),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*i),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(i-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${i}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${i}`);const s=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-progress"]],viewQuery:function(i,s){if(1&i&&(t.GBs(t4,7),t.GBs(n4,7),t.GBs(i4,7)),2&i){let r;t.mGM(r=t.lsd())&&(s.circleRef=r.first),t.mGM(r=t.lsd())&&(s.progressCircleRef=r.first),t.mGM(r=t.lsd())&&(s.progressContainerRef=r.first)}},inputs:{show:"show",percent:"percent"},decls:10,vars:10,consts:[["circle",""],["progressContainer",""],["progressCircle",""],["data-test","viewProgress","role","status","aria-live","polite",1,"view-progress",3,"ngClass"],["aria-hidden","true",1,"view-progress__circle"],[1,"view-progress__ring",3,"ngClass"],[1,"view-progress__ring-inner"],["class","view-progress__count",4,"ngIf"],[1,"view-progress__label"],[1,"view-progress__count"]],template:function(i,s){1&i&&(t.j41(0,"div",3)(1,"div",4,0),t.qSk(),t.j41(3,"svg",5,1),t.nrm(5,"circle",6,2),t.k0s(),t.DNE(7,r4,2,1,"div",7),t.joV(),t.j41(8,"div",8),t.EFF(9),t.k0s()()()),2&i&&(t.Y8G("ngClass",t.eq3(6,o4,s.show)),t.BMQ("aria-busy",s.show),t.R7$(),t.Y8G("@isOpen",s.show?"open":"closed"),t.R7$(2),t.Y8G("ngClass",t.eq3(8,s4,0===s.percent||100===s.percent)),t.R7$(4),t.Y8G("ngIf",s.percent>0&&s.percent<100),t.R7$(2),t.SpI(" ",s.label," "))},dependencies:[b.YU,b.bT],styles:[".view-progress[_ngcontent-%COMP%]{--circleSize: 35vw;pointer-events:none;position:absolute;display:flex;justify-content:center;align-items:center;inset:0;z-index:1000;transition:background-color .15s}@keyframes _ngcontent-%COMP%_progressPulse{0%{stroke-width:4}50%{stroke-width:1}to{stroke-width:4}}.view-progress--active[_ngcontent-%COMP%]{background-color:#0003}.view-progress__circle[_ngcontent-%COMP%]{transform:scale(0);width:var(--circleSize);height:var(--circleSize);border-radius:50%;background-color:#101823cc;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.view-progress__count[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;color:#fff;font-weight:700}.view-progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;color:#fffc}.view-progress__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;opacity:1;stroke-dashoffset:0;stroke-width:4;stroke:#fffc;fill:transparent;transform:rotate(-90deg)}.view-progress__ring--pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressPulse ease-in-out infinite 2s}@media (min-width: 600px){.view-progress__circle[_ngcontent-%COMP%]{width:160px;height:160px}}"],data:{animation:[(0,ie.hZ)("isOpen",[(0,ie.wk)("open",(0,ie.iF)({transform:"scale(1)"})),(0,ie.wk)("closed",(0,ie.iF)({transform:"scale(0)"})),(0,ie.kY)("closed => open",[(0,ie.i0)("300ms ease-out")]),(0,ie.kY)("open => closed",[(0,ie.i0)("150ms ease-in")])])]},changeDetection:0}),e})(),oT=(()=>{var n;class e{constructor(i){this.el=i}ngAfterContentInit(){bs()&&setTimeout(()=>{this.el.nativeElement.focus()},0)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.aKT))},n.\u0275dir=t.FsC({type:n,selectors:[["input","appAutoFocus",""]]}),e})(),l4=(()=>{var n;class e{constructor(){}onClick(i,s){s.select()}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275dir=t.FsC({type:n,selectors:[["","appSelectOnFocus",""]],hostBindings:function(i,s){1&i&&t.bIt("click",function(a){return s.onClick(a,a.target)})}}),e})();var sT=S(8851);function rT(n,e,o){Cb(n,e);const i=va(o,e.id);if(i){const s=n.successors[i]||[];s.push(e.id);const r=o.successors[i];return n.successors[i]=(0,m.uniq)(s).sort((a,l)=>r.indexOf(a)-r.indexOf(l)),n.predecessors[e.id]=i,rT(n,xi(o,i),o)}return function rw(n,e){Cb(n,e);const o=xi(n,e.id);n.roots[o.id]=o}(n,e),n}var h_,Pf=S(5478),Nf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Rf=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const d4=(n,e,o,i)=>({"tree-node--light":n,"tree-node--hidden":e,"tree-node--selected":o,"tree-node--unpickable":i}),p4=n=>({"tree-node__label--padded":n});function u4(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",14),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExpandClick(s.node,s.node.boolState.expanded))}),t.nrm(1,"app-icon",15),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("buttonTheme",o.theme),t.BMQ("aria-label",o.treeExpandLabel)("aria-expanded",o.node.boolState.expanded),t.R7$(),t.AVh("rotate-45",o.node.boolState.expanded)}}function g4(n,e){if(1&n&&(t.j41(0,"div",22),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.shortId," ")}}function h4(n,e){1&n&&t.nrm(0,"app-icon",23)}function m4(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",16),t.bIt("dblclick",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.setEditLabelMode(!0))}),t.j41(1,"div",17),t.DNE(2,g4,2,1,"div",18),t.j41(3,"div",19),t.DNE(4,h4,1,0,"app-icon",20),t.nI1(5,"async"),t.j41(6,"span",21),t.pXf(7,2),t.k0s(),t.EFF(8),t.k0s()()()}if(2&n){const o=t.XpG();t.Y8G("ngClass",t.eq3(7,p4,!o.hasChildren&&o.nested)),t.BMQ("aria-current",o.checked),t.R7$(2),t.Y8G("ngIf",o.showTreeNodeIds),t.R7$(2),t.Y8G("ngIf",t.bMT(5,5,o.perChapterTreeEnabled$)&&!1===o.node.boolState.available),t.R7$(4),t.SpI(" ",o.node.label," ")}}function f4(n,e){if(1&n){const o=t.RV6();t.j41(0,"input",24),t.bIt("blur",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleObjectLabel(s))})("keyup",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleObjectLabel(s))}),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("value",o.node.label)}}function S4(n,e){if(1&n){const o=t.RV6();t.j41(0,"input",25),t.bIt("change",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleLayerOrder(s,r.node))}),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("value",o.node.numState.layer)}}class hl{get graph(){return this._graph}set graph(e){this._graph=e,this.hasChildren=this.nodeHasChildren(this.graph,this.node?.id)}get node(){return this._node}set node(e){this._node=e,this.sanitizedID=this.graphService.sanitizeNodeID(this.node.id),this.checked=this.isNodeChecked(this.node.id);const o=this.node.id.split("-");2===o.length?(this.parentId=o[0],this.shortId=o[1]):(this.shortId=o[0],this.parentId=""),this.shortId=this.shortId.replace(/_/g," "),this.nested&&(this.hasChildren=this.nodeHasChildren(this.graph,this.node?.id)),this.changeDetection.markForCheck()}get theme(){return this._theme}set theme(e){this._theme=e}get treeExpandLabel(){return this.node.boolState.expanded?$localize`Collapse`+` ${this.node.label}`:$localize`Expand`+` ${this.node.label}`}constructor(e,o,i,s,r){this.store=e,this.graphService=o,this.sceneService=i,this.router=s,this.changeDetection=r,this.themeEnum=Hs.P,this.isLoft="module"===he.exportType,this.nested=!0,this._theme=Hs.P.Dark,this.checked=!1,this.hasChildren=!1,this.editLabelMode=!1,this.sanitizedID="",this.parentId="",this.shortId="",this.ngUnsubscribe=new oe.B}isNodeChecked(e){return this.store.selectSnapshot(Re.getNodes)[e].checked}isNodeShown(e){return this.store.selectSnapshot(Re.getNodes)[e].shown}nodeHasChildren(e,o){return!(!e||!o)&&Co(e,o).length>0}ngOnInit(){this.checkedNodesIds$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.checked=e.some(o=>o===this.node.id),this.changeDetection.markForCheck()}),this.labelEditNode$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.editLabelMode=e===this.node}),this.isEditMode=this.router.url.indexOf("/edit")>=0}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleExpandClick(e,o){this.store.dispatch(o?new cd(e):new ba(e))}handleNodeClick(e,o){e.shiftKey?this.checkNode(o):(this.setCheckedNodes(o),this.isFlyToNodeEnabled(o)&&this.store.dispatch(new To(o.id)),this.handleExpandClick(o,!o.boolState.expanded))}toggleVisible(e,o){const i=void 0===o?!this.isNodeShown(e.id):o;this.store.dispatch(new kn(i,[e.id])),this.changeDetection.markForCheck()}handleLayerOrder(e,o){const s=parseInt(e.target.value,10);this.setLayerOrder(o,s)}checkNode(e,o){const i=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new un(i,[e.id]))}setCheckedNodes(e,o){this.store.dispatch(new un(!1));const i=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new un(i,[e.id]))}setLayerOrder(e,o){this.store.dispatch(new ng([e],o)),this.changeDetection.markForCheck()}handleObjectLabel(e){const o=e.target;e instanceof KeyboardEvent?("enter"===e.key.toLowerCase()&&(this.setLabel(o.value),this.setEditLabelMode(!1)),"escape"===e.key.toLowerCase()&&this.setEditLabelMode(!1)):e instanceof FocusEvent&&"blur"===e.type&&(this.setLabel(o.value),this.setEditLabelMode(!1))}setLabel(e){this.node.label=e,this.store.dispatch(new ig(this.node.id,e))}setEditLabelMode(e){this.isEditMode&&this.store.dispatch(new _d(e?this.node:null))}isFlyToNodeEnabled(e){return!this.isEditMode&&(e.boolState.shown||this.sceneService.isObjectLoaded(e.id))}}(h_=hl).\u0275fac=function(e){return new(e||h_)(t.rXU(c.il),t.rXU(lo),t.rXU(cn),t.rXU(ut.Ix),t.rXU(t.gRc))},h_.\u0275cmp=t.VBU({type:h_,selectors:[["app-tree-nested-node"]],inputs:{layerOrderMode:"layerOrderMode",showTreeNodeIds:"showTreeNodeIds",graph:"graph",node:"node",nested:"nested",theme:"theme"},decls:17,vars:16,consts:()=>{let n,e,o;return n=$localize`:6e998fc06a19659c22cca43efa1b35515761cbb25633144232269377096:hide`,e=$localize`:f67337c708d49ce56772539ee443bac996a24f8e1504349909398224884:show`,o=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,[n,e,o,["data-test","treeNode",1,"tree-node",3,"keyup.enter","click","ngClass"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"buttonTheme","click",4,"ngIf"],["class","tree-node__label","tabindex","0","role","button",3,"ngClass","dblclick",4,"ngIf"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel","class","input",3,"value","blur","keyup",4,"ngIf"],["appEventFence","","type","text","data-test","treeNodeLayerOrder","class","input input--small tree-node__layer-order",3,"value","change",4,"ngIf"],["app-button","","buttonSize","xs","buttonShape","square","data-test","treeNodeVisible","appEventFence","",1,"tree-node__visible",3,"click","buttonTheme"],["icon","eye","data-test","treeNodeVisibleTrue","size","xs",1,"text-sm","tree-node__eye"],[1,"sr-only","tree-node__eye"],["icon","eye-slash","data-test","treeNodeVisibleFalse","size","xs",1,"text-sm","tree-node__eye-slash"],[1,"sr-only","tree-node__eye-slash"],["eventCategory","Search Node","appEventFence","",3,"theme","node"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"click","buttonTheme"],["appLogicalDir","","icon","caret-right",1,"inline-block","text-sm"],["tabindex","0","role","button",1,"tree-node__label",3,"dblclick","ngClass"],[1,"flex","flex-col"],["data-test","treeNodeId","class","uppercase text-2xs","style","opacity: 0.7",4,"ngIf"],["data-test","treeNodeLabel",1,"flex","items-center"],["icon","ban","data-test","treeNodeUnavailable","size","xs","class","mr-1 text-xs tree-node__unavailable",4,"ngIf"],[1,"sr-only"],["data-test","treeNodeId",1,"uppercase","text-2xs",2,"opacity","0.7"],["icon","ban","data-test","treeNodeUnavailable","size","xs",1,"mr-1","text-xs","tree-node__unavailable"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"blur","keyup","value"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"change","value"]]},template:function(e,o){1&e&&(t.j41(0,"div",3),t.bIt("keyup.enter",function(s){return o.handleNodeClick(s,o.node)})("click",function(s){return o.handleNodeClick(s,o.node)}),t.DNE(1,u4,2,5,"button",4)(2,m4,9,9,"div",5)(3,f4,1,1,"input",6)(4,S4,1,1,"input",7),t.j41(5,"button",8),t.bIt("click",function(){return o.toggleVisible(o.node)}),t.nrm(6,"app-icon",9),t.j41(7,"span",10),t.qex(8),t.pXf(9,0),t.bVm(),t.EFF(10),t.k0s(),t.nrm(11,"app-icon",11),t.j41(12,"span",12),t.qex(13),t.pXf(14,1),t.bVm(),t.EFF(15),t.k0s()(),t.nrm(16,"app-node-actions",13),t.k0s()),2&e&&(t.Y8G("ngClass",t.ziG(11,d4,o.theme===o.themeEnum.Light,!o.node.boolState.shown,o.checked,!o.node.boolState.pickable)),t.BMQ("data-id",o.sanitizedID),t.R7$(),t.Y8G("ngIf",o.nested&&o.hasChildren),t.R7$(),t.Y8G("ngIf",!o.editLabelMode),t.R7$(),t.Y8G("ngIf",o.editLabelMode),t.R7$(),t.Y8G("ngIf",o.layerOrderMode),t.R7$(),t.Y8G("buttonTheme",o.theme),t.R7$(5),t.SpI(" ",o.node.label,""),t.R7$(5),t.SpI(" ",o.node.label,""),t.R7$(),t.Y8G("theme",o.theme)("node",o.node))},dependencies:[b.YU,b.bT,qe,hi.Q,ea,oT,bc,Hi,b.Jj],styles:[":host{display:block}.tree-node{border-radius:4px;padding:4px;margin-bottom:4px;display:flex;align-items:center;height:100%;-webkit-user-select:none;user-select:none;min-width:200px;transition:background-color .12s}.tree-node--light{padding-right:12px}.tree-node--light:focus{outline:#2d72dc solid 2px!important;outline-offset:-2px;border-radius:4px}.tree-node--light .tree-node__label{color:#101823;font-size:.75rem;line-height:1rem}.tree-node--light.tree-node--selected{background:transparent;border-left-color:transparent}.tree-node--light.tree-node--selected .tree-node__label{color:#101823!important}.tree-node--light.tree-node--selected .tree-node__expand,.tree-node--light.tree-node--selected .tree-node__visible{color:#101823}.tree-node--light.tree-node--unpickable{border:none}.tree-node--light.tree-node--hidden .tree-node__label{color:#61779e}.tree-node--light .tree-node__expand,.tree-node--light .tree-node__visible{background-color:transparent;color:#96a8c0;border-radius:4px}.tree-node--selected{background-color:#2d72dc}.tree-node--selected .tree-node__label{color:#fff}.tree-node--unpickable{border:1px dashed #61779e}.tree-node--hidden .tree-node__expand,.tree-node--hidden .tree-node__visible,.tree-node--hidden .tree-node__label{color:#96a8c0}.tree-node--hidden .tree-node__visible{visibility:visible}.tree-node.tree-node--hidden.tree-node--selected .tree-node__expand,.tree-node.tree-node--hidden.tree-node--selected .tree-node__visible,.tree-node.tree-node--hidden.tree-node--selected .tree-node__label{color:#fff}.tree-node__label{font-size:.75rem;line-height:1rem;font-weight:400;line-height:1.3em;color:#d7e0ea;padding:8px 4px 8px 12px;display:flex;align-items:center;flex:1 1 100%;min-height:28px}.tree-node__label--padded{padding-left:36px}.tree-node__expand i{transition:transform .12s}.tree-node__expand--open app-icon{transform:rotate(45deg)}.tree-node .tree-node__expand+.tree-node__label{margin-left:-8px}.tree-node__expand,.tree-node__visible{border-radius:4px;color:#d7e0ea;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center;border:none}.tree-node__layer-order{font-size:10px;flex:0 0 56px;min-height:28px;height:28px;padding:4px;margin:2px;text-align:center}.tree-node .tree-node__unavailable{color:#de5959}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}@media (hover: hover){.tree-node__visible{visibility:hidden}.tree-node:hover,.tree-node:focus-within{cursor:pointer}.tree-node:hover .tree-node__visible,.tree-node:focus-within .tree-node__visible{visibility:visible}.tree-node:hover .tree-node__label,.tree-node:focus-within .tree-node__label{color:#fff}.tree-node--light:hover,.tree-node--light:focus-within{background-color:#d6ecff}.tree-node--light:hover .tree-node__label,.tree-node--light:focus-within .tree-node__label{color:#101823}.tree-node--light.tree-node--selected{background-color:#d6ecff}.tree-node--light.tree-node--selected:hover{background-color:#bde0ff}.tree-node--light.tree-node--selected .tree-node__label{color:#101823}.tree-node--light.tree-node--selected .tree-node__expand:hover,.tree-node--light.tree-node--selected .tree-node__visible:hover,.tree-node--light .tree-node__expand:hover,.tree-node--light .tree-node__visible:hover{background-color:transparent;color:inherit}.tree-node__expand:hover,.tree-node__visible:hover{background-color:#1c2a3f;color:#fff;cursor:pointer}.tree-node--selected .tree-node__expand:hover,.tree-node--selected .tree-node__visible:hover{background-color:#2d72dc}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:hover:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}}\n"],encapsulation:2,changeDetection:0}),Nf([(0,c.l6)(Io.getPerChapterTreeEnabled),Rf("design:type",f.c)],hl.prototype,"perChapterTreeEnabled$",void 0),Nf([(0,c.l6)(Re.getCheckedNodeIds),Rf("design:type",f.c)],hl.prototype,"checkedNodesIds$",void 0),Nf([(0,c.l6)(U.getLabelEditNode),Rf("design:type",f.c)],hl.prototype,"labelEditNode$",void 0);const b4=n=>({"tree-group--light":n});function y4(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",6),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.handleExpandClick(s,!0))}),t.k0s()}if(2&n){const o=t.XpG(2).$implicit;t.Y8G("title",o.label)}}function v4(n,e){if(1&n&&(t.j41(0,"div",4),t.DNE(1,y4,1,1,"div",5),t.nrm(2,"app-tree-group",2),t.k0s()),2&n){const o=t.XpG().$implicit,i=t.XpG();t.R7$(),t.Y8G("ngIf",i.hasChildren(o)),t.R7$(),t.Y8G("graph",i.graph)("node",o)("theme",i.theme)("layerOrderMode",i.layerOrderMode)("showTreeNodeIds",i.showTreeNodeIds)}}function E4(n,e){if(1&n&&(t.j41(0,"div",1),t.nrm(1,"app-tree-nested-node",2),t.DNE(2,v4,3,6,"div",3),t.k0s()),2&n){const o=e.$implicit,i=t.XpG();t.Y8G("ngClass",t.eq3(7,b4,i.theme===i.themeEnum.Light)),t.R7$(),t.Y8G("graph",i.graph)("node",o)("theme",i.theme)("layerOrderMode",i.layerOrderMode)("showTreeNodeIds",i.showTreeNodeIds),t.R7$(),t.Y8G("ngIf",o.boolState.expanded)}}let T4=(()=>{var n;class e{get graph(){return this._graph}set graph(i){i&&(this._graph=i,this.nodes=this.getNodes(this.graph,this.node))}get node(){return this._node}set node(i){this._node=i,this.nodes=this.getNodes(this.graph,this.node)}constructor(i,s){this.graphService=i,this.store=s,this.themeEnum=Hs.P,this.theme=Hs.P.Dark,this.nodes=[]}getNodes(i,s){const r=s?Co(i,s.id):pg(i);return this.graphService.getNodes(i,r)}countChildren(i){return Co(this.graph,i.id).length}hasChildren(i){return this.countChildren(i)>0}trackTreeNode(i,s){return s.id}handleExpandClick(i,s){this.store.dispatch(s?new cd(i):new ba(i))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(lo),t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-tree-group"]],inputs:{graph:"graph",theme:"theme",node:"node",layerOrderMode:"layerOrderMode",showTreeNodeIds:"showTreeNodeIds"},decls:1,vars:2,consts:[["class","tree-group",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tree-group",3,"ngClass"],[3,"graph","node","theme","layerOrderMode","showTreeNodeIds"],["class","tree-group__children",4,"ngIf"],[1,"tree-group__children"],["class","tree-group__collapse",3,"title","click",4,"ngIf"],[1,"tree-group__collapse",3,"click","title"]],template:function(i,s){1&i&&t.DNE(0,E4,3,9,"div",0),2&i&&t.Y8G("ngForOf",s.nodes)("ngForTrackBy",s.trackTreeNode)},dependencies:[b.YU,b.Sq,b.bT,n,hl],styles:['.tree-group[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:after{background:#eaeff5}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover{background:transparent}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#d7e0ea}.tree-group__children[_ngcontent-%COMP%]{padding-inline-start:20px;position:relative}.tree-group__collapse[_ngcontent-%COMP%]{position:absolute;inset-inline-start:0;top:0;bottom:0;width:20px;z-index:1}.tree-group__collapse[_ngcontent-%COMP%]:after{content:" ";display:block;position:absolute;width:1px;inset-inline-start:10px;top:0;bottom:0;background:#1c2a3f}.tree-group__collapse[_ngcontent-%COMP%]:hover{cursor:pointer}.tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#283853}'],changeDetection:0}),e})(),C4=(()=>{var n;class e{constructor(i,s){this.store=i,this.graphService=s,this.theme=Hs.P.Dark,this.ngUnsubscribe=new oe.B}ngAfterViewInit(){this.store.select(Re.getCheckedNodes).pipe((0,X.p)(i=>1===i.length),(0,w.Q)(this.ngUnsubscribe)).subscribe(([i])=>{setTimeout(()=>{this.scrollNodeIntoView(i.objectId)})})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}scrollNodeIntoView(i){const s=this.graphService.sanitizeNodeID(i),r=document.querySelector(`[data-id="${s}"]`);(0,m.isNil)(r)||"scrollBehavior"in document.documentElement.style&&r.scrollIntoView({behavior:"smooth",block:"nearest"})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(lo))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-tree"]],inputs:{theme:"theme",searchGraph:"searchGraph",layerOrderMode:"layerOrderMode",showTreeNodeIds:"showTreeNodeIds"},decls:1,vars:4,consts:[[3,"theme","graph","layerOrderMode","showTreeNodeIds"]],template:function(i,s){1&i&&t.nrm(0,"app-tree-group",0),2&i&&t.Y8G("theme",s.theme)("graph",s.searchGraph)("layerOrderMode",s.layerOrderMode)("showTreeNodeIds",s.showTreeNodeIds)},dependencies:[T4],changeDetection:0}),e})();function O4(n,e){1&n&&(t.j41(0,"div",5),t.pXf(1,0),t.k0s())}function w4(n,e){if(1&n&&t.nrm(0,"app-tree",6),2&n){const o=t.XpG();t.Y8G("theme",o.theme)("searchGraph",o.searchGraph)("layerOrderMode",o.layerOrderMode)("showTreeNodeIds",o.showTreeNodeIds)}}function M4(n,e){if(1&n&&(t.j41(0,"div"),t.nrm(1,"app-tree-nested-node",9),t.k0s()),2&n){const o=e.$implicit,i=t.XpG(2);t.R7$(),t.Y8G("theme",i.theme)("nested",!1)("node",o)("graph",i.prunedViewGraph)("layerOrderMode",i.layerOrderMode)("showTreeNodeIds",i.showTreeNodeIds)}}function I4(n,e){if(1&n&&(t.j41(0,"cdk-virtual-scroll-viewport",7),t.DNE(1,M4,2,6,"div",8),t.k0s()),2&n){const o=t.XpG();t.xc7("height",o.searchHeight,"px"),t.Y8G("itemSize",64),t.R7$(),t.Y8G("cdkVirtualForOf",o.searchResults)("cdkVirtualForTrackBy",o.trackTreeNode)}}let A4=(()=>{var n;class e{get query(){return this._query}set query(i){this._query=i||"",this.handleQueryChange(),void 0!==this.viewGraph&&this.numResults$.next(this.searchResults.length)}get displayMode(){return this._displayMode}set displayMode(i){null!=i&&(this._displayMode=i,this.prunedViewGraph=this.buildPrunedViewGraph(this.displayMode),this.handleQueryChange(),this.displayModeChange.emit(this.displayMode))}get viewGraph(){return this._viewGraph}set viewGraph(i){this._viewGraph=i,this.prunedViewGraph=this.buildPrunedViewGraph(this.displayMode),this.handleQueryChange(),this.changeDetectorRef.markForCheck()}constructor(i,s,r,a,l,_){this.renderer=i,this.changeDetectorRef=s,this.elementRef=r,this.sceneService=a,this.store=l,this.liveAnnouncer=_,this._query="",this._displayMode=ui.List,this.displayModeChange=new t.bkB,this.theme=Hs.P.Dark,this.treeSearchDisplayMode=ui,this.searchResults=[],this.searchHeight=0,this.ngUnsubscribe=new oe.B,this.numResults$=new He.t(0)}buildPrunedViewGraph(i){if(i===ui.List){const s=this.store.selectSnapshot(E.getSelectedChapter);if(!(0,m.isNil)(s))return Pb(this.sceneService.createViewGraph({showObjects:s.showObjects,availableObjects:s.availableObjects}))}}ngAfterViewInit(){this.renderer.listen("window","resize",i=>{this.resize()}),this.numResults$.pipe((0,Pn.B)(600)).subscribe(i=>{this.liveAnnouncer.announce(`${this.searchResults.length} structures found`)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleQueryChange(){const i=this.search(this.displayMode===ui.List?this.prunedViewGraph:this.viewGraph,this._query);this.displayMode===ui.Tree&&(this.searchGraph=function c4(n,e){let o={nodes:{},successors:{},predecessors:{},roots:{}};if(0===e.length)return o;o=e.reduce((s,r)=>rT(s,r,n),o);const i=Object.keys(n.roots);return o.roots=i.reduce((s,r)=>(r in o.roots&&(s[r]=o.roots[r]),s),{}),o}(this.viewGraph,i)),this.searchResults=i,this.resize()}resize(){this.getSearchHeight().pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.searchHeight=i,this.changeDetectorRef.markForCheck()})}getSearchHeight(){return new f.c(i=>{setTimeout(()=>{const s=this.elementRef.nativeElement.offsetHeight;null!=s&&(i.next(s),i.complete())})})}search(i,s){return function _4(n,e,o){if((0,m.isNil)(n))return[];const{sort:i}=o;e=(0,sT.TF)(e.toLowerCase());let s=Object.values(n.nodes).filter(r=>0===e.length||(0,sT.TF)(r.label.toLowerCase()).includes(e));return i?.label&&(s=s.sort((r,a)=>"asc"===i.label?r.label.localeCompare(a.label):a.label.localeCompare(r.label))),i?.depth&&(s=s.sort((r,a)=>"asc"===i.label?Math.sign(r.depth-a.depth):Math.sign(a.depth-r.depth))),s}(i,s,{sort:{label:"asc"}})}trackTreeNode(i,s){return s.id}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.sFG),t.rXU(t.gRc),t.rXU(t.aKT),t.rXU(cn),t.rXU(c.il),t.rXU(vi.Ai))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-tree-search"]],inputs:{query:"query",displayMode:"displayMode",viewGraph:"viewGraph",theme:"theme",layerOrderMode:"layerOrderMode",showTreeNodeIds:"showTreeNodeIds"},outputs:{displayModeChange:"displayModeChange"},decls:4,vars:3,consts:()=>{let o;return o=$localize`:e4e28b371f8453e22779db590cb0fe67f2a080e87839102902838664367:No results`,[o,[1,"tree-search"],["class","tree-search__empty",4,"ngIf"],["class","tree-search__tree",3,"theme","searchGraph","layerOrderMode","showTreeNodeIds",4,"ngIf"],["class","py-3",3,"itemSize","height",4,"ngIf"],[1,"tree-search__empty"],[1,"tree-search__tree",3,"theme","searchGraph","layerOrderMode","showTreeNodeIds"],[1,"py-3",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"mr-3",2,"height","64px",3,"theme","nested","node","graph","layerOrderMode","showTreeNodeIds"]]},template:function(i,s){1&i&&(t.j41(0,"div",1),t.DNE(1,O4,2,0,"div",2)(2,w4,1,4,"app-tree",3)(3,I4,2,5,"cdk-virtual-scroll-viewport",4),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",0===s.searchResults.length),t.R7$(),t.Y8G("ngIf",s.displayMode===s.treeSearchDisplayMode.Tree),t.R7$(),t.Y8G("ngIf",s.displayMode===s.treeSearchDisplayMode.List))},dependencies:[b.bT,Pf.yg,Pf.E$,Pf.d6,C4,hl],styles:[".tree-search{display:flex;flex-direction:column;flex:1 1 auto;height:100%}.tree-search__tree{flex-grow:1;width:100%;overflow-y:scroll;contain:strict}.tree-search__empty{font-size:.875rem;line-height:1.25rem;padding:12px;font-style:italic;margin-top:12px}.tree-search cdk-virtual-scroll-viewport{flex:1 1 auto}.tree-search cdk-virtual-scroll-viewport .cdk-virtual-scroll-content-wrapper{padding-right:12px}\n"],encapsulation:2,changeDetection:0}),e})();var m_,kf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Df=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const P4=["searchInput"],N4=["tabButton"],aT=n=>({"view-search__action--selected":n});class f_{constructor(e,o){this.viewService=e,this.store=o,this.application=bt,this.ngUnsubscribe=new oe.B,this.themeEnum=Hs.P,this.treeSearchDisplayMode=ui}ngOnInit(){this.initDisplayModeSubscription(),this.initSearchForm()}initDisplayModeSubscription(){this.searchDisplayMode$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{setTimeout(()=>{this.searchInput.nativeElement.focus()})})}initSearchForm(){this.searchForm=new K.gE({query:new K.MJ("")});const e=this.searchForm.controls.query;this.searchQuery$=e.valueChanges.pipe((0,Hl.Z)(e.value),(0,w.Q)(this.ngUnsubscribe))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleSearchKeyup(e){"Escape"===e.key&&(this.handleExitClick(),this.searchInput.nativeElement.blur())}handleExitClick(){this.searchForm.patchValue({query:""}),this.viewService.toggleSearch(null,!1)}toggleDisplayMode(){let e=this.store.selectSnapshot(P.getSearchDisplayMode);e=e===ui.List?ui.Tree:ui.List,this.setDisplayMode(e)}setDisplayMode(e){this.store.dispatch(new D.SetSearchDisplayMode(e))}handleTreeButtonClick(){this.setDisplayMode(ui.Tree)}handleListButtonClick(){this.setDisplayMode(ui.List)}getActiveTab(){switch(this.store.selectSnapshot(P.getSearchDisplayMode)){case ui.List:return"searchTab";case ui.Tree:return"treeTab";default:return null}}shiftFocus(e,o){e.stopPropagation();const i=this._buttonRefs.toArray(),r=(i.findIndex(a=>a.nativeElement==document.activeElement)+o+i.length)%i.length;i[r].nativeElement.focus()}}function lT(n){if(null==n)return"";const e=new RegExp(/[^a-zA-Z0-9_]/,"gi");return n.replace(e,"_")}(m_=f_).\u0275fac=function(e){return new(e||m_)(t.rXU(zt),t.rXU(c.il))},m_.\u0275cmp=t.VBU({type:m_,selectors:[["app-view-search"]],viewQuery:function(e,o){if(1&e&&(t.GBs(P4,5),t.GBs(N4,5)),2&e){let i;t.mGM(i=t.lsd())&&(o.searchInput=i.first),t.mGM(i=t.lsd())&&(o._buttonRefs=i)}},decls:28,vars:37,consts:()=>{let n,e,o,i;return n=$localize`:4c4305eb340456e2e50f1eb70a8061a4e63fc3521130690042989597231:Start typing the search term, then use tab to navigate the results`,e=$localize`:7f145ebe22cdfe1bafbe2f827b1294421bf0b1735291754977676860570:Search Anatomy`,o=$localize`:0e38ff46057c9e06e8be9f5c19870124aa84a13b5506274056947704181:Anatomy Tree`,i=$localize`:7e892ba15f2c6c17e83510e273b3e10fc32ea0164580988005648117665:Search`,[["tabButton",""],["searchInput",""],o,i,["role","dialog","cdkTrapFocus","",1,"view-search",3,"keyup.escape"],[1,"view-search__header",3,"formGroup"],[1,"view-search__actions-row"],["role","tablist",1,"view-search__actions",3,"keydown.arrowleft","keydown.arrowright"],["type","button","role","tab","id","treeTab",1,"view-search__action",3,"click","keyup.space","ngClass"],["type","button","role","tab","id","searchTab",1,"view-search__action",3,"click","keyup.space","ngClass"],[1,"view-search__input-row",3,"formGroup"],[1,"view-search__input-container"],["icon","search",1,"view-search__input-icon"],["appAutoFocus","","appSelectOnFocus","","type","search","aria-label",n,"placeholder",e,"formControlName","query",1,"view-search__input",3,"keyup"],["role","tabpanel",1,"view-search__body"],[3,"displayMode","theme","query","viewGraph","layerOrderMode","showTreeNodeIds"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",4),t.bIt("keyup.escape",function(){return t.eBV(i),t.Njj(o.handleExitClick())}),t.j41(1,"div",5)(2,"div",6)(3,"div",7),t.bIt("keydown.arrowleft",function(r){return t.eBV(i),t.Njj(o.shiftFocus(r,-1))})("keydown.arrowright",function(r){return t.eBV(i),t.Njj(o.shiftFocus(r,1))}),t.j41(4,"button",8,0),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleTreeButtonClick())})("keyup.space",function(){return t.eBV(i),t.Njj(o.handleTreeButtonClick())}),t.qex(9),t.pXf(10,2),t.bVm(),t.k0s(),t.j41(11,"button",9,0),t.nI1(13,"async"),t.nI1(14,"async"),t.nI1(15,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleListButtonClick())})("keyup.space",function(){return t.eBV(i),t.Njj(o.handleListButtonClick())}),t.qex(16),t.pXf(17,3),t.bVm(),t.k0s()()(),t.j41(18,"div",10)(19,"div",11),t.nrm(20,"app-icon",12),t.j41(21,"input",13,1),t.bIt("keyup",function(r){return t.eBV(i),t.Njj(o.handleSearchKeyup(r))}),t.k0s()()()(),t.j41(23,"div",14),t.nrm(24,"app-tree-search",15),t.nI1(25,"async"),t.nI1(26,"async"),t.nI1(27,"async"),t.k0s()()}2&e&&(t.R7$(),t.Y8G("formGroup",o.searchForm),t.R7$(3),t.Y8G("ngClass",t.eq3(33,aT,t.bMT(6,15,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)),t.BMQ("aria-selected",t.bMT(7,17,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)("tabIndex",t.bMT(8,19,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree?0:-1),t.R7$(7),t.Y8G("ngClass",t.eq3(35,aT,t.bMT(13,21,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)),t.BMQ("aria-selected",t.bMT(14,23,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)("tabIndex",t.bMT(15,25,o.searchDisplayMode$)===o.treeSearchDisplayMode.List?0:-1),t.R7$(7),t.Y8G("formGroup",o.searchForm),t.R7$(5),t.BMQ("aria-labelledby",o.getActiveTab()),t.R7$(),t.Y8G("displayMode",t.bMT(25,27,o.searchDisplayMode$))("theme",o.themeEnum.Light)("query",t.bMT(26,29,o.searchQuery$))("viewGraph",t.bMT(27,31,o.treeGraph$))("layerOrderMode",!1)("showTreeNodeIds",!1))},dependencies:[vi.kB,b.YU,oT,l4,K.me,K.BC,K.cb,qe,K.j4,K.JD,A4,b.Jj],styles:[".view-search{display:flex;flex-direction:column;height:100%}@keyframes appear{0%{background-color:transparent}}.view-search__header{flex:0 0 auto;flex-direction:column;display:flex;animation:appear .25s ease-out}.view-search__actions-row{flex:0 0 auto;display:flex;align-items:center}.view-search__actions{display:flex;height:48px;flex:1;justify-content:space-between}.view-search__action{font-size:.625rem;line-height:.75rem;text-transform:uppercase;align-items:center;background:transparent;border:none;border-bottom:2px solid transparent;color:#374a68;display:flex;flex-direction:column;flex:1;justify-content:flex-end;padding-bottom:8px;transition:all .3s ease-in-out;cursor:pointer}.view-search__action:hover:not(.view-search__action--selected){border-bottom-color:#f9fafd}.view-search__action--selected{border-bottom-color:#2d72dc;font-weight:600}.view-search__input-row{flex:0 0 auto;display:flex;padding:24px 0 12px}.view-search__input-container{background-color:#fff;border:1px solid #96a8c0;display:flex;flex-grow:1;border-radius:4px}.view-search__input-container:hover{border-color:#61779e}.view-search__input-container:focus-within{outline:#2d72dc solid 2px!important;outline-offset:-2px}.view-search__input-icon{background:0 0;display:flex;align-items:center;justify-content:center;color:#61779e;width:36px;height:36px;outline:0}.view-search__input{font-size:.875rem;line-height:1.25rem;font-weight:400;color:#131c2a;background:transparent;border:1px solid transparent;outline:none;flex:1 0 auto;padding:8px 12px 8px 0}.view-search__input::-ms-clear{display:none}.view-search__input::placeholder{color:#61779e;opacity:1}.view-search__body{flex:1 1 100%}@media not all and (-webkit-min-device-pixel-ratio: 0),not all and (min-resolution: .001dpcm){@supports (-webkit-appearance: none){.view-search__input{font-size:16px;padding:4px 8px;width:0}}}\n"],encapsulation:2,changeDetection:0}),kf([(0,c.l6)(U.getViewGraph),Df("design:type",f.c)],f_.prototype,"viewGraph$",void 0),kf([(0,c.l6)(U.getTreeGraph),Df("design:type",f.c)],f_.prototype,"treeGraph$",void 0),kf([(0,c.l6)(P.getSearchDisplayMode),Df("design:type",f.c)],f_.prototype,"searchDisplayMode$",void 0);let R4=(()=>{var n;class e{transform(i,s){return lT(i)}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=t.EJ8({name:"elementID",type:n,pure:!0}),e})();var S_,er=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},tr=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const k4=["chapterMenuTrigger"],D4=["chapter"],L4=(n,e)=>({"view-chapters__item--viewed":n,"view-chapters__item--selected":e});function U4(n,e){1&n&&t.nrm(0,"app-view-pagination",14),2&n&&t.Y8G("showCount",!1)}function V4(n,e){if(1&n){const o=t.RV6();t.qex(0),t.nrm(1,"app-pillbox-divider"),t.j41(2,"button",15,2),t.bIt("menuOpened",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleChapterMenuOpen())}),t.j41(4,"div",16)(5,"div",17)(6,"span",18),t.pXf(7,4),t.k0s(),t.j41(8,"div",19),t.EFF(9),t.nI1(10,"async"),t.nI1(11,"async"),t.k0s(),t.j41(12,"div",20),t.EFF(13),t.nI1(14,"async"),t.qex(15),t.pXf(16,5),t.bVm(),t.EFF(17),t.nI1(18,"async"),t.k0s()(),t.j41(19,"div",21),t.nrm(20,"app-icon",22),t.k0s()()(),t.bVm()}if(2&n){const o=t.XpG(2),i=t.sdS(6);t.R7$(2),t.Y8G("matMenuTriggerFor",i),t.R7$(7),t.SpI(" ",o.getFormattedChapterTitle(t.bMT(10,4,o.chapterTitle$),t.bMT(11,6,o.chapterIndex$))," "),t.R7$(4),t.SpI(" ",t.bMT(14,8,o.chapterIndex$)+1," "),t.R7$(4),t.SpI(" ",t.bMT(18,10,o.chapterCount$)," ")}}function j4(n,e){if(1&n&&(t.j41(0,"div",11),t.DNE(1,U4,1,1,"app-view-pagination",12),t.nI1(2,"async"),t.DNE(3,V4,21,12,"ng-container",13),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.paginationVisible$)),t.R7$(2),t.Y8G("ngIf",o.showTitle)}}function x4(n,e){if(1&n&&(t.j41(0,"div",24)(1,"span",25),t.EFF(2),t.nI1(3,"async"),t.nI1(4,"async"),t.k0s()()),2&n){const o=t.XpG(2);t.R7$(2),t.JRh(o.getFormattedChapterTitle(t.bMT(3,1,o.chapterTitle$),t.bMT(4,3,o.chapterIndex$)))}}function G4(n,e){if(1&n&&t.DNE(0,x4,5,5,"div",23),2&n){const o=t.XpG();t.Y8G("ngIf",o.showTitle)}}function $4(n,e){1&n&&(t.j41(0,"span",18),t.pXf(1,6),t.k0s())}function F4(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",26,3),t.nI1(2,"async"),t.nI1(3,"elementID"),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.handleChapterClick(s))}),t.nrm(4,"div",27),t.j41(5,"div",28),t.EFF(6),t.k0s(),t.DNE(7,$4,2,0,"span",29),t.nI1(8,"async"),t.k0s()}if(2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.Y8G("ngClass",t.l_i(13,L4,s.isViewed(o.id),o.id===t.bMT(2,7,s.selectedChapterId$))),t.BMQ("data-chapter-id",t.bMT(3,9,o.id)),t.R7$(4),t.Y8G("defaultImage",s.defaultImage)("lazyLoad",s.getChapterThumb(o.id)),t.R7$(2),t.Lme(" ",i+1,". ",s.getFormattedChapterTitle(o.displayName,i)," "),t.R7$(),t.Y8G("ngIf",o.id===t.bMT(8,11,s.selectedChapterId$))}}class Vo{constructor(e,o){this.viewService=e,this.store=o,this.viewUI=h,this.showTitle=!0,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png",this.ngUnsubscribe=new oe.B}getChapterThumb(e){const i=this.store.selectSnapshot(oi.getRegisteredThumbnails).get(e);return i?i.snapshot||i.urls.small:""}getFormattedChapterTitle(e,o){return e||$localize`Chapter`+` ${o+1}`}isViewed(e){return this.store.selectSnapshot(E.getChaptersViewed).some(o=>o===e)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterMenuOpen(){setTimeout(()=>{this.scrollToSelectedChapter()})}handleNextClick(){this.viewService.nextChapter("titleOnly")}handleChapterClick(e){this.viewService.selectChapter(e)}handlePreviousClick(){this.viewService.previousChapter("titleOnly")}scrollToSelectedChapter(){const e=lT(this.store.selectSnapshot(E.getSelectedChapterId));this.chapters.find(i=>i.nativeElement.dataset.chapterId===e)?.nativeElement.scrollIntoView({block:"center"})}}(S_=Vo).\u0275fac=function(e){return new(e||S_)(t.rXU(zt),t.rXU(c.il))},S_.\u0275cmp=t.VBU({type:S_,selectors:[["app-view-title-only"]],viewQuery:function(e,o){if(1&e&&(t.GBs(k4,5),t.GBs(D4,5,t.aKT)),2&e){let i;t.mGM(i=t.lsd())&&(o.chapterMenuTrigger=i.first),t.mGM(i=t.lsd())&&(o.chapters=i)}},inputs:{showTitle:"showTitle"},decls:9,vars:7,consts:()=>{let n,e,o;return n=$localize`:0498f53592b97136a56a48a29c54aea03a15b5e09209125563388589034:Chapter List`,e=$localize`:169eed2bc3e08e1bea977bcc5d799379f6b8a7585881876145178332550:of`,o=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["staticTitle",""],["chapterMenu","matMenu"],["chapterMenuTrigger","matMenuTrigger"],["chapter",""],n,e,o,["orientation","horizontal","data-test","viewTitleOnly","appPreventFadeout","",1,"relative"],["class","flex w-full","style","min-width: 0",4,"ngIf","ngIfElse"],[1,"view-chapters"],["mat-menu-item","","class","view-chapters__item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"flex","w-full",2,"min-width","0"],["data-test","viewFloatingPagination","buttonSize","small",3,"showCount",4,"ngIf"],[4,"ngIf"],["data-test","viewFloatingPagination","buttonSize","small",3,"showCount"],["app-view-button","","data-test","viewChaptersButton","buttonSize","small",1,"w-full",2,"min-width","0",3,"menuOpened","matMenuTriggerFor"],[1,"flex","flex-row","w-full"],[1,"grow",2,"overflow","hidden","text-align","start","padding","0 8px"],[1,"sr-only"],[1,"view-title-only__title","view-title-only__title--truncated"],[1,"view-title-only__count"],[1,"view-title-only__icon"],["icon","angle-down","size","lg"],["class","view-title-only__title view-title-only__title--static","data-test","viewStaticTitle",4,"ngIf"],["data-test","viewStaticTitle",1,"view-title-only__title","view-title-only__title--static"],[1,"view-title-only__title--truncated"],["mat-menu-item","",1,"view-chapters__item",3,"click","ngClass"],[1,"view-chapters__thumb",3,"defaultImage","lazyLoad"],[1,"view-chapters__title"],["class","sr-only",4,"ngIf"]]},template:function(e,o){if(1&e&&(t.j41(0,"app-pillbox",7),t.DNE(1,j4,4,4,"div",8),t.nI1(2,"async"),t.DNE(3,G4,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.j41(5,"mat-menu",9,1),t.DNE(7,F4,9,16,"button",10),t.nI1(8,"async"),t.k0s()),2&e){const i=t.sdS(4);t.R7$(),t.Y8G("ngIf",t.bMT(2,3,o.paginationVisible$))("ngIfElse",i),t.R7$(6),t.Y8G("ngForOf",t.bMT(8,5,o.chapters$))}},dependencies:[xt,b.YU,b.Sq,b.bT,Qr,qe,zc.Je,jn.kk,jn.fb,jn.Cp,Uo,Rp,Js,b.Jj,R4],styles:[".view-title-only{display:flex;align-items:center}.view-title-only__title{font-size:.875rem;line-height:1.25rem;font-weight:600;color:#131c2a}.view-title-only__title--static{padding:0 12px;min-height:40px;display:flex;align-items:center;min-width:0}.view-title-only__title--truncated{overflow:hidden;text-overflow:ellipsis}.view-title-only__count{font-size:10px;text-transform:uppercase;color:#374a68}.view-title-only__icon{display:flex;align-items:center;padding:0 8px}.view-chapters{min-width:300px;max-height:228px;overflow:auto}.view-chapters button.mat-mdc-menu-item{width:100%;height:auto;font-size:.75rem;line-height:1rem}.view-chapters div.mat-mdc-menu-content{padding:0}.view-chapters .mat-mdc-menu-item-text{display:flex;line-height:1.4em!important}.view-chapters__item{height:auto;white-space:normal;display:flex!important;padding:12px 20px!important;background-color:transparent;width:240px;transition:background-color 125ms,color 125ms}.view-chapters__item:first-of-type{border-top-left-radius:4px;border-top-right-radius:4px}.view-chapters__item:last-of-type{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.view-chapters__item:hover{cursor:pointer;background:#eaeff5}.view-chapters__item--selected{background-color:#2d72dc!important;--mat-menu-item-label-text-color: #ffffff}.view-chapters__thumb{background-size:cover;background-color:#f9fafd;border-radius:4px;background-repeat:no-repeat;border:1px solid #eaeff5;flex:0 0 52px;height:52px;width:52px;transition:border-color .1s}.view-chapters__title{overflow-wrap:break-word;padding-inline-start:16px;word-break:break-word;white-space:normal;display:flex;flex-grow:1;font-weight:500}\n"],encapsulation:2,changeDetection:0}),er([(0,c.l6)(E.getSelectedChapterTitle),tr("design:type",f.c)],Vo.prototype,"chapterTitle$",void 0),er([(0,c.l6)(E.getSelectedChapterIndex),tr("design:type",f.c)],Vo.prototype,"chapterIndex$",void 0),er([(0,c.l6)(E.getChapterCount),tr("design:type",f.c)],Vo.prototype,"chapterCount$",void 0),er([(0,c.l6)(E.getStoryChapters),tr("design:type",f.c)],Vo.prototype,"chapters$",void 0),er([(0,c.l6)(E.getSelectedChapterId),tr("design:type",f.c)],Vo.prototype,"selectedChapterId$",void 0),er([(0,c.l6)(oi.getRegisteredThumbnails),tr("design:type",f.c)],Vo.prototype,"thumbnails$",void 0),er([(0,c.l6)(E.getChaptersViewed),tr("design:type",f.c)],Vo.prototype,"chaptersViewed$",void 0),er([(0,c.l6)(ue.getVisible(h.Pagination)),tr("design:type",f.c)],Vo.prototype,"paginationVisible$",void 0);let B4=(()=>{var n;class e{constructor(i,s){this.dialogRef=i,this.data=s,this.config=s}handleCloseClick(){this.dialogRef.close()}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(pt.Vh))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-video-dialog"]],decls:4,vars:2,consts:[["role","dialog","aria-modal","true",1,"video-dialog"],["mode","full",1,"video-dialog__video",3,"sources"],["type","button","app-view-button","","buttonShape","rounded","buttonTheme","white","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"video-dialog__close",3,"click"],["icon","times"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"app-video-view",1),t.j41(2,"button",2),t.bIt("click",function(){return s.handleCloseClick()}),t.nrm(3,"app-icon",3),t.k0s()()),2&i&&(t.BMQ("aria-label",(s.config.title||"")+" Video Dialog"),t.R7$(),t.Y8G("sources",s.config.videoSources))},dependencies:[qe,E1,xt],styles:[".video-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.video-dialog__video[_ngcontent-%COMP%]{display:block;max-width:100%}.video-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;inset-inline-end:24px}"],changeDetection:0}),e})();const Lf=[{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.mpd",type:"application/dash+xml"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.m3u8",type:"application/x-mpegURL"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.0000022.jpg",type:"image/jpeg"}];var oa,so=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Rt=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let vn=((oa=class{constructor(e){this.store=e}static getStacksForChapter(e){return e.stacksForChapter??{}}static getUndoStack(e,o){return e[o]?.undoStack??[]}static getRedoStack(e,o){return e[o]?.redoStack??[]}static canUndo(e){return e.length>0}static canRedo(e){return e.length>0}static getUndoCount(e){return e.length}reset(e,o){e.patchState(re.jM(e.getState(),i=>{i.stacksForChapter={}}))}undoAll(e,o){const i=e.getState();if(void 0===i.stacksForChapter[o.chapterId])return;const s=[...i.stacksForChapter[o.chapterId].undoStack].reverse(),r=s.flat().reduce((l,_)=>(void 0===l[_.patchAction]&&(l[_.patchAction]={action:_.patchAction,patches:[]}),l[_.patchAction].patches=[...l[_.patchAction].patches,..._.inverse],l),{});Object.keys(r).forEach(l=>{e.dispatch(new r[l].action(r[l].patches))});const a=re.jM(i,l=>{l.stacksForChapter[o.chapterId].undoStack=[],l.stacksForChapter[o.chapterId].redoStack=s});e.patchState(a)}preserveState(e,o){const i=this.store.selectSnapshot(E.getSelectedChapterId),s=re.jM(e.getState(),r=>{0===o.patches.length||o.patches.some(l=>0===l.forward.length)&&o.patches.some(l=>0===l.inverse.length)||(void 0===r.stacksForChapter[i]&&(r.stacksForChapter[i]={redoStack:[],undoStack:[]}),r.stacksForChapter[i].redoStack=[],r.stacksForChapter[i].undoStack.push(o.patches))});e.patchState(s)}redo(e,o){const i=e.getState(),s=(0,m.get)(i.stacksForChapter[o.chapterId],"redoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=re.jM(i,l=>{l.stacksForChapter[o.chapterId].redoStack.pop(),l.stacksForChapter[o.chapterId].undoStack.push(r)});e.patchState(a),r.forEach(l=>{e.dispatch(new l.patchAction(l.forward))})}undo(e,o){const i=e.getState(),s=(0,m.get)(i.stacksForChapter[o.chapterId],"undoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=re.jM(i,l=>{l.stacksForChapter[o.chapterId].undoStack.pop(),l.stacksForChapter[o.chapterId].redoStack.push(r)});e.patchState(a),r.forEach(l=>{e.dispatch(new l.patchAction(l.inverse))})}}).\u0275fac=function(e){return new(e||oa)(t.KVO(c.il))},oa.\u0275prov=t.jDH({token:oa,factory:oa.\u0275fac}),oa);so([(0,c.rc)(Ut.Reset),Rt("design:type",Function),Rt("design:paramtypes",[Object,Ut.Reset]),Rt("design:returntype",void 0)],vn.prototype,"reset",null),so([(0,c.rc)(Ut.UndoAll),Rt("design:type",Function),Rt("design:paramtypes",[Object,Ut.UndoAll]),Rt("design:returntype",void 0)],vn.prototype,"undoAll",null),so([(0,c.rc)(Ut.SavePatches),Rt("design:type",Function),Rt("design:paramtypes",[Object,Ut.SavePatches]),Rt("design:returntype",void 0)],vn.prototype,"preserveState",null),so([(0,c.rc)(Ut.Redo),Rt("design:type",Function),Rt("design:paramtypes",[Object,Ut.Redo]),Rt("design:returntype",void 0)],vn.prototype,"redo",null),so([(0,c.rc)(Ut.Undo),Rt("design:type",Function),Rt("design:paramtypes",[Object,Ut.Undo]),Rt("design:returntype",void 0)],vn.prototype,"undo",null),so([(0,c.MD)([vn]),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype",Object)],vn,"getStacksForChapter",null),so([(0,c.MD)([vn.getStacksForChapter,E.getSelectedChapterId]),Rt("design:type",Function),Rt("design:paramtypes",[Object,String]),Rt("design:returntype",Array)],vn,"getUndoStack",null),so([(0,c.MD)([vn.getStacksForChapter,E.getSelectedChapterId]),Rt("design:type",Function),Rt("design:paramtypes",[Object,String]),Rt("design:returntype",Array)],vn,"getRedoStack",null),so([(0,c.MD)([vn.getUndoStack]),Rt("design:type",Function),Rt("design:paramtypes",[Array]),Rt("design:returntype",Boolean)],vn,"canUndo",null),so([(0,c.MD)([vn.getRedoStack]),Rt("design:type",Function),Rt("design:paramtypes",[Array]),Rt("design:returntype",Boolean)],vn,"canRedo",null),so([(0,c.MD)([vn.getUndoStack]),Rt("design:type",Function),Rt("design:paramtypes",[Array]),Rt("design:returntype",Number)],vn,"getUndoCount",null),vn=so([(0,c.Um)({injectContainerState:!1}),(0,c.Uw)({name:"undo",defaults:{stacksForChapter:{}}}),Rt("design:paramtypes",[c.il])],vn);var b_,v_,Uf=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Vf=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};class y_{constructor(e,o,i){this.store=e,this.visibilityLayersService=o,this.changeDetectorRef=i,this.accessibleLabel=$localize`layer slider`,this.percent=100,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initIndexPositionObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initIndexPositionObserver(){(0,Tt.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,X.p)(([e,o,i])=>!(0,m.isNil)(e)&&!(0,m.isNil)(o)&&!(0,m.isNil)(i)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{const s=this.visibilityLayersService.indexPositionToFraction(i,e,o);this.percent=this.visibilityLayersService.fractionToPercent(s),this.changeDetectorRef.markForCheck()})}handleDragEnded(e){this.syncSliderLayers(e,!1,!0)}handleTrackClicked(e){this.syncSliderLayers(e,!1,!0)}handlePercentChanged(e){this.syncSliderLayers(e,!0,!1)}syncSliderLayers(e,o,i){const s=this.store.selectSnapshot(E.getSelectedChapterId),r=this.store.selectSnapshot(E.getSelectedChapterCurrentLayers),a=this.visibilityLayersService.percentToFraction(e),l=this.visibilityLayersService.fractionToIndex(r,a),_=this.visibilityLayersService.fractionToPosition(r,a,l);o&&this.visibilityLayersService.syncLayersToScene(r,l,_,!1),i&&this.visibilityLayersService.syncLayersToState(s,l,_)}}(b_=y_).\u0275fac=function(e){return new(e||b_)(t.rXU(c.il),t.rXU(cs),t.rXU(t.gRc))},b_.\u0275cmp=t.VBU({type:b_,selectors:[["app-view-layers-slider"]],decls:4,vars:3,consts:()=>{let n;return n=$localize`:78670204058ee08d827f2323fab98b7520c7c51e7032204075609591368: Changing the value of the slider will modify visibility of different layers of the model `,[n,[1,"flex","justify-center","w-full",2,"height","200px"],[1,"sr-only"],["sliderAxis","y",3,"percentChanged","dragEnded","trackClicked","percent","showTrack","accessibleLabel"]]},template:function(e,o){1&e&&(t.j41(0,"div",1)(1,"span",2),t.pXf(2,0),t.k0s(),t.j41(3,"app-view-slider",3),t.bIt("percentChanged",function(s){return o.handlePercentChanged(s)})("dragEnded",function(s){return o.handleDragEnded(s)})("trackClicked",function(s){return o.handleTrackClicked(s)}),t.k0s()()),2&e&&(t.R7$(3),t.Y8G("percent",o.percent)("showTrack",!0)("accessibleLabel",o.accessibleLabel))},dependencies:[U1],styles:['.view-layers-slider[_ngcontent-%COMP%]{--track-width: 5px;height:200px;width:40px;display:flex;justify-content:center}.view-layers-slider--disabled[_ngcontent-%COMP%]{opacity:.25;pointer-events:none}.view-layers-slider__group[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;width:28px;height:100%}.view-layers-slider__track[_ngcontent-%COMP%]{cursor:pointer;position:absolute;background:#96a8c099;z-index:1;width:var(--track-width);border-radius:var(--track-width);top:14px;bottom:14px}.view-layers-slider__bar[_ngcontent-%COMP%]{position:absolute;background:#374a68;width:var(--track-width);border-radius:var(--track-width);z-index:2;height:0;top:0;pointer-events:none}.view-layers-slider__handle[_ngcontent-%COMP%]{cursor:pointer;width:28px;height:28px;margin-top:-14px;top:14px;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-layers-slider__handle[_ngcontent-%COMP%]:focus{outline:none;border:none}.view-layers-slider__handle--hide[_ngcontent-%COMP%]{display:none}.view-layers-slider__handle[_ngcontent-%COMP%]:after{content:"";width:12px;height:12px;border-radius:6px;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-layers-slider__handle[_ngcontent-%COMP%]:hover:after, .view-layers-slider__handle[_ngcontent-%COMP%]:focus:after{background:#2d72dc}'],changeDetection:0}),Uf([(0,c.l6)(E.getSelectedChapterCurrentLayers),Vf("design:type",f.c)],y_.prototype,"selectedChapterCurrentLayers$",void 0),Uf([(0,c.l6)(E.getSelectedChapterCurrentLayersIndex),Vf("design:type",f.c)],y_.prototype,"selectedChapterCurrentLayersIndex$",void 0),Uf([(0,c.l6)(E.getSelectedChapterCurrentLayersPosition),Vf("design:type",f.c)],y_.prototype,"selectedChapterCurrentLayersPosition$",void 0);class jf{constructor(e,o){this.viewService=e,this.directionality=o,this.toolEnum=Ct,this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleSelectTool(e){this.viewService.selectTool(e)}}(v_=jf).\u0275fac=function(e){return new(e||v_)(t.rXU(zt),t.rXU(zs.dS))},v_.\u0275cmp=t.VBU({type:v_,selectors:[["app-view-tools"]],inputs:{focusedTool:"focusedTool"},decls:13,vars:27,consts:()=>{let n,e,o,i,s,r,a,l,_;return n=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,e=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,o=$localize`:a0901bc2126d683a458d466c16ed7091158c9f243594337191936891611:select objects tool`,i=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,s=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,r=$localize`:630279daf1cfcb772a708396cd5fc256e028bf3e8856484494746251991:hide objects tool`,a=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,l=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,_=$localize`:06e2cd276f0cc0a33cbadb3ad0e1ea51706545222387689453887609648:fade objects tool`,[["appPreventFadeout","","orientation","vertical","role","toolbar","tabindex","-1","aria-orientation","vertical",1,"view-tools"],["app-view-button","","buttonSize","small","data-test","viewToolsSelect","aria-label",n,"matTooltip",e,"role","radio","aria-label",o,"tabindex","-1",3,"click","addFocusStyle","matTooltipPosition","buttonTheme","id"],["size","lg","icon","mouse-pointer","aria-hidden","true"],["app-view-button","","buttonSize","small","data-test","viewToolsHide","aria-label",i,"matTooltip",s,"role","radio","aria-label",r,"tabindex","-1",3,"click","addFocusStyle","matTooltipPosition","buttonTheme","id"],["size","lg","icon","eye-slash","aria-hidden","true"],["app-view-button","","buttonSize","small","data-test","viewToolsFade","aria-label",a,"matTooltip",l,"role","radio","aria-label",_,"tabindex","-1",3,"click","addFocusStyle","matTooltipPosition","buttonTheme","id"],["size","lg","icon","adjust","aria-hidden","true"]]},template:function(e,o){1&e&&(t.j41(0,"app-pillbox",0)(1,"button",1),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){return o.handleSelectTool(o.toolEnum.Select)}),t.nrm(4,"app-icon",2),t.k0s(),t.j41(5,"button",3),t.nI1(6,"async"),t.nI1(7,"async"),t.bIt("click",function(){return o.handleSelectTool(o.toolEnum.Hide)}),t.nrm(8,"app-icon",4),t.k0s(),t.j41(9,"button",5),t.nI1(10,"async"),t.nI1(11,"async"),t.bIt("click",function(){return o.handleSelectTool(o.toolEnum.Fade)}),t.nrm(12,"app-icon",6),t.k0s()()),2&e&&(t.R7$(),t.Y8G("addFocusStyle",o.focusedTool===o.toolEnum.Select)("matTooltipPosition",o.tooltipPosition)("buttonTheme",t.bMT(2,15,o.activeTool$)===o.toolEnum.Select?"blue-fill":"transparent-fill")("id","viewTools"+o.toolEnum.Select),t.BMQ("aria-current",t.bMT(3,17,o.activeTool$)===o.toolEnum.Select),t.R7$(4),t.Y8G("addFocusStyle",o.focusedTool===o.toolEnum.Hide)("matTooltipPosition",o.tooltipPosition)("buttonTheme",t.bMT(6,19,o.activeTool$)===o.toolEnum.Hide?"blue-fill":"transparent-fill")("id","viewTools"+o.toolEnum.Hide),t.BMQ("aria-current",t.bMT(7,21,o.activeTool$)===o.toolEnum.Hide),t.R7$(4),t.Y8G("addFocusStyle",o.focusedTool===o.toolEnum.Fade)("matTooltipPosition",o.tooltipPosition)("buttonTheme",t.bMT(10,23,o.activeTool$)===o.toolEnum.Fade?"blue-fill":"transparent-fill")("id","viewTools"+o.toolEnum.Fade),t.BMQ("aria-current",t.bMT(11,25,o.activeTool$)===o.toolEnum.Fade))},dependencies:[xt,Qr,qe,Sn.oV,Uo,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(U.getActiveTool),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],jf.prototype,"activeTool$",void 0);var E_,Wt=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Xt=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const H4=["viewMenu"],Q4=["viewQuizMenu"];function Y4(n,e){1&n&&t.nrm(0,"app-icon",47)}function q4(n,e){1&n&&t.nrm(0,"app-icon",48)}function K4(n,e){1&n&&t.nrm(0,"app-icon",49)}function J4(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",42),t.nI1(1,"async"),t.bIt("mousedown",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSecretXRTriggerDown())})("mouseup",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSecretXRTriggerUp())})("touchstart",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSecretXRTriggerDown())})("touchend",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSecretXRTriggerUp())})("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleToggleBar("selection"))})("keyup.escape",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleCloseBar())})("keyup.arrowup",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.switchTool(-1))})("keyup.arrowdown",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.switchTool(1))}),t.j41(2,"div",43),t.nI1(3,"async"),t.DNE(4,Y4,1,0,"app-icon",44)(5,q4,1,0,"app-icon",45)(6,K4,1,0,"app-icon",46),t.k0s()()}if(2&n){const o=t.XpG(2);t.Y8G("buttonTheme","selection"===o.openBar?"blue-fill":"transparent-fill")("matTooltipPosition",o.tooltipPosition),t.BMQ("aria-activedescendant","viewTools"+o.focusedTool)("aria-expanded",t.bMT(1,7,"selection"===o.openBar&&o.toolsVisible$)),t.R7$(2),t.Y8G("ngSwitch",t.bMT(3,9,o.activeTool$)),t.R7$(3),t.Y8G("ngSwitchCase",o.toolEnum.Hide),t.R7$(),t.Y8G("ngSwitchCase",o.toolEnum.Fade)}}function Z4(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",50),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleLayers())}),t.nrm(4,"app-icon",51),t.k0s()}if(2&n){let o;const i=t.XpG(2);t.Y8G("buttonTheme","show"===(null==(o=t.bMT(1,4,i.visibilityLayersUI$))?null:o.status)?"blue-fill":"transparent-fill")("matTooltipPosition",i.tooltipPosition),t.BMQ("data-test-visibility-layers",t.bMT(2,6,i.visibilityLayersVisible$))("data-test-skin-layers",t.bMT(3,8,i.skinLayersVisible$))}}function eV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",52),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSearch())}),t.nrm(3,"app-icon",53),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("buttonTheme","show"===t.bMT(1,3,o.searchStatus$)?"blue-fill":"transparent-fill")("matTooltipPosition",o.tooltipPosition),t.BMQ("aria-pressed","show"===t.bMT(2,5,o.searchStatus$))}}function tV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",54),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleDraw())}),t.nrm(1,"app-icon",55),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("matTooltipPosition",o.tooltipPosition)}}function nV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",57),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.toggleXRModeClick("immersive-vr"))}),t.nrm(4,"app-icon",58),t.k0s()}if(2&n){const o=t.XpG(3);t.Y8G("matTooltip",t.bMT(1,4,o.xrActive$)?"Exit VR":"Enter VR")("matTooltipPosition",o.tooltipPosition)("disabled","immersive-ar"===t.bMT(2,6,o.xrSessionMode$)),t.BMQ("aria-label",t.bMT(3,8,o.xrActive$)?"Exit VR":"Enter VR")}}function iV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",57),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.toggleXRModeClick("immersive-ar"))}),t.nrm(4,"app-icon",59),t.k0s()}if(2&n){const o=t.XpG(3);t.Y8G("matTooltip",t.bMT(1,4,o.xrActive$)?"Exit AR":"Enter AR")("matTooltipPosition",o.tooltipPosition)("disabled","immersive-vr"===t.bMT(2,6,o.xrSessionMode$)),t.BMQ("aria-label",t.bMT(3,8,o.xrActive$)?"Exit AR":"Enter AR")}}function oV(n,e){if(1&n&&(t.qex(0),t.DNE(1,nV,5,10,"button",56),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,iV,5,10,"button",56),t.nI1(5,"async"),t.nI1(6,"async"),t.bVm()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.xrSupportedModes$)["immersive-vr"]&&t.bMT(3,4,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small),t.R7$(3),t.Y8G("ngIf",t.bMT(5,6,o.xrSupportedModes$)["immersive-ar"]&&t.bMT(6,8,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small)}}function sV(n,e){if(1&n&&(t.qex(0),t.DNE(1,J4,7,11,"button",38),t.nI1(2,"async"),t.DNE(3,Z4,5,10,"button",39),t.nI1(4,"async"),t.DNE(5,eV,4,7,"button",40),t.nI1(6,"async"),t.DNE(7,tV,2,1,"button",41),t.nI1(8,"async"),t.DNE(9,oV,7,10,"ng-container",25),t.nI1(10,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,5,o.toolsVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,7,o.visibilityLayersVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(6,9,o.searchVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(8,11,o.whiteboardVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(10,13,o.xrEnabled$))}}function rV(n,e){if(1&n&&(t.j41(0,"button",60),t.nI1(1,"async"),t.nrm(2,"app-icon",61),t.k0s()),2&n){const o=t.XpG(),i=t.sdS(13),s=t.sdS(36);t.Y8G("matMenuTriggerFor",t.bMT(1,2,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small?s:i)("matTooltipPosition",o.tooltipPosition)}}function aV(n,e){if(1&n&&t.nrm(0,"app-view-tools",62),2&n){const o=t.XpG();t.Y8G("focusedTool",o.focusedTool)}}function lV(n,e){1&n&&(t.j41(0,"app-pillbox",63),t.nrm(1,"app-view-layers-slider"),t.k0s())}function cV(n,e){1&n&&t.nrm(0,"app-icon",73)}function _V(n,e){1&n&&t.nrm(0,"app-icon",74)}function dV(n,e){1&n&&t.nrm(0,"app-icon",75)}function pV(n,e){if(1&n&&(t.j41(0,"button",68),t.qex(1,69),t.nI1(2,"async"),t.DNE(3,cV,1,0,"app-icon",70)(4,_V,1,0,"app-icon",71)(5,dV,1,0,"app-icon",72),t.bVm(),t.qex(6),t.pXf(7,8),t.bVm(),t.k0s()),2&n){const o=t.XpG(2),i=t.sdS(32);t.Y8G("matMenuTriggerFor",i),t.R7$(),t.Y8G("ngSwitch",t.bMT(2,4,o.activeTool$)),t.R7$(3),t.Y8G("ngSwitchCase",o.toolEnum.Hide),t.R7$(),t.Y8G("ngSwitchCase",o.toolEnum.Fade)}}function uV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",76),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleLayers())}),t.nrm(3,"app-icon",77),t.qex(4),t.pXf(5,9),t.bVm(),t.k0s()}if(2&n){const o=t.XpG(2);t.BMQ("data-test-visibility-layers",t.bMT(1,2,o.visibilityLayersVisible$))("data-test-skin-layers",t.bMT(2,4,o.skinLayersVisible$))}}function gV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",78),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSearch())}),t.nrm(1,"app-icon",79),t.qex(2),t.pXf(3,10),t.bVm(),t.k0s()}}function hV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",80),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleDraw())}),t.nrm(1,"app-icon",81),t.qex(2),t.pXf(3,11),t.bVm(),t.k0s()}}function mV(n,e){1&n&&(t.qex(0),t.pXf(1,12),t.bVm())}function fV(n,e){1&n&&(t.qex(0),t.pXf(1,13),t.bVm())}function SV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",83),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.toggleXRModeClick("immersive-vr"))}),t.nrm(2,"app-icon",84),t.DNE(3,mV,2,0,"ng-container",25),t.nI1(4,"async"),t.DNE(5,fV,2,0,"ng-container",25),t.nI1(6,"async"),t.k0s()}if(2&n){const o=t.XpG(3);t.Y8G("disabled","immersive-ar"===t.bMT(1,3,o.xrSessionMode$)),t.R7$(3),t.Y8G("ngIf",t.bMT(4,5,o.xrActive$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(6,7,o.xrActive$))}}function bV(n,e){1&n&&(t.qex(0),t.pXf(1,14),t.bVm())}function yV(n,e){1&n&&(t.qex(0),t.pXf(1,15),t.bVm())}function vV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",83),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.toggleXRModeClick("immersive-ar"))}),t.nrm(2,"app-icon",85),t.DNE(3,bV,2,0,"ng-container",25),t.nI1(4,"async"),t.DNE(5,yV,2,0,"ng-container",25),t.nI1(6,"async"),t.k0s()}if(2&n){const o=t.XpG(3);t.Y8G("disabled","immersive-vr"===t.bMT(1,3,o.xrSessionMode$)),t.R7$(3),t.Y8G("ngIf",t.bMT(4,5,o.xrActive$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(6,7,o.xrActive$))}}function EV(n,e){if(1&n&&(t.qex(0),t.DNE(1,SV,7,9,"button",82),t.nI1(2,"async"),t.DNE(3,vV,7,9,"button",82),t.nI1(4,"async"),t.bVm()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.xrSupportedModes$)["immersive-vr"]),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,o.xrSupportedModes$)["immersive-ar"])}}function TV(n,e){if(1&n&&(t.qex(0),t.DNE(1,pV,8,6,"button",64),t.nI1(2,"async"),t.DNE(3,uV,6,6,"button",65),t.nI1(4,"async"),t.nI1(5,"async"),t.DNE(6,gV,4,0,"button",66),t.nI1(7,"async"),t.DNE(8,hV,4,0,"button",67),t.nI1(9,"async"),t.DNE(10,EV,5,6,"ng-container",25),t.nI1(11,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,5,o.toolsVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,7,o.visibilityLayersVisible$)&&t.bMT(5,9,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),t.R7$(3),t.Y8G("ngIf",t.bMT(7,11,o.searchVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(9,13,o.whiteboardVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(11,15,o.xrEnabled$))}}function CV(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"button",86),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectTool(s.toolEnum.Select))}),t.nrm(2,"app-icon",87),t.qex(3),t.pXf(4,16),t.bVm(),t.k0s(),t.j41(5,"button",88),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectTool(s.toolEnum.Hide))}),t.nrm(6,"app-icon",89),t.qex(7),t.pXf(8,17),t.bVm(),t.k0s(),t.j41(9,"button",90),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectTool(s.toolEnum.Fade))}),t.nrm(10,"app-icon",91),t.qex(11),t.pXf(12,18),t.bVm(),t.k0s(),t.bVm()}}function OV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",92),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleTakeQuiz())}),t.nrm(3,"app-icon",93),t.qex(4),t.pXf(5,19),t.bVm(),t.k0s()}if(2&n){let o;const i=t.XpG();t.Y8G("disabled",!(null!=(o=t.bMT(1,1,i.selectedChapterReady$))&&o.model)||t.bMT(2,3,i.quizActive$))}}function wV(n,e){1&n&&(t.qex(0),t.pXf(1,20),t.bVm())}function MV(n,e){1&n&&(t.qex(0),t.pXf(1,21),t.bVm())}function IV(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",94),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleLabels())}),t.DNE(1,wV,2,0,"ng-container",25),t.nI1(2,"async"),t.DNE(3,MV,2,0,"ng-container",25),t.nI1(4,"async"),t.k0s()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.showLabels$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(4,4,o.showLabels$))}}function AV(n,e){if(1&n&&(t.qex(0),t.j41(1,"button",95),t.pXf(2,22),t.k0s(),t.bVm()),2&n){t.XpG();const o=t.sdS(21);t.R7$(),t.Y8G("matMenuTriggerFor",o)}}class Gt{get openBar(){return this._openBar}set openBar(e){this._openBar=e}constructor(e,o,i,s,r,a,l){this.viewService=e,this.viewUIService=o,this.quizService=i,this.dialog=s,this.store=r,this.directionality=a,this.activatedRoute=l,this.toolEnum=Ct,this.horizontalBreakpoint=Un,this.canvasHeightBreakpoint=Fi,this.viewUI=h,this.viewUIStatus=Ve,this.bookmarkViewMode=ji,this.ngUnsubscribe=new oe.B,this._openBar="",this.focusedTool=null,this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}ngOnInit(){this.checkSecretXRTrigger()}ngOnDestroy(){clearTimeout(this.xrTimeout),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}checkSecretXRTrigger(){const e=this.activatedRoute.snapshot.queryParamMap.get("xr");(0,m.isNil)(e)||this.store.dispatch(new gi.SetEnabled("true"===e))}handleSecretXRTriggerDown(){this.xrTimeout=setTimeout(()=>{const o=this.store.selectSnapshot(Nn.getXREnabled);this.store.dispatch(new gi.SetEnabled(!o))},1e4)}handleSecretXRTriggerUp(){clearTimeout(this.xrTimeout)}handleSearch(){this.viewService.toggleSearch()}handleDraw(){this.viewService.toggleWhiteboard(!0)}handleSelectTool(e){(0,m.isNil)(e)||(this.viewService.selectTool(e),this.focusedTool=null)}handleToggleBar(e){e===this.openBar?(this.openBar="","selection"===e&&this.handleSelectTool(this.focusedTool)):this.openBar=e}handleLayers(){this.viewService.toggleLayers()}handleCloseBar(){this.openBar=""}handleToggleLabels(){this.viewService.showLabels()}handleTakeQuiz(){this.quizService.startQuiz()}handleHelpShortcuts(){this.viewService.toggleHelp(Ho.Shortcuts)}handleHelpBasics(){this.viewService.toggleHelp(Ho.Basics)}handlePlaythrough(e){this.viewService.togglePlaythrough(e)}handleTutorial(){this.viewService.toggleTutorial(!0)}handleVideo(e){this.dialog.open(B4,{id:Lo.VideoDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{videoSources:Lf}}),e.stopPropagation()}isEnabled(e){return this.viewUIService.isUIEnabled(e)}switchTool(e){(0,m.isNil)(this.focusedTool)&&(this.focusedTool=this.store.selectSnapshot(U.getActiveTool));const o=[Ct.Select,Ct.Hide,Ct.Fade],i=(o.indexOf(this.focusedTool)+e+o.length)%o.length;this.focusedTool=o[i]}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}toggleXRModeClick(e){this.store.selectSnapshot(Nn.getXRSessionMode)?this.store.dispatch(new gi.ExitXR(!1)):this.store.dispatch(new gi.EnterXR(e))}openRemoteQuest(){const e=new URL("https://oculus.com/open_url/");e.searchParams.set("url",location.href),window.open(e,"__blank")}}(E_=Gt).\u0275fac=function(e){return new(e||E_)(t.rXU(zt),t.rXU(hp),t.rXU(Za),t.rXU(pt.bZ),t.rXU(c.il),t.rXU(zs.dS),t.rXU(ut.nX))},E_.\u0275cmp=t.VBU({type:E_,selectors:[["app-view-toolbar"]],viewQuery:function(e,o){if(1&e&&(t.GBs(H4,5),t.GBs(Q4,5)),2&e){let i;t.mGM(i=t.lsd())&&(o.viewMenu=i.first),t.mGM(i=t.lsd())&&(o.viewQuizMenu=i.first)}},inputs:{openBar:"openBar"},decls:48,vars:48,consts:()=>{let n,e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z,te,se,ge,st,We,ln;return n=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,e=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,o=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,i=$localize`:ac0f81713a84217c9bd1d9bb460245d8190b073f5937251202465808296:More`,s=$localize`:58083a2c0d5c2b2184981c0887b01d1b3795eb613384117902239564995:Getting Started Video`,r=$localize`:27469d782d17f88ac1d4bbb5ab0715a83be9bfec1108080934572452765:3D Navigation Tutorial`,a=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,l=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,_=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,d=$localize`:c2317b4bdf2cb99d1f55afbb550ee164e909b90d4991259427179720015:Layers`,p=$localize`:c2317b4bdf2cb99d1f55afbb550ee164e909b90d4991259427179720015:Layers`,u=$localize`:ff3ca629882ef2834821af36216a182d484a8cce6002558759122494452:Anatomy Explorer`,g=$localize`:ff3ca629882ef2834821af36216a182d484a8cce6002558759122494452:Anatomy Explorer`,y=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,C=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,O=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,L=$localize`:c2317b4bdf2cb99d1f55afbb550ee164e909b90d4991259427179720015:Layers`,$=$localize`:ff3ca629882ef2834821af36216a182d484a8cce6002558759122494452:Anatomy Explorer`,q=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,x=$localize`:d8f00947439583705b11afdb26b3606125755d7b1909228686165085461:Exit VR`,k=$localize`:5830a413540a273b819289949937046a450e5d1d3237949197627908261:Enter VR`,A=$localize`:1d0d80fb57ed2c1c18d12b2df218541387455b4d6343763191422968223:Exit AR`,R=$localize`:ea19499751215e7ca470be4008a3fc22ed1281467143676568850518157:Enter AR`,Z=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,te=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,se=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,ge=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,st=$localize`:0176531c3e308e6a4f5dd4776a054145a1a6f2f34142825283571551211:Hide Labels`,We=$localize`:5a595fd88f56c04bacea3ea933dd02f98f2131506701808385090866243:Show Labels`,ln=$localize`:79b5cb803980738a667e2f41746369c1efc9b0b11685423440406455552: Help `,[["viewMenu","matMenu"],["helpMenu","matMenu"],["selectionToolsMenu","matMenu"],["moreMenu","matMenu"],i,s,r,a,O,L,$,q,x,k,A,R,Z,te,se,ge,st,We,ln,["data-test","viewToolbar",1,"view-toolbar"],["orientation","vertical","role","radiogroup","aria-label",n,"appPreventFadeout","",1,"view-toolbar__main"],[4,"ngIf"],["type","button","data-test","viewMenuButton","matTooltip",e,"app-view-button","","buttonSize","small","aria-label",o,3,"matMenuTriggerFor","matTooltipPosition",4,"ngIf"],["class","view-toolbar__tools","data-test","viewTools",3,"focusedTool",4,"ngIf"],["appPreventFadeout","","orientation","vertical","class","view-toolbar__tools","data-test","viewLayers",4,"ngIf"],["data-test","viewMenu",1,"view-menu",3,"overlapTrigger"],["mat-menu-item","","data-test","viewMoreMenuButton",3,"matMenuTriggerFor"],[1,"view-menu"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","viewLaunchTutorial",3,"click","disabled"],["mat-menu-item","","data-test","viewKeyboardShortcuts",3,"click"],["data-test","selectionToolsMenu",1,"view-menu"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"disabled","click",4,"ngIf"],["mat-menu-item","","data-test","viewToggleLabels",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewToolsButton","aria-label",l,"matTooltip",_,"aria-owns","viewToosSelect viewToolsHide viewToolsFade","aria-haspopup","true",3,"buttonTheme","matTooltipPosition","mousedown","mouseup","touchstart","touchend","click","keyup.escape","keyup.arrowup","keyup.arrowdown",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",d,"matTooltip",p,3,"buttonTheme","matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",u,"matTooltip",g,3,"buttonTheme","matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",y,"matTooltip",C,3,"matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewToolsButton","aria-label",l,"matTooltip",_,"aria-owns","viewToosSelect viewToolsHide viewToolsFade","aria-haspopup","true",3,"mousedown","mouseup","touchstart","touchend","click","keyup.escape","keyup.arrowup","keyup.arrowdown","buttonTheme","matTooltipPosition"],[1,"relative","flex","justify-center",3,"ngSwitch"],["size","lg","icon","mouse-pointer",4,"ngSwitchDefault"],["size","lg","icon","eye-slash",4,"ngSwitchCase"],["size","lg","icon","adjust",4,"ngSwitchCase"],["size","lg","icon","mouse-pointer"],["size","lg","icon","eye-slash"],["size","lg","icon","adjust"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",d,"matTooltip",p,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","sliders-simple"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",u,"matTooltip",g,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","magnifying-glass"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",y,"matTooltip",C,3,"click","matTooltipPosition"],["size","lg","icon","pen"],["app-view-button","","buttonSize","small",3,"matTooltip","matTooltipPosition","disabled","click",4,"ngIf"],["app-view-button","","buttonSize","small",3,"click","matTooltip","matTooltipPosition","disabled"],["size","lg","icon","head-side-goggles"],["size","lg","icon","glasses"],["type","button","data-test","viewMenuButton","matTooltip",e,"app-view-button","","buttonSize","small","aria-label",o,3,"matMenuTriggerFor","matTooltipPosition"],["size","lg","icon","ellipsis-vertical"],["data-test","viewTools",1,"view-toolbar__tools",3,"focusedTool"],["appPreventFadeout","","orientation","vertical","data-test","viewLayers",1,"view-toolbar__tools"],["mat-menu-item","","data-test","viewToolsButton",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","","data-test","viewLayersButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewSearchButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewDrawButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewToolsButton",3,"matMenuTriggerFor"],[3,"ngSwitch"],["class","view-toolbar__menu-icon","size","lg","icon","mouse-pointer",4,"ngSwitchDefault"],["class","view-toolbar__menu-icon","size","lg","icon","eye-slash",4,"ngSwitchCase"],["class","view-toolbar__menu-icon","size","lg","icon","adjust",4,"ngSwitchCase"],["size","lg","icon","mouse-pointer",1,"view-toolbar__menu-icon"],["size","lg","icon","eye-slash",1,"view-toolbar__menu-icon"],["size","lg","icon","adjust",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewLayersButton",3,"click"],["size","lg","icon","sliders-simple",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewSearchButton",3,"click"],["size","lg","icon","magnifying-glass",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewDrawButton",3,"click"],["size","lg","icon","pen",1,"view-toolbar__menu-icon"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["size","lg","icon","head-side-goggles",1,"view-toolbar__menu-icon"],["size","lg","icon","glasses",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewQuizToolsSelect",3,"click"],["size","lg","icon","mouse-pointer","appLogicalDir","",1,"view-toolbar__menu-icon","view-toolbar__menu-icon--light"],["mat-menu-item","","data-test","viewQuizToolsHide",3,"click"],["size","lg","icon","eye-slash","appLogicalDir","",1,"view-toolbar__menu-icon","view-toolbar__menu-icon--light"],["mat-menu-item","","data-test","viewQuizToolsFade",3,"click"],["size","lg","icon","adjust","appLogicalDir","",1,"view-toolbar__menu-icon","view-toolbar__menu-icon--light"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"click","disabled"],["size","lg","icon","user-graduate","appLogicalDir","",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewToggleLabels",3,"click"],["data-test","viewHelpMenuButton","mat-menu-item","",3,"matMenuTriggerFor"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",23)(1,"app-pillbox",24),t.DNE(2,sV,11,15,"ng-container",25),t.nI1(3,"async"),t.DNE(4,rV,3,4,"button",26),t.nI1(5,"async"),t.k0s(),t.DNE(6,aV,1,1,"app-view-tools",27),t.nI1(7,"async"),t.nI1(8,"async"),t.DNE(9,lV,2,0,"app-pillbox",28),t.nI1(10,"async"),t.nI1(11,"async"),t.k0s(),t.j41(12,"mat-menu",29,0),t.nI1(14,"async"),t.DNE(15,TV,12,17,"ng-container",25),t.nI1(16,"async"),t.j41(17,"button",30),t.qex(18),t.pXf(19,4),t.bVm(),t.k0s()(),t.j41(20,"mat-menu",31,1)(22,"button",32),t.bIt("click",function(r){return t.eBV(i),t.Njj(o.handleVideo(r))}),t.pXf(23,5),t.k0s(),t.j41(24,"button",33),t.nI1(25,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleTutorial())}),t.qex(26),t.pXf(27,6),t.bVm(),t.k0s(),t.j41(28,"button",34),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleHelpShortcuts())}),t.qex(29),t.pXf(30,7),t.bVm(),t.k0s()(),t.j41(31,"mat-menu",35,2),t.DNE(33,CV,13,0,"ng-container",25),t.nI1(34,"async"),t.k0s(),t.j41(35,"mat-menu",31,3),t.DNE(37,OV,6,5,"button",36),t.nI1(38,"async"),t.nI1(39,"async"),t.nI1(40,"async"),t.nI1(41,"async"),t.nI1(42,"async"),t.nI1(43,"async"),t.DNE(44,IV,5,6,"button",37),t.nI1(45,"async"),t.DNE(46,AV,3,1,"ng-container",25),t.nI1(47,"async"),t.k0s()}if(2&e){let i,s;const r=t.sdS(36);t.R7$(2),t.Y8G("ngIf",t.bMT(3,12,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small),t.R7$(2),t.Y8G("ngIf",t.bMT(5,14,o.toolbarOverflowVisible$)),t.R7$(2),t.Y8G("ngIf","selection"===o.openBar&&t.bMT(7,16,o.toolsVisible$)&&t.bMT(8,18,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small),t.R7$(3),t.Y8G("ngIf","show"===(null==(i=t.bMT(10,20,o.visibilityLayersUI$))?null:i.status)&&"single"===(null==(i=t.bMT(11,22,o.visibilityLayersUI$))?null:i.layersMode)),t.R7$(3),t.Y8G("overlapTrigger",t.bMT(14,24,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),t.R7$(3),t.Y8G("ngIf",t.bMT(16,26,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),t.R7$(2),t.Y8G("matMenuTriggerFor",r),t.R7$(7),t.Y8G("disabled",!(null!=(s=t.bMT(25,28,o.selectedChapterReady$))&&s.model)),t.R7$(9),t.Y8G("ngIf",t.bMT(34,30,o.toolsVisible$)),t.R7$(4),t.Y8G("ngIf",t.bMT(38,32,o.hasQuiz$)&&t.bMT(39,34,o.quizEnabled$)&&t.bMT(40,36,o.quizPromptVisible$)&&!1===t.bMT(41,38,o.quizLocked$)&&t.bMT(42,40,o.selectedBookmarkViewMode$)!==o.bookmarkViewMode.Content&&t.bMT(43,42,o.isMobileWeb$)),t.R7$(7),t.Y8G("ngIf",t.bMT(45,44,o.toggleLabelsVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(47,46,o.helpVisible$))}},dependencies:[xt,b.bT,b.ux,b.e1,b.fG,Qr,Hi,qe,jn.kk,jn.fb,jn.Cp,Sn.oV,Uo,y_,jf,b.Jj],styles:[".view-toolbar[_ngcontent-%COMP%]{position:relative}.view-toolbar__menu-icon[_ngcontent-%COMP%]{display:inline-block;width:20px;text-align:center;margin-inline-end:4px}.view-toolbar__menu-icon--light[_ngcontent-%COMP%]{color:#374a68}.view-toolbar__tools[_ngcontent-%COMP%]{position:absolute;z-index:2;inset-inline-start:48px;top:0;width:40px}"],changeDetection:0}),Wt([(0,c.l6)(ue.getVisible(h.Tools)),Xt("design:type",f.c)],Gt.prototype,"toolsVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.VisibilityLayers)),Xt("design:type",f.c)],Gt.prototype,"visibilityLayersVisible$",void 0),Wt([(0,c.l6)(ue.getUIEntry(h.VisibilityLayers)),Xt("design:type",f.c)],Gt.prototype,"visibilityLayersUI$",void 0),Wt([(0,c.l6)(ue.getVisible(h.SkinLayers)),Xt("design:type",f.c)],Gt.prototype,"skinLayersVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.Search)),Xt("design:type",f.c)],Gt.prototype,"searchVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.Whiteboard)),Xt("design:type",f.c)],Gt.prototype,"whiteboardVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.ToggleLabels)),Xt("design:type",f.c)],Gt.prototype,"toggleLabelsVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.Help)),Xt("design:type",f.c)],Gt.prototype,"helpVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.Playthrough)),Xt("design:type",f.c)],Gt.prototype,"playthroughVisible$",void 0),Wt([(0,c.l6)(ue.getVisible(h.ToolbarOverflow)),Xt("design:type",f.c)],Gt.prototype,"toolbarOverflowVisible$",void 0),Wt([(0,c.l6)(ue.getSearchStatus),Xt("design:type",f.c)],Gt.prototype,"searchStatus$",void 0),Wt([(0,c.l6)(mn.getHorizontalBreakpoint),Xt("design:type",f.c)],Gt.prototype,"horizontalBreakpoint$",void 0),Wt([(0,c.l6)(U.getCanvasHeightBreakpoint),Xt("design:type",f.c)],Gt.prototype,"canvasHeightBreakpoint$",void 0),Wt([(0,c.l6)(G.hasQuiz),Xt("design:type",f.c)],Gt.prototype,"hasQuiz$",void 0),Wt([(0,c.l6)(ue.getVisible(h.QuizPrompt)),Xt("design:type",f.c)],Gt.prototype,"quizPromptVisible$",void 0),Wt([(0,c.l6)(G.getQuizEnabled),Xt("design:type",f.c)],Gt.prototype,"quizEnabled$",void 0),Wt([(0,c.l6)(G.getQuizModeLocked),Xt("design:type",f.c)],Gt.prototype,"quizLocked$",void 0),Wt([(0,c.l6)(G.getQuizModeActive),Xt("design:type",f.c)],Gt.prototype,"quizActive$",void 0),Wt([(0,c.l6)(U.getShowLabels),Xt("design:type",f.c)],Gt.prototype,"showLabels$",void 0),Wt([(0,c.l6)(U.getActiveTool),Xt("design:type",f.c)],Gt.prototype,"activeTool$",void 0),Wt([(0,c.l6)(E.getSelectedChapterReadyState),Xt("design:type",f.c)],Gt.prototype,"selectedChapterReady$",void 0),Wt([(0,c.l6)(xe.getSelectedBookmarkViewMode),Xt("design:type",f.c)],Gt.prototype,"selectedBookmarkViewMode$",void 0),Wt([(0,c.l6)(P.getIsMobileWeb),Xt("design:type",f.c)],Gt.prototype,"isMobileWeb$",void 0),Wt([(0,c.l6)(vn.canUndo),Xt("design:type",f.c)],Gt.prototype,"canUndo$",void 0),Wt([(0,c.l6)(vn.canRedo),Xt("design:type",f.c)],Gt.prototype,"canRedo$",void 0),Wt([(0,c.l6)(ue.getVisible(h.Undo)),Xt("design:type",f.c)],Gt.prototype,"undoVisible$",void 0),Wt([(0,c.l6)(Nn.getXREnabled),Xt("design:type",f.c)],Gt.prototype,"xrEnabled$",void 0),Wt([(0,c.l6)(Nn.getXRSessionMode),Xt("design:type",f.c)],Gt.prototype,"xrSessionMode$",void 0),Wt([(0,c.l6)(Nn.getXRSupportedModes),Xt("design:type",f.c)],Gt.prototype,"xrSupportedModes$",void 0),Wt([(0,c.l6)(Nn.getXRActive),Xt("design:type",f.c)],Gt.prototype,"xrActive$",void 0);const PV=["app-view-rounded-button",""];function NV(n,e){if(1&n&&t.nrm(0,"app-icon",3),2&n){const o=t.XpG();t.Y8G("icon",o.icon)}}let RV=(()=>{var n;class e{constructor(){this.iconPlacement="left",this.compact=!1,this.buttonType="outline"}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["button","app-view-rounded-button",""]],inputs:{icon:"icon",iconPlacement:"iconPlacement",label:"label",compact:"compact",buttonType:"buttonType",shadow:"shadow"},attrs:PV,decls:4,vars:12,consts:[[1,"view-rounded-button"],["class","view-rounded-button__icon mx-1",3,"icon",4,"ngIf"],[1,"view-rounded-button__label","mx-1"],[1,"view-rounded-button__icon","mx-1",3,"icon"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,NV,1,1,"app-icon",1),t.j41(2,"div",2),t.EFF(3),t.k0s()()),2&i&&(t.AVh("view-rounded-button--outline","outline"===s.buttonType)("view-rounded-button--solid","solid"===s.buttonType)("view-rounded-button--shadow",s.shadow)("view-rounded-button--compact",s.compact)("view-rounded-button--reverse","right"===s.iconPlacement),t.R7$(),t.Y8G("ngIf",s.icon),t.R7$(2),t.JRh(s.label))},dependencies:[b.bT,qe],styles:["button[app-view-rounded-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all}button[app-view-rounded-button]:hover .view-rounded-button,button[app-view-rounded-button]:focus .view-rounded-button{color:#f9fafd;border-color:#f9fafd;background:#f9fafd40}button[app-view-rounded-button]:hover .view-rounded-button--solid,button[app-view-rounded-button]:focus .view-rounded-button--solid{border-color:#f9fafd40}.view-rounded-button{cursor:pointer;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:12px 16px;border-style:solid;border-width:1px;border-radius:24px;color:#f9fafd;border-color:#f9fafd}.view-rounded-button__label{font-size:1rem;line-height:1.5rem}.view-rounded-button--solid{color:#060502;border-color:#060502;background:#f9fafd}.view-rounded-button--shadow{box-shadow:0 0 8px #00000052}.view-rounded-button--reverse{flex-direction:row-reverse}.view-rounded-button--compact{padding:4px 8px}\n"],encapsulation:2,changeDetection:0}),e})();var sa=function(n){return n.CameraZoom="camera-zoom",n.CameraRotate="camera-rotate",n.CameraPan="camera-pan",n.NodeSelection="node-selection",n}(sa||{});function cT(n,e,o=1e3,i=.001){return xf(n).pipe((0,Hl.Z)(e.getCameraZoom()),(0,F.T)(()=>e.getCameraZoom()),(0,Wr.J)(),(0,F.T)(([s,r])=>r-s),(0,X.p)(s=>Math.abs(s)>i),(0,Pn.B)(o))}function _T(n,e,o=125){return xf(n).pipe((0,Hl.Z)(e.getLookDirection()),(0,F.T)(()=>e.getLookDirection()),(0,Wr.J)(),(0,F.T)(([i,s])=>function xV(n,e){return Ee.angle(n,e)>.001}(i,s)),(0,X.p)(i=>i),(0,Pn.B)(o))}function dT(n){return{camera:n.getCamera(),zoom:n.getCameraZoom()}}function xf(n){return n.getEvent(pe.CameraRested)}function pT(n){const{eye:e,look:o}=n,i=Ee.fromValues(e.x,e.y,e.z),s=Ee.fromValues(o.x,o.y,o.z),r=Ee.create();return Ee.sub(r,i,s),r}var uT=S(8545);const $V=["*",[["","slide-footer",""]]],FV=["*","[slide-footer]"];function BV(n,e){if(1&n&&(t.j41(0,"h2",6),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.title," ")}}function zV(n,e){if(1&n&&t.nrm(0,"img",7),2&n){const o=t.XpG(2);t.Y8G("src",o.image,t.B4B)("alt",o.alt)}}function WV(n,e){if(1&n&&(t.j41(0,"div",1),t.DNE(1,BV,2,1,"h2",2),t.j41(2,"article",3),t.SdG(3),t.k0s(),t.DNE(4,zV,1,2,"img",4),t.j41(5,"div",5),t.SdG(6,1),t.k0s()()),2&n){const o=t.XpG();t.AVh("slide--expanded","expanded"===o.spacing),t.Y8G("@refresh",void 0),t.R7$(),t.Y8G("ngIf",o.title),t.R7$(3),t.Y8G("ngIf",o.image)}}let Gf=(()=>{var n;class e{set shown(i){this._shown=i,this.initTrigger(),this.changeRef.markForCheck()}get shown(){return this._shown}constructor(i,s,r,a,l,_){this.store=i,this.actions=s,this.engineService=r,this.cameraService=a,this.engineRendererService=l,this.changeRef=_,this.alt="",this.spacing="compact",this.exitEnabled=!0,this.triggerDelay=300,this.triggerComplete=new t.bkB,this._shown=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){}ngAfterViewInit(){this.initTrigger()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTrigger(){if(this.ngUnsubscribe.next(),this.shown&&this.trigger){const i=this.resetCamera(),s=this.store.selectSnapshot(P.getCanTouch);(function kV(n,e,o,i,s,r){switch(n){case sa.CameraZoom:return r?cT(o,i):function DV(n,e,o,i=1e3,s=.001){const r=o.getCanvas(),a=(0,hn.R)(r,"wheel"),l=(0,hn.R)(r,"touchmove").pipe((0,X.p)(d=>2===d.touches.length)),_=cT(n,e,i,s);return(0,Ao.h)(a,l).pipe((0,At.Z)(()=>_))}(o,i,s);case sa.CameraPan:return function VV(n,e,o,i=125){const s=o.getCanvas(),r=(0,hn.R)(s,"mousemove").pipe((0,X.p)(_=>1===_.buttons&&_.shiftKey||2===_.buttons||4===_.buttons)),a=(0,hn.R)(s,"touchmove").pipe((0,X.p)(_=>2===_.touches.length)),l=function UV(n,e,o=125){return xf(n).pipe((0,Hl.Z)(dT(e)),(0,F.T)(()=>dT(e)),(0,Pn.B)(o),(0,Wr.J)(),(0,F.T)(([i,s])=>function GV(n,e){const s=pT(n.camera),r=pT(e.camera),a=Ee.create();Ee.sub(a,s,r);const l=a.reduce((d,p)=>d+p),_=e.zoom-n.zoom;return(0!==_||0!==l)&&Math.abs(l)<1&&Math.abs(_)<.001}(i,s)),(0,X.p)(i=>i))}(n,e,i);return(0,Ao.h)(r,a).pipe((0,At.Z)(()=>l))}(o,i,s);case sa.CameraRotate:return r?_T(o,i):function LV(n,e,o,i,s=1e3){const r=i.getCanvas(),a=(0,hn.R)(r,"mousemove").pipe((0,X.p)(d=>1===d.buttons)),l=(0,hn.R)(r,"touchmove").pipe((0,X.p)(d=>1===d.touches.length)),_=_T(e,o,s);return(0,Ao.h)(a,l).pipe((0,At.Z)(()=>_),(0,X.p)(()=>"rotate"===n.selectSnapshot(vt.getPanMode)),(0,Pn.B)(125))}(e,o,i,s);case sa.NodeSelection:return function jV(n){return n.select(Re.getCheckedNodes).pipe((0,Wr.J)(),(0,X.p)(([,e])=>e.length>0))}(e)}})(this.trigger,this.store,this.engineService,this.cameraService,this.engineRendererService,s).pipe((0,uT.U)(i),(0,Ga.c)(this.triggerDelay),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.triggerComplete.next()})}}resetCamera(){const s=this.store.selectSnapshot(E.getSelectedChapter)?.camera?.location;return(0,m.isNil)(s)?(0,Qe.of)(void 0):this.store.dispatch(new di(s,!0)).pipe((0,At.Z)(()=>this.actions.pipe((0,c.xi)(fg))),(0,Vt.s)(1))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(c.En),t.rXU(Lt),t.rXU(Pi),t.rXU(ws),t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-tour-slide"]],inputs:{title:"title",image:"image",alt:"alt",spacing:"spacing",shown:"shown",exitEnabled:"exitEnabled",trigger:"trigger",triggerDelay:"triggerDelay"},outputs:{triggerComplete:"triggerComplete"},ngContentSelectors:FV,decls:1,vars:1,consts:[["class","slide",3,"slide--expanded",4,"ngIf"],[1,"slide"],["class","slide__title",4,"ngIf"],[1,"slide__content"],["class","slide__image",3,"src","alt",4,"ngIf"],[1,"slide__footer"],[1,"slide__title"],[1,"slide__image",3,"src","alt"]],template:function(i,s){1&i&&(t.NAR($V),t.DNE(0,WV,7,5,"div",0)),2&i&&t.Y8G("ngIf",s.shown)},dependencies:[b.bT],styles:[".slide[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;max-width:500px}.slide__title[_ngcontent-%COMP%]{margin-bottom:16px;font-weight:600;font-size:1.125rem;line-height:1.75rem}.slide__content[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1rem;line-height:1.5rem;line-height:1.5em;max-width:100%}.slide__image[_ngcontent-%COMP%]{margin:24px auto;max-width:100%;min-height:1px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500;display:flex;flex-direction:row;align-items:center;justify-content:center;max-width:100%}.slide--expanded[_ngcontent-%COMP%]   .slide__title[_ngcontent-%COMP%]{margin:16px}.slide--expanded[_ngcontent-%COMP%]   .slide__content[_ngcontent-%COMP%]{margin:48px}.slide--expanded[_ngcontent-%COMP%]   .slide__image[_ngcontent-%COMP%]{margin:48px auto}@media (max-width: 768px){.slide[_ngcontent-%COMP%]{max-width:400px}.slide__image[_ngcontent-%COMP%]{margin:16px}.slide__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;margin-bottom:12px}.slide__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:12px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 640px){.slide[_ngcontent-%COMP%]{max-width:320px}}@media (max-width: 480px){.slide[_ngcontent-%COMP%]{max-width:240px}.slide__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:8px}.slide__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin-bottom:8px}.slide__image[_ngcontent-%COMP%]{margin:4px auto}.slide__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}@media (max-width: 320px){.slide[_ngcontent-%COMP%]{max-width:160px}}"],data:{animation:[(0,ie.hZ)("refresh",[(0,ie.kY)(":enter",[(0,ie.sM)(gl.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),e})();const XV=["*"];function HV(n,e){1&n&&(t.j41(0,"div",1)(1,"div",2),t.SdG(2),t.k0s()())}let $f=(()=>{var n;class e{set shown(i){this._shown=i,this.setSelectedSlide(0)}get shown(){return this._shown}constructor(i){this.changeRef=i,this.selectedSlideIndex=0,this._shown=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){}ngAfterViewInit(){this.initListeners(),setTimeout(()=>{this.setSlideShown(this.selectedSlideIndex)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}goToPrevSlide(){this.setSelectedSlide(this.selectedSlideIndex-1)}goToNextSlide(){this.setSelectedSlide(this.selectedSlideIndex+1)}setSelectedSlide(i){if(this.selectedSlideIndex=i,this.slides){const r=Math.max(0,Math.min(this.slides.length-1,i));this.selectedSlideIndex=r}this.setSlideShown(this.selectedSlideIndex)}initListeners(){(0,Ao.h)(...this.slides.map(i=>i.triggerComplete.asObservable())).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.goToNextSlide()})}setSlideShown(i){this.slides&&this.slides.forEach((s,r)=>{s.shown=r===i}),this.changeRef.markForCheck()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-tour-page"]],contentQueries:function(i,s,r){if(1&i&&t.wni(r,Gf,4),2&i){let a;t.mGM(a=t.lsd())&&(s.slides=a)}},inputs:{shown:"shown"},ngContentSelectors:XV,decls:1,vars:1,consts:[["class","page",4,"ngIf"],[1,"page"],[1,"page__contents"]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,HV,3,0,"div",0)),2&i&&t.Y8G("ngIf",s.shown)},dependencies:[b.bT],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.page__contents[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}@media (max-width: 768px){.page__contents[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 480px){.page__contents[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}"],changeDetection:0}),e})();var T_;const KV=n=>({"pages--opaquer":n});function JV(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",1)(1,"button",2),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExitClick())}),t.nrm(2,"app-icon",3),t.k0s(),t.j41(3,"div",4),t.SdG(4),t.k0s(),t.j41(5,"div",5)(6,"button",6),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handlePrevClick())}),t.nrm(7,"app-icon",7),t.k0s(),t.j41(8,"div",8),t.EFF(9),t.k0s(),t.j41(10,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleNextClick())}),t.nrm(11,"app-icon",10),t.k0s()()()}if(2&n){const o=e.$implicit;t.Y8G("ngClass",t.eq3(7,KV,o.pageIndex==o.pageSize-1)),t.R7$(6),t.Y8G("disabled",o.pageIndex<1),t.BMQ("tabindex",o.pageIndex<1?-1:0),t.R7$(3),t.Lme("",o.pageIndex+1," / ",o.pageSize,""),t.R7$(),t.Y8G("disabled",o.pageIndex===o.pageSize-1),t.BMQ("tabindex",o.pageIndex===o.pageSize-1?-1:0)}}class Kp{constructor(e,o){this.store=e,this.changeRef=o,this.ngUnsubscribe=new oe.B}ngOnInit(){}ngAfterViewInit(){this.tutorial$.pipe((0,w.Q)(this.ngUnsubscribe),(0,X.p)(e=>null!=e&&e.pageSize>0)).subscribe(e=>{this.handleTutorialPages(e)}),this.store.dispatch(new D.SetTutorial({pageSize:this.pages.length,pageIndex:0}))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePrevClick(){this.store.dispatch(new D.TutorialPrevious)}handleNextClick(){this.store.dispatch(new D.TutorialNext)}handleExitClick(){this.store.dispatch(new D.ToggleWindow(en.Tutorial,!1))}handleTutorialPages(e){this.pages.forEach((o,i)=>{o.shown=i===e.pageIndex}),this.changeRef.markForCheck()}}(T_=Kp).\u0275fac=function(e){return new(e||T_)(t.rXU(c.il),t.rXU(t.gRc))},T_.\u0275cmp=t.VBU({type:T_,selectors:[["app-view-tour-pages"]],contentQueries:function(e,o,i){if(1&e&&t.wni(i,$f,4),2&e){let s;t.mGM(s=t.lsd())&&(o.pages=s)}},ngContentSelectors:["*"],decls:2,vars:3,consts:()=>{let n,e,o,i,s,r;return n=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,e=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,o=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,i=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,s=$localize`:a165a2589725552dea3ac6e98be73c72f5ae03a01978646816781669814:Next Tutorial Step`,r=$localize`:4ff3dad8ce52dc71e7b3158b1b20b5039959dabf2249392320351386178: Next Tutorial Step`,[["class","pages",3,"ngClass",4,"ngIf"],[1,"pages",3,"ngClass"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","buttonSize","small","aria-label",n,"matTooltip",e,"matTooltipPosition","right","data-test","tutorialExitButton",1,"pages__close",3,"click"],["icon","times"],[1,"pages__contents"],[1,"pages__footer"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",o,"matTooltip",i,"matTooltipPosition","left","data-test","tutorialPreviousButton",1,"pages__nav",3,"click","disabled"],["icon","angle-left","appLogicalDir",""],[1,"mx-8"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",s,"matTooltip",r,"matTooltipPosition","right","data-test","tutorialNextButton",1,"pages__nav",3,"click","disabled"],["icon","angle-right","appLogicalDir",""]]},template:function(e,o){1&e&&(t.NAR(),t.DNE(0,JV,12,9,"div",0),t.nI1(1,"async")),2&e&&t.Y8G("ngIf",t.bMT(1,1,o.tutorial$))},dependencies:[xt,b.YU,b.bT,Hi,qe,Sn.oV,b.Jj],styles:[".pages[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:20px auto 48px;max-width:600px;position:relative;background:#101823cc;border-radius:16px;padding:24px 28px 20px}.pages--opaquer[_ngcontent-%COMP%]{background:#101823e6}.pages__footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;font-size:1rem;line-height:1.5rem;font-weight:500}.pages__close[_ngcontent-%COMP%]{z-index:1;position:absolute;top:8px;inset-inline-end:8px;align-self:flex-end;display:flex;align-items:center;justify-content:center}.pages__contents[_ngcontent-%COMP%]{padding:16px 0}@media (max-width: 768px){.pages[_ngcontent-%COMP%]{margin:16px 12% 48px;border-radius:10px;padding:18px 22px 14px}.pages__contents[_ngcontent-%COMP%]{padding:24px 0}.pages__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}}@media (max-width: 480px){.pages[_ngcontent-%COMP%]{margin:12px 10% 48px;border-radius:8px;padding:24px 20px 12px}.pages__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(P.getTutorial),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Kp.prototype,"tutorial$",void 0);let gT=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-tour-success"]],inputs:{inline:"inline"},decls:2,vars:2,consts:[[1,"view-tour-success"],["icon","check",1,"view-tour-success__icon"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"app-icon",1),t.k0s()),2&i&&t.AVh("view-tour-success--inline",s.inline)},dependencies:[qe],styles:[".view-tour-success{width:52px;height:52px;display:flex;background-color:#1bbc66;border-radius:50%;justify-content:center;align-items:center}.view-tour-success__icon{font-size:2.25rem;line-height:2.5rem;color:#fff}.view-tour-success--inline{display:inline-flex;width:32px;height:32px}.view-tour-success--inline .view-tour-success__icon{font-size:1.125rem;line-height:1.75rem}@media (max-width: 768px){.view-tour-success{width:36px;height:36px}.view-tour-success__icon{font-size:1.25rem;line-height:1.75rem}.view-tour-success--inline{display:inline-flex;width:24px;height:24px}.view-tour-success--inline .view-tour-success__icon{font-size:.75rem;line-height:1rem}}\n"],encapsulation:2,changeDetection:0}),e})();function ZV(n,e){if(1&n&&t.nrm(0,"app-icon",5),2&n){const o=t.XpG(2);t.Y8G("icon",o.icon)}}function ej(n,e){if(1&n&&(t.j41(0,"span",6),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.JRh(o.label)}}function tj(n,e){if(1&n&&(t.qex(0),t.DNE(1,ZV,1,1,"app-icon",3)(2,ej,2,1,"span",4),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.icon),t.R7$(),t.Y8G("ngIf",o.icon)}}function nj(n,e){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.label," ")}}let ij=(()=>{var n;class e{constructor(){}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-tour-tip-button"]],inputs:{label:"label",icon:"icon"},decls:3,vars:2,consts:[[1,"view-tour-tip-button","my-1","mx-1",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"icon",4,"ngIf"],["class","sr-only",4,"ngIf"],[3,"icon"],[1,"sr-only"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,tj,3,2,"ng-container",1)(2,nj,2,1,"span",2),t.k0s()),2&i&&(t.Y8G("ngSwitch",!!s.icon),t.R7$(),t.Y8G("ngSwitchCase",!0))},dependencies:[b.bT,b.ux,b.e1,b.fG,qe],styles:[".view-tour-tip-button{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;color:#131c2a;background-color:#fff;border-radius:2px;font-weight:700;padding:4px;width:24px;height:24px}@media (max-width: 768px){.view-tour-tip-button{width:20px;height:20px}}\n"],encapsulation:2,changeDetection:0}),e})();var C_;function rj(n,e){1&n&&(t.qex(0),t.pXf(1,14),t.bVm())}function aj(n,e){1&n&&(t.qex(0),t.pXf(1,15),t.bVm())}class Ff{constructor(e){this.viewService=e,this.triggers=sa,this.videoTutorialSources=Lf}ngOnInit(){this.captureScroll$=this.scrollMode$.pipe((0,F.T)(e=>e===As.Capture))}handleStartClick(){this.viewService.toggleTutorial(!1)}}(C_=Ff).\u0275fac=function(e){return new(e||C_)(t.rXU(zt))},C_.\u0275cmp=t.VBU({type:C_,selectors:[["app-view-tour-desktop"]],decls:65,vars:12,consts:()=>{let n,e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z;return n=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,e=$localize`:129a2224e1f9d19eb5e11e2a07fe10a7855564848515973702474791807:up`,o=$localize`:b5fbc7c7f007dd53b2318525bb7ff8b0376c9e371301930865667956193:down`,i=$localize`:478c0bf6552f7226e27bb5b57b8209a040ded2c67449548947549758066:left`,s=$localize`:4a379a71f932b31ecae93a9232f818eef02ece106520868693399199322:right`,r=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,a=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,l=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,_=$localize`:0cfd714a023e7dddfab02ebbaffddf8b3b7dd9881831081178261551807: Click and drag the model to change the viewing angle. `,d=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,p=$localize`:c71aa1ed54f03bfd28210dccb6f900b4962ea522114624992018654005:You can also use the arrow keys`,u=$localize`:8b5e6e1e74d302bbdd638500b071bb0859f3ab405411319251728756176:to rotate.`,g=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,y=$localize`:a6a4d760af95bd17149d92758784333d288f02a47584501271397744885:You can also use`,C=$localize`:5be36bcbbbee99ffb6ea5f40636c92334e7c3d374307223492407933970:to zoom out.`,O=$localize`:197d3f7bb3c4bdbe8c11eb56a4cebb7bc9b5880c2383075435551442269: Hold the shift key and drag to move the model's position. `,L=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,$=$localize`:7e72d30152be758594ce5a0257a4fc0ee19f94d54528617795430260542:You can also use the`,q=$localize`:a6e5a9592abcd7af3cf72b5d4ba3a12a124208c79056703775803925947:keys to pan.`,x=$localize`:b9964d82e0ae5a31d53f6aef4fdaa996d15dce161011814326808580654: Click on an individual part of the model to highlight anatomy. `,k=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,A=$localize`:2949e52a456470cb255048c7e1e40b496934ed32962414889722492464: Double-click to zoom in on specific structures.`,R=$localize`:c4673f13cb56aec8867cfdce431a5c1f283895f66288669230125842319: Hold the control key and scroll up and down to zoom in or out. `,Z=$localize`:dfdbec5eab67c07d82c394952e19cca3652719ea6750824053364243866: Scroll up and down to zoom in or out. `,[_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z,["title",n,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"],["icon","caret-up","label",e],["icon","caret-down","label",o],["appLogicalDir","","icon","caret-left","label",i],["appLogicalDir","","icon","caret-right","label",s],["title",r,3,"trigger","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["label","+"],["label","-"],["title",a,3,"trigger"],["label","W"],["label","A"],["label","S"],["label","D"],["title",l,3,"trigger"]]},template:function(e,o){1&e&&(t.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",16),t.pXf(3,0),t.k0s(),t.j41(4,"app-view-tour-slide")(5,"div",17)(6,"div"),t.nrm(7,"app-view-tour-success",18),t.j41(8,"strong",19),t.pXf(9,1),t.k0s(),t.qex(10),t.pXf(11,2),t.bVm(),t.nrm(12,"app-view-tour-tip-button",20)(13,"app-view-tour-tip-button",21)(14,"app-view-tour-tip-button",22)(15,"app-view-tour-tip-button",23),t.qex(16),t.pXf(17,3),t.bVm(),t.k0s()()()(),t.j41(18,"app-view-tour-page")(19,"app-view-tour-slide",24),t.nI1(20,"async"),t.DNE(21,rj,2,0,"ng-container",25)(22,aj,2,0,"ng-container",26),t.k0s(),t.j41(23,"app-view-tour-slide")(24,"div",17)(25,"div"),t.nrm(26,"app-view-tour-success",18),t.j41(27,"strong",19),t.pXf(28,4),t.k0s(),t.qex(29),t.pXf(30,5),t.bVm(),t.nrm(31,"app-view-tour-tip-button",27),t.eu8(32),t.EFF(33,"to zoom in and "),t.nrm(34,"app-view-tour-tip-button",28),t.qex(35),t.pXf(36,6),t.bVm(),t.k0s()()()(),t.j41(37,"app-view-tour-page")(38,"app-view-tour-slide",29),t.pXf(39,7),t.k0s(),t.j41(40,"app-view-tour-slide")(41,"div",17)(42,"div"),t.nrm(43,"app-view-tour-success",18),t.j41(44,"strong",19),t.pXf(45,8),t.k0s(),t.qex(46),t.pXf(47,9),t.bVm(),t.nrm(48,"app-view-tour-tip-button",30)(49,"app-view-tour-tip-button",31)(50,"app-view-tour-tip-button",32)(51,"app-view-tour-tip-button",33),t.qex(52),t.pXf(53,10),t.bVm(),t.k0s()()()(),t.j41(54,"app-view-tour-page")(55,"app-view-tour-slide",34),t.pXf(56,11),t.k0s(),t.j41(57,"app-view-tour-slide")(58,"div",17)(59,"div"),t.nrm(60,"app-view-tour-success",18),t.j41(61,"strong",19),t.pXf(62,12),t.k0s(),t.qex(63),t.pXf(64,13),t.bVm(),t.k0s()()()()()),2&e&&(t.R7$(2),t.Y8G("trigger",o.triggers.CameraRotate),t.R7$(5),t.Y8G("inline",!0),t.R7$(12),t.Y8G("trigger",o.triggers.CameraZoom)("ngSwitch",t.bMT(20,10,o.captureScroll$)),t.R7$(2),t.Y8G("ngSwitchCase",!1),t.R7$(5),t.Y8G("inline",!0),t.R7$(12),t.Y8G("trigger",o.triggers.CameraPan),t.R7$(5),t.Y8G("inline",!0),t.R7$(12),t.Y8G("trigger",o.triggers.NodeSelection),t.R7$(5),t.Y8G("inline",!0))},dependencies:[b.ux,b.e1,b.fG,Hi,$f,Kp,Gf,gT,ij,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(U.getScrollMode),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],Ff.prototype,"scrollMode$",void 0);let lj=(()=>{var n;class e{constructor(i){this.viewService=i,this.triggers=sa,this.videoTutorialSources=Lf}handleStartClick(){this.viewService.toggleTutorial(!1)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(zt))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-tour-mobile"]],decls:27,vars:5,consts:()=>{let o,i,s,r,a,l,_,d,p,u;return o=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,i=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,s=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,r=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,a=$localize`:40fea76a56245ebbead6177bc3d17ae5ec40a1652280443087469838323: Tap and drag with one finger to change the viewing angle. `,l=$localize`:8427d89e9a09d73465919535774a238eb9d421db2729825529782328186: Pinch with two fingers to zoom in or out. `,_=$localize`:14defb0441cab2a9b33483931a54f51867c652e96006726473932808920: Use two fingers to adjust the model's position. `,d=$localize`:1a9195f9922538bdf4a4aff64ca479c285355cfe7928756420516267887: Tap on an individual part of the model to highlight anatomy. `,p=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,u=$localize`:646945605f8dced01098f9c393573c2a9b46a8425072295053569562541:Double-tap to zoom in on specific structures.`,[a,l,_,d,p,u,["title",o,3,"trigger"],["title",i,3,"trigger"],["title",s,3,"trigger"],["title",r,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"]]},template:function(i,s){1&i&&(t.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",6),t.pXf(3,0),t.k0s(),t.j41(4,"app-view-tour-slide"),t.nrm(5,"app-view-tour-success"),t.k0s()(),t.j41(6,"app-view-tour-page")(7,"app-view-tour-slide",7),t.pXf(8,1),t.k0s(),t.j41(9,"app-view-tour-slide"),t.nrm(10,"app-view-tour-success"),t.k0s()(),t.j41(11,"app-view-tour-page")(12,"app-view-tour-slide",8),t.pXf(13,2),t.k0s(),t.j41(14,"app-view-tour-slide"),t.nrm(15,"app-view-tour-success"),t.k0s()(),t.j41(16,"app-view-tour-page")(17,"app-view-tour-slide",9),t.pXf(18,3),t.k0s(),t.j41(19,"app-view-tour-slide")(20,"div",10)(21,"div"),t.nrm(22,"app-view-tour-success",11),t.j41(23,"strong",12),t.pXf(24,4),t.k0s(),t.qex(25),t.pXf(26,5),t.bVm(),t.k0s()()()()()),2&i&&(t.R7$(2),t.Y8G("trigger","camera-rotate"),t.R7$(5),t.Y8G("trigger",s.triggers.CameraZoom),t.R7$(5),t.Y8G("trigger",s.triggers.CameraPan),t.R7$(5),t.Y8G("trigger",s.triggers.NodeSelection),t.R7$(5),t.Y8G("inline",!0))},dependencies:[$f,Kp,Gf,gT],changeDetection:0}),e})();var O_,hT=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},mT=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function cj(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",6)(1,"h2",7),t.pXf(2,1),t.k0s(),t.j41(3,"p",8),t.qex(4),t.pXf(5,2),t.bVm(),t.nrm(6,"button",9),t.nI1(7,"async"),t.nI1(8,"async"),t.j41(9,"mat-menu",null,0)(11,"button",10),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectInputModeClick(s.inputModes.Mouse))}),t.EFF(12),t.k0s(),t.j41(13,"button",10),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleSelectInputModeClick(s.inputModes.Touch))}),t.EFF(14),t.k0s()()(),t.j41(15,"div",11)(16,"button",12),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExitClick())}),t.k0s(),t.j41(17,"button",13),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleStartClick())}),t.k0s()()()}if(2&n){const o=t.sdS(10),i=t.XpG();t.R7$(6),t.Y8G("compact",!0)("label",i.inputModesText[t.bMT(7,6,i.inputMode$)])("matMenuTriggerFor",o),t.BMQ("aria-label",i.inputModesText[t.bMT(8,8,i.inputMode$)]),t.R7$(6),t.SpI(" ",i.inputModesText[i.inputModes.Mouse]," "),t.R7$(2),t.SpI(" ",i.inputModesText[i.inputModes.Touch]," ")}}function _j(n,e){1&n&&t.nrm(0,"app-view-tour-mobile")}function dj(n,e){1&n&&t.nrm(0,"app-view-tour-desktop")}function pj(n,e){if(1&n&&(t.j41(0,"div",14),t.nI1(1,"async"),t.DNE(2,_j,1,0,"app-view-tour-mobile",15)(3,dj,1,0,"app-view-tour-desktop",16),t.k0s()),2&n){const o=t.XpG();t.Y8G("ngSwitch",t.bMT(1,2,o.inputMode$)),t.R7$(2),t.Y8G("ngSwitchCase",o.inputModes.Touch)}}class Jp{constructor(e,o,i){this.store=e,this.viewService=o,this.storageService=i,this.inputModes=Dr,this.inputModesText={[Dr.Mouse]:$localize`mouse, trackpad, or keyboard`,[Dr.Touch]:$localize`touchscreen`},this.tourStarted=!1,this.tourEnded=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.initListeners(),this.store.dispatch(new D.TutorialSeen(!0))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.tutorial$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({pageIndex:e,pageSize:o})=>{this.tourStarted=e>-1,this.tourEnded=e===o-1}),(0,hn.R)(window,"keyup").pipe((0,X.p)(e=>"Escape"===e.key),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.exit()})}handleExitClick(){this.exit()}handleStartClick(){this.store.dispatch(new D.StartTutorial(!1))}handleSelectInputModeClick(e){this.store.dispatch(new D.SetInputMode(e))}exit(){this.viewService.toggleTutorial(!1)}}(O_=Jp).\u0275fac=function(e){return new(e||O_)(t.rXU(c.il),t.rXU(zt),t.rXU(Le))},O_.\u0275cmp=t.VBU({type:O_,selectors:[["app-view-tour"]],decls:3,vars:5,consts:()=>{let n,e,o,i,s,r,a;return n=$localize`:b6d518ec10f5635af884c06c0ee31f0d4589e8a2580493549510248593:Getting Started Tutorial`,e=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,o=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,i=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,s=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,r=$localize`:486c6addfeb93356cab8bbb37310c8f61534e1f29156212170228959929:Getting Started`,a=$localize`:80ef270109b95917aeaa29935ed0aeb1b53376275246430719012249797:Welcome! This tutorial will teach you how to navigate and explore in 3D using your`,[["inputSelectionMenu","matMenu"],r,a,["role","dialog","aria-label",n,"cdkTrapFocus","",1,"tour"],["class","tour__intro",4,"ngIf"],["class","tour__contents",3,"ngSwitch",4,"ngIf"],[1,"tour__intro"],[1,"tour__title"],[1,"tour__welcome"],["app-view-rounded-button","","buttonType","outline","icon","chevron-down","iconPlacement","right",1,"tour__input-selection","text-small",3,"compact","label","matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"tour__footer"],["app-view-rounded-button","","buttonType","outline","label",e,"aria-label",o,"data-test","tutorialExitButton",1,"mr-3",3,"click"],["app-view-rounded-button","","buttonType","solid","label",i,"aria-label",s,"data-test","tutorialStartButton",1,"ml-3",3,"click"],[1,"tour__contents",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]]},template:function(e,o){1&e&&(t.j41(0,"div",3),t.DNE(1,cj,18,10,"div",4)(2,pj,4,4,"div",5),t.k0s()),2&e&&(t.AVh("tour--started",o.tourStarted),t.Y8G("@refresh",void 0),t.R7$(),t.Y8G("ngIf",!o.tourStarted),t.R7$(),t.Y8G("ngIf",o.tourStarted))},dependencies:[vi.kB,b.bT,b.ux,b.e1,b.fG,jn.kk,jn.fb,jn.Cp,RV,Ff,lj,b.Jj],styles:[".tour[_ngcontent-%COMP%]{color:#fff;position:fixed;inset:0;z-index:100;pointer-events:none;display:flex;flex-direction:column;align-items:center;overflow:auto}.tour__title[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}.tour__welcome[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;margin:16px auto 32px}.tour__intro[_ngcontent-%COMP%]{background:#101823e6;border-radius:16px;margin:auto;padding:28px 32px;text-align:center;max-width:560px}.tour__input-selection[_ngcontent-%COMP%]{margin:0 8px;vertical-align:middle}.tour__header[_ngcontent-%COMP%]{flex:none;align-self:flex-end;justify-self:flex-start;margin:24px}.tour__contents[_ngcontent-%COMP%]{flex:auto;display:flex;flex-direction:column;justify-content:flex-end;width:100%}.tour__footer[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;display:flex;flex-direction:row;align-items:center;justify-content:center}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.875rem;line-height:2.25rem;cursor:pointer}.tour--ended[_ngcontent-%COMP%]   .tour__contents[_ngcontent-%COMP%]{justify-content:center}@media (max-width: 768px){.tour__intro[_ngcontent-%COMP%]{border-radius:12px;padding:20px 24px;margin:auto 12%;max-width:100%}.tour__intro__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;max-width:80%}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.875rem;line-height:1.25rem}.tour__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}@media (max-width: 480px){.tour__intro[_ngcontent-%COMP%]{border-radius:8px;padding:16px 20px;margin:auto 10%}.tour__intro__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin:12px auto 16px}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.75rem;line-height:1rem}.tour__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}}"],data:{animation:[(0,ie.hZ)("refresh",[(0,ie.kY)(":enter",[(0,ie.sM)(gl.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),hT([(0,c.l6)(P.getTutorial),mT("design:type",f.c)],Jp.prototype,"tutorial$",void 0),hT([(0,c.l6)(P.getInputMode),mT("design:type",f.c)],Jp.prototype,"inputMode$",void 0);var w_,fT=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},ST=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function uj(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"button",7),t.nI1(2,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleUndoClick())}),t.nrm(3,"app-icon",8),t.k0s(),t.j41(4,"button",9),t.nI1(5,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleRedoClick())}),t.nrm(6,"app-icon",10),t.k0s(),t.bVm()}if(2&n){const o=t.XpG(2);t.R7$(),t.Y8G("disabled",!1===t.bMT(2,6,o.canUndo$))("matTooltipPosition",o.tooltipPosition),t.R7$(2),t.Y8G("custom",!0),t.R7$(),t.Y8G("disabled",!1===t.bMT(5,8,o.canRedo$))("matTooltipPosition",o.tooltipPosition),t.R7$(2),t.Y8G("custom",!0)}}function gj(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",2)(1,"app-pillbox",3),t.DNE(2,uj,7,10,"ng-container",4),t.j41(3,"button",5),t.nI1(4,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleResetClick())}),t.j41(5,"span",6),t.pXf(6,0),t.k0s()()()()}if(2&n){const o=t.XpG();t.Y8G("@show",void 0),t.R7$(2),t.Y8G("ngIf","full"===o.layout),t.R7$(),t.Y8G("disabled",!1===t.bMT(4,4,o.canUndo$))("matTooltipPosition",o.tooltipPosition)}}class Zp{constructor(e,o){this.viewService=e,this.directionality=o,this.layout="full",this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}}(w_=Zp).\u0275fac=function(e){return new(e||w_)(t.rXU(zt),t.rXU(zs.dS))},w_.\u0275cmp=t.VBU({type:w_,selectors:[["app-view-undo"]],inputs:{layout:"layout"},decls:2,vars:3,consts:()=>{let n,e,o,i,s,r;return n=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,e=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,o=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,i=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,s=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,r=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,[e,["class","view-undo",4,"ngIf"],[1,"view-undo"],["orientation","vertical"],[4,"ngIf"],["app-view-button","","buttonSize","small","buttonShape","rounded","data-test","reset-btn","matTooltip",n,3,"click","disabled","matTooltipPosition"],[1,"font-semibold","text-2xs"],["app-view-button","","buttonSize","small","data-test","undo-btn","icon","undo","aria-label",o,"matTooltip",i,3,"click","disabled","matTooltipPosition"],["icon","undo","appLogicalDir","",3,"custom"],["app-view-button","","buttonSize","small","data-test","redo-btn","aria-label",s,"matTooltip",r,"icon","redo",3,"click","disabled","matTooltipPosition"],["icon","redo","appLogicalDir","",3,"custom"]]},template:function(e,o){1&e&&(t.DNE(0,gj,7,6,"div",1),t.nI1(1,"async")),2&e&&t.Y8G("ngIf",t.bMT(1,1,o.canUndo$))},dependencies:[xt,b.bT,Hi,qe,Sn.oV,Uo,b.Jj],styles:["[_nghost-%COMP%]{pointer-events:none}"],data:{animation:[(0,ie.hZ)("show",[(0,ie.kY)(":enter",(0,ie.K2)([(0,ie.iF)({transform:"translateX(-100%)",opacity:0}),(0,ie.i0)("150ms ease-in-out",(0,ie.iF)({transform:"translateX(0%)",opacity:1}))]))])]},changeDetection:0}),fT([(0,c.l6)(vn.canUndo),ST("design:type",f.c)],Zp.prototype,"canUndo$",void 0),fT([(0,c.l6)(vn.canRedo),ST("design:type",f.c)],Zp.prototype,"canRedo$",void 0);const hj=["textRef"],mj=n=>({"whiteboard-label__label--active":n});function fj(n,e){if(1&n){const o=t.RV6();t.j41(0,"div")(1,"div",4),t.bIt("cdkDragMoved",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.dragMoved(s,"corner1"))}),t.k0s(),t.j41(2,"div",5),t.bIt("cdkDragMoved",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.dragMoved(s,"corner2"))}),t.k0s(),t.j41(3,"div",6),t.bIt("cdkDragMoved",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.dragMoved(s,"corner3"))}),t.k0s(),t.j41(4,"div",7),t.bIt("cdkDragMoved",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.dragMoved(s,"corner4"))}),t.k0s(),t.j41(5,"div",8),t.bIt("cdkDragMoved",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.translateHandleMoved(s))}),t.k0s()()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner1),t.R7$(),t.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner2),t.R7$(),t.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner3),t.R7$(),t.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner4),t.R7$(),t.Y8G("cdkDragFreeDragPosition",o.dragHandles.translate)}}let Sj=(()=>{var n;class e{get id(){return this._id}set id(i){this._id=i,this.initialized=!1}set color(i){this.renderer.setStyle(this.textRef.nativeElement,"color",i)}set exporting(i){i&&(this.active=!1,this.labelActive.next(void 0))}set size(i){this.renderer.setStyle(this.textRef.nativeElement,"font-size",`${i}px`)}constructor(i,s,r,a){this.store=i,this.changeDetectorRef=s,this.renderer=r,this.localeId=a,this.active=!0,this.initialized=!1,this.labelActive=new t.bkB,this.labelEmpty=new t.bkB,this.dragHandles={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.handleCoords={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.textareaTransform={x:0,y:0,width:110,height:40},this.ngUnsubscribe=new oe.B,this.handleDocumentBackspace=l=>{const{activeElement:_}=this.textRef.nativeElement;"Backspace"===l.key&&this.active&&!_&&this.deleteLabel()},this.handleTextboxMouseDown=l=>{this.active=!0,this.labelActive.next(this.id),this.refreshHandles()},this.handleDocumentMouseDown=l=>{const _=l.target.className.includes("view-whiteboard__canvas"),d=l.target.className.includes("whiteboard-label__label"),p=l.target.dataset.id===this.id;this.isLabelEmpty()&&!p&&this.initialized?this.deleteLabel():(_||d&&!p)&&(this.active=!1,this.changeDetectorRef.markForCheck())},this.handleTextKeyDown=l=>{if(l.stopPropagation(),this.isLabelEmpty()&&"Backspace"===l.key)return void this.deleteLabel();const _=this.textRef.nativeElement.scrollHeight,{corner1:d,corner3:p,corner4:u}=this.handleCoords,g=d.y+_;this.handleCoords.corner3={...p,y:g},this.handleCoords.corner4={...u,y:g},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.updateTextarea(),this.changeDetectorRef.markForCheck()},this.dir=Ol(this.localeId).direction}ngOnInit(){this.initHandles(),this.initInteractionListeners(),this.initStateListeners(),setTimeout(()=>{this.textRef.nativeElement.focus(),this.initialized=!0})}ngOnDestroy(){this.textRef.nativeElement.removeEventListener("keydown",this.handleTextKeyDown),this.textRef.nativeElement.removeEventListener("mousedown",this.handleTextboxMouseDown),this.mouseDownListener(),this.backspaceListener(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initHandles(){this.textareaTransform.x=this.initialPos.x,this.textareaTransform.y=this.initialPos.y;const{x:i,y:s,width:r,height:a}=this.textareaTransform;this.dragHandles.corner1={x:i,y:s},this.dragHandles.corner2={x:i+r,y:s},this.dragHandles.corner3={x:i+r,y:s+a},this.dragHandles.corner4={x:i,y:s+a},this.dragHandles.translate={x:i+r/2,y:s+-10},this.handleCoords.corner1={...this.dragHandles.corner1},this.handleCoords.corner2={...this.dragHandles.corner2},this.handleCoords.corner3={...this.dragHandles.corner3},this.handleCoords.corner4={...this.dragHandles.corner4},this.handleCoords.translate={...this.dragHandles.translate},this.updateTextarea()}initStateListeners(){this.store.select(P.getWhiteboardAnnotateMode).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{i!==No.Text&&(this.active=!1,this.labelActive.next(void 0),this.changeDetectorRef.markForCheck())})}initInteractionListeners(){this.mouseDownListener=this.renderer.listen("document","mousedown",this.handleDocumentMouseDown),this.backspaceListener=this.renderer.listen("document","keydown",this.handleDocumentBackspace),this.textRef.nativeElement.addEventListener("mousedown",this.handleTextboxMouseDown),this.textRef.nativeElement.addEventListener("keydown",this.handleTextKeyDown)}refreshHandles(){this.dragHandles.corner1={...this.handleCoords.corner1},this.dragHandles.corner2={...this.handleCoords.corner2},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.dragHandles.translate={...this.handleCoords.translate},this.changeDetectorRef.markForCheck()}isLabelEmpty(){return""===this.textRef.nativeElement.innerText||"\n"===this.textRef.nativeElement.innerText}deleteLabel(){this.labelEmpty.next(this.id)}updateTextarea(){const{corner1:i,corner2:s,corner3:r}=this.handleCoords;this.textareaTransform.x=i.x,this.textareaTransform.y=i.y,this.textareaTransform.width=s.x-i.x,this.textareaTransform.height=r.y-s.y,this.renderer.setStyle(this.textRef.nativeElement,"transform",`translate(${this.textareaTransform.x}px, ${this.textareaTransform.y}px)`),this.renderer.setStyle(this.textRef.nativeElement,"width",`${this.textareaTransform.width}px`),this.renderer.setStyle(this.textRef.nativeElement,"height",`${this.textareaTransform.height}px`)}updateTranslateHandle(){const{corner1:i,corner2:s}=this.handleCoords;this.handleCoords.translate={x:(s.x-i.x)/2+i.x,y:i.y+-10},this.dragHandles.translate={...this.handleCoords.translate}}setHandle(i,s,r){this.handleCoords[i]={...this.handleCoords[i],[s]:r[s]},this.dragHandles[i]={...this.handleCoords[i]}}addDiffToHandle(i,s){this.handleCoords[i]={x:this.handleCoords[i].x+s.x,y:this.handleCoords[i].y+s.y},this.dragHandles[i]={...this.handleCoords[i]}}translateHandleMoved(i){const s=i.source._dragRef.getFreeDragPosition(),r={x:s.x-this.handleCoords.translate.x,y:s.y-this.handleCoords.translate.y};this.handleCoords.translate={...s},this.addDiffToHandle("corner1",r),this.addDiffToHandle("corner2",r),this.addDiffToHandle("corner3",r),this.addDiffToHandle("corner4",r),this.updateTextarea()}dragMoved(i,s){const r=i.source._dragRef.getFreeDragPosition();this.handleCoords[s]={...r},"corner1"===s&&(this.setHandle("corner2","y",r),this.setHandle("corner4","x",r)),"corner2"===s&&(this.setHandle("corner1","y",r),this.setHandle("corner3","x",r)),"corner3"===s&&(this.setHandle("corner2","x",r),this.setHandle("corner4","y",r)),"corner4"===s&&(this.setHandle("corner1","x",r),this.setHandle("corner3","y",r)),this.updateTranslateHandle(),this.updateTextarea()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(t.gRc),t.rXU(t.sFG),t.rXU(t.xe9))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-whiteboard-label"]],viewQuery:function(i,s){if(1&i&&t.GBs(hj,7),2&i){let r;t.mGM(r=t.lsd())&&(s.textRef=r.first)}},inputs:{id:"id",initialPos:"initialPos",color:"color",exporting:"exporting",size:"size"},outputs:{labelActive:"labelActive",labelEmpty:"labelEmpty"},decls:4,vars:6,consts:()=>{let o;return o=$localize`:0fde29c90b84be4dd7bc39adcce90313a570f14b1511122002214104331:Type..`,[["textRef",""],[1,"whiteboard-label"],[4,"ngIf"],["contenteditable","true","data-placeholder",o,1,"whiteboard-label__label",3,"dir","ngClass"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--move",3,"cdkDragMoved","cdkDragFreeDragPosition"]]},template:function(i,s){1&i&&(t.j41(0,"div",1),t.DNE(1,fj,6,5,"div",2),t.nrm(2,"div",3,0),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!0===s.active),t.R7$(),t.Y8G("dir",s.dir)("ngClass",t.eq3(4,mj,!0===s.active)),t.BMQ("data-id",s.id))},dependencies:[b.YU,b.bT,Bl.T1,zs.ig],styles:['.whiteboard-label[_ngcontent-%COMP%]{position:relative;z-index:1000}.whiteboard-label__handle[_ngcontent-%COMP%]{position:fixed;z-index:10;width:32px;height:32px;left:-16px;top:-16px}.whiteboard-label__handle[_ngcontent-%COMP%]:after{content:"";position:absolute;width:12px;height:12px;left:10px;top:10px;border-radius:50%;background-color:#2d72dc}.whiteboard-label__handle[_ngcontent-%COMP%]:hover{cursor:pointer}.whiteboard-label__handle--top-left[_ngcontent-%COMP%]:hover{cursor:nw-resize}.whiteboard-label__handle--top-right[_ngcontent-%COMP%]:hover{cursor:ne-resize}.whiteboard-label__handle--bottom-right[_ngcontent-%COMP%]:hover{cursor:se-resize}.whiteboard-label__handle--bottom-left[_ngcontent-%COMP%]:hover{cursor:sw-resize}.whiteboard-label__handle--move[_ngcontent-%COMP%]:hover{cursor:move}.whiteboard-label__label[_ngcontent-%COMP%]{box-sizing:border-box;position:absolute;border:none;padding:5px;overflow-y:hidden}.whiteboard-label__label--active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px #2d72dc}.whiteboard-label__label[_ngcontent-%COMP%]:focus{outline:none}.whiteboard-label__label[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#374a6880}'],changeDetection:0}),e})();var M_,nr=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},ir=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const bj=["colorBtn"];function yj(n,e){1&n&&(t.j41(0,"div"),t.nrm(1,"app-icon",28),t.j41(2,"span",29),t.pXf(3,5),t.k0s()())}function vj(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.setTextSize(s.size))}),t.j41(1,"div",24)(2,"div",25),t.DNE(3,yj,4,0,"div",26),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",27)(6,"span"),t.EFF(7),t.k0s()()()()}if(2&n){const o=e.$implicit,i=t.XpG();t.R7$(3),t.Y8G("ngIf",o.size===t.bMT(4,2,i.textSize$)),t.R7$(4),t.SpI("",o.label,"px")}}function Ej(n,e){1&n&&(t.j41(0,"div"),t.nrm(1,"app-icon",28),t.j41(2,"span",29),t.pXf(3,6),t.k0s()())}function Tj(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.setBrushSize(s.size))}),t.j41(1,"div",24)(2,"div",25),t.DNE(3,Ej,4,0,"div",26),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",27),t.nrm(6,"app-icon",30),t.j41(7,"span"),t.EFF(8),t.k0s()()()()}if(2&n){const o=e.$implicit,i=t.XpG();t.R7$(3),t.Y8G("ngIf",o.size===t.bMT(4,4,i.brushSize$)),t.R7$(3),t.xc7("font-size",o.size,"px"),t.R7$(2),t.JRh(o.label)}}function Cj(n,e){1&n&&(t.j41(0,"div"),t.nrm(1,"app-icon",28),t.j41(2,"span",29),t.pXf(3,7),t.k0s()())}function Oj(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.setEraserSize(s.size))}),t.j41(1,"div",24)(2,"div",25),t.DNE(3,Cj,4,0,"div",26),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",31),t.nrm(6,"app-icon",30),t.j41(7,"span"),t.EFF(8),t.k0s()()()()}if(2&n){const o=e.$implicit,i=t.XpG();t.R7$(3),t.Y8G("ngIf",o.size===t.bMT(4,4,i.eraserSize$)),t.R7$(3),t.xc7("font-size",o.size,"px"),t.R7$(2),t.JRh(o.label)}}function wj(n,e){1&n&&(t.j41(0,"div"),t.nrm(1,"app-icon",28),t.j41(2,"span",29),t.pXf(3,8),t.k0s()())}function Mj(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG();return t.Njj(r.setBrushColor(s.color))}),t.j41(1,"div",24)(2,"div",25),t.DNE(3,wj,4,0,"div",26),t.nI1(4,"async"),t.k0s(),t.j41(5,"div",27),t.nrm(6,"span",32),t.j41(7,"span"),t.EFF(8),t.nI1(9,"titlecase"),t.k0s()()()()}if(2&n){const o=e.$implicit,i=t.XpG();t.R7$(3),t.Y8G("ngIf",o.color===t.bMT(4,4,i.brushColor$)),t.R7$(3),t.xc7("background-color",o.color),t.R7$(2),t.JRh(t.bMT(9,6,o.label))}}class jo{constructor(e){this.store=e,this.textSizes=bv,this.brushSizes=Sv,this.brushColors=[{label:$localize`Black`,color:Sh.color},{label:$localize`Red`,color:"#ff0000"},{label:$localize`Yellow`,color:"#ffff00"},{label:$localize`Green`,color:"#00ff00"},{label:$localize`Cyan`,color:"#00ffff"},{label:$localize`Blue`,color:"#0000ff"},{label:$localize`Pink`,color:"#ff00ff"},{label:$localize`White`,color:vv.color}],this.eraserSizes=yv,this.modeEnum=No,this.downloadClick=new t.bkB,this.clearClick=new t.bkB,this.exitClick=new t.bkB,this.ngUnsubscribe=new oe.B}ngOnInit(){}ngAfterViewInit(){this.hasPaint$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{!e&&this.store.selectSnapshot(P.getWhiteboardAnnotateMode)===No.Erase&&this.handleModeSelect(No.Paint)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setBrushSize(e){this.store.dispatch(new D.SetWhiteboardBrushSize(e))}setBrushColor(e){this.store.dispatch(new D.SetWhiteboardBrushColor(e))}setTextSize(e){this.store.dispatch(new D.SetWhiteboardTextSize(e))}handleModeSelect(e){this.store.dispatch(new D.SetWhiteboardAnnotateMode(e))}setEraserSize(e){this.store.dispatch(new D.SetWhiteboardEraserSize(e))}handleDownloadClick(){this.downloadClick.next()}handleClearClick(){this.clearClick.next()}handleExitClick(){this.exitClick.next()}}(M_=jo).\u0275fac=function(e){return new(e||M_)(t.rXU(c.il))},M_.\u0275cmp=t.VBU({type:M_,selectors:[["app-view-whiteboard-tools"]],viewQuery:function(e,o){if(1&e&&t.GBs(bj,7,t.aKT),2&e){let i;t.mGM(i=t.lsd())&&(o.colorBtn=i.first)}},outputs:{downloadClick:"downloadClick",clearClick:"clearClick",exitClick:"exitClick"},decls:37,vars:43,consts:()=>{let n,e,o,i,s,r,a,l,_,d,p,u,g,y;return n=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,e=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,o=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,i=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,s=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,r=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,a=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,l=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,_=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,d=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,p=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,u=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,g=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,y=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["colorBtn","matMenuTrigger"],["textSizeMenu","matMenu"],["brushSizeMenu","matMenu"],["eraserSizeMenu","matMenu"],["brushColorMenu","matMenu"],p,u,g,y,[1,"view-whiteboard-tools"],["name","Whiteboard","orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",n,"matTooltip",e,"matTooltipPosition","right",3,"matMenuTriggerFor","buttonTheme"],["size","lg","icon","tint"],["app-view-button","","buttonSize","small","aria-label",o,"matTooltip",i,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","paint-brush"],["app-view-button","","buttonSize","small","aria-label",s,"matTooltip",r,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","text-size"],["app-view-button","","buttonSize","small","aria-label",a,"matTooltip",l,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme","disabled"],["size","lg","icon","eraser"],["orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",_,"matTooltip",d,"matTooltipPosition","right",3,"click","disabled"],["size","lg","icon","trash"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","flex-row","items-center","justify-start"],[1,"view-whiteboard-tools__check"],[4,"ngIf"],[1,"view-whiteboard-tools__label"],["icon","check","aria-hidden","true",1,"mr-2"],[1,"sr-only"],["icon","circle","aria-hidden","true",1,"mr-2"],[1,"view-whiteboard-tools__label","flex","flex-auto","items-center"],[1,"view-whiteboard-tools__swatch"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",9)(1,"app-pillbox",10)(2,"button",11,0),t.nrm(4,"app-icon",12),t.k0s(),t.j41(5,"button",13),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleModeSelect(o.modeEnum.Paint))}),t.nrm(9,"app-icon",14),t.k0s(),t.j41(10,"button",15),t.nI1(11,"async"),t.nI1(12,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleModeSelect(o.modeEnum.Text))}),t.nrm(13,"app-icon",16),t.k0s(),t.j41(14,"button",17),t.nI1(15,"async"),t.nI1(16,"async"),t.nI1(17,"async"),t.nI1(18,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleModeSelect(o.modeEnum.Erase))}),t.nrm(19,"app-icon",18),t.k0s(),t.nrm(20,"app-pillbox-divider",19),t.j41(21,"button",20),t.nI1(22,"async"),t.nI1(23,"async"),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleClearClick())}),t.nrm(24,"app-icon",21),t.k0s(),t.j41(25,"mat-menu",null,1),t.DNE(27,vj,8,4,"button",22),t.k0s(),t.j41(28,"mat-menu",null,2),t.DNE(30,Tj,9,6,"button",22),t.k0s(),t.j41(31,"mat-menu",null,3),t.DNE(33,Oj,9,6,"button",22),t.k0s(),t.j41(34,"mat-menu",null,4),t.DNE(36,Mj,10,8,"button",22),t.k0s()()()}if(2&e){const i=t.sdS(3),s=t.sdS(26),r=t.sdS(29),a=t.sdS(32),l=t.sdS(35);t.R7$(2),t.Y8G("matMenuTriggerFor",l)("buttonTheme",i.menuOpen?"blue-fill":"transparent-fill"),t.BMQ("aria-selected",i.menuOpen)("aria-pressed",i.menuOpen),t.R7$(3),t.Y8G("matMenuTriggerFor",r)("buttonTheme",t.bMT(6,21,o.mode$)===o.modeEnum.Paint?"blue-fill":"transparent-fill"),t.BMQ("aria-selected",t.bMT(7,23,o.mode$)===o.modeEnum.Paint)("aria-pressed",t.bMT(8,25,o.mode$)===o.modeEnum.Paint),t.R7$(5),t.Y8G("matMenuTriggerFor",s)("buttonTheme",t.bMT(11,27,o.mode$)===o.modeEnum.Text?"blue-fill":"transparent-fill"),t.BMQ("aria-pressed",t.bMT(12,29,o.mode$)===o.modeEnum.Text),t.R7$(4),t.Y8G("matMenuTriggerFor",a)("buttonTheme",t.bMT(15,31,o.mode$)===o.modeEnum.Erase?"blue-fill":"transparent-fill")("disabled",!1===t.bMT(16,33,o.hasPaint$)),t.BMQ("aria-selected",t.bMT(17,35,o.mode$)===o.modeEnum.Erase)("aria-pressed",t.bMT(18,37,o.mode$)===o.modeEnum.Erase),t.R7$(7),t.Y8G("disabled",!1===t.bMT(22,39,o.hasPaint$)&&!1===t.bMT(23,41,o.hasText$)),t.R7$(6),t.Y8G("ngForOf",o.textSizes),t.R7$(3),t.Y8G("ngForOf",o.brushSizes),t.R7$(3),t.Y8G("ngForOf",o.eraserSizes),t.R7$(3),t.Y8G("ngForOf",o.brushColors)}},dependencies:[xt,b.Sq,b.bT,qe,jn.kk,jn.fb,jn.Cp,Sn.oV,Uo,Rp,b.Jj,b.PV],styles:[".view-whiteboard-tools__check{min-width:20px;color:#2d72dc}.view-whiteboard-tools__swatch{display:inline-block;width:14px;height:14px;border-radius:50%;margin-inline-end:8px;box-shadow:0 0 0 1px #96a8c0}\n"],encapsulation:2,changeDetection:0}),nr([(0,c.l6)(P.isWhiteboardLocked),ir("design:type",f.c)],jo.prototype,"isLocked$",void 0),nr([(0,c.l6)(P.getWhiteboardAnnotateMode),ir("design:type",f.c)],jo.prototype,"mode$",void 0),nr([(0,c.l6)(P.getWhiteboardBrushSize),ir("design:type",f.c)],jo.prototype,"brushSize$",void 0),nr([(0,c.l6)(P.getWhiteboardTextSize),ir("design:type",f.c)],jo.prototype,"textSize$",void 0),nr([(0,c.l6)(P.getWhiteboardBrushColor),ir("design:type",f.c)],jo.prototype,"brushColor$",void 0),nr([(0,c.l6)(P.getWhiteboardEraserSize),ir("design:type",f.c)],jo.prototype,"eraserSize$",void 0),nr([(0,c.l6)(P.getWhiteboardHasPaint),ir("design:type",f.c)],jo.prototype,"hasPaint$",void 0),nr([(0,c.l6)(P.getWhiteboardHasText),ir("design:type",f.c)],jo.prototype,"hasText$",void 0);var I_,ra=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},aa=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const Ij=["drawCanvas"],Aj=["annotateWrapper"];function Pj(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-view-whiteboard-label",12),t.nI1(1,"async"),t.bIt("labelActive",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleLabelActive(s))})("labelEmpty",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleLabelEmpty(s))}),t.k0s()}if(2&n){const o=e.$implicit,i=t.XpG();t.AVh("view-whiteboard__label--clickthrough",t.bMT(1,7,i.annotateMode$)!==i.whiteboardAnnotateMode.Text),t.Y8G("exporting",i.exporting)("id",o.id)("initialPos",o.pos)("color",o.color)("size",o.size)}}function Nj(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",13),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExitClick())}),t.j41(1,"span",14),t.pXf(2,2),t.k0s()()}}const Bf=Gi.PNG;class gs{constructor(e,o,i,s,r,a){this.store=e,this.actions=o,this.viewService=i,this.clipboardService=s,this.applicationEventService=r,this.changeRef=a,this.whiteboardAnnotateMode=No,this.labels=[],this.exporting=!1,this.drawing=!1,this.brushSize=0,this.eraserSize=0,this.lineWidth=0,this.ngUnsubscribe=new oe.B}ngOnInit(){this.siteHeader=this.store.selectSnapshot(Kt.getSiteHeader),this.store.dispatch(new fn.SetHeader($s.Hide)),this.canvasElement=this.drawCanvas.nativeElement,this.canvasContext=this.canvasElement.getContext("2d"),this.initActiveLabelColorListener(),this.initActiveLabelTextSizeListener(),this.initAnnotateModeListener(),this.initBrushColorFromBackgroundListener(),this.store.dispatch(new Yo(!1))}ngAfterViewInit(){this.initCanvasListeners()}ngOnDestroy(){this.inputManager.destroy(),this.reset(),this.store.dispatch(new fn.SetHeader(this.siteHeader)),this.store.dispatch(new Yo(!0)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initAnnotateModeListener(){this.annotateMode$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{switch(this.inputManager&&this.inputManager.destroy(),e){case No.Paint:this.canvasContext.globalCompositeOperation="source-over",this.setLineWidth(this.brushSize),this.initDrawListeners();break;case No.Text:this.initTextListener();break;case No.Erase:this.canvasContext.globalCompositeOperation="destination-out",this.setLineWidth(this.eraserSize),this.initDrawListeners()}this.applicationEventService.fireEvent(Ce.WhiteboardModeUpdated,e)})}initActiveLabelColorListener(){this.brushColor$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.labels.find(i=>i.id===this.activeLabelId);o&&(o.color=e,this.changeRef.markForCheck())})}initActiveLabelTextSizeListener(){this.textSize$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.labels.find(i=>i.id===this.activeLabelId);o&&(o.size=e,this.changeRef.markForCheck())})}initBrushColorFromBackgroundListener(){this.background$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=Qg(e)?hI:mI;this.store.dispatch(new D.SetWhiteboardBrushColor(o.color))})}initTextListener(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Tap({event:"tap"})),this.inputManager.on("tap",e=>{if(this.activeLabelId)return void(this.activeLabelId=void 0);const o=(0,m.uniqueId)();let i=e.center.x,s=e.center.y;void 0!==e.pointers[0].x&&(i=e.pointers[0].x,s=e.pointers[0].y);const r=this.store.selectSnapshot(P.getWhiteboardBrushColor),a=this.store.selectSnapshot(P.getWhiteboardTextSize);this.labels.push({id:o,pos:{x:i,y:s},color:r,size:a}),this.activeLabelId=o,this.changeRef.markForCheck(),this.dispatchHasText()})}initCanvasListeners(){this.brushSize$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.setBrushSize(e)}),this.brushColor$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.setBrushColor(e)}),this.eraserSize$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.setEraserSize(e)}),this.syncCanvas()}initDrawListeners(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Pan({event:"pan",pointers:0})),this.inputManager.add(new Hammer.Tap({event:"tap"}));const e=new Map;this.inputManager.on("tap",o=>{this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o);this.drawPoint(i,s),this.checkCanvasPaint()}),this.inputManager.on("panstart",o=>{this.drawing=!0,this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o);e.set(o.pointers[0]?.pointerId||1,{x:i,y:s}),this.applicationEventService.fireEvent(Ce.WhiteboardDrawingStarted)}),this.inputManager.on("pan",o=>{this.drawing=!0,this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o),r=o.pointers[0]?.pointerId||1,{x:a,y:l}=e.get(r);this.drawLine(a,l,i,s),this.drawPoint(i,s),e.set(r,{x:i,y:s})}),this.inputManager.on("panend",()=>{this.drawing=!1,this.changeRef.markForCheck(),e.clear(),this.checkCanvasPaint(),this.applicationEventService.fireEvent(Ce.WhiteboardDrawingFinished)})}handleLabelActive(e){this.activeLabelId=e;const o=this.labels.find(i=>i.id===e);o&&this.store.dispatch([new D.SetWhiteboardTextSize(o.size),new D.SetWhiteboardBrushColor(o.color)])}handleLabelEmpty(e){this.labels=this.labels.filter(o=>o.id!==e),this.changeRef.markForCheck(),this.dispatchHasText()}dispatchHasText(){this.store.dispatch(new D.SetWhiteboardHasText(this.labels.length>0))}handleResetClick(){this.reset()}handleDownloadClick(){this.exporting=!0,this.changeRef.detectChanges();const{width:e,height:o}=this.canvasElement,i=this.store.selectSnapshot(E.getSelectedChapterId),s=this.store.selectSnapshot(E.getSelectedChapterBackground),r=this.store.selectSnapshot(U.getWatermarkEnabled),a=document.querySelector(".engine__watermark"),l=[this.drawCanvas.nativeElement,this.annotateElement.nativeElement];r&&!(0,m.isNil)(a)&&l.push(a),this.store.dispatch(new Cr(i,s,Bf,100,{width:e,height:o},"original",!0,!0,l)).pipe((0,zl.q)(()=>this.actions.pipe((0,c.xi)(Pa),(0,Vt.s)(1))),(0,w.Q)(this.ngUnsubscribe),(0,Ye.j)(()=>{this.exporting=!1,this.changeRef.markForCheck()})).subscribe(_=>{this.downloadSnapshot(_.blob)})}handleExitClick(){this.resetCanvas(),this.viewService.toggleWhiteboard(!1)}getInputPosition(e){const o=e.pointers[0];return o?.pageX?{x:o.pageX,y:o.pageY}:{x:e.center.x,y:e.center.y}}checkCanvasPaint(){const e=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),i=new Uint32Array(e.data.buffer).some(s=>0!==s);this.store.dispatch(new D.SetWhiteboardHasPaint(i))}drawPoint(e,o){const i=this.lineWidth/2,s=2*Math.PI;this.canvasContext.beginPath(),this.canvasContext.arc(e,o,i,0,s),this.canvasContext.fill()}drawLine(e,o,i,s){this.canvasContext.beginPath(),this.canvasContext.moveTo(e,o),this.canvasContext.lineTo(i,s),this.canvasContext.stroke(),this.canvasContext.closePath()}reset(){this.resetCanvas(),this.labels=[],this.changeRef.markForCheck(),this.dispatchHasText()}setBrushSize(e){this.brushSize=e,this.setLineWidth(e)}setBrushColor(e){this.canvasContext.fillStyle=e,this.canvasContext.strokeStyle=e}setEraserSize(e){this.eraserSize=e,this.setLineWidth(e)}setLineWidth(e){this.canvasContext.lineWidth=e,this.lineWidth=e}syncCanvas(){const e=this.store.selectSnapshot(P.getWhiteboardBrushSize),o=this.store.selectSnapshot(P.getWhiteboardBrushColor),i=this.store.selectSnapshot(P.getWhiteboardEraserSize),{width:s,height:r}=this.getScreenDimensions();this.canvasElement.width=s,this.canvasElement.height=r,this.setBrushSize(e),this.setBrushColor(o),this.setEraserSize(i),this.canvasContext.lineJoin="round"}resetCanvas(){const{width:e,height:o}=this.canvasElement;this.canvasContext.clearRect(0,0,e,o),this.store.dispatch(new D.SetWhiteboardHasPaint(!1))}downloadSnapshot(e){const{displayName:o}=this.store.selectSnapshot(Pe.getStory),r=`${(o||"").replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}_drawing.${Bf===Gi.PNG?"png":"jpg"}`;!0===he.native||he.platform===ro.SDK?po.blobToBase64(e).pipe((0,zl.q)(a=>this.clipboardService.copyToClipboard(a,"image")),(0,w.Q)(this.ngUnsubscribe)).subscribe(a=>{}):po.exportImage(e,Bf,r)}getScreenDimensions(){const{innerWidth:e,innerHeight:o}=window;return{width:e,height:o}}}(I_=gs).\u0275fac=function(e){return new(e||I_)(t.rXU(c.il),t.rXU(c.En),t.rXU(zt),t.rXU(Np),t.rXU(mo),t.rXU(t.gRc))},I_.\u0275cmp=t.VBU({type:I_,selectors:[["app-view-whiteboard"]],viewQuery:function(e,o){if(1&e&&(t.GBs(Ij,7),t.GBs(Aj,7)),2&e){let i;t.mGM(i=t.lsd())&&(o.drawCanvas=i.first),t.mGM(i=t.lsd())&&(o.annotateElement=i.first)}},decls:17,vars:20,consts:()=>{let n,e,o,i;return n=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,e=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,o=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,i=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,[["annotateWrapper",""],["drawCanvas",""],i,[1,"view-whiteboard"],["dir","ltr"],["class","view-whiteboard__label",3,"view-whiteboard__label--clickthrough","exporting","id","initialPos","color","size","labelActive","labelEmpty",4,"ngFor","ngForOf"],["data-test","drawCanvas",1,"view-whiteboard__canvas"],["data-test","viewWhiteboardTools",1,"view-whiteboard__tools",3,"clearClick","downloadClick","exitClick"],[1,"view-whiteboard__actions"],["app-view-button","","buttonSize","small","data-test","viewWhiteboardDownload","aria-label",n,"matTooltip",e,"matTooltipPosition","right",3,"click"],["size","lg","icon","down-to-bracket"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",o,3,"click",4,"ngIf"],[1,"view-whiteboard__label",3,"labelActive","labelEmpty","exporting","id","initialPos","color","size"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",o,3,"click"],[1,"px-3","uppercase","text-xs"]]},template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"div",3,0),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.j41(5,"div",4),t.DNE(6,Pj,2,9,"app-view-whiteboard-label",5),t.k0s(),t.nrm(7,"canvas",6,1),t.j41(9,"app-view-whiteboard-tools",7),t.bIt("clearClick",function(){return t.eBV(i),t.Njj(o.handleResetClick())})("downloadClick",function(){return t.eBV(i),t.Njj(o.handleDownloadClick())})("exitClick",function(){return t.eBV(i),t.Njj(o.handleExitClick())}),t.k0s(),t.j41(10,"div",8)(11,"app-pillbox")(12,"button",9),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleDownloadClick())}),t.nrm(13,"app-icon",10),t.k0s()(),t.j41(14,"app-pillbox"),t.DNE(15,Nj,3,0,"button",11),t.nI1(16,"async"),t.k0s()()()}2&e&&(t.AVh("view-whiteboard--exporting",o.exporting)("view-whiteboard--drawing",o.drawing)("view-whiteboard--cursor-paint",t.bMT(2,12,o.annotateMode$)===o.whiteboardAnnotateMode.Paint)("view-whiteboard--cursor-erase",t.bMT(3,14,o.annotateMode$)===o.whiteboardAnnotateMode.Erase)("view-whiteboard--cursor-text",t.bMT(4,16,o.annotateMode$)===o.whiteboardAnnotateMode.Text),t.R7$(6),t.Y8G("ngForOf",o.labels),t.R7$(9),t.Y8G("ngIf",!1===t.bMT(16,18,o.isLocked$)))},dependencies:[xt,b.Sq,b.bT,qe,zs.ig,Sn.oV,Uo,Sj,jo,b.Jj],styles:["@keyframes shadow{0%{box-shadow:inset 0 0 #3e4043b3}to{box-shadow:inset 0 0 10px 4px #3e4043b3}}.view-whiteboard{touch-action:none;animation:shadow .5s ease-out forwards;position:fixed;inset:0;z-index:20;display:flex;flex-direction:column;align-items:center;justify-content:space-between;transition:all .3s linear}.view-whiteboard--exporting{box-shadow:none}.view-whiteboard--exporting .view-whiteboard__tools,.view-whiteboard--exporting .view-whiteboard__actions,.view-whiteboard--drawing .view-whiteboard__tools,.view-whiteboard--drawing .view-whiteboard__actions{display:none}.view-whiteboard--cursor-paint:hover{cursor:url(/assets/images/cursor-whiteboard-paint.svg) 7 20,pointer}.view-whiteboard--cursor-erase:hover{cursor:url(/assets/images/cursor-whiteboard-erase.svg) 7 20,pointer}.view-whiteboard--cursor-text:hover{cursor:url(/assets/images/cursor-whiteboard-text.svg) 7 20,pointer}.view-whiteboard__canvas{box-shadow:inset 0 0 10px #3e404366;position:absolute;inset:0;z-index:1}.view-whiteboard__label{position:absolute;top:0;left:0;z-index:10}.view-whiteboard__label--clickthrough{pointer-events:none}.view-whiteboard__tools{position:absolute;inset-inline-start:12px;top:12px;bottom:12px;z-index:20;display:flex;align-items:center}.view-whiteboard__actions{display:flex;gap:8px;position:absolute;inset-inline-end:12px;top:12px;z-index:20}\n"],encapsulation:2,changeDetection:0}),ra([(0,c.l6)(P.isWhiteboardLocked),aa("design:type",f.c)],gs.prototype,"isLocked$",void 0),ra([(0,c.l6)(P.getWhiteboardAnnotateMode),aa("design:type",f.c)],gs.prototype,"annotateMode$",void 0),ra([(0,c.l6)(P.getWhiteboardBrushSize),aa("design:type",f.c)],gs.prototype,"brushSize$",void 0),ra([(0,c.l6)(P.getWhiteboardBrushColor),aa("design:type",f.c)],gs.prototype,"brushColor$",void 0),ra([(0,c.l6)(P.getWhiteboardTextSize),aa("design:type",f.c)],gs.prototype,"textSize$",void 0),ra([(0,c.l6)(P.getWhiteboardEraserSize),aa("design:type",f.c)],gs.prototype,"eraserSize$",void 0),ra([(0,c.l6)(E.getSelectedChapterBackground),aa("design:type",f.c)],gs.prototype,"background$",void 0);const kj=["zones"],Dj=[[["","top",""]],[["","left",""]],[["","right",""]],[["","bottom",""]]],Lj=["[top]","[left]","[right]","[bottom]"];let Uj=(()=>{var n;class e{constructor(){this.showZones=[]}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-zones"]],viewQuery:function(i,s){if(1&i&&t.GBs(kj,5),2&i){let r;t.mGM(r=t.lsd())&&(s.zones=r.first)}},inputs:{showZones:"showZones"},ngContentSelectors:Lj,decls:10,vars:4,consts:[["zones",""],[1,"view-zones"],[1,"view-zones__zone","view-zones__zone--top"],[1,"view-zones__zone","view-zones__zone--left"],[1,"view-zones__zone","view-zones__zone--right"],[1,"view-zones__zone","view-zones__zone--bottom"]],template:function(i,s){1&i&&(t.NAR(Dj),t.j41(0,"div",1,0)(2,"div",2),t.SdG(3),t.k0s(),t.j41(4,"div",3),t.SdG(5,1),t.k0s(),t.j41(6,"div",4),t.SdG(7,2),t.k0s(),t.j41(8,"div",5),t.SdG(9,3),t.k0s()()),2&i&&(t.R7$(2),t.Y8G("@isShown",s.showZones.includes("top")?"shown":"hidden"),t.R7$(2),t.Y8G("@isShown",s.showZones.includes("left")?"shown":"hidden"),t.R7$(2),t.Y8G("@isShown",s.showZones.includes("right")?"shown":"hidden"),t.R7$(2),t.Y8G("@isShown",s.showZones.includes("bottom")?"shown":"hidden"))},styles:['[_nghost-%COMP%]{width:100%;height:100%}.view-zones[_ngcontent-%COMP%]{width:100%;height:100%;display:grid;grid-template-areas:"top top top" "left . right" "bottom bottom bottom";grid-template-columns:minmax(40px,auto) 1fr minmax(40px,auto);grid-template-rows:auto 1fr auto;padding:12px;pointer-events:none;position:absolute;z-index:20}.view-zones__zone[_ngcontent-%COMP%]{opacity:0;display:flex;gap:8px}.view-zones__zone--left[_ngcontent-%COMP%]{grid-area:left;flex-direction:column}.view-zones__zone--right[_ngcontent-%COMP%]{grid-area:right;flex-direction:column}.view-zones__zone--top[_ngcontent-%COMP%]{grid-area:top;flex-direction:row;opacity:1}.view-zones__zone--top[_ngcontent-%COMP%]:not(:empty){margin-bottom:8px}.view-zones__zone--bottom[_ngcontent-%COMP%]{grid-area:bottom;flex-direction:row;justify-content:flex-end}.view-zones__zone--bottom[_ngcontent-%COMP%]:not(:empty){margin-top:8px}'],data:{animation:[(0,ie.hZ)("isShown",[(0,ie.wk)("shown",(0,ie.iF)({opacity:1})),(0,ie.wk)("hidden",(0,ie.iF)({opacity:0})),(0,ie.kY)("hidden => shown",[(0,ie.i0)("300ms ease-out")]),(0,ie.kY)("shown => hidden",[(0,ie.i0)("150ms ease-in")])])]},changeDetection:0}),e})();var A_,Be=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},ze=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const Vj=["engineContainer"],jj=["viewContainer"],xj=["view"],Gj=["viewCameraBar"],$j=["viewLogo"],Fj=["viewSceneBase"],Bj=["viewToolbar"],zj=(n,e,o,i,s,r,a)=>({"view-page--layout-column":n,"view-page--layout-drawer":e,"view-page--column-open":o,"view-page--column-closed":i,"view-page--drawer-open":s,"view-page--drawer-closed":r,"view-page--drawer-peek":a}),Wj=n=>({"view-page__drawer-nav--overflow":n}),yT=n=>({"w-full":n}),Xj=n=>({grow:n}),Hj=n=>({collapsed:n}),Qj=n=>({"pt-2":n}),Yj=(n,e,o)=>({"view-page__logo--mobile":n,"view-page__logo--web":e,"view-page__logo--raised":o});function qj(n,e){1&n&&t.nrm(0,"app-view-column-container",36)}function Kj(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-view-column",37),t.qex(1,38),t.j41(2,"div",39)(3,"div",40),t.pXf(4,4),t.k0s(),t.j41(5,"button",41),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleSearch(!1))}),t.nrm(6,"app-icon",42),t.j41(7,"span",43),t.pXf(8,5),t.k0s()()(),t.bVm(),t.qex(9,44),t.j41(10,"div",45),t.nrm(11,"app-view-search"),t.k0s(),t.bVm(),t.k0s()}2&n&&t.Y8G("floating",!0)("animated",!0)("padded",!1)}function Jj(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-view-column",46),t.qex(1,38),t.j41(2,"div",39)(3,"div",40),t.pXf(4,6),t.k0s(),t.j41(5,"button",47),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleToggleLayers())}),t.nrm(6,"app-icon",42),t.j41(7,"span",43),t.pXf(8,7),t.k0s()()(),t.bVm(),t.qex(9,44),t.j41(10,"div",48),t.nrm(11,"app-view-visibility-layers"),t.k0s(),t.bVm(),t.k0s()}2&n&&t.Y8G("floating",!0)("animated",!0)("padded",!1)}function Zj(n,e){if(1&n&&(t.nrm(0,"app-view-toolbar",49),t.nI1(1,"async")),2&n){const o=t.XpG();t.Y8G("openBar",t.bMT(1,1,o.startingTool$))}}function ex(n,e){if(1&n&&(t.nrm(0,"app-view-undo",50),t.nI1(1,"async")),2&n){const o=t.XpG();t.Y8G("layout",t.bMT(1,1,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny?"full":"resetOnly")}}function tx(n,e){1&n&&t.nrm(0,"app-view-title-only")}function nx(n,e){1&n&&t.nrm(0,"app-view-audio-mute")}function ix(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-pillbox",57),t.DNE(1,nx,1,0,"app-view-audio-mute",23),t.nI1(2,"async"),t.j41(3,"button",58),t.nI1(4,"async"),t.nI1(5,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(4);return t.Njj(s.handleChapterInfoToggle())}),t.nrm(6,"app-icon",59),t.k0s()()}if(2&n){let o;const i=t.XpG(4);t.R7$(),t.Y8G("ngIf",t.bMT(2,3,i.audioVisible$)),t.R7$(2),t.Y8G("buttonTheme","show"===(null==(o=t.bMT(4,5,i.drawerUI$))?null:o.status)&&t.bMT(5,7,i.contentMode$)===i.viewContentMode.ChapterInfo?"blue-fill":"transparent-fill"),t.R7$(3),t.Y8G("custom",!0)}}function ox(n,e){if(1&n&&(t.j41(0,"div",55),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.j41(4,"div"),t.DNE(5,tx,1,0,"app-view-title-only",23),t.nI1(6,"async"),t.k0s(),t.DNE(7,ix,7,9,"app-pillbox",56),t.nI1(8,"async"),t.nI1(9,"async"),t.k0s()),2&n){const o=t.XpG(3);t.Y8G("ngClass",t.eq3(15,Wj,t.bMT(1,3,o.titleOnlyVisible$)&&(t.bMT(2,5,o.drawerToggleVisible$)||t.bMT(3,7,o.audioVisible$)))),t.R7$(5),t.Y8G("ngIf",t.bMT(6,9,o.titleOnlyVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(8,11,o.drawerToggleVisible$)||t.bMT(9,13,o.audioVisible$))}}function sx(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-pillbox")(1,"button",60),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.handleQuizClick())}),t.nrm(2,"app-icon",61),t.k0s()()}}function rx(n,e){if(1&n&&(t.j41(0,"div",53),t.DNE(1,ox,10,17,"div",54),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.DNE(5,sx,3,0,"app-pillbox",23),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.nI1(9,"async"),t.nI1(10,"async"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.titleOnlyVisible$)||t.bMT(3,4,o.drawerToggleVisible$)||t.bMT(4,6,o.audioVisible$)),t.R7$(4),t.Y8G("ngIf",t.bMT(6,8,o.hasQuiz$)&&t.bMT(7,10,o.quizEnabled$)&&!1===t.bMT(8,12,o.quizModeLocked$)&&t.bMT(9,14,o.quizPromptVisible$)&&!1===t.bMT(10,16,o.quizModeActive$))}}function ax(n,e){if(1&n&&(t.qex(0,51),t.DNE(1,rx,11,18,"div",52),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,1,o.titleOnlyVisible$)||t.bMT(3,3,o.drawerToggleVisible$)||t.bMT(4,5,o.quizModeActive$)&&!1===t.bMT(5,7,o.quizModeLocked$))}}function lx(n,e){1&n&&t.nrm(0,"app-view-column-toggle")}function cx(n,e){1&n&&(t.qex(0),t.nrm(1,"app-view-title-only"),t.bVm())}function _x(n,e){1&n&&t.nrm(0,"app-view-audio-mute")}function dx(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",66),t.bIt("click",function(){t.eBV(o);const s=t.XpG(4);return t.Njj(s.handleQuizClick())}),t.nrm(1,"app-icon",67),t.j41(2,"span",68),t.pXf(3,8),t.k0s()()}}function px(n,e){if(1&n&&(t.j41(0,"app-pillbox"),t.DNE(1,_x,1,0,"app-view-audio-mute",23),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,dx,4,0,"button",65),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.nI1(9,"async"),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.audioVisible$)&&!1===t.bMT(3,4,o.columnVisible$)),t.R7$(3),t.Y8G("ngIf",t.bMT(5,6,o.hasQuiz$)&&t.bMT(6,8,o.quizEnabled$)&&!1===t.bMT(7,10,o.quizModeLocked$)&&t.bMT(8,12,o.quizPromptVisible$)&&!1===t.bMT(9,14,o.quizModeActive$))}}function ux(n,e){if(1&n&&(t.j41(0,"div",63)(1,"div",64),t.DNE(2,lx,1,0,"app-view-column-toggle",23),t.nI1(3,"async"),t.DNE(4,cx,2,0,"ng-container",23),t.nI1(5,"async"),t.DNE(6,px,10,16,"app-pillbox",23),t.nI1(7,"async"),t.nI1(8,"async"),t.nI1(9,"async"),t.nI1(10,"async"),t.nI1(11,"async"),t.nI1(12,"async"),t.nI1(13,"async"),t.k0s()()),2&n){const o=t.XpG(2);t.R7$(2),t.Y8G("ngIf",t.bMT(3,3,o.columnToggleVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(5,5,o.titleOnlyVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(7,7,o.hasQuiz$)&&t.bMT(8,9,o.quizEnabled$)&&!1===t.bMT(9,11,o.quizModeLocked$)&&t.bMT(10,13,o.quizPromptVisible$)&&!1===t.bMT(11,15,o.quizModeActive$)||t.bMT(12,17,o.audioVisible$)&&!1===t.bMT(13,19,o.columnVisible$))}}function gx(n,e){if(1&n&&(t.qex(0,51),t.DNE(1,ux,14,21,"div",62),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,1,o.columnToggleVisible$)||t.bMT(3,3,o.titleOnlyVisible$)||t.bMT(4,5,o.quizModeActive$))}}function hx(n,e){1&n&&t.eu8(0,51)}function mx(n,e){1&n&&t.nrm(0,"app-engine-camera-bar")}function fx(n,e){1&n&&(t.j41(0,"app-pillbox",69),t.nrm(1,"app-view-fullscreen",70),t.k0s())}function Sx(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",82),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(4);return t.Njj(s.handleToggleMedia(!1))}),t.nrm(2,"app-icon",83),t.k0s()}if(2&n){let o;const i=t.XpG(4);t.Y8G("matTooltip",i.mediaBarTooltip)("thin",!0),t.BMQ("aria-label",i.mediaBarTooltip)("aria-expanded","show"===(null==(o=t.bMT(1,4,i.mediaUI$))?null:o.status))}}function bx(n,e){if(1&n&&(t.j41(0,"div",77),t.nI1(1,"async"),t.nI1(2,"async"),t.j41(3,"app-pillbox",78),t.nI1(4,"async"),t.nI1(5,"async"),t.DNE(6,Sx,3,6,"button",79),t.nI1(7,"async"),t.nrm(8,"app-pillbox-divider",80)(9,"app-view-media-bar",81),t.nI1(10,"async"),t.nI1(11,"async"),t.k0s()()),2&n){let o,i,s;const r=t.XpG(3);t.Y8G("ngClass",t.eq3(20,yT,t.bMT(1,6,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall&&"full"===(null==(o=t.bMT(2,8,r.mediaUI$))?null:o.template))),t.R7$(3),t.Y8G("ngClass",t.eq3(22,Xj,t.bMT(4,10,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall&&"full"===(null==(i=t.bMT(5,12,r.mediaUI$))?null:i.template))),t.R7$(3),t.Y8G("ngIf",t.eq3(24,Hj,"show"===(null==(s=t.bMT(7,14,r.mediaUI$))?null:s.status))),t.R7$(3),t.Y8G("autoFocus","keyboard"===r.focusOrigin)("showSpeed",t.bMT(10,16,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall)("showScrubber",t.bMT(11,18,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall)}}function yx(n,e){if(1&n){const o=t.RV6();t.qex(0),t.j41(1,"button",82),t.nI1(2,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(4);return t.Njj(s.handleToggleMedia(!0))}),t.nrm(3,"app-icon",84),t.k0s(),t.nrm(4,"app-pillbox-divider",80),t.bVm()}if(2&n){let o;const i=t.XpG(4);t.R7$(),t.Y8G("matTooltip",i.mediaBarTooltip)("thin",!0),t.BMQ("aria-label",i.mediaBarTooltip)("aria-expanded","show"===(null==(o=t.bMT(2,4,i.mediaUI$))?null:o.status))}}function vx(n,e){if(1&n&&(t.j41(0,"app-pillbox",80),t.DNE(1,yx,5,6,"ng-container",23),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nrm(5,"app-view-play"),t.k0s()),2&n){let o;const i=t.XpG(3);t.R7$(),t.Y8G("ngIf",!1===t.bMT(2,1,i.isMobileWeb$)&&"collapse"===(null==(o=t.bMT(3,3,i.mediaUI$))?null:o.status)&&"full"===(null==(o=t.bMT(4,5,i.mediaUI$))?null:o.template))}}function Ex(n,e){if(1&n&&(t.j41(0,"div",74),t.DNE(1,bx,12,26,"div",75),t.nI1(2,"async"),t.nI1(3,"async"),t.DNE(4,vx,6,7,"app-pillbox",76),t.nI1(5,"async"),t.k0s()),2&n){let o,i;const s=t.XpG(2);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,s.mediaVisible$)&&"show"===(null==(o=t.bMT(3,4,s.mediaUI$))?null:o.status)),t.R7$(3),t.Y8G("ngIf","show"!==(null==(i=t.bMT(5,6,s.mediaUI$))?null:i.status))}}function Tx(n,e){if(1&n&&(t.nrm(0,"app-view-title-only",88),t.nI1(1,"async")),2&n){const o=t.XpG(3);t.Y8G("showTitle",!1===t.bMT(1,1,o.drawerVisible$))}}function Cx(n,e){if(1&n){const o=t.RV6();t.j41(0,"app-pillbox",57)(1,"button",58),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(3);return t.Njj(s.handleChapterInfoToggle())}),t.nrm(4,"app-icon",59),t.k0s()()}if(2&n){const o=t.XpG(3);t.R7$(),t.Y8G("buttonTheme",t.bMT(2,2,o.drawerVisible$)&&t.bMT(3,4,o.contentMode$)===o.viewContentMode.ChapterInfo?"blue-fill":"transparent-fill"),t.R7$(3),t.Y8G("custom",!0)}}function Ox(n,e){if(1&n&&(t.j41(0,"div",85),t.nI1(1,"async"),t.j41(2,"div",86),t.nI1(3,"async"),t.DNE(4,Tx,2,3,"app-view-title-only",87),t.nI1(5,"async"),t.k0s(),t.DNE(6,Cx,5,6,"app-pillbox",56),t.nI1(7,"async"),t.k0s()),2&n){const o=t.XpG(2);t.Y8G("ngClass",t.eq3(12,Qj,t.bMT(1,4,o.mediaVisible$))),t.R7$(2),t.Y8G("ngClass",t.eq3(14,yT,!1===t.bMT(3,6,o.drawerVisible$))),t.R7$(2),t.Y8G("ngIf",t.bMT(5,8,o.titleOnlyVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(7,10,o.drawerToggleVisible$))}}function wx(n,e){if(1&n&&(t.j41(0,"div",71),t.DNE(1,Ex,6,8,"div",72),t.nI1(2,"async"),t.DNE(3,Ox,8,16,"div",73),t.nI1(4,"async"),t.nI1(5,"async"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,2,o.mediaVisible$)),t.R7$(2),t.Y8G("ngIf",!0===t.bMT(4,4,o.isMobileWeb$)&&"drawer"===t.bMT(5,6,o.viewLayout$))}}function Mx(n,e){if(1&n&&(t.nrm(0,"app-view-logo",89),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async")),2&n){const o=t.XpG();t.Y8G("ngClass",t.sMw(11,Yj,!0===t.bMT(1,3,o.isMobileWeb$),!1===t.bMT(2,5,o.isMobileWeb$),o.isLogoRaised))("logoColor",o.isBackgroundLight?"color":"white")("logoSize",!0===t.bMT(3,7,o.isMobileWeb$)||t.bMT(4,9,o.horizontalBreakpoint$)<=o.horizontalBreakpoint.Small?"small":"full")}}function Ix(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",90)(1,"app-pillbox")(2,"button",60),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleExitQuiz())}),t.j41(3,"span",91),t.pXf(4,9),t.k0s()()()()}}function Ax(n,e){1&n&&(t.j41(0,"div",92),t.nrm(1,"app-view-drawer"),t.k0s())}function Px(n,e){1&n&&t.nrm(0,"div",93)}function Nx(n,e){if(1&n&&t.nrm(0,"app-view-ondemand",94),2&n){const o=t.XpG();t.Y8G("contentId",o.contentId)("contentType",o.contentType)}}function Rx(n,e){if(1&n&&(t.nrm(0,"app-view-progress",95),t.nI1(1,"async")),2&n){const o=t.XpG();t.Y8G("show",t.bMT(1,2,o.viewWindow$)===o.viewWindow.Loader)("percent",o.chapterLoadProgress)}}function kx(n,e){if(1&n&&t.nrm(0,"app-play-loader",97),2&n){const o=t.XpG(2);t.Y8G("percent",o.chapterLoadProgress)}}function Dx(n,e){1&n&&t.nrm(0,"app-button-loader")}function Lx(n,e){1&n&&t.nrm(0,"app-hand-loader")}function Ux(n,e){1&n&&t.nrm(0,"app-summary-loader")}function Vx(n,e){if(1&n&&(t.j41(0,"app-view-loader"),t.DNE(1,kx,1,1,"app-play-loader",96),t.nI1(2,"async"),t.DNE(3,Dx,1,0,"app-button-loader",23),t.nI1(4,"async"),t.DNE(5,Lx,1,0,"app-hand-loader",23),t.nI1(6,"async"),t.DNE(7,Ux,1,0,"app-summary-loader",23),t.nI1(8,"async"),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf","play"===t.bMT(2,4,o.interactType$)),t.R7$(2),t.Y8G("ngIf","button"===t.bMT(4,6,o.interactType$)),t.R7$(2),t.Y8G("ngIf","hand"===t.bMT(6,8,o.interactType$)),t.R7$(2),t.Y8G("ngIf","summary"===t.bMT(8,10,o.interactType$))}}function jx(n,e){1&n&&t.nrm(0,"app-view-tour")}function xx(n,e){1&n&&t.nrm(0,"app-view-whiteboard",98)}function Gx(n,e){1&n&&t.nrm(0,"app-view-print")}function $x(n,e){1&n&&t.nrm(0,"app-view-content-warning")}class Fe{onActive(e){this.showTools$.next(!0)}onInactive(e){const o=this.store.selectSnapshot(P.getFadeout),i=this.viewLayout$.getValue();0!==o&&i!==Bn.Column&&this.showTools$.next(!1)}onClick(e){this.handleFirstClickTracking(e)}constructor(e,o,i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A){this.activatedRoute=e,this.changeDetectorRef=o,this.store=i,this.actions=s,this.liveAnnouncer=r,this.viewService=a,this.viewQuizService=l,this.viewUIService=_,this.engineService=d,this.nodeService=p,this.animationService=u,this.applicationEventService=g,this.vendorAnalyticsService=y,this.mediaService=C,this.title=O,this.platform=L,this.viewPlaythroughService=$,this.focusMonitor=q,this.dialog=x,this.visibilityLayersService=k,this.legacyVisibilityLayersService=A,this.application=bt,this.environment=he,this.nativePlatform=yp,this.toolEnum=Ct,this.showTools$=new He.t(!1),this.mediaExpanded=!1,this.horizontalBreakpoint=Un,this.canvasHeightBreakpoint=Fi,this.viewContentMode=lt,this.viewLayoutStatus=Ve,this.viewMode=Ql,this.viewUI=h,this.viewWindow=en,this.columnLayoutStatus=Ve.Hide,this.drawerExpandable=!0,this.drawerOpen=!1,this.loadLabel="",this.chapterLoadProgress=0,this.chaptersLoaded=0,this.isBackgroundLight=!0,this.selectedChapterLoading=!1,this.viewToolsMode=zE,this.viewLayout$=new He.t(Bn.Column),this.mediaTemplate=Wi.None,this.mediabarExpanded=!1,this.showZones=[],this.focusOrigin="",this.isLogoRaised=!1,this.ngUnsubscribe=new oe.B}ngOnInit(){this.resetScene();const e=this.viewService.normalizeQueryParams(this.activatedRoute.snapshot.queryParams);this.contentId=e.id,this.contentType=e.type,this.contentLang=e.lang}ngAfterViewInit(){this.viewService.setViewLanguage(this.contentLang),this.loadStory(),this.store.dispatch(new rh({tag:!0,pin:!1})),this.store.dispatch(new tg(!0));const e=this.store.selectSnapshot(ue.getUI).loader.template;this.store.dispatch(new Zu(e===ss.Bar)),e!==ss.None&&this.store.dispatch(new D.ToggleWindow(en.Loader,!0)),this.liveAnnouncer.announce("Loading","polite"),this.store.select(ue.getUIEntry(h.Playthrough)).pipe((0,X.p)(i=>i.enable),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new D.SetPlaythroughEnabled(i.enable))}),this.checkCapabilities(),this.initSizeObservers(),this.initHeaderObserver(),this.initViewUIObserver(),this.initUIObserver(),this.initBreakpointObservers(),this.initKeyboardObserver(),this.initLoadProgressObserver(),this.initPlaythroughObserver(),this.initWindowObserver(),this.initMobileNav(),this.initBackgroundColorObserver(),this.initResponsiveLabels(),this.initNodeObserver(),this.initChapterObserver(),this.initChapterAudioPlayer(),this.initToolsFadeout(),this.initAccessibility(),this.initTooltips(),this.initQuizStateListener(),this.initVisibilityLayers(),this.storyId$.pipe((0,X.p)(i=>!(0,m.isNil)(i)&&"preview"!==i),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>this.initVendorAnalyticsEvents()),this.initAnatomyTree()}ngOnDestroy(){this.store.dispatch(new od(!1)),this.store.dispatch(new Hd),this.store.dispatch(new ns),Po.isFullscreen()&&Po.exitFullscreen(),this.viewQuizService.exitQuiz(),this.unbindKeyboard(),this.mediaService.stopAllAudio(),this.mediaService.removeAllAudioPlayers(),this.store.dispatch(new Ei.ResetAudio),this.viewPlaythroughService.clearChapterTimers(),this.destroyVisibilityLayers(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.focusMonitor.stopMonitoring(document.body)}loadStory(){this.onDemand$.pipe((0,X.p)(e=>!e),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.initStory(this.contentId,this.contentType,this.contentLang)})}checkCapabilities(){const e=bs(),o=BS();this.store.dispatch(new D.SetCanHover(e)),this.store.dispatch(new D.SetCanTouch(o)),this.store.dispatch(new D.SetCanFullscreen(Po.canFullscreen())),this.store.dispatch(new D.SetInputMode(o?Dr.Touch:Dr.Mouse)),(0,hn.R)(window,"orientationchange").pipe((0,Pn.B)(100),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new D.SetCanHover(bs())),this.store.dispatch(new D.SetCanTouch(BS()))})}initBreakpointObservers(){(0,Tt.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.resetUI(),this.viewService.resetContentMode()})}initResponsiveLabels(){const e=(0,hn.R)(window,"resize").pipe((0,Pn.B)(100)),o=this.store.select(P.getLabelsBreakpoint),i=this.store.select(ye.getSelectedLabel),s=this.store.select(ye.getLabelsCollapsed);i.pipe((0,X.p)(()=>this.store.selectSnapshot(ye.getLabelsCollapsed)),(0,w.Q)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(null!=r)}),s.pipe((0,X.p)(()=>!!this.store.selectSnapshot(ye.getSelectedLabel)),(0,w.Q)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(r)}),(0,Tt.z)(e,o).pipe((0,X.p)(([,r])=>!(0,m.isNil)(r)),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkLabelsCollapsed()}),this.checkLabelsCollapsed()}initSizeObservers(){const e=f2({strategy:"scroll"});(0,hn.R)(window,"resize").pipe((0,Pn.B)(10),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateViewHeight(),this.refreshLayout()}),new f.c(s=>{e.listenTo(this.engineContainer.nativeElement,()=>{s.next()})}).pipe((0,Pn.B)(10)).subscribe(()=>{this.resizeEngineContainer()})}initHeaderObserver(){this.store.select(Kt.getSiteHeader).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.updateViewHeight()})}initUIObserver(){this.viewUI$.pipe((0,X.p)(e=>!(0,m.isNil)(e)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.refreshLayout()}),this.viewUI$.pipe((0,X.p)(e=>!(0,m.isNil)(e)),(0,ls.Z)(100),(0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(Ce.UIUpdated,e)}),this.viewWindow$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.applicationEventService.fireEvent(Ce.UIWindowUpdated,e)}),(0,Tt.z)([this.isMobileWeb$,this.drawerVisible$,this.paginationVisible$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{this.isLogoRaised=!!e&&(!o||i&&o)})}initViewUIObserver(){(0,Tt.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$,S2(this.engineContainer.nativeElement),this.viewWindow$,this.store.select(E.getSelectedChapterId),this.store.select(ki.getStoryLoadProgress),this.store.select(ue.getUI),this.store.select(ye.getSelectedLabel)]).pipe((0,w.Q)(this.ngUnsubscribe),(0,Pn.B)(30)).subscribe(()=>{this.store.dispatch(new Tn.ToggleVisible({[h.Audio]:this.viewUIService.isVisible(h.Audio),[h.Camera]:this.viewUIService.isVisible(h.Camera),[h.Column]:this.viewUIService.isVisible(h.Column),[h.ColumnToggle]:this.viewUIService.isVisible(h.ColumnToggle),[h.Drawer]:this.viewUIService.isVisible(h.Drawer),[h.DrawerToggle]:this.viewUIService.isVisible(h.DrawerToggle),[h.Description]:this.viewUIService.isVisible(h.Description),[h.Fullscreen]:this.viewUIService.isVisible(h.Fullscreen),[h.Help]:this.viewUIService.isVisible(h.Help),[h.LabelList]:this.viewUIService.isVisible(h.LabelList),[h.Legend]:this.viewUIService.isVisible(h.Legend),[h.Logo]:this.viewUIService.isVisible(h.Logo),[h.Media]:this.viewUIService.isVisible(h.Media),[h.ToolbarOverflow]:this.viewUIService.isVisible(h.ToolbarOverflow),[h.NodeInfo]:this.viewUIService.isVisible(h.NodeInfo),[h.Pagination]:this.viewUIService.isVisible(h.Pagination),[h.Playthrough]:this.viewUIService.isVisible(h.Playthrough),[h.QuizPrompt]:this.viewUIService.isVisible(h.QuizPrompt),[h.Search]:this.viewUIService.isVisible(h.Search),[h.TitleOnly]:this.viewUIService.isVisible(h.TitleOnly),[h.Toolbar]:this.viewUIService.isVisible(h.Toolbar),[h.Tools]:this.viewUIService.isVisible(h.Tools),[h.ToggleLabels]:this.viewUIService.isVisible(h.ToggleLabels),[h.Undo]:this.viewUIService.isVisible(h.Undo),[h.VisibilityLayers]:this.viewUIService.isVisible(h.VisibilityLayers),[h.SkinLayers]:this.viewUIService.isVisible(h.SkinLayers),[h.Whiteboard]:this.viewUIService.isVisible(h.Whiteboard)}))})}initKeyboardObserver(){this.inputEnabled$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{e?this.bindKeyboard():this.unbindKeyboard()})}initNodeObserver(){this.actions.pipe((0,c.xi)(ad),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.viewService.delegateNodeClick(e.node,e.event)}),this.store.select(Re.getSelectedNode).pipe((0,Wr.J)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{const i=(0,m.get)(e,"objectId",void 0),s=(0,m.get)(o,"objectId",void 0);(void 0===o||i!==s)&&this.viewService.toggleNodeInfo(!1)})}initChapterObserver(){this.store.select(E.getSelectedChapterId).pipe((0,X.p)(e=>!!e),(0,F.T)(()=>this.store.selectSnapshot(E.getSelectedChapter)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.store.dispatch(new ns),this.setPageTitle(e),this.refreshLayout(),this.viewService.resetUI(),this.viewService.resetContentMode()}),this.store.select(U.getChapter).pipe((0,X.p)(e=>!!e),(0,F.T)(()=>this.store.selectSnapshot(E.getSelectedChapter)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{if(this.viewService.applyChapterCamera(e),this.viewService.applyChapterScenegraph(e),this.engineService.fireEvent(pe.SceneLoaded,null),this.store.selectSnapshot(P.getPlaythroughEnabled)){const o=this.store.selectSnapshot(P.getForceAudio);this.viewPlaythroughService.startChapterTimers(e,o);const i=this.store.selectSnapshot(E.getNextChapter);this.viewPlaythroughService.preloadAudio([i],o)}})}startPlaythroughMonitoring(){this.stopPlaythroughMonitoring(),this.playthroughMonitor$=(0,Tt.z)([this.viewPlaythroughService.audioSubject,this.viewPlaythroughService.animationSubject,this.viewPlaythroughService.readingSubject,this.viewPlaythroughService.minimumSubject]).pipe((0,ls.Z)(50),(0,F.T)(([e,o,i,s])=>e.complete&&o.complete&&i.complete&&s.complete),(0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{e&&this.viewPlaythroughService.startCountdown()}),this.playthroughCountdown$=this.viewPlaythroughService.countdownComplete.pipe((0,X.p)(()=>this.store.selectSnapshot(P.getPlaythroughEnabled)),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(P.getPlaythroughSettings);this.store.selectSnapshot(E.isLastChapter)?e.loop?this.viewService.firstChapter("Playthrough Loop"):this.openPlaythroughDialog():this.viewService.nextChapter("playthrough")}),this.playthroughInterrupt$=(0,Ao.h)((0,hn.R)(document,"mousemove").pipe((0,ls.Z)(50),(0,X.p)(e=>e.buttons>0)),(0,hn.R)(document,"mousedown"),(0,hn.R)(document,"keydown"),(0,hn.R)(document,"wheel")).pipe((0,X.p)(()=>this.viewPlaythroughService.audioSubject.getValue().complete&&this.viewPlaythroughService.animationSubject.getValue().complete&&this.viewPlaythroughService.readingSubject.getValue().complete&&this.viewPlaythroughService.minimumSubject.getValue().complete),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.viewPlaythroughService.delayCountdown()})}stopPlaythroughMonitoring(){[this.playthroughMonitor$,this.playthroughCountdown$,this.playthroughInterrupt$].forEach(e=>{e instanceof m2.yU&&e.unsubscribe()})}openPlaythroughDialog(){(0,m.isNil)(this.playthroughDialog)&&(this.playthroughDialog=this.dialog.open(Wm,{width:"100%",height:"100%"}),this.playthroughDialog.closed.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{switch(e){case"explore":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewService.firstChapter("Playthrough Modal - Explore");break;case"playAgain":this.viewService.togglePlaythrough(!0,!0),this.viewService.firstChapter("Playthrough Modal - Play Again");break;case"takeQuiz":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewQuizService.startQuiz();break;default:this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1)}this.playthroughDialog=null}))}initChapterAudioPlayer(){this.store.select(E.getSelectedChapterId).pipe((0,X.p)(e=>!!e),(0,qo.M)(()=>{this.mediaService.stopAllAudio()}),(0,Pn.B)(300),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(P.getForceAudio);this.store.selectSnapshot(G.getQuizModeActive)||(e||this.viewUIService.isAudioVisible())&&this.viewService.playChapterAudio(e)})}initLoadProgressObserver(){this.chapterLoadProgress=0,this.store.select(ki.getChaptersLoadProgress).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{const o=this.store.selectSnapshot(Pe.getLoadingChapter),i=this.store.selectSnapshot(E.getSelectedChapterId);if(!(0,m.isNil)(o)&&i===o.chapterId){const r=100*(e[i]??0);this.store.dispatch(new D.ToggleWindow(en.Loader,!0)),this.chapterLoadProgress=r,this.changeDetectorRef.markForCheck()}}),this.store.select(ki.getStoryLoadProgress).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.engineService.fireEvent(pe.HumanProgress,{progress:e})}),this.actions.pipe((0,c.rM)(ma),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterLoadProgress=100,this.changeDetectorRef.markForCheck(),this.store.dispatch(new D.ToggleWindow(en.Loader,!1)),this.liveAnnouncer.announce("Loading complete","polite")})}initPlaythroughObserver(){(0,Tt.z)([this.store.select(P.getPlaythroughEnabled),this.viewWindow$,this.quizModeActive$]).pipe((0,Vn.F)(),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i])=>{e&&null===o&&!0!==i?this.startPlaythrough():this.stopPlaythrough()})}initWindowObserver(){this.viewWindow$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{if(this.viewService.resetUI(),e===en.Tutorial||e===en.Interact)this.viewService.resetChapter(),this.viewService.toggleLabels(!1);else{const o=this.viewUIService.isUIEnabled(h.Labels);this.viewService.toggleLabels(o)}})}initMobileNav(){const e=(this.platform.ANDROID||this.platform.IOS||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(!function b2(){try{return window.self!==window.top}catch{return!0}}()||he.platform===ro.SDK);this.store.dispatch(new D.SetIsMobileWeb(e))}initBackgroundColorObserver(){this.background$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.isBackgroundLight=Qg(e),this.changeDetectorRef.markForCheck()})}initToolsFadeout(){this.showTools$.pipe((0,w.Q)(this.ngUnsubscribe),(0,Vn.F)()).subscribe(i=>{this.showZones=this.store.selectSnapshot(P.getIsMobileWeb)?i?["top","right","bottom","left"]:["bottom"]:i?["top","right","bottom","left"]:["top"],this.changeDetectorRef.markForCheck()});const e=this.store.selectSnapshot(P.getFadeout);0===e&&this.showTools$.next(!0);const o=this.store.selectSnapshot(P.getIsMobileWeb);this.viewLayout$.pipe((0,w.Q)(this.ngUnsubscribe),(0,Vn.F)()).subscribe(i=>{this.showTools$.next(i===Bn.Column||0===e||o)}),this.showTools$.pipe((0,X.p)(i=>!0===i),(0,X.p)(()=>0!==e),(0,Pn.B)(this.store.selectSnapshot(P.getFadeout)),(0,X.p)(()=>this.viewLayout$.getValue()!==Bn.Column),(0,X.p)(()=>!o),(0,X.p)(()=>!this.store.selectSnapshot(P.getFadeoutPaused)),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.showTools$.next(!1)}),this.focusMonitor.monitor(document.body,!0).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.focusOrigin=i,("keyboard"===i||"touch"===i)&&this.showTools$.next(!0)})}initVendorAnalyticsEvents(){const e={totalQuestions:0};this.store.select(G.getQuestionTotal).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{e.totalQuestions=o}),this.store.select(G.getQuizModeActive).pipe((0,X.p)(()=>this.store.selectSnapshot(G.getQuestionTotal)>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{o&&this.vendorAnalyticsService.track("Quiz - Entered",e)}),this.actions.pipe((0,c.xi)(Te.SubmitQuestionAnswer),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(G.getActiveQuestionIndex),i=this.store.selectSnapshot(G.getQuestionsRemaining);0===o&&this.vendorAnalyticsService.track("Quiz - First Question Answered",e),0===i&&this.vendorAnalyticsService.track("Quiz - Completed",e)}),this.store.select(E.getSelectedChapterModelReady).pipe((0,X.p)(o=>o),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(Pe.getStoryId),i=this.store.selectSnapshot(Pe.getStory);this.vendorAnalyticsService.trackOncePerPage("View - Loaded",{id:o,chapters:i.chapters.length,tour:i.tags.includes("tour"),animated:i.tags.includes("animated"),quiz:this.store.selectSnapshot(G.hasQuiz),edit:!1})})}initAccessibility(){this.actions.pipe((0,c.xi)(kn)).subscribe(e=>{this.liveAnnouncer.announce("Object "+(e.show?"shown":"hidden"))})}initTooltips(){this.mediaUI$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.mediaBarTooltip="collapse"===e?.status?$localize`Open Media Bar`:$localize`Close Media Bar`,this.changeDetectorRef.markForCheck()})}initQuizStateListener(){(0,Tt.z)([this.actions.pipe((0,c.rM)(lb)),this.store.select(xe.getSelectedBookmarkViewMode)]).pipe((0,X.p)(([,e])=>!(0,m.isNil)(e)),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,e])=>{const o=this.store.selectSnapshot(G.getQuizSettings);this.store.dispatch(new Te.SetQuizSettings({...o,enabled:e!==ji.Content}))})}initVisibilityLayers(){this.visibilityLayersService.initObservables(),this.legacyVisibilityLayersService.initObservables()}destroyVisibilityLayers(){this.visibilityLayersService.destroyObservables(),this.legacyVisibilityLayersService.destroyObservables()}initAnatomyTree(){this.store.dispatch(new Gg(!1))}handleFirstClickTracking(e){e.composedPath().some(r=>"APP-SITE-HEADER"===r.nodeName)||1===this.store.selectSnapshot(ki.getStoryLoadProgress)&&this.vendorAnalyticsService.trackOncePerPage("First Click")}handleToggleAutoplay(e){this.viewService.toggleAutoplay(e)}handleChapterInfoToggle(){const e=this.store.selectSnapshot(P.getContentMode),o=this.store.selectSnapshot(ue.getVisible(h.Drawer)),i=e===lt.ChapterInfo&&o?Ve.Hide:Ve.Show;this.viewService.clearSelectedLabel(),this.viewService.setContentMode(lt.ChapterInfo),this.viewService.toggleDrawer(i,!0)}handleColumnToggle(){this.viewService.toggleColumn(),this.changeDetectorRef.markForCheck()}handleDrawClick(){this.viewService.toggleWhiteboard(!0)}handleQuizClick(){this.viewQuizService.startQuiz()}handleExitQuiz(){this.viewQuizService.exitQuiz()}handleToggleSearch(e){this.viewService.toggleSearch(ui.Tree,e)}handleToggleLayers(){this.viewService.toggleLayers(!1)}handleSelectTool(e){this.viewService.selectTool(e)}handleToggleMedia(e){this.viewService.toggleMedia(e)}checkLabelsCollapsed(){const e=this.store.selectSnapshot(mn.getHorizontalBreakpoint),o=this.store.selectSnapshot(P.getLabelsBreakpoint),i=this.isLabelBreaking(o);this.store.dispatch(new sh(i,e>=Un.Large?Pr.Toggle:Pr.None))}isLabelBreaking(e){return window.innerWidth<e}bindKeyboard(){ai.bind("1",()=>this.viewService.selectTool(Ct.Select)),ai.bind("2",()=>this.viewService.selectTool(Ct.Hide)),ai.bind("3",()=>this.viewService.selectTool(Ct.Fade)),ai.bind(["command+,","ctrl+,"],e=>{e.preventDefault(),this.store.selectSnapshot(mn.getHorizontalBreakpoint)>Un.Medium?this.viewService.toggleColumn():this.viewService.toggleDrawer(),this.changeDetectorRef.markForCheck()}),ai.bind(["command+enter","ctrl+enter","command+p"],e=>{e.preventDefault(),Po.toggleFullscreen()}),ai.bind("meta+z",e=>{e.preventDefault(),this.viewService.undo()}),ai.bind(["meta+y","meta+shift+z"],e=>{e.preventDefault(),this.viewService.redo()}),ai.bind([".","pagedown"],()=>this.viewService.nextChapter("Keyboard")),ai.bind([",","pageup"],()=>this.viewService.previousChapter("Keyboard")),ai.bind(["del","backspace"],e=>{e.preventDefault(),this.viewService.hideSelectedStructures()}),ai.bind("R",e=>{e.preventDefault(),this.viewService.resetChapter()}),ai.bind("p",e=>{e.preventDefault(),this.viewService.togglePan()}),ai.bind("/",()=>{const e=this.store.selectSnapshot(G.getQuizModeActive),o=this.store.selectSnapshot(ue.getUIEntry(h.Search))?.enable??!1;!e&&o&&this.viewService.toggleSearch()}),ai.bind("?",()=>this.viewService.toggleHelp(Ho.Shortcuts)),ai.bind(["space","k"],e=>{e.preventDefault(),this.viewService.toggleAnimation()}),ai.bind(["j","l"],e=>{switch(e.preventDefault(),e.key){case"j":this.animationService.scrubRelative(-1,!0);break;case"l":this.animationService.scrubRelative(1,!0)}}),ai.bind(["H","I","F"],e=>{e.preventDefault();const o=this.store.selectSnapshot(Re.getCheckedNodeIds);if(o.length>0)switch(e.key){case"H":this.store.dispatch(new kn(!1,o));break;case"I":this.nodeService.hideInverse(o);break;case"F":this.nodeService.fade(o)}})}unbindKeyboard(){ai.reset()}resizeEngineContainer(){const{top:e,left:o,width:i,height:s}=this.engineContainer.nativeElement.getBoundingClientRect(),r=new mg(i,s,o,e,i,s,Pl.Shown,1);this.store.dispatch(new og(r))}updateViewHeight(){const e=this.store.selectSnapshot(Kt.getSiteHeader),s=Gm(e,this.store.selectSnapshot(Kt.getSiteHeaderHeight),gp(e));this.view.nativeElement.style.setProperty("--vh",`${s}px`)}resetScene(){this.store.dispatch(new od(!0)),this.store.dispatch(new fa(!1)),this.store.dispatch(new hr(Ct.Select)),this.store.dispatch(new Hd),this.store.dispatch(new yg(!1)),this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new fa(!0))})}refreshLayout(){const e=this.store.selectSnapshot(ue.getUI),o=this.store.selectSnapshot(P.getLayout);this.viewLayout$.next(this.viewUIService.getViewLayout(o)),this.columnLayoutStatus=e.column.status,this.mediaTemplate=this.viewUIService.getMediaTemplate(),this.updateViewHeight(),this.resizeEngineContainer(),this.store.dispatch(new oh(e.anatomyLabels.enable??!0,e.nodeInfo.enable??!0,!0,e.nodeAudio.enable??!0)),this.store.dispatch(new Sa((e.labels.enable??!0)&&(e.labels.shown??!0))),this.changeDetectorRef.markForCheck()}setPageTitle(e){const o=(0,m.get)(e,"displayName");this.title.setTitle((o?`${o} | `:"")+"BioDigital Human Platform")}deselectLabel(){this.store.dispatch(new is(null))}startPlaythrough(){this.startPlaythroughMonitoring();const e=this.store.selectSnapshot(P.getPlaythroughSettings);this.store.dispatch(new D.SetForceAudio(e.forceAudio));const o=e.forceAudio,i=this.store.selectSnapshot(E.getSelectedChapter),s=this.store.selectSnapshot(P.getViewLanguage);(o||this.mediaService.chapterHasAudio(i,s))&&(this.store.dispatch(new Ei.SetAudioMuted(!1)),this.viewService.playChapterAudio(o),this.store.dispatch(new Tn.ToggleVisible({[h.Audio]:!0}))),this.viewPlaythroughService.startChapterTimers(i,o)}stopPlaythrough(){this.stopPlaythroughMonitoring(),this.viewPlaythroughService.clearChapterTimers(),this.mediaService.stopAllAudio(),this.mediaService.muteAudio(),this.store.dispatch(new Ei.SetAudioMuted(!0))}}(A_=Fe).\u0275fac=function(e){return new(e||A_)(t.rXU(ut.nX),t.rXU(t.gRc),t.rXU(c.il),t.rXU(c.En),t.rXU(vi.Ai),t.rXU(zt),t.rXU(Za),t.rXU(hp),t.rXU(Lt),t.rXU(Ym),t.rXU(bi),t.rXU(mo),t.rXU(Qn),t.rXU(Di),t.rXU(z.hE),t.rXU(Z_.OD),t.rXU(XE),t.rXU(vi.FN),t.rXU(HE.lG),t.rXU(_s),t.rXU(cs))},A_.\u0275cmp=t.VBU({type:A_,selectors:[["app-view-page"]],viewQuery:function(e,o){if(1&e&&(t.GBs(Vj,7),t.GBs(jj,7),t.GBs(xj,7),t.GBs(Gj,5),t.GBs($j,5),t.GBs(Fj,7),t.GBs(Bj,5)),2&e){let i;t.mGM(i=t.lsd())&&(o.engineContainer=i.first),t.mGM(i=t.lsd())&&(o.viewContainer=i.first),t.mGM(i=t.lsd())&&(o.view=i.first),t.mGM(i=t.lsd())&&(o.viewCameraBar=i.first),t.mGM(i=t.lsd())&&(o.viewLogo=i.first),t.mGM(i=t.lsd())&&(o.viewSceneBase=i.first),t.mGM(i=t.lsd())&&(o.viewToolbar=i.first)}},hostBindings:function(e,o){1&e&&t.bIt("mousemove",function(s){return o.onActive(s)},!1,t.EBC)("mouseenter",function(s){return o.onActive(s)},!1,t.EBC)("touchstart",function(s){return o.onActive(s)},!1,t.EBC)("mouseleave",function(s){return o.onInactive(s)},!1,t.EBC)("click",function(s){return o.onClick(s)},!1,t.EBC)},decls:72,vars:104,consts:()=>{let n,e,o,i,s,r,a,l;return n=$localize`:774e30c83aba684afbcbdfc30ab51e5ccdbb08ef5018030683477673235:Close Anatomy`,e=$localize`:ff3ca629882ef2834821af36216a182d484a8cce6002558759122494452:Anatomy Explorer`,o=$localize`:8d649ab3a81d2e70497b706acb98ee078c9625cf6438735765171590350:Close anatomy column`,i=$localize`:a454f7b742cd860d2caaa74cf24b8de5106540d14490189331302251477:Close Layers`,s=$localize`:c2317b4bdf2cb99d1f55afbb550ee164e909b90d4991259427179720015:Layers`,r=$localize`:c02273112dd8379f0d352a3b817f7c69bc525b3c7920034665687725450:Close layers`,a=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,l=$localize`:76fbeb67fc76fbebecb31395a76d10d6f65188f44157627069774048070:Exit Quiz`,[["viewContainer",""],["view",""],["engineContainer",""],["viewSceneBase",""],e,o,s,r,a,l,["role","main","id","viewContainer"],[1,"view-page",3,"ngClass"],["class","view-page__column",4,"ngIf"],["data-test","viewSearch",3,"floating","animated","padded",4,"ngIf"],["data-test","viewVisibilityLayers",3,"floating","animated","padded",4,"ngIf"],["id","engine-container","data-test","viewEngineContainer",1,"view-page__engine"],[3,"showZones"],["left",""],[3,"openBar",4,"ngIf"],[3,"layout",4,"ngIf"],["top","",4,"ngIf"],["right",""],[1,"flex","flex-col","justify-end","h-full"],[4,"ngIf"],["orientation","vertical","class","mt-2","data-test","viewFullscreen",4,"ngIf"],["bottom",""],["class","w-full",4,"ngIf"],["class","view-page__logo",3,"ngClass","logoColor","logoSize",4,"ngIf"],["class","view-page__exit-quiz",4,"ngIf"],[1,"view-page__scene-base"],["class","view-page__drawer",4,"ngIf"],["class","view-block-input",4,"ngIf"],[3,"contentId","contentType",4,"ngIf"],[3,"show","percent",4,"ngIf"],["data-test","viewWhiteboard",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],[1,"view-page__column"],["data-test","viewSearch",3,"floating","animated","padded"],["header",""],[1,"flex","justify-between"],[1,"p-6","text-base","font-semibold"],["app-view-button","","matTooltip",n,"matTooltipPosition","right","data-test","viewSearchClose",3,"click"],["icon","times"],[1,"sr-only"],["body",""],[1,"h-full","px-5"],["data-test","viewVisibilityLayers",3,"floating","animated","padded"],["app-view-button","","matTooltip",i,"matTooltipPosition","right","data-test","viewVisibilityLayersClose",3,"click"],[1,"h-full","px-3","py-4"],[3,"openBar"],[3,"layout"],["top",""],["class","w-full view-page__title-nav",4,"ngIf"],[1,"w-full","view-page__title-nav"],["class","view-page__drawer-nav",3,"ngClass",4,"ngIf"],[1,"view-page__drawer-nav",3,"ngClass"],["appPreventFadeout","",4,"ngIf"],["appPreventFadeout",""],["app-view-button","","buttonSize","small","data-test","viewDrawerToggle",3,"click","buttonTheme"],["size","lg","icon","info",3,"custom"],["app-view-button","","buttonSize","small",3,"click"],["size","lg","icon","user-graduate"],["class","flex justify-between w-full",4,"ngIf"],[1,"flex","justify-between","w-full"],[1,"flex","gap-2"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click"],["icon","user-graduate",1,"pl-3"],[1,"px-3","text-xs","font-semibold","uppercase"],["orientation","vertical","data-test","viewFullscreen",1,"mt-2"],["buttonSize","small"],[1,"w-full"],["class","flex justify-end gap-2",4,"ngIf"],["class","view-page__mobile-nav",3,"ngClass",4,"ngIf"],[1,"flex","justify-end","gap-2"],[3,"ngClass",4,"ngIf"],["orientation","horizontal",4,"ngIf"],[3,"ngClass"],["orientation","horizontal","appPreventFadeout","",3,"ngClass"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"matTooltip","thin","click",4,"ngIf"],["orientation","horizontal"],["mediaTemplate","full",1,"w-full",3,"autoFocus","showSpeed","showScrubber"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"click","matTooltip","thin"],["icon","angle-right","appLogicalDir",""],["icon","angle-left","appLogicalDir",""],[1,"view-page__mobile-nav",3,"ngClass"],[2,"min-width","0",3,"ngClass"],[3,"showTitle",4,"ngIf"],[3,"showTitle"],[1,"view-page__logo",3,"ngClass","logoColor","logoSize"],[1,"view-page__exit-quiz"],[1,"px-3","text-xs","uppercase"],[1,"view-page__drawer"],[1,"view-block-input"],[3,"contentId","contentType"],[3,"show","percent"],[3,"percent",4,"ngIf"],[3,"percent"],["data-test","viewWhiteboard"]]},template:function(e,o){if(1&e&&(t.j41(0,"div",10,0)(2,"div",11,1),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.nI1(9,"async"),t.nI1(10,"async"),t.nI1(11,"async"),t.nI1(12,"async"),t.DNE(13,qj,1,0,"app-view-column-container",12),t.nI1(14,"async"),t.DNE(15,Kj,12,3,"app-view-column",13),t.nI1(16,"async"),t.DNE(17,Jj,12,3,"app-view-column",14),t.nI1(18,"async"),t.nI1(19,"async"),t.j41(20,"div",15,2),t.nrm(22,"app-engine"),t.j41(23,"app-view-zones",16),t.qex(24,17),t.DNE(25,Zj,2,3,"app-view-toolbar",18),t.nI1(26,"async"),t.DNE(27,ex,2,3,"app-view-undo",19),t.nI1(28,"async"),t.bVm(),t.DNE(29,ax,6,9,"ng-container",20),t.nI1(30,"async"),t.nI1(31,"async"),t.DNE(32,gx,5,7,"ng-container",20),t.nI1(33,"async"),t.DNE(34,hx,1,0,"ng-container",20),t.nI1(35,"async"),t.nI1(36,"async"),t.qex(37,21),t.j41(38,"div",22),t.DNE(39,mx,1,0,"app-engine-camera-bar",23),t.nI1(40,"async"),t.DNE(41,fx,2,0,"app-pillbox",24),t.nI1(42,"async"),t.k0s(),t.bVm(),t.qex(43,25),t.DNE(44,wx,6,8,"div",26),t.nI1(45,"async"),t.nI1(46,"async"),t.bVm(),t.k0s(),t.DNE(47,Mx,5,15,"app-view-logo",27),t.nI1(48,"async"),t.DNE(49,Ix,5,0,"div",28),t.nI1(50,"async"),t.nI1(51,"async"),t.nrm(52,"div",29,3),t.k0s(),t.DNE(54,Ax,2,0,"div",30),t.nI1(55,"async"),t.k0s()(),t.DNE(56,Px,1,0,"div",31),t.nI1(57,"async"),t.DNE(58,Nx,1,2,"app-view-ondemand",32),t.nI1(59,"async"),t.DNE(60,Rx,2,4,"app-view-progress",33),t.nI1(61,"async"),t.DNE(62,Vx,9,12,"app-view-loader",23),t.nI1(63,"async"),t.DNE(64,jx,1,0,"app-view-tour",23),t.nI1(65,"async"),t.DNE(66,xx,1,0,"app-view-whiteboard",34),t.nI1(67,"async"),t.DNE(68,Gx,1,0,"app-view-print",23),t.nI1(69,"async"),t.DNE(70,$x,1,0,"app-view-content-warning",35),t.nrm(71,"app-view-iphone12-warning")),2&e){let i,s,r,a;t.R7$(2),t.Y8G("ngClass",t.sGs(96,zj,"column"===t.bMT(4,26,o.viewLayout$),"drawer"===t.bMT(5,28,o.viewLayout$),t.bMT(6,30,o.columnVisible$),!1===t.bMT(7,32,o.columnVisible$),t.bMT(8,34,o.drawerVisible$)&&"show"===(null==(i=t.bMT(9,36,o.drawerUI$))?null:i.status),!1===t.bMT(10,38,o.drawerVisible$),t.bMT(11,40,o.drawerVisible$)&&"collapse"===(null==(i=t.bMT(12,42,o.drawerUI$))?null:i.status))),t.R7$(11),t.Y8G("ngIf",t.bMT(14,44,o.columnVisible$)),t.R7$(2),t.Y8G("ngIf","show"===(null==(s=t.bMT(16,46,o.searchUI$))?null:s.status)),t.R7$(2),t.Y8G("ngIf","show"===(null==(r=t.bMT(18,48,o.visibilityLayersUI$))?null:r.status)&&"group"===(null==(r=t.bMT(19,50,o.visibilityLayersUI$))?null:r.layersMode)),t.R7$(6),t.Y8G("showZones",o.showZones),t.R7$(2),t.Y8G("ngIf",t.bMT(26,52,o.toolbarVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(28,54,o.undoVisible$)),t.R7$(2),t.Y8G("ngIf","drawer"===t.bMT(30,56,o.viewLayout$)&&!1===t.bMT(31,58,o.isMobileWeb$)),t.R7$(3),t.Y8G("ngIf","column"===t.bMT(33,60,o.viewLayout$)),t.R7$(2),t.Y8G("ngIf","drawer"===t.bMT(35,62,o.viewLayout$)&&!0===t.bMT(36,64,o.isMobileWeb$)),t.R7$(5),t.Y8G("ngIf",t.bMT(40,66,o.cameraVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(42,68,o.fullscreenVisible$)),t.R7$(3),t.Y8G("ngIf",!0===t.bMT(45,70,o.isMobileWeb$)||t.bMT(46,72,o.mediaVisible$)),t.R7$(3),t.Y8G("ngIf",t.bMT(48,74,o.logoVisible$)),t.R7$(2),t.Y8G("ngIf",t.bMT(50,76,o.quizModeActive$)&&!t.bMT(51,78,o.quizModeLocked$)),t.R7$(5),t.Y8G("ngIf",t.bMT(55,80,o.drawerVisible$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(57,82,o.inputEnabled$)),t.R7$(2),t.Y8G("ngIf",t.bMT(59,84,o.viewWindow$)===o.viewWindow.OnDemand),t.R7$(2),t.Y8G("ngIf","circle"===(null==(a=t.bMT(61,86,o.viewUI$))?null:a.loader.template)),t.R7$(2),t.Y8G("ngIf",t.bMT(63,88,o.viewWindow$)===o.viewWindow.Interact),t.R7$(2),t.Y8G("ngIf",t.bMT(65,90,o.viewWindow$)===o.viewWindow.Tutorial),t.R7$(2),t.Y8G("ngIf",t.bMT(67,92,o.viewWindow$)===o.viewWindow.Whiteboard),t.R7$(2),t.Y8G("ngIf",t.bMT(69,94,o.usePrintImage$)),t.R7$(2),t.Y8G("appFlagApplication",o.application.All)("appFlagApplicationMode","include")("appFlagApplicationNative",o.nativePlatform.All)}},dependencies:[xt,b.YU,b.bT,Ep,Qr,Hi,an,kp,qe,Sn.oV,Uo,Rp,Ys,Vp,Up,gf,V1,j1,x1,qi,a_,Tf,xn,M8,P8,k8,p_,If,Af,a4,f_,Vo,Gt,Jp,Zp,gs,Uj,iT,Xp,b.Jj],styles:['.view-page{--drawer-height: 0;--column-width: 320px;border:none;width:100vw;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:hidden;display:grid;transition:all .25s}.view-page--layout-column{grid-template-rows:100%;grid-template-columns:var(--column-width) 1fr;grid-template-areas:"column engine"}.view-page--layout-drawer{grid-template-rows:1fr var(--drawer-height);grid-template-columns:1fr;grid-template-areas:"engine" "drawer"}.view-page--column-open{--column-width: 320px}.view-page--column-closed{--column-width: 0}.view-page--drawer-peek{--drawer-height: 40px}.view-page--drawer-open{--drawer-height: 40%}.view-page--drawer-closed.view-page--has-drawer{--drawer-height: 0}.view-page__column{background-color:#fff;grid-area:column;height:100%}.view-page__engine{grid-area:engine;width:100%;height:100%;position:relative}.view-page__drawer{max-width:100vw;border-top:1px solid #d7e0ea;background-color:#fff;grid-area:drawer}.view-page--drawer-push{padding-bottom:var(--drawer-height)}.view-page__title-nav{display:flex;justify-content:flex-start;gap:8px}.view-page__drawer-nav{display:grid;grid-template-columns:minmax(0,1fr) auto;width:auto}.view-page__drawer-nav--overflow{gap:8px}.view-page__mobile-nav{display:flex;justify-content:space-between;gap:8px;width:auto}.view-page__logo{display:inline-block;position:absolute;inset-inline-start:12px;inset-block-end:12px;z-index:10}.view-page__logo--raised{inset-block-end:62px}.view-page__exit-quiz{position:absolute;inset-block-start:12px;inset-inline-end:12px;z-index:10}.view-page__scene-base{position:absolute;left:0;bottom:0;right:0;z-index:10;transition:transform .3s}.view-block-input{position:fixed;inset:0;z-index:10000}\n'],encapsulation:2,changeDetection:0}),Be([(0,c.l6)(Pe.getStory),ze("design:type",f.c)],Fe.prototype,"story$",void 0),Be([(0,c.l6)(Pe.getStoryId),ze("design:type",f.c)],Fe.prototype,"storyId$",void 0),Be([(0,c.l6)(ue.getUI),ze("design:type",f.c)],Fe.prototype,"viewUI$",void 0),Be([(0,c.l6)(P.getAutoplay),ze("design:type",f.c)],Fe.prototype,"autoplay$",void 0),Be([(0,c.l6)(P.getInputEnabled),ze("design:type",f.c)],Fe.prototype,"inputEnabled$",void 0),Be([(0,c.l6)(P.getIsMobileWeb),ze("design:type",f.c)],Fe.prototype,"isMobileWeb$",void 0),Be([(0,c.l6)(P.getContentMode),ze("design:type",f.c)],Fe.prototype,"contentMode$",void 0),Be([(0,c.l6)(P.getFullscreenActive),ze("design:type",f.c)],Fe.prototype,"fullscreenActive$",void 0),Be([(0,c.l6)(P.getDrawerCoversContent),ze("design:type",f.c)],Fe.prototype,"drawerCoversContent$",void 0),Be([(0,c.l6)(P.getInteractType),ze("design:type",f.c)],Fe.prototype,"interactType$",void 0),Be([(0,c.l6)(P.getOnDemand),ze("design:type",f.c)],Fe.prototype,"onDemand$",void 0),Be([(0,c.l6)(P.getShowHelpTab),ze("design:type",f.c)],Fe.prototype,"showHelpTab$",void 0),Be([(0,c.l6)(P.getUsePrintImage),ze("design:type",f.c)],Fe.prototype,"usePrintImage$",void 0),Be([(0,c.l6)(P.getOpenWindow),ze("design:type",f.c)],Fe.prototype,"viewWindow$",void 0),Be([(0,c.l6)(P.getTutorialSeen),ze("design:type",f.c)],Fe.prototype,"tutorialSeen$",void 0),Be([(0,c.l6)(ki.getStoryLoadProgress),ze("design:type",f.c)],Fe.prototype,"storyLoadProgress$",void 0),Be([(0,c.l6)(mn.getHorizontalBreakpoint),ze("design:type",f.c)],Fe.prototype,"horizontalBreakpoint$",void 0),Be([(0,c.l6)(mn.getVerticalBreakpoint),ze("design:type",f.c)],Fe.prototype,"verticalBreakpoint$",void 0),Be([(0,c.l6)(E.getSelectedChapter),ze("design:type",f.c)],Fe.prototype,"chapter$",void 0),Be([(0,c.l6)(E.getSelectedChapterReadyState),ze("design:type",f.c)],Fe.prototype,"selectedChapterReady$",void 0),Be([(0,c.l6)(E.getChaptersLoaded),ze("design:type",f.c)],Fe.prototype,"chaptersLoaded$",void 0),Be([(0,c.l6)(E.getSelectedChapterIndex),ze("design:type",f.c)],Fe.prototype,"chapterIndex$",void 0),Be([(0,c.l6)(E.getChapterCount),ze("design:type",f.c)],Fe.prototype,"chapterCount$",void 0),Be([(0,c.l6)(E.getSelectedChapterBackground),ze("design:type",f.c)],Fe.prototype,"background$",void 0),Be([(0,c.l6)(ue.getVisible(h.Audio)),ze("design:type",f.c)],Fe.prototype,"audioVisible$",void 0),Be([(0,c.l6)(U.getAnimationPlaying),ze("design:type",f.c)],Fe.prototype,"animationPlaying$",void 0),Be([(0,c.l6)(U.getHoveredNode),ze("design:type",f.c)],Fe.prototype,"hoveredNode$",void 0),Be([(0,c.l6)(U.getActiveTool),ze("design:type",f.c)],Fe.prototype,"activeTool$",void 0),Be([(0,c.l6)(U.getEnginePosition),ze("design:type",f.c)],Fe.prototype,"enginePosition$",void 0),Be([(0,c.l6)(U.getCanvasHeightBreakpoint),ze("design:type",f.c)],Fe.prototype,"canvasHeightBreakpoint$",void 0),Be([(0,c.l6)(ye.getSelectedLabel),ze("design:type",f.c)],Fe.prototype,"selectedLabel$",void 0),Be([(0,c.l6)(G.hasQuiz),ze("design:type",f.c)],Fe.prototype,"hasQuiz$",void 0),Be([(0,c.l6)(G.getQuizModeActive),ze("design:type",f.c)],Fe.prototype,"quizModeActive$",void 0),Be([(0,c.l6)(G.getQuizModeLocked),ze("design:type",f.c)],Fe.prototype,"quizModeLocked$",void 0),Be([(0,c.l6)(G.getQuizEnabled),ze("design:type",f.c)],Fe.prototype,"quizEnabled$",void 0),Be([(0,c.l6)(G.getActiveQuestionIndex),ze("design:type",f.c)],Fe.prototype,"activeQuestionIndex$",void 0),Be([(0,c.l6)(G.getQuestionTotal),ze("design:type",f.c)],Fe.prototype,"questionTotal$",void 0),Be([(0,c.l6)(P.getStartingTool),ze("design:type",f.c)],Fe.prototype,"startingTool$",void 0),Be([(0,c.l6)(ue.getVisible(h.Camera)),ze("design:type",f.c)],Fe.prototype,"cameraVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Column)),ze("design:type",f.c)],Fe.prototype,"columnVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Drawer)),ze("design:type",f.c)],Fe.prototype,"drawerVisible$",void 0),Be([(0,c.l6)(ue.getUIEntry(h.Drawer)),ze("design:type",f.c)],Fe.prototype,"drawerUI$",void 0),Be([(0,c.l6)(ue.getVisible(h.DrawerToggle)),ze("design:type",f.c)],Fe.prototype,"drawerToggleVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Fullscreen)),ze("design:type",f.c)],Fe.prototype,"fullscreenVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Logo)),ze("design:type",f.c)],Fe.prototype,"logoVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Media)),ze("design:type",f.c)],Fe.prototype,"mediaVisible$",void 0),Be([(0,c.l6)(ue.getUIEntry(h.Media)),ze("design:type",f.c)],Fe.prototype,"mediaUI$",void 0),Be([(0,c.l6)(ue.getVisible(h.NodeInfo)),ze("design:type",f.c)],Fe.prototype,"nodeInfoVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.QuizPrompt)),ze("design:type",f.c)],Fe.prototype,"quizPromptVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Search)),ze("design:type",f.c)],Fe.prototype,"searchVisible$",void 0),Be([(0,c.l6)(ue.getUIEntry(h.Search)),ze("design:type",f.c)],Fe.prototype,"searchUI$",void 0),Be([(0,c.l6)(ue.getVisible(h.TitleOnly)),ze("design:type",f.c)],Fe.prototype,"titleOnlyVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Toolbar)),ze("design:type",f.c)],Fe.prototype,"toolbarVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Undo)),ze("design:type",f.c)],Fe.prototype,"undoVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.VisibilityLayers)),ze("design:type",f.c)],Fe.prototype,"visibilityLayersVisible$",void 0),Be([(0,c.l6)(ue.getUIEntry(h.VisibilityLayers)),ze("design:type",f.c)],Fe.prototype,"visibilityLayersUI$",void 0),Be([(0,c.l6)(ue.getVisible(h.ColumnToggle)),ze("design:type",f.c)],Fe.prototype,"columnToggleVisible$",void 0),Be([(0,c.l6)(ue.getVisible(h.Pagination)),ze("design:type",f.c)],Fe.prototype,"paginationVisible$",void 0);let zf=(()=>{var n;class e{constructor(){}resolve(i){const s={...i.queryParams};return function NM(n){const e=function OM(n){const e=Object.keys(n),o=e.filter(i=>Ky.includes(i));if(o.length>0){const i=[`The following URL parameters have been deprecated: "${o.join('", "')}"`,"Please contact support@biodigital.com for more information."];console.warn(i.join("\n"))}return e.reduce((i,s)=>(Ky.includes(s)&&delete i[s],i),n)}(n),o=function wM(n){return Object.keys(Zy).filter(e=>typeof n[e]>"u").reduce((e,o)=>{const s=(0,Zy[o])(n);return typeof s<"u"&&(e[o]=s),e},n)}(e);return PM(o)}(Object.keys(s).reduce((a,l)=>{const _=Array.isArray(s[l]);return a[l]=_?(0,m.last)(s[l]):s[l],a},{}))}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac}),e})();var Fx=S(6047),vT=S(830);function or(n,e){const{procName:o,actionFn:i,aliases:s=[],mapFnIn:r,mapFnOut:a,hideDefinition:l=!1}=e,_=function(p){const u=this,g=r?r(p):p,y=i(g);if(!(typeof y>"u"))if(y instanceof f.c)y.pipe((0,vT.$)()).subscribe(O=>{const L=a?a(O):O;u.setResult(L)});else{const C=a?a(y):y;u.setResult(C)}};[o,...s].forEach(p=>{n.defineAPIProcedure(p,_,{hidden:l})})}var W=function(n){return n.AnnotationsCreate="annotations.create",n.AnnotationsDestroy="annotations.destroy",n.AnnotationsInfo="annotations.info",n.AnnotationsSetDescription="annotations.setDescription",n.AnnotationsSetLabelsShown="annotations.setLabelsShown",n.AnnotationsSetTitle="annotations.setTitle",n.AnnotationsUpdate="annotations.update",n.AnnotationsSetEnabled="annotations.setEnabled",n.CameraInfo="camera.info",n.CameraOrbit="camera.orbit",n.CameraPan="camera.pan",n.CameraReset="camera.reset",n.CameraSet="camera.set",n.CameraZoom="camera.zoom",n.setCameraMode="camera.setCameraMode",n.CameraDisableChapterCamera="camera.disableChapterCamera",n.CameraEnableChapterCamera="camera.enableChapterCamera",n.GetAnnotationInfo="annotations.info",n.HideAnnotations="annotations.hide",n.HotspotsCreate="hotspots.create",n.HotspotsDestroy="hotspots.destroy",n.HotspotsHide="hotspots.hide",n.HotspotsInfo="hotspots.info",n.HotspotsShow="hotspots.show",n.HotspotsTypes="hotspots.types",n.HotspotsUpdate="hotspots.update",n.HumanInfo="human.info",n.HumanCanvasInfo="human.canvasInfo",n.InputDisable="input.disable",n.InputEnable="input.enable",n.LabelsCreate="labels.create",n.LabelsDestroy="labels.destroy",n.LabelsInfo="labels.info",n.LabelsHide="labels.hide",n.LabelsSetEnabled="labels.setEnabled",n.LabelsShow="labels.show",n.LabelsUpdate="labels.update",n.LabelsCanvasUpdate="labels.canvasUpdate",n.LabelsSetScale="labels.setScale",n.NativeErrorMessage="native.errorMessage",n.NativeSetSdkOffline="native.setSdkOffline",n.NativeSetAppVersion="native.setAppVersion",n.NativeRedirect="native.redirect",n.NativeReload="native.reload",n.NativeOfflineModelIds="native.offlineModelIDs",n.QuizInfo="quiz.info",n.QuizEnter="quiz.enter",n.QuizExit="quiz.exit",n.QuizQuestion="quiz.currentQuestion",n.QuizSubmit="quiz.submit",n.QuizNextQuestion="quiz.next",n.QuizPreviousQuestion="quiz.previous",n.QuizSelectQuestion="quiz.select",n.QuizSet="quiz.set",n.QuizReset="quiz.reset",n.SceneMetaData="scene.metadata",n.SceneSetHighlightColor="scene.setHighlightColor",n.SceneColorObject="scene.colorObject",n.SceneDisableHighlight="scene.disableHighlight",n.SceneEnableHighlight="scene.enableHighlight",n.SceneGetColor="scene.getColor",n.SceneInfo="scene.info",n.SceneLoad="scene.load",n.ScenePick="scene.pick",n.SceneReset="scene.reset",n.SceneSelectObjects="scene.selectObjects",n.SceneShowObjects="scene.showObjects",n.SceneTransformObject="scene.transformObject",n.SceneUncolorObject="scene.uncolorObject",n.SceneSnapshot="scene.snapshot",n.SceneCapture="scene.capture",n.SceneRestore="scene.restore",n.SceneEnableXrayMode="scene.enableXray",n.SceneDisableXrayMode="scene.disableXray",n.SceneSetLayersSliderPosition="scene.setLayersSliderPosition",n.SceneGetLayers="scene.getLayers",n.SceneGetPositions="scene.getPositions",n.SceneSetBaseDirectory="scene.setBaseDirectory",n.ShowAnnotations="annotations.show",n.SetAnnotationsShown="annotations.setShown",n.TimelineInfo="timeline.info",n.TimelineQuery="timeline.query",n.TimelineNext="timeline.nextChapter",n.TimelinePause="timeline.pause",n.TimelinePlay="timeline.play",n.TimelinePrev="timeline.previousChapter",n.TimelineSet="timeline.set",n.TimelineSetPlaybackSpeed="timeline.setPlaybackSpeed",n.TimelineGetPlaybackSpeed="timeline.getPlaybackSpeed",n.UIGetBackground="ui.getBackground",n.UIGetDisplay="ui.getDisplay",n.UIGetWorldPosition="ui.getWorldPosition",n.UISetBackground="ui.setBackground",n.UIPresetBackground="ui.presetBackground",n.UISetDisplay="ui.setDisplay",n.UIResetDisplay="ui.resetDisplay",n.UISnapshot="ui.snapshot",n.focusObject="focus.focusObject",n.dissectSetEnabled="dissect.setEnabled",n.pickSingleSetEnabled="pick.single.setEnabled",n.pickMultiSetEnabled="pick.multi.setEnabled",n.getCanvasPos="scene.getCanvasPos",n.sceneSetClickMode="scene.setClickMode",n.sceneGetClickMode="scene.getClickMode",n.IsolateObject="scene.isolateObject",n.UISetOndemand="ui.setOndemand",n.UISetLoadingExperience="ui.setLoadingExperience",n.UISetScrollCaptureMode="ui.setScrollCaptureMode",n.UISetTutorial="ui.setTutorial",n.UISetQuizLock="ui.setQuizLock",n.UIGetWindow="ui.getWindow",n.SceneGetVariantSchemas="scene.getVariantSchemas",n}(W||{});function Et(n){return(0,Tt.z)([n.select(E.getStoryChapters),n.select(U.getChapter)]).pipe((0,X.p)(([e,o])=>!(0,m.isEmpty)(e)&&!!o),(0,Ga.c)(0),(0,Vt.s)(1))}function sr(n){return n.select(E.getAllChaptersModelsReady).pipe((0,X.p)(e=>!0===e),(0,Vt.s)(1))}function eu(n){return(0,Tt.z)([n.select(Pe.getStory),n.select(Re.getNodes)]).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)&&!(0,m.isEmpty)(o)),(0,Vt.s)(1))}function Wf(n){const e=n.captureCamera();return{position:e.lookAt.eye,target:e.lookAt.look,up:e.lookAt.up,zoom:e.zoom}}var P_,ET=S(4525);!function(n){n.isLegacyCaptureFormat=function e(s){return void 0!==s.engineVersion},n.convertCaptureFormat=function o(s){const r=Object.keys(s.objects).reduce((a,l)=>(a.push({objectId:l,selected:!1,hidden:!1}),a),[]);return{storyId:s.timeline.rootName.replace(".json",""),camera:{lookAt:s.camera,zoom:void 0},labels:[],objects:r,background:[],activeChapterId:s.timeline.scrub?s.timeline.scrub.chapterId:void 0}},n.convertMediaFormat=function i(s){const r={};return Object.entries(s).forEach(([a,l])=>{r[a]={fullUrl:l.fullUrl,lang:l.lang,streamType:l.streamType}}),r}}(P_||(P_={}));let TT=(()=>{class e{}return e.type="[Analytics] Authorize App",e})(),Hx=(()=>{class e{constructor(i,s){this.userType=i,this.response=s}}return e.type="[Analytics] Auth Success",e})(),CT=(()=>{class e{constructor(i,s){this.userType=i,this.response=s}}return e.type="[Analytics] Auth Failure",e})(),N_=(()=>{class e{constructor(i,s){this.interaction=i,this.source=s}}return e.type="[Analytics] Log Interaction",e})(),Xf=(()=>{class e{constructor(i,s){this.interaction=i,this.response=s}}return e.type="[Analyics] Log Interaction Success",e})(),Qx=(()=>{class e{constructor(i,s){this.interaction=i,this.response=s}}return e.type="[Analyics] Log Interaction Failure",e})(),OT=(()=>{class e{}return e.type="[Analytics] Log View Analytic",e})(),Hf=(()=>{class e{}return e.type="[Analytics] Log Interaction Chance",e})(),wT=(()=>{class e{}return e.type="[Analytics] Log First Interaction",e})(),MT=(()=>{class e{}return e.type="[Analytics] Reset First Interaction",e})();function IT(n){if(!n)return null;const{objectId:e,canvasPos:o,worldPos:i,normal:s}=n;return{objectId:e||void 0,canvasPosition:o?{x:o.x,y:o.y}:void 0,mode:"query",position:i?Yt.fromArray(i):void 0,normal:s?Yt.fromArray(s):void 0}}function Qf(n,e,o){const i=n.getObjectById(o).parent;return null!==i&&(e[i.objectId].checked||Qf(n,e,i.objectId))}function AT(n,e,o){const i=e.getEvent(pe.HumanStarted).pipe((0,vT.$)()),s=o.includes("/")?yt.Module:yt.Bookmark;return n.dispatch(new td(o,s)),i}function PT(n,e){return n.dispatch(new rd(!0)),e.fireEvent(pe.SceneXrayEnabled),!0}function n7(n){return n.find(o=>o.type==Fn.Images)?.images?.filter(o=>null!=o.urls?.default).map(o=>o.urls.default)??[]}function c7(n,e,o,i,s,r,a,l,_,d,p,u,g,y,C){return[{procName:W.SceneMetaData,actionFn:()=>function Bx(n){return(0,Tt.z)([n.select(Pe.getStory),n.select(E.getStoryChapters)]).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)&&!(0,m.isEmpty)(o)),(0,Vt.s)(1))}(n).pipe((0,F.T)(([O,L])=>({title:O.displayName,description:O.description,chapters:L.map($=>({id:$.id,title:$.displayName,description:$.description,isAnimated:a.isChapterAnimated($),loops:a.isChapterLooped($),duration:a.getChapterTimeFrame($.id),media:P_.convertMediaFormat($.media),images:$.contentBlocks?n7($.contentBlocks):[],thumbnail:$.thumbnails?$.thumbnails.default:""}))})))},{procName:W.focusObject,actionFn:O=>(function t7(n,e,o){n.select&&n.xray?PT(e,o):qm(e,o),n.select&&e.dispatch(new un(!0,[n.objectId])),e.dispatch(new To(n.objectId,!0,1))}(O,n,o),!0),hideDefinition:!0},{procName:W.dissectSetEnabled,actionFn:O=>(n.dispatch(new hr(O.enable?Ct.Hide:Ct.Select)),!0),hideDefinition:!0},{procName:W.sceneSetClickMode,actionFn:O=>(n.dispatch(new hr("select"===O?Ct.Select:"hide"===O?Ct.Hide:"fade"===O?Ct.Fade:Ct.Select)),!0)},{procName:W.sceneGetClickMode,actionFn:()=>n.selectSnapshot(U.getActiveTool)},{procName:W.pickSingleSetEnabled,actionFn:O=>{const L=(()=>{switch(O.enable){case void 0:return!n.selectSnapshot(P.getMultiPickModeEnabled);case!0:return!1;case!1:return!0}})();return n.dispatch(new D.SetMultiPickModeEnabled(L)),!0},hideDefinition:!0},{procName:W.pickMultiSetEnabled,actionFn:O=>{const L=void 0===O.enable?!n.selectSnapshot(P.getMultiPickModeEnabled):O.enable;return n.dispatch(new D.SetMultiPickModeEnabled(L)),!0},hideDefinition:!0},{procName:W.getCanvasPos,actionFn:O=>{const L=u.getCanvas();return function Xx(n,e,o,i,s){o&&Ee.add(e,o,e);const r=n.getViewMat(),a=n.getProjMat(),l=ET.create();Ee.transformMat4(l,e,r),l[3]=1,ET.transformMat4(l,l,a);const d=l[1],p=l[3];return[Math.round((1+l[0]/p)*i/2),Math.round((1-d/p)*s/2)]}(u,O.worldPos,O.offset,L.width,L.height)},hideDefinition:!0},{procName:W.SceneCapture,actionFn:()=>Et(n).pipe((0,F.T)(()=>function Jx(n,e,o){const i=o.captureCamera(),s=e.selectSnapshot(Re.getNodes),r=Object.keys(s).map(u=>({objectId:u,selected:s[u].checked||Qf(n,s,u),hidden:!s[u].shown})),a=e.selectSnapshot(E.getStoryChapters).map(u=>({chapterId:u.id,background:u.background||Aa})),l=e.selectSnapshot(Pe.getStoryId);return{camera:i,labels:e.selectSnapshot(ye.getLabels),storyId:l,objects:r,background:a,activeChapterId:e.selectSnapshot(E.getSelectedChapterId)}}(g,n,s)))},{procName:W.SceneRestore,actionFn:O=>sr(n).pipe((0,At.Z)(()=>{const L=P_.isLegacyCaptureFormat(O),$=L?P_.convertCaptureFormat(O):O;return function e7(n,e,o,i,s){return AT(o,i,e.storyId).pipe((0,At.Z)(()=>(0,Ra.H)(function Zx(n,e,o,i=!1){return new Promise(s=>{const r=e.objects.filter(p=>!0===p.selected).map(p=>p.objectId),a=i?n.getLeafIds().filter(u=>void 0===e.objects.find(C=>C.objectId===u)):e.objects.filter(p=>!0===p.hidden).map(p=>p.objectId),l=e.background.map(p=>new mr(p.chapterId,p.background)),_=e.activeChapterId?[new kl(e.activeChapterId)]:[],d=void 0!==e.camera.zoom?[new Sg(e.camera.zoom)]:[];setTimeout(()=>{o.dispatch([new di(e.camera.lookAt,!1),new Ua(e.labels),new kn(!1,a,void 0,void 0,void 0,!0),new un(!0,r),...d,..._,...l]),s(void 0)})})}(n,e,o,s))),(0,qo.M)(()=>{i.fireEvent(pe.SceneRestored)}),(0,F.T)(()=>!0))}(g,$,n,o,L)}))},{procName:W.SceneEnableXrayMode,actionFn:()=>Et(n).pipe((0,F.T)(()=>PT(n,o)))},{procName:W.SceneDisableXrayMode,actionFn:()=>Et(n).pipe((0,F.T)(()=>qm(n,o)))},{procName:W.SceneLoad,actionFn:O=>sr(n).pipe((0,At.Z)(()=>{e.pipe((0,c.xi)(id),(0,Vt.s)(1)).subscribe(()=>{o.fireEvent(pe.SceneReady)});const L=AT(n,o,O);return n.dispatch(new MT),L}))},{procName:W.SceneSetBaseDirectory,actionFn:O=>(p.fireEvent(Ce.NativeSetBaseDirectory,O),!0)},{procName:W.NativeSetSdkOffline,actionFn:O=>(p.fireEvent(Ce.NativeSetSdkOffline,O),!0)},{procName:W.SceneReset,actionFn:()=>(l.resetChapter(),!0)},{procName:W.SceneInfo,actionFn:O=>Et(n).pipe((0,At.Z)(()=>eu(n)),(0,At.Z)(([L,$])=>{const q=O?.chapterId;let x=$;q&&(x=n.selectSnapshot(Re.getAllNodeState)[q]??{});const k=O?.objectId,A=k?[k]:Object.keys(g.getObjects()),R=!!O.objectId,{displayName:Z}=L;return function qx(n,e,o,i,s,r,a,l){const _=r.map(d=>function Yx(n,e,o,i,s,r){const a=o.getObjectById(s),{children:l,displayName:_,parent:d,shown:p}=a,u=o.isLeaf(a)?e[s].checked||Qf(o,e,s):void 0,g=e[s].available;return(r?function Kx(n,e,o){const i=n.selectSnapshot(P.getNodeInfoFallback),s=n.selectSnapshot(P.getViewLanguage);return e.queryNodeInfo(o,i,s).pipe((0,F.T)(r=>r?.description||""),(0,pi.W)(()=>(0,Qe.of)("")))}(n,i,_):(0,Qe.of)("")).pipe((0,F.T)(C=>({objectId:s,name:_,description:C,available:g,shown:p,selected:u,children:l?.map(O=>O.objectId),parent:d?d.objectId:null})))}(n,e,o,i,d,a));return(0,si.p)(_).pipe((0,F.T)(d=>{const p=d.reduce((u,g)=>((l||g.available)&&(u[g.objectId]=g),u),{});return{name:s,objects:p}}))}(n,x,g,y,Z,A,R,O?.includeUnavailable??!q)}))},{procName:W.ScenePick,actionFn:O=>IT(u.pick(O.x,O.y))},{procName:W.SceneSelectObjects,actionFn:O=>Et(n).pipe((0,F.T)(()=>{const L=!0===O.replace,$=O;return delete $.replace,L&&n.dispatch(new un(!1)),n.dispatch(new un(!1,[],$)),!0}))},{procName:W.SceneShowObjects,actionFn:O=>Et(n).pipe((0,F.T)(()=>{delete O.replace;const L=(q,x)=>{const k=g.getObjectById(q).children;let A={[q]:x};for(const R of k)void 0===O[R.objectId]&&(A[R.objectId]=x,A={...A,...L(R.objectId,x)});return A},$=Object.entries(O).reduce((q,[x,k])=>({...q,...L(x,k)}),{});return n.dispatch(new kn(!1,[],$,void 0,void 0,!0)),!0}))},{procName:W.IsolateObject,actionFn:O=>{const L="string"==typeof O?[O]:O,$=n.selectSnapshot(U.getViewGraph),q=r.getInverseSelection($,L),x=r.getNodes($,q);return n.dispatch(new kn(!1,x.map(k=>k.id),void 0,void 0,void 0,!0)),!0}},{procName:W.SceneTransformObject,actionFn:O=>Et(n).pipe((0,F.T)(()=>(g.transformObject(O.objectId,O),!0)))},{procName:W.SceneColorObject,actionFn:O=>eu(n).pipe((0,F.T)(()=>{const{objectId:L,tintColor:$,saturation:q,contrast:x,brightness:k,opacity:A}=O;return n.dispatch(new Mo(xg({tintColor:$,saturation:q,contrast:x,brightness:k,opacity:A}),[L])),!0}))},{procName:W.SceneGetColor,actionFn:O=>eu(n).pipe((0,F.T)(()=>yr(n.selectSnapshot(Re.getNodePaint)(O.objectId))))},{procName:W.SceneUncolorObject,actionFn:O=>eu(n).pipe((0,F.T)(()=>(n.dispatch(new Mo(Ma,[O.objectId])),!0)))},{procName:W.SceneDisableHighlight,actionFn:()=>(i.disableHighlight(),!0)},{procName:W.SceneEnableHighlight,actionFn:()=>(i.enableHighlight(),!0)},{procName:W.SceneSetHighlightColor,actionFn:O=>(i.setHighlightColor(O),!0)},{procName:W.SceneSetLayersSliderPosition,actionFn:O=>Et(n).pipe((0,F.T)(()=>{const{layersMode:L}=n.selectSnapshot(ue.getUI).visibilityLayers;return L===jr.Group?function r7(n,e,o){const i=(0,m.clamp)(o.position,0,1),s=!0===o.record,r=n.selectSnapshot(E.getSelectedChapterId),a=n.selectSnapshot(E.getSelectedChapterLayerGroups),l=e.computeGroupPositionsByFraction(a,i);return e.syncLayerGroupsToScene(l),e.syncLayerGroupsToState(r,l,s),!0}(n,_,O):function o7(n,e,o){const i=n.selectSnapshot(E.getSelectedChapterId),s=n.selectSnapshot(E.getSelectedChapterCurrentLayers),r=Math.min(1,Math.max(o.position,0)),a=e.fractionToIndex(s,r),l=e.fractionToPosition(s,r,a);return o.record?e.syncLayersToState(i,a,l):e.syncLayersToScene(s,a,l,!1),!0}(n,d,O)}))},{procName:W.SceneGetLayers,actionFn:()=>Et(n).pipe((0,F.T)(()=>{const{layersMode:O}=n.selectSnapshot(ue.getUI).visibilityLayers;return O===jr.Group?function s7(n){return[n.selectSnapshot(E.getSelectedChapterLayerGroups).map(i=>i.layers).flat()]}(n):function i7(n){return n.selectSnapshot(E.getAllChaptersCurrentLayers)}(n)}))},{procName:W.SceneGetPositions,actionFn:()=>Et(n).pipe((0,F.T)(()=>{const O=C.findContentBlockByType(n.selectSnapshot(E.getSelectedChapterContentBlocks),Fn.Positions);return(O?O.positions:[]).map($=>function a7(n){const e=n.camera.location;return{title:n.title,camera:{position:e.eye,target:e.look,up:e.up}}}($))}))},{procName:W.SceneGetVariantSchemas,actionFn:()=>Et(n).pipe((0,F.T)(()=>n.selectSnapshot(Pe.getVariantSchemas)))}]}function xo(n,e,o,i){n.defineAPIEvent(e,{events:o||[e],map:i||(s=>s)})}function NT(n){return n.selectSnapshot(U.getPlaybackSpeed)}function RT(n){return ts.getColors(n).map(o=>o[255])}function kT(n,e){const o=n.selectSnapshot(E.getSelectedChapterBackground),{colors:i,colorStops:s,gradientType:r}=o,a=e.gradientType||r,l=e.colorStops||s;if(e.colors){const[_,d]=e.colors;return{colors:[..._,...d],gradientType:a,colorStops:l}}return{colors:i,gradientType:a,colorStops:l}}function DT(n){return Object.entries(en).reduce((e,[o,i])=>i===n?o:e,"None")}function tu(n){return n.selectSnapshot(ye.getChapterLabels)}function LT(n,e){return function E7(n,e){return n.find(o=>e===o.id)}(tu(n),e)}function Yf(n,e){const o=n.getMarkerById(e.id),i=n.getMarkerWorldPosition(o);return{annotationId:e.id,objectId:e.objectId||null,title:e.title,description:e.description,shown:e.shown,occludable:e.occludable,position:i?Yt.fromArray(i):null,canvasPosition:o?{x:o.canvasPosition[0],y:o.canvasPosition[1]}:null}}function qf(n,e){const o=LT(n,e.annotationId);return o?{...o,...e}:null}function Kf(n,e){return e&&n.dispatch(new Rr(e)),!0}function Jf(n,e){return n.dispatch(new Fl(e)),!0}function UT(n,e){return n.reduce((o,i)=>({...o,[`${i}`]:e}),{})}function Zf(n,e){return function A7(n,e){return Object.entries(n).filter(([o,i])=>e(o,i)).reduce((o,[i,s])=>({...o,[`${i}`]:s}),{})}(n,(o,i)=>i===e)}function VT(n,e){return Object.keys(Zf(n,e))}function jT(n,e,o){return function T7(n,e){return n.filter(o=>e.includes(o.id))}(n,VT(e,o))}function xT(n,e,o){const i=VT(e,o).map(r=>function C7(n,...e){const o=e.map(s=>n.filter(a=>s===a.objectId));return function v7(n){const e=new Set(n);return Array.from(e.values())}([].concat(...o))}(n,r)).map(r=>r.map(a=>a.id));return UT([].concat(...i),o)}function R7(n,e){return[{eventName:Ce.AnnotationsCreated,aliasEvents:[Ce.LabelsCreated],mapFn:o=>Yf(n,o)},{eventName:Ce.AnnotationsDestroyed,aliasEvents:[Ce.LabelsDestroyed],mapFn:o=>({annotationId:o.id})},{eventName:Ce.AnnotationsShown,aliasEvents:[Ce.LabelsEnabled],mapFn:()=>!0},{eventName:Ce.AnnotationsHidden,aliasEvents:[Ce.LabelsDisabled],mapFn:()=>!0}]}function k7(n,e,o,i){return[{procName:W.AnnotationsInfo,actionFn:()=>tu(n),mapFnOut:s=>function w7(n,e){return e.reduce((o,i)=>(o[i.id]=Yf(n,i),o),{})}(o,s)},{procName:W.AnnotationsCreate,mapFnIn:s=>function O7(n,e,o,i){const s=e.selectSnapshot(E.getSelectedChapter),r=n.getObjectById(i.objectId)?i.objectId:void 0;return o.deserializeAnnotation({annotationId:i.annotationId,title:i.title,description:i.description,objectId:r,pos:i.position,occludable:i.occludable,labelOffset:i.labelOffset,shown:i.shown,labelShown:i.shown},s,$n.Annotation)}(i,n,e,s),actionFn:s=>function M7(n,e){return e.objectId?(n.dispatch(new Nr(e,!0)),e):null}(n,s),mapFnOut:s=>s?Yf(o,s):null},{procName:W.AnnotationsUpdate,mapFnIn:s=>qf(n,s),actionFn:s=>Kf(n,s)},{procName:W.AnnotationsSetTitle,mapFnIn:s=>qf(n,s),actionFn:s=>Kf(n,s),hideDefinition:!0},{procName:W.AnnotationsSetDescription,mapFnIn:s=>qf(n,s),actionFn:s=>Kf(n,s),hideDefinition:!0},{procName:W.AnnotationsDestroy,mapFnIn:s=>LT(n,s),actionFn:s=>function I7(n,e){return e&&n.dispatch(new Va(e)),!0}(n,s)},{procName:W.ShowAnnotations,actionFn:()=>Jf(n,!0)},{procName:W.SetAnnotationsShown,actionFn:()=>Jf(n,!0),hideDefinition:!0},{procName:W.HideAnnotations,actionFn:()=>Jf(n,!1)},{procName:W.AnnotationsSetLabelsShown,mapFnIn:s=>function P7(n,e){const{annotations:o,objects:i,replace:s}=e,a=o||{},l=i||{},_=tu(n),d={...Zf(a,!0),...Zf(a,!1),...xT(_,l,!0),...xT(_,l,!1)};return s?{...UT(_.map(p=>p.id),!1),...d}:d}(n,s),actionFn:s=>function N7(n,e){const o=tu(n),i=jT(o,e,!1),s=jT(o,e,!0);n.dispatch(new os(s,!0)),n.dispatch(new os(i,!1))}(n,s),hideDefinition:!0}]}const D7={};function GT(n,e){e.hasOwnProperty("data")&&(e[n]=e.data)}const Go={hotspotSeedId:0,hotspotIdMap:new Map,getHotspotMap:n=>{const{hotspotIdMap:e,createHotspotId:o}=Go;return n.selectSnapshot(ye.getLabels).forEach(s=>{const r=s.id;typeof e.get(r)>"u"&&o(r)}),e},createHotspotId:n=>(Go.hotspotSeedId++,Go.hotspotIdMap.set(n,Go.hotspotSeedId),Go.hotspotSeedId),getHotspotIdByLabel:(n,e,o)=>{const{getHotspotMap:i,createHotspotId:s}=Go,a=i(n).get(e);return o&&typeof a>"u"?s(e):a},getLabelIdByHotspotId:(n,e)=>{const o=Go.getHotspotMap(n),i=Array.from(o).find(([s,r])=>r===e);return i?i[0]:null}};function $T(n,e){const o=n.selectSnapshot(ye.getLabels);return typeof e<"u"?o.filter(i=>i.chapterId===e):o}function nu(n,e){const o=$T(n),i=Go.getLabelIdByHotspotId(n,e);return o.find(s=>s.id===i)}function FT(n){return n===Ko.CirclePlus?_n.Plus:n===Ko.CircleMinus?_n.Minus:_n.Default}function eS(n,e){return Go.getHotspotIdByLabel(n,e)}function iu(n,e){return{...e,id:eS(n,e.id)}}function BT(n,e,o){const i=e.selectSnapshot(E.getStoryChapters);return o.map(s=>function j7(n,e,o,i){const{id:s,chapterId:r,title:a,objectId:l}=i,_=o.findIndex(y=>r===y.id),d=Go.getHotspotIdByLabel(e,s,!0),p=n.getMarkerById(s),u=n.getMarkerWorldPosition(p),g=p?.marker3D?.direction;return{id:d,title:a,objectId:l,position:u?zT(u):null,direction:g?zT(g):null,canvasPosition:p?x7(p.canvasPosition):null,chapterScope:_,type:i.pinType===_n.PlusMinus?Ko.CirclePlus:Ko.Circle,shown:i.shown,data:D7[i.id]}}(n,e,i,s))}function zT(n){return{x:n[0],y:n[1],z:n[2]}}function ou(n){return[n.x,n.y,n.z]}function x7(n){return{x:n[0],y:n[1]}}function WT(n,e,o){return n.dispatch(new os(e,o)),!0}function tS(n,e){if("number"==typeof e){const o=nu(n,e);return o?[o]:[]}return $T(n)}function W7(n){return[{eventName:Ce.HotspotsEntered,mapFn:e=>iu(n,e)},{eventName:Ce.HotspotsLeft,mapFn:e=>iu(n,e)},{eventName:Ce.HotspotsPicked,mapFn:e=>iu(n,e)},{eventName:Ce.HotspotsDisplayUpdated,mapFn:e=>iu(n,e)},{eventName:Ce.HotspotsPositionUpdated,mapFn:e=>function U7(n,e){const{id:o,canvasPos:i}=e,{x:s,y:r}=i;return{id:eS(n,o),canvasPosition:{x:s,y:r,0:s,1:r},occluded:e.occluded}}(n,e)}]}function X7(n,e,o){return[{procName:W.HotspotsInfo,actionFn:i=>{const s="number"==typeof i?i:void 0;if(void 0!==s){const r=nu(n,s);return BT(o,n,[r])[0]}{const r=tS(n,s);return BT(o,n,r)}}},{procName:W.HotspotsTypes,mapFnIn:()=>function G7(){return Object.values(Ko).map(n=>`${n}`)}(),actionFn:i=>i},{procName:W.HotspotsCreate,mapFnIn:i=>function L7(n,e,o){const{title:i,objectId:s,position:r,direction:a,chapterScope:l,type:_}=o,d=n.selectSnapshot(E.getStoryChapters),p=n.selectSnapshot(E.getSelectedChapter),u=n.selectSnapshot(E.getSelectedChapterIndex),g="number"==typeof l?l:u,y=d[g]||p,C=!1!==o.shown,L={title:i,type:_||Ko.CircleLabel,objectId:s,pos:r?ou(r):null,dir:a?ou(a):null,shown:C,symbol:"",className:""},$=e.deserializeHotspots({},y,g,L);return $.title=i,$.flyTo=!1,$.flyToTarget=null,$.occludable=!0,$.pinGlow=!1,$.pinType=_n.PlusMinus,$.shown=C,$.hideWire=!0,$.theme=$n.StudioNext,$.pinType=FT(_),GT($.id,o),$}(n,e,i),actionFn:i=>function $7(n,e){return e.objectId?(n.dispatch(new Nr(e,!0)),e):null}(n,i),mapFnOut:i=>i?eS(n,i.id):null},{procName:W.HotspotsUpdate,mapFnIn:i=>function z7(n,e){const o=nu(n,e.id);return o?function V7(n,e){const{title:o,objectId:i,direction:s,position:r,shown:a,type:l}=n,_={...e,title:o,objectId:i,shown:a,pos:r?ou(r):null,dir:s?ou(s):null,pinType:l?FT(l):null};return GT(e.id,n),{...e,...(0,m.omitBy)(_,m.isNil)}}(e,o):null}(n,i),actionFn:i=>i?function F7(n,e){return n.dispatch(new Rr(e)),e}(n,i):null},{procName:W.HotspotsDestroy,mapFnIn:i=>nu(n,i),actionFn:i=>i?function B7(n,e){return n.dispatch(new Va(e)),e}(n,i):null},{procName:W.HotspotsShow,mapFnIn:i=>tS(n,i),actionFn:i=>WT(n,i,!0)},{procName:W.HotspotsHide,mapFnIn:i=>tS(n,i),actionFn:i=>WT(n,i,!1)}]}function XT(n){return n.selectSnapshot(ye.getChapterLabels)}function HT(n,e){return n.dispatch(new Fl(e)),!0}function ml(n,e){return XT(n).find(i=>e===i.id)}function nS(n,e){return XT(n).filter(i=>e.includes(i.id))}function iS(n,e,o){return e&&e.objectId?(n.dispatch(o?new Nr(e,!0):new Rr(e)),e):null}function QT(n,e){const o=document.createElement("span");return o.innerHTML=n,(0,m.trim)(o.textContent).length<=e}function YT(n,e){const o=(0,m.cloneDeep)(n);return o.title=e.title&&QT(e.title,100)?e.title:o.title,o.description=e.description&&QT(e.description,300)?e.description:o.description,o.theme=e.theme||o.theme,o.pinType=e.pinType||o.pinType,o.sequentialType=e.sequentialType||o.sequentialType,o.offset=function q7(n,e){return e||[-(n.hideWire?20:32),0]}(o,e.labelOffset),o.pinGlow=void 0!==e.pinGlow?e.pinGlow:o.pinGlow,o.hideWire=void 0!==e.hideWire?e.hideWire:o.hideWire,o.hideTag=void 0!==e.hideTag?e.hideTag:o.hideTag,o.collapseDescription=void 0!==e.collapseDescription?e.collapseDescription:o.collapseDescription,o.occludable=void 0!==e.occludable?e.occludable:o.occludable,o.cameraPosition=e.flyToCamera||o.cameraPosition,o.flyTo=function K7(n,e){return!1!==e&&(e||n.flyTo)}(o,e.flyTo),o.states=function J7(n){if(!n.flyTo)return[];const e=[new vs,new vs];e[0].errands=[new Ul],e[1].errands=n.cameraPosition?[new by(n.cameraPosition)]:[new Ll(n.objectId)]}(o),o}function fl(n,e){if(e){const o=n.getMarkerById(e.id),i=n.getMarkerWorldPosition(o);return{labelId:e.id,objectId:e.objectId,title:e.title,description:e.description,theme:e.theme,pinType:e.pinType,labelOffset:e.offset,hideWire:e.hideWire,pinGlow:e.pinGlow,occludable:e.occludable,sequentialType:e.sequentialType,shown:e.shown,collapseDescription:e.collapseDescription,hideTag:e.hideTag,flyTo:!0===e.flyTo,flyToCamera:e.cameraPosition,position:i??e.pos,canvasPosition:o?.canvasPosition??[-1,-1],occluded:o?.occluded??!0}}return null}function qT(n,e){return e.reduce((o,i)=>(o[i.id]=fl(n,i),o),{})}function oS(n){return n.selectSnapshot(G.getAllQuestions)}function sS(n,e){return oS(n).find(o=>o.id===e)}function KT(n){return sS(n,aS(n))}function Sl(n){return{enabled:n.selectSnapshot(G.getQuizEnabled),active:n.selectSnapshot(G.getQuizModeActive),questions:r6(oS(n)),questionId:aS(n),submissions:n6(n,rS(n))}}function n6(n,e){return e.map(o=>JT(n,o))}function JT(n,e){const o=KT(n);return{questionId:e.questionId,answerIds:o.data.correctAnswer,correctAnswerIds:_S(o),correct:Tr(o,e.answer)}}function rS(n){return n.selectSnapshot(G.getAllSubmissions)}function aS(n){return n.selectSnapshot(G.getActiveQuestionId)}function lS(n){const e=KT(n),o=function t6(n){return rS(n).find(o=>o.questionId===aS(n))}(n);return{question:cS(e),submission:o?JT(n,o):void 0}}function ZT(n){return n.map(e=>function i6(n){const e=n.type;switch(e){case Fn.Markdown:{const{markdown:o}=n;return{type:e,content:o}}case Fn.Images:{const{images:o}=n;return{type:e,content:o.map(s=>s.urls.default)}}default:return{type:e,content:""}}}(e))}function cS(n){let e=[],o="";switch(n.type){case ot.MultipleChoice:{const i=n.data;e=function o6(n){return n.map(e=>function s6(n){return{answerId:n.value,displayText:n.label}}(e))}(i.options),o=i.correctAnswer;break}case ot.SelectAnatomy:e=n.data.correctAnswer.map(s=>({answerId:s,displayText:s})),o="";break;case ot.LabelAnatomy:e=n.data.options.map(s=>({answerId:s.value,displayText:s.label.title})),o=""}return{questionId:n.id,questionType:n.type,questionPrompt:ZT(n.questionPrompt),answerExplanation:ZT(n.explanation),answers:e,answerId:o}}function r6(n,e){const o=n.map(i=>cS(i));return typeof e<"u"?o.filter(i=>e.includes(i.questionId)):o}function _S(n){const e=cS(n);switch(e.questionType){case ot.LabelAnatomy:case ot.SelectAnatomy:return e.answers.map(({answerId:o})=>o);case ot.Instructions:return["-"];default:return[e.answerId]}}var c6=S(9984),dS=function(n){return n.InvalidUAID="analytic id does not exist",n.InvalidDeveloperId="Client id invalid",n.InvalidProductKey="app product key",n.MissingUAID="analytic id missing",n.WebOnlyAPI="Api key only compatible with Web Widget",n.AndroidOnlyAPI="Api key only compatible with Mobile Widget SDK for Android",n.IOSOnlyAPI="Api key only compatible with Mobile Widget SDK for iOS",n.MixedAPIKeys="Use of both an app product key and an app api key not allowed",n.ProductKeyNotRegistered='App product key "xxx" has not been registered or is incorrect.  Ensure it has been registered by the system admin',n.ProductKeyInvalidAppBundleID='The app product key "xxx" has not been authorized to be used for app bundle id "yyy".  Confirm the correct values are being used from the system admin',n.ProductKeyBundleIDWhitelist='Use of app product key "xxx" requires the affiliated app bundle id (app_domain) to be white-listed.  Ensure the system admin has white-listed "yyy"',n.ImproperProductKeyUsage='Improper use of app product key "xxx" detected. Contact the system admin if issue continues',n.InvalidPlatformSource="Invalid platform source",n.MissingSource="Missing source",n.MissingPlatform="Missing platform",n.MissingAppDomain="Missing app domain",n.APIKeyMissing="Api key missing",n.APIKeyInvalid="Api key invalid",n.DeveloperDeactivated="Developer account for api key is deactivated",n.BundleIDNotAllowed="App bundle id not allowed",n.BundleIDUnregistered="App bundle id unregistered",n}(dS||{});class _6{}const d6={headers:new $e.Lr({"Content-Type":"application/json; charset=utf-8"})},eC="127.0.0.1";let pS=(()=>{var n;class e{constructor(i,s){this.http=i,this.storageService=s}getAnalytic(i){return he.offline?(fetch("https://human.biodigital.com/ws/user/analytics?analytic_id="+i,{method:"GET",mode:"no-cors"}),(0,Qe.of)({success:!0})):this.http.get("/ws/user/analytics?analytic_id="+i).pipe((0,F.T)(()=>({success:!0})),(0,pi.W)(r=>(0,Qe.of)(this.parseError(r))))}sendAnalytic(i){if(he.offline){const a=i instanceof Ht?"https://human.biodigital.com/ws/user/analytics":"https://human.biodigital.com/ws/developer/apps/access/key",l=(0,c6.stringify)(i);if(navigator.onLine)this.sendOfflineAnalytic(a,l),this.sendSavedOfflineMessages(a);else{const d="offline_event=1&event_timestamp="+(new Date).toISOString().substring(0,19)+"&"+l;this.storageService.setDatabaseAnalyticItem({url:a,message:d})}return(0,Qe.of)({success:!0})}return this.http.post(i instanceof Ht?"/ws/user/analytics":"/ws/developer/apps/access/key",i,d6).pipe((0,F.T)(()=>({success:!0})),(0,pi.W)(a=>(0,Qe.of)(this.parseError(a))))}sendOfflineAnalytic(i,s){var r=this;return(0,J.A)(function*(){fetch(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:s}).catch(()=>{navigator.onLine?setTimeout(()=>{fetch(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:s})},300):r.storageService.setDatabaseAnalyticItem({url:i,message:s})})})()}sendSavedOfflineMessages(i){this.storageService.getDatabaseOfflineAnalytics(s=>{s.forEach(r=>{this.sendOfflineAnalytic(r.url??i,r.message)})})}buildUserAnalytic(i,s,r){const{widgetUrlConfig:a,parentUrl:l}=i,_=a.uaid,d=l.domain,p={...this.buildAppActivityData(i),parent_analytic_identifier:_,referer_domain:d,[`${s}_source`]:r},u={analytic_platform:Rn.Widget,analytic_type:s,analytic_data:p};return he.offline&&(u.app_domain=eC),(0,je.bj)(Ht,u)}buildDeveloperAnalytic(i,s,r=Rn.Widget,a){const{widgetUrlConfig:l,parentUrl:_,embedded:d}=i;return(0,je.bj)(_6,{platform:r,app_activity:s,app_productkey:l["app-productkey"],app_userid:l["app-userid"],app_apikey:l.dk,app_domain:he.offline?eC:_.full,app_activity_data:a,widget_is_fullscreen:!d})}buildAppActivityData(i){const{engineVersion:s,engineAPIVersion:r,widgetUrlConfig:a}=i,l={engine_version:s,api_version:r};return Object.entries(a).filter(([_])=>"dk"!==_).forEach(([_,d])=>{l[`url_param_${_}`]=d}),(0,je.bj)(nn,l)}parseError(i){if(he.offline)return{success:!0,message:"",errorCode:null};const s=i.error.error,r=i.status,l=s&&s.message?s.message:"";return{success:r>=500&&r<=504,message:l,errorCode:Object.values(dS).includes(l)?l:null}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Le))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var hs=function(n){return n.Init="init",n.View="view",n.ChanceInteraction="interactionc",n.FirstInteraction="interactionf",n.Call="call",n}(hs||{});class u6{constructor(e,o,i){this.subject=e,this.callId=o,this.procedureName=i}setResult(e){const{callId:o,procedureName:i}=this;this.subject.next({callId:o,value:e,procedureName:i})}}const g6=Object.values(pe),h6=Object.values(Ce);let uS=(()=>{var n;class e{constructor(i,s){this.engineService=i,this.applicationEventService=s,this.proceduresMap={},this.hiddenProcedures={},this.eventsMap={},this.resultsSubject=new oe.B,this.logEntries=[],this.ngUnsubscribe=new oe.B,this.init()}getAPIProcedureNames(){return Object.keys(this.proceduresMap).filter(i=>!(!0===this.hiddenProcedures[i]))}getAPIEventNames(){const i=Object.keys(this.eventsMap);return[pe.HumanReady,...i]}logAPIProcedure(i){this.logEntries.length>1e4&&this.logEntries.shift(),this.logEntries.push({engine_version:fs,api_version:"2.0.1",identifier:i,category:i.split(".")[0]})}getAPILog(){return this.logEntries}resetAPILog(){this.logEntries.length=0}callAPIProcedure(i,s,r){const a=this.proceduresMap[s];a?a(i,r):console.warn("API:",`Target procedure not found: ${s}`)}defineAPIEvent(i,s){this.eventsMap[i]&&console.warn("API:",`Redefining event: ${i}`),this.eventsMap[i]=s||i}defineAPIProcedure(i,s,r){this.proceduresMap[i]&&console.warn("API:",`Redefining procedure: ${i}`),this.hiddenProcedures[i]=!0===r?.hidden,this.proceduresMap[i]=(a,l)=>{s.call(new u6(this.resultsSubject,a,i),l??{})}}onResults(){return this.resultsSubject.asObservable()}getEvent(i,s){let r;if(g6.includes(i)?r=this.engineService.getEvent(i):h6.includes(i)&&(r=this.applicationEventService.getEvent(i)),!(0,m.isNil)(r))return s?r.pipe((0,Vt.s)(1)):r}init(){const i=this;this.defineAPIProcedure("apiEvents.on",function(s){i.enableEvent.call(i,this,s,!1)},{hidden:!0}),this.defineAPIProcedure("apiEvents.once",function(s){i.enableEvent.call(i,this,s,!0)},{hidden:!0})}enableEvent(i,s,r){if(!this.eventsMap[s])return void console.warn("API:",`Event: ${s} not defined.`);const a=this.eventsMap[s];if("string"==typeof a){const l=this.getEvent(a,r);l?l.subscribe(_=>{i.setResult(_)}):console.warn("API:",`Error defining event: ${s}`)}else this.mapEvents(i,a,r)}mapEvents(i,s,r){const a=s.events,l=s.map;s.init&&s.init();const d=a.map(p=>{const u=this.getEvent(p,r);if(u)return u;console.warn("API:",`Error defining event: ${p}`)}).filter(p=>!(0,m.isNil)(p));(0,Ao.h)(...d).subscribe(function _(p){const u=l?l(p):p;null!==u&&i.setResult(u||{})})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(mo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),m6=(()=>{var n;class e{constructor(i,s,r){this.engineService=i,this.rpcService=s,this.zone=r,this.responseQueue=[],this.listening=!1,this.listen()}listen(){this.listening||(this.ngUnsubscribe||(this.ngUnsubscribe=new oe.B),this.zone.runOutsideAngular(()=>{this._listen()}))}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null,this.listening=!1)}_listen(){this.listening=!0,this.engineService.getEvent(pe.Started).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.sendResponse({message:"status",status:"ready"})}),this.rpcService.onResults().pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(({callId:i,value:s})=>{this.sendResponse({results:{[i]:s}})}),(0,hn.R)(window,"message").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{const s=this.getClientRequest(i.data);if(!s)return;const{action:r,call:a}=s;"connect"===r?this.client||(this.client=i.source,this.clientOrigin=i.origin,this.sendResponse({message:"connected"}),this.flushResponseQueue()):a&&this.executeCall(s)})}getClientRequest(i){try{return JSON.parse(i)}catch{return}}sendResponse(i){const s=JSON.stringify(i);this.client?this.postClientMessage(s):this.responseQueue.push(s)}postClientMessage(i){this.client.postMessage(i,this.clientOrigin)}flushResponseQueue(){for(;this.responseQueue.length>0;)this.postClientMessage(this.responseQueue.pop())}executeCall(i){const{id:s,call:r,params:a}=i;try{this.rpcService.callAPIProcedure(s,r,a),this.rpcService.logAPIProcedure(r)}catch(l){console.error("API:",`Error executing API call [callId: ${s}, procedure: ${r}]: ${l}`)}}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(Lt),t.KVO(uS),t.KVO(t.SKi))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})(),S6=(()=>{var n;class e{constructor(i,s,r,a,l,_,d,p,u,g,y,C,O,L,$,q,x,k,A,R,Z){this.store=i,this.actions=s,this.cameraService=r,this.engineService=a,this.animationService=l,this.paintService=_,this.labelsService=d,this.graphService=p,this.viewService=u,this.analyticsService=g,this.visibilityLayersService=y,this.legacyVisibilityLayersService=C,this.quizService=O,this.rpcService=L,this.windowClient=$,this.applicationEventService=q,this.engineRendererService=x,this.markerService=k,this.sceneService=A,this.contentInfoService=R,this.contentBlocksService=Z}listen(i,s){this.ngUnsubscribe||(this.ngUnsubscribe=new oe.B),he.native&&this.initNativeEventListeners(),this.initProcedures(),this.initEvents(),i&&s&&this.logAPIUsage(s)}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}logAPIUsage(i){setInterval(()=>{const r=this.rpcService.getAPILog(),a=(0,m.uniqBy)(r,l=>l.identifier);if(a.length>0){const l=JSON.stringify(a),_=this.analyticsService.buildDeveloperAnalytic(i,hs.Call,Rn.WidgetAPI,l);this.analyticsService.sendAnalytic(_).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe({next:d=>{},error:d=>{throw new Error(d)}}),this.rpcService.resetAPILog()}},1e4)}initEvents(){xo(this.rpcService,pe.HumanProgress,void 0,i=>i),function _7(n){return[{eventName:pe.HumanReady,aliasEvents:[pe.HumanStarted]},{eventName:pe.Error,aliasEvents:[pe.HumanError],mapFn:e=>e},{eventName:pe.HumanCanvasResized,aliasEvents:[pe.CanvasResized],mapFn:()=>n.selectSnapshot(U.getEnginePosition)}]}(this.store).forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function l7(){return[{eventName:pe.SceneLoaded,mapFn:n=>n},{eventName:pe.ScenePicked,aliasEvents:[pe.PickPicked],mapFn:IT},{eventName:pe.SceneObjectsSelected,mapFn:n=>n.selectedObjectsUpdate},{eventName:pe.SceneObjectsShown,mapFn:n=>n.enabledObjectsUpdate},{eventName:pe.SceneReady,aliasEvents:[pe.Started,pe.SceneReady]},{eventName:pe.SceneRestored,mapFn:()=>!0},{eventName:pe.SceneXrayEnabled,mapFn:()=>!0},{eventName:pe.SceneXrayDisabled,mapFn:()=>!0},{eventName:Ce.NativeShare,mapFn:n=>n},{eventName:Ce.NativeDebugMessage,mapFn:n=>n}]}().forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function zx(n){return[{eventName:pe.CameraUpdated,aliasEvents:[pe.CameraRested],mapFn:()=>Wf(n)}]}(this.cameraService).forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function p7(){return[{eventName:pe.TimelinePlaying,mapFn:n=>n},{eventName:pe.TimelineCompleted,mapFn:()=>!0},{eventName:pe.TimelineChapterTransition,mapFn:n=>({previousChapter:n.oldChapterIndex,currentChapter:n.newChapterIndex,time:n.time})}]}().forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),[].forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function b7(){return[{eventName:Ce.UIUpdated,mapFn:n=>UE(n)},{eventName:Ce.UIWindowUpdated,mapFn:n=>DT(n)}]}().forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function Z7(n,e){return[...R7(e),...W7(n),{eventName:Ce.LabelsChapterInfo,mapFn:o=>qT(e,o)},{eventName:Ce.LabelsCreated,mapFn:o=>fl(e,o)},{eventName:Ce.LabelsUpdated,mapFn:o=>fl(e,o)},{eventName:Ce.LabelsDestroyed,mapFn:o=>({labelId:o.id})},{eventName:Ce.LabelsEntered,mapFn:o=>o},{eventName:Ce.LabelsLeft,mapFn:o=>o},{eventName:Ce.LabelsPicked,mapFn:o=>o},{eventName:Ce.LabelsMoved,mapFn:o=>o},{eventName:Ce.LabelsEnabled,mapFn:()=>!0},{eventName:Ce.LabelsDisabled,mapFn:()=>!0},{eventName:Ce.LabelsShown,mapFn:o=>o},{eventName:Ce.LabelsHidden,mapFn:o=>o}]}(this.store,this.markerService).forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function a6(n){return[{eventName:Ce.QuizEntered,mapFn:()=>Sl(n)},{eventName:Ce.QuizExited,mapFn:()=>!0},{eventName:Ce.QuizQuestionLoaded,mapFn:e=>e},{eventName:Ce.QuizAnswerSelected,mapFn:e=>{const{questionId:o,answerId:i}=e;return{questionId:o,answerId:i,correctAnswerIds:_S(sS(n,e.questionId))}}},{eventName:Ce.QuizAnswerSubmitted,mapFn:e=>{const o=sS(n,e.questionId),i=_S(o);return{questionId:e.questionId,answerIds:e.answer,correctAnswerIds:i,correct:Tr(o,e.answer)}}},{eventName:Ce.QuizCompleted,mapFn:()=>Ly(oS(n),rS(n))}]}(this.store).forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function f6(){return[{eventName:Ce.WhiteboardDrawingStarted,mapFn:()=>!0},{eventName:Ce.WhiteboardDrawingFinished,mapFn:()=>!0},{eventName:Ce.WhiteboardModeUpdated,mapFn:n=>({mode:n})}]}().forEach(i=>{xo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)})}initProcedures(){(function d7(n,e,o,i){return[{procName:W.HumanInfo,actionFn:()=>({version:n,webglInfo:e.getWEBGLInfo(),apiFunctions:o.getAPIProcedureNames().sort(),apiEvents:o.getAPIEventNames().sort()})},{procName:W.HumanCanvasInfo,actionFn:()=>i.selectSnapshot(U.getEnginePosition)}]})(fs,this.engineService,this.rpcService,this.store).forEach(i=>{or(this.rpcService,i)}),c7(this.store,this.actions,this.engineService,this.paintService,this.cameraService,this.graphService,this.animationService,this.viewService,this.visibilityLayersService,this.legacyVisibilityLayersService,this.applicationEventService,this.engineRendererService,this.sceneService,this.contentInfoService,this.contentBlocksService).forEach(i=>{or(this.rpcService,i)}),function Wx(n,e){return[{procName:W.CameraInfo,actionFn:()=>Et(n).pipe((0,F.T)(()=>Wf(e)))},{procName:W.CameraOrbit,actionFn:o=>Et(n).pipe((0,F.T)(()=>(n.dispatch(new $b(void 0===o.pitch?0:o.pitch,void 0===o.yaw?0:o.yaw)),!0)))},{procName:W.CameraPan,actionFn:o=>Et(n).pipe((0,F.T)(()=>(n.dispatch(new jb(void 0===o.x?0:o.x,void 0===o.y?0:o.y,void 0===o.z?0:o.z)),!0)))},{procName:W.CameraReset,actionFn:()=>Et(n).pipe((0,At.Z)(()=>n.dispatch(new Rl)))},{procName:W.CameraSet,actionFn:o=>Et(n).pipe((0,F.T)(()=>{const i=o.animate||!1;if(o.objectId)return n.dispatch(new To(o.objectId,i,o.animationDuration)),!0;const s=Wf(e);return n.dispatch(new di({eye:o.position||s.position,look:o.target||s.target,up:o.up||s.up},i)),!0}))},{procName:W.CameraZoom,actionFn:o=>Et(n).pipe((0,F.T)(()=>(n.dispatch(new Sg(o||0)),!0)))},{procName:W.setCameraMode,actionFn:o=>(n.dispatch(new fd("pan"===o?"pan":"rotate")),!0)},{procName:W.CameraDisableChapterCamera,actionFn:()=>(n.dispatch(new md(!1)),!0)},{procName:W.CameraEnableChapterCamera,actionFn:()=>(n.dispatch(new md(!0)),!0)}]}(this.store,this.cameraService).forEach(i=>{or(this.rpcService,i)}),function g7(n,e,o){return[{procName:W.TimelineQuery,actionFn:()=>({chapters:n.selectSnapshot(E.getStoryChapters).map(s=>({description:s.description,displayName:s.displayName,annotations:s.labels.map(_=>({title:_.title,description:_.description}))}))}),hideDefinition:!0},{procName:W.TimelineInfo,actionFn:()=>Et(n).pipe((0,F.T)(([i])=>function u7(n,e,o){const i=o.getChapterTimeFrame();return{time:o.getTime(),startTime:i.firstTime,endTime:i.lastTime,chapters:e.map(s=>s.id),playing:o.isPlaying(),playbackSpeed:NT(n)}}(n,i,e)))},{procName:W.TimelinePlay,actionFn:i=>sr(n).pipe((0,At.Z)(()=>{const s=e.getGlobalTime(),r=i.time??s,a=i.loop??!1;let l=i.chapterId;return void 0===l&&(l=e.mapGlobalTimeToChapterId(r)),new f.c(_=>{n.selectSnapshot(U.getChapter)!==l&&n.dispatch(new kl(l)),n.select(U.getChapter).pipe((0,X.p)(u=>u===l),(0,Vt.s)(1)).subscribe(()=>function d(){if(r!==s){const u=(0,ee.clamp)(e.mapChapterGlobalTime(l,i.time),0,e.getChapterDuration());e.pause(),e.scrub(u)}e.setAnimationLoop(a),e.play(),_.next(!0),_.complete()}())})}))},{procName:W.TimelinePause,actionFn:()=>Et(n).pipe((0,F.T)(()=>(e.pause(),!0)))},{procName:W.TimelineSet,actionFn:i=>sr(n).pipe((0,At.Z)(()=>{if(void 0===i.time&&void 0===i.chapterId)return(0,Qe.of)(!0);let s=i.chapterId;void 0===s&&(s=e.mapGlobalTimeToChapterId(i.time));const r=n.selectSnapshot(U.getChapter)!==s;return new f.c(a=>{function l(){let _=i.time??0;_=(0,ee.clamp)(e.mapChapterGlobalTime(s,_),0,e.getChapterDuration()),e.pause(),e.scrub(_),a.next(!0),a.complete()}r?(n.select(U.getChapter).pipe((0,X.p)(_=>_===s),(0,Vt.s)(1)).subscribe(()=>l()),n.dispatch(new kl(s))):l()})}))},{procName:W.TimelineSetPlaybackSpeed,actionFn:i=>sr(n).pipe((0,F.T)(()=>"number"==typeof i&&(n.dispatch(new Ml(i)),!0)))},{procName:W.TimelineGetPlaybackSpeed,actionFn:()=>sr(n).pipe((0,F.T)(()=>NT(n)))},{procName:W.TimelineNext,actionFn:()=>sr(n).pipe((0,F.T)(()=>(o.nextChapter("API"),!0)))},{procName:W.TimelinePrev,actionFn:()=>sr(n).pipe((0,F.T)(()=>(o.previousChapter("API"),!0)))}]}(this.store,this.animationService,this.viewService).forEach(i=>{or(this.rpcService,i)}),function m7(n){return[{procName:W.InputEnable,actionFn:()=>(n.dispatch(new tt(!0)),!0)},{procName:W.InputDisable,actionFn:()=>(n.dispatch(new tt(!1)),!0)}]}(this.store).forEach(i=>{or(this.rpcService,i)}),function y7(n,e,o,i){const s=new He.t(!1);return e.pipe((0,c.rM)(Dl)).subscribe(()=>{s.next(!0)}),[{procName:W.UIGetBackground,actionFn:()=>Et(n).pipe((0,F.T)(()=>function f7(n){const{colors:e,gradientType:o,colorStops:i}=n;return{colors:Array.isArray(e)?[[e[0],e[1],e[2],e[3]],[e[4],e[5],e[6],e[7]]]:[[0,0,0,0],[0,0,0,0]],gradientType:o,colorStops:i}}(n.selectSnapshot(E.getSelectedChapterBackground))))},{procName:W.UISetBackground,mapFnIn:r=>{const{colors:a,colorStops:l,gradientType:_}=r;return{colors:a&&RT(a),gradientType:_,colorStops:l}},actionFn:r=>Et(n).pipe((0,F.T)(()=>{if(r){const a=kT(n,r);n.dispatch(new dy(a))}return!0}))},{procName:W.UIPresetBackground,mapFnIn:r=>{const{colors:a,colorStops:l,gradientType:_}=r;return{colors:a&&RT(a),gradientType:_,colorStops:l}},actionFn:r=>{if(r){const a=kT(n,r);he.platform===ro.SDK&&s.next(!1),s.pipe((0,X.p)(l=>!!l),(0,Vt.s)(1)).subscribe(()=>{n.dispatch(new Ed(a))})}return!0}},{procName:W.UIGetWorldPosition,actionFn:r=>Et(n).pipe((0,F.T)(()=>{const{worldPos:a}=o.pick(r.x,r.y);if(a){const{0:l,1:_,2:d}=a;return{x:l,y:_,z:d}}return null}))},{procName:W.UISetOndemand,actionFn:r=>(n.dispatch([new D.ToggleWindow(en.OnDemand,r.enabled)]),!0)},{procName:W.UISetLoadingExperience,actionFn:r=>((0,m.isEmpty)(r)?n.dispatch([new D.SetInteractType(Ds.None),new D.CloseWindow(en.Interact)]):n.dispatch([new D.SetInteractType(r),new D.OpenWindow(en.Interact)]),!0)},{procName:W.UISetScrollCaptureMode,actionFn:r=>(n.dispatch(new sd(r)),!0)},{procName:W.UISetTutorial,actionFn:r=>(n.dispatch([new D.ToggleWindow(en.Tutorial,r.enabled),new D.StartTutorial(r.enabled)]),!0)},{procName:W.UIGetWindow,actionFn:()=>DT(n.selectSnapshot(P.getOpenWindow))},{procName:W.UIGetDisplay,actionFn:()=>Et(n).pipe((0,F.T)(()=>UE(n.selectSnapshot(ue.getUI))))},{procName:W.UISetDisplay,actionFn:r=>{const a=function YP(n){const e=null!=n.all?jE(n.all):new Ka;return Br({all:n.all,startingColumn:n.startingColumn,fadeout:n.fadeout,drawerExpanded:n.infoExpand,logoIsHyperLink:void 0,[h.AnatomyLabels]:Nt(n.anatomyLabels,n.anatomyLabels),[h.Audio]:n.audio,[h.Camera]:Nt(n.nav,n.cameraMode,n.center,n.zoomIn,n.zoomOut,n.nav),[h.Column]:Nt(n.info,n.info),[h.ContextActions]:n.contextActions,[h.Drawer]:Nt(n.info,n.info),[h.Fullscreen]:Nt(n.fullscreen,n.fullscreen),[h.Help]:Nt(n.help,n.help),[h.LabelList]:Nt(n.labelList,n.labelList),[h.Labels]:void 0,[h.Layout]:n.layout,[h.Legend]:n.legend,[h.Logo]:n.logo,[h.Loader]:mp(n.loader),[h.Media]:$m(n.playPause,Nt(n.scrubber,n["scrubber.chapters"]),n.media),[h.NodeAudio]:n.anatomyPronunciations,[h.NodeInfo]:n.anatomyDescriptions,[h.Pagination]:Nt(n.tour,n["tour.chapters"]),[h.Playthrough]:Nt(n.playthrough,n.autoplay),[h.QuizPrompt]:n["ui-quiz"],[h.Search]:Nt(n.objectTree,n.search),[h.TitleOnly]:Nt(n.info,n.info),[h.ToggleLabels]:void 0,[h.Toolbar]:Nt(n.toolbar,n.menu),[h.Tools]:Nt(n.tools,n.tools),[h.Tutorial]:void 0,[h.Undo]:Nt(n.reset,n.undo),[h.VisibilityLayers]:n.visibilityLayers,[h.VisibilityLayersMode]:fp(n.visibilityLayersMode,n.skinLayers),[h.SkinLayers]:Nt(n.skinLayers),[h.Whiteboard]:n.whiteboard},e)}(r);return n.dispatch(new Zt(a)),r}},{procName:W.UIResetDisplay,actionFn:()=>{const r=n.selectSnapshot(ue.getInitialUI);n.dispatch(new Tn.SetUI(r))}},{procName:W.UISetQuizLock,actionFn:r=>(e.pipe((0,c.xi)(Wu),(0,Vt.s)(1)).subscribe(()=>{n.dispatch(new Te.SetQuizLocked(r)),n.dispatch(new Te.SetEnableQuizRetake(r)),!0===r&&i.startQuiz()}),!0)},{procName:W.UISnapshot,aliases:[W.SceneSnapshot],actionFn:r=>Et(n).pipe((0,At.Z)(()=>{const{width:a,height:l}=o.getCanvas();r={width:a,height:l,openInTab:!1,fileType:"jpeg",quality:.92,...r};const{width:_,height:d,openInTab:p,fileType:u}=r,g=n.selectSnapshot(E.getSelectedChapterId),y={width:_,height:d},C="jpeg"===u?Gi.JPEG:Gi.PNG,O=n.selectSnapshot(E.getSelectedChapterBackground);return n.dispatch(new Cr(g,O,C,.92,y,"original",!0,!0)).pipe((0,At.Z)(()=>e.pipe((0,c.xi)(Pa),(0,Vt.s)(1))),(0,At.Z)(L=>po.blobToBase64(L.blob)),(0,qo.M)(L=>{p&&L&&function S7(n){const e=window.open("","_blank");if(e){const o=e.document.createElement("img");o.src=n,e.document.body.appendChild(o)}}(L)}),(0,pi.W)(()=>(0,Qe.of)(null)))}))}]}(this.store,this.actions,this.engineRendererService,this.quizService).forEach(i=>{or(this.rpcService,i)}),function e6(n,e,o,i,s,r){return[...k7(n,e,i,s),...X7(n,e,i),{procName:W.LabelsInfo,actionFn:a=>Et(n).pipe((0,F.T)(()=>a.length>0?nS(n,a):n.selectSnapshot(ye.getChapterLabels))),mapFnOut:a=>qT(i,a)},{procName:W.LabelsCreate,actionFn:a=>Et(n).pipe((0,F.T)(()=>{if(a.labelId&&ml(n,a.labelId))return null;if(!a.objectId)return console.log("attempt to create a label with no objectId."),null;const l=function H7(n,e,o){const i=e.makeDefaultStudioLabel();i.id=o.labelId||An.idWithPrefix("label"),i.objectId=o.objectId,i.pos=o.position,i.renderableIndex=0,i.occludable=!!o.position,i.flyTo=!0,i.description="",i.shown=!0;const s=n.selectSnapshot(E.getSelectedChapter);return s?(i.chapterId=s.id,YT(i,o)):null}(n,e,a);return iS(n,l,!0)})),mapFnOut:a=>fl(i,a)},{procName:W.LabelsUpdate,actionFn:a=>Et(n).pipe((0,F.T)(()=>{let l=null;return ml(n,a.labelId)&&(l=function Q7(n,e){return YT(ml(n,e.labelId),e)}(n,a),iS(n,l,!1)),l})),mapFnOut:a=>fl(i,a)},{procName:W.LabelsCanvasUpdate,actionFn:a=>Et(n).pipe((0,F.T)(()=>{let l=null;return ml(n,a.labelId)&&(l=function Y7(n,e,o,i){const s=ml(n,i.labelId),r=i.canvasPosition,a=e.pick(r[0],r[1]);return a&&a.objectId?(s.objectId=a.objectId,s.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],s.offset=[s.hideWire?20:32,0],s.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],s.primitiveIndex=a.triIndex,s.renderableIndex=a.renderableIndex||0,s.dir=o.getDirection(a),s):null}(n,o,r,a),l&&iS(n,l,!1)),l})),mapFnOut:a=>fl(i,a)},{procName:W.LabelsDestroy,actionFn:a=>Et(n).pipe((0,F.T)(()=>{const l=ml(n,a);return l?(n.dispatch(new Va(l)),{labelId:l.id}):null}))},{procName:W.LabelsShow,actionFn:a=>Et(n).pipe((0,F.T)(()=>(a.length>0?n.dispatch(new os(nS(n,a),!0)):HT(n,!0),!0)))},{procName:W.LabelsHide,actionFn:a=>Et(n).pipe((0,F.T)(()=>(a.length>0?n.dispatch(new os(nS(n,a),!1)):HT(n,!1),!0)))},{procName:W.LabelsSetEnabled,aliases:[W.AnnotationsSetEnabled],actionFn:a=>{n.dispatch(new Sa(a.enable))},hideDefinition:!0},{procName:W.LabelsSetScale,actionFn:a=>{n.dispatch(new xd(a.scale))}}]}(this.store,this.labelsService,this.engineRendererService,this.markerService,this.sceneService,this.cameraService).forEach(i=>{or(this.rpcService,i)}),function l6(n,e){function o(i){return n.selectSnapshot(G.getQuizModeActive)?i():{error:"quiz mode is not active"}}return[{procName:W.QuizInfo,actionFn:()=>Et(n).pipe((0,F.T)(()=>n.selectSnapshot(G.hasQuiz)?Sl(n):null))},{procName:W.QuizSubmit,actionFn:i=>Et(n).pipe((0,F.T)(()=>o(()=>(e.submitQuestion(i.questionId,i.answerIds),Sl(n)))))},{procName:W.QuizQuestion,actionFn:()=>o(()=>Et(n).pipe((0,F.T)(()=>lS(n))))},{procName:W.QuizEnter,actionFn:()=>Et(n).pipe((0,F.T)(()=>n.selectSnapshot(G.hasQuiz)?(e.startQuiz(),!0):{error:"quiz not found"}))},{procName:W.QuizExit,actionFn:()=>Et(n).pipe((0,F.T)(()=>(e.exitQuiz(),!0)))},{procName:W.QuizSelectQuestion,actionFn:i=>o(()=>(n.dispatch(new Te.SetActiveQuestion(i)),Sl(n)))},{procName:W.QuizNextQuestion,actionFn:()=>Et(n).pipe((0,F.T)(()=>o(()=>(e.nextQuestion(),lS(n)))))},{procName:W.QuizPreviousQuestion,actionFn:()=>Et(n).pipe((0,F.T)(()=>o(()=>(n.dispatch(new Te.SetQuizLifecycle(_o.Question)),n.dispatch(new Te.PreviousQuestion),lS(n)))))},{procName:W.QuizReset,actionFn:()=>Et(n).pipe((0,F.T)(()=>(e.resetQuiz(),Sl(n))))},{procName:W.QuizSet,actionFn:i=>Et(n).pipe((0,F.T)(()=>{const{settings:s,startNumber:r,endNumber:a,locked:l}=i;if(!(0,m.isNil)(s)){const d=n.selectSnapshot(G.getQuizSettings);n.dispatch(new Te.SetQuizSettings({...d,...s}))}if("number"==typeof r||"number"==typeof a){const p=Ry(n.selectSnapshot(E.getStoryChapters)),y=p.slice("number"==typeof r?r-1:0,"number"==typeof a?a:p.length);n.dispatch(new Te.SetQuestions(y))}return"boolean"==typeof l&&n.dispatch(new Te.SetQuizLocked(l)),n.dispatch(new Te.SetQuizQuestionsMode("number"==typeof r&&"number"==typeof a?"restricted":"all")),Sl(n)}))}]}(this.store,this.quizService).forEach(i=>{or(this.rpcService,i)})}initNativeEventListeners(){this.applicationEventService.getEvent(Ce.NativeSetBaseDirectory).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{window.localBaseDirectory=i}),this.applicationEventService.getEvent(Ce.NativeSetSdkOffline).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{window.sdkOffline=!0===i})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(c.il),t.KVO(c.En),t.KVO(Pi),t.KVO(Lt),t.KVO(bi),t.KVO(Mr),t.KVO(fr),t.KVO(lo),t.KVO(zt),t.KVO(pS),t.KVO(_s),t.KVO(cs),t.KVO(Za),t.KVO(uS),t.KVO(m6),t.KVO(mo),t.KVO(ws),t.KVO(Xl),t.KVO(cn),t.KVO(ph),t.KVO(Ar))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var tC=function(n){return n.Auth="auth",n}(tC||{});class nC{}var rr,gS,$o=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},tn=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const b6={authenticated:!1,bypassAnalytics:!1,activeRequests:new Set,loggedInteractions:{init:!1,view:!1,interactionc:!1,interactionf:!1,call:!1}};let Ki=(gS=rr=class{static isAuthenticated(e){return e.authenticated}static isFirstInteractionLogged(e){return e.loggedInteractions.interactionf}authorizeAnalyticId(e){const{activeRequests:o}=e.getState();if(!o.has(hs.Init)){const i=this.store.selectSnapshot(Qt.getWidgetState),{embedded:s,userType:r,widgetUrlConfig:a}=i,l=a["bypass-analytics"];let _;e.patchState({bypassAnalytics:l}),!s||he.native||l?e.patchState({authenticated:!0}):(_=r===ni.User?this.analyticsService.getAnalytic(a.uaid):this.analyticsService.sendAnalytic(this.analyticsService.buildDeveloperAnalytic(i,hs.Init,Rn.WidgetAPI,this.analyticsService.buildAppActivityData(i))),o.add(hs.Init),e.patchState({activeRequests:o}),_.pipe((0,Ye.j)(()=>{o.delete(hs.Init),e.patchState({activeRequests:o})})).subscribe(d=>{const p=d.success;e.patchState({authenticated:p}),e.dispatch(p?new Hx(r,d):new CT(r,d))}))}}logInteraction(e,{interaction:o,source:i}){const{activeRequests:s}=e.getState();if(!s.has(o)){const r=this.store.selectSnapshot(Qt.getWidgetState),l=r.userType===ni.User?this.analyticsService.buildUserAnalytic(r,o,i):this.analyticsService.buildDeveloperAnalytic(r,o,Rn.Widget,this.analyticsService.buildAppActivityData(r));s.add(o),e.patchState({activeRequests:s}),this.analyticsService.sendAnalytic(l).pipe((0,Ye.j)(()=>{s.delete(o),e.patchState({activeRequests:s})})).subscribe(_=>{e.dispatch(_.success?new Xf(o,_):new Qx(o,_))})}}logInteractionSuccess(e,o){const{loggedInteractions:i}=e.getState();i[o.interaction]=!0,e.patchState({loggedInteractions:i})}initView(e){const o=["interactive","complete"].includes(document.readyState),i=o?(0,Qe.of)(o):(0,hn.R)(document,"DOMContentLoaded");this.store.select(gS.isAuthenticated).pipe((0,uT.U)(i),(0,X.p)(s=>!0===s),(0,Vt.s)(1)).subscribe(()=>{e.getState().bypassAnalytics||this.store.dispatch(new N_(hs.View))})}logInteractionChance(e){const o=e.getState();!o.loggedInteractions.interactionc&&!o.bypassAnalytics&&e.dispatch(new N_(hs.ChanceInteraction))}logFirstInteraction(e){e.getState().loggedInteractions.interactionf||e.dispatch([new Hf,new N_(hs.FirstInteraction)])}resetFirstInteraction(e){const o=e.getState().loggedInteractions;o.interactionf=!1,e.patchState({loggedInteractions:o})}constructor(e,o){this.store=e,this.analyticsService=o}ngxsOnInit(e){e.dispatch(new OT)}},rr.\u0275fac=function(e){return new(e||rr)(t.KVO(c.il),t.KVO(pS))},rr.\u0275prov=t.jDH({token:rr,factory:rr.\u0275fac}),rr);$o([(0,c.rc)(TT),tn("design:type",Function),tn("design:paramtypes",[Object]),tn("design:returntype",void 0)],Ki.prototype,"authorizeAnalyticId",null),$o([(0,c.rc)(N_),tn("design:type",Function),tn("design:paramtypes",[Object,N_]),tn("design:returntype",void 0)],Ki.prototype,"logInteraction",null),$o([(0,c.rc)(Xf),tn("design:type",Function),tn("design:paramtypes",[Object,Xf]),tn("design:returntype",void 0)],Ki.prototype,"logInteractionSuccess",null),$o([(0,c.rc)(OT),tn("design:type",Function),tn("design:paramtypes",[Object]),tn("design:returntype",void 0)],Ki.prototype,"initView",null),$o([(0,c.rc)(Hf),tn("design:type",Function),tn("design:paramtypes",[Object]),tn("design:returntype",void 0)],Ki.prototype,"logInteractionChance",null),$o([(0,c.rc)(wT),tn("design:type",Function),tn("design:paramtypes",[Object]),tn("design:returntype",void 0)],Ki.prototype,"logFirstInteraction",null),$o([(0,c.rc)(MT),tn("design:type",Function),tn("design:paramtypes",[Object]),tn("design:returntype",void 0)],Ki.prototype,"resetFirstInteraction",null),$o([(0,c.MD)(),tn("design:type",Function),tn("design:paramtypes",[nC]),tn("design:returntype",void 0)],Ki,"isAuthenticated",null),$o([(0,c.MD)(),tn("design:type",Function),tn("design:paramtypes",[nC]),tn("design:returntype",void 0)],Ki,"isFirstInteractionLogged",null),Ki=gS=$o([(0,c.Uw)({name:"modules",defaults:b6}),tn("design:paramtypes",[c.il,pS])],Ki);const y6=new Set([W.CameraOrbit,W.CameraPan,W.CameraReset,W.CameraSet,W.CameraZoom,W.LabelsCreate,W.LabelsDestroy,W.LabelsHide,W.LabelsShow,W.LabelsUpdate,W.QuizEnter,W.QuizExit,W.QuizSubmit,W.QuizNextQuestion,W.QuizPreviousQuestion,W.QuizReset,W.QuizSet,W.SceneColorObject,W.ScenePick,W.SceneReset,W.SceneRestore,W.SceneSelectObjects,W.SceneSetLayersSliderPosition,W.SceneShowObjects,W.SceneTransformObject,W.SceneUncolorObject,W.TimelineNext,W.TimelinePause,W.TimelinePlay,W.TimelinePrev,W.TimelineSet,W.UISnapshot]);var R_,iC=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},oC=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const v6=["logoElRef"];function E6(n,e){1&n&&(t.qex(0),t.nrm(1,"img",3,0),t.bVm())}class su{constructor(e){this.renderer=e,this.siteHeaderType=$s,this.ngUnsubscribe=new oe.B}ngAfterViewInit(){this.initLogoListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLogoListener(){(0,Tt.z)([this.headerLogoConfig$,this.siteHeader$]).pipe((0,X.p)(([e,o])=>!(0,m.isNil)(e)),(0,Pn.B)(0),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e])=>{const o=this.logoElRef.nativeElement,{logo_url:i}=Hg(e,"full","color");this.renderer.setAttribute(o,"src",i),this.renderer.setAttribute(o,"alt",$localize`Team Logo`),this.renderer.setAttribute(o,"aria-label",$localize`Team Logo`)})}}(R_=su).\u0275fac=function(e){return new(e||R_)(t.rXU(t.sFG))},R_.\u0275cmp=t.VBU({type:R_,selectors:[["app-viewer-header"]],viewQuery:function(e,o){if(1&e&&t.GBs(v6,5),2&e){let i;t.mGM(i=t.lsd())&&(o.logoElRef=i.first)}},decls:3,vars:4,consts:[["logoElRef",""],[1,"viewer-header",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"viewer-header__logo"]],template:function(e,o){1&e&&(t.j41(0,"div",1),t.nI1(1,"async"),t.DNE(2,E6,3,0,"ng-container",2),t.k0s()),2&e&&(t.Y8G("ngSwitch",t.bMT(1,2,o.siteHeader$)),t.R7$(2),t.Y8G("ngSwitchCase",o.siteHeaderType.Logo))},dependencies:[b.ux,b.e1,b.Jj],styles:[".viewer-header[_ngcontent-%COMP%]{background-color:#fff;border-bottom:1px solid #d7e0ea;display:flex;flex-direction:row;align-items:center;justify-content:center;height:var(--header-height)}.viewer-header__logo[_ngcontent-%COMP%]{min-height:20px;max-height:calc(var(--header-height) * .5);height:auto;width:auto;max-width:calc(100% - 32px)}"],changeDetection:0}),iC([(0,c.l6)(uo.getHeaderLogoConfig),oC("design:type",f.c)],su.prototype,"headerLogoConfig$",void 0),iC([(0,c.l6)(Kt.getSiteHeader),oC("design:type",f.c)],su.prototype,"siteHeader$",void 0);var k_,D_=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},L_=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const T6=["widgetElRef"];function C6(n,e){if(1&n&&(t.j41(0,"div",5),t.nI1(1,"async"),t.nrm(2,"app-viewer-header"),t.k0s()),2&n){const o=t.XpG();t.Y8G("ngSwitch",t.bMT(1,1,o.siteHeader$))}}function O6(n,e){1&n&&t.nrm(0,"div",6)}const w6=ZS().direction;document.dir=w6;class la{constructor(e,o,i,s,r,a,l,_,d,p,u,g,y){this.document=e,this.store=o,this.actions=i,this.activatedRoute=s,this.widgetAPIHandler=r,this.errorService=a,this.engineService=l,this.cameraService=_,this.storageService=d,this.renderer=p,this.viewService=u,this.quizService=g,this.rpcService=y,this.siteHeaderType=$s,this.title="Biodigital Human",this.environmentApplication=bt,this.environmentPlatform=ro,this.ngUnsubscribe=new oe.B,this.firstInteractionLogged$=this.store.select(Ki.isFirstInteractionLogged).pipe((0,X.p)(C=>C))}ngOnInit(){this.initErrorHandling(),this.initAnalytics();const{data:e}=this.activatedRoute.snapshot,o=e.widgetUrlConfig;this.initWidgetBreakpoints(o),this.initWidgetLabelScale(o),this.initWidgetLayout(o),this.initWidgetSetup(o),this.initFadeout(o),this.initStartingColumn(o),this.initStartingTool(o),this.initCustomWidgetSettings(o.paid),this.store.dispatch(new TT),this.initBackgroundFromWidget(o),this.initBackgroundFromChapter(),this.initCamera(o),this.initRotation(o),this.initQuizInteractions(o),this.widgetAPIHandler.listen(he.deploy===En.Production),this.initChaptersReadyListener(),this.initHumanReadyListener(),this.initDynamicLayout()}ngAfterViewInit(){this.initHeaderAndFooter()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWidgetSetup(e){const o=window!==window.top,i=o?BD_DOCUMENT_REFERRER:window.location.href;this.store.dispatch(new ke(i,o,e));const s=this.store.selectSnapshot(ue.getUI),r=VE(e),a=xE(s,r);this.store.dispatch(new Tn.SetUI(a)),this.store.dispatch(new Tn.SetInitialUI(a));const l=function JP(n){return n["disable-scroll"]?As.DoNotCapture:n["disable-scroll.alert"]||n["disable-scroll.overlay"]?As.DoNotCaptureShowMessage:As.Capture}(e);this.store.dispatch(new sd(l));const _=function ZP(n){return!0===n["ui-print-image"]}(e),d=function t2(n){return!1===n["auto-load"]}(e);(function n2(n){return!0===n["ui-poc-whiteboard"]})(e)&&(this.viewService.toggleWhiteboard(!0),this.store.dispatch(new D.SetWhiteboardLocked(!0)));const{interactType:p,isInteractActive:u}=function e2(n,e,o){const i=n["initial.play"]||n.initial||n["initial.button"]||n["initial.hand"]||n["initial.hand-hint"]||n["initial.summary"]||e;return{interactType:(()=>{switch(!0){case n.initial:case n["initial.button"]:return Ds.Button;case n["initial.hand"]:case n["initial.hand-hint"]:return Ds.Hand;case n["initial.play"]:return Ds.Play;case n["initial.summary"]:return Ds.Summary;default:return o}})(),isInteractActive:i}}(e,this.store.selectSnapshot(P.shouldWindowOpen(en.Interact)),this.store.selectSnapshot(P.getInteractType)),g=this.storageService.getLocalItem(In.GettingStartedTutorial),y=!0===r.tutorial&&"true"!==g;this.store.dispatch([new D.SetOnDemand(d),new D.ToggleWindow(en.OnDemand,d),new D.SetInteractType(p),new D.ToggleWindow(en.Interact,u),new D.ToggleWindow(en.Tutorial,y),new D.StartTutorial(y),new D.SetUsePrintImage(_)]);const C=function i2(n){return!0===n["demo-mode"]}(e);this.store.dispatch(new lg(C))}initCustomWidgetSettings(e){he.offline||e&&(this.store.select(Qt.getWidgetSettings).pipe((0,X.p)(o=>!(0,m.isNil)(o)&&o.length>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{o.forEach(i=>{i.anatomy_description_fallback&&this.viewService.setAnatomyDescriptionFallback(i.anatomy_description_fallback);const s=i.group_logos;if(s){const r=s.viewer?.viewer_logo_setting;"logo_swap"===r?this.viewService.setViewLogos(s):"logo_cobranding"===r&&(this.viewService.setHeaderLogos(s),this.store.dispatch(new fn.SetHeader($s.Logo)))}})}),this.store.dispatch(new Xn(e)))}initErrorHandling(){this.actions.pipe((0,c.xi)(cb),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentErrors()),this.actions.pipe((0,c.xi)(CT),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>this.handleAuthErrors(e))}initWidgetBreakpoints({"ui-collapse-label":e,"annotation-collapse":o}){const i=[e,o].find(s=>!(0,m.isNil)(s));(0,m.isNil)(i)||this.store.dispatch(new D.SetLabelBreakpoint(i))}initWidgetLabelScale({"label-scale":e}){(0,m.isNil)(e)||this.store.dispatch(new xd(e))}initWidgetLayout({"ui-layout":e}){(0,m.isNil)(e)||this.store.dispatch(new D.SetLayout(e))}initFadeout({"ui-fadeout":e}){!(0,m.isNil)(e)&&(0,m.isNumber)(e)&&this.store.dispatch(new D.SetFadeout(e))}initStartingColumn({"ui-starting-column":e}){(0,m.isNil)(e)||this.store.dispatch(new D.SetStartingColumn(e))}initStartingTool({"ui-starting-tool":e}){(0,m.isNil)(e)||this.store.dispatch(new D.SetStartingTool(e))}initQuizInteractions(e){const o=this.store.select(xe.getSelectedBookmark);(0,Tt.z)([this.store.select(G.hasQuiz),o]).pipe((0,X.p)(([i,s])=>!(0,m.isNil)(s)&&i),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(([i,s])=>{const r=this.store.selectSnapshot(G.getAllQuestions),l="true"==`${e["ui-quiz-locked"]}`,_=s.viewMode===ji.Quiz;this.store.dispatch(new Te.SetQuizLocked(l||_)),l&&this.store.dispatch(new Te.SetEnableQuizRetake(!1));const d=parseInt(e["ui-quiz-start"],10),p=parseInt(e["ui-quiz-end"],10),u=r.length,g=isNaN(d)?1:d,y=isNaN(p)?u:p;if(1!==g||y!==u){const L=r.filter(($,q)=>{const x=q+1;return x>=g&&x<=y});this.store.dispatch(new Te.SetQuestions(L))}const O=isNaN(d)&&isNaN(p)?"all":"restricted";this.store.dispatch(new Te.SetQuizQuestionsMode(O)),(l||_)&&setTimeout(()=>{this.quizService.startQuiz()})})}initAnalytics(){this.getIntersectionObserver(this.document.body,.75).pipe((0,Vt.s)(1)).subscribe(()=>{this.store.dispatch(new Hf)});const e=this.getDocumentInteraction(),o=this.rpcService.onResults().pipe((0,X.p)(i=>y6.has(i.procedureName)));(0,Ao.h)(e,o).pipe((0,Pn.B)(125),(0,w.Q)(this.firstInteractionLogged$),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new wT)})}initBackgroundFromWidget({background:e}){e&&(this.setWidgetTransparent(kd(e)),this.actions.pipe((0,c.rM)(Dl),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ed(e))}))}initBackgroundFromChapter(){this.store.select(E.getSelectedChapter).pipe((0,X.p)(e=>null!=e),(0,F.T)(e=>kd(e.background)),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.setWidgetTransparent(e)})}initCamera({camera:e}){e&&this.actions.pipe((0,c.xi)(ma),(0,Vt.s)(1),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new di(e,!1))})}initRotation({"load-rotate":e}){if(e){let o=performance.now();const i=this.store.select(E.getSelectedChapter),s=this.store.select(E.getSelectedChapterReadyState);(0,Fx.d)().pipe((0,el.E)(s),(0,X.p)(([,r])=>r?.model),(0,F.T)(()=>e*(performance.now()-o)*.001),(0,qo.M)(()=>o=performance.now()),(0,w.Q)(this.firstInteractionLogged$),(0,w.Q)(this.ngUnsubscribe)).subscribe(r=>{this.cameraService.rotateCameraStatic(0,r)}),this.firstInteractionLogged$.pipe((0,el.E)(i),(0,w.Q)(this.ngUnsubscribe)).subscribe(([,r])=>{const a=r?.camera?.location;a&&this.store.dispatch(new di(a,!0,2))})}}initHumanReadyListener(){this.actions.pipe((0,c.xi)(he.platform===ro.SDK?Wu:pb)).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.engineService.fireEvent(pe.Started,null)})}initChaptersReadyListener(){this.store.select(E.getAllChaptersModelsReady).pipe((0,X.p)(e=>!0===e),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new pb)})}initDynamicLayout(){(0,Tt.z)([this.store.select(Qt.getWidgetApiUIConfig),this.store.select(Qt.getWidgetUrlConfig),this.store.select(E.getSelectedChapter),this.store.select(G.getQuizModeActive),this.store.select(G.getActiveQuestion)]).pipe((0,X.p)(([e,o,i])=>null!=i&&null!=o),(0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o,i,s,r])=>{const a=VE(o),l=function qP(n){if(!n||!n.config)return null;const e=new Ka;return e[h.Column]=n.config.info,e[h.Drawer]=n.config.info,e[h.Fullscreen]=n.config.fullscreen,e[h.Search]=n.config.objectTree,e[h.Camera]=n.config.nav,e[h.Loader]=mp(n.config.loader),e[h.Whiteboard]=n.config.whiteboard,e[h.VisibilityLayers]=n.config.visibilityLayers,e[h.VisibilityLayersMode]=fp(n.config.visibilityLayersMode,n.config.skinLayers),e[h.SkinLayers]=n.config.skinLayers,e[h.ContextActions]=n.config.contextActions,e[h.Audio]=(0,m.isNil)(n.config.audio)?null:n.config.audio!==ri.None,e[h.Media]=$m(n.config.playPause,n.config.scrubber,n.config.mediaControls),e}(i.ui),_=function KP(n){const e=new Ka;return e.anatomyLabels=!1,e.labelList=!1,e.labels=!1,e.legend=!1,e.nodeInfo=!1,e.pagination=!1,e.search=!1,e.toggleLabels=!1,e.tools=n?.type===ot.SelectAnatomy,e.visibilityLayers=!1,e.whiteboard=!1,e}(r);this.viewService.setUI({apiUIConfig:e,urlUIConfig:a,chapterUIConfig:l,quizUIConfig:s?_:null})})}initHeaderAndFooter(){(0,Tt.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$]).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(([e,o])=>{const i=e<=Un.Medium?40:56,s=i;this.store.dispatch(new fn.SetHeaderHeight(i)),this.store.dispatch(new fn.SetFooterHeight(s));const r=this.widgetElRef.nativeElement;r.style.setProperty("--header-height",`${i}px`),r.style.setProperty("--footer-height",`${s}px`)})}handleContentErrors(){this.store.dispatch(new nd(null,null)),this.errorService.redirectToErrorPage(Hn.Content)}handleAuthErrors(e){he.deploy!==En.Local&&this.errorService.redirectToErrorPage(tC.Auth,e.response.errorCode)}getDocumentInteraction(){let e,o;return new f.c(i=>{e=new Jn.Manager(document.documentElement),e.add([new Jn.Tap({event:"singletap"}),new Jn.Tap({event:"doubletap",taps:2}),new Jn.Pan({event:"pan",direction:Jn.DIRECTION_ALL,threshold:0})]),o=()=>i.next(),e.on("panstart",o),e.on("singletap",o),document.documentElement.addEventListener("keypress",o),document.documentElement.addEventListener("focusin",o),document.documentElement.addEventListener("wheel",o)}).pipe((0,Ye.j)(()=>{e&&(e.destroy(),e=null),document.documentElement.removeEventListener("keypress",o),document.documentElement.removeEventListener("focusin",o),document.documentElement.removeEventListener("wheel",o)}),(0,w.Q)(this.ngUnsubscribe))}getIntersectionObserver(e,o){return new f.c(i=>{const r=new IntersectionObserver(a=>{a[0].intersectionRatio>=o&&(i.next(e),i.complete(),r.unobserve(e))},{root:null,threshold:o});r.observe(e)})}setWidgetTransparent(e){e?this.renderer.setStyle(document.body,"background","none transparent"):this.renderer.removeStyle(document.body,"background")}}(k_=la).\u0275fac=function(e){return new(e||k_)(t.rXU(b.qQ),t.rXU(c.il),t.rXU(c.En),t.rXU(ut.nX),t.rXU(S6),t.rXU(El),t.rXU(Lt),t.rXU(Pi),t.rXU(Le),t.rXU(t.sFG),t.rXU(zt),t.rXU(Za),t.rXU(uS))},k_.\u0275cmp=t.VBU({type:k_,selectors:[["app-widget-master"]],viewQuery:function(e,o){if(1&e&&t.GBs(T6,7),2&e){let i;t.mGM(i=t.lsd())&&(o.widgetElRef=i.first)}},decls:7,vars:6,consts:[["widgetElRef",""],[1,"widget","theme-light"],["class","widget__header",3,"ngSwitch",4,"ngIf"],[1,"widget__body"],["class","widget-shell",4,"appFlagApplication","appFlagApplicationPlatform","appFlagApplicationMode"],[1,"widget__header",3,"ngSwitch"],[1,"widget-shell"]],template:function(e,o){1&e&&(t.j41(0,"div",1,0),t.DNE(2,C6,3,3,"div",2),t.nI1(3,"async"),t.j41(4,"div",3),t.nrm(5,"router-outlet"),t.k0s()(),t.DNE(6,O6,1,0,"div",4)),2&e&&(t.R7$(2),t.Y8G("ngIf",t.bMT(3,4,o.siteHeader$)===o.siteHeaderType.Logo),t.R7$(4),t.Y8G("appFlagApplication",o.environmentApplication.All)("appFlagApplicationPlatform",o.environmentPlatform.SDK)("appFlagApplicationMode","exclude"))},dependencies:[b.bT,b.ux,ut.n3,Ep,su,b.Jj],styles:[".widget[_ngcontent-%COMP%]{--header-height: 56px;--footer-height: 56px;position:fixed;inset:0;display:flex;flex-direction:column;height:100vh;overflow:hidden}.widget__header[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.widget-shell[_ngcontent-%COMP%]{pointer-events:none;position:fixed;inset:0;z-index:99999;box-shadow:inset 0 0 0 1px #d7e0ea}"]}),D_([(0,c.l6)(Qt.getBypassAnalytics),L_("design:type",f.c)],la.prototype,"bypassAnalytics$",void 0),D_([(0,c.l6)(Kt.getSiteHeader),L_("design:type",f.c)],la.prototype,"siteHeader$",void 0),D_([(0,c.l6)(mn.getHorizontalBreakpoint),L_("design:type",f.c)],la.prototype,"horizontalBreakpoint$",void 0),D_([(0,c.l6)(mn.getVerticalBreakpoint),L_("design:type",f.c)],la.prototype,"verticalBreakpoint$",void 0),D_([(0,c.l6)(Qt.getEmbedded),L_("design:type",f.c)],la.prototype,"embedded$",void 0);const M6={title:"We're unable to find the model you're looking for.",description:'Please check your URL or visit the <a href="/" target="_blank">BioDigital Human</a> to see what\'s available in our 3D model library.'},I6={title:"Your BioDigital Human embed requires proper authentication.",description:""},A6={[dS.InvalidUAID]:{title:"Authentication Issues",description:"Your Human Widget has invalid user credentials.",url:"https://support.biodigital.com"}};function P6(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",13),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleSeeDetailsClick())}),t.EFF(1," See Details "),t.k0s()}}function N6(n,e){if(1&n&&(t.j41(0,"textarea",14),t.EFF(1,"        "),t.k0s()),2&n){const o=t.XpG(2);t.Y8G("value",o.engineErrorReport)}}function R6(n,e){if(1&n){const o=t.RV6();t.j41(0,"div")(1,"h1",3),t.EFF(2,"The BioDigital Human encountered an error."),t.k0s(),t.j41(3,"h2",4),t.EFF(4," Error: "),t.j41(5,"span",5),t.EFF(6),t.k0s()(),t.j41(7,"div",6),t.EFF(8," To receive assistance with this error, please follow these steps: "),t.k0s(),t.j41(9,"ol",7)(10,"li",8)(11,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleDownloadClick())}),t.EFF(12," Download "),t.k0s(),t.EFF(13," the error report. "),t.k0s(),t.j41(14,"li",8)(15,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleActionClick(s.supportURL))}),t.EFF(16," Share the report "),t.k0s(),t.EFF(17," with the customer support team. "),t.k0s()(),t.j41(18,"div",10),t.DNE(19,P6,2,0,"button",11),t.j41(20,"div"),t.DNE(21,N6,2,1,"textarea",12),t.k0s()()()}if(2&n){const o=t.XpG();t.R7$(6),t.JRh(o.engineErrorMessage),t.R7$(13),t.Y8G("ngIf",!o.viewEngineErrorDetails),t.R7$(2),t.Y8G("ngIf",o.viewEngineErrorDetails)}}function k6(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",3),t.EFF(1),t.k0s(),t.j41(2,"div",15),t.qex(3),t.j41(4,"button",9),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleActionClick(s.supportURL))}),t.EFF(5," Contact Support "),t.k0s(),t.bVm(),t.k0s(),t.nrm(6,"div",16)}if(2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.title," "),t.R7$(5),t.Y8G("innerHTML",o.description,t.npT)}}const sC=[{path:"",component:la,resolve:{widgetUrlConfig:zf},children:[{path:"",component:Fe},{path:"error",component:(()=>{var n;class e{handleSeeDetailsClick(){this.viewEngineErrorDetails=!0}get title(){return this.errorConfig.title}get description(){return this.errorConfig.description}constructor(i,s,r){this.router=i,this.snackBar=s,this.engineService=r,this.supportURL="https://support.biodigital.com",this.isEngineError=!1,this.viewEngineErrorDetails=!1;const{errorType:a,errorCode:l,error:_,errorUrl:d}=this.router.getCurrentNavigation().extras.state;this.errorType=a,this.errorUrl=d,this.errorCode=l,this.error=_}ngOnInit(){if(this.errorType===Hn.Engine){this.isEngineError=!0;const i={contentId:this.errorUrl,error:this.error,webglInfo:this.engineService.getWEBGLInfo()};this.engineErrorMessage=i.error.message,this.engineErrorReport=JSON.stringify(i,null,2)}else this.errorConfig=this.errorType===Hn.Content?M6:A6[this.errorCode]||I6}handleDownloadClick(){(0,Dd.saveAs)(new Blob([this.engineErrorReport],{type:"text/plain"}),"BioDigital_Error_Report.txt")}handleActionClick(i){window.open(i)||this.snackBar.open("Unable to open link in new window, please check your pop-up settings.")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(ut.Ix),t.rXU(ho.UG),t.rXU(Lt))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-error-page"]],decls:4,vars:2,consts:[["notEngineError",""],[1,"error"],[4,"ngIf","ngIfElse"],[1,"text-2xl","font-bold"],[1,"text-base","mt-4","mb-8"],[1,"font-semibold"],[1,"text-base","mb-4"],[1,"text-base"],[1,"my-4"],["app-button","","buttonType","outline","buttonTheme","light",3,"click"],[1,"mt-8"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click",4,"ngIf"],["class","error__details mt-2",3,"value",4,"ngIf"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click"],[1,"error__details","mt-2",3,"value"],[1,"flex","items-start","mt-10"],[1,"error__description","text-base","mt-8",3,"innerHTML"]],template:function(i,s){if(1&i&&(t.j41(0,"div",1),t.DNE(1,R6,22,3,"div",2)(2,k6,7,2,"ng-template",null,0,t.C5r),t.k0s()),2&i){const r=t.sdS(3);t.R7$(),t.Y8G("ngIf",s.isEngineError)("ngIfElse",r)}},dependencies:[hi.Q,b.bT],styles:[".error[_ngcontent-%COMP%]{margin:0 auto;max-width:640px;display:flex;flex-direction:column;padding:40px;color:#283853}.error[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style:decimal}.error__details[_ngcontent-%COMP%]{width:100%;height:200px}.error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#283853}"],changeDetection:0}),e})()}]}],D6=!0===he.offline?ut.iI.forRoot(sC,{useHash:!0}):ut.iI.forRoot(sC);let L6=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({providers:[zf],imports:[D6,ut.iI]}),e})();var rt=S(5189),_t=S(5056),U6=S(7522),V6=S(9512),j6=S(7078),x6=S(583),G6=S(3649),$6=S(6030),F6=S(8138);[U6.A,V6.A,j6.A,x6.A,G6.A,$6.A,F6.A].forEach(n=>{(0,b.EO)(n)});let rC=(()=>{var n;class e{static forRoot(){return{ngModule:e,providers:[{provide:t.xe9,useFactory:eb},{provide:t.hnV,useFactory:K0,deps:[$e.Qq,t.xe9],multi:!0}]}}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD]}),e})();var aC=S(1488);class U_{}var ca,ci=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ze=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const lC="/viewer",cC={publishing:!1,widgetURL:lC,dimensions:rE.dimensions,minDimensions:{width:300,height:400},aspectRatio:{width:4,height:3}};let zn=((ca=class{static getDimensions(e){return e.dimensions}static getAspectRatio(e){return e.aspectRatio}static getMinDimensions(e){return e.minDimensions}static getWidgetURL(e){return e.widgetURL}static getPublishing(e){return e.publishing}setPublishWidgetURL(e,o){e.patchState({widgetURL:o.widgetURL||lC})}setPublishDimensions(e,o){e.patchState({dimensions:o.dimensions})}getPublishURL(e,o){const{model:i,camera:s,widgetOptions:r}=o,{widgetURL:a}=e.getState(),l=this.store.selectSnapshot(ne.getUserLanguage),_=this.store.selectSnapshot(ne.getSelectedUserApp),d=this.store.selectSnapshot(ve.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetURL(i,a,r,s,rc.Single,l,_,d).subscribe(p=>{e.dispatch(new Nm(i,p))},()=>{e.dispatch(new Rm(i))})}getPublishURLSuccess(e,o){this.vendorAnalyticsService.track("Publish - Success",{type:"url",source:"publish"})}getPublishURLFail(e,o){this.snackbar.open("Unable to generate URL.")}getPublishIFrame(e,o){const{model:i,camera:s,widgetOptions:r}=o,a=e.getState(),l=a.widgetURL,_=o.dimensions??a.dimensions,d=this.store.selectSnapshot(ne.getUserLanguage),p=this.store.selectSnapshot(ne.getSelectedUserApp),u=this.store.selectSnapshot(ve.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetEmbed(i,l,r,_,s,rc.Single,d,p,u).subscribe(g=>{e.dispatch(new Pm(g))},()=>{e.dispatch(new VP)})}setPublishIFrameSuccess(e,o){this.vendorAnalyticsService.track("Publish - Success",{type:"iframe",source:"publish"})}savePublishImage(e,{imageData:o,imageType:i}){this.publishService.saveUserImage(o,i).subscribe(s=>{e.dispatch(new km(s))},()=>{e.dispatch(new jP)})}savePublishImageSuccess(e,o){this.vendorAnalyticsService.track("Publish - Success",{type:"image",source:"publish"})}getPublishImage(e,o){const{model:i,camera:s,widgetOptions:r,imageData:a,fileType:l}=o,{widgetURL:_}=e.getState(),d=this.store.selectSnapshot(ne.getUserLanguage),p=this.store.selectSnapshot(ne.getSelectedUserApp);(0,si.p)(this.publishService.generateWidgetURL(i,_,r,s,rc.Single,d,p),this.publishService.saveUserImage(a,l)).subscribe(([u,g])=>{const y=this.publishService.getImageEmbed(i.title,u,g);e.dispatch(new xP(y))},()=>{e.dispatch(new GP)})}setPublishing(e,{publishing:o}){e.patchState({publishing:o})}resetPublish(e,o){e.setState(cC)}constructor(e,o,i,s){this.publishService=e,this.store=o,this.snackbar=i,this.vendorAnalyticsService=s}}).\u0275fac=function(e){return new(e||ca)(t.KVO(Qa),t.KVO(c.il),t.KVO(ho.UG),t.KVO(Qn))},ca.\u0275prov=t.jDH({token:ca,factory:ca.\u0275fac}),ca);ci([(0,c.rc)(Am),Ze("design:type",Function),Ze("design:paramtypes",[Object,Am]),Ze("design:returntype",void 0)],zn.prototype,"setPublishWidgetURL",null),ci([(0,c.rc)(uE),Ze("design:type",Function),Ze("design:paramtypes",[Object,uE]),Ze("design:returntype",void 0)],zn.prototype,"setPublishDimensions",null),ci([(0,c.rc)(hE),Ze("design:type",Function),Ze("design:paramtypes",[Object,hE]),Ze("design:returntype",void 0)],zn.prototype,"getPublishURL",null),ci([(0,c.rc)(Nm),Ze("design:type",Function),Ze("design:paramtypes",[Object,Nm]),Ze("design:returntype",void 0)],zn.prototype,"getPublishURLSuccess",null),ci([(0,c.rc)(Rm),Ze("design:type",Function),Ze("design:paramtypes",[Object,Rm]),Ze("design:returntype",void 0)],zn.prototype,"getPublishURLFail",null),ci([(0,c.rc)(gE),Ze("design:type",Function),Ze("design:paramtypes",[Object,gE]),Ze("design:returntype",void 0)],zn.prototype,"getPublishIFrame",null),ci([(0,c.rc)(Pm),Ze("design:type",Function),Ze("design:paramtypes",[Object,Pm]),Ze("design:returntype",void 0)],zn.prototype,"setPublishIFrameSuccess",null),ci([(0,c.rc)(SE),Ze("design:type",Function),Ze("design:paramtypes",[Object,SE]),Ze("design:returntype",void 0)],zn.prototype,"savePublishImage",null),ci([(0,c.rc)(km),Ze("design:type",Function),Ze("design:paramtypes",[Object,km]),Ze("design:returntype",void 0)],zn.prototype,"savePublishImageSuccess",null),ci([(0,c.rc)(bE),Ze("design:type",Function),Ze("design:paramtypes",[Object,bE]),Ze("design:returntype",void 0)],zn.prototype,"getPublishImage",null),ci([(0,c.rc)(mE),Ze("design:type",Function),Ze("design:paramtypes",[Object,mE]),Ze("design:returntype",void 0)],zn.prototype,"setPublishing",null),ci([(0,c.rc)(fE),Ze("design:type",Function),Ze("design:paramtypes",[Object,fE]),Ze("design:returntype",void 0)],zn.prototype,"resetPublish",null),ci([(0,c.MD)(),Ze("design:type",Function),Ze("design:paramtypes",[U_]),Ze("design:returntype",void 0)],zn,"getDimensions",null),ci([(0,c.MD)(),Ze("design:type",Function),Ze("design:paramtypes",[U_]),Ze("design:returntype",void 0)],zn,"getAspectRatio",null),ci([(0,c.MD)(),Ze("design:type",Function),Ze("design:paramtypes",[U_]),Ze("design:returntype",void 0)],zn,"getMinDimensions",null),ci([(0,c.MD)(),Ze("design:type",Function),Ze("design:paramtypes",[U_]),Ze("design:returntype",void 0)],zn,"getWidgetURL",null),ci([(0,c.MD)(),Ze("design:type",Function),Ze("design:paramtypes",[U_]),Ze("design:returntype",void 0)],zn,"getPublishing",null),zn=ci([(0,c.Uw)({name:"publish",defaults:cC}),Ze("design:paramtypes",[Qa,c.il,ho.UG,Qn])],zn);var B6=S(1562),z6=S(9529);let W6=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,Ui.o,K.YN,K.X1]}),e})(),_C=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,K.X1,_t.G,B6.YG,z6.bU,W6,c.rK.forFeature([zn])]}),e})(),ru=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([xe]),b.MD,rt.G,K.X1,_t.G,ut.iI,_C]}),e})();class wn{}var dC=function(n){return n[n.Query=0]="Query",n[n.Path=1]="Path",n}(dC||{}),hS=function(n){return n[n.Row=0]="Row",n[n.Card=1]="Card",n}(hS||{});const X6=he.application===bt.Loft?hS.Row:hS.Card;var au=function(n){return n.Success="success",n.Fail="fail",n}(au||{});const H6="cdb/content",Q6="cdb/copy/content",Y6={headers:new $e.Lr({"Content-Type":"application/json; charset=utf-8"})},q6=["production","client","preview","internal_content","public_preview","demos","social","exports","real_data"];let pC=(()=>{var n;class e{constructor(i,s){this.http=i,this.sceneService=s}saveModule(i,s){s=this.formatModulePath(s);const r=[H6,"modules",s].join("/"),a=this.JSONStringify(i);return this.http.put(r,a,Y6).pipe((0,F.T)(()=>au.Success),(0,pi.W)(({status:l})=>(0,Qe.of)(l>=200&&l<=202?au.Success:au.Fail)))}mergeModule(i,s,r="exception"){return this.http.post("/cdb/merge/modules",{loft:`${i}.json`,bridge:`${s}.json`,merge_option:r})}copyState(i,s){const r=[Q6,"states",s].join("/"),a={headers:new $e.Lr({"Content-Type":"application/json; charset=utf-8","source-state":i})};return this.http.put(r,{},a)}listContents(i,s,r,a=!1){const l=this.generateModulePath(i,s||"",r||"");return this.http.get(`/cdb/ls/content/modules/${l}`).pipe((0,F.T)(_=>a?_.contents.map(p=>{const u=p.name.replace("/content/modules/","").replace(".json",""),g=p.name.split("/").pop().replace("/content/modules","").replace(".json",""),y=new gr;return y.id=u,y.title=g,y.type=yt.Module,y}):_.contents))}getState(i){return this.http.get(`/cdb/ls/content/states/${i}`).pipe((0,F.T)(s=>s.contents))}getClients(){return this.http.get("/search/client").pipe((0,F.T)(i=>i.clients))}getUsedStates(){const i={};return Object.values(this.sceneService.getObjects()).reduce((s,r)=>(["transformId","morphId","geometryId","materialId"].forEach(a=>{const l=this.getPropertyState(r,a);l.length&&(i[l]=!0)}),r.hasOwnProperty("renderables")&&["morphId","geometryId","materialId"].forEach(a=>{r.renderables.forEach(_=>{const d=this.getPropertyState(_,a);d.length&&(i[d]=!0)})}),s),{}),Object.keys(i)}parseScenePath(i){const s=i.split("/");return 1===s.length?null:{fullPath:`https://qa.biodigital.com/content/modules/${i}`,relativePath:s.slice(0,s.length-1).join("/"),sceneName:s[s.length-1]}}formatModulePath(i){let s=i;return/\.json$/.test(i)||(s=`${s}.json`),s}getPrimaryCategories(){return(0,Qe.of)(q6)}getSecondaryCategories(i){switch(i){case"production":return(0,Qe.of)(["maleAdult","femaleAdult"]);case"client":return this.getClients();default:return(0,Qe.of)([])}}generateSaveModule(i){const s=this.parseScenePath(i),r=s.relativePath.split("/");return{id:i,name:s.sceneName,primaryCategory:r[0]||"",secondaryCategory:r[1]||""}}generateModulePath(i,s,r){const a=[];return i.length&&a.push(i),s.length&&a.push(s),r.length&&(r.indexOf(".json")<0&&(r=`${r}.json`),a.push(r)),a.join("/")}getPropertyState(i,s){return null!=i[s]?i[s].split("/")[0]:""}JSONStringify(i){return JSON.stringify(i).replace(/[\u007f-\uffff]/g,s=>"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(cn))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class K6{constructor(e="",o,i=25,s=0){this.query=e,this.sortBy=o,this.pageSize=i,this.offset=s}}class uC{}var gC=S(7987),hC=S(6939);let mC=(()=>{var n;class e{constructor(i){this.store=i}ngOnInit(){}close(){this.store.dispatch(new ct.ShowFilters(!1,!0))}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-gallery-drawer"]],decls:8,vars:2,consts:[["appEventFence","","data-test","galleryDrawer",1,"gallery-drawer"],[1,"gallery-drawer__header"],[1,"gallery-drawer__label"],["app-button","","buttonType","ghost","buttonTheme","light","type","button","title","Close","data-test","galleryDrawerClose",3,"click"],["icon","times","size","lg"],[1,"gallery-drawer__body"],["viewMode","expanded"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"h1",2),t.EFF(3,"Filters"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return s.close()}),t.nrm(5,"app-icon",4),t.k0s()(),t.j41(6,"div",5),t.nrm(7,"app-gallery-filters",6),t.k0s()()),2&i&&(t.Y8G("@expand",void 0),t.R7$(4),t.BMQ("aria-label","Close"))},styles:[".gallery-drawer[_ngcontent-%COMP%]{box-shadow:0 11px 15px #0003,0 24px 38px #00000024,0 9px 46px #0000001f;background:#fff;border-radius:16px 16px 0 0;display:block;position:fixed;bottom:0;top:auto;width:100vw}.gallery-drawer__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;border-bottom:1px solid #eaeff5;height:52px;padding:0 12px 0 20px;display:flex;align-items:center}.gallery-drawer__label[_ngcontent-%COMP%]{flex:1 0 auto}.gallery-drawer__body[_ngcontent-%COMP%]{padding:20px}"],data:{animation:[(0,ie.hZ)("expand",[(0,ie.kY)(":enter",[(0,ie.K2)([(0,ie.iF)({top:"100%"}),(0,ie.i0)("250ms ease-in-out",(0,ie.iF)({top:"*"}))])])])]},changeDetection:0}),e})(),fC=(()=>{var n;class e{constructor(i,s){this.overlay=i,this.store=s}openDrawer(){this.overlayRef||this._createOverlay();const i=new hC.A8(mC);this.overlayRef.attach(i)}closeDrawer(){this.overlayRef.detach()}_createOverlay(){const i=new gC.rR({hasBackdrop:!0,scrollStrategy:this.overlay.scrollStrategies.block()});this.overlayRef=this.overlay.create(i),this.overlayRef.backdropClick().subscribe(()=>{this.store.dispatch(new ct.ShowFilters(!1,!0))})}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(gC.hJ),t.KVO(c.il))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var ar;class Wn{static getOfflineModelIDs(){return Wn._offlineModelIDs$}static setOfflineModelIDs(e){Wn._offlineModelIDs.next(e)}static getOfflineModelIDList(){return this._offlineModelIDs.getValue()}static setStore(e){Wn.store=e}static setServices(e,o){Wn.rpcService=e,Wn.applicationEventService=o}static setSnackBar(e){Wn.snackBar=e}static setRouter(e){Wn.router=e}static debug(e){this.fire(Ce.NativeDebugMessage,e)}static fire(e,o){Wn.applicationEventService&&Wn.applicationEventService.fireEvent(e,o)}on(e,o){Wn.rpcService&&Wn.rpcService.getEvent(e,!1).subscribe(o)}send(e,o){let i=null,s={};switch(e){case W.NativeErrorMessage:i=Wn.snackBar.open(o,"OK",{duration:6e3,verticalPosition:"top"}),i.onAction().subscribe(()=>{i.dismiss()});break;case W.NativeSetAppVersion:Wn.appVersion=o.appVersion;break;case W.NativeRedirect:s=JSON.parse(o.queryItems),Wn.router.navigate([o.url],{queryParams:s});break;case W.NativeReload:window.location.href=o.url;break;case W.NativeOfflineModelIds:Wn.setOfflineModelIDs(o.modelIds);break;default:Wn.debug("unprocessed HumanWindowAPI send "+e)}}}(ar=Wn).store=null,ar.snackBar=null,ar.router=null,ar.appVersion="",ar._offlineModelIDs=new He.t([]),ar._offlineModelIDs$=ar._offlineModelIDs.asObservable();var _a,ft=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Y=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const SC=[Cn.Organization,Cn.Collection],J6=[...SC,Cn.Category],bC={[ko.Private]:"My Models",[ko.TeamEdit]:"View & Edit",[ko.TeamView]:"View Only"},Z6=Object.fromEntries(Object.entries(bC).map(([n,e])=>[e,n])),yC={loading:!0,searchMode:dC.Query,viewMode:X6,showFilters:!1,searchResults:{total:0,items:[]},checkedResults:[],searchConfig:null,searchOptions:null,sidenav:{enabled:!0,open:!0,disableClose:!1},bulkActions:{enabled:!0,active:!1,items:[]},cardActions:{enabled:!0}},e5=[...dn.tags,...Um.tags,...lp.tags,...ac.tags,...lc.tags];let at=(_a=class{static getLoading(e){return e.loading}static getSearchMode(e){return e.searchMode}static getSearchConfig(e){return e.searchConfig}static getSearchOptions(e){return e.searchOptions}static getHasFilters(e){return J6.includes(e.searchConfig?.type)||!0===he.native}static getAvailableTags(e,o){const i=new Set,s=e.searchResults.items,r=he.native?Wn.getOfflineModelIDList():[];return SC.includes(e.searchConfig?.type)?function MP(n){const e=new Set;return n.forEach(o=>{const i=!0===o.is_owner,s=ym(o),r=nE(o),a=vm(o);i?e.add(ko.Private):s&&r?e.add(ko.TeamEdit):(s&&!r||a)&&e.add(ko.TeamView)}),Array.from(e)}(s).forEach(_=>{i.add(bC[_])}):s.forEach(l=>{l.tags.forEach(_=>{"quiz"===_&&(_="Quiz"),e5.includes(_)&&i.add(_)}),he.native&&r.includes(l.id)&&i.add("Downloaded")}),Array.from(i)}static getActiveTags(e){const i={};return e.searchConfig.tags.forEach(s=>{const r=FP.find(a=>a.tags.some(l=>l===s));if(r){const a=(0,m.get)(r,"title","");i[a]=s}}),i}static getActiveTagsCount(e){return(0,m.compact)(e.searchConfig.tags).length}static getSearchType(e){return e.searchConfig?e.searchConfig.type:null}static getSearchGroup(e){switch(e.searchConfig?.type){case Cn.Category:case Cn.Community:case Cn.Internal:case Cn.Loft:return yt.Module;case Cn.Collection:case Cn.Private:case Cn.Organization:return yt.Bookmark}}static getViewMode(e){return e.viewMode}static getShowFilters(e){return e.showFilters}static getSort(e){return e.searchOptions.sortBy}static getSortOptions(e){switch(e.searchConfig.type){case Cn.Loft:return[dc,dp];case Cn.Category:return[ME,_p,dc,dp];default:return[_p,dc,dp,IE,AE]}}static getSidenav(e){return e.sidenav}static getBulkActions(e){return e.bulkActions}static getBulkActionsAvailable(e){const{enabled:o,items:i}=e.bulkActions;return o&&i.length>0}static getBulkActionsActive(e){return e.bulkActions.active}static getCardActions(e){return e.cardActions}static getFilteredResults(e){const{searchResults:o,searchOptions:i}=e,{ascending:s,fields:r}=i.sortBy,{offset:a,pageSize:l}=i,_=xm(o.items,r,s).slice(a,a+l);return{...o,items:_}}static getAllResults(e){const{searchResults:o,searchOptions:i}=e,{ascending:s,fields:r}=i.sortBy,a=xm(o.items,r,s);return{total:o.total,items:a}}static getCheckedResults(e){return e.checkedResults}static isZSpaceSearch(e){return e.searchConfig.type===Cn.Category&&e.searchConfig.categoryId===Li.a.Zspace}setSearchMode(e,o){e.patchState({searchMode:o.searchMode})}setViewMode(e,o){e.patchState({viewMode:o.viewMode})}showFilters(e,o){e.patchState({showFilters:o.show}),o.triggerDrawer&&(o.show?this.galleryService.openDrawer():this.galleryService.closeDrawer())}setSearchOptions(e,o){e.patchState({searchOptions:{...o.options}})}setActiveTags(e,o){const s={...e.getState().searchConfig,tags:(0,m.flatten)(Object.values(o.activeTags))};this.store.dispatch(new ct.SetSearchConfig(s))}setSearchConfig(e,o){const i=o.config||e.getState().searchConfig,s=o.options||e.getState().searchOptions;null!==i&&e.patchState({searchOptions:{...s},searchConfig:{...i}})}searchCategory(e,{categoryId:o}){const i="public"===o?new XP(""):new WP(o);e.dispatch(new ct.SetSearchConfig(i))}searchStudio(e,o){const{searchConfig:i,searchOptions:s}=e.getState(),r=new K6("",dc),a=this.store.selectSnapshot(ne.getUserLanguage),l=this.store.selectSnapshot(ve.isZSpaceAccount);e.patchState({loading:!0,searchOptions:{...s,pageSize:r.pageSize,offset:r.offset},checkedResults:[]});let _=new f.c;switch(i.type){case Cn.Category:_=this.exploreService.getAnatomyCategory(i.query,"all"===i.categoryId?"":i.categoryId,i.tags.filter(u=>!u.startsWith("Downloaded")),l,a);break;case Cn.Organization:_=this.bookmarksService.getOrganizationContent(i.organizationId,i.query,a);break;case Cn.Collection:_=this.organizationsService.getCollectionContent(i.organizationId,i.collectionId,i.query,a);break;case Cn.Community:_=this.bookmarksService.getPublicBookmarks(i.query,a);break;case Cn.Private:_=this.bookmarksService.getPrivateContent(i.query,a);break;case Cn.Internal:_=this.exploreService.searchInternal(i.query,i.directory);break;case Cn.Loft:const p=i.query.indexOf(".json")>0;_=this.modulesService.listContents(i.primary,i.secondary,p?i.query:"",!0).pipe((0,F.T)(u=>p?u:u.filter(g=>g.title.indexOf(i.query)>=0)))}const d=i.tags.reduce((p,u)=>{const g=Z6[u];return g&&p.push(g),p},[]);_.pipe((0,F.T)(p=>d.length>0?function wP(n,e,o=!0){return n.filter(i=>{const s=!0===i.is_owner,r=ym(i),a=nE(i),l=vm(i),_=d=>{switch(d){case ko.Private:return s;case ko.TeamEdit:return r&&a;case ko.TeamView:return r&&!a||l;default:return!1}};return o?e.every(_):e.some(_)})}(p,d):p),(0,Ye.j)(()=>e.patchState({loading:!1}))).subscribe(p=>{const u=he.native?Wn.getOfflineModelIDList():[],g=i.tags.includes("Downloaded")?p.filter(y=>u.includes(y.id)):p;e.dispatch(new ct.SearchSuccess(g))})}searchSuccess(e,o){e.patchState({searchResults:{items:o.bookmarks,total:o.bookmarks.length}});const i=e.getState().searchConfig,s=o.bookmarks.length>0?"Search - With Results":"Search - No Results",r={...i,tags:i.tags.filter(a=>""!==a).join(", ")};this.vendorAnalyticsService.track(s,r)}checkItem(e,o){let i=e.getState().checkedResults;const s=i.some(r=>r===o.id);o.checked&&!s?i=[...i,o.id]:o.checked||(i=i.filter(r=>r!==o.id)),e.patchState({checkedResults:i})}checkAll(e,o){const i=e.getState().searchResults.items.map(s=>s.id);e.patchState({checkedResults:i})}uncheckAll(e,o){e.patchState({checkedResults:[]})}setCheckedItems(e,o){e.patchState({checkedResults:o.ids})}setSidenav(e,o){e.patchState({sidenav:{...o.sidenav}})}setCardActions(e,o){e.patchState({cardActions:{...o.cardActions}})}setBulkActions(e,o){const{bulkActions:i}=e.getState();e.patchState({bulkActions:{...i,...o.bulkActions}})}clearResults(e,o){e.patchState({searchResults:{items:[],total:0}})}resetGallery(e,o){e.patchState(yC)}constructor(e,o,i,s,r,a,l){this.organizationsService=e,this.modulesService=o,this.exploreService=i,this.bookmarksService=s,this.galleryService=r,this.store=a,this.vendorAnalyticsService=l}},_a.\u0275fac=function(e){return new(e||_a)(t.KVO(Qo),t.KVO(pC),t.KVO(pp),t.KVO(_c),t.KVO(fC),t.KVO(c.il),t.KVO(Qn))},_a.\u0275prov=t.jDH({token:_a,factory:_a.\u0275fac}),_a);ft([(0,c.rc)(ct.SetSearchMode),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetSearchMode]),Y("design:returntype",void 0)],at.prototype,"setSearchMode",null),ft([(0,c.rc)(ct.SetViewMode),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetViewMode]),Y("design:returntype",void 0)],at.prototype,"setViewMode",null),ft([(0,c.rc)(ct.ShowFilters),Y("design:type",Function),Y("design:paramtypes",[Object,ct.ShowFilters]),Y("design:returntype",void 0)],at.prototype,"showFilters",null),ft([(0,c.rc)(ct.SetSearchOptions),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetSearchOptions]),Y("design:returntype",void 0)],at.prototype,"setSearchOptions",null),ft([(0,c.rc)(ct.SetActiveTags),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetActiveTags]),Y("design:returntype",void 0)],at.prototype,"setActiveTags",null),ft([(0,c.rc)(ct.SetSearchConfig),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetSearchConfig]),Y("design:returntype",void 0)],at.prototype,"setSearchConfig",null),ft([(0,c.rc)(ct.SearchCategory),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SearchCategory]),Y("design:returntype",void 0)],at.prototype,"searchCategory",null),ft([(0,c.rc)(ct.SearchStudio),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SearchStudio]),Y("design:returntype",void 0)],at.prototype,"searchStudio",null),ft([(0,c.rc)(ct.SearchSuccess),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SearchSuccess]),Y("design:returntype",void 0)],at.prototype,"searchSuccess",null),ft([(0,c.rc)(ct.CheckItem),Y("design:type",Function),Y("design:paramtypes",[Object,ct.CheckItem]),Y("design:returntype",void 0)],at.prototype,"checkItem",null),ft([(0,c.rc)(ct.CheckAll),Y("design:type",Function),Y("design:paramtypes",[Object,ct.CheckAll]),Y("design:returntype",void 0)],at.prototype,"checkAll",null),ft([(0,c.rc)(ct.UncheckAll),Y("design:type",Function),Y("design:paramtypes",[Object,ct.UncheckAll]),Y("design:returntype",void 0)],at.prototype,"uncheckAll",null),ft([(0,c.rc)(ct.SetCheckedItems),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetCheckedItems]),Y("design:returntype",void 0)],at.prototype,"setCheckedItems",null),ft([(0,c.rc)(ct.SetSidenav),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetSidenav]),Y("design:returntype",void 0)],at.prototype,"setSidenav",null),ft([(0,c.rc)(ct.SetCardActions),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetCardActions]),Y("design:returntype",void 0)],at.prototype,"setCardActions",null),ft([(0,c.rc)(ct.SetBulkActions),Y("design:type",Function),Y("design:paramtypes",[Object,ct.SetBulkActions]),Y("design:returntype",void 0)],at.prototype,"setBulkActions",null),ft([(0,c.rc)(ct.ClearResults),Y("design:type",Function),Y("design:paramtypes",[Object,ct.ClearResults]),Y("design:returntype",void 0)],at.prototype,"clearResults",null),ft([(0,c.rc)(ct.Reset),Y("design:type",Function),Y("design:paramtypes",[Object,ct.Reset]),Y("design:returntype",void 0)],at.prototype,"resetGallery",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getLoading",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSearchMode",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSearchConfig",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSearchOptions",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getHasFilters",null),ft([(0,c.MD)([ne]),Y("design:type",Function),Y("design:paramtypes",[wn,Object]),Y("design:returntype",void 0)],at,"getAvailableTags",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getActiveTags",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getActiveTagsCount",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSearchType",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSearchGroup",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getViewMode",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getShowFilters",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSort",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSortOptions",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getSidenav",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getBulkActions",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getBulkActionsAvailable",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",Boolean)],at,"getBulkActionsActive",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getCardActions",null),ft([(0,c.MD)([ne]),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",uC)],at,"getFilteredResults",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",uC)],at,"getAllResults",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"getCheckedResults",null),ft([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[wn]),Y("design:returntype",void 0)],at,"isZSpaceSearch",null),at=ft([(0,c.Uw)({name:"gallery",defaults:yC}),Y("design:paramtypes",[Qo,pC,pp,_c,fC,c.il,Qn])],at);var V_=S(9511),j_=S(9162),mS=S(6315);const t5=["app-pill-button",""],n5=["*"],i5=n=>({"pill-button--selected":n});let o5=(()=>{var n;class e{constructor(){this.selected=!1}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["button","app-pill-button",""],["a","app-pill-button",""]],inputs:{selected:"selected"},attrs:t5,ngContentSelectors:n5,decls:2,vars:3,consts:[[1,"pill-button",3,"ngClass"]],template:function(i,s){1&i&&(t.NAR(),t.j41(0,"span",0),t.SdG(1),t.k0s()),2&i&&t.Y8G("ngClass",t.eq3(1,i5,s.selected))},dependencies:[b.YU],styles:["[_nghost-%COMP%]{border-color:transparent;background:none;border-width:0;padding:0;margin:0;border-radius:4px;outline:0 none}[_nghost-%COMP%]:not([disabled]):hover{cursor:pointer}[_nghost-%COMP%]:focus   .pill-button[_ngcontent-%COMP%]{outline:#2d72dc solid 2px!important}[_nghost-%COMP%]:disabled   .pill-button[_ngcontent-%COMP%], [_nghost-%COMP%]:disabled:hover   .pill-button[_ngcontent-%COMP%]{background-color:#f9fafd;color:#96a8c0}.pill-button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-family:Inter,sans-serif;font-weight:500;color:#374a68;display:flex;align-items:center;justify-content:center;background-color:#eaeff5;border-radius:100px;padding:8px 16px;transition:background-color .12s,color .12s;width:100%}.pill-button[_ngcontent-%COMP%]:hover{background-color:#d7e0ea}.pill-button--selected[_ngcontent-%COMP%], .pill-button--selected[_ngcontent-%COMP%]:hover{background-color:#2d72dc;color:#fff}"],changeDetection:0}),e})();var x_;function a5(n,e){if(1&n){const o=t.RV6();t.j41(0,"li",9)(1,"button",10),t.nI1(2,"async"),t.bIt("click",function(){const s=t.eBV(o).$implicit,r=t.XpG().$implicit,a=t.XpG(2);return t.Njj(a.setTag(r.title,a.activeTags[r.title]===s?"":s))}),t.EFF(3),t.nI1(4,"titlecase"),t.k0s()()}if(2&n){let o;const i=e.$implicit,s=t.XpG().$implicit,r=t.XpG(2);t.R7$(),t.Y8G("disabled",!(null!=(o=t.bMT(2,3,r.availableTags$))&&o.includes(i)))("selected",r.activeTags[s.title]===i),t.R7$(2),t.SpI(" ",t.bMT(4,5,i)," ")}}function l5(n,e){if(1&n&&(t.j41(0,"div",5)(1,"h2",6),t.EFF(2),t.k0s(),t.j41(3,"ul",7),t.DNE(4,a5,5,7,"li",8),t.k0s()()),2&n){const o=e.$implicit;t.R7$(2),t.JRh(o.title),t.R7$(2),t.Y8G("ngForOf",o.tags)}}function c5(n,e){if(1&n&&(t.j41(0,"div",3),t.DNE(1,l5,5,2,"div",4),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.tagGroups)}}function _5(n,e){if(1&n){const o=t.RV6();t.j41(0,"li",9)(1,"button",14),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2).$implicit,r=t.XpG(2);return t.Njj(r.setTag(s.title,""))}),t.j41(2,"span",15),t.EFF(3),t.nI1(4,"titlecase"),t.k0s(),t.nrm(5,"app-icon",16),t.k0s()()}if(2&n){const o=t.XpG().$implicit;t.R7$(3),t.JRh(t.bMT(4,1,o))}}function d5(n,e){if(1&n&&(t.qex(0),t.DNE(1,_5,6,3,"li",13),t.bVm()),2&n){const o=e.$implicit,i=t.XpG().$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngIf",s.activeTags[i.title]===o)}}function p5(n,e){if(1&n&&(t.qex(0),t.DNE(1,d5,2,1,"ng-container",12),t.bVm()),2&n){const o=e.$implicit;t.R7$(),t.Y8G("ngForOf",o.tags)}}function u5(n,e){if(1&n&&(t.j41(0,"ul",11),t.DNE(1,p5,2,1,"ng-container",12),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.tagGroups)}}class fS{get viewMode(){return this._viewMode}set viewMode(e){this._viewMode=e}get activeTags(){return this._activeTags}set activeTags(e){null==e&&(e={}),this._activeTags=e,this.activeTagList=Object.values(this.activeTags).reduce((o,i)=>(""!=i&&o.push(i),o),[]),this.changeDetectorRef.markForCheck()}constructor(e,o,i){this.changeDetectorRef=e,this.store=o,this.router=i,this.activeTagList=[],this.ngUnsubscribe=new oe.B,this._viewMode="expanded",this.tagGroups=[],this._activeTags={},this.selectedTagChange=new t.bkB}ngOnInit(){this.store.select(at.getActiveTags).pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.activeTags=e}),this.initFilters()}isMyLibrary(){return this.router.url.includes("/results/bookmarks")}initFilters(){const e=he.native;if(this.tagGroups=[],e&&this.tagGroups.push(OE),this.isMyLibrary())this.tagGroups.push(wE);else{const o=["Quiz",Li.a.Zspace];this.tagGroups=this.tagGroups.concat([lp,{...ac,tags:(0,m.without)(ac.tags,...o)}])}}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setTag(e,o){const i=this.store.selectSnapshot(at.getActiveTags);i[e]=o,this.store.dispatch(new ct.SetActiveTags(i))}}(x_=fS).\u0275fac=function(e){return new(e||x_)(t.rXU(t.gRc),t.rXU(c.il),t.rXU(ut.Ix))},x_.\u0275cmp=t.VBU({type:x_,selectors:[["app-gallery-filters"]],inputs:{viewMode:"viewMode"},outputs:{selectedTagChange:"selectedTagChange"},decls:3,vars:4,consts:[["data-test","galleryFilters",1,"gallery-filters"],["class","gallery-filters__expanded","data-test","galleryFiltersExpanded",4,"ngIf"],["class","gallery-filters__tags","data-test","galleryFiltersSummary",4,"ngIf"],["data-test","galleryFiltersExpanded",1,"gallery-filters__expanded"],["class","gallery-filters__group",4,"ngFor","ngForOf"],[1,"gallery-filters__group"],[1,"gallery-filters__header"],[1,"gallery-filters__tags"],["class","gallery-filters__tag",4,"ngFor","ngForOf"],[1,"gallery-filters__tag"],["app-pill-button","","data-test","galleryFiltersTag",3,"click","disabled","selected"],["data-test","galleryFiltersSummary",1,"gallery-filters__tags"],[4,"ngFor","ngForOf"],["class","gallery-filters__tag",4,"ngIf"],["app-pill-button","","data-test","galleryFiltersTag",3,"click"],[1,"mr-2"],["icon","times"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.DNE(1,c5,2,1,"div",1)(2,u5,2,1,"ul",2),t.k0s()),2&e&&(t.AVh("gallery-filters--multiple",o.tagGroups.length>1),t.R7$(),t.Y8G("ngIf","expanded"===o.viewMode),t.R7$(),t.Y8G("ngIf","summary"===o.viewMode))},dependencies:[o5,b.Sq,b.bT,qe,b.Jj,b.PV],styles:[".gallery-filters__expanded[_ngcontent-%COMP%]{display:flex;gap:32px}.gallery-filters__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:8px}.gallery-filters__tag[_ngcontent-%COMP%]{display:inline-block;margin:0 12px 12px 0}@media (max-width: 540px){.gallery-filters__expanded[_ngcontent-%COMP%]{flex-direction:column;gap:0}.gallery-filters__group[_ngcontent-%COMP%]{padding:0 0 24px}}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(at.getAvailableTags),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],fS.prototype,"availableTags$",void 0);var g5=S(2996);let h5=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,hC.jc,g5.z,Ui.o,Yi.C,_t.G]}),e})();var m5=S(7878);let f5=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,_t.G,Ti.y2.forChild()]}),e})(),lu=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,_t.G,rt.G,f5]}),e})();var S5=S(7575);let vC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,_t.G,rt.G,S5.PO,lu,m5.wR]}),e})(),b5=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([at]),zc.Un,ut.iI,Yi.C,b.MD,K.X1,ru,V_.h,mS.H,rt.G,aC.f,j_.M,_t.G,M1.g7,h5,vC]}),e})();t.wjB(mC,function(){return[hi.Q,bc,qe,fS]},[]);let EC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,ut.iI,_t.G]}),e})(),TC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[_t.G,rt.G,b.MD,ut.iI,aC.f,rC,K.X1,ru,b5,EC,c.rK.forFeature([Kt])]}),e})();var SS=S(2192);let bS=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([G]),b.MD,Ui.o,K.X1]}),e})(),yS=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([Pe,E,ye,oi,il]),b.MD,_t.G,rt.G,SS.G,lu,K.X1,Ti.y2.forChild(),bS]}),e})(),vS=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([Nn])]}),e})(),ES=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([Io,U,vt,Re,ki,St]),b.MD,V_.h,rt.G,K.YN,K.X1,yS,_t.G,SS.G,vS,Pc]}),e})(),y5=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,_C,c.rK.forFeature([ve])]}),e})(),CC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),TS=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,K.YN,K.X1,Pp.D]}),e})(),OC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1,TS]}),e})(),wC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),MC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),IC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),AC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),PC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),NC=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})();var Fo;function E5(n,e){if(1&n&&(t.j41(0,"button",7),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.settings.miscText," ")}}function T5(n,e){if(1&n&&(t.j41(0,"button",8),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.Y8G("mat-dialog-close",!1),t.R7$(),t.SpI(" ",o.settings.cancelText," ")}}function C5(n,e){if(1&n&&(t.j41(0,"button",9),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.Y8G("mat-dialog-close",!0),t.R7$(),t.SpI(" ",o.settings.confirmText," ")}}!function(n){n.OpenLimit=(()=>{class _{constructor(){}}return _.type="[Dialog] Open Limit",_})(),n.CloseLimit=(()=>{class _{constructor(p){this.upgrade=p}}return _.type="[Dialog] Close Limit",_})(),n.OpenPremiumContent=(()=>{class _{constructor(){}}return _.type="[Dialog] Open Premium Content",_})(),n.ClosePremiumContent=(()=>{class _{constructor(p){this.confirmed=p}}return _.type="[Dialog] Close Premium Content",_})(),n.OpenUpgrade=(()=>{class _{constructor(){}}return _.type="[Dialog] Open Upgrade",_})(),n.CloseUpgrade=(()=>{class _{constructor(){}}return _.type="[Dialog] Close Upgrade",_})()}(Fo||(Fo={}));let O5=(()=>{var n;class e{constructor(i,s){this.dialogRef=i,this.data=s,this.settings={titleText:"Confirm Action",bodyText:"",confirmText:"Confirm",confirmColor:"primary",cancelText:"Cancel",confirmEnabled:!0,cancelEnabled:!0,miscText:""},s&&(this.settings={...this.settings,...s})}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(pt.Vh))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-confirm-dialog"]],decls:9,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"text-sm"],["mat-dialog-actions",""],["app-button","","buttonTheme","light",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close",4,"ngIf"],["app-button","","buttonTheme","light",3,"mat-dialog-close"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(i,s){1&i&&(t.j41(0,"h1",0),t.EFF(1),t.k0s(),t.j41(2,"div",1)(3,"div",2),t.EFF(4),t.k0s()(),t.j41(5,"div",3),t.DNE(6,E5,2,1,"button",4)(7,T5,2,2,"button",5)(8,C5,2,2,"button",6),t.k0s()),2&i&&(t.R7$(),t.JRh(s.settings.titleText),t.R7$(3),t.JRh(s.settings.bodyText),t.R7$(2),t.Y8G("ngIf",s.settings.miscText),t.R7$(),t.Y8G("ngIf",s.settings.cancelEnabled),t.R7$(),t.Y8G("ngIf",s.settings.confirmEnabled))},dependencies:[b.bT,pt.tx,pt.BI,pt.E7,pt.Yi,hi.Q],styles:["[_nghost-%COMP%]{display:block}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;width:100%}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}@media (min-width: 480px){[_nghost-%COMP%]{min-width:320px}}"],changeDetection:0}),e})();const w5=["modalContents"];let RC=(()=>{var n;class e{constructor(i,s,r,a,l,_){this.dialogRef=i,this.data=s,this.sanitizer=r,this.renderer=a,this.vendorAnalyticsService=l,this.productService=_}onMessage(i){switch(i.data.action){case"close":this.dialogRef.close(i.data);break;case"track":this.vendorAnalyticsService.track(i.data.label,{...i.data.metadata,platform:this.productService.productType})}}ngOnInit(){this.title=this.data.title,this.url=this.data.url?this.sanitizer.bypassSecurityTrustResourceUrl(this.data.url):"",this.renderer.setStyle(this.modalContents.nativeElement,"background-color",this.data.backgroundColor||"#ffffff")}closeDialog(){this.dialogRef.close()}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(pt.Vh),t.rXU(z.up),t.rXU(t.sFG),t.rXU(Qn),t.rXU(Si))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-iframe-dialog"]],viewQuery:function(i,s){if(1&i&&t.GBs(w5,7),2&i){let r;t.mGM(r=t.lsd())&&(s.modalContents=r.first)}},hostBindings:function(i,s){1&i&&t.bIt("message",function(a){return s.onMessage(a)},!1,t.tSv)},decls:6,vars:3,consts:[["modalContents",""],["role","dialog","aria-modal","true",1,"modal"],[1,"modal__contents"],["cdkFocusInitial","",1,"modal__frame",3,"src"],["app-button","","buttonTheme","dark","buttonType","white","buttonShape","circle","type","button","title","Close",1,"modal__close",3,"click"],["icon","times","size","lg"]],template:function(i,s){if(1&i){const r=t.RV6();t.j41(0,"div",1)(1,"div",2,0),t.nrm(3,"iframe",3),t.k0s(),t.j41(4,"button",4),t.bIt("click",function(){return t.eBV(r),t.Njj(s.closeDialog())}),t.nrm(5,"app-icon",5),t.k0s()()}2&i&&(t.BMQ("aria-label",s.title),t.R7$(3),t.Y8G("src",s.url,t.f$h),t.R7$(),t.BMQ("aria-label","Close"))},dependencies:[qe,hi.Q],styles:[".modal[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative}.modal__close[_ngcontent-%COMP%]{margin-bottom:4px;align-self:flex-end;cursor:pointer;position:absolute;right:12px;top:12px}.modal__contents[_ngcontent-%COMP%]{flex-grow:1}.modal__frame[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0}),e})();var cu=function(n){return n.PersonalUse="Personal Use",n.Education="Education",n.Business="Business",n}(cu||{});let kC=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Users] Join Organization",e})(),M5=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Users] Join Organization Success",e})(),I5=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Users] Join Organization Fail",e})(),DC=(()=>{class e{constructor(i){this.code=i}}return e.type="[Users] Join Organization With Code",e})(),LC=(()=>{class e{constructor(i){this.organizationName=i}}return e.type="[Users] Join Organization With Code Success",e})(),A5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Join Organization With Code Fail",e})(),UC=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Users] Leave Organization",e})(),P5=(()=>{class e{constructor(i){this.organization=i}}return e.type="[Users] Leave Organization Success",e})(),N5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Leave Organization Fail",e})(),_u=(()=>{class e{constructor(i,s){this.groupEID=i,this.invites=s}}return e.type="[Users] Send Organization Invite",e})(),VC=(()=>{class e{constructor(i){this.responses=i}}return e.type="[Users] Send Organization Invite Success",e})(),jC=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Send Organization Invite Fail",e})(),xC=(()=>{class e{constructor(i){this.groupId=i}}return e.type="[Users] Get Organization Users",e})(),CS=(()=>{class e{constructor(i){this.users=i}}return e.type="[Users] Get Organization Users Success",e})(),R5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Get Organization Users Fail",e})(),GC=(()=>{class e{constructor(i){this.groupId=i}}return e.type="[Users] Get Organization Invited Users",e})(),OS=(()=>{class e{constructor(i){this.invites=i}}return e.type="[Users] Get Organization Invited Users Success",e})(),k5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Get Organization Invited Users Fail",e})(),D5=(()=>{class e{}return e.type="[Users] Reset",e})(),$C=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Update User Roles",e})(),L5=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Update User Roles Success",e})(),U5=(()=>{class e{}return e.type="[Users] Update User Roles Fail",e})(),FC=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Remove Organization User",e})(),V5=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Remove Organization User Success",e})(),j5=(()=>{class e{}return e.type="[Users] Remove Organization User Fail",e})(),BC=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Transfer Organization Content",e})(),x5=(()=>{class e{constructor(i,s){this.groupId=i,this.users=s}}return e.type="[Users] Transfer Organization Content Success",e})(),G5=(()=>{class e{}return e.type="[Users] Transfer Organization Content Fail",e})(),wS=(()=>{class e{constructor(i){this.params=i}}return e.type="[Users] Get Eligible Join Organizations",e})(),du=(()=>{class e{constructor(i){this.eligibleOrganizations=i}}return e.type="[Users] Get Eligible Join Organizations Success",e})(),$5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Get Eligible Join Organizations Error",e})(),MS=(()=>{class e{}return e.type="[Users] Clear Eligible Join Organizations",e})(),G_=(()=>{class e{constructor(i){this.params=i}}return e.type="[Users] Get Join Requests",e})(),pu=(()=>{class e{constructor(i){this.joinRequests=i}}return e.type="[Users] Get Join Requests Success",e})(),IS=(()=>{class e{constructor(i,s){this.organizationId=i,this.description=s}}return e.type="[Users] Post Join Request",e})(),F5=(()=>{class e{constructor(i){this.joinRequestKey=i}}return e.type="[Users] Post Join Request Success",e})(),zC=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Post Join Request Error",e})(),AS=(()=>{class e{constructor(i){this.joinRequestKey=i}}return e.type="[Users] Delete Join Request",e})(),WC=(()=>{class e{}return e.type="[Users] Delete Join Request Success",e})(),XC=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Delete Join Request Error",e})(),HC=(()=>{class e{constructor(i){this.params=i}}return e.type="[Users] Get Organization Join Requests",e})(),PS=(()=>{class e{constructor(i){this.organizationJoinRequests=i}}return e.type="[Users] Get Organization Join Requests Success",e})(),B5=(()=>{class e{constructor(i){this.error=i}}return e.type="[Users] Get Organization Join Requests Error",e})(),QC=(()=>{class e{constructor(i){this.joinRequests=i}}return e.type="[Users] Accept Join Requests",e})(),z5=(()=>{class e{constructor(i){this.count=i}}return e.type="[Users] Accept Join Requests Success",e})(),W5=(()=>{class e{constructor(i,s){this.count=i,this.error=s}}return e.type="[Users] Accept Join Requests Error",e})(),YC=(()=>{class e{constructor(i){this.joinRequestKeys=i}}return e.type="[Users] Deny Join Requests",e})(),X5=(()=>{class e{constructor(i){this.count=i}}return e.type="[Users] Deny Join Requests Success",e})(),H5=(()=>{class e{constructor(i,s){this.count=i,this.error=s}}return e.type="[Users] Deny Join Requests Error",e})();var Q5=S(7974),Y5=S(3831),q5=S(6727);const NS="/ws/organization/join/requests",uu="/ws/user/join/requests",RS="/ws/organization/user",kS="/ws/organization/users";let KC=(()=>{var n;class e{constructor(i,s){this.http=i,this.productService=s}getOrganizationJoinRequests(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new $e.Nl({fromObject:{...s}});return this.http.get(NS,{params:r})}acceptOrganizationJoinRequests(i){return this.batchRequest(i,r=>this.http.post(NS,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_accept:r}))}denyOrganizationJoinRequests(i){return this.batchRequest(i,r=>this.http.post(NS,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_deny:r}))}getEligibleJoinOrganizations(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new $e.Nl({fromObject:{...s}});return this.http.get(`${uu}/eligibility`,{params:r})}getJoinRequests(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new $e.Nl({fromObject:{...s}});return this.http.get(uu,{params:r})}postJoinRequest(i,s){return this.http.post(uu,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,organization_id:i,request_desc:s})}deleteJoinRequest(i){return this.http.request("delete",uu,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_request_key:i}})}getOrganizationUsers(i){const s=xu(i);return this.http.get(`${kS}${s}`).pipe((0,F.T)(r=>r.users),(0,F.T)(r=>r.map(a=>({...a,user_role:tc(a.user_role)}))))}getOrganizationInvites(i){const s=xu(i);return this.http.get(`/ws/organization/invite${s}`).pipe((0,F.T)(r=>r.invites),(0,F.T)(r=>r.map(a=>({...a,invite_user:{...a.inviter_user,user_role:tc(a.inviter_user.user_role)},invitee_user:{...a.invitee_user,user_role:tc(a.invitee_user.user_role)}}))))}sendOrganizationInvites(i,s,r){return this.http.post("/ws/organization/invite",{version:2,group_eid:i,invite_emails:s,site_verify_response:r}).pipe((0,F.T)(a=>{const{messages:l}=a.results_summary;return l}))}addUserToOrganization(i){return this.http.post(`${RS}/add`,{group_eid:i})}addUserWithGroupCode(i){return this.http.post(`${RS}/add`,{group_code:i}).pipe((0,F.T)(s=>s.organization_name))}updateUserRoles(i,s){return this.batchRequest(s,a=>this.http.post(kS,{group_id:i,update_users:a.map(l=>({user_id:l.userId,role_id:l.roleId}))}))}removeUser(i){return this.http.post(`${RS}/leave`,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i})}removeUsers(i,s){return this.batchRequest(s,a=>this.http.post(kS,{group_id:i,remove_users:a.map(l=>this.createTransferRequest(l))}))}transferUserContent(i,s){return this.batchRequest(s,a=>this.http.post("/ws/organization/bookmark/transfer",{group_id:i,transfer_bookmarks:a.map(l=>this.createTransferRequest(l))}))}createUserDisplayModel(i,s,r){return{name:this.formatUserName(i),initials:this.formatBadgeLabel(i),email:i.user_email,id:i.user_id,role:i.user_role,activeDeveloper:this.hasActiveDeveloperAccount(i),selected:!1,invitationStatus:s,joinRequestKey:r}}isUserModel(i){return["developer_account","developer_account_active","developer_has_apps"].every(r=>i.hasOwnProperty(r))}hasActiveDeveloperAccount(i){return!!this.isUserModel(i)&&i.developer_account&&i.developer_account_active&&i.developer_has_apps}batchRequest(i,s){let r=0;const a=[];for(;r<i.length;){const _=i.slice(r,r+50);a.push(s(_)),r+=50}const l=(0,Q5.c)(a,Y5.T).pipe((0,q5.K)());return(0,si.p)(l).pipe((0,F.T)(()=>!0))}createTransferRequest(i){const{sourceUserId:s,targetUserId:r}=i;return"number"==typeof r?{user_id:s,group_bookmarks:{transfer_ownership:1,transfer_user_id:r}}:{user_id:s}}formatUserName(i){const{user_first_name:s,user_last_name:r}=i,a=[s,r].filter(l=>!!l);return a.length>0?a.join(" "):""}formatBadgeLabel(i){const{user_first_name:s,user_last_name:r}=i;return[s,r].filter(l=>!!l).map(l=>l[0]).join("")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Si))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();class _i{}var lr,LS,DS=function(n){return n.Pending="pending",n.Accepted="accepted",n.Denied="denied",n.Expired="expired",n}(DS||{}),ht=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},H=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const JC={joining:!1,leaving:!1,inviting:!1,loadingUsers:!1,loadingInvites:!1,loadingOrganizationJoinRequests:!1,loadingJoinRequests:!1,loadingEligibleOrganizations:!1,postingJoinRequest:!1,deletingJoinRequest:!1,users:[],invites:[],joinRequests:[],organizationJoinRequests:[]};let it=(lr=class{static getUsers(e){return e.users}static getInvites(e){return e.invites}static getUsersLoading(e){return e.loadingUsers}static getJoining(e){return e.joining}static getLeaving(e){return e.leaving}static getInviting(e){return e.inviting}static getLoadingJoinRequests(e){return e.loadingJoinRequests}static getLoadingOrganizationJoinRequests(e){return e.organizationJoinRequests}static getLoadingEligibleOrganizations(e){return e.loadingEligibleOrganizations}static getPostingJoinRequest(e){return e.postingJoinRequest}static getDeletingJoinRequest(e){return e.deletingJoinRequest}static getRequesting(e){return e.loadingJoinRequests||e.loadingEligibleOrganizations||e.postingJoinRequest||e.deletingJoinRequest}static getEligibleOrganizations(e){return e.eligibleOrganizations}static hasEligibleOrganizations(e){return Array.isArray(e.eligibleOrganizations)&&e.eligibleOrganizations.length>0}static getJoinRequests(e){return e.joinRequests}static getPendingJoinRequest(e){return e.joinRequests?.find(o=>o.request_status===DS.Pending)}static getOrganizationJoinRequests(e){return e.organizationJoinRequests}static getPendingOrganizationJoinRequests(e){return e.organizationJoinRequests.filter(o=>o.request_status===DS.Pending)}joinOrganization(e,{organization:o}){e.patchState({joining:!0}),this.usersService.addUserToOrganization(o.eid).pipe((0,Ye.j)(()=>e.patchState({joining:!1}))).subscribe(()=>e.dispatch(new M5(o)),()=>e.dispatch(new I5(o)))}joinOrganizationWithCode(e,{code:o}){e.patchState({joining:!0}),this.usersService.addUserWithGroupCode(o).pipe((0,Ye.j)(()=>e.patchState({joining:!1}))).subscribe(i=>e.dispatch(new LC(i)),i=>e.dispatch(new A5(i)))}joinOrganizationWithCodeSuccess(){this.vendorAnalyticsService.track("Account Upgrade - Free Individual to Team")}leaveOrganization(e,{organization:o}){e.patchState({leaving:!0}),this.usersService.removeUser(o.id).pipe((0,Ye.j)(()=>e.patchState({leaving:!1}))).subscribe({next:()=>e.dispatch(new P5(o)),error:i=>e.dispatch(new N5(i))})}sendOrganizationInvite(e,{groupEID:o,invites:i}){e.patchState({inviting:!0}),this.authService.verifyIsHuman("invites","",!0).pipe((0,At.Z)(({isHuman:s,verification:r})=>{if(!s)throw new Do;return this.usersService.sendOrganizationInvites(o,i,r)}),(0,Ye.j)(()=>e.patchState({inviting:!1}))).subscribe({next:s=>{e.dispatch(new VC(s))},error:s=>{s instanceof Do&&e.dispatch(new Ba(s)),e.dispatch(new jC(s))}})}getOrganizationUsers(e,{groupId:o}){e.patchState({loadingUsers:!0}),this.usersService.getOrganizationUsers({group_id:o}).pipe((0,Ye.j)(()=>e.patchState({loadingUsers:!1}))).subscribe(i=>e.dispatch(new CS(i)),i=>e.dispatch(new R5(i)))}getOrganizationUsersSuccess(e,{users:o}){e.patchState({users:o})}getOrganizationUserInvites(e,{groupId:o}){e.patchState({loadingInvites:!0}),this.usersService.getOrganizationInvites({group_id:o,version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}).pipe((0,Ye.j)(()=>e.patchState({loadingInvites:!1}))).subscribe(i=>e.dispatch(new OS(i)),i=>e.dispatch(new k5(i)))}getOrganizationUserInvitesSuccess(e,{invites:o}){e.patchState({invites:o})}resetOrganizations(e){e.setState(JC)}updateUserRoles(e,{groupId:o,users:i}){this.usersService.updateUserRoles(o,i).subscribe(()=>e.dispatch(new L5(o,i)),()=>e.dispatch(new U5))}removeOrganizationUser(e,{groupId:o,users:i}){this.usersService.removeUsers(o,i).subscribe(()=>e.dispatch(new V5(o,i)),()=>e.dispatch(new j5))}transferOrganizationContent(e,{groupId:o,users:i}){this.usersService.transferUserContent(o,i).subscribe(()=>e.dispatch(new x5(o,i)),()=>e.dispatch(new G5))}clearEligibleJoinOrganizations(e,o){e.patchState({eligibleOrganizations:[]})}getEligibleJoinOrganizations(e,o){e.patchState({loadingEligibleOrganizations:!0}),this.usersService.getEligibleJoinOrganizations(o.params).pipe((0,Ye.j)(()=>e.patchState({loadingEligibleOrganizations:!1}))).subscribe({next:i=>{e.dispatch(new du(i.eligible_orgs))},error:i=>e.dispatch(new $5(i))})}getEligibleJoinOrganizationsSuccess(e,{eligibleOrganizations:o}){e.patchState({eligibleOrganizations:o})}getJoinRequests(e,o){e.patchState({loadingJoinRequests:!0}),this.usersService.getJoinRequests(o.params).pipe((0,Ye.j)(()=>e.patchState({loadingJoinRequests:!1}))).subscribe(i=>{e.dispatch(new pu(i.join_requests))})}getJoinRequestsSuccess(e,{joinRequests:o}){e.patchState({joinRequests:o}),LS.getPendingJoinRequest(e.getState())&&e.dispatch(new MS)}postJoinRequest(e,o){e.patchState({postingJoinRequest:!0}),this.usersService.postJoinRequest(o.organizationId,o.description).pipe((0,Ye.j)(()=>e.patchState({postingJoinRequest:!1}))).subscribe({next:i=>{e.dispatch(new F5(i.join_request_key)),e.dispatch(new G_)},error:i=>e.dispatch(new zC(i))})}deleteJoinRequest(e,o){e.patchState({deletingJoinRequest:!0}),this.usersService.deleteJoinRequest(o.joinRequestKey).pipe((0,Ye.j)(()=>e.patchState({deletingJoinRequest:!1}))).subscribe({next:()=>{e.dispatch(new WC),e.dispatch(new G_)},error:i=>e.dispatch(new XC(i))})}getOrganizationJoinRequests(e,o){e.patchState({loadingOrganizationJoinRequests:!0}),this.usersService.getOrganizationJoinRequests(o.params).pipe((0,Ye.j)(()=>e.patchState({loadingOrganizationJoinRequests:!1}))).subscribe({next:i=>{e.dispatch(new PS(i.join_requests))},error:i=>e.dispatch(new B5(i))})}getOrganizationJoinRequestsSuccess(e,{organizationJoinRequests:o}){e.patchState({organizationJoinRequests:o})}acceptJoinRequests(e,o){const i=o.joinRequests.length;this.usersService.acceptOrganizationJoinRequests(o.joinRequests).subscribe({next:()=>{e.dispatch(new z5(i))},error:s=>e.dispatch(new W5(i,s))})}denyJoinRequests(e,o){const i=o.joinRequestKeys.length;this.usersService.denyOrganizationJoinRequests(o.joinRequestKeys).subscribe({next:()=>{e.dispatch(new X5(i))},error:s=>e.dispatch(new H5(i,s))})}constructor(e,o,i,s){this.usersService=e,this.vendorAnalyticsService=o,this.productService=i,this.authService=s}},LS=lr,lr.\u0275fac=function(e){return new(e||lr)(t.KVO(KC),t.KVO(Qn),t.KVO(Si),t.KVO(Wa))},lr.\u0275prov=t.jDH({token:lr,factory:lr.\u0275fac}),lr);function ZC(n){return e=>{const o=Ri.parseEmails(e.value),i=o.filter(l=>!Ri.validateEmail(l)),s=o.length,r="number"==typeof n&&s>n;let a={};return r&&(a={...a,maxEmailsExceeded:r,currentEmailCount:s}),i.length>0&&(a={...a,invalidEmails:i}),Object.keys(a).length>0?(0,Qe.of)(a):(0,Qe.of)(null)}}ht([(0,c.rc)(kC),H("design:type",Function),H("design:paramtypes",[Object,kC]),H("design:returntype",void 0)],it.prototype,"joinOrganization",null),ht([(0,c.rc)(DC),H("design:type",Function),H("design:paramtypes",[Object,DC]),H("design:returntype",void 0)],it.prototype,"joinOrganizationWithCode",null),ht([(0,c.rc)(LC),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],it.prototype,"joinOrganizationWithCodeSuccess",null),ht([(0,c.rc)(UC),H("design:type",Function),H("design:paramtypes",[Object,UC]),H("design:returntype",void 0)],it.prototype,"leaveOrganization",null),ht([(0,c.rc)(_u),H("design:type",Function),H("design:paramtypes",[Object,_u]),H("design:returntype",void 0)],it.prototype,"sendOrganizationInvite",null),ht([(0,c.rc)(xC),H("design:type",Function),H("design:paramtypes",[Object,xC]),H("design:returntype",void 0)],it.prototype,"getOrganizationUsers",null),ht([(0,c.rc)(CS),H("design:type",Function),H("design:paramtypes",[Object,CS]),H("design:returntype",void 0)],it.prototype,"getOrganizationUsersSuccess",null),ht([(0,c.rc)(GC),H("design:type",Function),H("design:paramtypes",[Object,GC]),H("design:returntype",void 0)],it.prototype,"getOrganizationUserInvites",null),ht([(0,c.rc)(OS),H("design:type",Function),H("design:paramtypes",[Object,OS]),H("design:returntype",void 0)],it.prototype,"getOrganizationUserInvitesSuccess",null),ht([(0,c.rc)(D5),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",void 0)],it.prototype,"resetOrganizations",null),ht([(0,c.rc)($C),H("design:type",Function),H("design:paramtypes",[Object,$C]),H("design:returntype",void 0)],it.prototype,"updateUserRoles",null),ht([(0,c.rc)(FC),H("design:type",Function),H("design:paramtypes",[Object,FC]),H("design:returntype",void 0)],it.prototype,"removeOrganizationUser",null),ht([(0,c.rc)(BC),H("design:type",Function),H("design:paramtypes",[Object,BC]),H("design:returntype",void 0)],it.prototype,"transferOrganizationContent",null),ht([(0,c.rc)(MS),H("design:type",Function),H("design:paramtypes",[Object,MS]),H("design:returntype",void 0)],it.prototype,"clearEligibleJoinOrganizations",null),ht([(0,c.rc)(wS),H("design:type",Function),H("design:paramtypes",[Object,wS]),H("design:returntype",void 0)],it.prototype,"getEligibleJoinOrganizations",null),ht([(0,c.rc)(du),H("design:type",Function),H("design:paramtypes",[Object,du]),H("design:returntype",void 0)],it.prototype,"getEligibleJoinOrganizationsSuccess",null),ht([(0,c.rc)(G_),H("design:type",Function),H("design:paramtypes",[Object,G_]),H("design:returntype",void 0)],it.prototype,"getJoinRequests",null),ht([(0,c.rc)(pu),H("design:type",Function),H("design:paramtypes",[Object,pu]),H("design:returntype",void 0)],it.prototype,"getJoinRequestsSuccess",null),ht([(0,c.rc)(IS),H("design:type",Function),H("design:paramtypes",[Object,IS]),H("design:returntype",void 0)],it.prototype,"postJoinRequest",null),ht([(0,c.rc)(AS),H("design:type",Function),H("design:paramtypes",[Object,AS]),H("design:returntype",void 0)],it.prototype,"deleteJoinRequest",null),ht([(0,c.rc)(HC),H("design:type",Function),H("design:paramtypes",[Object,HC]),H("design:returntype",void 0)],it.prototype,"getOrganizationJoinRequests",null),ht([(0,c.rc)(PS),H("design:type",Function),H("design:paramtypes",[Object,PS]),H("design:returntype",void 0)],it.prototype,"getOrganizationJoinRequestsSuccess",null),ht([(0,c.rc)(QC),H("design:type",Function),H("design:paramtypes",[Object,QC]),H("design:returntype",void 0)],it.prototype,"acceptJoinRequests",null),ht([(0,c.rc)(YC),H("design:type",Function),H("design:paramtypes",[Object,YC]),H("design:returntype",void 0)],it.prototype,"denyJoinRequests",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getUsers",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getInvites",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getUsersLoading",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getJoining",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getLeaving",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getInviting",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getLoadingJoinRequests",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getLoadingOrganizationJoinRequests",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getLoadingEligibleOrganizations",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getPostingJoinRequest",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getDeletingJoinRequest",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getRequesting",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getEligibleOrganizations",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"hasEligibleOrganizations",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getJoinRequests",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getPendingJoinRequest",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getOrganizationJoinRequests",null),ht([(0,c.MD)(),H("design:type",Function),H("design:paramtypes",[_i]),H("design:returntype",void 0)],it,"getPendingOrganizationJoinRequests",null),it=LS=ht([(0,c.Uw)({name:"users",defaults:JC}),H("design:paramtypes",[KC,Qn,Si,Wa])],it);var $_,F_,B_,eO=S(3719),tO=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},nO=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};function J5(n,e){if(1&n&&(t.j41(0,"div",10)(1,"app-message-toggle",11),t.EFF(2),t.k0s()()),2&n){const o=t.XpG(2);t.R7$(2),t.SpI(" ",o.sentResponses.length," invite(s) have been sent. Please allow up to a few minutes for invitees to receive their invitations. ")}}function Z5(n,e){if(1&n&&(t.qex(0),t.DNE(1,J5,3,1,"div",9),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("ngIf",o.sentResponses.length>0)}}function eG(n,e){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const o=e.$implicit;t.R7$(),t.SpI(" ",o," ")}}function tG(n,e){if(1&n&&(t.j41(0,"div",19)(1,"app-message-toggle",20)(2,"div"),t.EFF(3),t.k0s(),t.DNE(4,eG,2,1,"div",21),t.k0s()()),2&n){const o=t.XpG(3);t.R7$(3),t.SpI("There was an error sending ",o.errorResponses.length," invite(s)."),t.R7$(),t.Y8G("ngForOf",o.formatResponses(o.errorResponses))}}function nG(n,e){if(1&n&&(t.j41(0,"div",19)(1,"app-message-toggle",20),t.EFF(2),t.k0s()()),2&n){const o=t.XpG(3);t.R7$(2),t.SpI(" ",o.errorMessage," ")}}function iG(n,e){if(1&n&&(t.j41(0,"div",22)(1,"mat-error"),t.EFF(2),t.k0s()()),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.Lme(" Please limit your entry to ",i.maxEmailCount,". Current count: ",null==o.errors?null:o.errors.currentEmailCount,". ")}}function oG(n,e){if(1&n&&(t.j41(0,"div",22)(1,"mat-error"),t.EFF(2),t.k0s()()),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.Lme(" ",i.formatEmails(null==o.errors?null:o.errors.invalidEmails)," ",1===o.errors.invalidEmails.length?"is not a valid email address.":"are not valid email addresses."," ")}}function sG(n,e){if(1&n&&(t.j41(0,"option",27),t.EFF(1),t.k0s()),2&n){const o=e.$implicit;t.Y8G("value",o.role_id),t.R7$(),t.SpI(" ",o.role_display_name," ")}}function rG(n,e){1&n&&(t.j41(0,"div",22)(1,"mat-error"),t.EFF(2," Please select a valid role. "),t.k0s()())}function aG(n,e){if(1&n&&(t.j41(0,"app-form-field",23)(1,"select",24)(2,"option",25),t.EFF(3,"--"),t.k0s(),t.DNE(4,sG,2,2,"option",26),t.k0s(),t.DNE(5,rG,3,0,"div",17),t.k0s()),2&n){const o=e.$implicit,i=t.XpG(3);t.R7$(4),t.Y8G("ngForOf",i.availableRoles),t.R7$(),t.Y8G("ngIf",o.touched&&o.invalid)}}function lG(n,e){if(1&n&&(t.qex(0,13),t.DNE(1,tG,5,2,"div",14)(2,nG,3,1,"div",14),t.j41(3,"app-form-field",15)(4,"textarea",16),t.EFF(5,"          "),t.k0s(),t.DNE(6,iG,3,2,"div",17)(7,oG,3,2,"div",17),t.k0s(),t.DNE(8,aG,6,2,"app-form-field",18),t.bVm()),2&n){const o=e.$implicit,i=t.XpG(2);t.Y8G("formGroup",i.form),t.R7$(),t.Y8G("ngIf",i.errorResponses.length>0),t.R7$(),t.Y8G("ngIf",i.errorMessage),t.R7$(2),t.Y8G("placeholder","Enter up to "+i.maxEmailCount+" email addresses separated by commas or line breaks"),t.R7$(2),t.Y8G("ngIf",null==o.errors?null:o.errors.maxEmailsExceeded),t.R7$(),t.Y8G("ngIf",null==o.errors?null:o.errors.invalidEmails),t.R7$(),t.Y8G("ngIf",i.form.get("roleId"))}}function cG(n,e){if(1&n&&t.DNE(0,lG,9,7,"ng-container",12),2&n){const o=t.XpG();t.Y8G("ngIf",o.form.get("emails"))}}function _G(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleCancelClick())}),t.EFF(1),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("uppercase","inline"===o.layout),t.R7$(),t.SpI(" ",o.cancelText," ")}}function dG(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",30),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleInviteClick())}),t.EFF(2),t.k0s()}if(2&n){const o=t.XpG(2);t.Y8G("uppercase","inline"===o.layout)("disabled",o.form.invalid||t.bMT(1,3,o.inviting$)),t.R7$(2),t.SpI(" ",o.errorResponses.length>0?"Try Again":o.sendText," ")}}function pG(n,e){1&n&&t.eu8(0)}function uG(n,e){1&n&&t.eu8(0)}function gG(n,e){if(1&n&&(t.qex(0),t.DNE(1,pG,1,0,"ng-container",31)(2,uG,1,0,"ng-container",31),t.bVm()),2&n){t.XpG();const o=t.sdS(3),i=t.sdS(5);t.R7$(),t.Y8G("ngTemplateOutlet",o),t.R7$(),t.Y8G("ngTemplateOutlet",i)}}function hG(n,e){1&n&&t.eu8(0)}function mG(n,e){1&n&&t.eu8(0)}function fG(n,e){if(1&n&&t.DNE(0,hG,1,0,"ng-container",31)(1,mG,1,0,"ng-container",31),2&n){t.XpG();const o=t.sdS(3),i=t.sdS(5);t.Y8G("ngTemplateOutlet",i),t.R7$(),t.Y8G("ngTemplateOutlet",o)}}function SG(n,e){if(1&n&&(t.j41(0,"div")(1,"div",28),t.DNE(2,_G,2,2,"ng-template",null,1,t.C5r)(4,dG,3,5,"ng-template",null,2,t.C5r)(6,gG,3,2,"ng-container",6)(7,fG,2,2,"ng-template",null,3,t.C5r),t.k0s()()),2&n){const o=t.sdS(8),i=t.XpG();t.R7$(6),t.Y8G("ngIf","inline"===i.layout)("ngIfElse",o)}}class gu{get valid(){return this.form.valid}constructor(e,o,i,s){this.store=e,this.actions=o,this.formBuilder=i,this.changeRef=s,this.maxEmailCount=50,this.availableRoles=[],this.layout="inline",this.enableActions=!0,this.sendText="Send invites",this.cancelText="Cancel",this.inviteSent=new t.bkB,this.inviteCancelled=new t.bkB,this.ngUnsubscribe=new oe.B,this.sent=!1,this.sentResponses=[],this.errorResponses=[]}ngOnInit(){this.initForm(),this.initInviteListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.store.dispatch(new Zd),this.currentUserRole=this.store.selectSnapshot(ne.getUserRole),this.userRoles$.pipe((0,X.p)(e=>e.length>0),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.availableRoles=e.filter(o=>op.indexOf(o.role_name)<=op.indexOf(this.currentUserRole.role_name)),this.changeRef.markForCheck()}),this.form=this.formBuilder.group({emails:["",K.k0.required,ZC(this.maxEmailCount).bind(this)],roleId:["",K.k0.required]})}initInviteListeners(){this.actions.pipe((0,c.xi)(_u),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.resetState(),this.changeRef.markForCheck()}),this.actions.pipe((0,c.xi)(VC),(0,w.Q)(this.ngUnsubscribe)).subscribe(({responses:e})=>{this.resetState(),this.sentResponses=e.filter(o=>"success"===o.status),this.errorResponses=e.filter(o=>"error"===o.status),this.sent=0===this.errorResponses.length,this.sent&&this.inviteSent.next(e),this.changeRef.markForCheck()}),this.actions.pipe((0,c.xi)(jC,Ba),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.resetState(),this.errorMessage=xs(e.error)||"There was an error sending the invites, please try again.",this.changeRef.markForCheck()})}handleCancelClick(){this.inviteCancelled.next()}backToFormClick(){this.resetState(),this.changeRef.markForCheck()}handleInviteClick(){const{eid:e}=this.organization,i=Ri.parseEmails(this.form.value.emails).map(s=>({user_email:s,role_id:parseInt(this.form.value.roleId,10)}));this.store.dispatch(new _u(e,i))}formatEmails(e){return e.join(", ")}formatResponses(e){const o=e.map(s=>s.reason);return[...new Set([...o])].map(s=>{const r=e.filter(l=>l.reason===s).map(l=>l.email),a=this.formatEmails(r);return`"${s}": ${a}`})}resetState(){this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.errorMessage=""}}($_=gu).\u0275fac=function(e){return new(e||$_)(t.rXU(c.il),t.rXU(c.En),t.rXU(K.ze),t.rXU(t.gRc))},$_.\u0275cmp=t.VBU({type:$_,selectors:[["app-team-invite"]],inputs:{organization:"organization",layout:"layout",enableActions:"enableActions",sendText:"sendText",cancelText:"cancelText"},outputs:{inviteSent:"inviteSent",inviteCancelled:"inviteCancelled"},ngContentSelectors:["*"],decls:8,vars:7,consts:[["sendFormTmp",""],["cancelBtnTmp",""],["sendBtnTmp",""],["blockBtnTmp",""],[1,"invite"],[1,"theme-light"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"invite__footer"],["class","my-1",4,"ngIf"],[1,"my-1"],["data-test","teamInviteSuccess","type","message"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","mb-4",4,"ngIf"],["theme","light","label","Invite via email"],["formControlName","emails","data-test","teamInviteEmails","rows","8",1,"invite__input","input",3,"placeholder"],["class","mt-1",4,"ngIf"],["theme","light","label","Role",4,"ngIf"],[1,"mb-4"],["type","error"],[4,"ngFor","ngForOf"],[1,"mt-1"],["theme","light","label","Role"],["formControlName","roleId",1,"input"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"invite__buttons"],["app-button","","buttonSize","xl","buttonTheme","light","buttonType","default","data-test","skipInvitesButton",1,"invite__button",3,"click","uppercase"],["app-button","","buttonSize","xl","buttonType","primary","data-test","sendInvitesButton",1,"invite__button",3,"click","uppercase","disabled"],[4,"ngTemplateOutlet"]],template:function(e,o){if(1&e&&(t.NAR(),t.j41(0,"div",4)(1,"div",5),t.DNE(2,Z5,2,1,"ng-container",6)(3,cG,1,1,"ng-template",null,0,t.C5r),t.k0s(),t.DNE(5,SG,9,2,"div",7),t.j41(6,"div",8),t.SdG(7,0,["[select]","invite - footer"]),t.k0s()()),2&e){const i=t.sdS(4);t.AVh("invite--inline","inline"===o.layout)("invite--block","block"===o.layout),t.R7$(2),t.Y8G("ngIf",o.sent)("ngIfElse",i),t.R7$(3),t.Y8G("ngIf",o.enableActions&&!o.sent)}},dependencies:[hi.Q,b.Sq,b.bT,b.T3,I1,eO.TL,K.xH,K.y7,K.me,K.wz,K.BC,K.cb,K.j4,K.JD,Qp,b.Jj],styles:[".invite__input[_ngcontent-%COMP%]{resize:vertical}.invite__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.invite__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.invite__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:8px auto}.invite--inline[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin-left:16px}.invite--inline[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end}.invite--block[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin:16px 0}.invite--block[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end;flex-direction:column}"],changeDetection:0}),tO([(0,c.l6)(it.getInviting),nO("design:type",f.c)],gu.prototype,"inviting$",void 0),tO([(0,c.l6)(ne.getUserRoles),nO("design:type",f.c)],gu.prototype,"userRoles$",void 0);class US{constructor(e,o,i){this.clipboardService=e,this.changeRef=o,this.snackbar=i,this.ngUnsubscribe=new oe.B,this.copyErrorMessage="There was a problem copying to the clipboard."}ngOnInit(){this.groupCode$.pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.groupCode=e,this.signupLink=`https://${window.location.host}/login/create?code=${e}`,this.changeRef.markForCheck()})}handleCopyCodeClick(e){e.preventDefault(),this.clipboardService.copyToClipboard(this.groupCode,"text").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.snackbar.open(o?"Team invite code copied to your clipboard.":this.copyErrorMessage)})}handleCopyLinkClick(e){e.preventDefault(),this.clipboardService.copyToClipboard(this.signupLink,"url").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(o=>{this.snackbar.open(o?"Team invite link copied to your clipboard.":this.copyErrorMessage)})}}function TG(n,e){1&n&&t.eu8(0)}function CG(n,e){1&n&&t.eu8(0)}function OG(n,e){if(1&n){const o=t.RV6();t.j41(0,"div",11)(1,"app-team-invite",12),t.bIt("inviteSent",function(s){t.eBV(o);const r=t.XpG();return t.Njj(r.handleInviteSent(s))})("inviteCancelled",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.handleInviteCancelled())}),t.k0s()()}if(2&n){const o=t.XpG();t.R7$(),t.Y8G("organization",o.organization)("layout","inline")}}function wG(n,e){1&n&&(t.j41(0,"div",13),t.nrm(1,"app-team-group-code"),t.k0s())}(F_=US).\u0275fac=function(e){return new(e||F_)(t.rXU(Np),t.rXU(t.gRc),t.rXU(ho.UG))},F_.\u0275cmp=t.VBU({type:F_,selectors:[["app-team-group-code"]],decls:10,vars:6,consts:[[1,"team-group-code","text-sm","mb-4"],[1,"flex","mb-3"],["type","text",1,"team-group-code__input","input",3,"readonly","value"],["app-button","","buttonSize","md","buttonTheme","light","buttonType","primary",1,"team-group-code__button","ml-4",3,"click","uppercase"],[1,"flex"],["type","text",1,"team-group-code__input","input","underline",3,"readonly","value"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.EFF(1," Share this code or invite link so people can join your team directly.\n"),t.k0s(),t.j41(2,"div",1),t.nrm(3,"input",2),t.j41(4,"button",3),t.bIt("click",function(s){return o.handleCopyCodeClick(s)}),t.EFF(5," Copy Code "),t.k0s()(),t.j41(6,"div",4),t.nrm(7,"input",5),t.j41(8,"button",3),t.bIt("click",function(s){return o.handleCopyLinkClick(s)}),t.EFF(9," Copy Link "),t.k0s()()),2&e&&(t.R7$(3),t.Y8G("readonly",!0)("value",o.groupCode),t.R7$(),t.Y8G("uppercase",!0),t.R7$(3),t.Y8G("readonly",!0)("value",o.signupLink),t.R7$(),t.Y8G("uppercase",!0))},dependencies:[hi.Q],styles:[".team-group-code__input[_ngcontent-%COMP%]{background-color:#eaeff5!important}.team-group-code__button[_ngcontent-%COMP%]{flex:0 0 112px}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(ve.getOrganizationGroupCode),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],US.prototype,"groupCode$",void 0);class VS{constructor(e,o){this.dialogRef=e,this.data=o,this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.ngUnsubscribe=new oe.B,this.organization=o.organization}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleInviteSent(e){setTimeout(()=>{this.inviteComplete()},5e3)}handleInviteCancelled(){this.inviteComplete()}inviteComplete(){this.dialogRef.close()}}(B_=VS).\u0275fac=function(e){return new(e||B_)(t.rXU(pt.CP),t.rXU(pt.Vh))},B_.\u0275cmp=t.VBU({type:B_,selectors:[["app-team-invite-dialog"]],decls:15,vars:4,consts:[["inviteTmpl",""],["groupCodeTmpl",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"dialog__close",3,"click"],["icon","times","size","lg"],["tabSize","medium","tabTheme","light","tabColor","red",3,"tabUnderline"],["label","Invite By Email"],[4,"ngTemplateOutlet"],["label","Share Code or Link"],[1,"theme-light","pt-6"],["sentText","Send invites","cancelText","Cancel",3,"inviteSent","inviteCancelled","organization","layout"],[1,"theme-light","py-6"]],template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"h1",2),t.EFF(1,"Invite Members"),t.k0s(),t.j41(2,"div",3)(3,"div",4)(4,"button",5),t.bIt("click",function(){return t.eBV(i),t.Njj(o.handleInviteCancelled())}),t.nrm(5,"app-icon",6),t.k0s(),t.j41(6,"app-tabs",7)(7,"app-tab",8),t.DNE(8,TG,1,0,"ng-container",9),t.k0s(),t.j41(9,"app-tab",10),t.DNE(10,CG,1,0,"ng-container",9),t.k0s()(),t.DNE(11,OG,2,2,"ng-template",null,0,t.C5r)(13,wG,2,0,"ng-template",null,1,t.C5r),t.k0s()()}if(2&e){const i=t.sdS(12),s=t.sdS(14);t.R7$(4),t.BMQ("aria-label","Close"),t.R7$(2),t.Y8G("tabUnderline",!0),t.R7$(2),t.Y8G("ngTemplateOutlet",i),t.R7$(2),t.Y8G("ngTemplateOutlet",s)}},dependencies:[b.T3,pt.BI,pt.Yi,hi.Q,qe,GE.j,$E.O,gu,US],styles:[".dialog[_ngcontent-%COMP%]{width:480px}.dialog__input[_ngcontent-%COMP%]{resize:vertical}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.dialog__close[_ngcontent-%COMP%]{position:absolute;right:24px;top:24px}@media (max-width: 480px){.dialog[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(it.getInviting),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],VS.prototype,"inviting$",void 0);let iO=(()=>{class e{constructor(){}}return e.type="[Share] Reset",e})(),hu=(()=>{class e{constructor(i){this.shareEmail=i}}return e.type="[Share] Share Email Link",e})(),oO=(()=>{class e{constructor(i){this.shareEmail=i}}return e.type="[Share] Share Email Link Success",e})(),sO=(()=>{class e{constructor(i){this.error=i}}return e.type="[Share] Share Email Link Fail",e})();var cr=function(n){return n.Facebook="facebook",n.LinkedIn="linkedin",n.Twitter="twitter",n}(cr||{}),jS=function(n){return n.Model="model",n.Quiz="quiz",n}(jS||{});let rO=(()=>{var n;class e{constructor(i,s){this.http=i,this.APP_BASE_URL=s}shareEmailLink(i){return this.http.post("/ws/user/share/email",i)}generateShareLink(i,s="en"){const r=i.thumbnail_url.replace("/small/","/large/");return{type:i.quiz?jS.Quiz:jS.Model,title:i.title,relativeUrl:this.createShareUrl(i,"share",s,!1,!1),fullUrl:this.createShareUrl(i,"share",s,!0,!1),thumbUrl:r,social:[{type:cr.Facebook,url:`https://www.facebook.com/sharer/sharer.php?u=${this.createShareUrl(i,cr.Facebook,s,!0,!0)}`},{type:cr.LinkedIn,url:`https://www.linkedin.com/sharing/share-offsite/?url=${this.createShareUrl(i,cr.LinkedIn,s,!0,!0)}`},{type:cr.Twitter,url:`http://twitter.com/share?url=${this.createShareUrl(i,cr.Twitter,s,!0,!0)}`}]}}createShareUrl(i,s,r,a,l){const _=i.id.replace(".json",""),d=Object.values(cr).includes(s),u=`/view?id=${_}&lang=${r}&ref=${s}`,g=a||d?`${d?"https://human.biodigital.com":this.APP_BASE_URL}${u}`:u;return l?encodeURIComponent(g):g}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO($e.Qq),t.KVO(Mm))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var da,mu=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Bo=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const aO={sharing:!1};let bl=((da=class{static getSharing(e){return e.sharing}resetShare(e,o){e.setState(aO)}sendEmail(e,{shareEmail:o}){e.patchState({sharing:!0}),this.authService.verifyIsHuman("share_email").pipe((0,At.Z)(({isHuman:i,verification:s})=>{if(!i)throw new Do;return this.shareService.shareEmailLink({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,site_verify_response:s,...o})}),(0,Ye.j)(()=>e.patchState({sharing:!1}))).subscribe({next:()=>{e.dispatch(new oO(o))},error:i=>{i instanceof Do&&e.dispatch(new Ba(i)),e.dispatch(new sO(i))}})}constructor(e,o,i){this.shareService=e,this.productService=o,this.authService=i}}).\u0275fac=function(e){return new(e||da)(t.KVO(rO),t.KVO(Si),t.KVO(Wa))},da.\u0275prov=t.jDH({token:da,factory:da.\u0275fac}),da);mu([(0,c.rc)(iO),Bo("design:type",Function),Bo("design:paramtypes",[Object,iO]),Bo("design:returntype",void 0)],bl.prototype,"resetShare",null),mu([(0,c.rc)(hu),Bo("design:type",Function),Bo("design:paramtypes",[Object,hu]),Bo("design:returntype",void 0)],bl.prototype,"sendEmail",null),mu([(0,c.MD)(),Bo("design:type",Function),Bo("design:paramtypes",[class MG{}]),Bo("design:returntype",void 0)],bl,"getSharing",null),bl=mu([(0,c.Uw)({name:"share",defaults:aO}),Bo("design:paramtypes",[rO,Si,Wa])],bl);var z_,lO=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},cO=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};const IG=["emailField"];function AG(n,e){1&n&&(t.qex(0),t.j41(1,"div",15)(2,"app-message-toggle",16),t.EFF(3," Your email was successfully sent. "),t.k0s()(),t.bVm())}function PG(n,e){if(1&n&&(t.j41(0,"div",15)(1,"app-message-toggle",22),t.EFF(2),t.k0s()()),2&n){const o=t.XpG(3);t.R7$(2),t.SpI(" ",o.errorMessage," ")}}function NG(n,e){1&n&&t.nrm(0,"app-spinner",23)}function RG(n,e){1&n&&(t.j41(0,"div",25)(1,"mat-error"),t.EFF(2,"Please enter a valid email address."),t.k0s()())}function kG(n,e){if(1&n&&(t.j41(0,"div",27)(1,"mat-error"),t.EFF(2),t.k0s()()),2&n){const o=t.XpG(2).$implicit,i=t.XpG(3);t.R7$(2),t.Lme(" Maximum email addresses excceeded, ",o.currentEmailCount," of ",i.maxEmailCount," max. ")}}function DG(n,e){if(1&n&&t.DNE(0,kG,3,2,"div",26),2&n){const o=t.XpG().$implicit;t.Y8G("ngIf",o.maxEmailsExceeded)}}function LG(n,e){if(1&n&&(t.qex(0),t.DNE(1,RG,3,0,"div",24)(2,DG,1,1,"ng-template",null,2,t.C5r),t.bVm()),2&n){const o=e.$implicit,i=t.sdS(3);t.R7$(),t.Y8G("ngIf",o.invalidEmails)("ngIfElse",i)}}function UG(n,e){if(1&n){const o=t.RV6();t.DNE(0,PG,3,1,"div",17),t.j41(1,"form",18),t.bIt("submit",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.submitForm(s.config.shareLink))}),t.j41(2,"textarea",19,1),t.EFF(4,"          "),t.k0s(),t.j41(5,"button",20),t.nI1(6,"async"),t.DNE(7,NG,1,0,"app-spinner",21),t.nI1(8,"async"),t.EFF(9),t.nI1(10,"async"),t.k0s()(),t.DNE(11,LG,4,2,"ng-container",6)}if(2&n){const o=t.XpG(2);t.Y8G("ngIf",o.errorMessage),t.R7$(),t.Y8G("formGroup",o.form),t.R7$(4),t.Y8G("disabled",!o.form.valid||t.bMT(6,7,o.sharing$)),t.BMQ("aria-label","Send Email"),t.R7$(2),t.Y8G("ngIf",t.bMT(8,9,o.sharing$)),t.R7$(2),t.SpI(" ",t.bMT(10,11,o.sharing$)?"Sending":"Send Email"," "),t.R7$(2),t.Y8G("ngIf",o.form.get("emails").errors)}}function VG(n,e){if(1&n&&(t.qex(0),t.DNE(1,AG,4,0,"ng-container",14)(2,UG,12,13,"ng-template",null,0,t.C5r),t.bVm()),2&n){const o=t.sdS(3),i=t.XpG();t.R7$(),t.Y8G("ngIf",i.emailSent)("ngIfElse",o)}}function jG(n,e){if(1&n&&(t.j41(0,"a",28),t.nI1(1,"titlecase"),t.nI1(2,"titlecase"),t.nrm(3,"img",9),t.k0s()),2&n){const o=e.$implicit;t.Y8G("href",o.url,t.B4B)("matTooltip","Share via "+t.bMT(1,5,o.type)),t.BMQ("aria-label","Share via "+t.bMT(2,7,o.type))("data-test",o.type+"LinkButton"),t.R7$(3),t.Y8G("src","/assets/images/social/"+o.type+"-share.svg",t.B4B)}}function xG(n,e){if(1&n&&(t.j41(0,"p",29),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.config.description," ")}}class fu{constructor(e,o,i,s,r,a,l,_){this.store=e,this.actions=o,this.dialogRef=i,this.data=s,this.clipboardService=r,this.snackBar=a,this.formBuilder=l,this.changeRef=_,this.maxEmailCount=50,this.config={title:"Share"},this.emailSent=!1,this.errorMessage="",this.formError="",this.ngUnsubscribe=new oe.B,this.config={...this.config,...s},this.initForm()}ngOnInit(){this.initEmailListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({emails:["",K.k0.required,ZC(this.maxEmailCount).bind(this)]})}initEmailListeners(){this.actions.pipe((0,c.xi)(hu),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!1,this.errorMessage="",this.changeRef.markForCheck()}),this.actions.pipe((0,c.xi)(oO),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!0,this.errorMessage="",setTimeout(()=>{this.emailSent=!1,this.form.setValue({emails:""}),this.changeRef.markForCheck(),setTimeout(()=>this.focus())},5e3),this.changeRef.markForCheck()}),this.actions.pipe((0,c.xi)(sO),(0,w.Q)(this.ngUnsubscribe)).subscribe(e=>{this.emailSent=!1,this.errorMessage=xs(e.error)||"There was an error sending the email.",setTimeout(()=>this.focus()),this.changeRef.markForCheck()})}focus(){const e=this.emailField?.nativeElement;e&&e.focus()}submitForm(e){const{type:o,title:i,relativeUrl:s,thumbUrl:r}=e,a=Ri.parseEmails(this.form.value.emails);this.store.dispatch(new hu({share_type:o,share_title:i,share_thumbnail_path:r,share_link_path:s,share_emails:a}))}handleCopyClick(e,o){this.clipboardService.copyToClipboard(e,"url").pipe((0,w.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(`Link ${i?"copied":"not copied"}.`)}),o.preventDefault()}handleCloseClick(){this.dialogRef.close()}}function GG(n,e){if(1&n&&t.nrm(0,"img",17),2&n){const o=t.XpG().$implicit;t.Y8G("src",o.logo,t.B4B)}}function $G(n,e){if(1&n&&(t.j41(0,"h2",18),t.EFF(1),t.k0s()),2&n){const o=t.XpG().$implicit;t.R7$(),t.SpI(" ",o.title," ")}}function FG(n,e){if(1&n&&t.nrm(0,"p",19),2&n){const o=t.XpG().$implicit;t.AVh("text-xl",o.logo)("font-medium",o.logo),t.Y8G("innerHTML",o.text,t.npT)}}function BG(n,e){if(1&n&&t.nrm(0,"img",20),2&n){const o=t.XpG().$implicit;t.Y8G("src",o.image,t.B4B)}}function zG(n,e){if(1&n&&(t.j41(0,"div",12),t.DNE(1,GG,1,1,"img",13)(2,$G,2,1,"h2",14)(3,FG,1,5,"p",15)(4,BG,1,1,"img",16),t.k0s()),2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.AVh("slide__item--hidden",s.selectedIndex!==i),t.R7$(),t.Y8G("ngIf",o.logo),t.R7$(),t.Y8G("ngIf",o.title),t.R7$(),t.Y8G("ngIf",o.text),t.R7$(),t.Y8G("ngIf",o.image)}}function WG(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",21),t.bIt("click",function(){const s=t.eBV(o).index,r=t.XpG();return t.Njj(r.handleSelectSlideClick(s))}),t.k0s()}if(2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.AVh("slide__nav-dot--active",s.selectedIndex===i),t.BMQ("title",o.title)("aria-label",o.title)}}(z_=fu).\u0275fac=function(e){return new(e||z_)(t.rXU(c.il),t.rXU(c.En),t.rXU(pt.CP),t.rXU(pt.Vh),t.rXU(Np),t.rXU(ho.UG),t.rXU(K.ok),t.rXU(t.gRc))},z_.\u0275cmp=t.VBU({type:z_,selectors:[["app-share-url-dialog"]],viewQuery:function(e,o){if(1&e&&t.GBs(IG,5),2&e){let i;t.mGM(i=t.lsd())&&(o.emailField=i.first)}},decls:14,vars:9,consts:[["emailFormTmp",""],["emailField",""],["maxEmailErrorTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"share-url-dialog"],[4,"ngIf"],[1,"share-url-dialog__social"],["target","_blank","aria-label","Copy Link","matTooltip","Copy Link","matTooltipPosition","below","data-test","copyLinkButton",1,"share-url-dialog__social-link",3,"click","href"],[3,"src"],["class","share-url-dialog__social-link","target","_blank","matTooltipPosition","below",3,"href","matTooltip",4,"ngFor","ngForOf"],["class","share-url-dialog__description my-3",4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonType","flat","buttonTheme","light","type","button","title","Close",1,"share-url-dialog__close",3,"click"],[4,"ngIf","ngIfElse"],[1,"my-2"],["type","message"],["class","my-2",4,"ngIf"],[1,"share-url-dialog__form",3,"submit","formGroup"],["rows","1","formControlName","emails","placeholder","Email, comma separated","data-test","emailEntryField",1,"share-url-dialog__input","input","theme-light"],["type","submit","app-button","","buttonType","primary","title","'Send Email'","data-test","emailLinkButton",1,"share-url-dialog__submit",3,"disabled"],["size","small","class","mr-2","render","inline",4,"ngIf"],["type","error"],["size","small","render","inline",1,"mr-2"],["class","my-1",4,"ngIf","ngIfElse"],[1,"my-1"],["class","flex flex-col my-1",4,"ngIf"],[1,"flex","flex-col","my-1"],["target","_blank","matTooltipPosition","below",1,"share-url-dialog__social-link",3,"href","matTooltip"],[1,"share-url-dialog__description","my-3"]],template:function(e,o){1&e&&(t.j41(0,"h1",3),t.EFF(1),t.k0s(),t.j41(2,"div",4)(3,"div",5),t.DNE(4,VG,4,2,"ng-container",6),t.nI1(5,"async"),t.j41(6,"div",7)(7,"a",8),t.bIt("click",function(s){return o.handleCopyClick(null==o.config.shareLink?null:o.config.shareLink.fullUrl,s)}),t.nrm(8,"img",9),t.k0s(),t.DNE(9,jG,4,9,"a",10),t.k0s(),t.DNE(10,xG,2,1,"p",11),t.k0s()(),t.j41(11,"div",12)(12,"button",13),t.bIt("click",function(){return o.handleCloseClick()}),t.EFF(13," Close "),t.k0s()()),2&e&&(t.R7$(),t.JRh(o.config.title),t.R7$(3),t.Y8G("ngIf",t.bMT(5,7,o.userProfile$)),t.R7$(3),t.Y8G("href",null==o.config.shareLink?null:o.config.shareLink.fullUrl,t.B4B),t.R7$(),t.Y8G("src","/assets/images/social/link-share.svg",t.B4B),t.R7$(),t.Y8G("ngForOf",null==o.config.shareLink?null:o.config.shareLink.social),t.R7$(),t.Y8G("ngIf",o.config.description),t.R7$(2),t.BMQ("aria-label","Close"))},dependencies:[b.Sq,b.bT,eO.TL,pt.BI,pt.E7,pt.Yi,Sn.oV,hi.Q,Jr,Qp,K.qT,K.me,K.BC,K.cb,K.j4,K.JD,b.Jj,b.PV],styles:[".share-url-dialog__description[_ngcontent-%COMP%]{color:#61779e;font-size:.75rem;line-height:1rem}.share-url-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:12px}.share-url-dialog__submit[_ngcontent-%COMP%]{flex:1 0 120px}.share-url-dialog__social[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;margin-top:32px;margin-bottom:20px}.share-url-dialog__social-link[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:100%;cursor:pointer}.share-url-dialog__social-link[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.share-url-dialog__social-link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.share-url-dialog__input[_ngcontent-%COMP%], .share-url-dialog__input[_ngcontent-%COMP%]:disabled{background-color:#f9fafd;color:#61779e;font-size:.75rem;line-height:1rem;opacity:1;resize:vertical;max-height:240px}@media (max-width: 480px){.share-url-dialog__form[_ngcontent-%COMP%]{flex-wrap:wrap}}"],changeDetection:0}),lO([(0,c.l6)(ne.getUserProfile),cO("design:type",f.c)],fu.prototype,"userProfile$",void 0),lO([(0,c.l6)(bl.getSharing),cO("design:type",f.c)],fu.prototype,"sharing$",void 0);var Su=function(n){return n[n.NewUser=0]="NewUser",n[n.ExistingUser=1]="ExistingUser",n[n.Group=2]="Group",n}(Su||{});const XG=[{text:"We make it easy to visualize the human body<br/> for your educational needs - all in interactive 3D.",logo:"/assets/images/biodigital-logo.svg"},{title:"Explore",text:"Browse our digital library for 3D models to complement your curriculum.",image:"/assets/images/welcome-tour-explore.jpg"},{title:"Customize",text:"Use our authoring tools to create 3D views tailored to your educational goals.",image:"/assets/images/welcome-tour-customize.jpg"},{title:"Collaborate",text:"Share your saved 3D views with your team from a central Library.",image:"/assets/images/welcome-tour-collaborate.jpg"},{title:"Integrate",text:"Publish your interactive 3D model and drop into your digital content.",image:"/assets/images/welcome-tour-integrate.jpg"}],HG=[{title:"Introducing Human Studio",text:"The first product for authoring custom interactive 3D models of anatomy, disease and treatments.",image:"/assets/images/studio-tour-studio.jpg"},{title:"Interactive Labels",text:"Quickly add anatomical labels to call out key learning objectives.",image:"/assets/images/studio-tour-labels.jpg"},{title:"Paint",text:"Customize the look and feel of your 3D model by applying different paint effects to anatomical structures.",image:"/assets/images/studio-tour-paint.jpg"},{title:"Tour Builder",text:"Tell an interactive story by stringing together different views of your 3D model.",image:"/assets/images/studio-tour-tour.jpg"},{title:"Text Manager",text:"Add or modify text from one dedicated place.",image:"/assets/images/studio-tour-text.jpg"}];let QG=(()=>{var n;class e{get isFirstSlide(){return 0===this.selectedIndex}get isLastSlide(){return this.selectedIndex===this.slides.length-1}constructor(i,s,r){switch(this.store=i,this.dialogRef=s,this.data=r,this.ngUnsubscribe=new oe.B,this.settings={userType:Su.NewUser},this.slides=[],this.selectedIndex=0,this.settings={...this.settings,...r},this.settings.userType){case Su.NewUser:this.slides=XG;break;case Su.ExistingUser:this.slides=HG}}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCloseTour(){this.close()}close(){this.dialogRef.close()}handleSelectSlideClick(i){this.selectedIndex=i}handleNextClick(){this.incrementSelectedIndex(1)}handlePrevClick(){this.incrementSelectedIndex(-1)}incrementSelectedIndex(i){this.selectedIndex=Math.max(0,this.selectedIndex+i)%this.slides.length}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(c.il),t.rXU(pt.CP),t.rXU(pt.Vh))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-welcome-tour-dialog"]],decls:12,vars:8,consts:[["role","dialog","aria-modal","true","data-test","welcomeTour",1,"welcome"],[1,"slide"],["class","slide__item",3,"slide__item--hidden",4,"ngFor","ngForOf"],[1,"slide__nav"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Previous Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-left","size","md"],[1,"slide__nav-dots"],["type","button","class","slide__nav-dot",3,"slide__nav-dot--active","click",4,"ngFor","ngForOf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Next Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-right","size","md"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close","data-test","welcomeTourClose",1,"welcome__close",3,"click"],["icon","times","size","lg"],[1,"slide__item"],["class","slide__logo",3,"src",4,"ngIf"],["class","text-2xl uppercase mt-4",4,"ngIf"],["class","text-lg mt-4 mb-4",3,"text-xl","font-medium","innerHTML",4,"ngIf"],["class","slide__image",3,"src",4,"ngIf"],[1,"slide__logo",3,"src"],[1,"text-2xl","uppercase","mt-4"],[1,"text-lg","mt-4","mb-4",3,"innerHTML"],[1,"slide__image",3,"src"],["type","button",1,"slide__nav-dot",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,zG,5,6,"div",2),t.j41(3,"div",3)(4,"button",4),t.bIt("click",function(){return s.handlePrevClick()}),t.nrm(5,"app-icon",5),t.k0s(),t.j41(6,"div",6),t.DNE(7,WG,1,4,"button",7),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){return s.handleNextClick()}),t.nrm(9,"app-icon",9),t.k0s()()(),t.j41(10,"button",10),t.bIt("click",function(){return s.handleCloseTour()}),t.nrm(11,"app-icon",11),t.k0s()()),2&i&&(t.BMQ("aria-label","Welcome Tour"),t.R7$(2),t.Y8G("ngForOf",s.slides),t.R7$(2),t.Y8G("disabled",s.isFirstSlide),t.BMQ("aria-label","Previous Slide"),t.R7$(3),t.Y8G("ngForOf",s.slides),t.R7$(),t.Y8G("disabled",s.isLastSlide),t.BMQ("aria-label","Next Slide"),t.R7$(2),t.BMQ("aria-label","Close"))},dependencies:[b.Sq,b.bT,hi.Q,qe],styles:[".welcome[_ngcontent-%COMP%]{position:relative;display:flex;align-items:flex-end;flex-direction:column;padding:24px}.welcome__close[_ngcontent-%COMP%]{position:absolute;top:24px;right:24px}.slide[_ngcontent-%COMP%]{width:800px;height:600px;position:relative;margin:auto;display:flex;flex-direction:column;justify-content:space-between}.slide__item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.slide__item--hidden[_ngcontent-%COMP%]{display:none}.slide__logo[_ngcontent-%COMP%]{width:300px;margin:160px 0 40px}.slide__image[_ngcontent-%COMP%]{flex:2;overflow:auto;width:100%}.slide__nav[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:16px;margin:12px 0}.slide__nav-arrow[_ngcontent-%COMP%]{cursor:pointer;margin:auto 12px;opacity:.8}.slide__nav-arrow[_ngcontent-%COMP%]:hover:not([disabled]){opacity:1}.slide__nav-dots[_ngcontent-%COMP%]{display:flex}.slide__nav-dot[_ngcontent-%COMP%]{margin:auto 4px;cursor:pointer;display:flex;background-color:#1c2a3f66;border-radius:50%;border:none;width:14px;height:14px;line-height:17px}.slide__nav-dot[_ngcontent-%COMP%]:hover{background-color:#1c2a3f99}.slide__nav-dot--active[_ngcontent-%COMP%]{background-color:#2d72dc}@media (max-width: 1024px){.slide[_ngcontent-%COMP%]{width:100%;height:80vh}}"],changeDetection:0}),e})();var W_;const KG=(n,e,o,i)=>({"team-join--compact":n,"team-join--readonly":e,"team-join--theme-dark":o,"team-join--theme-light":i});function JG(n,e){1&n&&(t.j41(0,"div",3),t.nrm(1,"app-spinner",4),t.k0s())}function ZG(n,e){if(1&n&&(t.j41(0,"div",12),t.nrm(1,"img",13),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("src",o.pendingJoinOrganization.logoUrl,t.B4B)}}function e$(n,e){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.pendingJoinOrganization.name," ")}}function t$(n,e){if(1&n&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.SpI(" ",o.pendingJoinOrganization.members," ")}}function n$(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.handleCancelJoinClick(s.pendingJoinRequest.join_request_key))}),t.EFF(1," Cancel Request "),t.k0s()}}function i$(n,e){if(1&n&&(t.qex(0),t.nrm(1,"app-html",5),t.j41(2,"div",6)(3,"div",7),t.DNE(4,ZG,2,1,"div",8)(5,e$,2,1,"div",9)(6,t$,2,1,"div",10),t.k0s(),t.DNE(7,n$,2,0,"button",11),t.k0s(),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("markdownText",o.joinRequestText),t.R7$(3),t.Y8G("ngIf",o.pendingJoinOrganization.logoUrl),t.R7$(),t.Y8G("ngIf",!o.compact||!o.pendingJoinOrganization.logoUrl),t.R7$(),t.Y8G("ngIf",!o.compact),t.R7$(),t.Y8G("ngIf",!o.readonly)}}function o$(n,e){if(1&n&&(t.j41(0,"div",12),t.nrm(1,"img",13),t.k0s()),2&n){const o=t.XpG(2).$implicit;t.R7$(),t.Y8G("src",o.logoUrl,t.B4B)}}function s$(n,e){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",o.name," ")}}function r$(n,e){if(1&n&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&n){const o=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",o.members," ")}}function a$(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",21),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2).$implicit,r=t.XpG(2);return t.Njj(r.handleRequestJoinClick(s.id))}),t.EFF(1," Request to Join "),t.k0s()}}function l$(n,e){if(1&n&&(t.j41(0,"div",6)(1,"div",7),t.DNE(2,o$,2,1,"div",8)(3,s$,2,1,"div",9)(4,r$,2,1,"div",10),t.k0s(),t.DNE(5,a$,2,0,"button",20),t.k0s()),2&n){const o=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.Y8G("ngIf",o.logoUrl),t.R7$(),t.Y8G("ngIf",!i.compact||!o.logoUrl),t.R7$(),t.Y8G("ngIf",!i.compact),t.R7$(),t.Y8G("ngIf",!i.readonly)}}function c$(n,e){if(1&n&&(t.j41(0,"div"),t.DNE(1,l$,6,4,"div",19),t.k0s()),2&n){const o=e.index,i=t.XpG(2);t.R7$(),t.Y8G("ngIf",0===o||i.showAllOrganizations)}}function _$(n,e){if(1&n){const o=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){t.eBV(o);const s=t.XpG(2);return t.Njj(s.toggleShowAllOrganizations())}),t.j41(1,"div",23),t.EFF(2),t.nrm(3,"app-icon",24),t.k0s()()}if(2&n){const o=t.XpG(2);t.Y8G("uppercase",!1),t.R7$(2),t.SpI(" ",o.toggleText," "),t.R7$(),t.Y8G("icon",o.showAllOrganizations?"caret-up":"caret-down")}}function d$(n,e){if(1&n&&(t.qex(0),t.nrm(1,"app-html",5),t.DNE(2,c$,2,1,"div",17)(3,_$,4,3,"button",18),t.bVm()),2&n){const o=t.XpG();t.R7$(),t.Y8G("markdownText",o.requestOrganizationsText),t.R7$(),t.Y8G("ngForOf",o.requestOrganizations),t.R7$(),t.Y8G("ngIf",o.showToggle)}}class xS{get joinRequestText(){if(this._joinRequestText)return this._joinRequestText;{let e=this.pendingJoinOrganization?.name;return e=e?`${e} team`:"team",`Your request to join the ${e} is pending approval from a team administrator. It will automatically expire in 14 days if not approved.`}}set joinRequestText(e){this._joinRequestText=e}constructor(e,o,i,s){this.changeDetectorRef=e,this.store=o,this.actions=i,this.snackBar=s,this.readonly=!1,this.compact=!1,this.theme="dark",this.organizations=[],this._joinRequestText="",this.requestOrganizationsText="It looks like some of your teammates are already using the BioDigital Human.",this.pendingJoinRequestSuccess=new t.bkB,this.requestOrganizationsSuccess=new t.bkB,this.joinRequestsLoaded=!1,this.requestOrganizations=[],this.showAllOrganizations=!1,this.showToggle=!1,this.showMoreText="",this.ngUnsubscribe=new oe.B}get showPendingRequest(){return void 0!==this.pendingJoinRequest}get showRequestOrganizations(){return void 0===this.pendingJoinRequest&&this.requestOrganizations.length>0}get toggleText(){return this.showAllOrganizations?"Show less":this.showMoreText}ngOnInit(){this.initEventListeners(),this.initRequests()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initRequests(){this.showAllOrganizations=!this.compact,0===this.organizations.length?this.store.dispatch(new G_):this.createRequestOrganizations(this.organizations)}initEventListeners(){this.actions.pipe((0,c.xi)(pu),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetJoinRequestsSuccess()),this.actions.pipe((0,c.xi)(du),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetEligibleOrganizationsSuccess()),this.actions.pipe((0,c.xi)(WC),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Join request successfully cancelled.")}),this.actions.pipe((0,c.xi)(XC),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with cancelling the request.")}),this.actions.pipe((0,c.xi)(zC),(0,w.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with making this request.")})}handleRequestJoinClick(e){this.store.dispatch(new IS(e))}handleCancelJoinClick(e){this.store.dispatch(new AS(e))}toggleShowAllOrganizations(){this.showAllOrganizations=!this.showAllOrganizations}handleGetJoinRequestsSuccess(){this.joinRequestsLoaded=!0,this.pendingJoinRequest=this.store.selectSnapshot(it.getPendingJoinRequest),this.pendingJoinRequest?this.pendingJoinOrganization=this.createDisplayOrganization(this.pendingJoinRequest.request_organization):this.store.dispatch(new wS),this.pendingJoinRequestSuccess.next(this.pendingJoinRequest),this.changeDetectorRef.markForCheck()}handleGetEligibleOrganizationsSuccess(){this.createRequestOrganizations(this.store.selectSnapshot(it.getEligibleOrganizations)),this.requestOrganizationsSuccess.next(this.requestOrganizations),this.changeDetectorRef.markForCheck()}createRequestOrganizations(e){this.showToggle=this.compact&&e.length>1;const o=e.length-1;this.showMoreText=`Show ${o} more team${1===o?"":"s"}`,this.requestOrganizations=e.map(this.createDisplayOrganization,this),this.requestOrganizations.sort((i,s)=>s.logoUrl&&!i.logoUrl?1:-1),this.changeDetectorRef.markForCheck()}createDisplayOrganization(e){return{id:e.organization_id,name:e.organization_name,logoUrl:e.group_logos.default,members:`${e.users_count} member${1===e.users_count?"":"s"}`}}}(W_=xS).\u0275fac=function(e){return new(e||W_)(t.rXU(t.gRc),t.rXU(c.il),t.rXU(c.En),t.rXU(ho.UG))},W_.\u0275cmp=t.VBU({type:W_,selectors:[["app-team-join"]],inputs:{readonly:"readonly",compact:"compact",theme:"theme",organizations:"organizations",joinRequestText:"joinRequestText",requestOrganizationsText:"requestOrganizationsText"},outputs:{pendingJoinRequestSuccess:"pendingJoinRequestSuccess",requestOrganizationsSuccess:"requestOrganizationsSuccess"},decls:7,vars:15,consts:[[1,"team-join",3,"ngClass"],["class","my-6",4,"ngIf"],[4,"ngIf"],[1,"my-6"],["size","huge"],[1,"team-join__text","block","my-4",3,"markdownText"],[1,"team-join__organization","flex","justify-between","mb-3"],[1,"team-join__organization-info","flex","flex-col"],["class","mb-3",4,"ngIf"],["class","team-join__organization-name",4,"ngIf"],["class","team-join__organization-members",4,"ngIf"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click",4,"ngIf"],[1,"mb-3"],[1,"team-join__organization-logo",3,"src"],[1,"team-join__organization-name"],[1,"team-join__organization-members"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click"],[4,"ngFor","ngForOf"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"uppercase","click",4,"ngIf"],["class","team-join__organization flex justify-between mb-3",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"click","uppercase"],[1,"text-sm","underline"],[1,"pl-1",3,"icon"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.DNE(1,JG,2,0,"div",1),t.nI1(2,"async"),t.DNE(3,i$,8,5,"ng-container",2),t.nI1(4,"async"),t.DNE(5,d$,4,3,"ng-container",2),t.nI1(6,"async"),t.k0s()),2&e&&(t.Y8G("ngClass",t.ziG(10,KG,o.compact,o.readonly,"dark"===o.theme,"light"===o.theme)),t.R7$(),t.Y8G("ngIf",t.bMT(2,4,o.requesting$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(4,6,o.requesting$)&&o.showPendingRequest),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(6,8,o.requesting$)&&o.showRequestOrganizations))},dependencies:[hi.Q,b.YU,b.Sq,b.bT,qe,Jr,Ws,b.Jj],styles:[".team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--theme-light[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{color:#283853}.team-join__organization[_ngcontent-%COMP%]{border:1px solid #d7e0ea;border-radius:4px;padding:16px}.team-join__organization-info[_ngcontent-%COMP%]{flex-basis:50%}.team-join__organization-logo[_ngcontent-%COMP%]{display:block;max-height:32px;max-width:100%}.team-join__organization-name[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600}.team-join__organization-members[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:500;color:#61779e}.team-join--compact[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization[_ngcontent-%COMP%]{border:none;border-radius:0;padding:0}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization-name[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500}.team-join--readonly[_ngcontent-%COMP%]   .team-join__organization-info[_ngcontent-%COMP%]{flex-basis:auto}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(it.getRequesting),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],xS.prototype,"requesting$",void 0);let p$=(()=>{var n;class e{constructor(i,s,r,a){this.dialogRef=i,this.router=s,this.storageService=r,this.data=a,this.requestOrganizationsText="",this.organizations=[]}ngOnInit(){this.organizations=this.data.organizations,this.storageService.setLocalItem(In.UserJoinPromptSeen,!0),this.dialogRef.afterClosed().subscribe(i=>{i&&this.router.navigateByUrl("/account/team")})}handleViewTeamsCancel(){this.dialogRef.close(!1)}handleViewTeamsClick(){this.dialogRef.close(!0)}}return(n=e).\u0275fac=function(i){return new(i||n)(t.rXU(pt.CP),t.rXU(ut.Ix),t.rXU(Le),t.rXU(pt.Vh))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-user-join-dialog"]],decls:7,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"readonly","organizations"],["mat-dialog-actions",""],["app-button","","buttonType","primary",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"h1",0),t.EFF(1,"We found your team"),t.k0s(),t.j41(2,"div",1),t.nrm(3,"app-team-join",2),t.k0s(),t.j41(4,"div",3)(5,"button",4),t.bIt("click",function(){return s.handleViewTeamsClick()}),t.EFF(6,"View Teams"),t.k0s()()),2&i&&(t.R7$(3),t.Y8G("readonly",!0)("organizations",s.organizations))},dependencies:[pt.BI,pt.E7,pt.Yi,hi.Q,xS],changeDetection:0}),e})();function u$(n,e){if(1&n&&t.nrm(0,"app-icon",2),2&n){const o=t.XpG();t.Y8G("icon",o.icon)}}let g$=(()=>{var n;class e{constructor(){this.size="medium",this.type="outline",this.color="#CCCCCC"}ngOnInit(){}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-profile-badge"]],inputs:{size:"size",type:"type",color:"color",icon:"icon",label:"label"},decls:3,vars:12,consts:[[1,"badge","uppercase"],[3,"icon",4,"ngIf"],[3,"icon"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,u$,1,1,"app-icon",1),t.EFF(2),t.k0s()),2&i&&(t.AVh("badge--outline","outline"===s.type)("badge--solid","solid"===s.type)("badge--small","small"===s.size)("badge--medium","medium"===s.size)("badge--large","large"===s.size),t.R7$(),t.Y8G("ngIf",s.icon),t.R7$(),t.SpI(" ",s.label,"\n"))},dependencies:[b.bT,qe],styles:[".badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border-radius:50%;color:#101823}.badge--outline[_ngcontent-%COMP%]{border:1px solid #ffffff;background-color:#96a8c099;color:#fff}.badge--small[_ngcontent-%COMP%]{width:32px;height:32px;font-size:.75rem;line-height:1rem}.badge--medium[_ngcontent-%COMP%]{width:40px;height:40px;font-size:.875rem;line-height:1.25rem}.badge--large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1rem;line-height:1.5rem}.badge--x-large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.125rem;line-height:1.75rem}"],changeDetection:0}),e})();var X_;const f$=(n,e)=>({"team-user--light":n,"team-user--dark":e});function S$(n,e){if(1&n&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.user.name||"<Name Unknown>"," ")}}function b$(n,e){1&n&&(t.j41(0,"div",9),t.EFF(1,"Developer"),t.k0s())}function y$(n,e){if(1&n&&(t.j41(0,"div",10),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.R7$(),t.SpI(" ",o.user.email," ")}}function v$(n,e){if(1&n&&(t.j41(0,"div",11),t.EFF(1),t.k0s()),2&n){const o=t.XpG();t.AVh("team-user__role--expired","expired"===o.user.invitationStatus),t.R7$(),t.SpI(" ",o.user.invitationStatus?o.user.invitationStatus:o.user.role.role_display_name," ")}}class GS{constructor(){this.showEmail=!1,this.showRole=!0,this.theme="light"}set showNameUnknown(e){this.showName=e||this.user.name.length>0}}var H_;function C$(n,e){if(1&n&&(t.j41(0,"option",14),t.EFF(1),t.k0s()),2&n){const o=e.$implicit;t.Y8G("value",o.role_id),t.R7$(),t.SpI(" ",o.role_display_name," ")}}function O$(n,e){if(1&n&&(t.j41(0,"select",12),t.DNE(1,C$,2,2,"option",13),t.nI1(2,"async"),t.k0s()),2&n){const o=t.XpG(2);t.R7$(),t.Y8G("ngForOf",t.bMT(2,1,o.userRoles$))}}function w$(n,e){if(1&n&&(t.j41(0,"div",9),t.nrm(1,"app-team-user",10),t.DNE(2,O$,3,3,"select",11),t.k0s()),2&n){const o=e.$implicit,i=e.index,s=t.XpG();t.Y8G("formGroupName",i),t.R7$(),t.Y8G("user",o)("showEmail",!0)("showNameUnknown",!0)("showRole",!1),t.R7$(),t.Y8G("ngIf",s.data.accept)}}(X_=GS).\u0275fac=function(e){return new(e||X_)},X_.\u0275cmp=t.VBU({type:X_,selectors:[["app-team-user"]],inputs:{user:"user",showEmail:"showEmail",showNameUnknown:"showNameUnknown",showRole:"showRole",theme:"theme"},decls:8,vars:10,consts:[[1,"team-user","flex","flex-row","grow","align-center","items-center",3,"ngClass"],[1,"team-user__badge","mr-3"],["type","outline","size","small",3,"label","icon"],[1,"team-user__text"],["class","team-user__name text-sm","data-test","teamMemberName",4,"ngIf"],["class","team-user__developer",4,"ngIf"],["class","team-user__email text-xs","data-test","teamMemberEmail",4,"ngIf"],["class","team-user__role flex flex-row items-center justify-end mx-2 text-2xs","data-test","teamMemberInfo",3,"team-user__role--expired",4,"ngIf"],["data-test","teamMemberName",1,"team-user__name","text-sm"],[1,"team-user__developer"],["data-test","teamMemberEmail",1,"team-user__email","text-xs"],["data-test","teamMemberInfo",1,"team-user__role","flex","flex-row","items-center","justify-end","mx-2","text-2xs"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"app-profile-badge",2),t.k0s(),t.j41(3,"div",3),t.DNE(4,S$,2,1,"div",4)(5,b$,2,0,"div",5)(6,y$,2,1,"div",6),t.k0s(),t.DNE(7,v$,2,3,"div",7),t.k0s()),2&e&&(t.Y8G("ngClass",t.l_i(7,f$,"light"===o.theme,"dark"===o.theme)),t.R7$(2),t.Y8G("label",o.user.initials)("icon",o.user.initials?"":"user"),t.R7$(2),t.Y8G("ngIf",o.showName),t.R7$(),t.Y8G("ngIf",o.user.activeDeveloper),t.R7$(),t.Y8G("ngIf",o.showEmail),t.R7$(),t.Y8G("ngIf",o.showRole))},dependencies:[b.YU,b.bT,g$],styles:[".team-user__badge[_ngcontent-%COMP%]{align-self:center}.team-user__text[_ngcontent-%COMP%]{width:0;flex-grow:1;flex-shrink:1;overflow:hidden}.team-user__name[_ngcontent-%COMP%]{color:#1c2a3f;overflow:hidden;text-overflow:ellipsis}.team-user__developer[_ngcontent-%COMP%]{height:16px;padding:0 8px;margin:4px 0;display:inline-flex;align-items:center;justify-content:center;font-size:8px;color:#374a68;background-color:#eaeff5;border-radius:8px;border:1px solid #96a8c0;text-transform:uppercase}.team-user__email[_ngcontent-%COMP%]{color:#374a68;overflow:hidden;text-overflow:ellipsis}.team-user__role[_ngcontent-%COMP%]{text-transform:uppercase;color:#96a8c0}.team-user__role--expired[_ngcontent-%COMP%]{color:#ed4758}.team-user--dark[_ngcontent-%COMP%]   .team-user__developer[_ngcontent-%COMP%]{background-color:#f9fafd}"],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(ne.isAdmin),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],GS.prototype,"isAdmin$",void 0);class $S{constructor(e,o,i){this.dialogRef=e,this.formBuilder=o,this.data=i}ngOnInit(){this.action=this.data.accept?"approve":"deny";const e="request"+(this.data.users.length>1?"s":"");this.title=`${(0,m.capitalize)(this.action)} ${(0,m.capitalize)(e)}?`,this.text=`Are you sure you want to ${this.action} the following ${e} to join your team?`,this.initForm()}initForm(){const e=this.data.users.map(o=>this.formBuilder.group({joinRequestKey:o.joinRequestKey,roleId:o.role.role_id}));this.form=this.formBuilder.group({joinRequests:new K.Bm(e)})}createPayload(){const{joinRequests:e}=this.form.value;return e.map(this.data.accept?o=>({join_request_key:o.joinRequestKey,user_role_id:parseInt(o.roleId)}):o=>o.joinRequestKey)}handleConfirmClick(){this.dialogRef.close(this.createPayload())}}(H_=$S).\u0275fac=function(e){return new(e||H_)(t.rXU(pt.CP),t.rXU(K.ze),t.rXU(pt.Vh))},H_.\u0275cmp=t.VBU({type:H_,selectors:[["app-team-join-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],["formArrayName","joinRequests"],[1,"my-3","text-sm"],["class","flex space-between align-center my-2 py-2",3,"formGroupName",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","mat-dialog-close",""],["app-button","","buttonType","primary",3,"click"],[1,"flex","space-between","align-center","my-2","py-2",3,"formGroupName"],[1,"flex","grow",3,"user","showEmail","showNameUnknown","showRole"],["class","input w-auto","formControlName","roleId",4,"ngIf"],["formControlName","roleId",1,"input","w-auto"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,o){1&e&&(t.j41(0,"h1",0),t.EFF(1),t.k0s(),t.j41(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6),t.k0s(),t.DNE(7,w$,3,6,"div",5),t.k0s()()(),t.j41(8,"div",6)(9,"button",7),t.EFF(10,"Cancel"),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){return o.handleConfirmClick()}),t.EFF(12),t.k0s()()),2&e&&(t.R7$(),t.JRh(o.title),t.R7$(2),t.Y8G("formGroup",o.form),t.R7$(3),t.JRh(o.text),t.R7$(),t.Y8G("ngForOf",o.data.users),t.R7$(5),t.SpI(" ",o.action," "))},dependencies:[b.Sq,b.bT,pt.tx,pt.BI,pt.E7,pt.Yi,hi.Q,GS,K.xH,K.y7,K.wz,K.BC,K.cb,K.j4,K.JD,K.$R,K.v8,b.Jj],changeDetection:0}),function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);s>3&&r&&Object.defineProperty(e,o,r)}([(0,c.l6)(ne.getUserRoles),function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",e)}(0,f.c)],$S.prototype,"userRoles$",void 0);const _O={maxWidth:"100vw",width:"100vw",height:"100vh",panelClass:"full-modal"};let dO=(()=>{var n;class e{get isMobile(){return window.innerWidth<=959}constructor(i,s,r,a,l,_,d){this.dialog=i,this.applicationEventService=s,this.router=r,this.store=a,this.vendorAnalyticsService=l,this.productService=_,this.organizationsService=d}openShareDialog(i,s,r){return this.dialog.open(fu,{id:Lo.ShareUrlDialog,data:{title:s,description:r,shareLink:i},width:"480px",maxWidth:"90vw"})}openConfirmDialog(i){const s={id:Lo.ConfirmDialog,...i};return this.dialog.open(O5,s)}openUpgradeDialog(i=!0){i&&this.closeAllDialogs();const s=this.store.selectSnapshot(ne.getUserProfile),r=this.getContactProfileParams(s),a=s.premium_account_valid?s.premium_account_type:"free",l=(0,m.get)(s,"organizations[0].subscription.type","").toLowerCase(),_=this.store.selectSnapshot(ve.isSubscriptionExpired),d=s.premium_account_eligibility.group_free_trial,p=Vu(s.account_settings),u=(0,m.get)(p,"account_purpose.value","");let g;if(he.native)g="mobile.html";else switch(u){case cu.Business:g="business.html";break;case cu.Education:g="school.html";break;default:g="individual.html"}const y={...r,accountType:a,subscription:l,expired:_,groupFreeTrial:d},$=`${he.native?"":{[En.Local]:"https://localhost:1234",[En.QA]:"https://pricing-qa.biodigital.com",[En.Staging]:"https://pricing.biodigital.com",[En.Production]:"https://pricing.biodigital.com"}[he.deploy]}/${g}?${this.serializeQueryParams(y)}`,q={id:Lo.PricingDialog,..._O,data:{title:"Upgrade",url:$,backgroundColor:"#0B1220"}},x=encodeURIComponent(this.router.url);return this.dialog.open(RC,q).afterClosed().subscribe(k=>{if(k){const A={action:"",plan:"",...k.metadata},R={business:["starter","premium","enterprise"],education:["class","institution"]};let Z="Individual";Object.entries(R).forEach(([se,ge])=>{ge.indexOf(A.plan)&&(Z=se)}),A.action&&this.vendorAnalyticsService.track(`Pricing - ${(0,m.capitalize)(A.action)} - ${(0,m.capitalize)(A.plan)}`,{platform:this.productService.productType,page:Z});let te="";switch(A.action){case"buy":if(he.native)return void this.applicationEventService.fireEvent(Ce.NativeUpgrade);this.router.navigate(["/account/profile"],{queryParams:{section:"subscription",mode:"edit"}});break;case"contact":this.openContactDialog("pricing page");break;case"try":switch(!0){case R.business.includes(A.plan):te=`/account/workflow/team/create?purpose=Business&returnTo=${x}`;break;case R.education.includes(A.plan):te=`/account/workflow/team/create?purpose=Education&returnTo=${x}`;break;default:te="account/workflow"}this.router.navigateByUrl(te)}}else this.vendorAnalyticsService.track("Pricing - Exit")})}openContactDialog(i=""){const s=this.store.selectSnapshot(ve.getOrganization),r=(0,m.isNil)(s)?"":`${s.id}`,a=this.store.selectSnapshot(ne.getUserProfile),l=this.getContactProfileParams(a),_={[En.Local]:"http://craft-sandbox.biodigital.local",[En.QA]:"http://craft-sandbox.biodigital.local",[En.Staging]:"https://www.biodigital.com",[En.Production]:"https://www.biodigital.com"},d=he.native?_[En.Production]:_[he.deploy];if(he.native){const p=this.serializeQueryParams({...l,organizationId:r,utm_source:"human-mobile",utm_campaign:i});return window.open(`${d}/contact?${p}`,"_blank")}{const u=`${d}/headless/contact-us?${this.serializeQueryParams({...l,organizationId:r,utm_source:"human-web",utm_campaign:i})}`,g={id:Lo.ContactDialog,..._O,data:{title:"Contact Us",url:u}};return this.dialog.open(RC,g)}}openPremiumContentDialog(){const i=he.native||!this.isMobile;return this.openConfirmDialog({id:Lo.PremiumContentDialog,data:{titleText:"Premium Content",bodyText:i?"This is premium content. Upgrade to a Premium Plan for unlimited access.":"This is premium content. Visit us on desktop to upgrade to a premium plan.",confirmText:"Upgrade Now",confirmEnabled:i,cancelText:"OK",confirmColor:"warn"}})}openAddUserDialog(){const i=this.store.selectSnapshot(ve.getOrganization);this.dialog.open(VS,{id:Lo.AddTeamModelDialog,disableClose:!1,data:{organization:i}})}openWelcomeTourDialog(i,s){const r={id:Lo.WelcomeTourDialog,disableClose:!1,data:{userType:i},...s};return this.dialog.open(QG,r)}openUserJoinDialog(i,s){return this.dialog.open(p$,{width:"480px",data:{userEmail:i,organizations:s}})}openTeamJoinDialog(i,s){return this.dialog.open($S,{width:"480px",disableClose:!1,data:{users:i,accept:s}})}closeAllDialogs(){console.log("closeAllDialogs"),this.dialog.closeAll()}getContactProfileParams(i){const{first_name:s,last_name:r,email:a}=i,l=(0,m.get)(i,"organizations[0].name",""),_=(0,m.get)(i,"organizations[0].group_attributes",[]),d=Vu(i.account_settings),p=(0,m.get)(d,"account_purpose.value",""),u=(0,m.get)(d,"account_field.value",""),g=(0,m.get)(d,"account_field.value",""),y=(0,m.get)(d,"account_role.value",""),C=this.organizationsService.getOrganizationAttribute(_,"account_settings","account_company_size"),O=this.organizationsService.getOrganizationAttribute(_,"account_settings","account_company_website");return{first_name:s,last_name:r,email:a,company:l,website:O?O.value:"",purpose:p,role:y,program_type:g,program_size:C?C.value:"",industry:p===cu.Education?"Academia":u}}serializeQueryParams(i){return Object.entries(i).map(([s,r])=>{const a="string"!=typeof r?JSON.stringify(r):r;return`${s}=${encodeURIComponent(a)}`}).join("&")}}return(n=e).\u0275fac=function(i){return new(i||n)(t.KVO(pt.bZ),t.KVO(mo),t.KVO(ut.Ix),t.KVO(c.il),t.KVO(Qn),t.KVO(Si),t.KVO(Qo))},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var pa,Q_=function(n,e,o,i){var a,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,e,o,i);else for(var l=n.length-1;l>=0;l--)(a=n[l])&&(r=(s<3?a(r):s>3?a(e,o,r):a(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},Ji=function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)};let ua=((pa=class{static getOpenDialog(e){return e.openDialog}openPremiumContent(e,o){this.dialogService.openPremiumContentDialog().afterClosed().subscribe(s=>{e.dispatch(new Fo.ClosePremiumContent(s))})}closePremiumContent(e,o){o.confirmed&&e.dispatch(new Fo.OpenUpgrade)}openUpgrade(e,o){this.dialogService.openUpgradeDialog()}constructor(e){this.dialogService=e}}).\u0275fac=function(e){return new(e||pa)(t.KVO(dO))},pa.\u0275prov=t.jDH({token:pa,factory:pa.\u0275fac}),pa);Q_([(0,c.rc)(Fo.OpenPremiumContent),Ji("design:type",Function),Ji("design:paramtypes",[Object,Fo.OpenPremiumContent]),Ji("design:returntype",void 0)],ua.prototype,"openPremiumContent",null),Q_([(0,c.rc)(Fo.ClosePremiumContent),Ji("design:type",Function),Ji("design:paramtypes",[Object,Fo.ClosePremiumContent]),Ji("design:returntype",void 0)],ua.prototype,"closePremiumContent",null),Q_([(0,c.rc)(Fo.OpenUpgrade),Ji("design:type",Function),Ji("design:paramtypes",[Object,Fo.OpenUpgrade]),Ji("design:returntype",void 0)],ua.prototype,"openUpgrade",null),Q_([(0,c.MD)(),Ji("design:type",Function),Ji("design:paramtypes",[class v5{}]),Ji("design:returntype",void 0)],ua,"getOpenDialog",null),ua=Q_([(0,c.Uw)({name:"dialog",defaults:{openDialog:null}}),Ji("design:paramtypes",[dO])],ua);let pO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),uO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),gO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),hO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),mO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,K.YN,K.X1,_t.G]}),e})();var fO=S(9464);let SO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),bO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),yO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,Ui.o,Yi.C]}),e})();var I$=S(4026);let A$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,K.YN,Pp.D,K.X1,j_.M,Yi.C,vC,fO.j,Ui.o,I$.m,mS.H]}),e})(),vO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1,A$,TS]}),e})(),P$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),N$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),EO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),TO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),CO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),R$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.YN,K.X1]}),e})(),OO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,Ti.y2.forChild()]}),e})(),wO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1,TS]}),e})(),MO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),IO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),AO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),PO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G]}),e})(),NO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,_t.G,K.X1]}),e})(),k$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([ua]),CC,OC,wO,wC,CO,MC,IC,yO,AC,PC,NC,pO,uO,gO,hO,mO,SO,bO,vO,EO,TO,NO,fO.j,Pp.D,_t.G,OO,MO,IO,AO,PO,CC,OC,wO,wC,CO,MC,IC,yO,AC,PC,NC,pO,vO,uO,gO,hO,mO,SO,bO,P$,N$,EO,TO,NO,EC,R$,OO,MO,IO,AO,PO]}),e})(),D$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,Ui.o]}),e})();var L$=S(6374),U$=S(6049);let V$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD]}),e})();var j$=S(8824),x$=S(556);let G$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,rt.G,Yi.C,V_.h,Ui.o,lu,mS.H,K.X1,bS,j_.M]}),e})();const $$=[];let F$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[ut.iI.forChild($$),ut.iI]}),e})();var RO=S(5584);let kO=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,vi.Pd,rt.G]}),e})(),B$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,vi.Pd,Yi.C,rt.G,ES,Ui.o,RO.d,K.YN,kO,j_.M,_t.G]}),e})();var z$=S(4218);let W$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,Ui.o,z$.H,Yi.C]}),e})(),X$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([Xi]),b.MD]}),e})(),H$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([P]),c.rK.forFeature([ue]),Ti.y2.forChild(),vi.Pd,ru,Yi.C,b.MD,lu,V_.h,ES,K.YN,Ui.o,zc.Un,rt.G,X$,SS.G,D$,L$.b,U$.Y,V$,j_.M,bS,K.X1,_t.G,yS,j$.j,RO.d,x$.f,kO,B$,G$,F$,W$,vS,na.Ez,Sf,gf,jp]}),e})(),DO=(()=>{var n;class e{intercept(i,s){return s.handle(i).pipe((0,F.T)(r=>(r instanceof $e.cS&&r.body&&r.body.hasOwnProperty("results")&&(r=r.clone({body:r.body.results})),r)))}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac}),e})(),Q$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({providers:[zf],imports:[c.rK.forFeature([Qt]),b.MD,_t.G]}),e})(),Y$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,ut.iI,Yi.C,V_.h,Ui.o,TC]}),e})(),LO=(()=>{var n;class e{parse(i){i=i.replace(/&amp;/g,"&");const r=(new ut.nU).parse(i);return this.ensureQueryParam(r.queryParams,"dk",i),this.ensureQueryParam(r.queryParams,"uaid",i),r}serialize(i){return(new ut.nU).serialize(i).replace(/%2F/g,"/")}ensureQueryParam(i,s,r){if(i.hasOwnProperty(s))return i;const a=this.getParameterByName(s,r);return null!==a&&(i[s]=a),i}getParameterByName(i,s){s||(s=window.location.href),i=i.replace(/[\[\]]/g,"\\$&");const a=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(s);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275prov=t.jDH({token:n,factory:n.\u0275fac}),e})(),q$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([mn]),b.MD]}),e})(),K$=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.rK.forFeature([vn]),b.MD]}),e})();var J$=S(7051);function Z$(){const n=new J$.A4;return n.link=(e,o,i)=>`<a href="${function eF(n){return n.match(/^(?:(?:(?:ht)tps?):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i)?n:""}(e)}" target="_blank" rel="noreferrer nofollow">${i}</a>`,n.paragraph=e=>`<p>${e}</p>`,n.image=(e,o,i)=>"",{renderer:n,gfm:!1}}let tF=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,Ti.y2.forRoot({markedOptions:{provide:Ti.GY,useFactory:Z$}})]}),e})(),nF=(()=>{var n;class e{static forRoot(i){return{ngModule:e,providers:[Qn,{provide:"vendorAnalyticsConfig",useValue:i}]}}}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({}),e})(),iF=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.MD,c.rK.forFeature([Ki])]}),e})();re.IP(),re.YT(),re.ht(!1);const oF=[{provide:$e.a7,useClass:DO,multi:!0},{provide:ut.Sd,useClass:LO},{provide:b.kB,useValue:"./"},{provide:b.hb,useClass:b.fw},{provide:Ru,useFactory:function jO(){return new xO}}],sF=[{provide:$e.a7,useClass:DO,multi:!0},{provide:ut.Sd,useClass:LO},{provide:Ru,useFactory:function VO(){return new K_(UO)}}];let rF=(()=>{var n;class e{}return(n=e).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n,bootstrap:[zm]}),n.\u0275inj=t.G2t({providers:!0===he.offline?oF:sF,imports:[c.rK.forRoot(),q$,rC.forRoot(),nF.forRoot({enabled:!1,pendoId:he.pendoId,hubspotId:he.hubspotId}),tF,z.Bb,Ne.wb,$e.q1,ES,vS,ru,TC,y5,yS,K$,k$,H$,Y$,Q$,iF,UP,L6]}),e})();he.production&&(0,t.SmG)(),z.sG().bootstrapModule(rF).catch(n=>console.error(n))},2634:()=>{}},Dt=>{Dt.O(0,[502],()=>Dt(Dt.s=4768)),Dt.O()}]);