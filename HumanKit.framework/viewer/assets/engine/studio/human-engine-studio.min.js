/*
 * Human Engine v17.1.3
 *
 * (c) 2015 BioDigital, Inc.
 *
 * Built: Thu Feb 27 2020 08:33:14 GMT-0500 (Eastern Standard Time)
 */

 /***************************
  * LICENSED SOFTWARE
  ***************************/
/*
 * SceneJS V4.2.0
 *
 * A WebGL-based 3D scene graph from xeoLabs
 * http://scenejs.org/
 *
 * Built on 2015-04-21
 *
 * MIT License
 * Copyright 2015, Lindsay Kay
 * http://xeolabs.com/
 *
 */
/*
 * Bezier.js
 *
 * A node.js and client-side library for (quadratic and cubic) Bezier curve work. 
 * https://pomax.github.io/bezierjs/
 *
 * MIT License
 * Copyright 2015, Mike Kamermans
 * https://github.com/Pomax/
 */
/*
 * FXAA Algorithm
 * Original:
 * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * * Redistributions of source code must retain the above copyright
 *  notice, this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright
 *  notice, this list of conditions and the following disclaimer in the
 *  documentation and/or other materials provided with the distribution.
 * * Neither the name of NVIDIA CORPORATION nor the names of its
 *  contributors may be used to endorse or promote products derived
 *  from this software without specific prior written permission.
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 * WebGL modifications from Cesium:
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 * Copyright 2011-2017 Cesium Contributors
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * Columbus View (Pat. Pend.)
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */ 

function ColorFresnel(a){var b=[[1,1,1],[1,1,1],1,0,1];5===arguments.length?b=Array.prototype.slice.call(arguments):Array.isArray(a)&&(b=a),this.isColorFresnel=!0,this.center=b[0],this.edge=b[1],this.centerBias=b[2],this.edgeBias=b[3],this.power=b[4]}function ScalarFresnel(a){var b=[1,1,1,0,1];5===arguments.length?b=Array.prototype.slice.call(arguments):Array.isArray(a)&&(b=a),this.isScalarFresnel=!0,this.center=b[0],this.edge=b[1],this.centerBias=b[2],this.edgeBias=b[3],this.power=b[4]}function unpackChapterLights(a){"use strict";var b,c={},d=0,e=0,f=Human.assets.lights.lightIds,g=Human.renderer.lights.defaultLightIds;if(a.lights.length)for(d=0;d<a.lights.length;d++)c[a.lights[d]]=!0;if(a.libraries.length)for(d=0;d<a.libraries.length;d++)if(b=a.libraries[d],f.hasOwnProperty(b))for(e=0;e<f[b].length;e++)c[f[b][e]]=!0;else if("default"===b)for(e=0;e<g.length;e++)c[g[e]]=!0;return c}var glMatrix={};glMatrix.EPSILON=1e-6,glMatrix.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,glMatrix.RANDOM=Math.random,glMatrix.setMatrixArrayType=function(a){glMatrix.ARRAY_TYPE=a};var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree},glMatrix.equals=function(a,b){return Math.abs(a-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var mat4={};mat4.create=function(){var a=new glMatrix.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.clone=function(a){var b=new glMatrix.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.fromValues=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=new glMatrix.ARRAY_TYPE(16);return q[0]=a,q[1]=b,q[2]=c,q[3]=d,q[4]=e,q[5]=f,q[6]=g,q[7]=h,q[8]=i,q[9]=j,q[10]=k,q[11]=l,q[12]=m,q[13]=n,q[14]=o,q[15]=p,q},mat4.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=m,a[12]=n,a[13]=o,a[14]=p,a[15]=q,a},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},mat4.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},mat4.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},mat4.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},mat4.mul=mat4.multiply,mat4.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},mat4.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.rotate=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d[0],D=d[1],E=d[2],F=Math.sqrt(C*C+D*D+E*E);return Math.abs(F)<glMatrix.EPSILON?null:(F=1/F,C*=F,D*=F,E*=F,e=Math.sin(c),f=Math.cos(c),g=1-f,h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],p=b[8],q=b[9],r=b[10],s=b[11],t=C*C*g+f,u=D*C*g+E*e,v=E*C*g-D*e,w=C*D*g-E*e,x=D*D*g+f,y=E*D*g+C*e,z=C*E*g+D*e,A=D*E*g-C*e,B=E*E*g+f,a[0]=h*t+l*u+p*v,a[1]=i*t+m*u+q*v,a[2]=j*t+n*u+r*v,a[3]=k*t+o*u+s*v,a[4]=h*w+l*x+p*y,a[5]=i*w+m*x+q*y,a[6]=j*w+n*x+r*y,a[7]=k*w+o*x+s*y,a[8]=h*z+l*A+p*B,a[9]=i*z+m*A+q*B,a[10]=j*z+n*A+r*B,a[11]=k*z+o*A+s*B,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},mat4.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},mat4.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},mat4.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},mat4.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},mat4.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromRotation=function(a,b,c){var d,e,f,g=c[0],h=c[1],i=c[2],j=Math.sqrt(g*g+h*h+i*i);return Math.abs(j)<glMatrix.EPSILON?null:(j=1/j,g*=j,h*=j,i*=j,d=Math.sin(b),e=Math.cos(b),f=1-e,a[0]=g*g*f+e,a[1]=h*g*f+i*d,a[2]=i*g*f-h*d,a[3]=0,a[4]=g*h*f-i*d,a[5]=h*h*f+e,a[6]=i*h*f+g*d,a[7]=0,a[8]=g*i*f+h*d,a[9]=h*i*f-g*d,a[10]=i*i*f+e,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},mat4.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},mat4.getTranslation=function(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a},mat4.getScaling=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[4],g=b[5],h=b[6],i=b[8],j=b[9],k=b[10];return a[0]=Math.sqrt(c*c+d*d+e*e),a[1]=Math.sqrt(f*f+g*g+h*h),a[2]=Math.sqrt(i*i+j*j+k*k),a},mat4.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;return c>0?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d),a},mat4.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},mat4.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},mat4.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},mat4.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},mat4.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},mat4.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},mat4.lookAt=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b[0],p=b[1],q=b[2],r=d[0],s=d[1],t=d[2],u=c[0],v=c[1],w=c[2];return Math.abs(o-u)<glMatrix.EPSILON&&Math.abs(p-v)<glMatrix.EPSILON&&Math.abs(q-w)<glMatrix.EPSILON?mat4.identity(a):(k=o-u,l=p-v,m=q-w,n=1/Math.sqrt(k*k+l*l+m*m),k*=n,l*=n,m*=n,e=s*m-t*l,f=t*k-r*m,g=r*l-s*k,n=Math.sqrt(e*e+f*f+g*g),n?(n=1/n,e*=n,f*=n,g*=n):(e=0,f=0,g=0),h=l*g-m*f,i=m*e-k*g,j=k*f-l*e,n=Math.sqrt(h*h+i*i+j*j),n?(n=1/n,h*=n,i*=n,j*=n):(h=0,i=0,j=0),a[0]=e,a[1]=h,a[2]=k,a[3]=0,a[4]=f,a[5]=i,a[6]=l,a[7]=0,a[8]=g,a[9]=j,a[10]=m,a[11]=0,a[12]=-(e*o+f*p+g*q),a[13]=-(h*o+i*p+j*q),a[14]=-(k*o+l*p+m*q),a[15]=1,a)},mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},mat4.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a},mat4.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a},mat4.sub=mat4.subtract,mat4.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a},mat4.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a},mat4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},mat4.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14],H=b[15];return Math.abs(c-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(s))&&Math.abs(d-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(e-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(f-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(g-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(i-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(j-z)<=glMatrix.EPSILON*Math.max(1,Math.abs(j),Math.abs(z))&&Math.abs(k-A)<=glMatrix.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(l-B)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(m-C)<=glMatrix.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(n-D)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=glMatrix.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=glMatrix.EPSILON*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(H))};var mat3={};mat3.create=function(){var a=new glMatrix.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},mat3.clone=function(a){var b=new glMatrix.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.fromValues=function(a,b,c,d,e,f,g,h,i){var j=new glMatrix.ARRAY_TYPE(9);return j[0]=a,j[1]=b,j[2]=c,j[3]=d,j[4]=e,j[5]=f,j[6]=g,j[7]=h,j[8]=i,j},mat3.set=function(a,b,c,d,e,f,g,h,i,j){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},mat3.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},mat3.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},mat3.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},mat3.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},mat3.mul=mat3.multiply,mat3.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},mat3.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},mat3.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},mat3.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},mat3.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},mat3.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},mat3.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a},mat3.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a},mat3.sub=mat3.subtract,mat3.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a},mat3.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a},mat3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},mat3.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return Math.abs(c-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(e-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(f-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(o))&&Math.abs(g-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(h-q)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(i-r)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(j-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(j),Math.abs(s))&&Math.abs(k-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(k),Math.abs(t))};var vec2={};vec2.create=function(){var a=new glMatrix.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},vec2.clone=function(a){var b=new glMatrix.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},vec2.fromValues=function(a,b){var c=new glMatrix.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},vec2.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},vec2.set=function(a,b,c){return a[0]=b,a[1]=c,a},vec2.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},vec2.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},vec2.sub=vec2.subtract,vec2.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},vec2.mul=vec2.multiply,vec2.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},vec2.div=vec2.divide,vec2.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a},vec2.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a},vec2.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},vec2.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},vec2.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a},vec2.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},vec2.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},vec2.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},vec2.dist=vec2.distance,vec2.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},vec2.len=vec2.length,vec2.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},vec2.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},vec2.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},vec2.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},vec2.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},vec2.random=function(a,b){b=b||1;var c=2*glMatrix.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},vec2.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},vec2.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},vec2.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},vec2.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},vec2.forEach=function(){var a=vec2.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},vec2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]},vec2.equals=function(a,b){var c=a[0],d=a[1],e=b[0],f=b[1];return Math.abs(c-e)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(d-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(f))};var vec3={};vec3.create=function(){var a=new glMatrix.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},vec3.clone=function(a){var b=new glMatrix.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.fromValues=function(a,b,c){var d=new glMatrix.ARRAY_TYPE(3);return d[0]=a,d[1]=b,d[2]=c,d},vec3.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},vec3.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},vec3.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},vec3.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},vec3.sub=vec3.subtract,vec3.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},vec3.mul=vec3.multiply,vec3.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},vec3.div=vec3.divide,vec3.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a},vec3.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a},vec3.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},vec3.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},vec3.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a},vec3.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},vec3.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},vec3.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},vec3.dist=vec3.distance,vec3.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},vec3.len=vec3.length,vec3.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},vec3.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},vec3.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},vec3.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},vec3.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},vec3.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},vec3.random=function(a,b){b=b||1;var c=2*glMatrix.RANDOM()*Math.PI,d=2*glMatrix.RANDOM()-1,e=Math.sqrt(1-d*d)*b;return a[0]=Math.cos(c)*e,a[1]=Math.sin(c)*e,a[2]=d*b,a},vec3.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},vec3.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},vec3.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},vec3.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.forEach=function(){var a=vec3.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),vec3.angle=function(a,b){var c=vec3.fromValues(a[0],a[1],a[2]),d=vec3.fromValues(b[0],b[1],b[2]);vec3.normalize(c,c),vec3.normalize(d,d);var e=vec3.dot(c,d);return e>1?0:-1>e?Math.PI:Math.acos(e)},vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},vec3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},vec3.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return Math.abs(c-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(e-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))};var vec4={};vec4.create=function(){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},vec4.clone=function(a){var b=new glMatrix.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},vec4.fromValues=function(a,b,c,d){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},vec4.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},vec4.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},vec4.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},vec4.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},vec4.sub=vec4.subtract,vec4.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},vec4.mul=vec4.multiply,vec4.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},vec4.div=vec4.divide,vec4.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a},vec4.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a},vec4.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),
a[3]=Math.min(b[3],c[3]),a},vec4.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},vec4.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a[3]=Math.round(b[3]),a},vec4.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},vec4.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},vec4.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},vec4.dist=vec4.distance,vec4.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},vec4.len=vec4.length,vec4.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},vec4.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},vec4.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},vec4.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},vec4.random=function(a,b){return b=b||1,a[0]=glMatrix.RANDOM(),a[1]=glMatrix.RANDOM(),a[2]=glMatrix.RANDOM(),a[3]=glMatrix.RANDOM(),vec4.normalize(a,a),vec4.scale(a,a,b),a},vec4.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},vec4.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},vec4.forEach=function(){var a=vec4.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},vec4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},vec4.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return Math.abs(c-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-i)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))};var quat={};quat.create=function(){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},quat.rotationTo=function(){var a=vec3.create(),b=vec3.fromValues(1,0,0),c=vec3.fromValues(0,1,0);return function(d,e,f){var g=vec3.dot(e,f);return-.999999>g?(vec3.cross(a,b,e),vec3.length(a)<1e-6&&vec3.cross(a,c,e),vec3.normalize(a,a),quat.setAxisAngle(d,a,Math.PI),d):g>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(vec3.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+g,quat.normalize(d,d))}}(),quat.setAxes=function(){var a=mat3.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],quat.normalize(b,quat.fromMat3(b,a))}}(),quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},quat.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},quat.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);return 0!=d?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0),c},quat.add=vec4.add,quat.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},quat.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},quat.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},quat.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},quat.sqlerp=function(){var a=quat.create(),b=quat.create();return function(c,d,e,f,g,h){return quat.slerp(a,d,g,h),quat.slerp(b,e,f,h),quat.slerp(c,a,b,2*h*(1-h)),c}}(),quat.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},quat.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},quat.exactEquals=vec4.exactEquals,quat.equals=vec4.equals,function(){"use strict";window.SceneJS_Map=function(a,b){this.items=a||[];var c=b||0,d=c+1;this.addItem=function(){var a;if(2==arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw SceneJS_error.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+b+"'");return this.items[b]=a,b}for(;;){a=arguments[0];var c=d++;if(!this.items[c])return this.items[c]=a,c}},this.removeItem=function(a){delete this.items[a]}}}(),function(){"use strict";var a=window.SceneJS=new function(){function b(a,c){var d,e="";for(d=0;c>d;d++)e+=" ";for(e+="-- ",console.log(e+a.type+" (id: "+a.id+", coreId: "+a.coreId+")"),d=0;d<a.nodes.length;d++)b(a.nodes[d],c+1)}this.VERSION="3.2",this.ENABLE_EXTENSIONS=["WEBGL_depth_texture","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","OES_standard_derivatives","EXT_shader_texture_lod"],this._baseStateId=0,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._engines={},this._engineIds=new SceneJS_Map,this.timer=window.performance||window.Date,this.WEBGL_INFO=function(){var a={WEBGL:!1,SOFTWARE_RENDERER:!1},b=document.createElement("canvas");if(!b)return a;var c=b.getContext("webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0})||b.getContext("experimental-webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0});return c||(c=b.getContext("webgl",{antialias:!0})||b.getContext("experimental-webgl",{antialias:!0}),c&&(a.SOFTWARE_RENDERER=!0)),a.WEBGL=!!c,a.WEBGL?(a.ANTIALIAS=c.getContextAttributes().antialias,a.FS_MAX_FLOAT_PRECISION=c.getShaderPrecisionFormat?c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision>0?"highp":c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",a.DEPTH_BITS=c.getParameter(c.DEPTH_BITS),a.STENCIL_BITS=c.getParameter(c.STENCIL_BITS),a.MAX_TEXTURE_SIZE=c.getParameter(c.MAX_TEXTURE_SIZE),a.MAX_CUBE_MAP_SIZE=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),a.MAX_RENDERBUFFER_SIZE=c.getParameter(c.MAX_RENDERBUFFER_SIZE),a.MAX_TEXTURE_UNITS=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS),a.MAX_VERTEX_ATTRIBS=c.getParameter(c.MAX_VERTEX_ATTRIBS),a.MAX_VERTEX_UNIFORM_VECTORS=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),a.MAX_FRAGMENT_UNIFORM_VECTORS=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),a.MAX_VARYING_VECTORS=c.getParameter(c.MAX_VARYING_VECTORS),a.SAMPLE_BUFFERS=!!c.getParameter(c.SAMPLE_BUFFERS),a.SAMPLES=c.getParameter(c.SAMPLES),a.MAX_POINT_SIZE=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1],a.MAX_VIEWPORT_DIMS=c.getParameter(c.MAX_VIEWPORT_DIMS),a.SUPPORTED_EXTENSIONS={},c.getSupportedExtensions().forEach(function(b){a.SUPPORTED_EXTENSIONS[b]=!0}),a.depthTexturesSupported=a.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||!1,a.floatTexturesSupported=a.SUPPORTED_EXTENSIONS.OES_texture_float||!1,a.linearFloatTexturesSupported=a.SUPPORTED_EXTENSIONS.OES_texture_float_linear||!1,a.drawBuffersSupported=a.SUPPORTED_EXTENSIONS.WEBGL_draw_buffers||!1,a.standardDerivativesSupported=a.SUPPORTED_EXTENSIONS.OES_standard_derivatives||!1,a.textureLODSupported=a.SUPPORTED_EXTENSIONS.EXT_shader_texture_lod||!1,a):a}(),this.DISPLAY_FLAGS={FOG_LINEAR:1,FOG_EXP:2,FOG_EXP2:3},this.TEXTURE_FLAGS={baseColor:1,specular:2,emit:4,alpha:8,normals:16,shine:32,metallic:64,roughness:128,occlusion:256,add:512,multiply:1024,over:2048,transparency:4096,conditionalAlpha:8192},this.CUBEMAP_FLAGS={reflect:1,light:2},this.PROPERTY_FLAGS={PICKING:1,ENABLED:2,REFLECTIVE:4,SOLID:8,SKYBOX:16,XRAY:32,CCW:64,NO_DEPTH_MASK:128,PARTIALLY_OPAQUE:256,FORCE_TRANSPARENT:512,ROUND_POINTS:1024,PERSPECTIVE_POINTS:2048,BILLBOARD:4096,CLIPPING:8192,STOCHASTIC_ALPHA:16384},this.COLOR_MOD_FLAGS={SATURATION:1,BRIGHTNESS:2,CONTRAST:4,TINT:8},this.XFORM_FLAGS={MATRIX_DIRTY:1,COMPILING:2,DIRTY:4},this.TRANSPARENCY_FLAGS={ALPHA:1,IMPROVED_ALPHA:2,ADD_ALPHA:4,ALPHA_TO_COVERAGE:8,WEIGHTED_OIT:16},this.DEPTH_TEST_FLAGS={ENABLED:1,DISABLED:2,ALWAYS_PASS:4},this.TRANSPARENCY_FLAGS.TWO_PASS=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ORDER_DEPENDENT=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_BLEND=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.KD_TREE_MAX_DEPTH=10,this.KD_TREE_MIN_TRIANGLES=20,this.setMaxPointSize=function(a){SceneJS_ProgramSourceFactory.setMaxPointSize(a)},this.publish=function(a,b,c){c||(this._topicPubs[a]=b);var d=this._topicSubs[a];if(d)for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)},this.unpublish=function(a){var b=this._topicSubs[a];if(b)for(var c in b)b.hasOwnProperty(c)&&b[c].call(this,null);delete this._topicPubs[a]},this.on=function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),d},this.off=function(a){var b=this._handleTopics[a];if(b){delete this._handleTopics[a];var c=this._topicSubs[b];c&&delete c[a],this._handleMap.removeItem(a),"rendered"==b&&this._engine.branchDirty(this)}},this.once=function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})},this.createScene=function(b,c){if(b=b||{},b.id){if(this._engines[b.id])throw SceneJS_error.fatalError(a.errors.ILLEGAL_NODE_CONFIG,"Scene already exists with this ID: '"+b.id+"'");this._engineIds.addItem(b.id,{})}else b.id=this._engineIds.addItem({});var d=new SceneJS_Engine(b,c);return this._engines[b.id]=d,d.scene},this.scene=function(a){var b=this._engines[a];return b?b.scene:null},this.getScene=function(a){if(!a)for(var a in this._engines)if(this._engines.hasOwnProperty(a))return this._engines[a].scene;var b=this._engines[a];return b?b.scene:null},this.getScenes=function(){var a={};for(var b in this._engines)this._engines.hasOwnProperty(b)&&(a[b]=this._engines[b].scene);return a},this._isArray=function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},this._shallowClone=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},this._applyIf=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0==b[c]||null==b[c])&&(b[c]=a[c]);return b},this._apply=function(a,b,c){var d;if(c)for(d in b)b.hasOwnProperty(d)&&delete b[d];for(d in a)a.hasOwnProperty(d)&&void 0!=a[d]&&(b[d]=a[d]);return b};var c=Object.prototype.hasOwnProperty;this._isEmpty=function(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(c.call(a,b))return!1;return!0},this._isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},this._sliceArray=function(a,b,c){if(a.slice)return a.slice(b,c);b=b||0,c=c||a.length;for(var d=c-b,e=new a.constructor(d),f=0;d>f;f++)e[f]=a[b+f];return e},this._loadBinary=function(a,b){var c=new XMLHttpRequest;c.responseType="arraybuffer",c.open("GET",a),c.onload=function(){b(c.response)},c.send(null)};var d=["","MOZ_","WEBKIT_"];this.checkExtension=function(a){for(var b=0,c=d.length;c>b;b++)if(this.WEBGL_INFO.SUPPORTED_EXTENSIONS[d[b]+a])return!0;return!1},this._getExtension=function(a,b){for(var c=0,e=d.length;e>c;c++){var f=a.getExtension(d[c]+b);if(f)return f}return null},this.printGraph=function(a){b(a,0)},this.reset=function(){var a=[];for(var b in this._engines)this._engines.hasOwnProperty(b)&&(a.push(this._engines[b]),delete this._engines[b],this._engineIds.removeItem(b));for(;a.length>0;)a.pop().destroy();SceneJS_events.fireEvent(SceneJS_events.RESET)}}}(),function(){"use strict";var a=window.SceneJS_events=new function(){this.ERROR=0,this.RESET=1,this.NODE_CREATED=2,this.SCENE_CREATED=3,this.SCENE_COMPILING=4,this.SCENE_DESTROYED=5,this.OBJECT_COMPILING=6,this.WEBGL_CONTEXT_LOST=7,this.WEBGL_CONTEXT_RESTORED=8,this.RENDER=9;var a=[];this.addListener=function(b,c,d){var e=a[b];e||(e=[],a[b]=e);for(var f={command:c,priority:void 0==d?e.length:d},g=-1,h=0,i=e.length;i>h;h++)if(!e[h]){g=h;break}0>g&&(e.push(f),g=e.length-1);var j=b+"."+g;return j},this.removeListener=function(b){var c=b.lastIndexOf("."),d=parseInt(b.substr(0,c)),e=parseInt(b.substr(c+1)),f=a[d];f&&delete f[e]},this.fireEvent=function(b,c){var d=a[b];if(d){c=c||{};for(var e=0;e<d.length;e++)d[e]&&d[e].command(c)}}};SceneJS.bind=function(b,c){switch(b){case"error":return a.addListener(a.ERROR,c);case"reset":return a.addListener(a.RESET,function(){c()});case"webglcontextlost":return a.addListener(a.WEBGL_CONTEXT_LOST,function(a){c(a)});case"webglcontextrestored":return a.addListener(a.WEBGL_CONTEXT_RESTORED,function(a){c(a)});default:throw SceneJS_error.fatalError("SceneJS.bind - this event type not supported: '"+b+"'")}},SceneJS.onEvent=SceneJS.bind,SceneJS.unEvent=function(b){return a.removeListener(b)},SceneJS.subscribe=SceneJS.addListener=SceneJS.onEvent=SceneJS.bind,SceneJS.unsubscribe=SceneJS.unEvent,SceneJS.on=SceneJS.onEvent,SceneJS.off=SceneJS.unEvent}(),function(){"use strict";var a=window.SceneJS_Canvas=function(a,b,c,d){if(this.canvasId,!b){b="canvas-"+a;var e=document.getElementsByTagName("body")[0],f=document.createElement("div"),g=f.style;g.height="100%",g.width="100%",g.padding="0",g.margin="0",g.left="0",g.top="0",g.position="absolute",f.innerHTML+='<canvas id="'+b+'" style="width: 100%; height: 100%; margin: 0; padding: 0;"></canvas>',e.appendChild(f)}var h=document.getElementById(b);if(!h)throw SceneJS_error.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"SceneJS.Scene attribute 'canvasId' does not match any elements in the page");h.addEventListener("webglcontextcreationerror",function(a){console.error("Unable to initialize WebGL:",a.statusMessage||"Unknown error")},!1),this.canvasId=b,this.options=d||{},this.canvas=h,this.options.simulateWebGLContextLost&&(window.WebGLDebugUtils?this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas):console.error("To simulate context loss, please include WebGLDebugUtils")),this.resolutionScaling=this.options.resolutionScaling||1,this.canvas.width=this.canvas.clientWidth*this.resolutionScaling,this.canvas.height=this.canvas.clientHeight*this.resolutionScaling,this.contextAttr=c||{},this.contextAttr.alpha=!0,this.gl=null,this.webgl2=!1,this.initWebGL()};a.prototype._WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],a.prototype.initWebGL=function(){if(this.options.webgl2===!0){try{this.gl=this.canvas.getContext("webgl2",this.contextAttr)}catch(a){}this.gl?this.webgl2=!0:console.log("Failed to get a WebGL 2 context - defaulting to WebGL 1.")}if(!this.gl)for(var b=0;!this.gl&&b<this._WEBGL_CONTEXT_NAMES.length;b++)try{this.gl=this.canvas.getContext(this._WEBGL_CONTEXT_NAMES[b],this.contextAttr)}catch(a){}if(!this.gl)throw SceneJS_error.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Failed to get a WebGL context")},a.prototype.loseWebGLContext=function(){this.options.simulateWebGLContextLost&&this.canvas.loseContext()},a.prototype.setResolutionScaling=function(a){this.resolutionScaling=a,this.canvas.width=this.canvas.clientWidth*a,this.canvas.height=this.canvas.clientHeight*a}}(),function(){"use strict";var a=window.SceneJS_Engine=function(a,b){b=b||{},a.type="scene",this.id=a.id,this._numPasses=a.numPasses||1,this._clearEachPass=!!a.clearEachPass,this.canvas=new SceneJS_Canvas(this.id,a.canvasId,a.contextAttr,b),this._coreFactory=new SceneJS_CoreFactory,this._nodeFactory=new SceneJS_NodeFactory,this.stats={build:{version:SceneJS.VERSION},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{},state:{programs:0},geometry:{meshes:0,vertices:0,triangles:0},textures:{},load:{sceneGraphCompilation:0,shaderCompilation:0,programCompilation:0},memory:{positions:0,colors:0,normals:0,uvs:0,indices:0,morphPositions:0,morphNormals:0,textures:0,tangents:0,pickPositions:0,pickColors:0},frame:{frameCount:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,drawChunks:0}},this.display=new SceneJS_Display(this.stats,{canvas:this.canvas,transparent:a.transparent,autoTangents:b.autoTangents,gammaInputPhong:b.gammaInputPhong}),this.sceneDirty=!1,this._sceneBranchesDirty=!1,this._compilationPaused=!1,this._nodesToDestroy=[],this._numNodesToDestroy=0,this.destroyed=!1;for(var c=this.canvas.gl,d=SceneJS.ENABLE_EXTENSIONS,e=0,f=d.length;f>e;++e)c.getExtension(d[e]);this.cpuTimer=SceneJS.timer,this.gpuTimer=c.getExtension("EXT_disjoint_timer_query")||null,this.gpuTimer&&(this.gpuTimerQuery=this.gpuTimer.createQueryEXT(this.gpuTimer.TIME_ELAPSED_EXT)),this.sceneStatus={nodes:{},numTasks:0};var g=this,h=a.nodes;a.nodes=[],this.scene=this.createNode(a),h&&(a.nodes=h,this.scene.addNodes(h)),this.canvas.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_LOST,{scene:g.scene})},!1),this.canvas.canvas.addEventListener("webglcontextrestored",function(){g.canvas.initWebGL();for(var a=g.canvas.gl,b=SceneJS.ENABLE_EXTENSIONS,c=0,d=b.length;d>c;++c)a.getExtension(b[c]);g.gpuTimer=a.getExtension("EXT_disjoint_timer_query"),g.gpuTimer&&(g.gpuTimerQuery=g.gpuTimer.createQueryEXT(g.gpuTimer.TIME_ELAPSED_EXT)),g._coreFactory.webglRestored(),g.display.webglRestored(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_RESTORED,{scene:g.scene})},!1)};a.prototype.setNumPasses=function(a){this._numPasses=a},a.prototype.setClearEachPass=function(a){this._clearEachPass=a},a.prototype.loseWebGLContext=function(){this.canvas.loseWebGLContext()},a.prototype.hasNodeType=function(a){return!!SceneJS_NodeFactory.nodeTypes[a]},a.prototype.createNode=function(a){this._doDestroyNodes(),a.type=a.type||"node";var b=this._coreFactory.getCore(a.type,a.coreId),c=this._nodeFactory.getNode(this,a,b),d=a.nodes;if(d){var e=SceneJS_NodeFactory.nodeTypes[c.type],f=!!e&&!!e.prototype._fromPlugin;if(!f)for(var g=0,h=d.length;h>g;g++){var i=this.createNode(d[g]);c.addNode(i)}}return c},a.prototype._doDestroyNodes=function(){for(var a;this._numNodesToDestroy>0;)--this._numNodesToDestroy,a=this._nodesToDestroy[this._numNodesToDestroy],this._nodesToDestroy[this._numNodesToDestroy]=null,a._doDestroy(),this._coreFactory.putCore(a._core),this._nodeFactory.putNode(a)},a.prototype.findNode=function(a){return this._nodeFactory.nodes.items[a]},a.prototype.findNodes=function(a){var b=new RegExp(a),c=[],d=this._nodeFactory.nodes.items;for(var e in d)d.hasOwnProperty(e)&&b.test(e)&&c.push(d[e]);return c},a.prototype.hasCore=function(a,b){return this._coreFactory.hasCore(a,b)},a.prototype.branchDirty=function(a){if(!this.sceneDirty&&a!=window){a.branchDirty=!0,a.dirty=!0;for(var b=a.parent;b&&!b.dirty&&!b.branchDirty;b=b.parent)b.dirty=!0;this._sceneBranchesDirty=!0}},a.prototype.render=function(a){var b=!1;if(this._willRender()||a&&a.force)for(var c=Date.now(),d=a&&a.force,e=a&&a.custom,f=0;f<this._numPasses;f++)this.scene.publish("rendering",{pass:f}),this.compile(),this.display.prepareScene(),this.display.render({pass:f,clear:this._clearEachPass||0==f,force:d,custom:e,opaqueOnly:a&&a.opaqueOnly}),this.scene.publish("rendered",{sceneId:this.id,time:c,pass:f}),b=!0;return b},a.prototype.pick=function(a){this._willRender()&&this.compile();var b=this.display.pick({pickTriangle:a?a.rayPick:!1,pickRegion:a?a.regionPick:!1,canvasPos:a.canvasPos,origin:a.origin,direction:a.direction});return b},a.prototype.readPixels=function(a,b,c){return this._willRender()&&this.compile(),this.display.readPixels(a,b,c)},a.prototype._willRender=function(){return SceneJS_events.fireEvent(SceneJS_events.RENDER),this.display.imageDirty||this.display.objectListDirty||this._sceneBranchesDirty||this.sceneDirty},a.prototype.pauseCompilation=function(){this._compilationPaused=!0},a.prototype.resumeCompilation=function(){this._compilationPaused=!1},a.prototype.compile=function(){if(!this._compilationPaused){if(this._sceneBranchesDirty||this.sceneDirty){this._sceneBranchesDirty=!1,SceneJS_events.fireEvent(SceneJS_events.SCENE_COMPILING,{engine:this});var a=SceneJS.timer.now();this.scene._compileNodes(),this.stats.load.sceneGraphCompilation+=SceneJS.timer.now()-a,this.sceneDirty=!1}this._doDestroyNodes()}},a.prototype.destroyNode=function(a){this._nodesToDestroy[this._numNodesToDestroy++]=a;var b=this.sceneStatus.nodes[a.id];b&&(this.sceneStatus.numTasks-=b.numTasks,delete this.sceneStatus.nodes[a.id])},a.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";window.SceneJS_error=new function(){var a;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){a=b.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){a=null},1e5),this.fatalError=function(b,c){"string"==typeof b&&(c=b,b=SceneJS.errors.ERROR);var d={errorName:SceneJS.errors._getErrorName(b)||"ERROR",code:b,exception:c,fatal:!0};return a&&(d.sceneId=a),SceneJS_events.fireEvent(SceneJS_events.ERROR,d),c},this.error=function(b,c){var d={errorName:SceneJS.errors._getErrorName(b)||"ERROR",code:b,exception:c,fatal:!1};a&&(d.sceneId=a),SceneJS_events.fireEvent(SceneJS_events.ERROR,d)}};!function(){SceneJS.errors={};var a=0;SceneJS.errors.ERROR=a++,SceneJS.errors.INVALID_FRAMEBUFFER=a++,SceneJS.errors.WEBGL_NOT_SUPPORTED=a++,SceneJS.errors.WEBGL_CONTEXT_LOST=a++,SceneJS.errors.NODE_CONFIG_EXPECTED=a++,SceneJS.errors.ILLEGAL_NODE_CONFIG=a++,SceneJS.errors.SHADER_COMPILATION_FAILURE=a++,SceneJS.errors.SHADER_LINK_FAILURE=a++,SceneJS.errors.CANVAS_NOT_FOUND=a++,SceneJS.errors.OUT_OF_VRAM=a++,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=a++,SceneJS.errors.NODE_NOT_FOUND=a++,SceneJS.errors.NODE_ILLEGAL_STATE=a++,SceneJS.errors.ID_CLASH=a++}(),SceneJS.errors._getErrorName=function(a){for(var b in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(b)&&SceneJS.errors[b]==a)return b;return null}}(),function(){"use strict";SceneJS.log=new function(){var a,b=null,c={},d=0,e="";SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){a=b.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){c={},b=null,a=null},1e5),this._setIndent=function(a){d=a;for(var b=[],c=0;d>c;c++)b.push("----");e=b.join("")},this.error=function(a){this._log("error",a)},this.warn=function(a){this._log("warn",a)},this.info=function(a){this._log("info",a)},this.debug=function(a){this._log("debug",a)},this.setFuncs=function(a){if(a){b=a;for(var d in c)this._flush(d)}},this._flush=function(a){var d=c[a];if(d){var e=b?b[a]:null;if(e){for(var f=0;f<d.length;f++)e(d[f]);c[a]=[]}}},this._log=function(a,b){if(SceneJS._isArray(b))for(var c=0;c<b.length;c++)this.__log(a,b[c]);else this.__log(a,b)},this.__log=function(a,c){c=e+c,b&&b[a]?b[a](c):console&&console[a]&&console[a](c)},this.getFuncs=function(){return b}}}(),function(){"use strict";{var a=(mat4.create(),mat4.create(),vec2.create(),vec3.create()),b=vec3.create(),c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create();vec3.create(),vec4.create()}window.SceneJS_math_log2=Math.log2?Math.log2:function(a){return Math.round(Math.log(a)*Math.LOG2E)},window.SceneJS_math_isPOT=function(a){return 0==(a&a-1)},window.SceneJS_math_cross3Vec4=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return[d*h-e*g,e*f-c*h,c*g-d*f,0]},window.SceneJS_math_setCellMat4=function(a,b,c,d){a[b+4*c]=d},window.SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:10},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},window.SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,10],look:[0,0,0],up:[0,1,0]},window.SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},window.SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},window.SceneJS_math_angleAxisQuaternion=function(a,b,c,d){var e=d/180*Math.PI,f=e/2,g=Math.sin(f);return[g*a,g*b,g*c,Math.cos(f)]},window.SceneJS_math_mulQuaternions=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return[f*g+c*j+d*i-e*h,f*h+d*j+e*g-c*i,f*i+e*j+c*h-d*g,f*j-c*g-d*h-e*i]},window.SceneJS_math_newMat4FromQuaternion=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=2*b,g=2*c,h=2*d,i=f*e,j=g*e,k=h*e,l=f*b,m=g*b,n=h*b,o=g*c,p=h*c,q=h*d,r=mat4.create();return SceneJS_math_setCellMat4(r,0,0,1-(o+q)),SceneJS_math_setCellMat4(r,0,1,m-k),SceneJS_math_setCellMat4(r,0,2,n+j),SceneJS_math_setCellMat4(r,1,0,m+k),SceneJS_math_setCellMat4(r,1,1,1-(l+q)),SceneJS_math_setCellMat4(r,1,2,p-i),SceneJS_math_setCellMat4(r,2,0,n-j),SceneJS_math_setCellMat4(r,2,1,p+i),SceneJS_math_setCellMat4(r,2,2,1-(l+o)),r},window.SceneJS_math_normalizeQuaternion=function(a){var b=vec4.length([a[0],a[1],a[2],a[3]]);return[a[0]/b,a[1]/b,a[2]/b,a[3]/b]},window.SceneJS_math_angleAxisFromQuaternion=function(a){a=SceneJS_math_normalizeQuaternion(a);var b=a[3],c=2*Math.acos(b),d=Math.sqrt(1-b*b);return.001>d?{x:a[0],y:a[1],z:a[2],angle:57.295779579*c}:{x:a[0]/d,y:a[1]/d,z:a[2]/d,angle:57.295779579*c}},window.SceneJS_math_decompressPosition=function(a,b,c){a[0]=b[0]*c[0]+c[12],a[1]=b[1]*c[5]+c[13],a[2]=b[2]*c[10]+c[14]},window.SceneJS_math_decompressUV=function(a,b,c){a[0]=b[0]*c[0]+c[6],a[1]=b[1]*c[4]+c[7]},window.SceneJS_math_getPickPrimitives=function(a,b,c){var d,e,f=!!b;f?(e=b.length,d=c?new Uint16Array(3*e):new Float32Array(3*e)):(e=a.length/3,d=a);for(var g,h,i,j,k,l,m,n,o=new Uint8Array(4*e),p=0,q=0;e>q;q+=3)h=3*q,i=4*q,n=p>>24&255,m=p>>16&255,l=p>>8&255,k=255&p,f&&(j=b[q],g=3*j,d[h]=a[g],d[h+1]=a[g+1],d[h+2]=a[g+2]),o[i]=k,o[i+1]=l,o[i+2]=m,o[i+3]=n,f&&(j=b[q+1],g=3*j,d[h+3]=a[g],d[h+4]=a[g+1],d[h+5]=a[g+2]),o[i+4]=k,o[i+5]=l,o[i+6]=m,o[i+7]=n,f&&(j=b[q+2],g=3*j,d[h+6]=a[g],d[h+7]=a[g+1],d[h+8]=a[g+2]),o[i+8]=k,o[i+9]=l,o[i+10]=m,o[i+11]=n,p++;return{positions:d,colors:o}},window.SceneJS_math_getPickPositions=function(a,b){for(var c,d,e,f=b.length,g=new Float32Array(3*f),h=0;f>h;h++)c=3*h,e=b[h],d=3*e,g[c]=a[d],g[c+1]=a[d+1],g[c+2]=a[d+2];return g},window.SceneJS_math_getPickColors=function(a){for(var b,c,d,e,f,g=a.length,h=new Uint8Array(4*g),i=0,j=0;g>j;j+=3)b=4*j,f=i>>24&255,e=i>>16&255,d=i>>8&255,c=255&i,h[b]=c,h[b+1]=d,h[b+2]=e,h[b+3]=f,h[b+4]=c,h[b+5]=d,h[b+6]=e,h[b+7]=f,h[b+8]=c,h[b+9]=d,h[b+10]=e,h[b+11]=f,i++;return h},window.SceneJS_math_rayPlaneIntersect=function(e,f,g,h,i,j){j=j||vec3.create(),f=vec3.normalize(a,f);var k=vec3.subtract(b,h,g),l=vec3.subtract(c,i,g),m=vec3.cross(d,k,l);vec3.normalize(m,m);var n=-vec3.dot(g,m),o=-(vec3.dot(e,m)+n)/vec3.dot(f,m);return j[0]=e[0]+o*f[0],j[1]=e[1]+o*f[1],j[2]=e[2]+o*f[2],j},window.SceneJS_math_cartesianToBarycentric=function(d,e,f,g,h){var i=vec3.subtract(a,g,e),j=vec3.subtract(b,f,e),k=vec3.subtract(c,d,e),l=vec3.dot(i,i),m=vec3.dot(i,j),n=vec3.dot(i,k),o=vec3.dot(j,j),p=vec3.dot(j,k),q=l*o-m*m;if(0===q)return null;var r=1/q,s=(o*n-m*p)*r,t=(l*p-m*n)*r;return h[0]=1-s-t,h[1]=t,h[2]=s,h},window.SceneJS_math_barycentricToCartesian=function(a,b,c,d,e){var f=a[0],g=a[1],h=a[2];return e[0]=b[0]*f+c[0]*g+d[0]*h,e[1]=b[1]*f+c[1]*g+d[1]*h,e[2]=b[2]*f+c[2]*g+d[2]*h,e},window.SceneJS_math_barycentricToCartesian=function(a,b,c,d,e){e=e||vec3.create();var f=a[0],g=a[1],h=a[2];return e[0]=b[0]*f+c[0]*g+d[0]*h,e[1]=b[1]*f+c[1]*g+d[1]*h,e[2]=b[2]*f+c[2]*g+d[2]*h,e},window.SceneJS_math_buildTangents=function(h,i,j,k,l){for(var m=new Float32Array(h.length),n=.001,o=vec3.create(),p=vec3.create(),q=vec3.create(),r=vec2.create(),s=vec2.create(),t=vec2.create(),u=i?i.length:h.length/3,v=0;u>v;v+=3){var w=i?i[v]:v;o.set(h.subarray(3*w,3*w+3)),r.set(j.subarray(2*w,2*w+2)),w=i?i[v+1]:v+1,p.set(h.subarray(3*w,3*w+3)),s.set(j.subarray(2*w,2*w+2)),w=i?i[v+2]:v+2,q.set(h.subarray(3*w,3*w+3)),t.set(j.subarray(2*w,2*w+2)),k&&(SceneJS_math_decompressPosition(o,o,k),SceneJS_math_decompressPosition(p,p,k),SceneJS_math_decompressPosition(q,q,k)),l&&(SceneJS_math_decompressUV(r,r,l),SceneJS_math_decompressUV(s,s,l),SceneJS_math_decompressUV(t,t,l));var x=vec3.subtract(a,p,o),y=vec3.subtract(b,q,o),z=vec2.subtract(c,s,r),A=vec2.subtract(d,t,r),B=z[0]*A[1]-z[1]*A[0];0===B&&(B=n);for(var C=1/B,D=vec3.scale(f,vec3.subtract(g,vec3.scale(e,x,A[1]),vec3.scale(f,y,z[1])),C),E=0;3>E;E++){var F=i?3*i[v+E]:3*(v+E);m[F]+=D[0],m[F+1]+=D[1],m[F+2]+=D[2]}}return m},window.SceneJS_math_octDecodeVec2=function(a,b){var c=a[0],d=a[1];c=(2*c+1)/255,d=(2*d+1)/255;var e=1-Math.abs(c)-Math.abs(d);0>e&&(c=(1-Math.abs(d))*(c>=0?1:-1),d=(1-Math.abs(c))*(d>=0?1:-1));var f=Math.sqrt(c*c+d*d+e*e);return b[0]=c/f,b[1]=d/f,b[2]=e/f,b}}(),function(){"use strict";SceneJS._webgl={enumMap:{funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"}}}(),function(){"use strict";SceneJS._webgl.ArrayBuffer=function(a,b,c,d,e,f,g){
switch(this.allocated=!1,c.constructor){case Uint8Array:this.itemType=a.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=a.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=a.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=a.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=a.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=a.INT,this.itemByteSize=4;break;default:this.itemType=a.FLOAT,this.itemByteSize=4}this.gl=a,this.type=b,this.numItems=d,this.itemSize=e,this.usage=f,this.normalize=!!g,this._allocate(c,d)},SceneJS._webgl.ArrayBuffer.prototype._allocate=function(a,b){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,a,this.usage),this.gl.bindBuffer(this.type,null),this.numItems=b,this.length=a.length,this.allocated=!0)},SceneJS._webgl.ArrayBuffer.prototype.setData=function(a){this.allocated&&(this.gl.bindBuffer(this.type,this.handle),a.length>this.length?(this.gl.bufferData(this.type,a,this.usage),this.length=a.length):this.gl.bufferSubData(this.type,0,a),this.gl.bindBuffer(this.type,null),this.numItems=a.length)},SceneJS._webgl.ArrayBuffer.prototype.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},SceneJS._webgl.ArrayBuffer.prototype.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.handle=null,this.allocated=!1)},SceneJS._webgl.ArrayBuffer.prototype.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)}}(),function(){"use strict";SceneJS._webgl.Attribute=function(a,b){this.gl=a,this.location=b},SceneJS._webgl.Attribute.prototype.bindArrayBuffer=function(a){a&&(a.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,a.itemSize,a.itemType,a.normalize,0,0))}}(),function(){"use strict";SceneJS._webgl.Framebuffer=function(a){this.allocated=!1,this.canvas=a.canvas,this.gl=a.canvas.gl,this.canvasWidth=0,this.canvasHeight=0,this.sizeRatio=a.sizeRatio||1,"number"==typeof a.colorAttachments&&(a.colorAttachments=new Array(a.colorAttachments));var b=a.colorAttachments||new Array(1);this.numColorAttachments=b.length,this.colorAttachments=new Array(this.numColorAttachments);for(var c=0;c<this.numColorAttachments;++c){var d=b[c]||{};this.colorAttachments[c]={format:void 0!==d.format?this.gl[d.format]:this.gl.RGBA,type:void 0!==d.type?this.gl[d.type]:this.gl.UNSIGNED_BYTE,minFilter:void 0!==d.minFilter?this.gl[d.minFilter]:this.gl.LINEAR,magFilter:void 0!==d.magFilter?this.gl[d.magFilter]:this.gl.LINEAR,wrapS:void 0!==d.wrapS?this.gl[d.wrapS]:this.gl.CLAMP_TO_EDGE,wrapT:void 0!==d.wrapT?this.gl[d.wrapT]:this.gl.CLAMP_TO_EDGE}}this.sharedDepthBuffer=a.sharedDepthBuffer||null,this.hasDepthAttachment=a.depthAttachment!==!1,this.useDepthTextures=SceneJS.WEBGL_INFO.depthTexturesSupported,this.drawBuffers=this.gl.getExtension("WEBGL_draw_buffers"),window.localContentOnly&&(this.useDepthTextures=!1),this.buf=null,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.webglRestored=function(a){this.gl=a,this.buf=null,this.allocated=!1,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.bind=function(){this._touch(),this.bound||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),this.gl.viewport(0,0,this.buf.width,this.buf.height),this.bound=!0)},SceneJS._webgl.Framebuffer.prototype._touch=function(){var a=this.gl.drawingBufferWidth,b=this.gl.drawingBufferHeight;if(this.buf){if(this.canvasWidth==a&&this.canvasHeight==b)return;for(var c=0;c<this.numColorAttachments;++c)this.gl.deleteTexture(this.buf.colorTargets[c]);this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.gl.deleteFramebuffer(this.buf.framebuf)}this.canvasWidth=a,this.canvasHeight=b;var d=Math.floor(a*this.sizeRatio),e=Math.floor(b*this.sizeRatio);this.buf={framebuf:this.gl.createFramebuffer(),colorTargets:new Array(this.numColorAttachments),width:d,height:e},this.buf.depthTarget=this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget().texture():this.useDepthTextures?this.gl.createTexture():this.gl.createRenderbuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf);for(var c=0;c<this.numColorAttachments;++c)this.buf.colorTargets[c]=this.gl.createTexture(),this._setTexture(this.buf.colorTargets[c],d,e,this.colorAttachments[c]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0+c,this.gl.TEXTURE_2D,this.buf.colorTargets[c],0);if(this.drawBuffers){for(var f=new Array(this.numColorAttachments),c=0;c<this.numColorAttachments;++c)f[c]=this.gl.COLOR_ATTACHMENT0+c;this.drawBuffers.drawBuffersWEBGL(f)}if(this.hasDepthAttachment&&(this.useDepthTextures?(this.sharedDepthBuffer||this._setTexture(this.buf.depthTarget,d,e,{format:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.buf.depthTarget,0)):(this.sharedDepthBuffer||(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,d,e)),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null))),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),!this.gl.isFramebuffer(this.buf.framebuf))throw SceneJS_error.fatalError(SceneJS.errors.INVALID_FRAMEBUFFER,"Invalid framebuffer");var g=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);switch(g){case this.gl.FRAMEBUFFER_COMPLETE:break;case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: "+g)}this.bound=!1},SceneJS._webgl.Framebuffer.prototype._setTexture=function(a,b,c,d){var e=void 0!==d.format?d.format:this.gl.RGBA,f=void 0!==d.type?d.type:this.gl.UNSIGNED_BYTE,g=void 0!==d.minFilter?d.minFilter:this.gl.LINEAR,h=void 0!==d.magFilter?d.magFilter:this.gl.LINEAR,i=void 0!==d.wrapS?d.wrapS:this.gl.CLAMP_TO_EDGE,j=void 0!==d.wrapT?d.wrapT:this.gl.CLAMP_TO_EDGE;this.gl.bindTexture(this.gl.TEXTURE_2D,a);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,e,b,c,0,e,f,null)}catch(k){var l=new WebGLUnsignedByteArray(b*c*3);this.gl.texImage2D(this.gl.TEXTURE_2D,0,e,b,c,0,e,f,l)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,g),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,h),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,j)},SceneJS._webgl.Framebuffer.prototype.clear=function(){if(!this.bound)throw"Render buffer not bound";this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.BLEND)},SceneJS._webgl.Framebuffer.prototype.read=function(a,b){var c=a,d=this.canvas.canvas.height-b,e=new Uint8Array(4);return this.gl.readPixels(c,d,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e},SceneJS._webgl.Framebuffer.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.bound=!1},SceneJS._webgl.Framebuffer.prototype.getColorTarget=function(a){var b=this;return a=a||0,{bind:function(c){return b.buf&&b.buf.colorTargets[a]?(b.gl.activeTexture(b.gl.TEXTURE0+c),b.gl.bindTexture(b.gl.TEXTURE_2D,b.buf.colorTargets[a]),!0):!1},unbind:function(c){b.buf&&b.buf.colorTargets[a]&&(b.gl.activeTexture(b.gl.TEXTURE0+c),b.gl.bindTexture(b.gl.TEXTURE_2D,null))},texture:function(){return b.buf.colorTargets[a]}}},SceneJS._webgl.Framebuffer.prototype.getDepthTarget=function(){var a=this;return this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget():{bind:function(b){return a.buf&&a.buf.depthTarget?(a.gl.activeTexture(a.gl.TEXTURE0+b),a.gl.bindTexture(a.gl.TEXTURE_2D,a.buf.depthTarget),!0):!1},unbind:function(b){a.buf&&a.buf.depthTarget&&(a.gl.activeTexture(a.gl.TEXTURE0+b),a.gl.bindTexture(a.gl.TEXTURE_2D,null))},texture:function(){return a.buf.depthTarget}}},SceneJS._webgl.Framebuffer.prototype.destroy=function(){if(this.buf){for(var a=0;a<this.numColorAttachments;++a)this.gl.deleteTexture(this.buf.colorTargets[a]);this.gl.deleteFramebuffer(this.buf.framebuf),this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.buf=null,this.bound=!1}}}(),function(){"use strict";SceneJS._webgl.Program=function(a,b,c,d,e){this.stats=a,this.hash=c,this.useCount=0,this.allocated=!1,this.gl=null,this._uniforms={},this._samplers={},this._attributes={},this.vertexSource=d,this.fragmentSource=e,this._vertexShader=null,this._fragmentShader=null,this.build(b)},SceneJS._webgl.Program.prototype.build=function(a){var b,c,d,e,f,g=SceneJS.timer.now(),h=this.stats;if(this.gl=a,this._vertexShader=new SceneJS._webgl.Shader(h,a,a.VERTEX_SHADER,this.vertexSource),this._fragmentShader=new SceneJS._webgl.Shader(h,a,a.FRAGMENT_SHADER,this.fragmentSource),this.handle=a.createProgram(),this.handle){a.attachShader(this.handle,this._vertexShader.handle),a.attachShader(this.handle,this._fragmentShader.handle),a.linkProgram(this.handle),a.getProgramParameter(this.handle,a.LINK_STATUS)||SceneJS.log.error("Shader program failed to link: "+a.getProgramInfoLog(this.handle));var i=a.getProgramParameter(this.handle,a.ACTIVE_UNIFORMS),j=0;for(c=0;i>c;++c)d=a.getActiveUniform(this.handle,c),d&&(e=d.name,"\x00"==e[e.length-1]&&(e=e.substr(0,e.length-1)),f=a.getUniformLocation(this.handle,e),d.type==a.SAMPLER_2D||d.type==a.SAMPLER_CUBE||35682==d.type?this._samplers[e]=f:(this._uniforms[e]=new SceneJS._webgl.Uniform(a,d.type,d.size,f),++j));var k=a.getProgramParameter(this.handle,a.ACTIVE_ATTRIBUTES);for(c=0;k>c;c++)b=a.getActiveAttrib(this.handle,c),b&&(f=a.getAttribLocation(this.handle,b.name),this._attributes[b.name]=new SceneJS._webgl.Attribute(a,f));h.load.programCompilation+=SceneJS.timer.now()-g,this.allocated=!0}},SceneJS._webgl.Program.prototype.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},SceneJS._webgl.Program.prototype.getUniformLocation=function(a){if(this.allocated){var b=this._uniforms[a];return b?b.getLocation():void 0}},SceneJS._webgl.Program.prototype.getUniform=function(a){if(this.allocated){var b=this._uniforms[a];return b?b:void 0}},SceneJS._webgl.Program.prototype.getAttribute=function(a){if(this.allocated){var b=this._attributes[a];return b?b:void 0}},SceneJS._webgl.Program.prototype.bindArrayBuffer=function(a,b){if(this.allocated){var c=this._attributes[a];c&&c.bindArrayBuffer(b)}},SceneJS._webgl.Program.prototype.bindTexture=function(a,b,c){if(!this.allocated)return!1;var d=this._samplers[a];return d&&b.bind(c)?(this.gl.uniform1i(d,c),!0):!1},SceneJS._webgl.Program.prototype.destroy=function(){this.allocated&&(this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this._attributes=null,this._uniforms=null,this._samplers=null,this.allocated=!1)},SceneJS._webgl.Program.prototype.setUniform=function(a,b){if(this.allocated){var c=this._uniforms[a];c&&c.setValue(b)}}}(),function(){"use strict";SceneJS._webgl.Shader=function(a,b,c,d){this.allocated=!1;var e=SceneJS.timer.now();if(this.handle=b.createShader(c),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create WebGL shader");if(b.shaderSource(this.handle,d),b.compileShader(this.handle),this.valid=0!=b.getShaderParameter(this.handle,b.COMPILE_STATUS),!this.valid&&!b.isContextLost()){SceneJS.log.error("Shader program failed to compile: "+b.getShaderInfoLog(this.handle)),SceneJS.log.error("Shader source:");for(var f=d.split("\n"),g=0;g<f.length;g++)SceneJS.log.error(g+1+": "+f[g]);throw SceneJS_error.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}a.load.shaderCompilation+=SceneJS.timer.now()-e,this.allocated=!0}}(),function(){"use strict";SceneJS._webgl.Texture2D=function(a,b){try{this._init(a,b)}catch(c){throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create texture: "+c.message||c)}},SceneJS._webgl.Texture2D.prototype._init=function(a,b){this.allocated=!1,this.gl=a,this.target=b.target||a.TEXTURE_2D,this.minFilter=b.minFilter,this.magFilter=b.magFilter,this.wrapS=b.wrapS,this.wrapT=b.wrapT,this.update=b.update,this.texture=b.texture,this.compressed=!!b.compressed,this.format=a.RGBA,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0,a.bindTexture(this.target,this.texture),b.minFilter&&a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,b.minFilter),b.magFilter&&a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,b.magFilter),b.wrapS&&a.texParameteri(this.target,a.TEXTURE_WRAP_S,b.wrapS),b.wrapT&&a.texParameteri(this.target,a.TEXTURE_WRAP_T,b.wrapT),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY!==!1),this.compressed||this.minFilter!=a.NEAREST_MIPMAP_NEAREST&&this.minFilter!=a.LINEAR_MIPMAP_NEAREST&&this.minFilter!=a.NEAREST_MIPMAP_LINEAR&&this.minFilter!=a.LINEAR_MIPMAP_LINEAR||a.generateMipmap(this.target),a.bindTexture(this.target,null),this.allocated=!0},SceneJS._webgl.Texture2D.prototype.bind=function(a){if(this.allocated){var b=this.gl;return this.texture?(b.activeTexture(b["TEXTURE"+a]),b.bindTexture(this.target,this.texture),this.update&&this.update(b),!0):!1}},SceneJS._webgl.Texture2D.prototype.unbind=function(a){if(this.allocated){var b=this.gl;this.texture&&(b.activeTexture(b["TEXTURE"+a]),b.bindTexture(this.target,null))}},SceneJS._webgl.Texture2D.prototype.destroy=function(){if(this.allocated){var a=this.gl;this.texture&&(a.deleteTexture(this.texture),this.texture=null)}}}(),function(){"use strict";function a(a,b,c){if(b===a.BOOL)return new Array(c);if(b===a.BOOL_VEC2)return new Array(2*c);if(b===a.BOOL_VEC3)return new Array(3*c);if(b===a.BOOL_VEC4)return new Array(4*c);if(b===a.INT)return new Uint32Array(c);if(b===a.INT_VEC2)return new Uint32Array(2*c);if(b===a.INT_VEC3)return new Uint32Array(3*c);if(b===a.INT_VEC4)return new Uint32Array(4*c);if(b===a.FLOAT)return new Float32Array(c);if(b===a.FLOAT_VEC2)return new Float32Array(2*c);if(b===a.FLOAT_VEC3)return new Float32Array(3*c);if(b===a.FLOAT_VEC4)return new Float32Array(4*c);if(b===a.FLOAT_MAT2)return new Float32Array(4*c);if(b===a.FLOAT_MAT3)return new Float32Array(9*c);if(b===a.FLOAT_MAT4)return new Float32Array(16*c);throw"Unsupported shader uniform type: "+b}var b=function(){var a={},b=document.createElement("canvas"),c=b.getContext("webgl")||b.getContext("experimental-webgl");return c?(a[c.BOOL]=function(a){var b,c,d=!0;if(1===this.length)this.value[0]!==a&&(d=!1);else for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){if(1===this.length)this.value[0]=a;else for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform1fv(this.location,this.value)}},a[c.BOOL_VEC2]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform2iv(this.location,a)}},a[c.BOOL_VEC3]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform3iv(this.location,a)}},a[c.BOOL_VEC4]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform4iv(this.location,a)}},a[c.INT_VEC2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform2iv(this.location,a))},a[c.INT_VEC3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform3iv(this.location,a))},a[c.INT_VEC4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform4iv(this.location,a))},a[c.FLOAT]=function(a){var b=!0;if(1===this.length)this.value[0]!==a&&(b=!1);else for(var c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(1===this.length?this.value[0]=a:this.value.set(a),this.gl.uniform1fv(this.location,this.value))},a[c.FLOAT_VEC2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform2fv(this.location,a))},a[c.FLOAT_VEC3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform3fv(this.location,a))},a[c.FLOAT_VEC4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform4fv(this.location,a))},a[c.FLOAT_MAT2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix2fv(this.location,!1,a))},a[c.FLOAT_MAT3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix3fv(this.location,!1,a))},a[c.FLOAT_MAT4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix4fv(this.location,!1,a))},a):a}();SceneJS._webgl.Uniform=function(c,d,e,f){this.gl=c,this.location=f,this.value=a(c,d,e),this.length=this.value.length,this.setValue=b[d]},SceneJS._webgl.Uniform.prototype.getLocation=function(){return this.location}}(),function(){"use strict";window.SceneJS_Core=function(a){this.type=a,this.coreId=null,this.stateId=null,this.useCount=0}}(),ColorFresnel.prototype.isEqual=function(a,b){var c=a.center.reduce(function(a,c,d){return a&&c===b.center[d]},!0),d=a.edge.reduce(function(a,c,d){return a&&c===b.edge[d]},!0),e=a.edgeBias===b.edgeBias,f=a.centerBias===b.centerBias,g=a.power===b.power;return c&&d&&e&&f&&g},ScalarFresnel.prototype.isEqual=function(a,b){var c=a.center===b.center,d=a.edge==b.edge,e=a.edgeBias===b.edgeBias,f=a.centerBias===b.centerBias,g=a.power===b.power;return c&&d&&e&&f&&g},function(){"use strict";function a(a){var b,c,d,e=a._engine.canvas.gl;a.arrays.positions?(b=SceneJS_math_getPickPrimitives(a.arrays.positions,a.arrays.indices,a.compressedPositions),c=b.positions,d=b.colors,a.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,c,c.length,3,e.STATIC_DRAW),a._engine.stats.memory.pickPositions+=c.length*c.constructor.BYTES_PER_ELEMENT,a._engine.stats.memory.pickColors+=d.length*d.constructor.BYTES_PER_ELEMENT):(d=SceneJS_math_getPickColors(a.arrays.indices),a._engine.stats.memory.pickColors+=d.length*d.constructor.BYTES_PER_ELEMENT),a.pickColorsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,d,d.length,4,e.STATIC_DRAW,!0)}function b(a,e,g,h,i,j){var k=vec3.create(),l=vec3.create(),m={triangles:null,left:null,right:null,bb:{min:k,max:l}};k[0]=k[1]=k[2]=Number.POSITIVE_INFINITY,l[0]=l[1]=l[2]=Number.NEGATIVE_INFINITY;var n,o;for(n=0,o=a.length;o>n;++n)for(var p=3*a[n],q=0;3>q;++q){var r;r=e?3*e[p+q]:3*(p+q),f[0]=g[r],f[1]=g[r+1],f[2]=g[r+2],h&&SceneJS_math_decompressPosition(f,f,h),f[0]<k[0]&&(k[0]=f[0]),f[0]>l[0]&&(l[0]=f[0]),f[1]<k[1]&&(k[1]=f[1]),f[1]>l[1]&&(l[1]=f[1]),f[2]<k[2]&&(k[2]=f[2]),f[2]>l[2]&&(l[2]=f[2])}if(j>c)return m.triangles=a,m;var s=(k[i]+l[i])/2,t=new Array(a.length),u=0,v=new Array(a.length),w=0;for(n=0,o=a.length;o>n;++n){var x,y,z,p=3*a[n];e?(x=e[p],y=e[p+1],z=e[p+2]):(x=p,y=p+1,z=p+2);var A=3*x,B=3*y,C=3*z,D=g[A+i],E=g[B+i],F=g[C+i];if(h){var G=h[5*i],H=h[i+12];D=D*G+H,E=E*G+H,F=F*G+H}s>=D||s>=E||s>=F?t[u++]=a[n]:v[w++]=a[n]}return d>u||d>w?(m.triangles=a,m):(t.length=u,v.length=w,m.left=b(t,e,g,h,(i+1)%3,j+1),m.right=b(v,e,g,h,(i+1)%3,j+1),m)}var c=SceneJS.KD_TREE_MAX_DEPTH,d=SceneJS.KD_TREE_MIN_TRIANGLES,e=window.SceneJS_GeometryCore=function(){this.type="xform",this.coreId=null,this.stateId=null,this.kdTree=null,this.kdTreeDirty=!0};e.prototype.getTangents=function(a){if(this.tangentBufs||(this.tangentBufs=[]),this.tangentBufs[a])return this.tangentBufs[a];var b=this.arrays,c=this.arrays.tangents[a],d=this._engine.canvas.gl;return c||b.positions&&b.uvs&&b.uvs[a]&&(c=SceneJS_math_buildTangents(b.positions,b.indices,b.uvs[a],this.positionDecodeMat,this.compressedUVs&&this.uvDecodeMats[a]),this._engine.stats.memory.tangents+=c.length*c.constructor.BYTES_PER_ELEMENT),c?(this.tangentBufs[a]=new SceneJS._webgl.ArrayBuffer(d,d.ARRAY_BUFFER,c,c.length,3,d.STATIC_DRAW),this.arrays.tangents[a]=!0,this.tangentBufs[a]):null},e.prototype.getPickPositions=function(){return this.pickPositionsBuf?this.pickPositionsBuf:(a(this),this.pickPositionsBuf)},e.prototype.getPickColors=function(){return this.pickColorsBuf?this.pickColorsBuf:(a(this),this.pickColorsBuf)},e.prototype.getKdTree=function(){return this.kdTree||this.buildKdTree(),this.kdTree},e.prototype.buildKdTree=function(){if(this.kdTreeDirty){var a=this.arrays.positions,c=this.arrays.indices;if(a){var d;d=c?c.length/3:a.length/9;for(var e=new Array(d),f=0;d>f;++f)e[f]=f;this.kdTree=b(e,c,a,this.positionDecodeMat,0,0),this.kdTreeDirty=!1}}};var f=vec3.create()}(),function(){"use strict";var a=SceneJS.PROPERTY_FLAGS,b=SceneJS.DEPTH_TEST_FLAGS,c=window.SceneJS_PropertiesCore=function(){this.type="properties",this.coreId=null,this.stateId=null,this.useCount=0,this.xrayParams=new Float32Array([.4,.8]),this.solidColor=new Float32Array([1,1,1]),this.colorModifiers=[],this.colorModRange=!1,this.opacityModifiers=[],this.opacityModRange=!1,this.name=null,this.flags=a.PICKING|a.ENABLED|a.REFLECTIVE|a.CCW|a.CLIPPING,this.transparent=!1,this.partiallyOpaque=!1,this.stochasticAlpha=!1,this.blend=!1,this.fragmentShaderHeader=null,this.fragmentShaderFooter=null,this.depthTest=b.ENABLED,this.hash="refl;;;;;;;"};c.prototype.getFlag=function(a){return!!(this.flags&a)},c.prototype.setFlag=function(a,b){this.flags=b?this.flags|a:this.flags&~a},c.prototype.resetTransparency=function(){var b=this.opacityModifiers,c=!1,d=!1,e=0;for(e=0;e<b.length;e++)if(b[e].value<1){c=!0;break}for(e=0;e<b.length;e++)if(b[e].range){d=!0;break}this.stochasticAlpha=this.getFlag(a.STOCHASTIC_ALPHA),this.transparent=this.getFlag(a.FORCE_TRANSPARENT)||!this.stochasticAlpha&&(c||this.getFlag(a.XRAY)),this.partiallyOpaque=this.getFlag(a.PARTIALLY_OPAQUE)||c&&d&&!this.getFlag(a.XRAY)}}(),function(){"use strict";var a=window.SceneJS_CoreFactory=function(){this._stateMap=new SceneJS_Map(null,SceneJS._baseStateId),this._cores={}};a.coreConstructors={geometry:SceneJS_GeometryCore,properties:SceneJS_PropertiesCore,"default":SceneJS_Core},a.prototype.getCore=function(b,c){var d=this._cores[b];d||(d=this._cores[b]={});var e;if(c&&(e=d[c]))return e.useCount++,e;var f=a.coreConstructors[b]||a.coreConstructors["default"];return e=new f(b),e.useCount=1,e.stateId=this._stateMap.addItem(e),e.coreId=void 0!=c&&null!=c?c:e.stateId,d[e.coreId]=e,e},a.prototype.hasCore=function(a,b){var c=this._cores[a];return c&&c[b]},a.prototype.putCore=function(a){if(0!=a.useCount&&--a.useCount<=0){var b=this._cores[a.type];delete b[a.coreId],this._stateMap.removeItem(a.stateId)}},a.prototype.webglRestored=function(){var a,b;for(var c in this._cores)if(this._cores.hasOwnProperty(c)&&(a=this._cores[c]))for(var d in a)a.hasOwnProperty(d)&&(b=a[d],b&&b.webglRestored&&b.webglRestored())}}(),function(){"use strict";SceneJS.Node=function(){},SceneJS.Node.prototype.constructor=SceneJS.Node,SceneJS.Node.prototype._construct=function(a,b,c,d){this._engine=a,this._core=b,this.coreId=b.coreId,this.id=c.id||c.nodeId||d,this.type=c.type||"node",this.data=c.data,this.parent=null,this.nodes=[],this.dirty=!1,this.disabled=!1,this.branchDirty=!1,this._init&&this._init(c)},SceneJS.Node.prototype.disable=function(){this.disabled||(this.disabled=!0,this._engine.branchDirty(this))},SceneJS.Node.prototype.enable=function(){this.disabled&&(this.disabled=!1,this._engine.branchDirty(this))},SceneJS.Node.prototype.log=function(){var a,b;switch(1==arguments.length?(a="info",b=arguments[0]):2==arguments.length&&(a=arguments[0],b=arguments[1]),a){case"warn":b="WARN;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b;break;case"error":b="ERROR; [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b;break;default:b="INFO;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b}console[a]?console[a](b):console.log(b)},SceneJS.Node.prototype.getScene=function(){return this._engine.scene},SceneJS.Node.prototype.getCoreId=function(){return this._core.coreId},SceneJS.Node.prototype.getID=function(){return this.id},SceneJS.Node.prototype.getId=function(){return this.id},SceneJS.Node.prototype.getNodeId=function(){return this.id},SceneJS.Node.prototype.getType=function(){return this.type},SceneJS.Node.prototype.getData=function(){return this.data},SceneJS.Node.prototype.setData=function(a){return this.data=a,this},SceneJS.Node.prototype.getNumNodes=function(){return this.nodes.length},SceneJS.Node.prototype.getNodes=function(){return this.nodes.slice(0)},SceneJS.Node.prototype.getNodeAt=function(a){return 0>a||a>=this.nodes.length?null:this.nodes[a]},SceneJS.Node.prototype.getFirstNode=function(){return 0==this.nodes.length?null:this.nodes[0]},SceneJS.Node.prototype.getLastNode=function(){return 0==this.nodes.length?null:this.nodes[this.nodes.length-1]},SceneJS.Node.prototype.getNode=function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].id==a)return this.nodes[b];return null},SceneJS.Node.prototype.disconnectNodeAt=function(a){var b=this.nodes.splice(a,1);return b.length>0?(b[0]._disconnectFromScene(),b[0].parent=null,this._engine.branchDirty(this),b[0]):null},SceneJS.Node.prototype.disconnect=function(){if(this.parent){for(var a=0;a<this.parent.nodes.length;a++)if(this.parent.nodes[a]===this){var b=this.parent.disconnectNodeAt(a);return this._disconnectFromScene(),this.parent=null,b}this._disconnectFromScene(),this.parent=null}return null},SceneJS.Node.prototype._connectToScene=function(){for(var a=0,b=this.nodes.length;b>a;a++)this.nodes[a]._connectToScene()},SceneJS.Node.prototype._disconnectFromScene=function(){for(var a=0,b=this.nodes.length;b>a;a++)this.nodes[a]._disconnectFromScene()},SceneJS.Node.prototype.removeNodeAt=function(a){var b=this.disconnectNodeAt(a);b&&b.destroy()},SceneJS.Node.prototype.removeNode=function(a){if(!a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined");if(!a._compile&&"string"==typeof a){var b=this._engine.findNode(a);if(!b)throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+a+"'");a=b}if(a._compile)for(var c=0;c<this.nodes.length;c++)if(this.nodes[c]===a){var d=this.removeNodeAt(c);return d}throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(a._compile?": "+a.id:a))},SceneJS.Node.prototype.disconnectNodes=function(){for(var a=this.nodes.length,b=0;a>b;b++)this.nodes[b]._disconnectFromScene(),this.nodes[b].parent=null;var c=this.nodes;return this.nodes=[],this._engine.branchDirty(this),c},SceneJS.Node.prototype.removeNodes=function(){for(var a=this.disconnectNodes(),b=0;b<a.length;b++)a[b].destroy()},SceneJS.Node.prototype.splice=function(){var a,b;if(null==this.parent)return null;var c=this.parent,d=this.disconnectNodes();for(a=0,b=d.length;b>a;a++)d[a].parent=this.parent,d[a]._connectToScene();for(a=0,b=c.nodes.length;b>a;a++)if(c.nodes[a]===this)return c.nodes.splice.apply(c.nodes,[a,1].concat(d)),this.nodes=[],this._disconnectFromScene(),this.parent=null,this.destroy(),this._engine.branchDirty(c),c},SceneJS.Node.prototype.addNodes=function(a){if(!a)return null;for(var b=a.length-1;b>=0;b--)this.addNode(a[b])},SceneJS.Node.prototype.addNode=function(a,b){if(a=a||{},a._compile){if(null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a}if("string"==typeof a){var c=this._engine.findNode(a);if(!c)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+a+"'");if(a=c,null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a}if(a.type=a.type||"node","node"==a.type||this._engine.hasNodeType(a.type))return a=this._engine.createNode(a),this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a;var d=this;return this._engine.createNode(a,function(a){d.nodes.push(a),a.parent=d,a._connectToScene(),d._engine.branchDirty(a),b&&b(a)}),null},SceneJS.Node.prototype.insertNode=function(a,b){if(!a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is undefined");if(a._compile||(a=this._engine.createNode(a)),!a._compile)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is not a SceneJS.Node");if(null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is still attached to another parent");if(void 0===b||null===b)a.addNodes(this.disconnectNodes()),this.addNode(a);else{if(0>b)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node index out of range: -1");b>=this.nodes.length?this.nodes.push(a):this.nodes.splice(b,0,a)}return a.parent=this,a._connectToScene(),a},SceneJS.Node.prototype.mapNodes=function(a){if(a(this))return this;for(var b,c=0;c<this.nodes.length;c++)if(b=this.nodes[c].mapNodes(a))return b;return null},SceneJS.Node.prototype.getParent=function(){return this.parent},SceneJS.Node.prototype.getParentOfType=function(a){for(var b=this.parent;b&&b.type!=a;)b=b.parent;return b},SceneJS.Node.prototype.eachParent=function(a){if(!a)throw"SceneJS.Node.eachParent param 'fn' is null or undefined";for(var b=0,c=this;c.parent;){if(a.call(c.parent,b++)===!0)return c.parent;c=c.parent}return null},SceneJS.Node.prototype.hasNode=function(a){if(null===a||void 0===a)throw"SceneJS.Node.hasNode param 'node' is null or undefined";var b,c=typeof a;if("number"==c)b=this.getNodeAt(a);else{if("string"!=c)throw"SceneJS.Node.hasNode param 'node' should be either an index number or an ID string";b=this.getNode(a)}return void 0!=b&&null!=b},SceneJS.Node.prototype.node=function(a){if(null===a||void 0===a)throw"SceneJS.Node.node param 'node' is null or undefined";var b,c=typeof a;if("number"==c)b=this.getNodeAt(a);else{if("string"!=c)throw"SceneJS.Node.node param 'node' should be either an index number or an ID string";b=this.getNode(a)}if(!b)throw"SceneJS.Node.node - node not found: '"+a+"'";return b},SceneJS.Node.prototype.eachNode=function(a,b){if(!a)throw"SceneJS.Node.eachNode param 'fn' is null or undefined";if("function"!=typeof a)throw"SceneJS.Node.eachNode param 'fn' should be a function";var c;b=b||{};var d=0;return b.andSelf&&a.call(this,d++)===!0?this:(b.depthFirst||b.breadthFirst?b.depthFirst&&(c=this._iterateEachNodeDepthFirst(a,this,d,!1)):c=this._iterateEachNode(a,this,d),
c?c:void 0)},SceneJS.Node.prototype.numNodes=function(){return this.nodes.length},SceneJS.Node.prototype._iterateEachNode=function(a,b,c){for(var d,e=b.nodes.length,f=0;e>f;f++)if(d=b.nodes[f],a.call(d,c++)===!0)return d;return null},SceneJS.Node.prototype._iterateEachNodeDepthFirst=function(a,b,c,d){if(d&&a.call(b,c++)===!0)return b;d=!0;for(var e,f=b.nodes.length,g=0;f>g;g++)if(e=this._iterateEachNodeDepthFirst(a,b.nodes[g],c,d))return e;return null},SceneJS.Node.prototype.findNodesByType=function(a,b){return this._findNodesByType(a,[],b)},SceneJS.Node.prototype._findNodesByType=function(a,b,c){var d;for(d=0;d<this.nodes.length;d++){var e=this.nodes[d];e.type==a&&b.push(e)}if(c)for(d=0;d<this.nodes.length;d++)this.nodes[d]._findNodesByType(a,b,c);return b},SceneJS.Node.prototype.findParentByType=function(a){for(var b=this.parent;b&&b.type!=a;)b=b.parent;return b},SceneJS.Node.prototype.getJSON=function(){return this},SceneJS.Node.prototype._compile=function(a){this.preCompile&&this.preCompile(),this._compileNodes(a),this.postCompile&&this.postCompile()},SceneJS.Node.prototype._compileNodes=function(a){for(var b,c=(!!this.onRendered,0),d=this.nodes.length;d>c;c++)b=this.nodes[c],b.branchDirty=b.branchDirty||this.branchDirty,(b.dirty||b.branchDirty||this._engine.sceneDirty)&&(b.disabled?b._compileNodes(a):b._compile(a),b.dirty=!1,b.branchDirty=!1)},SceneJS.Node.prototype.destroy=function(){if(!this.destroyed){if(this.parent)for(var a=this.parent.nodes,b=a.length,c=0;b>c;c++)if(a[c].id===this.id){a.splice(c,1);break}this._engine.scene.unpublish("nodes/"+this.id),this._destroyTree(),this._engine.display.objectListDirty=!0}return this},SceneJS.Node.prototype._destroyTree=function(){this.destroyed=!0,this._engine.destroyNode(this);for(var a,b=0,c=this.nodes.length;c>b;b++)a=this.nodes[b],this._engine.scene.unpublish("nodes/"+a.id),a._destroyTree()},SceneJS.Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),this}}(),function(){"use strict";var a=window.SceneJS_NodeFactory=function(){this.nodes=new SceneJS_Map({})};a.nodeTypes={},a.createNodeType=function(b){if(a.nodeTypes[b])throw"Node type already defined: "+b;var c=function(){SceneJS.Node.apply(this,arguments),this.type=b};return c.prototype=new SceneJS.Node,c.prototype.constructor=c,a.nodeTypes[b]=c,c},a.prototype.getNode=function(b,c,d){c.type=c.type||"node";var e;"node"===c.type?e=SceneJS.Node:(e=a.nodeTypes[c.type],e||(console.error("Unknown node type: "+c.type+" - can't create - making a SceneJS.Node by default"),e=SceneJS.Node));var f=new e,g=c.id||c.nodeId;return g?this.nodes.addItem(g,f):g=this.nodes.addItem(f),f._construct(b,d,c,g),f},a.prototype.putNode=function(a){this.nodes.removeItem(a.id)}}(),function(){"use strict";function a(a){var b="",c=0,d=a.colorModifiers.length;for(c=0;d>c;c++){var f=a.colorModifiers[c],g=f.applyTo,h=f.range,i=f.value;g===e.BRIGHTNESS?b+="b":g===e.CONTRAST?b+="c":g===e.SATURATION?b+="s":g===e.TINT&&(b+="t"),h&&(b+="r"),b+=i.isScalarFresnel?"sf":i.isColorFresnel?"cf":"nv"}return b}function b(a){var b="",c=0,d=a.opacityModifiers.length;for(c=0;d>c;c++){var e=a.opacityModifiers[c],f=e.range,g=e.value;b+=f?"r":"o",b+=g.isScalarFresnel?"sf":"nv"}return b}function c(c){return(c.getFlag(d.REFLECTIVE)?"refl":"")+";"+(c.getFlag(d.SKYBOX)?"sky":"")+";"+(c.getFlag(d.SOLID)?"s":"")+";"+(c.getFlag(d.ROUND_POINTS)?"rpt":"")+";"+(c.getFlag(d.PERSPECTIVE_POINTS)?"ppt":"")+";"+(c.getFlag(d.BILLBOARD)?"b":"")+";"+(c.getFlag(d.STOCHASTIC_ALPHA)?"sa":"")+";"+a(c)+";"+b(c)+";"+(c.fragmentShaderHeader||"")+";"+(c.fragmentShaderFooter||"")+";"}var d=SceneJS.PROPERTY_FLAGS,e=SceneJS.COLOR_MOD_FLAGS,f=SceneJS.DEPTH_TEST_FLAGS,g={saturation:e.SATURATION,brightness:e.BRIGHTNESS,contrast:e.CONTRAST,tintColor:e.TINT},h={enabled:f.ENABLED,disabled:f.DISABLED,alwaysPass:f.ALWAYS_PASS},i={};for(var j in h){var k=h[j];i[k]=j}var l=new SceneJS_PropertiesCore;l.stateId=SceneJS._baseStateId++;var m=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.properties=l,n=0}),SceneJS.Properties=SceneJS_NodeFactory.createNodeType("properties"),SceneJS.Properties.prototype._init=function(a){1==this._core.useCount&&a.properties&&this.setProperties(a.properties)},SceneJS.Properties.prototype.setProperties=function(a){var b=this._core;if(void 0!=a.picking&&(b.setFlag(d.PICKING,a.picking),this._engine.display.imageDirty=!0),void 0!=a.solidColor){var f=l.solidColor,i=a.solidColor;b.solidColor[0]=void 0!=i.r?i.r:f[0],b.solidColor[1]=void 0!=i.g?i.g:f[1],b.solidColor[2]=void 0!=i.b?i.b:f[2],this._engine.display.imageDirty=!0}if(void 0!=a.clipping&&(b.setFlag(d.CLIPPING,a.clipping),this._engine.branchDirty(this)),void 0!=a.enabled&&(b.setFlag(d.ENABLED,a.enabled),this._engine.display.objectListDirty=!0),void 0!=a.frontface&&(b.setFlag(d.CCW,"ccw"===a.frontface),this._engine.display.imageDirty=!0),void 0!=a.reflective&&(b.setFlag(d.REFLECTIVE,a.reflective),this._engine.branchDirty(this)),void 0!=a.solid&&(b.setFlag(d.SOLID,a.solid),this._engine.branchDirty(this)),void 0!=a.skybox&&(b.setFlag(d.SKYBOX,a.skybox),this._engine.branchDirty(this)),void 0!=a.billboard&&(b.setFlag(d.BILLBOARD,a.billboard),this._engine.branchDirty(this)),a.colorModifiers){var j,k;b.colorModifiers.length=a.colorModifiers.length,b.colorModRange=!1;for(var m=0,n=a.colorModifiers.length;n>m;m++){var o=a.colorModifiers[m];j=g[o.applyTo]||o.applyTo,k=o.value,k.isScalarFresnel||k.isColorFresnel||j!==e.CONTRAST||o.normalized||(k=o.value+1),b.colorModifiers[m]={applyTo:j,value:k,range:null},j===e.CONTRAST&&(b.colorModifiers[m].normalized=!0),o.range&&(b.colorModRange=!0,b.colorModifiers[m].range={center:new Float32Array(o.range.center),radius:new Float32Array([o.range.minRadius,o.range.maxRadius-o.range.minRadius])})}}if(void 0!=a.name&&(b.name=a.name),void 0!=a.xray){var p=b.transparent;b.setFlag(d.XRAY,a.xray),b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.glassFactor&&(b.xrayParams[0]=a.glassFactor,this._engine.display.imageDirty=!0),void 0!=a.murkiness&&(b.xrayParams[1]=a.murkiness,this._engine.display.imageDirty=!0),a.opacityModifiers){var k,q,p=b.transparent,r=a.opacityModifiers.length;b.opacityModifiers.length=r,b.opacityModRange=!1;for(var s=0;r>s;++s)q=a.opacityModifiers[s],k=q.value,b.opacityModifiers[s]={value:k,range:null},q.range&&(b.opacityModRange=!0,b.opacityModifiers[s].range={center:new Float32Array(q.range.center),radius:new Float32Array([q.range.minRadius,q.range.maxRadius-q.range.minRadius])});b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.noDepthMask&&(b.setFlag(d.NO_DEPTH_MASK,a.noDepthMask),this._engine.display.imageDirty=!0),void 0!=a.partiallyOpaque){var t=b.partiallyOpaque;b.setFlag(d.PARTIALLY_OPAQUE,a.partiallyOpaque),b.resetTransparency(),b.partiallyOpaque!==t&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0}if(void 0!=a.forceTransparent){var p=b.transparent;b.setFlag(d.FORCE_TRANSPARENT,a.forceTransparent),b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.stochasticAlpha){var p=b.transparent;b.setFlag(d.STOCHASTIC_ALPHA,a.stochasticAlpha),b.resetTransparency(),this._engine.branchDirty(this),this._engine.display.imageDirty=!0}void 0!=a.roundPoints&&(b.setFlag(d.ROUND_POINTS,a.roundPoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.perspectivePoints&&(b.setFlag(d.PERSPECTIVE_POINTS,a.perspectivePoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.fragmentShaderHeader&&(b.fragmentShaderHeader=a.fragmentShaderHeader,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.fragmentShaderFooter&&(b.fragmentShaderFooter=a.fragmentShaderFooter,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.depthTest&&(b.depthTest=h[a.depthTest]||a.depthTest,this._engine.display.imageDirty=!0);var u=b.hash;return b.hash=c(b),b.hash!==u&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this},SceneJS.Properties.prototype.getProperties=function(){var a=this._core;return{picking:a.getFlag(d.PICKING),clipping:a.getFlag(d.CLIPPING),enabled:a.getFlag(d.ENABLED),frontface:a.getFlag(d.CCW)?"ccw":"cw",reflective:a.getFlag(d.REFLECTIVE),solid:a.getFlag(d.SOLID),solidColor:a.solidColor,skybox:a.getFlag(d.SKYBOX),billboard:a.getFlag(d.BILLBOARD),fullyTransparent:a.getFlag(d.FULLY_TRANSPARENT),roundPoints:a.getFlag(d.ROUND_POINTS),perspectivePoints:a.getFlag(d.PERSPECTIVE_POINTS),xray:a.getFlag(d.XRAY),glassFactor:a.xrayParams[0],murkiness:a.xrayParams[1],colorModifiers:a.colorModifiers,opacityModifier:a.opacityModifiers,pointPerspectiveDistance:a.pointPerspectiveDistance,fragmentShaderHeader:a.fragmentShaderHeader,fragmentShaderFooter:a.fragmentShaderFooter,depthTest:i[a.depthTest]||"enabled"}},SceneJS.Properties.prototype.setPicking=function(a){return a=!!a,this._core.getFlag(d.PICKING)!==a&&(this._core.setFlag(d.PICKING,a),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getPicking=function(){return this._core.getFlag(d.PICKING)},SceneJS.Properties.prototype.setClipping=function(a){return this.setProperties({clipping:a}),this},SceneJS.Properties.prototype.getClipping=function(){return!!this.solidColor[3]},SceneJS.Properties.prototype.setEnabled=function(a){return this.setProperties({enabled:a})},SceneJS.Properties.prototype.getEnabled=function(){return this._core.getFlag(d.ENABLED)},SceneJS.Properties.prototype.setFrontface=function(a){var b="ccw"===a;return this._core.getFlag(d.CCW)!==b&&(this._core.setFlag(d.CCW,b),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFrontface=function(){return this._core.getFlag(d.CCW)?"ccw":"cw"},SceneJS.Properties.prototype.setReflective=function(a){return a=!!a,this._core.getFlag(d.REFLECTIVE)!=a&&(this._core.setFlag(d.REFLECTIVE,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getReflective=function(){return this._core.getFlag(d.REFLECTIVE)},SceneJS.Properties.prototype.setSolid=function(a){return a=!!a,this._core.getFlag(d.SOLID)!=a&&(this._core.setFlag(d.SOLID,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSolid=function(){return this._core.getFlag(d.SOLID)},SceneJS.Properties.prototype.setSolidColor=function(a){return this.setProperties({solidColor:a}),this},SceneJS.Properties.prototype.getSolidColor=function(){return{r:this._core.solidColor[0],g:this._core.solidColor[1],b:this._core.solidColor[2]}},SceneJS.Properties.prototype.setSkybox=function(a){return a=!!a,this._core.getFlag(d.SKYBOX)!=a&&(this._core.setFlag(d.SKYBOX,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSkybox=function(){return this._core.getFlag(d.SKYBOX)},SceneJS.Properties.prototype.setName=function(a){this._core.name=a},SceneJS.Properties.prototype.getName=function(){return this._core.name},SceneJS.Properties.prototype.setFullyTransparent=function(a){return a=!!a,this._core.getFlag(d.FULLY_TRANSPARENT)!==a&&(this._core.setFlag(d.FULLY_TRANSPARENT,a),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFullyTransparent=function(){return this._core.getFlag(d.FULLY_TRANSPARENT)},SceneJS.Properties.prototype.setRoundPoints=function(a){return a=!!a,this._core.getFlag(d.ROUND_POINTS)!=a&&(this._core.setFlag(d.ROUND_POINTS,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getRoundPoints=function(){return this._core.getFlag(d.ROUND_POINTS)},SceneJS.Properties.prototype._compile=function(a){this._engine.display.properties=m[n++]=this._core,this._compileNodes(a),this._engine.display.properties=--n>0?m[n-1]:l,m[n]=null}}(),function(){"use strict";function a(a){return function(){a._core.tangentBufs=null,a._core.pickPositionsBuf=null,a._core.arrays.tangents&&(a._core.arrays.tangents=[]),a._buildNodeCore(a._engine.canvas.gl,a._core)}}function b(a,b){{var c=a.STATIC_DRAW,d=b.arrays;b.compressedPositions||b.compressedNormals||b.compressedUVs}if(b.transparent=!!d.colors,d.positions&&(b.vertexBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.positions,d.positions.length,3,c)),b.compressedNormals?b.normalBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.normals,d.normals.length,2,c,!0):d.normals&&(b.normalBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.normals,d.normals.length,3,c)),d.uvs){var e,f,g,h=d.uvs;for(b.uvBufs=[],e=0,f=h.length;f>e;e++)g=d.uvs[e],g.length>0&&b.uvBufs.push(new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,g,g.length,2,c))}d.colors&&(b.colorBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.colors,d.colors.length,4,c,!0)),d.indices&&(b.indexBuf=new SceneJS._webgl.ArrayBuffer(a,a.ELEMENT_ARRAY_BUFFER,d.indices,d.indices.length,1,c)),d.pointScaleRotations&&(b.pointScaleRotationBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.pointScaleRotations,d.pointScaleRotations.length,2,c,!0)),d.pointUVTranslates&&(b.pointUVTranslateBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.pointUVTranslates,d.pointUVTranslates.length,2,c,!0))}SceneJS.Geometry=SceneJS_NodeFactory.createNodeType("geometry"),SceneJS.Geometry.prototype._init=function(b){1==this._core.useCount&&(this._initNodeCore(b,{origin:b.origin,scale:b.scale,autoNormals:"auto"==b.normals}),this._buildNodeCore(this._engine.canvas.gl,this._core),this._boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this._boundaryDirty=!0,this.backfaces=b.backfaces!==!1,this.addBlend=b.addBlend===!0,this.layer=b.layer||0,this.onObjectCreate=b.onObjectCreate||null,this._core.webglRestored=a(this),this._engine.stats.geometry.meshes++)},SceneJS.Geometry.prototype._initNodeCore=function(a,b){b=b||{};var c=a.primitive||"triangles",d=this._core,e=SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint?Uint32Array:Uint16Array;d._engine=this._engine,d.primitive=this._getPrimitiveType(c),d.primitiveName=c,d.pointSize=a.pointSize||1,d.pointUVScale=a.pointUVScale||new Float32Array([1,1]),d.compressedPositions=!1,d.compressedNormals=!1,d.compressedUVs=!1,a.normals&&"triangles"==c&&("auto"===a.normals||a.normals===!0)&&a.positions&&a.indices&&this._buildNormals(a),d.arrays={},a.positions&&(a.positionDecodeMat?(d.arrays.positions=a.positions,d.positionDecodeMat=a.positionDecodeMat,d.compressedPositions=!0):(a.positions.constructor!=Float32Array&&(a.positions=new Float32Array(a.positions)),(b.scale||b.origin)&&this._applyOptions(a.positions,b),d.arrays.positions=a.positions),this._engine.stats.geometry.vertices+=a.positions.length/3,this._engine.stats.memory.positions+=a.positions.length*a.positions.constructor.BYTES_PER_ELEMENT),a.normals&&(a.normals.constructor==Int8Array?(d.arrays.normals=a.normals,d.compressedNormals=!0):(a.normals.constructor!=Float32Array&&(a.normals=new Float32Array(a.normals)),d.arrays.normals=a.normals),this._engine.stats.memory.normals+=a.normals.length*a.normals.constructor.BYTES_PER_ELEMENT);var f,g;if(a.uvDecodeMats){f=a.uvs;for(var h=0,i=f.length;i>h;h++)g=f[h],g.constructor!=Uint16Array&&(f[h]=new Uint16Array(f[h])),this._engine.stats.memory.uvs+=g.length*g.constructor.BYTES_PER_ELEMENT;d.arrays.uvs=f,d.uvDecodeMats=a.uvDecodeMats,d.compressedUVs=!0}else if(a.uvs){f=a.uvs;for(var h=0,i=f.length;i>h;h++)g=f[h],g.constructor!=Float32Array&&(f[h]=new Float32Array(f[h])),this._engine.stats.memory.uvs+=g.length*g.constructor.BYTES_PER_ELEMENT;d.arrays.uvs=f}a.uv&&(a.uv.constructor!=Float32Array&&(a.uv=new Float32Array(a.uv)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[0]=a.uv,this._engine.stats.memory.uvs+=a.uv.length*a.uv.constructor.BYTES_PER_ELEMENT),a.uv1&&(a.uv1.constructor!=Float32Array&&(a.uv1=new Float32Array(a.uv1)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[1]=a.uv1,this._engine.stats.memory.uvs+=a.uv1.length*a.uv1.constructor.BYTES_PER_ELEMENT),a.uv2&&(a.uv2.constructor!=Float32Array&&(a.uv2=new Float32Array(a.uv2)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[2]=a.uv2,this._engine.stats.memory.uvs+=a.uv2.length*a.uv2.constructor.BYTES_PER_ELEMENT),a.uv3&&(a.uv3.constructor!=Float32Array&&(a.uv3=new Float32Array(a.uv3)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[3]=a.uv3,this._engine.stats.memory.uvs+=a.uv3.length*a.uv3.constructor.BYTES_PER_ELEMENT),d.arrays.normals&&d.arrays.uvs&&(d.arrays.tangents=[]),a.colors&&(a.colors.constructor!=Uint8Array&&(a.colors=new Uint8Array(a.colors)),d.arrays.colors=a.colors,this._engine.stats.memory.colors+=a.colors.length*a.colors.constructor.BYTES_PER_ELEMENT),a.indices&&(a.indices.constructor!=Uint8Array&&a.indices.constructor!=Uint16Array&&a.indices.constructor!=Uint32Array&&(a.indices=new e(a.indices)),d.arrays.indices=a.indices,this._engine.stats.geometry.triangles+=a.indices.length/3,this._engine.stats.memory.indices+=a.indices.length*a.indices.constructor.BYTES_PER_ELEMENT),a.pointScaleRotations&&(a.pointScaleRotations.constructor!=Float32Array&&(a.pointScaleRotations=new Float32Array(a.pointScaleRotations)),d.arrays.pointScaleRotations=a.pointScaleRotations,this._engine.stats.memory.pointScaleRotations+=a.pointScaleRotations.length*a.pointScaleRotations.constructor.BYTES_PER_ELEMENT),a.pointUVTranslates&&(a.pointUVTranslates.constructor!=Float32Array&&(a.pointUVTranslates=new Float32Array(a.pointUVTranslates)),d.arrays.pointUVTranslates=a.pointUVTranslates,this._engine.stats.memory.pointUVTranslates+=a.pointUVTranslates.length*a.pointUVTranslates.constructor.BYTES_PER_ELEMENT)},SceneJS.Geometry.prototype._getPrimitiveType=function(a){var b=this._engine.canvas.gl;switch(a){case"points":return b.POINTS;case"lines":return b.LINES;case"line-loop":return b.LINE_LOOP;case"line-strip":return b.LINE_STRIP;case"triangles":return b.TRIANGLES;case"triangle-strip":return b.TRIANGLE_STRIP;case"triangle-fan":return b.TRIANGLE_FAN;default:throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"geometry primitive unsupported: '"+a+"' - supported types are: 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}},SceneJS.Geometry.prototype._applyOptions=function(a,b){if(b.scale)for(var c=void 0!=b.scale.x?b.scale.x:1,d=void 0!=b.scale.y?b.scale.y:1,e=void 0!=b.scale.z?b.scale.z:1,f=0,g=a.length;g>f;f+=3)a[f]*=c,a[f+1]*=d,a[f+2]*=e;if(b.origin)for(var h=void 0!=b.origin.x?b.origin.x:0,i=void 0!=b.origin.y?b.origin.y:0,j=void 0!=b.origin.z?b.origin.z:0,f=0,g=a.length;g>f;f+=3)a[f]-=h,a[f+1]-=i,a[f+2]-=j;return a};var c=function(a){if(a.vertexBuf&&(a.vertexBuf.destroy(),a.vertexBuf=null),a.normalBuf&&(a.normalBuf.destroy(),a.normalBuf=null),a.uvBufs){for(var b,c=a.uvBufs,d=0,e=c.length;e>d;d++)b=c[d],b&&b.destroy();a.uvBufs=null}if(a.colorBuf&&(a.colorBuf.destroy(),a.colorBuf=null),a.pointScaleRotationBuf&&(a.pointScaleRotationBuf.destroy(),a.pointScaleRotationBuf=null),a.pointUVTranslateBuf&&(a.pointUVTranslateBuf.destroy(),a.pointUVTranslateBuf=null),a.tangentBufs){for(var f,g=a.tangentBufs,h=0,i=g.length;i>h;h++)f=g[h],f&&f.destroy();a.tangentBufs=null}a.indexBuf&&(a.indexBuf.destroy(),a.indexBuf=null)};SceneJS.Geometry.prototype._buildNodeCore=function(a,d){try{b(a,d)}catch(e){throw c(d),SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate geometry: "+e)}},SceneJS.Geometry.prototype._updateArray=function(a,b,c){var d=a.length,e=b.length;e+c>d&&(e-=e+c-d);for(var f=c,g=0;e>g;f++,g++)a[f]=b[g]},SceneJS.Geometry.prototype._buildNormals=function(a){for(var b,c,d,e,f,g,h=a.positions,i=a.indices,j=new Array(h.length/3),k=0,l=i.length-3;l>k;k+=3){b=i[k+0],c=i[k+1],d=i[k+2],e=[h[3*b+0],h[3*b+1],h[3*b+2]],f=[h[3*c+0],h[3*c+1],h[3*c+2]],g=[h[3*d+0],h[3*d+1],h[3*d+2]],f=vec4.subtract(vec4.create(),f,e),g=vec4.subtract(vec4.create(),g,e);var m=vec4.normalize(vec4.create(),SceneJS_math_cross3Vec4(f,g,[0,0,0,0]));j[b]||(j[b]=[]),j[c]||(j[c]=[]),j[d]||(j[d]=[]),j[b].push(m),j[c].push(m),j[d].push(m)}for(var n=new Float32Array(h.length),k=0,l=j.length;l>k;k++){var o=j[k];if(o){for(var p=o.length,q=0,r=0,s=0,t=0;p>t;t++)q+=o[t][0],r+=o[t][1],s+=o[t][2];n[3*k+0]=q/p,n[3*k+1]=r/p,n[3*k+2]=s/p}}a.normals=n,this._engine.stats.memory.normals+=n.length/3},SceneJS.Geometry.prototype.setSource=function(a){this._sourceConfigs=a;var b=this._source;b&&b.configure&&b.configure(a)},SceneJS.Geometry.prototype.getSource=function(){return this._sourceConfigs||{}},SceneJS.Geometry.prototype.getBackfaces=function(){return this.backfaces},SceneJS.Geometry.prototype.setBackfaces=function(a){this.backfaces=a;var b=this.getObject();b&&(b.backfaces=a),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getAddBlend=function(){return this.addBlend},SceneJS.Geometry.prototype.setAddBlend=function(a){this.addBlend=a;var b=this.getObject();b&&(b.addBlend=a),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getLayer=function(){return this.layer},SceneJS.Geometry.prototype.setLayer=function(a){this.layer=a;var b=this.getObject();b&&(b.layer=a),this._engine.display.objectListDirty=!0},SceneJS.Geometry.prototype.setPositions=function(a){if(a&&this._core.vertexBuf){this._boundaryDirty=!0;var b=this._core;b.vertexBuf.bind(),b.vertexBuf.setData(a),b.arrays.positions.set(a),b.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPositions=function(){return this._core.arrays?this._core.arrays.positions:null},SceneJS.Geometry.prototype.getPositionDecodeMat=function(){return this._core.positionDecodeMat||null},SceneJS.Geometry.prototype.setNormals=function(a){if(a&&this._core.normalBuf){var b=this._core;b.normalBuf.bind(),b.normalBuf.setData(a),b.arrays.normals.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getNormals=function(){return this._core.arrays?this._core.arrays.normals:null},SceneJS.Geometry.prototype.setColors=function(a){if(a&&this._core.colorBuf){var b=this._core;b.colorBuf.bind(),b.colorBuf.setData(a),b.arrays.colors.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getColors=function(){return this._core.arrays?this._core.arrays.colors:null},SceneJS.Geometry.prototype.setIndices=function(a){if(a&&this._core.indexBuf){this._boundaryDirty=!0;var b=this._core;b.indexBuf.bind(),a.constructor!=b.arrays.indices.constructor&&(a=new b.arrays.indices.constructor(a)),b.indexBuf.setData(a),b.arrays.indices.set(a),b.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getIndices=function(){return this._core.arrays?this._core.arrays.indices:null},SceneJS.Geometry.prototype.getUVs=function(){return this._core.arrays?this._core.arrays.uvs:null},SceneJS.Geometry.prototype.getUV=function(){return this._core.arrays?this._core.arrays.uvs[0]:null},SceneJS.Geometry.prototype.getUVDecodeMat=function(a){return this._core.uvDecodeMats[a||0]||null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[1]:null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[2]:null},SceneJS.Geometry.prototype.getUv3=function(){return this._core.arrays?this._core.arrays.uvs[3]:null},SceneJS.Geometry.prototype.setUV=function(a,b){if(b&&this._core.uvBufs&&this._core.uvBufs[a]){var c=this._core;c.uvBufs[a].bind(),c.uvBufs[a].setData(b),c.arrays.uvs[a].set(b),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.hasCompressedPositions=function(){return!!this._core.compressedPositions},SceneJS.Geometry.prototype.hasCompressedNormals=function(){return!!this._core.compressedNormals},SceneJS.Geometry.prototype.hasCompressedUVs=function(){return!!this._core.compressedUVs},SceneJS.Geometry.prototype.getPrimitive=function(){return this.primitive},SceneJS.Geometry.prototype.getPointSize=function(){return this._core.pointSize},SceneJS.Geometry.prototype.setPointSize=function(a){a&&this._core.pointSize!==a&&(this._core.pointSize=a,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.getPointUVScale=function(){return this._core.pointUVScale},SceneJS.Geometry.prototype.setPointUVScale=function(a){a&&this._core.pointUVScale!==a&&(this._core.pointUVScale=a,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.setPointScaleRotations=function(a){if(a&&this._core.pointScaleRotationBuf){var b=this._core;b.pointScaleRotationBuf.bind(),b.pointScaleRotationBuf.setData(a),b.arrays.pointScaleRotations.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointScaleRotations=function(){return this._core.arrays?this._core.arrays.pointScaleRotations:null},SceneJS.Geometry.prototype.setPointUVTranslates=function(a){if(a&&this._core.pointUVTranslateBuf){var b=this._core;b.pointUVTranslateBuf.bind(),b.pointUVTranslateBuf.setData(a),b.arrays.pointUVTranslates.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointUVTranslates=function(){return this._core.arrays?this._core.arrays.pointUVTranslates:null},SceneJS.Geometry.prototype.getKdTree=function(){var a=this.getObject();return a?a.getKdTree():this._core.getKdTree()},SceneJS.Geometry.prototype.getObject=function(){return this._engine.display._objects[this.id]||null},SceneJS.Geometry.prototype.getBoundary=function(){if(!this._boundaryDirty)return this._boundary;var a=this._core.arrays;if(!a)return null;var b=a.positions;if(!b)return null;this._boundary.xmin=Number.POSITIVE_INFINITY,this._boundary.ymin=Number.POSITIVE_INFINITY,this._boundary.zmin=Number.POSITIVE_INFINITY,this._boundary.xmax=Number.NEGATIVE_INFINITY,this._boundary.ymax=Number.NEGATIVE_INFINITY,this._boundary.zmax=Number.NEGATIVE_INFINITY;for(var c,d,e,f=0,g=b.length-2;g>f;f+=3)c=b[f],d=b[f+1],e=b[f+2],c<this._boundary.xmin&&(this._boundary.xmin=c),d<this._boundary.ymin&&(this._boundary.ymin=d),e<this._boundary.zmin&&(this._boundary.zmin=e),c>this._boundary.xmax&&(this._boundary.xmax=c),d>this._boundary.ymax&&(this._boundary.ymax=d),e>this._boundary.zmax&&(this._boundary.zmax=e);return this._boundaryDirty=!1,this._boundary},SceneJS.Geometry.prototype._compile=function(a){if(this._core._loading)return void this._compileNodes(a);var b=this._core,c=[b.normalBuf?"t":"f",b.arrays&&b.arrays.tangents?"t":"f",b.colorBuf?"t":"f",b.primitive,b.compressedPositions?"t":"f",b.compressedNormals?"t":"f",b.compressedUVs?"t":"f",b.pointScaleRotationBuf?"t":"f",b.pointUVTranslateBuf?"t":"f"];c.push(";uvs");var d=b.uvBufs;if(d)for(var e=0,f=d.length;f>e;e++)c.push(d[e]?"t":"f");b.hash=c.join(""),b.stateId=this._core.stateId,b.type="geometry",this._engine.display.geometry=b,SceneJS_events.fireEvent(SceneJS_events.OBJECT_COMPILING,{display:this._engine.display}),this._engine.display.buildObject(this.id,{backfaces:this.backfaces,addBlend:this.addBlend,layer:this.layer}),this.onObjectCreate&&this.onObjectCreate(this.getObject()),this._compileNodes(a)},SceneJS.Geometry.prototype._destroy=function(){this._engine.display.removeObject(this.id),1==this._core.useCount&&(this._destroyNodeCore(),this._source&&this._source.destroy&&this._source.destroy(),this._engine.stats.geometry.meshes--)},SceneJS.Geometry.prototype._disconnectFromScene=function(){this._engine.display.removeObject(this.id)},SceneJS.Geometry.prototype._destroyNodeCore=function(){document.getElementById(this._engine.canvas.canvasId)&&c(this._core);var a=this._core.arrays;a.positions&&(this._engine.stats.memory.positions-=a.positions.length/3),a.normals&&(this._engine.stats.memory.normals-=a.normals.length/3),a.colors&&(this._engine.stats.memory.colors-=a.colors.length/3),a.uvs&&a.uvs.length>0&&(this._engine.stats.memory.uvs-=a.uvs.length*(a.uvs[0].length/2)),a.indices&&(this._engine.stats.memory.indices-=a.indices.length),a.pointScaleRotations&&(this._engine.stats.memory.pointScaleRotations-=a.pointScaleRotations.length/2),a.pointUVTranslates&&(this._engine.stats.memory.pointUVTranslates-=a.pointUVTranslates.length/2)}}(),function(){"use strict";SceneJS.Library=SceneJS_NodeFactory.createNodeType("library"),SceneJS.Library.prototype._compile=function(){}}(),function(){"use strict";SceneJS.Material=SceneJS_NodeFactory.createNodeType("material"),SceneJS.Material.PHONG=0,SceneJS.Material.METALLIC=1;var a={type:"material",stateId:SceneJS._baseStateId++,workflow:SceneJS.Material.PHONG,baseColor:new Float32Array([1,1,1,1]),specularColor:new Float32Array([1,1,1,1]),emitColor:new Float32Array([1,1,1,0]),shine:70,metalRoughspecularf0:new Float32Array([1,1,.1,0])},b=[],c=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){b.engine.display.material=a,c=0}),SceneJS.Material.prototype._init=function(b){1==this._core.useCount&&(this._core.baseColor=new Float32Array(a.baseColor),this._core.specularColor=new Float32Array(a.specularColor),this._core.emitColor=new Float32Array(a.emitColor),this._core.shine=a.shine,this._core.metalRoughspecularf0=new Float32Array(a.metalRoughspecularf0),(b.color||b.baseColor)&&this.setBaseColor(b.color||b.baseColor),b.specularColor&&this.setSpecularColor(b.specularColor),b.emitColor&&this.setEmitColor(b.emitColor),void 0!=b.specular&&this.setSpecular(b.specular),void 0!=b.shine&&this.setShine(b.shine),void 0!=b.emit&&this.setEmit(b.emit),void 0!=b.alpha&&this.setAlpha(b.alpha),void 0!=b.metallic&&this.setMetallic(b.metallic),void 0!=b.roughness&&this.setRoughness(b.roughness),void 0!=b.specularf0&&this.setspecularf0(b.specularf0),this.setWorkflow(b.workflow))},SceneJS.Material.prototype.setWorkflow=function(a){return a=a||"phong","phong"===a?this._core.workflow=SceneJS.Material.PHONG:"metallic"===a?this._core.workflow=SceneJS.Material.METALLIC:(console.error("Unsupported SceneJS material workflow: "+a),this._core.workflow=SceneJS.Material.PHONG),this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getWorkflow=function(){switch(this._core.workflow){case SceneJS.Material.PHONG:return"phong";case SceneJS.Material.METALLIC:return"metallic"}},SceneJS.Material.prototype.setBaseColor=function(b){var c=a.baseColor;return this._core.baseColor[0]=void 0!=b.r?b.r:c[0],this._core.baseColor[1]=void 0!=b.g?b.g:c[1],this._core.baseColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.setColor=SceneJS.Material.prototype.setBaseColor,SceneJS.Material.prototype.getBaseColor=function(){return{r:this._core.baseColor[0],g:this._core.baseColor[1],b:this._core.baseColor[2]}},SceneJS.Material.prototype.getColor=SceneJS.Material.prototype.getBaseColor,SceneJS.Material.prototype.setSpecularColor=function(b){var c=a.specularColor;return this._core.specularColor[0]=void 0!=b.r?b.r:c[0],this._core.specularColor[1]=void 0!=b.g?b.g:c[1],this._core.specularColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecularColor=function(){return{r:this._core.specularColor[0],g:this._core.specularColor[1],b:this._core.specularColor[2]}},SceneJS.Material.prototype.setEmitColor=function(b){var c=a.emitColor;return this._core.emitColor[0]=void 0!=b.r?b.r:c[0],this._core.emitColor[1]=void 0!=b.g?b.g:c[1],this._core.emitColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmitColor=function(){return{r:this._core.emitColor[0],g:this._core.emitColor[1],b:this._core.emitColor[2]}},SceneJS.Material.prototype.setSpecular=function(b){return this._core.specularColor[3]=void 0!=b&&null!=b?b:a.specularColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecular=function(){return this._core.specularColor[3]},SceneJS.Material.prototype.setShine=function(b){return this._core.shine=void 0!=b?b:a.shine,this._engine.display.imageDirty=!0,
this},SceneJS.Material.prototype.getShine=function(){return this._core.shine},SceneJS.Material.prototype.setEmit=function(b){return this._core.emitColor[3]=void 0!=b?b:a.emitColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmit=function(){return this._core.emitColor[3]},SceneJS.Material.prototype.setAlpha=function(b){var c=this._core.baseColor[3]<1;return this._core.baseColor[3]=void 0!=b?b:a.baseColor[3],this._core.transparent=this._core.baseColor[3]<1,this._engine.display.imageDirty=!0,c!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this},SceneJS.Material.prototype.getAlpha=function(){return this._core.baseColor[3]},SceneJS.Material.prototype.setMetallic=function(b){return this._core.metalRoughspecularf0[0]=void 0!=b?b:a.metalRoughspecularf0[0],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getMetallic=function(){return this._core.metalRoughspecularf0[0]},SceneJS.Material.prototype.setRoughness=function(b){return this._core.metalRoughspecularf0[1]=void 0!=b?b:a.metalRoughspecularf0[1],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getRoughness=function(){return this._core.metalRoughspecularf0[1]},SceneJS.Material.prototype.setspecularf0=function(b){return this._core.metalRoughspecularf0[2]=void 0!=b?b:a.metalRoughspecularf0[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getspecularf0=function(){return this._core.metalRoughspecularf0[2]},SceneJS.Material.prototype._compile=function(d){this._engine.display.material=b[c++]=this._core,this._compileNodes(d),this._engine.display.material=--c>0?b[c-1]:a,b[c]=null}}(),function(){"use strict";function a(a,c){var d=c.targets||[];if(d.length<2)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var e=c.keys||[];if(e.length!=d.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");var f=a._core,g=a._engine.canvas.gl,h=g.STATIC_DRAW;f.keys=e,f.targets=[],f.key1=0,f.key2=1;for(var i,j,k,l,m,n=0,o=d.length;o>n;n++)m=d[n],!i&&m.positions&&(i=m.positions),!j&&m.normals&&(j=m.normals),!k&&m.uv&&(k=m.uv),!l&&m.uv2&&(l=m.uv2);for(var p,q,n=0,o=d.length;o>n;n++)m=d[n],p={},q=m.positions||i,q&&(m.positionDecodeMat?(p.positions=q,p.positionDecodeMat=m.positionDecodeMat,f.compressedPositions=!0):p.positions=q.constructor==Float32Array?q:new Float32Array(q),p.vertexBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.positions,q.length,3,h),i=q,a._engine.stats.memory.morphPositions+=p.positions.length*p.positions.constructor.BYTES_PER_ELEMENT),q=m.normals||j,q&&(q.constructor==Int8Array?(p.normals=q,f.compressedNormals=!0,p.normalBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.normals,q.length,2,h,!0)):(p.normals=q.constructor==Float32Array?q:new Float32Array(q),p.normalBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.normals,q.length,3,h)),j=q,a._engine.stats.memory.morphNormals+=p.normals.length*p.normals.constructor.BYTES_PER_ELEMENT),q=m.uv||k,q&&(p.uv=q.constructor==Float32Array?q:new Float32Array(q),p.uvBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.uv,q.length,2,h),k=q),q=m.uv2||l,q&&(p.uv2=q.constructor==Float32Array?q:new Float32Array(q),p.uvBuf2=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.uv2,q.length,2,h),l=q),f.targets.push(p);f.kdTree=null,f.kdTreeDirty=!0,f.getKdTree=function(a){if(!this.kdTreeDirty)return this.kdTree;for(var c=a.length/3,d=new Array(c),e=0;c>e;++e)d[e]=e;return this.kdTree=b(d,a,this.targets,0,0),this.kdTreeDirty=!1,this.kdTree},a._pickPositionsDirty=!0}function b(a,e,f,g,i){var j=vec3.create(),k=vec3.create(),l={triangles:null,left:null,right:null,bb:{min:j,max:k}};j[0]=j[1]=j[2]=Number.POSITIVE_INFINITY,k[0]=k[1]=k[2]=Number.NEGATIVE_INFINITY;var m,n,o=f.length;for(m=0,n=a.length;n>m;++m)for(var p=3*a[m],q=0;3>q;++q)for(var r=3*e[p+q],s=0;o>s;++s){var t=f[s].positions,u=f[s].positionDecodeMat;h[0]=t[r],h[1]=t[r+1],h[2]=t[r+2],u&&SceneJS_math_decompressPosition(h,h,u),h[0]<j[0]&&(j[0]=h[0]),h[0]>k[0]&&(k[0]=h[0]),h[1]<j[1]&&(j[1]=h[1]),h[1]>k[1]&&(k[1]=h[1]),h[2]<j[2]&&(j[2]=h[2]),h[2]>k[2]&&(k[2]=h[2])}if(i>c)return l.triangles=a,l;var v=(j[g]+k[g])/2,w=new Array(a.length),x=0,y=new Array(a.length),z=0;for(m=0,n=a.length;n>m;++m){for(var p=3*a[m],A=e[p],B=e[p+1],C=e[p+2],D=3*A,E=3*B,F=3*C,G=!0,s=0;o>s;++s){var t=f[s].positions,u=f[s].positionDecodeMat,H=t[D+g],I=t[E+g],J=t[F+g];if(u){var K=u[5*g],L=u[g+12];H=H*K+L,I=I*K+L,J=J*K+L}if(v>H||v>I||v>J){G=!1;break}}G?y[z++]=a[m]:w[x++]=a[m]}return d>x||d>z?(l.triangles=a,l):(w.length=x,y.length=z,l.left=b(w,e,f,(g+1)%3,i+1),l.right=b(y,e,f,(g+1)%3,i+1),l)}var c=SceneJS.KD_TREE_MAX_DEPTH,d=SceneJS.KD_TREE_MIN_TRIANGLES,e={type:"morphGeometry",stateId:SceneJS._baseStateId++,hash:"",morph:null},f=[],g=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.morphGeometry=e,g=0}),SceneJS.MorphGeometry=SceneJS_NodeFactory.createNodeType("morphGeometry"),SceneJS.MorphGeometry.prototype._init=function(a){if(1==this._core.useCount){this._pickPositionsDirty=!0,this._buildNodeCore(a),this._core.webglRestored=function(){};var b=this;this._core.getPickPositions=function(a,c){return b._pickPositionsDirty&&b._buildPickPositions(c),b._core.targets[a].pickPositionsBuf},this._core.getTangents=function(a,c,d,e,f){var g=b._core,h=g.targets[a];if(h.tangentBuf)return h.tangentBuf;var i=h.positions,e=h.positionDecodeMat||e;if(d=h.uv||d,i&&c&&d){var j=b._engine.canvas.gl,k=SceneJS_math_buildTangents(i,c,d,e,f);h.tangents=k;var l=j.STATIC_DRAW;return h.tangentBuf=new SceneJS._webgl.ArrayBuffer(j,j.ARRAY_BUFFER,k,k.length,3,l),h.tangentBuf}},this.setFactor(a.factor)}this._core.factor=a.factor||0,this._core.clamp=!!a.clamp},SceneJS.MorphGeometry.prototype._buildNodeCore=function(b){try{a(this,b)}catch(c){for(var d=0,e=this._core.targets.length;e>d;d++)target=core.targets[d],target.vertexBuf&&target.vertexBuf.destroy(),target.normalBuf&&target.normalBuf.destroy(),target.uvBuf&&target.uvBuf.destroy(),target.uvBuf2&&target.uvBuf2.destroy();throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate VBO(s) for morphGeometry: "+c)}},SceneJS.MorphGeometry.prototype._buildPickPositions=function(a){for(var b,c=this._core,d=null,e=this._engine.canvas.gl,f=e.STATIC_DRAW,g=0,h=c.targets.length;h>g;g++)d=c.targets[g],d.positions&&(d.pickPositionsBuf&&(d.pickPositionsBuf.destroy(),d.pickPositionsBuf=null),b=SceneJS_math_getPickPositions(d.positions,a),d.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,b,b.length,3,f));this._pickPositionsDirty=!1},SceneJS.MorphGeometry.prototype.setFactor=function(a){a=a||0;var b=this._core,c=b.keys,d=b.key1,e=b.key2,f=b.factor;if(a<c[0])d=0,e=1;else if(a>c[c.length-1])d=c.length-2,e=d+1;else{for(;c[d]>a;)d--,e--;for(;c[e]<a;)d++,e++}var g=d!=b.key1;b.factor=(a-c[d])/(c[e]-c[d]),this._factor=a;var h=g||f!=b.factor;if(b.key1=d,b.key2=e,h){var i=this.getCurrentFrame();this.onUpdate&&this.onUpdate(i),g&&this.onFrameUpdate&&this.onFrameUpdate(i)}this._engine.display.imageDirty=!0},SceneJS.MorphGeometry.prototype.getFactor=function(){return this._factor},SceneJS.MorphGeometry.prototype.getKeys=function(){return this._core.keys},SceneJS.MorphGeometry.prototype.getTargets=function(){return this._core.targets},SceneJS.MorphGeometry.prototype.getCurrentFrame=function(){var a=this._core,b=a.key1,c=a.key2;return{key1:b,key2:c,factor:a.factor,target1:a.targets[b],target2:a.targets[c]}},SceneJS.MorphGeometry.prototype._compile=function(a){this._core.hash||this._makeHash(),this._engine.display.morphGeometry=f[g++]=this._core,this._compileNodes(a),this._engine.display.morphGeometry=--g>0?f[g-1]:e,f[g]=null},SceneJS.MorphGeometry.prototype._makeHash=function(){var a=this._core;if(a.targets.length>0){var b=a.targets[0],c="t",d="f";a.hash=[b.vertexBuf?c:d,b.normalBuf?c:d,b.uvBuf?c:d,b.uvBuf2?c:d].join("")}else a.hash=""},SceneJS.MorphGeometry.prototype._destroy=function(){if(1==this._core.useCount&&document.getElementById(this._engine.canvas.canvasId))for(var a,b=this._core,c=0,d=b.targets.length;d>c;c++)a=b.targets[c],a.vertexBuf&&a.vertexBuf.destroy(),a.pickPositionsBuf&&a.pickPositionsBuf.destroy(),a.normalBuf&&a.normalBuf.destroy(),a.uvBuf&&a.uvBuf.destroy(),a.uvBuf2&&a.uvBuf2.destroy()};var h=(vec3.create(),vec3.create(),vec3.create())}(),function(){"use strict";SceneJS.Scene=SceneJS_NodeFactory.createNodeType("scene"),SceneJS.Scene.prototype._init=function(a){this.transparent=a.transparent===!0,this.stats=this._engine.stats,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},SceneJS.Scene.prototype.loseWebGLContext=function(){this._engine.loseWebGLContext()},SceneJS.Scene.prototype.getCanvas=function(){return this._engine.canvas.canvas},SceneJS.Scene.prototype.setTransparencyMode=function(a){this._engine.display.setTransparencyMode(a),this._engine.branchDirty(this)},SceneJS.Scene.prototype.setDepthSort=function(a){this._engine.display.depthSort=a,this._engine.display.objectListDirty=!0},SceneJS.Scene.prototype.getGL=function(){return this._engine.canvas.gl},SceneJS.Scene.prototype.getGPUTimer=function(){return this._engine.gpuTimer},SceneJS.Scene.prototype.getGPUTimerQuery=function(){return this._engine.gpuTimerQuery},SceneJS.Scene.prototype.getWebGL2Supported=function(){return this._engine.canvas.webgl2},SceneJS.Scene.prototype.getZBufferDepth=function(){var a=this._engine.canvas.gl;return a.getParameter(a.DEPTH_BITS)},SceneJS.Scene.prototype.setResolutionScaling=function(a){return this._engine.canvas.setResolutionScaling(a)},SceneJS.Scene.prototype.setProjection=function(a){var b=this._engine.display,c=a.type;c||b.projection&&(c=b.projection.type),c=c||"perspective","ortho"==c?b.projection=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:c,left:a.left,bottom:a.bottom,near:a.near,right:a.right,top:a.top,far:a.far}):"frustum"==c?b.projection={type:c,left:a.left||-1,bottom:a.bottom||-1,near:a.near||.1,right:a.right||1,top:a.top||1,far:a.far||1e4}:"perspective"==c&&(void 0!=a.fovy&&(a.fov=a.fovy),b.projection={type:c,fov:a.fov||60,aspect:void 0==a.aspect?1:a.aspect,near:a.near||.1,far:a.far||1e4}),b.projection.pan=a.pan,b.buildProjectionMatrix(),b.imageDirty=!0},SceneJS.Scene.prototype.getProjection=function(){return this._engine.display.projection},SceneJS.Scene.prototype.setCamera=function(a){var b=this._engine.display;a.eye&&b.camera.eye.set(a.eye),a.look&&b.camera.look.set(a.look),a.up&&b.camera.up.set(a.up),a.deviceMatrix&&(b.hasDeviceMatrix=!0,b.deviceMatrix.set(a.deviceMatrix)),b.buildViewMatrix(),b.imageDirty=!0},SceneJS.Scene.prototype.setLights=function(a){a=a||[];var b=this._engine.display;b.lights.length=a.length;var c="";b._ambientColor[0]=0,b._ambientColor[1]=0,b._ambientColor[2]=0;for(var d=0,e=0,f=a.length;f>e;++e){b.lights[d]=b.lights[d]||{};var g=b.lights[d],h=a[e],i=h.mode||"dir";if("dir"!=i&&"point"!=i&&"ambient"!=i&&"spot"!=i)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'spot' or 'ambient'");var j=h.pos,k=h.dir,l=h.color;g.color=new Float32Array([void 0!=l.r?l.r:1,void 0!=l.g?l.g:1,void 0!=l.b?l.b:1]),"ambient"!==i?(g.mode=i,g.diffuse="ambient"==i?!0:void 0!=h.diffuse?h.diffuse:!0,g.specular="ambient"==i?!1:void 0!=h.specular?h.specular:!0,g.pos=new Float32Array(h.pos?[j.x||0,j.y||0,j.z||0]:[0,0,0]),g.dir=new Float32Array(h.dir?[k.x||0,k.y||0,k.z||0]:[0,0,1]),g.innerCone=void 0!=h.innerCone?h.innerCone:.25,g.outerCone=void 0!=h.outerCone?h.outerCone:0,g.attenuation=new Float32Array([void 0!=h.constantAttenuation?h.constantAttenuation:0,h.linearAttenuation||0,h.quadraticAttenuation||0]),g.space=h.space||"world",++d,c+=g.mode,g.specular&&(c+="s"),g.diffuse&&(c+="d"),c+="world"===g.space?"w":"v",f-1>e&&(c+="/")):(b._ambientColor[0]=g.color[0],b._ambientColor[1]=g.color[1],b._ambientColor[2]=g.color[2])}b.lights.length=d,b.lightHash!==c?(b.lightHash=c,this._engine.branchDirty(this)):b.imageDirty=!0},SceneJS.Scene.prototype.setClips=function(a){var b=this._engine.display,c=b.clips,d="";c.clips.length=a.length,c.enabled=!1;for(var e=0,f=a.length;f>e;++e){var g=a[e],h=c.clips[e]||(c.clips[e]={normalAndDist:vec4.create(),fade:!1,fadeDistance:0}),i=g.n;vec3.normalize(i,i);var j=0;g.d?j=g.d:g.p&&(j=-vec3.dot(i,g.p)),h.normalAndDist.set(i),h.normalAndDist[3]=j,h.fade=!!g.fade,h.fadeDistance=0,h.fade?(c.clipFade=!0,h.fadeDistance=g.fadeDistance):c.clipDiscard=!0,d+=h.fade?"f":"c"}d===b.clipsHash?b.imageDirty=!0:(this._engine.branchDirty(this),b.clipsHash=d)},SceneJS.Scene.prototype.createReflection=function(a,b){var c=this._engine.display,d=c.reflections,e=d.reflections[a];return e?void console.error("Reflection already exists: "+a):(e=new SceneJS.GlobalCubemap(this,a,b),void(d.reflections[a]=e))},SceneJS.Scene.prototype.activateReflection=function(a){var b=this._engine.display.reflections,c=b.reflections[a];return c?(b.activeReflection=c,void this._updateReflectionsHash()):void console.error("Reflection not found: "+a)},SceneJS.Scene.prototype._updateReflectionsHash=function(){var a=this._engine.display,b=a.reflections.activeReflection,c=a.reflections.activeReflection?b.hash:";";c===a.reflectionsHash?a.imageDirty=!0:(this._engine.branchDirty(this),a.reflectionsHash=c)},SceneJS.Scene.prototype.deactivateReflection=function(){var a=this._engine.display.reflections;a.activeReflection&&(a.activeReflection=null,this._updateReflectionsHash())},SceneJS.Scene.prototype.destroyReflection=function(a){var b=this._engine.display,c=b.reflections,d=c.reflections[a];return d?(c.activeReflection&&c.activeReflection.id===d.id&&this.deactivateReflection(),d.destroy(),void delete c.reflections[a]):void console.error("Reflection not found: "+a)},SceneJS.Scene.prototype.destroyAllReflections=function(){for(var a=Object.keys(this._engine.display.reflections.reflections),b=0,c=a.length;c>b;b++)this.destroyReflection(a[b])},SceneJS.Scene.prototype.createLightmap=function(a,b){var c=this._engine.display,d=c.lightmaps,e=d.lightmaps[a];return e?void console.error("Lightmap already exists: "+a):(e=new SceneJS.GlobalCubemap(this,a,b),void(d.lightmaps[a]=e))},SceneJS.Scene.prototype.activateLightmap=function(a){var b=this._engine.display.lightmaps,c=b.lightmaps[a];return c?(b.activeLightmap=c,void this._updateLightmapsHash()):void console.error("Lightmap not found: "+a)},SceneJS.Scene.prototype._updateLightmapsHash=function(){var a=this._engine.display,b=a.lightmaps.activeLightmap,c=a.lightmaps.activeLightmap?b.hash:";";c===a.lightmapsHash?a.imageDirty=!0:(this._engine.branchDirty(this),a.lightmapsHash=c)},SceneJS.Scene.prototype.deactivateLightmap=function(){var a=this._engine.display.lightmaps;a.activeLightmap&&(a.activeLightmap=null,this._updateLightmapsHash())},SceneJS.Scene.prototype.destroyLightmap=function(a){var b=this._engine.display,c=b.lightmaps,d=c.lightmaps[a];return d?(c.activeLightmap&&c.activeLightmap.id===d.id&&this.deactivateLightmap(),d.destroy(),void delete c.lightmaps[a]):void console.error("Lightmap not found: "+a)},SceneJS.Scene.prototype.destroyAllLightmaps=function(){for(var a=Object.keys(this._engine.display.lightmaps.lightmaps),b=0,c=a.length;c>b;b++)this.destroyLightmap(a[b])},SceneJS.Scene.prototype.setDeviceMatrix=function(a){var b=this._engine.display;b.hasDeviceMatrix=!!a,a&&b.deviceMatrix.set(a),b.imageDirty=!0},SceneJS.Scene.prototype.getCamera=function(){return this._engine.display.camera},SceneJS.Scene.prototype.getViewMatrix=function(){return this._engine.display.viewMatrix},SceneJS.Scene.prototype.getProjectionMatrix=function(){return this._engine.display.projectionMatrix},SceneJS.Scene.prototype.setFogDensity=function(a){this._engine.display.fogDensity=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogStart=function(a){this._engine.display.fogParams[0]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnd=function(a){this._engine.display.fogParams[1]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMin=function(a){this._engine.display.fogParams[2]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMax=function(a){this._engine.display.fogParams[3]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogColor=function(a,b,c){this._engine.display.fogColor[0]=a,this._engine.display.fogColor[1]=b,this._engine.display.fogColor[2]=c,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogDensity=function(a){this._engine.display.fogColor[3]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMode=function(a){this._engine.display.fogMode=a,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnabled=function(a){this._engine.display.fogEnabled=a,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setXrayColor=function(a,b,c){this._engine.display.xrayColor[0]=a,this._engine.display.xrayColor[1]=b,this._engine.display.xrayColor[2]=c,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.mainFramebufferParams=function(a){this._engine.display.mainFramebufferParams=a||null},SceneJS.Scene.prototype.createFramebuffer=function(a,b){this._engine.display.createFramebuffer(a,b)},SceneJS.Scene.prototype.destroyFramebuffer=function(a){this._engine.display.destroyFramebuffer(a)},SceneJS.Scene.prototype.getPostProcessStage=function(a){return this._engine.display.getPostProcessStage(a)},SceneJS.Scene.prototype.createPostProcessType=function(a,b,c){this._engine.display.createPostProcessType(a,b,c)},SceneJS.Scene.prototype.postProcessOpaque=function(a){this._engine.display.postProcessOpaque(a)},SceneJS.Scene.prototype.postProcessFinal=function(a){this._engine.display.postProcessFinal(a)},SceneJS.Scene.prototype.setNumPasses=function(a){this._engine.setNumPasses(a)},SceneJS.Scene.prototype.setClearEachPass=function(a){this._engine.setClearEachPass(a)},SceneJS.Scene.prototype.setViewport=function(a,b,c,d){this._engine.display.setViewport(a,b,c,d)},SceneJS.Scene.prototype.render=function(a){return this._engine.render(a)},SceneJS.Scene.prototype.pauseCompilation=function(){return this._engine.pauseCompilation()},SceneJS.Scene.prototype.resumeCompilation=function(){return this._engine.resumeCompilation()},SceneJS.Scene.prototype.compile=function(){return this._engine.compile()},SceneJS.Scene.prototype.needFrame=function(){this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.start=function(a){this._engine.start(a)},SceneJS.Scene.prototype.pick=function(){var a;if(SceneJS._isNumeric(arguments[0])){var b=arguments[0],c=arguments[1];a=arguments[2]||{},a.canvasPos=new Float32Array([b,c])}else a=arguments[0]||{};var d=this._engine.pick(a);return this.render({force:!0}),d?(this.publish("pick",d),d):void this.publish("nopick")},SceneJS.Scene.prototype.readPixels=function(a,b,c){return this._engine.readPixels(a,b,c)},SceneJS.Scene.prototype._destroy=function(){this.destroyed||(delete SceneJS._engines[this.id],SceneJS._engineIds.removeItem(this.id),this.destroyed=!0)},SceneJS.Scene.prototype.isActive=function(){return!this._engine.destroyed},SceneJS.Scene.prototype.stop=function(){this._engine.stop()},SceneJS.Scene.prototype.containsNode=function(a){return!!this._engine.findNode(a)},SceneJS.Scene.prototype.findNodes=function(a){return this._engine.findNodes(a)},SceneJS.Scene.prototype.findNode=function(a){return this.getNode(a)},SceneJS.Scene.prototype.getNode=function(a){return this._engine.findNode(a)},SceneJS.Scene.prototype.hasCore=function(a,b){return this._engine.hasCore(a,b)},SceneJS.Scene.prototype.publish=function(a,b,c){if(c||(this._topicPubs[a]=b),this._topicSubs[a]){var d=this._topicSubs[a];for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)}},SceneJS.Scene.prototype.unpublish=function(a){var b=this._topicSubs[a];if(b)for(var c in b)b.hasOwnProperty(c)&&b[c].call(this,null);delete this._topicPubs[a]},SceneJS.Scene.prototype.on=function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),"rendered"==a&&this._engine.branchDirty(this),d},SceneJS.Scene.prototype.off=function(a){var b=this._handleTopics[a];if(b){delete this._handleTopics[a];var c=this._topicSubs[b];c&&delete c[a],this._handleMap.removeItem(a),"rendered"==b&&this._engine.branchDirty(this)}},SceneJS.Scene.prototype.once=function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})}}(),function(){"use strict";function a(a,b,c,d){return function(){if(b.compressedSrc){a._initTexture(c);var e;"dds"===d?e=a._parseDDS:"pvr"===d&&(e=a._parsePVR),SceneJS._loadBinary(b.compressedSrc,e.bind(this))}else b.image?(a._initTexture(c),a._setTextureImage(b.image)):b.src&&(a._initTexture(c),a._loadTexture(b.src))}}function b(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function c(a,b){var a=Math.max(a,16),b=Math.max(b,8);return a*b/4}function d(a,b){var a=Math.max(a,8),b=Math.max(b,8);return a*b/2}function e(a,b){return Math.floor((a+3)/4)*Math.floor((b+3)/4)*8}function f(a,b){return Math.floor((a+3)/4)*Math.floor((b+3)/4)*16}var g={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.texture=g,i=0});var h=[],i=0,j=null,k=null,l=null,m=null,n=SceneJS.TEXTURE_FLAGS;SceneJS.TextureMap=SceneJS_NodeFactory.createNodeType("texture"),SceneJS.TextureMap.prototype._init=function(b){if(1==this._core.useCount){var c=b.applyFrom||"uv";if("uv"!==c.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var d=0;if("uv"!==c&&(d=parseInt(c.substring(2)),isNaN(d)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");if(b.applyTo){var e=b.applyTo;if("baseColor"!=e&&"color"!=e&&"occlusion"!=e&&"specular"!=e&&"emit"!=e&&"alpha"!=e&&"normals"!=e&&"shine"!=e&&"transparency"!=e&&"metallic"!=e&&"roughness"!=e&&"metallicRoughness"!=e)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyTo value is unsupported: "+e)}if(b.blendMode&&"add"!=b.blendMode&&"multiply"!=b.blendMode&&"over"!=b.blendMode&&"conditionalAlpha"!=b.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");"color"==b.applyTo&&(b.applyTo="baseColor");var f=n[b.applyTo||"baseColor"]|n[b.blendMode||"multiply"];if(SceneJS._apply({waitForLoad:void 0==b.waitForLoad?!0:b.waitForLoad,texture:null,minFilter:b.minFilter,magFilter:b.magFilter,wrapS:b.wrapS,wrapT:b.wrapT,flipY:b.flipY,uvLayerIdx:d,isNormalMap:"normals"===b.applyTo,isAlphaMap:"alpha"===b.applyTo,isTransparencyMap:"transparency"===b.applyTo,flags:f,blendFactor:void 0!=b.blendFactor&&null!=b.blendFactor?b.blendFactor:1},this._core),this._initTexture(b.preloadColor),b.compressedImage)this.setCompressedImage(b.compressedImage,b.containerFormat,b.compressedSrc);else if(b.compressedSrc){this._core.compressedSrc=b.compressedSrc;var g;if("dds"===b.containerFormat)g=this._parseDDS;else if("pvr"===b.containerFormat)g=this._parsePVR;else{if("ktx"!==b.containerFormat)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Compressed textures require containerFormat parameter to be 'dds' or 'pvr'");g=this._parseKTX}SceneJS._loadBinary(b.compressedSrc,g.bind(this))}else b.image?this._setTextureImage(b.image):b.src&&(this._core.src=b.src,this._loadTexture(b.src,b.preloadSrc));this._core.mipMapLevels=0,this._core.drawTexture=b.drawTexture||!1,this._core.webglRestored=a(this,this._core,b.preloadColor,b.containerFormat)}},SceneJS.TextureMap.prototype._initTexture=function(a){var b=this._engine.canvas.gl;a=a||{r:.57735,g:.57735,b:.57735},a.a=void 0===a.a?1:a.a,a=new Uint8Array([Math.floor(255*a.r),Math.floor(255*a.g),Math.floor(255*a.b),Math.floor(255*a.a)]),this._core.width=1,this._core.height=1;var c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,a),this._setCoreTexture(c)},SceneJS.TextureMap.prototype._loadTexture=function(a,b){var c=this,d=new Image,e=!1,f=!1;if(b){var g=new Image;g.onload=function(){e||(c._setTextureImage(g),f=!0,c._engine.display.imageDirty=!0)},g.src=b}d.onload=function(){c._setTextureImage(d),e=!0,c._engine.display.imageDirty=!0},d.src=a},SceneJS.TextureMap.prototype._setTextureImage=function(a){var b=this._engine.canvas.gl,c=this._core,d=c.texture&&c.texture.texture?c.texture.texture:b.createTexture();b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),c.width=a.width,c.height=a.height,this._setCoreTexture(d),this._gatherStats(a.width,a.height,a.width*a.height*4)},SceneJS.TextureMap.prototype._setCompressedTextureImage=function(a,b,c,d,e,f,g){var h=this._engine.canvas.gl,i=this._core,k=i.texture&&i.texture.texture?i.texture.texture:h.createTexture(),l=SceneJS._getExtension(h,b);if(!l)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Compressed texture format "+b+"not available.");h.bindTexture(h.TEXTURE_2D,k);var m=0;this._core.width=d,this._core.height=e,this._core.mipMapLevels=f,this._core.compressed=!0;for(var n=j.SIZE_FUNCTIONS[c],o=d,p=e,q=0;f>q;++q){var r=0;g?(r=a[m]+(a[m+1]<<8)+(a[m+2]<<16)+(a[m+3]<<24),m+=4):r=n(o,p);var s=new Uint8Array(a.buffer,a.byteOffset+m,r);h.compressedTexImage2D(h.TEXTURE_2D,q,c,o,p,0,s),o/=2,p/=2,m+=r}this._setCoreTexture(k),this._gatherStats(d,e,a.byteLength)},SceneJS.TextureMap.prototype._gatherStats=function(a,b,c){this._engine.stats.memory.textures+=c;var d=this._engine.stats.textures,e=a+"x"+b,f=this._getTextureTarget(),g=d[f]=d[f]||{};g[e]=(g[e]||0)+1,g.memory=(g.memory||0)+c},SceneJS.TextureMap.prototype._setCoreTexture=function(a){var b=this._engine.canvas.gl,c=SceneJS_math_isPOT(this._core.width)&SceneJS_math_isPOT(this._core.height),d=c?b.REPEAT:b.CLAMP_TO_EDGE,e=1!==this._core.mipMapLevels&&c?b.LINEAR_MIPMAP_NEAREST:b.LINEAR;this._core.texture=new SceneJS._webgl.Texture2D(b,{texture:a,minFilter:this._getGLOption("minFilter",e),magFilter:this._getGLOption("magFilter",b.LINEAR),wrapS:this._getGLOption("wrapS",d),wrapT:this._getGLOption("wrapT",d),compressed:this._core.compressed,flipY:this._core.flipY,update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype._getTextureTarget=function(){var a=this._core.flags;return a&n.baseColor?"baseColor":a&n.occlusion?"occlusion":a&n.normals?"normals":a&n.alpha?"alpha":a&n.specular?"specular":a&n.emit?"emit":a&n.shine?"shine":a&n.transparency?"transparency":a&n.metallic?"metallic":a&n.roughness?"roughness":a&n.metallicRoughness?"metallicRoughness":void 0},SceneJS.TextureMap.prototype._getGLOption=function(a,b){var c=this._engine.canvas.gl,d=this._core[a];if(void 0==d)return b;var e=SceneJS._webgl.enumMap[d];if(void 0==e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+a+"' value: '"+d+"'");return c[e]},SceneJS.TextureMap.prototype._getOption=function(a,b){return void 0==a?b:a},SceneJS.TextureMap.prototype.setSrc=function(a){this._core.image=null,this._core.src=a,this._core.target=null,this._loadTexture(a)},SceneJS.TextureMap.prototype.setImage=function(a){this._core.src=null,this._core.target=null,this._setTextureImage(a)},SceneJS.TextureMap.prototype.setCompressedImage=function(a,b,c){this._core.src=null,this._core.image=null,this._core.target=null,this._core.compressedSrc=c,"dds"===b?this._parseDDS(a):"pvr"===b?this._parsePVR(a):this._parseKTX(a)},SceneJS.TextureMap.prototype.setTarget=function(a){return"colorTarget"!=a.type&&"depthTarget"!=a.type?void console.log("Target node type not compatible: "+a.type):(delete this._core.src,this._core.target=a,this._core.src=null,this._core.image=null,this._core.texture=a._core.renderBuf.getTexture(),this._core.texture.bufType=a._core.bufType,void(this._engine.display.imageDirty=!0))},SceneJS.TextureMap.prototype.setBlendFactor=function(a){this._core.blendFactor=a,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getBlendFactor=function(){return this._core.blendFactor},SceneJS.TextureMap.prototype.setTranslate=function(a){this._core.translate||(this._core.translate={x:0,y:0}),this._core.translate.x=a.x,this._core.translate.y=a.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getTranslate=function(){return this._core.translate},SceneJS.TextureMap.prototype.setScale=function(a){this._core.scale||(this._core.scale={x:0,y:0}),this._core.scale.x=a.x,this._core.scale.y=a.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getScale=function(){return this._core.scale},SceneJS.TextureMap.prototype.setRotate=function(a){this._core.rotate=a,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getRotate=function(){return this._core.rotate},SceneJS.TextureMap.prototype.getMatrix=function(){return this._core._matrixDirty&&this._core.buildMatrix.call(this.core)(),this.core.matrix},SceneJS.TextureMap.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("texture"),this.__core.transparent=!1,this.__core.drawLayer=-1);var b=this._engine.display.texture;this._core.empty||(this.__core.layers=b&&b.layers?b.layers.concat([this._core]):[this._core],this.__core.transparent=this._core.isAlphaMap||this._core.isTransparencyMap||b.transparent,this._core.drawTexture&&(this.__core.drawLayerIndex=this.__core.layers.length-1)),this._makeHash(this.__core),h[i++]=this.__core,this._engine.display.texture=this.__core,this._compileNodes(a),this._engine.display.texture=--i>0?h[i-1]:g,h[i]=null},SceneJS.TextureMap.prototype._makeHash=function(a){var b=[];if(a.layers&&a.layers.length>0)for(var c,d=a.layers,e=0,f=d.length;f>e;e++)c=d[e],b.push("/"),b.push(c.uvLayerIdx),b.push("/"),b.push(c.flags),c.matrix&&b.push("/anim"),c.compressed&&b.push("/comp"),"normals"===c.applyTo&&SceneJS.WEBGL_INFO.standardDerivativesSupported&&b.push("/gt");var g=b.join("");a.hash!=g&&(a.hash=g)},SceneJS.TextureMap.prototype._destroy=function(){1==this._core.useCount&&(this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null),this._engine.stats.memory.textures--)},SceneJS.TextureMap.prototype._parseDDS=function(a){if(!k)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"DXT compressed textures not supported on this platform.");var b=new Uint32Array(a,0,k.HEADER_LENGTH);if(b[k.MAGIC_NUMBER_INDEX]!=k.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: Magic number invalid.");if(b[k.PIXEL_FORMAT_FLAGS_INDEX]&0===k.PIXEL_FORMAT_FOURCC_FLAG)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: FourCC required.");var c=k.FOURCC_MAP[b[k.PIXEL_FORMAT_FOURCC_INDEX]],d=k.EXTENSION_MAP[b[k.PIXEL_FORMAT_FOURCC_INDEX]],e=1;b[k.FLAGS_INDEX]&k.MIPMAPCOUNT_FLAG&&(e=b[k.MIPMAPCOUNT_INDEX]);var f=b[k.WIDTH_INDEX],g=b[k.HEIGHT_INDEX],h=new Uint8Array(a,k.DATA_OFFSET);this._setCompressedTextureImage(h,d,c,f,g,e)},SceneJS.TextureMap.prototype._parsePVR=function(a){var b=new Uint32Array(a,0,l.HEADER_LENGTH);if(b[l.MAGIC_NUMBER_INDEX]!=l.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid PVR File: Magic number invalid.");var c=b[l.PIXEL_FORMAT_INDEX],d=l.EXTENSION_MAP[c],e=l.FORMAT_MAP[c],f=b[l.MIPMAPCOUNT_INDEX],g=b[l.WIDTH_INDEX],h=b[l.HEIGHT_INDEX],i=l.HEADER_SIZE+b[l.METADATA_SIZE_INDEX],j=new Uint8Array(a,i);this._setCompressedTextureImage(j,d,e,g,h,f)},SceneJS.TextureMap.prototype._parseKTX=function(a){
for(var b=new Uint32Array(a,0,m.HEADER_LENGTH),c=0;c<m.IDENTIFIER_LENGTH;++c)if(b[c]!=m.IDENTIFIER[c])throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid KTX File: Identifier invalid.");var d=b[m.INTERNAL_FORMAT_INDEX],e=m.EXTENSION_MAP[d],f=b[m.MIPMAPCOUNT_INDEX],g=b[m.WIDTH_INDEX],h=b[m.HEIGHT_INDEX],i=m.HEADER_SIZE+b[m.KEY_VALUE_SIZE_INDEX],j=new Uint8Array(a,i);this._setCompressedTextureImage(j,e,d,g,h,f,!0)},function(){function a(a){var b=SceneJS._getExtension(a,"WEBGL_compressed_texture_pvrtc"),g=SceneJS._getExtension(a,"WEBGL_compressed_texture_etc1"),h=SceneJS._getExtension(a,"WEBGL_compressed_texture_s3tc"),i={PVRTC_SUPPORTED:!!b,ETC1_SUPPORTED:!!g,DXT_SUPPORTED:!!h,FORMAT_ENUMS:{},SIZE_FUNCTIONS:{}};return i.PVRTC_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,i.SIZE_FUNCTIONS[b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=d,i.SIZE_FUNCTIONS[b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=d),i.ETC1_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL=g.COMPRESSED_RGB_ETC1_WEBGL,i.SIZE_FUNCTIONS[g.COMPRESSED_RGB_ETC1_WEBGL]=e),i.DXT_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT=h.COMPRESSED_RGB_S3TC_DXT1_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT=h.COMPRESSED_RGBA_S3TC_DXT3_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT=h.COMPRESSED_RGBA_S3TC_DXT5_EXT,i.SIZE_FUNCTIONS[h.COMPRESSED_RGB_S3TC_DXT1_EXT]=e,i.SIZE_FUNCTIONS[h.COMPRESSED_RGBA_S3TC_DXT3_EXT]=f,i.SIZE_FUNCTIONS[h.COMPRESSED_RGBA_S3TC_DXT5_EXT]=f),i}function g(){var a={MAGIC_NUMBER:542327876,MIPMAPCOUNT_FLAG:131072,PIXEL_FORMAT_FOURCC_FLAG:4,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,SIZE_INDEX:1,FLAGS_INDEX:2,HEIGHT_INDEX:3,WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,PIXEL_FORMAT_FLAGS_INDEX:20,PIXEL_FORMAT_FOURCC_INDEX:21,DATA_OFFSET:128,FOURCC_MAP:{},EXTENSION_MAP:{}};if(j.DXT_SUPPORTED){var c=b("DXT1"),d=b("DXT3"),e=b("DXT5");a.FOURCC_MAP[c]=j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,a.FOURCC_MAP[d]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,a.FOURCC_MAP[e]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT,a.EXTENSION_MAP[c]="WEBGL_compressed_texture_s3tc",a.EXTENSION_MAP[d]="WEBGL_compressed_texture_s3tc",a.EXTENSION_MAP[e]="WEBGL_compressed_texture_s3tc"}if(j.ETC1_SUPPORTED){var f=b("ETC1");a.FOURCC_MAP[f]=j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL,a.EXTENSION_MAP[f]="WEBGL_compressed_texture_etc1"}return a}function h(){var a={MAGIC_NUMBER:55727696,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12,EXTENSION_MAP:{0:"WEBGL_compressed_texture_pvrtc",1:"WEBGL_compressed_texture_pvrtc",2:"WEBGL_compressed_texture_pvrtc",3:"WEBGL_compressed_texture_pvrtc",6:"WEBGL_compressed_texture_etc1",7:"WEBGL_compressed_texture_s3tc",9:"WEBGL_compressed_texture_s3tc",11:"WEBGL_compressed_texture_s3tc"},FORMAT_MAP:{}};return j.PVRTC_SUPPORTED&&(a.FORMAT_MAP[0]=j.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,a.FORMAT_MAP[1]=j.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,a.FORMAT_MAP[2]=j.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,a.FORMAT_MAP[3]=j.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),j.ETC1_SUPPORTED&&(a.FORMAT_MAP[6]=j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL),j.DXT_SUPPORTED&&(a.FORMAT_MAP[7]=j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,a.FORMAT_MAP[9]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,a.FORMAT_MAP[11]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT),a}function i(){var a=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]),b={IDENTIFIER:new Uint32Array(a.buffer),IDENTIFIER_LENGTH:3,HEADER_LENGTH:16,HEADER_SIZE:64,INTERNAL_FORMAT_INDEX:7,WIDTH_INDEX:9,HEIGHT_INDEX:10,MIPMAPCOUNT_INDEX:14,KEY_VALUE_SIZE_INDEX:15,EXTENSION_MAP:{}};return j.DXT_SUPPORTED&&(b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc",b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc"),j.ETC1_SUPPORTED&&(b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL]="WEBGL_compressed_texture_etc1"),b}var n=document.createElement("canvas");if(n){var o=n.getContext("webgl")||n.getContext("experimental-webgl");o&&(j=a(o),k=g(),l=h(),m=i())}}()}(),function(){"use strict";var a=SceneJS.TEXTURE_FLAGS,b={type:"fresnel",stateId:SceneJS._baseStateId++,power:1,centerColor:new Float32Array([1,1,1,1]),edgeColor:new Float32Array([0,0,0,0]),blendFactor:1,blendMode:a.multiply,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.fresnel=b,d=0});var c=[],d=0;SceneJS.Fresnel=SceneJS_NodeFactory.createNodeType("fresnel"),SceneJS.Fresnel.prototype._init=function(c){if(1==this._core.useCount){if(c.applyTo&&"color"!=c.applyTo&&"specular"!=c.applyTo&&"alpha"!=c.applyTo&&"reflect"!=c.applyTo&&"emit"!=c.applyTo&&"fragment"!=c.applyTo&&"transparency"!=c.applyTo)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"fresnel applyTo value is unsupported - should be either 'color', 'specular', 'alpha', 'reflect', 'emit' or 'fragment'");if(this._core.applyTo=c.applyTo,c.blendMode&&"add"!=c.blendMode&&"multiply"!=c.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");this._core.blendMode=a[c.blendMode||"multiply"],this._core.centerColor=new Float32Array(b.centerColor),this._core.edgeColor=new Float32Array(b.edgeColor),this._core.power=b.power,void 0!=c.centerBias&&this.setCenterBias(c.centerBias),void 0!=c.edgeBias&&this.setEdgeBias(c.edgeBias),void 0!=c.power&&this.setPower(c.power),void 0!=c.centerColor&&this.setCenterColor(c.centerColor),void 0!=c.edgeColor&&this.setEdgeColor(c.edgeColor)}},SceneJS.Fresnel.prototype.getApplyTo=function(){return this._core.applyTo},SceneJS.Fresnel.prototype.setCenterBias=function(a){this._core.centerColor[3]=void 0!==a?a:b.centerColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getCenterBias=function(){return this._core.centerColor[3]},SceneJS.Fresnel.prototype.setEdgeBias=function(a){this._core.edgeColor[3]=void 0!==a?a:b.edgeColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getEdgeBias=function(){return this._core.edgeColor[3]},SceneJS.Fresnel.prototype.setPower=function(a){this._core.power=void 0!==a?a:b.power,this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getPower=function(){return this._core.power},SceneJS.Fresnel.prototype.setCenterColor=function(a){var c=b.centerColor;return this._core.centerColor[0]=void 0!=a.r?a.r:c[0],this._core.centerColor[1]=void 0!=a.g?a.g:c[1],this._core.centerColor[2]=void 0!=a.b?a.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getCenterColor=function(){return{r:this._core.centerColor[0],g:this._core.centerColor[1],b:this._core.centerColor[2]}},SceneJS.Fresnel.prototype.setEdgeColor=function(a){var c=b.edgeColor;return this._core.edgeColor[0]=void 0!=a.r?a.r:c[0],this._core.edgeColor[1]=void 0!=a.g?a.g:c[1],this._core.edgeColor[2]=void 0!=a.b?a.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getEdgeColor=function(){return{r:this._core.edgeColor[0],g:this._core.edgeColor[1],b:this._core.edgeColor[2]}},SceneJS.Fresnel.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("fresnel"),this.__core.transparent=!1,this.__core.partiallyOpaque=!1);var e=this._engine.display.fresnel;this._core.empty||(this.__core.diffuse="color"==this._core.applyTo?this._core:e.diffuse,this.__core.specular="specular"==this._core.applyTo?this._core:e.specular,this.__core.alpha="alpha"==this._core.applyTo?this._core:e.alpha,this.__core.reflect="reflect"==this._core.applyTo?this._core:e.reflect,this.__core.emit="emit"==this._core.applyTo?this._core:e.emit,this.__core.fragment="fragment"==this._core.applyTo?this._core:e.fragment,this.__core.transparency="transparency"==this._core.applyTo?this._core:e.transparency,this.__core.transparent=e.transparent,this.__core.partiallyOpaque=e.partiallyOpaque,("alpha"==this._core.applyTo||"transparency"==this._core.applyTo)&&(this.__core.transparent=!0,(this._core.centerColor[0]>=1||this._core.edgeColor[0]>=1)&&(this.__core.partiallyOpaque=!0))),this._makeHash(this.__core),c[d++]=this.__core,this._engine.display.fresnel=this.__core,this._compileNodes(a),this._engine.display.fresnel=--d>0?c[d-1]:b,c[d]=null},SceneJS.Fresnel.prototype._makeHash=function(a){var b=[];a.diffuse&&b.push("d"+a.diffuse.blendMode+";"),a.specular&&b.push("s"+a.specular.blendMode+";"),a.alpha&&b.push("a"+a.alpha.blendMode+";"),a.reflect&&b.push("r"+a.reflect.blendMode+";"),a.emit&&b.push("e"+a.emit.blendMode+";"),a.fragment&&b.push("f"+a.fragment.blendMode+";"),a.transparency&&b.push("t"+a.transparency.blendMode+";"),b.push(a.blendMode+";"),b=b.join(""),a.hash!=b&&(a.hash=b)},SceneJS.Fresnel.prototype._destroy=function(){}}(),function(){"use strict";var a={type:"cubemap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,space:"world",hash:""},b=[],c=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){b.engine.display.cubemap=a,c=0}),SceneJS.Cubemap=SceneJS_NodeFactory.createNodeType("cubemap"),SceneJS.Cubemap.prototype._init=function(a){if(1===this._core.useCount){if(this._core.hash="y",a.blendMode&&"add"!==a.blendMode&&"multiply"!==a.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap blendMode value is unsupported - should be either 'add' or 'multiply'");var b=a.applyTo||"reflect";if("reflect"!==b&&"light"!==b)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap applyTo value is unsupported - should be either 'reflect' or 'light'");this._core.blendMode=a.blendMode||"multiply",this._core.intensity=void 0!=a.intensity&&null!=a.intensity?a.intensity:1,this._core.applyTo=SceneJS.CUBEMAP_FLAGS[b];var c=a.space||"world";if("view"!==c&&"world"!==c)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"cubemap 'space' value is unsupported: '"+c+"' - should be 'view' or 'world'");"view"===c&&"reflect"===b&&(c="world;"),this._core.space=c;for(var d=this,e=this._engine.canvas.gl,f=e.createTexture(),g=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z],h=new Array(6),i=!1,j=6,k=0;k<g.length;k++){var l=new Image;l.onload=function(a){var b=l;return function(){if(!i&&(h[a]=b,0===--j)){e.bindTexture(e.TEXTURE_CUBE_MAP,f),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);for(var c=0,k=h.length;k>c;c++)e.texImage2D(g[c],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h[c]);d._core.texture=new SceneJS._webgl.Texture2D(e,{texture:f,target:e.TEXTURE_CUBE_MAP,minFilter:e.LINEAR_MIPMAP_LINEAR,magFilter:e.LINEAR,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE});var l=Math.min(b.width,b.height);d._core.mipLevels=SceneJS_math_log2(l),d._engine.display.imageDirty=!0}}}(k),l.onerror=function(){i=!0},l.src=a.src[k]}}},SceneJS.Cubemap.prototype._compile=function(d){this.__core||(this.__core=this._engine._coreFactory.getCore("cubemap"));var e=this._engine.display.cubemap;this._core.empty||(this.__core.layers=e&&e.layers?e.layers.concat([this._core]):[this._core]),this._makeHash(this.__core),b[c++]=this.__core,this._engine.display.cubemap=this.__core,this._compileNodes(d),this._engine.display.cubemap=--c>0?b[c-1]:a,b[c]=null},SceneJS.Cubemap.prototype._makeHash=function(a){var b;if(a.layers&&a.layers.length>0){for(var c,d=a.layers,e=[],f=0,g=d.length;g>f;f++)c=d[f],e.push("/"),e.push(c.applyTo),e.push("/"),e.push(c.space),e.push("/"),e.push(c.blendMode);b=e.join("")}else b="";a.hash!=b&&(a.hash=b)},SceneJS.Cubemap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";var a={type:"regionMap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,regionColor:[-1,-1,-1],highlightFactor:[1.5,1.5,0],hideAlpha:0,regionData:[],mode:"info",hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(c){c.engine.display.regionMap=a,b=0});var b=0,c={info:!0,highlight:!0,hide:!0,isolate:!0};SceneJS.RegionMap=SceneJS_NodeFactory.createNodeType("regionMap"),SceneJS.RegionMap.prototype._init=function(a){var b=this;if(1==this._core.useCount){SceneJS._apply({regionMap:null},this._core);var c=a.applyFrom||"uv";if("uv"!==c.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var d=0;if("uv"!==c&&(d=c.substring(2),isNaN(d)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");this._core.uvLayerIdx=d,a.src?(this._initTexture(),this._core.src=a.src,this._loadTexture(a.src)):a.image&&(this._initTexture(a.preloadColor),this._core.image=a.image,this._setTextureImage(a.image)),this._core.webglRestored=function(){b._core.image?(b._initTexture(),b._setTextureImage(b._core.image)):b._core.src?(b._initTexture(),b._loadTexture(b._core.src)):b._core.target},this.setRegionColor(a.regionColor),this.setHighlightFactor(a.highlightFactor),this.setHideAlpha(a.hideAlpha),this.setRegionData(a.regionData),this.setMode(a.mode)}},SceneJS.RegionMap.prototype._initTexture=function(){var a=this._engine.canvas.gl,b={r:.57735,g:.57735,b:.57735};b.a=void 0===b.a?1:b.a,b=new Uint8Array([Math.floor(255*b.r),Math.floor(255*b.g),Math.floor(255*b.b),Math.floor(255*b.a)]);var c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,b),this._setCoreTexture(c)},SceneJS.RegionMap.prototype._loadTexture=function(a){var b=this,c=new Image,d=!1;c.onload=function(){b._setTextureImage(c),d=!0,b._engine.display.imageDirty=!0},this._fetchImage(c,a)},SceneJS.RegionMap.prototype._fetchImage=function(a,b){0==b.indexOf("data")?a.src=b:(a.crossOrigin="Anonymous",a.src=b)},SceneJS.RegionMap.prototype._setTextureImage=function(a){var b=this._engine.canvas.gl,c=this._core.texture?this._core.texture.texture:b.createTexture();b.bindTexture(b.TEXTURE_2D,c),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),this._core.image=a,this._setCoreTexture(c)},SceneJS.RegionMap.prototype._setCoreTexture=function(a){var b=this._engine.canvas.gl;this._core.texture=new SceneJS._webgl.Texture2D(b,{texture:a,minFilter:this._getGLOption("minFilter",b.NEAREST_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",b.NEAREST),wrapS:this._getGLOption("wrapS",b.REPEAT),wrapT:this._getGLOption("wrapT",b.REPEAT),isDepth:this._getOption(this._core.isDepth,!1),depthMode:this._getGLOption("depthMode",b.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",b.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",b.LEQUAL),flipY:this._getOption(this._core.flipY,!0),width:this._getOption(this._core.width,1),height:this._getOption(this._core.height,1),internalFormat:this._getGLOption("internalFormat",b.ALPHA),sourceFormat:this._getGLOption("sourceFormat",b.ALPHA),sourceType:this._getGLOption("sourceType",b.UNSIGNED_BYTE),update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.RegionMap.prototype._getGLOption=function(a,b){var c=this._engine.canvas.gl,d=this._core[a];if(void 0==d)return b;var e=SceneJS._webgl.enumMap[d];if(void 0==e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+a+"' value: '"+d+"'");return c[e]},SceneJS.RegionMap.prototype._getOption=function(a,b){return void 0==a?b:a},SceneJS.RegionMap.prototype.setSrc=function(a){this._core.image=null,this._core.src=a,this._core.target=null,this._loadTexture(a)},SceneJS.RegionMap.prototype.setImage=function(a){this._core.image=a,this._core.src=null,this._core.target=null,this._setTextureImage(a)},SceneJS.RegionMap.prototype.setTarget=function(a){return"colorTarget"!=a.type&&"depthTarget"!=a.type?void console.log("Target node type not compatible: "+a.type):(delete this._core.src,this._core.target=a,this._core.src=null,this._core.image=null,this._core.texture=a._core.renderBuf.getTexture(),this._core.texture.bufType=a._core.bufType,void(this._engine.display.imageDirty=!0))},SceneJS.RegionMap.prototype.setRegionColor=function(b){var c=a.regionColor;return this._core.regionColor=b?[void 0!=b.r&&null!=b.r?b.r:c[0],void 0!=b.g&&null!=b.g?b.g:c[1],void 0!=b.b&&null!=b.b?b.b:c[2]]:a.regionColor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHighlightFactor=function(b){var c=a.highlightFactor;return this._core.highlightFactor=b?[void 0!=b.r&&null!=b.r?b.r:c[0],void 0!=b.g&&null!=b.g?b.g:c[1],void 0!=b.b&&null!=b.b?b.b:c[2]]:a.highlightFactor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHideAlpha=function(b){return this._core.hideAlpha=void 0!=b?b:a.hideAlpha,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setMode=function(b){var d=!!this._core.transparent;return this._core.mode=b&&c[b]?b:a.mode,this._core.transparent="hide"===this._core.mode||"isolate"===this._core.mode,d!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this._core.hash="reg-"+b,this},SceneJS.RegionMap.prototype.setRegionData=function(b){return this._core.regionData=b?b:a.regionData,this},SceneJS.RegionMap.prototype._compile=function(a){var b=this._engine.display.regionMap;this._engine.display.regionMap=this._core,this._compileNodes(a),this._engine.display.regionMap=b},SceneJS.RegionMap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";SceneJS.GlobalCubemap=function(a,b,c){this.scene=a,this.id=b,this.intensity=void 0!==c.intensity&&null!==c.intensity?c.intensity:1;var d=c.space||"world";"view"!==d&&"world"!==d&&(console.error("cubemap 'space' value is unsupported: '"+d+"' - should be 'view' or 'world' - defaulting to 'world'"),d="world"),this.space=d,this.hash=[this.space].join("");for(var e=this,f=a._engine.canvas.gl,g=f.createTexture(),h=[f.TEXTURE_CUBE_MAP_POSITIVE_X,f.TEXTURE_CUBE_MAP_NEGATIVE_X,f.TEXTURE_CUBE_MAP_POSITIVE_Y,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,f.TEXTURE_CUBE_MAP_POSITIVE_Z,f.TEXTURE_CUBE_MAP_NEGATIVE_Z],i=new Array(6),j=!1,k=6,l=0;l<h.length;l++){var m=new Image;m.onload=function(b){var c=m;return function(){if(!j&&(i[b]=c,0===--k)){f.bindTexture(f.TEXTURE_CUBE_MAP,g),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);for(var d=0,l=i.length;l>d;d++)f.texImage2D(h[d],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,i[d]);e.texture=new SceneJS._webgl.Texture2D(f,{texture:g,target:f.TEXTURE_CUBE_MAP,minFilter:f.LINEAR_MIPMAP_LINEAR,magFilter:f.LINEAR,wrapS:f.CLAMP_TO_EDGE,wrapT:f.CLAMP_TO_EDGE});var m=Math.min(c.width,c.height);e.mipLevels=SceneJS_math_log2(m),a._engine.display.imageDirty=!0}}}(l),m.onerror=function(){j=!0},m.src=c.src[l]}},SceneJS.GlobalCubemap.prototype.destroy=function(){this.texture&&(this.texture.destroy(),this.texture=null)}}(),function(){"use strict";var a=[],b=0,c={type:"xform",stateId:SceneJS._baseStateId++,matrix:mat4.create(),normalMatrix:mat4.create()};SceneJS.XForm=SceneJS_NodeFactory.createNodeType("xform"),SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.modelTransform=c,b=0}),SceneJS.XForm.prototype._init=function(a){1==this._core.useCount&&(this._core.matrix=mat4.create(),this._core.normalMatrix=mat4.create(),a.elements&&this.setElements(a.elements))},SceneJS.XForm.prototype.getMatrix=function(){return this._core.matrix},SceneJS.XForm.prototype.setElements=function(a){if(16!=a.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.XForm elements should number 16");var b=this._core;return b.matrix.set(a),mat4.invert(b.normalMatrix,b.matrix),mat4.transpose(b.normalMatrix,b.normalMatrix),this._engine.display.imageDirty=!0,this},SceneJS.XForm.prototype.getElements=function(){return this._core.matrix},SceneJS.XForm.prototype._compile=function(d){this._engine.display.modelTransform=a[b++]=this._core,this._compileNodes(d),this._engine.display.modelTransform=--b>0?a[b-1]:c,a[b]=null}}(),function(){"use strict";SceneJS.Types=new function(){this.addType=function(a,b){var c,d=SceneJS_NodeFactory.createNodeType(a);for(var e in b)if(b.hasOwnProperty(e))switch(c=b[e],e){case"init":case"construct":!function(){var a=b[e];d.prototype._init=function(b){a.call(this,b)},d.prototype._fromPlugin=!0}();break;case"destroy":case"destruct":d.prototype._destroy=c;break;default:d.prototype[e]=c}},this.hasType=function(a){return!!SceneJS_NodeFactory.nodeTypes[a]}}}(),function(){"use strict";function a(a,b){return a.sortKey-b.sortKey}function b(a,b){return a.layer-b.layer||a.properties.stateId-b.properties.stateId||a.sortTieBreaker-b.sortTieBreaker}function c(a,b){return a.layer-b.layer||b.getDepth()-a.getDepth()}var d=window.SceneJS_Display=function(a,b){this.stats=a||{},this._canvas=b.canvas,this._programFactory=new SceneJS_ProgramFactory(this.stats,{canvas:b.canvas}),this._chunkFactory=new SceneJS_ChunkFactory,this.transparent=b.transparent===!0,this.depthSort=b.depthSort===!0,this.autoTangents=b.autoTangents===!0,this.gammaInputPhong=b.gammaInputPhong===!0,this.properties=null,this.material=null,this.texture=null,this.fresnel=null,this.cubemap=null,this.modelTransform=null,this.regionMap=null,this.morphGeometry=null,this.geometry=null,this._objects={},this._ambientColor=[.7,.7,.8],this.projection={type:"perspective",fov:60,aspect:1,near:.1,far:500,pan:0},this.projectionMatrix=mat4.create(),this.buildProjectionMatrix(),this.camera={eye:new Float32Array([0,0,10]),look:new Float32Array([0,0,0]),up:new Float32Array([0,1,0])},this.viewMatrix=mat4.create(),this.hasDeviceMatrix=!1,this.deviceMatrix=mat4.create(),this.buildViewMatrix(),this.lights=[{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!0,specular:!0,dir:new Float32Array([-.5,-.5,-1]),space:"view"},{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!1,specular:!0,dir:new Float32Array([1,-.9,-.7]),space:"view"}],this.lightHash="dirsdv/dirsv/",this.clips={clips:[],clipFade:!1,clipDiscard:!1,enabled:!1},this.clipsHash="",this.reflections={reflections:{},activeReflection:null},this.reflectionsHash="",this.lightmaps={lightmaps:{},activeLightmap:null},this.lightmapsHash="",this.highlightColor=new Float32Array([1.5,1.5,.5]),this.desatParams=new Float32Array([.9,.3]),this.fogParams=new Float32Array([0,1e3,0,1]),this.fogColor=new Float32Array([1,1,1,.01]),this.fogEnabled=!1,this.xrayColor=new Float32Array([0,0,.1]),this.fogMode=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,this.viewport=new Float32Array([0,0,this._canvas.canvas.width,this._canvas.canvas.height]),this._opaqueObjects=[],this._numOpaqueObjects=0,this._transparentObjects=[],this._numTransparentObjects=0,this._pickLookup=[],this._frameCtx={regionData:[],canvas:this._canvas,VAO:null},this.objectListDirty=!0,this.imageDirty=!0,this._nextProgramId=0,this.postProcessPipelineOpaque=[],this.postProcessPipelineTransparent=[],this.postProcessPipelineFinal=[],this._postProcessTypes={},this._postProcesses={},this.framebuffers={},this.mainFramebuffer=null,this.mainFramebufferParams=null,this.oitAccumulateFramebuffer=null,this.oitPostprocessType=null,this.oitPostprocess=null,this.blitPostprocessType=null,this.blitPostprocess=null,this.transparencyMode=SceneJS.TRANSPARENCY_FLAGS.ALPHA,this.depthSort=!1,this.postProcessInitialized=!1,this.oitInitialized=!1};d.prototype.initPostProcess=function(){this.postProcessInitialized||(this.mainFramebuffer=this.createFramebuffer("__MAIN",this.mainFramebufferParams),this.blitPostprocessType=this.createPostProcessType("__BLIT",["precision highp float;","varying vec2 vUV;","uniform sampler2D uTexture;","void main() {","    gl_FragColor = texture2D(uTexture, vUV);","}"].join("\n")),this.blitPostprocess=new SceneJS_PostProcessStage(this,{type:"__BLIT",textures:{uTexture:{framebuffer:"__MAIN",target:"color"}}}),this.postProcessInitialized=!0)},d.prototype.initOIT=function(){this.oitInitialized||(this.initPostProcess(),this.oitAccumulateFramebuffer=this.createFramebuffer("__OIT_ACCUMULATE",{colorAttachments:[{type:"FLOAT"}],sharedDepthBuffer:this.mainFramebuffer}),this.oitDepthBuffer=this.createFramebuffer("__OIT_DEPTH",{colorAttachments:0}),this.oitPostprocessType=this.createPostProcessType("__OIT",["precision highp float;","varying vec2 vUV;","uniform vec2 uTexelOffset;","uniform sampler2D uAccumulate;","#define THRESH 0.1176","float edgeFilter(vec2 center, vec2 a0, vec2 a1, vec2 a2, vec2 a3){","    vec4 luminance = vec4(a0.x, a1.x , a2.x, a3.x);","    vec4 w = 1.0 - step(THRESH, abs(luminance - center.x));","    float W = w.x + w.y + w.z + w.w;","    w.x = W == 0.0 ? 1.0 : w.x;","    W = W == 0.0 ? 1.0 : W;","    return (w.x * a0.y + w.y * a1.y + w.z * a2.y + w.w * a3.y) / W;","}","void main() {","    vec4 accum = texture2D(uAccumulate, vUV);","    vec4 a0 = texture2D(uAccumulate, vUV + vec2(uTexelOffset.x, 0.0));","    vec4 a1 = texture2D(uAccumulate, vUV - vec2(uTexelOffset.x, 0.0));","    vec4 a2 = texture2D(uAccumulate, vUV + vec2(0.0, uTexelOffset.y));","    vec4 a3 = texture2D(uAccumulate, vUV - vec2(0.0, uTexelOffset.y));","    accum.rg /= max(accum.b, 0.001);","    a0.rg /= max(a0.b, 0.001);","    a1.rg /= max(a1.b, 0.001);","    a2.rg /= max(a2.b, 0.001);","    a3.rg /= max(a3.b, 0.001);","    vec3 ycocg = vec3(accum.rg, edgeFilter(accum.rg, a0.rg, a1.rg, a2.rg, a3.rg));","    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);","    ycocg.gb = checkerboard ? ycocg.gb : ycocg.bg;","    vec3 rgb = vec3(ycocg.r + ycocg.g - ycocg.b, ycocg.r + ycocg.b, ycocg.r - ycocg.g - ycocg.b);","    float a = 1.0 - accum.a;","    gl_FragColor = vec4(a * rgb, a);","}"].join("\n")),this.oitPostprocess=new SceneJS_PostProcessStage(this,{type:"__OIT",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uAccumulate:{framebuffer:"__OIT_ACCUMULATE",target:"color"}}}),this.oitInitialized=!0)},d.prototype.setTransparencyMode=function(a){this.transparencyMode=a,a===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.initOIT(),this.objectListDirty=!0},d.prototype.createFramebuffer=function(a,b){return this.framebuffers[a]&&this.framebuffers[a].destroy(),b=b||{},b.canvas=this._canvas,this.framebuffers[a]=new SceneJS._webgl.Framebuffer(b),this.framebuffers[a]},d.prototype.destroyFramebuffer=function(a){this.framebuffers[a]&&this.framebuffers[a].destroy(),delete this.framebuffers[a]},d.prototype.getPostProcessStage=function(a){return this._postProcesses[a]},d.prototype.createPostProcessType=function(a,b,c){return this._postProcessTypes[a]=new SceneJS_PostProcess(this.stats,this._canvas.gl,b,c),this._postProcessTypes[a]},d.prototype.postProcessOpaque=function(a){var b,c;for(a=a||[],a.length>0&&this.initPostProcess(),b=0,c=this.postProcessPipelineOpaque.length;c>b;++b){var d=this.postProcessPipelineOpaque[b];delete this._postProcesses[d.id],d.destroy()}for(this.postProcessPipelineOpaque.length=0,b=0,c=a.length;c>b;++b){var e=a[b],f=e.id;this._postProcesses[f]=new SceneJS_PostProcessStage(this,e),this.postProcessPipelineOpaque.push(this._postProcesses[f])}this.imageDirty=!0},d.prototype.postProcessFinal=function(a){var b,c;for(a=a||[],a.length>0&&this.initPostProcess(),b=0,c=this.postProcessPipelineFinal.length;c>b;++b){var d=this.postProcessPipelineFinal[b];delete this._postProcesses[d.id],d.destroy()}for(this.postProcessPipelineFinal.length=0,b=0,c=a.length;c>b;++b){var e=a[b],f=e.id;this._postProcesses[f]=new SceneJS_PostProcessStage(this,e),this.postProcessPipelineFinal.push(this._postProcesses[f])}this.imageDirty=!0},d.prototype.webglRestored=function(){this._programFactory.webglRestored(),this._chunkFactory.webglRestored();var a=this._canvas.gl;this.pickBuf&&this.pickBuf.webglRestored(a);for(var b in this.framebuffers)this.framebuffers[b].webglRestored(a);for(var c in this._postProcessTypes)this._postProcessTypes[c].webglRestored(a);this.imageDirty=!0},d.prototype.setViewport=function(a,b,c,d){this.viewport[0]=a,this.viewport[1]=b,this.viewport[2]=c,this.viewport[3]=d,this.imageDirty=!0},d.prototype.buildProjectionMatrix=function(){var a=this.projection,b=this.projectionMatrix;if("ortho"==a.type)mat4.ortho(b,a.left,a.right,a.bottom,a.top,a.near,a.far);else if("frustum"==a.type)mat4.frustum(b,a.left,a.right,a.bottom,a.top,a.near,a.far);else if("perspective"==a.type){var c=a.fov;c=Math.min(c,120),mat4.perspective(b,c*Math.PI/180,a.aspect,a.near,a.far)}if(a.pan){var d=a.pan,e=mat4.fromTranslation(mat4.create(),[d.x||0,d.y||0,d.z||0]);mat4.multiply(b,e,b)}},d.prototype.buildViewMatrix=function(){var a=this.camera,b=this.viewMatrix;if(mat4.lookAt(b,a.eye,a.look,a.up),this.hasDeviceMatrix){var c=mat4.create();mat4.multiply(c,this.deviceMatrix,b),b.set(c)}},d.prototype.buildObject=function(a,b){var c=this._objects[a];c||(c=this._objects[a]=new SceneJS_Object(a)),c.modelTransform=this.modelTransform,c.viewMatrix=this.viewMatrix,c.projectionMatrix=this.projectionMatrix,c.texture=this.texture,c.cubemap=this.cubemap,c.geometry=this.geometry,c.morphGeometry=this.morphGeometry,c.properties=this.properties,c.material=this.material,c.fresnel=this.fresnel,c.regionMap=this.regionMap,c.backfaces=b.backfaces,c.addBlend=b.addBlend,c.layer=b.layer;var d=[this.geometry.hash,this.morphGeometry.hash,this.texture.hash,this.fresnel.hash,this.cubemap.hash,this.lightHash,this.clipsHash,this.reflectionsHash,this.lightmapsHash,this.properties.hash,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&c.isPartiallyOpaque()?"pt":"",this.regionMap.hash,this.fogEnabled?"f"+this.fogMode:""].join(";");if(!c.program||d!=c.hash){c.program&&(this._programFactory.putProgram(c.program.draw),this._programFactory.putProgram(c.program.xray),this._programFactory.putProgram(c.program.pick),this._programFactory.putProgram(c.program.pickTriangle),this._programFactory.putProgram(c.program.depth),this._programFactory.putProgram(c.program.drawTexture),SceneJS_ProgramSourceFactory.putSource(c.hash));var e=SceneJS_ProgramSourceFactory.getSource(d,this,c);c.program={draw:this._programFactory.getProgram(d+"-draw",e.drawVertexSrc,e.drawFragmentSrc),xray:this._programFactory.getProgram(d+"-xray",e.xrayVertexSrc,e.xrayFragmentSrc),pick:this._programFactory.getProgram(d+"-pick",e.pickVertexSrc,e.pickFragmentSrc),pickTriangle:this._programFactory.getProgram(d+"-pickTriangle",e.pickTriangleVertexSrc,e.pickTriangleFragmentSrc),depth:this._programFactory.getProgram(d+"-depth",e.depthVertexSrc,e.depthFragmentSrc),drawTexture:this._programFactory.getProgram(d+"-drawTexture",e.drawTextureVertexSrc,e.drawTextureFragmentSrc),id:this._nextProgramId++,gl:this._canvas.gl},c.hash=d,c.sortKey=1e5*(c.program.id+1)+c.texture.stateId}this._setChunk(c,"draw",0,"program"),this._setChunk(c,"draw",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"draw",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(c,"draw",3,"regionMap",[this.regionMap]),this._setChunk(c,"draw",4,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"draw",5,"draw",[this.geometry]),this._setChunk(c,"xray",0,"program"),this._setChunk(c,"xray",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"xray",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"xray",3,"draw",[this.geometry]),this._setChunk(c,"pick",0,"program"),
this._setChunk(c,"pick",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"pick",2,"regionMap",[this.regionMap]),this._setChunk(c,"pick",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"pick",4,"draw",[this.geometry]),this._setChunk(c,"pickTriangle",0,"program"),this._setChunk(c,"pickTriangle",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"pickTriangle",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"pickTriangle",3,"draw",[this.geometry]),this._setChunk(c,"depth",0,"program"),this._setChunk(c,"depth",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"depth",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"depth",3,"draw",[this.geometry]),this._setChunk(c,"drawTexture",0,"program"),this._setChunk(c,"drawTexture",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"drawTexture",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(c,"drawTexture",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"drawTexture",4,"draw",[this.geometry]),this.objectListDirty=!0},d.prototype._setChunk=function(a,b,c,d,e){{var f;this._chunkFactory.chunkTypes[d]}void 0===a.chunkSets[b]&&(a.chunkSets[b]=[]);var g=a.chunkSets[b];if(e){for(var h=!0,i=0,j=e.length;j>i;++i)if(!e[i].empty){h=!1;break}if(h){var k=g[c];return k&&this._chunkFactory.putChunk(k),void(g[c]=null)}f="p"+a.program.id;for(var i=0,j=e.length;j>i;++i)f+="_"+e[i].stateId}else f="p"+a.program.id;f=c+"__"+f;var k=g[c];if(k){if(k.id==f)return;this._chunkFactory.putChunk(k)}g[c]=this._chunkFactory.getChunk(f,d,a.program,e)},d.prototype.removeObject=function(a){var b=this._objects[a];if(b){this._programFactory.putProgram(b.program),b.program=null,b.hash=null;for(var c in b.chunkSets)for(var d,e=b.chunkSets[c],f=0,g=e.length;g>f;f++)d=e[f],d&&this._chunkFactory.putChunk(d);delete this._objects[a],this.objectListDirty=!0}},d.prototype.prepareScene=function(){this.objectListDirty&&(this._buildObjectList(),this.objectListDirty=!1,this.imageDirty=!0)},d.prototype.render=function(a){a=a||{},0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height&&(this.imageDirty||a.force)&&(this._doDrawList({clear:a.clear!==!1,opaqueOnly:a.opaqueOnly,pass:a.pass,custom:a.custom}),this.imageDirty=!1,this.pickBufDirty=!0)},d.prototype._buildObjectList=function(){var c,d=(this._numOpaqueObjects,this._numTransparentObjects,SceneJS.PROPERTY_FLAGS.ENABLED),e=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS);this._numOpaqueObjects=0,this._numTransparentObjects=0;for(c in this._objects){var f=this._objects[c];f.properties.flags&d&&(f.isTransparent()?(this._transparentObjects[this._numTransparentObjects++]=f,e&&f.isPartiallyOpaque()&&(this._opaqueObjects[this._numOpaqueObjects++]=f)):this._opaqueObjects[this._numOpaqueObjects++]=f)}this._opaqueObjects.length=this._numOpaqueObjects,this._opaqueObjects.sort(a),this._transparentObjects.length=this._numTransparentObjects,this._transparentObjects.sort(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ORDER_DEPENDENT?b:a)},function(){var a=vec3.create(),b=vec3.create(),c=mat4.create(),e=mat4.frustum(mat4.create(),-1,1,-1,1,.1,1e4),f=vec3.create(),g=vec3.create(),h=vec3.create(),i=(vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),mat4.create(),mat4.create(),vec4.create(),vec4.create(),vec3.create()),j=(vec3.create(),vec3.create(),vec3.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),function(){var a=mat4.create(),b=mat4.create(),c=mat4.create(),d=vec4.create(),e=vec4.create();return function(f,g,h,i,j){var k=g.modelTransform.matrix,l=g.viewMatrix,m=g.projectionMatrix;mat4.multiply(a,l,k),mat4.multiply(b,m,a),mat4.invert(c,b);var n=f.width,o=f.height,p=(h[0]-n/2)/(n/2),q=-(h[1]-o/2)/(o/2);vec4.transformMat4(d,[p,q,-1,1],c),vec3.scale(d,d,1/d[3]),vec4.transformMat4(e,[p,q,1,1],c),vec3.scale(e,e,1/e[3]),i[0]=d[0],i[1]=d[1],i[2]=d[2],vec3.subtract(j,e,d),vec3.normalize(j,j)}}()),k=function(){var a=mat4.create(),b=vec4.create(),c=vec4.create();return function(d,e,f,g,h){var i=d.modelTransform.matrix;mat4.invert(a,i),b[0]=e[0],b[1]=e[1],b[2]=e[2],b[3]=1,vec4.transformMat4(c,b,a),g[0]=c[0],g[1]=c[1],g[2]=c[2],vec3.transformMat4(h,f,a)}}();d.prototype.pick=function(d){if(!(d.canvasPos||!d.rayPick||d.origin&&d.direction))return void console.warn("Incomplete pick parameters");if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var l=this._canvas.canvas,m=this._canvas.resolutionScaling,n=d.canvasPos;n&&(n=new Float32Array([n[0]*m,n[1]*m]));var o,p,q,r=this.pickBuf,s=null;r||(r=this.pickBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas}));var t,u,v,w,x=!d.canvasPos;if(x){t=d.origin||new Float32Array([0,0,0]),u=d.direction||new Float32Array([0,0,1]);var y=vec3.add(i,t,u),z=new Float32Array([0,1,0]);mat4.lookAt(c,t,y,z),v=.5*l.clientWidth,w=.5*l.clientHeight}else v=n[0],w=n[1];this.prepareScene(),this.render(),r.bind(),r.clear(),this._doDrawList({pickObject:!0,clear:!0,pickViewMatrix:x?c:null,pickProjMatrix:x?e:null}),this._canvas.gl.finish();var A=r.read(v,w),B=A[0]+256*A[1]+256*A[2]*256+256*A[3]*256*256,C=this._pickLookup[B-1];if(C>=0){o=C<this._numOpaqueObjects?this._opaqueObjects[C]:this._transparentObjects[C-this._numOpaqueObjects],s={canvasPos:n,objectId:o.id};var D=o.properties;D&&(s.name=D.name,s.nodeId=D.nodeId)}if(d.pickRegion&&(r.clear(),this._doDrawList({pickRegion:!0,object:o,pickViewMatrix:x?c:null,pickProjMatrix:x?e:null,clear:!0}),A=r.read(v,w),0!==A[0]||0!==A[1]||0!==A[2]||0!==A[3])){s=s||{canvasPos:n};var E,F,G={r:A[0]/255,g:A[1]/255,b:A[2]/255,a:A[3]/255},H=this._frameCtx.regionData,I=.01,J={};for(p=0,q=H.length;q>p;p++)if(E=H[p].color,G&&H[p].data&&(F=Math.max(Math.abs(G.r-E.r),Math.abs(G.g-E.g),Math.abs(G.b-E.b),Math.abs(G.a-(void 0===E.a?G.a:E.a))),I>F)){J=H[p].data;break}s.color=G,s.regionData=J}if(d.pickTriangle&&o){r.clear(),this._doDrawList({pickTriangle:!0,object:o,pickViewMatrix:x?c:null,pickProjMatrix:x?e:null,clear:!0}),A=r.read(v,w);var K=A[0]+256*A[1]+256*A[2]*256+256*A[3]*256*256;K*=3,s.primitiveIndex=K,"triangles"===o.geometry.primitiveName&&(s.primitive="triangle",x?k(o,t,u,a,b):j(l,o,n,a,b),s.indices=vec3.create(),o.getTriangleIndices(K,s.indices),o.getTrianglePositionOnSurface(K,f,g,h),s.position=vec3.create(),SceneJS_math_rayPlaneIntersect(a,b,f,g,h,s.position),s.barycentric=vec3.create(),o.cartesianToBarycentric(K,s.position,s.barycentric),s.normal=vec3.create(),o.normalFromBarycentric(K,s.barycentric,s.normal),s.worldPos=vec3.create(),o.getPointInWorldSpace(s.position,s.worldPos),s.uvs=[],o.uvFromBarycentric(K,s.barycentric,s.uvs),s.uvs.length>0&&(s.uv=s.uvs[0]))}return r.unbind(),s}}}(),d.prototype._doDrawList=function(){function a(a){d[a]||(d[a]=new Int32Array(8));for(var b=d[a],c=0,e=b.length;e>c;++c)b[c]=-1}function b(a,b,c){var e,f=a.gl,g=b.chunkSets[c],h=d[c];a.backfaces!=b.backfaces&&(b.backfaces?f.disable(f.CULL_FACE):f.enable(f.CULL_FACE),a.backfaces=b.backfaces),a.addBlend!=b.addBlend&&(b.addBlend?f.blendFunc(f.ONE,f.ONE):f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA),a.addBlend=b.addBlend);for(var i=0,j=g.length;j>i;i++)e=g[i],e&&(e.unique||h[i]!==e.numericId)&&(e.draw(c,a),h[i]=e.numericId)}var d={},e=new Float32Array(2);return function(d){var f=this._canvas.gl,g=this._frameCtx;g.gl=f,g.pass=d.pass||0,g.targetIndex=0,g.viewMatrix=this.viewMatrix,g.cameraEye=this.camera.eye,g.modelMat=null,g.cameraMat=null,g.projectionMatrix=this.projectionMatrix,g.lights=this.lights,g.clips=this.clips,g.reflection=this.reflections.activeReflection,g.lightmap=this.lightmaps.activeLightmap,g.highlightColor=this.highlightColor,g.desatParams=this.desatParams,g.fogParams=this.fogParams,g.fogColor=this.fogColor,g.fogMode=this.fogMode,g.fogEnabled=this.fogEnabled,g.xrayColor=this.xrayColor,g.scissorTestEnabled=!1,g.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,g.backfaces=!0,g.frontface=SceneJS.PROPERTY_FLAGS.CCW,g.picking=!!d.pickObject||!!d.pickTriangle||!!d.pickRegion,g.pickObject=!!d.pickObject,g.pickTriangle=!!d.pickTriangle,g.pickRegion=!!d.pickRegion,g.pickIndex=1,g.textureUnit=0,g.lineWidth=1,g.transparent=0,g.ambientColor=this._ambientColor,g.canvasResolution=g.canvasResolution||new Float32Array(2),g.canvasResolution[0]=this._canvas.canvas.width,g.canvasResolution[1]=this._canvas.canvas.height,g.aspect=this._canvas.canvas.width/this._canvas.canvas.height,g.texture=null,g.hasNormalMap=!1,g.regionMapUVLayerIdx=-1,g.drawElements=0,g.drawArrays=0,g.useProgram=0,g.bindTexture=0,g.bindArray=0,g.pickViewMatrix=d.pickViewMatrix,g.pickProjMatrix=d.pickProjMatrix,g.discardOpaque=!1,g.outputFormat=0,g.depthBuffer=null,g.addBlend=!1;var h=f.getExtension("OES_vertex_array_object");g.VAO=h?h:null,SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&f.getExtension("OES_standard_derivatives"),f.viewport(this.viewport[0],this.viewport[1],g.canvasResolution[0],g.canvasResolution[1]),f.enable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),f.depthMask(!0),this.transparent||g.picking?f.clearColor(0,0,0,0):f.clearColor(this._ambientColor[0],this._ambientColor[1],this._ambientColor[2],1);var i,j,k;if(d.custom){var l=d.custom.renderMode,m=d.custom.objects;for(a(l),i=0;i<m.length;i++)k=m[i],b(g,k,l)}else if(d.pickObject){a("pick");var n=0;for(d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),i=0,j=this._numOpaqueObjects;j>i;i++)k=this._opaqueObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=i,b(g,k,"pick"));for(i=0,j=this._numTransparentObjects;j>i;i++)k=this._transparentObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=this._numOpaqueObjects+i,b(g,k,"pick"))}else if(d.pickTriangle&&d.object)d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),a("pickTriangle"),b(g,d.object,"pickTriangle");else if(d.pickRegion)if(a("pick"),d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),d.object)b(g,d.object,"pick");else{var n=0;if(d.pickRegion){for(i=0,j=this._numOpaqueObjects;j>i;i++)k=this._opaqueObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=i,b(g,k,"pick"));for(i=0,j=this._numTransparentObjects;j>i;i++)k=this._transparentObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=this._numOpaqueObjects+i,b(g,k,"pick"))}}else{a("draw"),a("xray");var o=(Date.now(),d.opaqueOnly,this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this._numTransparentObjects>0||this.postProcessPipelineOpaque.length>0||this.postProcessPipelineFinal.length>0);for(o&&this.mainFramebuffer.bind(),d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),i=0,j=this._numOpaqueObjects;j>i;i++){var k=this._opaqueObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}o&&this.mainFramebuffer.unbind(),this.postProcessPipelineOpaque.length>0&&(f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE));for(var i=0,j=this.postProcessPipelineOpaque.length;j>i;++i){var p=this.postProcessPipelineOpaque[i];p.framebuffer&&p.framebuffer.bind(),p.draw(g),p.framebuffer&&p.framebuffer.unbind()}if(this.postProcessPipelineOpaque.length>0&&(f.enable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),g.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,g.backfaces=SceneJS.PROPERTY_FLAGS.BACKFACES,g.frontface=SceneJS.PROPERTY_FLAGS.CCW,g.addBlend=!1),this._numTransparentObjects>0){if(a("draw"),a("xray"),o&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.bind(),this.depthSort&&this._transparentObjects.sort(c),g.discardOpaque=!0,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_BLEND){var q=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK);f.enable(f.BLEND),this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA?f.blendFunc(f.ONE,f.ONE):f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA);var r=SceneJS.PROPERTY_FLAGS.NO_DEPTH_MASK;for(q&&f.depthMask(!1),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i],s=!q&&k.properties.flags&r;s&&f.depthMask(!1),k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw"),s&&f.depthMask(!0)}f.disable(f.BLEND),f.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT){for(a("depth"),e[0]=1/g.canvasResolution[0],e[1]=1/g.canvasResolution[1],this.oitDepthBuffer.bind(),f.clear(f.DEPTH_BUFFER_BIT),f.colorMask(!1,!1,!1,!1),i=0;i<this._numTransparentObjects;i++)b(g,this._transparentObjects[i],"depth");for(f.colorMask(!0,!0,!0,!0),this.oitDepthBuffer.unbind(),f.clearColor(0,0,0,1),f.enable(f.BLEND),f.blendFuncSeparate(f.ONE,f.ONE,f.ZERO,f.ONE_MINUS_SRC_ALPHA),f.depthMask(!1),this.oitAccumulateFramebuffer.bind(),f.clear(f.COLOR_BUFFER_BIT),g.outputFormat=1,g.depthBuffer=this.oitDepthBuffer.getDepthTarget(),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}this.oitAccumulateFramebuffer.unbind(),f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),this.mainFramebuffer.bind(),f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA),this.oitPostprocess.setUniform("uTexelOffset",e),this.oitPostprocess.draw(g),this.mainFramebuffer.unbind(),f.disable(f.BLEND),f.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE){for(f.enable(f.SAMPLE_ALPHA_TO_COVERAGE),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}f.disable(f.SAMPLE_ALPHA_TO_COVERAGE)}o&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.unbind()}if(o)if(f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),this.postProcessPipelineFinal.length>0)for(var i=0,j=this.postProcessPipelineFinal.length;j>i;++i){var p=this.postProcessPipelineFinal[i];p.framebuffer&&p.framebuffer.bind(),p.draw(g),p.framebuffer&&p.framebuffer.unbind()}else this.blitPostprocess.draw(g);{Date.now()}this.stats.frame.drawElements=g.drawElements,this.stats.frame.drawArrays=g.drawArrays,this.stats.frame.useProgram=g.useProgram,this.stats.frame.bindTexture=g.bindTexture,this.stats.frame.bindArray=g.bindArray,this.stats.frame.drawChunks=this._drawListLen}if(g.VAO)for(g.VAO.bindVertexArrayOES(null),i=0;10>i;i++)f.disableVertexAttribArray(i)}}(),d.prototype.readPixels=function(a,b,c){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){this._readPixelBuf||(this._readPixelBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas})),this._readPixelBuf.bind(),this._readPixelBuf.clear(),this.prepareScene(),this.render({force:!0,opaqueOnly:c});for(var d,e,f=0;b>f;f++)d=a[f]||(a[f]={}),e=this._readPixelBuf.read(d.x,d.y),d.r=e[0],d.g=e[1],d.b=e[2],d.a=e[3];this._readPixelBuf.unbind()}},d.prototype.destroy=function(){this._programFactory.destroy()}}(),function(){"use strict";var a=SceneJS.DISPLAY_FLAGS,b=SceneJS.TEXTURE_FLAGS,c=SceneJS.CUBEMAP_FLAGS,d=SceneJS.PROPERTY_FLAGS,e=SceneJS.COLOR_MOD_FLAGS,f="highp"===SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION,g=SceneJS.WEBGL_INFO.textureLODSupported;window.SceneJS_ProgramSourceFactory=new function(){function h(){for(var a=G.properties.colorModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isScalarFresnel)return!0;return!1}function i(){for(var a=G.properties.colorModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isColorFresnel)return!0;return!1}function j(){for(var a=G.properties.opacityModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isScalarFresnel)return!0;return!1}function k(a){return D(),E("attribute vec4 SCENEJS_aVertex;"),a&&(E("attribute vec4 SCENEJS_aTriColor;"),E("varying vec4 SCENEJS_vTriColor;")),E("uniform mat4 SCENEJS_uMMatrix;"),E("uniform mat4 SCENEJS_uVMatrix;"),E("uniform mat4 SCENEJS_uPMatrix;"),ga&&(E("uniform float SCENEJS_uPointSize;"),ja&&E("attribute vec2 SCENEJS_aPointScaleRotation;")),la&&E("uniform mat4 SCENEJS_uDecodePositionMatrix;"),E("varying vec4 SCENEJS_vWorldVertex;"),ea&&(E("attribute vec2 SCENEJS_aRegionMapUV;"),E("varying vec2 SCENEJS_vRegionMapUV;")),da&&(E("uniform float SCENEJS_uMorphFactor;"),G.morphGeometry.targets[0].vertexBuf&&E("attribute vec4 SCENEJS_aMorphVertex;"),la&&E("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),E("void main(void) {"),E(la?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),da&&G.morphGeometry.targets[0].vertexBuf&&E(la?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),E("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),E("mat4 vPosMatrix = SCENEJS_uVMatrix;"),$&&E("vPosMatrix[3].xyz = vec3(0.0);"),E("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),E("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),ea&&E("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),a&&E("SCENEJS_vTriColor = SCENEJS_aTriColor;"),ga&&(E("gl_PointSize = SCENEJS_uPointSize;"),ia&&E("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),ja&&E("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),E("gl_PointSize = min(gl_PointSize, "+Ea+");")),E("}"),F()}function l(a){if(D(),E("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),E("varying vec4 SCENEJS_vWorldVertex;"),a?E("varying vec4  SCENEJS_vTriColor;"):(E("uniform float  SCENEJS_uPickMode;"),E("uniform vec4  SCENEJS_uPickColor;")),ca)for(var b=0;b<G.clips.clips.length;b++)E("uniform vec4  SCENEJS_uClipNormalAndDist"+b+";"),G.clips.clips[b].fade&&E("uniform float SCENEJS_uClipFadeDistance"+b+";");if(ea&&(E("varying vec2 SCENEJS_vRegionMapUV;"),E("uniform sampler2D SCENEJS_uRegionMapSampler;")),E("void main(void) {"),ca){G.clips.clipDiscard&&E("float distOff = 0.0;"),G.clips.clipFade&&E("float distAlpha = 0.0;");for(var b=0;b<G.clips.clips.length;b++)E(G.clips.clips[b].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w) / SCENEJS_uClipFadeDistance"+b+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w);");G.clips.clipDiscard&&E("if (distOff > 0.0) { discard; }"),G.clips.clipFade&&E("if (distAlpha > 1.0) { discard; }")}return a?E("gl_FragColor = SCENEJS_vTriColor;  "):(E("    if  (SCENEJS_uPickMode == 0.0) {"),E("          gl_FragColor = SCENEJS_uPickColor;  "),E("    } else {"),E(ea?"          gl_FragColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t));":"          gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"),E("    }")),E("}"),F()}function m(){D(),E("attribute vec4 SCENEJS_aVertex;"),E("uniform mat4 SCENEJS_uMMatrix;"),E("uniform mat4 SCENEJS_uVMatrix;"),E("uniform mat4 SCENEJS_uPMatrix;"),la&&E("uniform mat4 SCENEJS_uDecodePositionMatrix;");var a=0,b=null,c=null;return T&&(c=G.texture.layers[G.texture.drawLayerIndex],c&&(a=c.uvLayerIdx||0),G.geometry.uvBufs&&(b=G.geometry.uvBufs[a]),b&&(E("varying vec2 SCENEJS_vUVCoord"+a+";"),E("attribute vec2 SCENEJS_aUVCoord"+a+";"),na&&E("uniform mat3 SCENEJS_uDecodeUVMatrix"+a+";"))),E("varying vec4 SCENEJS_vWorldVertex;"),da&&(E("uniform float SCENEJS_uMorphFactor;"),G.morphGeometry.targets[0].vertexBuf&&E("attribute vec4 SCENEJS_aMorphVertex;"),la&&E("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),E("void main(void) {"),E(la?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),da&&G.morphGeometry.targets[0].vertexBuf&&E(la?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),E("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),E("mat4 vPosMatrix = SCENEJS_uVMatrix;"),E("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),E("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),T&&b&&E(na?"SCENEJS_vUVCoord"+a+" = (SCENEJS_uDecodeUVMatrix"+a+" * vec3(SCENEJS_aUVCoord"+a+", 1.0)).xy;":"SCENEJS_vUVCoord"+a+" = SCENEJS_aUVCoord"+a+";"),E("}"),F()}function n(){D(),E("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;");var a=0,b=null,c=null;return T&&(c=G.texture.layers[G.texture.drawLayerIndex],c&&(a=c.uvLayerIdx||0),G.geometry.uvBufs&&(b=G.geometry.uvBufs[a]),b&&(E("uniform sampler2D SCENEJS_uDrawSampler;"),E("varying vec2 SCENEJS_vUVCoord"+a+";"))),E("void main(void) {"),E("vec4 color = vec4(0.0);"),T&&b&&c&&(E("vec2 textureCoord;"),E("textureCoord = SCENEJS_vUVCoord"+a+";"),c.compressed&&E("   textureCoord.y = 1.0 - textureCoord.y;"),E("if(textureCoord.x != -1.0) {"),E("   color = texture2D(SCENEJS_uDrawSampler, textureCoord);"),E("}")),E("gl_FragColor = color;"),E("}"),F()}function o(){return G.regionMap.empty?!1:q()}function p(){return G.texture.layers&&G.texture.layers.length>0?q():!1}function q(){return"points"===G.geometry.primitiveName?!0:G.geometry.uvBufs?!0:G.morphGeometry.targets&&(G.morphGeometry.targets[0].uvBuf||G.morphGeometry.targets[0].uvBuf2)?!0:!1}function r(a){if(!a.properties.getFlag(d.REFLECTIVE))return!1;if(!a.geometry.normalBuf)return!1;if(!a.cubemap.layers)return!1;for(var b=0,e=a.cubemap.layers.length;e>b;b++)if(a.cubemap.layers[b].applyTo===c.reflect)return!0;return!1}function s(a){if(!a.geometry.normalBuf)return!1;if(!a.cubemap.layers)return!1;for(var b=0,d=a.cubemap.layers.length;d>b;b++)if(a.cubemap.layers[b].applyTo===c.light)return!0;return!1}function t(a){return a.material.workflow!==SceneJS.Material.METALLIC?!1:a.properties.getFlag(d.REFLECTIVE)&&a.geometry.normalBuf&&a.reflections.activeReflection?!0:!1}function u(a){return a.material.workflow!==SceneJS.Material.METALLIC?!1:a.geometry.normalBuf&&a.lightmaps.activeLightmap?!0:!1}function v(a){return a.geometry.normalBuf?!0:a.morphGeometry.targets&&a.morphGeometry.targets[0].normalBuf?!0:!1}function w(a){if(a.texture){var c=a.texture.layers;if(!c)return!1;for(var d=0,e=c.length;e>d;d++)if(c[d].flags&b.normals)return!0}return!1}function x(){var a,b;if(D(),E("uniform mat4 SCENEJS_uMMatrix;"),E(f?"uniform mat4 SCENEJS_uVMatrix;":"uniform mediump mat4 SCENEJS_uVMatrix;"),E("uniform mat4 SCENEJS_uPMatrix;"),E("attribute vec4 SCENEJS_aVertex;"),E(f?"uniform vec3 SCENEJS_uWorldEye;":"uniform mediump vec3 SCENEJS_uWorldEye;"),E("varying vec3 SCENEJS_vViewEyeVec;"),ga&&(E("uniform float SCENEJS_uPointSize;"),ja&&(E("attribute vec2 SCENEJS_aPointScaleRotation;"),E("varying float SCENEJS_vPointRotation;")),ka&&(E("attribute vec2 SCENEJS_aPointUVTranslate;"),E("varying vec2 SCENEJS_vPointUVTranslate;"))),la&&E("uniform mat4 SCENEJS_uDecodePositionMatrix;"),Y&&(E("attribute vec3 SCENEJS_aNormal;"),E("uniform   mat4 SCENEJS_uMNMatrix;"),E("varying   vec3 SCENEJS_vViewNormal;"),(U||V||W||X)&&E("varying   vec3 SCENEJS_vWorldNormal;"),aa&&!ba&&(E("attribute vec3 SCENEJS_aTangent;"),E("varying   vec3 SCENEJS_vTangent;"))),T&&(b=G.geometry.uvBufs))for(var a=0,c=b.length;c>a;a++)b[a]&&(E("attribute vec2 SCENEJS_aUVCoord"+a+";"),na&&E("uniform mat3 SCENEJS_uDecodeUVMatrix"+a+";"));if(G.geometry.colorBuf&&(E("attribute vec4 SCENEJS_aVertexColor;"),E("varying vec4 SCENEJS_vColor;")),(ca||Y||qa||wa)&&E("varying vec4 SCENEJS_vWorldVertex;"),Aa&&E("varying vec4 SceneJS_vModelVertex;"),E("varying vec4 SCENEJS_vViewVertex;"),T&&(b=G.geometry.uvBufs))for(a=0,c=b.length;c>a;a++)b[a]&&E("varying vec2 SCENEJS_vUVCoord"+a+";");if(fa&&(E("attribute vec2 SCENEJS_aRegionMapUV;"),E("varying vec2 SCENEJS_vRegionMapUV;")),da&&(E("uniform float SCENEJS_uMorphFactor;"),G.morphGeometry.targets[0].vertexBuf&&E("attribute vec4 SCENEJS_aMorphVertex;"),Y&&G.morphGeometry.targets[0].normalBuf&&E("attribute vec3 SCENEJS_aMorphNormal;"),aa&&!ba&&E("attribute vec3 SCENEJS_aMorphTangent;"),la&&E("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),_&&(E("void billboard(inout mat4 mat) {"),E("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),E("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),E("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),E("}")),ma&&(E("vec3 octDecode(vec2 oct) {"),E("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),E("    if (v.z < 0.0) {"),E("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),E("    }"),E("    return normalize(v);"),E("}")),E("void main(void) {"),aa&&!ba&&E("vec3 modelTangent = SCENEJS_aTangent;"),E(la?"  vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"  vec4 modelVertex = SCENEJS_aVertex; "),ma?E("  vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):Y&&E("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),da&&(G.morphGeometry.targets[0].vertexBuf&&E(la?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),Y&&G.morphGeometry.targets[0].normalBuf&&E(ma?"  modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"  modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); "),aa&&!ba&&E("  modelTangent = mix(modelTangent, SCENEJS_aMorphTangent, SCENEJS_uMorphFactor); ")),Aa&&E("SceneJS_vModelVertex = modelVertex;;"),E("mat4 modelMatrix = SCENEJS_uMMatrix;"),E("mat4 viewMatrix = SCENEJS_uVMatrix;"),Y&&E("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),E("vec4 worldVertex;"),E("vec4 viewVertex;"),$&&E("viewMatrix[3].xyz = vec3(0.0);"),_?(E("   mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),E("   billboard(modelMatrix);"),E("   billboard(viewMatrix);"),E("   billboard(modelViewMatrix);"),Y&&E("   billboard(modelNormalMatrix);"),E("   worldVertex = modelMatrix * modelVertex;"),E("   viewVertex = modelViewMatrix * modelVertex;")):(E("  worldVertex = modelMatrix * modelVertex;"),E("  viewVertex  = viewMatrix * worldVertex; ")),Y&&(E("  vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),E("  SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;"),(U||V||W||X)&&E("SCENEJS_vWorldNormal = worldNormal;")),(ca||Y||qa||wa)&&E("  SCENEJS_vWorldVertex = worldVertex;"),E("  SCENEJS_vViewVertex = viewVertex;"),E("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),aa&&!ba&&E("SCENEJS_vTangent = modelTangent;"),E("SCENEJS_vViewEyeVec = ((viewMatrix * vec4(SCENEJS_uWorldEye, 1.0)).xyz  - viewVertex.xyz);"),T&&(b=G.geometry.uvBufs))for(a=0,c=b.length;c>a;a++)b[a]&&E(na?"SCENEJS_vUVCoord"+a+" = (SCENEJS_uDecodeUVMatrix"+a+" * vec3(SCENEJS_aUVCoord"+a+", 1.0)).xy;":"SCENEJS_vUVCoord"+a+" = SCENEJS_aUVCoord"+a+";");return G.geometry.colorBuf&&E("SCENEJS_vColor = SCENEJS_aVertexColor;"),fa&&E("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),ga&&(E("gl_PointSize = SCENEJS_uPointSize;"),ia&&E("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),ja&&(E("SCENEJS_vPointRotation = SCENEJS_aPointScaleRotation.y;"),E("gl_PointSize *= SCENEJS_aPointScaleRotation.x;")),ka&&E("SCENEJS_vPointUVTranslate = SCENEJS_aPointUVTranslate;"),E("gl_PointSize = min(gl_PointSize, "+Ea+");")),E("}"),F()}function y(){var c=G.fresnel.diffuse,d=G.fresnel.specular,f=G.fresnel.alpha,h=G.fresnel.transparency,i=G.fresnel.reflect,j=G.fresnel.emit,k=G.fresnel.fragment,l=J;if(D(),(aa&&ba||Aa)&&E("#extension GL_OES_standard_derivatives : enable"),g&&E("#extension GL_EXT_shader_texture_lod : enable"),Ba&&E(Ba),E("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),E("uniform sampler2D SCENEJS_uDepthBuffer;"),E("uniform vec2 SCENEJS_uCanvasRes;"),(J||K)&&(E("vec4 sRGBToLinear( in vec4 value ) {"),E("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),E("}")),za&&E("uniform bool SCENEJS_uDiscardOpaque;"),Aa&&(E("float hash(vec2 v) {"),E("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),E("}"),E("float hash3D(vec3 v) {"),E("    return hash(vec2(hash(v.xy), v.z));"),E("}")),J&&(E("#define PI 3.14159265359"),E("#define RECIPROCAL_PI 0.31830988618"),E("#define RECIPROCAL_PI2 0.15915494"),E("#define EPSILON 1e-6"),E("#define saturate(a) clamp( a, 0.0, 1.0 )"),E("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),E("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),E("}"),E("struct IncidentLight {"),E("   vec3 color;"),E("   vec3 direction;"),E("};"),E("struct ReflectedLight {"),E("   vec3 diffuse;"),E("   vec3 specular;"),E("};"),E("struct Geometry {"),E("   vec3 position;"),E("   vec3 viewNormal;"),E("   vec3 worldNormal;"),E("   vec3 viewEyeDir;"),E("};"),E("struct Material {"),E("   vec3    diffuseColor;"),E("   float   specularRoughness;"),E("   vec3    specularColor;"),E("   float   shine;"),E("};"),X&&(E("void computePBRLightMapping(const in samplerCube lightMap, const in float intensity, const in vec3 normal, const in Material material, inout ReflectedLight reflectedLight) {"),E("   reflectedLight.diffuse += (sRGBToLinear(textureCube(lightMap, normal)).rgb * PI) * (RECIPROCAL_PI * material.diffuseColor) * intensity;"),E("}")),W&&(E("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),E("   float r = ggxRoughness + 0.0001;"),E("   return (2.0 / (r * r) - 2.0);"),E("}"),E("float getSpecularMIPLevel(const in float blinnShininessExponent, float maxMipLevels) {"),E("   float desiredMIPLevel = maxMipLevels - 0.79248 - 0.5 * log2( (blinnShininessExponent * blinnShininessExponent) + 1.0 );"),E("   return clamp( desiredMIPLevel, 0.0, maxMipLevels );"),E("}"),E("vec3 getLightProbeIndirectRadiance(const in samplerCube reflectMap, const in vec3 reflectVec, const in float blinnShininessExponent, float maxMipLevels) {"),E("   float mipLevel = getSpecularMIPLevel(blinnShininessExponent, maxMipLevels);"),E(g?"   vec3 envMapColor = sRGBToLinear(textureCubeLodEXT(reflectMap, reflectVec, mipLevel)).rgb;":"   vec3 envMapColor = sRGBToLinear(textureCube(reflectMap, reflectVec, mipLevel)).rgb;"),E("   return envMapColor;"),E("}"),E("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),E("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),E("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),E("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),E("   vec4 r = roughness * c0 + c1;"),E("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),E("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),E("   return specularColor * AB.x + AB.y;"),E("}"),E("void computePBRReflectionMapping(const in samplerCube reflectMap, const in float intensity, const in mat4 viewMatrix, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight, float maxMipLevel) {"),E("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),E("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),E("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),E("   vec3 radiance               = getLightProbeIndirectRadiance(reflectMap, reflectVec, blinnExpFromRoughness, maxMipLevel);"),E("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),E("   reflectedLight.specular     += radiance * specularBRDFContrib * intensity;"),E("}")),E("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),E("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),E("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),E("}"),E("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),
E("   float a2 = alpha * alpha;"),E("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),E("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),E("   return 1.0 / ( gl * gv );"),E("}"),E("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),E("   float a2 = ( alpha * alpha );"),E("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),E("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),E("   return 0.5 / max( gv + gl, EPSILON );"),E("}"),E("float D_GGX(const in float alpha, const in float dotNH) {"),E("   float a2 = ( alpha * alpha );"),E("   float denom = ( dotNH * dotNH ) * ( a2 - 1.0 ) + 1.0;"),E("   return RECIPROCAL_PI * a2 / ( denom * denom );"),E("}"),E("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),E("   float alpha = ( roughness * roughness );"),E("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),E("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),E("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),E("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),E("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),E("   vec3  F = F_Schlick( specularColor, dotLH );"),E("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),E("   float D = D_GGX( alpha, dotNH );"),E("   return F * (G * D);"),E("}"),E("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),E("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),E("   vec3 irradiance = dotNL * incidentLight.color * PI;"),E("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),E("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),E("}")),(ca||Y||qa||wa)&&E("varying vec4 SCENEJS_vWorldVertex;"),Aa&&E("varying vec4 SceneJS_vModelVertex;"),E("varying vec4 SCENEJS_vViewVertex;"),G.geometry.colorBuf&&E("varying vec4 SCENEJS_vColor;"),T){aa&&(ba?(E("vec3 perturbNormal2Arb( sampler2D sampler, vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),E("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),E("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),E("      vec2 st0 = dFdx( uv.st );"),E("      vec2 st1 = dFdy( uv.st );"),E("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),E("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),E("      vec3 N = normalize( surf_norm );"),E("      vec3 mapN = texture2D( sampler, uv ).xyz * 2.0 - 1.0;"),E("      mat3 tsn = mat3( S, T, N );"),E("      return normalize( tsn * mapN );"),E("}")):E("varying vec3 SCENEJS_vTangent;"));var m=G.geometry.uvBufs;if(m)for(var n=0,o=m.length;o>n;n++)m[n]&&E("varying vec2 SCENEJS_vUVCoord"+n+";")}if(E("uniform mat4 SCENEJS_uVMatrix;"),E("uniform mat4 SCENEJS_uMMatrix;"),E("uniform vec3 SCENEJS_uWorldEye;"),E("varying vec3 SCENEJS_vViewEyeVec;"),E("uniform vec4  SCENEJS_uMaterialColor;"),E("uniform vec4  SCENEJS_uMaterialEmitColor;"),T)for(var n=0,o=G.texture.layers.length;o>n;n++){var p=G.texture.layers[n];E("uniform sampler2D SCENEJS_uSampler"+n+";"),p.matrix&&E("uniform mat4 SCENEJS_uLayer"+n+"Matrix;"),E("uniform float SCENEJS_uLayer"+n+"BlendFactor;")}if((c||d||f||h||j||k||i||ta||ua||va)&&(Fa.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),Fa.push("    float fr = abs(dot(eyeDir, normal));"),Fa.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),Fa.push("    return pow(finalFr, power);"),Fa.push("}"),c&&(E("uniform vec4 SCENEJS_uDiffuseFresnelCenterColor;"),E("uniform vec4 SCENEJS_uDiffuseFresnelEdgeColor;"),E("uniform float SCENEJS_uDiffuseFresnelPower;")),d&&(E("uniform vec4 SCENEJS_uSpecularFresnelCenterColor;"),E("uniform vec4 SCENEJS_uSpecularFresnelEdgeColor;"),E("uniform float SCENEJS_uSpecularFresnelPower;")),f&&(E("uniform vec4 SCENEJS_uAlphaFresnelCenterColor;"),E("uniform vec4 SCENEJS_uAlphaFresnelEdgeColor;"),E("uniform float SCENEJS_uAlphaFresnelPower;")),h&&(E("uniform vec4 SCENEJS_uTransparencyFresnelCenterColor;"),E("uniform vec4 SCENEJS_uTransparencyFresnelEdgeColor;"),E("uniform float SCENEJS_uTransparencyFresnelPower;")),i&&(E("uniform vec4 SCENEJS_uReflectFresnelCenterColor;"),E("uniform vec4 SCENEJS_uReflectFresnelEdgeColor;"),E("uniform float SCENEJS_uReflectFresnelPower;")),j&&(E("uniform vec4 SCENEJS_uEmitFresnelCenterColor;"),E("uniform vec4 SCENEJS_uEmitFresnelEdgeColor;"),E("uniform float SCENEJS_uEmitFresnelPower;")),k&&(E("uniform vec4 SCENEJS_uFragmentFresnelCenterColor;"),E("uniform vec4 SCENEJS_uFragmentFresnelEdgeColor;"),E("uniform float SCENEJS_uFragmentFresnelPower;"))),I&&(E("uniform vec3  SCENEJS_uAmbientColor;"),E("uniform vec4  SCENEJS_uMaterialSpecularColor;"),E("uniform float SCENEJS_uMaterialShine;")),J&&E("uniform vec4 SCENEJS_uMetalRoughSpecularf0;"),Y){if(E("uniform vec2  SCENEJS_uXrayParams;"),U||V)for(var n=0,o=G.cubemap.layers.length;o>n;n++){var p=G.cubemap.layers[n];E("uniform samplerCube SCENEJS_uCubeMapSampler"+n+";"),E("uniform float SCENEJS_uCubeMapIntensity"+n+";"),E("uniform float SCENEJS_uCubeMapMipLevels"+n+";")}W&&(E("uniform samplerCube SCENEJS_uPBRReflectionMapSampler;"),E("uniform float SCENEJS_uPBRReflectionMapIntensity;"),E("uniform float SCENEJS_uPBRReflectionMapMipLevels;")),X&&(E("uniform samplerCube SCENEJS_uPBRLightMapSampler;"),E("uniform float SCENEJS_uPBRLightMapIntensity;"),E("uniform float SCENEJS_uPBRLightMapMipLevels;")),E("varying vec3 SCENEJS_vViewNormal;"),(U||V||W||X)&&E("varying vec3 SCENEJS_vWorldNormal;");for(var n=0;n<G.lights.length;n++){var q=G.lights[n];E("uniform vec3  SCENEJS_uLightColor"+n+";"),"dir"==q.mode&&E("uniform vec3 SCENEJS_uLightDir"+n+";"),"point"==q.mode&&(E("uniform vec3  SCENEJS_uLightAttenuation"+n+";"),E("uniform vec3 SCENEJS_uLightPos"+n+";")),"spot"==q.mode&&(E("uniform vec3  SCENEJS_uLightAttenuation"+n+";"),E("uniform vec3 SCENEJS_uLightPos"+n+";"),E("uniform vec3 SCENEJS_uLightDir"+n+";"),E("uniform float SCENEJS_uInnerCone"+n+";"),E("uniform float SCENEJS_uOuterCone"+n+";"))}}if(ra){var r,s=0,t=G.properties.colorModifiers,o=t.length;for(s=0;o>s;s++)r=t[s],r.value.isColorFresnel||r.value.isScalarFresnel?(E("uniform vec4 SCENEJS_uColorModFresnelEdge"+s+";"),E("uniform vec4 SCENEJS_uColorModFresnelCenter"+s+";"),E("uniform float SCENEJS_uColorModFresnelPower"+s+";")):E(r.applyTo===e.TINT?"uniform vec3 SCENEJS_uColorModification"+s+";":"uniform float SCENEJS_uColorModification"+s+";"),r.range&&(E("uniform vec3 SCENEJS_uColorModCenter"+s+";"),E("uniform vec2 SCENEJS_uColorModRadius"+s+";"))}if(xa){var u,v=0,w=G.properties.opacityModifiers,o=w.length;for(v=0;o>v;v++)u=w[v],u.value.isScalarFresnel?(E("uniform vec4 SCENEJS_uOpacityModFresnelEdge"+v+";"),E("uniform vec4 SCENEJS_uOpacityModFresnelCenter"+v+";"),E("uniform float SCENEJS_uOpacityModFresnelPower"+v+";")):E("uniform float SCENEJS_uOpacityModification"+v+";"),u.range&&(E("uniform vec3 SCENEJS_uOpacityModCenter"+v+";"),E("uniform vec2 SCENEJS_uOpacityModRadius"+v+";"))}if(oa&&(E("uniform vec4   SCENEJS_uFogParams;"),E("uniform vec4   SCENEJS_uFogColor;")),fa&&(E("varying vec2 SCENEJS_vRegionMapUV;"),E("uniform sampler2D SCENEJS_uRegionMapSampler;"),E("uniform vec3 SCENEJS_uRegionMapRegionColor;"),E("uniform vec3 SCENEJS_uRegionMapHighlightFactor;"),E("uniform float SCENEJS_uRegionMapHideAlpha;")),ca){Z&&E("uniform vec3  SCENEJS_uSolidColor;");for(var n=0;n<G.clips.clips.length;n++)E("uniform vec4  SCENEJS_uClipNormalAndDist"+n+";"),G.clips.clips[n].fade&&E("uniform float SCENEJS_uClipFadeDistance"+n+";")}if(E("uniform float SCENEJS_uOutputFormat;"),E("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),ga&&(ja&&E("varying float SCENEJS_vPointRotation;"),ka&&(E("uniform vec2 SCENEJS_uPointUVScale;"),E("varying vec2 SCENEJS_vPointUVTranslate;"))),l&&(Fa.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),Fa.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),Fa.push("}")),E("void main(void) {"),ca){G.clips.clipDiscard&&E("float distOff = 0.0;"),G.clips.clipFade&&E("float distAlpha = 0.0;");for(var n=0;n<G.clips.clips.length;n++)E(G.clips.clips[n].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+n+".xyz) + SCENEJS_uClipNormalAndDist"+n+".w) / SCENEJS_uClipFadeDistance"+n+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+n+".xyz) + SCENEJS_uClipNormalAndDist"+n+".w);");G.clips.clipDiscard&&E("if (distOff > 0.0) { discard; }"),G.clips.clipFade&&E("if (distAlpha > 1.0) { discard; }"),Z&&(E("if (gl_FrontFacing == false) {"),E("   gl_FragColor = vec4(SCENEJS_uSolidColor, 1.0);"),E("   return;"),E("}"))}if(ga&&ha&&(E("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),E("float r = dot(cxy, cxy);"),E("if (r > 1.0) {"),E("   discard;"),E("}")),Y&&E("vec3 worldEyeVec = normalize(SCENEJS_uWorldEye - SCENEJS_vWorldVertex.xyz);"),G.geometry.colorBuf?(E("  vec3  color   = SCENEJS_vColor.rgb;"),E("  float colorAlpha  = SCENEJS_vColor.a;")):E("  vec3  color   = SCENEJS_uMaterialColor.rgb;"),E("  float alpha = SCENEJS_uMaterialColor.a;"),E("  float emit          = SCENEJS_uMaterialEmitColor.a;"),E("  vec3  emitColor     = SCENEJS_uMaterialEmitColor.rgb;"),E("  float occlusion     = 1.0;"),G.geometry.colorBuf&&E("alpha *= colorAlpha;"),E("float transparency  = 1.0 - alpha;"),I&&(E("  vec3  ambientColor  = SCENEJS_uAmbientColor;"),E("  float specular      = SCENEJS_uMaterialSpecularColor.a;"),E("  vec3  specularColor = SCENEJS_uMaterialSpecularColor.rgb;"),E("  float shine         = SCENEJS_uMaterialShine;")),J&&(E("  vec3  ambientColor  = vec3(0.2, 0.2, 0.2);"),E("  float metallic      = SCENEJS_uMetalRoughSpecularf0.r;"),E("  float roughness     = SCENEJS_uMetalRoughSpecularf0.g;"),E("  float specularF0    = SCENEJS_uMetalRoughSpecularf0.b;")),Y&&(E("float attenuation = 1.0;"),E(aa?"vec3 viewNormalVec = vec3(0.0, 0.0, 0.0);":"vec3 viewNormalVec = normalize(SCENEJS_vViewNormal);"),E("vec3 viewEyeVec = normalize(SCENEJS_vViewEyeVec);"),E("  float glassfactor = SCENEJS_uXrayParams.x;"),E("  float murkiness = SCENEJS_uXrayParams.y;"),E("if (transparency > 0.0) {"),E("  alpha = 1.0 - transparency;"),E("  float gf = (glassfactor  * (murkiness - abs(dot(SCENEJS_vViewNormal, vec3(0.0, 0.0, -1.0)))));"),E("  alpha = max(alpha, gf);"),E("  transparency = 1.0 - alpha;"),E("}")),Y&&aa&&!ba&&(E("mat3 mat =  mat3(SCENEJS_uVMatrix * SCENEJS_uMMatrix);"),E("vec3 n = normalize(SCENEJS_vViewNormal);"),E("vec3 t = normalize(mat * SCENEJS_vTangent);"),E("vec3 b = normalize(cross(SCENEJS_vViewNormal, mat * SCENEJS_vTangent));"),E("mat3 TBN = mat3(t, b, n);")),T){E("vec2 textureCoord;");var x=!0,y=!0,z=!0,A=!0,B=!0,C=!0,H=!0,L=!0,M=!0;ga&&(E("vec2 pointCoord = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);"),E("vec2 centerCoord = vec2(0.5);"),ka&&(E("centerCoord = SCENEJS_vPointUVTranslate + SCENEJS_uPointUVScale * 0.5;"),E("pointCoord = pointCoord * SCENEJS_uPointUVScale + SCENEJS_vPointUVTranslate;")),ja&&(E("vec2 pivot = pointCoord - centerCoord;"),E("float c = cos(SCENEJS_vPointRotation);"),E("float s = sin(SCENEJS_vPointRotation);"),E("pointCoord.x = c * pivot.x + s * pivot.y + centerCoord.x;"),E("pointCoord.y = c * pivot.y - s * pivot.x + centerCoord.y;")));for(var n=0,o=G.texture.layers.length;o>n;n++){var p=G.texture.layers[n],N=p.uvLayerIdx||0,m=G.geometry.uvBufs;if(m&&m[N])E("textureCoord = SCENEJS_vUVCoord"+N+";");else{if(!ga){SceneJS.log.warn("Texture layer applyTo='uv' but geometry has no UV coordinates for layer "+N);continue}E("textureCoord = pointCoord;")}if(p.matrix&&E("textureCoord=(SCENEJS_uLayer"+n+"Matrix * vec4(textureCoord, 1.0, 1.0)).xy;"),p.compressed&&E("textureCoord.y = 1.0 - textureCoord.y;"),p.flags&b.alpha&&(x?(E("transparency = mix(transparency, 1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),x=!1):p.flags&b.multiply?(E("alpha = 1.0 - transparency;"),E("alpha *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"),E("transparency = 1.0 - alpha;")):p.flags&b.add?(E("alpha = 1.0 - transparency;"),E("alpha += SCENEJS_uLayer"+n+"BlendFactor * (texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"),E("transparency = 1.0 - alpha;")):p.flags&b.over&&(E("alpha = 1.0 - transparency;"),E("alpha = mix(alpha, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),E("transparency = 1.0 - alpha;"))),p.flags&b.transparency&&(x?(E("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),x=!1):p.flags&b.multiply?E("transparency *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("transparency += SCENEJS_uLayer"+n+"BlendFactor * (texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.over&&E("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.occlusion&&(z?(E("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),z=!1):p.flags&b.multiply?E("occlusion *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("occlusion += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).r;"):p.flags&b.over&&E("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);")),I&&(K?(p.flags&b.baseColor&&(y?(E("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),y=!1):p.flags&b.multiply?E("color *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb);"):p.flags&b.add?E("color += SCENEJS_uLayer"+n+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb;"):p.flags&b.over&&E("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.emit&&(A?(E("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),A=!1):p.flags&b.multiply?E("emitColor *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb);"):p.flags&b.add?E("emitColor += SCENEJS_uLayer"+n+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb;"):p.flags&b.over&&E("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);"))):(p.flags&b.baseColor&&(y?(p.flags&b.conditionalAlpha?(E("if(textureCoord.x != -1.0) {"),E("   vec4 color"+n+" = texture2D(SCENEJS_uSampler"+n+", textureCoord);"),E("   color = mix(color, color"+n+".rgb, color"+n+".a * SCENEJS_uLayer"+n+"BlendFactor);"),E("}")):E("color = mix(color, texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),y=!1):p.flags&b.multiply?E("color *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb);"):p.flags&b.add?E("color += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb;"):p.flags&b.over?E("color = mix(color, texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb, SCENEJS_uLayer"+n+"BlendFactor);"):p.flags&b.conditionalAlpha&&(E("if(textureCoord.x != -1.0) {"),E("vec4 color"+n+" = texture2D(SCENEJS_uSampler"+n+", textureCoord);"),E("color = mix(color, color"+n+".rgb, color"+n+".a * SCENEJS_uLayer"+n+"BlendFactor);"),E("}"))),p.flags&b.emit&&(A?(E("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),A=!1):p.flags&b.multiply?E("emitColor *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb);"):p.flags&b.add?E("emitColor += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb;"):p.flags&b.over&&E("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+n+", textureCoord).rgb, SCENEJS_uLayer"+n+"BlendFactor);"))),p.flags&b.specular&&Y&&(B?(E("specular = mix(specular, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),B=!1):p.flags&b.multiply?E("specular *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("specular += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).r;"):p.flags&b.over&&E("specular = mix(specular, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.shine&&(C?(E("shine = mix((shine, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),C=!1):p.flags&b.multiply?E("shine *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("shine += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).r;"):p.flags&b.over&&E("shine = mix((shine, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"))),J&&(p.flags&b.baseColor&&(y?(E("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),y=!1):p.flags&b.multiply?E("color *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb);"):p.flags&b.add?E("color += SCENEJS_uLayer"+n+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb;"):p.flags&b.over&&E("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.emit&&(A?(E("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);"),A=!1):p.flags&b.multiply?E("emitColor *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb);"):p.flags&b.add?E("emitColor += SCENEJS_uLayer"+n+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb;"):p.flags&b.over&&E("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+n+", textureCoord)).rgb, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.metallic&&(H?(E("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),H=!1):p.flags&b.multiply?E("metallic *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("metallic += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).r;"):p.flags&b.over&&E("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);")),p.flags&b.roughness&&(L?(E("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"),L=!1):p.flags&b.multiply?E("roughness *= 1.0 - SCENEJS_uLayer"+n+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+n+", textureCoord).r);"):p.flags&b.add?E("roughness += SCENEJS_uLayer"+n+"BlendFactor * texture2D(SCENEJS_uSampler"+n+", textureCoord).r;"):p.flags&b.over&&E("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+n+", textureCoord).r, SCENEJS_uLayer"+n+"BlendFactor);"))),p.flags&b.normals&&Y){var O;p.flags&b.add?(O=M?"=":"+=",E(ba?"viewNormalVec "+O+" perturbNormal2Arb( SCENEJS_uSampler"+n+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+n+"BlendFactor;":"viewNormalVec "+O+" (TBN * normalize(texture2D(SCENEJS_uSampler"+n+", textureCoord).xyz * 2.0 - 1.0)) * SCENEJS_uLayer"+n+"BlendFactor;")):E(ba?"viewNormalVec = mix(viewNormalVec, (perturbNormal2Arb(SCENEJS_uSampler"+n+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord).xyz), SCENEJS_uLayer"+n+"BlendFactor);":"viewNormalVec = mix(viewNormalVec, TBN * normalize(texture2D(SCENEJS_uSampler"+n+", textureCoord).xyz * 2.0 - 1.0), SCENEJS_uLayer"+n+"BlendFactor);"),M=!1}}aa&&E("viewNormalVec = normalize(viewNormalVec);")}if(E("vec4 fragColor;"),Y){if(E("vec3 viewLightDir;"),I){if(E("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),E("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),E("vec3 viewLightVec;"),E("float dotN;"),E("float spotDirRatio;"),E("float lightDist;"),U){E("float reflectFactor = 1.0;"),i&&(E("float reflectFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uReflectFresnelEdgeColor.a,  SCENEJS_uReflectFresnelCenterColor.a, SCENEJS_uReflectFresnelPower);"),i.blendMode&b.multiply?E("reflectFactor *= mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);"):i.blendMode&b.add&&E("reflectFactor += mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);")),E("vec3 envLookup = reflect(-viewEyeVec, viewNormalVec);"),E("vec4 envColor;");for(var n=0,o=G.cubemap.layers.length;o>n;n++){var p=G.cubemap.layers[n];p.applyTo===SceneJS.CUBEMAP_FLAGS.reflect&&(E("envColor = textureCube(SCENEJS_uCubeMapSampler"+n+", envLookup);"),E("color = mix(color, envColor.rgb, reflectFactor * specular * SCENEJS_uCubeMapIntensity"+n+");"))}}for(var q,n=0,o=G.lights.length;o>n;n++)q=G.lights[n],"ambient"!=q.mode&&("point"==q.mode&&("world"==q.space?(E("viewLightVec = SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz;"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):E("viewLightVec = SCENEJS_uLightPos"+n+".xyz - SCENEJS_vViewVertex.xyz;"),E("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),E("lightDist = length( SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz);"),E("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+n+".x +   SCENEJS_uLightAttenuation"+n+".y * lightDist +   SCENEJS_uLightAttenuation"+n+".z * lightDist * lightDist);"),q.diffuse&&E("      lightValue += dotN * SCENEJS_uLightColor"+n+" * attenuation;"),q.specular&&E("    specularValue += specularColor * SCENEJS_uLightColor"+n+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"spot"==q.mode&&(E("viewLightDir = SCENEJS_uLightDir"+n+";"),"world"==q.space?(E("viewLightVec = SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz;"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),E("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):E("viewLightVec = SCENEJS_uLightPos"+n+".xyz - SCENEJS_vViewVertex.xyz;"),E("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),E("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),E("lightDist = length( SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz);"),E("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+n+".x +   SCENEJS_uLightAttenuation"+n+".y * lightDist +   SCENEJS_uLightAttenuation"+n+".z * lightDist * lightDist);"),E("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+n+") / max(SCENEJS_uOuterCone"+n+" - SCENEJS_uInnerCone"+n+", 0.0001), 0.0, 1.0);"),q.diffuse&&E("      lightValue += dotN * SCENEJS_uLightColor"+n+" * attenuation;"),q.specular&&E("    specularValue += specularColor * SCENEJS_uLightColor"+n+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"dir"==q.mode&&("world"==q.space?(E("viewLightVec = normalize(SCENEJS_uLightDir"+n+");"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):E("viewLightVec = normalize(SCENEJS_uLightDir"+n+");"),E("viewLightVec = -viewLightVec;"),E("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),q.diffuse&&E("lightValue += dotN * SCENEJS_uLightColor"+n+";"),q.specular&&E("specularValue += specularColor * SCENEJS_uLightColor"+n+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine);")));c&&(E("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),c.blendMode&b.multiply?E("color.rgb *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):c.blendMode&b.add&&E("color.rgb += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),d&&(E("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),d.blendMode&b.multiply?E("specularValue.rgb *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):d.blendMode&b.add&&E("specularValue.rgb += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),f&&(E("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),E("alpha = 1.0 - transparency;"),f.blendMode&b.multiply?E("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):f.blendMode&b.add&&E("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),E("transparency = 1.0 -alpha;")),h&&(E("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),h.blendMode&b.multiply?E("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):h.blendMode&b.add&&E("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),j&&(E("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),j.blendMode&b.multiply?E("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):j.blendMode&b.add&&E("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),E("alpha = 1.0 - transparency;"),E("fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambientColor.rgb)) + (emit * emitColor.rgb), alpha);")}if(J){if(E("IncidentLight  light;"),E("Material       material;"),E("Geometry       geometry;"),E("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),E("float dielectricSpecular   = 0.16 * specularF0 * specularF0;"),E("material.diffuseColor      = color * (1.0 - dielectricSpecular) * (1.0 - metallic);"),E("float realRoughness = sqrt(roughness);"),E("material.specularRoughness = clamp(realRoughness, 0.04, 1.0);"),E("material.specularColor     = mix(vec3(dielectricSpecular), color, metallic);"),E("geometry.position = SCENEJS_vViewVertex.xyz;"),V&&E("geometry.worldNormal = normalize(SCENEJS_vWorldNormal);"),E("geometry.viewNormal = viewNormalVec;"),E("geometry.viewEyeDir = -normalize(SCENEJS_vViewVertex.xyz);"),W&&E("computePBRReflectionMapping(SCENEJS_uPBRReflectionMapSampler, SCENEJS_uPBRReflectionMapIntensity, SCENEJS_uVMatrix, geometry, material, reflectedLight, SCENEJS_uPBRReflectionMapMipLevels);"),X){var P=G.lightmaps.activeLightmap;E("world"===P.space?"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.worldNormal, material, reflectedLight);":"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.viewNormal, material, reflectedLight);")}E("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),E("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),E("vec3 viewLightVec;"),E("float dotN;"),E("float spotDirRatio;"),E("float lightDist;");for(var q,n=0,o=G.lights.length;o>n;n++)q=G.lights[n],"ambient"!=q.mode&&("dir"==q.mode&&("world"==q.space?(E("viewLightVec = normalize(SCENEJS_uLightDir"+n+");"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):E("viewLightVec = normalize(SCENEJS_uLightDir"+n+");"),E("viewLightVec = -viewLightVec;"),E("light.direction = viewLightVec;"),E("light.color = SCENEJS_uLightColor"+n+";"),E("computePBRLighting(light, geometry, material, reflectedLight);")),"point"==q.mode&&("world"==q.space?(E("viewLightVec = SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz;"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):E("viewLightVec = SCENEJS_uLightPos"+n+".xyz - SCENEJS_vViewVertex.xyz;"),E("lightDist = length(viewLightVec);"),E("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+n+".x +   SCENEJS_uLightAttenuation"+n+".y * lightDist +   SCENEJS_uLightAttenuation"+n+".z * lightDist * lightDist);"),E("light.direction = normalize(viewLightVec);"),E("light.color = SCENEJS_uLightColor"+n+" * attenuation;"),E("computePBRLighting(light, geometry, material, reflectedLight);")),"spot"==q.mode&&(E("viewLightDir = SCENEJS_uLightDir"+n+";"),"world"==q.space?(E("viewLightVec = SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz;"),E("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),E("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):E("viewLightVec = SCENEJS_uLightPos"+n+".xyz - SCENEJS_vViewVertex.xyz;"),E("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),E("lightDist = length(SCENEJS_uLightPos"+n+" - SCENEJS_vWorldVertex.xyz);"),E("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+n+".x +   SCENEJS_uLightAttenuation"+n+".y * lightDist +   SCENEJS_uLightAttenuation"+n+".z * lightDist * lightDist);"),E("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+n+") / max(SCENEJS_uOuterCone"+n+" - SCENEJS_uInnerCone"+n+", 0.0001), 0.0, 1.0);"),E("light.direction = normalize(viewLightVec);"),E("light.color = SCENEJS_uLightColor"+n+" * attenuation;"),E("computePBRLighting(light, geometry, material, reflectedLight);")));c&&(E("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),c.blendMode&b.multiply?E("reflectedLight.diffuse *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):c.blendMode&b.add&&E("reflectedLight.diffuse += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),d&&(E("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),d.blendMode&b.multiply?E("reflectedLight.specular *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):d.blendMode&b.add&&E("reflectedLight.specular += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),f&&(E("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),E("alpha = 1.0 - transparency;"),f.blendMode&b.multiply?E("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):f.blendMode&b.add&&E("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),E("transparency = 1.0 - alpha;")),
h&&(E("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),h.blendMode&b.multiply?E("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):h.blendMode&b.add&&E("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),j&&(E("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),j.blendMode&b.multiply?E("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):j.blendMode&b.add&&E("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),E("vec3 outgoingLight = (occlusion * reflectedLight.diffuse) + (occlusion * reflectedLight.specular) + (emit * emitColor);"),E("alpha = 1.0 - transparency;"),E("fragColor = vec4(outgoingLight, alpha);")}}else E("alpha = 1.0 - transparency;"),E("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambientColor.rgb), alpha);");if(xa){var v=0,w=G.properties.opacityModifiers,o=w.length,Q=!1,R=!1;for(E("float opacity;"),v=0;o>v;v++)u=w[v],u.value.isScalarFresnel?(Q||(E("float opacityModFresnel;"),Q=!0),E("opacityModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uOpacityModFresnelEdge"+v+".a, SCENEJS_uOpacityModFresnelCenter"+v+".a, SCENEJS_uOpacityModFresnelPower"+v+");"),E("opacity = mix(SCENEJS_uOpacityModFresnelEdge"+v+".r, SCENEJS_uOpacityModFresnelCenter"+v+".r, opacityModFresnel);")):E("opacity =  SCENEJS_uOpacityModification"+v+";"),u.range&&(R||(E("float opacityModFactor;"),R=!0),E("opacityModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uOpacityModCenter"+v+") - SCENEJS_uOpacityModRadius"+v+".x) / SCENEJS_uOpacityModRadius"+v+".y, 0.0, 1.0);"),E("opacity = mix(1.0, opacity, opacityModFactor);")),E("fragColor.a *= opacity;")}if(ca&&G.clips.clipFade&&E("fragColor.a *= 1.0 - max(distAlpha, 0.0);"),fa&&(E("vec3 regionColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t)).rgb;"),E("float tolerance = 0.01;"),E("vec3 colorDelta = abs(SCENEJS_uRegionMapRegionColor - regionColor);"),"highlight"===G.regionMap.mode||"hide"===G.regionMap.mode?(E("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) < tolerance) {"),E("highlight"===G.regionMap.mode?"  fragColor.rgb *= SCENEJS_uRegionMapHighlightFactor;":"  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),E("}")):(E("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) > tolerance) {"),E("  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),E("}"))),za&&(E("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),E("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),Aa&&(E("{"),E("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),E("    float pixScale = 1.0 / maxDeriv;"),E("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),E("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),E("    float lerpFactor = fract(log2(pixScale));"),E("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),E("    float a = min(lerpFactor, 1.0 - lerpFactor);"),E("    vec3 cases = vec3("),E("        x * x / (2.0 * a * (1.0 - a)), "),E("        (x - 0.5 * a)/(1.0 - a), "),E("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),E("    );"),E("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),E("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),E("    if (fragColor.a < aThresh) {"),E("        discard;"),E("    } else {"),E("        fragColor.a = 1.0;"),E("    }"),E("}")),sa.length>0){E("float colorModFresnel;"),E("float saturation;"),E("float contrast;"),E("float brightness;"),E("float colorModFactor;"),E("vec3 tintColor;");var r,S=!1,s=0,o=sa.length;for(s=0;o>s;s++)r=sa[s],r.range&&E("colorModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uColorModCenter"+s+") - SCENEJS_uColorModRadius"+s+".x) / SCENEJS_uColorModRadius"+s+".y, 0.0, 1.0);"),r.applyTo===e.SATURATION?(S||(E("float L = dot(vec3(0.3, 0.59, 0.11), fragColor.rgb);"),S=!0),r.value.isScalarFresnel?(E("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+s+".a, SCENEJS_uColorModFresnelCenter"+s+".a, SCENEJS_uColorModFresnelPower"+s+");"),E("saturation = mix(SCENEJS_uColorModFresnelEdge"+s+".r, SCENEJS_uColorModFresnelCenter"+s+".r, colorModFresnel);")):E("saturation = SCENEJS_uColorModification"+s+";"),r.range&&E("saturation *= colorModFactor;"),E("fragColor.rgb -= saturation * (L - fragColor.rgb);")):r.applyTo===e.CONTRAST?(r.value.isScalarFresnel?(E("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+s+".a, SCENEJS_uColorModFresnelCenter"+s+".a, SCENEJS_uColorModFresnelPower"+s+");"),E("contrast = mix(SCENEJS_uColorModFresnelEdge"+s+".r, SCENEJS_uColorModFresnelCenter"+s+".r, colorModFresnel);")):E("contrast = SCENEJS_uColorModification"+s+";"),r.range&&E("contrast = mix(1.0, contrast, colorModFactor);"),E("fragColor.rgb = (fragColor.rgb - 0.5) * contrast + 0.5;")):r.applyTo===e.BRIGHTNESS?(r.value.isScalarFresnel?(E("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+s+".a, SCENEJS_uColorModFresnelCenter"+s+".a, SCENEJS_uColorModFresnelPower"+s+");"),E("brightness = mix(SCENEJS_uColorModFresnelEdge"+s+".r, SCENEJS_uColorModFresnelCenter"+s+".r, colorModFresnel);")):E("brightness = SCENEJS_uColorModification"+s+";"),r.range&&E("brightness *= colorModFactor;"),E("fragColor.rgb += brightness;")):r.applyTo===e.TINT&&(r.value.isColorFresnel?(E("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+s+".a, SCENEJS_uColorModFresnelCenter"+s+".a, SCENEJS_uColorModFresnelPower"+s+");"),E("tintColor = mix(SCENEJS_uColorModFresnelEdge"+s+".rgb, SCENEJS_uColorModFresnelCenter"+s+".rgb, colorModFresnel);"),r.range&&E("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")):(E("tintColor = SCENEJS_uColorModification"+s+";"),r.range&&E("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")),E("fragColor.rgb *= tintColor;"))}return oa&&(E("vec3 fogColor = SCENEJS_uFogColor.rgb;"),E("float fogDensity = SCENEJS_uFogColor.a;"),E("float fogStart = SCENEJS_uFogParams.x;"),E("float fogEnd = SCENEJS_uFogParams.y;"),E("float fogMin = SCENEJS_uFogParams.z;"),E("float fogMax = SCENEJS_uFogParams.w;"),pa===a.FOG_LINEAR?E("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(E("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),pa===a.FOG_EXP2&&E("fogAttenuation = fogAttenuation * fogAttenuation;"),E("float fog = 1.0 - exp(-fogAttenuation);")),E("fog = clamp(fog, fogMin, fogMax);"),E("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),k&&(E("float fragmentFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uFragmentFresnelEdgeColor.a, SCENEJS_uFragmentFresnelCenterColor.a, SCENEJS_uFragmentFresnelPower);"),k.blendMode&b.multiply?E("fragColor.rgb *= mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);"):k.blendMode&b.add&&E("fragColor.rgb += mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);")),l&&Fa.push("fragColor = linearToGamma(fragColor, 2.2);"),Aa||E("fragColor.rgb *= fragColor.a;"),E("fragColor = clamp(fragColor, 0.0, 1.0);"),E("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),Ca?E(Ca):(E("if (SCENEJS_uOutputFormat == 0.0) {"),E("    gl_FragColor = fragColor;"),E("} else if (SCENEJS_uOutputFormat == 1.0) {"),E("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),E("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),E("    float d = 1.0 - fragZ * 0.99;"),E("    float d4 = d * d * d * d;"),E("    float d16 = d4 * d4 * d4 * d4;"),E("    float a2 = fragColor.a * fragColor.a;"),E("    float a4 = a2 * a2;"),E("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),E("    float w = clamp(depthWeight, 0.0001, 1e4);"),E("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),E("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),E("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),E("}")),E("}"),F()}function z(){return D(),E("uniform mat4 SCENEJS_uMMatrix;"),f?(E("uniform mat4 SCENEJS_uVMatrix;"),E("uniform vec3 SCENEJS_uWorldEye;")):(E("uniform mediump mat4 SCENEJS_uVMatrix;"),E("uniform mediump vec3 SCENEJS_uWorldEye;")),E("uniform mat4 SCENEJS_uPMatrix;"),E("attribute vec4 SCENEJS_aVertex;"),ga&&(E("uniform float SCENEJS_uPointSize;"),ja&&E("attribute vec2 SCENEJS_aPointScaleRotation;")),la&&E("uniform mat4 SCENEJS_uDecodePositionMatrix;"),E("varying vec4 SCENEJS_vViewVertex;"),Y&&(E("attribute vec3 SCENEJS_aNormal;"),E("uniform   mat4 SCENEJS_uMNMatrix;"),E("varying   vec3 SCENEJS_vViewNormal;")),ca&&E("varying vec4 SCENEJS_vWorldVertex;"),Aa&&E("varying vec4 SceneJS_vModelVertex;"),da&&(E("uniform float SCENEJS_uMorphFactor;"),G.morphGeometry.targets[0].vertexBuf&&E("attribute vec4 SCENEJS_aMorphVertex;"),Y&&G.morphGeometry.targets[0].normalBuf&&E("attribute vec3 SCENEJS_aMorphNormal;"),la&&E("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),_&&(E("void billboard(inout mat4 mat) {"),E("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),E("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),E("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),E("}")),ma&&(E("vec3 octDecode(vec2 oct) {"),E("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),E("    if (v.z < 0.0) {"),E("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),E("    }"),E("    return normalize(v);"),E("}")),E("void main(void) {"),E(la?"vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"vec4 modelVertex = SCENEJS_aVertex; "),ma?E("vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):Y&&E("vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),da&&(G.morphGeometry.targets[0].vertexBuf&&E(la?"modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),Y&&G.morphGeometry.targets[0].normalBuf&&E(ma?"modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); ")),Aa&&E("SceneJS_vModelVertex = modelVertex;"),E("mat4 modelMatrix = SCENEJS_uMMatrix;"),E("mat4 viewMatrix = SCENEJS_uVMatrix;"),Y&&E("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),E("vec4 worldVertex;"),E("vec4 viewVertex;"),$&&E("viewMatrix[3].xyz = vec3(0.0);"),_?(E("mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),E("billboard(modelMatrix);"),E("billboard(viewMatrix);"),E("billboard(modelViewMatrix);"),Y&&E("billboard(modelNormalMatrix);"),E("worldVertex = modelMatrix * modelVertex;"),E("viewVertex = modelViewMatrix * modelVertex;")):(E("worldVertex = modelMatrix * modelVertex;"),E("viewVertex  = viewMatrix * worldVertex; ")),E("SCENEJS_vViewVertex = viewVertex;"),Y&&(E("vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),E("SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;")),ca&&E("SCENEJS_vWorldVertex = worldVertex;"),E("gl_Position = SCENEJS_uPMatrix * viewVertex;"),ga&&(E("gl_PointSize = SCENEJS_uPointSize;"),ia&&E("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),ja&&E("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),E("gl_PointSize = min(gl_PointSize, "+Ea+");")),E("}"),F()}function A(){if(D(),Aa&&E("#extension GL_OES_standard_derivatives : enable"),Ba&&E(Ba),E("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),E("#define EDGE_ALPHA 0.9"),E("#define CENTER_ALPHA 0.0"),E("#define EDGE_BIAS 0.0"),E("#define CENTER_BIAS 0.6"),E("uniform sampler2D SCENEJS_uDepthBuffer;"),E("uniform vec2 SCENEJS_uCanvasRes;"),E("varying vec4 SCENEJS_vViewVertex;"),ca){E("varying vec4 SCENEJS_vWorldVertex;"),Z&&E("uniform vec3 SCENEJS_uSolidColor;");for(var b=0;b<G.clips.clips.length;b++)E("uniform vec4  SCENEJS_uClipNormalAndDist"+b+";"),G.clips.clips[b].fade&&E("uniform float SCENEJS_uClipFadeDistance"+b+";")}if(Aa&&E("varying vec4 SceneJS_vModelVertex;"),Y&&(E("uniform vec3 SCENEJS_uXrayColor;"),E("varying vec3 SCENEJS_vViewNormal;")),oa&&(E("uniform vec4   SCENEJS_uFogParams;"),E("uniform vec4   SCENEJS_uFogColor;")),E("uniform float SCENEJS_uOutputFormat;"),E("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),za&&E("uniform bool SCENEJS_uDiscardOpaque;"),Aa&&(E("float hash(vec2 v) {"),E("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),E("}"),E("float hash3D(vec3 v) {"),E("    return hash(vec2(hash(v.xy), v.z));"),E("}")),E("void main(void) {"),E("vec4 fragColor = vec4(1.0);"),ca){G.clips.clipDiscard&&E("float distOff = 0.0;"),G.clips.clipFade&&E("float distAlpha = 0.0;");for(var b=0;b<G.clips.clips.length;b++)E(G.clips.clips[b].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w) / SCENEJS_uClipFadeDistance"+b+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w);");G.clips.clipDiscard&&E("if (distOff > 0.0) { discard; }"),G.clips.clipFade&&E("if (distAlpha > 1.0) { discard; }")}return ga&&ha&&(E("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),E("float r = dot(cxy, cxy);"),E("if (r > 1.0) {"),E("   discard;"),E("}")),Y&&(E("float fr = abs(dot(normalize(-SCENEJS_vViewVertex.xyz), normalize(SCENEJS_vViewNormal)));"),E("float fresnelFactor = clamp((fr - EDGE_BIAS) / (CENTER_BIAS - EDGE_BIAS), 0.0, 1.0);"),E("fragColor.rgb = SCENEJS_uXrayColor;"),E("fragColor.a = mix(EDGE_ALPHA, CENTER_ALPHA, fresnelFactor);")),ca&&G.clips.clipFade&&E("fragColor.a *= (1.0 - distAlpha);"),za&&(E("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),E("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),Aa&&(E("{"),E("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),E("    float pixScale = 1.0 / maxDeriv;"),E("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),E("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),E("    float lerpFactor = fract(log2(pixScale));"),E("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),E("    float a = min(lerpFactor, 1.0 - lerpFactor);"),E("    vec3 cases = vec3("),E("        x * x / (2.0 * a * (1.0 - a)), "),E("        (x - 0.5 * a)/(1.0 - a), "),E("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),E("    );"),E("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),E("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),E("    if (fragColor.a < aThresh) {"),E("        discard;"),E("    } else {"),E("        fragColor.a = 1.0;"),E("    }"),E("}")),oa&&(E("vec3 fogColor = SCENEJS_uFogColor.rgb;"),E("float fogDensity = SCENEJS_uFogColor.a;"),E("float fogStart = SCENEJS_uFogParams.x;"),E("float fogEnd = SCENEJS_uFogParams.y;"),E("float fogMin = SCENEJS_uFogParams.z;"),E("float fogMax = SCENEJS_uFogParams.w;"),pa===a.FOG_LINEAR?E("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(E("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),pa===a.FOG_EXP2&&E("fogAttenuation = fogAttenuation * fogAttenuation;"),E("float fog = 1.0 - exp(-fogAttenuation);")),E("fog = clamp(fog, fogMin, fogMax);"),E("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),E("fragColor.rgb *= fragColor.a;"),E("fragColor = clamp(fragColor, 0.0, 1.0);"),E("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),Ca?E(Ca):(E("if (SCENEJS_uOutputFormat == 0.0) {"),E("    gl_FragColor = fragColor;"),E("} else if (SCENEJS_uOutputFormat == 1.0) {"),E("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),E("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),E("    float d = 1.0 - fragZ * 0.99;"),E("    float d4 = d * d * d * d;"),E("    float d16 = d4 * d4 * d4 * d4;"),E("    float a2 = fragColor.a * fragColor.a;"),E("    float a4 = a2 * a2;"),E("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),E("    float w = clamp(depthWeight, 0.0001, 1e4);"),E("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),E("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),E("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),E("}")),E("}"),F()}function B(){return D(),E("attribute vec4 SCENEJS_aVertex;"),E("uniform mat4 SCENEJS_uMMatrix;"),E("uniform mat4 SCENEJS_uVMatrix;"),E("uniform mat4 SCENEJS_uPMatrix;"),ga&&(E("uniform float SCENEJS_uPointSize;"),ja&&E("attribute vec2 SCENEJS_aPointScaleRotation;")),la&&E("uniform mat4 SCENEJS_uDecodePositionMatrix;"),E("varying vec4 SCENEJS_vWorldVertex;"),da&&(E("uniform float SCENEJS_uMorphFactor;"),G.morphGeometry.targets[0].vertexBuf&&E("attribute vec4 SCENEJS_aMorphVertex;"),la&&E("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),E("void main(void) {"),E(la?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),da&&G.morphGeometry.targets[0].vertexBuf&&E(la?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),E("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),E("mat4 vPosMatrix = SCENEJS_uVMatrix;"),$&&E("vPosMatrix[3].xyz = vec3(0.0);"),E("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),E("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),ga&&(E("gl_PointSize = SCENEJS_uPointSize;"),ia&&E("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),ja&&E("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),E("gl_PointSize = min(gl_PointSize, "+Ea+");")),E("}"),F()}function C(){if(D(),E("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),E("varying vec4 SCENEJS_vWorldVertex;"),ca)for(var a=0;a<G.clips.clips.length;a++)E("uniform vec4  SCENEJS_uClipNormalAndDist"+a+";"),G.clips.clips[a].fade&&E("uniform float SCENEJS_uClipFadeDistance"+a+";");if(E("void main(void) {"),ca){G.clips.clipDiscard&&E("float distOff = 0.0;"),G.clips.clipFade&&E("float distAlpha = 0.0;");for(var a=0;a<G.clips.clips.length;a++)E(G.clips.clips[a].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+a+".xyz) + SCENEJS_uClipNormalAndDist"+a+".w) / SCENEJS_uClipFadeDistance"+a+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+a+".xyz) + SCENEJS_uClipNormalAndDist"+a+".w);");G.clips.clipDiscard&&E("if (distOff > 0.0) { discard; }"),G.clips.clipFade&&E("if (distAlpha > 1.0) { discard; }")}return E("   gl_FragColor = vec4(gl_FragCoord.zzz, 1.0);"),E("}"),F()}function D(){Fa=[]}function E(a){Fa.push(a||"")}function F(){return Fa.join("\n")}var G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da={},Ea=Math.floor(SceneJS.WEBGL_INFO.MAX_POINT_SIZE).toFixed(1),Fa="";this.setMaxPointSize=function(a){a=Math.min(a,SceneJS.WEBGL_INFO.MAX_POINT_SIZE),Ea=Math.floor(a).toFixed(1)},this.getSource=function(a,b,c){var e=Da[a];return e?(e.useCount++,e):(G=b,H=c,I=G.material.workflow===SceneJS.Material.PHONG,J=G.material.workflow===SceneJS.Material.METALLIC,K=b.gammaInputPhong,L=G.fresnel.diffuse,M=G.fresnel.specular,N=G.fresnel.alpha,P=G.fresnel.reflect,Q=G.fresnel.emit,R=G.fresnel.fragment,O=G.fresnel.transparency,S=L||M||N||O||P||Q||R,T=p(G),U=r(G),V=s(G),W=t(G),X=u(G),Y=v(G),ca=G.clips.clips.length>0&&!!(G.properties.flags&d.CLIPPING),Z=ca&&!!(G.properties.flags&d.SOLID),$=!!(G.properties.flags&d.SKYBOX),_=!!(G.properties.flags&d.BILLBOARD),aa=w(G),ba=aa&&b.autoTangents&&SceneJS.WEBGL_INFO.standardDerivativesSupported,da=!!G.morphGeometry.targets,ea=o(),fa=ea&&"info"!==G.regionMap.mode,ga="points"===G.geometry.primitiveName,ia=!!(G.properties.flags&d.PERSPECTIVE_POINTS),ja=!!G.geometry.pointScaleRotationBuf,ka=!!G.geometry.pointUVTranslateBuf,ha=!!(G.properties.flags&d.ROUND_POINTS),la=!(!G.geometry.compressedPositions&&!G.morphGeometry.compressedPositions),ma=!(!G.geometry.compressedNormals&&!G.morphGeometry.compressedNormals),na=!(!G.geometry.compressedUVs&&!G.morphGeometry.compressedUVs),oa=G.fogEnabled,pa=G.fogMode,qa=G.properties.colorModRange,ra=G.properties.colorModifiers.length>0,sa=G.properties.colorModifiers,ta=h(),ua=i(),va=j(),wa=G.properties.opacityModRange,xa=G.properties.opacityModifiers.length>0,ya=G.properties.opacityModifiers,za=G.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&H.isPartiallyOpaque(),Aa=!!(G.properties.flags&d.STOCHASTIC_ALPHA),Ba=G.properties.fragmentShaderHeader||null,Ca=G.properties.fragmentShaderFooter||null,e={hash:a,pickVertexSrc:k(),pickFragmentSrc:l(),pickTriangleVertexSrc:k(!0),pickTriangleFragmentSrc:l(!0),drawVertexSrc:x(),drawFragmentSrc:y(),xrayVertexSrc:z(),xrayFragmentSrc:A(),depthVertexSrc:B(),depthFragmentSrc:C(),drawTextureVertexSrc:m(),drawTextureFragmentSrc:n(),useCount:0},Da[a]=e,e)},this.putSource=function(a){var b=Da[a];b&&0==--b.useCount&&(Da[b.hash]=null)}}}(),function(){"use strict";var a=window.SceneJS_ProgramFactory=function(a,b){this.stats=a,this._canvas=b.canvas,this._programs={}};a.prototype.getProgram=function(a,b,c){var d=this._programs[a];return d||(d=new SceneJS._webgl.Program(this.stats,this._canvas.gl,a,b,c),this._programs[a]=d,this.stats.state.programs++),d.useCount++,d},a.prototype.putProgram=function(a){--a.useCount<=0&&(a.destroy(),delete this._programs[a.hash],this.stats.state.programs--)},a.prototype.webglRestored=function(){var a=this._canvas.gl;for(var b in this._programs)this._programs.hasOwnProperty(b)&&this._programs[b].build(a)},a.prototype.destroy=function(){}}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=3*b,i=3*c,j=3*d,k=a.targets[a.key1].positions,l=a.targets[a.key2].positions,m=a.targets[a.key1].positionDecodeMat,t=a.targets[a.key2].positionDecodeMat;a.compressedPositions?(SceneJS_math_decompressPosition(n,k.subarray(h,h+3),m),SceneJS_math_decompressPosition(q,l.subarray(h,h+3),t),SceneJS_math_decompressPosition(o,k.subarray(i,i+3),m),SceneJS_math_decompressPosition(r,l.subarray(i,i+3),t),SceneJS_math_decompressPosition(p,k.subarray(j,j+3),m),SceneJS_math_decompressPosition(s,l.subarray(j,j+3),t)):(n.set(k.subarray(h,h+3)),q.set(l.subarray(h,h+3)),o.set(k.subarray(i,i+3)),r.set(l.subarray(i,i+3)),p.set(k.subarray(j,j+3)),s.set(l.subarray(j,j+3))),vec3.lerp(e,n,q,a.factor),vec3.lerp(f,o,r,a.factor),vec3.lerp(g,p,s,a.factor)}function b(a,b,c,d,e,f,g){var h=a.arrays.positions,i=a.positionDecodeMat,j=3*b,k=3*c,l=3*d;e[0]=h[j],e[1]=h[j+1],e[2]=h[j+2],f[0]=h[k],f[1]=h[k+1],f[2]=h[k+2],g[0]=h[l],g[1]=h[l+1],g[2]=h[l+2],i&&(SceneJS_math_decompressPosition(e,e,i),SceneJS_math_decompressPosition(f,f,i),SceneJS_math_decompressPosition(g,g,i))}function c(a,b,c){var d=a.arrays.positions,e=a.positionDecodeMat,f=3*b;c[0]=d[f],c[1]=d[f+1],c[2]=d[f+2],e&&SceneJS_math_decompressPosition(c,c,e)}function d(a,b,c,d,e,f,g){var h,i,j,k=a.targets[a.key1].normals,l=a.targets[a.key2].normals;return a.compressedNormals?(h=2*b,i=2*c,j=2*d,SceneJS_math_octDecodeVec2(k.subarray(h,h+2),n),SceneJS_math_octDecodeVec2(l.subarray(h,h+2),q),SceneJS_math_octDecodeVec2(k.subarray(i,i+2),o),SceneJS_math_octDecodeVec2(l.subarray(i,i+2),r),SceneJS_math_octDecodeVec2(k.subarray(j,j+2),p),SceneJS_math_octDecodeVec2(l.subarray(j,j+2),s)):(h=3*b,i=3*c,j=3*d,n.set(k.subarray(h,h+3)),q.set(l.subarray(h,h+3)),o.set(k.subarray(i,i+3)),r.set(l.subarray(i,i+3)),p.set(k.subarray(j,j+3)),s.set(l.subarray(j,j+3))),vec3.lerp(e,n,q,a.factor),vec3.lerp(f,o,r,a.factor),vec3.lerp(g,p,s,a.factor),!0}function e(a,b,c,d,e,f,g){var h,i,j,k=a.arrays.normals;if(!k)return e=e.set([0,0,0]),f=f.set([0,0,0]),g=g.set([0,0,0]),!1;if(a.compressedNormals){{var h=2*b,i=2*c,j=2*d;k.subarray(h,h+2),k.subarray(i,i+2),k.subarray(j,j+2)}SceneJS_math_octDecodeVec2(k.subarray(h,h+2),e),SceneJS_math_octDecodeVec2(k.subarray(i,i+2),f),SceneJS_math_octDecodeVec2(k.subarray(j,j+2),g)}else h=3*b,i=3*c,j=3*d,e[0]=k[h],e[1]=k[h+1],e[2]=k[h+2],f[0]=k[i],f[1]=k[i+1],f[2]=k[i+2],g[0]=k[j],g[1]=k[j+1],g[2]=k[j+2];return!0}function f(a,b,c,d,e,f,g,h){var i=2*c,j=2*d,k=2*e,l=a.arrays.uvs[b];if(f[0]=l[i],f[1]=l[i+1],g[0]=l[j],g[1]=l[j+1],h[0]=l[k],h[1]=l[k+1],a.compressedUVs){var m=a.uvDecodeMats[b];SceneJS_math_decompressUV(f,f,m),SceneJS_math_decompressUV(g,g,m),SceneJS_math_decompressUV(h,h,m)}}{var g=window.SceneJS_Object=function(a){this.id=a,this.hash=null,this.sortKey=0,this.sortTieBreaker=0,this.chunkSets={},this.chunksLen=0,this.program=null,this.layer=null,this.texture=null,this.properties=null,this.centroid=null},h=new vec3.create,i=vec2.create(),j=vec2.create(),k=(vec2.create(),vec3.create()),l=vec3.create(),m=vec3.create(),n=vec3.create(),o=vec3.create(),p=vec3.create(),q=vec3.create(),r=vec3.create(),s=vec3.create(),t=vec4.create();vec4.create(),vec4.create()}g.prototype.getDepth=function(){this.centroid||(this.centroid=this._calculateCentroid(this));var a=this.modelTransform.matrix,b=this.viewMatrix,c=vec3.transformMat4(h,this.centroid,a);return-(b[2]*c[0]+b[6]*c[1]+b[10]*c[2]+b[14])},g.prototype.isTransparent=function(){return!this.properties.stochasticAlpha&&!!(this.properties.transparent||this.properties.opacityModifiers.length>0||this.texture.transparent||this.geometry.transparent||this.fresnel.transparent||this.material.transparent||this.regionMap.transparent)},g.prototype.isPartiallyOpaque=function(){return this.properties.partiallyOpaque||!this.properties.transparent&&(this.fresnel.partiallyOpaque||this.texture.transparent)},g.prototype.getKdTree=function(){var a=this.geometry.arrays.indices,b=this.morphGeometry.targets;return b&&b.length>0?this.morphGeometry.getKdTree(a):this.geometry.getKdTree()},g.prototype.getPositions=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].positions:this.geometry.arrays.positions},g.prototype.getPositionDecodeMat=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].positionDecodeMat:this.geometry.positionDecodeMat},g.prototype.getFrameEndPositions=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].positions:null},g.prototype.getFrameEndPositionDecodeMat=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].positionDecodeMat:null},g.prototype.getNormals=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].normals:this.geometry.arrays.normals},g.prototype.getFrameEndNormals=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].normals:null},g.prototype.getIndices=function(){return this.geometry.arrays.indices||null},g.prototype.getMorphFactor=function(){var a=this.morphGeometry.targets;return a&&a.length>0?this.morphGeometry.factor:null},g.prototype.cartesianToBarycentric=function(a,b,c){this.getTrianglePositionOnSurface(a,k,l,m),SceneJS_math_cartesianToBarycentric(b,k,l,m,c)},g.prototype.getPointInWorldSpace=function(a,b){t.set(a),t[3]=1,vec4.transformMat4(t,t,this.modelTransform.matrix),b.set(t.subarray(0,3))},g.prototype.getTriangleIndices=function(a,b){var c=this.geometry.arrays.indices;c?(b[0]=c[a],b[1]=c[a+1],b[2]=c[a+2]):(b[0]=a,b[1]=a+1,b[2]=a+2)},g.prototype.barycentricToCartesian=function(a,b,c){b=b||[1/3,1/3,1/3],this.getTrianglePositionOnSurface(a,k,l,m),SceneJS_math_barycentricToCartesian(b,k,l,m,c)},g.prototype.getTrianglePositionOnSurface=function(c,d,e,f){var g=this.geometry.arrays.indices;if(this.geometry||this.morphGeometry){var h,i,j;g?(h=g[c],i=g[c+1],j=g[c+2]):(h=c,i=c+1,j=c+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?a(this.morphGeometry,h,i,j,d,e,f):b(this.geometry,h,i,j,d,e,f)}},g.prototype.normalFromBarycentric=function(a,b,c){b=b||[1/3,1/3,1/3];var d=this.normalFromCartesian(a,k,l,m);return d?(vec3.scale(c,k,b[0]),vec3.add(c,c,vec3.scale(o,l,b[1])),vec3.add(c,c,vec3.scale(o,m,b[2])),!0):!1},g.prototype.normalFromCartesian=function(a,b,c,f){if(this.geometry||this.morphGeometry){var g,h,i,j=this.geometry.arrays.indices;return j?(g=j[a],h=j[a+1],i=j[a+2]):(g=a,h=a+1,i=a+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?d(this.morphGeometry,g,h,i,b,c,f):e(this.geometry,g,h,i,b,c,f)}},g.prototype.uvFromBarycentric=function(a,b,c){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var d,e,g,h=this.geometry.arrays.indices;h?(d=h[a],e=h[a+1],g=h[a+2]):(d=a,e=a+1,g=a+2);var n;for(n=0;n<this.geometry.arrays.uvs.length;n++){f(this.geometry,n,d,e,g,k,l,m);var o=vec2.create();vec2.scale(o,k,b[0]),vec2.add(o,o,vec2.scale(i,l,b[1])),vec2.add(o,o,vec2.scale(j,m,b[2])),c.push(o)}}},g.prototype.uvFromCartesian=function(a){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var b,c,d,e=this.geometry.arrays.indices;e?(b=e[a],c=e[a+1],d=e[a+2]):(b=a,c=a+1,d=a+2);var g,h=[],i=[],j=[];for(g=0;g<this.geometry.arrays.uvs.length;g++){f(a,g,b,c,d,k,l,m);var n=vec2.create(),o=vec2.create(),p=vec3.create();n[0]=k[0],n[1]=k[1],o[0]=l[0],o[1]=l[1],p[0]=m[0],p[1]=m[1],h.push(n),i.push(o),j.push(p)}}},g.prototype._calculateCentroid=function(){for(var a=vec3.create(),b=this.geometry.arrays.positions,d=1/0,e=1/0,f=1/0,g=-(1/0),i=-(1/0),j=-(1/0),k=Math.min,l=Math.max,m=0,n=b.length/3;n>m;++m){c(this.geometry,m,h);var o=h[0],p=h[1],q=h[2];d=k(o,d),e=k(p,e),f=k(q,f),g=l(o,g),i=l(p,i),j=l(q,j)}return a[0]=.5*(d+g),a[1]=.5*(e+i),a[2]=.5*(f+j),a}}(),function(){"use strict";var a=["attribute vec2 aPosition;","varying vec2 vUV;","void main() {","    vUV = aPosition * 0.5 + 0.5;","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),b=new Float32Array([-1,-1,1,-1,-1,1,1,1]);window.SceneJS_PostProcess=function(c,d,e,f){f=f||{},this.gl=d,this.uniformIndices={},this.uniformHandles=[],this.uniformValues=[],this.textureIndices={},this.samplerNames=[],this.textures=[],this.positionBuffer=new SceneJS._webgl.ArrayBuffer(d,d.ARRAY_BUFFER,b,b.length,2,d.STATIC_DRAW),this.program=new SceneJS._webgl.Program(c,d,"post-process",a,e),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformCount=0,this.textureCount=0,this.clear=!!f.clear},SceneJS_PostProcess.prototype.setUniform=function(a,b){var c=this.uniformIndices[a];void 0===c&&(c=this.uniformIndices[a]=this.uniformCount++,this.uniformHandles.push(this.program.getUniform(a))),this.uniformValues[c]=b},SceneJS_PostProcess.prototype.setTexture=function(a,b){var c=this.textureIndices[a];void 0===c&&(c=this.textureIndices[a]=this.textureCount++,this.samplerNames.push(a)),this.textures[c]=b},SceneJS_PostProcess.prototype.draw=function(a){a.VAO&&a.VAO.bindVertexArrayOES(null),this.program.bind(),this.positionsAttribute.bindArrayBuffer(this.positionBuffer);for(var b=0;b<this.uniformCount;++b)this.uniformHandles[b].setValue(this.uniformValues[b]);for(var b=0;b<this.textureCount;++b)this.program.bindTexture(this.samplerNames[b],this.textures[b],b);this.clear&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)),
this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},SceneJS_PostProcess.prototype.destroy=function(){this.positionBuffer.destroy(),this.positionBuffer=null,this.program.destroy(),this.program=null},SceneJS_PostProcess.prototype.webglRestored=function(a){this.gl=a,this.positionBuffer=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,b,b.length,2,a.STATIC_DRAW),this.program.build(a),this.positionsAttribute=this.program.getAttribute("aPosition");for(var c in this.uniformIndices){var d=this.uniformIndices[c];this.uniformHandles[d]=this.program.getUniform(c)}}}(),function(){"use strict";window.SceneJS_PostProcessStage=function(a,b){this.id=b.id,this.display=a,this.postProcess=a._postProcessTypes[b.type],this.uniforms=b.uniforms,this.framebuffer=null,b.framebuffer&&(this.framebuffer=a.framebuffers[b.framebuffer]),this.textures={};for(var c in b.textures){var d,e=b.textures[c],f=e.framebuffer,g=e.target,h=e.data,i=a._canvas.gl;if(f){if(d=a.framebuffers[f],!d){console.error("Framebuffer not found: "+f);continue}if("color"===g)this.textures[c]=d.getColorTarget(e.attachment||0);else{if("depth"!==g){console.error("Invalid target: "+g);continue}this.textures[c]=d.getDepthTarget()}}else if(h){var j=i.createTexture(),k=void 0!==e.format?i[e.format]:i.RGBA,l=void 0!==e.type?i[e.type]:i.UNSIGNED_BYTE,m=void 0!==e.minFilter?i[e.minFilter]:i.NEAREST,n=void 0!==e.magFilter?i[e.magFilter]:i.NEAREST,o=void 0!==e.wrapS?i[e.wrapS]:i.CLAMP_TO_EDGE,p=void 0!==e.wrapT?i[e.wrapT]:i.CLAMP_TO_EDGE;i.bindTexture(i.TEXTURE_2D,j),i.texImage2D(i.TEXTURE_2D,0,k,e.width,e.height,0,k,l,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,p),this.textures[c]={texture:j,gl:i,bind:function(a){return this.texture?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0):!1},unbind:function(a){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},i.bindTexture(i.TEXTURE_2D,null)}}},SceneJS_PostProcessStage.prototype.setUniform=function(a,b){this.uniforms[a]=b,this.display.imageDirty=!0},SceneJS_PostProcessStage.prototype.draw=function(a){for(var b in this.uniforms)this.postProcess.setUniform(b,this.uniforms[b]);for(var c in this.textures)this.postProcess.setTexture(c,this.textures[c]);this.postProcess.draw(a)},SceneJS_PostProcessStage.prototype.destroy=function(){for(var a in this.textures)"function"==typeof this.textures[a].destroy&&this.textures[a].destroy(),this.textures[a]=null}}(),function(){"use strict";var a=window.SceneJS_ChunkFactory=function(){this._chunks={},this._numericIds=1,this.chunkTypes=a.chunkTypes};a.chunkTypes={},a.addChunkType=function(b,c){a.chunkTypes[b]=c},a.prototype.getChunk=function(b,c,d,e){var f=a.chunkTypes[c];if(!f)throw"chunk type not supported: '"+c+"'";var g=this._chunks[b];return g?(g.useCount++,g):(g=new f(b,this._numericIds++,d,e),g.useCount=1,this._chunks[b]=g,g)},a.prototype.putChunk=function(a){0!==a.useCount&&--a.useCount<=0&&(a.recycle&&a.recycle(),delete this._chunks[a.id])},a.prototype.webglRestored=function(){var a;for(var b in this._chunks)this._chunks.hasOwnProperty(b)&&(a=this._chunks[b],a&&a.build&&a.build())}}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.unique=!0,this.build()};a.prototype.build=function(){this.core=this.cores[0],this.handles.draw={},this.handles.xray={},this.handles.pick={uPickColor:this.program.pick.getUniform("SCENEJS_uPickColor")},this.handles.depth={},this.handles.drawTexture={}},a.prototype.draw=function(a,b){var c=this.core,d=this.handles[a],e=this.program.gl;if(b.pickTriangle){var f=c.getPickColors();f&&e.drawArrays(c.primitive,0,f.numItems/4)}else{if(b.pickObject&&d.uPickColor){var g=b.pickIndex>>24&255,h=b.pickIndex>>16&255,i=b.pickIndex>>8&255,j=255&b.pickIndex;b.pickIndex++,d.uPickColor.setValue([j/255,i/255,h/255,g/255])}c.indexBuf?e.drawElements(c.primitive,c.indexBuf.numItems,c.indexBuf.itemType,0):e.drawArrays(c.primitive,0,c.vertexBuf.numItems/3)}b.transparent=!1},SceneJS_ChunkFactory.addChunkType("draw",a)}(),function(){"use strict";var a=SceneJS.PROPERTY_FLAGS,b=SceneJS.DEPTH_TEST_FLAGS,c=vec4.create(),d=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.unique=!0,this.build()};d.prototype.build=function(){this.propertiesCore=this.cores[0],this.xformCore=this.cores[1];var a=this.program.draw,b=this.program.xray,c=this.program.pick,d=this.program.pickTriangle,e=this.program.depth,f=this.program.drawTexture,g=this.handles.draw={},h=this.handles.xray={},i=this.handles.pick={},j=this.handles.pickTriangle={},k=this.handles.depth={},l=this.handles.drawTexture={};if(g.uDiscardOpaque=a.getUniform("SCENEJS_uDiscardOpaque"),g.uOutputFormat=a.getUniform("SCENEJS_uOutputFormat"),h.uDiscardOpaque=b.getUniform("SCENEJS_uDiscardOpaque"),h.uOutputFormat=b.getUniform("SCENEJS_uOutputFormat"),this.propertiesCore){g.uSolidColor=a.getUniform("SCENEJS_uSolidColor"),g.uXrayParams=a.getUniform("SCENEJS_uXrayParams"),h.uSolidColor=b.getUniform("SCENEJS_uSolidColor"),k.uClipping=e.getUniform("SCENEJS_uClipping"),g.uColorModifications=new Array(this.propertiesCore.colorModifiers.length),g.uColorModCenters=new Array(this.propertiesCore.colorModifiers.length),g.uColorModRadii=new Array(this.propertiesCore.colorModifiers.length),g.uColorModFresnels=new Array(this.propertiesCore.colorModifiers.length);for(var m=0,n=this.propertiesCore.colorModifiers.length;n>m;m++){var o=this.propertiesCore.colorModifiers[m],p=o.value;g.uColorModifications[m]=a.getUniform("SCENEJS_uColorModification"+m),(p.isColorFresnel||p.isScalarFresnel)&&(g.uColorModFresnels[m]={edge:a.getUniform("SCENEJS_uColorModFresnelEdge"+m),center:a.getUniform("SCENEJS_uColorModFresnelCenter"+m),power:a.getUniform("SCENEJS_uColorModFresnelPower"+m)}),g.uColorModCenters[m]=a.getUniform("SCENEJS_uColorModCenter"+m),g.uColorModRadii[m]=a.getUniform("SCENEJS_uColorModRadius"+m)}g.uOpacityModifications=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModCenters=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModRadii=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModFresnels=new Array(this.propertiesCore.opacityModifiers.length);for(var q=0,n=this.propertiesCore.opacityModifiers.length;n>q;++q){var r=this.propertiesCore.opacityModifiers[q];g.uOpacityModifications[q]=a.getUniform("SCENEJS_uOpacityModification"+q),r.value.isScalarFresnel&&(g.uOpacityModFresnels[q]={edge:a.getUniform("SCENEJS_uOpacityModFresnelEdge"+q),center:a.getUniform("SCENEJS_uOpacityModFresnelCenter"+q),power:a.getUniform("SCENEJS_uOpacityModFresnelPower"+q)}),g.uOpacityModCenters[q]=a.getUniform("SCENEJS_uOpacityModCenter"+q),g.uOpacityModRadii[q]=a.getUniform("SCENEJS_uOpacityModRadius"+q)}}this.xformCore&&(g.uMatLocation=a.getUniform("SCENEJS_uMMatrix"),g.uNormalMatLocation=a.getUniform("SCENEJS_uMNMatrix"),h.uMatLocation=b.getUniform("SCENEJS_uMMatrix"),h.uNormalMatLocation=b.getUniform("SCENEJS_uMNMatrix"),i.uMatLocation=c.getUniform("SCENEJS_uMMatrix"),j.uMatLocation=d.getUniform("SCENEJS_uMMatrix"),k.uMatLocation=e.getUniform("SCENEJS_uMMatrix"),l.uMatLocation=f.getUniform("SCENEJS_uMMatrix"))},d.prototype.draw=function(d,e){var f=this.program.gl,g=(e.picking,this.handles[d]);if(g.uDiscardOpaque&&g.uDiscardOpaque.setValue(e.discardOpaque),g.uOutputFormat&&g.uOutputFormat.setValue(e.outputFormat),this.propertiesCore){var h=this.propertiesCore.depthTest;e.depthTest!=h&&(h==b.ALWAYS_PASS?(f.enable(f.DEPTH_TEST),f.depthFunc(f.ALWAYS)):h==b.DISABLED?f.disable(f.DEPTH_TEST):(f.enable(f.DEPTH_TEST),f.depthFunc(f.LESS)),e.depthTest=h);var i=this.propertiesCore.flags&a.CCW;if(e.frontface!=i&&(f.frontFace(i?f.CCW:f.CW),e.frontface=i),g.uColorModifications)for(var j=0,k=this.propertiesCore.colorModifiers.length;k>j;++j){var l=this.propertiesCore.colorModifiers[j],m=l.value;g.uColorModifications[j]&&g.uColorModifications[j].setValue(m);var n=g.uColorModFresnels[j];n&&(m.isColorFresnel?(n.edge&&(c[0]=m.edge[0],c[1]=m.edge[1],c[2]=m.edge[2],c[3]=m.edgeBias,n.edge.setValue(c)),n.center&&(c[0]=m.center[0],c[1]=m.center[1],c[2]=m.center[2],c[3]=m.centerBias,n.center.setValue(c)),n.power&&n.power.setValue(m.power)):m.isScalarFresnel&&(n.edge&&(c[0]=m.edge,c[3]=m.edgeBias,n.edge.setValue(c)),n.center&&(c[0]=m.center,c[3]=m.centerBias,n.center.setValue(c)),n.power&&n.power.setValue(m.power))),g.uColorModCenters[j]&&g.uColorModCenters[j].setValue(l.range.center),g.uColorModRadii[j]&&g.uColorModRadii[j].setValue(l.range.radius)}if(g.uOpacityModifications)for(var o=0,k=this.propertiesCore.opacityModifiers.length;k>o;++o){var p=this.propertiesCore.opacityModifiers[o],m=p.value;g.uOpacityModifications[o]&&g.uOpacityModifications[o].setValue(m);var q=g.uOpacityModFresnels[o];q&&(q.edge&&(c[0]=m.edge,c[3]=m.edgeBias,q.edge.setValue(c)),q.center&&(c[0]=m.center,c[3]=m.centerBias,q.center.setValue(c)),q.power&&q.power.setValue(m.power)),g.uOpacityModCenters[o]&&g.uOpacityModCenters[o].setValue(p.range.center),g.uOpacityModRadii[o]&&g.uOpacityModRadii[o].setValue(p.range.radius)}g.uSolidColor&&g.uSolidColor.setValue(this.propertiesCore.solidColor),g.uXrayParams&&g.uXrayParams.setValue(this.propertiesCore.xrayParams)}this.xformCore&&(g.uMatLocation&&g.uMatLocation.setValue(this.xformCore.matrix),g.uNormalMatLocation&&g.uNormalMatLocation.setValue(this.xformCore.normalMatrix))},SceneJS_ChunkFactory.addChunkType("object",d)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.VAOs={draw:null,pick:null,pickTriangle:null,xray:null,depth:null,drawTexture:null},this.build()};a.prototype.build=function(){this.core=this.cores[0],this.core2=this.cores[1];var a=this.program.draw,b=0;this.core2.uvBufs&&(b=this.core2.uvBufs.length),this.handles.draw={aRegionMapUV:a.getAttribute("SCENEJS_aRegionMapUV"),aVertex:a.getAttribute("SCENEJS_aVertex"),aNormal:a.getAttribute("SCENEJS_aNormal"),aUV:new Array(b),uDecodeUV:new Array(b),aTangent:a.getAttribute("SCENEJS_aTangent"),aColor:a.getAttribute("SCENEJS_aVertexColor"),aMorphVertex:a.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:a.getAttribute("SCENEJS_aMorphNormal"),aMorphTangent:a.getAttribute("SCENEJS_aMorphTangent"),aPointScaleRotation:a.getAttribute("SCENEJS_aPointScaleRotation"),aPointUVTranslate:a.getAttribute("SCENEJS_aPointUVTranslate"),uPointUVScale:a.getUniform("SCENEJS_uPointUVScale"),uMorphFactor:a.getUniform("SCENEJS_uMorphFactor"),uPointSize:a.getUniform("SCENEJS_uPointSize"),uDecodePositions:a.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:a.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var c=0;b>c;c++)this.handles.draw.aUV[c]=a.getAttribute("SCENEJS_aUVCoord"+c),this.handles.draw.uDecodeUV[c]=a.getUniform("SCENEJS_uDecodeUVMatrix"+c);var d=this.program.xray;this.handles.xray={aVertex:d.getAttribute("SCENEJS_aVertex"),aNormal:d.getAttribute("SCENEJS_aNormal"),aMorphVertex:d.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:d.getAttribute("SCENEJS_aMorphNormal"),aPointScaleRotation:d.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:d.getUniform("SCENEJS_uMorphFactor"),uPointSize:d.getUniform("SCENEJS_uPointSize"),uDecodePositions:d.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:d.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var e=this.program.pick;this.handles.pick={aRegionMapUV:e.getAttribute("SCENEJS_aRegionMapUV"),aVertex:e.getAttribute("SCENEJS_aVertex"),aMorphVertex:e.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:e.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:e.getUniform("SCENEJS_uMorphFactor"),uPointSize:e.getUniform("SCENEJS_uPointSize"),uDecodePositions:e.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:e.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var f=this.program.pickTriangle;this.handles.pickTriangle={aVertex:f.getAttribute("SCENEJS_aVertex"),aTriColor:f.getAttribute("SCENEJS_aTriColor"),aMorphVertex:f.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:f.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:f.getUniform("SCENEJS_uMorphFactor"),uPointSize:f.getUniform("SCENEJS_uPointSize"),uDecodePositions:f.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:f.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var g=this.program.depth;this.handles.depth={aVertex:g.getAttribute("SCENEJS_aVertex"),aMorphVertex:g.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:g.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:g.getUniform("SCENEJS_uMorphFactor"),uPointSize:g.getUniform("SCENEJS_uPointSize"),uDecodePositions:g.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:g.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var h=this.program.drawTexture;this.handles.drawTexture={aVertex:h.getAttribute("SCENEJS_aVertex"),aUV:new Array(b),uDecodeUV:new Array(b),aMorphVertex:h.getAttribute("SCENEJS_aMorphVertex"),uMorphFactor:h.getUniform("SCENEJS_uMorphFactor"),uDecodePositions:h.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:h.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var c=0;b>c;c++)this.handles.drawTexture.aUV[c]=h.getAttribute("SCENEJS_aUVCoord"+c),this.handles.drawTexture.uDecodeUV[c]=h.getUniform("SCENEJS_uDecodeUVMatrix"+c);for(var i in this.VAOs)this.VAOs[i]={VAO:null,morphKey1:-1,morphKey2:-1}},a.prototype.recycle=function(){var a=this.program.gl.getExtension("OES_vertex_array_object");if(a)for(var b in this.VAOs)this.VAOs[b].VAO&&(a.deleteVertexArrayOES(this.VAOs[b].VAO),this.VAOs[b].VAO=null),this.VAOs[b].morphKey1=-1,this.VAOs[b].morphKey2=-1},a.prototype.morphDraw=function(a,b,c){b.morphKey1=this.core.key1,b.morphKey2=this.core.key2;var d=this.core.key1,e=this.core.key2,f=this.core.targets[d],g=this.core.targets[e];if(a.aMorphVertex?(a.aVertex.bindArrayBuffer(f.vertexBuf),a.aMorphVertex.bindArrayBuffer(g.vertexBuf),c.bindArray+=2):a.aVertex&&(a.aVertex.bindArrayBuffer(this.core2.vertexBuf),c.bindArray++),a.aMorphNormal?(a.aNormal.bindArrayBuffer(f.normalBuf),a.aMorphNormal.bindArrayBuffer(g.normalBuf),c.bindArray+=2):a.aNormal&&(a.aNormal.bindArrayBuffer(this.core2.normalBuf),c.bindArray++),(a.aMorphTangent||a.aTangent)&&c.hasNormalMap&&a.aMorphTangent&&(a.aTangent.bindArrayBuffer(this.core.getTangents(d,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),a.aMorphTangent.bindArrayBuffer(this.core.getTangents(e,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),c.bindArray+=2),a.aUV)for(var h,i=0,j=a.aUV.length;j>i;i++)h=this.core2.uvBufs[i],h&&a.aUV[i]&&(a.aUV[i].bindArrayBuffer(h),c.bindArray++);a.aColor&&(a.aColor.bindArrayBuffer(this.core2.colorBuf),c.bindArray++)},a.prototype.updateGeoUniforms=function(a){a.uDecodePositions&&a.uDecodePositions.setValue(this.core2.positionDecodeMat)},a.prototype.updateMorphUniforms=function(a){var b=this.core.key1,c=this.core.key2,d=this.core.targets[b],e=this.core.targets[c];a.uDecodePositions&&a.uDecodePositions.setValue(d.positionDecodeMat),a.uDecodeMorphPos&&a.uDecodeMorphPos.setValue(e.positionDecodeMat),a.uMorphFactor&&a.uMorphFactor.setValue(this.core.factor)},a.prototype.draw=function(a,b){var c=this.handles[a],d=this.VAOs[a],e=this.core.targets&&this.core.targets.length;if(c.uPointSize&&c.uPointSize.setValue(this.core2.pointSize),c.uPointUVScale&&c.uPointUVScale.setValue(this.core2.pointUVScale),c.uDecodeUV)for(var f=0,g=c.uDecodeUV.length;g>f;f++)c.uDecodeUV[f]&&c.uDecodeUV[f].setValue(this.core2.uvDecodeMats[f]);if(e?this.updateMorphUniforms(c):this.updateGeoUniforms(c),b.pickTriangle)if(e)if(c.aMorphVertex){var h=this.core.getPickPositions(this.core.key1,this.core2.arrays.indices);h&&c.aVertex.bindArrayBuffer(h),h=this.core.getPickPositions(this.core.key2,this.core2.arrays.indices),h&&c.aMorphVertex.bindArrayBuffer(h),c.aTriColor&&c.aTriColor.bindArrayBuffer(this.core2.getPickColors())}else c.aVertex&&(c.aVertex.bindArrayBuffer(this.core2.vertexBuf),this.core2.indexBuf.bind());else c.aVertex&&c.aVertex.bindArrayBuffer(this.core2.getPickPositions()),c.aTriColor&&c.aTriColor.bindArrayBuffer(this.core2.getPickColors());else{if(d.VAO&&b.VAO){if(b.VAO.bindVertexArrayOES(d.VAO),!e)return;if(d.morphKey1==this.core.key1&&d.morphKey2==this.core.key2)return}else b.VAO&&(b.VAO.bindVertexArrayOES(null),d.VAO=b.VAO.createVertexArrayOES(),b.VAO.bindVertexArrayOES(d.VAO));if(e)this.morphDraw(c,d,b);else{if(c.aVertex&&(c.aVertex.bindArrayBuffer(this.core2.vertexBuf),b.bindArray++),c.aNormal&&(c.aNormal.bindArrayBuffer(this.core2.normalBuf),b.bindArray++),c.aUV)for(var i,f=0,g=c.aUV.length;g>f;f++)i=this.core2.uvBufs[f],i&&c.aUV[f]&&(c.aUV[f].bindArrayBuffer(i),b.bindArray++);c.aColor&&(c.aColor.bindArrayBuffer(this.core2.colorBuf),b.bindArray++),c.aPointScaleRotation&&(c.aPointScaleRotation.bindArrayBuffer(this.core2.pointScaleRotationBuf),b.bindArray++),c.aPointUVTranslate&&(c.aPointUVTranslate.bindArrayBuffer(this.core2.pointUVTranslateBuf),b.bindArray++),c.aTangent&&b.hasNormalMap&&(c.aTangent.bindArrayBuffer(this.core2.getTangents(0)),b.bindArray++)}if(c.aRegionMapUV){var j=b.regionMapUVLayerIdx;if(j>=0){var k=this.core2.uvBufs;j<k.length&&(c.aRegionMapUV.bindArrayBuffer(k[j]),b.bindArray++)}}this.core2.indexBuf&&this.core2.indexBuf.bind()}},SceneJS_ChunkFactory.addChunkType("geometry",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.build()};a.prototype.build=function(){this.materialCore=this.cores[0],this.textureCore=this.cores[1],this.fresnelCore=this.cores[2],this.cubemapCore=this.cores[3];var a=this.program.draw,b=this.handles.draw={},c=(this.program.drawTexture,this.handles.drawTexture={});if(this.materialCore&&(b.uMaterialBaseColor=a.getUniform("SCENEJS_uMaterialColor"),b.uMaterialSpecularColor=a.getUniform("SCENEJS_uMaterialSpecularColor"),b.uMaterialEmitColor=a.getUniform("SCENEJS_uMaterialEmitColor"),b.uMaterialShine=a.getUniform("SCENEJS_uMaterialShine"),b.uMetalRoughSpecularf0=a.getUniform("SCENEJS_uMetalRoughSpecularf0")),this.textureCore){b.uTexSampler=[],b.uTexMatrix=[],b.uTexBlendFactor=[];var d=this.textureCore.layers;if(d){for(var e,a=this.program.draw,f=0,g=d.length;g>f;f++)e=d[f],b.uTexSampler[f]="SCENEJS_uSampler"+f,b.uTexMatrix[f]=a.getUniform("SCENEJS_uLayer"+f+"Matrix"),b.uTexBlendFactor[f]=a.getUniform("SCENEJS_uLayer"+f+"BlendFactor");c.uDrawSampler="SCENEJS_uDrawSampler"}}if(this.fresnelCore){var h=this.fresnelCore;h.diffuse&&(b.uDiffuseFresnelCenterColor=a.getUniform("SCENEJS_uDiffuseFresnelCenterColor"),b.uDiffuseFresnelEdgeColor=a.getUniform("SCENEJS_uDiffuseFresnelEdgeColor"),b.uDiffuseFresnelPower=a.getUniform("SCENEJS_uDiffuseFresnelPower")),h.specular&&(b.uSpecularFresnelCenterColor=a.getUniform("SCENEJS_uSpecularFresnelCenterColor"),b.uSpecularFresnelEdgeColor=a.getUniform("SCENEJS_uSpecularFresnelEdgeColor"),b.uSpecularFresnelPower=a.getUniform("SCENEJS_uSpecularFresnelPower")),h.alpha&&(b.uAlphaFresnelCenterColor=a.getUniform("SCENEJS_uAlphaFresnelCenterColor"),b.uAlphaFresnelEdgeColor=a.getUniform("SCENEJS_uAlphaFresnelEdgeColor"),b.uAlphaFresnelPower=a.getUniform("SCENEJS_uAlphaFresnelPower")),h.transparency&&(b.uTransparencyFresnelCenterColor=a.getUniform("SCENEJS_uTransparencyFresnelCenterColor"),b.uTransparencyFresnelEdgeColor=a.getUniform("SCENEJS_uTransparencyFresnelEdgeColor"),b.uTransparencyFresnelPower=a.getUniform("SCENEJS_uTransparencyFresnelPower")),h.reflect&&(b.uReflectFresnelCenterColor=a.getUniform("SCENEJS_uReflectFresnelCenterColor"),b.uReflectFresnelEdgeColor=a.getUniform("SCENEJS_uReflectFresnelEdgeColor"),b.uReflectFresnelPower=a.getUniform("SCENEJS_uReflectFresnelPower")),h.emit&&(b.uEmitFresnelCenterColor=a.getUniform("SCENEJS_uEmitFresnelCenterColor"),b.uEmitFresnelEdgeColor=a.getUniform("SCENEJS_uEmitFresnelEdgeColor"),b.uEmitFresnelPower=a.getUniform("SCENEJS_uEmitFresnelPower")),h.fragment&&(b.uFragmentFresnelCenterColor=a.getUniform("SCENEJS_uFragmentFresnelCenterColor"),b.uFragmentFresnelEdgeColor=a.getUniform("SCENEJS_uFragmentFresnelEdgeColor"),b.uFragmentFresnelPower=a.getUniform("SCENEJS_uFragmentFresnelPower"))}if(this.cubemapCore){var d=this.cubemapCore.layers;if(b.uCubeMapSampler=new Array(d.length),b.uCubeMapIntensity=new Array(d.length),b.uCubeMapMipLevels=new Array(d.length),d)for(var e,a=this.program.draw,f=0,g=d.length;g>f;f++)e=d[f],b.uCubeMapSampler[f]="SCENEJS_uCubeMapSampler"+f,b.uCubeMapIntensity[f]=a.getUniform("SCENEJS_uCubeMapIntensity"+f),b.uCubeMapMipLevels[f]=a.getUniform("SCENEJS_uCubeMapMipLevels"+f)}},a.prototype.draw=function(a,b){var c=(this.program.gl,this.handles[a]);if(this.materialCore&&(c.uMaterialBaseColor&&c.uMaterialBaseColor.setValue(this.materialCore.baseColor),c.uMaterialSpecularColor&&c.uMaterialSpecularColor.setValue(this.materialCore.specularColor),c.uMaterialEmitColor&&c.uMaterialEmitColor.setValue(this.materialCore.emitColor),c.uMaterialSpecular&&c.uMaterialSpecular.setValue(this.materialCore.specular),c.uMaterialShine&&c.uMaterialShine.setValue(this.materialCore.shine),c.uMaterialEmit&&c.uMaterialEmit.setValue(this.materialCore.emit),c.uMaterialAlpha&&c.uMaterialAlpha.setValue(this.materialCore.alpha),c.uMetalRoughSpecularf0&&c.uMetalRoughSpecularf0.setValue(this.materialCore.metalRoughspecularf0)),this.textureCore){b.hasNormalMap=!1;var d=this.textureCore.layers;if(d){var e,f=this.program[a];if(c.uTexSampler)for(var g=0,h=d.length;h>g;g++)e=d[g],c.uTexSampler[g]&&e.texture&&(f.bindTexture(c.uTexSampler[g],e.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,e._matrixDirty&&e.buildMatrix&&e.buildMatrix.call(e),c.uTexMatrix&&c.uTexMatrix[g]&&c.uTexMatrix[g].setValue(e.matrixAsArray),c.uTexBlendFactor&&c.uTexBlendFactor[g]&&c.uTexBlendFactor[g].setValue(e.blendFactor),b.hasNormalMap=b.hasNormalMap||e.isNormalMap);if(c.uDrawSampler){var i=this.textureCore.drawLayerIndex,j=d[i];f.bindTexture(c.uDrawSampler,j.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS}}b.texture=this.textureCore}if(this.fresnelCore){var k=this.fresnelCore;k.diffuse&&(c.uDiffuseFresnelCenterColor&&c.uDiffuseFresnelCenterColor.setValue(k.diffuse.centerColor),c.uDiffuseFresnelEdgeColor&&c.uDiffuseFresnelEdgeColor.setValue(k.diffuse.edgeColor),c.uDiffuseFresnelPower&&c.uDiffuseFresnelPower.setValue(k.diffuse.power)),k.specular&&(c.uSpecularFresnelCenterColor&&c.uSpecularFresnelCenterColor.setValue(k.specular.centerColor),c.uSpecularFresnelEdgeColor&&c.uSpecularFresnelEdgeColor.setValue(k.specular.edgeColor),c.uSpecularFresnelPower&&c.uSpecularFresnelPower.setValue(k.specular.power)),k.alpha&&(c.uAlphaFresnelCenterColor&&c.uAlphaFresnelCenterColor.setValue(k.alpha.centerColor),c.uAlphaFresnelEdgeColor&&c.uAlphaFresnelEdgeColor.setValue(k.alpha.edgeColor),c.uAlphaFresnelPower&&c.uAlphaFresnelPower.setValue(k.alpha.power)),k.transparency&&(c.uTransparencyFresnelCenterColor&&c.uTransparencyFresnelCenterColor.setValue(k.transparency.centerColor),c.uTransparencyFresnelEdgeColor&&c.uTransparencyFresnelEdgeColor.setValue(k.transparency.edgeColor),c.uTransparencyFresnelPower&&c.uTransparencyFresnelPower.setValue(k.transparency.power)),k.reflect&&(c.uReflectFresnelCenterColor&&c.uReflectFresnelCenterColor.setValue(k.reflect.centerColor),c.uReflectFresnelEdgeColor&&c.uReflectFresnelEdgeColor.setValue(k.reflect.edgeColor),c.uReflectFresnelPower&&c.uReflectFresnelPower.setValue(k.reflect.power)),k.emit&&(c.uEmitFresnelCenterColor&&c.uEmitFresnelCenterColor.setValue(k.emit.centerColor),c.uEmitFresnelEdgeColor&&c.uEmitFresnelEdgeColor.setValue(k.emit.edgeColor),c.uEmitFresnelPower&&c.uEmitFresnelPower.setValue(k.emit.power)),k.fragment&&(c.uFragmentFresnelCenterColor&&c.uFragmentFresnelCenterColor.setValue(k.fragment.centerColor),c.uFragmentFresnelEdgeColor&&c.uFragmentFresnelEdgeColor.setValue(k.fragment.edgeColor),c.uFragmentFresnelPower&&c.uFragmentFresnelPower.setValue(k.fragment.power))}if(this.cubemapCore){var d=this.cubemapCore.layers;if(d){var e,f=this.program[a];if(c.uCubeMapSampler)for(var g=0,h=d.length;h>g;g++)e=d[g],c.uCubeMapSampler[g]&&e.texture&&(f.bindTexture(c.uCubeMapSampler[g],e.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,c.uCubeMapIntensity[g]&&c.uCubeMapIntensity[g].setValue(e.intensity),c.uCubeMapMipLevels[g]&&c.uCubeMapMipLevels[g].setValue(e.mipLevels))}}},SceneJS_ChunkFactory.addChunkType("material",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.numLights=0,this.numClips=0,this.build()};a.prototype.build=function(){var a=this.program.draw,b=this.program.xray,c=this.program.pick,d=this.program.pickTriangle,e=this.program.depth,f=this.program.drawTexture;this.handles.draw={uPMatrix:a.getUniform("SCENEJS_uPMatrix"),uvMatrix:a.getUniform("SCENEJS_uVMatrix"),uWorldEye:a.getUniform("SCENEJS_uWorldEye"),uFogParams:a.getUniform("SCENEJS_uFogParams"),uFogColor:a.getUniform("SCENEJS_uFogColor"),uCanvasRes:a.getUniform("SCENEJS_uCanvasRes"),uAmbientColor:a.getUniform("SCENEJS_uAmbientColor"),uLightColor:[],uLightDir:[],uLightPos:[],uLightCutOff:[],uLightSpotExp:[],uLightAttenuation:[],uInnerCone:[],uOuterCone:[],uClipNormalAndDist:[],uClipFadeDistance:[],uPBRLightMapIntensity:a.getUniform("SCENEJS_uPBRLightMapIntensity"),uPBRLightMapMipLevels:a.getUniform("SCENEJS_uPBRLightMapMipLevels"),uPBRReflectionMapIntensity:a.getUniform("SCENEJS_uPBRReflectionMapIntensity"),uPBRReflectionMapMipLevels:a.getUniform("SCENEJS_uPBRReflectionMapMipLevels")};var g=this.program;for(this.numLights=0;;){var h=a.getUniform("SCENEJS_uLightColor"+this.numLights);if(!h)break;this.handles.draw.uLightColor[this.numLights]=h,this.handles.draw.uLightPos[this.numLights]=g.draw.getUniform("SCENEJS_uLightPos"+this.numLights),this.handles.draw.uLightDir[this.numLights]=g.draw.getUniform("SCENEJS_uLightDir"+this.numLights),this.handles.draw.uLightAttenuation[this.numLights]=g.draw.getUniform("SCENEJS_uLightAttenuation"+this.numLights),this.handles.draw.uInnerCone[this.numLights]=g.draw.getUniform("SCENEJS_uInnerCone"+this.numLights),this.handles.draw.uOuterCone[this.numLights]=g.draw.getUniform("SCENEJS_uOuterCone"+this.numLights),++this.numLights}for(this.handles.xray={uPMatrix:b.getUniform("SCENEJS_uPMatrix"),uvMatrix:b.getUniform("SCENEJS_uVMatrix"),uWorldEye:b.getUniform("SCENEJS_uWorldEye"),uFogParams:b.getUniform("SCENEJS_uFogParams"),uFogColor:b.getUniform("SCENEJS_uFogColor"),uXrayColor:b.getUniform("SCENEJS_uXrayColor"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pick={pickMode:c.getUniform("SCENEJS_uPickMode"),uPMatrix:c.getUniform("SCENEJS_uPMatrix"),uvMatrix:c.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pickTriangle={uPMatrix:d.getUniform("SCENEJS_uPMatrix"),uvMatrix:d.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.depth={uPMatrix:e.getUniform("SCENEJS_uPMatrix"),uvMatrix:e.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.drawTexture={uPMatrix:f.getUniform("SCENEJS_uPMatrix"),uvMatrix:f.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.numClips=0;;){var i=a.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips);if(!i)break;this.handles.draw.uClipNormalAndDist[this.numClips]=i,this.handles.draw.uClipFadeDistance[this.numClips]=a.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.xray.uClipNormalAndDist[this.numClips]=b.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.xray.uClipFadeDistance[this.numClips]=b.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pick.uClipNormalAndDist[this.numClips]=c.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pick.uClipFadeDistance[this.numClips]=c.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pickTriangle.uClipNormalAndDist[this.numClips]=d.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pickTriangle.uClipFadeDistance[this.numClips]=d.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.depth.uClipNormalAndDist[this.numClips]=e.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.depth.uClipFadeDistance[this.numClips]=e.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.drawTexture.uClipNormalAndDist[this.numClips]=f.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.drawTexture.uClipFadeDistance[this.numClips]=f.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),++this.numClips}var j=a.gl,k=j.createTexture();j.bindTexture(j.TEXTURE_2D,k),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,1,1,0,j.RGBA,j.UNSIGNED_BYTE,new Uint8Array(4)),this.dummyDepthTexture={texture:k,gl:j,bind:function(a){return this.texture?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0):!1},unbind:function(a){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},j.bindTexture(j.TEXTURE_2D,null)},a.prototype.draw=function(a,b){this.program[a].bind();var c=this.handles[a];b.textureUnit=0;var d=this.program.gl;if(c.depthMode&&c.depthMode.setValue(b.depthMode),!b.VAO)for(var e=0;10>e;e++)d.disableVertexAttribArray(e);if(c.uPMatrix&&c.uPMatrix.setValue(b.projectionMatrix),c.uvMatrix&&c.uvMatrix.setValue(b.viewMatrix),c.uWorldEye&&c.uWorldEye.setValue(b.cameraEye),c.uAmbientColor&&c.uAmbientColor.setValue(b.ambientColor),c.uLightColor)for(var e=0;e<this.numLights;++e){var f=b.lights[e];c.uLightColor[e]&&c.uLightColor[e].setValue(f.color),c.uLightPos[e]&&(c.uLightPos[e].setValue(f.pos),c.uLightAttenuation[e]&&c.uLightAttenuation[e].setValue(f.attenuation)),c.uLightDir[e]&&c.uLightDir[e].setValue(f.dir),c.uInnerCone[e]&&c.uInnerCone[e].setValue(f.innerCone),c.uOuterCone[e]&&c.uOuterCone[e].setValue(f.outerCone)}if(this.numClips>0)for(var e=0;e<this.numClips;++e){var g=b.clips.clips[e];c.uClipNormalAndDist[e]&&c.uClipNormalAndDist[e].setValue(g.normalAndDist),c.uClipFadeDistance[e]&&c.uClipFadeDistance[e].setValue(g.fadeDistance)}b.reflection&&b.reflection.texture&&(this.program[a].bindTexture("SCENEJS_uPBRReflectionMapSampler",b.reflection.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,c.uPBRReflectionMapIntensity&&c.uPBRReflectionMapIntensity.setValue(b.reflection.intensity),c.uPBRReflectionMapMipLevels&&c.uPBRReflectionMapMipLevels.setValue(b.reflection.mipLevels)),b.lightmap&&b.lightmap.texture&&(this.program[a].bindTexture("SCENEJS_uPBRLightMapSampler",b.lightmap.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,c.uPBRLightMapIntensity&&c.uPBRLightMapIntensity.setValue(b.lightmap.intensity),c.uPBRLightMapMipLevels&&c.uPBRLightMapMipLevels.setValue(b.lightmap.mipLevels)),c.uFogParams&&c.uFogParams.setValue(b.fogParams),c.uFogColor&&c.uFogColor.setValue(b.fogColor),c.uXrayColor&&c.uXrayColor.setValue(b.xrayColor);var h=b.depthBuffer||this.dummyDepthTexture;this.program[a].bindTexture("SCENEJS_uDepthBuffer",h,b.textureUnit),
b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,c.uCanvasRes&&c.uCanvasRes.setValue(b.canvasResolution),c.pickMode&&c.pickMode.setValue(b.pickObject?0:2),b.useProgram++},SceneJS_ChunkFactory.addChunkType("program",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.build()};a.prototype.build=function(){this.core=this.cores[0],this.handles.draw={uRegionMapRegionColor:this.program.draw.getUniform("SCENEJS_uRegionMapRegionColor"),uRegionMapHighlightFactor:this.program.draw.getUniform("SCENEJS_uRegionMapHighlightFactor"),uRegionMapHideAlpha:this.program.draw.getUniform("SCENEJS_uRegionMapHideAlpha")},this.sampleName="SCENEJS_uRegionMapSampler"},a.prototype.draw=function(a,b){var c=this.core.texture,d=this.handles[a]||{};c?(b.regionData=this.core.regionData,this.program.draw.bindTexture(this.sampleName,c,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,d.uRegionMapRegionColor&&d.uRegionMapRegionColor.setValue(this.core.regionColor),d.uRegionMapHighlightFactor&&d.uRegionMapHighlightFactor.setValue(this.core.highlightFactor),d.uRegionMapHideAlpha&&d.uRegionMapHideAlpha.setValue(this.core.hideAlpha),b.regionMapUVLayerIdx=this.core.uvLayerIdx):b.regionMapUVLayerIdx=-1},SceneJS_ChunkFactory.addChunkType("regionMap",a)}(),function(){function a(a){var b,c,d;a.size?(b=a.size[0],c=a.size[1],d=a.size[2]):(b=a.xSize||1,c=a.ySize||1,d=a.zSize||1);var e="geometry/box_"+b+"_"+c+"_"+d+(a.wire?"wire":"_solid");return this.getScene().hasCore("geometry",e)?{type:"geometry",coreId:e}:{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:e,positions:new Float32Array([b,c,d,-b,c,d,-b,-c,d,b,-c,d,b,c,d,b,-c,d,b,-c,-d,b,c,-d,b,c,d,b,c,-d,-b,c,-d,-b,c,d,-b,c,d,-b,c,-d,-b,-c,-d,-b,-c,d,-b,-c,-d,b,-c,-d,b,-c,d,-b,-c,d,b,-c,-d,-b,-c,-d,-b,c,-d,b,c,-d]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),uv:new Float32Array([b,c,0,c,0,0,b,0,0,c,0,0,b,0,b,c,b,0,b,c,0,c,0,0,b,c,0,c,0,0,b,0,0,0,b,0,b,c,0,c,0,0,b,0,b,c,0,c]),indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}SceneJS.Types.addType("geometry/box",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b="geometry/quad"+(a.wire?"wire":"_solid");return this.getScene().hasCore("geometry",b)?{type:"geometry",coreId:b}:{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:b,positions:[1,1,0,-1,1,0,-1,-1,0,1,-1,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3]}}SceneJS.Types.addType("geometry/quad",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b=a.latitudeBands||30,c=a.longitudeBands||30,d=a.radius||1,e="geometry/sphere_"+(a.wire?"wire":"_solid")+d+"_"+c+"_"+b;if(this.getScene().hasCore("geometry",e))return{type:"geometry",coreId:e};for(var f=[],g=[],h=[],i=0;b>=i;i++)for(var j=i*Math.PI/b,k=Math.sin(j),l=Math.cos(j),m=0;c>=m;m++){var n=2*m*Math.PI/c,o=Math.sin(n),p=Math.cos(n),q=p*k,r=l,s=o*k,t=m/c,u=i/b;g.push(q),g.push(r),g.push(s),h.push(t),h.push(u),f.push(d*q),f.push(d*r),f.push(d*s)}for(var v=[],i=0;b>i;i++)for(var m=0;c>m;m++){var w=i*(c+1)+m,x=w+c+1;v.push(w+1),v.push(x+1),v.push(x),v.push(w+1),v.push(x),v.push(w)}return{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:e,positions:new Float32Array(f),normals:new Float32Array(g),uv:new Float32Array(h),indices:v}}SceneJS.Types.addType("geometry/sphere",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b=a.width||1,c=a.height||1,d=a.widthSegments||1,e=a.heightSegments||1,f="geometry/plane_"+(1==a.wire?"wire_":"")+c+"_"+d+"_"+e;if(this.getScene().hasCore("geometry",f))return{type:"geometry",coreId:f};var g,h,i,j,k=[],l=[],m=[],n=[],o=b/2,p=c/2,q=d,r=e,s=q+1,t=r+1,u=b/q,v=c/r;for(h=0;t>h;h++)for(g=0;s>g;g++)i=g*u-o,j=h*v-p,k.push(i),k.push(-j),k.push(0),l.push(0),l.push(0),l.push(1),m.push(g/q),m.push(1-h/r);var w,x,y,z;for(h=0;r>h;h++)for(g=0;q>g;g++)w=g+s*h,x=g+s*(h+1),y=g+1+s*(h+1),z=g+1+s*h,n.push(w),n.push(x),n.push(y),n.push(y),n.push(z),n.push(w);return{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:f,positions:new Float32Array(k),normals:new Float32Array(l),uv:new Float32Array(m),indices:n}}SceneJS.Types.addType("geometry/plane",{construct:function(b){this.addNode(a.call(this,b))}})}(),-function(a){var b=a.GrowingPacker=function(){};b.prototype={fit:function(a){var b,c,d,e=a.length,f=e>0?a[0].w:0,g=e>0?a[0].h:0;for(this.root={x:0,y:0,w:f,h:g},b=0;e>b;b++)d=a[b],d.fit=(c=this.findNode(this.root,d.w,d.h))?this.splitNode(c,d.w,d.h):this.growNode(d.w,d.h)},findNode:function(a,b,c){return a.used?this.findNode(a.right,b,c)||this.findNode(a.down,b,c):b<=a.w&&c<=a.h?a:null},splitNode:function(a,b,c){return a.used=!0,a.down={x:a.x,y:a.y+c,w:a.w,h:a.h-c},a.right={x:a.x+b,y:a.y,w:a.w-b,h:c},a},growNode:function(a,b){var c=a<=this.root.w,d=b<=this.root.h,e=d&&this.root.h>=this.root.w+a,f=c&&this.root.w>=this.root.h+b;return e?this.growRight(a,b):f?this.growDown(a,b):d?this.growRight(a,b):c?this.growDown(a,b):null},growRight:function(a,b){return this.root={used:!0,x:0,y:0,w:this.root.w+a,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:a,h:this.root.h}},(node=this.findNode(this.root,a,b))?this.splitNode(node,a,b):null},growDown:function(a,b){return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+b,down:{x:0,y:this.root.h,w:this.root.w,h:b},right:this.root},(node=this.findNode(this.root,a,b))?this.splitNode(node,a,b):null}}}("undefined"!=typeof window?window:module.exports),function(){"use strict";var a=window.Human={},b="17.1.3";b=b.indexOf("ENGINE_VERSION")>0?"qa":b;var c="2.0.1";c=c.indexOf("API_VERSION")>0?"qa":c,a.VERSION=b,a.API_VERSION=c,a.deployed=!(window.location.hostname.match(/(localhost|192\.168\.11\.\d{1,3})/)||"file:"===window.location.protocol),a.locale="en-US",a.timer=window.performance||window.Date,a.stats={trackingDownloadSize:!1,jsonDownloadTotal:0,geometryDownloadTotal:0,textureDownloadTotal:0,jsonDownloadSizes:{},geometryDownloadSizes:{},textureDownloadSizes:{},loadSequence:{startTime:a.timer.now(),moduleRequest:0,moduleLoaded:0,assetsRequested:0,assetsLoaded:0,texturesRequested:0,texturesLoaded:0},loadTimes:{preModule:0,moduleDownload:0,preAsset:0,assetDownload:0,preTexture:0,textureDownload:0},trackDownloadSize:function(){window.pako&&(this.trackingDownloadSize=!0)}},a.canvasId="theCanvas",a.annotationCanvasId="annotationCanvas",a.containerId="container",a.XML_HTTP_JSON_SUPPORTED=function(){var a=new XMLHttpRequest;return a.open("GET","/"),a.responseType="json","json"===a.responseType}(),a.ELEMENT_REMOVE_SUPPORTED="function"==typeof Element.prototype.remove,SceneJS.bind("error",function(b){a._error("WEBGL",b.errorName,b.exception,!0)}),a.error=function(b,c){return void 0===c&&(c=b,b="ERROR"),a._error("HUMAN",b,c,!1)},a.fatalError=function(b,c){return void 0===c&&(c=b,b="ERROR"),a._error("HUMAN",b,c,!0)},a._error=function(b,c,d,e){return a.events.fire("error",{type:b,name:c,message:d,fatal:e,log:a.log.messages.join("\n"),stack:a.utils.getStackTrace(),webglInfo:SceneJS.WEBGL_INFO}),d}}(),function(){"use strict";Human.Component=function(){},Human.Component.prototype={_init:function(a){this._ctx=a,this._handleMap=new Human.utils.Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},publish:function(a,b,c){c||(this._topicPubs[a]=b);var d=this._topicSubs[a];if(d)for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)},on:function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),d},off:function(a,b){var c,d;if(b){c=a,d=this._topicSubs[c];for(var e in d)if(d[e]===b){a=e;break}}else c=this._handleTopics[a];c&&(delete this._handleTopics[a],d=this._topicSubs[c],d&&delete d[a],this._handleMap.removeItem(a))},once:function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})}}}(),function(){"use strict";var a=Human.math={X_AXIS:vec3.fromValues(1,0,0),Y_AXIS:vec3.fromValues(0,1,0),Z_AXIS:vec3.fromValues(0,0,1),VEC3_ZEROS:vec3.fromValues(0,0,0),VEC3_ONES:vec3.fromValues(1,1,1),TO_RADIANS:Math.PI/180},b=vec3.create(),c=vec3.create();a.clamp=function(a,b,c){return b>a?b:a>c?c:a},a.nextPowerOf2=function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))},a.sign=function(a){return a>0?1:0>a?-1:0},a.lerpScalar=function(a,b,c,d,e){var f=(a-b)/(c-b);return d+f*(e-d)},a.lerpVec3=function(a,b,c,d,e,f){f=f||vec3.create();var g=(a-b)/(c-b);return f[0]=d[0]+g*(e[0]-d[0]),f[1]=d[1]+g*(e[1]-d[1]),f[2]=d[2]+g*(e[2]-d[2]),f},a.triangleNormal=function(a,d,e,f){var g=b,h=c;return vec3.subtract(g,d,a),vec3.subtract(h,e,a),vec3.cross(f,g,h),vec3.normalize(f,f),f},a.getShortRotation=function(a,b){var c=b>a?1:-1,d=(b-a)*c;return d=(d+Math.PI)%(2*Math.PI)-Math.PI,d*c},a.lerpRadian=function(b,c,d){var e=a.getShortRotation(c,d),f=c+b*e;return f},a.lerpVec3Cylindrical=function(b,c,d,e,f,g){g=g||vec3.create();var h=(b-c)/(d-c);return g[0]=e[0]+h*(f[0]-e[0]),g[1]=a.lerpRadian(h,e[1],f[1]),g[2]=e[2]+h*(f[2]-e[2]),g},Human.math.decompressPosition=function(a,b,c){a[0]=b[0]*c[0]+c[12],a[1]=b[1]*c[5]+c[13],a[2]=b[2]*c[10]+c[14]},Human.math.decompressUV=function(a,b,c){a[0]=b[0]*c[0]+c[6],a[1]=b[1]*c[4]+c[7]},Human.math.vec3ObjToArray=function(a,b){var c=b||vec3.create();return c[0]=a.x||0,c[1]=a.y||0,c[2]=a.z||0,c},Human.math.vec3ArrayToObj=function(a){return{x:a[0],y:a[1],z:a[2]}},a.cartesianToCylindrical=function(a,b){var c=b||vec3.create();return c[0]=Math.sqrt(a[0]*a[0]+a[2]*a[2]),c[1]=Math.atan2(a[0],a[2]),c[2]=a[1],c},a.cylindricalToCartesian=function(a,b){var c=b||vec3.create();return c[0]=a[0]*Math.sin(a[1]),c[1]=a[2],c[2]=a[0]*Math.cos(a[1]),c},a.AxisBox3=function(a,b){this.verts=[[a[0],a[1],a[2]],[b[0],a[1],a[2]],[b[0],b[1],a[2]],[a[0],b[1],a[2]],[a[0],a[1],b[2]],[b[0],a[1],b[2]],[b[0],b[1],b[2]],[a[0],b[1],b[2]]]},a.easeOut=function(a,b,c){var d=a*a,e=d*a;return b+c*(-1*d*d+4*e+-6*d+4*a)},a.easeIn=function(b,c,d){return 1-a.easeOut(1-b,c,d)},a.easeInOut=function(b,c,d){return.5>b?a.easeIn(2*b,c,d)/2:.5*a.easeOut(2*b-1,c,d)+.5},a.getBoundaryCenter=function(a,b){var c=b||vec3.create();return c[0]=.5*(a.xmax+a.xmin),c[1]=.5*(a.ymax+a.ymin),c[2]=.5*(a.zmax+a.zmin),c};var d=vec3.create();a.getBoundaryDiag=function(a){return d[0]=a.xmax-a.xmin,d[1]=a.ymax-a.ymin,d[2]=a.zmax-a.zmin,vec3.length(d)};var e=mat4.create(),f=mat4.create(),g=mat4.create(),h=mat4.create(),i=mat4.create();a.buildRotationScaleMat3=function(a,b,c){return b=b||this.VEC3_ZEROS,c=c||this.VEC3_ONES,mat4.fromScaling(e,c),mat4.fromZRotation(f,b[2]*this.TO_RADIANS),mat4.fromYRotation(g,b[1]*this.TO_RADIANS),mat4.fromXRotation(h,b[0]*this.TO_RADIANS),mat4.multiply(i,h,e),mat4.multiply(i,g,i),mat4.multiply(i,f,i),mat3.fromMat4(a,i)}}(),function(){"use strict";function a(a,b,c,d,e){"undefined"==typeof e&&(e=.5);var f=i.projectionratio(e,a),g=1-f,h={x:f*b.x+g*d.x,y:f*b.y+g*d.y},j=i.abcratio(e,a),k={x:c.x+(c.x-h.x)/j,y:c.y+(c.y-h.y)/j};return{A:k,B:c,C:h}}var b=Math.abs,c=Math.cos,d=Math.sin,e=Math.atan2,f=Math.sqrt,g=Math.pow,h={x:0,y:0,z:0},i={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(a,b){var c=b(a),d=c.x*c.x+c.y*c.y;return"undefined"!=typeof c.z&&(d+=c.z*c.z),f(d)},length:function(a){var b,c,d=.5,e=0,f=i.Tvalues.length;for(b=0;f>b;b++)c=d*i.Tvalues[b]+d,e+=i.Cvalues[b]*i.arcfn(c,a);return d*e},map:function(a,b,c,d,e){var f=c-b,g=e-d,h=a-b,i=h/f;return d+g*i},lerp:function(a,b,c){var d={x:b.x+a*(c.x-b.x),y:b.y+a*(c.y-b.y)};return b.z&&c.z&&(d.z=b.z+a*(c.z-b.z)),d},pointToString:function(a){var b=a.x+"/"+a.y;return"undefined"!=typeof a.z&&(b+="/"+a.z),b},pointsToString:function(a){return"["+a.map(i.pointToString).join(", ")+"]"},angle:function(a,b,c){var d,g=b.x-a.x,h=b.y-a.y,i=c.x-a.x,j=c.y-a.y,k=g*j-h*i,l=f(g*g+h*h),m=f(i*i+j*j);return g/=l,h/=l,i/=m,j/=m,d=g*i+h*j,e(k,d)},dist:function(a,b){var c=a.x-b.x,d=a.y-b.y;return f(c*c+d*d)},abcratio:function(a,c){if(2!==c&&3!==c)return!1;if("undefined"==typeof a)a=.5;else if(0===a||1===a)return a;var d=g(a,c)+g(1-a,c),e=d-1;return b(e/d)},projectionratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"==typeof a)a=.5;else if(0===a||1===a)return a;var c=g(1-a,b),d=g(a,b)+c;return c/d},align:function(a,b){var f=b.p1.x,g=b.p1.y,h=-e(b.p2.y-g,b.p2.x-f),i=function(a){return{x:(a.x-f)*c(h)-(a.y-g)*d(h),y:(a.x-f)*d(h)+(a.y-g)*c(h)}};return a.map(i)}},j=Human.math.bezier=function(a){var c=a&&a.forEach?a:[].slice.call(arguments),d=!1;if("object"==typeof c[0]){d=c.length;var e=[];c.forEach(function(a){["x","y","z"].forEach(function(b){"undefined"!=typeof a[b]&&e.push(a[b])})}),c=e}var f=!1,g=c.length;if(d){if(d>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");f=!0}}else if(6!==g&&8!==g&&9!==g&&12!==g&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var h=!f&&(9===g||12===g)||a&&a[0]&&"undefined"!=typeof a[0].z;this._3d=h;for(var j=[],k=0,l=h?3:2;g>k;k+=l){var m={x:c[k],y:c[k+1]};h&&(m.z=c[k+2]),j.push(m)}this.order=j.length-1,this.points=j;var n=["x","y"];h&&n.push("z"),this.dims=n,this.dimlen=n.length,function(a){for(var c=i.align(j,{p1:j[0],p2:j[a.order]}),d=0;d<c.length;d++)if(b(c[d].y)>1e-4)return void(a._linear=!1);a._linear=!0}(this),this._t1=0,this._t2=1,this.update()};j.quadraticFromPoints=function(b,c,d,e){if("undefined"==typeof e&&(e=.5),0===e)return new j(c,c,d);if(1===e)return new j(b,c,c);var f=a(2,b,c,d,e);return new j(b,f.A,d)},j.cubicFromPoints=function(b,c,d,e,f){"undefined"==typeof e&&(e=.5);var g=a(3,b,c,d,e);"undefined"==typeof f&&(f=i.dist(c,g.C));var h=f*(1-e)/e,k=i.dist(b,d),l=(d.x-b.x)/k,m=(d.y-b.y)/k,n=f*l,o=f*m,p=h*l,q=h*m,r={x:c.x-n,y:c.y-o},s={x:c.x+p,y:c.y+q},t=g.A,u={x:t.x+(r.x-t.x)/(1-e),y:t.y+(r.y-t.y)/(1-e)},v={x:t.x+(s.x-t.x)/e,y:t.y+(s.y-t.y)/e},w={x:b.x+(u.x-b.x)/e,y:b.y+(u.y-b.y)/e},x={x:d.x+(v.x-d.x)/(1-e),y:d.y+(v.y-d.y)/(1-e)};return new j(b,w,x,d)},j.prototype={valueOf:function(){return this.toString()},toString:function(){return i.pointsToString(this.points)},update:function(){this.dpoints=[];for(var a=this.points,b=a.length,c=b-1;b>1;b--,c--){for(var d,e=[],f=0;c>f;f++)d={x:c*(a[f+1].x-a[f].x),y:c*(a[f+1].y-a[f].y)},this._3d&&(d.z=c*(a[f+1].z-a[f].z)),e.push(d);this.dpoints.push(e),a=e}this.computedirection()},computedirection:function(){var a=this.points,b=i.angle(a[0],a[this.order],a[1]);this.clockwise=b>0},length:function(){return i.length(this.derivative.bind(this))},_lut:[],getLUT:function(a){if(a=a||100,this._lut.length===a)return this._lut;this._lut=[];for(var b=0;a>=b;b++)this._lut.push(this.compute(b/a));return this._lut},on:function(a,b){b=b||5;for(var c,d=this.getLUT(),e=[],f=0,g=0;g<d.length;g++)c=d[g],i.dist(c,a)<b&&(e.push(c),f+=g/d.length);return e.length?f/=e.length:!1},get:function(a){return this.compute(a)},point:function(a){return this.points[a]},compute:function(a){if(0===a)return this.points[0];if(1===a)return this.points[this.order];var b,c=this.points,d=1-a;if(1===this.order)return b={x:d*c[0].x+a*c[1].x,y:d*c[0].y+a*c[1].y},this._3d&&(b.z=d*c[0].z+a*c[1].z),b;if(this.order<4){var e,f,g,i=d*d,j=a*a,k=0;return 2===this.order?(c=[c[0],c[1],c[2],h],e=i,f=d*a*2,g=j):3===this.order&&(e=i*d,f=i*a*3,g=d*j*3,k=a*j),b={x:e*c[0].x+f*c[1].x+g*c[2].x+k*c[3].x,y:e*c[0].y+f*c[1].y+g*c[2].y+k*c[3].y},this._3d&&(b.z=e*c[0].z+f*c[1].z+g*c[2].z+k*c[3].z),b}for(var l=JSON.parse(JSON.stringify(this.points));l.length>1;){for(var m=0;m<l.length-1;m++)l[m]={x:l[m].x+(l[m+1].x-l[m].x)*a,y:l[m].y+(l[m+1].y-l[m].y)*a},"undefined"!=typeof l[m].z&&(l[m]=l[m].z+(l[m+1].z-l[m].z)*a);l.splice(l.length-1,1)}return l[0]},derivative:function(a){var b,c,d=1-a,e=0,f=this.dpoints[0];2===this.order&&(f=[f[0],f[1],h],b=d,c=a),3===this.order&&(b=d*d,c=d*a*2,e=a*a);var g={x:b*f[0].x+c*f[1].x+e*f[2].x,y:b*f[0].y+c*f[1].y+e*f[2].y};return this._3d&&(g.z=b*f[0].z+c*f[1].z+e*f[2].z),g}}}(),function(){"use strict";function a(b,c,d,e,f){if(!h.rayAabb(b,c,d.bb.min,d.bb.max))return 0;if(d.triangles){for(var g=d.triangles,i=0,j=0,k=g.length;k>j;++j)e.getTrianglePositionOnSurface(3*g[j],z,A,B),h.rayTriangle(b,c,z,A,B,f)&&(f&&(f.triangleIndex=g[j]),++i);return i}return a(b,c,d.left,e,f)+a(b,c,d.right,e,f)}function b(a,c,d,e,f){if(!d.left){for(var g=d.objects,i=0,j=g.length;j>i;++i){var k=g[i],l=k.objectId;(!e||e(k))&&h.rayObjectAabb(a,c,l,y)&&f.push({object:k,tmin:y[0],tmax:y[1]})}return f}return h.rayAabb(a,c,d.bb.min,d.bb.max)?(b(a,c,d.left,e,f),b(a,c,d.right,e,f),f):f}function c(a,b){return a.t-b.t}function d(a,b){return a.tmin-b.tmin}function e(a,b,c){var d=[],e=a.getObject();if(!e)return d;for(C.length=0,C.push(e.getKdTree());C.length>0;){var f=C.pop();if(b(f)&&(f.left&&C.push(f.left),f.right&&C.push(f.right),f.triangles))for(var g=0,h=f.triangles.length;h>g;++g)e.getTrianglePositionOnSurface(3*f.triangles[g],z,A,B),c(z,A,B)&&d.push(f.triangles[g])}return d}function f(a,b,c,d,e){vec3.subtract(D,c,a),vec3.subtract(E,b,a),vec3.cross(F,E,D),vec3.cross(H,F,E);var f=vec3.length(D);f*=f,vec3.scale(H,H,f),vec3.cross(I,D,F);var g=vec3.length(E);g*=g,vec3.scale(I,I,g),vec3.add(H,H,I);var h=vec3.length(F);h*=h,vec3.scale(G,H,1/(2*h));var i=vec3.length(G);vec3.add(J,a,G),vec3.subtract(K,d,J);var j=vec3.length(K);return i+e>=j?!0:!1}function g(a,b,c,d,e){var f=e*e,g=a[0]-d[0],h=a[1]-d[1],i=a[2]-d[2],j=g*g+h*h+i*i;return j>f?!1:(g=b[0]-d[0],h=b[1]-d[1],i=b[2]-d[2],j=g*g+h*h+i*i,j>f?!1:(g=c[0]-d[0],h=c[1]-d[1],i=c[2]-d[2],j=g*g+h*h+i*i,j>f?!1:!0))}var h=Human.math.intersections={},i=1e-8,j=vec3.create(),k=vec3.create(),l=[new Float32Array([1,0,0]),new Float32Array([0,1,0]),new Float32Array([0,0,1]),new Float32Array([-1,0,0]),new Float32Array([0,-1,0])];h.pointAabb=function(a,b,c){return a[0]<b[0]?!1:a[0]>c[0]?!1:a[1]<b[1]?!1:a[1]>c[1]?!1:a[2]<b[2]?!1:a[2]>c[2]?!1:!0},h.aabbAabb=function(a,b,c,d){return b[0]<c[0]?!1:d[0]<a[0]?!1:b[1]<c[1]?!1:d[1]<a[1]?!1:b[2]<c[2]?!1:d[2]<a[2]?!1:!0},h.rayAabb=function(a,b,c,d,e){for(var f=0,g=Number.POSITIVE_INFINITY,h=Math.abs,j=Math.min,k=Math.max,l=0;3>l;++l)if(h(b[l])<i){if(a[l]<c[l]||a[l]>d[l])return!1}else{var m=(c[l]-a[l])/b[l],n=(d[l]-a[l])/b[l];if(m>n){var o=m;m=n,n=o}if(f=k(f,m),g=j(g,n),f>g)return!1}return e&&(e[0]=f,e[1]=g),!0};var m=new Float32Array(3),n=new Float32Array(3),o=new Float32Array(3),p=new Float32Array(3),q=new Float32Array(3);h.rayTriangle=function(a,b,c,d,e,f){vec3.sub(m,d,c),vec3.sub(n,e,c),vec3.cross(p,b,n);var g=vec3.dot(p,m);if(g>-i&&i>g)return!1;var h=1/g;vec3.sub(o,a,c);var j=h*vec3.dot(p,o);if(0>j||j>1)return!1;vec3.cross(q,o,m);var k=h*vec3.dot(q,b);if(0>k||j+k>1)return!1;var l=h*vec3.dot(q,n);return i>l?!1:(f&&l<f.t&&(f.u=j,f.v=k,f.w=1-j-k,f.t=l),!0)},h.pointPolyhedron=function(b,c){var d=0,e=0,f=c.getObject();if(!f)return!1;for(var g=0,h=l.length;h>g;++g)a(b,l[g],f.getKdTree(),f)%2===1?++d:++e;return d>e},h.rayPolyhedron=function(b,c,d,e){var f=d.getObject();return f?(e=e||{t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1},a(b,c,f.getKdTree(),f,e)>0?e:null):null},h.planeAabb=function(a,b,c,d){var e=d[0],f=d[1],g=d[2];if(a[0]>=0&&(e=c[0]),a[1]>=0&&(f=c[1]),a[2]>=0&&(g=c[2]),e*a[0]+f*a[1]+g*a[2]+b>0)return-1;var h=c[0],i=c[1],j=c[2];return a[0]>=0&&(h=d[0]),a[1]>=0&&(i=d[1]),a[2]>=0&&(j=d[2]),h*a[0]+i*a[1]+j*a[2]+b>0?0:1},h.planesAabb=function(a,b,c,d){for(var e=1,f=a.length,g=0;f>g;++g){var h=a[g],i=this.planeAabb(h.n,h.d,b,c);if(d&&(d[g]=i),1>i&&(e=i),-1===e)break}if(d&&f>g)for(var j=5;j>g;--j)d[j]=void 0;return e};var r=mat4.create(),s=mat3.create(),t=vec3.create(),u=vec3.create(),v=vec3.create(),w=vec3.create(),x=vec3.create();h.pointObject=function(a,b){var c=Human.scene.objects[b],d=c.getBoundary();if(w[0]=d.xmin,w[1]=d.ymin,w[2]=d.zmin,x[0]=d.xmax,x[1]=d.ymax,x[2]=d.zmax,!this.pointAabb(a,w,x))return!1;mat4.invert(r,c.getWorldMatrix()),vec3.transformMat4(t,a,r);for(var e=0,f=c.renderables.length;f>e;++e){var g=c.renderables[e];if(d=g.boundary,w[0]=d.xmin,w[1]=d.ymin,w[2]=d.zmin,x[0]=d.xmax,x[1]=d.ymax,x[2]=d.zmax,this.pointAabb(t,w,x)){var h=g.geometryNode;if(h&&this.pointPolyhedron(t,h))return!0}}return!1},h.rayObjectAabb=function(a,b,c,d){var e=Human.scene.objects[c],f=e.getBoundary();return w[0]=f.xmin,w[1]=f.ymin,w[2]=f.zmin,x[0]=f.xmax,x[1]=f.ymax,x[2]=f.zmax,this.rayAabb(a,b,w,x,d)},h.rayObject=function(a,b,c,d,e){var f=Human.scene.objects[c];if(!this.rayObjectAabb(a,b,c))return null;mat4.invert(r,f.getWorldMatrix()),vec3.transformMat4(u,a,r),mat3.fromMat4(s,r),vec3.transformMat3(v,b,s);for(var g=0,h=f.renderables.length;h>g;++g){var i=f.renderables[g];if(!e||e(i)){var j=i.boundary;if(w[0]=j.xmin,w[1]=j.ymin,w[2]=j.zmin,x[0]=j.xmax,x[1]=j.ymax,x[2]=j.zmax,this.rayAabb(u,v,w,x)){var k=i.geometryNode;if(k){var l=this.rayPolyhedron(u,v,k,d);if(l)return l}}}}return null},h.raySceneAabb=function(a,c,e){var f=[];return b(a,c,Human.scene.getKdTree(),e,f),f.length>0?(f.sort(d),f):null},h.rayScene=function(a,b,d,e){var f=[],g=this.raySceneAabb(a,b,d);if(g)for(var h=0,i=g.length;i>h;++h){var j=g[h].object.objectId,k={t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1,objectId:j};this.rayObject(a,b,j,k,e)&&f.push(k)}return f.length>0?(f.sort(c),f):null},h.spherePolyhedron=function(a,b,c){var d=j,g=k;return d[0]=b[0]-c,d[1]=b[1]-c,d[2]=b[2]-c,g[0]=b[0]+c,g[1]=b[1]+c,g[2]=b[2]+c,e(a,function(a){return h.aabbAabb(a.bb.min,a.bb.max,d,g)},function(a,d,e){return f(a,d,e,b,c)})},h.sphereInPolyhedron=function(a,b,c){var d=j,f=k;return d[0]=b[0]-c,d[1]=b[1]-c,d[2]=b[2]-c,f[0]=b[0]+c,f[1]=b[1]+c,f[2]=b[2]+c,e(a,function(a){return h.aabbAabb(a.bb.min,a.bb.max,d,f)},function(a,d,e){return g(a,d,e,b,c)})};var y=new Float32Array(2),z=new Float32Array(3),A=new Float32Array(3),B=new Float32Array(3),C=[],D=new Float32Array(3),E=new Float32Array(3),F=new Float32Array(3),G=new Float32Array(3),H=new Float32Array(3),I=new Float32Array(3),J=new Float32Array(3),K=new Float32Array(3)}(),function(){"use strict";function a(a,b){return b>a?-1:a>b?1:0}function b(a,b,c,d){function e(){200===h.status?c(h.response):d&&d(new Error("Failed network request ("+a+"): "+h.status+" - "+h.statusText))}function g(){var b=a.endsWith("-etc1.pvr")&&new DataView(h.response).getInt32(0)!==f;b?d(new Error("Failed offline PVR get request: "+h.status+" - "+h.statusText)):c(h.response)}var h=new XMLHttpRequest;h.open("GET",a,!0),h.timeout=0,h.responseType=b,h.onerror=function(){d(new Error("Failed request ("+a+"): "+h.status+" - "+h.statusText))},h.onload=window.localContentOnly?g:e,h.send(null)}function c(a,b){if(a){var d=a.bb.min,e=a.bb.max,f=d[0],g=d[1],h=d[2],i=e[0],j=e[1],k=e[2];b.addNode({type:"geometry",primitive:"lines",positions:[f,j,h,i,j,h,i,j,h,i,g,h,i,g,h,f,g,h,f,g,h,f,j,h,f,j,h,f,j,k,i,j,h,i,j,k,f,g,h,f,g,k,i,g,h,i,g,k,f,j,k,i,j,k,i,j,k,i,g,k,i,g,k,f,g,k,f,g,k,f,j,k]}),c(a.left,b),c(a.right,b)}}function d(a,b,c){b++,c.numNodes++;var e=a.triangles||a.objects;e?(c.numLeaves++,c.numObjects+=e.length,c.depthSum+=b):(d(a.left,b,c),d(a.right,b,c))}Human.utils=Human.utils||{};var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],f=1347834371;Human.utils.leftPad=function(a,b,c){for(;a.length<c;)a=b+a;return a},Human.utils.toHexString=function(a){for(var b="";a>0;)b=e[15&a]+b,a>>=4;return b},Human.utils.floatRGBToHexString=function(a,b,c){var d=this.leftPad(this.toHexString(Math.floor(255*a)),"0",2),e=this.leftPad(this.toHexString(Math.floor(255*b)),"0",2),f=this.leftPad(this.toHexString(Math.floor(255*c)),"0",2);return"#"+d+e+f},Human.utils.isArray=function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},Human.utils.isObject=function(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)},Human.utils.isPrimitive=function(a){return null===a||!!(typeof a).match(/^(string|number|boolean|undefined)$/)},Human.utils.isString=function(a){return"string"==typeof a||a instanceof String},Human.utils.filterInPlace=function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)b(a[d])?a[d-c]=a[d]:c++;return a.length=a.length-c,a},Human.utils.getStackTrace=function(){var a,b=new Error;if(b.stack)a=b.stack;else try{throw b}catch(c){a=c.stack}return a||null},Human.utils.extend=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},Human.utils.apply=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},Human.utils.applyIf=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0===b[c]||null===b[c])&&(b[c]=a[c]);return b},Human.utils.applyIf2=function(a,b){a=a||{};var c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=void 0!==a[d]?a[d]:b[d]);return c},Human.utils.shallowClone=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},Human.utils.deepClone=function(a){if(null===a||void 0===a||"string"==typeof a||"number"==typeof a||"boolean"==typeof a)return a;var b;if(Array.isArray(a)){b=new Array(a.length);for(var c=0,d=a.length;d>c;++c)b[c]=Human.utils.deepClone(a[c]);return b}b={};for(var e in a)b[e]=Human.utils.deepClone(a[e]);return b},Human.utils.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},Human.utils.getDir=function(a){var b=a.lastIndexOf("/");return b>-1?a.substring(0,b>0?b+1:0):""},Human.utils.async=function(a){setTimeout(a,0)},Human.utils.noop=function(){},Human.utils.getKeys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},Human.utils.createUUID=function(){for(var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],b=["8","9","A","B"],c=[],d=0;38>d;d++)switch(d){case 8:c.push("-");break;case 13:c.push("-");break;case 18:c.push("-");break;case 14:c.push("4");break;case 19:c.push(b[Math.round(3*Math.random())]);break;default:c.push(a[Math.round(15*Math.random())])}return c.join("")},Human.utils.binarySearch=function(b,c,d,e){d=d||a,e=e||{index1:null,index2:null,value1:null,value2:null};var f,g,h,i=0,j=b.length-1;if(d(b[0],c)>0)return e.index1=null,e.value1=null,e.index2=0,e.value2=b[0],e;if(d(b[j],c)<0)return e.index1=j,e.value1=b[j],e.index2=null,e.value2=null,e;for(;j>=i;){if(f=Math.floor((i+j)/2),g=b[f],h=b[f+1],d(g,c)<=0&&d(h,c)>=0)return e.index1=f,e.index2=f+1,e.value1=g,e.value2=h,e;d(g,c)>0?j=f-1:i=f+1}},Human.utils.atos=function(a,b,c){b=b||0,c=c||a.byteLength;var d=new Uint8Array(a,b,c),e=new TextDecoder("utf-8").decode(d);return e},Human.utils.atoj=function(a,b,c){return JSON.parse(Human.utils.atos(a,b,c))},Human.utils.benchmark=function(a,b){b=b||1e7;for(var c=performance.now(),d=0;b>d;d++)a();c=performance.now()-c,console.log("Total time: "+c.toFixed(3)+"ms"),console.log("Time / operation: "+(c/b).toExponential(3)+"ms")},Human.utils.setRandomVisibleObjects=function(a){for(var b=Object.keys(Human.scene.objects).filter(function(a){return Human.scene.objects[a].isLeaf()}),c={},d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c[b.splice(e,1)]=!0}Human.scene.setEnabledObjects({objectIds:c,replace:!0})},Human.utils.getText=function(a,c,d){b(a,"text",c,d)},Human.utils.getJSON=Human.XML_HTTP_JSON_SUPPORTED?function(a,c,d){b(a,"json",c,d)}:function(a,b,c){this.getText(a,function(a){b(JSON.parse(a))},c)},Human.utils.getBinary=function(a,c,d){b(a,"arraybuffer",c,d)},Human.utils.elementVisible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},Human.utils.removeElement=Human.ELEMENT_REMOVE_SUPPORTED?function(a){a.remove()}:function(a){null!==a.parentNode&&a.parentNode.removeChild(a)},Human.utils.boundaryToScreen=function(a){var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=[a.xmin,a.ymin,a.zmin,1],g=[a.xmin,a.ymin,a.zmax,1],h=[a.xmin,a.ymax,a.zmin,1],i=[a.xmin,a.ymax,a.zmax,1],j=[a.xmax,a.ymin,a.zmin,1],k=[a.xmax,a.ymin,a.zmax,1],l=[a.xmax,a.ymax,a.zmin,1],m=[a.xmax,a.ymax,a.zmax,1],n=Human.renderer.getViewMat(),o=Human.renderer.getProjMat(),p=mat4.create();mat4.multiply(p,o,n),vec4.transformMat4(f,f,p),b=Math.min(b,f[0]/f[3]),c=Math.max(c,f[0]/f[3]),d=Math.min(d,f[1]/f[3]),e=Math.max(e,f[1]/f[3]),vec4.transformMat4(g,g,p),b=Math.min(b,g[0]/g[3]),c=Math.max(c,g[0]/g[3]),d=Math.min(d,g[1]/g[3]),e=Math.max(e,g[1]/g[3]),vec4.transformMat4(h,h,p),b=Math.min(b,h[0]/h[3]),c=Math.max(c,h[0]/h[3]),d=Math.min(d,h[1]/h[3]),e=Math.max(e,h[1]/h[3]),vec4.transformMat4(i,i,p),b=Math.min(b,i[0]/i[3]),c=Math.max(c,i[0]/i[3]),d=Math.min(d,i[1]/i[3]),e=Math.max(e,i[1]/i[3]),vec4.transformMat4(j,j,p),b=Math.min(b,j[0]/j[3]),c=Math.max(c,j[0]/j[3]),d=Math.min(d,j[1]/j[3]),e=Math.max(e,j[1]/j[3]),vec4.transformMat4(k,k,p),b=Math.min(b,k[0]/k[3]),c=Math.max(c,k[0]/k[3]),d=Math.min(d,k[1]/k[3]),e=Math.max(e,k[1]/k[3]),vec4.transformMat4(l,l,p),b=Math.min(b,l[0]/l[3]),c=Math.max(c,l[0]/l[3]),d=Math.min(d,l[1]/l[3]),e=Math.max(e,l[1]/l[3]),vec4.transformMat4(m,m,p),b=Math.min(b,m[0]/m[3]),c=Math.max(c,m[0]/m[3]),d=Math.min(d,m[1]/m[3]),e=Math.max(e,m[1]/m[3]);var q=Human.renderer.canvas.canvas[0],r=(.5*b+.5)*q.width,s=(.5*c+.5)*q.width,t=q.height-(.5*e+.5)*q.height,u=q.height-(.5*d+.5)*q.height,v=(s-r)*(u-t);return{min:[r,t],max:[s,u],pixelCoverage:v}},Human.utils.visibleAssetReport=function(){var a={totalVertices:0,totalTriangles:0,objectStats:{},geometryStats:{},textureStats:{},objectsByTrianglesPerPixel:null,objectsByTexelsPerPixel:null,geometriesByTriangleCount:null,texturesBySize:null},b=Human.scene.objects,c=Object.keys(Human.scene.enabledObjects).filter(function(a){return!!Human.scene.objects[a].geometry&&!!Human.scene.objects[a].material});a.objectsByTrianglesPerPixel=new Array(c.length),a.objectsByTexelsPerPixel=new Array(c.length);for(var d=a.geometryStats,e=a.textureStats,f=0,g=c.length;g>f;++f){for(var h=c[f],i=b[h],j=i.geometry._core.arrays,k=j.positions.length/3,l=j.indices.length/3,m=i.material.textures||[],n=new Array(m.length),o=0;o<m.length;++o){var p=m[o]._core,q=p.compressedSrc||p.src||p.uri;n[o]=e[q]=e[q]||{src:q,width:p.width,height:p.height,objectIds:[],count:0,atlasSharing:0,atlas:!1,adjustedTexels:p.width*p.height},e[q].count++;for(var r=!0,s=0,t=e[q].objectIds.length;t>s;++s){var u=b[e[q].objectIds[s]].geometryId;u!==i.geometryId&&(e[q].atlas=!0),u===i.geometryId&&(r=!1)}r&&e[q].atlasSharing++,e[q].objectIds.push(h)}i._setBoundaryDirty();var v=Human.utils.boundaryToScreen(i.getBoundary());a.totalVertices+=k,a.totalTriangles+=l,a.objectsByTexelsPerPixel[f]=a.objectsByTrianglesPerPixel[f]=a.objectStats[h]={objectId:h,vertices:k,triangles:l,textures:n,canvasBounds:{min:v.min,max:v.max},pixelCoverage:v.pixelCoverage,trianglesPerPixel:l/v.pixelCoverage,texelsPerPixel:0},d[i.geometryId]=d[i.geometryId]||{geometryId:i.geometryId,vertices:k,triangles:l,totalVertices:0,totalTriangles:0,objectIds:[],count:0},d[i.geometryId].count++,d[i.geometryId].totalVertices+=k,d[i.geometryId].totalTriangles+=l,d[i.geometryId].objectIds.push(h)}return Object.keys(e).forEach(function(a){
var b=e[a];b.atlas&&(b.adjustedTexels/=b.atlasSharing)}),a.objectsByTrianglesPerPixel.sort(function(a,b){return b.trianglesPerPixel-a.trianglesPerPixel}),a.objectsByTexelsPerPixel.filter(function(a){return a.textures.length>0}).forEach(function(a){var b=a.textures;b.sort(function(a,b){return b.adjustedTexels-a.adjustedTexels}),a.texelsPerPixel=a.textures[0].adjustedTexels/a.pixelCoverage}),a.objectsByTexelsPerPixel.sort(function(a,b){return b.texelsPerPixel-a.texelsPerPixel}),a.geometriesByTriangleCount=Object.keys(d).map(function(a){return d[a]}).sort(function(a,b){return b.triangles*b.count-a.triangles*a.count}),a.texturesBySize=Object.keys(e).map(function(a){return e[a]}).sort(function(a,b){return b.adjustedTexels-a.adjustedTexels}),a},Human.utils.textGzipSize=function(a){if(window.pako){var b=(new TextEncoder).encode(a);return pako.deflate(b).byteLength}return 0},Human.utils.binaryGzipSize=function(a){if(window.pako){var b=new Uint8Array(a);return pako.deflate(b).byteLength}return 0},Human.utils.drawKdTree=function(a,b){c(a,b)},Human.utils.kdTreeStats=function(a){var b={numNodes:0,numLeaves:0,numObjects:0,averageLeafObjects:0,depthSum:0,averageDepth:0};return d(a,0,b),b.averageDepth=b.depthSum/b.numLeaves,b.averageLeafObjects=b.numObjects/b.numLeaves,b},Human.utils.loadScript=function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,null!==b&&(d.onload=b),c.appendChild(d)}}(),Human.utils.Map=function(a,b){"use strict";this.items=a||[];var c=b||0,d=c;"number"!=typeof c&&(d=c+"0"),this.addItem=function(){var a;if(2===arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw"ID clash: '"+b+"'";return this.items[b]=a,b}for(;;){a=arguments[0];var e;if("number"==typeof c?e=d++:(e=c+parseInt(d.substr(c.length)),d=c+(parseInt(d.substr(c.length))+1)),!this.items[e])return this.items[e]=a,e}},this.removeItem=function(a){var b=this.items[a];return void 0!==b&&(delete this.items[a],d=a),b}},Human.utils.IDPool=function(a){"use strict";a=a||{};var b=a.prefix||"id",c=b.length,d=[],e={},f={};this.getId=function(a){if(a){if(e[a]||f[a])throw"ID already in use: "+a;return e[a]=!0,a}for(var c,g=0,h=d.length;h>g;g++)if(!d[g]&&(c=b+g,!e[c]))return d[g]=!0,f[c]=!0,c;return d.push(!0),c=b+(d.length-1),f[c]=!0,c},this.containsId=function(a){return void 0!==e[a]||void 0!==f[a]},this.putId=function(a){e[a]?delete e[a]:f[a]&&(d[parseInt(a.substr(c))]=!1,delete f[a])}},function(){"use strict";function a(a,b,c){var d,f,g=Object.create(null),h=[];if(a.forEach(function(a){d=e.call(a),g[d]||(g[d]={value:a,freq:1})}),b.forEach(function(a){d=e.call(a),g[d]?1===g[d].freq&&(g[d].freq=3):g[d]={value:a,freq:2}}),c){for(f in g)c(g[f].freq)&&h.push(g[f].value);return h}return g}var b=Human.utils.selection={},c=function(a){this.defunct="function"!=typeof a?c.defunct:function(){return!1},this.tokens=[],this.rules=[],this.remove=0,this.state=0,this.index=0,this.input=""};c.prototype.addRule=function(a,b,c){var d=a.global;if(!d){var e="g";a.multiline&&(e+="m"),a.ignoreCase&&(e+="i"),a=new RegExp(a.source,e)}return"[object Array]"!==Object.prototype.toString.call(c)&&(c=[0]),this.rules.push({pattern:a,global:d,action:b,start:c}),this},c.prototype.setInput=function(a){return this.remove=0,this.state=0,this.index=0,this.tokens.length=0,this.input=a,this},c.prototype.lex=function(){if(this.tokens.length)return this.tokens.shift();this.reject=!0;for(var a;this.index<=this.input.length;){for(var b=this.scan().splice(this.remove),c=this.index;b.length&&this.reject;){var d=b.shift(),e=d.result,f=d.length;if(this.index+=f,this.reject=!1,this.remove++,a=d.action.apply(this,e),this.reject)this.index=e.index;else if("undefined"!=typeof a)switch(Object.prototype.toString.call(a)){case"[object Array]":this.tokens=a.slice(1),a=a[0];default:return f&&(this.remove=0),a}}var g=this.input;if(c<g.length)if(this.reject){if(this.remove=0,a=this.defunct.call(this,g.charAt(this.index++)),"undefined"!=typeof a)return"[object Array]"===Object.prototype.toString.call(a)?(this.tokens=a.slice(1),a[0]):a}else this.index!==c&&(this.remove=0),this.reject=!0;else{if(!b.length)break;this.reject=!0}}},c.prototype.scan=function(){for(var a=[],b=0,c=this.state,d=this.index,e=this.input,f=0,g=this.rules.length;g>f;f++){var h=this.rules[f],i=h.start,j=i.length;if(!j||i.indexOf(c)>=0||c%2&&1===j&&!i[0]){var k=h.pattern;k.lastIndex=d;var l=k.exec(e);if(l&&l.index===d){var m=a.push({result:l,action:h.action,length:l[0].length});for(h.global&&(b=m);--m>b;){var n=m-1;if(a[m].length>a[n].length){var o=a[m];a[m]=a[n],a[n]=o}}}}}return a};var d=function(a){this.table=a};d.prototype.parse=function(a){for(var b,c=a.length,d=this.table,e=[],f=[],g=0;c>g;)switch(b=a[g++]){case"(":f.unshift(b);break;case")":for(;f.length&&(b=f.shift(),"("!==b);)e.push(b);if("("!==b)throw new Error("Mismatched parentheses.");break;default:if(d.hasOwnProperty(b)){for(;f.length;){var h=f[0];if("("===h)break;var i=d[b],j=i.precedence,k=d[h].precedence;if(j>k||j===k&&"right"===i.associativity)break;e.push(f.shift())}f.unshift(b)}else e.push(b)}for(;f.length;)b=f.shift(),"("!==b&&e.push(b);return e};var e,f=[];f.push(e=function(){return this});var g={};g.union=function(b,c){return a(b,c,function(){return!0})},g.intersection=function(b,c){return a(b,c,function(a){return 3===a})},g.difference=function(b,c){return a(b,c,function(a){return 3>a})},g.complement=function(b,c){return a(b,c,function(a){return 1===a})},g.equals=function(b,c){var d,e=0,f=Math.pow(2,53),g=a(b,c);for(d in g)e=Math.max(e,g[d].freq),f=Math.min(f,g[d].freq);return 3===f&&3===e};var h={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},i={"<AND>":function(a,b){return a&&b},"<OR>":function(a,b){return a||b},"<NOT>":function(a){return!a}};b.StringMatcher=function(){this.lexer=new c(function(){return!1}),this.parser=new d(h),this.operators=i,this.lexer.addRule(/[A-z0-9]+/i,function(a){return a}),this.lexer.addRule(/(<[A-Z]+>)/,function(a){return a}),this.lexer.addRule(/[\(\+\-\*\/\)]/,function(a){return a})},b.StringMatcher.prototype.parse=function(a){this.lexer.setInput(a);for(var b=[],c=this.lexer.lex();c;)b.push(c),c=this.lexer.lex();return this.parser.parse(b)},b.StringMatcher.prototype.match=function(a,b){var c,d,e=this.parse(b),f=[];return e.forEach(function(b){this.operators.hasOwnProperty(b)?"<NOT>"!==b?(c=f.pop(),f.push(this.operators[b](c))):(d=f.pop(),c=f.pop(),f.push(this.operators[b](c,d))):(b="("+b+")",f.push(!!a.match(new RegExp(b,"i"))))}),f[0]};var j={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},k={"<AND>":function(a,b){return g.intersection(a,b)},"<OR>":function(a,b){return g.union(a,b)},"<XOR>":function(a,b){return g.difference(a,b)},"<NOT>":function(a,b){return g.complement(a,b)}};b.GraphMatcher=function(){this.lexer=new c(function(){return!1}),this.parser=new d(j),this.operators=k,this.lexer.addRule(/[A-z0-9\-]+/i,function(a){return a}),this.lexer.addRule(/(<[A-Z]+>)/,function(a){return a}),this.lexer.addRule(/[\(\)]/,function(a){return a})},b.GraphMatcher.prototype.parse=function(a){this.lexer.setInput(a);for(var b=[],c=this.lexer.lex();c;)b.push(c),c=this.lexer.lex();return this.parser.parse(b)},b.GraphMatcher.prototype.match=function(a,b){var c,d,e=this.parse(b),f=[],g=this;return e.forEach(function(b){g.operators.hasOwnProperty(b)?(d=f.pop(),c=f.pop(),Array.isArray(c)||(c=a.access(c)),Array.isArray(d)||(d=a.access(d)),f.push(g.operators[b](c,d))):f.push(Array.isArray(b)?b:a.access(b))}),f[0]}}(),function(){"use strict";var a=Human.events={},b={},c=0,d=[{}],e={},f={},g=!1;a.addBinder=function(a,c){(b[a]||(b[a]=[])).push(c)},a.createChannel=function(b){var c=d.length;return d.push({}),b&&b.enabled&&a.enableChannel(c,b.enabled),c},a.enableChannel=function(a,b){e[a]=b},a.onEvent=a.on=function(){var a,g,h,i;if("number"==typeof arguments[0]){if(a=arguments[0],a>d.length-1)return void Human.log.error("Human_event.onEvent","Channel not created: "+a+" - should be created first with Human.events.createChannel");g=arguments[1],h=arguments[2],i=arguments[3]}else if("object"==typeof arguments[0]){var j=arguments[0];g=j.type,h=j.fn;var k=b[g];if(k)for(var l=j.mask||{},m=0,n=k.length;n>m;m++)k[m](l,h);a=void 0!==j.channel&&null!==j.channel?j.channel:c,i=j.options}else a=c,g=arguments[0],h=arguments[1],i=arguments[2];e[a]=i&&void 0!==i.enable&&null!==i.enable?i.enable:!0,i=i||{};var o=d[a];o||(o=d[a]={});var p=o[g];p||(p=[],o[g]=p);var q={fn:h,priority:void 0===i.priority?p.length:i.priority,once:i.once};for(m=0;m<p.length;m++)if(p[m].priority>q.priority)return void p.splice(m,0,q);p.push(q),f[g]&&q.fn(f[g])},a.once=function(b,c){a.on(b,c,{once:!0})},a.fireEvent=a.fire=function(a,b,c){if(!g){for(var h,i,j=0,k=d.length;k>j;j++)if(e[j]&&(h=d[j],i=h[a])){b||(b={});for(var l,m,n=0,o=i.length;o>n;n++)if(m=i[n])try{m.fn(b),m.once&&(l||(l=[]),l.push(n))}catch(p){Human.log.error(p)}if(l)for(n=l.length-1;n>=0;n--)i.splice(l[n],1)}c&&(f[a]=b)}},a.blockEvents=function(a){g=!0;try{a()}catch(b){Human.log.error(b.message)}g=!1},a.unEvent=a.off=function(a,b,e){if(void 0===e||null===e)e=c;else if(e>=d.length||0>e)throw"Channel does not exist: "+e;var f=d[e];f||(f=d[e]={});var g=f[a];g||(g=[],f[a]=g);for(var h=g.length;h--;)g[h].fn===b&&g.splice(h,1)}}(),function(){"use strict";var a=Human.properties={},b=new Human.utils.IDPool;a.properties={};var c={},d={},e={};a.subscribe=function(f){f=f||{};var g=f.propId;if(!g)return Human.log.error("Human.properties.subscribe","Param expected: propId"),null;var h=f.callback;if(!h)return Human.log.error("Human.properties.subscribe","Param expected: callback"),null;if(f.subId&&b.containsId(f.subId))return Human.log.error("Human.properties.subscribe","Subscription already exists with this ID: "+f.subId),null;var i,j=f.value,k=b.getId(f.subId),l=a.properties[g];return l?(i=d[g]||(d[g]={}),i[k]=h,j&&(a.properties[g]=j),c[k]=h,e[k]=g,h(j),k):(i=d[g]||(d[g]={}),i[k]=h,(void 0===j||null===j)&&(j={}),a.properties[g]=j,c[k]=h,e[k]=g,h(j),k)},a.resubscribe=function(b,f){var g=c[b];if(!g)return void Human.log.warn("Human.properties.resubscribe","Subscription not found: '"+b+"'");var h=e[b],i=a.properties[f];h&&i&&(d[h]&&delete d[h][b],(d[f]||(d[f]={}))[b]=g,e[b]=f,g(i))},a.set=function(b){var c,e;for(var f in b)if(b.hasOwnProperty(f)&&(c=b[f],a.properties[f]=c,e=d[f]))for(var g in e)e.hasOwnProperty(g)&&e[g](c)},a.unsubscribe=function(a){var b=e[a];b&&(delete e[a],delete d[b][a])},a.query=function(b){if(!b)return a.properties;var c;if(b){var d=new RegExp(b);c={};for(var e in a.properties)a.properties.hasOwnProperty(e)&&d.test(e)&&(c[e]=a.properties[e])}return c};var f={"annotations.margins":{top:80,left:50,right:50,bottom:50},"annotations.labelWidth":120,"annotations.horizontalLines":!1,"annotations.fadeoutAngle":100,"annotation.layout.labelWidth":100,"annotations.layout.type":"draggable","camera.optics.far":5e3,"camera.optics.fov":55,"camera.optics.near":.1,"camera.zoomLimits":{max:300,min:.01},"fog.color":[1,1,1],"fog.density":.01,"fog.enabled":!1,"fog.end":1e3,"fog.max":1,"fog.min":0,"fog.mode":1,"fog.start":0,"timeline.autoPlay.enabled":!1,"timeline.autoPlay.type":"play","timeline.chapterCamerasEnabled":!0,"timeline.prevNextMode":"scrub","ui.mouseWheel.capture":!0,"ui.zoom.mouseWheel.enabled":!0};a.getDefaults=function(a){return a?f[a]:Human.utils.shallowClone(f)},a.setDefaults=function(a){Human.utils.apply(a,f)},a.applyDefaults=function(){this.set(f)}}(),function(){"use strict";function a(a){return a.length<45?a+"                                                           ".substr(0,45-a.length):a}function b(a,b){var e=d[b].toUpperCase();c.messages.length>c.maxMessages&&c.messages.shift(),a="["+e+"]	"+a,c.messages.push(a)}var c=Human.log={};c.LOG_NONE=0,c.LOG_DEBUG=1,c.LOG_INFO=2,c.LOG_WARN=3,c.LOG_ERROR=4,c.messages=[],c.maxMessages=100;var d=["none","debug","info","warn","error"],e=c.messageBuf=[],f=200,g=c.LOG_WARN,h=c.reporters={};c.setLevel=function(a){g=a},c.getLevel=function(){return g},c.log=function(a,i){switch(i=void 0===i||null===i?c.INFO:i){case c.LOG_DEBUG:g<=c.LOG_DEBUG&&window.console&&window.console.debug&&(window.console.debug(a),b(a,i));break;case c.LOG_ERROR:g<=c.LOG_ERROR&&window.console&&window.console.error&&(window.console.error(a),b(a,i));break;case c.LOG_INFO:g<=c.LOG_INFO&&window.console&&window.console.info&&(window.console.info(a),b(a,i));break;case c.LOG_WARN:g<=c.LOG_WARN&&window.console&&window.console.warn&&(window.console.warn(a),b(a,i))}var j={message:a,level:d[i]};for(var k in h)h.hasOwnProperty(k)&&Human.events.fire(k,j);e.length>f&&(e.length=0,e.push({message:"Logging buffer exceeded max length of "+f+" - messages to this point were flushed",level:d[c.LOG_WARN]})),e.push(j)},c.debug=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_DEBUG)},c.error=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_ERROR)},c.info=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_INFO)},c.warn=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_WARN)},Human.events.on("error",function(a){c.error(a.message)})}(),function(){"use strict";var a,b,c,d=Human.request={};d.getHashStr=function(){return window.location.hash},d.getHashParams=function(){if(!b||a!==window.location.hash){b={};for(var c,d=window.location.hash.slice(1),e=d.split(","),f=0,g=e.length;g>f;f++)c=e[f].split("="),b[c[0]]=c[1];a=window.location.hash}return b},d.getHashParam=function(c){return b&&a===window.location.hash||d.getHashParams(),b[c]},d.getSearchStr=function(){return window.location.search},d.getSearchParams=function(){if(!c){c={};for(var a,b=window.location.search.slice(1),d=b.split("&"),e=0,f=d.length;f>e;e++)a=d[e].split("="),c[a[0]]=a[1]}return c},d.getSearchParam=function(a){return c||d.getSearchParams(),c[a]}}(),function(){"use strict";function a(a,b){this.procName=a,this.callId=b}function b(a,b,c){function d(b){if(!c||!e){e=!0;var d=h?h(b):b;null!==d&&a.setResult(d||{})}}var e=!1,f=c?"once":"on",g=b.events,h=b.map;b.init&&b.init();for(var i=0,j=g.length;j>i;i++)Human.events[f](g[i],d)}function c(a){return a&&"object"==typeof a?a===window?!1:"string"==typeof a.nodeName&&"function"==typeof a.querySelectorAll&&"function"==typeof a.getElementsByTagName?!1:"function"==typeof a.preventDefault&&"function"==typeof a.stopPropagation?!1:!0:!0}var d=Human.rpc={windowClientEnabled:!0},e=1e4;d._procedures={},d._eventMap={};var f=[],g=!1,h={},i=[];a.prototype.setResult=function(a){for(var b=0,c=f.length;c>b;b++)f[b](this.callId,a)},a.prototype.info=function(a){Human.log.info(this.procName,a)},a.prototype.warn=function(a){Human.log.warn(this.procName,a)},a.prototype.error=function(a){Human.log.error(this.procName,a)},d.define=function(b,c,e){d._procedures[b]&&Human.log.warn("Human.rpc.define","Redefining procedure: "+b),e=e||{},(e.hidden||g)&&(h[b]=!0),d._procedures[b]=function(d,e){c.call(new a(b,d),e||{})}},d.defineEvent=function(a,b){d._eventMap[a]&&Human.log.warn("Human.rpc.defineEvent","Redefining event: "+a),d._eventMap[a]=b||a},d.enableEvent=function(a,c,e){if(!d._eventMap[c])return void Human.log.warn("Human.rpc.enableEvent","Event: "+c+" not defined.");var f=d._eventMap[c];if("string"==typeof f){var g=e?"once":"on";Human.events[g](f,function(b){a.setResult(b)})}else b(a,f,e)},d.getProcedures=function(){var a=Object.keys(d._procedures);return Human.utils.filterInPlace(a,function(a){return!h[a]}),a},d.getEvents=function(){return["human.ready"].concat(Object.keys(d._eventMap))},d.hideDefinitions=function(a){g=!0;try{a()}finally{g=!1}},d.onResult=function(a){f.push(a)},d.call=function(a,b,c){var e=d._procedures[b];return e?void e(a,c):void Human.log.warn("Human.rpc.call","Target procedure not found: "+b)},d.log=function(a){i.length>e&&i.shift(),i.push({engine_version:Human.VERSION,api_version:Human.API_VERSION,identifier:a,category:a.split(".")[0]})},d.getLog=function(){return i},d.logPending=function(){return i.length>0},d.resetLog=function(){i.length=0},d.filterUnsafeProperties=function(a){if(!Human.utils.isObject(a))return a;var b={};for(var d in a)a.hasOwnProperty(d)&&c(a[d])&&(b[d]=a[d]);return b}}(),function(){"use strict";Human.rpc.define("human.info",function(){this.setResult({version:Human.VERSION,webglInfo:SceneJS.WEBGL_INFO,apiFunctions:Human.rpc.getProcedures().sort(),apiEvents:Human.rpc.getEvents().sort()})}),Human.rpc.defineEvent("human.error","error")}(),function(){"use strict";function a(a){a=Human.view.annotations.annotations[a.annotationId];var b=a.pin.marker;return{annotationId:a.annotationId,title:a.label.title,description:a.label.description,objectId:a.object?a.object.objectId:null,position:{x:b.pos[0],y:b.pos[1],z:b.pos[2]},canvasPosition:{x:b.canvasPos[0],y:b.canvasPos[1]},occludable:a.occludable,shown:a.pin.shown}}Human.rpc.define("annotations.info",function(){var b,c=Human.view.annotations.annotations,d={};for(var e in c)c.hasOwnProperty(e)&&(b=c[e],d[e]=a(b));this.setResult(d)}),Human.rpc.define("annotations.create",function(b){b.saved=b.saved!==!1,b.position&&(b.pos=b.position);var c=Human.view.annotations.createAnnotation(b);this.setResult(a(c))}),Human.rpc.define("annotations.update",function(a){Human.view.annotations.updateAnnotation(a.annotationId,a),this.setResult(!0)}),Human.rpc.define("annotations.show",function(a){var b=Human.view.annotations.annotations[a];b?b.setShown(!0):Human.view.annotations.setShown(!0),this.setResult(!0)}),Human.rpc.define("annotations.hide",function(a){var b=Human.view.annotations.annotations[a];b?b.setShown(!1):Human.view.annotations.setShown(!1),this.setResult(!0)}),Human.rpc.define("annotations.destroy",function(a){"string"==typeof a&&(a={annotationId:a});var b=Human.view.annotations.annotations[a.annotationId];b&&b.destroy(),this.setResult(!0)}),Human.rpc.defineEvent("annotations.created",{events:["annotations.created"],map:a}),Human.rpc.defineEvent("annotations.destroyed"),Human.rpc.defineEvent("annotations.shown",{events:["annotations.shown"],map:function(a){return a.shown?void 0:null}}),Human.rpc.defineEvent("annotations.hidden",{events:["annotations.shown"],map:function(a){return a.shown?null:void 0}})}(),function(){"use strict";function a(){var a=Human.renderer.camera.getLookAt();return{position:a.eye,target:a.look,up:a.up,zoom:Human.renderer.camera.getZoom()}}Human.rpc.define("camera.set",function(a){var b=this;a.position&&(a.eye=a.position),a.target&&(a.look=a.target),"direct"===a.animationStyle&&(a.cylindricalView=!1),a.animate?Human.renderer.camera.fly.flyTo(a,function(){b.setResult(!0)}):Human.renderer.camera.fly.jumpTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.orbit",function(a){a.yaw&&Human.renderer.camera.rotateY(a.yaw),a.pitch&&Human.renderer.camera.rotateX(a.pitch),this.setResult(!0)}),Human.rpc.define("camera.pan",function(a){Human.renderer.camera.pan({x:a.x||0,y:a.y||0,z:a.z||0}),this.setResult(!0)}),Human.rpc.define("camera.zoom",function(a){var b="number"==typeof a?a:a.factor;b=Math.max(0,Math.min(b||0,1)),Human.renderer.camera.setZoom(b),this.setResult(!0)}),Human.rpc.define("camera.path",function(a){var b=this;Human.renderer.camera.fly.flyAlongCurvePath(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.info",function(){this.setResult(a())}),Human.rpc.define("camera.reset",function(){var a=this;Human.init.resetCamera(function(){a.setResult(!0)})}),Human.rpc.defineEvent("camera.updated",{events:["camera.rested"],map:a})}(),Human.rpc.hideDefinitions(function(){"use strict";Human.rpc.define("apiEvents.on",function(a){Human.rpc.enableEvent(this,a,!1)}),Human.rpc.define("apiEvents.once",function(a){Human.rpc.enableEvent(this,a,!0)})}),function(){"use strict";Human.rpc.define("input.disable",function(){Human.input.setEnabled(!1)}),Human.rpc.define("input.enable",function(){Human.input.setEnabled(!0)})}(),function(){"use strict";function a(a){var b,c={},d=Human.rpc.fmaIds,e=Human.modules.MALE_STATE_ID,f=Human.modules.FEMALE_STATE_ID;for(var g in a)if(a.hasOwnProperty(g)){b=d[g];for(var h=0;h<b.length;h++){var i=Human.scene.objects[e+"-"+b[h]]||Human.scene.objects[f+"-"+b[h]];i&&(c[i.objectId]=a[g])}}return c}function b(a){if(!a)return null;var b={};return b.objectId=a.objectId,b.canvasPosition={x:a.canvasPos[0],y:a.canvasPos[1]},a.worldPos&&(b.position={x:a.worldPos[0],y:a.worldPos[1],z:a.worldPos[2]}),b.mode=a.mode,b}Human.rpc.define("scene.load",function(a){function b(a){var b=Human.modules.modules[a],c=[];for(var d in b.showObjects)b.showObjects.hasOwnProperty(d)&&b.showObjects[d]&&Human.scene.objects[d]&&c.push(Human.scene.objects[d]);return c}function c(a){Human.modules.deactivate(a,function(){var b=Human.modules.modules[a].rootObjects;Human.modules.unload(a,b,["tweens","reflections","lights","geometry","material","transform","morph"],function(){Human.modules.destroy(a)})})}var d=this,e=null,f=null;"string"==typeof a?".json"===a.slice(-5)?f=a:e=a:(f=a.moduleId,e=a.bookmarkId);for(var g in Human.modules.activeModules)Human.modules.activeModules.hasOwnProperty(g)&&c(g);if(e)Human.utils.getJSON("/search/bookmarks/data?be="+e,function(a){Human.bookmarks.restore(a.bookmark,function(){d.setResult(!0)})},function(){d.setResult(!1)});else if(f){var h=["material","tweens","reflections","lights","geometry","transform"],i=["morph"],j={camera:!0,cameraCallback:function(){var a=Human.timeline.activeRoot._nowBranch.id;Human.events.fire("chapter.camera.finished",{chapterId:a})},graph:!0,annotations:!1,properties:!0,time:!1,hotspots:!1};Human.modules.fetch(f,function(){var a=Human.modules.moduleData[f];Human.modules.create(f,a,function(){var c=b(f);Human.modules.activate(f,0,j,function(){Human.modules.load(f,c,h,function(){var b=0;a.animation&&(b=Human.timeline.parsePlayInstruction(a.animation).t),j.annotations=!0,j.graph=!1,Human.modules.activate(f,b,j,function(){Human.modules.load(f,c,i,function(){a.animation&&Human.timeline.play(a.animation),Human.events.fire("module.ready",{moduleId:f}),d.setResult(Human.modules.activeModules.hasOwnProperty(f)?!0:!1)})})})})})})}}),Human.rpc.define("scene.pick",function(a){var c;void 0!==a.x&&(a.canvasX=a.x),void 0!==a.y&&(a.canvasY=a.y),a.rayPick=a.rayPick!==!1,c=a.triggerActions?Human.renderer.pick.pick(a):Human.renderer.pick.queryPick(a),this.setResult(b(c))}),Human.rpc.define("scene.pickingMode",function(a){"dissect"===a?(Human.events.blockEvents(function(){Human.view.annotations.setEnabled(!1)}),Human.view.dissect.setEnabled(!0)):"annotate"===a?(Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1)}),Human.view.annotations.setEnabled(!0)):"highlight"===a?(Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)}),Human.view.highlight.setEnabled(!0)):"none"===a&&Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1),Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1)}),this.setResult(!0)}),Human.rpc.define("scene.selectionMode",function(a){"isolate"===a?(Human.events.blockEvents(function(){Human.view.highlight.setEnabled(!1)}),Human.view.isolate.setEnabled(!0)):"highlight"===a?(Human.events.blockEvents(function(){Human.view.isolate.setEnabled(!1)}),Human.view.highlight.setEnabled(!0)):"none"===a&&(Human.events.blockEvents(function(){Human.view.isolate.setEnabled(!1)}),Human.view.highlight.setEnabled(!1)),this.setResult(!0)}),Human.rpc.define("scene.enableXray",function(){Human.view.xray.setEnabled(!0),this.setResult(!0)}),Human.rpc.define("scene.disableXray",function(){Human.view.xray.setEnabled(!1),this.setResult(!0)}),Human.rpc.define("scene.showObjects",function(b){var c=!!b.replace;delete b.replace,b.fmaIds&&(b=a(b.fmaIds)),Human.scene.setEnabledObjects({objects:b,replace:c,fetchAssets:!0}),this.setResult(!0)}),Human.rpc.define("scene.selectObjects",function(b){var c=!!b.replace;delete b.replace,b.fmaIds&&(b=a(b.fmaIds)),Human.scene.setSelectedObjects({objects:b,replace:c}),this.setResult(!0)}),function(){function a(a,c){function d(a){c[a.objectId]||(c[a.objectId]=b(a))}for(var e=0,f=a.length;f>e;e++)a[e].traverseUp(d)}function b(a){var b={objectId:a.objectId,name:a.displayName||"",description:a.description||"",shown:a.shown,selected:a.selected};b.children=[];for(var c=0,d=a.objects.length;d>c;c++)b.children.push(a.objects[c].objectId);return b.parent=a.parent?a.parent.objectId:null,b}Human.rpc.define("scene.info",function(c){var d={},e=Human.modules.activeModules[Object.keys(Human.modules.activeModules)[0]];d.name=e?e.displayName:null;var f,g=d.objects={};if(c.objectId){var h=c.objectId;f=Human.scene.objects[h],f&&(g[f.objectId]=b(f))}else for(var i=0,j=Human.scene.rootObjects.length;j>i;i++)a(Human.scene.rootObjects[i].getRenderableObjects(),g);this.setResult(d)})}(),Human.rpc.define("scene.transformObject",function(a){var b=a.objectId,c=Human.scene.objects[b];c?(c.setTransform(a),this.setResult(!0)):(this.error("Scene object not found: '"+b+"'"),this.setResult(!1))}),Human.rpc.define("scene.colorObject",function(a){var b=a.objectId,c=Human.scene.objects[b];c?(void 0!==a.tintColor&&c.setTintColor&&c.setTintColor(a.tintColor[0],a.tintColor[1],a.tintColor[2]),void 0!==a.saturation&&c.setSaturation&&c.setSaturation(a.saturation),void 0!==a.brightness&&c.setBrightness&&c.setBrightness(a.brightness),void 0!==a.contrast&&c.setContrast&&c.setContrast(a.contrast),void 0!==a.highlight&&c.setHighlight&&c.setHighlight(a.highlight),void 0!==a.xray&&c.setXRay&&c.setXRay(a.xray),void 0!==a.opacity&&c.setOpacity&&c.setOpacity(a.opacity),this.setResult(!0)):(this.error("Scene object not found: '"+b+"'"),this.setResult(!1))}),Human.rpc.define("scene.uncolorObject",function(a){var b=a.objectId,c=Human.scene.objects[b];c&&(c.clearColorModifiers(),c.clearOpacityModifiers(),this.setResult(!0))}),Human.rpc.define("scene.getColor",function(a){var b=a.objectId,c=Human.scene.objects[b];if(c){var d=c.getProperties(),e={tintColor:d.tintColor&&d.tintColor.length?d.tintColor:[1,1,1],brightness:d.brightness,saturation:d.saturation,contrast:d.contrast,opacity:d.opacity};this.setResult(e)}else this.setResult({})}),Human.rpc.define("scene.enableHighlight",function(){Human.renderer.highlightColor=new Float32Array([1.5,1.5,.5]),this.setResult(!0)}),Human.rpc.define("scene.disableHighlight",function(){Human.renderer.highlightColor=new Float32Array([1,1,1]),this.setResult(!0)}),Human.rpc.define("scene.capture",function(){this.setResult(Human.bookmarks.capture())}),Human.rpc.define("scene.restore",function(a){var b=this;Human.bookmarks.restore(a,function(){b.setResult(!0)})}),Human.rpc.define("scene.reset",function(){var a=this;Human.init.reset(function(){a.setResult(!0)})}),Human.rpc.defineEvent("scene.objectsShown",{events:["scene.objectsShown"],map:function(a){return a.enabledObjectsUpdate}}),Human.rpc.defineEvent("scene.objectsSelected",{events:["scene.objectsSelected"],map:function(a){return a.selectedObjectsUpdate}}),Human.rpc.defineEvent("scene.restored","bookmarks.restored"),Human.rpc.defineEvent("scene.picked",{events:["pick.picked"],init:function(){Human.properties.set({"pick.alwaysRayPick":!0})},map:b});var c;Human.rpc.defineEvent("scene.pickingModeUpdated",{events:["highlight.toggled","dissect.toggled","annotations.toggled"],map:function(){var a;return Human.view.dissect.enabled?a="dissect":Human.view.annotations.enabled?a="annotate":Human.view.highlight.enabled&&(a="highlight"),a===c?null:(c=a,{pickingMode:c})}});var d;Human.rpc.defineEvent("scene.selectionModeUpdated",{events:["highlight.toggled","isolate.toggled"],map:function(){var a;return a=Human.view.isolate.enabled?"isolate":Human.view.highlight.enabled?"highlight":"none",a===d?null:(d=a,{selectionMode:d})}}),Human.rpc.defineEvent("scene.xrayEnabled",{events:["xray.toggled"],map:function(a){return a.enabled?void 0:null}}),Human.rpc.defineEvent("scene.xrayDisabled",{events:["xray.toggled"],map:function(a){return a.enabled?null:void 0}})}(),function(){"use strict";function a(){var a=Human.timeline.getTimeFrame();return{time:Human.timeline.time,startTime:a.firstTime,endTime:a.lastTime,chapters:Object.keys(Human.timeline.chapters),playing:Human.timeline.playing}}function b(a){var b=a.split(".json");return 2!==b.length||b[1].startsWith("_")?a:b[0]+".json_"+b[1]}Human.rpc.define("timeline.info",function(){this.setResult(a())}),Human.rpc.define("timeline.set",function(a){a.hasOwnProperty("chapterId")&&(a.chapterId=b(a.chapterId)),Human.timeline.scrub(a),this.setResult(!0)}),Human.rpc.define("timeline.play",function(a){a.hasOwnProperty("chapterId")&&(a.chapterId=b(a.chapterId)),a.time&&(a.startTime=a.time),a.chapterId&&(a.startChapterId=a.chapterId),Human.timeline.play(a),this.setResult(!0)}),Human.rpc.define("timeline.pause",function(){Human.timeline.pause(),this.setResult(!0)}),Human.rpc.define("timeline.previousChapter",function(){Human.timeline.prev(),this.setResult(!0)}),Human.rpc.define("timeline.nextChapter",function(){Human.timeline.next(),this.setResult(!0)}),Human.rpc.defineEvent("timeline.chapterTransition",{events:["timeline.chapters.activated"],map:function(a){return{previousChapter:a.oldChapterIndex,currentChapter:a.newChapterIndex,time:a.time}}})}(),Human.rpc.hideDefinitions(function(){"use strict";function a(a){var b,c={},d=Human.rpc.fmaIds,e=Human.modules.MALE_STATE_ID,f=Human.modules.FEMALE_STATE_ID;for(var g in a)if(a.hasOwnProperty(g)){b=d[g];for(var h=0;h<b.length;h++){var i=Human.scene.objects[e+"-"+b[h]]||Human.scene.objects[f+"-"+b[h]];i&&(c[i.objectId]=a[g])}}return c}function b(a){var b,c={};for(var d in a)a.hasOwnProperty(d)&&(b=a[d],Human.utils.isPrimitive(b)&&"_"!==d[0]&&(c[d]=b));return c.objectId=a.object?a.object.objectId:"",c.title=a.label.title,c.description=a.label.description,c.pos=a.pin.pos,c.pinVec=a.pin.dir,c.visible=a.pin.visible,c}function c(a){var b=g[a];if(b){var c=b[0],d=b[1];Human.unEvent(c,d),delete g[a]}}function d(a,b){a&&Human.view.annotations.unsavedAnnotation?alert("Please save or cancel annotation first"):b()}Human.rpc.define("bookmarks.capture",function(){this.setResult(Human.bookmarks.capture())}),Human.rpc.define("bookmarks.restore",function(a){var b=this;Human.bookmarks.restore(a,function(){b.setResult(!0)})}),Human.rpc.define("events.off",function(a){if(a.id)c(a.id);else if(a.ids)for(var b=a.ids,d=0,e=b.length;e>d;d++)c(b[d]);else for(var f in g)g.hasOwnProperty(f)&&c(f)}),Human.rpc.define("timeline.query",function(){this.setResult(Human.timeline.query())}),Human.rpc.define("camera.query",function(){var a=Human.renderer.camera.getLookAt();a.zoom=Human.renderer.camera.getZoom(),this.setResult(a)}),Human.rpc.define("properties.query",function(a){this.setResult(Human.properties.query(a.regex))}),Human.rpc.define("actions.doAction",function(a){Human.actions._doAction([a.action,a.arguments])}),Human.rpc.define("alert",function(a){window.alert(a.message||"")}),Human.rpc.define("videos.getClips",function(){this.setResult(Human.media.videos.clipsList)}),Human.rpc.define("videos.open",function(a){var b=this;Human.media.videos.open(a.clipId,function(){b.setResult(!0)})}),Human.rpc.define("videos.play",function(a){Human.media.videos.play(a.clipId)}),Human.rpc.define("videos.scrub",function(a){Human.media.videos.scrub(a.clipId,a.time)}),Human.rpc.define("videos.pause",function(a){Human.media.videos.pause(a.clipId)}),Human.rpc.define("videos.stop",function(a){Human.media.videos.stop(a.clipId)}),Human.rpc.define("videos.close",function(a){Human.media.videos.close(a.clipId)}),Human.rpc.define("audio.getClips",function(){this.setResult(Human.media.audio.clipsList)}),Human.rpc.define("audio.open",function(a){var b=this;Human.media.audio.open(a.clipId,function(){b.setResult(!0)})}),
Human.rpc.define("audio.play",function(a){Human.media.audio.play(a.clipId)}),Human.rpc.define("audio.scrub",function(a){Human.media.audio.scrub(a.clipId,a.time)}),Human.rpc.define("audio.pause",function(a){Human.media.audio.pause(a.clipId)}),Human.rpc.define("audio.stop",function(a){Human.media.audio.stop(a.clipId)}),Human.rpc.define("audio.close",function(a){Human.media.videos.close(a.clipId)}),Human.rpc.define("modules.getModules",function(a){this.setResult(Human.modules.query(a))}),Human.rpc.define("modules.activate",function(a){var b=this;Human.modules.activateModules(a,function(){b.setResult(!0)})}),Human.rpc.define("modules.deactivate",function(a){Human.modules.deactivateModules(a)}),Human.rpc.define("properties.subscribe",function(a){var b=this;Human.properties.subscribe({subId:a.subId,propId:"myProperty",callback:function(a){b.setResult(a)}})}),Human.rpc.define("properties.resubscribe",function(a){Human.properties.resubscribe(a.subId,a.propId)}),Human.rpc.define("properties.unsubscribe",function(a){Human.properties.unsubscribe(a.subId)}),Human.rpc.define("renderer.getBGColor",function(){this.setResult(Human.renderer.bg.getBGColor())}),Human.rpc.define("renderer.setBGColor",function(a){Human.renderer.bg.setBGColor(a.color)}),Human.rpc.define("request.getParams",function(){this.setResult({hashParams:Human.request.getHashParams(),hashStr:Human.request.getHashStr(),searchParams:Human.request.getSearchParams(),searchStr:Human.request.getSearchStr()})}),Human.rpc.define("scene.queryBoundary",function(a){var b,c,d;if(a.objectId&&Human.scene.objects[a.objectId])b=Human.scene.objects[a.objectId].getBoundary();else if(a.fmaId){if(d=a.fmaId,c=Human.scene.objectsByFMAID[d],!c)return void this.error("No scene object found for the given FMA ID: '"+d+"'");b=c.getBoundary()}else if(a.objectIds)b=Human.scene.getBoundary({objectIds:a.objectIds});else if(a.fmaIds){for(var e=a.fmaIds,f=[],g=0,h=e.length;h>g;g++){if(d=e[g],c=Human.scene.objectsByFMAID[d],!c)return void this.error("No scene object found for the given FMA ID: '"+d+"'");f.push(c.objectId)}b=Human.scene.getBoundary({objectIds:f})}else b=a.selectedObjects?Human.scene.getBoundary({objects:Human.scene.selectedObjects}):a.enabledObjects?Human.scene.getBoundary({objects:Human.scene.enabledObjects}):Human.scene.getBoundary();this.setResult(b)}),function(){var a=document.getElementById("theCanvas"),b=function(b,c){c&&vec3.add(b,c,b);var d=Human.renderer.getViewMat(),e=Human.renderer.getProjMat(),f=vec4.create();vec3.transformMat4(f,b,d),f[3]=1,vec4.transformMat4(f,f,e);var g=f[0],h=f[1],i=f[3];return[Math.round((1+g/i)*a.width/2),Math.round((1-h/i)*a.height/2)]};Human.rpc.define("scene.getCanvasPos",function(a){this.setResult(b(a.worldPos,a.offset))}),Human.rpc.define("scene.getObjectCanvasPos",function(a){var c=Human.scene.objects[a.objectId];if(c){var d=c.getCenter();this.setResult(b(d,a.offset))}})}(),Human.rpc.define("annotations.setTitle",function(a){var b=Human.view.annotations.annotations[a.annotationId];b&&b.label.setTitle(a.title),this.setResult(!0)}),Human.rpc.define("annotations.setDescription",function(a){var b=Human.view.annotations.annotations[a.annotationId];b&&b.label.setDescription(a.description),this.setResult(!0)}),Human.rpc.define("annotations.setLabelsShown",function(a){Human.view.annotations.setLabelsShown(a),this.setResult(!0)}),Human.rpc.define("timeline.getBookmark",function(){this.setResult(Human.timeline.getBookmark())}),Human.rpc.define("timeline.setBookmark",function(a){Human.timeline.setBookmark(a)}),Human.rpc.define("clip.set",function(a){if(a.clips){var b,c=a.clips;for(var d in c)c.hasOwnProperty(d)&&(b=c[d],b.clipId=d,Human.renderer.clip.setClip(b))}else a.clip&&Human.renderer.clip.setClip(a.clip)}),Human.rpc.define("clip.reset",function(){Human.renderer.clip.reset()}),Human.rpc.define("effects.getEffects",function(){var a,b=[],c=Human.view.effects.effects;for(var d in c)c.hasOwnProperty(d)&&(a=c[d],b.push({effectId:d,displayName:a.displayName,description:a.description,enabled:a.enabled,params:a.params}));this.setResult(b)}),Human.rpc.define("effects.setEnabled",function(a){Human.view.effects.setEnabled(a)}),Human.rpc.define("effects.setParams",function(a){Human.view.effects.setParams(a)}),Human.rpc.define("focus.focusObject",function(a){var b=this,c=function(){b.setResult(!0)},d=a.fmaId,e=a.objectId,f=a.objectIds;if(!e&&!d&&!f)return Human.log.error("Human.view.focusObject","Parameter expected: either 'objectId', 'objectIds' or 'fmaId'"),void c();var g,h=Human.scene;if(e){if(g=h.objects[e],!g)return Human.log.error("Human.view.focusObject","Scene object not found: '"+e+"'"),void c()}else if(d){if(g=h.objectsByFMAID[d],!g)return Human.log.error("Human.view.focusObject","Scene object not found for this FMAID: '"+d+"'"),void c();e=g.objectId}a.xray===!0?Human.rpc.call(null,"xray.setEnabled",{enable:!0}):a.xray===!1&&Human.rpc.call(null,"xray.setEnabled",{enable:!1});var i=a.select;i=void 0===i||null===i?a.replace||!h.selectedObjects[e]:a.select;var j,k=a.flyTo;if(a.replace)h.setSelectedObjects({objectId:e,select:i,replace:a.replace});else if(i){var l={};l[e]=i,h.setSelectedObjects({objects:l,replace:a.replace})}a.showLabel===!1&&i||Human.view.labels._clearLabels(),a.showLabel!==!1&&(Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0}),Human.renderer.forceRenderFrame()),i&&"newSelected"===k?(j=g.getBoundary(),j&&Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()})):k&&"allSelected"!==k?"selectedLeafObjects"===k?Human.renderer.camera.fly.flyTo({selectedLeafObjects:!0,backOff:a.backOff,arc:0},function(){c()}):"object"===k?(j=g.getBoundary(),Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()})):c():(j=h.getBoundary({objects:h.selectedObjects}),j?Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()}):c())}),Human.rpc.define("labels.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.labels.getEnabled()),Human.view.labels.setEnabled(b)}),Human.rpc.define("labels.create",function(a){return a.objectId?(a.replace&&Human.view.labels.clearLabels(),void Human.view.labels.createLabel(a)):void this.error("parameter expected: 'objectId'")}),Human.rpc.define("labels.clear",function(){Human.view.labels.clearLabels()}),Human.rpc.define("lights.getLights",function(){var a,b=[],c=Human.renderer.lights.lights;for(var d in c)c.hasOwnProperty(d)&&(a=c[d],b.push({lightId:d,displayName:a.displayName,description:a.description,enabled:a.enabled,params:a.params}));this.setResult(b)}),Human.rpc.define("lights.setEnabled",function(a){Human.renderer.lights.setEnabled(a)}),Human.rpc.define("lights.setParams",function(a){Human.renderer.lights.setParams(a)}),Human.rpc.define("dissect.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.dissect.enabled),d(b,function(){Human.view.dissect.setEnabled(b),b?(Human.renderer.pick.setMultiPickEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!1),Human.view.annotations.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))})}),Human.rpc.define("highlight.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.highlight.enabled),Human.view.highlight.setEnabled(b),b&&(Human.view.isolate.setEnabled(!1),Human.view.xray.setEnabled(!1))}),Human.rpc.define("isolate.setEnabled",function(a){var b=a.enable;if((void 0===b||null===b)&&(b=!Human.view.isolate.enabled),Human.view.isolate.setEnabled(b),b){var c=Human.scene.anySelected();if(!c)return}b&&(Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1))}),Human.rpc.define("pick.single.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.renderer.pick.getSinglePickEnabled()),d(b,function(){Human.renderer.pick.setSinglePickEnabled(b),b&&(Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1))})}),Human.rpc.define("pick.multi.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.renderer.pick.getMultiPickEnabled()),d(b,function(){Human.renderer.pick.setMultiPickEnabled(b),b?(Human.renderer.pick.setSinglePickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)):Human.renderer.pick.setSinglePickEnabled(!0)})}),Human.rpc.define("pick.doublePick",function(a){Human.renderer.pick.doublePick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("pick.hoverPick",function(a){Human.renderer.pick.hoverPick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("annotations.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.annotations.enabled),d(!b,function(){Human.view.annotations.setEnabled(b),b?(Human.renderer.pick.setSinglePickEnabled(!1),Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))})}),Human.rpc.define("xray.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.xray.enabled),Human.view.xray.setEnabled(b),b&&(Human.view.highlight.setEnabled(!1),Human.view.isolate.setEnabled(!1))}),Human.rpc.define("queryModes",function(){var a={xray:Human.view.xray.enabled,highlight:Human.view.highlight.enabled,annotation:Human.view.annotations.enabled,singlePick:Human.renderer.pick.singleEnabled,multipick:Human.renderer.pick.multiEnabled,dissect:Human.view.dissect.enabled};this.setResult(a)}),Human.rpc.define("navigation.setEnabled",function(a){h("navigator_container",a.enable)}),Human.rpc.define("fullscreen.setEnabled",function(a){h("embed-full-screen",a.enable)});var e=Human.log.reporters,f=Human.log.messageBuf;Human.rpc.define("log.createReporter",function(a){if(!a.id)return void Human.log.error("param expected: id");var b="log.reporters."+a.id;if(!e[b]){e[b]={};for(var c=0,d=f.length;d>c;c++)Human.events.fire(b,f[c])}}),Human.rpc.define("log.destroyReporter",function(a){if(!a.id)return void Human.log.error("param expected: id");var b="log.reporters."+a.id;delete e[b]}),Human.rpc.define("annotations.getAnnotations",function(){var a,c=Human.view.annotations.annotations,d={};for(var e in c)c.hasOwnProperty(e)&&(a=c[e],d[e]=b(a));this.setResult(d)}),Human.rpc.define("annotations.setShown",function(a){Human.view.annotations.setShown(a.shown),this.setResult(!0)}),Human.rpc.define("camera.flyTo",function(a){var b=this;Human.renderer.camera.fly.flyTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.jumpTo",function(a){var b=this;Human.renderer.camera.fly.jumpTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.getZoom",function(){this.setResult(Human.renderer.camera.getZoom())});var g={};Human.rpc.define("events.on",function(a){var b=this,c=this.id;if(c&&g[c])return void this.error("an event is already bound to this ID: '"+c+"'");var d=a.type;if(!d)return void this.error("parameter expected: 'type'");var e=function(a){b.setResult(a)};a.mask?(a.fn=e,Human.events.on(a)):Human.events.on(a.type,e),c&&(g[c]=[d,e])}),Human.rpc.define("events.once",function(a){var b=this,c=a.type;return c?void Human.events.once(c,function(a){b.setResult(a)}):void this.error("parameter expected: 'type'")}),Human.rpc.define("events.fire",function(a){Human.events.fire(a.eventName,a.params)}),Human.rpc.define("reset",function(){var a=this;Human.init.reset(function(){a.setResult(!0)})}),Human.rpc.define("reload",function(){Human.init.reload()}),Human.rpc.define("pick.pick",function(a){Human.renderer.pick.pick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("pick.queryPick",function(a){this.setResult(Human.renderer.pick.queryPick({canvasX:a.canvasX,canvasY:a.canvasY,rayPick:a.rayPick})||{})}),Human.rpc.define("scene.setEnabledObjects",function(b){var c;if(b.fmaIds)c=a(b.fmaIds);else if(Human.utils.isArray(b.objectIds)){c={};for(var d=0,e=b.objectIds.length;e>d;d++)c[b.objectIds[d]]=!0}else c=b.objectIds;Human.scene.setEnabledObjects({objects:c,replace:b.replace})}),Human.rpc.define("scene.setSelectedObjects",function(b){var c;if(b.fmaIds)c=a(b.fmaIds);else if(Human.utils.isArray(b.objectIds)){c={};for(var d=0,e=b.objectIds.length;e>d;d++)c[b.objectIds[d]]=!0}else c=b.objectIds;b.objectIds=c,Human.scene.setSelectedObjects(b)}),function(){function a(c,d){if(c){d.push(b(c));for(var e=0,f=c.objects.length;f>e;e++)a(c.objects[e],d)}}function b(a){var b={};for(var c in a)if(a.hasOwnProperty(c)&&"_"!==c[0]){var d=a[c];Human.utils.isPrimitive(d)&&(b[c]=d)}return b.parentObjectId=a.parent?a.parent.objectId:null,b}Human.rpc.define("scene.getObjects",function(c){var d,e=[];if(c.objectId){var f=c.objectId;d=Human.scene.objects[f],d&&e.push(b(d))}else for(var g=0,h=Human.scene.rootObjects.length;h>g;g++)a(Human.scene.rootObjects[g],e);this.setResult(e)})}(),Human.rpc.define("scene.setObjectTransform",function(a){var b,c=a.objectId,d=a.fmaId;if(c){if(b=Human.scene.objects[c],!b)return void this.error("Scene object not found: '"+c+"'")}else if(d&&(b=Human.scene.objectsByFMAID[d],!b))return void this.error("scene object not found for the given FMA ID: '"+d+"'");b.setTransform(a)}),Human.rpc.define("timeline.scrub",function(a){Human.timeline.scrub(a)}),Human.rpc.define("timeline.stop",function(){Human.timeline.stop()}),Human.rpc.define("timeline.prev",function(){Human.timeline.prev()}),Human.rpc.define("timeline.next",function(){Human.timeline.next()}),Human.rpc.define("timeline.unpause",function(){Human.timeline.unpause()}),Human.rpc.define("properties.set",function(a){var b=a.props||a;Human.properties.set(b||{})});var h=function(a,b){var c="undefined"==typeof b?!0:b,d=document.getElementById(a);d.style.display=c?"block":"none"}}),Human.rpc.fmaIds={3734:["Base_of_aorta_3734_ID"],3768:["Aortic_arch_3768_ID"],3784:["Descending_Aorta_3784_ID"],3818:["Marginal_branch_of_right_coronary_artery_3818_ID"],3829:["Anterior_atrial_branch_of_right_coronary_artery_3829_ID"],3837:["Posterior_left_ventricular_branch_of_left_coronary_artery_3837_ID"],3932:["left_lower_subclavian_artery_3932_ID","Right_Brachiocephalic_trunk_3932_ID"],3941:["Right_common_carotid_artery_3941_ID"],3945:["Right_external_carotid_artery_3945_ID"],3949:["Right_Internal_Carotid_Artery_3949_ID"],3950:["Right_Internal_Carotid_Artery_3950_ID"],3958:["Right_Vertebral_Artery_3958_ID"],3969:["Right_internal_thoracic_artery_3969_ID"],3988:["Superior_right_epigastric_artery_3988_ID","Right_Superior_epigastric_artery_3988_ID"],4058:["Left_common_carotid_artery_4058_ID","Base_of_left_common_carotid_artery_4058_ID","Base_of_Left_common_carotid_artery_4058_ID"],4060:["Left_external_carotid_artery_4060_ID"],4062:["Left_Internal_Carotid_Artery_4062_ID"],4066:["Left_Vertebral_Artery_4066_ID"],4068:["Left_internal_thoracic_artery_4068_ID"],4083:["Left_Superior_epigastric_artery_4083_ID"],4085:["Right_costocervical_trunk_4085_ID"],4086:["Right_costocervical_trunk_4086_ID","Left_costocervical_trunk_4086_ID"],4134:["Left_deep_cervical_artery_4134_ID","left_deep_cervical_artery_4134_ID"],4634:["Right_Subcostal_artery_4634_ID","Right_subcostal_artery_4634_ID"],4654:["Left_Subcostal_artery_4654_ID","Left_subcostal_artery_4654_ID"],4693:["Right_subclavian_artery_4693_ID"],4694:["left_subclavian_artery_4694_ID","Left_Lower_Subclavian_artery_4694_ID","right_subclavian_artery_4694_ID"],4706:["Coronary_sinus_4706_ID"],4707:["Great_cardiac_vein_4707_ID"],4712:["Posterior_vein_of_left_ventricle_4712_ID"],4713:["Middle_cardiac_vein_4713_ID"],4714:["Small_cardiac_vein_4714_ID"],4715:["Oblique_vein_of_left_atrium_4715_ID"],4720:["Superior_Vena_Cava_4720_ID"],4728:["Inferior_Thyroid_vein_4728_ID"],4751:["Right_Brachiocephalic_vein_4751_ID","Right_brachiocephalic_vein_4751_ID"],4755:["Right_internal_jugular_vein_4755_ID"],4756:["Right_Vertebral_vein_4756_ID"],4758:["Right_internal_thoracic_vein_4758_ID"],4761:["Left_Brachiocephalic_vein_4761_ID","Left_brachiocephalic_vein_4761_ID"],4763:["Left_internal_jugular_vein_4763_ID"],4764:["Left_Vertebral_vein_4764_ID"],4766:["Left_internal_thoracic_vein_4766_ID"],4771:["Right_Superior_epigastric_vein_4771_ID","Right_superior_epigastric_vein_4771_ID"],4785:["Left_superior_epigastric_vein_4785_ID"],4838:["Azygos_Vein_4838_ID","Azygos_vein_4838_ID"],4843:["Right_ascending_lumbar_vein_4843_ID"],4944:["Hemiazgos_vein_4944_ID","Hemiazygos_vein_4944_ID"],4950:["Left_ascending_lumbar_vein_4950_ID"],5011:["Left_Accessory_Hemiazgos_vein_5011_ID","Left_Accessory_Hemiazygos_vein_5011_ID"],5883:["Right_Splanchnic_Nerve_5883_ID","Left_Splanchnic_Nerve_5883_ID"],6192:["Right_Phrenic_Nerve_6192_ID"],6193:["Left_Phrenic_Nerve_6193_ID"],6246:["Left_Recurrent_Laryngeal_Nerve_6246_ID","Right_Recurrent_Laryngeal_Nerve_6246_ID"],6258:["Left_Sympathetic_Chain_6258_ID","Right_Sympathetic_Chain_6258_ID"],6259:["Right_Sympathetic_Chain_6259_ID"],6442:["Left_C1_Spinal_Nerve_6442_ID","Right_C1_Spinal_Nerve_6442_ID"],6451:["Left_C2_Spinal_Nerve_6451_ID","Right_C2_Spinal_Nerve_6451_ID"],6453:["Left_C3_Spinal_Nerve_6453_ID","Right_C3_Spinal_Nerve_6453_ID"],6456:["Left_C4_Spinal_Nerve_6456_ID","Right_C4_Spinal_Nerve_6456_ID"],6457:["Right_C5_Spinal_Nerve_6457_ID","Left_C5_Spinal_Nerve_6457_ID"],6459:["Left_C6_Spinal_Nerve_6459_ID","Right_C6_Spinal_Nerve_6459_ID"],6461:["Right_C7_Spinal_Nerve_Group_6461_ID","Left_C7_Spinal_Nerve_6461_ID","Right_C7_Spinal_Nerve_6461_ID","Left_C7_Spinal_Nerve_Group_6461_ID"],6465:["Left_C8_Spinal_Nerve_6465_ID","Right_C8_Spinal_Nerve_6465_ID"],6582:["Ansa_Subclavia_6582_ID"],6642:["Superior_hypogastric_nerve_plexus_6642_ID"],6643:["Inferior_hypogastric_nerve_plexus_6643_ID"],6647:["Prostatic_nerve_plexus_6647_ID"],7088:["Heart_7088_ID"],7096:["Right_atrium_7096_ID"],7097:["Left_atrium_7097_ID"],7098:["Right_Ventricle_7098_ID"],7101:["Left_Ventricle_7101_ID"],7131:["Esophagus_7131_ID"],7133:["Interventricular_Septum_7133_ID"],7148:["Stomach_7148_ID"],7196:["Spleen_7196_ID"],7197:["Liver_7197_ID"],7198:["Pancreas_7198_ID"],7200:["Small_intestine_7200_ID"],7202:["Gallbladder_7202_ID"],7204:["Left_Kidney_7204_ID","Right_Kidney_7204_ID"],7205:["Right_Kidney_7205_ID","Left_Kidney_7205_ID"],7206:["Duodenum_7206_ID"],7207:["Jejunum_7207_ID"],7208:["Ileum_7208_ID"],7209:["Ovaries_7209_ID"],7211:["Right_testis_7211_ID"],7212:["Left_testis_7212_ID"],7213:["Right_Ovary_7213_ID"],7214:["Left_Ovary_7214_ID"],7218:["Right_auricle_7218_ID"],7219:["Left_auricle_7219_ID"],7234:["Tricuspid_Valve_7234_ID"],7235:["Mitral_valve_7235_ID"],7236:["Aortic_Valve_7236_ID"],7246:["Pulmonary_Valve_7246_ID"],7309:["Right_Lung_7309_ID"],7310:["Left_Lung_7310_ID"],7333:["Right_Superior_Lobe_7333_ID"],7337:["Right_Inferior_Lobe_7337_ID"],7370:["Left_Superior_Lobe_7370_ID"],7371:["Left_Inferior_Lobe_7371_ID"],7383:["Right_Middle_Lobe_7383_ID"],7394:["Trachea_7394_ID"],7486:["manubrium_of_sternum_7486_ID","body_of_sternum_7486_ID"],7591:["Right_Costal_Cartilage_7591_ID","Left_Costal_Cartilage_7591_ID"],7592:["Left_Costal_Cartilage_7592_ID","Right_Costal_Cartilage_7592_ID"],7647:["spinal_cord_7647_ID"],7857:["Left_first_rib_7857_ID","Right_first_rib_7857_ID"],7882:["Right_second_rib_7882_ID"],7883:["Left_second_rib_7883_ID"],7909:["Right_third_rib_7909_ID"],7910:["Left_third_rib_7910_ID"],7957:["Right_fourth_rib_7957_ID"],7958:["Left_fourth_rib_7958_ID"],8066:["Right_fifth_rib_8066_ID","Left_fifth_rib_8066_ID"],8175:["Left_sixth_rib_8175_ID","Right_sixth_rib_8175_ID"],8229:["Left_seventh_rib_8229_ID","Right_seventh_rib_8229_ID"],8283:["Left_eighth_rib_8283_ID","Right_eighth_rib_8283_ID"],8364:["Left_ninth_rib_8364_ID","Right_ninth_rib_8364_ID"],8445:["Right_tenth_rib_8445_ID","Left_tenth_rib_8445_ID"],8531:["Left_eleventh_rib_8531_ID","Right_eleventh_rib_8531_ID"],8533:["Right_twelfth_rib_8533_ID","Left_twelfth_rib_8533_ID"],8612:["Pulmonary_trunk_8612_ID"],9165:["First_thoracic_vertebra_9165_ID"],9187:["Second_thoracic_vertebra_9187_ID"],9209:["Third_thoracic_vertebra_9209_ID"],9248:["Fourth_thoracic_vertebra_9248_ID"],9600:["Prostate_9600_ID"],9603:["Thyroid_Gland_9603_ID"],9615:["Cricoid_cartilage_9615_ID"],9706:["Bile_Ducts_9706_ID"],9707:["Penis_9707_ID"],9710:["Vomer_9710_ID"],9711:["Maxilla_9711_ID"],9761:["Right_Transversus_thoracis_9761_ID"],9762:["Right_Transversus_thoracis_9762_ID","Left_Transversus_thoracis_9762_ID"],9922:["Fifth_thoracic_vertebra_9922_ID"],9945:["Sixth_thoracic_vertebra_9945_ID"],9968:["Seventh_thoracic_vertebra_9968_ID"],9991:["Eighth_thoracic_vertebra_9991_ID"],10014:["Ninth_thoracic_vertebra_10014_ID"],10037:["Tenth_thoracic_vertebra_10037_ID"],10059:["Eleventh_thoracic_vertebra_10059_ID"],10081:["Twelfth_thoracic_vertebra_10081_ID"],10551:["Right_dorsal_scapular_artery_10551_ID"],10552:["right_dorsal_scapular_artery_10552_ID","left_dorsal_scapular_artery_10552_ID"],10660:["Right_deep_cervical_artery_10660_ID"],10679:["Right_inferior_thyroid_artery_10679_ID"],10680:["left_inferior_thyroid_artery_10680_ID","Right_suprascapular_artery_10680_ID"],10681:["left_suprascapular_artery_10681_ID","Right_transverse_cervical_artery_10681_ID","right_suprascapular_artery_10681_ID"],10682:["left_transverse_cervical_artery_10682_ID","Right_superficial_cervical_artery_10682_ID"],10683:["left_superficial_cervical_artery_10683_ID"],10951:["Inferior_vena_cava_10951_ID","base_of_inferior_vena_cava_10951_ID"],12519:["Atlas_C1_12519_ID"],12520:["Axis_C2_12520_ID"],12521:["Third_cervical_vertebra_12521_ID"],12522:["Fourth_cervical_vertebra_12522_ID"],12523:["Fifth_cervical_vertebra_12523_ID"],12524:["Sixth_cervical_vertebra_12524_ID"],12525:["Seventh_cervical_vertebra_12525_ID"],12770:["Deep_lateral_cervical_lymph_nodes_12770_ID"],12858:["Union_between_ascending_lumbar_veins_12858_ID"],13072:["First_lumbar_vertebra_13072_ID"],13073:["Second_lumbar_vertebra_13073_ID"],13074:["Third_lumbar_vertebra_13074_ID"],13075:["Fourth_lumbar_vertebra_13075_ID"],13076:["Fifth_lumbar_vertebra_13076_ID"],13111:["Right_external_jugular_vein_13111_ID"],13112:["Left_external_jugular_vein_13112_ID","Right_external_jugular_vein_13112_ID"],13113:["Left_external_jugular_vein_13113_ID"],13295:["Diaphragm_13295_ID"],13322:["Right_Clavicle_13322_ID"],13323:["Left_Clavicle_13323_ID"],13325:["Right_cephalic_vein_13325_ID"],13326:["right_cephalic_vein_13326_ID","left_cephalic_vein_13326_ID"],13328:["Left_Clavicle_13328_ID"],13336:["Right_external_oblique_13336_ID"],13337:["Left_external_oblique_13337_ID"],13346:["Right_Sternohyoid_13346_ID"],13347:["Left_Sternohyoid_13347_ID"],13350:["Right_Sternothyroid_13350_ID"],13351:["Left_Sternothyroid_13351_ID"],13352:["Right_Thyrohyoid_13352_ID"],13353:["Left_Thyrohyoid_13353_ID"],13354:["Intercostal_Muscles_of_Left_Thorax_13354_ID","Intercostal_Muscles_of_Right_Thorax_13354_ID"],13358:["Right_latissimus_dorsi_13358_ID"],13359:["Left_latissimus_dorsi_13359_ID"],13373:["Right_pectoralis_major_13373_ID"],13374:["Left_pectoralis_major_13374_ID","Right_pectoralis_major_13374_ID"],13375:["Right_Pectoralis_minor_13375_ID"],13376:["Left_Pectoralis_minor_13376_ID","Right_Pectoralis_minor_13376_ID"],13377:["Right_Rectus_Abdominis_13377_ID"],13378:["Left_Rectus_Abdominis_13378_ID"],13379:["Right_Rectus_Abdominis_13379_ID"],13381:["Right_Rhomboid_Major_13381_ID"],13382:["Left_Rhomboid_Major_13382_ID"],13383:["Right_Rhomboid_Minor_13383_ID"],13384:["Left_Rhomboid_Minor_13384_ID"],13395:["Right_Scapula_13395_ID"],13396:["Left_Scapula_13396_ID","Right_Scapula_13396_ID"],13398:["Right_serratus_anterior_13398_ID"],13399:["Left_serratus_anterior_13399_ID"],13403:["Right_Serratus_Posterior_Superior_13403_ID"],13404:["Left_Serratus_Posterior_Superior_13404_ID"],13405:["Right_Serratus_Posterior_Inferior_13405_ID"],13406:["Left_Serratus_Posterior_Inferior_13406_ID"],13408:["Right_Sternocleidomastoid_13408_ID"],13409:["Left_Sternocleidomastoid_13409_ID"],13410:["Right_Subclavius_13410_ID"],13411:["Left_Subclavius_13411_ID","Right_Subclavius_13411_ID"],13414:["Right_subscapularis_13414_ID"],13415:["Left_subscapularis_13415_ID","Right_subscapularis_13415_ID"],13417:["Right_Thoracoepigastric_vein_13417_ID"],13418:["Left_Thoracoepigastric_vein_13418_ID"],13419:["Right_Trapezius_13419_ID"],13420:["Left_Trapezius_13420_ID"],13421:["Ligamentum_arteriosum_13421_ID"],13478:["Vertebral_Column_13478_ID"],13889:["Pituitary_Gland_13889_ID"],13890:["Parathyroid_Glands_13890_ID"],13892:["Right_Internal_oblique_13892_ID"],13893:["Left_Internal_oblique_13893_ID"],13912:["Anterior_interventricular_artery_13912_ID"],14331:["splenic_vein_14331_ID"],14332:["superior_mesenteric_vein_14332_ID"],14335:["Right_renal_vein_14335_ID"],14336:["Left_renal_vein_14336_ID"],14338:["Right_Hepatic_Vein_14338_ID"],14339:["Left_Hepatic_Vein_14339_ID"],14341:["Right_testicular_vein_14341_ID"],14345:["Left_testicular_vein_14345_ID"],14384:["Right_median_nerve_14384_ID"],14385:["Left_median_nerve_14385_ID"],14468:["Right_Recurrent_Laryngeal_Nerve_14468_ID"],14469:["Left_Recurrent_Laryngeal_Nerve_14469_ID"],14542:["Appendix_14542_ID"],14543:["Colon_14543_ID"],14544:["Rectum_14544_ID"],14545:["Ascending_colon_14545_ID"],14546:["Transverse_colon_14546_ID"],14547:["Descending_Colon_14547_ID"],14548:["Sigmoid_Colon_14548_ID"],14735:["Right_Lumbar_artery_14735_ID","Left_Lumbar_Artery_14735_ID","Right_Lumbar_Artery_14735_ID"],14746:["Right_Inferior_Phrenic_Artery_14746_ID"],14747:["Left_Inferior_Phrenic_Artery_14747_ID"],14749:["superior_mesenteric_artery_14749_ID"],14750:["Inferior_Mesenteric_artery_14750_ID"],14752:["Right_renal_artery_14752_ID"],14753:["Left_Renal_artery_14753_ID"],14759:["Right_testicular_artery_14759_ID"],14760:["Left_testicular_artery_14760_ID"],14768:["Left_Gastric_Artery_14768_ID"],14771:["Common_hepatic_artery_14771_ID"],14772:["Hepatic_artery_proper_14772_ID"],14773:["Splenic_artery_14773_ID"],14775:["Gastroduodenal_artery_14775_ID"],14776:["Right_Gastric_artery_14776_ID"],14778:["Right_hepatic_artery_14778_ID"],14779:["Left_hepatic_artery_14779_ID"],14781:["Right_Gastroepiploic_artery_14781_ID"],14787:["Dorsal_pancreatic_artery_14787_ID"],14790:["Inferior_pancreatic_artery_14790_ID"],14791:["Prepancreatic_Artery_14791_ID"],14792:["Great_pancreatic_artery_14792_ID"],14793:["Caudal_pancreatic_artery_14793_ID"],14796:["Left_Gastroepiploic_artery_14796_ID"],14810:["middle_colic_artery_14810_ID"],14811:["Right_colic_artery_14811_ID"],14812:["Celiac_Trunk_14812_ID"],14815:["Ileocolic_artery_14815_ID"],14819:["ileal_branch_of_ileocolic_artery_14819_ID"],14820:["Ileal_branch_of_ileocolic_vein_14820_ID","Colic_branch_of_ileocolic_vein_14820_ID"],14822:["Superior_branch_of_ileocolic_artery_14822_ID"],14826:["Left_colic_artery_14826_ID"],14830:["Sigmoid_artery_14830_ID"],14831:["Marginal_artery_of_colon_14831_ID"],14832:["Superior_Rectal_artery_14832_ID"],14835:["Cystic_artery_14835_ID"],15388:["Pancreatic_tributary_of_splenic_vein_15388_ID"],15390:["left_gastroepiploic_vein_15390_ID"],15391:["Inferior_Mesenteric_vein_15391_ID"],15394:["Left_colic_vein_15394_ID"],15395:["Sigmoid_vein_15395_ID"],15397:["Right_gastroepiploic_vein_15397_ID"],15398:["Anterior_Superior_pancreaticoduodenal_vein_15398_ID","Anterior_Inferior_pancreaticoduodenal_vein_15398_ID","Pancreaticoduodenal_vein_15398_ID","Posterior_Superior_pancreaticoduodenal_vein_15398_ID","Posterior_Inferior_pancreaticoduodenal_vein_15398_ID"],15399:["Left_Gastric_vein_15399_ID"],15400:["Right_Gastric_vein_15400_ID"],15407:["right_colic_vein_15407_ID"],15408:["Ileocolic_vein_15408_ID"],15414:["Right_Hepatic_Portal_Vein_15414_ID"],15415:["Left_Hepatic_Portal_Vein_15415_ID"],15571:["Right_Ureter_15571_ID"],15572:["Left_Ureter_15572_ID"],15629:["Right_Adrenal_Gland_15629_ID"],15630:["Left_Adrenal_Gland_15630_ID"],15710:["Internal_anal_sphincter_15710_ID"],15900:["Bladder_15900_ID"],16202:["Sacrum_16202_ID"],16491:["Right_iliohypogastric_nerve_16491_ID"],16492:["Left_iliohypogastric_nerve_16492_ID"],16493:["Right_ilioinguinal_nerve_16493_ID"],16494:["Left_ilioinguinal_nerve_16494_ID"],16497:["Right_lateral_femoral_cutaneous_nerve_16497_ID"],16498:["Left_lateral_femoral_cutaneous_nerve_16498_ID"],16499:["Right_femoral_nerve_16499_ID"],16500:["Left_femoral_nerve_16500_ID"],16501:["Right_obturator_nerve_16501_ID"],16502:["Left_obturator_nerve_16502_ID"],17559:["Uterus_17559_ID"],17740:["Cervix_of_uterus_17740_ID"],18245:["Right_Fallopian_Tube_18245_ID","Left_Fallopian_Tube_18245_ID"],18256:["Right_epididymis_18256_ID"],18257:["Left_epididymis_18257_ID"],18806:["Right_external_iliac_artery_18806_ID"],18807:["Left_external_iliac_artery_18807_ID"],18809:["Right_internal_iliac_artery_18809_ID"],18810:["Left_internal_iliac_artery_18810_ID"],18824:["Right_inferior_vesical_artery_18824_ID"],18825:["Left_inferior_vesical_artery_18825_ID"],18829:["Left_Uterine_Artery_18829_ID","Right_Uterine_Artery_18829_ID"],18836:["Right_internal_pudendal_artery_18836_ID"],18837:["Left_internal_pudendal_artery_18837_ID"],18846:["Right_iliolumbar_artery_18846_ID"],18847:["Left_iliolumbar_artery_18847_ID"],18856:["Right_lateral_sacral_artery_18856_ID"],18857:["Left_lateral_sacral_artery_18857_ID"],18866:["Right_obturator_artery_18866_ID"],18867:["Left_obturator_artery_18867_ID"],18869:["Right_superior_gluteal_artery_18869_ID"],18870:["Right_superior_gluteal_artery_18870_ID","Left_superior_gluteal_artery_18870_ID"],18872:["Right_inferior_gluteal_artery_18872_ID"],18873:["Left_inferior_gluteal_artery_18873_ID"],18885:["Right_external_iliac_vein_18885_ID"],18886:["Left_external_iliac_vein_18886_ID"],18887:["Right_internal_iliac_vein_18887_ID"],18888:["Left_internal_iliac_vein_18888_ID"],18891:["Right_inferior_vesical_vein_18891_ID"],18892:["Left_inferior_vesical_vein_18892_ID"],18897:["Right_Uterine_Vein_18897_ID"],18898:["Left_Uterine_Vein_18898_ID"],18903:["Right_iliolumbar_vein_18903_ID"],18904:["Left_iliolumbar_vein_18904_ID"],18906:["Right_lateral_sacral_vein_18906_ID"],18907:["Left_lateral_sacral_vein_18907_ID"],18909:["Right_superior_gluteal_vein_18909_ID"],18910:["Left_superior_gluteal_vein_18910_ID"],18912:["Right_inferior_gluteal_vein_18912_ID"],18913:["Left_inferior_gluteal_vein_18913_ID"],18915:["Right_obturator_vein_18915_ID"],18916:["Left_obturator_vein_18916_ID"],18918:["Right_internal_pudendal_vein_18918_ID"],18919:["Left_internal_pudendal_vein_18919_ID"],19086:["Muscles_of_the_Pelvis_19086_ID"],19087:["Levator_Ani_19087_ID"],19090:["Pubococcygeus_19090_ID"],19091:["Puborectalis_19091_ID"],19119:["Right_Uterosacral_Ligament_19119_ID"],19120:["Left_Uterosacral_Ligament_19120_ID"],19235:["Right_vas_deferens_19235_ID"],19236:["Left_vas_deferens_19236_ID"],19387:["Right_Seminal_Vesicle_19387_ID"],19388:["Left_Seminal_Vesicle_19388_ID"],19617:["Corpus_spongiosum_of_penis_19617_ID"],19618:["Right_corporus_cavernosum_of_penis_19618_ID","Left_corporus_cavernosum_of_penis_19618_ID"],19667:["Urethra_19667_ID"],19668:["Male_urethra_19668_ID"],19730:["Left_Ischiocavernosus_19730_ID","Right_Ischiocavernosus_19730_ID"],19731:["Right_Superficial_Transverse_Perineal_Muscle_19731_ID","Left_Superficial_Transverse_Perineal_Muscle_19731_ID"],19732:["Deep_transverse_perineal_muscle_19732_ID"],19949:["Vagina_19949_ID"],20224:["Right_Ribs_20224_ID"],20225:["Right_Ribs_20225_ID","Left_Ribs_20225_ID"],20226:["Right_Bony_Pelvis_20226_ID","Left_Ribs_20226_ID","Right_side_of_bony_pelvis_20226_ID"],20227:["Left_Bony_Pelvis_20227_ID","Left_side_of_bony_pelvis_20227_ID"],20274:["Perineal_Body_20274_ID"],20630:["Right_genitofemoral_nerve_20630_ID"],20631:["Left_genitofemoral_nerve_20631_ID"],20632:["Genital_branch_of_right_genitofemoral_nerve_20632_ID"],20633:["Genital_branch_of_left_genitofemoral_nerve_20633_ID"],20634:["Femoral_branch_of_right_genitofemoral_nerve_20634_ID"],20635:["Femoral_branch_of_left_genitofemoral_nerve_20635_ID"],20688:["Right_Inferior_Epigastric_Artery_20688_ID"],20689:["Left_Inferior_Epigastric_Artery_20689_ID"],
20735:["Right_Superficial_Epigastric_Artery_20735_ID"],20736:["Left_Superficial_Epigastric_Artery_20736_ID"],20796:["Right_deep_femoral_artery_20796_ID"],20797:["Left_deep_femoral_artery_20797_ID"],20801:["Right_lateral_circumflex_femoral_artery_20801_ID"],20802:["Left_lateral_circumflex_femoral_artery_20802_ID"],20807:["Right_Medial_circumflex_femoral_artery_20807_ID"],20808:["Left_Medial_circumflex_femoral_artery_20808_ID"],20818:["Right_dorsal_artery_of_penis_20818_ID"],20819:["Left_dorsal_artery_of_penis_20819_ID"],20967:["Prostatic_part_of_right_inferior_vesical_artery_20967_ID"],20968:["Prostatic_part_of_left_inferior_vesical_artery_20968_ID"],21163:["Right_Inferior_Epigastric_Vein_21163_ID"],21164:["Left_Inferior_Epigastric_Vein_21164_ID"],21188:["Right_Femoral_Vein_21188_ID"],21189:["Left_Femoral_Vein_21189_ID"],21378:["Superficial_Veins_of_the_Left_Leg_21378_ID","Superficial_Veins_of_the_Right_Leg_21378_ID"],21379:["Right_Great_Saphenous_Vein_21379_ID"],21380:["Left_Great_Saphenous_Vein_21380_ID"],21422:["Descending_branch_of_right_lateral_circumflex_femoral_artery_21422_ID"],21423:["Descending_branch_of_left_lateral_circumflex_femoral_artery_21423_ID"],21863:["Right_Pudendal_nerve_21863_ID"],21864:["Left_Pudendal_nerve_21864_ID"],21919:["Right_superficial_transverse_perineal_muscle_21919_ID"],21920:["Left_superficial_transverse_perineal_muscle_21920_ID"],21921:["Right_bulbospongiosus_21921_ID"],21922:["Left_bulbospongiosus_21922_ID"],21923:["Right_ischiocavernosus_21923_ID"],21924:["Left_ischiocavernosus_21924_ID"],21930:["External_Anal_Sphincter_21930_ID"],22109:["Right_Tibial_nerve_22109_ID"],22110:["Left_Tibial_nerve_22110_ID"],22111:["Right_sciatic_nerve_22111_ID"],22112:["Left_sciatic_nerve_22112_ID"],22171:["Right_inferior_ulnar_collateral_artery_22171_ID"],22172:["right_inferior_ulnar_collateral_artery_22172_ID","left_inferior_ulnar_collateral_artery_22172_ID"],22322:["Right_Iliacus_22322_ID"],22323:["Left_Iliacus_22323_ID"],22324:["Right_Obturator_Internus_22324_ID"],22325:["Left_Obturator_Internus_22325_ID"],22326:["Right_Obturator_externus_22326_ID"],22327:["Left_Obturator_externus_22327_ID"],22328:["Right_gluteus_maximus_22328_ID"],22329:["Left_gluteus_maximus_22329_ID"],22330:["Right_gluteus_medius_22330_ID"],22331:["Left_gluteus_medius_22331_ID"],22332:["Right_Gluteus_minimus_22332_ID"],22333:["Left_Gluteus_minimus_22333_ID"],22334:["Right_superior_gemellus_22334_ID"],22335:["Left_superior_gemellus_22335_ID"],22336:["Right_inferior_gemellus_22336_ID"],22337:["Left_inferior_gemellus_22337_ID"],22338:["Right_Quadratus_femoris_22338_ID"],22339:["Left_Quadratus_femoris_22339_ID"],22340:["Right_Piriformis_22340_ID"],22341:["Left_Piriformis_22341_ID"],22342:["Right_Psoas_Major_22342_ID"],22343:["Left_Psoas_Major_22343_ID"],22344:["Right_Transversus_abdominis_22344_ID"],22345:["Left_Transversus_abdominis_22345_ID"],22348:["Right_Quadratus_lumborum_22348_ID"],22349:["Left_Quadratus_lumborum_22349_ID"],22351:["Right_Psoas_Minor_22351_ID"],22352:["Left_Psoas_Minor_22352_ID"],22354:["Right_Sartorius_22354_ID"],22355:["Left_Sartorius_22355_ID"],22358:["Right_Semitendinosus_22358_ID"],22359:["Left_Semitendinosus_22359_ID"],22360:["Right_Biceps_Femoris_22360_ID"],22361:["Left_Biceps_Femoris_22361_ID"],22425:["Right_Tensor_Fasciae_Latae_22425_ID"],22426:["Left_Tensor_Fasciae_Latae_22426_ID"],22444:["Right_quadriceps_femoris_22444_ID"],22445:["Left_quadriceps_femoris_22445_ID"],22446:["Right_Articularis_Genus_22446_ID"],22447:["Left_Articularis_Genus_22447_ID"],22448:["Right_Semimembranosus_22448_ID"],22449:["Left_Semimembranosus_22449_ID"],22450:["Right_Pectineus_22450_ID"],22451:["Left_Pectineus_22451_ID"],22456:["Right_Adductor_Longus_22456_ID"],22457:["Right_Adductor_Longus_22457_ID","Left_Adductor_Longus_22457_ID"],22458:["Left_Adductor_Longus_22458_ID"],22459:["Right_Adductor_Magnus_22459_ID"],22460:["Left_Adductor_Magnus_22460_ID"],22507:["Right_descending_genicular_artery_22507_ID"],22508:["Left_descending_genicular_artery_22508_ID"],22539:["Right_Fibularis_tertius_22539_ID","Left_Fibularis_tertius_22539_ID"],22545:["Right_Tibialis_anterior_22545_ID","Left_Tibialis_anterior_22545_ID"],22547:["Left_Extensor_hallucis_longus_22547_ID","Right_Extensor_hallucis_longus_22547_ID"],22548:["Right_Extensor_hallucis_longus_22548_ID","Left_Extensor_hallucis_longus_22548_ID"],22549:["Right_extensor_digitorum_longus_22549_ID","Left_extensor_digitorum_longus_22549_ID"],22551:["Right_Fibularis_tertius_22551_ID","Left_Fibularis_tertius_22551_ID"],22553:["Right_Fibularis_longus_22553_ID","Left_Fibularis_longus_22553_ID"],22555:["Left_Fibularis_brevis_22555_ID","Right_Fibularis_brevis_22555_ID"],22556:["Right_Gastrocnemius_22556_ID"],22557:["Left_Gastrocnemius_22557_ID"],22559:["Right_Soleus_22559_ID","Left_Soleus_22559_ID"],22561:["Left_Plantaris_22561_ID","Right_Plantaris_22561_ID"],22586:["Right_superior_medial_genicular_artery_22586_ID"],22587:["Left_superior_medial_genicular_artery_22587_ID"],22588:["Right_superior_lateral_genicular_artery_22588_ID"],22589:["Left_superior_lateral_genicular_artery_22589_ID"],22592:["Right_Popliteus_22592_ID","Left_Popliteus_22592_ID"],22655:["Right_Axillary_artery_22655_ID"],22656:["Left_Axillary_artery_22656_ID","Right_Axillary_artery_22656_ID"],22669:["right_superior_thoracic_artery_22669_ID"],22670:["left_superior_thoracic_artery_22670_ID"],22675:["Right_lateral_thoracic_artery_22675_ID"],22676:["right_lateral_thoracic_artery_22676_ID","left_lateral_thoracic_artery_22676_ID"],22679:["Right_subscapular_artery_22679_ID"],22680:["left_subscapular_artery_22680_ID","right_subscapular_artery_22680_ID"],22682:["Right_anterior_humeral_circumflex_artery_22682_ID"],22683:["right_anterior_humeral_circumflex_artery_22683_ID","left_anterior_humeral_circumflex_artery_22683_ID"],22686:["Right_posterior_humeral_circumflex_artery_22686_ID"],22687:["left_posterior_humeral_circumflex_artery_22687_ID","right_posterior_humeral_circumflex_artery_22687_ID"],22691:["Right_brachial_artery_22691_ID"],22692:["right_brachial_artery_22692_ID","left_brachial_artery_22692_ID"],22696:["Right_deep_brachial_artery_22696_ID"],22697:["right_deep_brachial_artery_22697_ID","left_deep_brachial_artery_22697_ID"],22707:["Right_superior_ulnar_collateral_artery_22707_ID"],22708:["right_superior_ulnar_collateral_artery_22708_ID","left_superior_ulnar_collateral_artery_22708_ID"],22726:["Right_Splenius_cervicis_22726_ID"],22727:["Left_Splenius_cervicis_22727_ID"],22728:["Right_Splenius_capitis_22728_ID"],22729:["Left_Splenius_capitis_22729_ID"],22733:["Right_radial_artery_22733_ID"],22734:["Right_radial_artery_22734_ID","Left_radial_artery_22734_ID"],22740:["Right_Iliocostalis_Lumborum_22740_ID"],22741:["Left_Iliocostalis_Lumborum_22741_ID"],22742:["Right_Iliocostalis_Thoracis_22742_ID"],22743:["Left_Iliocostalis_Thoracis_22743_ID"],22744:["Right_Iliocostalis_Cervicis_22744_ID"],22745:["Left_Iliocostalis_Cervicis_22745_ID"],22751:["Right_Longissimus_Thoracis_22751_ID"],22753:["Left_Longissimus_Thoracis_22753_ID"],22754:["Right_Longissimus_Capitis_22754_ID"],22756:["Left_Longissimus_Capitis_22756_ID"],22757:["Right_Longissimus_Cervicis_22757_ID"],22758:["Left_Longissimus_Cervicis_22758_ID"],22765:["Right_radial_recurrent_artery_22765_ID"],22766:["left_radial_recurrent_artery_22766_ID","right_radial_recurrent_artery_22766_ID"],22772:["dorsal_carpal_branch_of_Right_radial_artery_22772_ID"],22773:["dorsal_carpal_branch_of_left_radial_artery_22773_ID","dorsal_carpal_branch_of_right_radial_artery_22773_ID"],22779:["Right_Spinalis_Thoracis_22779_ID"],22780:["Left_Spinalis_Thoracis_22780_ID"],22781:["Right_Spinalis_Cervicis_22781_ID"],22782:["Left_Spinalis_Cervicis_22782_ID"],22783:["Right_Spinalis_Capitis_22783_ID"],22784:["Left_Spinalis_Capitis_22784_ID"],22798:["Right_ulnar_artery_22798_ID","Left_ulnar_artery_22798_ID"],22801:["Right_anterior_ulnar_recurrent_artery_22801_ID"],22802:["right_anterior_ulnar_recurrent_artery_22802_ID","left_anterior_ulnar_recurrent_artery_22802_ID"],22804:["Right_posterior_ulnar_recurrent_artery_22804_ID"],22805:["right_posterior_ulnar_recurrent_artery_22805_ID","left_posterior_ulnar_recurrent_artery_22805_ID"],22807:["Right_common_interosseous_artery_22807_ID"],22808:["left_common_interosseous_artery_22808_ID","right_common_interosseous_artery_22808_ID"],22812:["Right_anterior_interosseous_artery_22812_ID"],22813:["left_anterior_interosseous_artery_22813_ID","right_anterior_interosseous_artery_22813_ID"],22821:["dorsal_carpal_branch_of_Right_ulnar_artery_22821_ID"],22822:["dorsal_carpal_branch_of_left_ulnar_artery_22822_ID","dorsal_carpal_branch_of_right_ulnar_artery_22822_ID"],22836:["Right_superficial_palmar_arch_22836_ID"],22837:["left_superficial_palmar_arch_22837_ID","right_superficial_palmar_arch_22837_ID"],22839:["Right_deep_palmar_arterial_arch_22839_ID"],22840:["left_deep_palmar_venous_arch_22840_ID","right_deep_palmar_venous_arch_22840_ID","right_deep_palmar_arterial_arch_22840_ID","left_deep_palmar_arterial_arch_22840_ID","right_deep_palmar_arch_22840_ID","left_deep_palmar_arch_22840_ID"],22872:["Right_Semispinalis_thoracis_22872_ID"],22873:["Left_Semispinalis_thoracis_22873_ID"],22874:["Right_Semispinalis_cervicis_22874_ID"],22875:["Left_Semispinalis_cervicis_22875_ID"],22876:["Right_Semispinalis_capitis_22876_ID"],22877:["Left_Semispinalis_capitis_22877_ID"],22878:["Right_Multifidus_22878_ID"],22879:["Left_Multifidus_22879_ID"],22909:["Right_basilic_vein_22909_ID"],22910:["right_basilic_vein_22910_ID","left_basilic_vein_22910_ID","Left_basilic_vein_22910_ID"],22920:["Right_palmar_metacarpal_veins_22920_ID"],22921:["right_palmar_metacarpal_veins_22921_ID","left_palmar_metacarpal_veins_22921_ID"],22935:["Right_medial_brachial_vein_22935_ID"],22936:["right_medial_brachial_vein_22936_ID","left_medial_brachial_vein_22936_ID"],22948:["Right_radial_vein_22948_ID"],22949:["left_radial_vein_22949_ID","right_radial_vein_22949_ID"],22951:["right_ulnar_vein_22951_ID"],22952:["right_ulnar_vein_22952_ID","left_ulnar_vein_22952_ID"],22964:["Right_median_cubital_vein_22964_ID"],22965:["right_median_cubital_vein_22965_ID","left_median_cubital_vein_22965_ID"],22968:["Right_median_antebrachial_vein_22968_ID"],22969:["left_median_antebrachial_vein_22969_ID","right_median_antebrachial_vein_22969_ID"],23111:["Right_deep_dorsal_vein_23111_ID"],23112:["right_deep_dorsal_vein_23112_ID","left_deep_dorsal_vein_23112_ID"],23123:["Right_medial_collateral_artery_23123_ID"],23124:["right_medial_collateral_artery_23124_ID","left_medial_collateral_artery_23124_ID"],23126:["Right_radial_collateral_artery_23126_ID"],23127:["right_radial_collateral_artery_23127_ID","left_radial_collateral_artery_23127_ID"],23130:["Right_Humerus_23130_ID","Left_Humerus_23130_ID"],23180:["Right_circumflex_scapular_artery_23180_ID"],23181:["right_circumflex_scapular_artery_23181_ID","left_circumflex_scapular_artery_23181_ID"],23464:["Left_radius_23464_ID","Right_radius_23464_ID"],23467:["Left_Ulna_23467_ID","Right_Ulna_23467_ID"],23707:["Right_Interosseous_membrane_23707_ID"],23708:["Left_Interosseous_membrane_23708_ID"],24160:["Bones_of_the_Right_Arm_24160_ID"],24162:["Bones_of_the_Left_Arm_24162_ID"],24435:["Right_scaphoid_bone_24435_ID","Left_scaphoid_bone_24435_ID"],24437:["Left_lunate_bone_24437_ID","Right_lunate_bone_24437_ID"],24439:["Left_triquetral_bone_24439_ID","Right_triquetral_bone_24439_ID"],24441:["Right_pisiform_24441_ID","Left_pisiform_24441_ID"],24443:["Right_trapezium_24443_ID","Left_trapezium_24443_ID"],24444:["Right_trapezoid_bone_24444_ID","Left_trapezoid_bone_24444_ID"],24446:["Right_capitate_bone_24446_ID","Left_capitate_bone_24446_ID"],24448:["Left_hamate_bone_24448_ID","Right_hamate_bone_24448_ID"],24474:["Right_femur_24474_ID"],24475:["Left_femur_24475_ID"],24477:["Right_tibia_24477_ID"],24478:["Right_tibia_24478_ID","Left_tibia_24478_ID"],24480:["Right_fibula_24480_ID"],24481:["Right_fibula_24481_ID","Left_fibula_24481_ID"],24482:["Right_talus_24482_ID"],24483:["Right_talus_24483_ID","Left_talus_24483_ID"],24486:["Right_patella_24486_ID"],24487:["Right_patella_24487_ID","Left_patella_24487_ID"],24497:["Right_calcaneus_24497_ID"],24498:["Right_calcaneus_24498_ID","Left_calcaneus_24498_ID"],24500:["Navicular_bone_of_right_foot_24500_ID"],24501:["Navicular_of_right_foot_24501_ID","Navicular_of_left_foot_24501_ID","Navicular_bone_of_left_foot_24501_ID"],24521:["Right_medial_Cuneiform_bone_24521_ID"],24522:["Left_medial_Cuneiform_bone_24522_ID","Right_medial_Cuneiform_bone_24522_ID"],24523:["Right_intermediate_Cuneiform_bone_24523_ID"],24524:["Right_intermediate_Cuneiform_bone_24524_ID","Left_intermediate_Cuneiform_bone_24524_ID"],24525:["Right_lateral_Cuneiform_bone_24525_ID"],24526:["Right_lateral_Cuneiform_bone_24526_ID","Left_lateral_Cuneiform_bone_24526_ID"],24528:["Right_cuboid_bone_24528_ID"],24529:["Left_cuboid_bone_24529_ID","Right_cuboid_bone_24529_ID"],25005:["Anterior_atlanto_occipital_membrane_25005_ID","Anterior_atlantooccipital_membrane_25005_ID"],29711:["Prostatic_venous_plexus_29711_ID"],31893:["Anterior_longitudinal_ligament_31893_ID"],32530:["Right_Rectus_capitis_posterior_major_32530_ID"],32531:["Left_Rectus_Capitis_posterior_major_32531_ID"],32532:["Right_Rectus_capitis_posterior_minor_32532_ID"],32533:["Left_Rectus_capitis_posterior_minor_32533_ID","Right_Rectus_Capitis_posterior_major_32533_ID"],32535:["Right_Rectus_capitis_posterior_minor_32535_ID"],32540:["Right_Levator_Scapulae_32540_ID","Right_Levator_scapulae_32540_ID"],32541:["Left_Levator_scapulae_32541_ID"],32542:["Right_Deltoid_32542_ID"],32543:["Left_Deltoid_32543_ID","Right_Deltoid_32543_ID"],32544:["Right_supraspinatus_32544_ID","Right_Supraspinatus_32544_ID"],32545:["Left_Supraspinatus_32545_ID"],32547:["Right_infraspinatus_32547_ID"],32548:["Left_infraspinatus_32548_ID"],32551:["Right_Teres_Major_32551_ID"],32552:["Left_Teres_Major_32552_ID"],32553:["Right_teres_minor_32553_ID"],32554:["Left_teres_minor_32554_ID"],33098:["Right_Rotatores_short_fibers_33098_ID","Right_Rotatores_long_fibers_33098_ID"],33099:["Left_Rotatores_long_fibers_33099_ID","Left_Rotatores_short_fibers_33099_ID"],33520:["Right_pectoral_girdle_muscles_33520_ID"],33521:["Left_pectoral_girdle_muscles_33521_ID","Right_pectoral_girdle_muscles_33521_ID"],37318:["Right_ulnar_nerve_37318_ID"],37319:["Left_ulnar_nerve_37319_ID"],37386:["Right_Abductor_pollicis_brevis_37386_ID"],37387:["Left_Abductor_pollicis_brevis_37387_ID"],37388:["Right_Flexor_pollicis_brevis_37388_ID"],37389:["Left_Flexor_pollicis_brevis_37389_ID"],37390:["Right_Opponens_pollicis_37390_ID"],37391:["Left_Opponens_pollicis_37391_ID"],37392:["Right_Adductor_pollicis_37392_ID"],37393:["Left_Adductor_pollicis_37393_ID","Right_Palmaris_brevis_37393_ID"],37395:["Left_Palmaris_brevis_37395_ID"],37396:["Right_Abductor_digiti_minimi_37396_ID"],37397:["Left_Abductor_digiti_minimi_37397_ID"],37398:["Right_Flexor_digiti_minimi_brevis_37398_ID"],37399:["Left_Flexor_digiti_minimi_brevis_37399_ID"],37400:["Right_Opponens_digiti_minimi_37400_ID"],37401:["Left_Opponens_digiti_minimi_37401_ID"],37460:["Right_Abductor_hallucis_37460_ID","Left_Abductor_hallucis_37460_ID"],37462:["Right_Flexor_digiti_minimi_brevis_37462_ID","Left_Flexor_digiti_minimi_brevis_37462_ID"],37464:["Abductor_digiti_minimi_of_right_foot_37464_ID","Abductor_digiti_minimi_of_left_foot_37464_ID"],37468:["Left_Flexor_hallucis_brevis_37468_ID","Right_Flexor_hallucis_brevis_37468_ID"],37470:["Left_Adductor_hallucis_37470_ID","Left_Adductor_hallucis_oblique_head_37470_ID","Left_Adductor_hallucis_transverse_head_37470_ID","Right_Adductor_hallucis_37470_ID","Right_Adductor_hallucis_oblique_head_37470_ID","Right_Adductor_hallucis_transverse_head_37470_ID"],37665:["Right_Coracobrachialis_37665_ID"],37666:["Left_Coracobrachialis_37666_ID","Right_Coracobrachialis_37666_ID"],37668:["Right_Brachialis_37668_ID"],37669:["Left_Brachialis_37669_ID"],37671:["Right_Biceps_Brachii_37671_ID"],37672:["Right_Biceps_Brachii_37672_ID","Left_Biceps_Brachii_37672_ID"],37689:["Right_Triceps_Brachii_37689_ID"],37690:["Right_Triceps_Brachii_37690_ID","Left_Triceps_Brachii_37690_ID"],37705:["Right_anconeus_37705_ID"],37706:["Left_anconeus_37706_ID","Right_anconeus_37706_ID"],38451:["Right_Pronator_teres_38451_ID"],38452:["Left_Pronator_teres_38452_ID"],38454:["Right_Pronator_quadratus_38454_ID"],38455:["Left_Pronator_quadratus_38455_ID"],38460:["Right_Flexor_carpi_radialis_longus_38460_ID"],38461:["Left_Flexor_carpi_radialis_longus_38461_ID"],38463:["Right_Palmaris_longus_38463_ID"],38464:["Left_Palmaris_longus_38464_ID"],38466:["Right_Flexor_carpi_ulnaris_38466_ID"],38467:["Left_Flexor_carpi_ulnaris_38467_ID"],38483:["Right_flexor_pollicis_longus_38483_ID"],38484:["Left_flexor_pollicis_longus_38484_ID"],38486:["Right_Brachioradialis_38486_ID"],38487:["Left_Brachioradialis_38487_ID"],38495:["Right_Extensor_carpi_radialis_longus_38495_ID"],38496:["Left_Extensor_carpi_radialis_longus_38496_ID"],38498:["Right_Extensor_carpi_radialis_brevis_38498_ID"],38499:["Left_Extensor_carpi_radialis_brevis_38499_ID"],38504:["Right_Extensor_digiti_minimi_38504_ID"],38505:["Left_Extensor_digiti_minimi_38505_ID"],38507:["Right_Extensor_carpi_ulnaris_38507_ID"],38508:["Left_Extensor_carpi_ulnaris_38508_ID"],38513:["Right_Supinator_38513_ID"],38514:["Left_Supinator_38514_ID"],38516:["Right_Abductor_pollicis_longus_38516_ID"],38517:["Left_Abductor_pollicis_longus_38517_ID"],38519:["Right_Extensor_pollicis_brevis_38519_ID"],38520:["Left_Extensor_pollicis_brevis_38520_ID"],38522:["Right_Extensor_pollicis_longus_38522_ID"],38523:["Left_Extensor_pollicis_longus_38523_ID"],38525:["Right_Extensor_indicis_38525_ID"],38526:["Left_Extensor_indicis_38526_ID"],38928:["Right_Rectus_Femoris_38928_ID"],38929:["Left_Rectus_Femoris_38929_ID"],38930:["Right_Vastus_Lateralis_38930_ID"],38931:["Left_Vastus_Lateralis_38931_ID"],38932:["Right_Vastus_Medialis_38932_ID"],38933:["Left_Vastus_Medialis_38933_ID"],38934:["Right_Vastus_Intermedius_38934_ID"],38935:["Left_Vastus_Intermedius_38935_ID"],39091:["Left_forearm_muscles_39091_ID"],39092:["Right_forearm_muscles_39092_ID"],39987:["Right_Extensor_retinaculum_of_hand_39987_ID","Left_Extensor_retinaculum_of_hand_39987_ID"],39988:["Right_Flexor_retinaculum_of_hand_39988_ID","Left_Flexor_retinaculum_of_hand_39988_ID"],42313:["Right_Pisohamate_Ligament_42313_ID","Left_Pisohamate_Ligament_42313_ID"],42369:["Right_hand_muscles_42369_ID"],42370:["Left_hand_muscles_42370_ID"],43883:["Right_Gracilis_43883_ID"],43884:["Left_Gracilis_43884_ID"],43890:["Right_inferior_medial_genicular_artery_43890_ID"],43891:["Left_inferior_medial_genicular_artery_43891_ID","Right_inferior_medial_genicular_artery_43891_ID"],43892:["Right_inferior_lateral_genicular_artery_43892_ID"],43893:["Left_inferior_lateral_genicular_artery_43893_ID"],43896:["Right_anterior_tibial_artery_43896_ID"],43897:["Right_anterior_tibial_artery_43897_ID","Left_anterior_tibial_artery_43897_ID"],43898:["Left_anterior_tibial_artery_43898_ID","Right_posterior_tibial_artery_43898_ID"],43899:["Left_posterior_tibial_artery_43899_ID"],43907:["Right_anterior_tibial_recurrent_artery_43907_ID"],43908:["Left_anterior_tibial_recurrent_artery_43908_ID"],43916:["Right_dorsalis_pedis_artery_43916_ID"],43917:["Left_dorsalis_pedis_artery_43917_ID"],43922:["Right_fibular_artery_43922_ID"],43923:["Left_fibular_artery_43923_ID"],43929:["Right_medial_plantar_artery_43929_ID"],43930:["Left_medial_plantar_artery_43930_ID"],43931:["Right_lateral_plantar_artery_43931_ID"],43932:["Left_lateral_plantar_artery_43932_ID"],43935:["Right_deep_medial_plantar_artery_43935_ID"],43936:["Left_deep_medial_plantar_artery_43936_ID"],43943:["Right_plantar_arch_43943_ID"],43944:["Left_plantar_arch_43944_ID"],43950:["Calcaneal_branch_of_right_fibular_artery_43950_ID"],43951:["Calcaneal_branch_of_left_fibular_artery_43951_ID"],44227:["Left_Popliteal_Lymph_Nodes_44227_ID","Right_Popliteal_Lymph_Nodes_44227_ID"],44249:["Right_Long_plantar_ligament_44249_ID","Left_Long_plantar_ligament_44249_ID"],44310:["Lymphatics_of_the_Lower_Limb_44310_ID"],44326:["Descending_branch_of_right_lateral_circumflex_femoral_Vein_44326_ID"],44327:["Descending_branch_of_left_lateral_circumflex_femoral_Vein_44327_ID"],44328:["Right_Popliteal_vein_44328_ID"],44329:["Left_Popliteal_vein_44329_ID"],44334:["Right_small_saphenous_vein_44334_ID"],44335:["Left_small_saphenous_vein_44335_ID"],44336:["Right_Anterior_Tibial_Vein_44336_ID"],44337:["Left_Anterior_Tibial_Vein_44337_ID"],44338:["Right_Posterior_Tibial_Vein_44338_ID"],44339:["Left_Posterior_Tibial_Vein_44339_ID"],44340:["Right_superficial_epigastric_vein_44340_ID"],44341:["Left_superficial_epigastric_vein_44341_ID"],44583:["Right_Oblique_Popliteal_Ligament_44583_ID"],44584:["Left_Oblique_Popliteal_Ligament_44584_ID"],44585:["Right_Patellar_Ligament_44585_ID"],44586:["Left_Patellar_Ligament_44586_ID"],44597:["Right_Arcuate_Popliteal_Ligament_44597_ID"],44599:["Left_Arcuate_Popliteal_Ligament_44599_ID"],44601:["Right_Tibial_Collateral_Ligament_44601_ID"],44602:["Left_Tibial_Collateral_Ligament_44602_ID"],44609:["Right_Fibular_Collateral_Ligament_44609_ID"],44610:["Left_Fibular_Collateral_Ligament_44610_ID"],44615:["Right_Anterior_Cruciate_Ligament_44615_ID"],44616:["Left_Anterior_Cruciate_Ligament_44616_ID"],44618:["Right_Posterior_Cruciate_Ligament_44618_ID"],44619:["Left_Posterior_Cruciate_Ligament_44619_ID"],44741:["Right_proper_plantar_digital_nerves_44741_ID"],44742:["Left_proper_plantar_digital_nerves_44742_ID"],44874:["Right_dorsal_branch_of_ulnar_nerve_44874_ID"],44875:["Left_dorsal_branch_of_ulnar_nerve_44875_ID"],44881:["Branch_of_Dorsal_venous_arch_of_Right_foot_44881_ID","Right_Dorsalis_pedis_vein_44881_ID","Dorsal_venous_arch_of_Right_foot_44881_ID"],44882:["Branch_of_Dorsal_venous_arch_of_Left_foot_44882_ID","Dorsal_venous_arch_of_Left_foot_44882_ID","Left_Dorsalis_pedis_vein_44882_ID"],44883:["Medial_branch_of_Plantar_venous_arch_of_right_foot_44883_ID","Plantar_venous_arch_of_Right_foot_44883_ID","Lateral_branch_of_Plantar_venous_arch_of_right_foot_44883_ID"],44884:["Medial_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Lateral_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Plantar_venous_arch_of_Left_foot_44884_ID"],44885:["Right_Fibular_vein_44885_ID"],44886:["Left_Fibular_vein_44886_ID"],44887:["Right_Superior_Medial_Genicular_vein_44887_ID","Right_Genicular_Veins_44887_ID","Right_Inferior_Medial_Genicular_Vein_44887_ID","Right_Superior_Lateral_Genicular_vein_44887_ID","Right_Inferior_Lateral_Genicular_Vein_44887_ID"],44888:["Left_Inferior_Lateral_Genicular_Vein_44888_ID","Left_Genicular_Veins_44888_ID","Left_Inferior_Medial_Genicular_Vein_44888_ID","Left_Superior_Medial_Genicular_vein_44888_ID","Left_Superior_Lateral_Genicular_vein_44888_ID"],44918:["Right_medial_circumflex_femoral_vein_44918_ID"],44919:["Left_medial_circumflex_femoral_vein_44919_ID"],44920:["Right_lateral_circumflex_femoral_vein_44920_ID"],44922:["Left_lateral_circumflex_femoral_vein_44922_ID"],45257:["Right_Intermediate_Femoral_Cutaneous_Nerve_45257_ID"],45258:["Left_Intermediate_Femoral_Cutaneous_Nerve_45258_ID"],45263:["Right_saphenous_nerve_45263_ID"],45264:["Left_saphenous_nerve_45264_ID"],45338:["Right_Posterior_femoral_cutaneous_nerve_45338_ID"],45339:["Left_Posterior_femoral_cutaneous_nerve_45339_ID"],45357:["Right_common_fibular_nerve_45357_ID"],45358:["Left_common_fibular_nerve_45358_ID"],45363:["Right_superficial_fibular_nerve_45363_ID"],45364:["Left_superficial_fibular_nerve_45364_ID"],45387:["Right_deep_fibular_nerve_45387_ID"],45388:["Left_deep_fibular_nerve_45388_ID"],45389:["Right_Lateral_terminal_branch_of_deep_fibular_nerve_45389_ID"],45390:["Left_Lateral_terminal_branch_of_deep_fibular_nerve_45390_ID"],45426:["Right_sural_nerve_45426_ID"],45427:["Left_sural_nerve_45427_ID"],45434:["Right_medial_proper_plantar_nerve_45434_ID"],45435:["Left_medial_proper_plantar_nerve_45435_ID"],45450:["Right_lateral_plantar_nerve_45450_ID"],45451:["Left_lateral_plantar_nerve_45451_ID"],45654:["Female_Internal_Genitalia_45654_ID"],45739:["Right_platysma_45739_ID"],45740:["Left_platysma_45740_ID"],45769:["Internal_Urethral_Sphincter_45769_ID"],45826:["Right_Stylohyoid_45826_ID"],45827:["Left_Stylohyoid_45827_ID"],45858:["Right_Iliococcygeus_45858_ID"],45859:["Left_Iliococcygeus_45859_ID"],45890:["Right_Biceps_Femoris_Short_Head_45890_ID"],45891:["Left_Biceps_Femoris_Short_Head_45891_ID"],46283:["Superior_oblique_part_of_right_longus_colli_46283_ID"],46284:["Superior_oblique_part_of_left_longus_colli_46284_ID"],46285:["Vertical_Intermediate_part_of_right_longus_colli_46285_ID"],46286:["Vertical_Intermediate_part_of_left_longus_colli_46286_ID"],46287:["Inferior_oblique_part_of_right_longus_colli_46287_ID"],46288:["Inferior_oblique_part_of_left_longus_colli_46288_ID"],46292:["Right_Digastric_46292_ID","Right_Digastric_muscle_46292_ID"],46293:["Left_Digastric_46293_ID","Left_Digastric_muscle_46293_ID"],46309:["Right_Longus_capitis_46309_ID"],46310:["Left_Longus_capitis_46310_ID"],46313:["Right_Rectus_capitis_anterior_46313_ID"],46314:["Left_Rectus_capitis_anterior_46314_ID"],46317:["Right_Rectus_capitis_lateralis_46317_ID"],46318:["Right_Rectus_capitis_lateralis_46318_ID","Left_Rectus_capitis_lateralis_46318_ID"],46319:["Left_Rectus_capitis_lateralis_46319_ID"],46321:["Right_Mylohyoid_muscle_46321_ID","Right_Mylohyoid_Muscle_46321_ID"],46322:["Left_Mylohyoid_46322_ID","Left_Mylohyoid_Muscle_46322_ID"],46326:["Right_Geniohyoid_46326_ID"],46327:["Left_Geniohyoid_46327_ID"],46443:["Right_Coccygeus_46443_ID"],46444:["Left_Coccygeus_46444_ID"],46563:["Vertical_part_of_left_cricothyroid_muscle_46563_ID","Right_Cricothyroid_muscle_46563_ID","Oblique_part_of_left_cricothyroid_muscle_46563_ID"],46564:["Vertical_part_of_left_cricothyroid_muscle_46564_ID","Left_Cricothyroid_muscle_46564_ID","Oblique_part_of_left_cricothyroid_muscle_46564_ID"],46621:["Superior_Pharyngeal_Constrictor_46621_ID"],46622:["Middle_Pharyngeal_Constrictor_46622_ID"],46623:["Inferior_Pharyngeal_Constrictor_46623_ID"],46690:["Genioglossus_46690_ID"],46703:["Right_Hyoglossus_46703_ID"],46704:["Left_Hyoglossus_46704_ID"],46705:["Right_Styloglossus_46705_ID"],46706:["Right_Styloglossus_46706_ID","Left_Styloglossus_46706_ID"],46759:["Right_frontalis_46759_ID"],46760:["Left_frontalis_46760_ID"],46761:["Right_occipitalis_46761_ID"],46762:["Left_occipitalis_46762_ID"],46768:["Epicranial_aponeurosis_46768_ID"],46777:["Depressor_septi_nasi_46777_ID"],46792:["Right_orbicularis_oculi_46792_ID"],46793:["Left_orbicularis_oculi_46793_ID"],46796:["Right_corrugator_supercilii_46796_ID"],46797:["Left_corrugator_supercilii_46797_ID"],46803:["Right_levator_labii_superioris_alaeque_nasi_46803_ID"],46804:["Left_levator_labii_superioris_alaeque_nasi_46804_ID"],46806:["Right_levator_labii_superioris_46806_ID"],46807:["Left_levator_labii_superioris_46807_ID"],46812:["Right_zygomaticus_major_46812_ID"],46813:["Left_zygomaticus_major_46813_ID"],46814:["Right_zygomaticus_minor_46814_ID"],46815:["Left_zygomaticus_minor_46815_ID"],46817:["Right_depressor_labii_inferioris_46817_ID"],46818:["Left_depressor_labii_inferioris_46818_ID"],46823:["Right_levator_anguli_oris_46823_ID"],46824:["Left_levator_anguli_oris_46824_ID"],46826:["Right_mentalis_46826_ID"],46827:["Left_mentalis_46827_ID"],46829:["Right_depressor_anguli_oris_46829_ID"],46830:["Left_depressor_anguli_oris_46830_ID"],46835:["Right_buccinator_46835_ID"],46836:["Left_buccinator_46836_ID"],46839:["Right_risorius_46839_ID"],46840:["Left_risorius_46840_ID"],46841:["Orbicularis_oris_46841_ID"],48025:["Left_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_Muscle_48025_ID","Left_Tendon_of_Digastric_Muscle_48025_ID"],48957:["Right_auricularis_superior_48957_ID"],48958:["Left_auricularis_superior_48958_ID"],48959:["Right_auricularis_anterior_48959_ID"],48960:["Left_auricularis_anterior_48960_ID"],48961:["Right_auricularis_posterior_48961_ID"],48962:["Left_auricularis_posterior_48962_ID"],48997:["Right_masseter_48997_ID"],48998:["Left_masseter_48998_ID"],49007:["Right_temporalis_49007_ID"],49008:["Left_temporalis_49008_ID"],49012:["Right_Medial_Pterygoid_49012_ID"],49013:["Left_Medial_Pterygoid_49013_ID"],49016:["Right_inferior_lateral_pterygoid_49016_ID","Right_superior_lateral_pterygoid_49016_ID"],49017:["Left_superior_lateral_pterygoid_49017_ID","Left_inferior_lateral_pterygoid_49017_ID"],49036:["Left_inferior_rectus_49036_ID"],49044:["Right_superior_rectus_49044_ID"],49045:["Left_superior_rectus_49045_ID"],49046:["Right_inferior_rectus_49046_ID"],49047:["Left_inferior_rectus_49047_ID"],49048:["Right_levator_palpebrae_superioris_49048_ID"],49049:["Left_levator_palpebrae_superioris_49049_ID"],49050:["Right_inferior_oblique_49050_ID"],49051:["Left_inferior_oblique_49051_ID"],49052:["Right_superior_oblique_49052_ID"],49053:["Left_superior_oblique_49053_ID"],49054:["Right_lateral_rectus_49054_ID"],49055:["Left_lateral_rectus_49055_ID"],49056:["Right_medial_rectus_49056_ID"],49057:["Left_medial_rectus_49057_ID"],49152:["Right_Ciliary_Muscle_49152_ID"],49153:["Left_Ciliary_Muscle_49153_ID"],49177:["Upper_Gastrointestinal_Tract_49177_ID"],49386:["Right_Inferior_extensor_retinaculum_49386_ID","Left_Inferior_extensor_retinaculum_49386_ID"],49388:["Right_Superior_extensor_retinaculum_49388_ID","Left_Superior_extensor_retinaculum_49388_ID"],49481:["Right_superior_laryngeal_artery_49481_ID"],49482:["Left_superior_laryngeal_artery_49482_ID"],49486:["Right_superior_thyroid_artery_49486_ID"],49487:["Left_superior_thyroid_artery_49487_ID"],49498:["Right_ascending_pharyngeal_artery_49498_ID"],49499:["Left_ascending_pharyngeal_artery_49499_ID"],49550:["Right_facial_artery_49550_ID"],49551:["Left_facial_artery_49551_ID","Right_facial_artery_49551_ID"],49552:["Left_facial_artery_49552_ID"],49556:["Right_ascending_palatine_artery_49556_ID"],49557:["Left_ascending_palatine_artery_49557_ID"],49559:["Right_tonsillar_artery_49559_ID"],49560:["Left_tonsillar_artery_49560_ID"],49561:["Right_tonsillar_artery_49561_ID"],49567:["Inferior_labial_artery_49567_ID"],49570:["Superior_labial_artery_49570_ID"],49584:["Right_angular_artery_49584_ID"],49585:["Left_angular_artery_49585_ID"],49625:["Right_posterior_auricular_artery_49625_ID"],49626:["Left_posterior_auricular_artery_49626_ID"],49651:["Right_superficial_temporal_artery_49651_ID"],49652:["Left_superficial_temporal_artery_49652_ID"],49658:["Right_transverse_facial_artery_49658_ID"],49659:["Left_transverse_facial_artery_49659_ID"],49660:["Right_transverse_facial_artery_49660_ID"],49676:["Right_maxillary_artery_49676_ID"],49677:["Left_maxillary_artery_49677_ID"],49678:["Right_maxillary_artery_49678_ID"],49705:["Right_mental_artery_49705_ID","branch_of_right_mental_artery_49705_ID"],49706:["Left_mental_artery_49706_ID","branch_of_left_mental_artery_49706_ID"],49712:["Right_middle_meningeal_artery_49712_ID"],49713:["Left_middle_meningeal_artery_49713_ID"],49743:["Right_deep_temporal_artery_49743_ID"],49744:["Left_deep_temporal_artery_49744_ID"],49755:["Right_buccal_artery_49755_ID"],49756:["Left_buccal_artery_49756_ID"],49768:["Right_infraorbital_artery_49768_ID"],49769:["Left_infraorbital_artery_49769_ID"],49792:["Right_descending_palatine_artery_49792_ID"],49793:["Left_descending_palatine_artery_49793_ID"],49799:["Left_greater_palatine_artery_49799_ID"],49800:["Right_greater_palatine_artery_49800_ID"],49802:["Right_lesser_palatine_artery_49802_ID"],49803:["Left_lesser_palatine_artery_49803_ID"],49805:["Right_sphenopalatine_artery_49805_ID"],49806:["Left_sphenopalatine_artery_49806_ID"],49810:["Right_posterior_lateral_nasal_artery_49810_ID"],49811:["Left_posterior_lateral_nasal_artery_49811_ID"],49812:["Posterior_septal_branch_of_right_sphenopalatine_artery_49812_ID"],49813:["Posterior_septal_branch_of_left_sphenopalatine_artery_49813_ID"],49869:["Right_opthalmic_artery_49869_ID","Right_ophthalmic_artery_49869_ID"],49870:["Left_opthalmic_artery_49870_ID","Left_ophthalmic_artery_49870_ID"],
49881:["Right_central_retinal_artery_49881_ID","Left_central_retinal_artery_49881_ID"],49911:["Right_Inferior_Pulmonary_vein_49911_ID"],49913:["Left_Inferior_Pulmonary_vein_49913_ID"],49914:["Right_Superior_Pulmonary_vein_49914_ID"],49916:["Left_Superior_Pulmonary_vein_49916_ID"],49928:["Right_lacrimal_artery_49928_ID"],49929:["Left_lacrimal_artery_49929_ID"],49974:["Right_supraorbital_artery_49974_ID"],49975:["Left_supraorbital_artery_49975_ID"],49987:["Right_anterior_ethmoidal_artery_49987_ID"],49988:["Left_anterior_ethmoidal_artery_49988_ID"],49990:["Right_posterior_ethmoidal_artery_49990_ID"],49991:["Left_posterior_ethmoidal_artery_49991_ID"],50001:["Right_dorsal_nasal_artery_50001_ID"],50002:["Left_dorsal_nasal_artery_50002_ID"],50026:["Right_supratrochlear_artery_50026_ID"],50027:["Left_supratrochlear_artery_50027_ID","Right_supratrochlear_artery_50027_ID"],50028:["Left_supratrochlear_artery_50028_ID"],50029:["Right_anterior_cerebral_artery_50029_ID"],50030:["Left_anterior_cerebral_artery_50030_ID"],50031:["Left_anterior_cerebral_artery_50031_ID"],50038:["Left_coronary_artery_50038_ID"],50039:["Right_Coronary_Artery_50039_ID"],50082:["Right_Middle_Cerebral_Artery_50082_ID"],50083:["Left_Middle_Cerebral_Artery_50083_ID"],50085:["Right_Posterior_Communicating_Artery_50085_ID"],50086:["Left_Posterior_Communicating_Artery_50086_ID"],50169:["Anterior_Communicating_Artery_50169_ID"],50197:["Muscles_of_the_Right_Arm_50197_ID"],50198:["Muscles_of_the_Right_Arm_50198_ID","Muscles_of_the_Left_Arm_50198_ID"],50203:["Right_upper_arm_muscles_50203_ID"],50204:["Right_upper_arm_muscles_50204_ID","Left_upper_arm_muscles_50204_ID"],50221:["Right_shoulder_muscles_50221_ID","Left_shoulder_muscles_50221_ID"],50222:["Left_shoulder_muscles_50222_ID","Right_shoulder_muscles_50222_ID"],50542:["Basilar_Artery_50542_ID"],50545:["Right_Anterior_Inferior_cerebellar_artery_50545_ID","Right_anterior_Inferior_cerebellar_artery_50545_ID"],50546:["Left_Anterior_Inferior_cerebellar_artery_50546_ID","Left_anterior_Inferior_cerebellar_artery_50546_ID"],50574:["Right_Superior_Cerebellar_artery_50574_ID"],50575:["Left_Superior_Cerebellar_Artery_50575_ID","Left_Superior_Cerebellar_artery_50575_ID"],50584:["Right_Posterior_cerebral_artery_50584_ID","Right_posterior_cerebral_artery_50584_ID"],50585:["Left_Posterior_cerebral_artery_50585_ID","Left_posterior_cerebral_artery_50585_ID"],50718:["Superior_Terminal_Branch_of_Right_Middle_Cerebral_Artery_50718_ID"],50719:["Superior_Terminal_Branch_of_Left_Middle_Cerebral_Artery_50719_ID"],50735:["Hepatic_Portal_and_Associated_Branches_50735_ID"],50764:["Right_transverse_sinus_50764_ID"],50765:["Left_transverse_sinus_50765_ID"],50767:["Superior_sagittal_sinus_50767_ID"],50768:["Inferior_Sagittal_Sinus_50768_ID"],50769:["Straight_Sinus_50769_ID"],50773:["Intercavernous_sinus_50773_ID"],50781:["Occipital_Sinus_50781_ID"],50784:["Sinus_Confluence_50784_ID"],50808:["Right_superior_thyroid_vein_50808_ID"],50809:["Left_superior_thyroid_vein_50809_ID"],50852:["Right_posterior_auricular_vein_50852_ID"],50853:["Left_posterior_auricular_vein_50853_ID"],50859:["Right_suprascapular_vein_50859_ID"],50860:["Left_suprascapular_vein_50860_ID","Right_suprascapular_vein_50860_ID"],50872:["Right_Pulmonary_artery_50872_ID"],50873:["Left_Pulmonary_artery_50873_ID"],50875:["Right_optic_nerve_50875_ID"],50876:["Left_Facial_Vein_50876_ID","Right_Facial_Vein_50876_ID"],50877:["Right_Facial_Vein_50877_ID","Left_Facial_Vein_50877_ID"],50878:["Left_optic_nerve_50878_ID"],50879:["Right_oculomotor_nerve_50879_ID"],50880:["Left_oculomotor_nerve_50880_ID"],50881:["Right_trochlear_nerve_50881_ID"],50882:["Left_trochlear_nerve_50882_ID"],50886:["Right_abducens_nerve_50886_ID"],50887:["Left_abducens_nerve_50887_ID"],50888:["Right_facial_nerve_50888_ID"],50889:["Left_facial_nerve_50889_ID"],50890:["Right_vestibulocochlear_nerve_50890_ID"],50891:["Left_vestibulocochlear_nerve_50891_ID"],50892:["Right_glossopharyngeal_nerve_50892_ID"],50894:["Left_glossopharyngeal_nerve_50894_ID"],50897:["Right_spinal_accessory_nerve_50897_ID","Left_spinal_accessory_nerve_50897_ID"],50899:["Left_spinal_accessory_nerve_50899_ID"],50902:["Right_hypoglossal_nerve_50902_ID"],50903:["Left_hypoglossal_Nerve_50903_ID"],50929:["Right_retromandibular_vein_50929_ID"],50930:["Left_retromandibular_vein_50930_ID"],50933:["Right_Superficial_Temporal_Vein_50933_ID"],50934:["Left_Superficial_Temporal_Vein_50934_ID"],51042:["Right_Deep_Femoral_vein_51042_ID"],51043:["Left_Deep_Femoral_vein_51043_ID"],51085:["Tendon_of_left_flexor_digitorum_brevis_51085_ID","Tendon_of_right_flexor_digitorum_brevis_51085_ID","Right_flexor_digitorum_longus_51085_ID","Left_flexor_digitorum_longus_51085_ID"],51289:["Right_superior_petrosal_sinus_51289_ID"],51290:["Left_superior_petrosal_sinus_51290_ID"],51402:["Right_Cavernous_sinus_51402_ID"],51403:["Left_Cavernous_Sinus_51403_ID"],51489:["Right_occipital_vein_51489_ID"],51490:["Left_occipital_vein_51490_ID"],51885:["Left_central_retinal_vein_51885_ID","Right_central_retinal_vein_51885_ID"],51942:["Right_superior_central_retinal_artery_51942_ID","Left_superior_central_retinal_artery_51942_ID"],51944:["Right_inferior_central_retinal_artery_51944_ID","Left_inferior_central_retinal_artery_51944_ID"],52619:["Right_trigeminal_ganglion_52619_ID"],52620:["Left_trigeminal_ganglion_52620_ID"],52629:["Right_lacrimal_nerve_52629_ID"],52630:["Left_lacrimal_nerve_52630_ID"],52639:["Right_opthalmic_nerve_52639_ID"],52640:["Left_opthalmic_nerve_52640_ID"],52643:["Right_supratrochlear_nerve_52643_ID"],52644:["Left_supratrochlear_nerve_52644_ID"],52661:["Medial_branch_of_right_supraorbital_nerve_52661_ID"],52662:["Medial_branch_of_left_supraorbital_nerve_52662_ID"],52663:["Lateral_branch_of_right_supraorbital_nerve_52663_ID"],52664:["Lateral_branch_of_left_supraorbital_nerve_52664_ID"],52669:["Right_nasociliary_nerve_52669_ID"],52670:["Left_nasociliary_nerve_52670_ID"],52725:["Right_maxillary_nerve_52725_ID"],52726:["Left_maxillary_nerve_52726_ID"],52734:["Frontal_bone_52734_ID"],52735:["Occipital_bone_52735_ID"],52736:["Sphenoid_bone_52736_ID"],52738:["Right_temporal_bone_52738_ID"],52739:["Left_temporal_bone_52739_ID"],52740:["Ethmoid_bone_52740_ID"],52745:["Nasal_bone_52745_ID"],52746:["Palatine_bone_52746_ID"],52748:["Mandible_52748_ID"],52749:["Hyoid_bone_52749_ID"],52784:["Left_lateral_posterior_superior_nasal_nerve_52784_ID"],52785:["Right_lateral_posterior_superior_nasal_nerve_52785_ID"],52788:["Right_parietal_bone_52788_ID"],52789:["Left_parietal_bone_52789_ID"],52803:["Right_greater_palatine_nerve_52803_ID"],52804:["Left_greater_palatine_nerve_52804_ID"],52806:["Right_lesser_palatine_nerve_52806_ID"],52807:["Left_lesser_palatine_nerve_52807_ID"],52824:["Left_posterior_inferior_nasal_nerve_52824_ID"],52825:["Right_posterior_inferior_nasal_nerve_52825_ID"],52892:["Right_zygomatic_bone_52892_ID"],52893:["Left_zygomatic_bone_52893_ID"],52974:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52974_ID"],52975:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52975_ID"],52976:["Zygomaticofacial_branch_of_right_zygomatic_nerve_52976_ID"],52977:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52977_ID","Zygomaticofacial_branch_of_left_zygomatic_nerve_52977_ID"],52978:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52978_ID"],52979:["Right_infraorbital_nerve_52979_ID"],52980:["Left_infra_orbital_nerve_52980_ID","Left_infraorbital_nerve_52980_ID"],52997:["Right_Mandibular_Nerve_52997_ID"],52998:["Left_Mandibular_Nerve_52998_ID"],53001:["Right_auriculotemporal_nerve_53001_ID"],53002:["Left_auriculotemporal_nerve_53002_ID"],53069:["Right_pterygopalatine_ganglion_53069_ID"],53070:["Left_pterygopalatine_ganglion_53070_ID"],53121:["Right_zygomatic_bone_53121_ID"],53122:["Left_zygomatic_bone_53122_ID"],53185:["Buccal_branch_of_right_facial_nerve_53185_ID","Buccal_branch_of_Right_Facial_Nerve_53185_ID"],53186:["Buccal_branch_of_Left_Facial_Nerve_53186_ID"],53219:["Right_lingual_nerve_53219_ID"],53220:["Left_lingual_nerve_53220_ID"],53244:["Right_Inferior_Alveolar_Nerve_53244_ID"],53245:["Left_Inferior_Alveolar_Nerve_53245_ID"],53251:["Right_mental_nerve_53251_ID","Left_mental_nerve_53251_ID"],53252:["Left_mental_nerve_53252_ID"],53279:["Right_posterior_auricular_nerve_53279_ID"],53280:["Left_posterior_auricular_nerve_53280_ID"],53290:["Temporal_branch_of_the_right_facial_nerve_53290_ID"],53291:["Temporal_branch_of_the_left_facial_nerve_53291_ID","Temporal_branch_of_the_right_facial_nerve_53291_ID"],53366:["Marginal_mandibular_branch_of_right_facial_nerve_53366_ID"],53367:["Marginal_mandibular_branch_of_left_facial_nerve_53367_ID"],53398:["Cervical_branch_of_right_facial_nerve_53398_ID"],53399:["Cervical_branch_of_left_facial_nerve_53399_ID"],53549:["Right_ciliary_ganglion_53549_ID"],53550:["Left_ciliary_ganglion_53550_ID"],53641:["Right_ear_53641_ID"],53642:["Left_ear_53642_ID"],53643:["Left_ear_53643_ID"],53645:["Right_Lacrimal_Bone_53645_ID"],53646:["Left_lacrimal_bone_53646_ID"],53654:["Palatine_bone_53654_ID"],54375:["Nasal_septum_54375_ID"],54449:["Right_eye_54449_ID"],54450:["Left_eye_54450_ID"],54640:["Tongue_54640_ID"],55099:["Thyroid_Cartilage_55099_ID"],55123:["Lower_part_of_cricopharyngeus_55123_ID"],55132:["Thyrohyoid_Membrane_55132_ID"],55143:["Right_ansa_cervicalis_nerve_55143_ID"],55144:["left_ansa_cervicalis_nerve_55144_ID"],55145:["Right_ansa_cervicalis_nerve_55145_ID"],55233:["Cricothyroid_ligament_55233_ID"],55560:["Right_Superior_Parathyroid_55560_ID"],55561:["Left_Superior_Parathyroid_55561_ID"],55562:["Right_Inferior_Parathyroid_55562_ID"],55563:["Left_Inferior_Parathyroid_55563_ID"],55610:["Right_procerus_55610_ID"],55611:["Left_procerus_55611_ID"],55612:["Transverse_part_of_right_nasalis_55612_ID"],55613:["Transverse_part_of_left_nasalis_55613_ID"],55614:["Alar_part_of_right_nasalis_55614_ID"],55615:["Alar_part_of_left_nasalis_55615_ID"],56103:["Right_Internal_acoustic_meatus_56103_ID"],56104:["Left_Internal_acoustic_meatus_56104_ID"],56427:["Right_tympanic_membrane_56427_ID"],56428:["Left_tympanic_membrane_56428_ID"],58236:["Right_Iris_58236_ID"],58237:["Left_Iris_58237_ID"],58242:["Right_Lens_58242_ID"],58243:["Left_Lens_58243_ID"],58271:["Right_Sclera_58271_ID"],58272:["Left_Sclera_58272_ID"],58299:["Right_Choroid_58299_ID"],58300:["Left_Choroid_58300_ID"],58302:["Right_Retina_58302_ID"],58303:["Left_Retina_58303_ID"],58841:["Right_Hyaloid_Canal_58841_ID"],58842:["Left_Hyaloid_Canal_58842_ID"],59102:["Right_lacrimal_gland_59102_ID"],59103:["Left_lacrimal_gland_59103_ID"],59505:["Right_major_alar_cartilage_59505_ID"],59506:["Left_major_alar_cartilage_59506_ID"],59512:["Right_lateral_nasal_cartilage_59512_ID"],59513:["Left_lateral_nasal_cartilage_59513_ID"],59545:["Right_lacrimal_sac_59545_ID"],59546:["Left_lacrimal_sac_59546_ID"],59797:["Left_Parotid_Gland_59797_ID","Right_Parotid_Gland_59797_ID"],59798:["Right_Parotid_Gland_59798_ID","Left_Parotid_Gland_59798_ID"],59802:["Right_Submandibular_Gland_59802_ID"],59803:["Left_Submandibular_Gland_59803_ID"],59804:["Right_Sublingual_Gland_59804_ID"],59805:["Left_Sublingual_Gland_59805_ID"],59866:["Right_Parotid_Duct_59866_ID"],59867:["Left_Parotid_Duct_59867_ID"],59964:["Right_Submandibular_Duct_59964_ID"],59965:["Left_Submandibular_Duct_59965_ID"],60180:["Right_osseous_labyrinth_60180_ID"],60181:["Left_osseous_labyrinth_60181_ID"],60188:["Right_Anterior_semicircular_canal_60188_ID"],60189:["Left_Anterior_semicircular_canal_60189_ID"],60191:["Right_Posterior_semicircular_canal_60191_ID"],60192:["Left_Posterior_semicircular_canal_60192_ID"],60194:["Right_Lateral_semicircular_canal_60194_ID"],60195:["Left_Lateral_semicircular_canal_60195_ID"],60202:["Right_Cochlea_60202_ID"],60203:["Left_Cochlea_60203_ID"],61020:["Right_Internal_Ear_61020_ID"],61021:["Left_Internal_Ear_61021_ID"],61735:["Right_external_acoustic_tube_61735_ID"],61736:["Left_external_acoustic_tube_61736_ID"],61965:["fornix_61965_ID"],62008:["hypothalamus_62008_ID"],62033:["Pineal_Gland_62033_ID"],62045:["optic_chiasm_62045_ID"],64919:["Right_Iliopsoas_64919_ID"],64920:["Left_Iliopsoas_64920_ID"],65015:["Left_Flexor_hallucis_longus_65015_ID","Right_Flexor_hallucis_longus_65015_ID"],65019:["Left_Tibialis_posterior_65019_ID","Right_Tibialis_posterior_65019_ID"],65281:["Right_long_thoracic_nerve_65281_ID"],65282:["Left_long_thoracic_nerve_65282_ID"],65536:["Right_lumbosacral_trunk_nerve_65536_ID"],65537:["Left_lumbosacral_trunk_nerve_65537_ID","Left_lumbosacral_trunk_65537_ID"],66321:["Right_thoracodorsal_artery_66321_ID"],66322:["right_thoracodorsal_artery_66322_ID","left_thoracodorsal_artery_66322_ID"],67584:["Left_nerve_of_pterygoid_canal_67584_ID","Right_nerve_of_pterygoid_canal_67584_ID"],67944:["cerebellum_67944_ID"],69316:["Right_Brachiocephalic_trunk_69316_ID"],69490:["Right_lateral_tarsal_artery_69490_ID"],69491:["Left_lateral_tarsal_artery_69491_ID"],69494:["Right_arcuate_artery_69494_ID"],69495:["Left_arcuate_artery_69495_ID"],69514:["Right_deep_plantar_artery_69514_ID"],69515:["Right_deep_plantar_artery_69515_ID"],69516:["Left_deep_plantar_artery_69516_ID"],69726:["Calcaneal_branch_of_right_posterior_tibial_artery_69726_ID"],69727:["Calcaneal_branch_of_left_posterior_tibial_artery_69727_ID"],70249:["Right_femoral_artery_70249_ID"],70250:["Left_femoral_artery_70250_ID"],70799:["Right_dorsal_metacarpal_arteries_70799_ID"],70800:["left_dorsal_metacarpal_arteries_70800_ID","right_dorsal_metacarpal_arteries_70800_ID"],70801:["left_dorsal_digital_arteries_70801_ID","right_dorsal_digital_arteries_70801_ID","Right_dorsal_digital_arteries_70801_ID","Right_palmar_metacarpal_arteries_70801_ID"],70802:["left_palmar_metacarpal_arteries_70802_ID","right_palmar_metacarpal_arteries_70802_ID","Right_common_palmar_digital_arteries_70802_ID"],70803:["right_common_palmar_digital_arteries_70803_ID","Right_proper_palmar_digital_arteries_70803_ID","left_common_palmar_digital_arteries_70803_ID"],70804:["left_proper_palmar_digital_arteries_70804_ID","right_proper_palmar_digital_arteries_70804_ID","left_common_palmar_digital_arteries_70804_ID"],70809:["Set_of_Jejunal_arteries_70809_ID"],70810:["Set_of_ileal_arteries_70810_ID"],70815:["Perforating_arteries_of_left_deep_fibular_artery_70815_ID","Perforating_arteries_of_right_deep_fibular_artery_70815_ID"],70889:["Left_lumbar_vein_70889_ID","Right_lumbar_vein_70889_ID"],70917:["Right_palmar_digital_veins_70917_ID"],70918:["right_palmar_digital_veins_70918_ID","left_palmar_digital_veins_70918_ID"],70922:["Right_distal_perforating_veins_70922_ID","Perforating_veins_of_right_deep_femoral_artery_70922_ID","Perforating_veins_of_left_deep_femoral_artery_70922_ID","Left_distal_perforating_veins_70922_ID"],70927:["Set_of_jejunal_veins_70927_ID"],70928:["Set_of_ileal_veins_70928_ID"],71132:["Gastrointestinal_Tract_71132_ID"],71211:["Right_lateral_thoracic_vein_71211_ID"],71212:["Left_lateral_thoracic_vein_71212_ID","Right_lateral_thoracic_vein_71212_ID"],71214:["Right_thoracodorsal_vein_71214_ID","Left_thoracodorsal_vein_71214_ID"],71215:["Right_thoracodorsal_vein_71215_ID"],71287:["Muscles_of_the_Head_and_Neck_71287_ID"],71291:["Muscles_of_the_Back_71291_ID"],71293:["Muscles_of_the_Thorax_71293_ID"],71310:["Left_Intertransversarii_71310_ID","Right_Intertransversarii_71310_ID"],71398:["Left_Radiate_Sternocostal_Ligaments_71398_ID","Right_Radiate_Sternocostal_Ligaments_71398_ID"],71894:["Right_carpal_bones_71894_ID","Left_carpal_bones_71894_ID"],71898:["Right_metacarpal_bones_of_hand_71898_ID","Left_metacarpal_bones_of_hand_71898_ID"],71900:["Phalanges_of_right_hand_71900_ID","Phalanges_of_left_hand_71900_ID"],72063:["Set_of_cervical_vertebrae_72063_ID"],72064:["Set_of_thoracic_vertebrae_72064_ID"],72065:["Set_of_lumbar_vertebrae_72065_ID"],72309:["Right_Stylohyoid_Ligament_72309_ID"],72311:["Left_Stylohyoid_Ligament_72311_ID"],72316:["Set_of_intervertebral_discs_72316_ID"],72826:["right_caudate_nucleus_72826_ID"],72827:["left_caudate_nucleus_72827_ID"],72828:["right_putamen_72828_ID"],72829:["left_putamen_72829_ID"],72832:["right_amygdaloid_body_72832_ID"],72833:["left_amygdaloid_body_72833_ID"],72856:["right_lateral_globus_pallidus_72856_ID"],72857:["left_lateral_globus_pallidus_72857_ID"],72858:["right_medial_globus_pallidus_72858_ID"],72859:["left_medial_globus_pallidus_72859_ID"],74048:["Right_stapes_74048_ID"],74049:["Left_stapes_74049_ID"],74050:["Right_Incus_74050_ID"],74051:["Left_Incus_74051_ID"],74052:["Right_malleus_74052_ID"],74053:["Left_malleus_74053_ID"],74073:["Right_Levatores_costarum_74073_ID"],74074:["Left_Levatores_costarum_74074_ID"],74075:["Right_Levatores_costarum_longi_74075_ID"],74076:["Left_Levatores_costarum_longi_74076_ID"],74079:["Right_Subcostales_74079_ID"],74080:["Left_Subcostales_74080_ID"],74525:["Occipital_74525_ID"],75150:["Teeth_75150_ID"],75398:["Superficial_dorsal_vein_of_penis_75398_ID"],75492:["Right_common_plantar_digital_nerves_75492_ID"],75493:["Left_common_plantar_digital_nerves_75493_ID"],76767:["Anterior_cardiac_vein_76767_ID"],76829:["Right_Zonula_Fibers_76829_ID","Left_Zonula_Fibers_76829_ID"],77161:["Intermediate_Hepatic_Vein_77161_ID"],77380:["Right_popliteal_artery_77380_ID"],77381:["Left_popliteal_artery_77381_ID"],77596:["Hypogastric_nerve_77596_ID"],77949:["Right_circumflex_scapular_vein_77949_ID"],77950:["Right_circumflex_scapular_vein_77950_ID","Left_circumflex_scapular_vein_77950_ID"],78023:["Right_lateral_brachial_vein_78023_ID"],78024:["right_lateral_brachial_vein_78024_ID","left_lateral_brachial_vein_78024_ID"],78209:["trunk_of_Hepatic_portal_vein_78209_ID"],78508:["Right_tarsal_bones_78508_ID"],78509:["Left_tarsal_bones_78509_ID"],78510:["Right_metatarsal_bones_78510_ID"],79468:["Right_accessory_meningeal_artery_79468_ID"],79469:["Left_accessory_meningeal_artery_79469_ID"],82695:["trunk_of_Hepatic_portal_vein_82695_ID"],82933:["Right_Nerve_to_levator_ani_82933_ID"],82934:["Left_Nerve_to_levator_ani_82934_ID"],85274:["External_Urethral_Sphincter_85274_ID"],86233:["Lymphatics_of_the_Upper_Limb_86233_ID"],86917:["Muscles_of_the_Abdomen_86917_ID"],87217:["Descending_aorta_thoracic_87217_ID","Descending_thoracic_aorta_87217_ID"],228738:["Muscles_of_the_Throat_228738_ID"],231317:["Phalanges_of_the_right_foot_231317_ID"],231319:["Phalanges_of_the_left_foot_231319_ID"],258714:["right_thalamus_258714_ID"],258716:["left_thalamus_258716_ID"],258847:["Right_Calcaneal_Tendon__aka_Achilles_Tendon_258847_ID"],258848:["Left_Calcaneal_Tendon__aka_Achilles_Tendon_258848_ID"],268668:["Right_interosseous_recurrent_artery_268668_ID"],268669:["right_interosseous_recurrent_artery_268669_ID","left_interosseous_recurrent_artery_268669_ID"]},function(){"use strict";var a=Human.clients={};a.numConnections=0,a.addClient=function(b){b({connected:function(){a.numConnections++,Human.events.fire("clients.connected",{})},disconnected:function(){a.numConnections--,Human.events.fire("clients.disconnected",{})}})}}(),function(){"use strict";var a=Human.cookies={};a.setCookie=function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},a.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},a.eraseCookie=function(b){a.setCookie(b,"",-1)}}(),function(){"use strict";var a=Human.init={},b=!1;a.bookmark={},a.cameraBookmark={},a.saveReset=function(){var b=Human.bookmarks.capture(),c=b.modules;if(c){var d=c.active;d&&d.length>1&&(c.active=[c.active[0]])}a.bookmark=b,Human.timeline.activeRoot&&(a.bookmark.camera=Human.timeline.activeRoot._chapters[0].camera.location)},a.reset=function(b){return a.bookmark?(Human.renderer.lights.restoreDefaults(),void Human.bookmarks.restore(a.bookmark,function(){Human.events.fire("init.reset"),b&&b()},function(a){Human.log.error("Human.init.reset","Reset failed: "+a),b&&b()})):(Human.log.error("Human.init.reset","Bookmark for reset was not captured"),void(b&&b()))},a.resetCamera=function(b){var c=Human.timeline.getCurrentChapterCamera();if(c)return void Human.renderer.camera.fly.flyTo(c,b);var d,e,f=0,g=Human.modules.activeModules;for(var h in g)g.hasOwnProperty(h)&&(e=g[h],e.camera&&e.timeActivated>f&&(d=e));return d?void Human.renderer.camera.fly.flyTo(d.camera,b):a.bookmark?void Human.renderer.camera.fly.flyTo(a.bookmark.camera,b):(Human.log.error("Human.init.resetCamera","Bookmark for reset was not captured"),void(b&&b()))},a.init=function(a){Human.renderer.init(),Human.assets.init(),Human.events.fire("loaded"),a&&a()},a.start=function(){b=!0,a.saveReset(),Human.events.fire("started")}}(),function(){"use strict";function a(){b.setFogEnabled(i),b.setFogMode(j),b.setFogStart(l),b.setFogEnd(m),b.setFogMin(n),b.setFogMax(o),b.setFogDensity(k),b.setFogColor(p[0],p[1],p[2]),g=!1}var b,c=14,d=100,e=Human.renderer={highlightColor:new Float32Array([1.5,1.5,.5]),xrayBGColor:new Float32Array([.2,.2,.3]),frameRateThrottled:!1,testContextLoss:!1,viewportDirty:!0,lastFrameStats:{gpuTime:0,cpuTime:0}},f={alpha:SceneJS.TRANSPARENCY_FLAGS.ALPHA,improvedAlpha:SceneJS.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,addAlpha:SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA,alphaToCoverage:SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE,weightedOIT:SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT},g=!1,h=!1,i=!1,j=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,k=.01,l=0,m=1e3,n=0,o=1,p=new Float32Array([1,1,1]),q=0,r=0,s=0,t=1,u=0,v=!1,w={timeStarted:0,timeLast:0,timeNow:0,tick:0},x={frameStart:0,lastFrameStart:0},y={frameStart:0,frameEnd:0,lastFrameEnd:0},z=mat4.create(),A=mat4.create(),B=vec3.create(),C=vec4.create();Human.properties.subscribe({propId:"highlight.color",value:e.highlightColor,callback:function(a){e.highlightColor=a,g=!0}}),Human.properties.subscribe({propId:"fog.enabled",value:i,callback:function(a){i=a,g=!0}}),Human.properties.subscribe({propId:"fog.mode",value:j,callback:function(a){j=a,g=!0}}),Human.properties.subscribe({propId:"fog.start",value:l,callback:function(a){l=a,g=!0}}),Human.properties.subscribe({propId:"fog.end",value:m,callback:function(a){m=a,g=!0}}),Human.properties.subscribe({propId:"fog.min",value:n,callback:function(a){n=a,g=!0}}),Human.properties.subscribe({propId:"fog.max",value:o,callback:function(a){o=a,g=!0}}),Human.properties.subscribe({propId:"fog.density",value:k,callback:function(a){k=a,g=!0}}),Human.properties.subscribe({propId:"fog.color",value:p,callback:function(a){p=a,g=!0}}),e.init=function(){SceneJS.WEBGL_INFO.SOFTWARE_RENDERER&&Human.log.error("This browser is using a software renderer for WebGL. Expect substantially reduced rendering performance.");var f=Date.now(),i=f,j=0;SceneJS.setMaxPointSize(255),b=this.graph.init(),this.postprocess.init(b),this.canvas.init(),this.lights.init(),this.setXrayBGColor(this.xrayBGColor),requestAnimationFrame(function k(){requestAnimationFrame(k);var l=b.getGPUTimer(),m=b.getGPUTimerQuery(),n=b.getGL();if(l&&v){var o=l.getQueryObjectEXT(m,l.QUERY_RESULT_AVAILABLE_EXT),p=n.getParameter(l.GPU_DISJOINT_EXT);o&&(v=!1),o&&!p&&(e.lastFrameStats.gpuTime=l.getQueryObjectEXT(m,l.QUERY_RESULT_EXT)/1e6)}if(!(h||(++u,t>u))){u=0;var z=Human.timer.now();l&&!v&&l.beginQueryEXT(l.TIME_ELAPSED_EXT,m),x.frameStart=Human.timer.now(),Human.events.fire("frameStart",x),x.lastFrameStart=x.frameStart,g&&a(),e.viewportDirty&&(b.setViewport(0,0,e.canvas.width,e.canvas.height),e.viewportDirty=!1);var A=Human.timer.now();if(w.timeStarted=f,w.timeLast=i,w.timeNow=A,w.tick=j,Human.events.fire("tick",w),i=A,j++,!e.frameRateThrottled){var B=b.stats.frame;if(r+=B.gpuTime,s+=B.cpuTime,++q===d){var C=r/q,D=s/q;(D>c||C>c)&&(e.setTicksPerRender(2),e.frameRateThrottled=!0),r=0,s=0,q=0}}e.prepareFrame(w),b.render(),y.frameStart=x.frameStart,y.frameEnd=Human.timer.now(),Human.events.fire("frameEnd",y),y.lastFrameEnd=y.frameEnd,l&&!v&&(l.endQueryEXT(l.TIME_ELAPSED_EXT),v=!0),e.lastFrameStats.cpuTime=Human.timer.now()-z}})},e.prepareFrame=function(){Human.timeline.onFrame(),Human.renderer.lights.onFrame(),Human.renderer.clip.onFrame(),Human.renderer.camera.onFrame(),Human.scene.onFrame(),Human.scene.markers.onFrame(),Human.events.fire("cull",w),Human.scene.cull()},e.updateDisplayForBG=function(){g=!0},e.pushPause=function(){e._pauses=e._pauses?e._pauses+1:1,1===e._pauses&&(h=!0)},e.popPause=function(){e._pauses&&0===--e._pauses&&(h=!1,b.render())},e.pauseCompilation=function(){b.pauseCompilation()},e.resumeCompilation=function(){b.resumeCompilation()},e.setTicksPerRender=function(a){t=a,u=0},e.resetFrameThrottling=function(){e.frameRateThrottled&&(e.setTicksPerRender(1),e.frameRateThrottled=!1)},e.setTransparencyMode=function(a){var c=f[a];return void 0===c?void Human.log.error("Unrecognized transparency mode: "+a):(b.setTransparencyMode(c),void("alphaToCoverage"===a?Human.renderer.postprocess.disable():Human.renderer.postprocess.enable()))},e.setDepthSort=function(a){b.setDepthSort(a)},e.onTasksComplete=function(a){void 0!==e._pauses&&null!==e._pauses&&e._pauses>0&&Human.log.error("Human.renderer.onTaskComplete","Renderer deadlock: Human.renderer.pushPause has paused renderer. Renderer needs to be unpaused in order to complete pending tasks.");var b=Human.renderer.getScene().getStatus().numTasks;if(!b||0===b)return void a();if(e.__checkLoaded)throw"Human.renderer.onTasksComplete: already blocking";e.__checkLoaded=window.setInterval(function(){var b=Human.renderer.getScene().getStatus().numTasks;b&&0!==b||(window.clearInterval(e.__checkLoaded),e.__checkLoaded=null,a())},200)},e.compile=function(){b.compile()},e.forceRenderFrame=function(a){a=a||{},a.force=!0,b.render(a)},e.getScene=function(){return b},e.getLibraryRoot=function(){return b},e.getNode=function(a){return b.findNode(a)},e.nodeExists=function(a){var c=b.findNode(a);return null!==c&&void 0!==c},e.loseContext=function(){b.loseWebGLContext()},e.getViewMat=function(){return b.getViewMatrix()},e.getProjMat=function(){return b.getProjectionMatrix()},e.checkWebGLExtension=function(a){return SceneJS.checkExtension(a)},e.setXrayBGColor=function(a){this.xrayBGColor.set(a),b.setXrayColor(a[0],a[1],a[2])},e.viewPositionToCanvas=function(a,b){var c=e.getProjMat();C.set(a),C[3]=1,vec4.transformMat4(C,C,c);var d=C[3];return b[0]=.5*this.canvas.width*(1+C[0]/d),b[1]=.5*this.canvas.height*(1-C[1]/d),b},e.worldPositionToCanvas=function(a,b){return vec3.transformMat4(B,a,e.getViewMat()),e.viewPositionToCanvas(B,b)},e.getResolutionScalingSupported=function(){function a(){var a=Element.prototype,d=Function.call.bind(Array.prototype.slice),f=Function.call.bind(a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector||a.oMatchesSelector),g=function(a,b){return f(a,b.selectorText)},h=function(a,b){return a in b.style&&""!==b.style[a]},i=d(document.styleSheets).reduce(function(a,b){return a.concat(d(b.cssRules))},[]),j=i.filter(g.bind(null,e.canvas.canvas)),k=h.bind(null,"width"),l=h.bind(null,"height");c=j.some(k)&&j.some(l),b=!0}var b=!1,c=!1;return function(){return b||a(),c}}(),e.setResolutionScaling=function(a){1>a&&(a=1),b.setResolutionScaling(a)},e.canvasPositionToWorldRay=function(a,b,c,d){var e=2*a/Human.renderer.canvas.width-1,f=1-2*b/Human.renderer.canvas.height,g=Human.renderer.camera.eye;c[0]=g.x,c[1]=g.y,c[2]=g.z,d[0]=e,d[1]=f,d[2]=.5;var h=mat4.invert(z,this.getProjMat()),i=mat4.invert(A,this.getViewMat());vec3.transformMat4(d,d,h),vec3.transformMat4(d,d,i),vec3.subtract(d,d,c),vec3.normalize(d,d)};var D=vec3.create(),E=vec3.create(),F=vec3.create(),G=vec3.create(),H=vec3.create(),I=vec3.create();e.canvasCircleToWorldSphereRadius=function(a,b,c,d){this.canvasPositionToWorldRay(a,b+c,H,I);var e=Human.renderer.camera.getLookDir(B),f=vec3.dot(e,I);if(f>.001){vec3.subtract(D,d,H);var g=vec3.dot(D,e)/f;return vec3.scale(F,I,g),vec3.add(E,H,F),vec3.subtract(G,E,d),vec3.length(G)}return 0}}(),function(){"use strict";var a,b={xform:1,properties:2,texture:3,material:3,cubemap:3,fresnel:3,billboard:3,morphGeometry:4,geometry:5},c=Human.renderer.graph={libraryRootNode:null},d={type:"scene",canvasId:Human.canvasId,transparent:!0,contextAttr:{preserveDrawingBuffer:!1,antialias:!0}};c.init=function(){return d.canvasId=Human.canvasId,a=SceneJS.createScene(d,{simulateWebGLContextLost:Human.renderer.testContextLoss}),this.libraryRootNode=a.addNode({type:"library"}),a.setCamera({eye:[0,0,55],look:[0,0,0],up:[0,1,0]}),a.setProjection({type:"perspective",fov:60,near:.01,far:400,fovAxis:"y",pan:{x:0,y:0,z:0}}),a},c.createSubtree=function(b){return a.addNode(b)},c.insertNode=function(a,c){c instanceof SceneJS.Node?c.parent&&"library"===c.parent.type?c.disconnect():c={type:c.type,coreId:c.getCoreId()}:"reflect"===c.type&&(c.type="cubemap");for(var d=c.type,e=b[d],f=a;f;){var g=b[f.type]?b[f.type]:0;if(g>e){var h=f.parent;return f.disconnect(),c=h.addNode(c),c.addNode(f),c}if(0===f.nodes.length)return f.addNode(c);f=f.nodes[0]}},c.disconnectNode=function(a){var b=a.parent,c=a.disconnectNodes();a.disconnect(),b.addNodes(c)},c.destroySubtree=function(a){a.destroy()}}(),function(){"use strict";var a=Human.renderer.bg={},b=null;a.getBGColor=function(){var a=null;if(b){a=[];for(var c=0;c<b.length;c++)a.push(b[c])}return a},a.setBGColor=function(a){Array.isArray(a)&&(b=a)}}(),function(){"use strict";function a(){var a=Human.renderer.canvas.canvas,b=Human.renderer.canvas.annotationCanvas,c=a.parentNode,d=c.clientWidth,e=c.clientHeight;Human.renderer.canvas.width=d,Human.renderer.canvas.height=e,a.width=d,a.height=e,b.width=d,b.height=e,Human.renderer.viewportDirty=!0,Human.renderer.camera.updateCanvas(),Human.renderer.postprocess.updateCanvas(),Human.renderer.draw.updateCanvas(),Human.events.fire("canvas.resized",{canvasWidth:d,canvasHeight:e})}Human.renderer.canvas={canvas:null,annotationCanvas:null,context2D:null,width:0,height:0},Human.renderer.canvas.init=function(){this.canvas=document.getElementById(Human.canvasId),this.annotationCanvas=document.getElementById(Human.annotationCanvasId),this.context2D=this.annotationCanvas.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,a()},Human.renderer.resize=a,window.addEventListener("resize",a)}(),function(){"use strict";function a(){var a=b,f=a.near,j=a.far,k=a.aspect,l=a.fovy*Math.PI/180;c[0]=a.eye.x,c[1]=a.eye.y,c[2]=a.eye.z,d[0]=a.look.x,d[1]=a.look.y,d[2]=a.look.z,e[0]=a.up.x,e[1]=a.up.y,e[2]=a.up.z;var o=Math.tan(.5*l)*f,q=o*k;vec3.subtract(m,d,c),vec3.normalize(m,m),vec3.cross(g,m,e),vec3.normalize(g,g),vec3.cross(e,g,m),vec3.scale(n,m,f),vec3.add(h,c,n),vec3.scale(n,m,j),vec3.add(i,c,n),vec3.scale(p[a.FRUSTUM_NEAR].n,m,-1),p[a.FRUSTUM_NEAR].d=-vec3.dot(h,p[a.FRUSTUM_NEAR].n),p[a.FRUSTUM_FAR].n.set(m),p[a.FRUSTUM_FAR].d=-vec3.dot(i,p[a.FRUSTUM_FAR].n),vec3.scale(n,g,q),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_RIGHT].n,n,e),p[a.FRUSTUM_RIGHT].d=-vec3.dot(c,p[a.FRUSTUM_RIGHT].n),vec3.scale(n,g,-q),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_LEFT].n,e,n),p[a.FRUSTUM_LEFT].d=-vec3.dot(c,p[a.FRUSTUM_LEFT].n),vec3.scale(n,e,o),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_TOP].n,g,n),p[a.FRUSTUM_TOP].d=-vec3.dot(c,p[a.FRUSTUM_TOP].n),vec3.scale(n,e,-o),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_BOTTOM].n,n,g),p[a.FRUSTUM_BOTTOM].d=-vec3.dot(c,p[a.FRUSTUM_BOTTOM].n)}var b=Human.renderer.camera={FRUSTUM_TOP:0,FRUSTUM_BOTTOM:1,FRUSTUM_LEFT:2,FRUSTUM_RIGHT:3,FRUSTUM_NEAR:4,FRUSTUM_FAR:5,autoSetNearFar:!0,nearFarDirty:!1},c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create(),h=vec3.create(),i=vec3.create(),j=vec3.create(),k=vec3.create(),l=vec3.create(),m=vec3.create(),n=vec3.create(),o=mat4.create(),p=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],q=!0;b.eye={x:0,y:0,z:-80},b.look={x:0,y:0,z:0},b.up={
x:0,y:1,z:0},b.rotationCenter=vec3.create(),b.lookDistance=80,b._screenPan={x:0,y:0,z:0},b._startcamera={eye:b.eye,look:b.look,up:b.up};var r=!0,s=!0,t=!1;b.lock=!1,b.aspect=1,b.fovy=55,Human.properties.subscribe({propId:"camera.optics.fov",value:b.fovy,callback:function(a){b.fovy=a,s=!0}}),b.near=.1,b.far=5e3,b.minZoom=.01,b.maxZoom=150,Human.properties.subscribe({propId:"camera.zoomLimits",value:{min:.01,max:150},callback:function(a){return a.min<.01?void Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' too small - should be >= 0.01"):a.min>=a.max?void Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' should be less than camera.zoomLimits.max"):(b.minZoom=a.min,b.maxZoom=a.max,void(r=!0))}}),b.updateCanvas=function(){b.setAspect(Human.renderer.canvas.width/Human.renderer.canvas.height)},b.setLookAt=function(a){var e=a.eye||b.eye,f=a.look||b.look,g=a.up||b.up;b.eye=e,b.look=f,b.up=g,Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),b.lookDistance=vec3.distance(c,d),a.look&&!a.preserveCenter&&this.setRotationCenter(a.look.x,a.look.y,a.look.z),r=!0},b.setRotationCenter=function(a,c,d){b.rotationCenter[0]=a,b.rotationCenter[1]=c,b.rotationCenter[2]=d},b.getLookAt=function(){return{eye:b.eye,look:b.look,up:b.up}},b.getLookDir=function(a){var b=this.eye,c=this.look;return a[0]=c.x-b.x,a[1]=c.y-b.y,a[2]=c.z-b.z,vec3.normalize(a,a),a},b.setScreenPan=function(a){b._screenPan.x=a.x||0,b._screenPan.y=a.y||0,b._screenPan.z=a.z||0,s=!0},b.getScreenPan=function(){return b._screenPan},b._reset={eye:{x:b.eye.x,y:b.eye.y,z:b.eye.z},look:{x:b.look.x,y:b.look.y,z:b.look.z},up:{x:b.up.x,y:b.up.y,z:b.up.z}},b.reset=function(){b.yaw=0,b.pitch=90,b._eye={x:b._reset.eye.x,y:b._reset.eye.y,z:b._reset.eye.z},b._look={x:b._reset.look.x,y:b._reset.look.y,z:b._reset.look.z},b._up={x:b._reset.up.x,y:b._reset.up.y,z:b._reset.up.z},b.rotationCenter.set([b._reset.look.x,b._reset.look.y,b._reset.look.z]),r=!0},b.rotateY=function(a){if(!b.lock){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(c,c,b.rotationCenter),vec3.subtract(d,d,b.rotationCenter);var f=Human.math.sign(e[1])||1;mat4.fromRotation(o,f*a*.0174532925,Human.math.Y_AXIS),vec3.transformMat4(c,c,o),vec3.transformMat4(d,d,o),vec3.transformMat4(e,e,o),vec3.add(c,c,b.rotationCenter),vec3.add(d,d,b.rotationCenter),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},up:{x:e[0],y:e[1],z:e[2]},preserveCenter:!0})}},b.rotateX=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(c,c,b.rotationCenter),vec3.subtract(d,d,b.rotationCenter),vec3.subtract(k,d,c),vec3.normalize(k,k),vec3.normalize(l,e),vec3.cross(f,l,k),mat4.fromRotation(o,.0174532925*a,f),vec3.transformMat4(c,c,o),vec3.transformMat4(d,d,o),vec3.transformMat4(e,e,o),vec3.add(c,c,b.rotationCenter),vec3.add(d,d,b.rotationCenter),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},up:{x:e[0],y:e[1],z:e[2]},preserveCenter:!0}))};var u=vec3.create();b.pan=function(a){if(!b.lock){if(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(u,c,d),j[0]=j[1]=j[2]=0,void 0!==a.x){vec3.normalize(k,u),vec3.normalize(l,e);var g=vec3.cross(f,u,e);vec3.normalize(g,vec3.cross(f,u,e)),vec3.scale(n,g,a.x),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]}void 0!==a.y&&(vec3.normalize(l,e),vec3.scale(n,l,a.y),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]),void 0!==a.z&&(vec3.normalize(k,c),vec3.scale(n,k,a.z),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]),vec3.add(c,c,j),vec3.add(d,d,j),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},preserveCenter:!0})}},b.setAspect=function(a){b.aspect=a,s=!0},b.viewRight=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:-c,y:d,z:0},up:{x:0,y:1,z:0}})}},b.viewLeft=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:c,y:d,z:0},up:{x:0,y:1,z:0}})}},b.viewPosterior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:d,z:-c},up:{x:0,y:1,z:0}})}},b.viewAnterior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:d,z:c},up:{x:0,y:1,z:0}})}},b.viewSuperior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:-c+d,z:0},up:{x:0,y:0,z:1}})}},b.viewInferior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:c+d,z:0},up:{x:0,y:0,z:-1}})}},b.zoom=function(a){if(!b.lock){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var e=Math.abs(vec3.length(c)),f=Math.abs(e+a);if(b.minZoom&&b.maxZoom){var g=e/b.maxZoom*.6;a=40*a*g,f=Math.abs(e+a),f<b.minZoom?f=b.minZoom:f>b.maxZoom&&(f=b.maxZoom)}vec3.normalize(k,c),vec3.scale(c,k,f),vec3.add(c,d,c),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},preserveCenter:!0})}},b.setZoom=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d),vec3.normalize(k,c),vec3.scale(c,k,b.minZoom+(1-a)*(b.maxZoom-b.minZoom)),vec3.add(c,d,c),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},preserveCenter:!0}))},b.getZoom=function(){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var a=Math.abs(vec3.length(c));return 1-(a-b.minZoom)/b.maxZoom},b.setZoomPercent=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d),vec3.normalize(k,c),vec3.scale(c,k,b.minZoom+.01*(100-a)*(b.maxZoom-b.minZoom)),b.setLookAt({eye:{x:d[0]+c[0],y:d[1]+c[1],z:d[2]+c[2]},preserveCenter:!0}))},b.getZoomPercent=function(){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var a=Math.abs(vec3.length(c));return 100-(a-b.minZoom)/b.maxZoom*100},b.getFrustum=function(){return q&&(a(),q=!1),p},b.getSubRegionFrustum=function(a,f,j,k){var l=b,o=l.near,p=l.far,q=l.aspect,r=l.fovy*Math.PI/180;c[0]=l.eye.x,c[1]=l.eye.y,c[2]=l.eye.z,d[0]=l.look.x,d[1]=l.look.y,d[2]=l.look.z,e[0]=l.up.x,e[1]=l.up.y,e[2]=l.up.z,vec3.subtract(m,d,c),vec3.normalize(m,m),vec3.cross(g,m,e),vec3.normalize(g,g),vec3.cross(e,g,m),vec3.normalize(e,e),vec3.scale(n,m,o),vec3.add(h,c,n);var s=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],t=Math.tan(.5*r)*o,u=t*q,v=Human.renderer.canvas.width/2,w=Human.renderer.canvas.height/2,x=(a-v)/v,y=x+j/v,z=(w-f)/w,A=z-k/w;return s[b.FRUSTUM_NEAR].n.set(m),s[b.FRUSTUM_NEAR].d=-vec3.dot(s[b.FRUSTUM_NEAR].n,h),vec3.scale(n,m,p),vec3.add(i,c,n),s[b.FRUSTUM_FAR].n.set([-m[0],-m[1],-m[2]]),s[b.FRUSTUM_FAR].d=-vec3.dot(s[b.FRUSTUM_FAR].n,i),vec3.scale(n,g,x*u),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,n,e),vec3.normalize(n,n),s[b.FRUSTUM_LEFT].n.set(n),s[b.FRUSTUM_LEFT].d=-vec3.dot(n,c),vec3.scale(n,g,y*u),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,e,n),vec3.normalize(n,n),s[b.FRUSTUM_RIGHT].n.set(n),s[b.FRUSTUM_RIGHT].d=-vec3.dot(n,c),vec3.scale(n,e,A*t),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,g,n),vec3.normalize(n,n),s[b.FRUSTUM_BOTTOM].n.set(n),s[b.FRUSTUM_BOTTOM].d=-vec3.dot(n,c),vec3.scale(n,e,z*t),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,n,g),vec3.normalize(n,n),s[b.FRUSTUM_TOP].n.set(n),s[b.FRUSTUM_TOP].d=-vec3.dot(n,c),s},b.onFrame=function(){if(r){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e);var a=Human.renderer.getScene();a.setCamera({eye:c,look:d,up:e}),vec3.subtract(n,c,d),Human.events.fire("camera.updated",{eye:b.eye,look:b.look,up:b.up,dist:Math.abs(vec3.length(n))}),t=!1,r=!1,q=!0,b.nearFarDirty=!0}else t||(t=!0,Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(n,c,d),Human.events.fire("camera.rested",{eye:b.eye,look:b.look,up:b.up,dist:Math.abs(vec3.length(n))}));if(b.autoSetNearFar&&b.nearFarDirty){var f=Human.scene.getBoundary(),g=Human.particles.getBoundary(),h=Math.min(f.xmin,g.xmin),i=Math.min(f.ymin,g.ymin),j=Math.min(f.zmin,g.zmin),k=Math.max(f.xmax,g.xmax),l=Math.max(f.ymax,g.ymax),m=Math.max(f.zmax,g.zmax),o=Human.renderer.getViewMat(),p=o[2],u=o[6],v=o[10],w=o[14],x=k-h,y=l-i,z=m-j,A=Math.sqrt(x*x+y*y+z*z),B=h*p+i*u+j*v+w;isFinite(B)&&(B=Math.max(B,k*p+i*u+j*v+w),B=Math.max(B,h*p+l*u+j*v+w),B=Math.max(B,h*p+i*u+m*v+w),B=Math.max(B,k*p+l*u+j*v+w),B=Math.max(B,k*p+i*u+m*v+w),B=Math.max(B,h*p+l*u+m*v+w),B=Math.max(B,k*p+l*u+m*v+w),b.near=Math.max(-B,.1),b.far=b.near+A,b.nearFarDirty=!1,s=!0)}s&&(Human.renderer.getScene().setProjection({type:"perspective",fov:b.fovy,near:b.near,far:b.far,aspect:b.aspect,pan:b._screenPan}),s=!1,q=!0,Human.renderer.postprocess.updateProjection())}}(),function(){"use strict";var a=Human.renderer.pick={};a.pick=function(a,b,c){var d=Human.renderer.getScene();if(!d)return null;var e={objectId:null},f=null,g=d.pick(a,b,c)||null;if(g){f=Human.scene.objects[g.name];var h=g.objectId;if(e=Human.utils.apply(g,e),f&&(e.objectId=f.objectId,h))for(var i=0,j=f.renderables.length;j>i;++i){var k=f.renderables[i].getRenderObject();if(k&&k.id===h){e.renderableIndex=i;break}}}return f?Human.events.fire("pick.picked",e):Human.events.fire("pick.missed",e),e}}(),function(){"use strict";function a(){k=Human.renderer.getScene().addNode({type:"properties",properties:{enabled:!1,backfaces:!0,clipping:!1,picking:!1,noDepthMask:!0}}),l=k.addNode({type:"xform"}),l.addNode({type:"material",emit:.9,baseColor:{r:.3,g:.3,b:.4},specularColor:{r:.3,g:.3,b:.4},specular:0,shine:100,alpha:.2,nodes:[{type:"geometry/plane"}]})}var b=Human.renderer.clip={};b.LEFT=0,b.RIGHT=1,b.BOTTOM=2,b.TOP=3,b.FRONT=4,b.BACK=5;var c=[{n:new Float32Array([-1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,-1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,-1]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,1]),d:0,fade:!1,fadeDistance:0}],d={xmin:1/0,xmax:-(1/0),ymin:1/0,ymax:-(1/0),zmin:1/0,zmax:-(1/0)},e=new Array(c.length),f=new Float32Array(c.length),g=new Array(c.length),h=[],i=!0,j={left:b.LEFT,right:b.RIGHT,bottom:b.BOTTOM,top:b.TOP,front:b.FRONT,back:b.BACK},k=null,l=null,m=mat4.create(),n=mat4.create(),o=mat4.create(),p=mat4.create(),q=vec3.create(),r=vec3.fromValues(1,1,1);b.setClip=function(a){var d=void 0!==j[a.clipId]?j[a.clipId]:a.clipId,h=c[d],k=g[d]=a.boundary||Human.scene.getBoundary();if(void 0!==a.enabled&&(e[d]=a.enabled),void 0!==a.fade&&(h.fade=a.fade),void 0!==a.fadeDistance&&(h.fadeDistance=a.fadeDistance),void 0!==a.progress){var l=f[d]=a.progress,m=0,n=0;(d===b.LEFT||d===b.RIGHT)&&(m=k.xmax-k.xmin,n=k.xmin+.5*m),(d===b.TOP||d===b.BOTTOM)&&(m=k.ymax-k.ymin,n=k.ymin+.5*m),(d===b.FRONT||d===b.BACK)&&(m=k.zmax-k.zmin,n=k.zmin+.5*m),(d===b.LEFT||d===b.BOTTOM||d===b.FRONT)&&(n*=-1),l=1-l,l-=.5,h.d=-(l*m+n)}i=!0,Human.events.fire("clip.updated",{clipId:d,progress:a.progress||this.getProgress(d),enabled:!!e[d],fade:h.fade,fadeDistance:h.fadeDistance})},b.getActiveClips=function(){return h},b.isEnabled=function(a){return!!e[j[a]||a]},b.getProgress=function(a){return f[j[a]||a]},b.serialize=function(){for(var a={},b=0,d=c.length;d>b;++b)a[b]={clipId:b,enabled:!!e[b],progress:f[b],fade:c[b].fade,fadeDistance:c[b].fadeDistance,boundary:g[b]};return a},b.show=function(d){k||a();var e=c[d],f=Human.scene.getBoundary(),g=f.xmax-f.xmin,h=f.ymax-f.ymin,i=f.zmax-f.zmin,j=.5*(f.xmin+f.xmax),s=.5*(f.ymin+f.ymax),t=.5*(f.zmin+f.zmax);k.setEnabled(!0),(d===b.LEFT||d===b.RIGHT)&&(mat4.fromYRotation(n,.5*Math.PI),q[0]=-e.d*e.n[0],q[1]=s,q[2]=t,r[0]=i,r[1]=h),(d===b.TOP||d===b.BOTTOM)&&(mat4.fromXRotation(n,.5*Math.PI),q[0]=j,q[1]=-e.d*e.n[1],q[2]=t,r[0]=g,r[1]=i),(d===b.FRONT||d===b.BACK)&&(mat4.identity(n),q[0]=j,q[1]=s,q[2]=-e.d*e.n[2],r[0]=g,r[1]=h),mat4.fromScaling(o,r),mat4.fromTranslation(m,q),mat4.multiply(p,n,o),mat4.multiply(p,m,p),l.setElements(p)},b.hide=function(){k&&k.setEnabled(!1)},b.reset=function(){for(var a=0,b=c.length;b>a;++a)e[a]=!1;i=!0,Human.events.fire("CrossSections.Reset")},b.onFrame=function(){if(i){h.length=0;for(var a=0,b=c.length;b>a;++a)e[a]&&h.push(c[a]);Human.renderer.getScene().setClips(h),i=!1}},b.getBoundary=function(){return d.xmin=e[b.LEFT]?c[b.LEFT].d:-(1/0),d.xmax=e[b.RIGHT]?-c[b.RIGHT].d:1/0,d.ymin=e[b.BOTTOM]?c[b.BOTTOM].d:-(1/0),d.ymax=e[b.TOP]?-c[b.TOP].d:1/0,d.zmin=e[b.BACK]?c[b.BACK].d:-(1/0),d.zmax=e[b.FRONT]?-c[b.FRONT].d:1/0,d}}(),function(){"use strict";var a=Human.renderer.lights={};a.lights={},a.defaultLightIds=[];var b=[],c=!0,d=!0;a.init=function(){a.addLight({lightId:"light0",enabled:!0,params:{mode:"ambient",color:{r:.2,g:.2,b:.2,diffuse:!0}}}),a.addLight({lightId:"light1",enabled:!0,params:{mode:"dir",dir:{x:1,y:0,z:-.5},color:{r:.1,g:.1,b:.2},diffuse:!0,specular:!0,space:"view"}}),a.addLight({lightId:"light2",enabled:!0,params:{mode:"dir",dir:{x:-1,y:0,z:1},color:{r:.55,g:.5,b:.5},diffuse:!0,specular:!0,space:"view"}}),a.addLight({lightId:"light3",enabled:!0,params:{mode:"dir",dir:{x:.25,y:0,z:-1},color:{r:.9,g:.9,b:.9},diffuse:!0,specular:!1,space:"view"}}),a.defaultLightIds.push("light0"),a.defaultLightIds.push("light1"),a.defaultLightIds.push("light2"),a.defaultLightIds.push("light3")},a.addLight=function(e){return a.lights.hasOwnProperty(e.lightId)?void Human.log.warn("Human.renderer.lights.addLights","The lightId already exists: "+e.lightId):(a.lights[e.lightId]={lightId:e.lightId,enabled:!!e.enabled,params:e.params,index:b.length},c=!0,void(d=!0))},a.addLights=function(b){for(var c in b)b.hasOwnProperty(c)&&a.addLight(b[c])},a.removeLight=function(b){a.lights[b]&&(delete a.lights[b],c=!0,d=!0)},a.removeAllLights=function(){a.lights={},b.length=0,d=!0},a.removeCustomLights=function(){for(var b in a.lights)a.lights.hasOwnProperty(b)&&a.defaultLightIds.indexOf(b)<0&&(delete a.lights[b],d=!0)},a.setEnabled=function(b){var e=!1;for(var f in b){var g=a.lights[f];if(g){var h=!!b[f];g.enabled!==h&&(g.enabled=h,e=!0)}else Human.log.error("Human.renderer.lights.setEnabled","Light not found: "+f)}e&&(c=!0,d=!0)},a.clearEnabled=function(){var b=!1;for(var e in a.lights)a.lights[e].enabled=!1,b=!0;b&&(c=!0,d=!0)},a.setLight=function(b){var c=b.lightId,e=a.lights[c];return e?(void 0!==b.mode&&(e.params.mode=b.mode),void 0!==b.color&&(e.params.color=b.color),void 0!==b.dir&&(e.params.dir=b.dir),void 0!==b.pos&&(e.params.pos=b.pos),void 0!==b.diffuse&&(e.params.diffuse=b.diffuse),void 0!==b.specular&&(e.params.specular=b.specular),void 0!==b.innerCone&&(e.params.innerCone=b.innerCone),void 0!==b.outerCone&&(e.params.outerCone=b.outerCone),void 0!==b.constantAttenuation&&(e.params.constantAttenuation=b.constantAttenuation),void 0!==b.linearAttenuation&&(e.params.linearAttenuation=b.linearAttenuation),void 0!==b.quadraticAttenuation&&(e.params.quadraticAttenuation=b.quadraticAttenuation),void 0!==b.space&&(e.params.space=b.space),void(d=!0)):void Human.log.error("Light "+c+" does not exist")},a.restoreDefaults=function(){var b={};a.defaultLightIds.forEach(function(a){b[a]=!0}),a.clearEnabled(),a.setEnabled(b)},a.onFrame=function(){if(c){var e=0;b.length=0;for(var f in a.lights){var g=a.lights[f];g.enabled&&(b.push(g.params),g.index=e++)}c=!1,d=!0}d&&(Human.renderer.getScene().setLights(b),d=!1)}}(),function(){"use strict";function a(a){var c=Human.renderer.getScene();c&&b(c,a)}function b(a,d){for(("cubemap"===a.type||"reflection"===a.applyTo)&&c(a,d);a.nodes&&a.nodes.length>0;){var e=a.nodes[0];b(e,d)}}function c(a,b){if(a.getCoreId()!==b.node.getCoreId()){var c=a.getParent(),d=a.disconnectNodes();a.destroy(),a._engine._doDestroyNodes();var e=c.addNode({type:"cubemap",coreId:b.node.getCoreId()});e.addNodes(d)}}var d=Human.renderer.reflections={};d.setEnabled=function(b){var c=Human.assets.reflections.reflections[b];return c?void a(c):void Human.log.error("Human.renderer.reflections.setEnabled","reflection not found: "+b)},d.clearEnabled=function(){}}(),function(){"use strict";function a(a){var c=Human.renderer.getScene();c&&b(c,a)}function b(a,d){for(("cubemap"===a.type||"lightmap"===a.applyTo)&&c(a,d);a.nodes&&a.nodes.length>0;){var e=a.nodes[0];b(e,d)}}function c(a,b){if(a.getCoreId()!==b.node.getCoreId()){var c=a.getParent(),d=a.disconnectNodes();a.destroy(),a._engine._doDestroyNodes();var e=c.addNode({type:"cubemap",coreId:b.node.getCoreId()});e.addNodes(d)}}var d=Human.renderer.lightmaps={};d.setEnabled=function(b){var c=Human.assets.reflections.reflections[b];return c?void a(c):void Human.log.error("Human.renderer.lightmaps.setEnabled","reflection not found: "+b)},d.clearEnabled=function(){}}(),function(){"use strict";function a(a){if(b.enabled){var c,d,e,f,g,h={opaquePipeline:[],transparentPipeline:[],finalPipeline:[],pipelineFramebuffers:{opaque:{read:"__MAIN",write:"__BDS_COLOR1"},transparent:{read:"__MAIN",write:"__BDS_COLOR1"},"final":{read:"__MAIN",write:"__BDS_COLOR1"}},getIOFramebuffers:function(a){var b=this.pipelineFramebuffers[a],c={read:b.read,write:b.write};return"__BDS_COLOR1"===b.write?(b.read="__BDS_COLOR1",b.write="__BDS_COLOR2"):(b.read="__BDS_COLOR2",b.write="__BDS_COLOR1"),c}};for(f=0,g=a.length;g>f;++f){var i=b.effects[a[f]];i?i.addStage(h):Human.log.error("Unknown effect: "+a[f])}if(0!==h.opaquePipeline.length||0!==h.transparentPipeline.length||0!==h.finalPipeline.length){if(b.framebuffersInitialized||(b.scene.createFramebuffer("__BDS_COLOR1",{depthAttachment:!1}),b.scene.createFramebuffer("__BDS_COLOR2",{depthAttachment:!1}),b.framebuffersInitialized=!0),h.opaquePipeline.length>0){c=h.opaquePipeline[h.opaquePipeline.length-1],d=c.textures,e=!1;for(var j in d)if("__MAIN"===d[j].framebuffer){e=!0;break}e?h.opaquePipeline.push({type:"blit",id:"blitOpaqueToMain",textures:{uColorBuffer:{framebuffer:c.framebuffer,target:"color"}},framebuffer:"__MAIN"}):c.framebuffer="__MAIN",b.scene.postProcessOpaque(h.opaquePipeline)}h.finalPipeline.length>0?(c=h.finalPipeline[h.finalPipeline.length-1],c.framebuffer=!1):h.finalPipeline.push({type:"blit",id:"blitToScreen",textures:{uColorBuffer:{framebuffer:"__MAIN",target:"color"}},framebuffer:!1}),b.scene.postProcessFinal(h.finalPipeline)}}}var b=Human.renderer.postprocess={scene:null,framebuffersInitialized:!1,enabled:!0,effects:{},currentConfig:[]};b.init=function(a){this.scene=a,a.createPostProcessType("blit",["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","void main() {","gl_FragColor = texture2D(uColorBuffer, vUV);","}"].join("\n"));for(var b in this.effects)this.effects[b].init(a)},b.enable=function(){this.enabled||(this.enabled=!0,b.parse(this.currentConfig))},b.disable=function(){this.enabled&&(this.destroyPipeline(),this.enabled=!1)},b.parse=function(b){if(this.destroyPipeline(),this.currentConfig=b,this.enabled){for(var c=[],d=0,e=b.length;e>d;++d){var f=b[d],g=Human.renderer.postprocess.effects[f.effect];g?(c.push(f.effect),Human.renderer.postprocess.effects[f.effect].configure(f)):Human.log.error("Unknown postprocess effect: ",f.effect)}a(c)}},b.destroyPipeline=function(){this.scene.postProcessOpaque(null),this.scene.postProcessFinal(null)},b.updateProjection=function(){for(var a in this.effects)this.effects[a].updateProjection&&this.effects[a].updateProjection()},b.updateCanvas=function(){for(var a in this.effects)this.effects[a].updateCanvas&&this.effects[a].updateCanvas()}}(),function(){"use strict";function a(){var a=Human.renderer.canvas.context2D;a.lineWidth=2*g.brushRadius,a.lineJoin="round",a.lineCap="round",g.erase?(a.strokeStyle="#FFFFFF",a.fillStyle="#FFFFFF"):(a.strokeStyle=g.brushColorCSS,a.fillStyle=g.brushColorCSS)}function b(a,b){var c=Human.renderer.pick.corePick(a,b,{rayPick:!0});if(c&&c.worldPos){var h=c.objectId+f+c.renderableIndex,i=Human.scene.objects[c.objectId],j=i.renderables[c.renderableIndex];l[h]||e(j,h);var k=Human.renderer.canvasCircleToWorldSphereRadius(a,b,g.brushRadius,c.worldPos),q=c.worldPos,r=j.geometryNode,s=j.getRenderObject();mat4.invert(y,i.worldMatrix),vec3.transformMat4(z,q,y);var t,A,B=l[h],C=B.triangleUVs,D=Human.math.intersections.spherePolyhedron(r,z,k);if(0!==D.length){var E={};if(g.erase){var F=Human.math.intersections.sphereInPolyhedron(r,z,k);for(t=0,A=F.length;A>t;++t)E[F[t]]=!0}var G,H,I=Human.renderer.camera.getLookDir(n);for(t=0,A=D.length;A>t;++t)G=D[t],E[G]&&C[G]?delete C[G]:(s.getTrianglePositionOnSurface(3*G,v,w,x),Human.math.triangleNormal(v,w,x,u),vec4.transformMat4(u,u,i.worldMatrix),vec3.dot(u,I)>0||(s.getPointInWorldSpace(v,v),s.getPointInWorldSpace(w,w),s.getPointInWorldSpace(x,x),C[G]?C[G].patchId!==o&&(C[G].patchId=o,d(v,w,x,C[G].uvs)):(H=new Array(3),d(v,w,x,H),C[G]={patchId:o,uvs:H})));var J=B.bb;for(G in C){H=C[G].uvs;var K=H[0],L=H[1],M=H[2];J.min[0]=Math.min(J.min[0],K[0]),J.min[0]=Math.min(J.min[0],L[0]),J.min[0]=Math.min(J.min[0],M[0]),J.max[0]=Math.max(J.max[0],K[0]),J.max[0]=Math.max(J.max[0],L[0]),J.max[0]=Math.max(J.max[0],M[0]),J.min[1]=Math.min(J.min[1],K[1]),J.min[1]=Math.min(J.min[1],L[1]),J.min[1]=Math.min(J.min[1],M[1]),J.max[1]=Math.max(J.max[1],K[1]),J.max[1]=Math.max(J.max[1],L[1]),J.max[1]=Math.max(J.max[1],M[1])}p[h]=j,m=!0}}}function c(){A.length=0;var a,b;for(a in p)b=l[a],A.push(p[a].getRenderObject());Human.renderer.forceRenderFrame({custom:{renderMode:"drawTexture",objects:A}});var c=Human.renderer.canvas.canvas,d=Human.renderer.canvas.annotationCanvas,e=Human.renderer.canvas.context2D;k.globalCompositeOperation="source-over",k.drawImage(c,0,0),k.globalCompositeOperation=g.erase?"destination-out":"source-over",k.drawImage(d,0,0);var f=k.getImageData(0,0,q,r);k.clearRect(0,0,q,r);var i,j,m;for(a in p){var n=p[a];b=l[a];var s=b.bb;if(s.min[0]!==1/0){e.putImageData(f,0,0);var t=e.getImageData(s.min[0]*q,s.min[1]*r,(s.max[0]-s.min[0])*q,(s.max[1]-s.min[1])*r);e.clearRect(0,0,q,r);var u=b.patches;u[o]={w:t.width,h:t.height,imageData:t},B.length=0;for(m in u)B.push(u[m]);B.sort(function(a,b){return b.h-a.h}),h.fit(B);var v=Math.min(Human.math.nextPowerOf2(h.root.w),4096),w=Math.min(Human.math.nextPowerOf2(h.root.h),4096);for(d.width=Math.max(d.width,v),d.height=Math.max(d.height,w),i=0,j=B.length;j>i;++i)e.putImageData(B[i].imageData,B[i].fit.x,B[i].fit.y);var x=e.getImageData(0,0,v,w);n.drawTexture.setImage(x);var y=b.triangleUVs,z=n.geometryNode.getUVs(),C=z[z.length-1],D={};for(var E in y){var F=y[E];if(F.patchId===o){var G=s.min[0],H=s.min[1],I=s.max[0]-s.min[0],J=s.max[1]-s.min[1];for(i=0;3>i;++i){var K=F.uvs[i];K[0]=(K[0]-G)/I,K[1]=(K[1]-H)/J}}var L=u[F.patchId],M=F.uvs[0],N=F.uvs[1],O=F.uvs[2],P=L.fit.x/v,Q=L.fit.y/w,R=L.w/v,S=L.h/w;C[3*E*2]=M[0]*R+P,C[3*E*2+1]=1-M[1]*S+1-Q,C[2*(3*E+1)]=N[0]*R+P,C[2*(3*E+1)+1]=1-N[1]*S+1-Q,C[2*(3*E+2)]=O[0]*R+P,C[2*(3*E+2)+1]=1-O[1]*S+1-Q,D[F.patchId]=!0}for(m in u)D[m]||delete u[m];n.geometryNode.setUV(z.length-1,C),d.width=q,d.height=r}else Human.console.error("Draw mesh data invalid.")}}function d(a,b,c,d){var e=vec2.create();Human.renderer.worldPositionToCanvas(a,e),e[0]/=q,e[1]/=r,d[0]=e;var f=vec2.create();Human.renderer.worldPositionToCanvas(b,f),f[0]/=q,f[1]/=r,d[1]=f;var g=vec2.create();Human.renderer.worldPositionToCanvas(c,g),g[0]/=q,g[1]/=r,d[2]=g}function e(a,b){var c=a.geometryNode,d={type:"geometry",primitive:"triangles",id:b+"_draw_geometry",positionDecodeMat:c.getPositionDecodeMat()},e=c.getPositions(),f=c.getNormals(),g=c.getUVs(),h=c.getIndices(),i=h.length,j=e.constructor;if(d.positions=new j(3*i),f&&(d.normals=c.hasCompressedNormals()?new Int8Array(2*i):new Float32Array(3*i)),g){d.uvs=new Array(g.length+1);for(var k=0,m=g.length;m>k;k++)d.uvs[k]=new Float32Array(2*i);d.uvs[k]=new Float32Array(2*i)}else d.uvs=[new Float32Array(2*i)];for(var n=d.positions,o=d.normals,p=d.uvs,q=0,r=h.length;r>q;q+=3){var s=h[q],t=h[q+1],u=h[q+2];if(n[3*q]=e[3*s],n[3*q+1]=e[3*s+1],n[3*q+2]=e[3*s+2],n[3*q+3]=e[3*t],n[3*q+4]=e[3*t+1],n[3*q+5]=e[3*t+2],n[3*q+6]=e[3*u],n[3*q+7]=e[3*u+1],n[3*q+8]=e[3*u+2],o&&(c.hasCompressedNormals()?(o[2*q]=f[2*s],o[2*q+1]=f[2*s+1],o[2*q+2]=f[2*t],o[2*q+3]=f[2*t+1],o[2*q+4]=f[2*u],o[2*q+5]=f[2*u+1]):(o[3*q]=f[3*s],o[3*q+1]=f[3*s+1],o[3*q+2]=f[3*s+2],o[3*q+3]=f[3*t],o[3*q+4]=f[3*t+1],o[3*q+5]=f[3*t+2],o[3*q+6]=f[3*u],o[3*q+7]=f[3*u+1],o[3*q+8]=f[3*u+2])),p){var v,w,x=0;if(g)for(var y=g.length;y>x;x++){v=g[x],w=p[x],C[0]=v[2*s],C[1]=v[2*s+1],D[0]=v[2*t],D[1]=v[2*t+1],E[0]=v[2*u],E[1]=v[2*u+1];var z=c.getUVDecodeMat(x);z&&(Human.math.decompressUV(C,C,z),Human.math.decompressUV(D,D,z),Human.math.decompressUV(E,E,z)),w[2*q]=C[0],w[2*q+1]=C[1],w[2*q+2]=D[0],w[2*q+3]=D[1],w[2*q+4]=E[0],w[2*q+5]=E[1]}w=p[x],w[2*q]=-1,w[2*q+1]=-1,w[2*q+2]=-1,w[2*q+3]=-1,w[2*q+4]=-1,w[2*q+5]=-1}}l[b]={triangleUVs:{},patches:{},bb:{min:vec2.fromValues(1/0,1/0),max:vec2.fromValues(-(1/0),-(1/0))}};var A=0;g&&(A=g.length),a.attachDrawTexture({type:"texture",applyFrom:"uv"+A,applyTo:"color",blendMode:"conditionalAlpha",drawTexture:!0});var B=b+"-draw-mesh";Human.assets.geometries.createGeometry(B,{geometry:d}),a.setGeometry(B)}var f="---",g=Human.renderer.draw={initalized:!1,erase:!1,brushRadius:20,brushColor:vec3.fromValues(1,0,0),brushColorCSS:null},h=null,i=null,j=null,k=null,l={},m=!1,n=vec3.create(),o=0,p={},q=0,r=0,s=-1,t=-1;g.init=function(){this.initalized||(i=Human.renderer.getScene(),j=document.createElement("canvas"),k=j.getContext("2d"),h=new GrowingPacker,this.initalized=!0,this.setBrushColor(this.brushColor[0],this.brushColor[1],this.brushColor[2]),this.updateCanvas())},g.setBrushColor=function(a,b,c){this.brushColor[0]=a,this.brushColor[1]=b,this.brushColor[2]=c,this.brushColorCSS=Human.utils.floatRGBToHexString(a,b,c)},g.beginStroke=function(c,d){a(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.arc(c,d,this.brushRadius,0,2*Math.PI,!1),Human.renderer.canvas.context2D.fill(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.moveTo(c,d),b(c,d),s=c,t=d},g.strokeTo=function(a,c){Human.renderer.canvas.context2D.lineTo(a,c),Human.renderer.canvas.context2D.stroke();var d=2*this.brushRadius,e=a-s,f=c-t,g=Math.sqrt(e*e+f*f);if(g>d)for(var h=Math.floor(g/d),i=d*(e/g),j=d*(f/g),k=1;h>=k;++k){var l=s+k*i,m=t+k*j;b(l,m)}b(a,c),s=a,t=c},g.record=function(){m&&(c(),++o);for(var a in l){var b=l[a];b.bb.min[0]=b.bb.min[1]=1/0,b.bb.max[0]=b.bb.max[1]=-(1/0)}p={},Human.renderer.canvas.context2D.clearRect(0,0,q,r),k.clearRect(0,0,q,r),m=!1},g.updateCanvas=function(){if(this.initalized){var a=Human.renderer.canvas;j.width=q=a.width,j.height=r=a.height}};var u=vec4.create(),v=vec3.create(),w=vec3.create(),x=vec3.create(),y=mat4.create(),z=vec3.create(),A=[],B=[],C=vec2.create(),D=vec2.create(),E=vec2.create()}(),function(){"use strict";Human.renderer.camera.CurvePath=function(){var a,b,c=[],d=0,e=vec3.create(),f=Human.math.bezier;this.init=function(g){c=[],d=0,a=g.length,b=a-1,2>a&&Human.log.error("curvePath init no enough points");var h=vec3.create(),i=vec3.create();vec3.subtract(e,g[0],g[1]),vec3.scale(e,e,.25),vec3.add(h,g[0],e),vec3.subtract(e,g[a-1],g[a-2]),vec3.scale(e,e,.25),vec3.add(i,g[a-1],e);var j,k,l,m,n,o,p,q=vec3.create(),r=vec3.create();for(j=1;a>j;++j)l=g[j-1],m=g[j],o=l,p=m,1>=j?vec3.subtract(e,l,h):(k=g[j-2],vec3.subtract(e,m,k),vec3.scale(e,e,.25)),vec3.add(q,o,e),j>=a-1?vec3.subtract(e,i,m):(n=g[j+1],vec3.subtract(e,n,l),vec3.scale(e,e,.25)),vec3.subtract(r,p,e),c.push(new f(o[0],o[1],o[2],q[0],q[1],q[2],r[0],r[1],r[2],p[0],p[1],p[2]));for(j=0;b>j;++j)d+=c[j].length()},this.getPosition=function(a){var b=this.getParameter(a);return{position:c[b.i].compute(b.t01),i:b.i,t01:b.t01}},this.getParameter=function(b){var c,d;return d=b*(a-1),d=Human.math.clamp(d,0,a-1),c=Math.floor(d),c>=a-1&&(c-=1),d-=c,{i:c,t01:d}},this.getPathLength=function(){return d}}}(),function(){"use strict";function a(a,b){Human.renderer.camera.lock=!0,b&&g.push(b),a=a||{},h=new Human.renderer.camera.fly.CurvePathAnimation({eyeCurvePath:a.eyeCurvePath,lookCurvePath:a.lookCurvePath,upVecs:a.upVecs,velocity:a.velocity,constrainUp:a.constrainUp,easeIn:a.easeIn,easeOut:a.easeOut,onComplete:c}),h.update(Date.now())}function b(a,b){Human.renderer.camera.lock=!0,b&&g.push(b),a=a||{},h=new Human.renderer.camera.fly.Animation({animationDuration:a.animationDuration,velocity:a.velocity,target:a.target,arc:a.arc,backOff:a.backOff,constrainUp:a.constrainUp,onComplete:c,cylindricalView:a.cylindricalView,easeIn:a.easeIn,easeOut:a.easeOut}),h.update(Date.now())}function c(){for(h=null;g.length>0;)g.pop()();Human.renderer.camera.lock=!1}function d(a){var b=a.backOff||0;0>b?b=0:b>1&&(b=1),b=1-b;var c=Human.math.vec3ObjToArray(Human.renderer.camera.look),d=Human.math.vec3ObjToArray(Human.renderer.camera.eye),e=vec3.create();vec3.subtract(e,d,c),vec3.normalize(e,e);var f=a.boundary,g=Human.math.getBoundaryCenter(f),h=a.stopFOV,i=vec3.length(e),j=Human.math.getBoundaryDiag(f),k=Math.abs(j/(1+.8*b)/Math.tan(h/2)),l=k/i;return vec3.scale(e,e,l),vec3.add(e,g,e),{target:{eye:{x:e[0],y:e[1],z:e[2]},look:{x:g[0],y:g[1],z:g[2]},up:{x:0,y:1,z:0}}}}var e=Human.renderer.camera.fly={};e.flyTimeScale=1,e.velocity=1,e.cylindricalArcScale=1,e.cylindricalView=!1,e.cylindricalOnly=!1,e.cylindricalRotationLerpMin=Math.PI/6,e.cylindricalRotationLerpMax=Math.PI/2,e.cylindricalRadiusLerpMin=.2,e.cylindricalRadiusLerpMax=1;var f=55,g=[],h=null,i=new Human.renderer.camera.CurvePath,j=new Human.renderer.camera.CurvePath;e.onFrame=function(){h&&h.update(Date.now())},e.cancelAnimation=function(){h&&(c(),h=null)},e.flyAlongCurvePath=function(b,c,d){c=c||function(){},d=d||function(a){Human.log.error("Human.renderer.camera.fly.flyAlongCurvePath",a),c()},b||(d("params must be defined"),c());var e,f,g=void 0!==b.velocity?b.velocity:1,h=[],k=[],l=[];for(e=0,f=b.points.length;f>e;++e)h.push(Human.math.vec3ObjToArray(b.points[e].eye||b.points[e].position)),k.push(Human.math.vec3ObjToArray(b.points[e].look||b.points[e].target)),l.push(Human.math.vec3ObjToArray(b.points[e].up));i.init(h),j.init(k),a({eyeCurvePath:i,lookCurvePath:j,upVecs:l,velocity:g,constrainUp:b.constrainUp,easeIn:b.easeIn,easeOut:b.easeOut},c)},e.flyTo=function(a,c,d){var e,f,g;if(c=c||function(){},d=d||function(a){Human.log.error("Human.renderer.camera.fly",a),c()},a.objectId){if(g=a.objectId,e=Human.scene.objects[g],!e)return void d("No scene object found for the given ID: '"+g+"'");f=e.getBoundary(),f?b({target:{boundary:f},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c):c()}else a.boundary?(f=a.boundary,b({target:{boundary:f},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c)):a.eye||a.look?b({target:{eye:a.eye,look:a.look,up:a.up},arc:a.arc,backOff:a.backOff,animationDuration:a.animationDuration,velocity:a.velocity,constrainUp:!1,cylindricalView:a.cylindricalView,easeIn:a.easeIn,easeOut:a.easeOut},c):b({target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c)},e.jumpTo=function(a,b,e){var g,h,i;b=b||function(){},e=e||function(a){Human.log.error("Human.renderer.camera.fly",a),b()};var j;if(a.objectId){if(i=a.objectId,g=Human.scene.objects[i],!g)return void e("No scene object found for the given ID: '"+i+"'");h=g.getBoundary(),h&&(j={target:{boundary:h},backOff:a.backOff})}else if(a.boundary)j=d(a);else if(a.eye||a.look){if(!a.eye&&!a.look)return void e("incomplete parameter configuration: both 'eye' and 'look' expected");

j={target:{eye:a.eye,look:a.look,up:a.up}}}else j={target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},backOff:a.backOff};j&&(c(),j.target.boundary?(j.target.stopFOV=f||j.target.stopFOV,Human.renderer.camera.fly.jumpTo(j.target)):Human.renderer.camera.setLookAt(j.target)),b()},e.cancel=c}(),function(){"use strict";function a(a,b){var c=Human.renderer.camera.fly,d=Human.math.clamp((a-c.cylindricalRotationLerpMin)/(c.cylindricalRotationLerpMax-c.cylindricalRotationLerpMin),0,1),e=Human.math.clamp((b-c.cylindricalRadiusLerpMin)/(c.cylindricalRadiusLerpMax-c.cylindricalRadiusLerpMin),0,1);return Math.min(d,e)}var b=55,c=vec3.create(),d=vec3.create(),e=vec3.create();Human.renderer.camera.fly.Animation=function(f){var g=f.target,h=void 0!==f.cylindricalView?f.cylindricalView:Human.renderer.camera.fly.cylindricalView;if(this.arc=h?void 0===f.arc?1:f.arc:0,this.scaleArc=void 0===f.scaleArc?Human.renderer.camera.fly.cylindricalArcScale:f.scaleArc,this.easeIn=!!f.easeIn,this.easeOut=f.easeOut!==!1,this.constrainUp=void 0===f.constrainUp?!1:f.constrainUp,!g)return Human.log.error("Human.renderer.camera.fly.Animation config missing: target"),void(f.onComplete&&f.onComplete());var i=Human.renderer.camera;this._look1=Human.math.vec3ObjToArray(i.look),this._eye1=Human.math.vec3ObjToArray(i.eye),this._up1=Human.math.vec3ObjToArray(i.up),vec3.subtract(c,this._eye1,this._look1),this._vec=vec3.create(),vec3.normalize(this._vec,c);var j=f.backOff||0;if(0>j?j=0:j>1&&(j=1),j=1-j,g.boundary){var k=g.boundary,l=g.dist||2.5,m=Math.abs(vec3.length(this._vec)),n=Human.math.getBoundaryDiag(k),o=Math.abs(n/(1+.8*j)/Math.tan(b/2)),p=o/m*l;this._look2=Human.math.getBoundaryCenter(k),g.offset&&(this._look2[0]+=g.offset[0],this._look2[1]+=g.offset[1],this._look2[2]+=g.offset[2]);var q=Human.renderer.camera.fly.cylindricalOnly;if(h){this.arc=1,Human.math.cartesianToCylindrical(this._look1,d),Human.math.cartesianToCylindrical(this._look2,e);var r=Human.math.getShortRotation(d[1],e[1]),s=e[0],t=a(Math.abs(r),s);q?(e[0]=e[0]+p,this._eye2=Human.math.cylindricalToCartesian(e)):(e[0]=p,e[2]=0,this._eye2=Human.math.cylindricalToCartesian(e),vec3.scale(c,this._vec,p),Human.math.lerpVec3(t,0,1,c,this._eye2,c),vec3.normalize(c,c),vec3.scale(c,c,p),vec3.add(this._eye2,this._look2,c))}else vec3.scale(c,this._vec,p),this._eye2=vec3.add(vec3.create(),this._look2,c);this._up2=vec3.create(),this.constrainUp?(this._up2[0]=i.up.x,this._up2[1]=i.up.y,this._up2[2]=i.up.z):g.up?(this._up2[0]=g.up.x||0,this._up2[1]=g.up.y||0,this._up2[2]=g.up.z||0):this._up2[1]=1}else{var u=g.look,v=g.eye,w=g.up,x=Human.renderer.camera.eye,y=Human.renderer.camera.look,z=Human.renderer.camera.up;this._look2=vec3.create(),this._eye2=vec3.create(),this._up2=vec3.create(),u?(this._look2[0]=u.x||0,this._look2[1]=u.y||0,this._look2[2]=u.z||0):(this._look2[0]=y.x,this._look2[1]=y.y,this._look2[2]=y.z),v?(this._eye2[0]=v.x||0,this._eye2[1]=v.y||0,this._eye2[2]=v.z||0):(this._eye2[0]=x.x,this._eye2[1]=x.y,this._eye2[2]=x.z),w&&!this.constrainUp?(this._up2[0]=w.x||0,this._up2[1]=w.y||0,this._up2[2]=w.z||0):(this._up2[0]=z.x,this._up2[1]=z.y,this._up2[2]=z.z)}vec3.subtract(c,this._look2,this._look1);var A=Math.abs(vec3.length(c));vec3.subtract(c,this._eye2,this._eye1);var B=Math.abs(vec3.length(c));if(this.arc>0){Human.math.cartesianToCylindrical(this._eye1,d),Human.math.cartesianToCylindrical(this._eye2,e);var C=Human.math.getShortRotation(d[1],e[1]),D=(d[0]+e[0])*Math.abs(C),E=e[2]-d[1],F=Math.sqrt(D*D+E*E);B=(1-this.arc)*B+this.arc*F}this._dist=A>B?A:B,this._animationDuration=f.animationDuration?1e3*f.animationDuration:1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(f.velocity||Human.renderer.camera.fly.velocity))+1),this._onComplete=f.onComplete};var f=vec3.create(),g=vec3.create();Human.renderer.camera.fly.Animation.prototype.update=function(a){if(void 0===this._time1&&(this._time1=a,this._time2=this._time1+this._animationDuration),this._done||a>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var b,h=(a-this._time1)/this._animationDuration;if(b=this.easeIn&&this.easeOut?Human.math.easeInOut(h,0,1,1):this.easeIn?Human.math.easeIn(h,0,1,1):this.easeOut?Human.math.easeOut(h,0,1,1):h,Human.math.lerpVec3(b,0,1,this._look1,this._look2,g),this.arc>0){if(Human.math.lerpVec3Cylindrical(b,0,1,d,e,c),1!==this.scaleArc){var i=c[0],j=this.scaleArc*i;i=.5>b?Human.math.lerpScalar(b,0,.5,i,j):Human.math.lerpScalar(b,.5,1,j,i),c[0]=i}Human.math.cylindricalToCartesian(c,f),this.arc<1&&(Human.math.lerpVec3(b,0,1,this._eye1,this._eye2,c),Human.math.lerpVec3(this.arc,0,1,c,f,f))}else Human.math.lerpVec3(b,0,1,this._eye1,this._eye2,f);if(this.constrainUp)Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(g),eye:Human.math.vec3ArrayToObj(f)});else{var k=Human.math.lerpVec3(b,0,1,this._up1,this._up2,[]);Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(g),eye:Human.math.vec3ArrayToObj(f),up:Human.math.vec3ArrayToObj(k)})}},Human.renderer.camera.fly.Animation.prototype.stop=function(){}}(),function(){"use strict";var a=1,b=vec3.create();Human.properties.subscribe({propId:"camera.flyCurvePath",value:{velocity:1},callback:function(b){a=b.velocity||1}}),Human.renderer.camera.fly.CurvePathAnimation=function(b){this.easeIn=!!b.easeIn,this.easeOut=b.easeOut!==!1,this.constrainUp=void 0===b.constrainUp?!1:b.constrainUp,this._eyeCurvePath=b.eyeCurvePath,this._lookCurvePath=b.lookCurvePath,this._upVecs=b.upVecs;var c=Human.renderer.camera,d=1,e=this._lookCurvePath.getParameter(d),f=e.i;this._look2=Human.math.vec3ObjToArray(this._lookCurvePath.getPosition(d).position),this._eye2=Human.math.vec3ObjToArray(this._eyeCurvePath.getPosition(d).position),this._up2=this.constrainUp?Human.math.vec3ObjToArray(c.up):this._upVecs[f+1];var g=this._eyeCurvePath.getPathLength(),h=this._lookCurvePath.getPathLength();this._dist=Math.max(g,h),this._duration=1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(b.velocity||a))+1),this._onComplete=b.onComplete},Human.renderer.camera.fly.CurvePathAnimation.prototype.update=function(a){if(void 0===this._time1&&(this._time1=a,this._time2=this._time1+this._duration),this._done||a>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var c,d=(a-this._time1)/this._duration;c=this.easeIn&&this.easeOut?Human.math.easeInOut(d,0,1,1):this.easeIn?Human.math.easeIn(d,0,1,1):this.easeOut?Human.math.easeOut(d,0,1,1):d;var e=this._lookCurvePath.getPosition(c).position,f=this._eyeCurvePath.getPosition(c).position;if(this.constrainUp)Human.renderer.camera.setLookAt({look:e,eye:f});else{var g=this._lookCurvePath.getParameter(c);Human.math.lerpVec3(g.t01,0,1,this._upVecs[g.i],this._upVecs[g.i+1],b),Human.renderer.camera.setLookAt({look:e,eye:f,up:Human.math.vec3ArrayToObj(b)})}}}(),function(){"use strict";var a=90,b=130,c=.1,d=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uFocusStart;","uniform float uFocusEnd;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform sampler2D uDepth;","uniform vec2 uTexelOffset;","uniform vec2 uDepthRange;","void main() {","float ndc = 2.0 * texture2D(uDepth, vUV).r - 1.0;","float depth = -(2.0 * uDepthRange.y * uDepthRange.x) / (ndc * (uDepthRange.y - uDepthRange.x) - uDepthRange.y - uDepthRange.x);","float deltaDepth = max(depth - uFocusEnd, 0.0) + max(uFocusStart - depth, 0.0);","vec4 color = vec4(0.0);","if (ndc < 1.0 && deltaDepth > 0.0) {","float blurRadius = min(floor(uBlurCoefficient * deltaDepth), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),e={type:"dof",id:"dofHorizontal",uniforms:{uFocusStart:a,uFocusEnd:b,uBlurCoefficient:c,uTexelOffset:new Float32Array([1/window.innerWidth,0]),uDepthRange:new Float32Array([.1,1e4])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},f={type:"dof",id:"dofVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},g=Human.renderer.postprocess.effects.dof={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,focusStart:a,focusEnd:b,blurCoefficient:c};g.init=function(a){this.scene=a,this.supported&&a.createPostProcessType("dof",d)},g.addStage=function(a){if(this.supported){var b=a.getIOFramebuffers("final");e.uniforms.uFocusStart=this.focusStart,e.uniforms.uFocusEnd=this.focusEnd,e.uniforms.uBlurCoefficient=this.blurCoefficient,e.uniforms.uDepthRange[0]=Human.renderer.camera.near,e.uniforms.uDepthRange[1]=Human.renderer.camera.far,e.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,e.textures.uTexture.framebuffer=b.read,e.framebuffer=b.write,b=a.getIOFramebuffers("final"),f.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,f.textures.uTexture.framebuffer=b.read,f.framebuffer=b.write,a.finalPipeline.push(e),a.finalPipeline.push(f)}},g.setFocusStart=function(a){this.focusStart=e.uniforms.uFocusStart=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uFocusStart",this.focusStart)},g.setFocusEnd=function(a){this.focusEnd=e.uniforms.uFocusEnd=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uFocusEnd",this.focusEnd)},g.setBlurCoefficient=function(a){this.blurCoefficient=e.uniforms.uBlurCoefficient=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uBlurCoefficient",this.blurCoefficient)},g.configure=function(d){d=d||{},d.focusStart=void 0===d.focusStart?a:d.focusStart,d.focusEnd=void 0===d.focusEnd?b:d.focusEnd,d.blur=void 0===d.blur?c:d.blur,this.setFocusStart(d.focusStart),this.setFocusEnd(d.focusEnd),this.setBlurCoefficient(d.blur)},g.updateProjection=function(){e.uniforms.uDepthRange[0]=Human.renderer.camera.near,e.uniforms.uDepthRange[1]=Human.renderer.camera.far;var a=this.scene.getPostProcessStage("dofHorizontal");a&&a.setUniform("uDepthRange",e.uniforms.uDepthRange)},g.updateCanvas=function(){var a=Human.renderer.canvas;e.uniforms.uTexelOffset[0]=1/a.width,f.uniforms.uTexelOffset[1]=1/a.height;var b=this.scene.getPostProcessStage("dofHorizontal"),c=this.scene.getPostProcessStage("dofVertical");b&&c&&(b.setUniform("uTexelOffset",e.uniforms.uTexelOffset),c.setUniform("uTexelOffset",f.uniforms.uTexelOffset))}}(),function(){"use strict";var a=.1,b=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","void main() {","vec4 color = vec4(0.0);","float blurRadius = min(floor(uBlurCoefficient * 100.0), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","gl_FragColor = color;","}"].join("\n"),c={type:"blur",id:"blurHorizontal",uniforms:{uBlurCoefficient:a,uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},d={type:"blur",id:"blurVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},e=Human.renderer.postprocess.effects.blur={scene:null,blurCoefficient:a};e.init=function(a){this.scene=a,a.createPostProcessType("blur",b)},e.addStage=function(a){var b=a.getIOFramebuffers("final");c.uniforms.uBlurCoefficient=this.blurCoefficient,c.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,c.textures.uTexture.framebuffer=b.read,c.framebuffer=b.write,b=a.getIOFramebuffers("final"),d.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,d.textures.uTexture.framebuffer=b.read,d.framebuffer=b.write,a.finalPipeline.push(c),a.finalPipeline.push(d)},e.setBlurCoefficient=function(a){this.blurCoefficient=c.uniforms.uBlurCoefficient=a;var b=this.scene.getPostProcessStage("blurHorizontal");b&&b.setUniform("uBlurCoefficient",this.blurCoefficient)},e.configure=function(b){b=b||{},b.blur=void 0===b.blur?a:b.blur,this.setBlurCoefficient(b.blur)},e.updateCanvas=function(){var a=Human.renderer.canvas,b=this.scene.getPostProcessStage("blurHorizontal"),e=this.scene.getPostProcessStage("blurVertical");b&&e&&(c.uniforms.uTexelOffset[0]=1/a.width,d.uniforms.uTexelOffset[1]=1/a.height,b.setUniform("uTexelOffset",c.uniforms.uTexelOffset),e.setUniform("uTexelOffset",d.uniforms.uTexelOffset))}}(),function(){"use strict";var a=.2,b=new Float32Array([0,0]),c=.1,d=new Float32Array(4),e=new Float32Array(3),f=new Float32Array(3),g=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform sampler2D uTexture;","uniform vec4 uBlurParams;","uniform vec3 uTexelParams;","void main() {","vec2 center = uBlurParams.xy;","float radius = uBlurParams.z;","float blurCoefficient = uBlurParams.w;","vec2 texelOffset = uTexelParams.xy;","float aspect = uTexelParams.z;","vec2 pos = vUV * 2.0 - 1.0;","pos.x *= aspect;","float r = length(pos - center);","float deltaR = max(r - radius, 0.0);","vec4 color = vec4(0.0);","if (deltaR > 0.0) {","float blurRadius = min(floor(blurCoefficient * 100.0 * deltaR), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * texelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),h={type:"radialBlur",id:"radialBlurHorizontal",uniforms:{uBlurParams:d,uTexelParams:e},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},i={type:"radialBlur",id:"radialBlurVertical",uniforms:{uTexelParams:f},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},j=Human.renderer.postprocess.effects.radialBlur={scene:null,radius:a,center:new Float32Array(b),blurCoefficient:c};j.init=function(a){this.scene=a,a.createPostProcessType("radialBlur",g)},j.addStage=function(a){var b=a.getIOFramebuffers("final");d.set(this.center),d[2]=this.radius,d[3]=this.blurCoefficient;var c=Human.renderer.canvas.width/Human.renderer.canvas.height;e[0]=c/Human.renderer.canvas.width,e[2]=c,f[1]=1/Human.renderer.canvas.height,f[2]=c,h.textures.uTexture.framebuffer=b.read,h.framebuffer=b.write,b=a.getIOFramebuffers("final"),i.textures.uTexture.framebuffer=b.read,i.framebuffer=b.write,a.finalPipeline.push(h),a.finalPipeline.push(i)},j.setRadius=function(a){this.radius=d[2]=a;var b=this.scene.getPostProcessStage("radialBlurHorizontal");b&&b.setUniform("uBlurParams",d)},j.setCenter=function(a,b){this.center[0]=a,this.center[1]=b,d.set(this.center);var c=this.scene.getPostProcessStage("radialBlurHorizontal");c&&c.setUniform("uBlurParams",d)},j.setBlurCoefficient=function(a){this.blurCoefficient=d[3]=a;var b=this.scene.getPostProcessStage("radialBlurHorizontal");b&&b.setUniform("uBlurParams",d)},j.configure=function(d){d=d||{},d.radius=void 0===d.radius?a:d.radius,d.center=void 0===d.center?b:d.center,d.blur=void 0===d.blur?c:d.blur,this.setRadius(d.radius),this.setCenter(d.center[0],d.center[1]),this.setBlurCoefficient(d.blur)},j.updateCanvas=function(){var a=Human.renderer.canvas,b=a.width/a.height;e[0]=b/a.width,e[2]=b,f[1]=1/a.height,f[2]=b;var c=this.scene.getPostProcessStage("radialBlurHorizontal"),d=this.scene.getPostProcessStage("radialBlurVertical");c&&d&&(c.setUniform("uTexelParams",e),d.setUniform("uTexelParams",f))}}(),function(){"use strict";var a=2.2,b=!1,c=["precision highp float;","varying vec2 vUV;","uniform float uGamma;","uniform bool uToneMap;","uniform sampler2D uTexture;","vec3 toneMapReinhard(vec3 color) {","    return color / (color + 1.0);","}","void main() {","   vec4 color = texture2D(uTexture, vUV);","   if (uToneMap) {","       color.rgb = toneMapReinhard(color.rgb);","   }","   color.rgb = pow(color.rgb, vec3(1.0 / uGamma));","   gl_FragColor = color;","}"].join("\n"),d={type:"gammaCorrect",id:"gammaCorrect",uniforms:{uGamma:a,uToneMap:b},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},e=Human.renderer.postprocess.effects.gammaCorrect={scene:null,gamma:a,toneMap:b};e.init=function(a){this.scene=a,a.createPostProcessType("gammaCorrect",c)},e.addStage=function(a){var b=a.getIOFramebuffers("final");d.uniforms.uGamma=this.gamma,d.uniforms.uToneMap=this.toneMap,d.textures.uTexture.framebuffer=b.read,d.framebuffer=b.write,a.finalPipeline.push(d)},e.setGamma=function(a){this.gamma=d.uniforms.uGamma=a;var b=this.scene.getPostProcessStage("gammaCorrect");b&&b.setUniform("uGamma",this.gamma)},e.setToneMap=function(a){this.toneMap=d.uniforms.uToneMap=a;var b=this.scene.getPostProcessStage("gammaCorrect");b&&b.setUniform("uToneMap",this.toneMap)},e.configure=function(c){c=c||{},c.gamma=void 0===c.gamma?a:c.gamma,c.toneMap=void 0===c.toneMap?b:c.toneMap,this.setGamma(c.gamma),this.setToneMap(c.toneMap)}}(),function(){"use strict";var a=["precision highp float;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","varying vec2 vUV;","const float fxaaQualitySubpix = 0.75;","const float fxaaQualityEdgeThreshold = 0.125;","const float fxaaQualityEdgeThresholdMin = 0.0;","#define FXAA_QUALITY_PRESET 25","#if (FXAA_QUALITY_PRESET == 10)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 3.0","#define FXAA_QUALITY_P2 12.0","#endif","#if (FXAA_QUALITY_PRESET == 11)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 3.0","#define FXAA_QUALITY_P3 12.0","#endif","#if (FXAA_QUALITY_PRESET == 12)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 4.0","#define FXAA_QUALITY_P4 12.0","#endif","#if (FXAA_QUALITY_PRESET == 13)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 4.0","#define FXAA_QUALITY_P5 12.0","#endif","#if (FXAA_QUALITY_PRESET == 14)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 4.0","#define FXAA_QUALITY_P6 12.0","#endif","#if (FXAA_QUALITY_PRESET == 15)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 12.0","#endif","#if (FXAA_QUALITY_PRESET == 20)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 2.0","#define FXAA_QUALITY_P2 8.0","#endif","#if (FXAA_QUALITY_PRESET == 21)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 8.0","#endif","#if (FXAA_QUALITY_PRESET == 22)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 8.0","#endif","#if (FXAA_QUALITY_PRESET == 23)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 8.0","#endif","#if (FXAA_QUALITY_PRESET == 24)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 3.0","#define FXAA_QUALITY_P6 8.0","#endif","#if (FXAA_QUALITY_PRESET == 25)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 8.0","#endif","#if (FXAA_QUALITY_PRESET == 26)","#define FXAA_QUALITY_PS 9","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 4.0","#define FXAA_QUALITY_P8 8.0","#endif","#if (FXAA_QUALITY_PRESET == 27)","#define FXAA_QUALITY_PS 10","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 4.0","#define FXAA_QUALITY_P9 8.0","#endif","#if (FXAA_QUALITY_PRESET == 28)","#define FXAA_QUALITY_PS 11","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 4.0","#define FXAA_QUALITY_P10 8.0","#endif","#if (FXAA_QUALITY_PRESET == 29)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#if (FXAA_QUALITY_PRESET == 39)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.0","#define FXAA_QUALITY_P2 1.0","#define FXAA_QUALITY_P3 1.0","#define FXAA_QUALITY_P4 1.0","#define FXAA_QUALITY_P5 1.5","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#define FxaaBool bool","#define FxaaFloat float","#define FxaaFloat2 vec2","#define FxaaFloat3 vec3","#define FxaaFloat4 vec4","#define FxaaHalf float","#define FxaaHalf2 vec2","#define FxaaHalf3 vec3","#define FxaaHalf4 vec4","#define FxaaInt2 vec2","#define FxaaTex sampler2D","#define FxaaSat(x) clamp(x, 0.0, 1.0)","#define FxaaTexTop(t, p) texture2D(t, p)","#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))","FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","FxaaFloat4 FxaaPixelShader(","FxaaFloat2 pos,","FxaaTex tex,","FxaaFloat2 fxaaQualityRcpFrame,","FxaaFloat fxaaQualitySubpix,","FxaaFloat fxaaQualityEdgeThreshold,","FxaaFloat fxaaQualityEdgeThresholdMin",") {","FxaaFloat2 posM;","posM.x = pos.x;","posM.y = pos.y;","FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","#define lumaM rgbyM.y","FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat maxSM = max(lumaS, lumaM);","FxaaFloat minSM = min(lumaS, lumaM);","FxaaFloat maxESM = max(lumaE, maxSM);","FxaaFloat minESM = min(lumaE, minSM);","FxaaFloat maxWN = max(lumaN, lumaW);","FxaaFloat minWN = min(lumaN, lumaW);","FxaaFloat rangeMax = max(maxWN, maxESM);","FxaaFloat rangeMin = min(minWN, minESM);","FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","FxaaFloat range = rangeMax - rangeMin;","FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","FxaaBool earlyExit = range < rangeMaxClamped;","if(earlyExit)","return rgbyM;","FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNS = lumaN + lumaS;","FxaaFloat lumaWE = lumaW + lumaE;","FxaaFloat subpixRcpRange = 1.0/range;","FxaaFloat subpixNSWE = lumaNS + lumaWE;","FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","FxaaFloat lumaNESE = lumaNE + lumaSE;","FxaaFloat lumaNWNE = lumaNW + lumaNE;","FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","FxaaFloat lumaNWSW = lumaNW + lumaSW;","FxaaFloat lumaSWSE = lumaSW + lumaSE;","FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","FxaaBool horzSpan = edgeHorz >= edgeVert;","FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","if(!horzSpan) lumaN = lumaW;","if(!horzSpan) lumaS = lumaE;","if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","FxaaFloat gradientN = lumaN - lumaM;","FxaaFloat gradientS = lumaS - lumaM;","FxaaFloat lumaNN = lumaN + lumaM;","FxaaFloat lumaSS = lumaS + lumaM;","FxaaBool pairN = abs(gradientN) >= abs(gradientS);","FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","if(pairN) lengthSign = -lengthSign;","FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","FxaaFloat2 posB;","posB.x = posM.x;","posB.y = posM.y;","FxaaFloat2 offNP;","offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","if(!horzSpan) posB.x += lengthSign * 0.5;","if( horzSpan) posB.y += lengthSign * 0.5;","FxaaFloat2 posN;","posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","FxaaFloat2 posP;","posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","FxaaFloat subpixE = subpixC * subpixC;","FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","if(!pairN) lumaNN = lumaSS;","FxaaFloat gradientScaled = gradient * 1.0/4.0;","FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","FxaaFloat subpixF = subpixD * subpixE;","FxaaBool lumaMLTZero = lumaMM < 0.0;","lumaEndN -= lumaNN * 0.5;","lumaEndP -= lumaNN * 0.5;","FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","FxaaBool doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","#if (FXAA_QUALITY_PS > 3)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","#if (FXAA_QUALITY_PS > 4)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","#if (FXAA_QUALITY_PS > 5)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","#if (FXAA_QUALITY_PS > 6)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","#if (FXAA_QUALITY_PS > 7)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","#if (FXAA_QUALITY_PS > 8)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","#if (FXAA_QUALITY_PS > 9)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","#if (FXAA_QUALITY_PS > 10)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","#if (FXAA_QUALITY_PS > 11)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","#if (FXAA_QUALITY_PS > 12)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","FxaaFloat dstN = posM.x - posN.x;","FxaaFloat dstP = posP.x - posM.x;","if(!horzSpan) dstN = posM.y - posN.y;","if(!horzSpan) dstP = posP.y - posM.y;","FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","FxaaFloat spanLength = (dstP + dstN);","FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","FxaaFloat spanLengthRcp = 1.0/spanLength;","FxaaBool directionN = dstN < dstP;","FxaaFloat dst = min(dstN, dstP);","FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","FxaaFloat subpixG = subpixF * subpixF;","FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","return FxaaTexTop(tex, posM);","}","void main() {","gl_FragColor = FxaaPixelShader(","vUV,","uTexture,","uTexelOffset,","fxaaQualitySubpix,","fxaaQualityEdgeThreshold,","fxaaQualityEdgeThresholdMin);","}"].join("\n"),b={
type:"fxaa",id:"fxaa",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},c=Human.renderer.postprocess.effects.fxaa={scene:null};c.init=function(b){this.scene=b,b.createPostProcessType("fxaa",a)},c.addStage=function(a){var c=a.getIOFramebuffers("final");b.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,b.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,b.textures.uTexture.framebuffer=c.read,b.framebuffer=c.write,a.finalPipeline.push(b)},c.configure=function(){},c.updateCanvas=function(){b.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,b.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height;var a=this.scene.getPostProcessStage("fxaa");a&&a.setUniform("uTexelOffset",b.uniforms.uTexelOffset)}}(),function(){"use strict";function a(a){a.createFramebuffer("__BDS_SAO",{depthAttachment:!1})}var b=.9,c=50,d=.1,e=.9,f=.3,g=["#extension GL_OES_standard_derivatives : require","precision highp float;","#define PI2 6.283185","#define TAU (PI2 * 2.0)","#define NUM_SAMPLES 16.0","#define SAMPLE_WEIGHT (1.0 / NUM_SAMPLES)","#define EPSILON 0.0001","varying vec2 vUV;","uniform float uSampleRadius;","uniform float uIntensity;","uniform float uContrast;","uniform float uBias;","uniform vec2 uTexelOffset;","uniform vec3 uDepthParams;","uniform vec3 uXYParams;","uniform sampler2D uDepthBuffer;","vec3 getPosition(float fragDepth, vec2 uv) {","vec2 clipCoord = uv * 2.0 - 1.0;","float zView = uDepthParams.x / (fragDepth * uDepthParams.y + uDepthParams.z);","return vec3(","clipCoord.x * zView * uXYParams.x * uXYParams.y,","clipCoord.y * zView * uXYParams.y,","zView",");","}","vec2 packDepth(float viewZ) {","    float d = viewZ / -uDepthParams.z;","float temp = floor(d * 256.0);","return vec2(","    temp / 256.0,","    d * 256.0 - temp",");","}","void main() {","float fragDepth = texture2D(uDepthBuffer, vUV).x;","if (fragDepth == 1.0) { discard; }","vec3 position = getPosition(fragDepth, vUV);","vec3 normal = normalize(cross(dFdx(position), dFdy(position)));","float ssRadius = min((uXYParams.z * uSampleRadius) / (position.z + EPSILON), 32.0);","if (ssRadius < 4.0) { discard; }","float occlusion = 0.0;","for (int i = 0; i < int(NUM_SAMPLES); ++i) {","   float a = (float(i) + 0.5) * SAMPLE_WEIGHT;","   float h = ssRadius * a;","   float theta = a * TAU;","   vec2 u = vec2(cos(theta), sin(theta));","   vec2 uv = vUV + h * u * uTexelOffset;","   fragDepth = texture2D(uDepthBuffer, uv).x;","   vec3 samplePosition = getPosition(fragDepth, uv);","   vec3 dir = samplePosition - position;","   float len2 = dot(dir, dir);","   float f = max(0.0, uSampleRadius * uSampleRadius - len2);","   occlusion += f * f * f * max(0.0, dot(dir, normal) - uBias) / (len2 + EPSILON);","}","occlusion = max(0.0, occlusion * 2.0 * uIntensity * SAMPLE_WEIGHT);","vec2 odd = mod(gl_FragCoord.xy, 2.0);","if (abs(dFdx(position.z)) < 0.02) {","    occlusion -= dFdx(occlusion) * (odd.x - 0.5);","}","if (abs(dFdy(position.z)) < 0.02) {","    occlusion -= dFdy(occlusion) * (odd.y - 0.5);","}","gl_FragColor.r = occlusion;","gl_FragColor.gb = packDepth(position.z);","}"].join("\n"),h=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform vec2 uTexelOffset;","float unpackDepth(vec2 p) {","    return p.x + p.y / 256.0;","}","void main() {","float gaussian[5];","gaussian[0] = 0.153170;","gaussian[1] = 0.144893;","gaussian[2] = 0.122649;","gaussian[3] = 0.092902;","gaussian[4] = 0.062970;","vec3 centerValue = texture2D(uColorBuffer, vUV).rgb;","float totalWeight = gaussian[0];","float sum = centerValue.r * totalWeight;","float centerDepth = unpackDepth(centerValue.gb);","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * -float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","gl_FragColor.r = sum / (totalWeight + 0.0001);","}"].join("\n"),i=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform sampler2D uOcclusionBuffer;","uniform float uOcclusionScale;","uniform float uOcclusionCutoff;","void main() {","vec4 color = texture2D(uColorBuffer, vUV);","float ambient = 1.0 - smoothstep(uOcclusionCutoff, 1.0, texture2D(uOcclusionBuffer, vUV).r) * uOcclusionScale;","gl_FragColor = vec4(color.rgb * ambient, color.a);","}"].join("\n"),j={type:"sao",id:"sao",uniforms:{uSampleRadius:.4,uIntensity:8,uBias:.001,uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight]),uXYParams:new Float32Array(3),uDepthParams:new Float32Array(3)},textures:{uDepthBuffer:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"__BDS_SAO"},k={type:"saoblur",id:"saohblur",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uColorBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"---SET_ME---"},l={type:"saoblur",id:"saovblur",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"__BDS_SAO"},m={type:"saoblend",id:"saoblend",uniforms:{uOcclusionScale:e,uOcclusionCutoff:f},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"},uOcclusionBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"--SET_ME---"},n=Human.renderer.postprocess.effects.sao={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,fbInitialized:!1,sampleRadius:b,intensity:c,bias:d,scale:e};n.init=function(a){this.scene=a,this.supported&&(a.createPostProcessType("sao",g),a.createPostProcessType("saoblur",h),a.createPostProcessType("saoblend",i))},n.addStage=function(b){if(this.supported){this.fbInitialized||a(this.scene);var c=this.scene.getProjection(),d=c.aspect,e=c.fov*Math.PI/180,f=c.near,g=c.far,h=-Math.tan(.5*e),i=-Human.renderer.canvas.height/(2*Math.tan(.5*e)),n=Human.renderer.canvas.width,o=Human.renderer.canvas.height,p=b.getIOFramebuffers("opaque"),q=p.read,r=p.write;j.uniforms.uSampleRadius=this.sampleRadius,j.uniforms.uIntensity=this.intensity,j.uniforms.uBias=this.bias,j.uniforms.uTexelOffset[0]=1/n,j.uniforms.uTexelOffset[1]=1/o,j.uniforms.uXYParams[0]=d,j.uniforms.uXYParams[1]=h,j.uniforms.uXYParams[2]=i,j.uniforms.uDepthParams[0]=-f*g,j.uniforms.uDepthParams[1]=f-g,j.uniforms.uDepthParams[2]=g,k.uniforms.uTexelOffset[0]=1/n,k.uniforms.uTexelOffset[1]=0,k.framebuffer=r,l.uniforms.uTexelOffset[0]=0,l.uniforms.uTexelOffset[1]=1/o,l.textures.uColorBuffer.framebuffer=r,m.uniforms.uOcclusionScale=this.scale,m.textures.uColorBuffer.framebuffer=q,m.framebuffer=r,b.opaquePipeline.push(j),b.opaquePipeline.push(k),b.opaquePipeline.push(l),b.opaquePipeline.push(m)}},n.setSampleRadius=function(a){this.sampleRadius=j.uniforms.uSampleRadius=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uSampleRadius",this.sampleRadius)},n.setIntensity=function(a){this.intensity=j.uniforms.uIntensity=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uIntensity",this.intensity)},n.setBias=function(a){this.bias=j.uniforms.uBias=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uBias",this.bias)},n.setOcclusionScale=function(a){this.scale=m.uniforms.uOcclusionScale=a;var b=this.scene.getPostProcessStage("saoblend");b&&b.setUniform("uOcclusionScale",this.scale)},n.setOcclusionCutoff=function(a){this.cutoff=m.uniforms.uOcclusionCutoff=a;var b=this.scene.getPostProcessStage("saoblend");b&&b.setUniform("uOcclusionCutoff",this.cutoff)},n.configure=function(a){a=a||{},a.sampleRadius=void 0===a.sampleRadius?b:a.sampleRadius,a.intensity=void 0===a.intensity?c:a.intensity,a.bias=void 0===a.bias?d:a.bias,a.scale=void 0===a.scale?e:a.scale,a.cutoff=void 0===a.cutoff?f:a.cutoff,this.setSampleRadius(a.sampleRadius),this.setIntensity(a.intensity),this.setBias(a.bias),this.setOcclusionScale(a.scale),this.setOcclusionCutoff(a.cutoff)},n.updateProjection=function(){var a=this.scene.getProjection(),b=a.aspect,c=a.fov*Math.PI/180,d=a.near,e=a.far,f=-Math.tan(.5*c),g=-Human.renderer.canvas.height/(2*Math.tan(.5*c));j.uniforms.uXYParams[0]=b,j.uniforms.uXYParams[1]=f,j.uniforms.uXYParams[2]=g,j.uniforms.uDepthParams[0]=-d*e,j.uniforms.uDepthParams[1]=d-e,j.uniforms.uDepthParams[2]=e;var h=this.scene.getPostProcessStage("sao");h&&(h.setUniform("uXYParams",j.uniforms.uXYParams),h.setUniform("uDepthParams",j.uniforms.uDepthParams))},n.updateCanvas=function(){var a=Human.renderer.canvas.width,b=Human.renderer.canvas.height,c=this.scene.getProjection(),d=c.aspect,e=c.fov*Math.PI/180,f=-Math.tan(.5*e),g=-Human.renderer.canvas.height/(2*Math.tan(.5*e));j.uniforms.uTexelOffset[0]=1/a,j.uniforms.uTexelOffset[1]=1/b,j.uniforms.uXYParams[0]=d,j.uniforms.uXYParams[1]=f,j.uniforms.uXYParams[2]=g,k.uniforms.uTexelOffset[0]=1/a,l.uniforms.uTexelOffset[1]=1/b;var h=this.scene.getPostProcessStage("sao"),i=this.scene.getPostProcessStage("saohblur"),m=this.scene.getPostProcessStage("saovblur");h&&i&&m&&(h.setUniform("uXYParams",j.uniforms.uXYParams),h.setUniform("uTexelOffset",j.uniforms.uTexelOffset),i.setUniform("uTexelOffset",k.uniforms.uTexelOffset),m.setUniform("uTexelOffset",l.uniforms.uTexelOffset))}}(),function(){"use strict";function a(b,c){var d,e,f=b.matrixDirty,g=f||c,h=g;if(f&&b.buildMatrix(),g&&(b.parent?mat4.multiply(b.worldMatrix,b.parent.worldMatrix,b.localMatrix):b.worldMatrix.set(b.localMatrix),b.matrixDirty=!1),b.isLeaf())return g?(b.compileXform(),!0):b.geoDirty?(b.compileBoundary(),b.geoDirty=!1,!0):!1;for(d=0,e=b.objects.length;e>d;++d)a(b.objects[d],g)&&(h=!0);if(h){for(b.boundary.xmin=Number.POSITIVE_INFINITY,b.boundary.ymin=Number.POSITIVE_INFINITY,b.boundary.zmin=Number.POSITIVE_INFINITY,b.boundary.xmax=Number.NEGATIVE_INFINITY,b.boundary.ymax=Number.NEGATIVE_INFINITY,b.boundary.zmax=Number.NEGATIVE_INFINITY,d=0,e=b.objects.length;e>d;++d){var i=b.objects[d].getBoundary();b.boundary.xmin=Math.min(b.boundary.xmin,i.xmin),b.boundary.ymin=Math.min(b.boundary.ymin,i.ymin),b.boundary.zmin=Math.min(b.boundary.zmin,i.zmin),b.boundary.xmax=Math.max(b.boundary.xmax,i.xmax),b.boundary.ymax=Math.max(b.boundary.ymax,i.ymax),b.boundary.zmax=Math.max(b.boundary.zmax,i.zmax)}b.center[0]=.5*(b.boundary.xmin+b.boundary.xmax),b.center[1]=.5*(b.boundary.ymin+b.boundary.ymax),b.center[2]=.5*(b.boundary.zmin+b.boundary.zmax)}return h}function b(a,c,d){var g=vec3.create(),h=vec3.create(),j={objects:a,left:null,right:null,bb:{min:g,max:h}};if(0===a.length)return j;g[0]=g[1]=g[2]=Number.POSITIVE_INFINITY,h[0]=h[1]=h[2]=Number.NEGATIVE_INFINITY;var k,l,m,n;for(m=0,n=a.length;n>m;++m)k=a[m],l=k.getBoundary(),l.xmin<g[0]&&(g[0]=l.xmin),l.xmax>h[0]&&(h[0]=l.xmax),l.ymin<g[1]&&(g[1]=l.ymin),l.ymax>h[1]&&(h[1]=l.ymax),l.zmin<g[2]&&(g[2]=l.zmin),l.zmax>h[2]&&(h[2]=l.zmax);if(d>e)return j;var o=i[c],p=(g[c]+h[c])/2,q=new Array(a.length),r=0,s=new Array(a.length),t=0;for(m=0,n=a.length;n>m;++m)k=a[m],l=k.getBoundary(),l[o]<=p?q[r++]=k:s[t++]=k;return f>r||f>t?j:(q.length=r,s.length=t,j.left=b(q,(c+1)%3,d+1),j.right=b(s,(c+1)%3,d+1),j)}function c(a,b,e){var f,g,h=a.bb.min,i=a.bb.max,j=1,k=1;if(b&&(j=Human.math.intersections.planesAabb(b,h,i)),e&&(k=Human.math.intersections.planesAabb(e,h,i)),-1!==k)if(-1!==j)if(1===j&&(b=null),1===k&&(e=null),0===j||0===k)if(a.left)c(a.left,b,e),c(a.right,b,e);else for(f=0,g=a.objects.length;g>f;++f)d(a.objects[f],b,e);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].frustumCull(!1),a.objects[f].clipCull(!1);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].frustumCull(!0);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].clipCull(!0)}function d(a,b,c){var d=a.getBoundary();j[0]=d.xmin,j[1]=d.ymin,j[2]=d.zmin,k[0]=d.xmax,k[1]=d.ymax,k[2]=d.zmax;var e=1,f=1,g=!1;if(b&&(e=Human.math.intersections.planesAabb(b,j,k,l)),c){m.length=c.length,f=Human.math.intersections.planesAabb(c,j,k,m);for(var h=0,i=m.length;i>h&&void 0!==m[h];++h)if(0===m[h]&&c[h].fade){g=!0;break}}a.frustumCull(-1===e),a.clipCull(-1===f),-1!==e&&-1!==f&&(a.clipFade(g),a.setVisiblyClipped(0===e&&0===l[Human.renderer.camera.FRUSTUM_NEAR]||0===f))}var e=10,f=1,g=new Human.utils.selection.GraphMatcher,h=Human.scene={};h.rootObjects=[],h.modelObjects={},h.objects={},h.colorModPriorities={__HIGHLIGHT:Number.POSITIVE_INFINITY},h.objectsByFMAID={},h.objectsForTags={},h._kdTree=null,h.kdTreeDirty=!0,h.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},h.center=vec3.create(),h.enabledObjects={},h._leavesCache={},h.createObject=function(a){if(!a.objectId)return void Human.log.error("Scene.createObject","Param expected: objectId");if(h.objects[a.objectId])return void Human.log.error("Scene.createObject","Param: objectId already in use");var b=a.parentObjectId?h.objects[a.parentObjectId]:null,c=a.modelId;a.tags=a.tags||[];var d=b?h._inheritTags(a.tags,b):a.tags;a.modelId=c,a.parent=b,a.tags=d,b&&(a.reflectedX=b.reflectedX,a.reflectedY=b.reflectedY,a.reflectedZ=b.reflectedZ);var e;return e=a.group?new Human.scene.Group(a):new Human.scene.Object(a),h.objects[a.objectId]=e,e.fmaId&&(h.objectsByFMAID[e.fmaId]=e),b?b.objects.push(e):h.rootObjects.push(e),(h.modelObjects[c]=h.modelObjects[c]||{})[a.objectId]=e,h._registerObjectForTags(e),Human.events.fire("scene.objectCreated",{moduleId:a.moduleId,modelId:c,objectId:e.objectId,name:e.displayName,description:e.description,displayName:e.displayName,fmaId:e.fmaId,tags:e.tags,parentObjectId:b?b.objectId:null}),void 0!==a.shown&&(e.show(a.shown),a.shown&&(h.enabledObjects[a.objectId]=e)),h._leavesCache={},e},h._inheritTags=function(a,b){var c,d,e=a||[],f=b.tags,g=[];if(e){for(var h=0,i=f.length;i>h;h++){d=f[h];for(var j=!0,k=0,l=e.length;l>k;k++)c=e[k],c===d&&(j=!1);j&&g.push(d)}return e.concat(g)}return e},h._registerObjectForTags=function(a){for(var b,c,d=a.tags,e=0,f=d.length;f>e;e++)b=d[e],c=h.objectsForTags[b],c||(c=h.objectsForTags[b]={}),c[a.objectId]=a},h._deregisterObjectForTags=function(a){for(var b,c,d=a.tags,e=0,f=d.length;f>e;e++)b=d[e],c=h.objectsForTags[b],c&&delete c[a.objectId]},h.setEnabledObjects=function(a){var b=a.objects||a.objectIds,c={},d=a.replace?!1:void 0,e=a.fetchAssets?[]:null;h.setEnabledSubtree(Human.scene.rootObjects,b,d,e,c),e&&Human.scene.graph.attachAssetSetsToSubtree(e),Human.utils.isEmpty(c)||Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:c})},h.setEnabledSubtree=function(a,b,c,d,e){for(var f=0,g=a.length;g>f;++f){var i=a[f],j=void 0!==b[i.objectId]?b[i.objectId]:c;i.isLeaf()?j===!0?h.enabledObjects[i.objectId]||(h.enabledObjects[i.objectId]=i,e[i.objectId]=!0,i.show(!0),d&&!i.isRenderable()&&d.push(i)):j===!1&&h.enabledObjects[i.objectId]&&(delete h.enabledObjects[i.objectId],e[i.objectId]=!1,i.show(!1)):h.setEnabledSubtree(i.objects,b,j,d,e)}},h.setColorModPriority=function(a,b){this.colorModPriorities[a]=b;for(var c=this.getLeaves(),d=0,e=c.length;e>d;++d)Human.scene.objects[c[d]].colorModPrioritiesDirty()},h.getLeaves=function(a){var b=h._leavesCache[a];if(!b){if(b=[],a){var c=h.objects[a];c&&h._getLeaves([c],b)}else h._getLeaves(Human.scene.rootObjects,b);h._leavesCache[a]=b}return b},h._getLeaves=function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],0===c.objects.length?b.push(c.objectId):h._getLeaves(c.objects,b)},h.getEnabledLeaves=function(a){var b;if(a){var c=h.objects[a];b=[],c&&h._getEnabledLeaves([c],b)}else b=Object.keys(h.enabledObjects);return b},h._getEnabledLeaves=function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],0===c.objects.length?h.enabledObjects.hasOwnProperty(c.objectId)&&b.push(c.objectId):h._getEnabledLeaves(c.objects,b)},h._getKeys=function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&(d[d]=b);return c},h.destroyObject=function(a){var b=h.objects[a];if(b&&!b._destroyed){var c,d;for(c=0,d=h.rootObjects.length;d>c;c++)if(h.rootObjects[c].objectId===a){h.rootObjects.splice(c,1);break}delete h.objects[a],b.fmaId&&delete h.objectsByFMAID[b.fmaId],delete h.enabledObjects[a],b.parent&&b.parent._removeObject(a);var e=b.objects.slice(0);for(c=0,d=e.length;d>c;c++)h.destroyObject(e[c].objectId);b.isLeaf()&&b.destroyNodes(),delete h.modelObjects[b.modelId][b.objectId],h._deregisterObjectForTags(b),h._leavesCache={},Human.events.fire("scene.objectDestroyed",{objectId:a})}},h.getBoundary=function(a){if(!a)return this.boundary;a=a||{};var b,c,d,e;if(a.objectIds){d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};for(var f=a.objectIds,g=0,i=f.length;i>g;g++)b=h.objects[f[g]],b&&0===b.objects.length&&(e=b.getBoundary(),e.xmin<d.xmin&&(d.xmin=e.xmin),e.ymin<d.ymin&&(d.ymin=e.ymin),e.zmin<d.zmin&&(d.zmin=e.zmin),e.xmax>d.xmax&&(d.xmax=e.xmax),e.ymax>d.ymax&&(d.ymax=e.ymax),e.zmax>d.zmax&&(d.zmax=e.zmax))}else if(a.objects){d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};var j=a.objects;for(c in j)j[c]&&h.objects[c]&&(b=h.objects[c],0===b.objects.length&&(e=b.getBoundary(),e.xmin<d.xmin&&(d.xmin=e.xmin),e.ymin<d.ymin&&(d.ymin=e.ymin),e.zmin<d.zmin&&(d.zmin=e.zmin),e.xmax>d.xmax&&(d.xmax=e.xmax),e.ymax>d.ymax&&(d.ymax=e.ymax),e.zmax>d.zmax&&(d.zmax=e.zmax)))}else d=a.clipped?Human.utils.deepClone(this.boundary):this.boundary;if(a.clipped){var k=Human.renderer.clip.getBoundary();d.xmin=Math.max(d.xmin,k.xmin),d.xmax=Math.min(d.xmax,k.xmax),d.ymin=Math.max(d.ymin,k.ymin),d.ymax=Math.min(d.ymax,k.ymax),d.zmin=Math.max(d.zmin,k.zmin),d.zmax=Math.min(d.zmax,k.zmax)}return d},h.getKdTree=function(){if(this.kdTreeDirty){for(var a=Human.scene.rootObjects,c=[],d=function(a){a.shown&&0===a.objects.length&&c.push(a)},e=0,f=a.length;f>e;++e)a[e].traverseDown(d);this._kdTree=b(c,0,0),this.kdTreeDirty=!1}return this._kdTree},h.access=function(a){return h.getLeaves(a)},h.select=function(a){return g.match(h,a)},h.setObjectProperties=function(a){function b(b){var g=c[b.objectId]=a[b.objectId]||{};if(b.parent){var i=c[b.parent.objectId];for(var j in i)void 0!==g[j]||f[j]||(g[j]=i[j]);g.glassFactor=b.glassFactor,g.murkiness=b.murkiness}g.hasOwnProperty("shown")&&b.shown!==g.shown&&b.isLeaf()&&(d[b.objectId]=g.shown),b.isLeaf()&&(g.shown?(e[b.objectId]=b,h.enabledObjects[b.objectId]=b):delete h.enabledObjects[b.objectId],b.clearColorModifiers(),b.clearOpacityModifiers(),b.setProperties(g))}a=a||{};for(var c={},d={},e={},f={transform:!0},g=Human.scene.rootObjects,i=0,j=g.length;j>i;i++)g[i].traverseDown(b);Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:d,showSelectedObjects:h.showSelectedObjects}),Human.events.fire("scene.objectPropertiesSet",{instructions:a})},h.onFrame=function(){var b,c,d=!1;for(b=0,c=this.rootObjects.length;c>b;++b)a(this.rootObjects[b],!1)&&(d=!0);if(d){for(this.boundary.xmin=Number.POSITIVE_INFINITY,this.boundary.ymin=Number.POSITIVE_INFINITY,this.boundary.zmin=Number.POSITIVE_INFINITY,this.boundary.xmax=Number.NEGATIVE_INFINITY,this.boundary.ymax=Number.NEGATIVE_INFINITY,this.boundary.zmax=Number.NEGATIVE_INFINITY,b=0,c=this.rootObjects.length;c>b;++b){var e=this.rootObjects[b].getBoundary();this.boundary.xmin=Math.min(this.boundary.xmin,e.xmin),this.boundary.ymin=Math.min(this.boundary.ymin,e.ymin),this.boundary.zmin=Math.min(this.boundary.zmin,e.zmin),this.boundary.xmax=Math.max(this.boundary.xmax,e.xmax),this.boundary.ymax=Math.max(this.boundary.ymax,e.ymax),this.boundary.zmax=Math.max(this.boundary.zmax,e.zmax)}this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)}},h.cull=function(){c(this.getKdTree(),Human.renderer.camera.getFrustum(),Human.renderer.clip.getActiveClips())};var i=["xmin","ymin","zmin"],j=vec3.create(),k=vec3.create(),l=new Array(6),m=[]}(),function(){"use strict";Human.scene.Group=function(a){this.modelId=a.modelId,this.objectId=a.objectId,this.fmaId=a.fmaId,this.layer=a.layer,this.displayName=a.displayName,this.description=a.description,this.parent=a.parent,this.tags=a.tags,this.anonymous=a.anonymous,this.objects=[],this.reflectedX=a.reflectedX||!1,this.reflectedY=a.reflectedY||!1,this.reflectedZ=a.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=a.transformId,this.transformInitialized=!a.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,(a.pivot||a.translate||a.scale||a.rotate)&&this.setTransform(a)},Human.scene.Group.prototype.checkRenderable=function(){for(var a=0,b=this.objects.length;b>a;++a)this.objects[a].checkRenderable()},Human.scene.Group.prototype.isVisible=function(){var a=this.getLeafObjects().length;return this.getShownObjects().length===a&&this.getRenderableObjects().length===a},Human.scene.Group.prototype.isLeaf=function(){return!1},Human.scene.Group.prototype.setTransform=function(a){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),a.pivot&&(void 0!==a.pivot.x&&(this.pivot.x=a.pivot.x),void 0!==a.pivot.y&&(this.pivot.y=a.pivot.y),void 0!==a.pivot.z&&(this.pivot.z=a.pivot.z)),a.translate&&(void 0!==a.translate.x&&(this.translate.x=a.translate.x),void 0!==a.translate.y&&(this.translate.y=a.translate.y),void 0!==a.translate.z&&(this.translate.z=a.translate.z)),a.scale&&(void 0!==a.scale.x&&(this.scale.x=a.scale.x),void 0!==a.scale.y&&(this.scale.y=a.scale.y),void 0!==a.scale.z&&(this.scale.z=a.scale.z),a.scale.x<0&&this.setReflectedX(!0),a.scale.y<0&&this.setReflectedY(!0),a.scale.z<0&&this.setReflectedZ(!0)),a.rotate&&(void 0!==a.rotate.x&&(this.rotate.x=a.rotate.x),void 0!==a.rotate.y&&(this.rotate.y=a.rotate.y),void 0!==a.rotate.z&&(this.rotate.z=a.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var a=mat4.create(),b=mat4.create(),c=mat4.create(),d=mat4.create(),e=mat4.create(),f=mat4.create();Human.scene.Group.prototype.buildMatrix=function(){var g=this.pivot,h=this.translate;mat4.fromTranslation(a,[-g.x,-g.y,-g.z]);var i=this.scale;mat4.fromScaling(b,[i.x,i.y,i.z]),mat4.fromTranslation(c,[h.x+g.x,h.y+g.y,h.z+g.z]);var j=this.rotate;mat4.fromRotation(d,j.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(e,j.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(f,j.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,a,this.localMatrix),mat4.multiply(this.localMatrix,b,this.localMatrix),mat4.multiply(this.localMatrix,f,this.localMatrix),mat4.multiply(this.localMatrix,e,this.localMatrix),mat4.multiply(this.localMatrix,d,this.localMatrix),mat4.multiply(this.localMatrix,c,this.localMatrix),this.matrixDirty=!1},Human.scene.Group.prototype.reflectedTransform=function(){var a=0;return this.reflectedX&&++a,this.reflectedY&&++a,this.reflectedZ&&++a,a%2===1},Human.scene.Group.prototype.getBoundary=function(){return this.boundary},Human.scene.Group.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Group.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Group.prototype.getCenter=function(){return this.center},Human.scene.Group.prototype.setReflectedX=function(a){this.reflectedX=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedX(a)},Human.scene.Group.prototype.setReflectedY=function(a){this.reflectedY=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedY(a)},Human.scene.Group.prototype.setReflectedZ=function(a){this.reflectedZ=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedZ(a)},Human.scene.Group.prototype._removeObject=function(a){for(var b=0,c=this.objects.length;c>b;b++)if(this.objects[b].objectId===a)return void this.objects.splice(b,1)},Human.scene.Group.prototype.isRenderable=function(){for(var a=0,b=this.objects.length;b>a;++a)if(!this.objects[a].isRenderable())return!1;return!0},Human.scene.Group.prototype.isPinnable=function(){for(var a=0,b=this.objects.length;b>a;++a)if(!this.objects[a].isPinnable())return!1;return!0},Human.scene.Group.prototype.getDefaultProperties=function(){return{shown:!1,pickable:!0,backfaces:!1,glassFactor:0,murkiness:1,opacity:1}},Human.scene.Group.prototype.traverseUp=function(a){a(this),this.parent&&this.parent.traverseUp(a)},Human.scene.Group.prototype.traverseDown=function(a){a(this);for(var b=0,c=this.objects.length;c>b;b++)this.objects[b].traverseDown(a)},Human.scene.Group.prototype.getLeafObjects=function(a){var b=[];return this.traverseDown(function(c){c.isLeaf()&&(b.push(c),a&&a(c))}),b},Human.scene.Group.prototype.getRenderableObjects=function(a){var b=[];return this.getLeafObjects(function(c){c.isRenderable()&&(b.push(c),a&&a(c))}),b},Human.scene.Group.prototype.getShownObjects=function(a){var b=[];return this.getLeafObjects(function(c){c.shown&&(b.push(c),a&&a(c))}),b}}(),function(){"use strict";function a(a,b){var c=a.constructor.name,d=b.constructor.name;return c===d?"Number"===c||"Boolean"===c?a===b:"Array"===c||"Float32Array"===c?a.reduce(function(a,c,d){return a&&c===b[d]},!0):"ScalarFresnel"===c?j.prototype.isEqual(a,b):"ColorFresnel"===c?i.prototype.isEqual(a,b):!1:!1}function b(a){var b=a.constructor.name;return"Array"===b?a.slice(0):"ColorFresnel"===b?new i(a.center,a.edge,a.centerBias,a.edgeBias,a.power):"ScalarFresnel"===b?new j(a.center,a.edge,a.centerBias,a.edgeBias,a.power):a}function c(a,b){a._propertiesNode&&(a.tintColor=b,a.setColorModifier("__TINT_COLOR",{applyTo:"tintColor",value:a.tintColor}))}function d(a){a._propertiesNode.setEnabled(a.shown&&!a.culledByFrustum&&!a.culledByClip)}function e(a){for(var b=a.renderables,c=0,d=b.length;d>c;++c)b[c].setBackfaces(!1)}function f(a,b){return a.priority-b.priority}function g(a){a.colorModifierList.length=0;for(var b in a.colorModifiers)a.colorModifierList.push(a.colorModifiers[b]);a.colorModifierList.sort(f),a.colorModifierConfigs.length=a.colorModifierList.length;for(var c=0,d=a.colorModifierList.length;d>c;++c)a.colorModifierConfigs[c]=a.colorModifierList[c].params}function h(a){a.opacityModifierConfigs.length=0;for(var b in a.opacityModifiers)a.opacityModifierConfigs.push(a.opacityModifiers[b])}var i=window.ColorFresnel,j=window.ScalarFresnel;Human.scene.Object=function(a){if(this.modelId=a.modelId,this.objectId=a.objectId,this.anonymous=a.anonymous,this.fmaId=a.fmaId,this.layer=parseInt(a.layer,10)||0,this.displayName=a.displayName,this.description=a.description,this.parent=a.parent,this.shown=!1,this.culledByFrustum=!1,this.culledByClip=!1,this.fadeByClip=!1,this.pickable=!0,this.clippable=!0,this.xray=!1,this.opacity=void 0!==a.opacity?a.opacity:1,this.glassFactor=1,this.murkiness=1,this.highlight=!1,this.tintColor=new Float32Array([1,1,1]),this.saturation=0,this.contrast=0,this.brightness=0,this.colorModifiers={},this.colorModifierList=[],this.colorModifierConfigs=[],this.opacityModifiers={},this.opacityModifierConfigs=[],this.backfaces=!1,this.visiblyClipped=!1,this.windingOrder="ccw",this.tags=a.tags,this.objects=[],this.reflectedX=a.reflectedX||!1,this.reflectedY=a.reflectedY||!1,this.reflectedZ=a.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=a.transformId,this.transformInitialized=!a.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,this._rootNode=null,this._renderableRoot=null,this.renderables=[],this.anonymousIdToRenderableIndex=a.anonymousIdToRenderableIndex||{},a.renderables){this.initRenderables();for(var b=0,c=a.renderables.length;c>b;++b)this.addRenderable(a.renderables[b])}(a.geometryId||a.morphId)&&(this.initRenderables(),this.addRenderable(a)),(a.pivot||a.translate||a.scale||a.rotate)&&this.setTransform(a),this._checkFlippedWinding(),this._propertiesNode&&this._propertiesNode.setSolidColor(a.capColor||{r:.7,g:.7,b:.7})},Human.scene.Object.prototype.initRenderables=function(){if(!this._rootNode){this._rootNode=this._transformNode=Human.renderer.graph.createSubtree({type:"xform"});var a=this.getDefaultFlags();this._xrayBackfaces=!1,a.enabled=!1,a.pickable=!0,a.solid=Human.scene.enableSolidObjects,a.layer=this.layer||0,a.name=this.objectId,a.xray=!1,a.highlight=!1,a.opacity=this.opacity,a.glassFactor=this.glassFactor,a.murkiness=this.murkiness,a.xrayEnabled=!0,this._renderableRoot=this._propertiesNode=Human.renderer.graph.insertNode(this._rootNode,{type:"properties",properties:a})}},Human.scene.Object.prototype.addRenderable=function(a){this.renderables.push(new Human.scene.Renderable(this,a))},Human.scene.Object.prototype.detachAsset=function(a){var b,c;switch(a){case"geometry":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachGeometry();break;case"material":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachMaterial();break;case"morph":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachMorph()}},Human.scene.Object.prototype.checkRenderable=function(){this.isRenderable()&&Human.events.fire("scene.objectRenderable",{objectId:this.objectId})},Human.scene.Object.prototype.isRenderable=function(){for(var a=0,b=this.renderables.length;b>a;++a)if(!this.renderables[a].isRenderable())return!1;for(var c=this;c;){if(c.transformId&&!c.transformInitialized)return!1;c=c.parent}return!0},Human.scene.Object.prototype.isVisible=function(){return this.shown&&this.isRenderable()},Human.scene.Object.prototype.isLeaf=function(){return!0},Human.scene.Object.prototype.setTransform=function(a){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),a.pivot&&(void 0!==a.pivot.x&&(this.pivot.x=a.pivot.x),void 0!==a.pivot.y&&(this.pivot.y=a.pivot.y),void 0!==a.pivot.z&&(this.pivot.z=a.pivot.z)),a.translate&&(void 0!==a.translate.x&&(this.translate.x=a.translate.x),void 0!==a.translate.y&&(this.translate.y=a.translate.y),void 0!==a.translate.z&&(this.translate.z=a.translate.z)),a.scale&&(void 0!==a.scale.x&&(this.scale.x=a.scale.x),void 0!==a.scale.y&&(this.scale.y=a.scale.y),void 0!==a.scale.z&&(this.scale.z=a.scale.z),a.scale.x<0&&this.setReflectedX(!0),a.scale.y<0&&this.setReflectedY(!0),a.scale.z<0&&this.setReflectedZ(!0)),a.rotate&&(void 0!==a.rotate.x&&(this.rotate.x=a.rotate.x),void 0!==a.rotate.y&&(this.rotate.y=a.rotate.y),void 0!==a.rotate.z&&(this.rotate.z=a.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var k=mat4.create(),l=mat4.create(),m=mat4.create(),n=mat4.create(),o=mat4.create(),p=mat4.create();

Human.scene.Object.prototype.buildMatrix=function(){var a=this.pivot,b=this.translate;mat4.fromTranslation(k,[-a.x,-a.y,-a.z]);var c=this.scale;mat4.fromScaling(l,[c.x,c.y,c.z]),mat4.fromTranslation(m,[b.x+a.x,b.y+a.y,b.z+a.z]);var d=this.rotate;mat4.fromRotation(n,d.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(o,d.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(p,d.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,k,this.localMatrix),mat4.multiply(this.localMatrix,l,this.localMatrix),mat4.multiply(this.localMatrix,p,this.localMatrix),mat4.multiply(this.localMatrix,o,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,m,this.localMatrix),this.matrixDirty=!1},Human.scene.Object.prototype.compileXform=function(){this._transformNode&&(this._transformNode.setElements(this.worldMatrix),this.compileBoundary())},Human.scene.Object.prototype.compileBoundary=function(){Human.scene.kdTreeDirty=!0,Human.renderer.camera.nearFarDirty=!0;var a=this.worldMatrix,b=this._getBoundary(a);this.boundary.xmin=b.xmin,this.boundary.ymin=b.ymin,this.boundary.zmin=b.zmin,this.boundary.xmax=b.xmax,this.boundary.ymax=b.ymax,this.boundary.zmax=b.zmax,this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)},Human.scene.Object.prototype.reflectedTransform=function(){var a=0;return this.reflectedX&&++a,this.reflectedY&&++a,this.reflectedZ&&++a,a%2===1},Human.scene.Object.prototype._checkFlippedWinding=function(){if(this._propertiesNode){var a=this.reflectedTransform(),b=this.windingOrder,c="ccw"===this.windingOrder?"cw":"ccw";this._propertiesNode.setFrontface(a?c:b)}},Human.scene.Object.prototype.getBoundary=function(){return this.boundary},Human.scene.Object.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Object.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Object.prototype.getCenter=function(){return this.center};var q=vec3.create(),r=vec3.create();Human.scene.Object.prototype._getBoundary=function(a){for(var b,c,d,e=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY,k=0,l=this.renderables.length;l>k;++k){var m=this.renderables[k],n=m.boundary;if(m.isRenderable()){if(this._propertiesNode.getSkybox()){var o=Human.renderer.camera.eye;r[0]=o.x,r[1]=o.y,r[2]=o.z}else r[0]=0,r[1]=0,r[2]=0;for(var p=0;8>p;p++)q[0]=1&p?n.xmin:n.xmax,q[1]=2&p?n.ymin:n.ymax,q[2]=4&p?n.zmin:n.zmax,vec3.transformMat4(q,q,a),b=q[0]-r[0],c=q[1]-r[1],d=q[2]-r[2],e>b&&(e=b),f>c&&(f=c),g>d&&(g=d),b>h&&(h=b),c>i&&(i=c),d>j&&(j=d)}}return{xmin:e,ymin:f,zmin:g,xmax:h,ymax:i,zmax:j}},Human.scene.Object.prototype.show=function(a){if(this.shown!==a&&(this.shown=a,this._propertiesNode)){d(this),Human.scene.kdTreeDirty=!0;var b="scene.object"+(this.shown?"Shown":"Hidden");Human.events.fire(b,{objectId:this.objectId})}},Human.scene.Object.prototype.frustumCull=function(a){this.culledByFrustum!==a&&this._propertiesNode&&(this.culledByFrustum=a,d(this))},Human.scene.Object.prototype.clipCull=function(a){this.culledByClip!==a&&this._propertiesNode&&(this.culledByClip=a,d(this))},Human.scene.Object.prototype.clipFade=function(a){this.fadeByClip!==a&&this._propertiesNode&&(this.fadeByClip=a,this._propertiesNode.setProperties({forceTransparent:a,partiallyOpaque:a}))},Human.scene.Object.prototype.setOpacity=function(c){return c===!1?void this.clearOpacityModProperties({opacity:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(a(this.opacity,c)||(this.opacity=c,this._propertiesNode&&this.setOpacityModifier("__OPACITY",{value:this.opacity}))))},Human.scene.Object.prototype.setXRay=function(a){this.setXRayColors(a),this.xray=a},Human.scene.Object.prototype.setXRayColors=function(a){this._propertiesNode&&(this._propertiesNode.setProperties({xray:a}),e(this))},Human.scene.Object.prototype.setGlassFactor=function(a){this.glassFactor=a,this._propertiesNode&&this._propertiesNode.setProperties({glassFactor:a})},Human.scene.Object.prototype.setMurkiness=function(a){this.murkiness=a,this._propertiesNode&&this._propertiesNode.setProperties({murkiness:a})},Human.scene.Object.prototype.setPickable=function(a){this.pickable!==a&&(this._propertiesNode&&this._propertiesNode.setPicking(a),this.pickable=a)},Human.scene.Object.prototype.setClippable=function(a){this.clippable!==a&&(this._propertiesNode&&this._propertiesNode.setClipping(a),this.clippable=a)},Human.scene.Object.prototype.setColorModifier=function(a,b){if(this._propertiesNode){var c=!1;if(null===b)delete this.colorModifiers[a],c=!0;else if(this.colorModifiers[a]){var d=this.colorModifiers[a];void 0!==b.applyTo&&(d.params.applyTo=b.applyTo),void 0!==b.value&&(d.params.value=b.value),d.params.range=void 0!==b.range?b.range:null}else this.colorModifiers[a]={priority:Human.scene.colorModPriorities[a]||0,params:{applyTo:b.applyTo,value:b.value,range:b.range||null}},c=!0;c&&g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})}},Human.scene.Object.prototype.clearColorModifiers=function(){this._propertiesNode&&(this.colorModifiers={},g(this),this.tintColor=new Float32Array(s.tintColor.value),this.brightness=s.brightness.value,this.saturation=s.saturation.value,this.contrast=s.contrast.value,this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.clearColorModProperties=function(a){this._propertiesNode&&((!a||a.tintColor)&&(delete this.colorModifiers.__TINT_COLOR,this.tintColor=new Float32Array(s.tintColor.value)),(!a||a.brightness)&&(delete this.colorModifiers.__BRIGHTNESS,this.brightness=s.brightness.value),(!a||a.saturation)&&(delete this.colorModifiers.__SATURATION,this.saturation=s.saturation.value),(!a||a.contrast)&&(delete this.colorModifiers.__CONTRAST,this.contrast=s.contrast.value),g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.setOpacityModifier=function(a,b){if(this._propertiesNode){var c=!1;if(null===b)delete this.opacityModifiers[a],c=!0;else if(this.opacityModifiers[a]){var d=this.opacityModifiers[a];void 0!==b.value&&(d.value=b.value),d.range=void 0!==b.range?b.range:null}else this.opacityModifiers[a]={value:b.value,range:b.range||null},c=!0;c&&h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs})}},Human.scene.Object.prototype.clearOpacityModifiers=function(){this._propertiesNode&&(this.opacityModifiers={},this.opacity=s.opacity.value,h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.clearOpacityModProperties=function(a){this._propertiesNode&&((!a||a.opacity)&&(delete this.opacityModifiers.__OPACITY,this.opacity=s.opacity.value),h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.colorModPrioritiesDirty=function(){for(var a in this.colorModifiers)this.colorModifiers[a].priority=Human.scene.colorModPriorities[a]||0;g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})},Human.scene.Object.prototype.setHighlight=function(a){if(this._propertiesNode){if(a){var b=Human.renderer.highlightColor;this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:b})}else this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:Human.math.VEC3_ONES});this.highlight=a}},Human.scene.Object.prototype.setTintColor=function(d){if(d===!1)return void this.clearColorModProperties({tintColor:!0});var e;3===arguments.length?e=[arguments[0],arguments[1],arguments[2]]:(e=b(arguments[0]),Array.isArray(e)&&5===e.length&&(e=new i(e))),a(this.tintColor,e)||c(this,e)},Human.scene.Object.prototype.setContrast=function(c){return c===!1?void this.clearColorModProperties({contrast:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.contrast,c)&&(this.contrast=c,this.setColorModifier("__CONTRAST",{applyTo:"contrast",value:this.contrast}))))},Human.scene.Object.prototype.setSaturation=function(c){return c===!1?void this.clearColorModProperties({saturation:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.saturation,c)&&(this.saturation=c,this.setColorModifier("__SATURATION",{applyTo:"saturation",value:this.saturation}))))},Human.scene.Object.prototype.setBrightness=function(c){return c===!1?void this.clearColorModProperties({brightness:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.brightness,c)&&(this.brightness=c,this.setColorModifier("__BRIGHTNESS",{applyTo:"brightness",value:this.brightness}))))},Human.scene.Object.prototype.setPartiallyOpaque=function(a){this._propertiesNode&&this._propertiesNode.setProperties({partiallyOpaque:a})},Human.scene.Object.prototype.setBackfaces=function(a){this.backfaces!==a&&(this.backfaces=a,e(this))},Human.scene.Object.prototype.setVisiblyClipped=function(a){this.visiblyClipped!==a&&this.hasRenderObjects()&&(this.visiblyClipped=a,e(this))},Human.scene.Object.prototype.setReflectedX=function(a){this.reflectedX=a,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedY=function(a){this.reflectedY=a,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedZ=function(a){this.reflectedZ=a,this._checkFlippedWinding()},Human.scene.Object.prototype.destroyNodes=function(){this._rootNode&&(Human.renderer.graph.destroySubtree(this._rootNode),this.renderables.length=0,this._rootNode=null)};var s={shown:{setter:Human.scene.Object.prototype.show,value:!1,keyable:!0,type:"boolean"},pickable:{setter:Human.scene.Object.prototype.setPickable,value:!0,keyable:!1,type:"boolean"},backfaces:{setter:Human.scene.Object.prototype.setBackfaces,value:!1,keyable:!1,type:"boolean"},glassFactor:{setter:Human.scene.Object.prototype.setGlassFactor,value:0,keyable:!1,type:"number"},murkiness:{setter:Human.scene.Object.prototype.setMurkiness,value:1,keyable:!1,type:"number"},opacity:{setter:Human.scene.Object.prototype.setOpacity,value:1,keyable:!0,type:"number"},tintColor:{setter:Human.scene.Object.prototype.setTintColor,value:new Float32Array([1,1,1]),keyable:!1,type:"Float32Array"},saturation:{setter:Human.scene.Object.prototype.setSaturation,value:0,keyable:!1,type:"number"},brightness:{setter:Human.scene.Object.prototype.setBrightness,value:0,keyable:!1,type:"number"},contrast:{setter:Human.scene.Object.prototype.setContrast,value:0,keyable:!1,type:"number"}},t=Object.keys(s);Human.scene.Object.prototype.getDefaultFlags=function(){return{picking:this.pickable,enabled:!1,specular:!0,backfaces:!1,reflection:!0,solid:Human.scene.enableSolidObjects}},Human.scene.Object.prototype.getDefaultProperties=function(){for(var a={},b=0,c=t.length;c>b;b++){var d=t[b];a[d]=s[d].value}return a},Human.scene.Object.prototype.getProperties=function(){for(var a=this,b={},c=0,d=t.length;d>c;c++){var e=t[c];b[e]=a[e]}return b},Human.scene.Object.prototype.setProperties=function(b){b=b||{};var c,d,e,f,g=this;for(this.clearColorModifiers(),this.clearOpacityModifiers(),e=0,f=t.length;f>e;e++){var h=t[e];c=s[h],d=void 0!==b[h]?b[h]:c.value,a(g[h],d)||c.setter.call(g,d)}var i,j=Human.scene.colorRecipes.getRecipes();for(e=0;e<j.length;e++)i=j[e],Human.scene.colorRecipes.setObjectRecipe(this.objectId,i,b[i]||!1)},Human.scene.Object.prototype.barycentricToModelSpace=function(a,b,c,d){if(this.renderables.length<=a)return!1;var e=this.renderables[a].getRenderObject();return e?(e.barycentricToCartesian(b,c,d),d):!1},Human.scene.Object.prototype.barycentricToWorldSpace=function(a,b,c,d){return this.barycentricToModelSpace(a,b,c,d),d?(vec3.transformMat4(d,d,this.getWorldMatrix()),d):!1},Human.scene.Object.prototype.isPinnable=function(){return this.hasRenderObjects()},Human.scene.Object.prototype.hasRenderObjects=function(){for(var a=0,b=this.renderables.length;b>a;++a)if(!this.renderables[a].getRenderObject())return!1;return!0},Human.scene.Object.prototype.serialize=function(){var b={};for(var c in s){var d=s[c];if(!a(d.value,this[c])){var e,f=this[c];e=JSON.parse(f instanceof j||f instanceof i?JSON.stringify([f.center,f.edge,f.centerBias,f.edgeBias,f.power]):JSON.stringify(f)),b[c]=e}}return b},Human.scene.Object.prototype.traverseUp=function(a){a(this),this.parent&&this.parent.traverseUp(a)},Human.scene.Object.prototype.traverseDown=function(a){a(this)},Human.scene.Object.prototype.getLeafObjects=function(a){return a&&a(this),[this]}}(),function(){"use strict";var a=0,b=Human.scene.Renderable=function(b,c){this.id=a++,this.object=b,this.rootNode=b._renderableRoot.addNode(),this.geometryId=c.geometryId||null,this.materialId=c.materialId||null,this.morphId=c.morphId||null,this.drawTexture=null,this.geometryAttached=!1,this.materialAttached=!1,this.morphAttached=!1,this.geometryNode=null,this.materialNode=null,this.textureNodes=null,this.fresnelNodes=null,this.reflectionNode=null,this.lightMapNode=null,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.backfaces=!1,this.addBlend=!1,this.layer=c.layer||0};b.prototype.attachAsset=function(a,b){var c=this.isRenderable();this[a+"Attached"]=!0,c!==this.isRenderable()?(this.compileMaterial(),this.compileGeometry(),this.morphAttached&&this.compileMorph(),this.setBackfaces(this.backfaces),this.setAddBlend(this.addBlend),this.setLayer(this.layer),this.object.checkRenderable()):this.isRenderable()&&this.compileMorph(),("morph"===a||"geometry"===a&&!this.morph)&&(this.boundary=b.boundary)},b.prototype.detachGeometry=function(){this.geometryNode&&(this.geometryNode.splice(),this.geometryNode.destroy(),this.geometryNode=null,this.geometryAttached=!1,Human.assets.putAsset(this.geometryId))},b.prototype.detachMaterial=function(){if(this.materialNode&&(this.materialNode.splice(),this.materialNode.destroy(),this.materialNode=null),this.textureNodes){for(var a=0,b=this.textureNodes.length;b>a;++a)this.textureNodes[a].splice(),this.textureNodes[a].destroy();this.textureNodes=null}if(this.fresnelNodes){for(var c in this.fresnelNodes)this.fresnelNodes[c].splice(),this.fresnelNodes[c].destroy();this.fresnelNodes=null}this.reflectionNode&&(this.reflectionNode.splice(),this.reflectionNode.destroy(),this.reflectionNode=null),this.lightMapNode&&(this.lightMapNode.splice(),this.lightMapNode.destroy(),this.lightMapNode=null),this.materialAttached=!1,Human.assets.putAsset(this.materialId)},b.prototype.detachMorph=function(){this.morphNode&&(this.morphNode.splice(),this.morphNode.destroy(),this.morphNode=null,this.morphAttached=!1,Human.assets.putAsset(this.morphId))},b.prototype.disconnectGeometry=function(){this.geometryNode&&(Human.renderer.graph.disconnectNode(this.geometryNode),this.geometryNode=null,this.geometryAttached=!1)},b.prototype.disconnectMaterial=function(){if(this.materialNode&&(Human.renderer.graph.disconnectNode(this.materialNode),this.materialNode=null),this.textureNodes){for(var a=0,b=this.textureNodes.length;b>a;++a)Human.renderer.graph.disconnectNode(this.textureNodes[a]);this.textureNodes=null}if(this.fresnelNodes){for(var c in this.fresnelNodes)Human.renderer.graph.disconnectNode(this.fresnelNodes[c]);this.fresnelNodes=null}this.reflectionNode&&(Human.renderer.graph.disconnectNode(this.reflectionNode),this.reflectionNode=null),this.lightMapNode&&(Human.renderer.graph.disconnectNode(this.lightMapNode),this.lightMapNode=null),this.materialAttached=!1},b.prototype.disconnectMorph=function(){this.morphNode&&(Human.renderer.graph.disconnectNode(this.morphNode),this.morphNode=null,this.morphAttached=!1)},b.prototype.isRenderable=function(){return!(!this.materialAttached||!this.geometryAttached)},b.prototype.getRenderObject=function(){return this.geometryNode?this.geometryNode.getObject():null},b.prototype.isTransparent=function(){var a=this.getRenderObject();return a?a.isTransparent():!1},b.prototype.setBackfaces=function(a){a=a&&!this.isTransparent(),this.backfaces=a,this.geometryNode&&this.geometryNode.setBackfaces(this.backfaces)},b.prototype.setAddBlend=function(a){this.addBlend=a,this.geometryNode&&this.geometryNode.setAddBlend(this.addBlend)},b.prototype.setLayer=function(a){this.layer=a,this.geometryNode&&this.geometryNode.setLayer(this.layer)},b.prototype.setGeometry=function(a){this.disconnectGeometry(),this.geometryId=a,this.geometryAttached=!0,this.compileGeometry()},b.prototype.setMaterial=function(a){this.disconnectMaterial(),this.materialId=a,this.materialAttached=!0,this.compileMaterial()},b.prototype.attachDrawTexture=function(a){this.drawTexture=Human.renderer.graph.insertNode(this.rootNode,a)},b.prototype.compileGeometry=function(){var a=Human.assets.geometries.geometries[this.geometryId];if(a){this.geometryNode=Human.renderer.graph.insertNode(this.rootNode,{type:"geometry",coreId:a.geometry.getCoreId()});var b=this;this.geometryNode.onObjectCreate=function(a){b.isTransparent()&&b.setBackfaces(b.backfaces),a.sortTieBreaker=b.id},this.object.geoDirty=!0}},b.prototype.compileMaterial=function(){var a=Human.assets.materials.materials[this.materialId];if(a){if(a.textures){var b=a.textures;this.textureNodes=[];var c,d;for(c=0,d=b.length;d>c;c++)b[c]&&this.textureNodes.push(Human.renderer.graph.insertNode(this.rootNode,{type:"texture",coreId:b[c].getCoreId()}))}if(a.material&&(this.materialNode=Human.renderer.graph.insertNode(this.rootNode,{type:"material",coreId:a.material.getCoreId()})),a.flags){var e=Human.utils.apply(a.flags,this.object._propertiesNode.getProperties());void 0!==e.frontface&&(this.object.windingOrder=e.frontface),void 0!==e.backfaces&&this.setBackfaces(e.backfaces),void 0!==e.addBlend&&this.setAddBlend(e.addBlend),this.object._propertiesNode.setProperties(e)}if(a.reflection&&(this.reflectionNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:a.reflection.getCoreId()})),a.lightmap&&(this.lightMapNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:a.lightmap.getCoreId()})),a.fresnels){var f=a.fresnels;this.fresnelNodes={};for(var g in f)f.hasOwnProperty(g)&&(this.fresnelNodes[g]=Human.renderer.graph.insertNode(this.rootNode,{type:"fresnel",coreId:f[g].getCoreId()}))}void 0!==a.glassFactor&&this.object.setGlassFactor(a.glassFactor),void 0!==a.murkiness&&this.object.setMurkiness(a.murkiness)}},b.prototype.compileMorph=function(){var a=Human.assets.morphs.morphs[this.morphId];a&&(this.morphNode=Human.renderer.graph.insertNode(this.rootNode,{type:"morphGeometry",coreId:a.morphGeometry.getCoreId()}),this.object.geoDirty=!0)},b.prototype.isAttached=function(){return this.object.renderables.indexOf(this)>-1}}(),function(){"use strict";var a=Human.scene.sets={},b=function(a,b){var c=[null,void 0];return c.indexOf(b)<0?b:c.indexOf(a)<0?a:null},c=function(a,b){return b===a?!0:!1};a.keys=function(a,b){b=b||!1;var c=Object.keys(a),d=[];return b?c.forEach(function(a){b(a)&&d.push(a)}):d=c,d},a.filterKeys=function(b,c){var d,e=[];if(c instanceof RegExp)d=c;else try{d=new RegExp(c)}catch(f){return{}}var g=function(a){return d.test(a)};return e=a.keys(b).filter(g)},a.keysWhere=function(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&b(a[d])&&c.push(d);return c},a.hasKey=function(b,c){var d=a.keys(b);return d.indexOf(c)>=0?!0:!1},a.getSetIterator=function(b){var c=0,d=a.keys(b),e=d.length;return{next:function(){var a;if(!this.hasNext())return null;var e=d[c];return a={key:e,value:b[e]},c++,a},hasNext:function(){return e>c},rewind:function(){return c=0,b[d[0]]},current:function(){return b[d[c]]}}},a.values=function(b){var c=a.keys(b),d=[];return c.forEach(function(a){d.push(b[a])}),d},a.jointKeys=function(b,c){var d={},e=function(a){d[a]=!0},f=a.keys(b),g=a.keys(c);return f.forEach(e),g.forEach(e),a.keys(d)},a.commonKeys=function(b,c){var d={},e=a.keys(b),f=a.keys(c);return e.forEach(function(a){d[a]=1}),f.forEach(function(a){d[a]=(d[a]||0)+1}),a.keysWhere(d,function(a){return a>1?!0:!1})},a.uniqueKeys=function(b,c){var d={},e=function(a){d[a]=1},f=function(a){d[a]=0},g=a.keys(b),h=a.keys(c);return g.forEach(e),h.forEach(f),a.keysWhere(d,function(a){return a>0?!0:!1})},a.union=function(c,d,e){var f,g={},h=null;return e||(e=b),f=a.jointKeys(c,d),f.forEach(function(a){h=e(c[a],d[a]),null!==h&&(g[a]=h)}),g},a.intersection=function(c,d,e){var f,g={},h=null;return e||(e=b),f=a.commonKeys(c,d),f.forEach(function(a){h=e(c[a],d[a]),null!==h&&(g[a]=h)}),g},a.difference=function(c,d,e){var f=a.uniqueKeys(c,d),g=null;e||(e=b);var h={};return f.forEach(function(a){g=e(c[a]),null!==g&&(h[a]=g)}),h},a.isin=function(b,d,e){e||(e=c);for(var f,g=!1,h=a.getSetIterator(d);h.hasNext()&&!g;)f=h.next(),g=e(b,f.key,f.value);return g}}(),function(){"use strict";function a(a,b){var c=a.objectId,d=a.geometryId||null,e=a.morphId||null,f=a.materialId||null,g=a.transformId||null;if(Human.scene.objects[c])return null;void 0===a.layer&&(a.layer=b?b.layer:0),a.objectId=c,a.parent=b,a.parentObjectId=b?b.objectId:null,a.materialId=f,a.geometryId=d,a.morphId=e,a.transformId=g,a.tags=a.tags||[],a.capColor=j("capColor",a,b),a.modelId=a.objectId.split("-")[0];var h=Human.scene.createObject(a);return void 0!==a.opacity&&h.setOpacity(a.opacity),void 0!==a.shown&&h.show(a.shown),h}function b(a,d,e,f){var g=d.shift();c(a,g,function(){if(f){for(var c={},h=0,i=g.length;i>h;h++)c[g[h]]=!0;f(c,e,!d.length)}d.length&&b(a,d,e+1,f)})}function c(a,b,c){function d(){0===--f&&c&&c()}var e,f=a.length;if(0===f)return void(c&&Human.utils.async(c));for(var g=0,h=f;h>g;g++)e=a[g],n.attachAssetsToObject(e,b,d)}function d(a){s.geometryId&&a.detachAsset("geometry"),s.materialId&&a.detachAsset("material"),s.transformId&&a.detachAsset("transform"),s.morphId&&a.detachAsset("morph")}function e(a,b,c){for(var d=0,e=b.length;e>d;d++){var f,g=b[d];if("transform"===g){var h=a.transformId;h&&!a.transformInitialized&&(c.transform=c.transform||{},f=c.transform[h]=c.transform[h]||[],f.push(a))}else if(a.renderables)for(var i=0,j=a.renderables.length;j>i;++i){var k=a.renderables[i],l=k[g+"Id"],m=k[g+"Attached"];l&&!m&&(c[g]=c[g]||{},f=c[g][l]=c[g][l]||[],f.push(k))}}return c}function f(){Human.events.fire("graph.assetAttach.start")}function g(a,b,c,d){q++,Human.events.fire("graph.assetAttach.progress",{assetId:a,targetObjects:c,assetType:b,nullAsset:d}),o[b]||(o[b]=[]),d||o[b].push(a),p===q&&h()}function h(){Human.events.fire("graph.assetAttach.finish",o),o={},p=0,q=0}function i(a,b,c,d){0===p&&f(),p++,Human.assets.getAsset(a,b,function(e){if(e)for(var f=0,h=c.length;h>f;f++)if("transform"===b){var i=c[f];Human.scene.objects[i.objectId]&&i.setTransform(e)}else{var j=c[f];j.attachAsset(b,e)}g(a,b,c,!e),d(e)})}function j(a,b,c){return c?void 0!==b[a]&&null!==b[a]?b[a]:c[a]:b[a]}function k(a){if(a.objects&&a.objectId){for(var b,c=0,d=a.objects.length;d>c;++c)if(!a.objects[c].objectId){b=[];break}b&&l(a)&&(a.anonymousIdToRenderableIndex={},m(a,b,a),a.renderables=b,a.objects.length=0)}}function l(a){if(!a.objects)return!0;for(var b=0,c=a.objects.length;c>b;++b){var d=a.objects[b];if(d.transformId||d.objectId||d.pivot||d.translate||d.scale||d.rotate||!l(d))return!1}return!0}function m(a,b,c){if(a.objects)for(var d=0,e=a.objects.length;e>d;++d){var f=a.objects[d];void 0===f.layer&&(f.layer=a.layer),f.geometryId?(c.anonymousIdToRenderableIndex[c.objectId+r++]=b.length,b.push({geometryId:f.geometryId,materialId:f.materialId,morphId:f.morphId,layer:f.layer})):(r++,m(f,b,c,c.objectId))}}var n=Human.scene.graph={},o={},p=0,q=0,r=0,s={};n.buildGraph=function(b,c){if(b){c||(r=0);for(var d,e,f=0;f<b.length;f++)d=b[f],k(d),d.objectId||(d.objectId=c.objectId+r++,d.anonymous=!0),d.group=d.objects&&d.objects.length>0,e=a(d,c),null!==e&&d.objects&&n.buildGraph(d.objects,e)}},n.gatherAssetIdsFromObject=function(a,b,c){Array.isArray(a)||(a=[a]),b=b||["geometry","material","transform","morph"],c=c||{};for(var d=0,f=a.length;f>d;d++)e(a[d],b,c);return c},n.attachAssetsToObject=function(a,b,c){function d(){0===--e&&c&&c()}"function"==typeof b&&(c=b,b=null),Array.isArray(a)||(a=[a]),b=b||["geometry","material","transform","morph"];for(var e=0,f=0,g=a.length;g>f;f++){var h=n.gatherAssetIdsFromObject(a[f],b);e++,n.attachAssets(h,d)}},n.attachAssetSetsToSubtree=function(a,c,d){function e(a){k[a.objectId]=a}function f(a){i[a.objectId]||(j.push(a),i[a.objectId]=!0)}"function"==typeof c&&(d=c,c=null),Array.isArray(a)||(a=[a]),c=c||[["geometry","material","transform"],["morph"]];for(var g,h,i={},j=[],k={},l=0;l<a.length;l++)a[l].getLeafObjects(e);for(g in k)k.hasOwnProperty(g)&&(h=k[g],h&&h.traverseUp(f));b(j,c,0,d)},n.attachAssets=function(a,b){function c(){0===--d&&b&&b()}var d=0,e=Object.keys(a);if(0===e.length)return void(b&&Human.utils.async(b));for(var f=0,g=e.length;g>f;f++){var h=e[f],j=a[h];if(j)for(var k in j)if(j.hasOwnProperty(k)){var l=j[k];d++,i(k,h,l,c)}}},n.destroySubtree=function(a){Array.isArray(a)||(a=[a]);var b,c,d;for(b=0,c=a.length;c>b;b++)d=a[b],Human.scene.destroyObject(d.objectId)},n.unloadSubtree=function(a,b,c){Array.isArray(a)||(a=[a]);var e,f,g;for(s={},b.indexOf("geometries")>=0&&(s.geometryId=!0),b.indexOf("transforms")>=0&&(s.transformId=!0),b.indexOf("morphs")>=0&&(s.morphId=!0),b.indexOf("materials")>=0&&(s.materialId=!0),b.indexOf("morph")>=0&&(s.morphId=!0),e=0,f=a.length;f>e;e++)g=a[e],g.getLeafObjects(d);c&&c()}}(),function(){"use strict";function a(){var a=f+e;return e++,a}function b(a,b){i[a]?i[a].push(b):i[a]=[b],j=!0}function c(){var a,b,c,d,e=0;for(a in i)if(++e,d=i[a],b=Human.scene.objects[a],b&&b.isVisible()){for(c=0;c<d.length;c++)d[c].build();delete i[a],--e}j=e>0}var d=Human.scene.markers={},e=0,f="marker_",g=2,h=0;d.markers={};var i={},j=!1,k=vec3.fromValues(.33,.33,.33),l=vec3.create(),m=vec3.create(),n=mat4.create(),o=vec3.create(),p=function(c){var d=this;if(d.id=c.id||a(),d.pos=vec3.create(),this.viewPos=vec3.create(),d.dir=vec3.create(),c.pos&&(d.pos[0]=c.pos[0],d.pos[1]=c.pos[1],d.pos[2]=c.pos[2]),c.dir&&(d.dir[0]=c.dir[0],d.dir[1]=c.dir[1],d.dir[2]=c.dir[2],vec3.normalize(d.dir,d.dir)),d.viewAngle=0,d.canvasPos=vec2.fromValues(0,0),d.built=!1,d.occluded=!1,d.objectCentered=!1,d.renderableIndex=-1,d.primitiveIndex=-1,d.barycentric=null,c.objectId&&Human.scene.objects[c.objectId]){if(d.object=Human.scene.objects[c.objectId],d.modelPos=vec3.create(),void 0!==c.primitiveIndex){d.renderableIndex=void 0!==c.renderableIndex?c.renderableIndex:0,d.primitiveIndex=c.primitiveIndex;var e=c.barycentric||k;d.barycentric=vec3.fromValues(e[0],e[1],e[2])}else c.pos||(d.objectCentered=!0);d.object.isRenderable()?d.build():b(c.objectId,d)}else{if(!c.pos)return void Human.log.error("Human.scene.marker","marker configuration requires 'objectId' or 'pos' parameter.");d.build()}};p.prototype.build=function(){var a=this;if(!a.built){if(-1!==a.primitiveIndex)a.object.barycentricToModelSpace(a.renderableIndex,a.primitiveIndex,a.barycentric,a.modelPos),vec3.transformMat4(a.pos,a.modelPos,a.object.getWorldMatrix());else if(a.object&&!a.objectCentered)mat4.invert(n,a.object.getWorldMatrix()),vec3.transformMat4(a.modelPos,a.pos,n);else if(a.objectCentered){var b=a.object.getCenter();a.pos[0]=b[0],a.pos[1]=b[1],a.pos[2]=b[2],mat4.invert(n,a.object.getWorldMatrix()),vec3.transformMat4(a.modelPos,a.pos,n)}a.updatePosition(),a.updateViewAngle(),a.updateOcclusion(),a.built=!0}},p.prototype.updatePosition=function(){var a=this;-1!==a.primitiveIndex&&a.object.barycentricToModelSpace(a.renderableIndex,a.primitiveIndex,a.barycentric,a.modelPos),a.modelPos&&vec3.transformMat4(a.pos,a.modelPos,a.object.getWorldMatrix()),vec3.transformMat4(a.viewPos,a.pos,Human.renderer.getViewMat()),Human.renderer.worldPositionToCanvas(a.pos,a.canvasPos)},p.prototype.updateViewAngle=function(){if(this.objectCentered)return void(this.viewAngle=0);var a=Human.renderer.camera.eye;o.set([a.x,a.y,a.z]),vec3.subtract(l,o,this.pos),vec3.normalize(l,l);var b=Math.min(vec3.dot(l,this.dir),1);this.viewAngle=57.2957795*Math.acos(b)},p.prototype.updateOcclusion=function(){this.occluded=this.isOccludedByObject()||this.isOffScreen()},p.prototype.isOccludedByObject=function(){if(this.objectCentered)return!1;var a,b,c,d,e;return a=Human.renderer.camera.eye,l[0]=a.x,l[1]=a.y,l[2]=a.z,vec3.sub(m,this.pos,l),b=vec3.length(m),c=Math.min(.1*b,.5),d=1/b,m[0]*=d,m[1]*=d,m[2]*=d,e=Human.math.intersections.rayScene(l,m,function(a){return a.shown&&!a.culled},function(a){return!a.isTransparent()}),!!(e&&e.length&&e[0].t+c<b)},p.prototype.isOffScreen=function(){var a=this.canvasPos,b=Human.renderer.canvas.width,c=Human.renderer.canvas.height;return a[0]<0||a[0]>b||a[1]<0||a[1]>c},d.create=function(a){var b=new p(a);return d.markers[b.id]=b,Human.events.fire("scene.markers.added",{id:b.id}),b.built&&Human.events.fire("scene.markers.built",{id:[b.id]}),b},d["delete"]=function(a){delete d.markers[a],Human.events.fire("scene.markers.deleted",{id:a})},d.buildByObjectId=function(a){var b=[];if(i[a]){var c,d;for(c=0;c<i[a].length;c++)d=i[a][c],d.build(),b.push(d.id);delete i[a]}Human.events.fire("scene.markers.built",{id:b})},d.onFrame=function(){h=(h+1)%g,j&&c();var a,b=0;for(var e in d.markers)a=d.markers[e],a&&a.built&&(a.updatePosition(),a.updateViewAngle(),0===h&&a.updateOcclusion(),++b);b>0&&Human.events.fire("scene.markers.updated")}}(),function(){"use strict";function a(a){var b=a.channels,c=a.mods,d=a.fresnelChannels,l=a.fresnelMods,m=[],n=[],o=0;if(void 0!==b&&null!==b&&(b&g&&m.push({applyTo:"tintColor",value:c.slice(o,o+=3)}),b&h&&m.push({applyTo:"saturation",value:c.slice(o,o+=1)[0]}),b&i&&m.push({applyTo:"contrast",value:c.slice(o,o+=1)[0]}),b&j&&m.push({applyTo:"brightness",value:c.slice(o,o+=1)[0]}),b&k&&n.push({applyTo:"opacity",value:c.slice(o,o+=1)[0]})),o=0,void 0!==d&&null!==d){if(d&g){var p=l.slice(o,o+=9);m.push({applyTo:"tintColor",value:new e([p[0],p[1],p[2]],[p[3],p[4],p[5]],p[6],p[7],p[8])})}if(d&h){var q=l.slice(o,o+=5);m.push({applyTo:"saturation",value:new f(q[0],q[1],q[2],q[3],q[4])})}if(d&i){var r=l.slice(o,o+=5);m.push({applyTo:"contrast",value:new f(r[0],r[1],r[2],r[3],r[4])})}if(d&j){var s=l.slice(o,o+=5);m.push({applyTo:"brightness",value:new f(s[0],s[1],s[2],s[3],s[4])})}if(d&k){var t=l.slice(o,o+=5);n.push({applyTo:"opacity",value:new f(t[0],t[1],t[2],t[3],t[4])})}}return{colorMods:m,opacityMods:n}}function b(a){var b=0,c=[];return a.colorMods.forEach(function(a){"tintColor"===a.applyTo?(b+=g,a.value.forEach(function(a){c.push(a)})):"saturation"===a.applyTo?(b+=h,c.push(a.value[0])):"contrast"===a.applyTo?(b+=i,c.push(a.value[0])):"brightness"===a.applyTo&&(b+=j,c.push(a.value[0]))}),a.opacityMods.forEach(function(a){"opacity"===a.applyTo&&(b+=k,c.push(a.value[0]))}),{channels:b,mods:c}}function c(a,b){return a+"_"+b}var d=Human.scene.colorRecipes={},e=window.ColorFresnel,f=window.ScalarFresnel,g=16,h=8,i=4,j=2,k=1,l={};d.createConfigFromMods=function(a){return b(a)},d.getRecipes=function(){return Object.keys(l)},d.getRecipeMods=function(a){return l.hasOwnProperty(a)?Human.utils.shallowClone(l[a]):void Human.log.error("Human.scene.color-recipes","No such color recipe : "+a)},d.registerRecipe=function(b,c){return l.hasOwnProperty(b)?void Human.log.error("Human.scene.color-recipes","Color mod recipe already exists : "+b):void(l[b]=a(c))},d.clearRecipes=function(){l={}},d.removeRecipe=function(a){delete l[a]},d.setObjectRecipe=function(a,b,d){var e,f,g,h=Human.scene.objects[a],i=l[b];if(h&&i){for(e=0;e<i.colorMods.length;e++)f=i.colorMods[e],g=c(b,f.applyTo),h.setColorModifier(g,d?f:null);for(e=0;e<i.opacityMods.length;e++)f=i.opacityMods[e],g=c(b,f.applyTo),d?h.setOpacityModifier(g,f):!d&&h.opacityModifiers[g]&&h.setOpacityModifier(g,null);

}},d.hasTarget=function(a,b){var c=Human.scene.objects[b],d=l[a];if(c&&d){var e=Object.keys(c.colorModifiers).reduce(function(b,c){return b||c.startsWith(a)},!1);return Object.keys(c.opacityModifiers).reduce(function(b,c){return b||c.startsWith(a)},e)}},d.serializeRecipe=function(a){var c=d.getRecipeMods(a);return b(c)}}(),function(){"use strict";var a=Human.timeline={objectVisibilityUpdates:{}};a.animations={},a.leafTimelines={},a.branchTimelines={},a.rootTimelines={},a.activeRoot=null,a.FRAME_LENGTH=.033,a.TIME_CONSTANT=.001,a.borderConditions={start:{which:"second",direction:a.direction},middle:{which:"both",direction:a.direction},end:{which:"first",direction:a.direction}},a.playing=!1,a.playfree=!0,a._lastWorldTime=0,a._time1=0,a._time2=0,a._freeTime=0,a.time=0,a.playQueue=[],a.loop=!1,a.scale=1,a.direction="forwards",a._playParams=null,a._scrubParams=null,a.chapters={};var b,c,d,e,f;a.addAnimation=function(b,c){return c.update?(a.animations[b]&&a.removeAnimation(b),a.animations[b]=c,void Human.events.fire("Timeline.Loaded")):void Human.log.error("Human.timeline.addAnimation","Param expected: update")},a.removeAnimation=function(b){var c=a.animations[b];return c?(delete a.animations[b],c.destroy&&c.destroy(),void(Human.utils.isEmpty(a.animations)&&Human.events.fire("Timeline.Empty"))):void Human.log.warn("Human.timeline.removeAnimation","Animation not found: "+b)};var g=function(){return"forwards"===a.direction?a._time2:a._time1},h=function(){return"forwards"===a.direction?a._time1:a._time2},i=function(){var b=g();return a.time===b?!0:!1},j=function(){var b=h();return a.time===b?!0:!1},k=function(b){var c={},d="backwards"===b?-1:1,e=["forwards","backwards"];return e.indexOf(b)<0?(Human.log.warn("timeline.setBorderConditions","invalid direction :"+b),null):(c.start={which:"second",direction:b},c.middle={which:"both",direction:b},c.end={which:"first",direction:b},a.direction=b,a.borderConditions=c,void(a.scale=d*Math.abs(a.scale)))};a.initTransparencies=function(){Human.log.error("timeline.initTransparencies() is deprecated and no longer required for loading")},a.onFrame=function(){if(b=a.activeRoot,null!==b&&void 0!==b){if(c=(new Date).getTime(),d=(c-a._lastWorldTime)*a.TIME_CONSTANT,e=d/a.FRAME_LENGTH,a._lastWorldTime=c,a.time>a._time2?a.time=a._time2:a.time<a._time1&&(a.time=a._time1),a.playfree&&(b.updateFreeAnimations(a._freeTime),a._freeTime+=a.scale*e*a.FRAME_LENGTH),a.playing){f=a.borderConditions.middle;var g=!0;i()?a.loop===!0?(f=a.borderConditions.start,a.time=h()):(f=a.borderConditions.end,g=!1):j()&&(f=a.borderConditions.start),b.update(a.time,f),g?(a.playing=!0,Human.events.fire("timeline.playing",{time:a.time}),a.time+=a.scale*e*a.FRAME_LENGTH):(Human.events.fire("timeline.completed"),a.playing=!1,Human.events.fire("timeline.stopped",{time:a.time}))}Human.renderer.camera.fly.onFrame(),Human.utils.isEmpty(a.objectVisibilityUpdates)||(Human.scene.setEnabledObjects({objectIds:a.objectVisibilityUpdates,replace:!1}),a.objectVisibilityUpdates={})}},Human.events.on("timeline.stopped",function(){if(a.playQueue.shift(),a.playQueue.length>0){var b=a.playQueue[0];a._play(b)}else Human.events.fire("timeline.paused",{time:Human.timeline.time})}),a.parsePlayInstruction=function(b){b=b||{};var c=b.root||a.activeRoot,d="forwards";c.getTimeFrame();var e,f,g,h,i,j,k=null,m=null,n=null,o=b.hasOwnProperty("align")?b.align:!0,p=["nextChapter","prevChapter","startChapterId","startTime"],q=["nextChapter","prevChapter","finishChapterId","finishTime","numChapters"],r=null,s=!1;switch(a._playParams=b,e=l(p,b)[0]||"default",f=l(q,b)[0]||"default",e){case"nextChapter":h=0,g=c.getNeighborChapter(c._nowBranch,"next");break;case"prevChapter":h=0,g=c.getNeighborChapter(c._nowBranch,"previous");break;case"startChapterId":if(h=0,g=c.getBranch({id:b.startChapterId}),Human.utils.isEmpty(g))return void Human.log.warn("timeline.play","Invalid chapter id: "+b.startChapterId);break;case"startTime":r=c.mapGlobalTime(b.startTime,{tie:"later"}),g=r.branch,h=r.time;break;case"default":g=c._chapters[0],h=0}switch(f){case"nextChapter":i=g,j=i.getTimeFrame().lastTime;break;case"prevChapter":i=g,j=i.getTimeFrame().lastTime;break;case"finishChapterId":if(i=c.getBranch({id:b.finishChapterId}),Human.utils.isEmpty(i))return void Human.log.warn("timeline.play","Invalid chapter id: "+b.finishChapterId);j=i.getTimeFrame().lastTime;break;case"finishTime":if(0===b.finishTime)i=c._chapters[0],j=0;else{var t={tie:"earlier"};r=c.mapGlobalTime(b.finishTime,t),i=r.branch,j=r.time}break;case"numChapters":var u=c.whereIsBranch(g,{chapters:!0}),v=c._chapters.length-u,w=b.numChapters||1;w=Math.min(w,v),i=c._chapters[u+w-1],j=i.getTimeFrame().lastTime;break;case"default":i=c._chapters[c._chapters.length-1],j="end"}if(k=c.mapBranchTime(g,h),m=c.mapBranchTime(i,j),m>=k?(d="forwards",n=k):(r=k,k=m,m=r,n=m,d="backwards"),o&&("forwards"===d?(k=c.mapBranchTime(g,0),m=c.mapBranchTime(i,"end")):"backwards"===d&&(k=c.mapBranchTime(i,0),m=c.mapBranchTime(g,"end"))),b.hasOwnProperty("loop"))s=b.loop;else{var x=["startChapterId","nextChapter","prevChapter"],y=["numChapters","nextChapter","finishChapterId"];x.indexOf(e)>=0&&y.indexOf(f)>=0&&g.id===i.id&&(s=g.animation.loop)}return{t:n,t1:k,t2:m,loop:s,direction:d}},a.play=function(b){b=b||{},b.queue&&a.playing?a.playQueue.push(b):(a.playQueue=[b],a._play(b))},a._play=function(b){var c=a.parsePlayInstruction(b||{});a._time1=c.t1,a._time2=c.t2,a.time=c.t,a.loop=c.loop,k(c.direction),a.playing=!0,a._lastWorldTime=(new Date).getTime(),Human.events.fire("timeline.played",{time:a.time})};var l=function(a,b){var c=Object.keys(b),d=function(a){return c.indexOf(a)>=0};return a.filter(d)};a.stop=function(){a.playing=!1,a.playQueue=[],Human.events.fire("timeline.stopped",{time:a.time})},a.scrub=function(b){var c,d=a.activeRoot,e=0,f={which:"first",direction:"forwards"};if(a.playQueue=[],a._scrubParams=b,b.hasOwnProperty("time"))e=b.time;else if(b.hasOwnProperty("chapterId")){var g=d.getBranch({id:b.chapterId});g?(e=d.mapBranchTime(g,0),f={which:"second",direction:"forwards"}):e=a.time}else e=a.time;if(b.hasOwnProperty("borderCondition")){var h=b.borderCondition,i=["first","both","second"],j=["forwards","backwards"];i.indexOf(h.which)>=0&&(f.which=h.which),j.indexOf(h.direction)>=0&&(f.direction=h.direction)}0===e?f={which:"second",direction:"forwards"}:e===d.getTimeFrame.lastTime&&(f={which:"first",direction:"forwards"}),(e<a._time1||e>a._time2)&&(c=d.mapGlobalTime(e,f),a._time1=d.mapBranchTime(c.branch,0),a._time2=d.mapBranchTime(c.branch,"end")),a.playing=!1,a.time=e,d.update(e,f),Human.events.fire("timeline.scrubbed",{time:a.time})},a.next=function(){var b=a.activeRoot,c=Human.properties.properties["timeline.prevNextMode"],d=b._nowBranch,e=b.getNeighborChapter(d,"next");if(b.isLast(d))return void Human.log.warn("timeline.next","can't proceed beyond last chapter");var f=b.mapBranchTime(d,"end")+.001;if("play"===c){var g;g=e.animation.loop?{startTime:b.mapBranchTime(e,0),align:!0,finishTime:b.mapBranchTime(e,"end"),loop:e.animation.loop,queue:!1}:{startTime:a.time,align:!1,finishTime:f,loop:!1,queue:!1},a.play(g)}else a.scrub({time:f})},a.prev=function(){var b=a.activeRoot,c=Human.properties.properties["timeline.prevNextMode"],d=b._nowBranch;if(b.isFirst(d))return void Human.log.warn("timeline.next","can't go to chapter before first chapter");var e,f=b.getNeighborChapter(d,"previous"),g=b.mapBranchTime(f,"start")+.001;"play"===c?(e=d.animation.loop?{startTime:b.mapBranchTime(f,"start"),align:!0,finishTime:b.mapBranchTime(f,"end"),loop:f.animation.loop,queue:!1}:{startTime:b.mapBranchTime(f,"end"),align:!1,finishTime:b.mapBranchTime(f,"start"),loop:!1,queue:!1},a.play(e)):a.scrub({time:g})},a.getBookmark=function(){var b={};return Human.timeline.activeRoot&&(b.rootName=Human.timeline.activeRoot.id),a.playing?(b.play=a._playParams,b.play.root&&delete b.play.root):b.scrub=a._scrubParams,b},a.setBookmark=function(b){if(b.rootName&&a.rootTimelines.hasOwnProperty(b.rootName))a.activeRoot=a.rootTimelines[b.rootName];else if(b.modules&&b.modules.activeModules){var c=b.modules.activeModules;c=c.filter(function(a){return Human.timeline.rootTimelines.hasOwnProperty(a)}),c.length>1&&(c=c.filter(function(a){return!Human.modules.isBaseModule(a)}));var d=c[0];Human.timeline.activeRoot=Human.timeline.rootTimelines[d]}else Human.log.warn("Human.timeline.setBookmark: Unable to set appropriate root timeline")},a.pause=function(){a.playing=!1,Human.events.fire("timeline.paused",{time:a.time})},a.unpause=function(){var b={startTime:a.time,numChapters:1,loop:a.activeRoot._nowBranch.animation.loop};a.play(b),Human.events.fire("timeline.unpaused",{time:a.time})},a.playFreeAnimations=function(){a.playfree=!0},a.pauseFreeAnimations=function(){a.playfree=!1},a.getTimeFrame=function(){return Human.utils.isEmpty(a.activeRoot)?0:a.activeRoot.getTimeFrame()},a.getCurrentChapterCamera=function(){return Human.timeline.activeRoot._nowBranch.getCamera(0)},a._convertPlayParams=function(a){var b=a;return a.hasOwnProperty("endTime")&&(b.finishTime=b.endTime),a.hasOwnProperty("endChapterId")&&(b.finishChapterId=a.endChapterId),b},a.query=function(){if(!a.activeRoot)return{};var b=a.activeRoot._assembleQueryChapters();return{chapters:b,time:a.time,timeFrame:a.getTimeFrame(),playing:a.playing,paused:!a.playing}},a.destroyChapterSet=function(b){if(a.stop(),a.rootTimelines.hasOwnProperty(b))a.rootTimelines[b].destroy();else if(b)for(var c in a.rootTimelines)a.rootTimelines.hasOwnProperty(c)&&(Human.modules.isBaseModule(c)||a.rootTimelines[c].destroy());else Human.log.warn("timeline.destoryChapterSet","Invalid argument: "+b)},Human.events.on("timeline.chapters.updated",function(b){var c,d=0;if(a.chapters={},null!==a.activeRoot)for(d=0;d<b.length;d++)c=a.activeRoot._chapters[d].id,a.chapters[c]=b[d]})}(),function(){"use strict";Human.timeline.TweenAnimation=function(a){this._options=a.options||{},this._tweens=a.tweens,this.timeline=a.timeline,this.firstTime=1e6,this.lastTime=-1e6;for(var b,c=0,d=this._tweens.length;d>c;c++)b=this._tweens[c],b.firstTime<this.firstTime&&(this.firstTime=b.firstTime),b.lastTime>this.lastTime&&(this.lastTime=b.lastTime)},Human.timeline.TweenAnimation.prototype.update=function(a,b){for(var c=0,d=this._tweens.length;d>c;c++)this._tweens[c].update(a,b)},Human.timeline.TweenAnimation.prototype.destroy=function(){for(var a,b=0,c=this._tweens.length;c>b;b++)a=this._tweens[b],a.destroy&&a.destroy()}}(),function(){"use strict";function a(a){for(var b in a)if(a.hasOwnProperty(b)&&!Human.utils.isObject(a[b]))return!1;return!0}Human.timeline.Tween=function(b){this._control=b.control,this._tweenList=[];for(var c,d,e,f,g,h,i={},j=0,k=b.targets.length;k>j;j++){c=b.targets[j],d=b.keys[j],Human.utils.isObject(c.attr)&&a(c.attr)&&(c=c.attr),e=c;for(var l in e)e.hasOwnProperty(l)&&(f=e[l],g=i[l],g||(h=this._control.attr[l],g=new Human.timeline.TweenAttr(h,b.options),i[l]=g,this._tweenList.push(g)),g.addTarget(d,f))}this.firstTime=b.keys[0],this.lastTime=b.keys[b.keys.length-1]},Human.timeline.Tween.prototype._run=function(a,b){for(var c=0,d=this._tweenList,e=0,f=d.length;f>e;e++)d[e].update(a,b)&&c++;return c},Human.timeline.Tween.prototype.query=function(a,b){return this._run(a,b),this._control.attr},Human.timeline.Tween.prototype.update=function(a,b){this._run(a,b)>0&&this._control.update(a)}}(),function(){"use strict";function a(a,b,c,d){"number"!=typeof c&&(c=c.value);var e=a.controlPoints,f=Math.floor(50*(b-d));a.bezier=new Human.math.bezier(d,c,e.x[0],e.y[0],e.x[1],e.y[1],b,a.value),a.lookUp=a.bezier.getLUT(f)}function b(a,b,c,d,e){var f=(a-b)/(c-b),g=e-d,h=f*g;return d+h}function c(a,c){var d,e,f,g=c.lookUp,h=0,i=g.length-1;if(a<=g[h].x)return g[h].y;if(a>=g[i].x)return g[i].y;for(;i>=h;){if(d=Math.floor((h+i)/2),e=g[d],f=g[d+1],e.x<=a&&f.x>=a)return b(a,e.x,f.x,e.y,f.y);e.x>a?i=d-1:h=d+1}}Human.timeline.TweenAttr=function(a,b){this.attr=a,this.attrNames=null,b=b||{},this.keys=[],this.attrTargetLists={},this._tweens=[],this._key1=0,this._key2=1,this._firstKey=null,this._lastKey=null,this._keyDiff=null,this._loop=!!b.loop,this._timeOffset=b.timeOffset||0,this._paddingDirty=!0},Human.timeline.TweenAttr.prototype.addTarget=function(b,c){b+=this._timeOffset,this.keys.push(b);var d,e,f,g,h,i=this.keys.length-1;for(var j in c)if(c.hasOwnProperty(j)){if(d=this.attrTargetLists[j],!d){if(this.keys.length>1)throw"First target in tween must contain a value for each animated attribute on target";d=this.attrTargetLists[j]=[]}if(f=c[j],d[i]=f,"number"!=typeof f&&a(f,b,d[i-1],this.keys[i-1]),i>0)for(e=!1,g=i-1;!e&&g>=0;)h=d[g],void 0===h&&null===h?(d[g]=f,g--):e=!0}(null===this._firstKey||this._firstKey>b)&&(this._firstKey=b),(null===this._lastKey||this._lastKey<b)&&(this._lastKey=b),this._keyDiff=this._lastKey-this._firstKey,this._paddingDirty=!1},Human.timeline.TweenAttr.prototype._padTargets=function(){var a,b,c,d=this.attrTargetLists,e=this.keys.length;for(a in d)if(d.hasOwnProperty(a)){if(b=d[a],b.length===e)continue;for(c=b[b.length-1];b.length<e;)b.push(c)}this._paddingDirty=!1},Human.timeline.TweenAttr.prototype.update=function(a,d){this._paddingDirty&&this._padTargets();var e=this.keys,f=this.attrNames?this.attrNames:this.attrNames=Object.keys(this.attrTargetLists);if(this._loop)d=this._firstKey+d%this._keyDiff;else{if(d<e[0])return this._key1=0,this._key2=1,this._clampToTarget(f,0),!0;if(d>e[e.length-1])return this._key1=e.length-2,this._key2=this._key1+1,this._clampToTarget(f,this.keys.length-1),!0}for(;e[this._key1]>d;)this._key1--,this._key2--;for(;e[this._key2]<d;)this._key1++,this._key2++;var g,h,i,j,k,l,m=this.attrTargetLists,n=this._key1,o=this._key2,p=this.attr,q=!1;for(j=0,k=f.length;k>j;j++)l=f[j],g=m[l],h=g[n],"number"!=typeof h&&(h=h.value),i="number"==typeof g[o]?b(d,e[n],e[o],h,g[o]):c(d,g[o]),p[l]=i,q=!0;return q},Human.timeline.TweenAttr.prototype._clampToTarget=function(a,b){var c,d,e,f,g=this.attr,h=this.attrTargetLists;for(d=0,e=a.length;e>d;d++)f=a[d],c=h[f][b],"number"!=typeof c&&(c=c.value),g[f]=c}}(),function(){"use strict";var a=1,b=2,c=3,d=4;Human.timeline.Switch=function(a){this._keys=a.keys,this._targets=a.targets,this._control=a.control,this._options=a.options||{},this._key=0,this._lastKey=null,this.firstTime=a.keys[0],this.lastTime=a.keys[a.keys.length-1]},Human.timeline.Switch.prototype.query=function(a,b){return this._findTarget(b),this._targets[this._key]},Human.timeline.Switch.prototype.update=function(d,e){var f=this._findTarget(e);switch(f){case a:return;case b:break;case c:}this._control.attr=this._targets[this._key],this._control.update(d),this._lastKey=this._key},Human.timeline.Switch.prototype._findTarget=function(e){if(e<this._keys[0])return this._key=0,a;if(e===this._keys[0])return this._key=0,b;if(e>this._keys[this._keys.length-1])return this._key=this._keys.length-1,c;for(;this._keys[this._key]>e;)this._key--;for(;void 0!==this._keys[this._key+1]&&null!==this._keys[this._key+1]&&this._keys[this._key+1]<e;)this._key++;return d}}(),function(){"use strict";Human.timeline.CameraControl=function(){this.attr={up:{x:0,y:1,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0}}},Human.timeline.CameraControl.prototype.update=function(a){return a.cameraEnabled!==!1?(Human.renderer.camera.setLookAt(this.attr),!0):void 0}}(),function(){"use strict";Human.timeline.MaterialControl=function(a){this._materialId=a.modelId+"/"+a.materialId,this.attr={},a.attributes.hasOwnProperty("attr")&&(a.attributes=a.attributes.attr);var b,c={r:0,g:0,b:0,a:1},d={r:1,g:1,b:1},e={r:0,g:0,b:0},f={"float":1};for(b in a.attributes)a.attributes.hasOwnProperty(b)&&("baseColor"===b?this.attr.baseColor=c:"specularColor"===b?this.attr.specularColor=d:"emitColor"===b?this.attr.emitColor=e:"alphaColor"===b&&(this.attr.alphaColor=f))},Human.timeline.MaterialControl.prototype.update=function(){var a=Human.assets.materials.materials[this._materialId];if(!a)return void(this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._targetMissing=!0));if(a.material){var b=a.material,c=this.attr;return c.baseColor&&b.setBaseColor(c.baseColor),c.specularColor&&b.setSpecularColor(c.specularColor),c.emitColor&&b.setEmitColor(c.emitColor),c.alphaColor&&b.setAlpha(c.alphaColor["float"]),!0}}}(),function(){"use strict";function a(d,e,f){var g=e.attr,h=e.tnt,i=e.cst,j=e.sat,k=e.brt,l=e.o;if(g&&(void 0!==g.pickable&&d.setPickable(g.pickable),void 0!==g.opacity&&d.setOpacity(g.opacity),void 0!==g.shown&&(Human.timeline.objectVisibilityUpdates[d.objectId]=g.shown)),l&&void 0!==l.val&&(c.value=l.val,void 0!==l.x&&(c.range={center:[l.x,l.y,l.z],minRadius:l.rmin,maxRadius:l.rmax}),d.setOpacityModifier("__OPACITY_TWEEN_"+f,c)),h&&void 0!==h.r&&(b.applyTo="tintColor",b.value=[h.r,h.g,h.b],void 0!==h.x&&(b.range={center:[h.x,h.y,h.z],minRadius:h.rmin,maxRadius:h.rmax}),d.setColorModifier("__TINT_COLOR_TWEEN_"+f,b)),i&&void 0!==i.val&&(b.applyTo="contrast",b.value=i.val,void 0!==i.x&&(b.range={center:[i.x,i.y,i.z],minRadius:i.rmin,maxRadius:i.rmax}),d.setColorModifier("_CONTRAST_TWEEN_"+f,b)),j&&void 0!==j.val&&(b.applyTo="saturation",b.value=j.val,void 0!==j.x&&(b.range={center:[j.x,j.y,j.z],minRadius:j.rmin,maxRadius:j.rmax}),d.setColorModifier("__SATURATION_TWEEN_"+f,b)),k&&void 0!==k.val&&(b.applyTo="brightness",b.value=k.val,void 0!==k.x&&(b.range={center:[k.x,k.y,k.z],minRadius:k.rmin,maxRadius:k.rmax}),d.setColorModifier("__BRIGHTNESS_TWEEN_"+f,b)),d.objects.length>0)for(var m=d.objects,n=0,o=m.length;o>n;n++)a(m[n],e,f)}Human.timeline.ObjectControl=function(a){var b=null;b=a.objectId?[a.objectId]:a.objectIds;for(var c=0,d=b.length;d>c;++c){var e=b[c];e.indexOf(".")<0&&e.indexOf("-")<0&&(b[c]=a.modelId+"-"+e)}this._objectIds=b,this.id=a.id,this.attr={attr:{},tnt:{},cst:{},sat:{},brt:{},o:{}}},Human.timeline.ObjectControl.prototype.update=function(){for(var b=0,c=this._objectIds.length;c>b;++b){var d=this._objectIds[b],e=Human.scene.objects[d];if(!e)return void(this._targetMissing||(Human.log.warn("Human.timeline.TweenAnimation","'lerp:objectAttr' tween can't find object: "+d),this._targetMissing=!0));var f=Human.timeline.activeRoot._nowBranch.synchronization[d];f&&f.shown===!1||a(e,this.attr,this.id)}};var b={applyTo:null,value:0,range:null},c={value:0,range:null}}(),function(){"use strict";Human.timeline.ObjectTransformControl=function(a){var b=a.objectId,c=a.initial;b.indexOf(".")<0&&b.indexOf("-")<0&&(b=a.modelId+"-"+a.objectId),this._objectId=b;var d=this.attr={};["translate","rotate","scale","pivot"].forEach(function(a){var b="scale"===a?1:0;void 0!==c[a]&&(d[a]={},void 0!==c[a].x&&(d[a].x=b),void 0!==c[a].y&&(d[a].y=b),void 0!==c[a].z&&(d[a].z=b))})},Human.timeline.ObjectTransformControl.prototype.update=function(){var a=Human.scene.objects[this._objectId];if(!a)return void(this._targetMissing||(Human.log.warn("Human.timeline.ObjectTransformControl","Can't find object: "+this._objectId),this._targetMissing=!0));var b=!0;(void 0===b||null===b||b===!0)&&a.setTransform(this.attr)}}(),function(){"use strict";Human.timeline.TextureControl=function(a){return this._material=a.modelId+"/"+a.materialId,void 0===a.targetLayer||null===a.targetLayer?void Human.log.error("Human.timeline.TweenAnimation","'texture' tween attribute expected: 'targetLayer'"):(this._targetLayer=a.targetLayer,void(this.attr={rotate:{z:0},translate:{x:0,y:0},scale:{x:1,y:1},blend:{factor:1}}))},Human.timeline.TextureControl.prototype.update=function(){var a=Human.assets.materials.materials[this._material];if(!a)return void(this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._material),this._targetMissing=!0));var b=a.textures;if(this._targetLayer>=0&&this._targetLayer<b.length){var c=b[this._targetLayer],d=this.attr;d.scale&&c.setScale(d.scale),d.translate&&c.setTranslate(d.translate),void 0!==d.rotate&&null!==d.rotate&&c.setRotate(d.rotate.z),void 0!==d.blend&&null!==d.blend&&c.setBlendFactor(d.blend.factor)}}}(),function(){"use strict";Human.timeline.FresnelControl=function(a){this._materialId=a.modelId+"/"+a.materialId,this._fresnelType=a.fresnelType,"baseFresnel"===this._fresnelType&&(this._fresnelType="colorFresnel"),this.attr={bias:{edge:0,center:.7,power:1},edge:{r:.8,g:.7,b:.7},center:{r:.05,g:.05,b:.09}}},Human.timeline.FresnelControl.prototype.update=function(){if(!this._fresnel){var a=Human.assets.materials.materials[this._materialId];if(!a)return void(this._materialMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._materialMissing=!0));var b=this._fresnelType.length<=7?this._fresnelType:this._fresnelType.substring(0,this._fresnelType.length-7);if(this._fresnel=a.fresnels[b],!this._fresnel)return void(this._fresnelMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find fresnel type: "+this._fresnelType),this._fresnelMissing=!0))}var c=this.attr.bias;return this._fresnel.setEdgeBias(c.edge),this._fresnel.setCenterBias(c.center),this._fresnel.setPower(c.power),this._fresnel.setEdgeColor(this.attr.edge),this._fresnel.setCenterColor(this.attr.center),!0}}(),function(){"use strict";Human.timeline.tweenParticleLookup=function(a){var b=Human.timeline.activeRoot._nowBranch.id,c=Object.keys(Human.modules.moduleData),d=c[c.length-1],e=Human.modules.moduleData[d].tweenParticleLookup,f=void 0===e?a:e[b][a],g=Human.timeline.activeRoot._nowBranch.id+"/"+f,h=Human.particles.systems[f]||Human.particles.systems[g];return h}}(),function(){"use strict";Human.timeline.ParticleSystemControl=function(a){this.particleSystemId=a.particleSystemId,this.attr={attr:{}},this._targetMissing=!1},Human.timeline.ParticleSystemControl.prototype.update=function(){var a=Human.timeline.tweenParticleLookup(this.particleSystemId);if(!a)return void(this._targetMissing||(Human.log.warn("ParticleSystemControl: can't find system: ",this.particleSystemId),this._targetMissing=!0));var b=this.attr.attr;a.enabled&&b&&(void 0!==b.emissionAverage&&(a.emissionAverage=b.emissionAverage),void 0!==b.emissionVariance&&(a.emissionVariance=b.emissionVariance))}}(),function(){"use strict";var a=vec3.create(),b=vec3.create();Human.timeline.ParticleComponentControl=function(a){this.particleSystemId=a.particleSystemId,this.componentId=a.componentId,this.attr={attr:{},position:{},translate:{},scale:{},rotate:{},directionAverage:{},shapeTranslate:{},shapeScale:{},shapeRotate:{}},this._targetMissing=!1},Human.timeline.ParticleComponentControl.prototype.update=function(){var c=Human.timeline.tweenParticleLookup(this.particleSystemId);if(!c)return void(this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find system: ",this.particleSystemId),this._targetMissing=!0));var d=c.components[this.componentId];if(!d)return void(this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find component: "+this.componentId),this._targetMissing=!0));var e=d.shape;if(c.enabled){var f=this.attr.attr,g=this.attr.position,h=this.attr.translate,i=this.attr.scale,j=this.attr.rotate,k=this.attr.directionAverage,l=this.attr.shapeTranslate,m=this.attr.shapeRotate,n=this.attr.shapeScale;if(f&&(void 0!==f.average&&(d.average=f.average),void 0!==f.variance&&(d.variance=f.variance),void 0!==f.forceAverage&&(d.forceAverage=f.forceAverage),void 0!==f.forceVariance&&(d.forceVariance=f.forceVariance),void 0!==f.frequency&&(d.frequency=f.frequency),void 0!==f.friction&&(d.friction=1-f.friction),void 0!==f.radius&&(d.radius=f.radius),void 0!==f.directionVariance&&(d.directionVariance=f.directionVariance)),g&&void 0!==g.x&&(a[0]=g.x,a[1]=g.y,a[2]=g.z,d.position.set(a)),h&&void 0!==h.x&&(a[0]=h.x,a[1]=h.y,a[2]=h.z,d.translate.set(a)),(i||j)&&d.xform){var o=null,p=null;i&&void 0!==i.x&&(o=a,o[0]=i.x,o[1]=i.y,o[2]=i.z),j&&void 0!==j.x&&(p=b,p[0]=j.x,p[1]=j.y,p[2]=j.z),Human.math.buildRotationScaleMat3(d.xform,p,o)}k&&void 0!==k.x&&(a[0]=k.x,a[1]=k.y,a[2]=k.z,vec3.normalize(d.directionAverage,a)),e&&(l&&void 0!==l.x&&(a[0]=l.x,a[1]=l.y,a[2]=l.z,e.translate.set(a)),m&&void 0!==m.x&&(a[0]=m.x,a[1]=m.y,a[2]=m.z,e.rotate.set(a)),n&&void 0!==n.x&&(a[0]=n.x,a[1]=n.y,a[2]=n.z,e.scale.set(a)),e.updateXform())}}}(),function(){"use strict";var a=Human.timeline.LeafTimeline=function(a,b){var c=this;b=b||{},c.level="leaf",c.id=a,c.animations={},c.timelineAnimations={},c.freeAnimations={},c.cameraTween=null,c.animationCtx={cameraEnabled:!0},Human.timeline.leafTimelines[c.id]=c};a.prototype.addAnimation=function(a,b){var c=this;if(!b)return void Human.log.error("LeafTimeline.addAnimation","null or undefined animation object");if(!b.update)return void Human.log.error("LeafTimeline.addAnimation","Param expected: update");if(c.animations[a]&&c.removeAnimation(a),c.animations[a]=b,b.timeline===!1?c.freeAnimations[a]=b:c.timelineAnimations[a]=b,!c.cameraTween){var d,e,f,g=!1,h=b._tweens||[],i=Human.timeline.CameraControl;for(d=0,e=h.length;e>d&&!g;d++)f=h[d],f._control&&f._control instanceof i&&(g=!0,c.cameraTween=f)}Human.events.fire("Timeline.Loaded")},a.prototype.removeAnimation=function(a){var b=this,c=b.animations[a];return c?(a in b.freeAnimations?delete b.freeAnimations[a]:delete b.timelineAnimations[a],delete b.animations[a],void(c.destroy&&c.destroy())):void Human.log.warn("Human.timeline.LeafTimeline.removeAnimation","Animation not found: "+a)},a.prototype.getTimeFrame=function(){var a,b,c=this,d=!1,e=0,f=c.timelineAnimations;for(var g in f)f.hasOwnProperty(g)&&(d=!0,b=f[g].lastTime,e=Math.max(e,b));return a={firstTime:0,lastTime:e}},a.prototype.update=function(a,b,c){var d=this;c=c||{};var e,f={cameraEnabled:a===!1?a:d.animationCtx.cameraEnabled},g=d.timelineAnimations;for(var h in g)g.hasOwnProperty(h)&&(e=g[h],"lerp:camera"===e.type?e.update(b):e.update(f,b))},a.prototype.destroy=function(){var a=this;a.animations={},a.freeAnimations={},a.timelineAnimations={},a.cameraTween=null,delete Human.timeline.leafTimelines[a.id]},a.prototype.unload=function(a){var b,c=this,d="tweens"===a?Human.timeline.TweenAnimation:Human.assets.morphs.Animation;for(b in c.animations)c.animations.hasOwnProperty(b)&&c.animations[b]instanceof d&&(delete c.animations[b],Human.timeline.removeAnimation(b))},a.prototype.getCamera=function(a){var b=this;return null===b.cameraTween||void 0===b.cameraTween?null:b.cameraTween.query(b.cameraTween._control,a)}}(),function(){"use strict";var a=Human.timeline.BranchTimeline=function(a){var b=this;b._onEndOptions=["loop","freeze"],b.level="branch",b.timeRange=null,b.id=a.id,b.maps={},a.timelineMap.forEach(function(a,c){b.makeMapComponent(a,c)}),b.media={};for(var c in a.media)a.media.hasOwnProperty(c)&&b.addClip(c,a.media[c]);b.info={displayName:a.displayName||"",description:a.description||""},b.synchronization=a.synchronization,b.properties=a.properties||{},b.annotations=a.annotations||[],b.hotspots=a.hotspots||[],"alphaToCoverage"===a.transparencyMode&&(a.transparencyMode=null),b.transparencyMode=a.transparencyMode||"alpha","weightedOIT"!==b.transparencyMode||SceneJS.WEBGL_INFO.floatTexturesSupported||(b.transparencyMode=a.fallbackTransparency||"alpha"),b.viewModes=a.viewModes||{},b.options=a.options||{},a.hasOwnProperty("xray")&&(b.viewModes.xray=a.xray),b.camera={},a.camera?b.camera=a.camera:(a.jumpTo?(b.camera.action="jumpTo",b.camera.location=a.jumpTo,a.jumpTo.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.jumpTo.screenPan),a.jumpTo.hasOwnProperty("rotationCenter")&&(b.camera.rotationCenter=a.jumpTo.rotationCenter)):a.flyTo&&(b.camera.action="flyTo",b.camera.location=a.flyTo,a.flyTo.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.flyTo.screenPan),a.flyTo.hasOwnProperty("rotationCenter")&&(b.camera.rotationCenter=a.flyTo.rotationCenter)),a.options&&a.options.screenPan?b.camera.screenPan=a.options.screenPan:a.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.screenPan)),b.animation={loop:!1},a.loop&&(b.animation.loop=!0),b.background=a.background||{},b.clippingPlanes=a.clippingPlanes||{},b.effects=a.effects,b.ui=a.ui||{},b.lights=a.lights;var d=a.environment||a;d.reflectionMap&&d.reflectionMap.length>0&&(b.reflection=d.reflectionMap[0]),d.lightMap&&d.lightMap.length>0&&(b.lightmap=d.lightMap[0]),b.graph=a.graph||{},b.firstUpdate=!0,b.initializedCamera=!1,b.initializedAnnotations=!1,b.initializedProperties=!1,b.initializedGraph=!1,b.initializedHotspots=!1,b.initializedParticles=!1,b.initializedClippingPlanes=!1,b.initializedPostprocess=!1,b.initializedTransparencyMode=!1,b.customData=a.customData||{},b.particleSystems=b.customData.particleSystems||[],b.ssaa=!!b.customData.ssaa,b.postprocess=b.customData.postprocess||[],window.localContentOnly&&b.postprocess.push({effect:"fxaa"}),b.translations=b.translations||{},Human.timeline.branchTimelines[b.id]=b};a.prototype.addClip=function(a,b){var c=this;c.media.hasOwnProperty(a)&&delete c.media[a];var d={data:b,published:!1};d.publish=function(){Human.events.fire(b.streamType+".suggestedClipInfo",this.data),Human.events.fire(b.streamType+".suggestedClips",[this.data.clipId],!0),this.published=!0},d.update=function(a){this.data.time1<=a&&a<=this.data.time2&&(this.published||this.publish())},c.media[a]=d},a.prototype.makeMapComponent=function(a,b){var c=this,d={};if(d.mapId=a.data.timeline+"_"+b,d.start=a.start,d.end=a.end,d.data=a.data,Human.timeline.leafTimelines.hasOwnProperty(a.data.timeline))d.data.timeline=Human.timeline.leafTimelines[a.data.timeline];else{var e=new Human.timeline.LeafTimeline(a.data.timeline);d.data.timeline=e}var f,g;if(d.data.fit){var h=d.data.end-d.data.start,i=d.end-d.start;f=h/i,g=d.data.start,d.calcChildTime=function(a){return f*(a-d.start)+g}}else f=1,g=d.data.start,"freeze"===d.data.onEnd?d.calcChildTime=function(a){var b=f*(a-d.start)+g;return Math.min(b,d.data.end)}:"loop"===d.data.onEnd?d.calcChildTime=function(a){var b=d.data.end-d.data.start,c=a-d.start;return c-b*Math.floor(c/b)+g}:Human.log.warn("WARNING: invalid onEnd property for branch timeline map data.");c.maps[d.mapId]=d,c.timeRange=c.getTimeFrame()},a.prototype._getAudio=function(){var a=this,b=[];for(var c in a.media)a.media.hasOwnProperty(c)&&"audio"===a.media[c].data.streamType&&b.push(a.media[c].data);return b},a.prototype.getTimeFrame=function(){var a=this,b=0;for(var c in a.maps)a.maps.hasOwnProperty(c)&&a.maps[c].end>b&&(b=a.maps[c].end);0===b&&(b=2);var d={firstTime:0,lastTime:b};return d},a.prototype.getCamera=function(a){var b=this;"end"===a?a=b.getTimeFrame().lastTime:"start"===a&&(a=0);var c=b.getAnimatedCamera(a);if(c)return c.screenPan=c.screenPan||b.options.screenPan,c;if(!Human.utils.isEmpty(b.camera))return c=b.camera.location,c.screenPan=b.options.screenPan,c;var d=Human.renderer.camera._startcamera;return d.screenPan=b.options.screenPan,d},a.prototype.getAnimatedCamera=function(a){var b=this,c=b.getTimeFrame();"start"===a||a<c.startTime?a=c.startTime:("end"===a||"last"===a||a>c.lastTime)&&(a=c.lastTime);var d=b.whichCameraMap(0);if(null===d||void 0===d)return null;if(!(a>=d.start&&a<=d.end))return null;var e=d.data.timeline,f=d.calcChildTime(a),g=e.getCamera(f);return null!==g&&void 0!==g?g:void 0},a.prototype.whichCameraMap=function(a){var b,c=this,d=c.whichMaps(a);for(b=0;b<d.length;b++)if(d[b].map.data.timeline.cameraTween)return d[b].map;return null},a.prototype.reset=function(){var a=this;a.firstUpdate=!0,a.initializedGraph=!1,a.initializedCamera=!1,a.initializedHotspots=!1,a.initializedProperties=!1,a.initializedAnnotations=!1,a.initializedParticles=!1,a.initializedClippingPlanes=!1,a.initializedPostprocess=!1,a.initializedTransparencyMode=!1;var b,c,d=a.media;for(b in d)d.hasOwnProperty(b)&&(c=d[b],c.published=!1)},a.prototype.whichMaps=function(a){var b=this,c=[],d=[];"start"===a?a=0:"end"===a&&(a=b.getTimeFrame().lastTime);for(var e in b.maps)if(b.maps.hasOwnProperty(e)){var f=b.maps[e];a>=f.start&&a<=f.end&&c.push(e)}return c.every(function(a){var c=b.maps[a],e={map:c};return"leaf"===c.data.timeline.level?(e.camera=!0,d.push(e)):(e.camera=!1,
d.unshift(e)),!0}),d},a.prototype.getChildLeafTimelines=function(a){var b=this,c=b.whichMaps(a),d={};return c.every(function(b){var c=b.map.data.timeline.id,e=b.map.calcChildTime(a);return d[c]=e,!0}),d},a.prototype.getUniqueLeafTimelines=function(){var a=this,b={};for(var c in a.maps)if(a.maps.hasOwnProperty(c)){var d=a.maps[c];b[d.data.timeline.id]=d.data.timeline}return b},a.prototype.initCamera=function(a,b){var c=this,d=c.whichCameraMap(a);d||c.camera.ignore?d?"flyTo"===c.camera.action?Human.renderer.camera.fly.flyTo(c.getCamera(a),function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):Human.renderer.camera.fly.jumpTo(c.getCamera(a),function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):b&&b():(c.camera.screenPan&&Human.renderer.camera.setScreenPan(c.camera.screenPan),"flyTo"===c.camera.action?Human.renderer.camera.fly.flyTo(c.camera.location,function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):Human.renderer.camera.fly.jumpTo(c.camera.location,function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}))},a.prototype.initAnnotations=function(a){var b=this;Human.view&&(Human.view.annotations.clearAnnotations(),a.forEach(function(a,c){var d="___"+b.id+"."+c;if(!a.pos&&a.objectId){var e=Human.scene.objects[a.objectId];e&&(a.pos=e.getCenter())}a.annotationId=d,a.title=a.title||"",a.description=a.description||"",a.dir=a.pinVec||a.dir,a.type=a.type||"default",a.enabled="secondary"!==a.type,a.shown="secondary"!==a.type,a.labelShown="secondary"!==a.type,a.labelOffset=a.labelOffset||null,a.saved=!0,Human.view.annotations.createAnnotation(a)}))},a.prototype.initGraph=function(a){Human.scene.setObjectProperties(a)},a.prototype.initProperties=function(){var a=this;Human.renderer.lights.clearEnabled(),Human.renderer.lights.setEnabled(unpackChapterLights(a.lights));var b=Human.renderer.getScene();b.deactivateReflection(),a.reflection&&b.activateReflection(a.reflection),b.deactivateLightmap(),a.lightmap&&b.activateLightmap(a.lightmap),Human.view&&Human.view.setViewModes(a.viewModes),Human.properties.applyDefaults(),Human.properties.set(a.properties)},a.prototype.initParticles=function(){for(var a=0,b=this.particleSystems.length;b>a;++a)Human.particles.enable(this.particleSystems[a])},a.prototype.initClippingPlanes=function(){Human.renderer.clip.reset();var a;for(a in this.clippingPlanes.clips)if(this.clippingPlanes.clips.hasOwnProperty(a)){var b=Human.utils.shallowClone(this.clippingPlanes.clips[a]);b.boundary=this.clippingPlanes.boundary,Human.renderer.clip.setClip(b)}},a.prototype.initPostprocess=function(){Human.renderer.postprocess.parse(this.postprocess)},a.prototype.initTransparencyMode=function(){Human.renderer.setTransparencyMode(this.transparencyMode)},a.prototype.init=function(a,b,c){var d=this;Human.events.fire("timeline.chapters.activate.start",{chapterId:d.id,params:b}),d.timeRange=d.getTimeFrame(),b.camera&&!d.initializedCamera&&(d.initializedCamera=!0,d.initCamera(a,b.cameraCallback||function(){})),b.graph&&!d.initializedGraph&&(d.initializedGraph=!0,d.initGraph(d.synchronization)),b.properties&&!d.initializedProperties&&(d.initializedProperties=!0,d.initProperties()),b.particles&&!d.initializedParticles&&(Human.particles.disableAll(),Human.particles.resetAll(),d.initializedParticles=!0,d.initParticles()),b.clipping&&!d.initializedClippingPlanes&&(d.initializedClippingPlanes=!0,d.initClippingPlanes()),b.postprocess&&!d.initializedPostprocess&&(d.initializedPostprocess=!0,d.initPostprocess()),b.transparencyMode&&!d.initializedTransparencyMode&&(d.initializedTransparencyMode=!0,d.initTransparencyMode()),d.ssaa?Human.renderer.getResolutionScalingSupported()&&Human.renderer.setResolutionScaling(2):Human.renderer.setResolutionScaling(1),Human.events.fire("timeline.chapters.initializing",{chapterId:d.id,params:b}),c&&c(),Human.events.fire("timeline.chapters.activate.finish",{chapterId:d.id})},a.prototype.uninit=function(a,b){var c=this;Human.events.fire("timeline.chapter.deactivate.start"),c.initGraph({}),c.initAnnotations([]),b&&b(),Human.events.fire("timeline.chapter.deactivate.finish")},a.prototype.update=function(a,b,c){b=b||{};var d=this;d.firstUpdate&&(d.firstUpdate=!1,b.hasOwnProperty("camera")||(b.camera=!d.initializedCamera),b.hasOwnProperty("annotations")||(b.annotations=!d.initializedAnnotations),b.hasOwnProperty("properties")||(b.properties=!d.initializedProperties),b.hasOwnProperty("graph")||(b.graph=!d.initializedGraph),b.hasOwnProperty("particles")||(b.particles=!d.initializedParticles),b.hasOwnProperty("clipping")||(b.clipping=!d.initializedClippingPlanes),b.hasOwnProperty("postprocess")||(b.postprocess=!d.initializedPostprocess),b.hasOwnProperty("transparencyMode")||(b.transparencyMode=!d.initializedTransparencyMode),d.init(a,b,function(){})),d._update2(a),c&&c()},a.prototype._update2=function(a){var b=this;(null===b.timeRange||void 0===b.timeRange)&&(b.timeRange=b.getTimeFrame());var c=b.timeRange;"start"===a||a<c.startTime?a=c.startTime:("end"===a||"last"===a||a>c.lastTime)&&(a=c.lastTime);var d=b.whichMaps(a);d.forEach(function(b){var c=b.map,d=b.camera,e=c.data.timeline,f=c.calcChildTime(a);return e.update(d,f),!0});for(var e in b.media)b.media.hasOwnProperty(e)&&b.media[e].update(a)},a.prototype.destroy=function(){var a=this,b=a.getUniqueLeafTimelines();for(var c in b)b.hasOwnProperty(c)&&"dummy"!==c&&b[c].destroy();delete Human.timeline.branchTimelines[a.id]}}(),function(){"use strict";var a=Human.timeline.RootTimeline=function(a,b){b=b||{};var c=this;c.id=a,c.level="root",c.animationOptions={},c._theQueue=[],c._chapters=[],c._times=[],c._timeFrame=null,c.freeAnimations={},c._firstUpdate=!0,c._prevBranch=null,c._prevTime=null,c._nowBranch=null,c._nowTime=null};a.prototype.setAnimationOptions=function(a,b){var c=this;b=b||{},a.animation&&(c.animationOptions=a.animation)},a.prototype.addChapter=function(a,b){var c=this;b=b||{};var d=b.hasOwnProperty("rebuild")?b.rebuild:!0,e=b.position||c._chapters.length;(0>e||e>c._chapters.length)&&Human.log.warn("RootTimeline.addChapter(): Invalid index "+e+"position"),c._chapters.splice(e,0,a),d&&c.build()},a.prototype.activate=function(a,b,c){var d=this;Human.timeline.activeRoot=d;var e=d.mapGlobalTime(a,{which:"second",direction:"forwards"});Human.events.fire("timeline.chapters.updated",d._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:d._timeFrame.firstTime,lastTime:d._timeFrame.lastTime}),Human.timeline.stop(),e.branch.init(e.time,b,function(){}),Human.timeline.activeRoot.update(a,{which:"second",direction:"forwards"}),Human.timeline.time=a,Human.timeline._time1=a,Human.timeline._time2=a,Human.timeline._freeTime=a,c()},a.prototype.deactivate=function(a,b){var c=this;null!==Human.timeline.activeRoot&&Human.timeline.activeRoot.id===c.id&&(Human.events.fire("timeline.chapters.updated",[]),Human.events.fire("timeline.timeFrame.updated",{firstTime:0,lastTime:0}),Human.timeline.activeRoot=null,Human.timeline.stop(),Human.timeline.time=0,Human.timeline._time1=0,Human.timeline._time2=0,Human.timeline._freeTime=0,c._nowBranch.uninit(a,b))},a.prototype.getDescendentLeaves=function(){var a=this,b={};return a._chapters.forEach(function(a){var c=a.getChildLeafTimelines(0);for(var d in c)c.hasOwnProperty(d)&&(b.hasOwnProperty(d)||(b[d]=Human.timeline.leafTimelines[d]))}),b},a.prototype.getTimeFrame=function(a){var b=this;a=a||{};var c=0,d=b._chapters;return d.forEach(function(a){c+=a.getTimeFrame().lastTime}),{firstTime:0,lastTime:c}},a.prototype.whereIsBranch=function(a,b){var c=this;b=b||{};var d=0,e=!1,f=null,g=[];for(g=b.chapters===!0?c._chapters:c._theQueue;!e&&d<g.length;)e=g[d].id===a.id?!0:!1,e?f=d:d++;return f},a.prototype.getBranch=function(a){var b=this;a=a||{};var c,d,e=!1,f=0,g={};if(Human.utils.isEmpty(a))return null;for(Object.keys(a).length>1&&Human.log.warn("timeline.RootTimeline.getBranch","too many parameters, using only the first."),c=Object.keys(a)[0],d=a[c];!e&&f<b._theQueue.length;)g=b._theQueue[f],b._theQueue[f][c]===d&&(e=!0),f++;var h;return h=e?g:null},a.prototype.mapGlobalTime=function(a,b){var c=this;b=b||{},"end"===a?a=c.getTimeFrame().lastTime:"start"===a&&(a=0),0>a?a=0:a>c.getTimeFrame().lastTime&&(a=c.getTimeFrame().lastTime);var d="earlier";b.tie?d=b.tie:b.which&&b.direction&&("forwards"===b.direction?d="second"===b.which?"later":"earlier":"backwards"===b.direction&&(d="first"===b.which?"later":"earlier"));var e={branch:null,time:null,index:null},f=c._times.indexOf(a);if(f>=0){var g="later"!==d?f-1:f;g=0>g?c._theQueue.length-1:g,g=g>=c._times.length-1?0:g,e.branch=c._theQueue[g],e.time="later"!==d?a-c._times[g]:0,e.index=g}else{var h=Human.utils.binarySearch(c._times,a);e.branch=c._theQueue[h.index1],e.time=a-h.value1,e.index=h.index1}return e},a.prototype.mapBranchTime=function(a,b,c){var d=this;c=c||{};var e=0,f=d.whereIsBranch(a);return"end"===b?b=a.getTimeFrame().lastTime:"start"===b&&(b=0),e=null===f?null:d._times[f]+b},a.prototype.getNeighborChapter=function(a,b,c){var d=this;c=c||{};var e=null,f=null;if(b="previous"===b?"previous":"next",a instanceof Human.timeline.BranchTimeline)e=a;else{if("number"!=typeof a)return Human.log.warn("timeline.root.getNeighborChapter","invalid 'now' argument :"+JSON.stringify(a)),null;var g="later"===c.tie?"later":"earlier";e=d.mapGlobalTime(a,{tie:g})}if(f=d.whereIsBranch(e),0===f&&"previous"===b)return null;if(f===d._theQueue.length-1&&"next"===b)return null;var h=f;return"next"===b?h++:h--,d._theQueue[h]},a.prototype.isFirst=function(a){var b=this;return a.id===b._theQueue[0].id?!0:!1},a.prototype.isLast=function(a){var b=this,c=b._theQueue.length-1;return a.id===b._theQueue[c].id?!0:!1},a.prototype.buildFreeAnimations=function(a){var b=this;a=a||{};var c=b.getDescendentLeaves();for(var d in c)if(c.hasOwnProperty(d)){var e=c[d].freeAnimations;for(var f in e)e.hasOwnProperty(f)&&!b.freeAnimations.hasOwnProperty(f)&&(b.freeAnimations[f]=e[f])}},a.prototype.buildQueue=function(a){var b=this;a=a||{},b._theQueue=[];var c=0;b._times=[c],b._chapters.forEach(function(a){c+=a.getTimeFrame().lastTime,b._theQueue.push(a),b._times.push(c)})},a.prototype.build=function(a){var b=this;a=a||{},b._theQueue=[],b._times=[],b.buildFreeAnimations(),b.buildQueue(),Human.timeline.rootTimelines[b.id]&&delete Human.timeline.rootTimelines[b.id],Human.timeline.rootTimelines[b.id]=b,b._timeFrame=b.getTimeFrame(),null===b._nowBranch?(b._nowBranch=b._theQueue[0],b._nowTime=0,b._prevBranch=b._nowBranch,b._prevTime=0):null===b.whereIsBranch(b._nowBranch)&&(b._nowBranch=b._theQueue[0],b._nowTime=0,null===b._prevBranch?(b._prevBranch=b._nowBranch,b._prevTime=b._nowTime):null===b.whereIsBranch(b._prevBranch)&&(b._prevBranch=b._nowBranch,b._prevTime=b._nowTime)),Human.events.fire("timeline.chapters.updated",b._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:b._timeFrame.firstTime,lastTime:b._timeFrame.lastTime})},a.prototype.destroy=function(){var a=this;a._theQueue.forEach(function(a){Human.timeline.branchTimelines.hasOwnProperty(a.id)&&a.destroy()}),Human.timeline.rootTimelines.hasOwnProperty(a.id)&&delete Human.timeline.rootTimelines[a.id]},a.prototype.updateFreeAnimations=function(a){var b=this;for(var c in b.freeAnimations)b.freeAnimations.hasOwnProperty(c)&&b.freeAnimations[c].update({cameraEnabled:!1},a);for(var d=b._nowBranch.particleSystems,e=0,f=d.length;f>e;++e)Human.particles.update(d[e],a)},a.prototype.update=function(a,b,c){var d=this;b=b||{};var e={},f=[];"function"!=typeof c&&(c=function(){}),e={which:"both",direction:"forwards"},b.hasOwnProperty("which")&&(e.which=b.which),b.hasOwnProperty("direction")&&(e.direction=b.direction),0>a?(a=0,Human.log.warn("Time violates lower bound. Updating to time = 0.0")):a>d._timeFrame.lastTime&&(a=d._timeFrame.lastTime,Human.log.warn("Time violates upper bound. Updating to time = "+a)),f=d._getBranchesToUpdate(a,e),d._firstUpdate&&(d._nowBranch=f[0].branch,d._nowTime=f[0].time,d._firstUpdate=!1);var g=!1;f.forEach(function(a){d._prevBranch=d._nowBranch,d._prevTime=d._nowTime,g=a.branch.firstUpdate,d._nowBranch=a.branch,d._nowTime=a.time,a.branch.update(a.time,{},c),g&&Human.events.fire("timeline.chapters.activated",d._assembleChaptersActivated())}),d._prevBranch.id!==d._nowBranch.id&&d._prevBranch.reset()},a.prototype._getBranchesToUpdate=function(a,b){var c=this;return c._times.indexOf(a)>=0?c._getBorderBranches(a,b):[c.mapGlobalTime(a,{tie:"earlier"})]},a.prototype._getBorderBranches=function(a,b){var c=this,d=c.mapGlobalTime(a,{tie:"earlier"}),e=c.mapGlobalTime(a,{tie:"later"}),f=[d,e];return"backwards"===b.direction&&(f=[e,d]),"first"===b.which?f.splice(1,1):"second"===b.which&&f.splice(0,1),f},a.prototype._assembleChaptersUpdated=function(){var a,b,c,d,e=this,f=[],g=e._chapters;for(a=0,b=g.length;b>a;a++)c=g[a],d={chapterId:c.id,time:e.mapBranchTime(c,0),duration:c.getTimeFrame().lastTime,displayName:c.info.displayName,description:c.info.description,loop:c.animation.loop,index:a},f.push(d);return f},a.prototype._assembleChaptersActivated=function(){var a=this,b={};return b.oldChapterIndex=a.whereIsBranch(a._prevBranch,{chapters:!0}),b.newChapterIndex=a.whereIsBranch(a._nowBranch,{chapters:!0}),b.time=a.mapBranchTime(a._nowBranch,a._nowTime),b.loop=a._nowBranch.animation.loop||!1,b.branchID=a._nowBranch.id,b},a.prototype._assembleQueryChapters=function(){var a,b,c,d=this,e=[],f=d._chapters;for(a=0,b=f.length;b>a;a++)c=f[a],e.push({chapterId:c.id,time:d.mapBranchTime(c,0),displayName:c.info.displayName,description:c.info.description,type:"branch",tags:c.tags||[],annotations:c.annotations,hotspots:null,flyTo:c.camera.location,active:d._nowBranch.id===c.id,sounds:c._getAudio(),translations:c.translations||null});return e}}(),function(){"use strict";function a(a,d){var e=a.id||"ps"+b++,f=a.numParticles,g={properties:a.properties,material:a.material,textures:a.textures,spriteRows:a.spriteRows||0,spriteCols:a.spriteCols||0,spriteStartFrame:a.spriteStartFrame||0,spriteEndFrame:a.spriteEndFrame||0};0===g.spriteEndFrame&&g.spriteRows>0&&g.spriteCols>0&&(g.spriteEndFrame=g.spriteRows*g.spriteCols-1);var h,i,j,k,l,m,n,o,p,q=[],r=[],s=[],t={},u=0,v=a.creators||[],w=a.updaters||[],x=a.constraints||[],y=0,z=null,A=null;for(j=0,k=v.length;k>j;++j)o=v[j],m=o.id||"__CR"+ ++u,t[m]?Human.log.error("Component "+m+" already exists. Skipping."):(l=o.type,n=new c.creators[l](o,g),q.push(n),t[m]=n,"Lifetime"===l?g.lifetimes=!0:"SolidColor"===l?g.colors=!0:"RandomScale"===l||"RandomRotation"===l?g.scaleRotations=!0:"RandomRotationSpeed"===l?(g.scaleRotations=!0,g.rotationSpeeds=!0):"SpriteAnimationDuration"===l&&(g.uvTranslates=!0,g.spriteFrameDuration=!0,g.spriteFrameCounter=!0,g.spriteCurrentTime=!0));var B=null,C=null;for(j=0,k=w.length;k>j;++j)if(p=w[j],m=p.id||"__UP"+ ++u,t[m])Human.log.error("Component "+m+" already exists. Skipping.");else{if(l=p.type,p.shape&&(h=p.shape,i=h.type,z=new c.shapes[i](h),A=h.direction||"in"),B=new c.updaters[l](p,g),"AgeColorBlend"===l)g.colors=!0,g.lifetimes=!0;else if("Path"===l){C=B;for(var D=p.nodes,E=0;E<D.length;++E)B.addNode(D[E]);g.paths=!0}else"SpriteAnimation"===l&&(g.uvTranslates=!0);z&&(B.shape=z,B.shapeDirection=A),r.push(B),t[m]=B}var F=null;for(j=0,k=x.length;k>j;++j)if(o=x[j],m=o.id||"__CN"+ ++u,t[m])Human.log.error("Component "+m+" already exists. Skipping.");else{l=o.type;var G;switch(o.shape&&(h=o.shape,i=h.type,z=new c.shapes[i](h),A=h.direction||"in"),o.trap?(G=y++,g.traps=!0):G=-1,l){case"LifetimeKill":case"LifetimeStop":F=new c.constraints[l](g);break;case"PathKill":case"PathRadius":case"PathStop":F=new c.constraints[l](C,g);break;case"ShapeBounce":case"ShapeStop":case"ShapeKill":F=new c.constraints[l](z,A,G,g)}s.push(F),t[m]=F}var H=g.textures||[];for(j=0,k=H.length;k>j;++j)H[j].src=window.localBaseDirectory+"content/states/"+H[j].src.replace(/^\/+/,"");Human.assets.textures.load(H,function(){var b=new c.ParticleSystem(f,g);b.creators=q,b.updaters=r,b.constraints=s,b.components=t,void 0!==a.emissionAverage&&(b.emissionAverage=a.emissionAverage),void 0!==a.emissionVariance&&(b.emissionVariance=a.emissionVariance),void 0!==a.maxSpeed&&(b.maxSpeed=a.maxSpeed),void 0!==a.pointSize&&b.pointSize(a.pointSize),c.systems[e]=b,d&&d()})}var b=0,c=Human.particles={creators:{},updaters:{},constraints:{},shapes:{},systems:{}},d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};c.parse=function(b,c){function d(){0===--e&&c&&c()}b=Human.utils.deepClone(b);var e=b.length;if(0===e)return void(c&&c());for(var f=0,g=b.length;g>f;++f)a(b[f],d)},c.getBoundary=function(){d.xmin=Number.POSITIVE_INFINITY,d.ymin=Number.POSITIVE_INFINITY,d.zmin=Number.POSITIVE_INFINITY,d.xmax=Number.NEGATIVE_INFINITY,d.ymax=Number.NEGATIVE_INFINITY,d.zmax=Number.NEGATIVE_INFINITY;for(var a in c.systems){var b=c.systems[a].getBoundary();d.xmin=Math.min(d.xmin,b.xmin),d.ymin=Math.min(d.ymin,b.ymin),d.zmin=Math.min(d.zmin,b.zmin),d.xmax=Math.max(d.xmax,b.xmax),d.ymax=Math.max(d.ymax,b.ymax),d.zmax=Math.max(d.zmax,b.zmax)}return d},c.update=function(a,b){c.systems[a]&&(c.systems[a].update(b),Human.renderer.camera.nearFarDirty=!0)},c.updateAll=function(a){for(var b in c.systems)c.systems.hasOwnProperty(b)&&c.update(b,a)},c.enable=function(a){c.systems[a].enable()},c.enableAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.enable(a)},c.disable=function(a){c.systems[a].disable()},c.disableAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.disable(a)},c.reset=function(a){c.systems[a].reset()},c.resetAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.reset(a)},c.destroy=function(a){c.systems[a]&&(c.systems[a].destroy(),delete c.systems[a])},c.destroyAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.destroy(a)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Uint8Array(4),d=new Float32Array(2),e=new Float32Array(1),f=new Float32Array(2),g={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},h=Human.particles.ParticleSystem=function(a,b){b=b||{};var c=b.material,d=b.textures,e=b.properties||{},f=e.layer||0,g=e.addBlend||!1,h=!!b.colors,i=!!b.lifetimes,j=!!b.paths,k=!!b.traps,l=Human.renderer.getScene(),m=!!b.scaleRotations,n=!!b.rotationSpeeds,o=!!b.uvTranslates,p=!!b.spriteFrameDuration,q=!!b.spriteFrameCounter,r=!!b.spriteCurrentTime;this.activeParticlesBegin=0,this.numParticles=0,this.maxSpeed=0,this.maxNumParticles=a,this.spriteRows=b.spriteRows||0,this.spriteCols=b.spriteCols||0,this.spriteStartFrame=b.spriteStartFrame||0,this.spriteEndFrame=b.spriteEndFrame||0,this.attributes={stopped:new Array(a),dead:new Array(a),positions:new Float32Array(3*a),velocities:new Float32Array(3*a),colors:h?new Uint8Array(4*this.maxNumParticles):null,lifetimes:i?new Float32Array(this.maxNumParticles):null,ages:i?new Float32Array(this.maxNumParticles):null,paths:j?new Uint8Array(this.maxNumParticles):null,traps:k?new Uint32Array(this.maxNumParticles):null,scaleRotations:m?new Float32Array(2*a):null,rotationSpeeds:n?new Float32Array(a):null,uvTranslates:o?new Float32Array(2*a):null,spriteFrameDuration:p?new Float32Array(a):null,spriteFrameCounter:q?new Uint8Array(a):null,spriteCurrentTime:r?new Float32Array(a):null},this.rootNode=null,this.properties=null,this.material=null,this.geometry=null;var s;if(e.enabled=!1,e.picking=!1,e.depthMask===!1&&(e.noDepthMask=!0),this.rootNode=this.properties=s=l.addNode({type:"properties",properties:e}),c&&(c.type="material",this.material=s=s.addNode(c)),d)for(var t=0,u=d.length;u>t;++t)d[t].type="texture",d[t].src=window.localBaseDirectory+"content/states/"+d[t].src,s=s.addNode(d[t]);var v=null;this.spriteRows>0&&this.spriteCols>0&&(v=new Float32Array([1/this.spriteCols,1/this.spriteRows])),this.geometry=s.addNode({type:"geometry",positions:this.attributes.positions,colors:this.attributes.colors,pointScaleRotations:this.attributes.scaleRotations,pointUVTranslates:this.attributes.uvTranslates,pointUVScale:v,layer:f,addBlend:g,primitive:"points"}),this.enabled=!1,this.emissionAverage=0,this.emissionVariance=0,this.creators=[],this.updaters=[],this.constraints=[],this.components={},this.previousTime=null};h.prototype.pointSize=function(a){this.geometry.setPointSize(a)},h.prototype.getBoundary=function(){return g},h.prototype.update=function(a){if(this.enabled){g.xmin=Number.POSITIVE_INFINITY,g.ymin=Number.POSITIVE_INFINITY,g.zmin=Number.POSITIVE_INFINITY,g.xmax=Number.NEGATIVE_INFINITY,g.ymax=Number.NEGATIVE_INFINITY,g.zmax=Number.NEGATIVE_INFINITY;var c=Math.max,d=Math.min,e=Math.sqrt,f=Math.floor,h=Math.random;this.previousTime=this.previousTime||a;var i=d(a-this.previousTime,.04);0>i&&(this.previousTime=a,i=0);var j,k,l,m,n,o,p,q,r=this.attributes,s=r.positions,t=r.velocities,u=r.ages,v=r.lifetimes,w=!!u,x=this.maxSpeed*i,y=x*x,z=r.scaleRotations,A=r.rotationSpeeds;if(this.numParticles<this.maxNumParticles){var B=this.emissionAverage*i,C=this.emissionVariance*i,D=c(B+2*h()*C-C,0);D=D>=1?f(D):h()<D?1:0;var E=d(this.numParticles+D,this.maxNumParticles);for(j=this.numParticles;E>j;++j)l=3*j,q=2*j,s[l]=0,s[l+1]=0,s[l+2]=0,t[l]=0,t[l+1]=0,t[l+2]=0,r.dead[j]=!1,r.stopped[j]=!1,r.paths&&(r.paths[j]=0),r.traps&&(r.traps[j]=0),r.traps&&(r.traps[j]=0),r.scaleRotations&&(r.scaleRotations[q]=1,r.scaleRotations[q+1]=0),r.rotationSpeeds&&(r.rotationSpeeds[j]=0),r.uvTranslates&&(r.uvTranslates[q]=this.spriteStartFrame%this.spriteCols*1/this.spriteCols,r.uvTranslates[q+1]=1*(this.spriteRows-1-f(this.spriteStartFrame/this.spriteCols))/this.spriteRows),r.spriteFrameCounter&&(r.spriteFrameCounter[j]=0),r.spriteFrameDuration&&(r.spriteFrameDuration[j]=0),r.spriteCurrentTime&&(r.spriteCurrentTime[j]=0);for(k=0,m=this.creators.length;m>k;++k)this.creators[k].create(this.numParticles,E,r);this.numParticles=E}for(k=0,m=this.updaters.length;m>k;++k)this.updaters[k].update(this.activeParticlesBegin,this.numParticles,r,i);for(j=this.activeParticlesBegin;j<this.numParticles;++j){if(l=3*j,q=2*j,n=l,o=l+1,p=l+2,b[0]=t[n]*i,b[1]=t[o]*i,b[2]=t[p]*i,y>0){var F=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];if(F>y){var G=e(F),H=x/G;b[0]*=H,b[1]*=H,b[2]*=H,t[n]=b[0],t[o]=b[1],t[p]=b[2]}}s[n]+=b[0],s[o]+=b[1],s[p]+=b[2],A&&(z[q+1]+=A[j]*i),g.xmin=d(g.xmin,s[n]),g.ymin=d(g.ymin,s[o]),g.zmin=d(g.zmin,s[p]),g.xmax=c(g.xmax,s[n]),g.ymax=c(g.ymax,s[o]),g.zmax=c(g.zmax,s[p]),w&&u[j]<v[j]&&(u[j]=d(u[j]+i,v[j]))}for(j=0;j<this.activeParticlesBegin;++j)l=3*j,n=l,o=l+1,p=l+2,g.xmin=d(g.xmin,s[n]),g.ymin=d(g.ymin,s[o]),g.zmin=d(g.zmin,s[p]),g.xmax=c(g.xmax,s[n]),g.ymax=c(g.ymax,s[o]),g.zmax=c(g.zmax,s[p]);for(k=0,m=this.constraints.length;m>k;++k)this.constraints[k].constrain(this.activeParticlesBegin,this.numParticles,r);var I=r.stopped,J=r.dead;for(j=this.activeParticlesBegin;j<this.numParticles;++j)J[j]?(this.kill(j),--j):I[j]&&this.stop(j);this.geometry.setPositions(r.positions.subarray(0,3*this.numParticles)),r.colors&&this.geometry.setColors(r.colors.subarray(0,4*this.numParticles)),r.scaleRotations&&this.geometry.setPointScaleRotations(r.scaleRotations.subarray(0,2*this.numParticles)),r.uvTranslates&&this.geometry.setPointUVTranslates(r.uvTranslates.subarray(0,2*this.numParticles)),this.properties.setEnabled(this.numParticles>0?!0:!1),this.previousTime=a}},h.prototype.kill=function(a){var b=this.attributes,c=2*a,d=3*a,e=4*a,f=a,g=2*(this.numParticles-1),h=3*(this.numParticles-1),i=4*(this.numParticles-1),j=this.numParticles-1,k=b.positions,l=b.velocities,m=b.colors,n=b.ages,o=b.lifetimes,p=b.paths,q=b.dead,r=b.stopped,s=b.traps,t=b.scaleRotations,u=b.rotationSpeeds,v=b.uvTranslates;k[d]=k[h],k[d+1]=k[h+1],k[d+2]=k[h+2],l[d]=l[h],l[d+1]=l[h+1],l[d+2]=l[h+2],q[f]=q[j],r[f]=r[j],m&&(m[e]=m[i],m[e+1]=m[i+1],m[e+2]=m[i+2],m[e+3]=m[i+3]),t&&(t[c]=t[g],t[c+1]=t[g+1]),u&&(u[f]=u[j]),v&&(v[c]=v[g],v[c+1]=v[g+1]),o&&(n[f]=n[j],o[f]=o[j]),p&&(p[f]=p[j]),s&&(s[f]=s[j]),this.numParticles--},h.prototype.stop=function(g){var h=this.attributes,i=2*g,j=3*g,k=4*g,l=g,m=2*this.activeParticlesBegin,n=3*this.activeParticlesBegin,o=4*this.activeParticlesBegin,p=this.activeParticlesBegin,q=h.positions,r=h.velocities,s=h.colors,t=h.ages,u=h.lifetimes,v=h.paths,w=h.stopped,x=h.traps,y=h.scaleRotations,z=h.rotationSpeeds,A=h.uvTranslates;a[0]=q[n],a[1]=q[n+1],a[2]=q[n+2],q[n]=q[j],q[n+1]=q[j+1],q[n+2]=q[j+2],q[j]=a[0],q[j+1]=a[1],q[j+2]=a[2],b[0]=r[n],b[1]=r[n+1],b[2]=r[n+2],r[n]=r[j],r[n+1]=r[j+1],r[n+2]=r[j+2],r[j]=b[0],r[j+1]=b[1],r[j+2]=b[2],s&&(c[0]=s[o],c[1]=s[o+1],c[2]=s[o+2],c[3]=s[o+3],s[o]=s[k],s[o+1]=s[k+1],s[o+2]=s[k+2],s[o+3]=s[k+3],s[k]=c[0],s[k+1]=c[1],s[k+2]=c[2],s[k+3]=c[3]),y&&(d[0]=y[m],d[1]=y[m+1],y[m]=y[i],y[m+1]=y[i+1],y[i]=d[0],y[i+1]=d[1]),z&&(e[0]=z[p],z[p]=z[g],z[g]=e[0]),A&&(f[0]=A[m],f[1]=A[m+1],A[m]=A[i],A[m+1]=A[i+1],A[i]=f[0],A[i+1]=f[1]);var B;u&&(B=t[p],t[p]=t[l],t[l]=B,B=u[p],u[p]=u[l],u[l]=B),v&&(B=v[p],v[p]=v[l],v[l]=B),x&&(B=x[p],x[p]=x[l],x[l]=B),w[l]=!1,this.activeParticlesBegin++},h.prototype.reset=function(){this.numParticles=0,this.activeParticlesBegin=0},h.prototype.enable=function(){this.properties.setEnabled(!0),this.enabled=!0},h.prototype.disable=function(){this.properties.setEnabled(!1),this.enabled=!1},h.prototype.destroy=function(){this.rootNode.destroy()}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.creators.DirectionalVelocity=function(a){this.directionAverage=new Float32Array(a.directionAverage),this.directionVariance=a.directionVariance||0,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,vec3.normalize(this.directionAverage,this.directionAverage)};b.prototype.create=function(b,c,d){for(var e=d.velocities,f=Math.random,g=vec3.normalize,h=b;c>h;++h){var i=3*h,j=this.forceAverage+2*f()*this.forceVariance-this.forceVariance;a[0]=this.directionAverage[0]+2*f()*this.directionVariance-this.directionVariance,a[1]=this.directionAverage[1]+2*f()*this.directionVariance-this.directionVariance,a[2]=this.directionAverage[2]+2*f()*this.directionVariance-this.directionVariance,g(a,a),e[i]=a[0]*j,e[i+1]=a[1]*j,e[i+2]=a[2]*j}}}(),function(){"use strict";var a=Human.particles.creators.Lifetime=function(a){this.average=a.average,this.variance=a.variance||0};a.prototype.create=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=Math.random,g=a;b>g;++g)d[g]=0,e[g]=this.average,this.variance>0&&(e[g]+=2*f()*this.variance-this.variance)}}(),function(){"use strict";var a=Human.particles.creators.PointPosition=function(a){this.position=new Float32Array(a.position)};a.prototype.create=function(a,b,c){for(var d=c.positions,e=a;b>e;++e){var f=3*e;d[f]=this.position[0],d[f+1]=this.position[1],d[f+2]=this.position[2]}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.creators.RandomVelocity=function(a){this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0};b.prototype.create=function(b,c,d){for(var e=d.velocities,f=Math.random,g=vec3.normalize,h=b;c>h;++h){var i=3*h,j=this.forceAverage;this.forceVariance>0&&(j+=2*f()*this.forceVariance-this.forceVariance),a[0]=2*f()-1,a[1]=2*f()-1,a[2]=2*f()-1,g(a,a),e[i]=a[0]*j,e[i+1]=a[1]*j,e[i+2]=a[2]*j}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.SpherePosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=Math.PI,h=Math.sin,i=Math.cos,j=b;c>j;++j){var k=3*j,l=f()*g,m=f()*g*2,n=f();a[0]=n*h(l)*h(m),a[1]=n*i(l),a[2]=n*h(l)*i(m),this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[k]=a[0],e[k+1]=a[1],e[k+2]=a[2]}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.CubePosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=b;c>g;++g){var h=3*g;a[0]=f()-.5,a[1]=f()-.5,a[2]=f()-.5,this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[h]=a[0],e[h+1]=a[1],e[h+2]=a[2]}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.CylinderPosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=Math.PI,h=Math.sin,i=Math.cos,j=b;c>j;++j){var k=3*j,l=f()*g*2,m=f(),n=2*f()-1;a[0]=m*i(l),a[1]=n,a[2]=m*h(l),this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[k]=a[0],e[k+1]=a[1],e[k+2]=a[2]}}}(),function(){"use strict";var a=Human.particles.creators.RandomScale=function(a){this.average=a.average,this.variance=a.variance||0};a.prototype.create=function(a,b,c){for(var d=c.scaleRotations,e=Math.random,f=2*a,g=2*b,h=f;g>h;h+=2){var i=this.average;this.variance>0&&(i+=2*e()*this.variance-this.variance),d[h]=i}}}(),function(){"use strict";var a=Human.particles.creators.RandomRotation=function(a){this.average=a.average*Human.math.TO_RADIANS,this.variance=(a.variance||0)*Human.math.TO_RADIANS};a.prototype.create=function(a,b,c){for(var d=c.scaleRotations,e=Math.random,f=2*a+1,g=2*b+1,h=f;g>h;h+=2){var i=this.average;this.variance>0&&(i+=2*e()*this.variance-this.variance),d[h]=i}}}(),function(){"use strict";var a=Human.particles.creators.RandomRotationSpeed=function(a){this.average=a.average*Human.math.TO_RADIANS,this.variance=(a.variance||0)*Human.math.TO_RADIANS};a.prototype.create=function(a,b,c){for(var d=c.rotationSpeeds,e=Math.random,f=a;b>f;f++){var g=this.average;this.variance>0&&(g+=2*e()*this.variance-this.variance),d[f]=g}}}(),function(){"use strict";var a=Human.particles.creators.SpriteAnimationDuration=function(a,b){this.rows=b.spriteRows,this.cols=b.spriteCols,this.startFrame=b.spriteStartFrame,this.endFrame=b.spriteEndFrame,this.average=a.average,this.variance=a.variance};a.prototype.create=function(a,b,c){for(var d=c.spriteFrameDuration,e=Math.random,f=Math.max,g=a;b>g;g++){var h=this.average;this.variance>0&&(h+=2*e()*this.variance-this.variance),d[g]=f(h/(this.endFrame-this.startFrame),0)}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.BrownianMotion=function(a){this.frequency=a.frequency,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.frequency*e,l=this.forceAverage*e,m=this.forceVariance*e,n=b;c>n;++n)if((!j||this.shape[this.shapeDirection](f,n))&&h()<k){var o=3*n,p=l;m>0&&(p+=2*h()*m-m),a[0]=2*h()-1,a[1]=2*h()-1,a[2]=2*h()-1,i(a,a),g[o]+=a[0]*p,g[o+1]+=a[1]*p,g[o+2]+=a[2]*p}}}(),function(){"use strict";var a=Human.particles.updaters.Friction=function(a){this.friction=1-a.friction,this.shape=null,this.shapeDirection="in"};a.prototype.update=function(a,b,c,d){for(var e=c.positions,f=c.velocities,g=!!this.shape,h=Math.pow(this.friction,d),i=a;b>i;++i)if(!g||this.shape[this.shapeDirection](e,i)){
var j=3*i;f[j]*=h,f[j+1]*=h,f[j+2]*=h}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.UniformForce=function(a){this.directionAverage=new Float32Array(a.directionAverage),this.directionVariance=a.directionVariance||0,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in",vec3.normalize(this.directionAverage,this.directionAverage)};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.forceAverage*e,l=this.forceVariance*e,m=b;c>m;++m)if(!j||this.shape[this.shapeDirection](f,m)){var n=3*m,o=k;l>0&&(o+=2*h()*l-l),a[0]=this.directionAverage[0],a[1]=this.directionAverage[1],a[2]=this.directionAverage[2],this.directionVariance&&(a[0]+=2*h()*this.directionVariance-this.directionVariance,a[1]+=2*h()*this.directionVariance-this.directionVariance,a[2]+=2*h()*this.directionVariance-this.directionVariance,i(a,a)),g[n]+=a[0]*o,g[n+1]+=a[1]*o,g[n+2]+=a[2]*o}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.RadialForce=function(a){this.position=new Float32Array(a.position),this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.forceAverage*e,l=this.forceVariance*e,m=b;c>m;++m)if(!j||this.shape[this.shapeDirection](f,m)){var n=3*m,o=k;l&&(o+=2*h()*l-l),a[0]=f[n]-this.position[0],a[1]=f[n+1]-this.position[1],a[2]=f[n+2]-this.position[2],i(a,a),g[n]+=a[0]*o,g[n+1]+=a[1]*o,g[n+2]+=a[2]*o}}}(),function(){"use strict";var a=Human.particles.updaters.AgeColorBlend=function(a){this.colors=new Array(a.colors.length);for(var b=0,c=a.colors.length;c>b;++b)this.colors[b]=new Uint8Array(a.colors[b]);this.shape=null,this.shapeDirection="in"};a.prototype.update=function(a,b,c){for(var d=c.positions,e=c.ages,f=c.lifetimes,g=c.colors,h=!!this.shape,i=this.colors.length-1,j=Math.floor,k=a;b>k;++k)if(!h||this.shape[this.shapeDirection](d,k)){var l=4*k,m=e[k]/f[k]*i,n=j(m),o=n+1,p=this.colors[n],q=this.colors[o]||this.colors[n],r=m-n,s=1-r;g[l]=s*p[0]+r*q[0],g[l+1]=s*p[1]+r*q[1],g[l+2]=s*p[2]+r*q[2],g[l+3]=s*p[3]+r*q[3]}}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=Human.particles.updaters.Path=function(){this.nodes=[],this.shape=null,this.shapeDirection="in"};d.prototype.addNode=function(a){if(a.first=0===this.nodes.length,a.position=new Float32Array(a.position),a.forceVariance=a.forceVariance||0,this.nodes.push(a),a.first)a.vec=null,a.dir=null,a.length=null;else{var b=this.nodes[this.nodes.length-2];a.vec=vec3.subtract(vec3.create(),a.position,b.position),a.dir=vec3.normalize(vec3.create(),a.vec),a.length=vec3.length(a.vec)}},d.prototype.updateNode=function(a,b){var c=this.nodes[a];if(b.position){if(c.position=b.position,!c.first){var d=this.nodes[a-1];vec3.subtract(c.vec,c.position,d.position),vec3.normalize(c.dir,c.vec),c.length=vec3.length(c.vec)}if(a<this.nodes.length-1){var e=this.nodes[a+1];vec3.subtract(e.vec,e.position,c.position),vec3.normalize(e.dir,e.vec),e.length=vec3.length(e.vec)}}b.radius&&(c.radius=b.radius),b.forceAverage&&(c.forceAverage=b.forceAverage)},d.prototype.update=function(d,e,f,g){for(var h,i=f.positions,j=f.velocities,k=f.paths,l=!!this.shape,m=Math.random,n=vec3.distance,o=vec3.normalize,p=vec3.subtract,q=vec3.dot,r=vec3.length,s=vec3.scale,t=d;e>t;++t)if((!l||this.shape[this.shapeDirection](i,t))&&(h=this.nodes[k[t]])){var u=3*t;a[0]=i[u],a[1]=i[u+1],a[2]=i[u+2];var v;if(h.first){if(n(a,h.position)<h.radius&&(k[t]++,h=this.nodes[k[t]],!h))continue;v=p(c,h.position,a),o(v,v)}else{var w=this.nodes[k[t]-1],x=p(c,a,w.position),y=q(x,h.dir);if(y>h.length){if(k[t]++,h=this.nodes[k[t]],!h)continue;b[0]=j[u],b[1]=j[u+1],b[2]=j[u+2];var z=r(b);s(b,h.dir,z),j[u]=b[0],j[u+1]=b[1],j[u+2]=b[2]}v=h.dir}var A=h.forceAverage*g,B=h.forceVariance*g,C=A;B>0&&(C+=2*m()*B-B),j[u]+=v[0]*C,j[u+1]+=v[1]*C,j[u+2]+=v[2]*C}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.Gravity=function(a){this.position=new Float32Array(a.position),this.radius=a.radius,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=Math.max,j=vec3.length,k=!!this.shape,l=this.forceAverage*e,m=this.forceVariance*e,n=b;c>n;++n)if(!k||this.shape[this.shapeDirection](f,n)){var o=3*n,p=l;m&&(p+=2*h()*m-m),a[0]=this.position[0]-f[o],a[1]=this.position[1]-f[o+1],a[2]=this.position[2]-f[o+2];var q=i(j(a),this.radius);a[0]/=q,a[1]/=q,a[2]/=q,p/=q*q,g[o]+=a[0]*p,g[o+1]+=a[1]*p,g[o+2]+=a[2]*p}}}(),function(){"use strict";var a=Human.particles.updaters.SpriteAnimation=function(a,b){this.rows=b.spriteRows,this.cols=b.spriteCols,this.startFrame=b.spriteStartFrame,this.endFrame=b.spriteEndFrame};a.prototype.update=function(a,b,c,d){for(var e=c.uvTranslates,f=c.spriteFrameCounter,g=c.spriteFrameDuration,h=c.spriteCurrentTime,i=a;b>i;i++)h[i]+=d,h[i]>=g[i]&&(h[i]=0,f[i]++,e[2*i]+=1/this.cols,1===e[2*i]&&(e[2*i]=0,e[2*i+1]-=1/this.rows),e[2*i+1]===-1/this.rows&&(e[2*i]=this.startFrame%this.cols*1/this.cols,e[2*i+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows),f[i]>this.endFrame&&(f[i]=this.startFrame,e[2*i]=this.startFrame%this.cols*1/this.cols,e[2*i+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows))}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.updaters.AxisForce=function(a){this.position=new Float32Array(a.position),vec3.normalize(a.direction,a.direction),this.direction=new Float32Array(a.direction),this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};f.prototype.update=function(f,g,h,i){for(var j=h.positions,k=h.velocities,l=Math.random,m=!!this.shape,n=this.forceAverage*i,o=this.forceVariance*i,p=f;g>p;++p)if(!m||this.shape[this.shapeDirection](j,p)){var q=3*p,r=n;o&&(r+=2*l()*o-o),b[0]=j[q],b[1]=j[q+1],b[2]=j[q+2],vec3.sub(c,b,this.position);var s=vec3.dot(c,this.direction);vec3.scale(d,this.direction,s),vec3.add(e,d,this.position),vec3.sub(a,b,e),vec3.normalize(a,a),k[q]+=a[0]*r,k[q+1]+=a[1]*r,k[q+2]+=a[2]*r}}}(),function(){"use strict";var a=Human.particles.constraints.LifetimeKill=function(){};a.prototype.constrain=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=c.dead,g=a;b>g;++g)d[g]>=e[g]&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.LifetimeStop=function(){};a.prototype.constrain=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=c.stopped,g=a;b>g;++g)d[g]>=e[g]&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.ShapeKill=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};a.prototype.constrain=function(a,b,c){for(var d=c.positions,e=c.dead,f=c.traps,g=this.trap,h=this.trapMask,i=a;b>i;++i)if(this.shape[this.direction](d,i)){if(g&&0===(f[i]&h))continue;e[i]=!0}else g&&(f[i]|=h)}}(),function(){"use strict";var a=Human.particles.constraints.ShapeStop=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};a.prototype.constrain=function(a,b,c){for(var d=c.positions,e=c.stopped,f=c.traps,g=this.trap,h=this.trapMask,i=a;b>i;++i)if(this.shape[this.direction](d,i)){if(g&&0===(f[i]&h))continue;e[i]=!0}else g&&(f[i]|=h)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.constraints.PathRadius=function(a){this.nodes=a.nodes};f.prototype.constrain=function(f,g,h){for(var i=h.positions,j=h.paths,k=vec3.normalize,l=vec3.subtract,m=vec3.dot,n=vec3.length,o=vec3.scale,p=f;g>p;++p){var q=3*p;if(!(j[p]<1)){var r=this.nodes[j[p]];if(r){a[0]=i[q],a[1]=i[q+1],a[2]=i[q+2];var s=this.nodes[j[p]-1],t=l(b,a,s.position),u=m(t,r.dir),v=o(c,r.dir,u),w=l(d,t,v),x=n(w);if(x>r.radius){k(w,w);var y=o(e,w,r.radius-x);i[q]+=y[0],i[q+1]+=y[1],i[q+2]+=y[2]}}}}}}(),function(){"use strict";var a=Human.particles.constraints.PathKill=function(a){this.nodes=a.nodes};a.prototype.constrain=function(a,b,c){for(var d=this.nodes.length,e=c.paths,f=c.dead,g=a;b>g;++g)e[g]>=d&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.PathStop=function(a){this.nodes=a.nodes};a.prototype.constrain=function(a,b,c){for(var d=this.nodes.length,e=c.paths,f=c.stopped,g=a;b>g;++g)e[g]>=d&&(f[g]=!0)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.constraints.ShapeBounce=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};f.prototype.constrain=function(f,g,h){for(var i=h.positions,j=h.velocities,k=h.traps,l=this.trap,m=this.trapMask,n=vec3.subtract,o=vec3.dot,p=vec3.length,q=vec3.scale,r=f;g>r;++r)if(this.shape[this.direction](i,r)){if(l&&0===(k[r]&m))continue;var s=3*r;this.shape.surfaceProjection(i,r,d,e),i.set(d,s),a[0]=j[s],a[1]=j[s+1],a[2]=j[s+2];var t=p(a);a[0]/=t,a[1]/=t,a[2]/=t;var u=o(a,e),v=q(b,e,2*u),w=n(c,a,v);q(w,w,t),j[s]=w[0],j[s+1]=w[1],j[s+2]=w[2]}else l&&(k[r]|=m)}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Sphere=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return 1>=e*e+f*f+g*g},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e*e+f*f+g*g>=1},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform),vec3.normalize(c,c),d.set(c),this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=mat3.create(),d=new Float32Array([0,1,0]),e=Human.particles.shapes.Plane=function(a){this.translate=new Float32Array(a.translate||Human.math.VEC3_ZEROS),this.rotate=new Float32Array(a.rotate||Human.math.VEC3_ZEROS),this.normal=vec3.create(),this.distance=0};e.prototype.updateXform=function(){this.normal.set(d),Human.math.buildRotationScaleMat3(c,this.rotate,null),vec3.transformMat3(this.normal,this.normal,c),this.distance=vec3.dot(this.translate,this.normal)},e.prototype["in"]=function(a,b){var c=3*b,d=a[c],e=a[c+1],f=a[c+2],g=this.normal[0],h=this.normal[1],i=this.normal[2];return d*g+e*h+f*i<=this.distance},e.prototype.out=function(a,b){var c=3*b,d=a[c],e=a[c+1],f=a[c+2],g=this.normal[0],h=this.normal[1],i=this.normal[2];return d*g+e*h+f*i>=this.distance},e.prototype.surfaceProjection=function(c,d,e,f){var g=3*d;a[0]=c[g],a[1]=c[g+1],a[2]=c[g+2],f[0]=this.normal[0],f[1]=this.normal[1],f[2]=this.normal[2],vec3.scale(b,f,this.distance-vec3.dot(a,f)),vec3.add(e,a,b)}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Cube=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e>=-.5&&.5>=e&&f>=-.5&&.5>=f&&g>=-.5&&.5>=g},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return-.5>=e||e>=.5||-.5>=f||f>=.5||-.5>=g||g>=.5},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b,f=Math.abs;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform);var g=c[0],h=c[1],i=c[2],j=f(g+.5),k=f(g-.5),l=f(h+.5),m=f(h-.5),n=f(i+.5),o=f(i-.5);k>j&&l>j&&m>j&&n>j&&o>j?(g=-.5,d[0]=-1,d[1]=0,d[2]=0):l>k&&m>k&&n>k&&o>k?(g=.5,d[0]=1,d[1]=0,d[2]=0):m>l&&n>l&&o>l?(h=-.5,d[0]=0,d[1]=-1,d[2]=0):n>m&&o>m?(h=.5,d[0]=0,d[1]=1,d[2]=0):o>n?(i=-.5,d[0]=0,d[1]=0,d[2]=-1):(i=.5,d[0]=0,d[1]=0,d[2]=1),-.5>g?g=-.5:g>.5&&(g=.5),-.5>h?h=-.5:h>.5&&(h=.5),-.5>i?i=-.5:i>.5&&(i=.5),c[0]=g,c[1]=h,c[2]=i,this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Cylinder=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return 1>=e*e+g*g&&f>=-1&&1>=f},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e*e+g*g>=1||-1>=f||f>=1},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform);var f,g,h=c[0],i=c[1],j=c[2];-1>i?(d[0]=0,d[1]=-1,d[2]=0):i>1?(d[0]=0,d[1]=1,d[2]=0):(g=h*h+j*j,f=Math.sqrt(g),d[0]=h/f,d[1]=0,d[2]=j/f),-1>i&&(i=-1),i>1&&(i=1),g=g||h*h+j*j,g>1&&(f=f||Math.sqrt(f),h/=f,j/=f),c[0]=h,c[1]=i,c[2]=j,this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),Human.media=Human.media||{},Human.media.Clips=function(a){"use strict";var b=this;this._streamType=a,this.clips={},this.clipsList=[],this.libraries={},this.suggestedClips=[],Human.events.fire(this._streamType+".clips",b.clipsList,!0),b.getClipById=function(a){var b=null;return this.clipsList.forEach(function(c){c.clipId===a&&(b=c)}),b},this.createLibrary=function(a,b){if(this.libraries[a])return void Human.log.warn("Human.media."+this._streamType+".createLibrary","Library already loaded: "+a);for(var c,d,e=a.split("/"),f=e[0],g=e[1],h=this.libraries[a]={libraryId:a,clips:{}},i=0,j=b.length;j>i;i++)if(c=b[i],c.clipId)if(c.type)if(c.src){(void 0===c.time1||null===c.time1)&&(c.time1=null),(void 0===c.time2||null===c.time2)&&(c.time2=null),this.clips[c.clipId]&&Human.log.error("Human.media."+this._streamType+".createLibrary","Clip 'clipId' clashes with another clip: '"+c.clipId+"' - replacing existing clip");var k=[f,this._streamType,g,c.src].join("/");d={clipId:c.clipId,modelId:f,streamType:this._streamType,subasset:g,displayName:c.displayName,description:c.description||"",time1:c.time1,time2:c.time2,type:c.type||"",src:c.src,fullUrl:k,alternatives:c.alternatives||[],length:c.length||0,suggested:!1,status:"closed"},h.clips[c.clipId]=d,this.clips[c.clipId]=d}else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: src");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: type");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: clipId");this._rebuildClipList()},this._rebuildClipList=function(){this.clipsList=[];for(var a in this.clips)this.clips.hasOwnProperty(a)&&this._insertClipIntoList(this.clipsList,this.clips[a]);Human.events.fire(this._streamType+".clips",this.clipsList,!0)},this._insertClipIntoList=function(a,b){if(0===a.length)a.push(b);else{for(var c,d=a.length-1;d>=0;d--)if(c=a[d],c.time1<b.time1)return void a.splice(d+1,0,b);a.splice(0,0,b)}},this.destroyLibrary=function(a){var b=this.libraries[a];if(!b)return void Human.log.warn("Human.media."+this._streamType+".destroyLibrary","Library not found: "+a);for(var c in b.clips)b.clips.hasOwnProperty(c)&&(delete this.clips[c],Human.events.fire(this._streamType+".status",{clipId:c,status:"destroyed"}));delete this.libraries[a],this._rebuildClipList()},this.open=function(a,b){Human.events.fire(this._streamType+".status",{clipId:a,status:"open"},!0),b()},this.play=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"playing"},!0)},this.scrub=function(a,b){Human.events.fire(this._streamType+".scrubbed",{clipId:a,time:b})},this.pause=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"paused"},!0)},this.stop=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"stopped"},!0)},this.close=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"closed"},!0)},this.reset=function(){for(var a in this.libraries)this.libraries.hasOwnProperty(a)&&this.destroyLibrary(a)}},Human.media.audio=new Human.media.Clips("audio"),Human.media.videos=new Human.media.Clips("videos"),function(){"use strict";function a(a){return void 0===h.libUseCounts[a]?void(h.libUseCounts[a]=1):void h.libUseCounts[a]++}function b(a){return void 0===h.assetUseCounts[a]?void(h.assetUseCounts[a]=1):void h.assetUseCounts[a]++}function c(a){return i[a]||a+"s"}function d(a,d,e,g){f(d,a);var i,j,k;if(!e||e===h.server.TIMEOUT){for(e||(h.nullAssets[d]=!0),h.loadedAssets[d]=null,i=l[d],j=0,k=i.length;k>j;j++)i[j](null);return void delete l[d]}try{if(g){var m="morph"===a||"geometry"===a,n=new XMLHttpRequest;n.open("PUT","/assets/"+d,!0),n.send(m?e:JSON.stringify(e))}if("transform"===a){for(i=l[d],j=0,k=i.length;k>j;j++)i[j](e);delete h.loadedAssets[d],delete l[d]}else{var o=Human.assets[c(a)];o.parseAsset(d,e,function(a){for(h.loadedAssets[d]=a,i=l[d],j=0,k=i.length;k>j;j++)b(d),i[j](a);delete l[d]})}}catch(p){Human.log.error("Error parsing asset: "+d+" - "+p.message),h.loadedAssets[d]=null,h.nullAssets[d]=!0;for(var i=l[d],j=0,k=i.length;k>j;j++)i[j](null);delete l[d]}}function e(){Human.events.fire("assets.load.start"),Human.stats.loadSequence.assetsRequested=Human.timer.now(),Human.stats.loadTimes.preAsset=Human.stats.loadSequence.assetsRequested-Human.stats.loadSequence.startTime}function f(a,b){n++,Human.events.fire("assets.load.progress",{assetId:a,assetType:b,requestedAssets:m,receivedAssets:n}),n===m&&g()}function g(){Human.events.fire("assets.load.finish"),m=0,n=0,Human.stats.loadSequence.assetsLoaded=Human.timer.now(),Human.stats.loadTimes.assetDownload=Human.stats.loadSequence.assetsLoaded-Human.stats.loadSequence.assetsRequested,Human.renderer.resetFrameThrottling()}var h=Human.assets={loadedAssets:{},nullAssets:{},assetUseCounts:{},libUseCounts:{}},i={geometry:"geometries",audio:"audio",videos:"video"},j={},k={},l={},m=0,n=0;h.init=function(){this.server.init(),this.geometries.init(),this.materials.init(),this.morphs.init(),this.reflections.init()},h.getAsset=function(a,c,f){if(h.nullAssets[a])return void(f&&Human.utils.async(function(){f(null)}));if("LOADING"===h.loadedAssets[a])return void(f&&l[a].push(f));if(h.loadedAssets[a])return b(a),void(f&&Human.utils.async(function(){f(h.loadedAssets[a])}));if(0===m&&e(),m++,h.loadedAssets[a]="LOADING",l[a]=[],f&&l[a].push(f),window.localContentOnly||Human.mobile.iOS||Human.mobile.android){var g="morph"===c||"geometry"===c,i=a;window.localContentOnly&&(a=a.replace(/\|/g,"/").replace(/:/g,";")+".bda");var j=new XMLHttpRequest;j.responseType=g?"arraybuffer":"text",j.open("GET",window.localBaseDirectory+"assets/"+a,!0),j.onerror=function(){window.localContentOnly?d(c,i,null,!1):h.server.getAsset(c,i,function(a){d(c,i,a,!0)})},j.onload=function(){if(200===j.status||window.localContentOnly){var b=j.response,e=g?b:JSON.parse(b);window.localContentOnly&&!g&&(e=e.asset),d(c,i,e,!1)}else h.server.getAsset(c,a,function(b){d(c,a,b,!0)})},j.send(null)}else h.server.getAsset(c,a,function(b){d(c,a,b,!1)})},h.getAssetLibrary=function(b,d,e,f,g,i){return k[e]?void Human.utils.async(i):h.libUseCounts[e]?(a(e),void Human.utils.async(i)):void h.server.getAssetLibrary(d,e,f,function(d){var f;if(!d)return k[e]=!0,void(i&&i());if(h.libUseCounts[e])return a(e),void(i&&i());if("animation"===b){if("binary"===d.format)return void(i&&i());f=Human.assets.tweens}else f=Human.assets[c(b)];f?f.parseLibrary(e,d,g,function(){a(e),j[e]=f,i&&i()}):(Human.log.error("Unknown asset library type: "+b),i&&i())})},h.putAssetLibrary=function(a){if(void 0!==h.libUseCounts[a]&&--h.libUseCounts[a]<=0){delete h.libUseCounts[a];var b=j[a];b&&b.unloadLibrary&&b.unloadLibrary(a),delete j[a]}},h.putAsset=function(a){if(void 0!==this.assetUseCounts[a]&&--this.assetUseCounts[a]<=0){var b=h.loadedAssets[a],d=Human.assets[c(b.type)];d.destroyAsset(a),delete h.loadedAssets[a],delete this.assetUseCounts[a]}}}(),function(){"use strict";function a(){var a=new WebSocket(h);return a.binaryType="arraybuffer",a.addEventListener("open",function(){a.send(JSON.stringify({open:"sesame!"}));for(var b=0,c=l.length;c>b;b++)l[b]();l.length=0}),a.addEventListener("close",function(a){Human.log.log("Socket closed",a.code,a.reason)}),a.addEventListener("error",function(){Human.log.error("Socket error")}),a.addEventListener("message",function(a){var b,f,g=a.data;if(e=Date.now(),"string"==typeof g){if(""===g)return;var h=JSON.parse(g);f=h.id,c(f,g),h.error?(Human.log.error("Asset not found: "+f),b=null):h.asset?b=h.asset:(Human.log.error("Null asset: "+f),b=null)}else{b=g;var i,j,k=new DataView(b),l=k.getUint32(0,!0);17===l?(j=new Uint32Array(b,0,2)[1],i=11*Uint32Array.BYTES_PER_ELEMENT):(j=k.getUint32(4,!0),i=k.getUint32(12,!0)),f=Human.utils.atos(b,i,j).trim(),d(f,g)}var n=m[f];if(n){for(var o=0,p=n.length;p>o;o++)n[o](b);delete m[f]}}),a}function b(){if(0!==n.length){if(e=Date.now(),g.readyState===WebSocket.OPEN)return g.send(JSON.stringify({assets:n})),void(n.length=0);l.push(function(){g.send(JSON.stringify({assets:n})),n.length=0}),(g.readyState===WebSocket.CLOSING||g.readyState===WebSocket.CLOSED)&&(g=a())}}function c(a,b){if(Human.stats.trackingDownloadSize){var c=Human.utils.textGzipSize(b);Human.stats.jsonDownloadSizes[a]=c,Human.stats.jsonDownloadTotal+=c}}function d(a,b){if(Human.stats.trackingDownloadSize){var c=Human.utils.binaryGzipSize(b);Human.stats.geometryDownloadSizes[a]=c,Human.stats.geometryDownloadTotal+=c}}var e,f,g,h,i=Human.assets.server={TIMEOUT:1},j=12e4,k="true"===Human.request.getSearchParam("__bdh_engine_draco"),l=[],m={},n=[],o={geometry:"geometry"},p={},q={},r=!1;Human.properties.subscribe({propId:"assetDomain",value:"assets-human.biodigital.com",callback:function(a){f=a}}),i.init=function(){if(!r){var c="https:"===window.location.protocol?"wss:":"ws:";(Human.mobile.android||Human.mobile.iOS)&&(c="wss:"),h=c+"//"+f+"/assets/ws"+(k?4:3),g=a(),setInterval(function(){b();var a=Date.now();if(a-e>j)for(var c in m)if(m.hasOwnProperty(c)){Human.log.error("Server timeout on asset: "+c);for(var d=m[c],f=0,g=d.length;g>f;f++)d[f](i.TIMEOUT);delete m[c]}},100),r=!0}},i.cacheModuleDefinition=function(a,b){return p[a]?void 0:b?void(p[a]=JSON.stringify(b)):void i.getModuleDefinition(a)},i.getModuleDefinition=function(a,b,d){return p[a]?void(b&&b(JSON.parse(p[a]))):(Human.stats.loadSequence.moduleRequest=Human.timer.now(),Human.stats.loadTimes.preModule=Human.stats.loadSequence.moduleRequest-Human.stats.loadSequence.startTime,void Human.utils.getText(window.localBaseDirectory+"content/modules/"+a,function(d){c(a,d),p[a]=d,Human.stats.loadSequence.moduleLoaded=Human.timer.now(),Human.stats.loadTimes.moduleDownload=Human.stats.loadSequence.moduleLoaded-Human.stats.loadSequence.moduleRequest,b&&b(JSON.parse(d))},function(b,c,e){Human.events.fire("net.error",{id:a,type:"modules",status:b.status,statusText:b.statusText}),d&&d(e)}))},i.cacheStateIndex=function(a,b){return q[a]?void 0:b?void(q[a]=JSON.stringify(b)):void Human.utils.getText(window.localBaseDirectory+"content/states/"+a+"/index?v="+Human.VERSION+"&locale="+Human.locale,function(b){c(a+"/index",b),q[a]=b})},i.getStateIndex=function(a,b,d){return q[a]?void(b&&b(JSON.parse(q[a]))):void Human.utils.getText(window.localBaseDirectory+"content/states/"+a+"/index?v="+Human.VERSION+"&locale="+Human.locale,function(d){c(a+"/index",d),b(JSON.parse(d))},d)},i.getAnimationManifest=function(a,b,d){var e=a.split("/");Human.utils.getText(window.localBaseDirectory+"content/states/"+e[0]+"/animations/"+e[1]+"/manifest",function(d){c(a,d),b(JSON.parse(d))},d)},i.getAsset=function(a,b,c){var d=b.split("/"),e=d[0],f=d[1],g=d[2],h=e+"/"+(o[a]||a+"s")+"/"+f;return g&&(h+="/"+g),m[h]?void m[h].push(c):(m[h]=[c],void n.push(h))},i.getAssetLibrary=function(a,b,c,d){var e=b.split("/");Human.utils.getJSON(window.localBaseDirectory+"content/states/"+e[0]+"/"+a+"/"+e[1]+"/"+c,d,function(){Human.log.error("Asset library not found: "+b),d(null)})}}(),function(){"use strict";function a(a,b){return function(c){if(Human.stats.trackingDownloadSize){var d=Human.utils.binaryGzipSize(c);Human.stats.textureDownloadSizes[a.compressedSrc]=d,Human.stats.textureDownloadTotal+=d}a.type="texture",a.compressedImage=c,a.src=null,b()}}function b(a,b){return function(){a.compressedSrc=null,c(a,b)}}function c(a,b){if(Human.stats.trackingDownloadSize){var c=a.src;Human.utils.getBinary(c,function(a){Human.stats.textureDownloadSizes[c]=a.byteLength,Human.stats.textureDownloadTotal+=a.byteLength})}var e=new Image;e.onload=d(e,a,b),e.onerror=b,e.src=a.src,a.src=null}function d(a,b,c){return function(){b.type="texture",b.image=a,c()}}function e(a){var b=a.src.replace(/(\.jpg|\.jpeg|\.png)$/,"");return h?(a.compressedSrc=b+"-dxt1.dds",void(a.containerFormat="dds")):i?(a.compressedSrc=b+"-pvrtc.pvr",void(a.containerFormat="pvr")):j?(a.compressedSrc=b+"-etc1.pvr",void(a.containerFormat="pvr")):void 0}function f(a){return a.image||a.compressedImage}var g=Human.assets.textures={},h=SceneJS.checkExtension("WEBGL_compressed_texture_s3tc"),i=SceneJS.checkExtension("WEBGL_compressed_texture_pvrtc"),j=SceneJS.checkExtension("WEBGL_compressed_texture_etc1"),k={add:"over",hack_add:"add"};g.load=function(d,g){function h(){0===--i&&(Human.utils.filterInPlace(d,f),g())}d=d||[];var i=d.length;if(0===i)return void g();for(var j=0;i>j;++j){var l=d[j];l={src:l.src||l.uri,applyTo:l.applyTo,blendMode:k[l.blendMode]||l.blendMode,blendFactor:l.blendFactor,preloadColor:l.preloadColor,preloadSrc:l.preloadSrc},d[j]=l,e(l),l.compressedSrc?Human.utils.getBinary(l.compressedSrc,a(l,h),b(l,h)):c(l,h)}}}(),function(){"use strict";function a(a){var b=a.data[0],c=a.data[1];if(1===b){var d=a.data[2];m[c](i.createGeometry(c,d))}else{var e=a.data[2];Human.log.error("Human.assets.geometries",e+" : "+c)}delete m[c]}function b(){for(var b=0;n>b;b++){var c=Human.workers.loadWorker(l);c.onmessage=a,o[b]=c}}function c(a,b){var c=b.subarray(0,3),d=b.subarray(3,6),e=mat4.create();return mat4.fromScaling(q,d),mat4.fromTranslation(r,c),mat4.multiply(e,r,q),a.positionTranslate=c,a.positionScale=d,a.geometry.positionDecodeMat=e,a}function d(a,b,c){a.geometry.uvDecodeMats=new Array(c),a.uvTranslates=new Array(c),a.uvScales=new Array(c);for(var d=0;c>d;d++){var e=4*d,f=a.uvTranslates[d]=b.subarray(e,e+2),g=a.uvScales[d]=b.subarray(e+2,e+4);mat3.fromScaling(s,g),mat3.fromTranslation(t,f),a.geometry.uvDecodeMats[d]=mat3.create(),mat3.multiply(a.geometry.uvDecodeMats[d],t,s)}return a}function e(a,b,c,d){var e=new Uint32Array(a,0,11),f=e[1],g=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=11*Uint32Array.BYTES_PER_ELEMENT,o=n+f,p=o+g,q=p+j,r=q+k,s=r+l,t=0;j>0&&(b.geometry.positions=new Float32Array(a,p,j/Float32Array.BYTES_PER_ELEMENT),b.boundary=h(b.geometry.positions),t=b.geometry.positions.length/3),k>0&&(b.geometry.normals=new Float32Array(a,q,k/Float32Array.BYTES_PER_ELEMENT)),m>0&&(b.geometry.uv=new Float32Array(a,s,m/Float32Array.BYTES_PER_ELEMENT)),l>0&&(b.geometry.indices=new Uint32Array(a,r,l/Uint32Array.BYTES_PER_ELEMENT),256>=t?b.geometry.indices=new Uint8Array(b.geometry.indices):65536>=t&&(b.geometry.indices=new Uint16Array(b.geometry.indices))),d(i.createGeometry(c,b))}function f(a,b,e,f){var g,j,l=new DataView(a),m=l.getUint32(4,!0),n=l.getUint32(8,!0),o=l.getUint32(12,!0),p=l.getUint32(16,!0),q=l.getUint32(20,!0),r=l.getUint32(24,!0),s=l.getUint32(28,!0),t=l.getUint16(32,!0),u=l.getUint8(34),v=l.getUint8(35),w=new Array(v);for(j=0,g=36;v>j;j++,g+=6)w[j]={uvSize:l.getUint32(g,!0),uvDecodeSize:l.getUint16(g+4,!0)};if(g=o+m+n,t>0&&(c(b,new Float32Array(a,g,t/Float32Array.BYTES_PER_ELEMENT)),g+=t),v>0&&(d(b,new Float32Array(a,g,4*v),v),g+=16*v),q>0&&(b.geometry.positions=new Uint16Array(a,g,q/Uint16Array.BYTES_PER_ELEMENT),b.boundary=h(b.geometry.positions,b.positionScale,b.positionTranslate),g+=q),v>0)for(b.geometry.uvs=new Array(v),j=0;v>j;j++)b.geometry.uvs[j]=new Uint16Array(a,g,w[j].uvSize/Uint16Array.BYTES_PER_ELEMENT),g+=w[j].uvSize;if(r>0&&(b.geometry.normals=new Int8Array(a,g,r/Int8Array.BYTES_PER_ELEMENT),g+=r),s>0){var x=k[u];b.geometry.indices=new x(a,p,s/x.BYTES_PER_ELEMENT)}f(i.createGeometry(e,b))}function g(a,b,e,f){var g=new DataView(a),h=g.getUint32(12,!0),i=g.getUint32(4,!0),j=g.getUint32(8,!0),k=24,l=g.getUint8(22,!0),q=16*l,r=h,s=r+i,t=s+j,u=t+k,v=u+l*q,w=g.getUint32(16,!0),x=new Int8Array(a,v,w/Int8Array.BYTES_PER_ELEMENT);c(b,new Float32Array(a,t,k/Float32Array.BYTES_PER_ELEMENT)),l>0&&d(b,new Float32Array(a,u,q/Float32Array.BYTES_PER_ELEMENT),l),m[e]=f;var y=p%n;o[y].postMessage([x,e,b],[x.buffer]),
p++}function h(a,b,c){b=b||v,c=c||u;for(var d,e,f,g=1e5,h=1e5,i=1e5,j=-1e5,k=-1e5,l=-1e5,m=0,n=a.length-2;n>m;m+=3)d=a[m]*b[0]+c[0],e=a[m+1]*b[1]+c[1],f=a[m+2]*b[2]+c[2],g>d&&(g=d),h>e&&(h=e),i>f&&(i=f),d>j&&(j=d),e>k&&(k=e),f>l&&(l=f);return{xmin:g,ymin:h,zmin:i,xmax:j,ymax:k,zmax:l}}var i=Human.assets.geometries={};i.geometries={};var j,k={1:Uint8Array,2:Uint16Array,4:Uint32Array},l="draco/worker.js",m={},n=2,o=new Array(n),p=0;i.init=function(){b(),j=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Geometry library"})},i.parseAsset=function(a,b,c){var d=new Uint32Array(b,0,1)[0],h={geometry:{primitive:"triangles"},draco:19===d,compressed:17!==d};h.draco?g(b,h,a,c):h.compressed?f(b,h,a,c):e(b,h,a,c)},i.createGeometry=function(a,b){if(i.geometries[a])return void Human.log.error("Human.assets.geometries.createGeometry","Geometry already loaded: "+a);if(!b.geometry)return void Human.log.error("Human.assets.geometries.createGeometry","Mandatory attribute 'geometryId' expected on geometry: "+a);b.geometry.type="geometry";var c={geometry:j.addNode(b.geometry),type:"geometry",compressed:b.compressed},d=b.boundary;if(!d){var e=null,f=null;if(b.geometry.positionDecodeMat){var g=b.geometry.positionDecodeMat;e=new Float32Array([g[0],g[5],g[10]]),f=new Float32Array([g[12],g[13],g[14]])}d=h(b.geometry.positions,e,f)}return c.boundary=d,c.center=[.5*(d.xmax+d.xmin),.5*(d.ymax+d.ymin),.5*(d.zmax+d.zmin)],c.axisBoundary=new Float32Array([d.xmin,d.ymin,d.zmin,d.xmax,d.ymax,d.zmax]),i.geometries[a]=c,c},i.getCompressionStats=function(){var a={compressed:0,uncompressed:0};for(var b in i.geometries)i.geometries.hasOwnProperty(b)&&(i.geometries[b].compressed?a.compressed++:a.uncompressed++);return a},i.destroyAsset=function(a){if(a){var b=i.geometries[a];b.geometry.destroy(),delete i.geometries[a]}else i.reset()},i.reset=function(){for(var a in i.geometries)i.geometries.hasOwnProperty(a)&&i.destroyAsset(a)};var q=mat4.create(),r=mat4.create(),s=mat3.create(),t=mat3.create(),u=vec3.fromValues(0,0,0),v=vec3.fromValues(1,1,1)}(),function(){"use strict";function a(b,c,e){e=e||{};var f,g;switch(b.id&&(b.id=null),b.type){case"texture":var h;for(f=0,g=b.layers.length;g>f;f++)h=b.layers[f],h.src=h.uri||h.src,d||(h.src=c+h.src),h.preloadURI=h.preloadURI||h.preloadSrc,h.preloadURI&&(d?h.preloadURI+="?v="+Human.VERSION:h.preloadURI=c+h.preloadURI+"?v="+Human.VERSION),h.blendMode=h.blendMode||"over","add"===h.blendMode?h.blendMode="over":"forceAdd"===h.blendMode&&(h.blendMode="add");e&&(e.texture=b);break;case"material":if(e){e.material=b;var i,j,k,l,m;if(b.reflectionId){if(i=b.reflectionId,k=Human.assets.reflections,l=k.exportedReflectionIds[i],!l){var n=c.split("/");if(n.length>3){var o=n[3];i=o+"/"+i,l=k.exportedReflectionIds[i],l||Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+i)}}l&&(m=Human.assets.reflections.reflections[l],m?e.reflection=m.node:Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+i))}b.lightmapId&&(j=b.lightmapId,k=Human.assets.reflections,l=k.exportedReflectionIds[j],l?(m=Human.assets.reflections.reflections[l],m?e.lightmap=m.node:Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+i)):Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+i))}break;case"flags":e&&(e.flags=b)}if(b.nodes){for(f=0,g=b.nodes.length;g>f;f++)a(b.nodes[f],c,e);b.nodes=null}return e}var b=Human.assets.materials={};b.materials={};var c,d=!1;b.init=function(){c=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Materials library"})},b.parseAsset=function(c,d,e){var f=c.split("/"),g=f[1].split(".")[0],h=window.localBaseDirectory+"content/states/"+f[0]+"/materials/"+g+"/";b.createMaterial(c,a(d,h),e)},b.findMaterial=function(a){var c=b.materials[a];return c?c:null},b.createMaterial=function(a,d,e){if(b.materials[a])return void Human.log.warn("Human.assets.materials.createMaterial","Material already loaded: "+a);var f={type:"material",textureCompressionStats:{compressed:0,uncompressed:0},hasAlphaTexture:!1,hasAlphaFresnel:!1,partiallyOpaque:!1};if(d.material){f.material=c.addNode({type:"material",workflow:d.material.workflow,baseColor:d.material.baseColor,specularColor:d.material.specularColor,emitColor:d.material.emitColor,shine:d.material.shine,alpha:d.material.alpha,emit:d.material.emit,metallic:d.material.metallic,roughness:d.material.roughness,specularf0:d.material.specularf0}),f.glassFactor=void 0!==d.material.glassFactor&&null!==d.material.glassFactor?d.material.glassFactor:1,f.murkiness=void 0!==d.material.murkiness&&null!==d.material.murkiness?d.material.murkiness:1;var g,h,i;d.material.baseFresnel&&(g=d.material.baseFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:1,g:1,b:1},i=void 0!==g.center?g.center:{r:0,g:0,b:0},f.fresnels.color=c.addNode({type:"fresnel",applyTo:"color",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"})),d.material.alphaFresnel&&(g=d.material.alphaFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:0,i=void 0!==g.center?g.center:1,f.fresnels.alpha=c.addNode({type:"fresnel",applyTo:"alpha",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"}),f.hasAlphaFresnel=!0),d.material.transparencyFresnel&&(g=d.material.transparencyFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:0,i=void 0!==g.center?g.center:1,f.fresnels.transparency=c.addNode({type:"fresnel",applyTo:"transparency",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"}),f.hasAlphaFresnel=!0),d.material.reflectionFresnel&&(g=d.material.reflectionFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:1,i=void 0!==g.center?g.center:0,f.fresnels.reflect=c.addNode({type:"fresnel",applyTo:"reflect",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"})),d.material.specularFresnel&&(g=d.material.specularFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:0,g:0,b:0},i=void 0!==g.center?g.center:{r:1,g:1,b:1},f.fresnels.specular=c.addNode({type:"fresnel",applyTo:"specular",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"})),d.material.emitFresnel&&(g=d.material.emitFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:0,g:0,b:0},i=void 0!==g.center?g.center:{r:1,g:1,b:1},f.fresnels.emit=c.addNode({type:"fresnel",applyTo:"emit",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"}))}else f.glassFactor=1,f.murkiness=1;d.reflection&&(f.reflection=c.addNode({type:"cubemap",applyTo:"reflect",coreId:d.reflection.getCoreId()})),d.lightmap&&(f.lightmap=c.addNode({type:"cubemap",applyTo:"light",coreId:d.lightmap.getCoreId()}));var j,k;d.flags&&d.flags.flags.skybox&&(j=!1,k=Number.MIN_SAFE_INTEGER),d.flags&&(f.flags={skybox:d.flags.flags.skybox,billboard:d.flags.flags.billboard,frontface:d.flags.flags.frontface,backfaces:d.flags.flags.backfaces,addBlend:d.flags.flags.addBlend},f.partiallyOpaque=!!f.flags.partiallyOpaque);var l=d.texture?d.texture.layers:[];Human.assets.textures.load(l,function(){f.textures=new Array(l.length);for(var d=0,g=l.length;g>d;++d)l[d].compressedSrc?f.textureCompressionStats.compressed++:f.textureCompressionStats.uncompressed++,("alpha"===l[d].applyTo||"transparency"===l[d].applyTo)&&(f.hasAlphaTexture=!0),f.textures[d]=c.addNode(l[d]);b.materials[a]=f,e(f)})},b.getTextureCompressionStats=function(){var a={compressed:0,uncompressed:0};for(var c in b.materials)b.materials.hasOwnProperty(c)&&(a.compressed+=b.materials[c].textureCompressionStats.compressed,a.uncompressed+=b.materials[c].textureCompressionStats.uncompressed);return a},b.destroyAsset=function(a){if(a){var c=b.materials[a];for(var d in c)c.hasOwnProperty(d)&&"function"==typeof c[d].destroy&&c[d].destroy();delete b.materials[a]}else b.reset()},b.reset=function(){for(var a in b.materials)b.materials.hasOwnProperty(a)&&b.destroyAsset(a)}}(),function(){"use strict";function a(a){for(var b,c={morphGeometry:{}},d=new Uint32Array(a,0,11),e=d[1],f=d[2],g=d[3],h=d[4],i=d[5],j=d[6],k=11*Uint32Array.BYTES_PER_ELEMENT,l=k+e,m=l+f,n=m+g,o=n+h,p=o+i,q=c.morphGeometry.keys=Human.utils.atoj(a,l,f),r=q.length,s=c.morphGeometry.targets=[],t=g/r,u=t/Float32Array.BYTES_PER_ELEMENT,v=h/r,w=v/Float32Array.BYTES_PER_ELEMENT,x=j/r,y=j/Float32Array.BYTES_PER_ELEMENT,z=0;r>z;z++)b={},g>0&&(b.positions=new Float32Array(a,m+z*t,u)),h>0&&(b.normals=new Float32Array(a,n+z*v,w)),j>0&&(b.uvs=new Float32Array(a,p+z*x,y)),s.push(b);return c}function b(a){var b,c,d={},g=new DataView(a),h=g.getUint32(4,!0),i=g.getUint32(8,!0),j=g.getUint32(12,!0),k=g.getUint32(20,!0),l=g.getUint32(24,!0),m=g.getUint16(32,!0),n=g.getUint8(34),o=new Array(n);for(c=0,b=36;n>c;c++,b+=5)o[c]={uvSize:g.getUint32(b,!0),uvDecodeSize:g.getUint8(b+4)};b=j+h,d.morphGeometry=Human.utils.atoj(a,b,i);var p,q=d.morphGeometry.keys,r=q.length,s=d.morphGeometry.targets=new Array(r);for(c=0;r>c;c++)s[c]={};d.positionTranslates=new Array(r),d.positionScales=new Array(r);var t=m/r,u=k/r,v=u/Uint16Array.BYTES_PER_ELEMENT,w=l/r,x=w/Int8Array.BYTES_PER_ELEMENT;if(b+=i,m>0)for(c=0;r>c;c++){p=s[c];var y=d.positionTranslates[c]=new Float32Array(a,b,3),z=d.positionScales[c]=new Float32Array(a,b+12,3);mat4.fromScaling(e,z),mat4.fromTranslation(f,y),p.positionDecodeMat=mat4.create(),mat4.multiply(p.positionDecodeMat,f,e),b+=t}if(k>0){for(c=0;r>c;c++)s[c].positions=new Uint16Array(a,b+c*u,v);b+=k}if(l>0)for(c=0;r>c;c++)s[c].normals=new Int8Array(a,b+c*w,x);return d}var c=Human.assets.morphs={};c.morphs={};var d;c.init=function(){d=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Morphs library"})},c.parseAsset=function(c,d,e){var f,g=new Uint32Array(d,0,1)[0];f=17===g?a(d):b(d),e(Human.assets.morphs.createMorph(c,f))},c.findMorph=function(a){var b=c.morphs[a];return b?b:null},c.createMorph=function(a,b){var e=c.morphs[a];if(e)return Human.log.warn("Human.assets.morphs.createMorph","Morph already loaded: "+a),e;b.morphGeometry.type="morphGeometry";for(var f=d.addNode(b.morphGeometry),g=f.getTargets(),h={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},i=vec3.create(),j=Human.math.decompressPosition,k=0,l=g.length;l>k;++k)for(var m=g[k],n=m.positions,o=m.positionDecodeMat,p=0,q=n.length;q>p;p+=3)i[0]=n[p],i[1]=n[p+1],i[2]=n[p+2],o&&j(i,i,o),i[0]<h.xmin&&(h.xmin=i[0]),i[0]>h.xmax&&(h.xmax=i[0]),i[1]<h.ymin&&(h.ymin=i[1]),i[1]>h.ymax&&(h.ymax=i[1]),i[2]<h.zmin&&(h.zmin=i[2]),i[2]>h.zmax&&(h.zmax=i[2]);e={type:"morph",morphGeometry:f,boundary:h,center:[.5*(h.xmax+h.xmin),.5*(h.ymax+h.ymin),.5*(h.zmax+h.zmin)],positionTranslates:b.positionTranslates,positionScales:b.positionScales};var r=new Human.assets.morphs.Animation,s=b.morphGeometry.keys;r.addMorph(s[0],s[s.length-1],function(a){e.morphGeometry.setFactor(a)}),r.calculateTimeFrame(),Human.timeline.addAnimation(a,r);var t=a.split("/")[0],u=Human.timeline.leafTimelines[t]||new Human.timeline.LeafTimeline(t);return u.addAnimation(a,r),c.morphs[a]=e,e},c.destroyAsset=function(a){if(a){var b=c.morphs[a];if(!b)return void Human.log.warn("Human.assets.morphs.destroyMorph","Morph not found: "+a);b.morphGeometry.destroy(),delete c.morphs[a]}else c.reset()},c.reset=function(){for(var a in c.morphs)c.morphs.hasOwnProperty(a)&&c.destroyAsset(a)};var e=mat4.create(),f=mat4.create()}(),function(){"use strict";Human.assets.morphs.Animation=function(a){a=a||{},this.type="morph-animation",this._loop=a.loop!==!1,this._morphList=[],this.timeline=a.timeline,this.firstTime=null,this.lastTime=null},Human.assets.morphs.Animation.prototype.addMorph=function(a,b,c){this._morphList.push({firstTime:a,lastTime:b,update:c})},Human.assets.morphs.Animation.prototype.calculateTimeFrame=function(){for(var a,b=1e6,c=-1e6,d=this._morphList,e=0,f=this._morphList.length;f>e;e++)a=d[e],a.firstTime<b&&(b=a.firstTime),a.lastTime>c&&(c=a.lastTime);this.firstTime=b,this.lastTime=c},Human.assets.morphs.Animation.prototype.update=function(a,b){for(var c,d,e=0,f=this._morphList.length;f>e;e++)c=this._morphList[e],this._loop?d=b===c.lastTime?b:c.firstTime+b%(c.lastTime-c.firstTime):(d<c.firstTime&&(d=c.firstTime),d>c.lastTime&&(d=c.lastTime)),c.update(d)},Human.assets.morphs.Animation.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";var a=Human.assets.lights={lightIds:{}};a.parseLibrary=function(b,c,d,e){var f=a.lightIds[b];if(f)return Human.log.warn("Human.assets.lights.parseLibrary","library already loaded"),void e();var g=c.lights;if(!g)return Human.log.error("Human.assets.lights.parseLibrary","'lights' section expected in lights library"),void e();f=a.lightIds[b]=[],Human.renderer.lights.clearEnabled();for(var h,i,j=0,k=g.length;k>j;j++)h=g[j],h.lightId?(i=b+"."+h.lightId,h.lightId=i,h.enabled=!0,Human.renderer.lights.addLight(h),f.push(i)):(Human.log.error("Human.assets.lights.load","'lightId' missing on light"),e());e&&e()},a.unloadLibrary=function(b){var c=a.lightIds[b];if(!c)return void Human.log.warn("Human.assets.lights.unloadLibrary","library not loaded");var d,e,f=Human.renderer.lights;for(d=0,e=c.length;e>d;d++)f.removeLight(c[d]);delete a.lightIds[b]}}(),function(){"use strict";function a(a,b){return a&&b?b.indexOf(".")<0?a+"-"+b:b:null}var b=Human.assets.tweens={};b.parseLibrary=function(b,c,d,e){var f,g,h,i,j,k,l,m,n=c.tweens||{},o=[],p=b.split("/")[0];Human.timeline.leafTimelines.hasOwnProperty(p)||(m=new Human.timeline.LeafTimeline(p));for(var q in n)if(n.hasOwnProperty(q)){if(f=n[q],!f.keys){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'keys'");continue}if(!f.targets){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'targets'");continue}if(f.keys.length<2||f.targets.length<2){Human.log.error("Human.timeline.tweenAnimationLoader","tween has insufficient keys or targets - minimum of two required");continue}if(f.keys.length!==f.targets.length){Human.log.error("Human.timeline.tweenAnimationLoader","tween has mismatching numbers of keys and targets");continue}if(f.options=Human.utils.applyIf(this.options,f.options||{}),g=f.type,!g){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'type'");continue}if(j=g.split(":"),h=j[0],i=j[1],"lerp"===h&&(h="tween"),!h||!i){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute invalid: 'type'");continue}switch(i){case"objectAttr":k=new Human.timeline.ObjectControl({modelId:p,objectId:a(p,f.objectId||f.targetId),objectIds:f.objectIds,id:q});break;case"objectXForm":k=new Human.timeline.ObjectTransformControl({modelId:p,objectId:a(p,f.objectId||f.targetId),initial:f.targets[0]});break;case"material":k=new Human.timeline.MaterialControl({modelId:p,materialId:a(p,f.materialId||f.targetId),attributes:f.targets[0]});break;case"texture":k=new Human.timeline.TextureControl({modelId:p,materialId:a(p,f.materialId||f.targetId),targetLayer:f.targetLayer});break;case"fresnel":k=new Human.timeline.FresnelControl({modelId:p,materialId:a(p,f.materialId),fresnelType:f.fresnelType});break;case"particleSystem":k=new Human.timeline.ParticleSystemControl({particleSystemId:f.particleSystemId});break;case"particleComponent":k=new Human.timeline.ParticleComponentControl({particleSystemId:f.particleSystemId,componentId:f.componentId});break;case"camera":k=new Human.timeline.CameraControl;break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+g);continue}switch(h){case"tween":l=new Human.timeline.Tween({keys:f.keys,targets:f.targets,control:k});break;case"switch":l=new Human.timeline.Switch({keys:f.keys,targets:f.targets,control:k});break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+g);continue}o.push(l)}if(o.length>0){var r=new Human.timeline.TweenAnimation({tweens:o});Human.timeline.addAnimation(b,r)}m=Human.timeline.leafTimelines[p],m.addAnimation(b,Human.timeline.animations[b]),e&&e()},b.unloadLibrary=function(a){var b=a.split("/")[0];Human.timeline.leafTimelines[b].unload("tweens")}}(),function(){"use strict";var a=Human.assets.reflections={},b={};a.reflections={},a.exportedReflectionIds={};var c;a.init=function(){c=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Reflections library"})},a.parseLibrary=function(c,d,e,f){var g=b[c];if(g)return Human.log.warn("Human.assets.reflections.parseLibrary","library already loaded"),void f();g=[],b[c]=g;var h,i,j,k,l=c.split("/"),m=window.localBaseDirectory+"content/states/"+l[0]+"/reflections/"+l[1]+"/",n=Human.renderer.graph;for(var o in d)if(d.hasOwnProperty(o)){if(h=d[o],h.type="reflect",h.blendMode=h.blendMode||"add",i=h.src,!i){Human.log.error("Human.assets.reflections.loader","Reflection property missing: src");continue}if(!Human.utils.isArray(i)){Human.log.error("Human.assets.reflections.loader","Reflection property should be array: src");continue}for(var p=0,q=i.length;q>p;p++)i[p]=m+i[p]+"?v="+Human.VERSION;j=c+"."+o,k={applyTo:h.applyTo||"reflect",node:n.insertNode(Human.renderer.getLibraryRoot(),h)},a.reflections[j]=k,"reflect"===k.applyTo?Human.renderer.getScene().createReflection(j,{src:h.src,intensity:h.intensity,space:h.space||"world"}):Human.renderer.getScene().createLightmap(j,{src:h.src,intensity:h.intensity,space:h.space||"world"}),g.push(j)}Human.renderer.compile(),f&&f()},a.exportReflections=function(b){b=b||{};for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];-1===d.indexOf("/")&&(b[c]=d.replace(/^([^\.]+)\./,"$1/"))}a.exportedReflectionIds=b||{}},a.unloadLibrary=function(c){var d=b[c];if(!d)return void Human.log.warn("Human.assets.reflections.unloadLibrary","library not loaded");var e,f,g,h;for(e=0,f=d.length;f>e;e++)g=d[e],h=a.reflections[g],h.node.destroy(),"reflect"===h.applyTo?Human.renderer.getScene().destroyReflection(g):Human.renderer.getScene().destroyLightmap(g);a.exportedReflectionIds={},delete b[c]}}(),function(){"use strict";var a=Human.assets.audio={};a.parseLibrary=function(a,b,c,d){Human.media.audio.createLibrary(a,b),d&&d()},a.unloadLibrary=function(a){Human.media.audio.destroyLibrary(a)}}(),function(){"use strict";var a=Human.assets.video={};a.parseLibrary=function(a,b,c,d){Human.media.videos.createLibrary(a,b),d&&d()},a.unloadLibrary=function(a){Human.media.videos.destroyLibrary(a)}}(),function(){"use strict";function a(a,b){return a?a[b]===!0?!0:a[b]===!1?!1:!1:!0}function b(){var a=Human.modules.moduleLibs,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function c(){var a=[];if(Human.modules.numActiveModules>0){var b=Human.modules.activeModules;for(var c in b)b.hasOwnProperty(c)&&a.push(c)}return a}function d(){return Human.renderer.camera.getLookAt()}function e(){return Human.renderer.clip.serialize()}function f(){var a,b,c,d={},e=Human.scene,f=e.objects,h=e.enabledObjects;for(var i in f)f.hasOwnProperty(i)&&(a=f[i],c=null,0===a.objects.length&&h[i]&&(c=c||{},c.enabled=!0,b=g(a),b&&(c.transform=b),c.opacity=a.opacity),c&&(d[i]=c));for(var j=0;j<Human.scene.rootObjects.length;j++)a=Human.scene.rootObjects[j],i=a.objectId,a.shown||(d[i]={enabled:a.shown,opacity:a.opacity});return Human.events.fire("bookmarks.captureObjectStates",{data:d}),d}function g(a){if(null===a.pivot)return null;var b={};return 0!==a.pivot.x&&(b.pivot=b.pivot||{},b.pivot.x=a.pivot.x),0!==a.pivot.y&&(b.pivot=b.pivot||{},b.pivot.y=a.pivot.y),0!==a.pivot.z&&(b.pivot=b.pivot||{},b.pivot.z=a.pivot.z),0!==a.translate.x&&(b.translate=b.translate||{},b.translate.x=a.translate.x),0!==a.translate.y&&(b.translate=b.translate||{},b.translate.y=a.translate.y),0!==a.translate.z&&(b.translate=b.translate||{},b.translate.z=a.translate.z),1!==a.scale.x&&(b.scale=b.scale||{},b.scale.x=a.scale.x),1!==a.scale.y&&(b.scale=b.scale||{},b.scale.y=a.scale.y),1!==a.scale.z&&(b.scale=b.scale||{},b.scale.z=a.scale.z),0!==a.rotate.x&&(b.rotate=b.rotate||{},b.rotate.x=a.rotate.x),0!==a.rotate.y&&(b.rotate=b.rotate||{},b.rotate.y=a.rotate.y),0!==a.rotate.z&&(b.rotate=b.rotate||{},b.rotate.z=a.rotate.z),Object.keys(b).length>0?b:null}function h(a){var b,c=[],d={},e=a.objects;for(b in e)if(e[b].shown||e[b].enabled){var f=Human.modules.convertBaseAnatomyObjectId(b);if(!d[f]){d[f]=!0;var g=Human.scene.objects[f];if(!g){if(f=Human.modules.convertBaseAnatomyObjectId(l(b)),d[f])continue;d[f]=!0,g=Human.scene.objects[f]}g&&g.isLeaf()&&c.push(g)}}return c}function i(a,b){var c=0,d=Human.timeline.rootTimelines[a];if(b.timeline)if(b.timeline.hasOwnProperty("scrub"))try{c=b.timeline.scrub.time}catch(e){c=0}else if(b.timeline.hasOwnProperty("play")){var f=b.timeline.play;try{c=Human.timeline.parsePlayInstruction(f).t}catch(e){c=0}}var g=d.mapGlobalTime(c).index;d._chapters=[d._chapters[g]],d.build()}function j(a,b,c){if(s(a.objects),r(a.modes),q(a.camera,function(){}),Human.renderer.resumeCompilation(),Human.renderer.popPause(),!b||void 0===b)return void(c&&c());var d=h(a),e=["tweens","reflections","audio","videos","lights","skyBoxes","geometry","material","transform","morph"];Human.modules.load(b,d,e,function(){u(a.objects),t(a.clips),p(a),Human.events.fire("bookmarks.restored",a),c&&c()})}function k(a,b){var c=Human.timeline.rootTimelines[b];c._chapters[0].info.displayName=a.title,c._chapters[0].info.description=a.description;var d=Human.modules.modules[b].displayName,e=Human.modules.modules[b].description,f=Human.utils.shallowClone(c._chapters[0].annotations);return c._chapters[0].annotations=a.annotations,Human.modules.modules[b].displayName=a.title,Human.modules.modules[b].description=a.description,Human.modules.modules[b].chapters[0].displayName=a.title,Human.modules.modules[b].chapters[0].description=a.description,{title:d,description:e,annotations:f}}function l(a){return a.replace(/_ID[0-9]+$/,"_ID")}function m(a){var b,c,d,e,f,g={};for(b in Human.scene.objects)Human.scene.objects[b]&&!Human.scene.objects[b].anonymous&&(g[b]={shown:!1});for(b in a)if(a.hasOwnProperty(b)){d=a[b],c=Human.modules.convertBaseAnatomyObjectId(b),c=l(c);var h=Human.scene.objects[c];if(h&&(d.hasOwnProperty("enabled")&&(d.shown=d.enabled,delete d.enabled),d.hasOwnProperty("pickable")||(d.pickable=h.pickable),d.hasOwnProperty("backfaces")||(d.backfaces=h.backfaces),d.hasOwnProperty("opacity")||(d.opacity=h.opacity),d.glassFactor=h.glassFactor,d.murkiness=h.murkiness,g[c]=d),b.match("_ID[0-9]+$"))for(e=Human.scene.getLeaves(c),f=0;f<e.length;f++)Human.scene.objects[e[f]].anonymous&&(a[e[f]]?a[e[f]].shown=d.shown:a[e[f]]={shown:d.shown})}return g}function n(a){a.modules={},a.modules.activeModules=[],a.modules.moduleLibs=[],Human.utils.isObject(a.objects)||(a.objects={});var b=o(a.objects);b&&a.modules.activeModules.unshift(b)}function o(a){var b,c=null;for(var d in a)if(a.hasOwnProperty(d)&&(b=d.match(/^(fe)?maleAdult/))){c=["production",b[0],b[0]+".json"].join("/");break}return c}function p(a){return a.timeline?void(a.timeline.scrub?Human.timeline.scrub(a.timeline.scrub):a.timeline.play&&Human.timeline.play(a.timeline.play)):void Human.timeline.scrub({time:0})}function q(a,b){Human.renderer.camera.fly.flyTo(a,function(){b&&b()})}function r(a){a&&(void 0!==a.highlight&&null!==a.highlight&&Human.rpc.call(null,"highlight.setEnabled",{enable:a.highlight}),Human.scene.anySelected()&&a.isolate?void 0!==a.isolate&&null!==a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:a.isolate}):void 0!==a.isolate&&null!==a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:!1}),void 0!==a.labels&&null!==a.labels&&Human.rpc.call(null,"labels.setEnabled",{enable:a.labels}),void 0!==a.singlePick&&null!==a.singlePick&&Human.rpc.call(null,"pick.single.setEnabled",{enable:a.singlePick}),void 0!==a.multiPick&&null!==a.multiPick&&Human.rpc.call(null,"pick.multi.setEnabled",{enable:a.multiPick}),void 0!==a.xray&&null!==a.xray&&Human.rpc.call(null,"xray.setEnabled",{enable:a.xray}))}function s(a){a=m(a),Human.scene.setObjectProperties(a)}function t(a){Human.renderer.clip.reset();for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];void 0!==c.state&&(("clipping"===c.state||3===c.state||"visible"===c.state||4===c.state)&&(c.enabled=!0),"number"==typeof c.clipId&&c.clipId--),Human.renderer.clip.setClip(a[b])}}function u(a){a=a||{};var b,c,d;for(c in a)a.hasOwnProperty(c)&&(b=Human.scene.objects[c],d=a[c].transform,b&&d&&b.setTransform(v(b,d)))}function v(a,b){var c=a.pivot||{x:0,y:0,z:0},d=a.translate||{x:0,y:0,z:0},e=a.scale||{x:1,y:1,z:1},f=a.rotate||{x:0,y:0,z:0};return b.pivot=b.pivot||{},b.translate=b.translate||{},b.scale=b.scale||{},b.rotate=b.rotate||{},b.pivot.x=void 0===b.pivot.x?c.x:b.pivot.x,b.pivot.y=void 0===b.pivot.y?c.y:b.pivot.y,b.pivot.z=void 0===b.pivot.z?c.z:b.pivot.z,b.translate.x=void 0===b.translate.x?d.x:b.translate.x,b.translate.y=void 0===b.translate.y?d.y:b.translate.y,b.translate.z=void 0===b.translate.z?d.z:b.translate.z,b.scale.x=void 0===b.scale.x?e.x:b.scale.x,b.scale.y=void 0===b.scale.y?e.y:b.scale.y,b.scale.z=void 0===b.scale.z?e.z:b.scale.z,b.rotate.x=void 0===b.rotate.x?f.x:b.rotate.x,b.rotate.y=void 0===b.rotate.y?f.y:b.rotate.y,b.rotate.z=void 0===b.rotate.z?f.z:b.rotate.z,b}var w,x,y=Human.bookmarks={};y.capture=function(g){var h={engineVersion:Human.VERSION};a(g,"modules")&&(h.modules={moduleLibs:b(),activeModules:c()}),a(g,"camera")&&(h.camera=d()),a(g,"clips")&&(h.clips=e()),a(g,"objects")&&(h.objects=f()),a(g,"timeline")&&(h.timeline=Human.timeline.getBookmark()),a(g,"background")&&(h.background={colors:Human.renderer.bg.getBGColor()}),h.plugins={};var i,j=Human.plugins;for(var k in j)j.hasOwnProperty(k)&&(i=j[k],i.writeBookmark&&i.writeBookmark(h));return Human.events.fire("bookmarks.capture",{bookmark:h}),h},y.restore=function(a,b){Human.events.fire("bookmarks.restoring"),Human.utils.isObject(a.modules)||n(a);for(var c=a.modules.activeModules,d=c.length>1,e=[],f=0,g=c.length;g>f;f++)e[f]=Human.modules.convertBaseAnatomyModuleId(c[f]);Human.utils.filterInPlace(e,function(a){return Human.modules.activeModules[a]?!1:d&&Human.modules.isBaseModule(a)?!1:!0});var h=e[0],l={camera:!0,graph:!0,annotations:!0,properties:!0,time:!0,hotspots:!0};if(a.theModuleId=h,Human.renderer.pushPause(),Human.renderer.pauseCompilation(),h)if(Human.modules.modules.hasOwnProperty(h)){var m=Human.modules.moduleData[h];Human.modules.create(h,m,function(){i(h,a);var c=k(a,h);w=c.title,x=c.description,Human.modules.activate(h,0,l,function(){j(a,h,b)})})}else Human.modules.fetch(h,function(){var c=Human.modules.moduleData[h];Human.modules.create(h,c,function(){i(h,a);var c=k(a,h);w=c.title,x=c.description,Human.modules.activate(h,0,l,function(){j(a,h,b)})})});else j(a,h,b)}}(),function(){"use strict";function a(){void 0===window.localBaseDirectory&&(window.localBaseDirectory="/",window.localContentOnly=!1)}var b=5,c=Human.modules={},d=new Human.utils.IDPool;c.modules={},c.moduleData={},c.moduleLibs={},c.activeModules={},c.numActiveModules=0,c.history=[],c.fetch=function(b,d,e){a(),Human.events.fire("modules.fetch.start",{moduleId:b}),Human.assets.server.getModuleDefinition(b,function(a){a.moduleId=b,c.moduleData[b]=a,Human.events.fire("modules.fetch.finish",{moduleId:b,moduleData:a}),d&&d()},function(a){Human.log.info("Human.modules.activateModules","Failed to activate module: '"+b+"' - "+a),e&&e(a)})},c.create=function(d,e,f){a(),e=Human.utils.deepClone(e),Human.events.fire("modules.create.start",{moduleId:d,moduleData:e}),c.modules[d]&&delete c.modules[d];var g=new c.Module(e),h=function(){c.modules[d]=g,Human.events.fire("modules.created",e),Human.events.fire("modules.create.finish",{moduleId:d,module:c.modules[d]}),f&&f()};g.create(h),c.history.unshift(d),c.history.length>b&&c.history.pop()},c.activate=function(a,b,d,e){Human.events.fire("modules.activate.start",{moduleId:a,config:d}),Human.events.fire("modules.activating",{moduleId:a});var f=function(){c.activeModules[a]=c.modules[a],c.numActiveModules++,Human.events.fire("modules.activated",{moduleId:a}),Human.events.fire("modules.activate.finish",{moduleId:a}),e&&e()};c.modules[a].activate(b,d,f)},c.load=function(a,b,d,e){Human.events.fire("modules.load.start",{moduleId:a,graphNodes:b,assetTypes:d});var f=function(){Human.renderer.prepareFrame(),Human.events.fire("modules.load.finish",{moduleId:a,graphNodes:b,assetTypes:d}),e&&e()};c.modules[a].load(b,d,f)},c.unload=function(a,b,d,e){Human.events.fire("modules.unload.start",{moduleId:a,graphNodes:b,assetTypes:d});var f=function(){Human.events.fire("modules.unload.finish",{moduleId:a,graphNodes:b,assetTypes:d}),e&&e()};c.modules[a].unload(b,d,f)},c.deactivate=function(a,b,d){Human.events.fire("modules.deactivate.start",{moduleId:a,config:b});var e=function(){delete c.activeModules[a],c.numActiveModules--,Human.events.fire("modules.deactivated",{moduleId:a}),Human.events.fire("modules.deactivate.finish",{moduleId:a}),d&&d()};c.modules[a].deactivate(b,e)},c.destroy=function(a,b){if(Human.events.fire("modules.destory.start",{moduleId:a}),c.modules[a]){var e=function(){delete c.moduleData[a],delete c.modules[a],d.putId(a),Human.events.fire("modules.destroy.finish",{moduleId:a}),b&&b()};c.modules[a].destroy(e)}else Human.log.warn("Human.modules.destroyModule","Module does not exist, cannot be destoryed: + "+a)},c.isBase=function(a){var b=a.match(/^(femaleAdult|maleAdult|female_complete_anatomy_[0-9]+\.json|male_complete_anatomy_[0-9]+\.json)/);return b&&b[0]},c.isBaseModule=function(a){var b=a.split("/");return c.isBase(b[b.length-1])?a:!1},c.requiresBase=function(a){for(var b=!1,d=0;d<a.length&&!(b=c.isBase(a[d]));d++);return b};var e=c.MALE_STATE_ID="maleAdult_standard",f=c.FEMALE_STATE_ID="femaleAdult_standard",g={"production/maleAdult/maleAdult.json":"production/maleAdult/maleAdult_standard.json","production/femaleAdult/femaleAdult.json":"production/femaleAdult/femaleAdult_standard.json"};c.convertBaseAnatomyModuleId=function(a){return g[a]||a},c.convertBaseAnatomyStateId=function(a){return a.replace(/^femaleAdult$/,f).replace(/^maleAdult$/,e)},c.convertBaseAnatomyObjectId=function(a){if(c.isBase(a)){var b=a.split("-"),d=c.convertBaseAnatomyStateId(b[0]);a=[d,b[1]].join("-"),/_ID$/.test(a)||(a+="_ID")}return a}}(),function(){"use strict";function a(a,b){var c,d;b=b||{showObjects:{},selectObjects:{},pickThroughObjects:{},colorRecipeObjects:{}};var e=a.showObjects||b.showObjects||{},f=a.selectObjects||b.selectObjects||{},g=a.pickThroughObjects||b.pickThroughObjects||{},h=a.opacityObjects||b.opacityObjects||{},i=a.colorRecipeObjects||b.colorRecipeObjects||{},j=a.synchronization||{};d="shown";for(c in e)e.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=e[c]);d="selected";for(c in f)f.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=f[c]);d="pickable";for(c in g)g.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=!g[c]);d="opacity";for(c in h)j[c]||(j[c]={}),j[c][d]=h[c];for(var k in i)for(c in i[k])j[c]||(j[c]={}),j[c][k]=i[k][c];return j}function b(a,b,c,d,e,f,g){a[d]||(a[d]=!0,Human.assets.getAssetLibrary(b,c,d,e,f,g))}function c(a,b){a[b]&&(delete a[b],Human.assets.putAssetLibrary(b))}function d(a,b,c){var d,e,f=0;for(d in a)if(a.hasOwnProperty(d)&&b.indexOf(d)>=0)for(var g=a[d],h=0;h<g.length;h++)e=g[h],c[e]||(f+=1);return f}function e(a){return function(b){return a.indexOf(b)>-1}}var f=Human.modules.Module=function(a){this.moduleId=a.moduleId,this.displayName=a.displayName||"",this.description=a.description||"",this.translations=a.translations||{},this.tags=a.tags||[],this.ui=a.ui||{},this.active=!1,this.timeActivated=-1,this.rootObjects=[],this.animation=a.animation||{},this.camera=a.camera,this.jumpTo=a.jumpTo,this.flyTo=a.flyTo;var b=a.modelIds||a.stateId;

this.modelIds=b?Human.utils.isArray(b)?b:[b]:[],this.showObjects=a.showObjects,this.selectObjects=a.selectObjects,this.pickThroughObjects=a.pickThroughObjects,this.opacityObjects=a.opacityObjects,this.xray=a.xray,this.properties=a.properties,this.swapped=!1,this.swappedObjectId=null,this.background=a.background||null,this.customData=a.customData||{},this.cache=!1,this.chapters=a.chapters||null,this.sceneGraph=a.sceneGraph,this.particleSystems=a.customData&&a.customData.particleSystems?a.customData.particleSystems:[],this.assetLibraries=a.assetLibraries,this.hasAssetLights=this.assetLibraries.hasOwnProperty("lights")&&this.assetLibraries.lights.length>0,this.lights=a.lights,this.hasLights=this.hasAssetLights||!!this.lights,this.reflections=a.reflections||{};for(var c in this.reflections)if(this.reflections.hasOwnProperty(c)){var d=this.reflections[c],e=d.split(".");d=e[0]+"/"+e.slice(1).join("."),Human.assets.reflections.exportedReflectionIds[c]=d}this.layers=a.layers||{},this.objectState=a.objects||{},this.clips=a.clips||{},this.modes=a.modes||{},this.colorRecipes=a.colorRecipes||{},this.loadedLibs={}};f.prototype.create=function(b){var c,d,f,g=this;for(Human.scene.graph.buildGraph(g.sceneGraph,null,{}),c=0;c<g.sceneGraph.length;c++)g.rootObjects.push(Human.scene.objects[g.sceneGraph[c].objectId]);this.lights&&Human.renderer.lights.addLights(this.lights);var h;for(c=0;c<g.chapters.length;c++)if(h=g.chapters[c],h.lights)if(this.hasAssetLights){var i=h.lights.libraries;Human.utils.filterInPlace(i,e(this.assetLibraries.lights)),0===i.length&&i.push("default")}else h.lights.libraries=["default"];else h.lights={libraries:[],lights:[]},h.lights.libraries=g.hasAssetLights?Human.utils.deepClone(g.assetLibraries.lights):["default"];f=new Human.timeline.RootTimeline(g.moduleId);var j={showObjects:g.showObjects,pickThroughObjects:g.pickThroughObjects,selectObjects:g.selectObjects,opacityObjects:g.opacityObjects};for(c=0;c<g.chapters.length;c++)g.chapters[c].synchronization=a(g.chapters[c],j),g.chapters[c].hasOwnProperty("id")||(g.chapters[c].id=g.moduleId+"_"+c),d=new Human.timeline.BranchTimeline(g.chapters[c]),f.addChapter(d,{rebuild:!1});f.build(),g.rootTimeline=f,Human.particles.destroyAll(),Human.particles.parse(g.particleSystems,b)},f.prototype.activate=function(a,b,c){var d=this;if(d.timeActivated=Date.now(),d.active=!0,d.properties&&Human.properties.set(d.properties),d.colorRecipes){Human.scene.colorRecipes.clearRecipes();for(var e in d.colorRecipes)Human.scene.colorRecipes.registerRecipe(e,d.colorRecipes[e])}a!==!1&&d.rootTimeline.activate(a,b,c)},f.prototype.load=function(a,c,e){var f=this,g=0;this.customData.tweens&&Human.assets.tweens.parseLibrary(this.customData.tweenId,this.customData.tweens);var h=d(f.assetLibraries,c,f.loadedLibs);if(h>0){var i=function(){h--,0===h&&Human.scene.graph.attachAssetSetsToSubtree(a,[c],e)};if(f.assetLibraries.tweens&&c.indexOf("tweens")>=0)for(g=0;g<f.assetLibraries.tweens.length;g++)b(f.loadedLibs,"animation","animations",f.assetLibraries.tweens[g],"manifest",{},i);if(f.assetLibraries.reflections&&c.indexOf("reflections")>=0)for(g=0;g<f.assetLibraries.reflections.length;g++)b(f.loadedLibs,"reflection","reflections",f.assetLibraries.reflections[g],"outline",{},i);if(f.assetLibraries.lights&&f.assetLibraries.lights.length>0&&c.indexOf("lights")>=0)for(g=0;g<f.assetLibraries.lights.length;g++)b(f.loadedLibs,"light","lights",f.assetLibraries.lights[g],"outline",{},i)}else Human.scene.graph.attachAssetSetsToSubtree(a,[c],e)},f.prototype.unload=function(a,b,d){var e=this,f=0;if(e.assetLibraries.tweens&&b.indexOf("tweens")>=0)for(f=0;f<e.assetLibraries.tweens.length;f++)c(e.loadedLibs,e.assetLibraries.tweens[f]);if(e.assetLibraries.reflections&&b.indexOf("reflections")>=0)for(f=0;f<e.assetLibraries.reflections.length;f++)c(e.loadedLibs,e.assetLibraries.reflections[f]);if(e.assetLibraries.lights&&b.indexOf("lights")>=0)for(f=0;f<e.assetLibraries.lights.length;f++)c(e.loadedLibs,e.assetLibraries.lights[f]);Human.scene.graph.unloadSubtree(a,b,d)},f.prototype.deactivate=function(a,b){var c=this;c.timeActivated=-1,c.active=!1,c.rootTimeline.deactivate(a,b)},f.prototype.destroy=function(a){var b=this;Human.particles.destroyAll(),b.rootTimeline.destroy(),Human.scene.graph.destroySubtree(b.rootObjects),b=null,a&&a()}}(),function(){"use strict";Human.mobile={android:void 0!==window.HumanKitAndroid,iOS:void 0!==window.webkit,bundleid:void 0!==window.mobilebundleid?window.mobilebundleid:null},window.webkit.messageHandlers.messageHandler.postMessage("got mobile iOS: "+Human.mobile.iOS+" bundleID "+Human.mobile.bundleid)}(),function(){"use strict";var a=Human.workers={},b="";a.setPath=function(a){b=a},a.loadWorker=function(a){var c=b+"/"+a;return new Worker(c)}}(),function(){"use strict";Human.plugins={},Human.addPlugin=function(a,b){Human.plugins[a]=b}}(),function(a){"use strict";function b(a,b,c){return a>=b&&c>=a}function c(a,b){return Math.floor(a/b)}function d(a){var b=0;this.get=function(){return b>=a.length?N:Number(a[b])},this.offset=function(c){if(b+=c,0>b)throw new Error("Seeking past start of the buffer");if(b>a.length)throw new Error("Seeking past EOF")},this.match=function(c){if(c.length>b+a.length)return!1;var d;for(d=0;d<c.length;d+=1)if(Number(a[b+d])!==c[d])return!1;return!0}}function e(a){var b=0;this.emit=function(){var c,d=N;for(c=0;c<arguments.length;++c)d=Number(arguments[c]),a[b++]=d;return d}}function f(a){var c=0,d=function(){for(var c=[],d=0,e=a.length;d<a.length;){var f=a.charCodeAt(d);if(b(f,55296,57343))if(b(f,56320,57343))c.push(65533);else if(d===e-1)c.push(65533);else{var g=a.charCodeAt(d+1);if(b(g,56320,57343)){var h=1023&f,i=1023&g;d+=1,c.push(65536+(h<<10)+i)}else c.push(65533)}else c.push(f);d+=1}return c}();this.offset=function(a){if(c+=a,0>c)throw new Error("Seeking past start of the buffer");if(c>d.length)throw new Error("Seeking past EOF")},this.get=function(){return c>=d.length?O:d[c]}}function g(){var a="";this.string=function(){return a},this.emit=function(b){65535>=b?a+=String.fromCharCode(b):(b-=65536,a+=String.fromCharCode(55296+(b>>10&1023)),a+=String.fromCharCode(56320+(1023&b)))}}function h(a,b){if(a)throw new Error("EncodingError");return b||65533}function i(){throw new Error("EncodingError")}function j(a){if(a=String(a).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(R,a))return R[a];throw new Error("EncodingError: Unknown encoding: "+a)}function k(a,b){return(b||[])[a]||null}function l(a,b){var c=b.indexOf(a);return-1===c?null:c}function m(a){if(a>39419&&189e3>a||a>1237575)return null;var b,c=0,d=0,e=S.gb18030;for(b=0;b<e.length;++b){var f=e[b];if(!(f[0]<=a))break;c=f[0],d=f[1]}return d+a-c}function n(a){var b,c=0,d=0,e=S.gb18030;for(b=0;b<e.length;++b){var f=e[b];if(!(f[1]<=a))break;c=f[1],d=f[0]}return d+a-c}function o(a){var c=a.fatal,d=0,e=0,f=0,g=0;this.decode=function(a){var i=a.get();if(i===N)return 0!==e?h(c):O;if(a.offset(1),0===e){if(b(i,0,127))return i;if(b(i,194,223))e=1,g=128,d=i-192;else if(b(i,224,239))e=2,g=2048,d=i-224;else{if(!b(i,240,244))return h(c);e=3,g=65536,d=i-240}return d*=Math.pow(64,e),null}if(!b(i,128,191))return d=0,e=0,f=0,g=0,a.offset(-1),h(c);if(f+=1,d+=(i-128)*Math.pow(64,e-f),f!==e)return null;var j=d,k=g;return d=0,e=0,f=0,g=0,b(j,k,1114111)&&!b(j,55296,57343)?j:h(c)}}function p(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,55296,57343))return i(e);if(b(e,0,127))return a.emit(e);var f,g;b(e,128,2047)?(f=1,g=192):b(e,2048,65535)?(f=2,g=224):b(e,65536,1114111)&&(f=3,g=240);for(var h=a.emit(c(e,Math.pow(64,f))+g);f>0;){var j=c(e,Math.pow(64,f-1));h=a.emit(128+j%64),f-=1}return h}}function q(a,c){var d=c.fatal;this.decode=function(c){var e=c.get();if(e===N)return O;if(c.offset(1),b(e,0,127))return e;var f=a[e-128];return null===f?h(d):f}}function r(a,c){c.fatal;this.encode=function(c,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return c.emit(e);var f=l(e,a);return null===f&&i(e),c.emit(f+128)}}function s(a,c){var d=c.fatal,e=0,f=0,g=0;this.decode=function(c){var i=c.get();if(i===N&&0===e&&0===f&&0===g)return O;i!==N||0===e&&0===f&&0===g||(e=0,f=0,g=0,h(d)),c.offset(1);var j;if(0!==g)return j=null,b(i,48,57)&&(j=m(10*(126*(10*(e-129)+(f-48))+(g-129))+i-48)),e=0,f=0,g=0,null===j?(c.offset(-3),h(d)):j;if(0!==f)return b(i,129,254)?(g=i,null):(c.offset(-2),e=0,f=0,h(d));if(0!==e){if(b(i,48,57)&&a)return f=i,null;var l=e,n=null;e=0;var o=127>i?64:65;return(b(i,64,126)||b(i,128,254))&&(n=190*(l-129)+(i-o)),j=null===n?null:k(n,S.gbk),null===n&&c.offset(-1),null===j?h(d):j}return b(i,0,127)?i:128===i?8364:b(i,129,254)?(e=i,null):h(d)}}function t(a,d){d.fatal;this.encode=function(d,e){var f=e.get();if(f===O)return N;if(e.offset(1),b(f,0,127))return d.emit(f);var g=l(f,S.gbk);if(null!==g){var h=c(g,190)+129,j=g%190,k=63>j?64:65;return d.emit(h,j+k)}if(null===g&&!a)return i(f);g=n(f);var m=c(c(c(g,10),126),10);g-=10*m*126*10;var o=c(c(g,10),126);g-=10*o*126;var p=c(g,10),q=g-10*p;return d.emit(m+129,o+48,p+129,q+48)}}function u(a){var c=a.fatal,d=!1,e=0;this.decode=function(a){var f=a.get();if(f===N&&0===e)return O;if(f===N&&0!==e)return e=0,h(c);if(a.offset(1),126===e)return e=0,123===f?(d=!0,null):125===f?(d=!1,null):126===f?126:10===f?null:(a.offset(-1),h(c));if(0!==e){var g=e;e=0;var i=null;return b(f,33,126)&&(i=k(190*(g-1)+(f+63),S.gbk)),10===f&&(d=!1),null===i?h(c):i}return 126===f?(e=126,null):d?b(f,32,127)?(e=f,null):(10===f&&(d=!1),h(c)):b(f,0,127)?f:h(c)}}function v(a){var d=(a.fatal,!1);this.encode=function(a,e){var f=e.get();if(f===O)return N;if(e.offset(1),b(f,0,127)&&d)return e.offset(-1),d=!1,a.emit(126,125);if(126===f)return a.emit(126,126);if(b(f,0,127))return a.emit(f);if(!d)return e.offset(-1),d=!0,a.emit(126,123);var g=l(f,S.gbk);if(null===g)return i(f);var h=c(g,190)+1,j=g%190-63;return b(h,33,126)&&b(j,33,126)?a.emit(h,j):i(f)}}function w(a){var c=a.fatal,d=0,e=null;this.decode=function(a){if(null!==e){var f=e;return e=null,f}var g=a.get();if(g===N&&0===d)return O;if(g===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var i=d,j=null;d=0;var l=127>g?64:98;if((b(g,64,126)||b(g,161,254))&&(j=157*(i-129)+(g-l)),1133===j)return e=772,202;if(1135===j)return e=780,202;if(1164===j)return e=772,234;if(1166===j)return e=780,234;var m=null===j?null:k(j,S.big5);return null===j&&a.offset(-1),null===m?h(c):m}return b(g,0,127)?g:b(g,129,254)?(d=g,null):h(c)}}function x(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);var f=l(e,S.big5);if(null===f)return i(e);var g=c(f,157)+129,h=f%157,j=63>h?64:98;return a.emit(g,h+j)}}function y(a){var c=a.fatal,d=0,e=0;this.decode=function(a){var f=a.get();if(f===N)return 0===d&&0===e?O:(d=0,e=0,h(c));a.offset(1);var g,i;return 0!==e?(g=e,e=0,i=null,b(g,161,254)&&b(f,161,254)&&(i=k(94*(g-161)+f-161,S.jis0212)),b(f,161,254)||a.offset(-1),null===i?h(c):i):142===d&&b(f,161,223)?(d=0,65377+f-161):143===d&&b(f,161,254)?(d=0,e=f,null):0!==d?(g=d,d=0,i=null,b(g,161,254)&&b(f,161,254)&&(i=k(94*(g-161)+f-161,S.jis0208)),b(f,161,254)||a.offset(-1),null===i?h(c):i):b(f,0,127)?f:142===f||143===f||b(f,161,254)?(d=f,null):h(c)}}function z(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);if(165===e)return a.emit(92);if(8254===e)return a.emit(126);if(b(e,65377,65439))return a.emit(142,e-65377+161);var f=l(e,S.jis0208);if(null===f)return i(e);var g=c(f,94)+161,h=f%94+161;return a.emit(g,h)}}function A(a){var c=a.fatal,d={ASCII:0,escape_start:1,escape_middle:2,escape_final:3,lead:4,trail:5,Katakana:6},e=d.ASCII,f=!1,g=0;this.decode=function(a){var i=a.get();switch(i!==N&&a.offset(1),e){default:case d.ASCII:return 27===i?(e=d.escape_start,null):b(i,0,127)?i:i===N?O:h(c);case d.escape_start:return 36===i||40===i?(g=i,e=d.escape_middle,null):(i!==N&&a.offset(-1),e=d.ASCII,h(c));case d.escape_middle:var j=g;return g=0,36!==j||64!==i&&66!==i?36===j&&40===i?(e=d.escape_final,null):40!==j||66!==i&&74!==i?40===j&&73===i?(e=d.Katakana,null):(a.offset(i===N?-1:-2),e=d.ASCII,h(c)):(e=d.ASCII,null):(f=!1,e=d.lead,null);case d.escape_final:return 68===i?(f=!0,e=d.lead,null):(a.offset(i===N?-2:-3),e=d.ASCII,h(c));case d.lead:return 10===i?(e=d.ASCII,h(c,10)):27===i?(e=d.escape_start,null):i===N?O:(g=i,e=d.trail,null);case d.trail:if(e=d.lead,i===N)return h(c);var l=null,m=94*(g-33)+i-33;return b(g,33,126)&&b(i,33,126)&&(l=f===!1?k(m,S.jis0208):k(m,S.jis0212)),null===l?h(c):l;case d.Katakana:return 27===i?(e=d.escape_start,null):b(i,33,95)?65377+i-33:i===N?O:h(c)}}}function B(a){var d=(a.fatal,{ASCII:0,lead:1,Katakana:2}),e=d.ASCII;this.encode=function(a,f){var g=f.get();if(g===O)return N;if(f.offset(1),(b(g,0,127)||165===g||8254===g)&&e!==d.ASCII)return f.offset(-1),e=d.ASCII,a.emit(27,40,66);if(b(g,0,127))return a.emit(g);if(165===g)return a.emit(92);if(8254===g)return a.emit(126);if(b(g,65377,65439)&&e!==d.Katakana)return f.offset(-1),e=d.Katakana,a.emit(27,40,73);if(b(g,65377,65439))return a.emit(g-65377-33);if(e!==d.lead)return f.offset(-1),e=d.lead,a.emit(27,36,66);var h=l(g,S.jis0208);if(null===h)return i(g);var j=c(h,94)+33,k=h%94+33;return a.emit(j,k)}}function C(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(e===N&&0===d)return O;if(e===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var f=d;if(d=0,b(e,64,126)||b(e,128,252)){var g=127>e?64:65,i=160>f?129:193,j=k(188*(f-i)+e-g,S.jis0208);return null===j?h(c):j}return a.offset(-1),h(c)}return b(e,0,128)?e:b(e,161,223)?65377+e-161:b(e,129,159)||b(e,224,252)?(d=e,null):h(c)}}function D(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,128))return a.emit(e);if(165===e)return a.emit(92);if(8254===e)return a.emit(126);if(b(e,65377,65439))return a.emit(e-65377+161);var f=l(e,S.jis0208);if(null===f)return i(e);var g=c(f,188),h=31>g?129:193,j=f%188,k=63>j?64:65;return a.emit(g+h,j+k)}}function E(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(e===N&&0===d)return O;if(e===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var f=d,g=null;if(d=0,b(f,129,198)){var i=178*(f-129);b(e,65,90)?g=i+e-65:b(e,97,122)?g=i+26+e-97:b(e,129,254)&&(g=i+26+26+e-129)}b(f,199,253)&&b(e,161,254)&&(g=12460+94*(f-199)+(e-161));var j=null===g?null:k(g,S["euc-kr"]);return null===g&&a.offset(-1),null===j?h(c):j}return b(e,0,127)?e:b(e,129,253)?(d=e,null):h(c)}}function F(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);var f=l(e,S["euc-kr"]);if(null===f)return i(e);var g,h;if(12460>f){g=c(f,178)+129,h=f%178;var j=26>h?65:52>h?71:77;return a.emit(g,h+j)}return f-=12460,g=c(f,94)+199,h=f%94+161,a.emit(g,h)}}function G(a){var c=a.fatal,d={ASCII:0,escape_start:1,escape_middle:2,escape_end:3,lead:4,trail:5},e=d.ASCII,f=0;this.decode=function(a){var g=a.get();switch(g!==N&&a.offset(1),e){default:case d.ASCII:return 14===g?(e=d.lead,null):15===g?null:27===g?(e=d.escape_start,null):b(g,0,127)?g:g===N?O:h(c);case d.escape_start:return 36===g?(e=d.escape_middle,null):(g!==N&&a.offset(-1),e=d.ASCII,h(c));case d.escape_middle:return 41===g?(e=d.escape_end,null):(a.offset(g===N?-1:-2),e=d.ASCII,h(c));case d.escape_end:return 67===g?(e=d.ASCII,null):(a.offset(g===N?-2:-3),e=d.ASCII,h(c));case d.lead:return 10===g?(e=d.ASCII,h(c,10)):14===g?null:15===g?(e=d.ASCII,null):g===N?O:(f=g,e=d.trail,null);case d.trail:if(e=d.lead,g===N)return h(c);var i=null;return b(f,33,70)&&b(g,33,126)?i=k(178*(f-1)+26+26+g-1,S["euc-kr"]):b(f,71,126)&&b(g,33,126)&&(i=k(12460+94*(f-71)+(g-33),S["euc-kr"])),null!==i?i:h(c)}}}function H(a){var d=(a.fatal,{ASCII:0,lead:1}),e=!1,f=d.ASCII;this.encode=function(a,g){var h=g.get();if(h===O)return N;if(e||(e=!0,a.emit(27,36,41,67)),g.offset(1),b(h,0,127)&&f!==d.ASCII)return g.offset(-1),f=d.ASCII,a.emit(15);if(b(h,0,127))return a.emit(h);if(f!==d.lead)return g.offset(-1),f=d.lead,a.emit(14);var j=l(h,S["euc-kr"]);if(null===j)return i(h);var k,m;return 12460>j?(k=c(j,178)+1,m=j%178-26-26+1,b(k,33,70)&&b(m,33,126)?a.emit(k,m):i(h)):(j-=12460,k=c(j,94)+71,m=j%94+33,b(k,71,126)&&b(m,33,126)?a.emit(k,m):i(h))}}function I(a,c){var d=c.fatal,e=null,f=null;this.decode=function(c){var g=c.get();if(g===N&&null===e&&null===f)return O;if(g===N&&(null!==e||null!==f))return h(d);if(c.offset(1),null===e)return e=g,null;var i;if(i=a?(e<<8)+g:(g<<8)+e,e=null,null!==f){var j=f;return f=null,b(i,56320,57343)?65536+1024*(j-55296)+(i-56320):(c.offset(-2),h(d))}return b(i,55296,56319)?(f=i,null):b(i,56320,57343)?h(d):i}}function J(a,d){d.fatal;this.encode=function(d,e){function f(b){var c=b>>8,e=255&b;return a?d.emit(c,e):d.emit(e,c)}var g=e.get();if(g===O)return N;if(e.offset(1),b(g,55296,57343)&&i(g),65535>=g)return f(g);var h=c(g-65536,1024)+55296,j=(g-65536)%1024+56320;return f(h),f(j)}}function K(a,b){return b.match([255,254])?(b.offset(2),"utf-16"):b.match([254,255])?(b.offset(2),"utf-16be"):b.match([239,187,191])?(b.offset(3),"utf-8"):a}function L(b,c){return this&&this!==a?(b=b?String(b):T,c=Object(c),this._encoding=j(b),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new L(b,c)}function M(b,c){return this&&this!==a?(b=b?String(b):T,c=Object(c),this._encoding=j(b),this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new M(b,c)}var N=-1,O=-1,P=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}],Q={},R={};P.forEach(function(a){a.encodings.forEach(function(a){Q[a.name]=a,a.labels.forEach(function(b){R[b]=a})})});var S=a["encoding-indexes"]||{};Q["utf-8"].getEncoder=function(a){return new p(a)},Q["utf-8"].getDecoder=function(a){return new o(a)},function(){["ibm864","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","x-mac-cyrillic"].forEach(function(a){var b=Q[a],c=S[a];b.getDecoder=function(a){return new q(c,a)},b.getEncoder=function(a){return new r(c,a)}})}(),Q.gbk.getEncoder=function(a){return new t(!1,a)},Q.gbk.getDecoder=function(a){return new s(!1,a)},Q.gb18030.getEncoder=function(a){return new t(!0,a)},Q.gb18030.getDecoder=function(a){return new s(!0,a)},Q["hz-gb-2312"].getEncoder=function(a){return new v(a)},Q["hz-gb-2312"].getDecoder=function(a){return new u(a)},Q.big5.getEncoder=function(a){return new x(a)},Q.big5.getDecoder=function(a){return new w(a)},Q["euc-jp"].getEncoder=function(a){return new z(a)},Q["euc-jp"].getDecoder=function(a){return new y(a)},Q["iso-2022-jp"].getEncoder=function(a){return new B(a)},Q["iso-2022-jp"].getDecoder=function(a){return new A(a)},Q.shift_jis.getEncoder=function(a){return new D(a)},Q.shift_jis.getDecoder=function(a){return new C(a)},Q["euc-kr"].getEncoder=function(a){return new F(a)},Q["euc-kr"].getDecoder=function(a){return new E(a)},Q["iso-2022-kr"].getEncoder=function(a){return new H(a)},Q["iso-2022-kr"].getDecoder=function(a){return new G(a)},Q["utf-16"].getEncoder=function(a){return new J(!1,a)},Q["utf-16"].getDecoder=function(a){return new I(!1,a)},Q["utf-16be"].getEncoder=function(a){return new J(!0,a)},Q["utf-16be"].getDecoder=function(a){return new I(!0,a)};var T="utf-8";L.prototype={encode:function(a,b){a=a?String(a):"",b=Object(b),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(b.stream);for(var c=[],d=new e(c),g=new f(a);g.get()!==O;)this._encoder.encode(d,g);if(!this._streaming){var h;do h=this._encoder.encode(d,g);while(h!==N);this._encoder=null}return new Uint8Array(c)}},M.prototype={decode:function(a,b){if(a&&!("buffer"in a&&"byteOffset"in a&&"byteLength"in a))throw new TypeError("Expected ArrayBufferView");a||(a=new Uint8Array(0)),b=Object(b),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(b.stream);var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),e=new d(c),f=K(this._encoding.name,e);if(j(f)!==this._encoding)throw new Error("BOM mismatch");for(var h,i=new g;e.get()!==N;)h=this._decoder.decode(e),null!==h&&h!==O&&i.emit(h);if(!this._streaming){do h=this._decoder.decode(e),null!==h&&h!==O&&i.emit(h);while(h!==O);this._decoder=null}return i.string()}},a.TextEncoder=a.TextEncoder||L,a.TextDecoder=a.TextDecoder||M}(this);