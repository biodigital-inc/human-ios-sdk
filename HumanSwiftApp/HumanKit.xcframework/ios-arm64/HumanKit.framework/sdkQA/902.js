var Je=Object.defineProperty,Ne=(te,H,V)=>H in te?Je(te,H,{enumerable:!0,configurable:!0,writable:!0,value:V}):te[H]=V,z=(te,H,V)=>(Ne(te,"symbol"!=typeof H?H+"":H,V),V);(()=>{var S,te={7902:(S,k,F)=>{(()=>{"use strict";function oe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}const r=F(9330),C=F(5071),O=F(5014),$=(0,O.create)(),E=(0,O.create)();function ae(e,t,o){if(o?(0,O.fromScaling)(E,o):(0,O.identity)(E),t){const a=t[0],n=t[1],i=t[2];a&&((0,O.fromXRotation)($,a),(0,O.multiply)(E,$,E)),n&&((0,O.fromYRotation)($,n),(0,O.multiply)(E,$,E)),i&&((0,O.fromZRotation)($,i),(0,O.multiply)(E,$,E))}return(0,C.fromMat4)(e,E)}const ne=(0,r.create)(),me=Math.PI/180,re=(0,r.create)(),ge=Math.PI/180,we=2*Math.PI,se=(0,r.create)(),xe=Math.PI/180,Se=Math.PI/180,ie=(0,r.create)(),ce=(0,r.create)(),ve=Math.PI/180,Ce=Math.PI,$e=2*Ce,ye=Math.PI/180;class Fe{constructor(){z(this,"translate"),z(this,"rotate"),z(this,"scale"),z(this,"xform"),z(this,"inverseXform"),z(this,"normalXform"),z(this,"dirty")}}const Be={shapeTranslate:"translate",shapeRotate:"rotate",shapeScale:"scale"};function K(e,t,o,a,n){const i=Be[t],s=i&&e[i];return"shapeRotate"===t&&(o*=ye,a*=ye,n*=ye),!!s&&(s[0]=o,s[1]=a,s[2]=n,e.dirty=!0,!0)}class Ve extends Fe{constructor(t){super(),this.translate=t?.translate?(0,r.clone)(t.translate):null,this.xform=t?.scale||t?.rotate?(0,C.create)():null,this.xform?(this.rotate=(0,r.fromValues)(0,0,0),t?.rotate&&(0,r.scale)(this.rotate,t.rotate,ye),this.scale=(0,r.fromValues)(1,1,1),t?.scale&&(0,r.copy)(this.scale,t.scale),this.inverseXform=(0,C.create)(),this.normalXform=(0,C.create)(),this.dirty=!0,this.updateXform()):(this.rotate=null,this.scale=null,this.inverseXform=null,this.normalXform=null,this.dirty=!1)}updateXform(){this.xform&&this.dirty&&(ae(this.xform,this.rotate,this.scale),(0,C.invert)(this.inverseXform,this.xform),(0,C.transpose)(this.normalXform,this.inverseXform)),this.dirty=!1}}const Pe=(e,t=0,o=1)=>Math.max(t,Math.min(o,e)),P=new class{constructor(e,t,o=100){z(this,"activeCount"),z(this,"size"),z(this,"get"),z(this,"release");const a=[];let n=0;Object.defineProperties(this,{activeCount:{get:()=>n},size:{get:()=>a.length}}),this.get=()=>(n++,a.length?a.pop():e()),this.release=i=>{if(n<=0)throw new Error("Pool: too many objects released.");n--,a.length<o&&(t&&t(i),a.push(i))}}}(()=>(0,r.create)(),e=>(0,r.set)(e,0,0,0)),Ke=Math.PI/180,Te=(0,C.create)();function Xe(e,t){return t[0]*e.normal[0]+t[1]*e.normal[1]+t[2]*e.normal[2]}function Ie(e){const t=e[0],o=e[1],a=e[2];return t*t+o*o+a*a}const G={Cube:class extends Ve{in(e){const t=e[0],o=e[1],a=e[2];return t>=-.5&&t<=.5&&o>=-.5&&o<=.5&&a>=-.5&&a<=.5}out(e){const t=e[0],o=e[1],a=e[2];return t<=-.5||t>=.5||o<=-.5||o>=.5||a<=-.5||a>=.5}surfaceProjection(e,t,o){let a=e[0],n=e[1],i=e[2];const s=Math.abs(a+.5),c=Math.abs(a-.5),p=Math.abs(n+.5),l=Math.abs(n-.5),u=Math.abs(i+.5),d=Math.abs(i-.5);s<c&&s<p&&s<l&&s<u&&s<d?(a=-.5,(0,r.set)(o,-1,0,0)):c<p&&c<l&&c<u&&c<d?(a=.5,(0,r.set)(o,1,0,0)):p<l&&p<u&&p<d?(n=-.5,(0,r.set)(o,0,-1,0)):l<u&&l<d?(n=.5,(0,r.set)(o,0,1,0)):u<d?(i=-.5,(0,r.set)(o,0,0,-1)):(i=.5,(0,r.set)(o,0,0,1)),t[0]=Pe(a,-.5,.5),t[1]=Pe(n,-.5,.5),t[2]=Pe(i,-.5,.5),this.xform&&(this.updateXform(),(0,r.transformMat3)(t,t,this.xform),(0,r.transformMat3)(o,o,this.normalXform),(0,r.normalize)(o,o)),this.translate&&(0,r.add)(t,t,this.translate)}},Cylinder:class extends Ve{in(e){const t=e[0],o=e[1],a=e[2];return t*t+a*a<=1&&o>=-1&&o<=1}out(e){const t=e[0],o=e[1],a=e[2];return t*t+a*a>=1||o<=-1||o>=1}surfaceProjection(e,t,o){let a=e[0],n=e[1],i=e[2];if(n<=-1)(0,r.set)(o,0,-1,0),n=-1;else if(n>=1)(0,r.set)(o,0,1,0),n=1;else{const s=Math.sqrt(a*a+i*i);s>=1||1-Math.abs(n)>=1-s?(a/=s,i/=s,(0,r.set)(o,a,0,i)):(n=Math.sign(n),(0,r.set)(o,0,n,0))}t[0]=a,t[1]=n,t[2]=i,this.xform&&(this.updateXform(),(0,r.transformMat3)(t,t,this.xform),(0,r.transformMat3)(o,o,this.normalXform),(0,r.normalize)(o,o)),this.translate&&(0,r.add)(t,t,this.translate)}},Plane:class extends Fe{constructor(t){super(),z(this,"translate"),z(this,"rotate"),z(this,"normal"),z(this,"distance"),z(this,"xform"),z(this,"dirty",!0),this.translate=(0,r.clone)(t.translate||[0,0,0]),this.rotate=(0,r.clone)(t.rotate||[0,0,0]),t.rotate&&(0,r.scale)(this.rotate,t.rotate,Ke),this.normal=(0,r.create)(),this.distance=0,this.updateXform()}updateXform(){this.dirty&&(this.normal[0]=0,this.normal[1]=1,this.normal[2]=0,ae(Te,this.rotate),(0,r.transformMat3)(this.normal,this.normal,Te),this.distance=(0,r.dot)(this.translate,this.normal),this.dirty=!1)}in(t){return this.updateXform(),Xe(this,t)<=this.distance}out(t){return this.updateXform(),Xe(this,t)>=this.distance}surfaceProjection(t,o,a){this.updateXform(),a[0]=this.normal[0],a[1]=this.normal[1],a[2]=this.normal[2];const n=P.get();(0,r.scale)(n,a,this.distance-(0,r.dot)(t,a)),(0,r.add)(o,t,n),P.release(n)}},Sphere:class extends Ve{in(e){return Ie(e)<=1}out(e){return Ie(e)>=1}surfaceProjection(e,t,o){(0,r.normalize)(t,e),oe(o)?o.set(t):(0,r.copy)(o,t),this.xform&&(this.updateXform(),(0,r.transformMat3)(t,t,this.xform),(0,r.transformMat3)(o,o,this.normalXform),(0,r.normalize)(o,o)),this.translate&&(0,r.add)(t,t,this.translate)}}};function Y(e,t,o,a){const n=3*a;return e[0]=o[n],e[1]=o[n+1],e[2]=o[n+2],t?.translate&&(e[0]-=t.translate[0],e[1]-=t.translate[1],e[2]-=t.translate[2]),t?.inverseXform&&(0,r.transformMat3)(e,e,t.inverseXform),e}const Me=(0,r.create)(),Re=(0,r.create)(),le=(0,r.create)(),ke=(0,r.create)(),_e=(0,r.create)(),Q=(0,r.create)(),W=(0,r.create)(),Ee={CubePosition:function(e){const t=e.translate?(0,r.clone)(e.translate):null,o=e.scale||e.rotate?(0,C.create)():null,a=o?(0,r.create)():null;e.rotate&&(0,r.scale)(a,e.rotate,me);const n={scale:o?e.scale||(0,r.fromValues)(1,1,1):null,rotate:a,translate:t};let i=!0;return{set(s,c,p,l){"rotate"===s?(0,r.set)(a,c*me,p*me,l*me):s in n&&(0,r.set)(n[s],c,p,l),i=!0},update(s,c,p){const l=s.get("position");o&&i&&(ae(o,a,n.scale),i=!1);for(let u=c,d=3*u;u<p;u++,d+=3)ne[0]=Math.random()-.5,ne[1]=Math.random()-.5,ne[2]=Math.random()-.5,o&&(0,r.transformMat3)(ne,ne,o),t&&(0,r.add)(ne,ne,t),l.set(ne,d)}}},CylinderPosition:function(e){const t=e.translate?(0,r.clone)(e.translate):null,o=e.scale||e.rotate?(0,C.create)():null,a=o?(0,r.create)():null;e.rotate&&(0,r.scale)(a,e.rotate,ge);const n={scale:o?e.scale||(0,r.fromValues)(1,1,1):null,rotate:a,translate:t};let i=!0;return{set(s,c,p,l){"rotate"===s?(0,r.set)(a,c*ge,p*ge,l*ge):s in n&&(0,r.set)(n[s],c,p,l),i=!0},update(s,c,p){const l=s.get("position");o&&i&&(ae(o,a,n.scale),i=!1);for(let u=c,d=3*u;u<p;u++,d+=3){const v=Math.random()*we,M=Math.random(),m=2*Math.random()-1;re[0]=M*Math.cos(v),re[1]=m,re[2]=M*Math.sin(v),o&&(0,r.transformMat3)(re,re,o),t&&(0,r.add)(re,re,t),l.set(re,d)}}}},DirectionalVelocity:function(e){const t=(0,r.clone)(e.directionAverage);(0,r.normalize)(t,t);const o={directionAverage:t},a={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0,directionVariance:e.directionVariance||0};return{components:["velocity"],set(n,i,s,c){n in o?(0,r.set)(o[n],i,s,c):n in a&&(a[n]=i)},update(n,i,s){const c=n.get("velocity"),{forceAverage:p,forceVariance:l,directionVariance:u}=a;for(let d=i,v=3*d;d<s;d++,v+=3){const M=p+2*Math.random()*l-l;se[0]=t[0]+2*Math.random()*u-u,se[1]=t[1]+2*Math.random()*u-u,se[2]=t[2]+2*Math.random()*u-u,(0,r.normalize)(se,se),c[v]+=se[0]*M,c[v+1]+=se[1]*M,c[v+2]+=se[2]*M}}}},Lifetime:function(e){const t={average:e.average,variance:e.variance||0};return{components:["lifetime","age"],set(o,a){o in t&&(t[o]=a)},update(o,a,n){const i=o.get("age"),s=o.get("lifetime"),{average:c,variance:p}=t;for(let l=a;l<n;l++)i[l]=0,s[l]=c,p>0&&(s[l]+=2*Math.random()*p-p)}}},PointPosition:function(e){const t=(0,r.clone)(e.position),o={position:t};return{set(a,n,i,s){a in o&&(0,r.set)(o[a],n,i,s)},update(a,n,i){const s=a.get("position");for(let c=n,p=3*c;c<i;c++,p+=3)s.set(t,p)}}},RandomRotation:function(e){const t={average:e.average*xe,variance:(e.variance||0)*xe};return{components:["scaleRotation"],set(o,a){o in t&&(t[o]=a*xe)},update(o,a,n){const i=o.get("scaleRotation"),{average:s,variance:c}=t;for(let p=2*a+1,l=2*n+1;p<l;p+=2){let u=s;c>0&&(u+=2*Math.random()*c-c),i[p]=u}}}},RandomRotationSpeed:function(e){const t={average:e.average*Se,variance:(e.variance||0)*Se};return{components:["rotationSpeed","scaleRotation"],set(o,a){o in t&&(t[o]=a*Se)},update(o,a,n){const i=o.get("rotationSpeed"),{average:s,variance:c}=t;for(let p=a;p<n;p++){let l=s;c>0&&(l+=2*Math.random()*c-c),i[p]=l}}}},RandomScale:function(e){const t={average:e.average,variance:e.variance||0};return{components:["scaleRotation"],set(o,a){o in t&&(t[o]=a)},update(o,a,n){const i=o.get("scaleRotation"),{average:s,variance:c}=t;for(let p=2*a,l=2*n;p<l;p+=2){let u=s;c>0&&(u+=2*Math.random()*c-c),i[p]=u}}}},RandomVelocity:function(e){const t={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0};return{components:["velocity"],set(o,a){o in t&&(t[o]=a)},update(o,a,n){const i=o.get("velocity"),{forceAverage:s,forceVariance:c}=t;for(let p=a,l=3*p;p<n;p++,l+=3){const u=s+2*Math.random()*c-c;ie[0]=2*Math.random()-1,ie[1]=2*Math.random()-1,ie[2]=2*Math.random()-1,(0,r.normalize)(ie,ie),i[l]+=ie[0]*u,i[l+1]+=ie[1]*u,i[l+2]+=ie[2]*u}}}},SpherePosition:function(e){const t=e.translate?(0,r.clone)(e.translate):null,o=e.scale||e.rotate?(0,C.create)():null,a=o?(0,r.create)():null;e.rotate&&(0,r.scale)(a,e.rotate,ve);const n={scale:o?e.scale||(0,r.fromValues)(1,1,1):null,rotate:a,translate:t};let i=!0;return{set(s,c,p,l){"rotate"===s?(0,r.set)(a,c*ve,p*ve,l*ve):s in n&&(0,r.set)(n[s],c,p,l),i=!0},update(s,c,p){const l=s.get("position");o&&i&&(ae(o,a,n.scale),i=!1);for(let u=c,d=3*u;u<p;u++,d+=3){const v=Math.random()*Ce,M=Math.random()*$e,m=Math.random(),g=Math.sin(v);ce[0]=m*g*Math.sin(M),ce[1]=m*Math.cos(v),ce[2]=m*g*Math.cos(M),o&&(0,r.transformMat3)(ce,ce,o),t&&(0,r.add)(ce,ce,t),l.set(ce,d)}}}},SpriteAnimationDuration:function(e,t,o){const a={average:e.average,variance:e.variance||0,startFrame:o.spriteStartFrame||0,endFrame:o.spriteEndFrame||Math.max(0,o.spriteCols*o.spriteCols-1)};return{components:["uvTranslate","spriteFrameDuration","spriteCurrentTime"],set(n,i){n in a&&(a[n]=i)},update(n,i,s){const c=n.get("spriteFrameDuration"),p=n.get("spriteCurrentTime"),{average:l,variance:u,startFrame:d,endFrame:v}=a,M=v-d;for(let m=i;m<s;m++){let g=l;u>0&&(g+=2*Math.random()*u-u),p[m]=0,c[m]=M?Math.max(g/M,0):0}}}}},je={AgeColorBlend:function(e){const t=[];for(let i=0,s=e.colors.length;i<s;i++)t[i]=new Uint8Array(e.colors[i]);const o=e.shape?new G[e.shape.type](e.shape):null,n=o?o[e.shape?.direction||"in"].bind(o):null;return{components:["position","age","lifetime","color"],set(i,s,c,p){K(o,i,s,c,p)},update(i,s,c){const p=i.get("position"),l=i.get("age"),u=i.get("lifetime"),d=i.get("color"),v=t.length-1,M=o?P.get():null;for(let m=s,g=4*m;m<c;m++,g+=4)if(!n||n(Y(M,o,p,m))){const f=l[m]/u[m]*v,b=Math.floor(f),w=t[b],h=t[b+1]||t[b],y=f-b,A=1-y;d[g]=A*w[0]+y*h[0],d[g+1]=A*w[1]+y*h[1],d[g+2]=A*w[2]+y*h[2],d[g+3]=A*w[3]+y*h[3]}M&&P.release(M)}}},AxisForce:function(e){const t=e.forceAverage,o=e.forceVariance||0,a=(0,r.clone)(e.position),n=(0,r.clone)(e.direction);(0,r.normalize)(n,n);const i=e.shape?new G[e.shape.type](e.shape):null,c=i?i[e.shape?.direction||"in"].bind(i):null,p={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0};return{components:["velocity","position"],set(l,u,d,v){"shapeTranslate"===l||"shapeRotate"===l||"shapeScale"===l?K(i,l,u,d,v):l in p&&(p[l]=u)},update(l,u,d,v){const M=l.get("position"),m=l.get("velocity"),g=t*v,f=o*v,b=P.get(),x=P.get(),w=P.get(),h=P.get();for(let y=u,A=3*y;y<d;y++,A+=3)if(Y(b,i,M,y),!c||c(b)){const I=A+1,_=A+2;let R=g;f>0&&(R+=2*Math.random()*f-f),b[0]=M[A],b[1]=M[I],b[2]=M[_],(0,r.subtract)(h,b,a);const U=(0,r.dot)(h,n);(0,r.scale)(w,n,U),(0,r.add)(x,w,a),(0,r.subtract)(x,b,x),(0,r.normalize)(x,x),m[A]+=x[0]*R,m[I]+=x[1]*R,m[_]+=x[2]*R}P.release(b),P.release(x),P.release(w),P.release(h)}}},BrownianMotion:function(e){const t=e.shape?new G[e.shape.type](e.shape):null,a=t?t[e.shape?.direction||"in"].bind(t):null,n={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0,frequency:e.frequency};return{components:["velocity","position"],set(i,s,c,p){"shapeTranslate"===i||"shapeRotate"===i||"shapeScale"===i?K(t,i,s,c,p):i in n&&(n[i]=s)},update(i,s,c,p){const l=i.get("position"),u=i.get("velocity"),d=n.frequency*p,v=n.forceAverage*p,M=n.forceVariance*p,m=t?P.get():null,g=P.get();for(let f=s,b=3*f;f<c;f++,b+=3)if((!a||a(Y(m,t,l,f)))&&Math.random()<d){let x=v;M>0&&(x+=2*Math.random()*M-M),g[0]=2*Math.random()-1,g[1]=2*Math.random()-1,g[2]=2*Math.random()-1,(0,r.normalize)(g,g),u[b]+=g[0]*x,u[b+1]+=g[1]*x,u[b+2]+=g[2]*x}m&&P.release(m),P.release(g)}}},Gravity:function(e){const t=(0,r.clone)(e.position),o=e.shape?new G[e.shape.type](e.shape):null,n=o?o[e.shape?.direction||"in"].bind(o):null,i={position:t},s={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0,radius:e.radius};return{components:["velocity","position"],set(c,p,l,u){"shapeTranslate"===c||"shapeRotate"===c||"shapeScale"===c?K(o,c,p,l,u):c in i?(0,r.set)(i[c],p,l,u):c in s&&(s[c]=p)},update(c,p,l,u){const{forceAverage:d,forceVariance:v,radius:M}=s;if(0===M)return;const m=c.get("position"),g=c.get("velocity"),f=d*u,b=v*u,x=P.get(),w=P.get();for(let h=p,y=3*h;h<l;h++,y+=3)if(Y(x,o,m,h),!n||n(x)){let A=f;b>0&&(A+=2*Math.random()*b-b);const I=y+1,_=y+2;w[0]=x[0]-m[y],w[1]=x[1]-m[I],w[2]=x[2]-m[_];const R=1/Math.max((0,r.length)(w),M);(0,r.scale)(w,w,R),g[y]+=w[0]*A,g[y+1]+=w[1]*A,g[y+2]+=w[2]*A}P.release(x),P.release(w)}}},Friction:function(e){const t=e.shape?new G[e.shape.type](e.shape):null,a=t?t[e.shape?.direction||"in"].bind(t):null,n={friction:1-e.friction};return{components:["velocity","position"],set(i,s,c,p){"shapeTranslate"===i||"shapeRotate"===i||"shapeScale"===i?K(t,i,s,c,p):i in n&&(n[i]=s)},update(i,s,c,p){const l=i.get("position"),u=i.get("velocity"),d=Math.pow(n.friction,p),v=t?P.get():null;for(let M=s,m=3*M;M<c;M++,m+=3)a&&!a(Y(v,t,l,M))||(u[m]*=d,u[m+1]*=d,u[m+2]*=d);v&&P.release(v)}}},Path:function(e,t){const o=function(s){const c=[];return s.forEach(({position:p,radius:l,forceAverage:u,forceVariance:d},v)=>{const M=(0,r.clone)(p),m=v?(0,r.subtract)((0,r.create)(),M,c[v-1].position):null,g=v?(0,r.length)(m):0,f={position:M,radiusSquared:l?l*l:0,forceVariance:d||0,forceAverage:u,vec:m,dir:v?(0,r.scale)((0,r.create)(),m,1/g):null,length:g};c.push(f)}),c}(e.nodes);t.path=o;const a=e.shape?new G[e.shape.type](e.shape):null,i=a?a[e.shape?.direction||"in"].bind(a):null;return{components:["velocity","position","pathIndex"],set(s,c,p,l){K(a,s,c,p,l)},update(s,c,p,l){const u=s.get("position"),d=s.get("velocity"),v=s.get("pathIndex"),M=P.get(),m=P.get(),g=P.get();for(let f=c,b=3*f;f<p;f++,b+=3)if(Y(M,a,u,f),!i||i(M)){const x=v[f];let w=o[x];if(w){const h=b+1,y=b+2;let A=null;if(x){if((0,r.subtract)(m,M,o[x-1].position),(0,r.dot)(m,w.dir)>w.length){const _=x+1;if(v[f]=_,w=o[_],w){g[0]=d[b],g[1]=d[h],g[2]=d[y];const R=(0,r.length)(g);(0,r.scale)(g,w.dir,R),d.set(g,b)}}w&&(A=w.dir)}else{if((0,r.squaredDistance)(M,w.position)<w.radiusSquared){const I=x+1;v[f]=I,w=o[I]}w&&((0,r.subtract)(m,w.position,M),A=(0,r.normalize)(m,m))}if(w){const _=w.forceVariance*l;let R=w.forceAverage*l;_>0&&(R+=2*Math.random()*_-_),d[b]+=A[0]*R,d[h]+=A[1]*R,d[y]+=A[2]*R}}}P.release(M),P.release(m),P.release(g)}}},RadialForce:function(e){const t=(0,r.clone)(e.position),o=e.shape?new G[e.shape.type](e.shape):null,n=o?o[e.shape?.direction||"in"].bind(o):null,i={position:t},s={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0};return{components:["velocity","position"],set(c,p,l,u){"shapeTranslate"===c||"shapeRotate"===c||"shapeScale"===c?K(o,c,p,l,u):c in i?(0,r.set)(i[c],p,l,u):c in s&&(s[c]=p)},update(c,p,l,u){const d=c.get("position"),v=c.get("velocity"),M=s.forceAverage*u,m=s.forceVariance*u,g=P.get(),f=P.get();for(let b=p,x=3*b;b<l;b++,x+=3)if(Y(g,o,d,b),!n||n(g)){let w=M;m>0&&(w+=2*Math.random()*m-m);const h=x+1,y=x+2;f[0]=d[x]-g[0],f[1]=d[h]-g[1],f[2]=d[y]-g[2],(0,r.normalize)(f,f),v[x]+=f[0]*w,v[x+1]+=f[1]*w,v[x+2]+=f[2]*w}P.release(g),P.release(f)}}},SpriteAnimation:function(e,t,o){const a=o.spriteRows||0,n=o.spriteCols||1,i=o.spriteStartFrame||0,s=(o.spriteEndFrame||Math.max(0,a*n-1))-i;return{components:["uvTranslate","spriteFrameDuration","spriteCurrentTime"],update(c,p,l,u){const d=c.get("uvTranslate"),v=c.get("spriteFrameDuration"),M=c.get("spriteCurrentTime");for(let m=p,g=2*m,f=m+1;m<l;m++,g+=2,f+=2){M[m]=(M[m]+u)%(s*v[m]);const x=Math.floor(M[m]/v[m]);d[g]=x%n/n;const h=Math.floor(x/n)+1;d[f]=-h/a}}}},UniformForce:function(e){const t=(0,r.clone)(e.directionAverage),o=e.shape?new G[e.shape.type](e.shape):null,n=o?o[e.shape?.direction||"in"].bind(o):null,i={directionAverage:t},s={forceAverage:e.forceAverage,forceVariance:e.forceVariance||0,directionVariance:e.directionVariance||0};return{components:["velocity","position"],set(c,p,l,u){"shapeTranslate"===c||"shapeRotate"===c||"shapeScale"===c?K(o,c,p,l,u):c in i?(0,r.set)(i[c],p,l,u):c in s&&(s[c]=p)},update(c,p,l,u){const d=c.get("position"),v=c.get("velocity"),{forceAverage:M,forceVariance:m,directionVariance:g}=s,f=M*u,b=m*u,x=o?P.get():null,w=P.get();for(let h=p,y=3*h;h<l;h++,y+=3)if(!n||n(Y(x,o,d,h))){let A=f;b>0&&(A+=2*Math.random()*b-b),(0,r.copy)(w,t),g&&(w[0]+=2*Math.random()*g-g,w[1]+=2*Math.random()*g-g,w[2]+=2*Math.random()*g-g,(0,r.normalize)(w,w)),v[y]+=w[0]*A,v[y+1]+=w[1]*A,v[y+2]+=w[2]*A}x&&P.release(x),P.release(w)}}}},qe={LifetimeKill:function(){return{components:["lifetime","age","dead"],update(e,t,o){const a=e.get("age"),n=e.get("lifetime"),i=e.get("dead");for(let s=t;s<o;s++)a[s]>=n[s]&&(i[s]=!0)}}},LifetimeStop:function(){return{components:["lifetime","age","stopped"],update(e,t,o){const a=e.get("age"),n=e.get("lifetime"),i=e.get("stopped");for(let s=t;s<o;s++)a[s]>=n[s]&&(i[s]=!0)}}},PathRadius:function(e,t){const{path:o=[]}=t;return{components:["position","pathIndex"],update(a,n,i){const s=a.get("position"),c=a.get("pathIndex");for(let p=n,l=3*p;p<i;p++,l+=3){const u=c[p],d=u>0?o[u]:null;if(d){const v=l+1,M=l+2;Me[0]=s[l],Me[1]=s[v],Me[2]=s[M],(0,r.subtract)(Re,Me,o[u-1].position);const g=(0,r.dot)(Re,d.dir);(0,r.scale)(le,d.dir,g),(0,r.subtract)(le,Re,le);const f=(0,r.squaredLength)(le);if(f>d.radiusSquared){(0,r.normalize)(le,le);const b=(0,r.scale)(le,le,Math.sqrt(d.radiusSquared)-Math.sqrt(f));s[l]=b[0],s[v]=b[1],s[M]=b[2]}}}}}},PathKill:function(e,t){const{path:o=[]}=t,a=o.length;return{components:["position","path","pathIndex","dead"],update(n,i,s){const c=n.get("pathIndex"),p=n.get("dead");for(let l=i;l<s;l++)c[l]>=a&&(p[l]=!0)}}},PathStop:function(e,t){const{path:o=[]}=t,a=o.length;return{components:["position","path","pathIndex","stopped"],update(n,i,s){const c=n.get("pathIndex"),p=n.get("stopped");for(let l=i;l<s;l++)c[l]>=a&&(p[l]=!0)}}},ShapeBounce:function(e,t){const o=new G[e.shape.type](e.shape),a=e.shape.direction||"in",n=!!e.trap,i=t.trapId||0;n&&(t.trapId=i+1);const s=1<<i,c=["position","velocity"];n&&c.push("trap");const p=o[a].bind(o);return{components:c,set(l,u,d,v){K(o,l,u,d,v)},update(l,u,d){const v=l.get("position"),M=l.get("velocity"),m=n?l.get("trap"):null,g=P.get();for(let f=u;f<d;f++)if(Y(g,o,v,f),p(g)){if(!n||m[f]&s){const b=3*f;o.surfaceProjection(g,ke,_e),v.set(ke,b),Q[0]=M[b],Q[1]=M[b+1],Q[2]=M[b+2];const x=(0,r.length)(Q);if(x){Q[0]/=x,Q[1]/=x,Q[2]/=x;const w=(0,r.dot)(Q,_e);(0,r.scale)(W,_e,2*w),(0,r.subtract)(W,Q,W),(0,r.scale)(W,W,x)}else W[0]=0,W[1]=0,W[2]=0;M.set(W,b)}}else n&&(m[f]|=s);P.release(g)}}},ShapeKill:function(e,t){const o=new G[e.shape.type](e.shape),a=e.shape.direction||"in",n=!!e.trap,i=t.trapId||0;n&&(t.trapId=i+1);const s=1<<i,c=["position","dead"];n&&c.push("trap");const p=o[a].bind(o);return{components:c,set(l,u,d,v){K(o,l,u,d,v)},update(l,u,d){const v=l.get("position"),M=l.get("dead"),m=n?l.get("trap"):null,g=P.get();for(let f=u;f<d;f++)Y(g,o,v,f),p(g)?(!n||m[f]&s)&&(M[f]=!0):n&&(m[f]|=s);P.release(g)}}},ShapeStop:function(e,t){const o=new G[e.shape.type](e.shape),a=e.shape.direction||"in",n=!!e.trap,i=t.trapId||0;n&&(t.trapId=i+1);const s=1<<i,c=["position","stopped"];n&&c.push("trap");const p=o[a].bind(o);return{components:c,set(l,u,d,v){K(o,l,u,d,v)},update(l,u,d){const v=l.get("position"),M=l.get("stopped"),m=n?l.get("trap"):null,g=P.get();for(let f=u;f<d;f++)Y(g,o,v,f),p(g)?(!n||m[f]&s)&&(M[f]=!0):n&&(m[f]|=s);P.release(g)}}}},be={position:{constructor:Float32Array,size:3},velocity:{constructor:Float32Array,size:3},color:{constructor:Uint8Array,size:4,geometry:!0},scaleRotation:{constructor:Float32Array,size:2,geometry:!0,init(e,t,o){for(let a=2*t,n=2*o;a<n;a+=2)e[a]=1,e[a+1]=0}},uvTranslate:{constructor:Float32Array,size:2,geometry:2,init(e,t,o,a){const{spriteRows:n=0,spriteCols:i=1,spriteStartFrame:s=0}=a,c=s%i/i,p=(n-1-Math.floor(s/i))/n;for(let l=2*t,u=2*o;l<u;l+=2)e[l]=c,e[l+1]=p}},dead:{init:!1},stopped:{init:!1}},j=(0,r.create)();class Ye{constructor(t){z(this,"emissionAverage"),z(this,"emissionVariance"),z(this,"bounds",{min:(0,r.clone)([1/0,1/0,1/0]),max:(0,r.clone)([-1/0,-1/0,-1/0])}),z(this,"arrays"),z(this,"particles"),z(this,"active"),z(this,"update"),z(this,"reset"),z(this,"set");const{numParticles:o}=t,a=new Float32Array(3*o),n=new Float32Array(3*o),i={position:{data:a,numComponents:3,drawType:35048}},s=new Map([["position",a],["velocity",n],["dead",new Array(o)],["stopped",new Array(o)]]),c={},p=new Map;function l(h){return"function"==typeof h?h:(h.components&&h.components.forEach(y=>{if(!s.has(y)){const A=be[y],_=A?.size||1,R=new(A?.constructor||Array)(o*_);s.set(y,R),A?.geometry&&(i[y]={data:R,drawType:35048,numComponents:_})}}),h.update)}const u=[];t.creators.filter(h=>!!Ee[h.type]||(console.error(`Undefined particle system creator: '${h.type}'`,h),!1)).forEach(h=>{const y=Ee[h.type](h,c,t),A=l(y);u.push(A),h.id&&("function"!=typeof y?p.set(h.id,y):console.error("Cannot update component",h.type))});const d=[];t.updaters?.filter(h=>!!je[h.type]||(console.error(`Undefined particle system updater: '${h.type}'`,h),!1)).map(h=>{const y=je[h.type](h,c,t),A=l(y);d.push(A),h.id&&("function"!=typeof y?p.set(h.id,y):console.error("Cannot update component",h.type))});const v=[];t.constraints?.filter(h=>!!qe[h.type]||(console.error(`Undefined particle system constraint: '${h.type}'`,h),!1)).map(h=>{const y=qe[h.type](h,c,t),A=l(y);v.push(A),h.id&&("function"!=typeof y?p.set(h.id,y):console.error("Cannot update component",h.type))});const M=t.maxSpeed||0,m=M*M;this.emissionAverage=t.emissionAverage??1,this.emissionVariance=t.emissionVariance||0;let g=1/0,f=0,b=0;function x(h){const y=f-1;f--,h!==y&&s.forEach((A,I)=>{const _=be[I];if(_?.copy)return void _.copy(A,y,h);const R=_?.size||1;if(1===R)A[h]=A[y];else for(let U=0,J=y*R,N=h*R;U<R;U++,J++,N++)A[N]=A[J]})}function w(h){const y=b-1;s.forEach((A,I)=>{const _=be[I];if(_?.swap)return void _.swap(A,y,h);const R=_?.size||1;if(1===R){const U=A[h];A[h]=A[y],A[y]=U}else for(let U=0,J=y*R,N=h*R;U<R;U++,J++,N++){const de=A[N];A[N]=A[J],A[J]=de}}),b++}this.update=h=>{const y=Math.min(.04,Math.max(0,h-g));g=h;let A=!1;if(f<o){const Z=this.emissionVariance*y;let B=Math.max(this.emissionAverage*y+2*Math.random()*Z-Z,0);if(B=B>=1?Math.floor(B):Math.random()<B?1:0,B>0){const T=Math.min(f+B,o);s.forEach((X,D)=>{const L=be[D];if("function"==typeof L?.init)return void L.init(X,f,T,t);const pe=L?.size||1,he=L?.init??0;if(oe(X))X.fill(he,f*pe,T*pe);else if(Array.isArray(X))if(1===pe)for(let ue=f;ue<T;ue++)X[ue]=he;else for(let ue=f*pe,He=T*pe;ue<He;ue++)X[ue]=he}),u.forEach(X=>{X(s,f,T,y)}),f=T,A=!0}}if(f>b){d.forEach(T=>{T(s,b,f,y)});for(let T=b,X=3*T,D=X+1,L=X+2;T<f;T++,X+=3,D+=3,L+=3){if(j[0]=n[X]*y,j[1]=n[D]*y,j[2]=n[L]*y,m>0){const pe=j[0]*j[0]+j[1]*j[1]+j[2]*j[2];if(pe>m){const he=Math.sqrt(pe);(0,r.scale)(j,j,M/he),n.set(j,X)}}a[X]+=j[0],a[D]+=j[1],a[L]+=j[2]}const q=s.get("rotationSpeed");if(q){const T=s.get("scaleRotation");for(let X=b,D=2*X+1;X<f;X++,D+=2)T[D]+=q[X]*y}const Z=s.get("age"),B=s.get("lifetime");if(Z&&B)for(let T=b;T<f;T++)Z[T]=Math.min(Z[T]+y,B[T]);v.forEach(T=>{T(s,b,f,y)}),A=!0}const I=s.get("dead"),_=s.get("stopped");if(I||_)for(let q=f-1;q>=b;q--)I&&I[q]?(x(q),A=!0):_&&_[q]&&(w(q),A=!0);let R=1/0,U=1/0,J=1/0,N=-1/0,de=-1/0,ze=-1/0;for(let q=0,Z=3*q,B=Z+1,T=Z+2;q<f;q++,Z+=3,B+=3,T+=3){const X=a[Z],D=a[B],L=a[T];X<R&&(R=X),D<U&&(U=D),L<J&&(J=L),X>N&&(N=X),D>de&&(de=D),L>ze&&(ze=L)}return(0,r.set)(this.bounds.min,R,U,J),(0,r.set)(this.bounds.max,N,de,ze),A},this.reset=()=>{f=0,b=0},this.set=(h,y,A,I,_)=>{const R=p.get(h);R&&R.set?R.set(y,A,I,_):console.warn("Unknown particle system component",h)},Object.defineProperties(this,{arrays:{get:()=>i},particles:{get:()=>f},active:{get:()=>f-b}})}}const ee=new Map,Ae=new Set;let fe=0;function De(e,t,o="update"){const{particles:a,arrays:n,bounds:i}=t,s={},c=[];Object.keys(n).forEach(p=>{const{data:l,...u}=n[p],v=l.slice(0,"create"===o?l.length:a*(u.numComponents||3));s[p]={...u,data:v},c.push(v.buffer)}),self.postMessage({command:o,id:e,particles:a,arrays:s,bounds:{min:Array.from(i.min),max:Array.from(i.max)}},c)}function Le(){const e=performance.now()/1e3;Ae.forEach(t=>{const o=ee.get(t);o.update(e)&&De(t,o)}),fe=setTimeout(Le,8)}const Ze={create:function(e){const{id:t,def:o}=e;if(ee.has(t))return void console.warn(`Simulation worker: Simulation already exists: '${t}'`);const a=new Ye(o);ee.set(t,a),De(t,a,"create")},destroy:function(e){const{id:t}=e;ee.get(t)?ee.delete(t):console.warn(`Simulation worker: Simulation not found: '${t}'`)},start:function(e){Ae.add(e.id),fe||(fe=setTimeout(Le,8))},pause:function(e){Ae.delete(e.id),Ae.size||(clearTimeout(fe),fe=0)},set(e){const{id:t,componentId:o,key:a,x:n,y:i,z:s}=e;ee.get(t).set(o,a,n,i,s)},emissionAverage(e){const{id:t,value:o}=e;ee.get(t).emissionAverage=o},emissionVariance(e){const{id:t,value:o}=e;ee.get(t).emissionVariance=o},reset(e){ee.get(e.id).reset()},returnArrays(){}};self.onmessage=e=>{const t=Ze[e.data.command];t?t(e.data):console.warn(`Simulation worker: Unrecognized command: '${e.data.command||""}'`)}})()}},H={};function V(S){var k=H[S];if(void 0!==k)return k.exports;var F=H[S]={exports:{}};return te[S](F,F.exports,V),F.exports}V.m=te,V.x=()=>{var S=V.O(void 0,[14,296],()=>V(7902));return V.O(S)},S=[],V.O=(k,F,oe,r)=>{if(!F){var O=1/0;for(C=0;C<S.length;C++){for(var[F,oe,r]=S[C],$=!0,E=0;E<F.length;E++)(!1&r||O>=r)&&Object.keys(V.O).every(we=>V.O[we](F[E]))?F.splice(E--,1):($=!1,r<O&&(O=r));if($){S.splice(C--,1);var ae=oe();void 0!==ae&&(k=ae)}}return k}r=r||0;for(var C=S.length;C>0&&S[C-1][2]>r;C--)S[C]=S[C-1];S[C]=[F,oe,r]},V.d=(S,k)=>{for(var F in k)V.o(k,F)&&!V.o(S,F)&&Object.defineProperty(S,F,{enumerable:!0,get:k[F]})},V.f={},V.e=S=>Promise.all(Object.keys(V.f).reduce((k,F)=>(V.f[F](S,k),k),[])),V.u=S=>S+".js",V.miniCssF=S=>{},V.o=(S,k)=>Object.prototype.hasOwnProperty.call(S,k),V.r=S=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})},(()=>{var S;V.tt=()=>(void 0===S&&(S={createScriptURL:k=>k},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(S=trustedTypes.createPolicy("angular#bundler",S))),S)})(),V.tu=S=>V.tt().createScriptURL(S),V.p="",(()=>{var S={902:1};V.f.i=(r,C)=>{S[r]||importScripts(V.tu(V.p+V.u(r)))};var F=self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[],oe=F.push.bind(F);F.push=r=>{var[C,O,$]=r;for(var E in O)V.o(O,E)&&(V.m[E]=O[E]);for($&&$(V);C.length;)S[C.pop()]=1;oe(r)}})(),(()=>{var S=V.x;V.x=()=>Promise.all([V.e(14),V.e(296)]).then(S)})(),V.x()})();