(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[951],{86234:(re,Z,s)=>{"use strict";s.d(Z,{l:()=>Be});var z,e=s(58743),p=s(65776),b=s(13976),o=s(54438),C=s(60177),V=s(65763),G=s(85052),x=s(2573),g=(s(31462),s(47610)),c=s(55494),E=s(65985),w=s(26779),h=s(49204),u=s(76718),D=s(14264),R=s(37925),$=s(12347),d=s(79805),k=s(515),W=s(94495),N=s(35286),m=function(M,S,f,L){var xe,ee=arguments.length,ie=ee<3?S:null===L?L=Object.getOwnPropertyDescriptor(S,f):L;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)ie=Reflect.decorate(M,S,f,L);else for(var De=M.length-1;De>=0;De--)(xe=M[De])&&(ie=(ee<3?xe(ie):ee>3?xe(S,f,ie):xe(S,f))||ie);return ee>3&&ie&&Object.defineProperty(S,f,ie),ie},P=function(M,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(M,S)};const U=["image"],j=["imagePre"],H=["imagePost"],q=["imageContainer"];function se(M,S){if(1&M&&(o.nrm(0,"div",10),o.nI1(1,"markdown"),o.nI1(2,"async")),2&M){const f=o.XpG();o.Y8G("innerHTML",o.bMT(2,3,o.bMT(1,1,f.label)),o.npT)}}function O(M,S){if(1&M&&o.nrm(0,"img",11,2),2&M){const f=o.XpG();o.Y8G("src",f.imageUrl,o.B4B)}}function K(M,S){if(1&M&&o.nrm(0,"img",12,3),2&M){const f=o.XpG();o.Y8G("src",f.imageUrl,o.B4B)}}class J{constructor(S,f,L,ee){this.renderer=S,this.engineService=f,this.animationService=L,this.store=ee,this.ngUnsubscribe=new G.B,this.loopImage=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,D.p)(S=>!!S.animation),(0,R.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}initTimelineListener(){(0,u.h)(this.engineService.getEvent(k.X.TimelineScrubbed),this.engineService.getEvent(k.X.TimelinePlaying)).pipe((0,R.Q)(this.ngUnsubscribe)).subscribe(S=>{const f=this.getChapterPercent();this.moveImage(f)})}handleClick(S){const f=this.store.selectSnapshot(c.S.getAnimationPlaying);f&&this.animationService.pause(),this.scrub(S),setTimeout(()=>{f&&this.animationService.unpause()})}scrub(S){if(S.currentTarget instanceof HTMLElement){const f=S.currentTarget.getBoundingClientRect(),ie=this.timerange.lastTime-this.timerange.firstTime,De=(S.clientX-f.left-f.width/2)*(ie/this.getImageWidth());let Re=this.animationService.getTime()+De;this.loopImage&&(Re<0?Re=ie+Re:Re>ie&&(Re-=ie)),Re>=0&&Re<=ie&&this.animationService.scrub(Re)}}moveImage(S){const f=this.getImageWidth();this.renderer.setStyle(this.imageContainer.nativeElement,"transform",`translate(${S/100*-f}px, 0)`),this.loopImage&&(this.renderer.setStyle(this.imagePre.nativeElement,"transform",`translate(${-f}px, 0)`),this.renderer.setStyle(this.imagePost.nativeElement,"transform",`translate(${f}px, 0)`))}getImageWidth(){return this.image.nativeElement.getBoundingClientRect().width}getChapterPercent(){if((0,h.isNil)(this.timerange))return 0;const{firstTime:S,lastTime:f}=this.timerange,L=this.animationService.getTime();return Math.max(S,Math.min(L,f))/f*100}}var X;(z=J).\u0275fac=function(S){return new(S||z)(o.rXU(o.sFG),o.rXU(d.y),o.rXU($.O),o.rXU(V.il))},z.\u0275cmp=o.VBU({type:z,selectors:[["app-ticker-block-item"]],viewQuery:function(S,f){if(1&S&&(o.GBs(U,7),o.GBs(j,5),o.GBs(H,5),o.GBs(q,7)),2&S){let L;o.mGM(L=o.lsd())&&(f.image=L.first),o.mGM(L=o.lsd())&&(f.imagePre=L.first),o.mGM(L=o.lsd())&&(f.imagePost=L.first),o.mGM(L=o.lsd())&&(f.imageContainer=L.first)}},inputs:{label:"label",imageUrl:"imageUrl",loopImage:"loopImage"},decls:8,vars:4,consts:[["imageContainer",""],["image",""],["imagePre",""],["imagePost",""],[1,"ticker-block-item",3,"click"],["class","ticker-block-item__label html",3,"innerHTML",4,"ngIf"],[1,"ticker-block-item__image-container"],["class","ticker-block-item__image ticker-block-item__image--pre",3,"src",4,"ngIf"],["class","ticker-block-item__image ticker-block-item__image--post",3,"src",4,"ngIf"],[1,"ticker-block-item__image",3,"src"],[1,"ticker-block-item__label","html",3,"innerHTML"],[1,"ticker-block-item__image","ticker-block-item__image--pre",3,"src"],[1,"ticker-block-item__image","ticker-block-item__image--post",3,"src"]],template:function(S,f){if(1&S){const L=o.RV6();o.j41(0,"div",4),o.bIt("click",function(ie){return o.eBV(L),o.Njj(f.handleClick(ie))}),o.DNE(1,se,3,5,"div",5),o.j41(2,"div",6,0),o.DNE(4,O,2,1,"img",7)(5,K,2,1,"img",8),o.nrm(6,"img",9,1),o.k0s()()}2&S&&(o.R7$(),o.Y8G("ngIf",f.label),o.R7$(3),o.Y8G("ngIf",f.loopImage),o.R7$(),o.Y8G("ngIf",f.loopImage),o.R7$(),o.Y8G("src",f.imageUrl,o.B4B))},dependencies:[C.bT,C.Jj,N.i0],styles:['.ticker-block-item[_ngcontent-%COMP%]{--label-height: 24px;background:#f9fafd;background:linear-gradient(90deg,#f9fafd 20%,#fff0,#fff,#f9fafd 80%);overflow:hidden;padding-left:50%;position:relative;cursor:pointer}.ticker-block-item[_ngcontent-%COMP%]:hover   .ticker-block-item__label[_ngcontent-%COMP%]{background:#ffffffe6}.ticker-block-item[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;left:50%;top:0;height:100%;width:1px;background:red;box-shadow:0 0 0 4px #f003;z-index:10}.ticker-block-item__label[_ngcontent-%COMP%]{position:absolute;height:var(--label-height);left:0;top:0;width:100%;display:flex;align-items:center;font-size:12px;z-index:10;background:#ffffff8c}.ticker-block-item__image-container[_ngcontent-%COMP%]{position:relative;margin-top:var(--label-height);pointer-events:none;-webkit-user-select:none;user-select:none}.ticker-block-item__image[_ngcontent-%COMP%]{display:block;max-width:none}.ticker-block-item__image--pre[_ngcontent-%COMP%], .ticker-block-item__image--post[_ngcontent-%COMP%]{position:absolute;top:0;left:0}'],changeDetection:0}),m([(0,V.l6)(c.S.getAnimationPlaying),P("design:type",x.c)],J.prototype,"animationPlaying$",void 0),m([(0,V.l6)(W.N.getSelectedChapterReadyState),P("design:type",x.c)],J.prototype,"chapterReadyState$",void 0);const ge=["guideline"];function T(M,S){if(1&M&&o.nrm(0,"app-ticker-block-item",11),2&M){const f=S.$implicit,L=o.XpG(2);o.Y8G("imageUrl",f.urls.default)("label",f.caption)("loopImage",L.tickerBlock.loopImage)}}function y(M,S){if(1&M){const f=o.RV6();o.j41(0,"div",3)(1,"div",4),o.bIt("mouseenter",function(){o.eBV(f);const ee=o.XpG();return o.Njj(ee.handleMouseEnter())})("mouseleave",function(){o.eBV(f);const ee=o.XpG();return o.Njj(ee.handleMouseLeave())})("mousemove",function(ee){o.eBV(f);const ie=o.XpG();return o.Njj(ie.handleMouseMove(ee))}),o.DNE(2,T,1,3,"app-ticker-block-item",5),o.nrm(3,"div",6,0),o.k0s(),o.j41(5,"button",7),o.bIt("click",function(){o.eBV(f);const ee=o.XpG();return o.Njj(ee.handlePlayClick())}),o.j41(6,"span",8),o.EFF(7),o.nI1(8,"async"),o.k0s(),o.nrm(9,"app-icon",9),o.nI1(10,"async"),o.j41(11,"span",10),o.pXf(12,1),o.nI1(13,"async"),o.k0s()()()}if(2&M){const f=o.XpG();o.R7$(2),o.Y8G("ngForOf",f.tickerBlock.images),o.R7$(5),o.JRh(f.getAnimationPlayingTooltip(o.bMT(8,4,f.animationPlaying$))),o.R7$(2),o.Y8G("icon",o.bMT(10,6,f.animationPlaying$)?"pause":"play"),o.R7$(4),o.uP7(o.bMT(13,8,f.animationPlaying$)?"Pause":"Play"),o.nnv(12)}}class v{constructor(S,f){this.store=S,this.renderer=f,this.ngUnsubscribe=new G.B}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayClick(){const S=this.store.selectSnapshot(c.S.getAnimationPlaying);this.store.dispatch(new g.dE(!S))}getAnimationPlayingTooltip(S){return S?$localize`Pause Animation`:$localize`Play Animation`}handleMouseMove(S){const f=this.guideline.nativeElement,ee=f.parentElement.getBoundingClientRect();this.renderer.setStyle(f,"transform",`translate(${S.clientX-ee.left}px, 0)`)}handleMouseEnter(){this.renderer.setStyle(this.guideline.nativeElement,"display","block")}handleMouseLeave(){this.renderer.setStyle(this.guideline.nativeElement,"display","none")}}(X=v).\u0275fac=function(S){return new(S||X)(o.rXU(V.il),o.rXU(o.sFG))},X.\u0275cmp=o.VBU({type:X,selectors:[["app-ticker-block"]],viewQuery:function(S,f){if(1&S&&o.GBs(ge,5),2&S){let L;o.mGM(L=o.lsd())&&(f.guideline=L.first)}},inputs:{tickerBlock:"tickerBlock"},decls:1,vars:1,consts:()=>{let M;return M=$localize`:␟026d242c5f68dd78d7735a118cb96c4d3ed15eb6␟793165009929591137:${"\ufffd0\ufffd"}:INTERPOLATION: Animation`,[["guideline",""],M,["class","ticker-block",4,"ngIf"],[1,"ticker-block"],[1,"ticker-block__item-container",3,"mouseenter","mouseleave","mousemove"],[3,"imageUrl","label","loopImage",4,"ngFor","ngForOf"],[1,"ticker-block__guideline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"ticker-block__play",3,"click"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"],[1,"ml-2","text-uppercase","text-10"],[3,"imageUrl","label","loopImage"]]},template:function(S,f){1&S&&o.DNE(0,y,14,10,"div",2),2&S&&o.Y8G("ngIf",f.tickerBlock)},dependencies:[C.Sq,C.bT,E.ri,w.R,J,C.Jj],styles:[".ticker-block__item-container[_ngcontent-%COMP%]{position:relative}.ticker-block__guideline[_ngcontent-%COMP%]{display:none;position:absolute;pointer-events:none;left:0;top:0;height:100%;width:1px;background:red;z-index:10}.ticker-block__play[_ngcontent-%COMP%]{width:100%;margin:12px 0}"],changeDetection:0}),function(M,S,f,L){var xe,ee=arguments.length,ie=ee<3?S:null===L?L=Object.getOwnPropertyDescriptor(S,f):L;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)ie=Reflect.decorate(M,S,f,L);else for(var De=M.length-1;De>=0;De--)(xe=M[De])&&(ie=(ee<3?xe(ie):ee>3?xe(S,f,ie):xe(S,f))||ie);ee>3&&ie&&Object.defineProperty(S,f,ie)}([(0,V.l6)(c.S.getAnimationPlaying),function(M,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",S)}(0,x.c)],v.prototype,"animationPlaying$",void 0);var F=s(70914);let ne=(()=>{var M;class S{constructor(){this.layout=e.j.Normal}ngOnInit(){}}return(M=S).\u0275fac=function(L){return new(L||M)},M.\u0275cmp=o.VBU({type:M,selectors:[["app-markdown-block"]],inputs:{markdownBlock:"markdownBlock",layout:"layout"},decls:2,vars:1,consts:[[1,"markdown-block"],[3,"markdownText"]],template:function(L,ee){1&L&&(o.j41(0,"div",0),o.nrm(1,"app-html",1),o.k0s()),2&L&&(o.R7$(),o.Y8G("markdownText",ee.markdownBlock.markdown))},dependencies:[F.V],encapsulation:2,changeDetection:0}),S})();var Y=s(47010),le=s(86008),fe=(s(71441),s(7431)),Te=s(62751),Q=s(15185);function Pe(M,S){if(1&M){const f=o.RV6();o.j41(0,"li",2)(1,"button",3),o.bIt("click",function(){const ee=o.eBV(f).$implicit,ie=o.XpG();return o.Njj(ie.handlePositionClick(ee))}),o.j41(2,"div",4),o.nrm(3,"app-thumbnail-view",5),o.k0s(),o.j41(4,"div",6),o.EFF(5),o.k0s()()()}if(2&M){const f=S.$implicit;o.R7$(3),o.Y8G("thumbnail",f.thumbnail),o.R7$(2),o.JRh(f.title)}}let We=(()=>{var M;class S{constructor(L){this.store=L}handlePositionClick(L){this.store.dispatch(new fe.Ih(L.camera.location,L.camera.action===Te.L.FlyTo,void 0,L.camera.rotationCenter))}}return(M=S).\u0275fac=function(L){return new(L||M)(o.rXU(V.il))},M.\u0275cmp=o.VBU({type:M,selectors:[["app-position-block"]],inputs:{positionBlock:"positionBlock"},decls:2,vars:1,consts:[[1,"view-positions"],["class","view-positions__list-item",4,"ngFor","ngForOf"],[1,"view-positions__list-item"],[1,"view-positions__item",3,"click"],[1,"view-positions__thumbnail"],[3,"thumbnail"],[1,"view-positions__title"]],template:function(L,ee){1&L&&(o.j41(0,"ul",0),o.DNE(1,Pe,6,2,"li",1),o.k0s()),2&L&&(o.R7$(),o.Y8G("ngForOf",ee.positionBlock.positions))},dependencies:[C.Sq,Q.J],styles:[".view-positions__list-item[_ngcontent-%COMP%]{padding-bottom:8px}.view-positions__item[_ngcontent-%COMP%]{background:none;border:0;display:flex;padding:12px 12px 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:start;align-items:center}.view-positions__item[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.view-positions__item[_ngcontent-%COMP%]:hover, .view-positions__item--selected[_ngcontent-%COMP%]:hover{background-color:#131c2a0d}.view-positions__item--selected[_ngcontent-%COMP%]   .view-positions__title[_ngcontent-%COMP%]{font-weight:600}.view-positions__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-inline-end:12px;border:1px solid #eaeff5;border-radius:4px}.view-positions__title[_ngcontent-%COMP%]{color:#131c2a;font-size:.875rem;line-height:1.25rem;word-break:break-word}"],changeDetection:0}),S})();function dt(M,S){if(1&M&&o.nrm(0,"app-ticker-block",9),2&M){const f=o.XpG(2).$implicit;o.Y8G("tickerBlock",f)}}function ce(M,S){if(1&M&&(o.qex(0),o.DNE(1,dt,1,1,"app-ticker-block",8),o.bVm()),2&M){const f=o.XpG().$implicit;o.R7$(),o.Y8G("ngIf",f.enable)}}function Qe(M,S){if(1&M&&o.nrm(0,"app-markdown-block",10),2&M){const f=o.XpG().$implicit,L=o.XpG(2);o.Y8G("markdownBlock",f)("layout",L.layout)}}function ot(M,S){if(1&M&&o.nrm(0,"app-images-block",11),2&M){const f=o.XpG().$implicit,L=o.XpG(2);o.Y8G("imagesBlock",f)("layout",L.layout)}}function pt(M,S){if(1&M&&o.nrm(0,"app-videos-block",12),2&M){const f=o.XpG().$implicit,L=o.XpG(2);o.Y8G("videosBlock",f)("layout",L.layout)}}function st(M,S){if(1&M&&o.nrm(0,"app-position-block",13),2&M){const f=o.XpG().$implicit;o.Y8G("positionBlock",f)}}function _t(M,S){if(1&M&&(o.j41(0,"div"),o.qex(1,2),o.DNE(2,ce,2,1,"ng-container",3)(3,Qe,1,2,"app-markdown-block",4)(4,ot,1,2,"app-images-block",5)(5,pt,1,2,"app-videos-block",6)(6,st,1,1,"app-position-block",7),o.bVm(),o.k0s()),2&M){const f=S.$implicit,L=S.index,ee=o.XpG(2);o.AVh("mt-6",L>0),o.R7$(),o.Y8G("ngSwitch",f.type),o.R7$(),o.Y8G("ngSwitchCase",ee.contentBlockTypes.Ticker),o.R7$(),o.Y8G("ngSwitchCase",ee.contentBlockTypes.Markdown),o.R7$(),o.Y8G("ngSwitchCase",ee.contentBlockTypes.Images),o.R7$(),o.Y8G("ngSwitchCase",ee.contentBlockTypes.Videos),o.R7$(),o.Y8G("ngSwitchCase",ee.contentBlockTypes.Positions)}}function at(M,S){if(1&M&&(o.qex(0),o.DNE(1,_t,7,8,"div",1),o.bVm()),2&M){const f=o.XpG();o.R7$(),o.Y8G("ngForOf",f.contentBlocks)("ngForTrackBy",f.trackContentBlock)}}let Be=(()=>{var M;class S{get contentBlocks(){return this.contentBlocksService.filterContentBlocksByType(this._contentBlocks,this.include,this.exclude)}set contentBlocks(L){this._contentBlocks=L}constructor(L){this.contentBlocksService=L,this.contentBlockTypes=p.m,this._contentBlocks=[],this.layout=e.j.Normal,this.include=[],this.exclude=[]}trackContentBlock(L,ee){return ee.type}}return(M=S).\u0275fac=function(L){return new(L||M)(o.rXU(b.V))},M.\u0275cmp=o.VBU({type:M,selectors:[["app-content-blocks"]],inputs:{contentBlocks:"contentBlocks",layout:"layout",include:"include",exclude:"exclude"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"mt-6",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"markdownBlock","layout",4,"ngSwitchCase"],[3,"imagesBlock","layout",4,"ngSwitchCase"],[3,"videosBlock","layout",4,"ngSwitchCase"],[3,"positionBlock",4,"ngSwitchCase"],[3,"tickerBlock",4,"ngIf"],[3,"tickerBlock"],[3,"markdownBlock","layout"],[3,"imagesBlock","layout"],[3,"videosBlock","layout"],[3,"positionBlock"]],template:function(L,ee){1&L&&o.DNE(0,at,2,2,"ng-container",0),2&L&&o.Y8G("ngIf",ee.contentBlocks.length>0)},dependencies:[C.Sq,C.bT,C.ux,C.e1,v,ne,Y.Z,le.V,We],encapsulation:2,changeDetection:0}),S})()},71441:(re,Z,s)=>{"use strict";s.d(Z,{q:()=>p,z:()=>b});var e=s(65776);class p{}class b{constructor(){this.type=e.m.Positions,this.positions=[]}}},31462:(re,Z,s)=>{"use strict";s.d(Z,{F:()=>p,g:()=>b});var e=s(65776);class p{}class b{constructor(){this.type=e.m.Ticker,this.images=[],this.loopImage=!1,this.enable=!0}}},57535:(re,Z,s)=>{"use strict";s.d(Z,{C6:()=>g,DT:()=>c,EA:()=>se,Fg:()=>G,Fq:()=>w,Ir:()=>P,MH:()=>H,Mj:()=>x,U8:()=>$,Vs:()=>D,hG:()=>R,jQ:()=>d,qA:()=>V,qg:()=>U,t0:()=>q,xM:()=>j,yB:()=>E});var e=s(38970),p=s(49204),o=s(59429);const C={type:e.Po.Cube,direction:e.zu.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},V=[e.lc.ShapeBounce,e.lc.ShapeKill,e.lc.ShapeStop],G={[e.lc.LifetimeKill]:{type:e.lc.LifetimeKill},[e.lc.LifetimeStop]:{type:e.lc.LifetimeStop},[e.lc.PathKill]:{type:e.lc.PathKill},[e.lc.PathStop]:{type:e.lc.PathStop},[e.lc.PathRadius]:{type:e.lc.PathRadius},[e.lc.ShapeBounce]:{type:e.lc.ShapeBounce,trap:!1,shape:{...C}},[e.lc.ShapeKill]:{type:e.lc.ShapeKill,trap:!1,shape:{...C}},[e.lc.ShapeStop]:{type:e.lc.ShapeStop,trap:!1,shape:{...C}}},x={[e.Uy.DirectionalVelocity]:{type:e.Uy.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[e.Uy.Lifetime]:{type:e.Uy.Lifetime,average:2.5,variance:1},[e.Uy.PointPosition]:{type:e.Uy.PointPosition,position:[0,0,0]},[e.Uy.RandomVelocity]:{type:e.Uy.RandomVelocity,forceAverage:5,forceVariance:0},[e.Uy.SpherePosition]:{type:e.Uy.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.CylinderPosition]:{type:e.Uy.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.CubePosition]:{type:e.Uy.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[e.Uy.RandomRotation]:{type:e.Uy.RandomRotation,average:0,variance:0},[e.Uy.RandomRotationSpeed]:{type:e.Uy.RandomRotationSpeed,average:0,variance:180},[e.Uy.RandomScale]:{type:e.Uy.RandomScale,average:1,variance:0},[e.Uy.SpriteAnimationDuration]:{type:e.Uy.SpriteAnimationDuration,average:1,variance:0}},A={[e.$t.AgeColorBlend]:{type:e.$t.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[e.$t.BrownianMotion]:{type:e.$t.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[e.$t.UniformForce]:{type:e.$t.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[e.$t.RadialForce]:{type:e.$t.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[e.$t.Friction]:{type:e.$t.Friction,friction:.1},[e.$t.Gravity]:{type:e.$t.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[e.$t.Path]:{type:e.$t.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[e.$t.AxisForce]:{type:e.$t.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[e.$t.SpriteAnimation]:{type:e.$t.SpriteAnimation}},g={type:e.Po.Sphere,direction:e.zu.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},c={baseColor:{r:1,g:0,b:0},alpha:1},E={spriteRows:8,spriteCols:8,spriteStartFrame:0,spriteEndFrame:63},w={layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},h={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{...w},constraints:[G[e.lc.LifetimeKill]],creators:[x[e.Uy.PointPosition],x[e.Uy.RandomVelocity],x[e.Uy.Lifetime]],updaters:[A[e.$t.AgeColorBlend],A[e.$t.Friction]]},u={...h,material:c,...E};function D(){const O=JSON.parse(JSON.stringify(h)),{constraints:K,creators:J,updaters:X}=O;return{...O,constraints:K.map((de,ae)=>({...de,id:o.u.idWithPrefix("constraint")})),creators:J.map((de,ae)=>({...de,id:o.u.idWithPrefix("creator")})),updaters:X.map((de,ae)=>({...de,id:o.u.idWithPrefix("updater")}))}}function R(O){return{...G[O]}}function $(O){return{...x[O]}}function d(O){return{...A[O]}}function k(O){return(0,p.omitBy)(O,p.isNil)}function P(O){return k(function W(O){return Object.keys(u).reduce((K,J)=>(K[J]=O[J],K),{})}(O))}function U(O,K){return k(function N(O,K){const{id:J,name:X,shape:de,trap:ae}=K;return V.includes(O)?{id:J,name:X,type:O,trap:ae,shape:de}:{id:J,name:X,type:O}}(O,K))}function j(O,K){return k(function z(O,K){const{id:J,name:X,directionAverage:de,forceAverage:ae,directionVariance:ge,forceVariance:T,average:y,variance:v,position:B,scale:F,rotate:ne,translate:Y}=K;switch(O){case e.Uy.DirectionalVelocity:return{id:J,name:X,type:O,directionAverage:de,forceAverage:ae,directionVariance:ge,forceVariance:T};case e.Uy.Lifetime:return{id:J,name:X,type:O,average:y,variance:v};case e.Uy.PointPosition:return{id:J,name:X,type:O,position:B};case e.Uy.RandomVelocity:return{id:J,name:X,type:O,forceAverage:ae,forceVariance:T};case e.Uy.SpherePosition:case e.Uy.CylinderPosition:case e.Uy.CubePosition:return{id:J,name:X,type:O,scale:F,rotate:ne,translate:Y};case e.Uy.RandomRotation:case e.Uy.RandomRotationSpeed:case e.Uy.RandomScale:case e.Uy.SpriteAnimationDuration:return{id:J,name:X,type:O,average:y,variance:v};default:return}}(O,K))}function H(O,K){return k(function m(O,K){const{id:J,name:X,colors:de,position:ae,direction:ge,friction:T,frequency:y,forceAverage:v,radius:B,forceVariance:F,nodes:ne,shape:Y,directionAverage:le,directionVariance:be}=K;switch(O){case e.$t.AgeColorBlend:return{id:J,name:X,type:O,colors:de,shape:Y};case e.$t.BrownianMotion:return{id:J,name:X,type:O,frequency:y,forceAverage:v,forceVariance:F,shape:Y};case e.$t.UniformForce:return{id:J,name:X,type:O,directionAverage:le,forceAverage:v,directionVariance:be,forceVariance:F,shape:Y};case e.$t.RadialForce:return{id:J,name:X,type:O,position:ae,forceAverage:v,forceVariance:F,shape:Y};case e.$t.Friction:return{id:J,name:X,type:O,friction:T,shape:Y};case e.$t.Gravity:return{id:J,name:X,type:O,position:ae,radius:B,forceAverage:v,forceVariance:F,shape:Y};case e.$t.Path:return{id:J,name:X,type:O,nodes:ne,shape:Y};case e.$t.AxisForce:return{id:J,name:X,type:O,position:ae,direction:ge,forceAverage:v,forceVariance:F,shape:Y};case e.$t.SpriteAnimation:return{id:J,name:X,type:O};default:return}}(O,K))}function q(O,K){return![e.lc.PathKill,e.lc.PathRadius,e.lc.PathStop].includes(K)||O.updaters.some(de=>de.type===e.$t.Path)}function se(O){return(0,p.omit)(O,["materialId","material","textures"])}},51002:(re,Z,s)=>{"use strict";s.d(Z,{k:()=>ge});var j,e=s(47555),p=s(65763),b=s(3829),o=s(85052),C=s(37925),V=s(2573),G=s(7431),x=s(94495),A=s(93822),g=s(93915),c=s(49969),E=s(15623),w=s(61295),h=s(75069),u=s(3266),D=s(39358),R=s(55494),$=s(73987),d=s(54438),k=s(18617),W=s(60177),N=s(12637),z=s(14823),m=s(65985),P=s(26779),U=s(82487),H=function(T,y,v,B){var Y,F=arguments.length,ne=F<3?y:null===B?B=Object.getOwnPropertyDescriptor(y,v):B;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)ne=Reflect.decorate(T,y,v,B);else for(var le=T.length-1;le>=0;le--)(Y=T[le])&&(ne=(F<3?Y(ne):F>3?Y(y,v,ne):Y(y,v))||ne);return F>3&&ne&&Object.defineProperty(y,v,ne),ne},q=function(T,y){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(T,y)};function se(T,y){1&T&&d.nrm(0,"app-icon",16)}function O(T,y){1&T&&d.nrm(0,"app-icon",17),2&T&&d.Y8G("custom",!0)}function K(T,y){1&T&&(d.j41(0,"span",8),d.pXf(1,2),d.k0s())}function J(T,y){1&T&&(d.j41(0,"span",8),d.pXf(1,3),d.k0s())}function X(T,y){if(1&T){const v=d.RV6();d.j41(0,"li")(1,"button",18),d.bIt("touchend",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("in"))})("mouseup",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("in"))})("keyup.enter",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("in"))}),d.nrm(2,"app-icon",19),d.k0s()()}}function de(T,y){if(1&T){const v=d.RV6();d.j41(0,"li")(1,"button",20),d.bIt("touchend",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("out"))})("mouseup",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("out"))})("keyup.enter",function(){d.eBV(v);const F=d.XpG(2);return d.Njj(F.setZoomFixed("out"))}),d.nrm(2,"app-icon",21),d.k0s()()}}function ae(T,y){if(1&T){const v=d.RV6();d.qex(0),d.j41(1,"li")(2,"button",12),d.nI1(3,"async"),d.bIt("click",function(){d.eBV(v);const F=d.XpG();return d.Njj(F.togglePan())}),d.DNE(4,se,1,0,"app-icon",13),d.nI1(5,"async"),d.DNE(6,O,1,1,"app-icon",14),d.nI1(7,"async"),d.DNE(8,K,2,0,"span",15),d.nI1(9,"async"),d.DNE(10,J,2,0,"span",15),d.nI1(11,"async"),d.k0s()(),d.DNE(12,X,3,0,"li",11),d.nI1(13,"async"),d.DNE(14,de,3,0,"li",11),d.nI1(15,"async"),d.bVm()}if(2&T){const v=d.XpG();d.R7$(2),d.Y8G("matTooltip",v.cameraModeTooltip),d.BMQ("aria-pressed","pan"===d.bMT(3,8,v.panMode$)),d.R7$(2),d.Y8G("ngIf","pan"===d.bMT(5,10,v.panMode$)),d.R7$(2),d.Y8G("ngIf","rotate"===d.bMT(7,12,v.panMode$)),d.R7$(2),d.Y8G("ngIf","pan"===d.bMT(9,14,v.panMode$)),d.R7$(2),d.Y8G("ngIf","rotate"===d.bMT(11,16,v.panMode$)),d.R7$(2),d.Y8G("ngIf",d.bMT(13,18,v.canvasHeightBreakpoint$)>v.canvasHeightBreakpoint.Tiny),d.R7$(2),d.Y8G("ngIf",d.bMT(15,20,v.canvasHeightBreakpoint$)>v.canvasHeightBreakpoint.Tiny)}}class ge{get cameraToggleTooltip(){return this.collapsed?$localize`Open 3D Controls`:$localize`Close 3D Controls`}constructor(y,v,B,F,ne){this.store=y,this.cameraService=v,this.viewService=B,this.liveAnnouncer=F,this.changeDetectorRef=ne,this.collapsed=!0,this.canCollapse=!0,this.viewLayout=A.U,this.toolEnum=e.s,this.expandNav=!1,this.breakpointEnum=E.m,this.canvasHeightBreakpoint=$.h,this.padding="none",this.ngUnsubscribe=new o.B,this.initTooltips()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTooltips(){this.panMode$.pipe((0,C.Q)(this.ngUnsubscribe)).subscribe(y=>{this.cameraModeTooltip="pan"===y?$localize`Change to Rotate Mode`:$localize`Change to Pan Mode`}),this.changeDetectorRef.markForCheck()}setZoomFixed(y){this.cameraService.setCameraZoomWithVelocity("in"===y?-8:8);const B=(100*this.cameraService.getCameraZoom()).toFixed(0);this.liveAnnouncer.announce(`zoomed ${y} to ${B}%`)}returnToChapterCamera(){const y=this.store.selectSnapshot(x.N.getSelectedChapter);this.store.dispatch(new G.Ih(y.camera.location)).subscribe(()=>{this.liveAnnouncer.announce("recenter complete")})}resetChapter(){this.returnToChapterCamera();const y=this.store.selectSnapshot(x.N.getSelectedChapterId);this.store.dispatch(new h.a.UndoAll(y)),this.store.dispatch(new w.q9(!1)),this.store.dispatch(new g.S3)}togglePan(){this.viewService.togglePan()}toggleCameraBar(){this.collapsed=!this.collapsed}}(j=ge).\u0275fac=function(y){return new(y||j)(d.rXU(p.il),d.rXU(u.j),d.rXU(D.z),d.rXU(k.Ai),d.rXU(d.gRc))},j.\u0275cmp=d.VBU({type:j,selectors:[["app-engine-camera-bar"]],inputs:{collapsed:"collapsed",canCollapse:"canCollapse"},decls:13,vars:4,consts:()=>{let T,y,v,B,F,ne,Y,le,be,fe;return T=$localize`:␟fa8adc0f5e22d9c18b37663b6f2bb1b50424eb1c␟8617328588319285229:Camera Control Buttons`,y=$localize`:␟ac4a855ff1671d74a0692e3b9ee5be349e6281ca␟6332173527621530176:Return to Starting Position`,v=$localize`:␟0c6b2042f7ade77091a6e0b314f5797a51644835␟918403358406080994:Toggle 3D navigation controls`,B=$localize`:␟0459da369b661293df2216dab6d5504bc0ae736d␟4770948314010072135:Clicking this button will reset the camera viewing the 3D model`,F=$localize`:␟240d93ec4b5179c4fd189688280eaa63b0d6d783␟6492222661583280:Pan mode active, change to rotate mode`,ne=$localize`:␟e583fc810e521ceb2967fc19734fed46a2540c94␟4140573029148607220:Rotate mode active, change to pan mode`,Y=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,le=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,be=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,fe=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,[v,B,F,ne,["direction","vertical","data-test","cameraBar","direction","vertical","appPreventFadeout",""],["role","group","aria-label",T],["app-view-button","","buttonSize","small","data-test","cameraToggleBar","matTooltipPosition","left",3,"click","short","matTooltip"],["size","sm",3,"icon"],[1,"sr-only"],["app-view-button","","buttonSize","small","matTooltip",y,"matTooltipPosition","left","data-test","cameraReset",3,"click"],["size","lg","icon","location-crosshairs"],[4,"ngIf"],["app-view-button","","buttonSize","small","matTooltipPosition","left","data-test","cameraPan",3,"click","matTooltip"],["size","lg","icon","arrows-up-down-left-right",4,"ngIf"],["size","lg","icon","rotate",3,"custom",4,"ngIf"],["class","sr-only",4,"ngIf"],["size","lg","icon","arrows-up-down-left-right"],["size","lg","icon","rotate",3,"custom"],["app-view-button","","buttonSize","small","data-test","cameraZoomIn","aria-label",Y,"matTooltip",le,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","plus"],["app-view-button","","buttonSize","small","data-test","cameraZoomOut","aria-label",be,"matTooltip",fe,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","minus"]]},template:function(y,v){1&y&&(d.j41(0,"app-pillbox",4)(1,"ul",5)(2,"li")(3,"button",6),d.bIt("click",function(){return v.toggleCameraBar()}),d.nrm(4,"app-icon",7),d.j41(5,"span",8),d.pXf(6,0),d.k0s()()(),d.j41(7,"li")(8,"button",9),d.bIt("click",function(){return v.returnToChapterCamera()}),d.nrm(9,"app-icon",10),d.j41(10,"span",8),d.pXf(11,1),d.k0s()()(),d.DNE(12,ae,16,22,"ng-container",11),d.k0s()()),2&y&&(d.R7$(3),d.Y8G("short",!0)("matTooltip",v.cameraToggleTooltip),d.R7$(),d.Y8G("icon",v.collapsed?"angle-up":"angle-down"),d.R7$(8),d.Y8G("ngIf",!v.collapsed))},dependencies:[W.bT,N.s,z.oV,m.ri,P.R,U.O,W.Jj],encapsulation:2,data:{animation:[(0,c.hZ)("expand",[(0,c.kY)(":enter",[(0,c.K2)([(0,c.iF)({height:0}),(0,c.i0)("150ms ease-in-out",(0,c.iF)({height:"*"}))])]),(0,c.kY)(":leave",[(0,c.K2)([(0,c.i0)("150ms ease-in-out",(0,c.iF)({height:"0"}))])])]),(0,c.hZ)("show",[(0,c.kY)(":enter",[(0,c.K2)([(0,c.iF)({height:"0"}),(0,c.i0)("125ms ease-in-out",(0,c.iF)({height:"*"}))])]),(0,c.kY)(":leave",[(0,c.K2)([(0,c.i0)("125ms 125ms ease-in-out",(0,c.iF)({height:"0"}))])])])]},changeDetection:0}),H([(0,p.l6)(b.x.getPanMode),q("design:type",V.c)],ge.prototype,"panMode$",void 0),H([(0,p.l6)(R.S.getCanvasHeightBreakpoint),q("design:type",V.c)],ge.prototype,"canvasHeightBreakpoint$",void 0)},41537:(re,Z,s)=>{"use strict";s.d(Z,{_:()=>pe});var e=s(54438),p=s(65763),b=s(47610),o=s(55494),C=s(85052),V=s(29160),G=s(76718),x=s(82656),A=s(35426),g=s(2573),c=s(37925),E=s(14264),w=s(87996),h=s(36110),u=s(94909),D=s(81027),R=s(15210),$=s(66196),d=s(67584),k=s(8360),W=s(17106),N=s(82733),m=s(1670),P=s(21082),U=s(2094),j=s(79805),H=s(24418),q=s(3266),se=s(4664),O=s(47555),K=s(94495),J=s(60286),X=s(7431),de=s(57021),ae=s(3829),ge=s(62943),T=s(13409),y=s(515),v=s(65294),B=s(22679),F=s(30327),ne=s(20458),Y=s(13878),le=s(49188),be=s(27180),fe=s(61295),Te=s(63365),Q=s(49204),Pe=s(28931),We=s(12921);class dt{constructor(t,n){this.store=t,this.particleSystemsService=n,this.ngUnsubscribe=new C.B,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const t=this.store.select(We.B.getParticleSystems),n=this.store.select(We.B.getVisisbleParticleSystems);(0,x.z)([t,n]).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const a=this.store.selectSnapshot(K.N.getSelectedChapterId),r=this.store.selectSnapshot(We.B.getVisibleParticleSystemsForChapter(a));this.particleSystemsService.setEngineParticles(i,a,r)})}}var ce=s(38753),Qe=s(95419),ot=s(17215),pt=s(93815),st=s(46799),_t=s(76724),at=s(35650),Be=s(11724),M=s(12215),S=s(66056),f=s(12347),L=s(41373),ee=s(41623),ie=s(38472),xe=s(77994),De=s(32724),Re=s(46842),Vt=s(26463),ht=s(38645),gt=s(83621),zt=s(18617),_e=s(60177),Yt=s(81391),Me=s(93915),ut=s(8358),mt=s(76872),Xe=s(38157),Ot=s(49746),xt=s(1300),Ae=s(87710),Kt=s(43753),bt=s(24151),Wt=s(51640),Rt=s(28203),He=s(28407),At=(s(69568),s(38104)),ft=s(15623),vt=s(34006),Dt=s(21007),Ct=s(49989),Et=s(26779),lt=s(35286);function Qt(l,t){if(1&l){const n=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.playAudio())}),e.nrm(1,"app-icon",10),e.k0s()}}function Ht(l,t){if(1&l&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&l){const n=e.XpG();e.R7$(),e.JRh(n.latinLabel)}}function Zt(l,t){if(1&l&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&l){const n=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,n.description)),e.npT)}}let Jt=(()=>{var l;class t{constructor(i,a,r){this.dialogRef=i,this.mediaService=a,this.data=r,this.title=r.title,this.audioPlayer=r.audioPlayer,this.latinLabel=r.latinLabel,this.description=r.description}ngOnDestroy(){this.audioPlayer&&(this.audioPlayer=null)}handleCloseClick(){this.dialogRef.close()}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(vt.CP),e.rXU(Qe.u),e.rXU(vt.Vh))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-context-label-dialog"]],decls:11,vars:9,consts:[[1,"context-label-dialog","flex","flex-col"],[1,"flex","flex-row","justify-between","items-start"],[1,"flex","flex-row","items-start"],[1,"context-label-dialog__title","mt-2","mr-2",3,"innerHTML"],["class","context-label-dialog__audio","type","button","app-button","","buttonTheme","light","buttonSize","md",3,"click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"context-label-dialog__close",3,"click"],["icon","times","size","lg"],["class","context-label-dialog__latin-label mt-1",4,"ngIf"],["class","context-label-dialog__description mt-6",3,"innerHTML",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","md",1,"context-label-dialog__audio",3,"click"],["icon","volume-up","appLogicalDir",""],[1,"context-label-dialog__latin-label","mt-1"],[1,"context-label-dialog__description","mt-6",3,"innerHTML"]],template:function(i,a){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"div",3),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,Qt,2,0,"button",4),e.k0s(),e.j41(7,"button",5),e.bIt("click",function(){return a.handleCloseClick()}),e.nrm(8,"app-icon",6),e.k0s()(),e.DNE(9,Ht,2,1,"div",7)(10,Zt,3,5,"div",8),e.k0s()),2&i&&(e.R7$(3),e.Y8G("innerHTML",e.bMT(5,7,e.bMT(4,5,a.title)),e.npT),e.R7$(3),e.Y8G("ngIf",a.audioPlayer),e.R7$(),e.BMQ("aria-label","Close"),e.R7$(2),e.Y8G("ngIf",a.latinLabel),e.R7$(),e.Y8G("ngIf",a.description))},dependencies:[_e.bT,Dt.Q,Ct.e,Et.R,_e.Jj,lt.i0],styles:[".context-label-dialog{height:100%;padding:24px}.context-label-dialog__title{font-weight:700;font-size:20px;word-break:break-word}.context-label-dialog__latin-label{font-style:italic;font-weight:400;font-size:14px;letter-spacing:.02em}.context-label-dialog__description{font-size:14px;line-height:20px;overflow:auto;margin-right:-24px;padding-right:24px}.context-label-dialog__description p{padding-bottom:12px}\n"],encapsulation:2}),t})();var Ze,qt=s(94604),en=s(59429),tn=s(68947),yt=s(11040),nn=s(22397),on=s(17766),sn=s(5393),St=s(59115),an=s(79817),ln=s(11789),rn=s(48030),Lt=s(82323),cn=s(3367),It=s(25780),dn=s(26513),Ut=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},kt=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};const pn=["labelContainerEl"],_n=["labelEl"],hn=["wire"],gn=["tag"],un=["pin"],mn=["title"],bn=[[["","label-header",""]],[["","label-actions",""]],[["","label-more",""]],[["","label-body",""]]],vn=(l,t,n,i,a,r,_,I,te)=>({"label--selected":l,"label--glow":t,"label--annotation":n,"label--invert":i,"label--studio":a,"label--context":r,"label--screenshot-mode":_,"label--auto-fit":I,"label--opaque":te}),Cn=l=>({"label__wire--collapse":l}),En=(l,t,n,i)=>({"label__tag--collapse":l,"label__tag--collapsible":t,"label__tag--floating":n,"label__tag--draggable":i}),yn=l=>({"label__body--collapse":l});function Sn(l,t){1&l&&(e.j41(0,"div",18),e.nrm(1,"img",19),e.k0s())}function Pn(l,t){if(1&l&&(e.j41(0,"div",20),e.SdG(1,3),e.k0s()),2&l){const n=e.XpG();e.Y8G("ngClass",e.eq3(1,yn,n.isCollapsed||n.descriptionCollapsed))}}class Ve{get label(){return this._label}set label(t){const n=(0,Q.isEmpty)(t),i=(0,Q.isEmpty)(this.label);n&&!i?(this._label=null,this.destroyLabel()):n||(this._label={...t},this.initLabel(this.label))}set selected(t){this._selected=t}get selected(){return this._selected}constructor(t,n,i,a,r,_,I,te,oe,he){this.renderer=t,this.labelsService=n,this.engineService=i,this.cameraService=a,this.engineRendererService=r,this.store=_,this.actions=I,this.changeDetection=te,this.markerService=oe,this.localeId=he,this.labelPinType=bt.O,this.labelSequentialType=an.C,this.labelUpdated=new e.bkB,this.offsetUpdated=new e.bkB,this.pinClicked=new e.bkB,this.tagClicked=new e.bkB,this.displayUpdated=new e.bkB,this.positionUpdated=new e.bkB,this.hoverStart=new e.bkB,this.hoverEnd=new e.bkB,this.labelOffsetUpdated=new e.bkB,this.fit="fixed",this.opaque=!1,this.fixedScale=0,this.isCollapsed=!1,this.tagCollapsed=!1,this.theme="classic",this.pinDraggable=!0,this.tagDraggable=!0,this._selected=!1,this.enginePosition=null,this.isBackgroundDark=!1,this.pinDragging=!1,this.screenshotMode=!1,this.hammerManagers=[],this.displayUpdated$=new C.B,this.positionUpdated$=new C.B,this.ngUnsubscribe=new C.B,this.dir=(0,yt.NS)(this.localeId).direction}ngOnInit(){this.initListeners()}ngAfterViewInit(){this.bindTagEvents(),this.bindPinEvents(),this.bindHoverEvents()}ngOnDestroy(){this.destroyLabel(),this.emitDisplayUpdated({id:this.label.id,inView:!1,shown:!1,objectShown:this.objectShown}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}destroyLabel(){this.hammerManagers.forEach(t=>t.destroy()),this.hammerManagers=[],this.deleteMarker(this.marker)}initListeners(){this.enginePosition$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.enginePosition=t}),this.engineService.getEvent(y.X.Tick).pipe((0,E.p)(()=>!(0,Q.isNil)(this.label)&&!(0,Q.isNil)(this.enginePosition)),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setCanvasPos()}),this.displayUpdated$.pipe((0,P.F)((t,n)=>(0,Q.isEqual)(t,n)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.displayUpdated.next(t)}),this.positionUpdated$.pipe((0,P.F)((t,n)=>(0,Q.isEqual)(t,n)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.positionUpdated.next(t)}),this.background$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.colors.slice(0,3),i=t.colors.slice(4,7);this.isBackgroundDark=!ln.T.isLight(n,i),this.changeDetection.markForCheck()}),this.actions.pipe((0,p.xi)(Lt.V9),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!0,this.changeDetection.detectChanges()}),this.actions.pipe((0,p.rM)(Lt.WX),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!1,this.changeDetection.markForCheck()})}bindTagEvents(){const t=new Pe.Manager(this.tagRef.nativeElement,{domEvents:!0});t.add(new Pe.Pan({direction:Pe.DIRECTION_ALL,threshold:3})),t.add(new Pe.Tap({event:"tap"})),t.on("pan",n=>{if(!this.tagDraggable)return;n.srcEvent.stopPropagation(),this.cachedTagOffset||(this.cachedTagOffset=this.label.offset);const i=[this.cachedTagOffset[0]+n.deltaX,this.cachedTagOffset[1]+n.deltaY];this.label.offset=i,n.isFinal&&(this.cachedTagOffset=null,this.offsetUpdated.next({labelId:this.label.id,offset:i}))}),t.on("tap",n=>{n.srcEvent.preventDefault(),n.srcEvent.stopPropagation(),this.tagClicked.next(n)}),this.hammerManagers.push(t)}bindPinEvents(){const t=new Pe.Manager(this.pinRef.nativeElement);t.add(new Pe.Pan({direction:Pe.DIRECTION_ALL,threshold:4})),t.add(new Pe.Tap({event:"tap"})),t.on("pan",n=>{if(!this.pinDraggable)return;n.srcEvent.stopPropagation(),this.pinDragging=!0;let{layerX:i,layerY:a}=n.changedPointers[0];if(i-=16,a-=16,this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${i}px, ${a}px)`),n.isFinal){this.pinDragging=!1;const r={...this.label},_=this.engineRendererService.pick(i,a),I="string"==typeof _.objectId;I&&(r.dir=this.cameraService.getDirection(_),r.objectId=_.objectId,r.barycentric=[_.barycentric[0],_.barycentric[1],_.barycentric[2]],r.pos=[_.worldPos[0],_.worldPos[1],_.worldPos[2]],r.primitiveIndex=_.triIndex),this.labelUpdated.next({label:r,shouldPreserve:I})}}),t.on("tap",n=>{n.srcEvent.preventDefault(),n.srcEvent.stopImmediatePropagation(),this.pinClicked.next(n)}),this.hammerManagers.push(t)}bindHoverEvents(){const t=this.labelRef.nativeElement;this.renderer.listen(t,"mouseenter",()=>{this.hoverStart.next({labelId:this.label.id})}),this.renderer.listen(t,"mouseleave",()=>{this.hoverEnd.next({labelId:this.label.id})})}initLabel(t){this.initMarker(t),this.ensureObjectId(t),this.initObjectSubscription(t)}initMarker(t){this.marker&&this.deleteMarker(this.marker),this.marker=this.markerService.createMarker(t)}checkLabelDisplay(){return{id:this.label.id,shown:this.label.shown,inView:this.isOnCanvas(),objectShown:!0}}ensureObjectId(t){if(!t.objectId&&this.marker){const[n,i]=this.marker.canvasPosition,a=this.engineRendererService.pick(n,i);a.objectId&&(t.objectId=a.objectId,t.states.forEach(r=>{r.errands.forEach(_=>{_.type===Xe.X.flyToObject&&(_.value=a.objectId)})}),this.labelUpdated.next({label:t,shouldPreserve:void 0}))}}initObjectSubscription(t){this.object$&&this.object$.unsubscribe(),t.objectId&&(this.object$=this.store.select(o.S.getViewGraphNode).pipe((0,h.T)(n=>n(t.objectId)),(0,E.p)(n=>!!n),(0,c.Q)(this.ngUnsubscribe)).subscribe(n=>{this.objectShown=n.boolState.shown}))}deleteMarker(t){this.markerService.deleteMarker(t?.id),this.marker=null}setCanvasPos(){if(this.pinDragging||!this.marker)return void((0,Q.isNil)(this.marker)&&this.setDisplay(!1));const t=this.isOccluded(),n=this.isOcclusionIgnored(),i=this.isOnCanvas(),a=t&&!n,r=void 0===this.objectShown?i&&!a:i&&this.objectShown&&!a;r!==this.shown&&(this.shown=r,this.setDisplay(r)),this.setElementPosition(),this.setElementScale(),this.setTagPosition(),this.setWirePosition();const[I,te]=this.marker.canvasPosition;this.positionUpdated$.next({positionUpdate:{id:this.label.id,canvasPos:{x:I,y:te},occluded:a},onCanvas:i})}isOcclusionIgnored(){return this.selected||!this.label.occludable}isOccluded(){return this.marker?.occluded}isOnCanvas(){if(!this.marker)return!1;const{offsetWidth:t,offsetHeight:n}=this.labelsService.getLabelContainer().nativeElement,[i,a]=this.marker.canvasPosition;return i>0&&a>0&&i<t&&a<n}setDisplay(t){this.renderer.setStyle(this.labelRef.nativeElement,"visibility",t?"visible":"hidden"),this.emitDisplayUpdated({id:this.label.id,inView:this.isOnCanvas(),shown:t,objectShown:this.objectShown})}setElementPosition(){const[t,n]=this.marker?.canvasPosition??[0,0];this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${t}px, ${n}px)`)}setElementScale(){let t;if(this.fixedScale)t=this.fixedScale;else{const i=this.store.selectSnapshot(o.S.getEnginePosition).width;t=i>1440?i/1440:1}const n=32*t-32;this.renderer.setStyle(this.labelRef.nativeElement,"transform-origin","top left"),this.renderer.setStyle(this.labelRef.nativeElement,"transform",`translate(-${n/2}px, -${n/2}px) scale(${t}, ${t})`)}setTagPosition(){const[t,n]=this.label.offset,i=this.tagRef.nativeElement.offsetWidth;let a;switch(a=this.label.pinType===bt.O.None&&this.label.hideWire||t>0?"left":"right",a){case"left":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+t}px, ${n}px)`);break;case"right":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+t-i}px, ${n}px)`)}}setWirePosition(){let[t,n]=this.label.offset;switch(this.label.theme){case mt.D.Annotation:case mt.D.Classic:n+=this.titleRef.nativeElement.offsetHeight-16-2}const i=Math.sqrt(t*t+n*n);this.renderer.setStyle(this.wireRef.nativeElement,"width",`${i}px`),this.renderer.setStyle(this.wireRef.nativeElement,"transform",`rotate(${Math.atan2(n,t)}rad)`)}emitDisplayUpdated(t){this.label.id!==rn.j&&(null==t.inView||null==t.shown||this.displayUpdated$.next(t))}}(Ze=Ve).\u0275fac=function(t){return new(t||Ze)(e.rXU(e.sFG),e.rXU(ut.x),e.rXU(j.y),e.rXU(q.j),e.rXU(st.z),e.rXU(p.il),e.rXU(p.En),e.rXU(e.gRc),e.rXU(cn.m),e.rXU(e.xe9))},Ze.\u0275cmp=e.VBU({type:Ze,selectors:[["app-generic-label"]],viewQuery:function(t,n){if(1&t&&(e.GBs(pn,7),e.GBs(_n,7),e.GBs(hn,7),e.GBs(gn,7),e.GBs(un,7),e.GBs(mn,7)),2&t){let i;e.mGM(i=e.lsd())&&(n.labelContainerRef=i.first),e.mGM(i=e.lsd())&&(n.labelRef=i.first),e.mGM(i=e.lsd())&&(n.wireRef=i.first),e.mGM(i=e.lsd())&&(n.tagRef=i.first),e.mGM(i=e.lsd())&&(n.pinRef=i.first),e.mGM(i=e.lsd())&&(n.titleRef=i.first)}},hostVars:2,hostBindings:function(t,n){2&t&&e.AVh("selected",n.selected)},inputs:{fit:"fit",opaque:"opaque",fixedScale:"fixedScale",sequence:"sequence",hasContent:"hasContent",label:"label",isCollapsed:"isCollapsed",descriptionCollapsed:"descriptionCollapsed",tagCollapsed:"tagCollapsed",selected:"selected",theme:"theme",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},outputs:{labelUpdated:"labelUpdated",offsetUpdated:"offsetUpdated",pinClicked:"pinClicked",tagClicked:"tagClicked",displayUpdated:"displayUpdated",positionUpdated:"positionUpdated",hoverStart:"hoverStart",hoverEnd:"hoverEnd",labelOffsetUpdated:"labelOffsetUpdated"},ngContentSelectors:["[label-header]","[label-actions]","[label-more]","[label-body]"],decls:21,vars:27,consts:[["labelContainerEl",""],["labelEl",""],["pin",""],["wire",""],["tag",""],["title",""],["data-test","labelContainer",1,"label-container"],["data-test","labelElement",1,"label",3,"ngClass"],[1,"label__pin"],[3,"label","labelTheme","selected","sequence"],[1,"label__glow"],[1,"label__wire",3,"ngClass"],["aria-hidden","true",1,"label__tag",3,"dir","ngClass"],[1,"label__header"],["data-test","labelTitle",1,"label__title"],["class","label__more","appLogicalDir","",4,"ngIf"],["appEventFence","",1,"label__actions"],["class","label__body",3,"ngClass",4,"ngIf"],["appLogicalDir","",1,"label__more"],["src","./assets/images/labels/caret-right.svg"],[1,"label__body",3,"ngClass"]],template:function(t,n){1&t&&(e.NAR(bn),e.j41(0,"div",6,0)(2,"div",7,1)(4,"div",8,2),e.nrm(6,"app-label-pin",9)(7,"div",10),e.k0s(),e.nrm(8,"div",11,3),e.j41(10,"div",12,4)(12,"div",13)(13,"div",14,5),e.SdG(15),e.k0s(),e.DNE(16,Sn,2,0,"div",15),e.j41(17,"div",16),e.SdG(18,1),e.k0s()(),e.DNE(19,Pn,2,3,"div",17),e.SdG(20,2),e.k0s()()()),2&t&&(e.R7$(2),e.Y8G("ngClass",e.zJS(10,vn,[n.selected,n.label.pinGlow,"annotation"===n.label.theme||"classic"===n.label.theme,n.isBackgroundDark,"studioNext"===n.label.theme,"context"===n.label.theme,n.screenshotMode,"auto"===n.fit,n.opaque])),e.R7$(4),e.Y8G("label",n.label)("labelTheme",n.label.theme)("selected",n.selected)("sequence",n.sequence),e.R7$(2),e.Y8G("ngClass",e.eq3(20,Cn,n.isCollapsed||n.tagCollapsed||n.label.hideWire)),e.R7$(2),e.Y8G("dir",n.dir)("ngClass",e.ziG(22,En,n.isCollapsed||n.tagCollapsed,n.label.collapseDescription,n.label.hideWire,n.tagDraggable)),e.R7$(6),e.Y8G("ngIf",n.hasContent&&n.label.collapseDescription),e.R7$(3),e.Y8G("ngIf",n.hasContent))},dependencies:[_e.YU,_e.bT,It.L,Ct.e,Rt.ig,dn.b],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{opacity:1;display:block}}@keyframes _ngcontent-%COMP%_fadeOut{0%{display:block;opacity:1}99%{opacity:0}to{opacity:0;display:none}}@keyframes _ngcontent-%COMP%_glow{0%{box-shadow:0 0 #ffffff80}50%{box-shadow:0 0 8px 2px #ffffff80}to{box-shadow:0 0 #ffffff80}}@keyframes _ngcontent-%COMP%_classic-glow{0%{transform:scale(.5)}10%{transform:scale(.5)}50%{transform:scale(1)}90%{transform:scale(.5)}to{transform:scale(.5)}}[_nghost-%COMP%], .label-container[_ngcontent-%COMP%]{display:block;position:absolute;z-index:10;width:200px;pointer-events:all;pointer-events:none}[_nghost-%COMP%]:hover, .label-container[_ngcontent-%COMP%]:hover{z-index:12}.selected[_nghost-%COMP%]{z-index:11}.label-container[_ngcontent-%COMP%]{left:-16px;top:-16px}.label[_ngcontent-%COMP%]{display:block;overflow:visible;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;height:32px}.label--screenshot-mode[_ngcontent-%COMP%]{text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:before, .label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:after{box-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{box-shadow:none!important;text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:none!important}.label--auto-fit[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:max-content;padding:0!important}.label--auto-fit[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding:0!important}.label__glow[_ngcontent-%COMP%]{display:none;position:absolute;width:32px;height:32px;border-radius:50%;z-index:0;top:0;left:0}.label--selected[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{transform:rotate(45deg)}.label__more[_ngcontent-%COMP%]{color:#374a68;display:none;flex:0 0 16px;height:16px;align-items:center;justify-content:center;transition:transform .15s ease-in-out}.label__pin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;position:absolute;pointer-events:all;transition:background-color .12s;z-index:10}.label__pin[_ngcontent-%COMP%]:hover{cursor:pointer}.label__pin--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__pin--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__wire[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;height:0;transform-origin:0 100%;pointer-events:none;z-index:1}.label__wire--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]{display:inline-block;left:16px;top:0;z-index:10;max-width:160px;pointer-events:all}.label__tag[_ngcontent-%COMP%]:hover{cursor:pointer}.label__tag--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__tag--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__tag--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important;border-radius:4px}.label__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;line-height:140%;align-self:center}.label__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;padding-top:12px}.label__body--collapse[_ngcontent-%COMP%]{display:none}.label__icon[_ngcontent-%COMP%]{margin:0 -4px 0 4px}.label__actions[_ngcontent-%COMP%]{padding-left:4px}.label--studio.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--studio.label--opaque[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#ffffffd9!important}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#2d72dc}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600}.label--studio.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid rgba(16,24,35,.8);box-shadow:0 0 0 1px #f9fafd40}.label--studio.label[_ngcontent-%COMP%]   .label__wire--collapse[_ngcontent-%COMP%]{display:none}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background:#ffffff8c;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:4px 8px;border-radius:4px;max-width:200px}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc}.label--studio.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#101823;flex:1 1 auto}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#374a68;padding-top:4px}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.label--studio.label[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex}.label--annotation.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff40;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite;top:-1px;left:-1px}.label--annotation.label--none[_ngcontent-%COMP%]{display:none}.label--annotation.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:10px;color:#eee}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--floating[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:none}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:focus{outline-offset:4px}.label--annotation.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;min-height:18px;width:100%;padding-bottom:4px;margin-bottom:-2px;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding-top:4px;color:#333}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#eee}.label--context.label[_ngcontent-%COMP%]{pointer-events:none}.label--context.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--context.label[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%], .label--context.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{display:none}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;background:#ffffffb3;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:0;border-radius:4px;width:-moz-fit-content;width:fit-content;min-width:200px;max-width:none;min-height:75px;opacity:1;transition:width .25s,opacity .1s}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc;cursor:grab}.label--context.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{padding:4px 8px 0}.label--context.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;color:#101823}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid #eaeff5;color:#101823;overflow-x:hidden;padding-top:8px}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.context-label--large[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:300px}@media (min-width: 960px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:400px}}@media (max-width: 959px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{opacity:0}}"],changeDetection:0}),Ut([(0,p.l6)(o.S.getEnginePosition),kt("design:type",g.c)],Ve.prototype,"enginePosition$",void 0),Ut([(0,p.l6)(K.N.getSelectedChapterBackground),kt("design:type",g.c)],Ve.prototype,"background$",void 0);var Je,Pt=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Mt=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};const Mn=["labelDescription"];function Tn(l,t){if(1&l){const n=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.playAudio())}),e.nrm(1,"app-icon",21),e.k0s()}if(2&l){const n=e.XpG(2);e.Y8G("disabled",n.audioPlayerLoading)}}function On(l,t){if(1&l){const n=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.handleReadMoreClick())}),e.nrm(1,"app-icon",23),e.k0s()}if(2&l){const n=e.XpG(2);e.R7$(),e.AVh("context-label__info--expanded",n.expanded)}}function xn(l,t){if(1&l&&(e.j41(0,"div",17),e.DNE(1,Tn,2,1,"button",18)(2,On,2,2,"button",19),e.k0s()),2&l){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.enableAudio),e.R7$(),e.Y8G("ngIf",n.enableInfo&&(null==n.node||null==n.node.info?null:n.node.info.description))}}function Rn(l,t){if(1&l&&(e.j41(0,"i",24),e.EFF(1),e.k0s()),2&l){const n=e.XpG();e.R7$(),e.SpI(" ",n.node.info.latinLabel," ")}}function An(l,t){if(1&l){const n=e.RV6();e.j41(0,"div",25,2),e.nI1(2,"markdown"),e.nI1(3,"async"),e.bIt("pointerdown",function(a){e.eBV(n);const r=e.XpG();return e.Njj(r.handleDescriptionPointerDown(a))})("wheel",function(a){e.eBV(n);const r=e.XpG();return e.Njj(r.stopPropagation(a))}),e.k0s()}if(2&l){const n=e.XpG();e.AVh("context-label__description--expanded",n.expanded),e.Y8G("innerHTML",e.bMT(3,5,e.bMT(2,3,n.node.info.description)),e.npT)}}function Dn(l,t){if(1&l){const n=e.RV6();e.j41(0,"div",26)(1,"button",27),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.hideNode())}),e.pXf(2,5),e.k0s(),e.j41(3,"button",28),e.qex(4),e.pXf(5,6),e.bVm(),e.nrm(6,"app-icon",29),e.k0s(),e.j41(7,"button",27),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.hideInverseNodes())}),e.pXf(8,7),e.k0s()()}if(2&l){e.XpG();const n=e.sdS(12);e.R7$(3),e.Y8G("matMenuTriggerFor",n)}}const Ln=["es-ES","en-US"];class qe{set label(t){this._label=t,this.largeTitle=this._label.title.length>60,this.removeAudioPlayer(),this.setLabelNode(),this.changeDetectorRef.markForCheck()}get label(){return this._label}get enableAudio(){return Ln.includes(this.localeCode)&&this._enableAudio}set enableAudio(t){this._enableAudio=t,this.removeAudioPlayer(),this.changeDetectorRef.markForCheck()}constructor(t,n,i,a,r,_,I,te,oe){this.store=t,this.actions=n,this.sceneService=i,this.dialog=a,this.nodeService=r,this.mediaService=_,this.renderer2=I,this.markdownService=te,this.changeDetectorRef=oe,this.largeTitle=!1,this.expanded=!1,this.ngUnsubscribe=new C.B,this.id=en.u.getUuid()}ngOnInit(){this.initInfoListeners(),this.initBreakpointListeners(),this.initLocale()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.removeAudioPlayer()}setLabelNode(){const t=(0,Q.get)(this.label,"objectId");if(t){const n=this.store.selectSnapshot(o.S.getViewGraph);this.node=this.sceneService.getViewNode(n,t)}else this.node=null;this.expanded=!1,this.changeDetectorRef.markForCheck()}initInfoListeners(){this.actions.pipe((0,p.rM)(b.RV),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setLabelNode()})}initBreakpointListeners(){this.horizontalBreakpoint$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.expanded&&(t<ft.m.Large&&!this.curDialog?this.openContextLabelDialog():t>=ft.m.Large&&this.curDialog&&this.curDialog?.close(!0))})}initLocale(){var t=this;return(0,He.A)(function*(){t.localeCode=yield t.getLocaleCode(),t.changeDetectorRef.markForCheck()})()}handleReadMoreClick(){this.node&&(this.expanded=!this.expanded,this.expanded&&this.store.selectSnapshot(At.V.getHorizontalBreakpoint)<ft.m.Large&&this.openContextLabelDialog())}stopPropagation(t){t.stopPropagation()}handleDescriptionPointerDown(t){const n=this.labelDescription.nativeElement,i=n.offsetWidth-n.clientWidth;if(i>0){const r=n.getBoundingClientRect().right-i;t.clientX>r&&this.stopPropagation(t)}}playAudio(){var t=this;return(0,He.A)(function*(){(0,Q.isNil)(t.audioPlayer)&&(yield t.setAudioPlayer(t.localeCode)),t.audioPlayer.stop(),t.audioPlayer.play()})()}setAudioPlayer(t){var n=this;return(0,He.A)(function*(){n.removeAudioPlayer(),n.audioPlayerLoading=!0,n.changeDetectorRef.markForCheck(),n.audioPlayer=yield n.mediaService.addAudioPlayer(n.id,n.getAudioSource(t),!1),n.audioPlayerLoading=!1,n.changeDetectorRef.markForCheck()})()}getAudioSource(t){var n=this;return(0,He.A)(function*(){const i=yield tn.l.getPlainTextFromMarkdown(n.renderer2,n.markdownService,n._label.title,!0);return(0,nn.R)(i,t)})()}getLocaleCode(){var t=this;return(0,He.A)(function*(){const n=t.store.selectSnapshot(B.t.getStoryInfo);let i=yt.q.id;if(n.type===on.c.Bookmark){let r=t.store.selectSnapshot(B.t.getStory).chapters.map(_=>_.description||"").join(" ").trim();if(!r){const _=t.store.selectSnapshot(o.S.getViewGraph);r=Object.values(_.nodes).map(te=>te.label).join(", ").trim()}return(0,sn.E)(r)}{const a=t.store.selectSnapshot(B.t.getStoryLanguage);i=(0,yt.U1)(a).id}return i})()}removeAudioPlayer(){this.mediaService.removeAudioPlayer(this.id),this.audioPlayer=null}hideNode(){this.store.dispatch(new fe.yr(!1,[this.node.id]))}fadeInverseNodes(){this.nodeService.fadeInverse([this.node.id])}fadeNode(){this.nodeService.fade([this.node.id])}hideInverseNodes(){this.nodeService.hideInverse([this.node.id])}openContextLabelDialog(){this.curDialog=this.dialog.open(Jt,{width:"calc(100% - 80px)",maxWidth:"100%",height:"calc(100% - 80px)",maxHeight:"100%",data:{title:this.label.title,audioPlayer:this.audioPlayer,latinLabel:this.node.info.latinLabel,description:this.node.info.description}}),this.curDialog.afterClosed().subscribe(t=>{this.curDialog=void 0,t||(this.expanded=!1,this.changeDetectorRef.markForCheck())})}}(Je=qe).\u0275fac=function(t){return new(t||Je)(e.rXU(p.il),e.rXU(p.En),e.rXU(at.w),e.rXU(vt.bZ),e.rXU(qt.w),e.rXU(Qe.u),e.rXU(e.sFG),e.rXU(lt.Rl),e.rXU(e.gRc))},Je.\u0275cmp=e.VBU({type:Je,selectors:[["app-context-label"]],viewQuery:function(t,n){if(1&t&&e.GBs(Mn,5),2&t){let i;e.mGM(i=e.lsd())&&(n.labelDescription=i.first)}},inputs:{label:"label",enableInfo:"enableInfo",enableActions:"enableActions",enableAudio:"enableAudio"},decls:17,vars:17,consts:()=>{let l,t,n,i,a;return l=$localize`:␟b759baf42e7a90ef5e8c645babba3f7737e6a526␟5489525302847889282: Fade This `,t=$localize`:␟1eeab5878ca4b21288c9610b9837d0cf81cc64a0␟6683889227007993247: Fade Everything Else `,n=$localize`:␟ccf7390cbf933d13bbd3558c3f16040691f3f5c3␟7951634674386802910: Hide `,i=$localize`:␟81d6fa1833302eff81aca2a44b472dbd23898f44␟7797708308805705984:Fade`,a=$localize`:␟bfe7e779289d630d424893f857357ae741f6acfd␟8086714388799643845: Isolate `,[["title",""],["fadeActions","matMenu"],["labelDescription",""],l,t,n,i,a,[1,"context-label",3,"fixedScale","label"],["label-header","",1,"context-label__header","html",3,"innerHTML"],["class","context-label__actions","label-actions","",4,"ngIf"],["label-more",""],["class","context-label__latin",4,"ngIf"],["class","context-label__description",3,"context-label__description--expanded","innerHTML","pointerdown","wheel",4,"ngIf"],["class","context-label__node-actions",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["label-actions","",1,"context-label__actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"disabled","click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click","disabled"],["icon","volume-up","appLogicalDir",""],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click"],["icon","info-circle",1,"context-label__info"],[1,"context-label__latin"],[1,"context-label__description",3,"pointerdown","wheel","innerHTML"],[1,"context-label__node-actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"click"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"]]},template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-generic-label",8),e.nI1(1,"async"),e.nrm(2,"div",9,0),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,xn,3,2,"div",10),e.qex(7,11),e.DNE(8,Rn,2,1,"i",12)(9,An,4,7,"div",13)(10,Dn,9,1,"div",14),e.j41(11,"mat-menu",null,1)(13,"button",15),e.bIt("click",function(){return e.eBV(i),e.Njj(n.fadeNode())}),e.pXf(14,3),e.k0s(),e.j41(15,"button",16),e.bIt("click",function(){return e.eBV(i),e.Njj(n.fadeInverseNodes())}),e.pXf(16,4),e.k0s()(),e.bVm(),e.k0s()}2&t&&(e.AVh("context-label--expanded",n.expanded)("context-label--large",n.largeTitle),e.Y8G("fixedScale",e.bMT(1,11,n.labelScale$))("label",n.label),e.R7$(2),e.Y8G("innerHTML",e.bMT(5,15,e.bMT(4,13,n.label.title)),e.npT),e.R7$(4),e.Y8G("ngIf",n.node),e.R7$(2),e.Y8G("ngIf",n.node&&(null==n.node.info?null:n.node.info.latinLabel)),e.R7$(),e.Y8G("ngIf",n.enableInfo&&(null==n.node||null==n.node.info?null:n.node.info.description)),e.R7$(),e.Y8G("ngIf",n.node))},dependencies:[_e.bT,Dt.Q,Ct.e,Et.R,St.kk,St.fb,St.Cp,Ve,_e.Jj,lt.i0],styles:[".context-label[_ngcontent-%COMP%]{z-index:12}.context-label__header[_ngcontent-%COMP%]{word-break:break-word}.context-label__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;min-height:24px}.context-label__info--expanded[_ngcontent-%COMP%]{color:#2d72dc}.context-label__latin[_ngcontent-%COMP%]{display:block;padding:0 8px 4px;font-size:.625rem;line-height:.75rem;font-style:italic}.context-label__description[_ngcontent-%COMP%]{max-height:0;margin:0;overflow:auto;font-size:12px;line-height:18px;transition:max-height .25s,margin .25s}.context-label__node-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid rgba(16,24,35,.5);margin-top:4px;white-space:nowrap}.context-label__node-action[_ngcontent-%COMP%]{border-radius:0;border-inline-end:1px solid rgba(16,24,35,.5);flex:1}.context-label__node-action[_ngcontent-%COMP%]:last-child{border-inline-end:0}@media (min-width: 960px){.context-label__description--expanded[_ngcontent-%COMP%]{margin:8px;max-height:200px}}"],changeDetection:0}),Pt([(0,p.l6)(o.S.getQuerying),Mt("design:type",g.c)],qe.prototype,"querying$",void 0),Pt([(0,p.l6)(ce.y.getLabelScale),Mt("design:type",g.c)],qe.prototype,"labelScale$",void 0),Pt([(0,p.l6)(At.V.getHorizontalBreakpoint),Mt("design:type",g.c)],qe.prototype,"horizontalBreakpoint$",void 0);var et,Bt=s(15375),In=s(86234),wt=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},$t=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};const Un=["body"];function kn(l,t){if(1&l&&(e.nrm(0,"div",6),e.nI1(1,"markdown"),e.nI1(2,"async")),2&l){const n=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,n.label.description)),e.npT)}}function Nn(l,t){if(1&l&&(e.j41(0,"div",7),e.nrm(1,"app-content-blocks",8),e.k0s()),2&l){const n=e.XpG();e.R7$(),e.Y8G("contentBlocks",n.label.contentBlocks)("layout","compact")}}class rt{get isCollapsed(){if(this.collapsedMode===Bt.Q.Toggle){const t=this.store.selectSnapshot(ce.y.getSelectedLabelId)===this.label.id;return this.collapsed&&!t}return this.collapsed}get hasContent(){return this.labelsService.hasContent(this.label)}constructor(t,n,i,a){this.changeDetectorRef=t,this.labelsService=n,this.store=i,this.applicationEventService=a,this.emitEvents=!0,this.collapsedMode=Bt.Q.None,this.collapsed=!1,this.pinDraggable=!1,this.tagDraggable=!1,this.descriptionCollapsed=!1,this.tagCollapsed=!1,this.ngUnsubscribe=new C.B}ngOnInit(){this.selectedLabel$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(n=>this.handleLabelSelected(n)),this.store.select(ce.y.getChapterLabels).pipe((0,c.Q)(this.ngUnsubscribe),(0,w.B)(100)).subscribe(()=>{this.sequence=this.store.selectSnapshot(ce.y.getLabelSequence(this.label)),this.changeDetectorRef.markForCheck()}),this.descriptionCollapsed=this.label.collapseDescription,this.tagCollapsed=this.label.hideTag||!(this.label.title||this.hasContent)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleLabelUpdated(t){const{label:n,shouldPreserve:i}=t;this.store.dispatch(new Me.lb(n,i))}handleOffsetUpdated(t){const{labelId:n,offset:i}=t;this.store.dispatch(new Me.yi(n,i))}handlePinClicked(t){this.selectLabel()}handleTagClicked(t){this.selectLabel()}selectLabel(){const t=this.store.selectSnapshot(ce.y.getSelectedLabel);this.store.dispatch(new Me.TR(t&&t.id===this.label.id?null:this.label)),this.emitEvent(v.F.HotspotsPicked,{id:this.label.id}),this.emitEvent(v.F.LabelsPicked,{labelId:this.label.id})}emitEvent(t,n){this.emitEvents&&this.applicationEventService.fireEvent(t,n)}handleDisplayUpdated(t){this.setBodyOpacity(t.shown),this.emitEvent(v.F.HotspotsDisplayUpdated,t)}handlePositionUpdated(t){this.emitEvent(v.F.HotspotsPositionUpdated,t.positionUpdate),this.emitEvent(v.F.LabelsMoved,{labelId:t.positionUpdate.id,canvasPosition:[t.positionUpdate.canvasPos.x,t.positionUpdate.canvasPos.y],occluded:t.positionUpdate.occluded||!t.onCanvas})}handleHoverStart(t){this.emitEvent(v.F.HotspotsEntered,{id:t.labelId}),this.emitEvent(v.F.LabelsEntered,{labelId:t.labelId})}handleHoverEnd(t){this.emitEvent(v.F.HotspotsLeft,{id:t.labelId}),this.emitEvent(v.F.LabelsLeft,{labelId:t.labelId})}handleLabelSelected(t){const n=t&&t.id===this.label.id,i=(0,Q.get)(t,"states[1].errands"),a=this.store.selectSnapshot(ae.x.getLockCamera);n&&i&&!a&&i.forEach(_=>{switch(_.type){case Xe.X.flyToObject:this.store.dispatch(new b.W6(_.value));break;case Xe.X.flyToCamera:this.store.dispatch(new X.Ih(_.value))}this.store.dispatch(new X.Xz(!0))}),this.tagCollapsed=!this.label.title&&!this.hasContent||(this.label.expandTag&&this.label.hideTag?!n:this.label.hideTag),this.descriptionCollapsed=this.label.showDescription&&this.label.collapseDescription?!n:this.label.collapseDescription}handleBodyPointerDown(t){const n=this.body.nativeElement,i=n.offsetWidth-n.clientWidth;if(i>0){const r=n.getBoundingClientRect().right-i;t.clientX>r&&t.stopPropagation()}}handleBodyWheel(t){const n=this.body.nativeElement;n.scrollHeight>n.clientHeight&&t.stopPropagation()}setBodyOpacity(t){const n=this.body.nativeElement;t?n.style.removeProperty("opacity"):n.style.opacity="0"}}(et=rt).\u0275fac=function(t){return new(t||et)(e.rXU(e.gRc),e.rXU(ut.x),e.rXU(p.il),e.rXU(gt.S))},et.\u0275cmp=e.VBU({type:et,selectors:[["app-story-label"]],viewQuery:function(t,n){if(1&t&&e.GBs(Un,7),2&t){let i;e.mGM(i=e.lsd())&&(n.body=i.first)}},inputs:{label:"label",emitEvents:"emitEvents",collapsedMode:"collapsedMode",collapsed:"collapsed",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},decls:10,vars:20,consts:[["body",""],[1,"story-label",3,"labelUpdated","offsetUpdated","tagClicked","pinClicked","keydown.enter","displayUpdated","positionUpdated","hoverStart","hoverEnd","label","selected","fixedScale","sequence","isCollapsed","tagCollapsed","pinDraggable","tagDraggable","descriptionCollapsed","hasContent"],["label-header","",1,"html",3,"innerHTML"],["label-body","",1,"story-label__body","html",3,"pointerdown","wheel"],["data-test","labelDescription",3,"innerHTML",4,"ngIf"],["class","my-1","appEventFence","","style","cursor: auto",4,"ngIf"],["data-test","labelDescription",3,"innerHTML"],["appEventFence","",1,"my-1",2,"cursor","auto"],[3,"contentBlocks","layout"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-generic-label",1),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("labelUpdated",function(r){return e.eBV(i),e.Njj(n.handleLabelUpdated(r))})("offsetUpdated",function(r){return e.eBV(i),e.Njj(n.handleOffsetUpdated(r))})("tagClicked",function(r){return e.eBV(i),e.Njj(n.handleTagClicked(r))})("pinClicked",function(r){return e.eBV(i),e.Njj(n.handlePinClicked(r))})("keydown.enter",function(r){return e.eBV(i),e.Njj(n.handleTagClicked(r))})("displayUpdated",function(r){return e.eBV(i),e.Njj(n.handleDisplayUpdated(r))})("positionUpdated",function(r){return e.eBV(i),e.Njj(n.handlePositionUpdated(r))})("hoverStart",function(r){return e.eBV(i),e.Njj(n.handleHoverStart(r))})("hoverEnd",function(r){return e.eBV(i),e.Njj(n.handleHoverEnd(r))}),e.nrm(3,"div",2),e.nI1(4,"markdown"),e.nI1(5,"async"),e.j41(6,"div",3,0),e.bIt("pointerdown",function(r){return e.eBV(i),e.Njj(n.handleBodyPointerDown(r))})("wheel",function(r){return e.eBV(i),e.Njj(n.handleBodyWheel(r))}),e.DNE(8,kn,3,5,"div",4)(9,Nn,2,2,"div",5),e.k0s()()}if(2&t){let i;e.Y8G("label",n.label)("selected",(null==(i=e.bMT(1,12,n.selectedLabel$))?null:i.id)===n.label.id)("fixedScale",e.bMT(2,14,n.labelScale$))("sequence",n.sequence)("isCollapsed",n.isCollapsed)("tagCollapsed",n.tagCollapsed)("pinDraggable",n.pinDraggable)("descriptionCollapsed",n.descriptionCollapsed)("hasContent",n.hasContent),e.R7$(3),e.Y8G("innerHTML",e.bMT(5,18,e.bMT(4,16,n.label.title)),e.npT),e.R7$(5),e.Y8G("ngIf",n.label.description),e.R7$(),e.Y8G("ngIf",n.label.contentBlocks)}},dependencies:[_e.bT,It.L,In.l,Ve,_e.Jj,lt.i0],styles:[".story-label__body[_ngcontent-%COMP%]{max-height:120px;overflow-x:hidden;overflow-y:auto;margin-right:-8px;padding-right:8px}"],changeDetection:0}),wt([(0,p.l6)(ce.y.getLabelScale),$t("design:type",g.c)],rt.prototype,"labelScale$",void 0),wt([(0,p.l6)(ce.y.getSelectedLabel),$t("design:type",g.c)],rt.prototype,"selectedLabel$",void 0);var je,Gt=s(76016),Ue=s(89417),Bn=s(49206),wn=s(57743);function jn(l,t){1&l&&e.nrm(0,"app-icon",8)}function Fn(l,t){1&l&&e.nrm(0,"app-icon",9)}function Xn(l,t){if(1&l&&(e.j41(0,"div",10)(1,"em",11),e.EFF(2),e.k0s(),e.EFF(3,". "),e.k0s()),2&l){const n=e.XpG(2);e.R7$(2),e.JRh(n.option.label.title)}}function Vn(l,t){if(1&l&&(e.j41(0,"div",10)(1,"p",12),e.EFF(2," You selected "),e.j41(3,"em",11),e.EFF(4),e.k0s(),e.EFF(5,". "),e.k0s(),e.j41(6,"p"),e.EFF(7," This is the "),e.j41(8,"em",11),e.EFF(9),e.k0s(),e.EFF(10,". "),e.k0s()()),2&l){let n;const i=e.XpG(2);e.R7$(4),e.JRh(null==(n=i.getSelectedLabel(i.options,i.control.value))?null:n.title.trim()),e.R7$(5),e.JRh(i.option.label.title.trim())}}function zn(l,t){if(1&l&&(e.j41(0,"div",4),e.DNE(1,jn,1,0,"app-icon",5)(2,Fn,1,0,"app-icon",6)(3,Xn,4,1,"div",7)(4,Vn,11,2,"div",7),e.k0s()),2&l){const n=e.XpG();e.Y8G("ngSwitch",n.correct),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1)}}class Tt extends Bn.Z{constructor(){super(...arguments),this.sequence=0,this.labelUpdated=new e.bkB}ngOnInit(){}handleLabelUpdated(t){this.labelUpdated.next(t.label)}handleOffsetUpdated(t){this.labelUpdated.next({...this.option.label,offset:t.offset})}getSelectedLabel(t,n){const i=this.options.find(a=>a.value===n);return i?i.label:void 0}}(je=Tt).\u0275fac=(()=>{let l;return function(n){return(l||(l=e.xGo(je)))(n||je)}})(),je.\u0275cmp=e.VBU({type:je,selectors:[["app-quiz-label"]],inputs:{sequence:"sequence",collapsed:"collapsed",options:"options",option:"option",correct:"correct",mode:"mode"},outputs:{labelUpdated:"labelUpdated"},features:[e.Jv_([{provide:Ue.kq,useExisting:(0,e.Rfq)(()=>je),multi:!0}]),e.Vt3],decls:5,vars:17,consts:[[1,"label","theme-light",3,"labelUpdated","offsetUpdated","label","fit","opaque","fixedScale","pinDraggable","tagDraggable","isCollapsed","descriptionCollapsed","hasContent","sequence"],["label-body","",1,"label__body"],[3,"outline","hidden","options","formControl"],["class","label__summary flex items-start",3,"ngSwitch",4,"ngIf"],[1,"label__summary","flex","items-start",3,"ngSwitch"],["class","label__icon label__icon--correct","style","font-size: 16px","icon","check-circle",4,"ngSwitchCase"],["class","label__icon label__icon--incorrect","style","font-size: 16px","icon","times-circle",4,"ngSwitchCase"],["class","label__text pl-2",4,"ngSwitchCase"],["icon","check-circle",1,"label__icon","label__icon--correct",2,"font-size","16px"],["icon","times-circle",1,"label__icon","label__icon--incorrect",2,"font-size","16px"],[1,"label__text","pl-2"],[1,"font-semibold"],[1,"pb-2"]],template:function(t,n){1&t&&(e.j41(0,"app-generic-label",0),e.nI1(1,"async"),e.bIt("labelUpdated",function(a){return n.handleLabelUpdated(a)})("offsetUpdated",function(a){return n.handleOffsetUpdated(a)}),e.j41(2,"div",1),e.nrm(3,"app-quiz-label-anatomy-select",2),e.DNE(4,zn,5,5,"div",3),e.k0s()()),2&t&&(e.Y8G("label",n.option.label)("fit","summary"===n.mode?"fixed":"auto")("opaque",!0)("fixedScale",e.bMT(1,15,n.labelScale$))("pinDraggable","edit"===n.mode)("tagDraggable",!0)("isCollapsed",n.collapsed)("descriptionCollapsed",!1)("hasContent",!0)("sequence",n.sequence),e.R7$(3),e.Y8G("outline",!1)("hidden","summary"===n.mode)("options",n.options)("formControl",n.control),e.R7$(),e.Y8G("ngIf","summary"===n.mode))},dependencies:[_e.bT,_e.ux,_e.e1,Et.R,Ue.BC,Ue.l_,wn.w,Ve,_e.Jj],styles:[".label__body[_ngcontent-%COMP%]{color:#101823;min-width:142px;max-width:200px}.label__icon[_ngcontent-%COMP%]{position:relative;flex-basis:0 0 20px;justify-content:center}.label__icon--correct[_ngcontent-%COMP%]{color:#83e692}.label__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}.label__text[_ngcontent-%COMP%]{flex-wrap:wrap}"],changeDetection:0}),function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);a>3&&r&&Object.defineProperty(t,n,r)}([(0,p.l6)(ce.y.getLabelScale),function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,g.c)],Tt.prototype,"labelScale$",void 0);var tt,ze=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Ye=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};function Yn(l,t){if(1&l){const n=e.RV6();e.qex(0),e.j41(1,"app-quiz-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.bIt("labelUpdated",function(a){const r=e.eBV(n).index,_=e.XpG();return e.Njj(_.handleLabelUpdated(a,r))}),e.k0s(),e.bVm()}if(2&l){const n=t.$implicit,i=t.index,a=e.XpG();e.R7$(),e.Y8G("mode",a.mode)("formControl",n)("option",e.bMT(2,7,a.quizLabels$)[i])("options",e.bMT(3,9,a.quizLabels$))("sequence",i+1)("correct",a.isCorrect(e.bMT(4,11,a.quizLabels$)[i],e.bMT(5,13,a.activeSubmitted$),i))("collapsed",e.bMT(6,15,a.labelsCollapsed$))}}class we{constructor(t,n,i,a){this.store=t,this.formBuilder=n,this.changeRef=i,this.router=a,this.ngUnsubscribe=new C.B,this.mode="edit",this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.initQuizSubmissionListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.quizLabels$.pipe((0,P.F)((t,n)=>{const i=t.map(r=>r.value),a=n.map(r=>r.value);return(0,Q.isEqual)(i,a)}),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(Ae.j.getQuizModeActive);this.buildFormOptions(t,n),this.changeRef.markForCheck()}),(0,x.z)([this.quizModeActive$,this.quizLabels$]).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.setFormEnabled(t),this.changeRef.markForCheck()})}initQuizSubmissionListeners(){this.activeSubmission$.pipe((0,E.p)(t=>!(0,Q.isNil)(t)&&!(0,Q.isNil)(t.answer)&&Array.isArray(t.answer)),(0,P.F)((t,n)=>(0,Q.isEqual)(t,n)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=t.answer;(0,Q.isEqual)(this.form.value.options,i)||(this.form.patchValue({options:i},{emitEvent:!1,onlySelf:!0}),this.changeRef.markForCheck())}),this.form.valueChanges.pipe((0,P.F)((t,n)=>(0,Q.isEqual)(t,n)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(Ae.j.getActiveQuestionId),i=this.store.selectSnapshot(Ae.j.getActiveSubmitted),a=this.store.selectSnapshot(Ae.j.getActiveSubmission),r=(0,Q.isNil)(a)?[]:a.answer,_=t.options;(0,Q.isNil)(i)&&((0,Q.isEqual)(_,r)||this.store.dispatch(new Gt.B.SetActiveSubmission({questionId:n,answer:_})),this.changeRef.markForCheck())}),(0,x.z)([this.quizModeActive$,this.activeSubmitted$]).subscribe(([t,n])=>{this.mode=this.router.url.includes("/edit")?"edit":t&&!(0,Q.isNil)(n)?"summary":"view",this.changeRef.markForCheck()})}isCorrect(t,n,i){if(!(0,Q.isNil)(n))return n.answer[i]===t.value}handleLabelUpdated(t,n){const i=this.store.selectSnapshot(Ae.j.getActiveQuestion);i.data.options[n].label=t,this.store.dispatch(new Gt.B.SetQuestion(i))}buildFormOptions(t,n){this.optionsArray.clear(),t.forEach(i=>{this.optionsArray.push(this.formBuilder.control(n?"":i.value))})}setFormEnabled(t){t?this.optionsArray.enable():this.optionsArray.disable()}}(tt=we).\u0275fac=function(t){return new(t||tt)(e.rXU(p.il),e.rXU(Ue.ze),e.rXU(e.gRc),e.rXU(ht.Ix))},tt.\u0275cmp=e.VBU({type:tt,selectors:[["app-quiz-labels"]],decls:3,vars:2,consts:[["data-test","quizLabelsElement",3,"formGroup"],["formArrayName","options"],[4,"ngFor","ngForOf"],["data-test","appQuizLabel",3,"labelUpdated","mode","formControl","option","options","sequence","correct","collapsed"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,Yn,7,17,"ng-container",2),e.k0s()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("ngForOf",n.optionsArray.controls))},dependencies:[_e.Sq,Ue.BC,Ue.cb,Ue.l_,Ue.j4,Ue.v8,Tt,_e.Jj],changeDetection:0}),ze([(0,p.l6)(ce.y.getLabelsCollapsed),Ye("design:type",g.c)],we.prototype,"labelsCollapsed$",void 0),ze([(0,p.l6)(Ae.j.getActiveQuestionLabels),Ye("design:type",g.c)],we.prototype,"quizLabels$",void 0),ze([(0,p.l6)(Ae.j.getQuizModeActive),Ye("design:type",g.c)],we.prototype,"quizModeActive$",void 0),ze([(0,p.l6)(Ae.j.getAllSubmissions),Ye("design:type",g.c)],we.prototype,"allSubmissions$",void 0),ze([(0,p.l6)(Ae.j.getActiveSubmission),Ye("design:type",g.c)],we.prototype,"activeSubmission$",void 0),ze([(0,p.l6)(Ae.j.getActiveSubmitted),Ye("design:type",g.c)],we.prototype,"activeSubmitted$",void 0);var nt,ye=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},Se=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};function Kn(l,t){if(1&l&&(e.nrm(0,"app-context-label",5),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async")),2&l){let n,i,a;const r=e.XpG(3);e.Y8G("label",e.bMT(1,4,r.contextLabel$))("enableInfo",e.bMT(2,6,r.enableContextLabelInfo$)&&(null==(n=e.bMT(3,8,r.viewUI$))?null:n.nodeInfo.enable))("enableActions",e.bMT(4,10,r.enableContextLabelActions$)&&(null==(i=e.bMT(5,12,r.viewUI$))?null:i.contextActions.enable))("enableAudio",e.bMT(6,14,r.enableContextLabelAudio$)&&(null==(a=e.bMT(7,16,r.viewUI$))?null:a.nodeAudio.enable))}}function Wn(l,t){if(1&l&&(e.qex(0),e.nrm(1,"app-story-label",6),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bVm()),2&l){let n,i;const a=t.$implicit,r=e.XpG(3);e.R7$(),e.AVh("labels__label--hidden",!a.shown),e.Y8G("pinDraggable",null==(n=e.bMT(2,7,r.draggable$))?null:n.pin)("tagDraggable",null==(i=e.bMT(3,9,r.draggable$))?null:i.tag)("label",a)("collapsed",e.bMT(4,11,r.labelsCollapsed$))("collapsedMode",e.bMT(5,13,r.labelsCollapsedMode$))}}function Qn(l,t){if(1&l&&(e.qex(0),e.DNE(1,Kn,8,18,"app-context-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,Wn,6,15,"ng-container",4),e.nI1(5,"async"),e.bVm()),2&l){const n=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,3,n.enableContextLabel$)&&e.bMT(3,5,n.contextLabel$)),e.R7$(3),e.Y8G("ngForOf",e.bMT(5,7,n.labels$))("ngForTrackBy",n.trackLabel)}}function Hn(l,t){1&l&&(e.qex(0),e.nrm(1,"app-quiz-labels"),e.bVm())}function Zn(l,t){if(1&l&&(e.j41(0,"div",1),e.DNE(1,Qn,6,9,"ng-container",2)(2,Hn,2,0,"ng-container",2),e.k0s()),2&l){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.showAnatomyLabels),e.R7$(),e.Y8G("ngIf",n.showQuizLabels)}}class ve{constructor(t,n,i,a,r,_,I,te){this.action$=t,this.cameraService=n,this.changeDetector=i,this.elRef=a,this.labelsService=r,this.router=_,this.store=I,this.applicationEventService=te,this.interactive=!1,this.showAnatomyLabels=!1,this.showQuizLabels=!1,this.ngUnsubscribe=new C.B}ngOnInit(){this.bindEngineEvents(),this.bindApplicationEvents(),this.labelsService.setLabelContainer(this.elRef)}ngOnDestroy(){this.labelsService.setLabelContainer(null),this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}bindApplicationEvents(){this.action$.pipe((0,p.xi)(b.zE),(0,c.Q)(this.ngUnsubscribe)).subscribe(n=>{this.handleClickNode(n)}),this.action$.pipe((0,p.xi)(b.fZ),(0,c.Q)(this.ngUnsubscribe)).subscribe(n=>{n.node&&this.store.dispatch(new Me.S3)}),this.labels$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(n=>{this.changeDetector.markForCheck()}),this.selectedLabel$.pipe((0,E.p)(n=>null==n),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{const n=this.store.selectSnapshot(ae.x.getZoomed),i=this.store.selectSnapshot(ae.x.getLockCamera);n&&!i&&this.resetCamera()});const t=(0,x.z)([this.activeTool$,this.activeQuestion$]).pipe((0,c.Q)(this.ngUnsubscribe),(0,h.T)(([n,i])=>{const a=this.router.url.indexOf("/edit")>=0,r=(0,Q.get)(i,"type")===Kt.Q5.LabelAnatomy;return a?n===O.s.Quiz:r}));(0,x.z)([this.showLabels$,t,this.activeQuestion$]).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(([n,i,a])=>{const r=(0,Q.get)(a,"showChapterLabels");this.showQuizLabels=i,this.showAnatomyLabels=!this.showQuizLabels&&n||r,this.changeDetector.markForCheck()}),this.store.select(K.N.getSelectedChapterReadyState).pipe((0,E.p)(n=>null!=n),(0,c.Q)(this.ngUnsubscribe)).subscribe(n=>{this.interactive=n.model,this.changeDetector.markForCheck()})}bindEngineEvents(){this.action$.pipe((0,p.xi)(b.Gv,Me.eH),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(t.show?v.F.LabelsEnabled:v.F.LabelsDisabled,null)}),this.action$.pipe((0,p.xi)(Me.Sh),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(v.F.LabelsCreated,t.label)}),this.action$.pipe((0,p.xi)(Me.lb),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(v.F.LabelsUpdated,t.label)}),this.action$.pipe((0,p.xi)(Me.D3),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{t.labels.forEach(n=>{this.applicationEventService.fireEvent(t.shown?v.F.LabelsShown:v.F.LabelsHidden,{labelId:n.id})})}),this.action$.pipe((0,p.xi)(Me.vx),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(v.F.LabelsDestroyed,t.label)})}handleClickNode(t){const n=this.store.selectSnapshot(o.S.getActiveTool);if((0,Q.isNil)(t.node))this.store.dispatch(new Me.TR(null)),this.store.dispatch(new Me.S3);else{const i=this.store.selectSnapshot(ce.y.getEnableContextLabel);n===O.s.Label?this.addLabel(t.hit,t.node):i&&setTimeout(()=>{this.toggleContextLabel(t.hit,t.node)})}}addLabel(t,n){const i=this.cameraService.getDirection(t),a=this.getLabelDefaults(t.objectId),r=a.hideWire?20:32;a.title=n.label,a.offset=[r,0],a.objectId=t.objectId,a.barycentric=[t.barycentric[0],t.barycentric[1],t.barycentric[2]],a.pos=[t.worldPos[0],t.worldPos[1],t.worldPos[2]],a.primitiveIndex=t.triIndex,a.renderableIndex=t.renderableIndex||0,a.dir=i,a.chapterId=this.store.selectSnapshot(K.N.getSelectedChapter).id,a.occludable=!0,a.shown=!0,this.store.dispatch(new Me.Sh(a,!0)),this.store.dispatch(new Me.TR(a))}toggleContextLabel(t,n){const i=this.store.selectSnapshot(T.z.getCheckedNodeIds);if(!this.store.selectSnapshot(o.S.getContextMenu).node&&i.some(r=>r===n.id)){const r=this.cameraService.getDirection(t),_=this.labelsService.makeDefaultStudioLabel();_.theme=mt.D.Context,_.title=n.label,_.offset=[32,0],_.objectId=t.objectId,_.barycentric=[t.barycentric[0],t.barycentric[1],t.barycentric[2]],_.pos=[t.worldPos[0],t.worldPos[1],t.worldPos[2]],_.primitiveIndex=t.triIndex,_.renderableIndex=t.renderableIndex||0,_.dir=r,_.occludable=!1,_.hideWire=!0,_.pinType=bt.O.None,this.store.dispatch(new Me.h5(_))}else this.store.dispatch(new Me.S3)}getLabelDefaults(t){let n=this.store.selectSnapshot(ce.y.getSelectedLabel);if(null==n){let i=this.store.selectSnapshot(ce.y.getChapterLabels);(!i||0===i.length)&&(i=this.store.selectSnapshot(ce.y.getLabels)),i.length&&(n=(0,Q.cloneDeep)(i[i.length-1]))}if(null!=n){const i=this.labelsService.makeDefaultStudioLabel();switch(i.hideWire=n.hideWire,i.pinGlow=n.pinGlow,i.pinType=n.pinType,i.theme=n.theme,i.sequentialType=n.sequentialType,i.states[0].errands[0]=new xt.T,(0,Q.get)(n,"states[1].errands[0].type")){case Xe.X.flyToObject:case Xe.X.flyToCamera:i.states[1].errands[0]=new Ot.F(t)}return i}{const i=this.labelsService.makeDefaultStudioLabel();return i.states[0].errands[0]=new xt.T,i.states[1].errands[0]=new Ot.F(t),i}}trackLabel(t,n){const{id:i,shown:a,theme:r}=n;return`${i}${a}${r}`}resetCamera(){const n=this.store.selectSnapshot(K.N.getSelectedChapter)?.camera?.location;(0,Q.isNil)(n)||this.store.dispatch(new X.Ih(n))}}(nt=ve).\u0275fac=function(t){return new(t||nt)(e.rXU(p.En),e.rXU(q.j),e.rXU(e.gRc),e.rXU(e.aKT),e.rXU(ut.x),e.rXU(ht.Ix),e.rXU(p.il),e.rXU(gt.S))},nt.\u0275cmp=e.VBU({type:nt,selectors:[["app-labels"]],decls:1,vars:1,consts:[["class","labels","data-test","labelsElement","dir","ltr",4,"ngIf"],["data-test","labelsElement","dir","ltr",1,"labels"],[4,"ngIf"],[3,"label","enableInfo","enableActions","enableAudio",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"label","enableInfo","enableActions","enableAudio"],["data-test","appStoryLabel",1,"labels__label",3,"pinDraggable","tagDraggable","label","collapsed","collapsedMode"]],template:function(t,n){1&t&&e.DNE(0,Zn,3,2,"div",0),2&t&&e.Y8G("ngIf",n.interactive)},dependencies:[_e.Sq,_e.bT,Rt.ig,qe,rt,we,_e.Jj],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;position:relative}.labels[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2;pointer-events:none}.labels__label--hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),ye([(0,p.l6)(Wt.dF.getUI),Se("design:type",g.c)],ve.prototype,"viewUI$",void 0),ye([(0,p.l6)(ce.y.getChapterLabels),Se("design:type",g.c)],ve.prototype,"labels$",void 0),ye([(0,p.l6)(Ae.j.getQuizModeActive),Se("design:type",g.c)],ve.prototype,"quizModeActive$",void 0),ye([(0,p.l6)(o.S.getActiveTool),Se("design:type",g.c)],ve.prototype,"activeTool$",void 0),ye([(0,p.l6)(Ae.j.getActiveQuestion),Se("design:type",g.c)],ve.prototype,"activeQuestion$",void 0),ye([(0,p.l6)(K.N.getSelectedChapter),Se("design:type",g.c)],ve.prototype,"selectedChapter$",void 0),ye([(0,p.l6)(ce.y.getSelectedLabel),Se("design:type",g.c)],ve.prototype,"selectedLabel$",void 0),ye([(0,p.l6)(ce.y.getLabelsCollapsed),Se("design:type",g.c)],ve.prototype,"labelsCollapsed$",void 0),ye([(0,p.l6)(ce.y.getLabelsCollapsedMode),Se("design:type",g.c)],ve.prototype,"labelsCollapsedMode$",void 0),ye([(0,p.l6)(ce.y.getContextLabel),Se("design:type",g.c)],ve.prototype,"contextLabel$",void 0),ye([(0,p.l6)(o.S.getShowLabels),Se("design:type",g.c)],ve.prototype,"showLabels$",void 0),ye([(0,p.l6)(ae.x.getZoomed),Se("design:type",g.c)],ve.prototype,"zoomed$",void 0),ye([(0,p.l6)(ce.y.getEnableContextLabel),Se("design:type",g.c)],ve.prototype,"enableContextLabel$",void 0),ye([(0,p.l6)(ce.y.getEnableContextLabelInfo),Se("design:type",g.c)],ve.prototype,"enableContextLabelInfo$",void 0),ye([(0,p.l6)(ce.y.getEnableContextLabelActions),Se("design:type",g.c)],ve.prototype,"enableContextLabelActions$",void 0),ye([(0,p.l6)(ce.y.getEnableContextLabelAudio),Se("design:type",g.c)],ve.prototype,"enableContextLabelAudio$",void 0),ye([(0,p.l6)(ce.y.getLabelsDraggable),Se("design:type",g.c)],ve.prototype,"draggable$",void 0);var Jn=s(76037),qn=s(82109),ei=s(77428);let ti=(()=>{var l;class t{constructor(i,a){this.store=i,this.changeDetectorRef=a,this.ngUnsubscribe=new C.B,this.storyLoadProgress=0}ngOnInit(){const i=this.store.select(qn.N.getChaptersLoadProgress),a=this.store.select(B.t.getLoadingChapter);(0,x.z)(i,a).pipe((0,E.p)(()=>{const r=this.store.selectSnapshot(B.t.getLoadChapters);return!(0,Q.isNil)(r)&&r.length>0}),(0,c.Q)(this.ngUnsubscribe)).subscribe(([r,_])=>{const I=this.store.selectSnapshot(K.N.getSelectedChapterId),te=!(0,Q.isNil)(_)&&_.chapterId===I;this.storyLoadProgress=te?r[I]??0:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(p.il),e.rXU(e.gRc))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-engine-progress"]],decls:1,vars:3,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(i,a){1&i&&e.nrm(0,"app-progress",0),2&i&&(e.Y8G("value",a.storyLoadProgress)("total",1),e.BMQ("data-progress",a.storyLoadProgress))},dependencies:[ei.X],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0}),t})();var Ce=s(49969);function ni(l,t){if(1&l){const n=e.RV6();e.j41(0,"div",1),e.bIt("@show.done",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.onShowDone())}),e.j41(1,"div",2),e.EFF(2,"Use control + scroll to zoom"),e.k0s()()}2&l&&e.Y8G("@show",void 0)}let ii=(()=>{var l;class t{constructor(i,a){this.actions=i,this.changeDetectorRef=a,this.ngUnsubscribe=new C.B,this.show=!1}ngOnInit(){this.actions.pipe((0,p.xi)(b.JK),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(p.En),e.rXU(e.gRc))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(i,a){1&i&&e.DNE(0,ni,3,1,"div",0),2&i&&e.Y8G("ngIf",a.show)},dependencies:[_e.bT],styles:[".engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:#10182380;font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,Ce.hZ)("show",[(0,Ce.kY)(":enter",[(0,Ce.K2)([(0,Ce.iF)({opacity:"*"}),(0,Ce.i0)("500ms ease-in-out",(0,Ce.iF)({opacity:1})),(0,Ce.i0)("500ms 2000ms ease-in-out",(0,Ce.iF)({opacity:0}))])])])]},changeDetection:0}),t})();const oi=(l,t)=>({backgroundColor:l,duration:t}),si=(l,t)=>({value:l,params:t}),ai=(0,Ce.lY)([(0,Ce.iF)({opacity:"0",backgroundColor:"*"}),(0,Ce.K2)([(0,Ce.i0)("{{ duration }}ms {{ easing }}",(0,Ce.iF)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,Ce.i0)("250ms 500ms ease-in",(0,Ce.iF)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let li=(()=>{var l;class t{constructor(i,a,r){this.actions=i,this.changeDetectorRef=a,this.store=r,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new C.B}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,p.xi)(b.zW),(0,c.Q)(this.ngUnsubscribe)).subscribe(i=>{this.fadeIn(i.color,i.duration)})}handleFadeComplete(){this.store.dispatch(new b.In),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(i,a){this.isVisible=!0,this.color=i,this.duration=1e3*a,this.changeDetectorRef.markForCheck()}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(p.En),e.rXU(e.gRc),e.rXU(p.il))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(i,a){1&i&&(e.j41(0,"div",0),e.bIt("@fade.done",function(){return a.handleFadeComplete()}),e.k0s()),2&i&&e.Y8G("@fade",e.l_i(4,si,a.isVisible,e.l_i(1,oi,a.color,a.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,Ce.hZ)("fade",[(0,Ce.kY)("* => true",(0,Ce.sM)(ai))])]},changeDetection:0}),t})();var ri=s(9065),ci=s(81642);let di=(()=>{var l;class t{constructor(i,a,r,_){this.engineService=i,this.cameraService=a,this.numberService=r,this.changeDetectionRef=_,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(y.X.CameraUpdated).pipe((0,ri.Z)(50)).subscribe(i=>{const a=this.numberService.roundModel(i.eye,0),{x:r,y:_,z:I}=a,te=Math.floor(100*this.cameraService.getCameraZoom()),oe=this.numberService.roundNumber(i.dist,0);this.camera={x:r,y:_,z:I,zoom:te,dist:oe},this.changeDetectionRef.markForCheck()})}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(j.y),e.rXU(q.j),e.rXU(ci.D),e.rXU(e.gRc))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(i,a){1&i&&(e.j41(0,"div",0),e.EFF(1),e.k0s()),2&i&&(e.R7$(),e.SjE(" X:",null==a.camera?null:a.camera.x," Y:",null==a.camera?null:a.camera.y," Z:",null==a.camera?null:a.camera.z," Dist:",null==a.camera?null:a.camera.dist," Zoom:",null==a.camera?null:a.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0}),t})();var jt=s(90413);let pi=(()=>{var l;class t{constructor(i){this.store=i}ngOnInit(){}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger().openMenu()}onNodeActionsClosed(){this.store.dispatch(new b.fZ(null,null))}getNodeActionsStyles(){return{"left.px":this.hit?this.hit.canvasPos.x:0,"top.px":this.hit?this.hit.canvasPos.y:0}}}return(l=t).\u0275fac=function(i){return new(i||l)(e.rXU(p.il))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-engine-contextmenu"]],viewQuery:function(i,a){if(1&i&&e.GBs(jt.D,7),2&i){let r;e.mGM(r=e.lsd())&&(a.nodeActionsComponent=r.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"nodeActionsClosed","ngStyle","node"]],template:function(i,a){1&i&&(e.j41(0,"div",0)(1,"app-node-actions",1),e.bIt("nodeActionsClosed",function(){return a.onNodeActionsClosed()}),e.k0s()()),2&i&&(e.R7$(),e.Y8G("ngStyle",a.getNodeActionsStyles())("node",a.node))},dependencies:[_e.B3,jt.D],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]}),t})();var it,ue=function(l,t,n,i){var _,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(l,t,n,i);else for(var I=l.length-1;I>=0;I--)(_=l[I])&&(r=(a<3?_(r):a>3?_(t,n,r):_(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r},me=function(l,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(l,t)};const _i=["engine"],hi=l=>({"engine--hidden":l});function gi(l,t){1&l&&e.nrm(0,"div",2)}function ui(l,t){if(1&l&&e.nrm(0,"app-engine-contextmenu",3),2&l){const n=e.XpG();e.Y8G("node",n.contextMenuNode)("hit",n.contextMenuHit)}}function mi(l,t){1&l&&e.nrm(0,"div",4)}function bi(l,t){1&l&&e.nrm(0,"app-engine-progress",5)}function fi(l,t){if(1&l&&(e.j41(0,"div",6),e.nrm(1,"app-engine-stats",7),e.nI1(2,"async"),e.k0s()),2&l){const n=e.XpG(),i=e.sdS(1);e.Y8G("cdkDragBoundary",i),e.R7$(),e.Y8G("theme",n.isBackgroundLight?"light":"dark")("showAdvancedTools",e.bMT(2,3,n.showAdvancedTools$))}}function vi(l,t){1&l&&e.nrm(0,"app-engine-camera-position")}var Fe=function(l){return l[l.Pan=.4]="Pan",l[l.PanSlow=.04]="PanSlow",l[l.Zoom=5]="Zoom",l[l.ZoomSlow=1]="ZoomSlow",l[l.Rotate=.3]="Rotate",l[l.RotateSlow=.03]="RotateSlow",l}(Fe||{}),ke=function(l){return l[l.Rotate=6]="Rotate",l[l.Pan=1.75]="Pan",l[l.Zoom=2.5]="Zoom",l}(ke||{}),Ee=function(l){return l[l.Zoom=-6]="Zoom",l[l.TrackZoom=.5]="TrackZoom",l[l.Pan=1.25]="Pan",l[l.Rotate=1.5]="Rotate",l[l.Friction=.85]="Friction",l[l.ZoomFriction=.85]="ZoomFriction",l[l.FrictionThreshold=.002]="FrictionThreshold",l}(Ee||{}),$e=function(l){return l.Fade="engine--cursor-fade",l.Hide="engine--cursor-hide",l.Label="engine--cursor-label",l.Paint="engine--cursor-paint",l.Eyedropper="engine--cursor-eyedropper",l.Crosshair="engine--cursor-crosshair",l.Default="",l}($e||{}),Ft=function(l){return l[l.None=0]="None",l[l.Left=1]="Left",l[l.Right=2]="Right",l[l.LeftAndRight=4]="LeftAndRight",l}(Ft||{});const Xt=1e3/60;class pe{wheel(t){const n=this.store.selectSnapshot(o.S.getScrollMode),i=t.ctrlKey;n===Y.M.DoNotCaptureShowMessage&&!i&&this.store.dispatch(new b.JK(!0)),(n===Y.M.Capture||i)&&(t.preventDefault(),this.handleWheel(t))}onContextMenu(t){this.contextMenuEnable()&&this.handleContextMenu(t)}onMouseOut(){this.handleMouseOut()}constructor(t,n,i,a,r,_,I,te,oe,he,Oe,Le,Ge,Ie,Ke,Ne,ct,Ei){this.actions=t,this.activatedRoute=n,this.animationService=i,this.cameraService=a,this.changeDetecton=r,this.engineService=_,this.xrService=I,this.sceneService=te,this.mediaService=oe,this.paintService=he,this.renderer=Oe,this.storageService=Le,this.store=Ge,this.applicationEventService=Ie,this.particleSystemsService=Ke,this.engineRendererService=Ne,this.clippingPlanesService=ct,this.liveAnnouncer=Ei,this.VERSION=Be.VERSION,this.flyCamera=!0,this.visible=!1,this.application=be.c,this.cursorClass=$e.Default,this.chapterReady=!1,this.ngUnsubscribe=new C.B,this.display=!1,this.engineVisible=!0,this.inputEnabled=(0,e.hFB)(!0),this.contextMenuEnable=(0,e.hFB)(!0),this.background=new V.t(null),this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,H.c.application===be.c.Loft&&s.e(361).then(s.t.bind(s,5361,23)).then(yi=>{window.pako=yi}),this.showDebug=H.c.application===be.c.Loft||"true"===this.storageService.getLocalItem(ot.UT.CameraDebug),H.c.deploy===M.Z.Production&&(H.c.application===be.c.Studio||H.c.application===be.c.Viewer)||console.table({Commit:Be.COMMIT,Time:new Date(Be.TIMESTAMP).toLocaleString(),Version:Be.VERSION})}convertToLeafStateMap(t,n){const i={};return Object.entries(n).forEach(([a,r])=>{i[a]={},i[a][t]=r}),i}ngOnInit(){this.particleStateListener=new dt(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initVideo(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.particleStateListener.destroy(),this.engineService.destroyEngine(),this.animationService.destroyPlayer(),this.xrService.destroyXR(),this.canvas?.remove(),this.canvas=null,this.changeDetecton.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const t=this.store.selectSnapshot(o.S.getWebGLContextName),n=this.activatedRoute.snapshot.queryParams.disableTextureCompression,i="true"===n||n?.split(",").reduce((a,r)=>({...a,[r.trim().toLowerCase()]:!0}),{});this.engineService.initEngine({contextName:t,disableTextureCompression:i}),this.canvas=this.engineRendererService.getCanvas(),this.canvas.style.zIndex="1",this.canvas.dataset.test="engineCanvas",this.engineElement.nativeElement.prepend(this.canvas),"true"===localStorage.getItem("xr")&&this.xrService.initXR(this.engineService.engine)}bindEngineEvents(){this.engineService.getEvent(y.X.Loaded).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new b.AU(!0))}),this.engineService.getEvent(y.X.TimelineChapterTransition).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(v.F.LabelsChapterInfo,this.store.selectSnapshot(ce.y.getChapterLabels))}),(0,G.h)(this.engineService.getEvent(y.X.TimelinePlayed),this.engineService.getEvent(y.X.TimelinePaused)).pipe((0,c.Q)(this.ngUnsubscribe),(0,E.p)(()=>null!=this.store.selectSnapshot(K.N.getSelectedChapterId)),(0,w.B)(50),(0,h.T)(()=>this.animationService.isPlaying())).subscribe(t=>{this.store.dispatch(new b.jM(t))}),this.engineService.getEvent(y.X.Tick).pipe((0,E.p)(()=>this.visible&&!(0,Q.isNil)(this.engineService.engine?.story)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.inputEnabled()&&this.handleMouseInputEngineTick(t),this.handleCameraTick(t),this.deltaTime=window.performance.now()}),this.engineService.getEvent(y.X.TweenVisibilityUpdate).pipe((0,u.E)(this.store.select(K.N.getIsChapterAnimated),this.store.select(K.N.getSelectedChapterModelReady)),(0,E.p)(([t,n,i])=>n&&i&&Object.keys(t).length>0),(0,c.Q)(this.ngUnsubscribe)).subscribe(([t])=>{const n=[],i=[];Object.entries(t).forEach(([a,r])=>{r?n.push(a):i.push(a)}),n.length>0&&this.store.dispatch(new fe.LV(!0,n)),i.length>0&&this.store.dispatch(new fe.LV(!1,i)),this.applyShownPatches(t,!1)}),this.engineService.getEvent(y.X.VariantsUpdate).pipe((0,E.p)(t=>Object.keys(t).length>0),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applyVariantPatches(t,!0,!1,!1)}),this.engineService.getEvent(y.X.SceneObjectRenderable).pipe(function z(l,...t){var n,i;const a=null!==(n=(0,W.lI)(t))&&void 0!==n?n:k.E,r=null!==(i=t[0])&&void 0!==i?i:null,_=t[1]||1/0;return(0,R.N)((I,te)=>{let oe=[],he=!1;const Oe=Ie=>{const{buffer:Ke,subs:Ne}=Ie;Ne.unsubscribe(),(0,d.o)(oe,Ie),te.next(Ke),he&&Le()},Le=()=>{if(oe){const Ie=new D.yU;te.add(Ie);const Ne={buffer:[],subs:Ie};oe.push(Ne),(0,N.N)(Ie,a,()=>Oe(Ne),l)}};null!==r&&r>=0?(0,N.N)(te,a,Le,r,!0):he=!0,Le();const Ge=(0,$._)(te,Ie=>{const Ke=oe.slice();for(const Ne of Ke){const{buffer:ct}=Ne;ct.push(Ie),_<=ct.length&&Oe(Ne)}},()=>{for(;oe?.length;)te.next(oe.shift().buffer);Ge?.unsubscribe(),te.complete(),te.unsubscribe()},void 0,()=>oe=null);I.subscribe(Ge)})}(1e3),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t.length){const n={};t.forEach(i=>{n[i.objectId]={renderable:!0}}),this.store.dispatch(new b.GT(n))}}),this.engineService.getEvent(y.X.AssetsLoadProgress).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(({chapterId:t,chapterProgress:n})=>{const i=this.store.selectSnapshot(B.t.getLoadChapters).length,_=1/i,oe=n*_+(i-Math.max(this.store.selectSnapshot(B.t.getLoadChaptersRemaining).length,1))*_;this.progress=oe.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new F.m(oe,t,n))}),this.engineService.getEvent(y.X.CameraUpdated).pipe((0,E.p)(()=>!this.cameraAnimating),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(y.X.CameraRested).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,p.xi)(S.dC),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,E.p)(t=>null!=t),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.enginePosition=t,this.repositionEngine(t)}),this.store.select(o.S.getXrayModeEnabled).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(T.z.getCheckedNodes),i=this.store.selectSnapshot(T.z.getNodes),a=this.store.selectSnapshot(o.S.getViewGraph);!1===t?(Object.keys(i||[]).forEach(r=>{this.paintService.paint(a,r,i[r].paint)}),n.forEach(r=>this.paintService.highlight(a,r.objectId,!0))):(this.paintService.paintAll(a,Object.keys(i),ne.EC),this.paintService.paintAll(a,n.map(r=>r.objectId),ne.NR))}),this.actions.pipe((0,p.xi)(b.K6),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.display=t,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.engineVisible=t,this.changeDetecton.markForCheck()}),this.contextMenu$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.contextMenuNode=t.node,this.contextMenuHit=t.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,E.p)(t=>!(0,Q.isNil)(t)),(0,m.J)(),(0,c.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{const i=this.store.selectSnapshot(o.S.getChapter);if(this.store.selectSnapshot(K.N.getSelectedChapterReadyState).model){const _=n.id;if(t.id===_&&i===_)return;this.animationService.setChapter(_).then(()=>{this.store.dispatch(new fe.IA(_)),(0,le.q)(this.store,this.engineService),this.store.dispatch(new X.Yp(void 0))})}}),(0,x.z)([this.clippingPlanes$,this.readyState$]).pipe((0,E.p)(([t,n])=>!(0,Q.isNil)(t)&&!0===n?.model),(0,P.F)(Q.isEqual),(0,w.B)(0),(0,c.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.clippingPlanesService.setClippingPlanes(t)}),(0,x.z)([this.selectedChapterId$,this.readyState$,this.autoplay$,this.prefersReducedMotion$]).pipe((0,E.p)(([t,n,i,a])=>!((0,Q.isNil)(t)||(0,Q.isNil)(n)||(0,Q.isNil)(i)||(0,Q.isNil)(a))),(0,c.Q)(this.ngUnsubscribe)).subscribe(([,t,n,i])=>{const a=(0,Q.get)(t,"animation",!1),r=this.store.selectSnapshot(K.N.getSelectedChapter),_=(0,Q.get)(r,"ui.play.autoplay",!0),I=a&&n&&_&&!i;this.store.dispatch(new b.A6),this.store.dispatch(new b.dE(I))})}bindCameraEvents(){this.actions.pipe((0,p.xi)(X.Ih,b.W6),(0,E.p)(t=>!!(t instanceof X.Ih?t.camera:t.objectId)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=!this.store.selectSnapshot(Re.U.getPrefersReducedMotion)&&t.animate;let i;i=t instanceof X.Ih?n?this.flyToCamera(t.camera,t.animationDuration):this.jumpToCamera(t.camera):n?this.flyToObject(t.objectId,t.animationDuration):this.jumpToObject(t.objectId),i.then(()=>{this.liveAnnouncer.announce("Camera Postion Updated"),this.store.dispatch(new X.Nz),t instanceof X.Ih&&t.rotationCenter&&this.cameraService.setCameraRotationCenter(t.rotationCenter)})}),this.actions.pipe((0,p.xi)(X.bB),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.panCameraStatic(t.x,t.y,t.z)}),this.actions.pipe((0,p.xi)(X.RJ),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.rotateCameraStatic(t.x,t.y)}),this.actions.pipe((0,p.xi)(X.F5),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.setAbsoluteZoom(t.value)})}bindToolEvents(){this.activeTool$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(Object.values($e).forEach(n=>{n&&this.renderer.removeClass(this.engineElement.nativeElement,n)}),t){case O.s.Fade:this.renderer.addClass(this.engineElement.nativeElement,$e.Fade);break;case O.s.Hide:this.renderer.addClass(this.engineElement.nativeElement,$e.Hide);break;case O.s.Label:this.renderer.addClass(this.engineElement.nativeElement,$e.Label);break;case O.s.Paint:this.renderer.addClass(this.engineElement.nativeElement,$e.Paint);break;case O.s.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,$e.Eyedropper)}})}bindMouseEvents(){this.mouseMove$=(0,A.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleMousePan(t)}),this.mouseMove$.pipe((0,u.E)(this.store.select(o.S.getHoverPickEnabled)),(0,U.c)(10),(0,E.p)(([,t])=>t),(0,c.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.handleMouseHover(t)}),this.mouseLeave$=(0,A.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,U.c)(10),(0,c.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(t){return(0,A.R)(window,t).pipe((0,E.p)(()=>{const n=this.store.selectSnapshot(Vt.Pf.getFocusedElement),i=(0,Q.isEmpty)(document.querySelectorAll(".cdk-overlay-pane"));return!n&&i}))}bindKeyEvents(){const t=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((a,r)=>(a[r]=!1,a),{}),n=new V.t(t);let i;this.bindWindowKeyEvent("keydown").pipe((0,E.p)(a=>!(a.repeat||a.metaKey||a.ctrlKey)),(0,E.p)(a=>{const _=a.target.nodeName.toLowerCase();return!(["input","textarea","select","option","button"].indexOf(_)>=0)}),(0,c.Q)(this.ngUnsubscribe)).subscribe(a=>{n.next({...n.value,[a.key.toLowerCase()]:!0,shiftKey:a.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,E.p)(a=>!!a.key),(0,c.Q)(this.ngUnsubscribe)).subscribe(a=>{1===Object.values(i).filter(_=>!0===_).length?(this.applyMotion(i,!0),n.next({...n.value,[a.key.toLowerCase()]:!1,shiftKey:a.shiftKey,hasMomentum:!1===i.shiftKey})):n.next({...n.value,[a.key.toLowerCase()]:!1,shiftKey:a.shiftKey,hasMomentum:!1})}),n.pipe((0,E.p)(()=>this.inputEnabled()),(0,c.Q)(this.ngUnsubscribe)).subscribe(a=>{i=a,!1===a.hasMomentum&&this.applyMotion(a,!1)})}applyMotion(t,n){const i=new de.x,a=t.shiftKey?Fe.ZoomSlow:Fe.Zoom,r=t.shiftKey?Fe.PanSlow:Fe.Pan,_=t.shiftKey?Fe.RotateSlow:Fe.Rotate;i.zoom+=t.c||t["-"]||t._?a:0,i.zoom-=t.e||t["="]||t["+"]?a:0,i.panX-=t.d?r:0,i.panX+=t.a?r:0,i.panY+=t.w?r:0,i.panY-=t.s?r:0,i.rotateX-=t.arrowright?_:0,i.rotateX+=t.arrowleft?_:0,i.rotateY+=t.arrowup?_:0,i.rotateY-=t.arrowdown?_:0,i.applyFriction=n,this.store.dispatch(new X.P4(i))}initChangeListener(){this.nodeStatePatches$.pipe((0,E.p)(t=>t.length>0),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.reduce((he,Oe)=>{const Le=Oe.path[Oe.path.length-1];return void 0!==he[Le]&&he[Le].push(Oe),he},{available:[],shown:[],checked:[],paint:[],pickable:[],variant:[]}),i=he=>n[he].reduce((Oe,Le)=>(Oe[Le.path[2]]=Le.value,Oe),{}),a=i("available"),r=i("checked"),_=i("shown"),I=i("paint"),te=i("pickable"),oe=i("variant");(0,Q.isEmpty)(a)||this.applyAvailablePatches(a),(0,Q.isEmpty)(_)||this.applyShownPatches(_,!0),(0,Q.isEmpty)(r)||this.applyCheckedPatches(r),(0,Q.isEmpty)(I)||this.applyPaintPatches(I),(0,Q.isEmpty)(te)||this.applyPickablePatches(te),(0,Q.isEmpty)(oe)||this.applyVariantPatches(oe,!1,!0,!0)})}initBackgroundListener(){(0,x.z)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(([t,n,i])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",(0,ge.tH)(t)),this.isBackgroundCheckered(t)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",n?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",i?1:0)}),this.background$.pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.isBackgroundLight=(0,ge.T4)(t),this.changeDetecton.markForCheck()})}initPlaybackSpeedListener(){this.store.select(o.S.getPlaybackSpeed).pipe((0,E.p)(()=>this.store.selectSnapshot(K.N.getSelectedChapterAnimationReady)),(0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{this.animationService.setPlaybackRate(t)})}repositionEngine(t){const n=this.engineElement.nativeElement,{top:i,left:a,width:r,height:_,visibility:I,scale:te,viewportWidth:oe,viewportHeight:he}=t;this.renderer.setStyle(n,"left",`${a}px`),this.renderer.setStyle(n,"top",`${i}px`),this.renderer.setStyle(n,"width",`${r}px`),this.renderer.setStyle(n,"height",`${_}px`),this.renderer.setStyle(n,"transform",`scale(${te})`),this.renderer.setStyle(n,"zIndex",`${I}`),this.renderer.setStyle(n,"visibility",I===se.g.Shown?"visible":"hidden"),oe!==r||he!==_||1!==te?this.renderer.addClass(n,"engine--scaled"):this.renderer.removeClass(n,"engine--scaled");const Oe=Math.max(1,Math.floor(1/te));n?.style?.setProperty("--engine-border-width",`${Oe}px`),this.visible=I===se.g.Shown,this.engineService.fireEvent(y.X.CanvasResized)}bindHumanInteractions(){this.hammerManager=new Pe.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new Pe.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new Pe.Tap({event:"singletap"})),this.hammerManager.add(new Pe.Pan({event:"pan",pointers:0})),this.hammerManager.add(new Pe.Pinch({event:"pinch"})),this.hammerManager.add(new Pe.Press({time:500})),this.hammerManager.on("singletap",i=>{this.store.selectSnapshot(o.S.getClickPickEnabled)&&this.handleTap(i)}),this.hammerManager.on("doubletap",i=>{this.handleDoubleTap(i)}),this.hammerManager.on("press",i=>{i.preventDefault(),i.srcEvent.stopImmediatePropagation(),this.handlePress(i)}),this.hammerManager.on("pan",i=>{i.preventDefault(),this.handlePan(i)}),this.hammerManager.on("panend",i=>{this.handlePanEnd(i)}),this.hammerManager.on("pinchend",i=>{this.handlePinchEnd(i)});let t=0,n=0;this.hammerManager.on("pinchstart",i=>{t=i.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",i=>{if(this.pinchTicks>0)return;const a=Math.abs(i.deltaX)>60||Math.abs(i.deltaY)>60,r=i.scale>1.25||i.scale<.75;this.pinchMode?("pan"===this.pinchMode&&r&&!a&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&a&&!r&&(this.pinchMode="pan")):this.pinchMode=r?"pinch":"pan";const _=i.scale-t;t=i.scale;const I=n;n=0===_?0:_>0?1:-1,this.cameraService.setCameraPan(i.velocityX*Ee.Pan,i.velocityY*Ee.Pan),n+I!==0&&this.cameraService.setRelativeZoom(_*Ee.Zoom)})}handleMouseHover(t){if(t.buttons!==Ft.None)return;const{offsetX:n,offsetY:i}=t,a=this.pickAtCanvasPosition(n,i,!1);if(a.objectId){const r=this.store.selectSnapshot(o.S.getViewGraph),_=this.sceneService.getViewNode(r,a.objectId),I=this.store.selectSnapshot(o.S.getHoveredNode);(!I||I.id!==_.id)&&this.store.dispatch(new b.DZ(_,a))}else null!=this.store.selectSnapshot(o.S.getHoveredNode)&&this.store.dispatch(new b.DZ(null))}handleMouseLeave(){this.store.dispatch(new b.DZ(null))}handleMousePan(t){if(2===t.buttons||4===t.buttons){let{movementX:n,movementY:i}=t;n/=16,i/=16,this.cameraService.setCameraPan(n,i)}}handleMouseOut(){this.store.dispatch(new b.DZ(null))}handleWheel(t){let n=0;0===t.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(t.deltaY)<10?"trackpad":"wheel"),n="trackpad"===this.scrollType?t.deltaY*Ee.TrackZoom:Math.sign(t.deltaY)*ke.Zoom):(this.scrollType="wheel",n=t.deltaY*ke.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(n)>40&&(n=40*Math.sign(n)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(n):this.zoomWithVelocity(n)}zoomWithVelocity(t){this.cameraService.setCameraZoom(t),requestAnimationFrame(()=>{t*=.85,Math.abs(t)>1&&this.zoomWithVelocity(t)})}handleContextMenu(t){t.preventDefault();const{offsetX:n,offsetY:i}=t,a=this.pickAtCanvasPosition(n,i),r=this.getNodeFromHit(a);this.store.dispatch(new b.fZ(r,a))}handlePanEnd(t){const n=this.store.selectSnapshot(ae.x.getCameraMotion);if(this.pinchTicks>0||n.panX===t.velocityX&&n.panY===t.velocityY)return;const i=this.store.selectSnapshot(ae.x.getPanMode);t.srcEvent.shiftKey||"pan"===i?(n.panX=t.velocityX*Ee.Pan,n.panY=t.velocityY*Ee.Pan):(n.rotateX=t.velocityX*Ee.Rotate,n.rotateY=t.velocityY*Ee.Rotate),n.applyFriction=!0,this.store.dispatch(new X.P4(n))}handlePinchEnd(t){const n=this.store.selectSnapshot(ae.x.getCameraMotion);if("pan"===this.pinchMode)n.panX=t.velocityX*Ee.Pan,n.panY=t.velocityY*Ee.Pan;else{const i=t.velocity>0?1:-1;n.zoom=Math.sqrt(t.velocityX*t.velocityX+t.velocityY*t.velocityY)*-i*Ee.Zoom}n.applyFriction=!0,this.store.dispatch(new X.P4(n)),this.pinchTicks=10}handleTap(t){const{offsetX:n,offsetY:i}=this.getOffset(t),a=this.pickAtCanvasPosition(n,i),r=this.getNodeFromHit(a);this.store.dispatch(new b.zE(r,t,a))}handleDoubleTap(t){const{offsetX:n,offsetY:i}=this.getOffset(t),a=this.pickAtCanvasPosition(n,i),r=this.getNodeFromHit(a);r&&this.store.dispatch(new b.W6(r.id))}handlePress(t){const{offsetX:n,offsetY:i}=this.getOffset(t),a=this.pickAtCanvasPosition(n,i),r=this.getNodeFromHit(a);r&&this.store.dispatch(new b.W6(r.id))}handlePan(t){if(this.pinchTicks>0)return;const n=this.store.selectSnapshot(ae.x.getPanMode),{velocityX:i,velocityY:a}=t;t.srcEvent.shiftKey||"pan"===n?this.cameraService.setCameraPan(i*Ee.Pan,a*Ee.Pan):this.cameraService.setCameraRotation(i*Ee.Rotate,a*Ee.Rotate)}handleMouseInputEngineTick(t){const n=this.cameraService.tickCameraRotation(),i=this.cameraService.tickCameraPan(),a=this.cameraService.tickCameraZoom(),r=Math.min(15,(window.performance.now()-this.deltaTime)/Xt);if((n.vx||n.vy)&&this.cameraService.rotateCameraStatic(0!==n.vx?r*n.vx*ke.Rotate:0,0!==n.vy?r*n.vy*ke.Rotate:0),i.x||i.y){const _=this.cameraService.getLookDistance(),I=Math.max(_/80,.01);this.cameraService.panCameraStatic(r*i.x*I*ke.Pan,r*i.y*I*ke.Pan,r*i.z*I*ke.Pan)}0!==a&&this.cameraService.setRelativeZoom(r*a*ke.Zoom)}handleCameraTick(t){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const n=this.store.selectSnapshot(ae.x.getCameraMotion);this.cameraService.setCameraPan(n.panX,n.panY),this.cameraService.setCameraRotation(n.rotateX,n.rotateY),this.cameraService.setCameraZoom(n.zoom),this.cameraService.tickCamera(t)}applyCheckedPatches(t){this.engineService.fireEvent(y.X.SceneObjectsSelected,{selectedObjectsUpdate:t});const n=this.store.selectSnapshot(o.S.getViewGraph),i=this.store.selectSnapshot(o.S.getXrayModeEnabled);Object.entries(t).forEach(([a,r])=>{i?this.paintService.paint(n,a,!0===r?ne.NR:ne.EC):this.paintService.highlight(n,a,r)})}applyShownPatches(t,n){const i=Object.keys(t),a=this.sceneService.getObjectsById(i),r=i.reduce((oe,he)=>(this.sceneService.isLeaf(a[he])&&(oe[he]=t[he]),oe),{});this.engineService.fireEvent(y.X.SceneObjectsShown,{enabledObjectsUpdate:r});const _=this.store.selectSnapshot(T.z.getNodes),I=Object.values(_).reduce((oe,he)=>(oe[he.objectId]=he.shown,oe),{});n&&this.sceneService.setNodesVisible(I);const te=this.convertToLeafStateMap("shown",I);this.store.dispatch(new b.A0(te,_))}applyPaintPatches(t){Object.entries(t).forEach(([n,i])=>{this.paintService.colorObject(n,(0,Te.Sf)(i))})}applyPickablePatches(t){const n=this.store.selectSnapshot(T.z.getNodes),i=Object.values(n).reduce((a,r)=>(a[r.objectId]=r.pickable,a),{});this.sceneService.setNodesProperty(i,"pickable"),this.store.dispatch(new b.$V(this.convertToLeafStateMap("pickable",i),n))}applyAvailablePatches(t){const n=this.store.selectSnapshot(T.z.getNodes),i=this.convertToLeafStateMap("available",t);this.store.dispatch(new b.Rc(i,n))}applyVariantPatches(t,n,i,a){if(n&&this.store.dispatch(new fe._n(t,a)),i){const{anatomyObjects:r}=this.sceneService.getAnatomySceneGraph();Object.entries(t).forEach(([_,I])=>{this.sceneService.setObjectVariant(r,_,I)})}}getFriction(t){if(0===t)return 0;const n=(window.performance.now()-this.deltaTime)/Xt;let a=t*Math.max(0,Ee.Friction+.1*(1-n));return Math.abs(a)<Ee.FrictionThreshold&&(a=0),a}applyFriction(){const t=this.store.selectSnapshot(ae.x.getCameraMotion);!0===t.applyFriction&&(t.rotateX=this.getFriction(t.rotateX),t.rotateY=this.getFriction(t.rotateY),t.panX=this.getFriction(t.panX),t.panY=this.getFriction(t.panY),t.zoom=this.getFriction(t.zoom),0===t.rotateX&&0===t.rotateY&&0===t.panX&&0===t.panY&&0===t.zoom&&(t.applyFriction=!1),this.store.dispatch(new X.P4(t)))}flyToObject(t,n){return this.cameraService.flyToObject(t,n)}flyToCamera(t,n){return this.cameraService.flyToCamera(t,n)}jumpToObject(t){return this.cameraService.jumpToObject(t)}jumpToCamera(t){return this.cameraService.jumpToCamera(t)}getNodeFromHit(t){let n;if(t.objectId){const i=this.store.selectSnapshot(o.S.getViewGraph);n=this.sceneService.getViewNode(i,t.objectId)}return n}pickAtCanvasPosition(t,n,i=!0){const a=this.enginePosition?.scale??1;if(1!==a){const r=1/a,_=Be.vec3Pool.get();[t,n]=ie.scale(_,[t,n,0],r),Be.vec3Pool.release(_)}return this.engineRendererService.pick(t,n,i)}getOffset(t){let n=0,i=0;t.center?(n=t.center.x,i=t.center.y):(n=t.clientX,i=t.clientY);const r=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:n-r.left,offsetY:i-r.top}}isTransparentBackground(t){return!!t&&(0,ge.ty)(this.background.getValue())}isBackgroundCheckered(t){return H.c.application!==be.c.Viewer&&this.isTransparentBackground(t)}playChapterFromStart(){this.store.selectSnapshot(K.N.getSelectedChapterReadyState).animation&&(this.store.dispatch(new b.A6),this.store.dispatch(new b.dE(!0)))}initVideo(){this.mediaService.getVideoEvents().pipe((0,c.Q)(this.ngUnsubscribe)).subscribe(t=>{const{id:n,event:i}=t;"play"===i&&this.store.dispatch(new L.F(n)),this.store.selectSnapshot(ee.Y.getCurrentVideo)===n&&("pause"===i||"ended"===i)&&this.store.dispatch(new L.F(null))})}}(it=pe).\u0275fac=function(t){return new(t||it)(e.rXU(p.En),e.rXU(ht.nX),e.rXU(f.O),e.rXU(q.j),e.rXU(e.gRc),e.rXU(j.y),e.rXU(xe.S),e.rXU(at.w),e.rXU(Qe.u),e.rXU(J.s),e.rXU(e.sFG),e.rXU(ot.n$),e.rXU(p.il),e.rXU(gt.S),e.rXU(pt.c),e.rXU(st.z),e.rXU(_t.h),e.rXU(zt.Ai))},it.\u0275cmp=e.VBU({type:it,selectors:[["app-engine"]],viewQuery:function(t,n){if(1&t&&e.GBs(_i,7),2&t){let i;e.mGM(i=e.lsd())&&(n.engineElement=i.first)}},hostBindings:function(t,n){1&t&&e.bIt("wheel",function(a){return n.wheel(a)})("contextmenu",function(a){return n.onContextMenu(a)})("mouseout",function(a){return n.onMouseOut(a)})},inputs:{inputEnabled:[e.Mj6.SignalBased,"inputEnabled"],contextMenuEnable:[e.Mj6.SignalBased,"contextMenuEnable"]},decls:16,vars:24,consts:[["engine",""],["id","container","data-test","engine","role","complementary",1,"engine",3,"ngClass"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"],["cdkDrag","",1,"engine__stats",3,"cdkDragBoundary"],[3,"theme","showAdvancedTools"]],template:function(t,n){if(1&t&&(e.j41(0,"div",1,0),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,gi,1,0,"div",2),e.nI1(5,"async"),e.nrm(6,"app-labels"),e.DNE(7,ui,1,2,"app-engine-contextmenu",3)(8,mi,1,0,"div",4)(9,bi,1,0,"app-engine-progress",5),e.nI1(10,"async"),e.nrm(11,"app-engine-scroll")(12,"app-engine-fade"),e.DNE(13,fi,3,5,"div",6),e.nI1(14,"async"),e.DNE(15,vi,1,0,"app-engine-camera-position"),e.k0s()),2&t){const i=e.sdS(1);e.Y8G("ngClass",e.eq3(22,hi,"screen"===e.bMT(2,12,n.overlayType$))),e.BMQ("data-progress",n.progress)("data-chapter-ready",n.chapterReady)("data-camera-animating",n.cameraAnimating)("data-story-id",e.bMT(3,14,n.storyId$))("data-engine-version",n.VERSION),e.R7$(4),e.vxM(4,e.bMT(5,16,n.watermarkEnabled$)?4:-1),e.R7$(3),e.vxM(7,n.contextMenuNode?7:-1),e.R7$(),e.vxM(8,n.inputEnabled()?-1:8),e.R7$(),e.vxM(9,e.bMT(10,18,n.showProgressBar$)?9:-1),e.R7$(4),e.vxM(13,e.bMT(14,20,n.statsEnabled$)?13:-1),e.R7$(2),e.vxM(15,n.showDebug&&i?15:-1)}},dependencies:[_e.YU,Yt.T1,ve,Jn.J,ti,ii,li,di,pi,_e.Jj],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--hidden[_ngcontent-%COMP%]{display:none!important}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.svg) 7 20,pointer}.engine--cursor-fade[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-fade.svg) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.svg) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.svg) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea),linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea)}.engine--scaled[_ngcontent-%COMP%]{outline:var(--engine-border-width, 1px) solid #d7e0ea}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}.engine__stats[_ngcontent-%COMP%]{position:absolute;width:-moz-fit-content;width:fit-content;max-height:calc(100vh - 32px);overflow:auto;top:16px;right:16px;z-index:2}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0}),ue([(0,p.l6)(o.S.getEnginePosition),me("design:type",g.c)],pe.prototype,"enginePosition$",void 0),ue([(0,p.l6)(o.S.getHoveredNode),me("design:type",g.c)],pe.prototype,"hoveredNode$",void 0),ue([(0,p.l6)(T.z.getPatches),me("design:type",g.c)],pe.prototype,"nodeStatePatches$",void 0),ue([(0,p.l6)(o.S.getActiveTool),me("design:type",g.c)],pe.prototype,"activeTool$",void 0),ue([(0,p.l6)(o.S.getDisplay),me("design:type",g.c)],pe.prototype,"engineDisplay$",void 0),ue([(0,p.l6)(o.S.getVisible),me("design:type",g.c)],pe.prototype,"engineVisible$",void 0),ue([(0,p.l6)(o.S.getShowProgressBar),me("design:type",g.c)],pe.prototype,"showProgressBar$",void 0),ue([(0,p.l6)(o.S.getContextMenu),me("design:type",g.c)],pe.prototype,"contextMenu$",void 0),ue([(0,p.l6)(o.S.getAutoplay),me("design:type",g.c)],pe.prototype,"autoplay$",void 0),ue([(0,p.l6)(B.t.getStoryId),me("design:type",g.c)],pe.prototype,"storyId$",void 0),ue([(0,p.l6)(K.N.getSelectedChapter),me("design:type",g.c)],pe.prototype,"selectedChapter$",void 0),ue([(0,p.l6)(K.N.getSelectedChapterId),me("design:type",g.c)],pe.prototype,"selectedChapterId$",void 0),ue([(0,p.l6)(K.N.getSelectedChapterReadyState),me("design:type",g.c)],pe.prototype,"readyState$",void 0),ue([(0,p.l6)(K.N.getSelectedChapterClippingPlanes),me("design:type",g.c)],pe.prototype,"clippingPlanes$",void 0),ue([(0,p.l6)(K.N.getSelectedChapterBackground),me("design:type",g.c)],pe.prototype,"background$",void 0),ue([(0,p.l6)(o.S.getWatermarkEnabled),me("design:type",g.c)],pe.prototype,"watermarkEnabled$",void 0),ue([(0,p.l6)(o.S.getStatsEnabled),me("design:type",g.c)],pe.prototype,"statsEnabled$",void 0),ue([(0,p.l6)(o.S.getShowAdvancedStatsTools),me("design:type",g.c)],pe.prototype,"showAdvancedTools$",void 0),ue([(0,p.l6)(De.U.getXROverlayType),me("design:type",g.c)],pe.prototype,"overlayType$",void 0),ue([(0,p.l6)(Re.U.getPrefersReducedMotion),me("design:type",g.c)],pe.prototype,"prefersReducedMotion$",void 0)},93815:(re,Z,s)=>{"use strict";s.d(Z,{c:()=>g});var e=s(57535),p=s(65763),b=s(35939),o=s(12921),C=s(59429),V=s(79805),G=s(49204),A=s(54438);let g=(()=>{var c;class E{constructor(h,u){this.engineService=h,this.store=u}createParticleSystem(h){const u={...(0,e.Vs)(),id:C.u.idWithPrefix("system")};this.store.dispatch(new b.u.NewParticleSystem(u,h))}duplicateParticleSystem(h,u){this.store.dispatch(new b.u.DuplicateParticleSystem(h,u))}resetParticleSystem(h){const u={...(0,e.Vs)(),id:h};this.store.dispatch(new b.u.UpdateParticleSystem(h,u))}toggleParticleSystemVisible(h,u){const D=this.isParticleSystemVisible(h,u);this.store.dispatch(new b.u.SetParticleSystemVisible(h,!D,u))}isParticleSystemVisible(h,u){return this.store.selectSnapshot(o.B.getVisibleParticleSystemsForChapter(u)).includes(h)}addChapterParticleSystem(h,u){this.store.dispatch(new b.u.AssignParticle(h,u))}removeChapterParticleSystem(h,u){this.store.dispatch(new b.u.UnassignParticle(h,u))}removeAllChapterParticleSystem(h){this.store.selectSnapshot(o.B.particleSystemsForChapter(h)).forEach(D=>{this.removeChapterParticleSystem(D.id,h)})}createNewConstraint(h,u){const{id:D,constraints:R}=h;this.store.dispatch(new b.u.UpdateParticleSystem(D,{...h,constraints:[...R,{...(0,e.hG)(u),id:C.u.idWithPrefix("constraint")}]}))}duplicateConstraint(h,u){h.constraints=[...h.constraints,{...(0,e.qg)(u.type,u),id:C.u.idWithPrefix("constraint")}],this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleConstraint(h.constraints.length-1))}resetConstraint(h,u){const D=h.constraints[u],{id:R,type:$}=D;h.constraints[u]={...(0,e.hG)($),id:R},this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}resetConstraints(h){h.constraints=h.constraints.map(u=>{const{id:D,type:R}=u;return{...(0,e.hG)(R),id:D}}),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}removeConstraint(h,u){h.constraints.splice(u,1),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleConstraint(-1))}createNewCreator(h,u){const{id:D,creators:R}=h;this.store.dispatch(new b.u.UpdateParticleSystem(D,{...h,creators:[...R,{...(0,e.U8)(u),id:C.u.idWithPrefix("creator")}]}))}duplicateCreator(h,u){h.creators=[...h.creators,{...(0,e.xM)(u.type,u),id:C.u.idWithPrefix("creator")}],this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleCreator(h.creators.length-1))}resetCreator(h,u){const D=h.creators[u],{id:R,type:$}=D;h.creators[u]={...(0,e.U8)($),id:R},this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}resetCreators(h){h.creators=h.creators.map(u=>{const{id:D,type:R}=u;return{...(0,e.U8)(R),id:D}}),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}removeCreator(h,u){h.creators.splice(u,1),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleConstraint(-1))}createNewUpdater(h,u){const{id:D,updaters:R}=h;this.store.dispatch(new b.u.UpdateParticleSystem(D,{...h,updaters:[...R,{...(0,e.jQ)(u),id:C.u.idWithPrefix("updater")}]}))}duplicateUpdater(h,u){h.updaters=[...h.updaters,{...(0,e.MH)(u.type,u),id:C.u.idWithPrefix("updater")}],this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleUpdater(h.updaters.length-1))}resetUpdater(h,u){const D=h.updaters[u],{id:R,type:$}=D;h.updaters[u]={...(0,e.jQ)($),id:R},this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}resetUpdaters(h){h.updaters=h.updaters.map(u=>{const{id:D,type:R}=u;return{...(0,e.jQ)(R),id:D}}),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h))}removeUpdater(h,u){h.updaters.splice(u,1),this.store.dispatch(new b.u.UpdateParticleSystem(h.id,h)),this.store.dispatch(new b.u.SelectParticleConstraint(-1))}setEngineParticles(h,u,D){const R=this.engineService.engine?.story,$=R?.chapters?.find(d=>d.id===u);(0,G.isNil)($)||(R.particleSystemDefs.forEach((d,k)=>{(0,G.isNil)(h[k])&&R.particleSystemDefs.delete(k)}),Object.entries(h).forEach(([d,k])=>{const W=R.particleSystemDefs.get(d);((0,G.isNil)(W)||!(0,G.isEqual)(W,k))&&R.particleSystemDefs.set(d,k)}),$.particleSystemIds.forEach(d=>{D.includes(d)||$.particleSystemIds.delete(d)}),D.forEach(d=>{$.particleSystemIds.has(d)||$.particleSystemIds.add(d)}))}}return(c=E).\u0275fac=function(h){return new(h||c)(A.KVO(V.y),A.KVO(p.il))},c.\u0275prov=A.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),E})()},57743:(re,Z,s)=>{"use strict";s.d(Z,{w:()=>E});var e=s(54438),p=s(89417),b=s(49204),C=s(85052),V=s(37925),G=s(49206),x=s(60177),A=s(26779);function g(w,h){if(1&w&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&w){const u=h.$implicit;e.Y8G("value",u.value),e.R7$(),e.SpI(" ",u.label.title," ")}}function c(w,h){if(1&w&&(e.j41(0,"select",6)(1,"option",7),e.EFF(2,"Select"),e.k0s(),e.DNE(3,g,2,2,"option",8),e.k0s()),2&w){const u=e.XpG();e.R7$(3),e.Y8G("ngForOf",u.options)}}let E=(()=>{var w;class h extends G.n{get options(){return this._options}set options(D){const R=(0,b.clone)(D);this._options=R.sort(($,d)=>$.label.title.localeCompare(d.label.title)),this.changeRef.markForCheck()}constructor(D,R){super(),this.formBuilder=D,this.changeRef=R,this.outline=!0,this.valueChange=new e.bkB,this.ngUnsubscribe=new C.B,this.form=this.formBuilder.group({value:[""]}),this.valueControl=this.form.get("value")}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,V.Q)(this.ngUnsubscribe)).subscribe(({value:D})=>{this.writeValue(D),this.valueChange.next(D)})}setDisabledState(D){super.setDisabledState(D),D?this.form.disable():this.form.enable(),this.changeRef.markForCheck()}setFormValues(D){this.valueControl.setValue(D),this.changeRef.markForCheck()}getSelectedOption(){const D=this.valueControl.value;return this.options.find(R=>R.value===D)}}return(w=h).\u0275fac=function(D){return new(D||w)(e.rXU(p.ze),e.rXU(e.gRc))},w.\u0275cmp=e.VBU({type:w,selectors:[["app-quiz-label-anatomy-select"]],inputs:{options:"options",outline:"outline"},outputs:{valueChange:"valueChange"},features:[e.Jv_([{provide:p.kq,useExisting:(0,e.Rfq)(()=>w),multi:!0}]),e.Vt3],decls:7,vars:5,consts:[[1,"label",3,"formGroup"],[1,"label__select-label","flex","text-xs"],[1,"flex","justify-between","p-2","flex-auto"],[1,"mr-2"],["icon","caret-down","size","lg"],["class","input label__select","placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",4,"ngIf"],["placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",1,"input","label__select"],["value","","data-test","questionAnswerOption"],["class","label__option","data-test","questionAnswerOption",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswerOption",1,"label__option",3,"value"]],template:function(D,R){if(1&D&&(e.j41(0,"div",0)(1,"label",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.nrm(5,"app-icon",4),e.k0s(),e.DNE(6,c,4,1,"select",5),e.k0s()()),2&D){let $;e.AVh("label--empty",""===R.valueControl.value),e.Y8G("formGroup",R.form),e.R7$(4),e.JRh((null==($=R.getSelectedOption())||null==$.label?null:$.label.title)||"Select"),e.R7$(2),e.Y8G("ngIf",!R.disabled)}},dependencies:[x.Sq,x.bT,A.R,p.xH,p.y7,p.wz,p.BC,p.cb,p.j4,p.JD],styles:[".label[_ngcontent-%COMP%]{overflow:hidden}.label__select-label[_ngcontent-%COMP%]{color:#101823;position:relative}.label__select[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;opacity:.01}.label--empty[_ngcontent-%COMP%]   .label__select-label[_ngcontent-%COMP%]{color:#96a8c0}"],changeDetection:0}),h})()},24484:(re,Z,s)=>{"use strict";s(43753)},3909:(re,Z,s)=>{"use strict";s.d(Z,{M:()=>c});var e=s(65763),p=s(47632),b=s(47610),o=s(61295),C=s(91003),V=s(33013),G=s(93915),x=s(66056),A=s(75069),g=s(54438);let c=(()=>{var E;class w{constructor(u,D){this.store=u,this.positionsService=D}resetScene(){this.store.dispatch(new b.lQ),this.store.dispatch(new o.Yn),this.store.dispatch(new A.a.Reset),this.store.dispatch(new p.sN(null)),this.store.dispatch(new V.FN),this.store.dispatch(new b.u3("")),this.store.dispatch(new G.$y),this.store.dispatch(new b.w8),this.store.dispatch(new b.B9),this.store.dispatch(new x.jj),this.positionsService.clearAllClipboards()}}return(E=w).\u0275fac=function(u){return new(u||E)(g.KVO(e.il),g.KVO(C.c))},E.\u0275prov=g.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}),w})()},4763:(re,Z,s)=>{"use strict";s.d(Z,{n:()=>x});var e=s(54438),p=s(72026),b=s(60177),o=s(26779);const C=(A,g,c,E)=>({"badge--blue":A,"badge--green":g,"badge--inline":c,"badge--block":E});function V(A,g){if(1&A&&(e.j41(0,"div",1),e.nrm(1,"app-icon",3),e.k0s()),2&A){const c=e.XpG();e.R7$(),e.Y8G("icon",c.icon())}}function G(A,g){if(1&A&&(e.j41(0,"div",2),e.EFF(1),e.k0s()),2&A){const c=e.XpG();e.R7$(),e.JRh(c.label())}}let x=(()=>{var A;class g{constructor(){this.display=(0,e.hFB)("inline"),this.theme=(0,e.hFB)("none"),this.icon=(0,e.hFB)(""),this.label=(0,e.hFB)("")}}return(A=g).\u0275fac=function(E){return new(E||A)},A.\u0275cmp=e.VBU({type:A,selectors:[["app-badge"]],inputs:{display:[e.Mj6.SignalBased,"display"],theme:[e.Mj6.SignalBased,"theme"],icon:[e.Mj6.SignalBased,"icon"],label:[e.Mj6.SignalBased,"label"]},standalone:!0,features:[e.aNF],decls:3,vars:8,consts:[[1,"badge","flex","items-center",3,"ngClass"],[1,"badge__check"],[1,"badge__label"],[3,"icon"]],template:function(E,w){1&E&&(e.j41(0,"div",0),e.DNE(1,V,2,1,"div",1)(2,G,2,1,"div",2),e.k0s()),2&E&&(e.Y8G("ngClass",e.ziG(3,C,"blue"===w.theme(),"green"===w.theme(),"inline"===w.display(),"block"===w.display())),e.R7$(),e.vxM(1,w.icon()?1:-1),e.R7$(),e.vxM(2,w.label()?2:-1))},dependencies:[b.MD,b.YU,p.o,o.R],styles:[".badge{gap:8px;padding:4px 8px 4px 4px;border-radius:12px}.badge__check{display:flex;align-items:center;justify-content:center;border-radius:100%;width:14px;height:14px;font-size:.625rem;line-height:.75rem}.badge__label{font-size:.75rem;line-height:1rem;font-weight:500}.badge--inline{display:inline-flex}.badge--block{display:flex}.badge--blue{background-color:#a6dfff66;color:#1c5ab9}.badge--blue .badge__check{background-color:#2d72dc;color:#fff}.badge--green{background-color:#c1efdf66;color:#095922}.badge--green .badge__check{background-color:#138032;color:#fff}\n"],encapsulation:2,changeDetection:0}),g})()},48948:(re,Z,s)=>{"use strict";s.d(Z,{p:()=>o});var e=s(54438),p=s(60177);const b=(C,V)=>({"pillbox-divider--horizontal":C,"pillbox-divider--vertical":V});let o=(()=>{var C;class V{constructor(){this.orientation="horizontal"}ngOnInit(){}get justifySelf(){return"vertical"===this.orientation?"stretch":""}get alignSelf(){return"horizontal"===this.orientation?"stretch":""}}return(C=V).\u0275fac=function(x){return new(x||C)},C.\u0275cmp=e.VBU({type:C,selectors:[["app-pillbox-divider"]],hostVars:4,hostBindings:function(x,A){2&x&&e.xc7("justify-self",A.justifySelf)("align-self",A.alignSelf)},inputs:{orientation:"orientation"},decls:1,vars:4,consts:[[1,"pillbox-divider",3,"ngClass"]],template:function(x,A){1&x&&e.nrm(0,"div",0),2&x&&e.Y8G("ngClass",e.l_i(1,b,"horizontal"===A.orientation,"vertical"===A.orientation))},dependencies:[p.YU],styles:["[_nghost-%COMP%]{display:flex}.pillbox-divider[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.pillbox-divider--horizontal[_ngcontent-%COMP%]{height:100%;border-right:1px solid #d7e0ea}.pillbox-divider--vertical[_ngcontent-%COMP%]{width:40px;border-bottom:1px solid #d7e0ea}"],changeDetection:0}),V})()},82487:(re,Z,s)=>{"use strict";s.d(Z,{O:()=>g});var e=s(54438),p=s(60177),b=s(65985),o=s(14823),C=s(26779),V=s(48948);const G=["*"],x=(c,E)=>({"pillbox--vertical":c,"pillbox--horizontal":E});function A(c,E){if(1&c){const w=e.RV6();e.qex(0),e.nrm(1,"app-pillbox-divider"),e.j41(2,"button",2),e.bIt("click",function(){e.eBV(w);const u=e.XpG();return e.Njj(u.handleExitClick())}),e.nrm(3,"app-icon",3),e.k0s(),e.bVm()}if(2&c){const w=e.XpG();e.R7$(2),e.Y8G("matTooltip","Close "+w.name),e.BMQ("aria-label","Close "+w.name)}}let g=(()=>{var c;class E{constructor(){this.canExit=!1,this.padding="normal",this.orientation="horizontal",this.name="",this.exit=new e.bkB}ngOnInit(){}handleExitClick(){this.exit.emit()}}return(c=E).\u0275fac=function(h){return new(h||c)},c.\u0275cmp=e.VBU({type:c,selectors:[["app-pillbox"]],inputs:{canExit:"canExit",padding:"padding",orientation:"orientation",name:"name"},outputs:{exit:"exit"},ngContentSelectors:G,decls:3,vars:5,consts:[[1,"pillbox",3,"ngClass"],[4,"ngIf"],["data-test","closePillboxButton","app-view-button","",3,"click","matTooltip"],["icon","times"]],template:function(h,u){1&h&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.DNE(2,A,4,2,"ng-container",1),e.k0s()),2&h&&(e.Y8G("ngClass",e.l_i(2,x,"vertical"===u.orientation,"horizontal"===u.orientation)),e.R7$(2),e.Y8G("ngIf",u.canExit))},dependencies:[p.YU,p.bT,b.ri,o.oV,C.R,V.p],styles:[":host{display:inline-block}.pillbox{box-shadow:0 1px 4px 1px #0500380a;border:1px solid #d7e0ea;pointer-events:all;background:#fffffff2;border-radius:4px;display:flex;overflow:hidden;transition:all .1s ease-out}.pillbox:empty{border:0;box-shadow:none}.pillbox:hover{background:#fff}.pillbox--vertical{flex-direction:column;align-items:center}.pillbox--horizontal{flex-direction:row}\n"],encapsulation:2,changeDetection:0}),E})()},77428:(re,Z,s)=>{"use strict";s.d(Z,{X:()=>A});var e=s(38645),p=s(85052),b=s(37925),o=s(54438),C=s(60177);const V=(g,c,E)=>({"progress--small":g,"progress--medium":c,"progress--large":E}),G=g=>({"progress__bar--complete":g}),x=g=>({width:g});let A=(()=>{var g;class c{get value(){return this._value}set value(w){this._value=w,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}constructor(w,h){this.router=w,this.changeDetector=h,this.total=100,this._value=0,this.size="small",this.disableComplete=!1,this.percentWidth=0,this.ngUnsubscribe=new p.B}ngOnInit(){this.router.events.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(w=>{w instanceof e.Z&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(g=c).\u0275fac=function(w){return new(w||g)(o.rXU(e.Ix),o.rXU(o.gRc))},g.\u0275cmp=o.VBU({type:g,selectors:[["app-progress"]],inputs:{total:"total",value:"value",size:"size",disableComplete:"disableComplete"},decls:2,vars:12,consts:[[1,"progress",3,"ngClass"],["role","progressbar","aria-label","content loading progress","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(w,h){1&w&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.k0s()),2&w&&(o.Y8G("ngClass",o.sMw(4,V,"small"===h.size,"medium"===h.size,"large"===h.size)),o.R7$(),o.Y8G("ngClass",o.eq3(8,G,!h.disableComplete&&100===h.percentWidth))("ngStyle",o.eq3(10,x,h.percentWidth+"%")),o.BMQ("aria-valuenow",h.percentWidth))},dependencies:[C.YU,C.B3],styles:["@keyframes _ngcontent-%COMP%_progressSuccess{0%{width:100%!important;background:#38de38}50%{opacity:1;background:#38de38}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;width:100%}.progress__bar[_ngcontent-%COMP%]{background:#de3535;height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressSuccess 2s linear forwards}.progress--small[_ngcontent-%COMP%]{height:4px}.progress--medium[_ngcontent-%COMP%]{height:8px}.progress--large[_ngcontent-%COMP%]{height:12px}"],changeDetection:0}),c})()},15185:(re,Z,s)=>{"use strict";s.d(Z,{J:()=>V});var e=s(54438),b=(s(93455),s(49204));const C=["thumbnailView"];let V=(()=>{var G;class x{get thumbnail(){return this._thumbnail}set thumbnail(g){(0,b.isEqual)(this._thumbnail,g)||(this._thumbnail=g,null!=g?this.setImageStyle():this.clearImageStyle())}constructor(g){this.renderer=g}setImageStyle(){let g=this.thumbnail.snapshot||this.thumbnail.urls.small;const c=(new Date).valueOf();g.startsWith("blob:")||(g=`${g}?cb=${c}&uncached=true`);const E=new Image;E.src=g,E.onload=()=>{this.renderer.setStyle(this.thumbnailView.nativeElement,"background-size","cover"),this.renderer.setStyle(this.thumbnailView.nativeElement,"background-image",`url(${g})`)}}clearImageStyle(){this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-size"),this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-image")}}return(G=x).\u0275fac=function(g){return new(g||G)(e.rXU(e.sFG))},G.\u0275cmp=e.VBU({type:G,selectors:[["app-thumbnail-view"]],viewQuery:function(g,c){if(1&g&&e.GBs(C,7,e.aKT),2&g){let E;e.mGM(E=e.lsd())&&(c.thumbnailView=E.first)}},inputs:{thumbnail:"thumbnail"},decls:2,vars:0,consts:[["thumbnailView",""],[1,"thumbnail-view"]],template:function(g,c){1&g&&e.nrm(0,"div",1,0)},styles:[".thumbnail-view[_ngcontent-%COMP%]{background-color:#283853;background-image:url(/assets/images/logo-dark-transparent.svg);background-position:center center;background-repeat:no-repeat;background-size:25% 25%;border-radius:4px;height:100%;width:100%}.theme-light[_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%]{background-color:#eaeff5}"],changeDetection:0}),x})()},12637:(re,Z,s)=>{"use strict";s.d(Z,{s:()=>o});var e=s(65763),p=s(93132),b=s(54438);let o=(()=>{var C;class V{onEnter(){this.store.dispatch(new p.B.SetPreventFadeoutEvent("mouseenter",!0))}onLeave(){this.store.dispatch(new p.B.SetPreventFadeoutEvent("mouseenter",!1))}onFocusin(){this.store.dispatch(new p.B.SetPreventFadeoutEvent("focusin",!0))}onFocusout(){this.store.dispatch(new p.B.SetPreventFadeoutEvent("focusin",!1))}constructor(x){this.store=x}}return(C=V).\u0275fac=function(x){return new(x||C)(b.rXU(e.il))},C.\u0275dir=b.FsC({type:C,selectors:[["","appPreventFadeout",""]],hostBindings:function(x,A){1&x&&b.bIt("mouseenter",function(){return A.onEnter()})("mouseleave",function(){return A.onLeave()})("focusin",function(){return A.onFocusin()})("focusout",function(){return A.onFocusout()})}}),V})()},42887:(re,Z,s)=>{"use strict";s.d(Z,{x:()=>b});var e=s(60177),p=s(54438);let b=(()=>{var o;class C{}return(o=C).\u0275fac=function(G){return new(G||o)},o.\u0275mod=p.$C({type:o}),o.\u0275inj=p.G2t({imports:[e.MD]}),C})()},32258:(re,Z,s)=>{"use strict";s.d(Z,{W:()=>V});var e=s(85052),p=s(76718),b=s(35426),o=s(36110),C=s(37925);class V{constructor(x,A,g){this.overlay=x,this.content=A,this.data=g,this.afterClosed=new e.B,this.afterClosed$=this.afterClosed.asObservable(),x.backdropClick().subscribe(()=>this._close("backdropClick",g)),this.entered$=(0,p.h)((0,b.R)(x.overlayElement,"mouseenter"),(0,b.R)(x.overlayElement,"mouseleave")).pipe((0,o.T)(c=>"mouseenter"===c.type),(0,C.Q)(this.afterClosed$))}close(x){this._close("close",x)}_close(x,A){this.overlay.dispose(),this.afterClosed.next({type:x,data:A}),this.afterClosed.complete()}}},5025:(re,Z,s)=>{"use strict";s.d(Z,{k:()=>E,O:()=>h});var e=s(47987),p=s(32258),b=s(76939),o=s(54438),C=s(60177);function V(u,D){if(1&u&&o.nrm(0,"div",4),2&u){const R=o.XpG();o.Y8G("innerHTML",R.content,o.npT)}}function G(u,D){1&u&&o.eu8(0)}function x(u,D){if(1&u&&(o.qex(0),o.DNE(1,G,1,0,"ng-container",5),o.bVm()),2&u){const R=o.XpG();o.R7$(),o.Y8G("ngTemplateOutlet",R.content)("ngTemplateOutletContext",R.context)}}function A(u,D){1&u&&o.eu8(0)}function g(u,D){if(1&u&&(o.qex(0),o.DNE(1,A,1,0,"ng-container",6),o.bVm()),2&u){const R=o.XpG();o.R7$(),o.Y8G("ngComponentOutlet",R.content)}}let c=(()=>{var u;class D{constructor($){this.popupRef=$,this.renderMethod="component"}ngOnInit(){this.content=this.popupRef.content,"string"==typeof this.content?this.renderMethod="text":this.content instanceof o.C4Q&&(this.renderMethod="template",this.context={close:this.popupRef.close.bind(this.popupRef)})}}return(u=D).\u0275fac=function($){return new($||u)(o.rXU(p.W))},u.\u0275cmp=o.VBU({type:u,selectors:[["app-popup"]],decls:5,vars:4,consts:[[1,"popup"],[3,"ngSwitch"],[3,"innerHTML",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"innerHTML"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet"]],template:function($,d){1&$&&(o.j41(0,"div",0),o.qex(1,1),o.DNE(2,V,1,1,"div",2)(3,x,2,2,"ng-container",3)(4,g,2,1,"ng-container",3),o.bVm(),o.k0s()),2&$&&(o.R7$(),o.Y8G("ngSwitch",d.renderMethod),o.R7$(),o.Y8G("ngSwitchCase","text"),o.R7$(),o.Y8G("ngSwitchCase","template"),o.R7$(),o.Y8G("ngSwitchCase","component"))},dependencies:[C.OI,C.T3,C.ux,C.e1],styles:["[_nghost-%COMP%]{width:100%;height:100%}.popup[_ngcontent-%COMP%]{background:#fff;border-radius:4px;padding:24px;overflow-y:auto;width:100%;height:100%;overflow-y:scroll;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}"],changeDetection:0}),D})();var E=function(u){return u.Above="above",u.Below="below",u.Left="left",u.Right="right",u}(E||{});const w={[E.Above]:{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-12},[E.Below]:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:12},[E.Left]:{originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-12},[E.Right]:{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:12}};let h=(()=>{var u;class D{constructor($,d){this.overlay=$,this.injector=d}open($){const{origin:d,content:k,data:W,width:N,height:z,maxHeight:m,maxWidth:P,hasBackdrop:U,positions:j}=$,H=this.overlay.create(this.getOverlayConfig({origin:d,width:N,height:z,maxHeight:m,maxWidth:P,hasBackdrop:U,positions:j})),q=new p.W(H,k,W),se=this.createInjector(q,this.injector);return H.attach(new b.A8(c,null,se)),q}createInjector($,d){const k=new WeakMap([[p.W,$]]);return new b.JP(d,k)}getPositionStrategy($,d){return this.overlay.position().flexibleConnectedTo($).withPositions(this.getPositions(d))}getOverlayConfig({origin:$,width:d,height:k,maxHeight:W,maxWidth:N,hasBackdrop:z,positions:m}){return new e.rR({width:d,height:k,maxHeight:W,maxWidth:N,hasBackdrop:z??!0,backdropClass:"popup-scrim",positionStrategy:this.getOverlayPosition($,m),scrollStrategy:this.overlay.scrollStrategies.reposition()})}getOverlayPosition($,d){return d=d||[E.Above,E.Below,E.Left,E.Right],this.overlay.position().flexibleConnectedTo($).withPositions(this.getPositions(d)).withPush(!0)}getPositions($){return $.map(d=>w[d])}}return(u=D).\u0275fac=function($){return new($||u)(o.KVO(e.hJ),o.KVO(o.zZn))},u.\u0275prov=o.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),D})()},91442:(re,Z,s)=>{"use strict";s.d(Z,{R:()=>o,W:()=>b});var e=s(49204);function b(C,V,G){const x=[...C],A=x.splice(V,1);return x.splice(G,0,...A),x}function o(C,V,G){const x=V.findIndex((g,c)=>!(0,e.isEqual)(C[c],g)),A=V[x];return V.map((g,c)=>(0,e.isEqual)(A,g)&&c!==x?G:g)}},26513:(re,Z,s)=>{"use strict";s.d(Z,{b:()=>d});var e=s(24151),p=s(76872),o=(s(69568),s(54438)),C=s(60177);const V=(k,W,N,z)=>({"label-pin--light":k,"label-pin--dark":W,"label-pin--none":N,"label-pin--selected":z}),G=(k,W)=>({"label-pin__text--white":k,"label-pin__text--black":W});function x(k,W){1&k&&o.nrm(0,"img",9)}function A(k,W){1&k&&o.nrm(0,"img",9)}function g(k,W){1&k&&o.nrm(0,"img",10)}function c(k,W){1&k&&o.nrm(0,"img",11)}function E(k,W){if(1&k&&(o.qex(0),o.DNE(1,x,1,0,"img",6)(2,A,1,0,"img",6)(3,g,1,0,"img",7)(4,c,1,0,"img",8),o.bVm()),2&k){const N=o.XpG();o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Default||N.label.pinType===N.labelPinType.None&&N.showOnNone),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Sequential),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Plus||N.label.pinType===N.labelPinType.PlusMinus&&!N.selected),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Minus||N.label.pinType===N.labelPinType.PlusMinus&&N.selected)}}function w(k,W){1&k&&o.nrm(0,"img",15)}function h(k,W){1&k&&o.nrm(0,"img",15)}function u(k,W){1&k&&o.nrm(0,"img",16)}function D(k,W){1&k&&o.nrm(0,"img",17)}function R(k,W){if(1&k&&o.DNE(0,w,1,0,"img",12)(1,h,1,0,"img",12)(2,u,1,0,"img",13)(3,D,1,0,"img",14),2&k){const N=o.XpG();o.Y8G("ngIf",N.label.pinType===N.labelPinType.Default||N.label.pinType===N.labelPinType.None&&N.showOnNone),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Sequential),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Plus||N.label.pinType===N.labelPinType.PlusMinus&&!N.selected),o.R7$(),o.Y8G("ngIf",N.label.pinType===N.labelPinType.Minus||N.label.pinType===N.labelPinType.PlusMinus&&N.selected)}}function $(k,W){if(1&k&&(o.qex(0),o.j41(1,"div",18),o.EFF(2),o.k0s(),o.bVm()),2&k){const N=o.XpG();o.R7$(),o.Y8G("ngClass",o.l_i(2,G,N.labelTheme===N.labelThemeEnum.StudioNext,N.labelTheme===N.labelThemeEnum.Annotation)),o.R7$(),o.SpI(" ",N.sequence," ")}}let d=(()=>{var k;class W{constructor(){this.labelPinType=e.O,this.labelThemeEnum=p.D,this.labelTheme=p.D.StudioNext,this.selected=!1,this.showOnNone=!1}}return(k=W).\u0275fac=function(z){return new(z||k)},k.\u0275cmp=o.VBU({type:k,selectors:[["app-label-pin"]],inputs:{label:"label",labelTheme:"labelTheme",selected:"selected",sequence:"sequence",showOnNone:"showOnNone"},decls:7,vars:9,consts:[["pin",""],["lightPins",""],[1,"label-pin",3,"ngClass"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"label__glow"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg",1,"label-pin__image"],[1,"label-pin__text",3,"ngClass"]],template:function(z,m){if(1&z&&(o.j41(0,"div",2,0),o.DNE(2,E,5,4,"ng-container",3)(3,R,4,4,"ng-template",null,1,o.C5r)(5,$,3,5,"ng-container",4),o.nrm(6,"div",5),o.k0s()),2&z){const P=o.sdS(4);o.Y8G("ngClass",o.ziG(4,V,m.labelTheme===m.labelThemeEnum.StudioNext,m.labelTheme===m.labelThemeEnum.Annotation,m.label.pinType===m.labelPinType.None&&!m.showOnNone,m.selected)),o.R7$(2),o.Y8G("ngIf",m.labelTheme===m.labelThemeEnum.Annotation)("ngIfElse",P),o.R7$(3),o.Y8G("ngIf",m.label.pinType===m.labelPinType.Sequential)}},dependencies:[C.YU,C.bT],styles:['.label-pin[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;position:relative;transition:background-color .12s;z-index:10}.label-pin__text[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;top:0;z-index:10;width:100%;height:100%;justify-content:center;align-items:center;font-size:10px!important;color:#101823}.label-pin[_ngcontent-%COMP%]:before{content:" ";background-color:transparent;border:2px solid transparent;border-radius:50%;box-sizing:border-box;display:block;position:absolute;top:0;left:0;z-index:-2;height:100%;width:100%;transition:all .15s ease-out}.label-pin--light.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label-pin--light.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#101823}.label-pin--dark.label-pin[_ngcontent-%COMP%]:before{background-color:#000000bf}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#2d72dc}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:after{background-color:#2d72dc}.label-pin--dark.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#fff}.label-pin--none.label-pin[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),W})()},91003:(re,Z,s)=>{"use strict";s.d(Z,{c:()=>N});var e=s(28407),p=s(65763),b=s(49204),C=s(40215),V=s(13976),G=s(65776),x=s(71441),A=s(3266),g=s(1308),c=s(30582),E=s(7431),w=s(1580),h=s(9592),u=s(97415),D=s(62751),R=s(33013),$=s(94495),d=s(82323),k=s(65650),W=s(54438);let N=(()=>{var z;class m{constructor(U,j,H,q,se){this.store=U,this.cameraService=j,this.snapshotService=H,this.imagesService=q,this.contentBlocksService=se,this.startingPositionClipboard=null,this.additionalPositionClipboard=null,this.additionalPositionsClipboard=null}getCamera(){const U=this.cameraService.getCamera(),j=U.look,H=this.cameraService.getCameraRotationCenter();let q;return this.cameraService.compareXYZ(j,H)||(q=H),{location:U,rotationCenter:q}}getChapterStartingPosition(U){return{camera:this.store.selectSnapshot($.N.getChapter(U)).camera,thumbnail:this.store.selectSnapshot(k.K.getRegisteredThumbnails).get(U)}}startingPositionToAdditionalPosition(U){const{camera:j,thumbnail:H}=this.getChapterStartingPosition(U),{location:q,rotationCenter:se,title:O}=j;return{camera:{location:q,rotationCenter:se,action:D.L.FlyTo},thumbnail:H,title:O}}copyStartingPosition(U){let j=!1;const{camera:H,thumbnail:q}=this.getChapterStartingPosition(U);return H&&q&&(this.startingPositionClipboard=(0,b.cloneDeep)({camera:H,thumbnail:q}),j=!0),j}pasteStartingPosition(U=!1){let j=0;if(this.startingPositionClipboard){const{camera:H,thumbnail:q}=this.startingPositionClipboard,se=U?this.store.selectSnapshot($.N.getStoryChapters):[this.store.selectSnapshot($.N.getSelectedChapter)];se.forEach(O=>{this.store.dispatch(new R.tn(O.id,H.location,H.rotationCenter)),this.store.dispatch(new R.pN(O.id,H.title)),this.store.dispatch(new d.cf(O.id,q))}),this.store.dispatch(new E.Ih(H.location)),j=se.length}return this.clearStartingPosition(),j}clearStartingPosition(){this.startingPositionClipboard=null}copyAdditionalPosition(U){this.additionalPositionClipboard=(0,b.cloneDeep)(U)}clearAdditionalPosition(){this.additionalPositionClipboard=null}copyAdditionalPositions(U){this.additionalPositionsClipboard=(0,b.cloneDeep)(U)}pasteAdditionalPositions(U=!1){let j=0;if(this.additionalPositionsClipboard){const H=U?this.store.selectSnapshot($.N.getStoryChapters):[this.store.selectSnapshot($.N.getSelectedChapter)];H.forEach(q=>{let se=this.contentBlocksService.findContentBlockByType(q.contentBlocks,G.m.Positions);se||(se=new x.z,q.contentBlocks.push(se)),se.positions.push(...this.additionalPositionsClipboard),this.store.dispatch(new R.jo(q.id,[...q.contentBlocks],!1))}),j=H.length}return this.clearAdditionalPositions(),j}clearAdditionalPositions(){this.additionalPositionsClipboard=null}clearAllClipboards(){this.clearStartingPosition(),this.clearAdditionalPosition(),this.clearAdditionalPositions()}captureStartingPositionCamera(U){const j=this.getCamera();this.store.dispatch(new R.tn(U,j.location,j.rotationCenter))}captureStartingPositionThumbnail(U){const{background:j,imageType:H,imageQuality:q,dimensions:se,crop:O,includeLabels:K,includeCopyright:J,layers:X}=this.getThumbnailSettings();this.store.dispatch(new d.V9(U,j,H,q,se,O,K,J,X))}captureAdditionalPositionThumbnail(){var U=this;return(0,e.A)(function*(){const{background:j,imageType:H,imageQuality:q,dimensions:se,crop:O,includeLabels:K,includeCopyright:J,layers:X}=U.getThumbnailSettings(),de={...g._,crop:O,imageType:H,imageQuality:q,copyrightEnabled:J},ae=yield(0,C._)(U.snapshotService.takeSnapshot(se.width,se.height,j,X,K,de)),ge=yield(0,C._)(U.imagesService.saveImageBlob(ae));return{small:ge.uris.small,large:ge.uris.large}})()}getThumbnailSettings(){return{background:this.store.selectSnapshot($.N.getSelectedChapterBackground),imageType:h.H.JPEG,imageQuality:92,dimensions:u.I.medium,crop:"square",includeLabels:!1,includeCopyright:!1,layers:[]}}}return(z=m).\u0275fac=function(U){return new(U||z)(W.KVO(p.il),W.KVO(A.j),W.KVO(c.M),W.KVO(w.M),W.KVO(V.V))},z.\u0275prov=W.jDH({token:z,factory:z.\u0275fac,providedIn:"root"}),m})()},73828:(re,Z,s)=>{var e;!function(p,b,o){if(p){for(var A,C={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},V={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},G={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},x={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g=1;g<20;++g)C[111+g]="f"+g;for(g=0;g<=9;++g)C[g+96]=g.toString();z.prototype.bind=function(m,P,U){var j=this;return j._bindMultiple.call(j,m=m instanceof Array?m:[m],P,U),j},z.prototype.unbind=function(m,P){return this.bind.call(this,m,function(){},P)},z.prototype.trigger=function(m,P){var U=this;return U._directMap[m+":"+P]&&U._directMap[m+":"+P]({},m),U},z.prototype.reset=function(){var m=this;return m._callbacks={},m._directMap={},m},z.prototype.stopCallback=function(m,P){if((" "+P.className+" ").indexOf(" mousetrap ")>-1||N(P,this.target))return!1;if("composedPath"in m&&"function"==typeof m.composedPath){var j=m.composedPath()[0];j!==m.target&&(P=j)}return"INPUT"==P.tagName||"SELECT"==P.tagName||"TEXTAREA"==P.tagName||P.isContentEditable},z.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},z.addKeycodes=function(m){for(var P in m)m.hasOwnProperty(P)&&(C[P]=m[P]);A=null},z.init=function(){var m=z(b);for(var P in m)"_"!==P.charAt(0)&&(z[P]=function(U){return function(){return m[U].apply(m,arguments)}}(P))},z.init(),p.Mousetrap=z,re.exports&&(re.exports=z),void 0!==(e=function(){return z}.call(Z,s,Z,re))&&(re.exports=e)}function c(m,P,U){m.addEventListener?m.addEventListener(P,U,!1):m.attachEvent("on"+P,U)}function E(m){if("keypress"==m.type){var P=String.fromCharCode(m.which);return m.shiftKey||(P=P.toLowerCase()),P}return C[m.which]?C[m.which]:V[m.which]?V[m.which]:String.fromCharCode(m.which).toLowerCase()}function w(m,P){return m.sort().join(",")===P.sort().join(",")}function R(m){return"shift"==m||"ctrl"==m||"alt"==m||"meta"==m}function d(m,P,U){return U||(U=function $(){if(!A)for(var m in A={},C)m>95&&m<112||C.hasOwnProperty(m)&&(A[C[m]]=m);return A}()[m]?"keydown":"keypress"),"keypress"==U&&P.length&&(U="keydown"),U}function W(m,P){var U,j,H,q=[];for(U=function k(m){return"+"===m?["+"]:(m=m.replace(/\+{2}/g,"+plus")).split("+")}(m),H=0;H<U.length;++H)x[j=U[H]]&&(j=x[j]),P&&"keypress"!=P&&G[j]&&(j=G[j],q.push("shift")),R(j)&&q.push(j);return{key:j,modifiers:q,action:P=d(j,q,P)}}function N(m,P){return null!==m&&m!==b&&(m===P||N(m.parentNode,P))}function z(m){var P=this;if(m=m||b,!(P instanceof z))return new z(m);P.target=m,P._callbacks={},P._directMap={};var j,U={},H=!1,q=!1,se=!1;function O(T){T=T||{};var v,y=!1;for(v in U)T[v]?y=!0:U[v]=0;y||(se=!1)}function K(T,y,v,B,F,ne){var Y,le,be=[],fe=v.type;if(!P._callbacks[T])return[];for("keyup"==fe&&R(T)&&(y=[T]),Y=0;Y<P._callbacks[T].length;++Y)le=P._callbacks[T][Y],!B&&le.seq&&U[le.seq]!=le.level||fe!=le.action||("keypress"!=fe||v.metaKey||v.ctrlKey)&&!w(y,le.modifiers)||((!B&&le.combo==F||B&&le.seq==B&&le.level==ne)&&P._callbacks[T].splice(Y,1),be.push(le));return be}function J(T,y,v,B){P.stopCallback(y,y.target||y.srcElement,v,B)||!1===T(y,v)&&(function u(m){m.preventDefault?m.preventDefault():m.returnValue=!1}(y),function D(m){m.stopPropagation?m.stopPropagation():m.cancelBubble=!0}(y))}function X(T){"number"!=typeof T.which&&(T.which=T.keyCode);var y=E(T);if(y){if("keyup"==T.type&&H===y)return void(H=!1);P.handleKey(y,function h(m){var P=[];return m.shiftKey&&P.push("shift"),m.altKey&&P.push("alt"),m.ctrlKey&&P.push("ctrl"),m.metaKey&&P.push("meta"),P}(T),T)}}function ge(T,y,v,B,F){P._directMap[T+":"+v]=y;var Y,ne=(T=T.replace(/\s+/g," ")).split(" ");ne.length>1?function ae(T,y,v,B){function F(fe){return function(){se=fe,++U[T],function de(){clearTimeout(j),j=setTimeout(O,1e3)}()}}function ne(fe){J(v,fe,T),"keyup"!==B&&(H=E(fe)),setTimeout(O,10)}U[T]=0;for(var Y=0;Y<y.length;++Y){var be=Y+1===y.length?ne:F(B||W(y[Y+1]).action);ge(y[Y],be,B,T,Y)}}(T,ne,y,v):(Y=W(T,v),P._callbacks[Y.key]=P._callbacks[Y.key]||[],K(Y.key,Y.modifiers,{type:Y.action},B,T,F),P._callbacks[Y.key][B?"unshift":"push"]({callback:y,modifiers:Y.modifiers,action:Y.action,seq:B,level:F,combo:T}))}P._handleKey=function(T,y,v){var F,B=K(T,y,v),ne={},Y=0,le=!1;for(F=0;F<B.length;++F)B[F].seq&&(Y=Math.max(Y,B[F].level));for(F=0;F<B.length;++F)if(B[F].seq){if(B[F].level!=Y)continue;le=!0,ne[B[F].seq]=1,J(B[F].callback,v,B[F].combo,B[F].seq)}else le||J(B[F].callback,v,B[F].combo);var be="keypress"==v.type&&q;v.type==se&&!R(T)&&!be&&O(ne),q=le&&"keydown"==v.type},P._bindMultiple=function(T,y,v){for(var B=0;B<T.length;++B)ge(T[B],y,v)},c(m,"keypress",X),c(m,"keydown",X),c(m,"keyup",X)}}(typeof window<"u"?window:null,typeof window<"u"?document:null)},2094:(re,Z,s)=>{"use strict";s.d(Z,{c:()=>x});var e=s(8360),p=s(15210),b=s(66196),o=s(81954);const C={leading:!0,trailing:!1};var G=s(43654);function x(A,g=e.E,c=C){const E=(0,G.O)(A,g);return function V(A,g=C){return(0,p.N)((c,E)=>{const{leading:w,trailing:h}=g;let u=!1,D=null,R=null,$=!1;const d=()=>{R?.unsubscribe(),R=null,h&&(N(),$&&E.complete())},k=()=>{R=null,$&&E.complete()},W=z=>R=(0,o.Tg)(A(z)).subscribe((0,b._)(E,d,k)),N=()=>{if(u){u=!1;const z=D;D=null,E.next(z),!$&&W(z)}};c.subscribe((0,b._)(E,z=>{u=!0,D=z,(!R||R.closed)&&(w?N():W(z))},()=>{$=!0,(!(h&&u&&R)||R.closed)&&E.complete()}))})}(()=>E,c)}}}]);