"use strict";(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[637],{50637:(Ge,Ct,l)=>{l.r(Ct),l.d(Ct,{SearchModule:()=>Ne});var N=l(60177),H=l(38645),W=l(28407),m=l(65763),T=l(43194),z=l(85052),Y=l(82656),pt=l(40215),B=l(2573),y=l(21424),C=l(97948),I=l(16823),D=l(14264),O=l(21082),g=l(37925),nt=l(36110),Dt=l(87145),St=l(32914),Tt=l(11756),Z=l(17365),Pt=l(1670),d=l(49204),U=l(28696),it=l(24418),ht=l(27180),k=l(47632),Nt=l(68132),ut=l(96728),M=l(72865),Ot=l(54169),P=l(17766),X=l(15877),Vt=l(37780),Gt=l(37678),Bt=l(66432),Jt=l(3287),Ut=l(9632),t=l(54438);let Lt=(()=>{var a;class o{constructor(e,s,i){this.store=e,this.APP_BASE_URL=s,this.VIEWER_BASE_URL=i}getStudioSearchConfigFromEmptyRoute(e){return this.store.select(I.k.getProfile).pipe((0,D.p)(s=>!(0,d.isNil)(s)),(0,Z.s)(1),(0,nt.T)(s=>{switch(e.data.settings.contentType){case P.c.Module:return new M.pf("all");case P.c.Bookmark:const r=s.data.organizations[0]?.id;return r?new M.S8(r):new M.Y0;case P.c.Internal:return new M.O5}}))}getStudioSearchConfigFromRoute(e){const s=e.queryParams,i=(0,d.get)(s,"categoryId","all"),r=parseInt((0,d.get)(s,"organizationId",null),10),c=parseInt((0,d.get)(s,"collectionId",null),10),h=(0,d.get)(s,"type",C.n.Category),u=(0,d.get)(s,"tags","").split("|"),f=(0,d.get)(s,"query",""),v=(0,d.get)(s,"directory","");switch(h){case C.n.Category:return(0,X.of)(new M.pf(i,u,f));case C.n.Community:return(0,X.of)(new M.Ij(f,u));case C.n.Private:return(0,X.of)(new M.Y0(f,u));case C.n.Collection:return(0,X.of)(new M.Vf(r,c,f,u));case C.n.Organization:return(0,X.of)(new M.S8(r,f,u));case C.n.Internal:return(0,X.of)(new M.O5(f,v,u))}}getSearchOptionsFromRoute(e){const s=e.queryParams,i=e.data.settings,r=(0,d.get)(s,"sort","").split("|"),c="true"===(0,d.get)(s,"asc","true"),p=new Ot.n("",null);let h=ut.F.find(u=>(0,d.isEqual)(r,u.fields)&&u.ascending===c);return(0,d.isNil)(h)&&(h=i.contentType!==P.c.Module&&i.contentType!==P.c.Internal||it.c.application===ht.c.Loft?ut._z:ut.Ir),(0,d.isNil)(h)||(p.sortBy=h),p}getLoftSearchConfigFromEmptyRoute(){return new M.qS("production","maleAdult","")}getLoftSearchConfigFromRoute(e){const s=e.queryParams,i=(0,d.get)(s,"primary"),r=(0,d.get)(s,"secondary"),c=(0,d.get)(s,"query","");return i?new M.qS(i,r,c):null}exportBookmarksToCSV(){const e=this.getCheckedResults(),s=this.store.selectSnapshot(Nt.F.getWidgetURL),i=this.store.selectSnapshot(y.q.getWidgetOptions),r=this.store.selectSnapshot(y.q.getAppFeatures),c=r&&r.offlinePkgGen,p=this.store.selectSnapshot(I.k.getUserLanguage),h=this.store.selectSnapshot(I.k.getSelectedUserApp),u=this.store.selectSnapshot(y.q.getCollections),f=this.store.selectSnapshot(y.q.getOrganization)?.id,v=this.store.selectSnapshot(y.q.getSelectedOrganizationProductAccountId);this.store.dispatch(new k.ov(e,f,u,s,p,h,i,c,v))}exportModulesToCSV(){const e=(0,Vt.W)(this.store.selectSnapshot(I.k.getUserProfile)),i=this.getCheckedResults().map(c=>({title:c.title,specialty:(0,d.get)((0,Bt.v1)(c),"title",""),category:(0,d.get)((0,Bt.ZV)(c),"title",""),viewer:`${this.VIEWER_BASE_URL}/?id=${c.id}`,...e?{viewer:`${this.VIEWER_BASE_URL}/?id=${c.id}`}:{},app:`${this.APP_BASE_URL}/view?id=${c.id}`,animated:c.animated?"yes":"no",tour:c.tour?"yes":"no",created:c.create_date_time})),r=[{label:"Model Title",field:"title"},{label:"Specialty",field:"specialty"},{label:"Category",field:"category"},...e?[{label:"Human Viewer Link",field:"viewer"}]:[],{label:"Web App Link",field:"app"},{label:"Animated",field:"animated"},{label:"Tour",field:"tour"},{label:"Created Date",field:"created"}];(0,Jt.H)(i,r).subscribe(c=>{const h=`BioDigital-Library-${(new Date).toISOString().split("T")[0]}.csv`,u=new Blob([c],{type:"text/csv;charset=utf-8"});(0,Gt.saveAs)(u,h)})}getCheckedResults(){const e=this.store.selectSnapshot(T.Y.getAllResults),s=this.store.selectSnapshot(T.Y.getCheckedResults);return e.items.filter(r=>s.some(c=>r.id===c))}}return(a=o).\u0275fac=function(e){return new(e||a)(t.KVO(m.il),t.KVO(Ut.ar),t.KVO(Ut.jw))},a.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),o})();var V=l(17773),zt=l(50353),Yt=l(92811),Xt=l(83513),b=l(89417),$=l(34006),$t=l(29160),Ft=l(18152),mt=l(21523),G=l(17215),K=l(7213),Qt=l(70737),A=l(52394),gt=l(95416),ft=l(21007),Rt=l(87505),bt=l(97352),kt=l(87996),It=l(49206),Ht=l(82765);function Wt(a,o){if(1&a&&(t.j41(0,"div",3)(1,"mat-checkbox",4),t.EFF(2),t.k0s()()),2&a){const n=o.$implicit;t.Y8G("formGroupName",o.index),t.R7$(2),t.SpI(" ",n.get("title").value," ")}}let Mt=(()=>{var a;class o extends It.n{get collections(){return this._collections}set collections(e){this._collections=e,this.buildCollectionsFormArray(this.collectionsArray,e)}constructor(e){super(),this.fb=e,this._collections=[],this.ngUnsubscribe=new z.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(e){this.collectionsArray.controls.forEach(s=>{const r=e.includes(s.value.id);s.patchValue({checked:r})})}setDisabledState(e){e?this.form.disable():this.form.enable()}initForm(){this.form=this.fb.group({collections:this.fb.array([])}),this.collectionsArray=this.form.controls.collections}initFormListeners(){this.form.valueChanges.pipe((0,kt.B)(100),(0,nt.T)(e=>e.collections.filter(s=>s.checked).map(s=>s.id)),(0,O.F)(d.isEqual),(0,g.Q)(this.ngUnsubscribe)).subscribe(e=>{this.writeValue(e)})}buildCollectionsFormArray(e,s){e.clear(),s.forEach(i=>{const{collection_name:r,collection_id:c}=i;e.push(this.fb.group({title:r,id:c,checked:!1}))})}}return(a=o).\u0275fac=function(e){return new(e||a)(t.rXU(b.ok))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-collections-input"]],inputs:{collections:"collections"},features:[t.Jv_([{provide:b.kq,useExisting:(0,t.Rfq)(()=>a),multi:!0}]),t.Vt3],decls:3,vars:2,consts:[[1,"collections-input",3,"formGroup"],["formArrayName","collections"],["class","text-xs",3,"formGroupName",4,"ngFor","ngForOf"],[1,"text-xs",3,"formGroupName"],["formControlName","checked",1,"collections-input__checkbox"]],template:function(e,s){1&e&&(t.j41(0,"div",0),t.qex(1,1),t.DNE(2,Wt,3,2,"div",2),t.bVm(),t.k0s()),2&e&&(t.Y8G("formGroup",s.form),t.R7$(2),t.Y8G("ngForOf",s.collectionsArray.controls))},dependencies:[N.Sq,Ht.So,b.BC,b.cb,b.j4,b.JD,b.$R,b.v8],changeDetection:0}),o})();var At=l(5951);let Zt=(()=>{var a;class o extends It.n{constructor(e){super(),this.fb=e,this.bookmarkPermission=A.c,this.ngUnsubscribe=new z.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(e){this.form.setValue({permission:e})}setDisabledState(e){e?this.form.disable():this.form.enable()}initForm(){this.form=this.fb.group({permission:this.fb.control(A.c.Private)})}initFormListeners(){this.form.valueChanges.pipe((0,kt.B)(100),(0,O.F)(d.isEqual),(0,g.Q)(this.ngUnsubscribe)).subscribe(({permission:e})=>{this.writeValue(e)})}}return(a=o).\u0275fac=function(e){return new(e||a)(t.rXU(b.ok))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-bookmark-permissions-input"]],features:[t.Jv_([{provide:b.kq,useExisting:(0,t.Rfq)(()=>a),multi:!0}]),t.Vt3],decls:8,vars:4,consts:[[1,"bookmark-permissions-input",3,"formGroup"],["formControlName","permission","aria-label","Permission",1,"bookmark-permissions-input__radio-group","text-xs"],["data-test","groupAccessPrivateButton",3,"value"],["data-test","groupAccessViewButton",3,"value"],["data-test","groupAccessEditButton",3,"value"]],template:function(e,s){1&e&&(t.j41(0,"div",0)(1,"mat-radio-group",1)(2,"mat-radio-button",2),t.EFF(3,"Private "),t.k0s(),t.j41(4,"mat-radio-button",3),t.EFF(5,"Team (View Only) & Private "),t.k0s(),t.j41(6,"mat-radio-button",4),t.EFF(7,"Team (View & Edit) & Private "),t.k0s()()()),2&e&&(t.Y8G("formGroup",s.form),t.R7$(2),t.Y8G("value",s.bookmarkPermission.Private),t.R7$(2),t.Y8G("value",s.bookmarkPermission.TeamView),t.R7$(2),t.Y8G("value",s.bookmarkPermission.TeamEdit))},dependencies:[At.VT,At._g,b.BC,b.cb,b.j4,b.JD],styles:[".bookmark-permissions-input__radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}"],changeDetection:0}),o})();var q,at=function(a,o,n,e){var r,s=arguments.length,i=s<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(a,o,n,e);else for(var c=a.length-1;c>=0;c--)(r=a[c])&&(i=(s<3?r(i):s>3?r(o,n,i):r(o,n))||i);return s>3&&i&&Object.defineProperty(o,n,i),i},rt=function(a,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,o)};function Kt(a,o){if(1&a&&(t.j41(0,"app-form-field",13),t.nrm(1,"app-collections-input",14),t.nI1(2,"async"),t.k0s()),2&a){const n=t.XpG(2);t.Y8G("label",n.collectionsLabel),t.R7$(),t.Y8G("collections",t.bMT(2,2,n.collections$))}}function qt(a,o){if(1&a&&(t.qex(0),t.j41(1,"app-form-field",10),t.nrm(2,"app-bookmark-permissions-input",11),t.k0s(),t.DNE(3,Kt,3,4,"app-form-field",12),t.nI1(4,"async"),t.bVm()),2&a){let n;const e=t.XpG();t.R7$(3),t.Y8G("ngIf",null==(n=t.bMT(4,1,e.collections$))?null:n.length)}}function _t(a,o){1&a&&(t.qex(0),t.nrm(1,"app-spinner",15),t.EFF(2," Adding "),t.bVm())}function te(a,o){1&a&&t.EFF(0,"Confirm")}class Q{get collectionsLabel(){const o=this.settings.bookmarks.length;return`Add ${o} ${1===o?"Model":"Models"} to:`}constructor(o,n,e,s,i,r,c,p){this.store=o,this.actions=n,this.formBuilder=e,this.dialogRef=s,this.snackBar=i,this.storageService=r,this.data=c,this.changeRef=p,this.processing$=new $t.t(!1),this.ngUnsubscribe=new z.B,this.canAddTeamBookmarks=!1,this.settings={...c};const h=this.store.selectSnapshot(y.q.getOrganization);(0,d.isNil)(h)||this.store.dispatch(new Ft._q(h.id))}ngOnInit(){this.initForm(),this.initMessaging(),this.initPermissions()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleSubmit(){this.form.valid&&this.addTeamModels(this.settings.bookmarks)}handleCopySuccess(o){this.dialogRef.close(o)}handleCopyFailure(o){this.snackBar.open(`Failed to add ${this.settings.bookmarks.length} bookmarks to ${(this.form.value.collectionIds??[]).length} collection(s).`)}initForm(){const o=this.store.selectSnapshot(y.q.getOrganization),n="true"===this.storageService.getLocalItem(G.UT.DefaultGroupEdit),e=(0,d.isNil)(o)?A.c.Private:n?A.c.TeamEdit:A.c.TeamView;this.form=this.formBuilder.group({permission:this.formBuilder.control(e,b.k0.required),collectionIds:this.formBuilder.control([])});const i=this.form.controls.collectionIds;this.form.controls.permission.valueChanges.pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(r=>{r!==A.c.Private&&this.canAddTeamBookmarks?i.enable():i.disable(),r===A.c.TeamEdit?this.storageService.setLocalItem(G.UT.DefaultGroupEdit,!0):this.storageService.removeLocalItem(G.UT.DefaultGroupEdit)}),this.processing$.pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(r=>{r?this.form.disable():this.form.enable()})}initMessaging(){this.actions.pipe((0,m.xi)(k.ZA),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.processing$.next(!0),this.changeRef.markForCheck()}),this.actions.pipe((0,m.xi)(k.GZ),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.processing$.next(!1),this.handleCopySuccess(o),this.changeRef.markForCheck()}),this.actions.pipe((0,m.xi)(k.F_),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.processing$.next(!1),this.handleCopyFailure(o),this.changeRef.markForCheck()})}initPermissions(){(0,Y.z)([this.userRole$,this.organization$]).pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(([o,n])=>{this.canAddTeamBookmarks=!(0,d.isNil)(n)&&K._m(o,Qt.y.AddTeamBookmarks),this.changeRef.markForCheck()})}addTeamModels(o){const n=this.store.selectSnapshot(y.q.getOrganization),e=this.store.selectSnapshot(I.k.getUserLocale).lang,s=o.map(i=>this.getBookmarkCopyEntryModel(i,e,n));this.store.dispatch(new k.ZA(s))}getBookmarkCopyEntryModel(o,n,e){const{permission:s,collectionIds:i}=this.form.value,r=s===A.c.TeamView,c=s===A.c.TeamEdit,p={content_type:"bookmark"===o.type?"bookmark":"module",content_id:o.id,lang_code:n};return(0,d.isNil)(e)||(p.group_access={add_to_group:r||c?1:0,visibility:r||c?1:0,member_edit:c?1:0,add_to_collections:i??[]}),p}}(q=Q).\u0275fac=function(o){return new(o||q)(t.rXU(m.il),t.rXU(m.En),t.rXU(b.ok),t.rXU($.CP),t.rXU(gt.UG),t.rXU(G.n$),t.rXU($.Vh),t.rXU(t.gRc))},q.\u0275cmp=t.VBU({type:q,selectors:[["app-bulk-add-model-dialog"]],decls:17,vars:13,consts:[["defaultTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"text-xs","pb-6"],[1,"flex","flex-col",3,"submit","formGroup"],[4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close","disabled"],["type","submit","app-button","","buttonTheme","light","buttonType","primary","cdkFocusInitial","",3,"click","disabled"],[4,"ngIf","ngIfElse"],["theme","light","label","Choose Permissions"],["formControlName","permission"],["labelHelp",'Models are automatically added to "All Team Models".',"theme","light","class","my-2",3,"label",4,"ngIf"],["labelHelp",'Models are automatically added to "All Team Models".',"theme","light",1,"my-2",3,"label"],["formControlName","collectionIds",3,"collections"],["size","small","render","inline",1,"mr-1"]],template:function(o,n){if(1&o){const e=t.RV6();t.j41(0,"h1",1),t.EFF(1,"Add Models to My Library"),t.k0s(),t.j41(2,"div",2)(3,"p",3),t.EFF(4),t.k0s(),t.j41(5,"form",4),t.bIt("submit",function(){return t.eBV(e),t.Njj(n.handleSubmit())}),t.DNE(6,qt,5,3,"ng-container",5),t.k0s()(),t.j41(7,"div",6)(8,"button",7),t.nI1(9,"async"),t.EFF(10," Cancel "),t.k0s(),t.j41(11,"button",8),t.nI1(12,"async"),t.bIt("click",function(){return t.eBV(e),t.Njj(n.handleSubmit())}),t.DNE(13,_t,3,0,"ng-container",9),t.nI1(14,"async"),t.DNE(15,te,1,0,"ng-template",null,0,t.C5r),t.k0s()()}if(2&o){const e=t.sdS(16);t.R7$(4),t.SpI("",n.settings.bookmarks.length," selected"),t.R7$(),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("ngIf",n.canAddTeamBookmarks),t.R7$(2),t.Y8G("disabled",t.bMT(9,7,n.processing$)),t.R7$(3),t.Y8G("disabled",t.bMT(12,9,n.processing$)||!n.form.valid),t.R7$(2),t.Y8G("ngIf",t.bMT(14,11,n.processing$))("ngIfElse",e)}},dependencies:[N.bT,$.tx,$.BI,$.E7,$.Yi,ft.Q,Rt.K,bt.tI,b.qT,b.BC,b.cb,b.j4,b.JD,Mt,Zt,N.Jj],styles:[".dialog__radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (min-width: 480px){.dialog[_ngcontent-%COMP%]{min-width:380px}}"],changeDetection:0}),at([(0,m.l6)(I.k.getUserRole),rt("design:type",B.c)],Q.prototype,"userRole$",void 0),at([(0,m.l6)(y.q.getOrganization),rt("design:type",B.c)],Q.prototype,"organization$",void 0),at([(0,m.l6)(y.q.getCollections),rt("design:type",B.c)],Q.prototype,"collections$",void 0),at([(0,m.l6)(mt.J.getCopying),rt("design:type",B.c)],Q.prototype,"copying$",void 0);var tt,_=l(84370),ee=l(39937),oe=l(58841),se=l(53236),vt=function(a,o,n,e){var r,s=arguments.length,i=s<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(a,o,n,e);else for(var c=a.length-1;c>=0;c--)(r=a[c])&&(i=(s<3?r(i):s>3?r(o,n,i):r(o,n))||i);return s>3&&i&&Object.defineProperty(o,n,i),i},yt=function(a,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,o)};function ne(a,o){if(1&a&&(t.j41(0,"app-form-field",11),t.nrm(1,"app-collections-input",12),t.nI1(2,"async"),t.k0s()),2&a){const n=t.XpG();t.Y8G("label",n.collectionsLabel),t.R7$(),t.Y8G("collections",t.bMT(2,2,n.collections$))}}function ie(a,o){1&a&&(t.qex(0),t.nrm(1,"app-spinner",13),t.EFF(2," Updating "),t.bVm())}function ae(a,o){1&a&&t.EFF(0,"Confirm")}class et{get collectionsLabel(){const o=this.settings.bookmarks.length;return`Move ${o} ${1===o?"Model":"Models"} to:`}constructor(o,n,e,s,i,r,c){this.store=o,this.fb=n,this.dialogRef=e,this.data=s,this.snackbar=i,this.actions=r,this.changeDetectorRef=c,this.settings={bookmarks:[]},this.assignedCollections=new Map,this.unassignedCollections=new Map,this.saving$=new $t.t(!1),this.ngUnsubscribe=new z.B,this.settings={...this.settings,...s}}ngOnInit(){this.initForm(),this.initSaveObserver(),this.initCollections(),this.dialogRef.beforeClosed().pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cancelSave()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.bookmarkForm=this.fb.group({permission:this.fb.control(A.c.Private),collectionIds:this.fb.control([],{nonNullable:!0})}),this.saving$.pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{o?this.bookmarkForm.disable():this.bookmarkForm.enable()})}initCollections(){const o=this.store.selectSnapshot(y.q.getOrganization),n=this.settings.collectionId,e=this.store.selectSnapshot(y.q.getCollections)??[];!(0,d.isNil)(o)&&0===e.length&&this.store.dispatch(new Ft._q(o.id)),(0,Y.z)([this.organization$,this.collections$]).pipe((0,D.p)(s=>!(0,d.isNil)(s)),(0,g.Q)(this.ngUnsubscribe)).subscribe(([s,i])=>{const r=(0,d.isNil)(s)?A.c.Private:A.c.TeamView;this.assignedCollections.clear(),this.unassignedCollections.clear(),i.forEach(h=>{h.collection_id===n?this.assignedCollections.set(h.collection_id,h):this.unassignedCollections.set(h.collection_id,h)});const p={permission:r,collectionIds:Array.from(this.assignedCollections.keys())};this.formInitialValue=p,this.bookmarkForm.setValue(p),this.changeDetectorRef.markForCheck()}),this.trackCollectionsDirty()}initSaveObserver(){this.actions.pipe((0,m.xi)(k.Ln),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.saving$.next(!0)}),this.actions.pipe((0,m.xi)(k.ET),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.saving$.next(!1),this.handleSaveSuccess(o)}),this.actions.pipe((0,m.xi)(k.dc),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.saving$.next(!1),this.handleSaveFailure(o)})}trackCollectionsDirty(){this.bookmarkForm.valueChanges.pipe((0,kt.B)(100),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{(0,d.isEqual)(this.formInitialValue,o)?this.bookmarkForm.markAsPristine():this.bookmarkForm.markAsDirty(),this.changeDetectorRef.markForCheck()})}handleSubmit(){this.bookmarkForm.valid&&this.saveBookmark()}saveBookmark(){const n=this.store.selectSnapshot(y.q.getOrganization)?.id,e=this.settings.bookmarks.map(s=>{const{addCollections:i,removeCollections:r}=this.getBookmarkEntry(s);return{bookmark:s,addCollections:i,removeCollections:r}});this.store.dispatch(new k.Ln(n,e))}handleSaveSuccess(o){this.snackbar.open(`${o.updates.length} bookmarks successfully updated.`),this.store.dispatch(new U.w.SearchStudio),this.dialogRef.close(!0)}handleSaveFailure(o){const n=(0,se.u1)(o.error)||`Failed to update ${o.updates.length} bookmarks.`;this.snackbar.open(n)}handleCancelClick(){this.dialogRef.close(!1)}getBookmarkEntry(o){const{collectionIds:n}=this.bookmarkForm.value,e=[],s=new Map;return this.assignedCollections.forEach((i,r)=>{!n.includes(r)&&o.collection_content_id&&s.set(i,o.collection_content_id)}),this.unassignedCollections.forEach((i,r)=>{n.includes(r)&&e.push(i)}),{addCollections:e,removeCollections:s}}cancelSave(){this.settings.bookmarks=[],this.saving$.next(!1)}}(tt=et).\u0275fac=function(o){return new(o||tt)(t.rXU(m.il),t.rXU(b.ok),t.rXU($.CP),t.rXU($.Vh),t.rXU(gt.UG),t.rXU(m.En),t.rXU(t.gRc))},tt.\u0275cmp=t.VBU({type:tt,selectors:[["app-bulk-update-dialog"]],decls:18,vars:13,consts:[["defaultTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],["data-test","saveDialog",1,"save"],[1,"flex","flex-col",3,"submit","formGroup"],[1,"theme-light","text-xs"],["labelHelp",'Models are automatically added to "All Team Models".',"theme","light","class","my-2",3,"label",4,"ngIf"],["mat-dialog-actions",""],["type","button","app-button","","buttonTheme","light",3,"click"],["type","submit","app-button","","buttonTheme","light","buttonType","primary","data-test","saveButton",3,"click","disabled"],[4,"ngIf","ngIfElse"],["labelHelp",'Models are automatically added to "All Team Models".',"theme","light",1,"my-2",3,"label"],["formControlName","collectionIds",3,"collections"],["size","small","render","inline",1,"mr-1"]],template:function(o,n){if(1&o){const e=t.RV6();t.j41(0,"h1",1),t.EFF(1,"Manage Models"),t.k0s(),t.j41(2,"div",2)(3,"div",3)(4,"form",4),t.bIt("submit",function(){return t.eBV(e),t.Njj(n.handleSubmit())}),t.j41(5,"div",5),t.DNE(6,ne,3,4,"app-form-field",6),t.nI1(7,"async"),t.k0s()()()(),t.j41(8,"div",7)(9,"button",8),t.bIt("click",function(){return t.eBV(e),t.Njj(n.handleCancelClick())}),t.EFF(10,"Cancel"),t.k0s(),t.j41(11,"button",9),t.nI1(12,"async"),t.nI1(13,"async"),t.bIt("click",function(){return t.eBV(e),t.Njj(n.handleSubmit())}),t.DNE(14,ie,3,0,"ng-container",10),t.nI1(15,"async"),t.DNE(16,ae,1,0,"ng-template",null,0,t.C5r),t.k0s()()}if(2&o){let e;const s=t.sdS(17);t.R7$(4),t.Y8G("formGroup",n.bookmarkForm),t.R7$(2),t.Y8G("ngIf",null==(e=t.bMT(7,5,n.collections$))?null:e.length),t.R7$(5),t.Y8G("disabled",t.bMT(12,7,n.collectionsLoading$)||t.bMT(13,9,n.saving$)||!n.bookmarkForm.dirty),t.R7$(3),t.Y8G("ngIf",t.bMT(15,11,n.saving$))("ngIfElse",s)}},dependencies:[N.bT,$.BI,$.E7,$.Yi,ft.Q,Rt.K,bt.tI,b.qT,b.BC,b.cb,b.j4,b.JD,Mt,N.Jj],changeDetection:0}),vt([(0,m.l6)(y.q.getOrganization),yt("design:type",B.c)],et.prototype,"organization$",void 0),vt([(0,m.l6)(y.q.getCollections),yt("design:type",B.c)],et.prototype,"collections$",void 0),vt([(0,m.l6)(y.q.getCollectionsLoading),yt("design:type",B.c)],et.prototype,"collectionsLoading$",void 0);var re=l(43654),le=l(15210),ce=l(66196),pe=l(40634),xt=l(68947),he=l(35286),ue=l(67575),me=l(70914);function ge(a,o){1&a&&t.nrm(0,"app-spinner",9)}function fe(a,o){if(1&a&&(t.j41(0,"div",14)(1,"div",15)(2,"div"),t.EFF(3),t.k0s(),t.j41(4,"div",16),t.EFF(5),t.k0s()(),t.nrm(6,"mat-progress-bar",17),t.k0s()),2&a){const n=t.XpG(2);t.R7$(3),t.JRh(n.formatJobStatus(n.job)),t.R7$(2),t.SpI(" ",n.formatTaskCount(n.job.job_tasks)," "),t.R7$(),t.Y8G("value",100*n.job.job_status_pct)}}function be(a,o){if(1&a&&(t.qex(0),t.j41(1,"div",10)(2,"div",11),t.nrm(3,"app-html",12),t.k0s(),t.DNE(4,fe,7,3,"div",13),t.k0s(),t.bVm()),2&a){const n=t.XpG();t.R7$(3),t.Y8G("markdownText",n.bodyMarkdownText),t.R7$(),t.Y8G("ngIf",n.isJobActive)}}function ke(a,o){1&a&&(t.qex(0),t.nrm(1,"app-spinner",20),t.EFF(2," Stopping "),t.bVm())}function ve(a,o){1&a&&t.EFF(0,"Stop")}function ye(a,o){if(1&a){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(n);const s=t.XpG();return t.Njj(s.cancelJobClick(s.job.job_id,s.job.job_type))}),t.DNE(1,ke,3,0,"ng-container",19)(2,ve,1,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&a){const n=t.sdS(3),e=t.XpG();t.Y8G("disabled",e.cancelling),t.R7$(),t.Y8G("ngIf",e.cancelling)("ngIfElse",n)}}function Ce(a,o){if(1&a){const n=t.RV6();t.j41(0,"button",21),t.bIt("click",function(){t.eBV(n);const s=t.XpG();return t.Njj(s.closeDialogClick())}),t.EFF(1," Close "),t.k0s()}}let Se=(()=>{var a;class o{constructor(e,s,i,r,c,p,h,u){this.store=e,this.actions=s,this.renderer=i,this.markdownService=r,this.bookmarkService=c,this.changeRef=p,this.dialogRef=h,this.data=u,this.settings={},this.ngUnsubscribe=new z.B,this.settings={...this.settings,...u},this.initBookmarkJobListeners(u.jobId)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleElementClick(e){if(e.target instanceof HTMLAnchorElement){e.preventDefault(),e.stopImmediatePropagation();const i=e.target.href;i.startsWith(window.location.origin)&&(window.location.href=i)}}initBookmarkJobListeners(e){var s=this;const i=["aborted","complete","error"],{copyBookmarkModels:r,deleteBookmarkIds:c}=this.settings,p=r?.length??c?.length??1e3;(0,re.O)(0,p<100?1e3:p<500?2e3:5e3).pipe((0,St.n)(()=>this.bookmarkService.getBookmarkJobs({job_id:e,include_job_tasks:1})),(0,nt.T)(u=>u[0]),function de(a,o=!1){return(0,le.N)((n,e)=>{let s=0;n.subscribe((0,ce._)(e,i=>{const r=a(i,s++);(r||o)&&e.next(i),!r&&e.complete()}))})}(u=>!i.includes(u?.job_status),!0),(0,g.Q)(this.ngUnsubscribe)).subscribe(function(){var u=(0,W.A)(function*(f){s.job=f,s.store.dispatch(new k.Zp([f]));const v=i.includes(f.job_status);s.isJobActive=!v;const{title:R,bodyMarkdown:x}=yield s.formatJobText(f,s.settings);switch(s.headerText=R,s.bodyMarkdownText=x,f?.job_status){case"error":"bookmark_copy"===f.job_type&&s.store.dispatch(new k.ZW),"bookmark_delete"===f.job_type&&s.store.dispatch(new k.PS);break;case"complete":"bookmark_copy"===f.job_type&&s.store.dispatch(new k.U8),"bookmark_delete"===f.job_type&&s.store.dispatch(new k.$H)}s.changeRef.markForCheck()});return function(f){return u.apply(this,arguments)}}()),this.actions.pipe((0,m.xi)(k.I0)).subscribe(()=>{this.cancelling=!0,this.changeRef.markForCheck()}),this.actions.pipe((0,m.xi)(k.HN,k.Mo)).subscribe(()=>{this.cancelling=!1,this.changeRef.markForCheck()})}formatJobText(e,s){var i=this;return(0,W.A)(function*(){const{job_status:r,job_tasks_count:c,job_tasks:p,job_type:h}=e,u=s.copyBookmarkModels??[],f=u[0]?.group_access?.add_to_group?"**Team - All Models**":"**Private - All Models**",v=c,R=p.filter(S=>"complete"===S.job_task_status),x=R.length,J=p.filter(S=>"error"===S.job_task_status),E=J.length,st=v-x;switch(h){case"bookmark_copy":switch(r){case"aborted":{const S=yield i.getFormattedContentNames(R,h),L=yield i.getFormattedCollectionNames(u,!0,"inline");return{title:"Task Stopped",bodyMarkdown:L?`${st} models have been stopped. The following ${x} models have been added to ${L}:\n${S}`:`${st} models have been stopped. The following ${x} models have been added to ${f}:\n${S}`}}case"error":{const S=yield i.getFormattedContentNames(J,h),L=yield i.getFormattedCollectionNames(u,!0,"inline");return{title:"Task Error",bodyMarkdown:L?`${R.length} models were added successfully to ${L}. **The following ${E} models were unable to be added**:\n${S}`:`${R.length} models were added successfully to ${f}. **The following ${E} models were unable to be added**:\n${S}`}}case"complete":{const S=yield i.getFormattedCollectionNames(u,!0,"inline");return{title:"Added Successfully",bodyMarkdown:S?`${x} models have been added to ${S}.`:`${x} models have been added to ${f}.`}}default:{const S=yield i.getFormattedCollectionNames(u,!1,"list");return{title:"Adding Models to My Library",bodyMarkdown:S?`Please wait while ${v} models are added to:\n${S}\n\nStopping this task will only affect models left in the queue.`:`Please wait while ${v} models are added to ${f}.\n\nStopping this task will only affect models left in the queue.`}}}case"bookmark_delete":switch(r){case"aborted":return{title:"Task Stopped",bodyMarkdown:`${st} models have been stopped. The following ${x} models have been deleted:\n${yield i.getFormattedContentNames(R,h)}`};case"error":{const S=yield i.getFormattedContentNames(J,h);return{title:"Task Error",bodyMarkdown:`\n              ${R.length} models were deleted successfully from all My Library locations. The following ${E} models were unable to be deleted:\n${S}`}}case"complete":return{title:"Deleted Successfully",bodyMarkdown:`${x} models were deleted successfully from all My Library locations.`};default:return{title:"Deleting Models from My Library",bodyMarkdown:`Deleting ${v} models may take a few moments. Stopping this task will only affect models left in the queue.`}}}})()}formatJobPercent(e){return`${(100*e.job_status_pct).toFixed(0)}%`}formatJobStatus(e){return e.job_status.split("_").map(i=>(0,d.capitalize)(i)).join(" ")}formatTaskCount(e){const s=e.length;return`${e.filter(c=>"complete"===c.job_task_status).length}/${s}`}cancelJobClick(e,s){this.store.dispatch(new k.I0(e,s))}closeDialogClick(){this.dialogRef.close()}getFormattedCollectionNames(e,s,i){var r=this;const c=this.store.selectSnapshot(y.q.getCollections),p=e.map(v=>v.group_access?.add_to_collections??[]).flat(),h=(0,d.keyBy)(c,"collection_id"),u=Array.from(new Set(p)).map(v=>h[v]),f=u.length;return u.reduce(function(){var v=(0,W.A)(function*(R,x,J){let E=yield R;const{group_id:st,collection_id:S,collection_name:L}=x,Oe=0===J,Ve=J===f-1,jt=yield xt.l.getPlainTextFromMarkdown(r.renderer,r.markdownService,L,!0),dt=s?`[${jt}](/results/bookmarks?organizationId=${st}&collectionId=${S}&type=Collection)`:jt;switch(i){case"list":return E+=`- ${dt}\n`,E;case"inline":return E+=Oe?`**${dt}**`:Ve?` and **${dt}**`:`, **${dt}**`,E}return E});return function(R,x,J){return v.apply(this,arguments)}}(),Promise.resolve(""))}getFormattedContentNames(e,s){var i=this;return(0,W.A)(function*(){let r=[];switch(s){case"bookmark_copy":r=e.map(c=>c.job_task_details.source_content_name);break;case"bookmark_delete":r=e.map(c=>c.job_task_details.bookmark_name)}return r.length>0?"- "+(yield Promise.all(r.map(p=>xt.l.getPlainTextFromMarkdown(i.renderer,i.markdownService,p??"")))).join("\n- "):""})()}}return(a=o).\u0275fac=function(e){return new(e||a)(t.rXU(m.il),t.rXU(m.En),t.rXU(t.sFG),t.rXU(he.Rl),t.rXU(pe.x),t.rXU(t.gRc),t.rXU($.CP),t.rXU($.Vh))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-bookmark-jobs-dialog"]],hostBindings:function(e,s){1&e&&t.bIt("click",function(r){return s.handleElementClick(r)})},decls:9,vars:5,consts:[["defaultTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"bookmark-jobs-dialog"],["size","huge",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonType","text","buttonTheme","light","buttonType","primary","cdkFocusInitial","","aria-label","Stop Job",3,"disabled","click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","buttonType","flat","cdkFocusInitial","",3,"click",4,"ngIf"],["size","huge"],[1,"flex","flex-col","mt-4","mb-2"],[1,"bookmark-jobs-dialog__text","text-sm"],[3,"markdownText"],["class","mt-6 mb-2",4,"ngIf"],[1,"mt-6","mb-2"],[1,"flex","flex-row","justify-between","text-xs"],[1,"text-2xs","my-1"],[1,"bookmark-jobs-dialog__progress",3,"value"],["app-button","","buttonType","text","buttonTheme","light","buttonType","primary","cdkFocusInitial","","aria-label","Stop Job",3,"click","disabled"],[4,"ngIf","ngIfElse"],["size","small","render","inline",1,"mr-1"],["app-button","","buttonType","text","buttonTheme","light","buttonType","flat","cdkFocusInitial","",3,"click"]],template:function(e,s){1&e&&(t.j41(0,"h1",1),t.EFF(1),t.k0s(),t.j41(2,"div",2)(3,"div",3),t.DNE(4,ge,1,0,"app-spinner",4)(5,be,5,2,"ng-container",5),t.k0s()(),t.j41(6,"div",6),t.DNE(7,ye,4,3,"button",7)(8,Ce,2,0,"button",8),t.k0s()),2&e&&(t.R7$(),t.JRh(s.headerText),t.R7$(3),t.Y8G("ngIf",!s.job),t.R7$(),t.Y8G("ngIf",s.job),t.R7$(2),t.Y8G("ngIf",s.isJobActive),t.R7$(),t.Y8G("ngIf",!s.isJobActive))},dependencies:[N.bT,$.BI,$.E7,$.Yi,ue.HM,ft.Q,bt.tI,me.V],styles:[".bookmark-jobs-dialog__text{max-height:200px;overflow:auto}.bookmark-jobs-dialog__progress{height:16px}.bookmark-jobs-dialog .html a{text-decoration:none!important}\n"],encapsulation:2,changeDetection:0}),o})();var ot,Te=l(63181),Be=l(71217),Ue=l(82608),Et=l(99504),lt=l(79898),$e=l(99327),Fe=l(18617),Re=l(51452),w=function(a,o,n,e){var r,s=arguments.length,i=s<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(a,o,n,e);else for(var c=a.length-1;c>=0;c--)(r=a[c])&&(i=(s<3?r(i):s>3?r(o,n,i):r(o,n))||i);return s>3&&i&&Object.defineProperty(o,n,i),i},j=function(a,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,o)};const wt="(max-width: 959px)";class F{constructor(o,n,e,s,i,r,c,p,h,u,f,v,R){this.actions=o,this.activatedRoute=n,this.bookmarkActionsService=e,this.breakpointObserver=s,this.router=i,this.searchService=r,this.dialog=c,this.store=p,this.location=h,this.urlSerializer=u,this.liveAnnouncer=f,this.snackBar=v,this.storageService=R,this.application=it.c.application,this.environmentApplication=ht.c,this.galleryActionMode=lt.g,this.ngUnsubscribe=new z.B,this.actionMode=lt.g.Explore}ngOnInit(){this.searchSettings=this.activatedRoute.snapshot.data.settings,this.initSearch(),this.store.dispatch(new U.w.SetCardActions({enabled:!0})),this.updateSidenavEnabled(this.searchSettings),this.keepRouteUpdated(),this.observeActionResults(),this.keepBulkActionsUpdated(),this.keepActionModeUpdated(),this.initAccessibilty(),this.initBookmarkJobListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.store.dispatch(new U.w.Reset)}initAccessibilty(){(0,Y.z)([this.store.select(T.Y.getFilteredResults),this.store.select(T.Y.getSearchConfig),this.store.select(T.Y.getLoading),(0,ee.E)(this.store)]).pipe((0,D.p)(([o,n,e])=>!(0,d.isNil)(o)&&!(0,d.isNil)(n)&&!e),(0,O.F)((o,n)=>(0,d.isEqual)(o[0],n[0])),(0,g.Q)(this.ngUnsubscribe)).subscribe(([o,n,e,s])=>{const{total:i,items:r}=o,c=n.query,p=[];p.push(0===i?"No results found":i===r.length?`Showing ${i} results`:`Showing ${r.length} of ${i} results`),p.push(c?`for search, "${c}"`:`for category, "${s}"`);const h=`${p.join(" ")}.`;this.liveAnnouncer.announce(h)}),this.actions.pipe((0,m.xi)(U.w.CheckAll),(0,nt.T)(()=>this.store.selectSnapshot(T.Y.getCheckedResults)),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.liveAnnouncer.announce(`${o.length} models selected.`)}),this.actions.pipe((0,m.xi)(U.w.UncheckAll),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.liveAnnouncer.announce("Model selections cleared.")}),this.viewMode$.pipe((0,O.F)((o,n)=>(0,d.isEqual)(o,n)),(0,Dt.i)(1),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.liveAnnouncer.announce(`Gallery view mode updated to ${o===oe.P.Card?"Card":"List"} View.`)})}initBookmarkJobListeners(){this.activeBookmarkJobs$.pipe((0,g.Q)(this.ngUnsubscribe)).pipe((0,D.p)(o=>!(0,d.isNil)(o)),(0,St.n)(o=>this.openBookmarkJobDialog({jobId:o.job_id})),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new U.w.SearchStudio)}),this.store.dispatch(new k.zW)}initSearch(){this.profile$.pipe((0,D.p)(o=>!(0,d.isNil)(o)),(0,g.Q)(this.ngUnsubscribe),(0,Tt.Z)(()=>this.activatedRoute.queryParams.pipe((0,g.Q)(this.ngUnsubscribe)))).subscribe(()=>{(this.activatedRoute.snapshot.queryParamMap.has("primary")?this.searchLoftFromRoute:this.searchStudioFromRoute).call(this,this.activatedRoute.snapshot)})}searchStudioFromRoute(o){((0,d.isEmpty)(o.queryParams)?this.searchService.getStudioSearchConfigFromEmptyRoute(o):this.searchService.getStudioSearchConfigFromRoute(o)).pipe((0,Z.s)(1)).subscribe(e=>{const s=this.searchService.getSearchOptionsFromRoute(o);this.store.dispatch(new U.w.SetSearchOptions(s)),e&&this.store.dispatch(new U.w.SetSearchConfig(e))})}searchLoftFromRoute(o){const n=(0,d.isEmpty)(o.queryParams)?this.searchService.getLoftSearchConfigFromEmptyRoute():this.searchService.getLoftSearchConfigFromRoute(o),e=this.searchService.getSearchOptionsFromRoute(o);this.store.dispatch(new U.w.SetSearchOptions(e)),this.store.dispatch(new U.w.SetSearchConfig(n))}updateSidenavEnabled(o){if(o.application!==ht.c.Studio||o.contentType!==P.c.Bookmark)return;const n=this.teamJoinNotificationInteracted();(0,Y.z)([this.store.select(I.k.isPrivateUser),this.store.select(Et.e.getEligibleOrganizations)]).pipe((0,D.p)(([e,s])=>!(!e||(!Array.isArray(s)||s.length>0)&&!n)),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(T.Y.getSidenav);this.store.dispatch(new U.w.SetSidenav({...e,enabled:!1}))}),!n&&!this.store.selectSnapshot(Et.e.getEligibleOrganizations)&&this.store.selectSnapshot(I.k.getUserSessionType)===Be.P.User&&this.store.dispatch(new Ue.Ae)}teamJoinNotificationInteracted(){const o="true"===this.storageService.getLocalItem(G.UT.UserJoinPromptSeen),n="true"===this.storageService.getLocalItem(G.UT.UserJoinNotificationInteracted);return o&&n}keepRouteUpdated(){(0,Y.z)(this.store.select(T.Y.getSearchConfig),this.store.select(T.Y.getSearchOptions)).pipe((0,D.p)(([o,n])=>!(0,d.isNil)(o)&&!(0,d.isNil)(n)),(0,O.F)(([o,n],[e,s])=>{const i=h=>h,c=(0,d.isEqualWith)(o,e,(h,u,f)=>{if("tags"===f)return(0,d.isEqual)(h.filter(i),u.filter(i))}),p=(0,d.isEqual)((0,d.omit)(n,["pageSize"]),(0,d.omit)(s,["pageSize"]));return c&&p}),(0,Pt.J)(),(0,g.Q)(this.ngUnsubscribe)).subscribe(([[o],[n,e]])=>{const s=this.getUrlTree(n,e),i=(0,d.isEqual)((0,d.omit)(o,["query"]),(0,d.omit)(n,["query"]));this.router.navigateByUrl(this.router.serializeUrl(s),{skipLocationChange:i}),i&&this.replaceLocationState()})}observeActionResults(){this.actions.pipe((0,m.xi)(k.x$,k.DN,k.lN),(0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.store.dispatch(new U.w.SearchStudio)}),this.actions.pipe((0,m.xi)(k.GZ,k.te),(0,Tt.Z)(o=>this.openBookmarkJobDialog(o)),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new U.w.SearchStudio)}),this.actions.pipe((0,m.xi)(k.F_),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{})}keepActionModeUpdated(){this.bulkActionsActive$.pipe((0,g.Q)(this.ngUnsubscribe)).subscribe(o=>{this.actionMode=o?lt.g.Check:lt.g.Explore})}keepBulkActionsUpdated(){(0,Y.z)([this.breakpointObserver.observe(wt),this.profile$,this.searchConfig$,this.collections$]).pipe((0,O.F)(),(0,g.Q)(this.ngUnsubscribe),(0,D.p)(([,,o])=>!(0,d.isNil)(o))).subscribe(([,,o,n])=>{o&&this.updateBulkActions(o,n)}),this.bulkActionsActive$.pipe((0,O.F)(d.isEqual),(0,D.p)(o=>!o),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new U.w.UncheckAll)}),this.searchConfig$.pipe((0,O.F)(d.isEqual),(0,g.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new U.w.SetBulkActions({active:!1}))})}updateBulkActions(o,n){const e=o.type,s=new zt.S4;switch(s.active=this.store.selectSnapshot(T.Y.getBulkActionsActive),e){case C.n.Private:case C.n.Organization:case C.n.Collection:case C.n.Category:{const i=[],r=this.store.selectSnapshot(I.k.getUserRole),c=this.store.selectSnapshot(I.k.isPremiumUser),p=this.store.selectSnapshot(y.q.hasOrganization),h=this.store.selectSnapshot(y.q.isTrial);K.Dx(r,c)&&i.push(V.qg.ExportCSV),K.E2(c,h)&&e===C.n.Category&&i.push(V.qg.AddToLibrary),(e===C.n.Collection||e===C.n.Organization||e===C.n.Private)&&i.push(V.qg.Delete),K.Dy(r,p)&&n?.length>0&&(e===C.n.Collection||e===C.n.Organization)&&i.push(V.qg.Manage),s.enabled=!0,s.items=[...i];break}default:s.enabled=!1}(it.c.platform!==Yt.N.Web||this.breakpointObserver.isMatched(wt))&&(s.enabled=!1),this.store.dispatch(new U.w.SetBulkActions(s))}handleBulkAction(o){const{name:n}=o,e=this.store.selectSnapshot(T.Y.getAllResults).items,s=this.store.selectSnapshot(T.Y.getCheckedResults),i=e.filter(r=>s.includes(r.id));this.performBulkAction(n,i).then(r=>{r&&this.store.dispatch(new U.w.UncheckAll)}).catch(()=>{this.snackBar.open(`There was an error performing the specified bulk action: "${n}".`)})}performBulkAction(o,n){var e=this;return(0,W.A)(function*(){const s=e.store.selectSnapshot(T.Y.getSearchConfig);switch(o){case V.qg.ExportCSV:return s.type===C.n.Category?e.searchService.exportModulesToCSV():e.searchService.exportBookmarksToCSV(),!0;case V.qg.AddToLibrary:return(0,pt._)(e.dialog.open(Q,{id:_.t.BulkAddModelDialog,data:{bookmarks:s.type===C.n.Category?n:[]}}).afterClosed().pipe((0,Z.s)(1),(0,g.Q)(e.ngUnsubscribe)));case V.qg.Delete:{const i=e.store.selectSnapshot(I.k.getUserRole),r=n.filter(p=>K.M8(i,p));return(0,pt._)(e.dialog.open(Te.Y,{id:_.t.BulkDeleteModelDialog,data:{bookmarks:r}}).afterClosed().pipe((0,Z.s)(1),(0,g.Q)(e.ngUnsubscribe)))}case V.qg.Manage:return(0,pt._)(e.dialog.open(et,{id:_.t.BulkUpdateDialog,width:"360px",data:{bookmarks:n,collectionId:s.type===C.n.Collection?s.collectionId:void 0}}).afterClosed().pipe((0,Z.s)(1),(0,g.Q)(e.ngUnsubscribe)));default:return!0}})()}handleView(o){this.bookmarkActionsService.view(o)}openBookmarkJobDialog(o){const n=this.dialog.getDialogById(_.t.BookmarkJobsDialog);return n?n.afterClosed():this.dialog.open(Se,{id:_.t.BookmarkJobsDialog,disableClose:!0,width:"464px",height:"auto",data:o}).afterClosed()}replaceLocationState(){const o=this.store.selectSnapshot(T.Y.getSearchConfig),n=this.store.selectSnapshot(T.Y.getSearchOptions),e=this.getUrlTree(o,n),s=this.urlSerializer.serialize(e);this.location.replaceState(s)}getUrlTree(o,n){const e=window.location.pathname,s=(0,d.get)(n,"sortBy.fields",[]).join("|"),i=(0,d.get)(n,"sortBy.ascending",!0),r={};s.length&&(r.sort=s,r.asc=i);const c={tags:(0,d.compact)((0,d.get)(o,"tags",[])).join("|")},p=Object.entries({...o,...c,...r}).reduce((u,[f,v])=>(null!==v&&""!==v&&(u[f]=v),o.type===C.n.Loft&&(["primary","secondary","query"].includes(f)||delete u[f]),u),{});return this.router.createUrlTree([e],{queryParams:p})}}(ot=F).\u0275fac=function(o){return new(o||ot)(t.rXU(m.En),t.rXU(H.nX),t.rXU(Xt.h),t.rXU($e.QP),t.rXU(H.Ix),t.rXU(Lt),t.rXU($.bZ),t.rXU(m.il),t.rXU(N.aZ),t.rXU(H.Sd),t.rXU(Fe.Ai),t.rXU(gt.UG),t.rXU(G.n$))},ot.\u0275cmp=t.VBU({type:ot,selectors:[["app-search-page"]],decls:2,vars:4,consts:[[1,"search-page"],[3,"bulkAction","selectBookmark","application","actionMode","contentType","showSourcePicker"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"app-gallery-container",1),t.bIt("bulkAction",function(s){return n.handleBulkAction(s)})("selectBookmark",function(s){return n.handleView(s)}),t.k0s()()),2&o&&(t.R7$(),t.Y8G("application",n.searchSettings.application)("actionMode",n.actionMode)("contentType",n.searchSettings.contentType)("showSourcePicker",n.application===n.environmentApplication.Loft))},dependencies:[Re.j],styles:[".search-page[_ngcontent-%COMP%]{min-height:100%;display:flex}"],changeDetection:0}),w([(0,m.l6)(T.Y.getFilteredResults),j("design:type",B.c)],F.prototype,"results$",void 0),w([(0,m.l6)(T.Y.getSearchConfig),j("design:type",B.c)],F.prototype,"searchConfig$",void 0),w([(0,m.l6)(mt.J.getBookmarkJobs),j("design:type",B.c)],F.prototype,"bookmarkJobs$",void 0),w([(0,m.l6)(mt.J.getActiveBookmarkJob),j("design:type",B.c)],F.prototype,"activeBookmarkJobs$",void 0),w([(0,m.l6)(I.k.getProfile),j("design:type",B.c)],F.prototype,"profile$",void 0),w([(0,m.l6)(y.q.getOrganization),j("design:type",B.c)],F.prototype,"organization$",void 0),w([(0,m.l6)(y.q.getCollections),j("design:type",B.c)],F.prototype,"collections$",void 0),w([(0,m.l6)(T.Y.getViewMode),j("design:type",B.c)],F.prototype,"viewMode$",void 0),w([(0,m.l6)(T.Y.getBulkActionsAvailable),j("design:type",B.c)],F.prototype,"bulkActionsAvailable$",void 0),w([(0,m.l6)(T.Y.getBulkActionsActive),j("design:type",B.c)],F.prototype,"bulkActionsActive$",void 0);var Ie=l(20736),Me=l(85446);let ct=(()=>{var a;class o{constructor(){}resolve(e){let s;switch(e.routeConfig.path){case"bookmarks":s=P.c.Bookmark;break;case"modules":s=P.c.Module;break;case"internal":s=P.c.Internal}return{application:it.c.application,contentType:s}}}return(a=o).\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.jDH({token:a,factory:a.\u0275fac}),o})();var Ae=l(22083);const xe=[{path:"",component:Ie.m,canActivate:[Me.q],data:{fixedHeight:!0,overflowFix:!0,siteHeaderType:Ae.D.Search},children:[{path:"modules",resolve:{settings:ct},component:F,data:{title:"Explore"}},{path:"bookmarks",resolve:{settings:ct},component:F,data:{title:"My Library"}},{path:"internal",resolve:{settings:ct},component:F}]}];let Ee=(()=>{var a;class o{}return(a=o).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({imports:[H.iI.forChild(xe),H.iI]}),o})();var we=l(8377),je=l(28107),De=l(45189),Pe=l(36569);let Ne=(()=>{var a;class o{}return(a=o).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({providers:[ct],imports:[N.MD,je.R,Ee,we.l,De.G,Pe.q]}),o})()}}]);