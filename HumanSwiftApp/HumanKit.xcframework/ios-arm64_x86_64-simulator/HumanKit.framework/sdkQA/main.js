(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[179],{9695:(ma,Ph,A)=>{"use strict";var ys=A(1481),i=A(4650),S0=A(8746),l=A(3306);class Pi{}let Tp=(()=>{class t{constructor(e,o,s){this.hostingURL=e,this.embedded=o,this.widgetConfig=s}}return t.type="[Widget] Setup Widget",t})(),P0=(()=>{class t{}return t.type="[Widget] Reset",t})(),uc=(()=>{class t{constructor(e){this.enabled=e}}return t.type="[Widget] Set Input Enabled",t})(),Mp=(()=>{class t{constructor(e){this.config=e}}return t.type="[Widget] Set API Config",t})(),Ip=(()=>{class t{constructor(e){this.productAccountId=e}}return t.type="[Widget] Get Widget Product Settings",t})(),zp=(()=>{class t{constructor(e){this.widgetSettings=e}}return t.type="[Widget] Set Widget Product Settings",t})();var Yo=(()=>{return(t=Yo||(Yo={}))[t.User=0]="User",t[t.Developer=1]="Developer",Yo;var t})(),fo=(()=>{return(t=fo||(fo={})).Widget="widget",t.WidgetAPI="widgetapi",fo;var t})(),sn=A(4721),at=A(529);let kh=(()=>{class t{constructor(e){this.http=e}getWidgetSettings(e){return this.http.get(`/ws/product/account/settings?product_acctid=${e}`)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class Oh{}class gc{}var Pn=A(3755),Hi=A(3210),X=A(1568),$=A(1648),Th=A(9696),pe=(()=>{return(t=pe||(pe={})).Started="started",t.Loaded="loaded",t.Tick="tick",t.HumanReady="human.ready",t.HumanStarted="started",t.Error="error",t.HumanError="human.error",t.CanvasResized="canvas.resized",t.HumanCanvasResized="human.canvasResized",t.LogDebug="_log.debug",t.LogError="_log.error",t.LogInfo="_log.info",t.LogWarn="_log.warn",t.SceneLoaded="scene.loaded",t.HumanProgress="human.progress",t.AssetsLoadFinish="assets.load.finish",t.AssetsLoadProgress="assets.load.progress",t.AssetsLoadStart="assets.load.start",t.CameraRested="camera.rested",t.CameraUpdated="camera.updated",t.ModuleInteractive="module.interactive",t.ModulesActivateFinish="modules.activate.finish",t.ModulesCreateFinish="modules.create.finish",t.ModulesDestroyFinish="modules.destroy.finish",t.ModulesFetchStart="modules.fetch.start",t.PickPicked="pick.picked",t.SceneMarkersUpdated="scene.markers.updated",t.SceneObjectRenderable="scene.objectRenderable",t.SceneObjectsSelected="scene.objectsSelected",t.SceneObjectsShown="scene.objectsShown",t.ScenePicked="scene.picked",t.SceneRestored="scene.restored",t.SceneXrayEnabled="scene.xrayEnabled",t.SceneXrayDisabled="scene.xrayDisabled",t.SceneReady="scene.ready",t.TimelineChapterActivated="timeline.chapters.activated",t.TimelineChapterTransition="timeline.chapterTransition",t.TimelinePlaying="timeline.playing",t.TimelineScrubbed="timeline.scrubbed",t.TimelinePlayed="timeline.played",t.TimelinePaused="timeline.paused",t.TimelineCompleted="timeline.completed",t.TimelineTimeFrameUpdated="timeline.timeFrame.updated",t.GraphAssetAttachFinish="graph.assetAttach.finish",t.TweenVisibilityUpdate="TweenVisibilityUpdate",pe;var t})(),mt=(()=>{return(t=mt||(mt={})).Loft="Loft",t.Studio="Studio",t.Viewer="Viewer",t.All="",mt;var t})(),Xe=(()=>{return(t=Xe||(Xe={})).Bookmark="bookmark",t.Module="module",t.Internal="internal",Xe;var t})(),pn=(()=>{return(t=pn||(pn={})).Local="Local",t.QA="QA",t.Staging="Staging",t.Production="Production",pn;var t})(),Yi=(()=>{return(t=Yi||(Yi={})).Web="web",t.SDK="sdk",Yi;var t})();const se={production:!1,assetDomain:"assets-qa.biodigital.com",supportEmail:"support@biodigital.com",googleAuthKey:"66261904577-061oin26uo7sor0vrqc8dnn105irq82n.apps.googleusercontent.com",googleAnalyticsId:"UA-1141985-29",linkedinId:"2641938",pendoId:"3a783681-e53b-4ebd-69c0-788bbae48f13",rollbarToken:"dd70f513aa0740668070fa3fd62b33a0",recaptchaKey:"6LdvZvcUAAAAAM0Z1St9WQXwvSYd__hMUY2WZ6um",application:mt.Viewer,deploy:pn.Local,platform:Yi.SDK,exportType:Xe.Bookmark,offline:!1,native:!0,minPasswordLength:8};var k0=A(8751);class O0 extends k0.ZP{constructor(){super("HumanDatabase"),this.version(2).stores({keyValue:",value",analytics:"message"}),this.open(),this.keyValue=this.table("keyValue"),this.analytics=this.table("analytics")}}var fn=(()=>{return(t=fn||(fn={})).WidgetOptions="widgetOptions",t.SnapshotOptions="snapshotOptions",t.Locale="locale",t.GroupRestriction="GroupRestriction",t.UserAppId="userAppId",t.RememberMeEmail="rememberMeEmail",t.LabelConversionSeen="labelConversionSeen",t.DefaultGroupEdit="defaultGroupEdit",t.DefaultCollectionId="defaultCollectionId",t.InternetExplorerWarning="internetExplorerWarning",t.GettingStartedTutorial="gettingStartedTutorial",t.AutoCapture="autoCapture",t.SystemMessage="systemMessage",t.ExploreRedesignMessage="exploreRedesignMessage",t.Iphone12Warning="iphone12Warning",t.RecentRecipes="recentRecipes",t.TeamTrialExpirationSeen="teamTrialExpiredSeen",t.ProExpirationSeen="proExpirationSeen",t.PaintPalettes="paintPalettes",t.RecentSearchConfig="recentSearchConfig",t.CameraDebug="cameraDebug",fn;var t})(),_s=(()=>{return(t=_s||(_s={})).UserMessagesSeen="userMessagesSeen",t.PreviewSize="previewSize",t.GPUAnalyticsStored="gpuAnalyticsStored",_s;var t})(),fa=(()=>{return(t=fa||(fa={})).PreviewStory="previewStory",t.PreviewBookmark="previewBookmark",fa;var t})();class Mh{constructor(){this._data={}}get keys(){return Object.keys(this._data)}get length(){return this.keys.length}clear(){this._data={}}getItem(n){return this._data[n]}key(n){return this.keys[n]}removeItem(n){delete this._data[n]}setItem(n,e){this._data[n]=e}}let dn=(()=>{class t{constructor(){this._localStorage=this.getStorage("localStorage"),this._sessionStorage=this.getStorage("sessionStorage"),this._indexedStorage=new O0}getLocalItem(e){return this._localStorage.getItem(`${e}`)}getLocalJSON(e){const o=this.getLocalItem(e);return o?JSON.parse(o):null}setLocalItem(e,o){const s="object"==typeof o?JSON.stringify(o):`${o}`;try{return this._localStorage.setItem(`${e}`,s),!0}catch{return!1}}removeLocalItem(e){this._localStorage.removeItem(`${e}`)}getSessionItem(e){const o=this._sessionStorage.getItem(`${e}`);return o?JSON.parse(o):null}setSessionItem(e,o){const s=JSON.stringify(o);try{return this._sessionStorage.setItem(`${e}`,s),!0}catch{return!1}}removeSessionItem(e){this._sessionStorage.removeItem(`${e}`)}setDatabaseItem(e,o){return this._indexedStorage.keyValue.put(o,e)}setDatabaseAnalyticItem(e){var o=this;(0,Pn.Z)(function*(){yield o._indexedStorage.analytics.put(e)})()}getDatabaseOfflineAnalytics(e){var o=this;(0,Pn.Z)(function*(){const s=yield o._indexedStorage.analytics.toArray();o._indexedStorage.analytics.clear(),e(s)})()}getDatabaseOfflineAnalyticsCount(e){var o=this;(0,Pn.Z)(function*(){const s=yield o._indexedStorage.analytics.toArray();e(s.length)})()}getDatabaseItem(e){return this._indexedStorage.keyValue.get(e)}clearStorage(){this.clearLocalStorage(),this.clearSessionStorage()}clearLocalStorage(){this._localStorage.clear()}clearSessionStorage(){this._sessionStorage.clear()}getStorage(e){try{return window[e]||new Mh}catch{return new Mh}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var xs=(()=>{return(t=xs||(xs={})).Content="content",t.SceneJS="scenejs",xs;var t})(),We=A(3184);let Ih=(()=>{class t{constructor(e){this.router=e}redirectToErrorPage(e,o,s){if((this.router.url||"").match("/error"))return;const c=this.router.createUrlTree([se.application===mt.Viewer?"/error":"/view/error"],{queryParams:{errorType:e,errorCode:o,errorBlob:s,errorUrl:this.router.url}}),p=this.router.serializeUrl(c);this.router.navigateByUrl(p,{skipLocationChange:!0})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(We.F0))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var xe=A(4528),m=A(4794);const T0={[xe.FogModeNumericEnum.Linear]:"linear",[xe.FogModeNumericEnum.Exponential]:"exp",[xe.FogModeNumericEnum.ExponentialSquared]:"exp2"};class zh{constructor(){this._subjects={}}getEvent(n){return(this._subjects[n]=this._subjects[n]??new X.x).asObservable()}fireEvent(n,e){const o=this._subjects[n];o&&o.next(e)}}let M0=(()=>{class t extends zh{}return t.\u0275fac=function(){let n;return function(o){return(n||(n=i.n5z(t)))(o||t)}}(),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),et=(()=>{class t{constructor(e,o,s,r){this.errorService=e,this.storageService=o,this.engineEventService=s,this.http=r,this.events={},this.errorLogged=!1,this._engineCreated=new Hi.X(void 0),this._engineDestroyed=new X.x,this.registerEngineWorkers(),this.events=Object.values(pe).reduce((a,c)=>(a[c]=this.engineEventService.getEvent(c),a),{}),this.engineCreated$=this._engineCreated.asObservable().pipe((0,$.h)(a=>!(0,m.isNil)(a))),this.engineDestroyed$=this._engineDestroyed.asObservable()}get engine(){return this._engine}getEvent(e){return this.events[e]}fireEvent(e,o){this.engineEventService.fireEvent(e,o)}initEngine(e){return this.createServerInstance(),this.createEngineInstance(e),this.fireEvent(pe.Loaded),this.engine}destroyEngine(){this._engine&&(this._engineCreated.next(void 0),this._engineDestroyed.next(),this._engine.destroy(),this._engine=null),this._server&&(this._server.destroy(),this._server=null)}setStory(e){this.engine.setStory(e),this.engine.story.chapters.forEach(o=>{o.on("progress",()=>{this.fireEvent(pe.AssetsLoadProgress,o.loadProgress)})})}getWEBGLInfo(){return{}}setProperties(e){const{story:o,renderer:s}=this.engine,r=o?.activeChapter,a=o?.cameraController;(0,m.isNil)(r)||(this.setFogProperties(s,r,e),this.setCameraProperties(s,r,a,e))}setFogProperties(e,o,s){Object.entries(s).forEach(([a,c])=>{if(a.startsWith("fog.")&&((0,m.has)(e.environment,a)&&(0,m.set)(o.properties,a,c),(0,m.has)(e.environment,a)))switch(a){case"fog.density":e.environment.fog.density=c/xe.BIODIGITAL_SCENE_SCALE;break;case"fog.mode":e.environment.fog.mode=T0[c];break;case"fog.start":e.environment.fog.start=c*xe.BIODIGITAL_SCENE_SCALE;break;case"fog.end":e.environment.fog.end=c*xe.BIODIGITAL_SCENE_SCALE;break;default:(0,m.set)(e.environment,a,c)}}),!1===s["fog.enabled"]&&(e.environment.fog.mode="")}setCameraProperties(e,o,s,r){Object.entries(r).forEach(([p,d])=>{if(p.startsWith("camera."))switch(p){case"camera.optics.near":o.properties.camera.optics.near=d;break;case"camera.optics.far":o.properties.camera.optics.far=d;break;case"camera.optics.fov":o.properties.camera.optics.fov=d;break;case"camera.zoomLimits":o.properties.camera.zoomLimits=d}});const{optics:a,zoomLimits:c}=o.properties.camera;e.camera.fov=a.fov*Math.PI/180,e.camera.far=a.far*xe.BIODIGITAL_SCENE_SCALE,e.camera.near=a.near*xe.BIODIGITAL_SCENE_SCALE,e.camera.dirtyProjection(),s.minDistance=c.min*xe.BIODIGITAL_SCENE_SCALE,s.maxDistance=c.max*xe.BIODIGITAL_SCENE_SCALE}initAnalytics(e,o,s,r){var a=this;return(0,Pn.Z)(function*(){const p=yield(yield(0,Th.z)(a.engineCreated$)).renderer.getGPUCapabilities();if(a.gpuAnalytic={version:4,app_producttype:e,app_productkey:o,gpu_data:{...p},acct_cred_type:s,acct_cred_id:r,offline_event:se.offline?1:0},!a.storageService.getSessionItem(_s.GPUAnalyticsStored)){const u=se.offline?{...a.gpuAnalytic,event_timestamp:(new Date).toISOString().substring(0,19)}:a.gpuAnalytic;a.http.post("/ws/product/analytic/gpu-event",u,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(()=>{a.storageService.setSessionItem(_s.GPUAnalyticsStored,Date.now())})}})()}handleEngineFatalErrors(e){if(this.errorLogged)return;this.errorLogged=!0;const s={...this.gpuAnalytic,error_category:e.errorName,error_message:JSON.stringify({message:e.messageFromCaller,stack:e.stackTrace})};se.offline&&(s.event_timestamp=(new Date).toISOString().substring(0,19)),this.http.post("/ws/product/error/gpu-event",s,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe();const r=btoa(JSON.stringify(e));this.errorService.redirectToErrorPage(xs.SceneJS,void 0,r)}createServerInstance(){if(this._server)throw new Error("Websocket server already exists");this._server=new xe.BioDigitalWebSocketServer(se.assetDomain)}createEngineInstance(e){if(this._engine)throw new Error("Engine is already instantiated");const o=e?{contextName:e}:void 0;(0,m.isNil)(o)||console.log("Optional Engine Options: ",o),this._engine=new xe.BioDigitalEngine(this._server,{...o,baseUrl:"/"}),this._engineCreated.next(this._engine)}registerEngineWorkers(){new Worker(A.tu(new URL(A.p+A.u(932),A.b))),(0,xe.registerWorker)("geometry",()=>new Worker(A.tu(new URL(A.p+A.u(837),A.b)))),(0,xe.registerWorker)("morph",()=>new Worker(A.tu(new URL(A.p+A.u(593),A.b)))),(0,xe.registerWorker)("texture",()=>new Worker(A.tu(new URL(A.p+A.u(795),A.b)))),(0,xe.registerWorker)("simulation",()=>new Worker(A.tu(new URL(A.p+A.u(902),A.b))))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Ih),i.LFG(dn),i.LFG(M0),i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Ap="18.0.14";var bn=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ke=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Lh={userType:Yo.User,authenticating:!1,authenticated:!1,widgetUrlConfig:{id:"",type:""},widgetApiConfig:null,parentUrl:{full:"",domain:""},embedded:!1,engineVersion:"",engineAPIVersion:"",inputEnabled:!0,widgetSettings:void 0};let tt=class{constructor(n,e){this.widgetConfigService=n,this.engineService=e}static getWidgetState(n){return n}static getUserType(n){return n.userType}static getWidgetAuthenticating(n){return n.authenticating}static getWidgetAuthenticated(n){return n.authenticated}static getInputEnabled(n){return n.inputEnabled}static getEmbedded(n){return n.embedded}static getBypassAnalytics(n){return n.widgetUrlConfig["bypass-analytics"]}static getParentURL(n){return n.parentUrl.full}static getWidgetUrlConfig(n){return n.widgetUrlConfig}static getWidgetApiUIConfig(n){return n.widgetApiConfig}static getWidgetSettings(n){return n.widgetSettings}setupWidget(n,{hostingURL:e,embedded:o,widgetConfig:s}){const r=e.match(/:\/\/(.[^/]+)/);n.patchState({userType:s.uaid?Yo.User:Yo.Developer,embedded:o,widgetUrlConfig:s,parentUrl:{full:e,domain:r&&r[1]?r[1]:e}})}getWidgetProductSettings(n,{productAccountId:e}){this.widgetConfigService.getWidgetSettings(e).subscribe(({settings:o})=>{n.dispatch(new zp(o))})}setWidgetProductSettings(n,{widgetSettings:e}){n.patchState({widgetSettings:e})}resetWidget(n){n.setState(Lh)}buildAppActivityData(n){const{engineVersion:e,engineAPIVersion:o,widgetUrlConfig:s}=n,r={engine_version:e,api_version:o};return Object.entries(s).filter(([a])=>"dk"!==a).forEach(([a,c])=>{r[`url_param_${a}`]=c}),(0,sn.yE)(Oh,r)}setInputEnabled(n,e){n.patchState({inputEnabled:e.enabled})}setWidgetApiConfig(n,e){n.patchState({widgetApiConfig:e.config})}buildUserAnalytic(n,e,o){const{widgetUrlConfig:s,parentUrl:r}=n,a=s.uaid,c=r.domain,p={...this.buildAppActivityData(n),parent_analytic_identifier:a,referer_domain:c,[`${e}_source`]:o};return(0,sn.yE)(gc,{analytic_platform:fo.Widget,analytic_type:e,analytic_data:p})}ngxsOnInit(n){n.patchState({engineVersion:Ap,engineAPIVersion:"2.0.1"})}};tt.\u0275fac=function(n){return new(n||tt)(i.LFG(kh),i.LFG(et))},tt.\u0275prov=i.Yz7({token:tt,factory:tt.\u0275fac}),bn([(0,l.aU)(Tp),ke("design:type",Function),ke("design:paramtypes",[Object,Tp]),ke("design:returntype",void 0)],tt.prototype,"setupWidget",null),bn([(0,l.aU)(Ip),ke("design:type",Function),ke("design:paramtypes",[Object,Ip]),ke("design:returntype",void 0)],tt.prototype,"getWidgetProductSettings",null),bn([(0,l.aU)(zp),ke("design:type",Function),ke("design:paramtypes",[Object,zp]),ke("design:returntype",void 0)],tt.prototype,"setWidgetProductSettings",null),bn([(0,l.aU)(P0),ke("design:type",Function),ke("design:paramtypes",[Object]),ke("design:returntype",void 0)],tt.prototype,"resetWidget",null),bn([(0,l.aU)(uc),ke("design:type",Function),ke("design:paramtypes",[Object,uc]),ke("design:returntype",void 0)],tt.prototype,"setInputEnabled",null),bn([(0,l.aU)(Mp),ke("design:type",Function),ke("design:paramtypes",[Object,Mp]),ke("design:returntype",void 0)],tt.prototype,"setWidgetApiConfig",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getWidgetState",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getUserType",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getWidgetAuthenticating",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getWidgetAuthenticated",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getInputEnabled",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getEmbedded",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getBypassAnalytics",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getParentURL",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getWidgetUrlConfig",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",void 0)],tt,"getWidgetApiUIConfig",null),bn([(0,l.Qf)(),ke("design:type",Function),ke("design:paramtypes",[Pi]),ke("design:returntype",Array)],tt,"getWidgetSettings",null),tt=bn([(0,l.ZM)({name:"widget",defaults:Lh}),ke("design:paramtypes",[kh,et])],tt);var T,t,b=A(7096),w=A(835),di=(()=>{return(t=di||(di={}))[t.Basics=0]="Basics",t[t.All=1]="All",t[t.Shortcuts=2]="Shortcuts",di;var t})();function hc(t,n=!1){return(n?function Fh(t){return t.filter(n=>Object.values(n).some(e=>!(0,m.isNil)(e.value)&&""!==e.value))}(t):t).reduce((o,s)=>({...o,...s}),{})}(t=T||(T={})).SetCanHover=(()=>{class E{constructor(le){this.canHover=le}}return E.type="[View] Set Can Hover",E})(),t.SetCanTouch=(()=>{class E{constructor(le){this.canTouch=le}}return E.type="[View] Set Can Touch",E})(),t.SetCanFullscreen=(()=>{class E{constructor(le){this.canFullscreen=le}}return E.type="[View] Set Can Fullscreen",E})(),t.SetUI=(()=>{class E{constructor(le){this.ui=le}}return E.type="[View] Set UI",E})(),t.SetInitialUI=(()=>{class E{constructor(le){this.ui=le}}return E.type="[View] Set Initial UI",E})(),t.SetInputEnabled=(()=>{class E{constructor(le){this.enabled=le}}return E.type="[View] Set Input Enabled",E})(),t.SetSearchDisplayMode=(()=>{class E{constructor(le){this.mode=le}}return E.type="[View] Set Search Display Mode",E})(),t.TogglePresentation=(()=>{class E{constructor(le){this.active=le}}return E.type="[View] Toggle Presentation",E})(),t.SetInteractType=(()=>{class E{constructor(le){this.interactType=le}}return E.type="[View] Set Interact Type",E})(),t.SetOnDemand=(()=>{class E{constructor(le){this.onDemand=le}}return E.type="[View] Set On Demand",E})(),t.SetLayout=(()=>{class E{constructor(le){this.layout=le}}return E.type="[View] Set Layout",E})(),t.ToggleHelpTab=(()=>{class E{constructor(le=di.Basics){this.tab=le}}return E.type="[View] Toggle Help Tab",E})(),t.SetInputMode=(()=>{class E{constructor(le){this.inputMode=le}}return E.type="[View] Set Input Mode",E})(),t.SetTutorial=(()=>{class E{constructor(le){this.tutorial=le}}return E.type="[View] Set Tutorial",E})(),t.StartTutorial=(()=>{class E{constructor(le){this.intro=le}}return E.type="[View] Start Tutorial",E})(),t.TutorialSeen=(()=>{class E{constructor(le){this.seen=le}}return E.type="[View] Tutorial Seen",E})(),t.TutorialNext=(()=>{class E{constructor(){}}return E.type="[View] Tutorial Next",E})(),t.TutorialPrevious=(()=>{class E{constructor(){}}return E.type="[View] Tutorial Previous",E})(),t.ToggleNodeInfo=(()=>{class E{constructor(le){this.show=le}}return E.type="[View] Toggle Node Info",E})(),t.SetViewLanguage=(()=>{class E{constructor(le){this.lang=le}}return E.type="[View] Set View Language",E})(),t.SetNodeInfoConfig=(()=>{class E{constructor(le){this.fallback=le}}return E.type="[View] Set Node Info Config",E})(),t.SetMultiPickModeEnabled=(()=>{class E{constructor(le){this.enabled=le}}return E.type="[View] Set multi pick mode enabled",E})(),t.SetLabelBreakpoint=(()=>{class E{constructor(le){this.labelsBreakpoint=le}}return E.type="[View] Set Label Breakpoint",E})(),t.SetUsePrintImage=(()=>{class E{constructor(le){this.usePrintImage=le}}return E.type="[View] Set Use Print Image",E})(),t.SetWindows=(()=>{class E{constructor(le){this.windows=le}}return E.type="[View] Set Windows",E})(),t.OpenWindow=(()=>{class E{constructor(le){this.window=le}}return E.type="[View] Open Window",E})(),t.CloseWindow=(()=>{class E{constructor(le){this.window=le}}return E.type="[View] Close Window",E})(),t.ToggleWindow=(()=>{class E{constructor(le,Sh){this.window=le,this.show=Sh}}return E.type="[View] Toggle Window",E})(),t.ToggleMenu=(()=>{class E{constructor(le){this.open=le}}return E.type="[View] Toggle Menu",E})(),t.SetWhiteboardEnabled=(()=>{class E{constructor(le){this.enabled=le}}return E.type="[View] Whiteboard Enabled",E})(),t.SetWhiteboardLocked=(()=>{class E{constructor(le){this.locked=le}}return E.type="[View] Whiteboard locked",E})(),t.SetWhiteboardBrushSize=(()=>{class E{constructor(le){this.brushSize=le}}return E.type="[View] Whiteboard Brush Size",E})(),t.SetWhiteboardBrushColor=(()=>{class E{constructor(le){this.brushColor=le}}return E.type="[View] Whiteboard Brush Color",E})(),t.SetWhiteboardTextSize=(()=>{class E{constructor(le){this.size=le}}return E.type="[View] Whiteboard Text Size",E})(),t.SetWhiteboardEraserSize=(()=>{class E{constructor(le){this.eraserSize=le}}return E.type="[View] Whiteboard Eraser Size",E})(),t.SetWhiteboardAnnotateMode=(()=>{class E{constructor(le){this.mode=le}}return E.type="[View] Whiteboard Annotate Mode",E})(),t.SetWhiteboardHasPaint=(()=>{class E{constructor(le){this.hasPaint=le}}return E.type="[View] Whiteboard Has Paint",E})(),t.SetWhiteboardHasText=(()=>{class E{constructor(le){this.hasText=le}}return E.type="[View] Whiteboard Has Text",E})(),t.ShowScrim=(()=>{class E{constructor(le,Sh){this.showSpinner=le,this.label=Sh}}return E.type="[View] Show Scrim",E})(),t.HideScrim=(()=>{class E{constructor(){}}return E.type="[View] Hide Scrim",E})(),t.SetChapterCallToActionSeen=(()=>{class E{constructor(le){this.chapterCallToActionSeen=le}}return E.type="[View] Set Chapter Call To Action Seen",E})();class I0{}var J=A(3806),Uh=A(8293);class z0{}class vs{constructor(){this.type=Xe.Bookmark,this.favorite=!1,this.unavailable=!1}}!function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,Uh.D)(()=>z0),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],vs.prototype,"group_access",void 0);var ki=(()=>(function(t){t.All="",t.Quiz="mode-quiz",t.Content="mode-content"}(ki||(ki={})),ki))();function ar(t){const{id:n,type:e}=t;if("module"===e&&(t.id=function F0(t){return t.replace("Condition.content.","").replace(".json","").split(".").join("/")}(n)),t.tour=t.tags.includes("tour"),t.animated=t.tags.includes("animated"),t.quiz=t.tags.includes("quiz"),t.lowDefinition=t.tags.includes("low definition"),!t.viewMode){const o=Object.values(ki).find(s=>t.tags.includes(s));t.viewMode=o??ki.All}return t}var ba=(()=>(function(t){t.IdAsc="+collection_id",t.IdDesc="-collection_id",t.NameAsc="+collection_name",t.NameDesc="-collection_name",t.UpdateDateAsc="+collection_updatedate",t.UpdateDateDesc="-collection_updatedate",t.CreateDateAsc="+collection_createdate",t.CreateDateDesc="-collection_createdate",t.CustomAsc="+custom_sort_order",t.CustomDesc="-custom_sort_order"}(ba||(ba={})),ba))();function Lp(t){return"?"+Object.entries(t).filter(([n,e])=>!(0,m.isNil)(e)).map(([n,e])=>`${n}=${encodeURIComponent(e)}`).join("&")}const cr="/ws/organization/collection";let bo=(()=>{class t{constructor(e){this.http=e}createOrganization(e){return this.http.post("/ws/organization/create",e)}updateOrganization(e){return this.http.post("/ws/organization/update",e)}getCollections(e){e.sort_order||(e.sort_order=[ba.CustomAsc,ba.NameDesc]);const o=Lp(e);return this.http.get(`${cr}${o}`).pipe((0,J.U)(s=>(0,sn.yE)(I0,s).map(r=>this.normalizeCollectionModel(r))))}getCollectionContent(e,o,s="",r="en"){const a=s.toLocaleLowerCase().split(" ");return this.getCollections({group_id:e,collection_id:o,include_content:1,ol:r}).pipe((0,J.U)(c=>c[0].collection_content.map(d=>(0,sn.yE)(vs,d)).filter(d=>{let u=!0;return a.length&&d.title&&a.forEach(g=>{u=u&&d.title.toLocaleLowerCase().indexOf(g)>=0}),u=u&&!0!==d.unavailable,u})))}addCollection(e,o){return this.http.post(cr,{group_id:e,collection_name:o})}removeCollection(e){return this.http.request("DELETE",cr,{body:{group_id:e.group_id,collection_id:e.collection_id}})}renameCollection(e,o){return this.http.post(cr,{group_id:e.group_id,collection_id:e.collection_id,collection_name:o})}reorderCollections(e,o){return this.http.post(`${cr}/sort-order`,{group_id:e,collection_id_sort_list:o.map(s=>s.collection_id)})}updateCollectionContent(e,o,s){return this.http.post(`${cr}/content`,{group_id:e,add_content:o,remove_content:s})}getOrganizationAttribute(e,o,s){return e.find(r=>r.type===o&&r.name===s)}getPublicProfile(e){return this.http.get("/ws/organization/public/profile",{params:{...e}}).pipe((0,J.U)(o=>o))}normalizeCollectionModel(e){return e.collection_content&&e.collection_content.forEach(o=>{ar(o)}),e}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var lr=(()=>(function(t){t.DiscoveredChapterNav="Discovered Chapter Nav"}(lr||(lr={})),lr))();let Ln=(()=>{class t{constructor(e,o,s,r){this.config=e,this.router=o,this.route=s,this.organizationsService=r,this.appended=!1,this.initialized=!1,this.sessionEvents={},this.pageEvents={},this.queuedEvents=[],this.initRouteListener()}appendScript(){if(!this.config.enabled||this.appended)return;const e=`\n      (function(apiKey){\n        (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];\n        v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){\n            o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);\n            y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';\n            z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');\n      })('${this.config.pendoId}');\n    `,o=document.createElement("script");o.textContent=e,document.body.appendChild(o),this.appended=!0}initialize(e){if(!this.pendoEnabled())return;const o={...e};o.visitor.id&&this.setIds(o),pendo.initialize(o),this.initialized=!0,this.flushQueuedEvents()}identify(e){if(!this.pendoEnabled())return;const o={...e};this.setIds(o),pendo.identify(o)}createVisitorData(e){const o={},s=hc(e.account_settings),r=(0,m.get)(e,"organizations[0].user_role.role_display_name",null);return e.hasOwnProperty("id")&&(o.id=e.id.toString()),e.hasOwnProperty("email")&&(o.email=e.email),e.hasOwnProperty("first_name")&&e.hasOwnProperty("last_name")&&(o.full_name=`${e.first_name} ${e.last_name}`),e.hasOwnProperty("registration_date")&&(o.registration_date=e.registration_date),e.hasOwnProperty("premium_account")&&(o.premium=e.premium_account),e.hasOwnProperty("user_is_developer")&&(o.developer=e.user_is_developer),e.hasOwnProperty("subscription")&&(o.subscriptionType=e.subscription?e.subscription.subscription_type:null),e.hasOwnProperty("is_third_party")&&(o.thirdParty=e.is_third_party),s.hasOwnProperty("account_purpose")&&(o.purpose=s.account_purpose?s.account_purpose.value:null),s.hasOwnProperty("account_role")&&(o.role=s.account_role?s.account_role.value:null),s.hasOwnProperty("account_field")&&(o.field=s.account_field?s.account_field.value:null),r&&(o.teamRole=r),o}updateVisitorData(e){!this.pendoEnabled()||pendo.updateOptions({visitor:this.createVisitorData(e)})}createAccountData(e){const o=(0,m.get)(e,"group_attributes",null);return{id:(0,m.get)(e,"id",null),name:(0,m.get)(e,"name",null),subscriptionType:(0,m.get)(e,"subscription.type",null),subscriptionEndDate:(0,m.get)(e,"subscription.paid_through_date",null),usersCount:(0,m.get)(e,"users_count",null),purpose:this.getGroupAttributeValue(o,"account_purpose"),field:this.getGroupAttributeValue(o,"account_field"),companyWebsite:this.getGroupAttributeValue(o,"account_company_website"),companySize:this.getGroupAttributeValue(o,"account_company_size")}}flushQueuedEvents(){this.queuedEvents.forEach(e=>{this.track(e.trackType,e.metadata)})}track(e,o){this.pendoEnabled()&&(this.initialized?pendo.track(e,o):this.queuedEvents.push({trackType:e,metadata:o}))}trackOncePerSession(e,o){this.sessionEvents[e]||this.pendoEnabled()&&(this.track(e,o),this.sessionEvents[e]=!0)}trackOncePerPage(e,o){this.pageEvents[e]||this.pendoEnabled()&&(this.track(e,o),this.pageEvents[e]=!0)}trackSignIn(e){this.trackSignInSignUp("Sign In - Success",e)}trackSignUp(e){this.trackSignInSignUp("Sign Up - Success",e)}trackSignInSignUp(e,o){const s=this.route.snapshot.queryParams;this.track(e,{type:o,referrer:document.referrer,refParam:s.ref||null,groupInvite:s.hasOwnProperty("group_invite"),groupCode:s.hasOwnProperty("group")&&s.hasOwnProperty("code")})}initRouteListener(){this.router.events.pipe((0,$.h)(e=>e instanceof We.m2)).subscribe(()=>{this.pageEvents={}})}pendoEnabled(){if(!this.config.enabled)return!1;const e=(0,m.get)(this.config,`whitelist[${se.application}]`,null);if(!(0,m.isNil)(e)){const o=new URLSearchParams(window.location.search),s=o.get("id")||o.get("be")||o.get("m");return e.includes(s)}return!0}setIds(e){const o=(0,m.get)(this.config,`idPrefixes[${se.deploy}]`,"");e.visitor.id=`${o}${e.visitor.id}`,e.account.id&&(e.account.id=`${o}${e.account.id}`)}getGroupAttributeValue(e,o){if(!e)return null;const s=this.organizationsService.getOrganizationAttribute(e,"account_settings",o);return s?s.value:null}}return t.\u0275fac=function(e){return new(e||t)(i.LFG("pendoConfig"),i.LFG(We.F0),i.LFG(We.gz),i.LFG(bo))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();A(8313),A(9191);const U0={ja:"ja-JP","pt-PT":"pt-BR"},ui={title:"English",lang:"en",country:"us",id:"en-US"},ya=[ui,{title:"Espa\xf1ol",lang:"es",country:"es",id:"es-ES"},{title:"\u4e2d\u6587(\u7b80\u4f53)",lang:"zh",country:"cn",id:"zh-CN"},{title:"Fran\xe7ais",lang:"fr",country:"fr",id:"fr-FR"},{title:"Deutsch",lang:"de",country:"de",id:"de-DE"},{title:"Italiano",lang:"it",country:"it",id:"it-IT"},{title:"\u65e5\u672c\u8a9e",lang:"ja",country:"ja",id:"ja"},{title:"Portugu\xeas",lang:"pt",country:"pt",id:"pt-PT"}];function Rh(t){return ya.find(n=>n.lang===t)}function Nh(){return(se.application===mt.Viewer?function E0(){return Rh(new URLSearchParams(window.location.search).get("lang"))??ui}():function N0(){let t="";try{t=localStorage.getItem("locale")}catch{}return function R0(t){return ya.find(n=>n.id===t)}(t)||ui}()).id}let mc=(()=>{class t{constructor(e,o,s=ui.lang,r=!1){this.id=e,this.type=o,this.lang=s,this.preview=r}}return t.type="[Story] Load Current Story",t})(),Fp=(()=>{class t{constructor(){}}return t.type="[Story] Unload Current Story",t})(),Eh=(()=>{class t{constructor(e){this.story=e}}return t.type="[Story] Replace the Story",t})(),Dh=(()=>{class t{constructor(e){this.id=e}}return t.type="[Story] Set the Story ID",t})(),jh=(()=>{class t{constructor(e){this.displayName=e}}return t.type="[Story] Set Story Text",t})(),Qh=(()=>{class t{constructor(e){this.tags=e}}return t.type="[Story] Set Story Tags",t})(),Zh=(()=>{class t{constructor(e){this.lightLibs=e}}return t.type="[Story] Set Story Light Libs",t})(),fc=(()=>{class t{constructor(e,o,s){this.id=e,this.type=o,this.reset=s}}return t.type="[Story] Set Incoming Story Id",t})(),Up=(()=>{class t{constructor(){}}return t.type="[Story] Load Story Chunk",t})(),Rp=(()=>{class t{constructor(e){this.chapterId=e}}return t.type="[Story] Reorder Load Chunks",t})(),pr=(()=>{class t{constructor(e){this.chapter=e}}return t.type="[Story] Load Story Chunk Success",t})(),Np=(()=>{class t{constructor(e,o,s,r,a=!0){this.id=e,this.story=o,this.type=s,this.chapterIdx=r,this.replaceActiveStory=a}}return t.type="[Story] Build Story In Engine From Story Model",t})(),bc=(()=>{class t{constructor(e,o,s,r){this.story=e,this.id=o,this.type=s,this.lang=r}}return t.type="[Story] Load Success",t})(),Bh=(()=>{class t{constructor(e,o){this.id=e,this.type=o}}return t.type="[Story] Load Fail",t})(),Vh=(()=>{class t{constructor(e,o,s=ui.lang){this.id=e,this.type=o,this.lang=s}}return t.type="[Story] Import",t})(),Ep=(()=>{class t{constructor(e,o,s){this.story=e,this.id=o,this.type=s}}return t.type="[Story] Import Success",t})(),qh=(()=>{class t{constructor(){}}return t.type="[Story] Clear",t})(),D0=(()=>{class t{constructor(){}}return t.type="[Story] Synchronize Chapters",t})(),$h=(()=>{class t{constructor(){}}return t.type="[Story] Human Ready (Web)",t})(),Dp=(()=>{class t{constructor(){}}return t.type="[Story] Human Ready (SDK)",t})(),j0=(()=>{class t{constructor(e){this.story=e}}return t.type="[Story] Merge Bridge Module Success",t})();class zt{}let Gh=(()=>{class t{constructor(){}}return t.type="[Engine] Load",t})(),jp=(()=>{class t{constructor(e){this.result=e}}return t.type="[Engine] Load Success",t})(),Qp=(()=>{class t{constructor(e){this.ready=e}}return t.type="[Engine] Set Ready",t})(),yc=(()=>{class t{constructor(e){this.display=e}}return t.type="[Engine] Set Display of 3D Scene",t})(),_c=(()=>{class t{constructor(e){this.scrollMode=e}}return t.type="[Engine] Set Zoom via scroll Allowed",t})(),Jh=(()=>{class t{constructor(e){this.shown=e}}return t.type="[Engine] Set Scroll Alert Shwon",t})(),dr=(()=>{class t{constructor(e){this.visible=e}}return t.type="[Engine] Set Visibility of 3D Scene",t})(),Hh=(()=>{class t{constructor(e,o){this.color=e,this.duration=o}}return t.type="[Engine] Fade",t})(),Q0=(()=>{class t{constructor(){}}return t.type="[Engine] Fade Complete",t})(),yo=(()=>{class t{constructor(e){this.graph=e}}return t.type="[Engine] Set Graph",t})(),Z0=(()=>{class t{constructor(){}}return t.type="[Engine] Clear Graph",t})(),xc=(()=>{class t{constructor(e){this.enabled=e}}return t.type="[Engine] Set Xray Mode",t})(),Zp=(()=>{class t{constructor(e){this.chapterId=e}}return t.type="[Engine] Set Engine Chapter",t})(),vc=(()=>{class t{constructor(e,o,s){this.node=e,this.event=o,this.hit=s}}return t.type="[Engine] Click Node",t})(),_a=(()=>{class t{constructor(e,o){this.node=e,this.hit=o}}return t.type="[Engine] Set Contextmenu",t})(),Wi=(()=>{class t{constructor(e,o=!0,s){this.objectId=e,this.animate=o,this.animationDuration=s}}return t.type="[Engine] Fly To Object",t})(),Bp=(()=>{class t{constructor(e,o){this.leafVisibilityState=e,this.nodes=o}}return t.type="[Engine] Synchronize Visible Nodes On Tree",t})(),Vp=(()=>{class t{constructor(e){this.leafRenderableState=e}}return t.type="[Engine] Synchronize Renderable State of Nodes On Tree",t})(),qp=(()=>{class t{constructor(e,o){this.leafPickableState=e,this.nodes=o}}return t.type="[Engine] Synchronize Pickable State of Nodes On Tree",t})(),Yh=(()=>{class t{constructor(e){this.show=e}}return t.type="[Engine] Toggle Camera Bar",t})(),$p=(()=>{class t{constructor(e){this.show=e}}return t.type="[Engine] Toggle Progress Bar",t})(),Wo=(()=>{class t{constructor(e){this.show=e}}return t.type="[Engine] Toggle Labels",t})(),Cs=(()=>{class t{constructor(e){this.tool=e}}return t.type="[Engine] Set active tool",t})(),Cc=(()=>{class t{constructor(){}}return t.type="[Engine] Play chapter animation",t})(),_o=(()=>{class t{constructor(e=!0){this.play=e}}return t.type="[Engine] Play animation",t})(),Gp=(()=>{class t{constructor(e){this.playing=e}}return t.type="[Engine] Set animation playing",t})(),Jp=(()=>{class t{constructor(e){this.speed=e}}return t.type="[Engine] Set playback speed",t})(),ws=(()=>{class t{constructor(e){this.play=e}}return t.type="[Engine] Play audio",t})(),Hp=(()=>{class t{constructor(e){this.playAudioType=e}}return t.type="[Engine] Set Audio Type",t})(),Wh=(()=>{class t{constructor(){}}return t.type="[Engine] Play chapter from start",t})(),Yp=(()=>{class t{constructor(e){this.enable=e}}return t.type="[Engine] Set autoplay",t})(),Wp=(()=>{class t{constructor(e,o){this.nodes=e,this.layer=o}}return t.type="[Engine] Set object layer order",t})(),Kp=(()=>{class t{constructor(e,o){this.nodeId=e,this.displayName=o}}return t.type="[Engine] Set object display name",t})(),Kh=(()=>{class t{constructor(){}}return t.type="[Engine] Auto Sort object layer orders",t})(),Xh=(()=>{class t{constructor(){}}return t.type="[Engine] Reset object layer orders",t})(),Xp=(()=>{class t{constructor(e){this.position=e}}return t.type="[Engine] Set Engine Position",t})(),ed=(()=>{class t{constructor(){}}return t.type="[Engine] Reset Engine Position",t})(),em=(()=>{class t{constructor(e){this.effects=e}}return t.type="[Engine] Set Post Processing Effects",t})(),tm=(()=>{class t{constructor(e){this.properties=e}}return t.type="[Engine] Set Properties",t})(),nm=(()=>{class t{constructor(e){this.mode=e}}return t.type="[Engine] Set Transparency Mode",t})(),ur=(()=>{class t{constructor(e){this.node=e}}return t.type="[Engine] Expand ViewTree Node",t})(),wc=(()=>{class t{constructor(e){this.node=e}}return t.type="[Engine] Collapse ViewTree Node",t})(),im=(()=>{class t{constructor(){}}return t.type="[Engine] Collapse All ViewTree Nodes",t})(),gr=(()=>{class t{constructor(e,o){this.node=e,this.hit=o}}return t.type="[Engine] Hover Node",t})(),Sc=(()=>{class t{constructor(e){this.node=e}}return t.type="[Engine] Set Label Edit Node",t})(),xa=(()=>{class t{constructor(e,o){this.node=e,this.info=o}}return t.type="[Engine] Set Node Info",t})(),td=(()=>{class t{constructor(e,o,s){this.node=e,this.fallback=o,this.lang=s}}return t.type="[Engine] Query Node Info",t})(),Pc=(()=>{class t{constructor(e,o){this.node=e,this.info=o}}return t.type="[Engine] Query Node Info Success",t})(),om=(()=>{class t{constructor(e){this.node=e}}return t.type="[Engine Nodes] Query Node Info Failure",t})(),sm=(()=>{class t{constructor(e){this.enabled=e}}return t.type="[Engine] Set Watermark Enabled",t})(),nd=(()=>{class t{constructor(e){this.context=e}}return t.type="[Engine] Set Engine WebGL Context",t})();class V0{}function Oc(t=[]){return{shown:()=>!1,selected:()=>!1,pickable:()=>!0,renderable:()=>!1,expanded:()=>!1,...t.reduce((n,e)=>(n[e]=()=>!1,n),{})}}function rm(t,n){t.nodes[n.id]||(t.nodes[n.id]=n)}function ni(t,n){return t.nodes[n]??null}function va(t,n){return t.predecessors[n]??null}function xo(t,n){return[...t.successors[n]||[]]}function Tc(t,n,e){const o={},s=ni(t,n);return Object.entries(s.boolState).forEach(([r,a])=>{e&&e.includes(r)&&(o[r]=a)}),Object.entries(s.numState).forEach(([r,a])=>{e&&e.includes(r)&&(o[r]=a)}),o}function Ca(t,n){return!!t.nodes[n]&&void 0===t.successors[n]}function id(t){return Object.keys(t.roots)}function am(t,n,e,o,s){const r=function B0(t){return{id:t,depth:0,boolState:{},numState:{}}}(e.objectId);r.depth=s,function H0(t,n,e){Object.entries(e).forEach(([o,s])=>{const r=s(n.objectId);"boolean"==typeof r?t.boolState[o]=r:"number"==typeof r?t.numState[o]=r:t[o]=r})}(r,e,o),t.nodes[r.id]=r,n?(t.successors[n]=[...t.successors[n]||[],r.id],t.predecessors[r.id]=n):t.roots[r.id]=r,s+=1,e.children.forEach(c=>{am(t,r.id,c,o,s)})}function Mc(t,n,e){e?(n(e),xo(t,e).forEach(o=>{(0,m.isNil)(o)||Mc(t,n,o)})):id(t).forEach(o=>{n(o),Mc(t,n,o)})}function od(t,n){const o={nodes:{},successors:{},predecessors:{},roots:{}};return t.forEach(s=>{am(o,null,s,n,0)}),o}function sd(t,n,e){const o=[];for(const s of t){const r=n[s.objectId],a=void 0===r?e:r,c=sd(s.children||[],n,a);if(a){const p={...s};p.children=c,o.push(p)}else c.forEach(p=>o.push(p))}return o}const Y0={trueWins:t=>({result:t.votesFor.length>0,dissenters:[...t.votesAgainst]}),falseWins:t=>({result:t.votesAgainst.length>0,dissenters:[...t.votesFor]}),majorityWins:t=>{const n=t.votesFor.length>t.votesAgainst.length;return{result:n,dissenters:n?[...t.votesAgainst]:[...t.votesFor]}}};function wa(t,n){return t.reduce((e,o)=>(e[o]=n[o]||!1,e),{})}function rd(t,n,e){return function G0(t,n){const e=new Set;return n.forEach(o=>{const s=va(t,o);s&&e.add(s)}),Array.from(e)}(t,n).filter(s=>s&&ni(t,s).depth===e)}function cm(t,n,e){return Object.keys(n).reduce((s,r)=>{const a=n[r],c=e[r]||"majorityWins",{result:p,dissenters:d}=Y0[c](a);return s[r]={id:t,result:p,dissenters:d,voters:[...a.votesFor,...a.votesAgainst]},s},{})}let Oi=(()=>{class t{serializeNode(e,o,s={},r=(a=>!0)){const a={};return a.id=o.id,Object.entries(o.boolState).forEach(([c,p])=>{s.hasOwnProperty(c)&&(a[c]=p)}),Object.entries(o.numState).forEach(([c,p])=>{s.hasOwnProperty(c)&&(a[c]=p)}),e.successors[o.id]&&(a.children=[],e.successors[o.id].forEach(c=>{r(c)&&a.children.push(this.serializeNode(e,e.nodes[c],s,r))},this)),a}getAllSiblingsFromList(e,o,s){const r=[];let a;for(a=0;a<o.length;a++)this.getSiblings(e,o[a],s).forEach(c=>{r.includes(c)||r.push(c)});return r}getElectionResults(e,o,s,r){class a extends class n1{}{constructor(h,y){super(),Object.entries(h).forEach(([k,B])=>{this[k]={votesFor:[],votesAgainst:[]},Object.entries(y).forEach(([K,V])=>{V[k]?this[k].votesFor.push(K):this[k].votesAgainst.push(K)},this)},this)}}let c,p;const d=Object.keys(r),u=[];return s.forEach(g=>{p={},xo(e,g).forEach(k=>{p[k]=o[k]||wa(d,Tc(e,k,d)),delete o[k]},this),c=new a(r,p);const h=cm(g,c,r);u.push(h);const y={};Object.entries(h).forEach(([k,B])=>{y[k]=B.result}),o[g]=y},this),u}updateGraphStateRecord(e,o,s,r,a=!0){s.forEach(c=>{const p=c[r[0]].id,d=Tc(e,p,r),u={};let g=!1;r.forEach(h=>{(a||c[h].result!==d[h])&&(u[h]=c[h].result,g=!0)}),g&&(o[p]=u)},this)}nodeExists(e,o){return!!e.nodes[o]}getLeaves(e){const o=[];return Object.entries(e.nodes).forEach(([s,r])=>{e.successors[s]||o.push(s)}),o}getDescendants(e,o,s=!1){const r=[];return function c(p){xo(e,p).forEach(d=>{r.push(d),c(d)})}(o),s&&r.push(o),r}getLeafDescendants(e,o,s=!1){const r=this.getDescendants(e,o,s).filter(a=>Ca(e,a));return(Ca(e,o)||s)&&r.push(o),r}getAllLeafDescendants(e,o){let s=[];return o.forEach(r=>{s=Ca(e,r)?[...s,r]:[...s,...this.getLeafDescendants(e,r,!1)]}),s.sort().reduce((r,a)=>(r.indexOf(a)<0&&r.push(a),r),[])}getInverseSelection(e,o){const s=this.getAllLeafDescendants(e,o);return this.getLeaves(e).filter(r=>s.indexOf(r)<0)}getSiblings(e,o,s=!1){const r=e.predecessors[o];let a=[];if(a=r?xo(e,r):id(e),!s){const c=a.indexOf(o);c>=0&&a.splice(c,1)}return a}getNodes(e,o){const s=[];return o.forEach(r=>{e.nodes[r]&&s.push(e.nodes[r])}),s}setState(e,o,s){const r=ni(e,o),a={};return Object.entries(s).forEach(([c,p])=>{"boolean"==typeof p&&r.boolState[c]!==p?(r.boolState[c]=p,a[c]=p):"number"==typeof p&&r.numState[c]!==p&&(r.numState[c]=p,a[c]=p)}),a}synchronize(e,o,s){const r=this.calculateGraphStateMap(e,o,s);return Object.entries(r).forEach(([a,c])=>{this.setState(e,a,c)},this),r}calculateGraphStateMap(e,o,s,r=!s){let a=[];const c={};let p=[];const d={},u=Object.keys(o);let g=0;for(s?Object.entries(s).forEach(([h,y])=>{c[h]=wa(u,s[h]),d[h]={...c[h]},g=Math.max(g,ni(e,h).depth)},this):this.getLeaves(e).forEach(h=>{c[h]=wa(u,ni(e,h).boolState),d[h]={...c[h]},g=Math.max(g,ni(e,h).depth)},this),g-=1,a=rd(e,Object.keys(c),g);g>=0;)p=this.getElectionResults(e,c,a,o),this.updateGraphStateRecord(e,d,p,u,r),g-=1,a=rd(e,Object.keys(c),g);return d}filterGraphAccessors(e,o){const r=this.getNodes(e,o).sort((p,d)=>p.depth-d.depth),a=new Map;return r.filter(p=>!a.has(p.id)&&(this.getDescendants(e,p.id,!0).forEach(d=>a.set(d,!0)),!0)).map(p=>p.id)}resetDepth(e){Mc(e,s=>{let r=0;e.predecessors[s]&&(r=ni(e,e.predecessors[s]).depth+1),ni(e,s).depth=r})}deleteNode(e,o,s=!0){if(!this.nodeExists(e,o))return;delete e.nodes[o];const r=e.predecessors[o];r&&(delete e.predecessors[o],e.successors[r]&&(e.successors[r]=e.successors[r].filter(c=>c!==o)));const a=e.successors[o];a&&(delete e.successors[o],s&&a.forEach(c=>{this.deleteNode(e,c)},this)),e.roots[o]&&delete e.roots[o]}sanitizeNodeID(e){const o=new RegExp(/\|:/,"gi");return e.replace(o,"_")}resetAsLeaf(e,o){let s=[];return e.nodes[o]&&!Ca(e,o)&&(s=this.getDescendants(e,o),delete e.successors[o],s.forEach(r=>{delete e.nodes[r],delete e.successors[r],delete e.predecessors[r]})),s}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class lm{constructor(n,e,o,s,r){this.left=n,this.top=e,this.width=o,this.height=s,this.visibility=r}}var Ss=(()=>(function(t){t[t.Hidden=-1]="Hidden",t[t.Shown=1]="Shown"}(Ss||(Ss={})),Ss))();class Sa{}let pm=(()=>{class t{constructor(e){this.id=e}}return t.type="[Engine Camera] Clear Camera",t})(),dm=(()=>{class t{constructor(e,o){this.id=e,this.camera=o}}return t.type="[Engine Camera] Store Camera",t})(),Zn=(()=>{class t{constructor(e,o=!0,s,r){this.camera=e,this.animate=o,this.animationDuration=s,this.rotationCenter=r}}return t.type="[Engine Camera] Set Camera",t})(),ad=(()=>{class t{constructor(){}}return t.type="[Engine Camera] Set Camera Success",t})(),Ic=(()=>{class t{constructor(e){this.enabled=e}}return t.type="[Engine Camera] Set Chapter Camera Enabled",t})(),hr=(()=>{class t{constructor(e){this.cameraMotion=e}}return t.type="[Engine Camera] Move Camera",t})(),cd=(()=>{class t{constructor(){}}return t.type="[Engine Camera] Reset Camera",t})(),um=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Zoom Camera",t})(),ld=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Zoom Camera Static",t})(),gm=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Pan Camera X",t})(),hm=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Pan Camera Y",t})(),mm=(()=>{class t{constructor(e,o,s){this.x=e,this.y=o,this.z=s}}return t.type="[Engine Camera] Pan Camera Static",t})(),fm=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Rotate Camera X",t})(),bm=(()=>{class t{constructor(e){this.value=e}}return t.type="[Engine Camera] Rotate Camera Y",t})(),ym=(()=>{class t{constructor(e,o){this.x=e,this.y=o}}return t.type="[Engine Camera] Rotate Camera Static",t})(),zc=(()=>{class t{constructor(e){this.mode=e}}return t.type="[Engine Camera] Set Camera Mode",t})(),pd=(()=>{class t{constructor(e){this.zoomed=e}}return t.type="[Engine Camera] Set Zoomed",t})(),dd=(()=>{class t{constructor(e){this.lock=e}}return t.type="[Engine Camera] Lock camera",t})(),Ac=(()=>{class t{constructor(e){this.camera=e}}return t.type="[Engine Camera] Set Camera Fly To",t})(),Lc=(()=>{class t{constructor(e){this.patches=e}}return t.type="[Engine Camera] Patch Camera State",t})();class wt{static toArray(n){return[n.x,n.y,n.z]}static fromArray(n){return{x:n[0],y:n[1],z:n[2]}}}var i1=A(5876),_m=A(1207),o1=A(4112);function ud(t){const{xmin:n,ymin:e,zmin:o,xmax:s,ymax:r,zmax:a}=t;return{min:[n,e,o],max:[s,r,a]}}function xm(t){if((0,m.isNil)(t))return!1;{const n=Object.values(t);return 6===n.length&&n.every(e=>Number.isFinite(e))}}var he=A(9330);function gd(t,n){const e=he.create();return he.add(e,n,t),he.scale(e,e,.5),e}function hd(t,n,e,o,s,r){const a=(t-n)/(e-n);return(r=r??he.create())[0]=o[0]+a*(s[0]-o[0]),r[1]=o[1]+a*(s[1]-o[1]),r[2]=o[2]+a*(s[2]-o[2]),r}const md=Math.PI/180,vm=1/xe.BIODIGITAL_SCENE_SCALE,Cm=new xe.AABB,a1={shown:"trueWins",renderable:"falseWins",pickable:"trueWins"};let Ut=(()=>{class t{constructor(e,o){this.engineService=e,this.graphService=o}getObjects(e){const o=this.getChapter(e),s={};return o.anatomyObjects.forEach((r,a)=>s[a]=r),s}getObjectById(e,o){return this.getChapter(o)?.anatomyObjects?.get(e)}getObjectsById(e,o){const s=this.getChapter(o);return e.reduce((r,a)=>{const c=s?.anatomyObjects?.get(a);return c&&(r[c.objectId]=c),r},{})}isObjectLoaded(e){return!0===this.getObjectById(e)?.loaded}isObjectCulledByClip(e,o){if(0===o.length)return!1;const s=o.map(r=>r.plane);return e.renderables.some(r=>(0,xe.boxIntersectsPlaneBounds)(s,r.meshNode.worldBounds))}getRootObjects(e){return this.getChapter(e)?.anatomy??[]}getSceneBoundary(){const{sceneRoot:e}=this.engineService.engine;return this.getSceneNodeBoundaryModel(e,Cm)}getObjectBoundary(e){const{sceneNode:o}=this.getObjectById(e);return this.getSceneNodeBoundaryModel(o,Cm)}getObjectBoundaryCenter(e){const o=this.getObjectBoundary(e),{min:s,max:r}=ud(o);return gd(s,r)}setEnabledObjects(e){const{replace:o,enabledByObject:s}=e,r=this.getRootObjects();this.setObjectsShown(r,s,!o&&void 0)}getLeavesByObject(e){const o=e.children??[];return 0===o.length?[e]:o.map(s=>this.getLeavesByObject(s)).flat()}getLeaves(e){if(e){const o=this.getObjectById(e);return o?this.getLeavesByObject(o):[]}return this.getRootObjects().map(s=>this.getLeavesByObject(s)).flat()}getLeafIds(e){return this.getLeaves(e).map(o=>o.objectId)}getEnabledLeafIds(){return this.getLeaves().filter(e=>!0===e?.shown).map(e=>e.objectId)}isLeaf(e){return 0===e.children.length}transformObject(e,o){const s=this.getObjectById(e);if(s){if((0,m.isEmpty)(o))return;const{sceneNode:r}=s,a=(c,p)=>{const{x:d,y:u,z:g}=p;c[0]=d??c[0],c[1]=u??c[1],c[2]=g??c[2]};if(!(0,m.isEmpty)(o.rotate)){const{x:c,y:p,z:d}=o.rotate;d&&(r.rotation[2]=d*md),p&&(r.rotation[1]=p*md),c&&(r.rotation[0]=c*md)}(0,m.isEmpty)(o.scale)||a(r.scale,o.scale),(0,m.isEmpty)(o.translate)||a(r.position,o.translate),(0,m.isEmpty)(o.pivot)||a(r.origin,o.pivot),r.dirtyMatrix()}else console.error(`Scene object not found: '${e}'`)}setNodesVisible(e,o=!1){const s={replace:o,enabledByObject:{...e},fetchAssets:!0};this.setEnabledObjects(s)}setNodesPickable(e){Object.keys(e).forEach(o=>{const s=this.getObjectById(o);(this.isLeaf(s)?[o]:this.getLeafIds(o)).forEach(a=>{this.getObjectById(a).pickable=e[o]})})}setObjectLayer(e,o){const s=this.getObjectById(e);if(s.layer=o,s.renderables)for(let r=0;r<s.renderables.length;++r)s.renderables[r].layer=o;else Object.prototype.hasOwnProperty.call(s,"_layerNode")||Object.prototype.hasOwnProperty.call(s,"_propertiesNode")}getObjectLayerValues(e){const o={},s=this.getSceneBoundary();return e.forEach(r=>{const a=this.getObjectById(r),c=this.getObjectBoundary(r),p=Math.min(c.xmin-s.xmin,s.xmax-c.xmax),d=2*Math.min(c.ymin-s.ymin,s.ymax-c.ymax),u=Math.min(c.zmin-s.zmin,s.zmax-c.zmax),g=a.layer;o[g]=o[g]||[],o[g].push({nodeId:r,value:Math.min(p,d,u)})}),o}getWorldPosition(e,o,s,r=0){const c=this.getObjectById(e)?.renderables[r]?.meshNode;if((0,m.isNil)(c))return;const p=c.worldMatrix,d=he.create(),u=xe.vec3Pool.get(),g=xe.vec3Pool.get(),h=xe.vec3Pool.get();return(0,xe.getTrianglePositions)(c,o,u,g,h),(0,xe.cartesianCoord)(d,s,u,g,h),he.transformMat4(d,d,p),he.scale(d,d,1/xe.BIODIGITAL_SCENE_SCALE),xe.vec3Pool.release(u),xe.vec3Pool.release(g),xe.vec3Pool.release(h),d}getChapterSceneGraph(e){const o=this.getChapterIndex(e);if(-1===o)throw new Error("Chapter not found");return this.getSceneGraph(this.getRootObjects(o),o)}getSceneGraph(e,o){const s=this.getObjects(o),a=od(e,{...Oc(),shown:c=>!0===s[c]?.shown,pickable:c=>!0===s[c]?.pickable,label:c=>s[c]?.displayName??"",layer:c=>s[c]?.layer??0});return this.graphService.synchronize(a,a1),a}createViewGraph({objectVisibilities:e,includeRoot:o=!1,chapterId:s}){const r=this.getChapterIndex(s);if(-1===r)throw new Error("Chapter not found");let a=this.getRootObjects(r);a=e?sd(a,e):a;const c=a.reduce((d,u)=>{const g=!o&&u.objectId.includes("-root");return d[u.objectId]=!g,g&&u.children.forEach(h=>{d[h.objectId]=!0}),d},{}),p=this.getSceneGraph(sd(a,c),r);return this.graphService.resetDepth(p),p}getViewNode(e,o){return this.graphService.nodeExists(e,o)?ni(e,o):null}setObjectsShown(e,o,s){e.forEach(r=>{const c=o[r.objectId]??s;"boolean"==typeof c&&(r.shown=c),this.setObjectsShown(r.children,o,s)})}getSceneNodeBoundaryModel(e,o){const{min:s,max:r}=this.getSceneNodeBounds(e,o);return he.scale(s,s,vm),he.scale(r,r,vm),{xmin:s[0],ymin:s[1],zmin:s[2],xmax:r[0],ymax:r[1],zmax:r[2]}}getSceneNodeBounds(e,o){return o.clear(),(0,xe.traverseSceneNodes)(e,s=>{s instanceof xe.MeshNode&&o.expand(s.worldBounds)}),o}getChapterIndex(e){return this.engineService.engine.story?.chapters?.findIndex(r=>r.id===e)}getChapter(e){const o=this.engineService.engine?.story,s=o?.chapters,r=o?.activeChapterIndex;return s?.[e??r]}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(Oi))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const wm={backOff:0,stopFOV:55,dist:2.5};function Sm(t,n,e,o=wm){const s={...wm,...o},r=s.dist,a=s.stopFOV,c=1-(0,m.clamp)(s.backOff,0,1),p=function s1(t,n){const e=he.create();return he.sub(e,n,t),he.length(e)}(t,n);return Math.abs(p/(1+.8*c)/Math.tan(a/2))/e*r}function Pm(t,n,e){const o=wt.toArray(t.look),s=wt.toArray(t.eye),r=he.create();he.subtract(r,s,o);const a=he.create();he.normalize(a,r);const c=Math.abs(he.length(a)),{min:p,max:d}=ud(n),u=Sm(p,d,c,e),g=gd(p,d);he.scale(r,a,u);const h=he.add(he.create(),g,r);return{eye:wt.fromArray(h),look:wt.fromArray(g),up:wt.fromArray([0,1,0])}}class km{constructor(n,e){this.tempVec=he.create(),this.eyeVec=he.create(),this.lookVec=he.create(),this.cameraService=n;const{targetCamera:o,targetBoundary:s}=e,r=n.getCamera();if(this.initialLook=wt.toArray(r.look),this.initialEye=wt.toArray(r.eye),this.initialUp=wt.toArray(r.up),s){he.subtract(this.tempVec,this.initialEye,this.initialLook);const d=he.create();he.normalize(d,this.tempVec);const u=Math.abs(he.length(d)),{min:g,max:h}=ud(s),y=Sm(g,h,u,e);he.scale(this.tempVec,d,y),this.targetLook=gd(g,h),this.targetEye=he.add(he.create(),this.targetLook,this.tempVec),this.targetUp=he.fromValues(0,1,0)}o&&(this.targetLook=wt.toArray(o.look),this.targetEye=wt.toArray(o.eye),this.targetUp=wt.toArray(o.up)),he.subtract(this.tempVec,this.targetLook,this.initialLook);const a=Math.abs(he.length(this.tempVec));he.subtract(this.tempVec,this.targetEye,this.initialEye);const c=Math.abs(he.length(this.tempVec));this.animationDuration=e.animationDuration?1e3*e.animationDuration:1e3*((a>c?a:c)/(200*(e.velocity||1))+1),this.onComplete=e.onComplete}update(n){if(void 0===this.startTime&&(this.startTime=n,this.endTime=this.startTime+this.animationDuration),this.animationDone||n>this.endTime)return this.animationDone||this.cameraService.setCamera({eye:wt.fromArray(this.targetEye),look:wt.fromArray(this.targetLook),up:wt.fromArray(this.targetUp)}),this.animationDone=!0,void this.onComplete(this);const o=function r1(t,n,e){const o=t*t;return n+e*(-1*o*o+o*t*4+-6*o+4*t)}((n-this.startTime)/this.animationDuration,0,1);hd(o,0,1,this.initialLook,this.targetLook,this.lookVec),hd(o,0,1,this.initialEye,this.targetEye,this.eyeVec),hd(o,0,1,this.initialUp,this.targetUp),this.cameraService.setCamera({eye:wt.fromArray(this.eyeVec),look:wt.fromArray(this.lookVec),up:wt.fromArray(this.targetUp)})}stop(){}}let fd=(()=>{class t{constructor(){}roundModel(e,o){const s={...e};return Object.keys(e).filter(r=>"number"==typeof e[r]).forEach(r=>{s[r]=this.roundNumber(e[r],o)}),s}roundNumber(e,o){return Math.round(e*Math.pow(10,o))/Math.pow(10,o)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Om=180/Math.PI,Fc=1/xe.BIODIGITAL_SCENE_SCALE,mr=xe.BIODIGITAL_SCENE_SCALE,Uc=he.create(),Tm=he.create(),Rc=he.create(),Nc=he.create(),Ec=he.create();let Bn=(()=>{class t{constructor(e,o,s){this.engineService=e,this.numberService=o,this.sceneService=s,this.rotation={vx:0,vy:0},this.pan={x:0,y:0,z:0},this.zoom=0,this.animationCallbacks=[],this.initCameraEvents()}get cameraController(){const e=this.engineService.engine?.story?.cameraController;if(!e)throw new Error("Story not instantiated, cannot get camera controller");return e}tickCamera(e){this.animation&&this.animation.update(performance.now())}getCamera(){const{up:e,target:o,position:s}=this.cameraController;return he.scale(Uc,s,Fc),he.scale(Tm,o,Fc),{eye:wt.fromArray(Uc),look:wt.fromArray(Tm),up:wt.fromArray(e)}}setCamera(e,o=!1){const{eye:s,look:r,up:a}=e;if(s&&(he.scale(Uc,wt.toArray(s),mr),this.cameraController.setPosition(Uc)),r){const c=he.scale(he.create(),wt.toArray(r),mr);this.cameraController.setTarget(c)}if(a){const c=wt.toArray(a);this.cameraController.setUp(c)}r&&!o&&this.setCameraRotationCenter(r)}getLookDirection(){const{target:e,position:o}=this.cameraController;return he.sub(Nc,e,o),he.normalize(Nc,Nc),Nc}getLookDistance(){return this.cameraController.distance*Fc}getCameraZoom(){return this.cameraController.zoom}captureCamera(){return{lookAt:this.getCamera(),zoom:this.getCameraZoom()}}getDirection(e){const{position:o}=this.cameraController;return he.sub(Ec,o,e.worldPos),he.normalize(Ec,Ec),Ec}rotateCameraStatic(e,o){this.cameraController.orbit(e/Om,o/Om)}panCameraStatic(e,o,s){this.cameraController.pan(e*mr,o*mr,s*mr)}setRelativeZoom(e){this.cameraController.dolly(e)}setAbsoluteZoom(e){this.cameraController.zoom=e}getCameraRotationCenter(){return he.scale(Rc,this.cameraController.center,Fc),wt.fromArray(Rc)}setCameraRotationCenter(e){he.scale(Rc,wt.toArray(e),mr);const[o,s,r]=Rc;he.set(this.cameraController.center,o,s,r)}setCameraRotation(e,o){this.rotation.vx=o,this.rotation.vy=-e}setCameraPan(e,o){this.pan.x=e,this.pan.y=o}setCameraZoom(e){this.zoom=.03*e}setCameraZoomWithVelocity(e){this.setCameraZoom(e),requestAnimationFrame(()=>{e*=.85,Math.abs(e)>1&&this.setCameraZoomWithVelocity(e)})}tickCameraRotation(){return this.rotation.vx=this.checkEpsilon(this.rotation.vx),this.rotation.vy=this.checkEpsilon(this.rotation.vy),this.rotation}tickCameraPan(){return this.pan.x=this.checkEpsilon(this.pan.x),this.pan.y=this.checkEpsilon(this.pan.y),this.pan.z=this.checkEpsilon(this.pan.z),this.pan}tickCameraZoom(){return this.zoom=this.checkEpsilon(this.zoom),this.zoom}areCamerasEqual(e,o){return this.compareXYZ(e.eye,o.eye)&&this.compareXYZ(e.look,o.look)&&this.compareXYZ(e.up,o.up)}compareXYZ(e,o){return e.x===o.x&&e.y===o.y&&e.z===o.z}roundCamera(e,o){const{eye:s,look:r,up:a}=e;return{eye:this.numberService.roundModel(s,o),look:this.numberService.roundModel(r,o),up:this.numberService.roundModel(a,o)}}flyToObject(e,o){return new Promise(s=>{const r=this.sceneService.getObjectBoundary(e);xm(r)?(this.animationCallbacks.push(s),this.animation=new km(this,{targetBoundary:r,animationDuration:o,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())):s(void 0)})}flyToCamera(e,o){return new Promise(s=>{this.animationCallbacks.push(s),this.animation=new km(this,{targetCamera:e,animationDuration:o,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())})}jumpToObject(e){const o=this.sceneService.getObjectBoundary(e);if(xm(o)){const r=Pm(this.getCamera(),o);return this.jumpToCamera(r)}return new Promise(s=>s(void 0))}jumpToCamera(e){return new Promise(o=>{this.finishAnimation(),this.setCamera(e),o(void 0)})}getCameraAfterFlyTo(e){return Pm(this.getCamera(),e)}checkEpsilon(e){return Math.abs(e)<.001?0:e}initCameraEvents(){const e=new X.x,o=e.asObservable();o.subscribe(s=>{this.engineService.fireEvent(pe.CameraUpdated,s)}),o.pipe((0,i1.D)(()=>(0,_m.R)().pipe((0,o1.j)(2)))).subscribe(s=>{this.engineService.fireEvent(pe.CameraRested,s)}),this.engineService.engineCreated$.subscribe(s=>{s.camera.on("updateWorldMatrix",r=>{if(!s?.story)return;const p={...this.getCamera(),dist:this.getLookDistance()};e.next(p)})})}finishAnimation(){for(this.animation&&(this.animation.stop(),this.animation=null);this.animationCallbacks.length>0;)this.animationCallbacks.pop()()}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(fd),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class bd{constructor(n=0,e=0,o=0,s=0,r=0,a=!1){this.zoom=n,this.panX=e,this.panY=o,this.rotateX=s,this.rotateY=r,this.applyFriction=a}}var vo=A(1780);class Ge{}let Dc=(()=>{class t{constructor(e){this.patches=e}}return t.type="[Story Chapter] Apply Patch",t})(),Mm=(()=>{class t{constructor(){}}return t.type="[Story Chapter] Next Chapter",t})(),Im=(()=>{class t{constructor(){}}return t.type="[Story Chapter] Previous Chapter",t})(),u1=(()=>{class t{constructor(){}}return t.type="[Story Chapter] First Chapter",t})(),yd=(()=>{class t{constructor(){}}return t.type="[Story Chapter] Last Chapter",t})(),gi=(()=>{class t{constructor(e){this.chapter=e}}return t.type="[Story Chapter] Select Chapter",t})(),Ps=(()=>{class t{constructor(e){this.chapterId=e}}return t.type="[Story Chapter] Select Chapter by chapter id",t})(),Pa=(()=>{class t{constructor(e){this.chapters=e}}return t.type="[Story Chapter] Set Chapters",t})(),zm=(()=>{class t{constructor(e,o){this.chapterId=e,this.cameraAction=o}}return t.type="[Story Chapter] Set Chapter Camera Action",t})(),Am=(()=>{class t{constructor(e,o){this.chapterId=e,this.ui=o}}return t.type="[Story Chapter] Set Chapter UI",t})(),Lm=(()=>{class t{constructor(e,o,s){this.chapterId=e,this.description=o,this.displayName=s}}return t.type="[Story Chapter] Set Chapter Info",t})(),Fm=(()=>{class t{constructor(e,o){this.chapterId=e,this.legend=o}}return t.type="[Story Chapter] Set Chapter Legend",t})(),Um=(()=>{class t{constructor(e,o){this.chapterId=e,this.legend=o}}return t.type="[Story Chapter] Add To Chapter Legend",t})(),Rm=(()=>{class t{constructor(e,o){this.previousIndex=e,this.currentIndex=o}}return t.type="[Story Chapter] Reorder Chapters",t})(),jc=(()=>{class t{constructor(e,o){this.chapterId=e,this.readyState=o}}return t.type="[Story Chapter] Set Readystate",t})(),_d=(()=>{class t{constructor(e){this.chapterId=e}}return t.type="[Story Chapter] Build Chapter Visibility Layers",t})(),Nm=(()=>{class t{constructor(e,o,s){this.chapterId=e,this.effects=o,this.properties=s}}return t.type="[Story Chapter] Set Chapter PostProcessing",t})(),Em=(()=>{class t{constructor(e,o,s){this.chapterId=e,this.transition=o,this.key=s}}return t.type="[Story Chapter] Set Chapter Transitions",t})(),Dm=(()=>{class t{constructor(e,o){this.chapterIds=e,this.properties=o}}return t.type="[Story Chapter] Set Chapter Properties",t})(),jm=(()=>{class t{constructor(e,o){this.chapterIds=e,this.properties=o}}return t.type="[Story Chapter] Remove Chapter Properties",t})(),Qm=(()=>{class t{constructor(e,o){this.chapterId=e,this.transparencyMode=o}}return t.type="[Story Chapter] Set Chapter Transparency Mode",t})(),Zm=(()=>{class t{constructor(e,o,s,r){this.chapterId=e,this.clips=o,this.enabled=s,this.record=r}}return t.type="[Story Chapter] Set Chapter Clipping Planes",t})(),ks=(()=>{class t{constructor(e,o){this.chapterId=e,this.background=o}}return t.type="[Story Chapter] Set Chapter Background",t})(),Qc=(()=>{class t{constructor(e){this.background=e}}return t.type="[Story Chapter] Set All Chapters Background",t})(),Bm=(()=>{class t{constructor(){}}return t.type="[Story Chapter] Reset Selected Chapter Background",t})(),Vm=(()=>{class t{constructor(e){this.background=e}}return t.type="[Story Chapter] Set Selected Chapter Background",t})(),qm=(()=>{class t{constructor(e,o,s){this.story=e,this.chapter=o,this.chapterId=s}}return t.type="[Story Chapter] Duplicate An Existing Chapter",t})(),$m=(()=>{class t{constructor(e){this.chapter=e}}return t.type="[Story Chapter] Remove Chapter",t})(),xd=(()=>{class t{constructor(){}}return t.type="[Story Chapter] Reset",t})(),Gm=(()=>{class t{constructor(e,o,s){this.chapterId=e,this.camera=o,this.rotationCenter=s}}return t.type="[Story Chapters] Record Camera",t})(),vd=(()=>{class t{constructor(e,o,s,r){this.chapterId=e,this.index=o,this.position=s,this.record=r}}return t.type="[Story Chapters] Set the current visibility layers index and position",t})(),Jm=(()=>{class t{constructor(e,o){this.chapterId=e,this.media=o}}return t.type="[Story Chapters] Set the media object",t})(),Hm=(()=>{class t{constructor(e,o){this.chapterId=e,this.contentBlocks=o}}return t.type="[Story Chapters] Set the content blocks",t})(),Cd=(()=>{class t{constructor(e){this.timelineMaps=e}}return t.type="[Story Chapters] Add to timelineMap array",t})(),Ym=(()=>{class t{constructor(e){this.updates=e}}return t.type="[Story Chapters] Update timelineMap array",t})(),Wm=(()=>{class t{constructor(e){this.timelineMapIds=e}}return t.type="[Story Chapters] Remove from timelineMap array",t})(),Km=(()=>{class t{constructor(e,o){this.chapterId=e,this.lights=o}}return t.type="[Story Chapters] Set the lights",t})(),Xm=(()=>{class t{constructor(e){this.timelineMaps=e}}return t.type="[Story Chapters] set chapter timeline with data from the engine",t})();var $t,St=(()=>(function(t){t.Default="default",t.Plus="plus",t.Minus="minus",t.PlusMinus="plusMinus",t.Sequential="sequential",t.None="None"}(St||(St={})),St))(),qt=(()=>(function(t){t.Annotation="annotation",t.Classic="classic",t.StudioNext="studioNext",t.Context="context"}(qt||(qt={})),qt))(),ii=(()=>(function(t){t.Alphabetical="alphabetical",t.Numerical="numerical"}(ii||(ii={})),ii))();class Zc{constructor(n){this.pinType=St.PlusMinus,this.sequentialType=ii.Alphabetical,this.theme=qt.StudioNext,this.expandTag=!0,this.showDescription=!0,this.collapseDescription=!1,this.pinGlow=!1,this.hideWire=!1,this.hideTag=!1,this.title=n}}!function(t){function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const s=16*Math.random()|0;return("x"===o?s:3&s|8).toString(16)})}t.getUuid=n,t.idWithPrefix=function e(o){return o?`${o}-${n()}`:n()}}($t||($t={}));var hi=(()=>(function(t){t.classicAnnotation="classic-annotation",t.classicHotspot="classic-hotspot",t.studioNext="studio-light"}(hi||(hi={})),hi))();class Ko{constructor(){this.title=null,this.description=null,this.errands=[]}}var Fn=(()=>(function(t){t.flyToChapter="flyToChapter",t.flyToObject="flyToObject",t.flyToCamera="flyToCamera"}(Fn||(Fn={})),Fn))();class ka{constructor(n){this.type=Fn.flyToObject,this.value=n}}class ef{constructor(n){this.type=Fn.flyToCamera,this.value=n}}var Ti=(()=>(function(t){t.Circle="circle",t.CirclePlus="circle-plus",t.CircleMinus="circle-minus",t.Label="label",t.CircleLabel="circle-label"}(Ti||(Ti={})),Ti))();class Oa{constructor(){this.type=Fn.flyToChapter,this.value=null}}let Un=(()=>{class t{constructor(e,o){this.engineService=e,this.store=o,this.fps=30}setChapter(e){var o=this;return(0,Pn.Z)(function*(){const{story:s}=o.engineService.engine,{activeChapter:r}=s,a=o.store.selectSnapshot(_.getStoryChapters);if(e&&e!==r?.id){const c=a.findIndex(p=>p.id===e);return s.activateChapter(c).then(p=>(o.initPlayer(p),p.id))}return new Promise(c=>c(e))})()}initPlayer(e){const{animationSystem:o}=e;this._animationPlayer=new xe.BioDigitalAnimationPlayer(o),this._animationPlayer.playBackRate=this.store.selectSnapshot(M.getPlaybackSpeed),this.engineService.engine.renderer.on("animate",()=>{this._animationPlayer.update()}),this._animationPlayer.on("timeupdate",()=>{this.engineService.fireEvent(pe.TimelinePlaying,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("play",()=>{this.engineService.fireEvent(pe.TimelinePlayed,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("pause",()=>{this.engineService.fireEvent(pe.TimelinePaused,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("ended",()=>{this.engineService.fireEvent(pe.TimelineCompleted)});const s=[];e.timelineMap.forEach((d,u)=>{const g={id:u,...d};g.name=g.name??"",s.push(g)}),this.store.dispatch(new Xm(s)),e.timelineMap.on("change",()=>{this.engineService.fireEvent(pe.TimelineTimeFrameUpdated)}),this.store.dispatch(new jc(e.id,{model:!0,animation:!0}));const r=this.store.selectSnapshot(M.getChapter),a=this.store.selectSnapshot(_.getStoryChapters),c=a.findIndex(d=>d.id===r),p=a.findIndex(d=>d.id===e.id);this.engineService.fireEvent(pe.TimelineChapterActivated,{oldChapterIndex:c,newChapterIndex:p,time:0}),this.store.dispatch(new Zp(e.id))}isChapterAnimated(e){return!(0,m.isNil)(e)&&e.timelineMap.filter(s=>"dummy"!==(0,m.get)(s,"data.timeline")&&"dummy"!==(0,m.get)(s,"name")).length>0}isChapterLooped(e){return!0===(0,m.get)(e,"loop")||-1===(0,m.get)(e,"ui.play.count")}restart(){const e=this.isPlaying();e&&this.pause(),this._animationPlayer.currentTime=0,e&&this.play()}play(){this._animationPlayer&&this._animationPlayer.play()}pause(){this._animationPlayer&&this._animationPlayer.pause()}unpause(){this._animationPlayer&&(this.hasChapterFinished()&&this.scrub(0),this._animationPlayer.play())}scrub(e){this._animationPlayer.currentTime=(0,m.clamp)(e,0,this._animationPlayer.duration),this.engineService.fireEvent(pe.TimelineScrubbed,{time:this._animationPlayer.currentTime})}scrubFrame(e){const o="next"===e?1:-1,s=this.getTime(),a=this.secondsToFrames(s)+o,c=this.framesToSeconds(a);this.scrub(c)}secondsToFrames(e){return Math.round(e*this.fps)}framesToSeconds(e){return e/this.fps}getNearestFrameTime(e){return this.framesToSeconds(this.secondsToFrames(e))}formatTime(e){const o=d=>{const u=e<0?Math.ceil:Math.floor;return Math.abs(u(d)).toString().padStart(2,"0")},r=o(e/60),a=o(e%60),c=(d=>Math.abs(this.secondsToFrames(d%1)).toString().padStart(2,"0"))(e%1);return`${e<0?"-":""}${r}:${a}:${c}`}parseFormattedTime(e){const o=/^-/,s=o.test(e)?-1:1;-1===s&&(e=e.replace(o,""));const r=e.split(":").reverse();let a=parseInt(r[0],10),c=parseInt(r[1],10),p=parseInt(r[2],10);return isNaN(a)&&(a=0),isNaN(c)&&(c=0),isNaN(p)&&(p=0),(60*p+c+this.framesToSeconds(a))*s}updateTimelineClips(e){const o=this.engineService.engine.story.activeChapter;e.forEach(s=>{o.timelineMap.set(s.id,s)})}deleteTimelineClips(e){const o=this.engineService.engine.story.activeChapter;e.forEach(s=>{o.timelineMap.delete(s)})}addChapter(e,o){}setPlaybackRate(e){this._animationPlayer.playBackRate=e}getStoryAnimationNames(){const e=this.store.selectSnapshot(_.getStoryChapters),o=[];return e.forEach(s=>{s.timelineMap.forEach(r=>{const a=r.data.timeline;o.includes(a)||o.push(a)})}),o}getChapterTimeFrame(){return{firstTime:0,lastTime:this.getChapterDuration()}}getChapterDuration(){return(0,m.isNil)(this._animationPlayer)?0:this._animationPlayer.duration}getTime(){return(0,m.isNil)(this._animationPlayer)?0:this._animationPlayer.currentTime}isPlaying(){return!this._animationPlayer.paused}hasChapterFinished(){return!(0,m.isNil)(this._animationPlayer)&&this._animationPlayer.currentTime===this._animationPlayer.duration}setAnimationLoop(e){if(!this._animationPlayer)throw new Error("Animation player is not initialized");this._animationPlayer.loop=e}mapChapterGlobalTime(e,o){let s=o;if((0,m.isNil)(s))return 0;const r=this.store.selectSnapshot(_.getStoryChapters),a=r.findIndex(c=>c.id===e);for(let c=0;c<a;c++){let d=0;r[c].timelineMap.forEach(u=>{u.end>d&&(d=u.end)}),s-=d}return s}mapGlobalTimeToChapterId(e){let r,o=e;return this.store.selectSnapshot(_.getStoryChapters).forEach(a=>{if(!(0,m.isNil)(r))return;let c=0;a.timelineMap.forEach(p=>{p.end>c&&(c=p.end)}),o>=c?o-=c:r=a.id}),r}getGlobalTime(){const e=this.store.selectSnapshot(_.getSelectedChapterIndex),o=this.store.selectSnapshot(_.getStoryChapters);let s=this._animationPlayer.currentTime;for(let r=0;r<e;r++){let c=0;o[r].timelineMap.forEach(p=>{p.end>c&&(c=p.end)}),s+=c}return s}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const g1={flyToCamera:"flyTo",flyToChapter:"flyTo"};let Os=(()=>{class t{constructor(e,o){this.animationService=e,this.sceneService=o,this.convertActionToErrand=(s,r,a)=>{const c=new RegExp("^flyTo(Async)?"),p=new RegExp("^flyToObject(Async)?"),d=new RegExp("^flyTo[w.:]+currentChapter.[flyTo|jumpTo]"),u=a.split(":").slice(0,2),g=s;let h=u[1];/currentChapter/.test(h)&&(h=h.replace("currentChapter",`chapters[${r}]`));let y=null;return p.test(u[0])?y=new ka((0,m.get)(g,h)):c.test(u[0])?y=new ef((0,m.get)(g,h)):d.test(u[0])&&(y=new Oa),y},this.convertErrandToAction=(s,r)=>{const a=$t.idWithPrefix("errand").replace(/-/g,"_"),c={};let p="";const d=function h1(t){return g1[t]||t}(r.type);return r.type===Fn.flyToChapter||(p=`${d}Async:currentChapter.customData.${a}`,c[a]=r.value),{action:p,data:c}}}filterHotspot(e,o,s){const r=new RegExp("^(flyTo|flyToObject|hideHotspot|showHotspot|resetHotspots)"),a=this.getHotspotAction(e,s),c=a.filter(p=>r.test(p));return a.length===c.length}deserializeAnnotation(e,o,s){const r=new Zc(e.title||"");return r.id=e.annotationId||$t.idWithPrefix("label"),r.chapterId=o.id,r.expandTag=!0,r.showDescription=!0,r.collapseDescription=!1,r.pinGlow=!1,r.hideWire=!1,r.hideTag=!1,s===qt.Annotation?(r.theme=qt.Annotation,r.pinType=St.Default,r.flyTo=!1,r.states=[]):(r.theme=qt.StudioNext,r.pinType=St.PlusMinus,r.flyTo=!0,r.states=[new Ko,new Ko],r.states[0].errands=[new Oa],r.states[1].errands=[new ka(e.objectId)]),r.occludable=!1!==e.occludable,r.renderableIndex=e.renderableIndex||0,e.objectId&&Object.prototype.hasOwnProperty.call(e,"barycentric")?(r.objectId=e.objectId,r.primitiveIndex=e.primitiveIndex,r.barycentric=e.barycentric):Object.prototype.hasOwnProperty.call(e,"pos")&&(Object.prototype.hasOwnProperty.call(e,"objectId")&&(r.objectId=e.objectId),r.pos=e.pos),e.dir&&Array.isArray(e.dir)?r.dir=e.dir:e.dir&&e.dir instanceof Object&&(r.dir=Object.values(e.dir)),r.description=e.description||"",r.offset=e.labelOffset||[40,40],r.shown=!1!==e.shown,r.labelShown=!1!==e.labelShown,r}deserializeHotspots(e,o,s,...r){const[a,c]=r,p=new Zc(a.title||"");switch(p.id=$t.idWithPrefix("hotspot"),p.objectId=a.objectId,p.chapterId=o.id,p.description=a.description||"",p.pinType=/plus|minus/.test(a.className)?St.PlusMinus:/sequential/.test(a.className)?St.Sequential:/none/.test(a.className)?St.None:St.Default,/alphabetical/.test(a.className)?p.sequentialType=ii.Alphabetical:/numerical/.test(a.className)&&(p.sequentialType=ii.Numerical),p.pinGlow=/pulse/.test(a.className),p.occludable=!0,p.shown=a.shown,p.offset=a.labelOffset?a.labelOffset:[22,-17],(/left/.test(a.className)&&p.offset[0]>0||/right/.test(a.className)&&p.offset[0]<0)&&(p.offset[0]*=-1),Object.prototype.hasOwnProperty.call(a,"barycentric")?(p.renderableIndex=a.renderableIndex||0,p.barycentric=a.barycentric,p.primitiveIndex=a.primitiveIndex):p.pos=a.pos,p.dir=a.dir,a.theme=a.theme?a.theme:hi.classicHotspot,a.theme){case hi.classicAnnotation:p.theme=qt.Annotation,p.showDescription=!0,p.collapseDescription=/collapsible/g.test(a.className),p.expandTag=!0,p.hideTag=!1,p.hideWire=!/leader-line/.test(a.className);break;case hi.classicHotspot:p.theme=qt.Classic,p.showDescription=/label/.test(a.className),p.expandTag=/label/.test(a.className),p.hideTag=!p.expandTag,p.collapseDescription=!1,p.hideWire=!/leader-line/.test(a.className);break;case hi.studioNext:p.theme=qt.StudioNext,p.showDescription=this.hasContent(a),p.collapseDescription=/collapsible/g.test(a.className),p.hideTag=!a.title,p.hideWire=!/leader-line/.test(a.className)}p.flyTo=!1,p.flyToTarget=null,p.states=[];const d=this.filterHotspotActions(this.getHotspotAction(e,a)),u=c?this.filterHotspotActions(this.getHotspotAction(e,c)):[],g=new Ko,h=new Ko;d.length&&(g.errands=d.map(k=>this.convertActionToErrand(e,s,k))),u.length&&(h.errands=u.map(k=>this.convertActionToErrand(e,s,k))),p.states=[h,g],g.errands.length>0&&(p.flyTo=!0,p.flyToTarget=g.errands[0].type,g.errands[0].type===Fn.flyToCamera&&(p.cameraPosition=g.errands[0].value));const y=a.contentBlocks;return y&&(p.contentBlocks=JSON.parse(JSON.stringify(y))),p}makeDefaultStudioLabel(e){const o=e?{...e}:new Zc("");return o.pinType=St.PlusMinus,o.theme=qt.StudioNext,o.expandTag=!0,o.showDescription=!0,o.collapseDescription=!1,o.pinGlow=!1,o.hideWire=!1,o.hideTag=!1,o.occludable=!0,o.flyTo=!0,o.description="",o.shown=!0,o.states=[new Ko,new Ko],o}makeAnnotationLabel(e){const o=e?{...e}:new Zc("");return o.pinType=St.Default,o.theme=qt.Annotation,o.expandTag=!0,o.showDescription=!0,o.collapseDescription=!1,o.pinGlow=!1,o.hideWire=!1,o.hideTag=!1,o.states=[],o}serializeLabel(e,o){const s={symbol:void 0,className:void 0,dir:void 0,objectId:void 0,shown:void 0,type:void 0},r=(0,sn.nq)(e),a=["circle","draggable"];if(s.shown=!0,e.objectId&&(s.objectId=r.objectId),e.objectId&&e.primitiveIndex&&e.barycentric)s.renderableIndex=e.renderableIndex||0,s.primitiveIndex=e.primitiveIndex,s.barycentric=e.barycentric;else{if(!e.objectId)return{data:{},hotspots:[]};s.pos=r.pos}switch((Array.isArray(e.dir)||ArrayBuffer.isView(e.dir))&&(s.dir=Array.prototype.slice.call(e.dir)),s.labelOffset=e.offset,e.theme){case qt.Annotation:s.theme=hi.classicAnnotation;break;case qt.Classic:s.theme=hi.classicHotspot;break;default:s.theme=hi.studioNext}""!==r.title?(s.title=r.title,s.description=r.description,s.type=Ti.CircleLabel):s.type=Ti.Circle,e.pinGlow&&a.push("pulse"),e.pinType===St.PlusMinus&&a.push("plus"),e.pinType===St.Sequential&&(a.push("sequential"),a.push(e.sequentialType===ii.Alphabetical?"alphabetical":"numerical")),e.pinType===St.None&&a.push("none"),e.hideWire||a.push("leader-line"),e.hideTag||a.push("label"),e.collapseDescription&&a.push("collapsible collapsed"),s.className=a.join(" ");let c={};s.actions=[];const p=[s],d=e.states.length;e.states.forEach((g,h)=>{if(h===d-1)p[0].actions.push("resetHotspots"),g.errands.forEach(y=>{const k=this.convertErrandToAction(e,y);p[0].actions.push(k.action),c={...c,...k.data}});else{const y=(0,m.cloneDeep)(s);y.actions=[],y.className=y.className.replace("plus","minus"),g.errands.forEach(k=>{const B=this.convertErrandToAction(e,k);y.actions.push(B.action),c={...c,...B.data}}),p.push(y)}}),2===p.length&&(p[0].actions.push(`hideHotspots:currentChapter.hotspots[${o}]`),p[0].actions.push(`showHotspots:currentChapter.hotspots[${o+1}]`),p[1].actions.push(`hideHotspots:currentChapter.hotspots[${o+1}]`),p[1].actions.push(`showHotspots:currentChapter.hotspots[${o}]`),p[0].shown=!0,p[1].shown=!1),2===p.length&&e.collapseDescription&&(p[1].className+=p[1].className.replace("collapsed","")),p.forEach(g=>{s.labelOffset[0]<0?g.className=g.className.replace("right","")+" left":s.labelOffset[0]>0&&(g.className=g.className.replace("left","")+" right")});const u=e.contentBlocks;return u&&(s.contentBlocks=JSON.parse(JSON.stringify(u))),{data:c,hotspots:p}}setLabelContainer(e){this._labelContainer=e}getLabelContainer(){return this._labelContainer}hasContent(e){const{description:o,contentBlocks:s}=e;return!!o||!(0,m.isNil)(s)&&s.length>0}getHotspotAction(e,o){const s=o.actionSrc?(0,m.get)(e,o.actionSrc):o.actions?o.actions:[];return Array.isArray(s)?s:[]}filterHotspotActions(e){const o=new RegExp("^(flyTo|flyToObject)");return e.filter(s=>o.test(s))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Un),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function _1(t,n,e){const o=Object.keys(n),s=Object.keys(e),r=function W0(t,n){return Object.keys(t).reduce((o,s)=>(o[s]=wa(n,t[s]),o),{})}(e,o),a=function K0(t,n){const o=t.map(r=>ni(n,r).depth);return Math.max(0,...o)-1}(s,t),c=(0,m.range)(a,-1).reduce((u,g)=>{const h=rd(t,Object.keys(u.remainingVoters),g),y=function t1(t,n,e,o){const s=Object.keys(o);return{results:e.reduce((a,c)=>{const p=xo(t,c),d=p.map(h=>({[h]:n[h]||wa(s,Tc(t,h,s))}));p.forEach(h=>{delete n[h]});const g=cm(c,function X0(t,n){return t.reduce((e,o)=>{const s=function e1(t,n){return t.reduce((e,o)=>{const s=Object.keys(o)[0];return o[s][n]?e.votesFor.push(s):e.votesAgainst.push(s),e},{votesFor:[],votesAgainst:[]})}(n,o);return e[o]=s,e},{})}(s,d),o);return n[c]=Object.entries(g).reduce((h,[y,k])=>(h[y]=k.result,h),{}),a.push(g),a},[]),remainingVoters:n}}(t,u.remainingVoters,h,n),k=function b1(t){return t.reduce((n,e)=>{const r=Object.keys(e).map(a=>function f1(t,n,e,o){const s=o.reduce((r,a)=>(r[a]={[t]:!e},r),{});return s[n]={[t]:e},s}(a,e[a].id,e[a].result,e[a].dissenters)).reduce((a,c)=>(0,m.merge)(a,c),{});return Object.keys(r).forEach(a=>{n[a]=r[a]}),n},{})}(y.results);return Object.keys(k).forEach(B=>{u.syncGraph[B]=k[B]}),u.remainingVoters=y.remainingVoters,u},{syncGraph:{},remainingVoters:r}).syncGraph;return function y1(t,n,e,o){const s=n.reduce((r,a)=>{const p=t[a],d=t[o.predecessors[a]];for(const u of e)p[u]===d[u]&&r.push({successorId:a,prop:u});return r},[]);for(const r of s)delete t[r.successorId][r.prop],0===Object.keys(t[r.successorId]).length&&delete t[r.successorId];return t}(c,Object.keys(c).filter(u=>!t.roots[u]&&!!t.successors[u]),o,t)}class Ki{}let tf=(()=>{class t{constructor(){}}return t.type="[Engine Nodes] Reset",t})(),wd=(()=>{class t{constructor(e){this.nodeState=e}}return t.type="[Engine Nodes] init nodes",t})(),Ts=(()=>{class t{constructor(e){this.patches=e}}return t.type="[Engine Nodes] patch nodes",t})(),Bc=(()=>{class t{constructor(e){this.activeChapterId=e}}return t.type="[Engine Nodes] set active chapter",t})(),nf=(()=>{class t{constructor(e,o){this.originalChapterId=e,this.copyChapterId=o}}return t.type="[Engine Nodes] Duplicate node state",t})(),rn=(()=>{class t{constructor(e,o,s,r=!0,a=!1){this.show=e,this.objectIds=o,this.patch=s,this.record=r,this.setByTween=a}}return t.type="[Engine Nodes] update nodes shown",t})(),Ms=(()=>{class t{constructor(e){this.objectId=e}}return t.type="[Engine Nodes] update nodes selected",t})(),Rt=(()=>{class t{constructor(e,o,s){this.checked=e,this.objectIds=o,this.patch=s}}return t.type="[Engine Nodes] update nodes checked",t})(),Ta=(()=>{class t{constructor(e,o,s){this.pickable=e,this.objectIds=o,this.patch=s}}return t.type="[Engine Nodes] update nodes pickable",t})(),Xo=(()=>{class t{constructor(e,o,s,r=!0){this.recipe=e,this.objectIds=o,this.patch=s,this.record=r}}return t.type="[Engine Nodes] update nodes paint",t})();var Nt;function of(t,n){const e=n.children;return 0===e.length?[]:(0,m.flattenDeep)(e.map(o=>[o.objectId,...of(t,t.getObjectById(o.objectId))]))}function Ma(t,n,e,o,s){of(t,t.getObjectById(n)).forEach(r=>e[r][o]=s)}!function(t){t.Reset=(()=>{class a{constructor(){}}return a.type="[Undo] Reset",a})(),t.Undo=(()=>{class a{constructor(p){this.chapterId=p}}return a.type="[Undo] Undo",a})(),t.UndoAll=(()=>{class a{constructor(p){this.chapterId=p}}return a.type="[Undo] Undo All",a})(),t.Redo=(()=>{class a{constructor(p){this.chapterId=p}}return a.type="[Undo] Redo",a})(),t.SavePatches=(()=>{class a{constructor(p){this.patches=p}}return a.type="[Undo] Store Patches",a})()}(Nt||(Nt={}));var H=A(8338);function sf(t,n,e){if(void 0===t.activeChapterId||void 0===t.nodeState)return;const[o,s,r]=H.aS(t,c=>{const p=c.nodeState[c.activeChapterId],d=n.objectIds||Object.keys(p);n.patch?Object.entries(n.patch).forEach(([u,g])=>{p[u].shown=g}):d.forEach(u=>{p[u].shown=n.show,p[u].shownSetByTween=n.setByTween,n.objectIds&&(Ma(e,u,p,"shown",n.show),!0===n.setByTween&&Ma(e,u,p,"shownSetByTween",n.setByTween))})});return{finalState:H.Uy(o,c=>{c.patches=s,c.patchesForChapter[c.activeChapterId].push(...s)}),patches:s,inversePatches:r}}class rf{constructor(n={center:[0,0,0],edge:[1,1,1],centerBias:1,edgeBias:0,power:1}){const{edge:e,center:o,centerBias:s,edgeBias:r,power:a}=n;this.edge=e,this.center=o,this.centerBias=s,this.edgeBias=r,this.power=a}static toEngine(n){const{center:e,edge:o,centerBias:s,edgeBias:r,power:a}=n;return[[...e],[...o],s,r,a]}}class fr{constructor(n={center:0,edge:1,centerBias:1,edgeBias:0,power:1}){const{edge:e,center:o,centerBias:s,edgeBias:r,power:a}=n;this.edge=e,this.center=o,this.centerBias=s,this.edgeBias=r,this.power=a}static toEngine(n){const{center:e,edge:o,centerBias:s,edgeBias:r,power:a}=n;return[e,o,s,r,a]}static isFresnelObject(n){let e=!1;return n&&(e="center,centerBias,edge,edgeBias,power"==Object.keys(n).sort().toString()),e}}function Vc(t,n){switch(!0){case void 0===t[n]:return;case!1===t[n]:return!1;case"number"==typeof t[n]:return 100*t[n];default:return new fr({center:t[n][0],edge:t[n][1],centerBias:t[n][2],edgeBias:t[n][3],power:t[n][4]})}}function Co(t){return!(0,m.isNil)(t)&&Object.prototype.hasOwnProperty.call(t,"edge")&&Object.prototype.hasOwnProperty.call(t,"edgeBias")&&Object.prototype.hasOwnProperty.call(t,"center")&&Object.prototype.hasOwnProperty.call(t,"centerBias")&&Object.prototype.hasOwnProperty.call(t,"power")}function af(t){return{tintColor:(()=>{switch(!0){case void 0===t.tintColor:return;case!1===t.tintColor:return!1;case Array.isArray(t.tintColor):return 3===t.tintColor.length?[...t.tintColor]:new rf({center:t.tintColor[0],edge:t.tintColor[1],centerBias:t.tintColor[2],edgeBias:t.tintColor[3],power:t.tintColor[4]})}})(),saturation:Vc(t,"saturation"),brightness:Vc(t,"brightness"),contrast:Vc(t,"contrast"),opacity:Vc(t,"opacity")}}function Is(t){let n=!1!==t.tintColor&&void 0,e=!1!==t.saturation&&void 0,o=!1!==t.brightness&&void 0,s=!1!==t.contrast&&void 0,r=!1!==t.opacity&&void 0;return Array.isArray(t.tintColor)?n=[...t.tintColor]:Co(t.tintColor)&&(n=rf.toEngine(t.tintColor)),"number"==typeof t.saturation?e=t.saturation/100:Co(t.saturation)&&(e=fr.toEngine(t.saturation)),"number"==typeof t.brightness?o=t.brightness/100:Co(t.brightness)&&(o=fr.toEngine(t.brightness)),"number"==typeof t.contrast?s=t.contrast/100:Co(t.contrast)&&(s=fr.toEngine(t.contrast)),"number"==typeof t.opacity?r=t.opacity/100:Co(t.opacity)&&(r=fr.toEngine(t.opacity)),{tintColor:n,saturation:e,brightness:o,contrast:s,opacity:r}}function cf(t,n){const e=Object.assign({},t);for(const[o,s]of Object.entries(n))typeof s<"u"&&(e[o]=s);return e}var zs,Yt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ve=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};let Se=zs=class{constructor(n){this.sceneService=n}static getAllNodeState(n){return n.nodeState}static getActiveChapter(n){return n.activeChapterId}static getPatches(n){return n.patches}static getNodes(n){return void 0===n.activeChapterId||void 0===n.nodeState?{}:n.nodeState[n.activeChapterId]||{}}static getNodePaint(n){return e=>n.nodeState[n.activeChapterId][e].paint}static getNodeIds(n){return Object.keys(zs.getNodes(n))}static getCheckedNodeIds(n){return Object.values(zs.getNodes(n)).filter(e=>e.checked).map(e=>e.objectId)}static getCheckedNodes(n){return zs.getCheckedNodeIds(n).map(e=>n.nodeState[n.activeChapterId][e])}static getUncheckedNodeIds(n){return zs.getNodeIds(n).filter(e=>!n.nodeState[n.activeChapterId][e].checked)}static getSelectedNode(n){const e=zs.getNodeIds(n).find(o=>n.nodeState[n.activeChapterId][o].selected);return e?n.nodeState[n.activeChapterId][e]:void 0}reset(n,e){n.patchState(H.Uy(n.getState(),o=>{o.activeChapterId=void 0,o.nodeState=void 0,o.patches=[],o.patchesForChapter={}}))}applyPatch(n,e){const o=H.QE(n.getState(),e.patches),s=H.Uy(o,r=>{r.patchesForChapter[r.activeChapterId].push(...e.patches),r.patches=e.patches});n.patchState(s)}initNodeState(n,e){n.patchState({nodeState:e.nodeState})}setActiveChapter(n,e){const o=n.getState(),s=H.Uy(o,r=>{r.activeChapterId=e.activeChapterId,r.patchesForChapter[e.activeChapterId]=r.patchesForChapter[e.activeChapterId]||[],r.patches=r.patchesForChapter[e.activeChapterId]});n.patchState(s)}duplicateNodeState(n,e){const o=n.getState(),s=H.Uy(o,r=>{r.nodeState[e.copyChapterId]=r.nodeState[e.originalChapterId],r.patchesForChapter[e.copyChapterId]=r.patchesForChapter[e.originalChapterId].map(c=>(c.path[1]=e.copyChapterId,c))});n.patchState(s)}updateNodesShown(n,e){const o=n.getState(),{finalState:s,patches:r,inversePatches:a}=sf(o,e,this.sceneService);n.patchState(s),e.record&&n.dispatch(new Nt.SavePatches([{forward:r,inverse:a,patchAction:Ts}]))}updateNodesSelected(n,e){const o=n.getState();if(!o)return;const s=H.Uy(o,r=>{const a=r.nodeState?.[r.activeChapterId]??{},c=Object.keys(a);void 0===e.objectId?c.forEach(p=>a[p].selected=!1):(c.forEach(p=>a[p].selected=!1),a[e.objectId].selected=!0)});n.patchState(s)}updateNodesChecked(n,e){const o=n.getState(),[s,r,a]=H.aS(o,p=>{const d=p.nodeState?.[p.activeChapterId]??{};void 0===e.patch?(e.objectIds||Object.keys(d)).forEach(g=>{d[g].checked=e.checked,e.objectIds&&Ma(this.sceneService,g,d,"checked",e.checked)}):Object.entries(e.patch).forEach(([u,g])=>d[u].checked=g)}),c=H.Uy(s,p=>{p.patches=r});n.patchState(c)}updateNodesPickable(n,e){const o=n.getState(),[s,r,a]=H.aS(o,p=>{const d=p.nodeState?.[p.activeChapterId]??{};e.patch?Object.entries(e.patch).forEach(([u,g])=>d[u].pickable=g):(e.objectIds||Object.keys(d)).forEach(g=>{d[g].pickable=e.pickable,e.objectIds&&Ma(this.sceneService,g,d,"pickable",e.pickable)})}),c=H.Uy(s,p=>{p.patches=r,p.patchesForChapter[p.activeChapterId].push(...r)});n.patchState(c),n.dispatch(new Nt.SavePatches([{forward:r,inverse:a,patchAction:Ts}]))}updateNodesPaint(n,e){const o=n.getState(),[s,r,a]=H.aS(o,p=>{const d=p.nodeState?.[p.activeChapterId]??{},u=e.objectIds||Object.keys(d);e.patch?Object.entries(e.patch).forEach(([g,h])=>{const y=cf(d[g].paint,h);d[g].paint=y}):u.forEach(g=>{const h=cf(d[g].paint,e.recipe);d[g].paint=h,e.objectIds&&Ma(this.sceneService,g,d,"paint",h)})}),c=H.Uy(s,p=>{p.patches=r,p.patchesForChapter[p.activeChapterId].push(...r)});n.patchState(c),e.record&&n.dispatch(new Nt.SavePatches([{forward:r,inverse:a,patchAction:Ts}]))}};Se.\u0275fac=function(n){return new(n||Se)(i.LFG(Ut))},Se.\u0275prov=i.Yz7({token:Se,factory:Se.\u0275fac}),Yt([(0,l.aU)(tf),ve("design:type",Function),ve("design:paramtypes",[Object,tf]),ve("design:returntype",void 0)],Se.prototype,"reset",null),Yt([(0,l.aU)(Ts),ve("design:type",Function),ve("design:paramtypes",[Object,Ts]),ve("design:returntype",void 0)],Se.prototype,"applyPatch",null),Yt([(0,l.aU)(wd),ve("design:type",Function),ve("design:paramtypes",[Object,wd]),ve("design:returntype",void 0)],Se.prototype,"initNodeState",null),Yt([(0,l.aU)(Bc),ve("design:type",Function),ve("design:paramtypes",[Object,Bc]),ve("design:returntype",void 0)],Se.prototype,"setActiveChapter",null),Yt([(0,l.aU)(nf),ve("design:type",Function),ve("design:paramtypes",[Object,nf]),ve("design:returntype",void 0)],Se.prototype,"duplicateNodeState",null),Yt([(0,l.aU)(rn),ve("design:type",Function),ve("design:paramtypes",[Object,rn]),ve("design:returntype",void 0)],Se.prototype,"updateNodesShown",null),Yt([(0,l.aU)(Ms),ve("design:type",Function),ve("design:paramtypes",[Object,Ms]),ve("design:returntype",void 0)],Se.prototype,"updateNodesSelected",null),Yt([(0,l.aU)(Rt),ve("design:type",Function),ve("design:paramtypes",[Object,Rt]),ve("design:returntype",void 0)],Se.prototype,"updateNodesChecked",null),Yt([(0,l.aU)(Ta),ve("design:type",Function),ve("design:paramtypes",[Object,Ta]),ve("design:returntype",void 0)],Se.prototype,"updateNodesPickable",null),Yt([(0,l.aU)(Xo),ve("design:type",Function),ve("design:paramtypes",[Object,Xo]),ve("design:returntype",void 0)],Se.prototype,"updateNodesPaint",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getAllNodeState",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getActiveChapter",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getPatches",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getNodes",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getNodePaint",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getNodeIds",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getCheckedNodeIds",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getCheckedNodes",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getUncheckedNodeIds",null),Yt([(0,l.Qf)(),ve("design:type",Function),ve("design:paramtypes",[Ki]),ve("design:returntype",void 0)],Se,"getSelectedNode",null),Se=zs=Yt([(0,l.ZM)({name:"engineNodes",defaults:{activeChapterId:void 0,nodeState:void 0,patches:[],patchesForChapter:{}}}),ve("design:paramtypes",[Ut])],Se);const br={label:"Original",tintColor:!1,saturation:!1,contrast:!1,brightness:!1,opacity:!1},es={label:"Fade",tintColor:[0,0,0],contrast:!1,brightness:55,saturation:-100,opacity:new fr({edge:1,center:0,edgeBias:0,centerBias:1,power:1})};function qc(t,n,e){const o=xo(t,n);if(0===o.length)return!1;for(const s of o)if(!0===e[s])return!0;return o.some(s=>qc(t,s,e))}function $c(t,n,e){switch(e[n]){case!0:return!0;case!1:return!1;case void 0:{const o=va(t,n);return!!o&&$c(t,o,e)}}}function uf(t,n,e){if((0,m.isNil)(e))return!0;switch(e[n]){case!0:return!1;case!1:return!0;case void 0:{const o=va(t,n);return!o||uf(t,o,e)}}}function gf(t,n,e){if(e&&e[n]&&function T1(t){return"tintColor"in t||"opacity"in t||"brightness"in t||"saturation"in t||"contrast"in t}(e[n]))return af(e[n]);const o=va(t,n);return o?gf(t,o,e):br}function M1(t,n,e,o){function s(a){const c=$c(t,a,n)||qc(t,a,n),p=uf(t,a,e);return{objectId:a,checked:!1,selected:!1,paint:gf(t,a,o),pickable:p,shown:c,shownSetByTween:!1}}return Object.keys(t.nodes).reduce((a,c)=>(a[c]=s(c),a),{})}var be,yr,Mi;!function(t){t.SetParticleState=(()=>{class F{constructor(D,I,ce){this.particleSystems=D,this.assignedParticles=I,this.tweenParticleLookup=ce}}return F.type="[Engine Particles] Set Particle State",F})(),t.NewParticleSystem=(()=>{class F{constructor(D,I){this.particleSystem=D,this.chapterId=I}}return F.type="[Engine Particles] New Particle System",F})(),t.DuplicateParticleSystem=(()=>{class F{constructor(D,I){this.id=D,this.targetChapterId=I}}return F.type="[Engine Particles] Duplicate Particle System",F})(),t.DuplicateParticleSystemSuccess=(()=>{class F{constructor(D,I){this.id=D,this.targetChapterId=I}}return F.type="[Engine Particles] Duplicate Particle System Success",F})(),t.UpdateParticleSystem=(()=>{class F{constructor(D,I){this.id=D,this.particleSystem=I}}return F.type="[Engine Particles] Update Particle System",F})(),t.SetParticleSystemsVisible=(()=>{class F{constructor(D,I){this.visible=D,this.chapterId=I}}return F.type="[Engine Particles] Set Particle Systems Visible",F})(),t.SetParticleSystemVisible=(()=>{class F{constructor(D,I,ce){this.id=D,this.visible=I,this.chapterId=ce}}return F.type="[Engine Particles] Set Particle System Visible",F})(),t.AssignParticle=(()=>{class F{constructor(D,I){this.id=D,this.chapterId=I}}return F.type="[Engine Particles] Assign Particle",F})(),t.UnassignParticle=(()=>{class F{constructor(D,I){this.id=D,this.chapterId=I}}return F.type="[Engine Particles] Unassign Particle",F})(),t.DeleteParticleSystem=(()=>{class F{constructor(D){this.id=D}}return F.type="[Engine Partiles] Delete Particle System",F})(),t.SelectParticleSystem=(()=>{class F{constructor(D){this.id=D}}return F.type="[Engine Partiles] Select Particle System",F})(),t.SelectParticleConstraint=(()=>{class F{constructor(D){this.index=D}}return F.type="[Engine Partiles] Select Particle Constraint",F})(),t.SelectParticleCreator=(()=>{class F{constructor(D){this.index=D}}return F.type="[Engine Partiles] Select Particle Creator",F})(),t.SelectParticleUpdater=(()=>{class F{constructor(D){this.index=D}}return F.type="[Engine Partiles] Select Particle Updater",F})(),t.UpdateTweenParticleLookupChapters=(()=>{class F{constructor(D){this.chapterMap=D}}return F.type="[Engine Particles] Update Lookup Chapters",F})(),t.SetLookupForChapter=(()=>{class F{constructor(D,I){this.chapterId=D,this.lookup=I}}return F.type="[Engine Particles] Set Lookup for chapter",F})(),t.DeleteChapterLookup=(()=>{class F{constructor(D){this.chapterId=D}}return F.type="[Engine Particles] Delete chapter lookup",F})(),t.ApplyPatch=(()=>{class F{constructor(D){this.patches=D}}return F.type="[Engine Particles] Apply Patch",F})()}(be||(be={})),function(t){t.updateChapterIds=function n(r,a){return Object.keys(r).reduce((d,u)=>(d[a[u]]=r[u],d),{})},t.duplicateChapter=function e(r,a,c){return{...c,[a]:c[r]}},t.deleteChapter=function o(r,a){const c={...a};return delete c[r],c},t.addEntryForChapter=function s(r,a,c){return c[r]={...c[r],...a},c}}(yr||(yr={})),function(t){function n(o){return o.split("-")[0].replace(/_particle$/,"")}t.getParticleIdRoot=n,t.generateParticleId=function e(o,s=$t.getUuid){return`${n(o)}-${s()}`}}(Mi||(Mi={}));var ts,ct=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Y=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};let Fe=ts=class{constructor(){}static particleSystemIdExists(n){return(0,l.P1)([ts],e=>void 0!==e.particleSystems[n])}static particleSystemsForChapter(n){return(0,l.P1)([ts],e=>(e.assignedParticles[n]||[]).map(s=>e.particleSystems[s]))}static getVisibleParticleSystemsForChapter(n){return(0,l.P1)([ts],e=>{const s=e.visibleParticleSystems[n]||{};return(e.assignedParticles[n]||[]).filter(r=>!1!==s[r])})}static getTweenParticleLookup(n){return n.tweenParticleLookup}static getParticleSystems(n){return n.particleSystems}static getVisisbleParticleSystems(n){return n.visibleParticleSystems}static getParticleSystemsList(n){return Object.values(n.particleSystems)}static getAssignedParticleSystems(n){return n.assignedParticles}static getSelectedParticleSystemId(n){return n.particleSelection.selectedParticle}static getSelectedParticleSystem(n){const{particleSystems:e,particleSelection:o}=n;return e[o.selectedParticle]}static getSelectedParticleConstraintIndex(n){return n.particleSelection.selectedConstraint}static getSelectedParticleConstraint(n){const e=ts.getSelectedParticleSystem(n);return e?e.constraints[n.particleSelection.selectedConstraint]:null}static getSelectedParticleCreatorIndex(n){return n.particleSelection.selectedCreator}static getSelectedParticleCreator(n){const e=ts.getSelectedParticleSystem(n);return e?e.creators[n.particleSelection.selectedCreator]:null}static getSelectedParticleUpdaterIndex(n){return n.particleSelection.selectedUpdater}static getSelectedParticleUpdater(n){const e=ts.getSelectedParticleSystem(n);return e?e.updaters[n.particleSelection.selectedUpdater]:null}applyPatch(n,e){const o=H.QE(n.getState(),e.patches);n.patchState(o)}setParticleState(n,e){n.patchState(H.Uy(n.getState(),o=>{o.particleSystems=e.particleSystems.reduce((s,r)=>(s[r.id]=r,s),{}),o.assignedParticles=e.assignedParticles,o.tweenParticleLookup=e.tweenParticleLookup,o.visibleParticleSystems={}}))}setParticlesVisible(n,{visible:e,chapterId:o}){n.patchState(H.Uy(n.getState(),s=>{const a=(s.assignedParticles[o]||[]).reduce((c,p)=>(c[p]=e,c),{});s.visibleParticleSystems={...s.visibleParticleSystems,[o]:a}}))}setParticleVisible(n,{id:e,visible:o,chapterId:s}){n.patchState(H.Uy(n.getState(),r=>{r.visibleParticleSystems[s]={...r.visibleParticleSystems[s]||{},[e]:o}}))}newParticleSystem(n,e){const{particleSystem:o,chapterId:s}=e,r=o.id,[a,c,p]=H.aS(n.getState(),d=>{d.particleSystems[r]=o,d.assignedParticles[s]=[...d.assignedParticles[s]||[],r]});n.patchState(a)}duplicateParticleSystem(n,e){const{id:o,targetChapterId:s}=e,r=Mi.generateParticleId(o);n.patchState(H.Uy(n.getState(),a=>{a.particleSystems[r]=JSON.parse(JSON.stringify(a.particleSystems[o])),a.particleSystems[r].id=r,a.assignedParticles[s].push(r);const c=Mi.getParticleIdRoot(o);a.tweenParticleLookup[s]&&a.tweenParticleLookup[s][c]&&(a.tweenParticleLookup=yr.addEntryForChapter(s,{[c]:r},a.tweenParticleLookup))})),n.dispatch(new be.DuplicateParticleSystemSuccess(r,s))}updateParticleSystem(n,e){const o=H.Uy(n.getState(),s=>{s.particleSystems[e.id]=e.particleSystem});n.patchState({...o,particleSystems:{...o.particleSystems}})}deleteChapterLookup(n,e){n.patchState(H.Uy(n.getState(),o=>{delete o.tweenParticleLookup[e.chapterId]}))}setLookupForChapter(n,e){n.patchState(H.Uy(n.getState(),o=>{o.tweenParticleLookup[e.chapterId]=e.lookup}))}assignParticle(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.assignedParticles[e.chapterId]||[],r=Mi.getParticleIdRoot(e.id);o.assignedParticles[e.chapterId]=s.concat(e.id),o.tweenParticleLookup=yr.addEntryForChapter(e.chapterId,{[r]:e.id},o.tweenParticleLookup),o.particleSystems={...o.particleSystems}}))}unassignParticle(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.assignedParticles[e.chapterId]||[],r=Mi.getParticleIdRoot(e.id);o.assignedParticles[e.chapterId]=s.filter(a=>a!==e.id),o.tweenParticleLookup[e.chapterId]&&delete o.tweenParticleLookup[e.chapterId][r],o.particleSystems={...o.particleSystems}}))}deleteParticleSystem(n,e){n.patchState(H.Uy(n.getState(),o=>{delete o.particleSystems[e.id],Object.keys(o.assignedParticles).forEach(s=>{o.assignedParticles[s]=o.assignedParticles[s].filter(r=>r!==e.id)}),Object.keys(o.tweenParticleLookup).forEach(s=>{delete o.tweenParticleLookup[s][Mi.getParticleIdRoot(e.id)]})}))}selectParticleSystem(n,e){n.patchState(H.Uy(n.getState(),o=>{o.particleSelection={selectedParticle:e.id}}))}selectParticleConstraint(n,e){const s=n.getState().particleSelection;n.patchState(H.Uy(n.getState(),r=>{r.particleSelection={...s,selectedConstraint:e.index}}))}selectParticleCreator(n,e){const s=n.getState().particleSelection;n.patchState(H.Uy(n.getState(),r=>{r.particleSelection={...s,selectedCreator:e.index}}))}selectParticleUpdater(n,e){const s=n.getState().particleSelection;n.patchState(H.Uy(n.getState(),r=>{r.particleSelection={...s,selectedUpdater:e.index}}))}updateTweenParticleLookupChapters(n,e){n.patchState(H.Uy(n.getState(),o=>{o.tweenParticleLookup=yr.updateChapterIds(o.tweenParticleLookup,e.chapterMap)}))}};var ee;Fe.\u0275fac=function(n){return new(n||Fe)},Fe.\u0275prov=i.Yz7({token:Fe,factory:Fe.\u0275fac}),ct([(0,l.aU)(be.ApplyPatch),Y("design:type",Function),Y("design:paramtypes",[Object,be.ApplyPatch]),Y("design:returntype",void 0)],Fe.prototype,"applyPatch",null),ct([(0,l.aU)(be.SetParticleState),Y("design:type",Function),Y("design:paramtypes",[Object,be.SetParticleState]),Y("design:returntype",void 0)],Fe.prototype,"setParticleState",null),ct([(0,l.aU)(be.SetParticleSystemsVisible),Y("design:type",Function),Y("design:paramtypes",[Object,be.SetParticleSystemsVisible]),Y("design:returntype",void 0)],Fe.prototype,"setParticlesVisible",null),ct([(0,l.aU)(be.SetParticleSystemVisible),Y("design:type",Function),Y("design:paramtypes",[Object,be.SetParticleSystemVisible]),Y("design:returntype",void 0)],Fe.prototype,"setParticleVisible",null),ct([(0,l.aU)(be.NewParticleSystem),Y("design:type",Function),Y("design:paramtypes",[Object,be.NewParticleSystem]),Y("design:returntype",void 0)],Fe.prototype,"newParticleSystem",null),ct([(0,l.aU)(be.DuplicateParticleSystem),Y("design:type",Function),Y("design:paramtypes",[Object,be.DuplicateParticleSystem]),Y("design:returntype",void 0)],Fe.prototype,"duplicateParticleSystem",null),ct([(0,l.aU)(be.UpdateParticleSystem),Y("design:type",Function),Y("design:paramtypes",[Object,be.UpdateParticleSystem]),Y("design:returntype",void 0)],Fe.prototype,"updateParticleSystem",null),ct([(0,l.aU)(be.DeleteChapterLookup),Y("design:type",Function),Y("design:paramtypes",[Object,be.DeleteChapterLookup]),Y("design:returntype",void 0)],Fe.prototype,"deleteChapterLookup",null),ct([(0,l.aU)(be.SetLookupForChapter),Y("design:type",Function),Y("design:paramtypes",[Object,be.SetLookupForChapter]),Y("design:returntype",void 0)],Fe.prototype,"setLookupForChapter",null),ct([(0,l.aU)(be.AssignParticle),Y("design:type",Function),Y("design:paramtypes",[Object,be.AssignParticle]),Y("design:returntype",void 0)],Fe.prototype,"assignParticle",null),ct([(0,l.aU)(be.UnassignParticle),Y("design:type",Function),Y("design:paramtypes",[Object,be.UnassignParticle]),Y("design:returntype",void 0)],Fe.prototype,"unassignParticle",null),ct([(0,l.aU)(be.DeleteParticleSystem),Y("design:type",Function),Y("design:paramtypes",[Object,be.DeleteParticleSystem]),Y("design:returntype",void 0)],Fe.prototype,"deleteParticleSystem",null),ct([(0,l.aU)(be.SelectParticleSystem),Y("design:type",Function),Y("design:paramtypes",[Object,be.SelectParticleSystem]),Y("design:returntype",void 0)],Fe.prototype,"selectParticleSystem",null),ct([(0,l.aU)(be.SelectParticleConstraint),Y("design:type",Function),Y("design:paramtypes",[Object,be.SelectParticleConstraint]),Y("design:returntype",void 0)],Fe.prototype,"selectParticleConstraint",null),ct([(0,l.aU)(be.SelectParticleCreator),Y("design:type",Function),Y("design:paramtypes",[Object,be.SelectParticleCreator]),Y("design:returntype",void 0)],Fe.prototype,"selectParticleCreator",null),ct([(0,l.aU)(be.SelectParticleUpdater),Y("design:type",Function),Y("design:paramtypes",[Object,be.SelectParticleUpdater]),Y("design:returntype",void 0)],Fe.prototype,"selectParticleUpdater",null),ct([(0,l.aU)(be.UpdateTweenParticleLookupChapters),Y("design:type",Function),Y("design:paramtypes",[Object,be.UpdateTweenParticleLookupChapters]),Y("design:returntype",void 0)],Fe.prototype,"updateTweenParticleLookupChapters",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getTweenParticleLookup",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getParticleSystems",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getVisisbleParticleSystems",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getParticleSystemsList",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getAssignedParticleSystems",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleSystemId",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleSystem",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleConstraintIndex",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleConstraint",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleCreatorIndex",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleCreator",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleUpdaterIndex",null),ct([(0,l.Qf)(),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],Fe,"getSelectedParticleUpdater",null),Fe=ts=ct([(0,l.ZM)({name:"engineParticles",defaults:{particleSelection:{},particleSystems:{},visibleParticleSystems:{},assignedParticles:{},tweenParticleLookup:{}}}),Y("design:paramtypes",[])],Fe),function(t){t.SetQuizState=(()=>{class I{constructor(ye){this.quizState=ye}}return I.type="[Quiz] Set Quiz State",I})(),t.ResetQuizState=(()=>{class I{constructor(){}}return I.type="[Quiz] Reset Quiz State",I})(),t.SetQuizSettings=(()=>{class I{constructor(ye){this.quizSettings=ye}}return I.type="[Quiz] Set Quiz Settings",I})(),t.SetQuizActive=(()=>{class I{constructor(ye){this.active=ye}}return I.type="[Quiz] Set Quiz Active",I})(),t.SetQuizEnabled=(()=>{class I{constructor(ye){this.enabled=ye}}return I.type="[Quiz] Set Quiz Enabled",I})(),t.SetQuizLocked=(()=>{class I{constructor(ye){this.locked=ye}}return I.type="[Quiz] Set Quiz Locked",I})(),t.SetEnableQuizRetake=(()=>{class I{constructor(ye){this.enable=ye}}return I.type="[Quiz] Set Enable Quiz Retake",I})(),t.SetQuizQuestionsMode=(()=>{class I{constructor(ye){this.mode=ye}}return I.type="[Quiz] Set Quiz Questions Mode",I})(),t.ReorderQuestions=(()=>{class I{constructor(ye){this.chapterIds=ye}}return I.type="[Quiz] Reoder Quiz Questions",I})(),t.AddQuestion=(()=>{class I{constructor(ye){this.question=ye}}return I.type="[Quiz] Add Quiz Question",I})(),t.SetQuestions=(()=>{class I{constructor(ye){this.questions=ye}}return I.type="[Quiz] Set Quiz Questions",I})(),t.RemoveQuestions=(()=>{class I{constructor(ye){this.questionIds=ye}}return I.type="[Quiz] Remove Quiz Questions",I})(),t.SetQuestion=(()=>{class I{constructor(ye){this.question=ye}}return I.type="[Quiz] Set Quiz Question",I})(),t.SubmitQuestionAnswer=(()=>{class I{constructor(ye){this.submission=ye}}return I.type="[Quiz] Submit Question Answer",I})(),t.NextQuestion=(()=>{class I{constructor(){}}return I.type="[Quiz] Advance Question",I})(),t.PreviousQuestion=(()=>{class I{constructor(){}}return I.type="[Quiz] Previous Question",I})(),t.ClearSubmissions=(()=>{class I{constructor(){}}return I.type="[Quiz] Clear Submissions",I})(),t.SetActiveQuestion=(()=>{class I{constructor(ye){this.questionId=ye}}return I.type="[Quiz] Set Active Question",I})(),t.SetQuizPickMode=(()=>{class I{constructor(ye){this.pickMode=ye}}return I.type="[Quiz] Set Pick Mode",I})(),t.SetActiveSubmission=(()=>{class I{constructor(ye){this.submission=ye}}return I.type="[Quiz] Set Active QuestionAnswer",I})(),t.SetQuizLifecycle=(()=>{class I{constructor(ye){this.lifecycle=ye}}return I.type="[Quiz] Set Quiz Lifecycle",I})()}(ee||(ee={}));var Re=(()=>(function(t){t.MultipleChoice="multiple-choice",t.SelectAnatomy="select-anatomy",t.LabelAnatomy="label-anatomy",t.Instructions="text-only"}(Re||(Re={})),Re))();const I1={[Re.MultipleChoice]:"Multiple Choice",[Re.SelectAnatomy]:"Select Anatomy in 3D",[Re.LabelAnatomy]:"Label Anatomy",[Re.Instructions]:"Instructions"};function mf(t){const n=t.map(e=>(e.quizQuestions||[]).map(s=>({...s,chapterId:s.chapterId||e.id})));return[].concat(...n)}function bf(t){return"string"==typeof t.data.correctAnswer?[t.data.correctAnswer]:t.data.correctAnswer}function As(t,n){const e=bf(t);switch(t.type){case Re.LabelAnatomy:return(0,m.isEqual)(e,n);case Re.MultipleChoice:return(0,m.isEqual)(e.sort(),n.sort());case Re.SelectAnatomy:if(void 0===t.data.selectType||"all"===t.data.selectType)return(0,m.isEqual)(e.sort(),n.sort());if("any"===t.data.selectType)return 0===(0,m.difference)(n,e).length&&n.length>0}}function yf(t,n){const e=t.filter(g=>g.type!==Re.Instructions),o=t.reduce((g,h)=>(g[h.id]=function A1(t,n){const e=t.find(o=>o.questionId===n);return e?e.answer:void 0}(n,h.id),g),{}),s=t.reduce((g,h)=>(g[h.id]=bf(h),g),{}),r=e.filter(g=>{const h=o[g.id];return As(g,typeof h>"u"?[]:"string"==typeof h?[h]:h)}),a=t.length,c=e.length,p=r.length,d=a-p;return{score:a>0?Math.round(p/c*100):0,total:a,scorableTotal:c,correctTotal:p,incorrectTotal:d,questionAnswers:o,correctQuestionAnswers:s}}var Gc,mi=(()=>(function(t){t[t.Question=0]="Question",t[t.Explanation=1]="Explanation",t[t.Review=2]="Review"}(mi||(mi={})),mi))(),De=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},N=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ia=(()=>(function(t){t[t.Learning=0]="Learning",t[t.Assessment=1]="Assessment"}(Ia||(Ia={})),Ia))();const Sd={quizModeActive:!1,quizModeLocked:!1,quizQuestionsMode:"all",enableQuizRetake:!0,launchMode:Ia.Learning,questions:[],activeQuestionId:void 0,activeSubmission:void 0,questionSubmissions:[],quizSettings:{enabled:!0,showSummary:!0,showExplanation:!0,showSubmit:!0,showProgress:!0},pickMode:"single",lifecycle:mi.Question};function _f(t,n){return t.filter(e=>e.chapterId===n)}function Pd(t,n){const e=n.map(s=>_f(t,s));return[].concat(...e)}function kd(t){const n=function U1(t){return[...new Set(t.map(n=>n.chapterId))]}(t);return Pd(t,n)}let U=Gc=class{static getQuizQuestionsByChapter(n){return(0,l.P1)([Gc],e=>_f(e.questions,n))}static getLifecycle(n){return n.lifecycle}static getQuizSettings(n){return n.quizSettings}static getQuizModeActive(n){return n.quizModeActive}static getQuizModeLocked(n){return n.quizModeLocked}static getEnableQuizRetake(n){return n.enableQuizRetake}static getQuizReviewEnabled(n){const{quizModeLocked:e,quizQuestionsMode:o,questions:s,quizSettings:r}=n;return!(e&&!r.showSummary||e&&"restricted"===o&&1===s.length)}static globalSceneConfig(n){return n.sceneConfig}static hasQuiz(n){return n.questions.length>0}static getQuizEnabled(n){return!1!==n.quizSettings.enabled}static getAllQuestions(n){return n.questions}static getAllSubmissions(n){return n.questionSubmissions}static getActiveSubmitted(n){const{questionSubmissions:e,activeQuestionId:o}=n;return e.find(s=>s.questionId===o)}static getActiveSubmission(n){return n.activeSubmission}static getActiveQuestion(n){return n.questions.find(e=>e.id===n.activeQuestionId)}static getActiveQuestionId(n){return n.activeQuestionId}static getActiveQuestionLabels(n){const e=n.questions.find(o=>o.id===n.activeQuestionId);return e&&e.type===Re.LabelAnatomy?e.data.options:[]}static getActiveQuestionIndex(n){return n.questions.findIndex(e=>e.id===n.activeQuestionId)}static getQuestionIndex(n,e){return(0,l.P1)([Gc],o=>Pd(o.questions,n).findIndex(s=>s.id===e))}static getQuestionTotal(n){return n.questions.length}static getCorrectAnswerTotal(n){const{questionSubmissions:e,questions:o}=n;return e.filter(r=>As(o.find(c=>c.id===r.questionId),r.answer)).length}static getQuestionsRemaining(n){const{questions:e,questionSubmissions:o}=n;return e.length-o.length}static hasQuestionRemaining(n){const{questions:e,questionSubmissions:o}=n;return o.length<e.length}static getPickMode(n){return n.pickMode}resetQuizState(n,e){n.setState({...Sd})}setQuizState(n,{quizState:e}){n.setState({...Sd,...e})}setQuizSettings(n,{quizSettings:e}){n.patchState({quizSettings:e})}setQuizActive(n,e){n.patchState({quizModeActive:e.active,activeQuestionId:!1===e.active?void 0:n.getState().activeQuestionId})}setQuizEnabled(n,e){const o=n.getState().quizSettings;n.patchState({quizSettings:{...o,enabled:e.enabled}})}setQuizLocked(n,e){n.patchState({quizModeLocked:e.locked})}setEnableQuizRetake(n,e){n.patchState({enableQuizRetake:e.enable})}setQuizQuestionsMode(n,e){n.patchState({quizQuestionsMode:e.mode})}reorderQuestions(n,{chapterIds:e}){n.patchState({questions:Pd(n.getState().questions,e)})}addQuestion(n,e){const o=[...n.getState().questions,e.question];n.patchState({questions:kd(o)})}setQuestions(n,{questions:e}){n.patchState({questions:kd(e)})}setQuestion(n,e){const o=n.getState().questions.map(s=>s.id===e.question.id?e.question:s);n.patchState({questions:o})}removeQuestions(n,e){const o=n.getState(),s=null!=e.questionIds?e.questionIds:o.questions.map(a=>a.id),r=o.questions.filter(a=>!s.includes(a.id));n.patchState({questions:kd(r)})}submitQuestionAnswer(n,e){const o=[...n.getState().questionSubmissions],s=o.findIndex(a=>a.questionId===e.submission.questionId);s>-1?o[s]=e.submission:o.push(e.submission),n.patchState({questionSubmissions:o})}nextQuestion(n){const{questions:e,activeQuestionId:o}=n.getState(),r=e[n.getState().questions.findIndex(a=>a.id===o)+1]?.id||void 0;void 0!==r&&n.patchState({activeQuestionId:r})}previousQuestion(n){const{questions:e,activeQuestionId:o}=n.getState(),r=e[n.getState().questions.findIndex(a=>a.id===o)-1]?.id||void 0;void 0!==r&&n.patchState({activeQuestionId:r})}clearSubmissions(n){n.patchState({questionSubmissions:[]})}setActiveQuestion(n,e){n.patchState({activeQuestionId:e.questionId})}setQuizPickMode(n,{pickMode:e}){n.patchState({pickMode:e})}setActiveSubmission(n,{submission:e}){n.patchState({activeSubmission:e})}setQuizLifecycle(n,e){n.patchState({lifecycle:e.lifecycle})}};U.\u0275fac=function(n){return new(n||U)},U.\u0275prov=i.Yz7({token:U,factory:U.\u0275fac}),De([(0,l.aU)(ee.ResetQuizState),N("design:type",Function),N("design:paramtypes",[Object,ee.ResetQuizState]),N("design:returntype",void 0)],U.prototype,"resetQuizState",null),De([(0,l.aU)(ee.SetQuizState),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizState]),N("design:returntype",void 0)],U.prototype,"setQuizState",null),De([(0,l.aU)(ee.SetQuizSettings),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizSettings]),N("design:returntype",void 0)],U.prototype,"setQuizSettings",null),De([(0,l.aU)(ee.SetQuizActive),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizActive]),N("design:returntype",void 0)],U.prototype,"setQuizActive",null),De([(0,l.aU)(ee.SetQuizEnabled),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizEnabled]),N("design:returntype",void 0)],U.prototype,"setQuizEnabled",null),De([(0,l.aU)(ee.SetQuizLocked),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizLocked]),N("design:returntype",void 0)],U.prototype,"setQuizLocked",null),De([(0,l.aU)(ee.SetEnableQuizRetake),N("design:type",Function),N("design:paramtypes",[Object,ee.SetEnableQuizRetake]),N("design:returntype",void 0)],U.prototype,"setEnableQuizRetake",null),De([(0,l.aU)(ee.SetQuizQuestionsMode),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizQuestionsMode]),N("design:returntype",void 0)],U.prototype,"setQuizQuestionsMode",null),De([(0,l.aU)(ee.ReorderQuestions),N("design:type",Function),N("design:paramtypes",[Object,ee.ReorderQuestions]),N("design:returntype",void 0)],U.prototype,"reorderQuestions",null),De([(0,l.aU)(ee.AddQuestion),N("design:type",Function),N("design:paramtypes",[Object,ee.AddQuestion]),N("design:returntype",void 0)],U.prototype,"addQuestion",null),De([(0,l.aU)(ee.SetQuestions),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuestions]),N("design:returntype",void 0)],U.prototype,"setQuestions",null),De([(0,l.aU)(ee.SetQuestion),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuestion]),N("design:returntype",void 0)],U.prototype,"setQuestion",null),De([(0,l.aU)(ee.RemoveQuestions),N("design:type",Function),N("design:paramtypes",[Object,ee.RemoveQuestions]),N("design:returntype",void 0)],U.prototype,"removeQuestions",null),De([(0,l.aU)(ee.SubmitQuestionAnswer),N("design:type",Function),N("design:paramtypes",[Object,ee.SubmitQuestionAnswer]),N("design:returntype",void 0)],U.prototype,"submitQuestionAnswer",null),De([(0,l.aU)(ee.NextQuestion),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U.prototype,"nextQuestion",null),De([(0,l.aU)(ee.PreviousQuestion),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U.prototype,"previousQuestion",null),De([(0,l.aU)(ee.ClearSubmissions),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U.prototype,"clearSubmissions",null),De([(0,l.aU)(ee.SetActiveQuestion),N("design:type",Function),N("design:paramtypes",[Object,ee.SetActiveQuestion]),N("design:returntype",void 0)],U.prototype,"setActiveQuestion",null),De([(0,l.aU)(ee.SetQuizPickMode),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizPickMode]),N("design:returntype",void 0)],U.prototype,"setQuizPickMode",null),De([(0,l.aU)(ee.SetActiveSubmission),N("design:type",Function),N("design:paramtypes",[Object,ee.SetActiveSubmission]),N("design:returntype",void 0)],U.prototype,"setActiveSubmission",null),De([(0,l.aU)(ee.SetQuizLifecycle),N("design:type",Function),N("design:paramtypes",[Object,ee.SetQuizLifecycle]),N("design:returntype",void 0)],U.prototype,"setQuizLifecycle",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getLifecycle",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],U,"getQuizSettings",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getQuizModeActive",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getQuizModeLocked",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getEnableQuizRetake",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Boolean)],U,"getQuizReviewEnabled",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"globalSceneConfig",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"hasQuiz",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getQuizEnabled",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getAllQuestions",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getAllSubmissions",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getActiveSubmitted",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getActiveSubmission",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getActiveQuestion",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getActiveQuestionId",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Array)],U,"getActiveQuestionLabels",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getActiveQuestionIndex",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getQuestionTotal",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getCorrectAnswerTotal",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getQuestionsRemaining",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"hasQuestionRemaining",null),De([(0,l.Qf)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],U,"getPickMode",null),U=Gc=De([(0,l.ZM)({name:"quiz",defaults:Sd})],U);const _r={colors:[245,245,245,1,245,245,245,1],gradientType:"radial",colorStops:[0,100]};var fi=(()=>(function(t){t.JPEG="image/jpeg",t.PNG="image/png"}(fi||(fi={})),fi))();let Jc=(()=>{class t{constructor(e){this.thumbnails=e}}return t.type="[Story Chapters] Register thumbnail URLs from story",t})(),xr=(()=>{class t{constructor(e,o=_r,s=fi.JPEG,r=.92,a,c="original",p,d,u=[]){this.chapterId=e,this.background=o,this.imageType=s,this.imageQuality=r,this.dimensions=a,this.crop=c,this.includeLabels=p,this.includeCopyright=d,this.layers=u}}return t.type="[Story Chapters] Take picture",t})(),vr=(()=>{class t{constructor(e,o,s){this.chapterId=e,this.blob=o,this.dimensions=s}}return t.type="[Story Chapters] Take picture success",t})();var wo;function Hc(t){if(!t||!t.colors)return!1;const n=t.colors,e=n[3];return n.length<=4?0===e:0===e&&0===n[7]}function vf(t){const n=t?.colors;if(Array.isArray(n)){const e=n.slice(0,3);return wo.isLight(e)}return!1}!function(t){const e=/(\s*[\d\.]+\s*,){2,15}\s*[\d\.]+\s*/g;function s(R){for(let D=0;D<3;D++)if(parseFloat(`${R[D]}`)>1)return!0;return!1}function a(R){const D=document.createElement("div");D.style.backgroundColor=R,document.documentElement.appendChild(D);const I=window.getComputedStyle(D).backgroundColor.replace(/\s/g,"");return window.document.documentElement.removeChild(D),I}function c(R){const D=R.slice(0,4);3===D.length&&D.push(1);for(let I=0;I<4;I++)D[I]=parseFloat(`${D[I]}`),D[I]<0&&(D[I]=0),D[I]>255&&(D[I]=255);return D[3]>1&&(D[3]=1),D}function p(R){let D;if(Array.isArray(R))D=c(R);else if("string"==typeof R){let I=R.match(e);I?D=c(I[0].split(",")):(I=a(R).match(e),I&&(D=c(I[0].split(","))))}return D}function d(R){const D=p(R);if(!D)throw new TypeError("Invalid color input.");const I=g(D);return{1:s(D)?I:D,255:s(D)?D:I}}function g(R){const D=s(R),I=[];for(let ce=0;ce<3;ce++){let ye=D?R[ce]/255:255*R[ce];ye=D?Math.round(100*ye)/100:Math.round(ye),I.push(ye)}return 4===R.length&&I.push(R[3]),I}function h(R,D=!1){R=R.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(Ae,An,mo,Ho)=>[An,An,mo,mo,Ho,Ho].join("")).replace(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,(Ae,An,mo,Ho)=>[An,mo,Ho,"ff"].join(""));const I=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(R),ce=parseInt(I[1],16),ye=parseInt(I[2],16),ie=parseInt(I[3],16),rt=parseInt(I[4],16)/255;if(D){const Ae=V([ce,ye,ie]);return[Ae[0],Ae[1],Ae[2],rt]}return[ce,ye,ie,rt]}function B(R){const[D,I,ce]=R;return Math.sqrt(D*D*.299+I*I*.587+ce*ce*.114)}function V(R){return R.map(I=>I/255)}function ge(R){return R.map(I=>Math.round(255*I))}function F(R){return`#${R.map(I=>{const ce=I.toString(16);return ce.length%2?`0${ce}`:ce}).join("")}`}t.is255=s,t.isLight=function r(R,D){return D||(D=[...R]),(B(R)+B(D))/2>140.25},t.getComputedColor=a,t.convertChannels=c,t.convert=p,t.getColor=d,t.getColors=function u(R){let D=[];if("string"==typeof R){const I=R.match(e);I&&(R=I.join(",")),R=R.split(",")}if(Array.isArray(R))if(Array.isArray(R[0])&&Array.isArray(R[1]))D=R;else if(R.length<=2)D=1===R.length?R.concat(R):R;else{const ce=Math.floor(R.length/2);D=R.length>4?[R.slice(0,ce),R.slice(ce)]:[R,R]}return D.map(I=>d(I))},t.scaleColor=g,t.hexToRgba=h,t.hexToRgb=function y(R,D=!1){const I=h(R,D);return[I[0],I[1],I[2]]},t.rgbToHex=function k(R,D=!1){return F(D?ge(R):R)},t.rgbToHSP=B,t.rgbaToHex=function K(R,D=!1){const I=R[0],ce=R[1],ye=R[2],ie=255*R[3];return F(D?[...ge([I,ce,ye]),ie]:[I,ce,ye,ie])},t.rgbToDecimal=V,t.rgbFromDecimal=ge}(wo||(wo={}));const Cf={small:{width:256,height:256},medium:{width:512,height:512},large:{width:1024,height:1024}};var wf;class Cr{constructor(){this[wf]=!0}}wf=H.sc;var So,Ue=A(8563),Sf=A(489),Ii=A(9306),j1=A(6080),Vn=A(1325),Q1=A(7504),Z1=A.n(Q1),Yc=A(7443),Wc=A(5344),B1=A(9184);!function(t){t.exportImage=function n(d,u,g,h){const y="string"==typeof d?t.base64ToBlob(d,u):d;return h?(0,B1.E4)(y,h).then(function(k){(0,Wc.saveAs)(k,g)}):(0,Wc.saveAs)(y,g),(0,Ue.of)(!0)},t.canvasToBlob=function e(d,u,g){return new b.y(h=>{d.toBlob(y=>{h.next(y),h.complete()},u,g)})},t.fitCanvas=function o(d,{width:u,height:g}){const h=document.createElement("canvas");h.width=u,h.height=g;const y=h.getContext("2d"),V=Math.max(.5*(d.width-h.width/h.height*d.height),0);return new b.y(ge=>{y.drawImage(d,V,0,h.width,h.height),ge.next(h),ge.complete()})},t.elementToCanvas=function s(d,u=!1){const g=u?{backgroundColor:"transparent"}:{};return(0,Yc.D)(Z1()(d,{scale:1,...g}))},t.combineCanvasElements=function r(d){const u=Math.max(0,...d.map(k=>k.width)),g=Math.max(0,...d.map(k=>k.height)),h=document.createElement("canvas");h.width=u,h.height=g;const y=h.getContext("2d");return d.forEach(k=>{y.drawImage(k,0,0)}),h},t.base64ToBlob=function a(d,u){const g=atob(d.split(",")[1]),h=new ArrayBuffer(g.length),y=new Uint8Array(h);for(let k=0;k<g.length;k++)y[k]=g.charCodeAt(k);return new Blob([h],{type:u})},t.blobToBase64=function c(d){return new b.y(u=>{const g=new FileReader;g.addEventListener("load",()=>{u.next(g.result),u.complete()}),g.readAsDataURL(d)})},t.blobToCanvas=function p(d,{width:u,height:g}){return new b.y(h=>{const y=document.createElement("canvas");y.width=u,y.height=g;const k=y.getContext("2d"),B=new Image;B.addEventListener("load",()=>{k.drawImage(B,0,0),h.next(y),h.complete()}),B.src=URL.createObjectURL(d)})}}(So||(So={}));let Od=(()=>{class t{constructor(e){this.engineService=e}setPostProcessingFeatures(e){const{renderer:o,story:s}=this.engineService.engine;s?.activeChapter&&(s.activeChapter.postProcess.length=0,s.activeChapter.postProcess.push(...e)),o.setPostProcessingPipeline(e)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Kc=A(5014);const V1={stats:{textures:{baseColor:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},alpha:{"1024x1024":1,memory:1e6,"512x512":1},normals:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},emit:{"1024x1024":1,memory:1e6,"512x512":1,"256x256":1},roughness:{"512x512":1,memory:1e6,"1024x1024":1}}}},Pf=Kc.create(),za=Kc.create();let Po=(()=>{class t{constructor(e){this.engineService=e}get canvas(){if(!this.engineService.engine)throw new Error("Engine not defined, cannot use canvas");return this.engineService.engine.renderer.canvas}forceRenderFrame(){this.engineService.engine.renderer.render()}getCanvas(){return this.canvas}getScene(){return V1}getViewMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.worldMatrixInverse)}getProjMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.projectionMatrix)}pick(e,o,s=!0){const r=this.engineService.engine,a=r.story?.activeChapter,c=r.rayCastCamera(e,o,{filter:p=>a?.findAnatomyObject(p)?.pickable});if(c){const p=this.generateHitModel(a,e,o,c,s);return this.engineService.fireEvent(pe.PickPicked,p),p}return{canvasPos:{x:e,y:o}}}setTransparencyMode(e){this.engineService.engine.renderer.transparencyMode=e}scaleAndNormalizeMatrix(e){return Kc.copy(za,e),za[12]*=xe.BIODIGITAL_SCENE_SCALE,za[13]*=xe.BIODIGITAL_SCENE_SCALE,za[14]*=xe.BIODIGITAL_SCENE_SCALE,za}generateHitModel(e,o,s,r,a){const{triIndex:c,intersection:p,object:d}=r,u=e.findAnatomyObject(d),{objectId:g,renderables:h}=u,y=h.findIndex(V=>V.meshNode===d),k=h[y]?.meshNode,K={canvasPos:{x:o,y:s},objectId:g,renderableIndex:y,triIndex:c};if(a){const V=this.getBarycentricCoordinate(k,p,c);return he.scale(p,p,1/xe.BIODIGITAL_SCENE_SCALE),{...K,barycentric:V,worldPos:p}}return K}getBarycentricCoordinate(e,o,s){const r=he.create(),a=xe.vec3Pool.get(),c=xe.vec3Pool.get(),p=xe.vec3Pool.get(),d=xe.vec3Pool.get();return Kc.invert(Pf,e.worldMatrix),he.transformMat4(a,o,Pf),(0,xe.getTrianglePositions)(e,s,c,p,d),(0,xe.barycentricCoord)(r,a,c,p,d),xe.vec3Pool.release(a),xe.vec3Pool.release(c),xe.vec3Pool.release(p),xe.vec3Pool.release(d),r}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),kf=(()=>{class t{constructor(e,o,s,r,a){this.labelsService=e,this.postProcessingService=o,this.engineRendererService=s,this.cameraService=r,this.store=a}localResize(e,o){const s=this.engineRendererService.getCanvas(),r=s.parentNode,a=r.clientWidth,c=r.clientHeight;return r.width=e,r.height=o,s.width=e,s.height=o,r.style.width=`${e}px`,r.style.height=`${o}px`,[a,c]}canvasToImage(e,o="original"){const s=e.width/e.height,r=this.engineRendererService.getCanvas();let{width:a,height:c}=r,p=.5*(r.width-a),d=0;switch(o){case"square":c>a?c=a:a=c,p=.5*(r.width-a),d=.5*(r.height-c);break;case"original":a=s*c}return new b.y(u=>{requestAnimationFrame(()=>{e.getContext("2d").drawImage(r,p,d,a,c,0,0,e.width,e.height),u.next(),u.complete()})})}canvasToImageWithResize(e){const o=this.engineRendererService.getCanvas();this.store.dispatch(new Wo(!1));const[s,r]=this.localResize(e.width,e.height),a=e.getContext("2d");return new b.y(c=>{requestAnimationFrame(()=>{a.drawImage(o,0,0,o.width,o.height),this.localResize(s,r),this.store.dispatch(new Wo(!0)),c.next(),c.complete()})})}drawRadialGradient(e,o){const s=o.colors,[a,c]=o.colorStops.map(h=>((h,y,k)=>{const[B,K]=[Math.pow(y/2,2),Math.pow(k/2,2)];return h/100*Math.pow(B+K,.5)})(h,e.width,e.height)),p=e.getContext("2d"),[d,u]=[e.width/2,e.height/2],g=p.createRadialGradient(d,u,a,d,u,c);g.addColorStop(o.colorStops[0]/100,`rgba(${s.slice(0,4).join(",")})`),g.addColorStop(o.colorStops[1]/100,`rgba(${s.slice(4,8).join(",")})`),p.fillStyle=g,p.fillRect(0,0,e.width,e.height)}drawLinearGradient(e,o){const s=o.colors,r=e.getContext("2d"),[a,c]=[e.width/2,e.height/2],p=r.createLinearGradient(a,c,a,e.height);p.addColorStop(o.colorStops[0]/100,`rgba(${s.slice(0,4).join(",")})`),p.addColorStop(o.colorStops[1]/100,`rgba(${s.slice(4,8).join(",")})`),r.fillStyle=p,r.fillRect(0,0,e.width,e.height)}takeSnapshot(e,o,s,r,a,c){const{imageType:p,imageQuality:d,copyrightEnabled:u,crop:g}=c,h=document.createElement("canvas");h.width=e,h.height=o,"radial"===s.gradientType?this.drawRadialGradient(h,s):"linear"===s.gradientType&&this.drawLinearGradient(h,s);const y=this.engineRendererService.getCanvas(),B=[],K=(h.height>y.height||h.width>y.width?this.canvasToImageWithResize(h):this.canvasToImage(h,g)).pipe((0,J.U)(()=>h));B.push(K);const V=[],ge=this.labelsService.getLabelContainer();return a&&ge&&V.push(ge.nativeElement),V.push(...r),B.push(...V.map(F=>(F instanceof HTMLCanvasElement?(0,Ue.of)(F):So.elementToCanvas(F,!0)).pipe((0,Ii.V)(D=>So.fitCanvas(D,{width:e,height:o}))))),(0,Sf.z)(B).pipe((0,j1.c)(),(0,J.U)(F=>So.combineCanvasElements(F)),(0,Ii.V)(F=>u?this.writeLogoToCanvas(F,c):(0,Ue.of)(F)),(0,Ii.V)(F=>So.canvasToBlob(F,p,d)))}writeLogoToCanvas(e,o){return this.getLogoImage(o.copyrightImagePath).pipe((0,J.U)(s=>{let{width:r,height:a}=s;const{width:c,height:p}=e;if(.1*c>r){const h=a/r;r=.1*c,a=h*r}const{xOffset:d,yOffset:u}=this.getLogoPosition(c,p,r,a,o);return e.getContext("2d").drawImage(s,d,u,r,a),e}),(0,Vn.K)(()=>(0,Ue.of)(e)))}getLogoImage(e){return new b.y(o=>{const s=new Image;s.onload=()=>{o.next(s),o.complete()},s.onerror=()=>o.error(),s.src=e})}getLogoPosition(e,o,s,r,a){const{copyrightPosition:c,copyrightOffset:p}=a;let d,u;switch(c.x){case"right":d=e-s;break;case"center":d=e/2-s/2;break;default:d=0}switch(c.y){case"bottom":u=o-r;break;case"center":u=o/2-r/2;break;default:u=0}return{xOffset:d+p.x,yOffset:u+p.y}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Os),i.LFG(Od),i.LFG(Po),i.LFG(Bn),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Aa=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},oi=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const q1={imageType:fi.JPEG,crop:"original",copyrightEnabled:!1,copyrightImagePath:"assets/images/powered-by-biodigital-color.svg",copyrightPosition:{x:"left",y:"bottom"},copyrightOffset:{x:12,y:-12},imageQuality:1},$1={thumbnails:new Map};let Wt=class{constructor(n,e){this.snapshotService=n,this.store=e}static getRegisteredThumbnails(n){return n.thumbnails}registerChapterThumbnails(n,e){n.patchState(H.Uy(n.getState(),o=>{o.thumbnails=new Map(e.thumbnails)}))}takeChapterPicture(n,e){const{chapterId:o,includeLabels:s,includeCopyright:r,dimensions:a,imageType:c,imageQuality:p,crop:d,layers:u}=e,g=a||Cf.large,{width:h,height:y}=g,k=e.background;let B;B=c===fi.PNG?k||_r:k&&!Hc(k)?k:_r;const K=k.colors.slice(0,3),V=wo.isLight(K),ge={...q1,crop:d,imageType:c,imageQuality:p,copyrightEnabled:r,copyrightImagePath:V?"assets/images/powered-by-biodigital-color.svg":"assets/images/powered-by-biodigital-white.svg"};setTimeout(()=>{this.snapshotService.takeSnapshot(h,y,B,u,s,ge).subscribe(F=>{n.dispatch(new vr(o,F,g))})})}takeChapterPictureSuccess(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.thumbnails.get(e.chapterId)||new Cr;s.snapshot=URL.createObjectURL(e.blob),o.thumbnails.set(e.chapterId,s)}))}};function Y1(t,n){try{const e=Of(t),o=Of(n),s=!1===t.opacity?1:t.opacity,r=!1===n.opacity?1:n.opacity;return e===o?s===r?t.saturation===n.saturation?t.brightness===n.brightness?t.contrast>n.contrast?e+4:e-4:t.brightness>n.brightness?e+3:e-3:t.saturation>n.saturation?e+2:e-2:s>r?e+1:e-1:e-o}catch{return 0}}function Of(t){if(!t.tintColor)return-10;const n=t.tintColor[0],e=t.tintColor[1],o=t.tintColor[2],s=Math.max(n,e,o),a=s-Math.min(n,e,o);let c=0;return c=s===n?(e-o)/a:s===e?2+(o-n)/a:4+(n-e)/a,c*=60,c<0&&(c+=360),c}function Tf(t){const n=new Map;return t.filter(o=>{const s=JSON.stringify(o,Object.keys(o));return!n.has(s)&&(n.set(s,!0),!0)})}Wt.\u0275fac=function(n){return new(n||Wt)(i.LFG(kf),i.LFG(l.yh))},Wt.\u0275prov=i.Yz7({token:Wt,factory:Wt.\u0275fac}),Aa([(0,l.aU)(Jc),oi("design:type",Function),oi("design:paramtypes",[Object,Jc]),oi("design:returntype",void 0)],Wt.prototype,"registerChapterThumbnails",null),Aa([(0,l.aU)(xr),oi("design:type",Function),oi("design:paramtypes",[Object,xr]),oi("design:returntype",void 0)],Wt.prototype,"takeChapterPicture",null),Aa([(0,l.aU)(vr),oi("design:type",Function),oi("design:paramtypes",[Object,vr]),oi("design:returntype",void 0)],Wt.prototype,"takeChapterPictureSuccess",null),Aa([(0,l.Qf)(),oi("design:type",Function),oi("design:paramtypes",[class R1{}]),oi("design:returntype",void 0)],Wt,"getRegisteredThumbnails",null),Wt=Aa([(0,l.ZM)({name:"storyThumbnails",defaults:$1}),oi("design:paramtypes",[kf,l.yh])],Wt);let wr=(()=>{class t{constructor(e,o){this.graphService=e,this.sceneService=o,this.highlightDisabled=!1}colorObject(e,o){const s=this.sceneService.getObjectById(e);if(this.sceneService.isLeaf(s)){const r=s.modifiers;Object.keys(o).forEach(a=>{const c=o[a];if(!1===c)r.delete(a);else{const p={applyTo:a,range:null};if(function G1(t){return Array.isArray(t)&&5===t.length}(c)){const[d,u,g,h,y]=c;p.fresnel={center:d,edge:u,centerBias:g,edgeBias:h,power:y}}else p.value=c;r.set(a,p)}})}}getColor(e){return function W1(t,n){const e=t.getObjectById(n);if(t.isLeaf(e)){const s={};return e.modifiers.forEach(r=>{s[r.applyTo]=r.fresnel??r.value}),s}return null}(this.sceneService,e)}uncolorObject(e){const o=this.sceneService.getObjectById(e);this.sceneService.isLeaf(o)&&o.modifiers.clear()}unpaint(e,o){this.graphService.getLeafDescendants(e,o.id).forEach(s=>{const r=this.sceneService.getObjectById(s);this.sceneService.isLeaf(r)&&r.modifiers.clear()})}paint(e,o,s){const r=Is(s);this.graphService.getLeafDescendants(e,o).forEach(a=>{this.colorObject(a,r)})}highlight(e,o,s){(!1===this.highlightDisabled||!1===s)&&this.graphService.getLeafDescendants(e,o).forEach(r=>{const a=this.sceneService.getObjectById(r);this.sceneService.isLeaf(a)&&(a.selected=s)})}paintAll(e,o,s){o.forEach(r=>this.paint(e,r,s))}unpaintAll(e,o){o.forEach(s=>{this.unpaint(e,s)})}highlightAll(e,o,s){o.forEach(r=>this.highlight(e,r,s))}disableHighlight(){this.highlightDisabled=!0}enableHighlight(){this.highlightDisabled=!1}setHighlightColor(e){}getColorRecipes(){return[]}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Oi),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class K1{constructor(n){this.shown="majorityWins",this.selected="majorityWins",this.pickable="majorityWins",n.forEach(e=>{this[e]="majorityWins"})}}const X1={play:{count:1}};let Mf=(()=>{class t{constructor(e,o,s,r){this.store=e,this.labelService=o,this.paintService=s,this.engineService=r}getMinimumGraphSync(e,o,s){const r=this.paintService.getColorRecipes(),a=Object.keys(Oc(r)),c=function m1(t,n,e){const o={},s={};return Mc(t,a=>{s[a]=function J0(t,n){return t.roots.hasOwnProperty(n)||!1}(t,a)?{...Tc(t,a,e),...n[a]||{}}:{...s[t.predecessors[a]],...n[a]||{}},Ca(t,a)&&(o[a]=s[a])}),o}(e,o,a),d=_1(e,JSON.parse(JSON.stringify(new K1(r))),c);Object.entries(o).forEach(([g,h])=>{const y=(0,m.omit)(h,a);(0,m.isEmpty)(y)||(d[g]={...d[g]||{},...y})});const u=new V0;return Object.entries(d).forEach(([g,h])=>{u[this.switchNamespace(g,s)]=h},this),u}convertGraphSync(e){const o={},s={},r={},a={};return Object.entries(e).forEach(([c,p])=>{Object.entries(p).forEach(([d,u])=>{"shown"===d?o[c]=u:"selected"===d?s[c]=u:"pickable"===d?r[c]=!u:a[c]={...a[c]||{},[d]:u}},this)},this),{showObjects:o,selectObjects:s,pickThroughObjects:r,synchronization:a}}switchNamespace(e,o){return o[e]||e}serializeHotspots(e,o){let s=[...e.hotspots],r={};return o.filter(c=>c.chapterId===e.id).forEach(c=>{const p=this.labelService.serializeLabel(c,s.length);s=[...s,...p.hotspots],r={...r,...p.data}}),{customData:r,hotspots:s}}calcMinimumPaintState(e,o){function s(r,a=!0){const p=(e.successors[r]||[]).reduce((d,u)=>({...d,...s(u,!(0,m.isEqual)(o[r],o[u]))}),{});return a?{[r]:o[r],...p}:p}return Object.keys(e.roots).reduce((r,a)=>({...r,...s(a)}),{})}serializeVisibilityLayers(e,o){const r={...e};return Array.isArray(e?.layers)&&(r.layers=e.layers.map(a=>({...a,objectIds:a.objectIds.filter(c=>Object.prototype.hasOwnProperty.call(o.nodes,c))})).filter(a=>a.objectIds.length>0)),r}duplicateTimelineMap(e){return e?e.map(o=>{const s=(0,m.cloneDeep)(o);return delete s.id,s}):[]}duplicateQuizQuestions(e){return this.store.selectSnapshot(U.getQuizQuestionsByChapter(e)).map(o=>{const s=(0,m.cloneDeep)(o);return delete s.chapterId,s})}serializeChapter(e,o,s,r,a){const c=this.serializeHotspots(o,r),p=this.store.selectSnapshot(Fe.particleSystemsForChapter(o.id)),u={...(0,m.pickBy)(o.customData,(F,R)=>!R.startsWith("errand")),...c.customData,particleSystems:p.map(F=>F.id)},g=a[o.id],h=this.store.selectSnapshot(Wt.getRegisteredThumbnails),y=h.get(g)?.urls||h.get(o.id)?.urls||null,k={id:g,displayName:o.displayName,description:o.description,[o.camera.action]:o.camera.location,cameraRotationCenter:o.camera.rotationCenter,background:o.background??{},hotspots:c.hotspots,clippingPlanes:{clips:o.clippingPlanes.clips,boundary:o.clippingPlanes.boundary},ui:(0,m.isEmpty)(o.ui)?X1:o.ui,media:o.media,timelineMap:this.duplicateTimelineMap(o.timelineMap),customData:u,lights:o.lights,transparencyMode:o.transparencyMode||null,fallbackTransparency:o.fallbackTransparency,properties:o.properties,transitions:o.transitions,environment:o.environment,legend:o.legend||[],visibilityLayers:this.serializeVisibilityLayers(o.sliderLayers.src,e),contentBlocks:o.contentBlocks||[],thumbnails:{default:"",...y},quizQuestions:this.duplicateQuizQuestions(o.id),synchronization:void 0},K=this.store.selectSnapshot(Se.getAllNodeState)[o.id],V=Object.entries(K).reduce((F,[R,D])=>{const I=D.shownSetByTween?$c(e,R,o.showObjects)||qc(e,R,o.showObjects):D.shown;return F.boolState[R]={shown:I,pickable:D.pickable},F.paintState[R]=Is(D.paint),F},{boolState:{},paintState:{}}),ge=this.getMinimumGraphSync(e,V.boolState,s);return Object.entries(this.convertGraphSync(ge)).forEach(([F,R])=>{k[F]=R}),k.synchronization=this.calcMinimumPaintState(e,V.paintState),k}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(Os),i.LFG(wr),i.LFG(et))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Xc(t,n){return t.reduce((e,o)=>(e[o.id]=!0===n?Td():o.id,e),{})}function Td(){return $t.idWithPrefix("chapter")}const eC={enabled:!1,clips:{left:{clipId:0,enabled:!1,fade:!1,fadeDistance:0,progress:0},right:{clipId:1,enabled:!1,fade:!1,fadeDistance:0,progress:0},back:{clipId:5,enabled:!1,fade:!1,fadeDistance:0,progress:0},front:{clipId:4,enabled:!1,fade:!1,fadeDistance:0,progress:0},top:{clipId:3,enabled:!1,fade:!1,fadeDistance:0,progress:0},bottom:{clipId:2,enabled:!1,fade:!1,fadeDistance:0,progress:0}}},tC={0:"left",1:"right",2:"bottom",3:"top",4:"front",5:"back"};var Sr=(()=>(function(t){t.JumpTo="jumpTo",t.FlyTo="flyTo"}(Sr||(Sr={})),Sr))();let Pr=(()=>{class t{constructor(e,o,s,r,a){this.serializeChapterService=e,this.labelService=o,this.animationService=s,this.paintService=r,this.sceneService=a}processChapterForEngine(e){const o=Xc([e],!1),p=od(this.sceneService.getRootObjects(),Oc(this.paintService.getColorRecipes()));return{...this.serializeChapterService.serializeChapter(p,e,{},[],o),sliderLayers:e.sliderLayers}}copyChapter(e,o){const s=(0,m.cloneDeep)(e);return s.id=o,s.readyState={model:!0,animation:!1},s}getChapter(e,o,s,r){const a=s.id||Td();let c;(0,m.isNil)(s.background)||(c=function E1(t){if(!Object.keys(t).length)return null;const n=[...t.colors];n.forEach((r,a)=>{n[a]=(a+1)%4&&r<=1?Math.round(255*r):r});const e=/radial|linear/.test(t.gradientType)?t.gradientType:"radial",o=t.colorStops,s=Array.isArray(o)&&2===o.length?[o[0],o[1]]:[0,100];return{colors:n,gradientType:e,colorStops:s}}(s.background));const p=s.transparencyMode||xe.TransparencyModeEnum.Alpha,d=s.jumpTo?{location:s.jumpTo,action:Sr.JumpTo}:{location:s.flyTo,action:Sr.FlyTo};s.cameraRotationCenter&&(d.rotationCenter=s.cameraRotationCenter),s.camera&&Array.isArray(s.camera.rotationCenter)&&(d.rotationCenter=wt.fromArray(s.camera.rotationCenter));let u=!1;const g=s.timelineMap;g.forEach(on=>{"dummy"!==on.name&&"dummy"!==on.data.timeline&&(u=!0)});let h=0;const y=!!s.animation&&s.animation.loop;u&&y?h=-1:u&&!y&&(h=1);const k=s.ui&&!(0,m.isEmpty)(s.ui)?s.ui:{play:{count:h}},B=qt.Annotation,K=[...s.annotations||[]].map(on=>this.labelService.deserializeAnnotation(on,s,B)),V=[],F=this.groupHotspots([...s.hotspots||[]].filter(on=>{const bs=this.labelService.filterHotspot(e,s,on);return bs?on.theme||(on.theme="module"===o?hi.studioNext:hi.classicHotspot):V.push(on),bs})).map(on=>this.labelService.deserializeHotspots(e,s,r,...on)),R=(0,m.isNil)(s.labels)?[...K,...F]:s.labels,D=V,I=(0,m.isEmpty)(s.clippingPlanes)?eC:this.sanitizeClippingPlanes(s.clippingPlanes),ce=s.contentBlocks??[],ye=s.legend??[],rt=(s.quizQuestions??[]).map(on=>({...on,chapterId:s.id})),Ae=s.media??{};Object.values(Ae).forEach(on=>{on&&(0,m.isEmpty)(on.lang)&&(on.lang="en")});const mo=s.thumbnails;return{...s,id:a,background:c,camera:d,timelineMap:g,loop:y,ui:k,labels:R,hotspots:D,clippingPlanes:I,contentBlocks:ce,legend:ye,quizQuestions:rt,media:Ae,readyState:{model:!1,animation:!1},thumbnails:mo,transparencyMode:p,sliderLayers:{current:{},src:{}}}}getChapterTweenStates(e){const o=e.timelineMap.filter(s=>"dummy"!==s.data.timeline).map(s=>s.data.timeline);return Array.from(new Set(o))}getChapterLightLibraries(e){return(e.lights&&e.lights.libraries||[]).filter(s=>"default"!==s)}getChapterReflectionLibraries(e){const s=e.environment&&e.environment.reflectionMap||[],r=c=>c.split(".")[0],a=(e.environment&&e.environment.lightMap||[]).map(r).concat(s.map(r));return Array.from(new Set(a))}hasVisibilityLayers(e){return Array.isArray(e)&&e.length>0}buildVisibilityLayers(e,o){const s=e.visibilityLayers,r=e.showObjects,a={src:s,current:{}};if(s&&this.hasVisibilityLayers(s.layers)){const c=s.initIndex||0,p=this.unpackLayers(s.layers),d=this.buildShownObjectsSet(r,o),u=this.buildCurrentLayers(p,d);a.src={layers:s.layers,initIndex:c},a.current={layers:u,index:c,position:0}}return a}buildShownObjectsSet(e,o){const s=this.sceneService.getSceneGraph(this.sceneService.getRootObjects(),o),r=Object.keys(s.nodes).filter(a=>$c(s,a,e)||qc(s,a,e));return new Set(r)}unpackLayers(e){const o=[];return e.forEach(s=>{let r=[];s.objectIds.forEach(c=>{const p=this.sceneService.getObjectById(c);if(p){const d=this.sceneService.getLeaves(p.objectId);r=r.concat(d.map(u=>u.objectId))}}),o.push({name:s.name,objectIds:r})}),o}buildCurrentLayers(e,o){const s=[];return e.forEach((r,a)=>{let c=!1;r.objectIds.forEach(p=>{o.has(p)&&(c?s[s.length-1].objectIds.push(p):(s.push({name:e[a].name,objectIds:[p]}),c=!0))})}),s}sanitizeClippingPlanes(e){const o=Object.values(e.clips).some(r=>r.progress>0),s=(0,m.mapKeys)(e.clips,(r,a)=>tC[a]||a);return{...e,clips:s,enabled:o}}groupHotspots(e){const o={},s=a=>a.primitiveIndex?a.primitiveIndex.toFixed(0):a.pos?a.pos.map(c=>c.toFixed(3)).join(":"):Math.random().toFixed(3),r=a=>RegExp("^circle-(plus|minus)").test(a)?"pair":"single";return e.forEach(a=>{const c=[r(a.type),a.objectId,s(a)].join("|");c in o?o[c].push(a):o[c]=[a]}),Object.values(o)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Mf),i.LFG(Os),i.LFG(Un),i.LFG(wr),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ko=(()=>(function(t){t.Toggle="toggle",t.None="none"}(ko||(ko={})),ko))();let Md=(()=>{class t{constructor(e){this.patches=e}}return t.type="[Story Labels] Patch Labels",t})(),Id=(()=>{class t{constructor(e,o){this.labelId=e,this.offset=o}}return t.type="[Story Labels] Set label Offset",t})(),el=(()=>{class t{constructor(e){this.labels=e}}return t.type="[Story Labels] Set Labels",t})(),Ls=(()=>{class t{constructor(e){this.label=e}}return t.type="[Story Labels] Add Label",t})(),zd=(()=>{class t{constructor(e){this.label=e}}return t.type="[Story Labels] Set Contexdt Label",t})(),kr=(()=>{class t{constructor(e){this.label=e}}return t.type="[Story Labels] Remove Label",t})(),Oo=(()=>{class t{constructor(){}}return t.type="[Story Labels] Remove Context Label",t})(),Ad=(()=>{class t{constructor(e){this.chapter=e}}return t.type="[Story Labels] Remove All Chapter Labels",t})(),Fs=(()=>{class t{constructor(e,o=!1){this.label=e,this.record=o}}return t.type="[Story Labels] Set Label",t})(),If=(()=>{class t{constructor(e,o){this.id=e,this.states=o}}return t.type="[Story Labels] Set Label States",t})(),tl=(()=>{class t{constructor(e){this.scale=e}}return t.type="[Story Labels] Set Label Scale",t})(),ns=(()=>{class t{constructor(e){this.label=e}}return t.type="[Story Labels] Select Label",t})(),Ld=(()=>{class t{constructor(){}}return t.type="[Story Labels] Reset",t})(),zf=(()=>{class t{constructor(e,o){this.labels=e,this.fields=o}}return t.type="[Story Labels] Convert",t})(),Fd=(()=>{class t{constructor(e,o=!0,s=!0){this.enable=e,this.enableInfo=o,this.enableActions=s}}return t.type="[Story Labels] Enable Context Label",t})(),To=(()=>{class t{constructor(e,o){this.labels=e,this.shown=o}}return t.type="[Story Labels] Set Labels Shown",t})(),La=(()=>{class t{constructor(e){this.show=e}}return t.type="[Story Labels] Set All Labels Shown",t})(),Ud=(()=>{class t{constructor(e,o=ko.None){this.collapsed=e,this.collapsedMode=o}}return t.type="[Story Labels] Set Labels Collapsed",t})(),Rd=(()=>{class t{constructor(e){this.draggable=e}}return t.type="[Story Labels] Set Draggable",t})();var is=A(3555),zi=(()=>(function(t){t.Markdown="markdown",t.Images="images",t.Ticker="ticker"}(zi||(zi={})),zi))(),Pe=(()=>(function(t){t.Hide="hide",t.Show="show",t.Collapse="collapse"}(Pe||(Pe={})),Pe))(),qn=(()=>(function(t){t.None="none",t.Small="small",t.Full="full"}(qn||(qn={})),qn))(),Ai=(()=>(function(t){t.None="none",t.Circle="circle",t.Bar="bar"}(Ai||(Ai={})),Ai))();const Nd=se.application===mt.Viewer?Ai.Bar:Ai.Circle;class Ke{constructor(n=Pe.Hide,e=!0){this.status=n,this.enable=e}}var Rn,Dt=A(6560),Li=A(7091);!function(t){function e(d){r()&&(d||(d=document.body),d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen())}function o(){r()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function s(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}function r(){return!!s()||(console.warn("Fullscreen is not enabled"),!1)}function a(){return document.fullscreenElement||document.webkitFullscreenElement}t.toggleFullscreen=function n(d){const u=a();(0,m.isNil)(u)?e(d):o()},t.requestFullscreen=e,t.exitFullscreen=o,t.canFullscreen=s,t.checkFullscreenSupport=r,t.getFullscreenElement=a,t.isFullscreen=function c(){return!(0,m.isNil)(a())},t.onFullscreenChange=function p(){const d=["mozfullscreenchange","webkitfullscreenchange","fullscreenchange"].map(u=>(0,Dt.R)(document.body,u));return(0,Li.T)(...d)}}(Rn||(Rn={}));var Mo=(()=>(function(t){t.None="none",t.Play="play",t.Button="button",t.Hand="hand"}(Mo||(Mo={})),Mo))(),pt=(()=>(function(t){t[t.OnDemand=0]="OnDemand",t[t.Interact=1]="Interact",t[t.Loader=2]="Loader",t[t.Tutorial=3]="Tutorial",t[t.Whiteboard=4]="Whiteboard",t[t.Help=5]="Help"}(pt||(pt={})),pt))(),Fi=(()=>(function(t){t[t.Text=0]="Text",t[t.Paint=1]="Paint",t[t.Erase=2]="Erase"}(Fi||(Fi={})),Fi))();const Af=[4,8,12,16,24,32],Ed=t=>t.slice(0).reverse().map(n=>({label:`${n}`,size:n})),Lf=Ed(Af),Ff=Ed([8,12,16,20,24,32]),Uf=Ed(Af),Rf={label:"Black",color:"#000000"},Nf={label:"White",color:"#ffffff"},Ef=[Rf,{label:"Red",color:"#ff0000"},{label:"Yellow",color:"#ffff00"},{label:"Green",color:"#00ff00"},{label:"Cyan",color:"#00ffff"},{label:"Blue",color:"#0000ff"},{label:"Pink",color:"#ff00ff"},Nf],pC=Lf[4],dC=Ef[0],uC=Ff[3],gC=Uf[4],hC=Rf,mC=Nf;var Dd,Io=(()=>(function(t){t.Mouse="mouse",t.Touch="touch"}(Io||(Io={})),Io))(),Or=(()=>(function(t){t[t.Default=0]="Default",t.DrawerOnly="drawer",t.ColumnOnly="column"}(Or||(Or={})),Or))(),Fa=(()=>(function(t){t.BioDigital="biodigital",t.Wikipedia="wikipedia",t.NCIT="ncit"}(Fa||(Fa={})),Fa))(),an=(()=>(function(t){t[t.List=0]="List",t[t.Tree=1]="Tree"}(an||(an={})),an))(),re=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},v=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};class Je{}const Df={audio:new Ke,camera:new Ke(Pe.Show,!0),chapterList:new Ke(Pe.Show,!1),column:new Ke,description:new Ke,drawer:new class sC extends Ke{constructor(n=!1){super(),this.isExpanded=n}},fullscreen:new Ke,help:new Ke,labels:new class cC extends Ke{constructor(n=!0){super(),this.shown=n}},labelInfo:new Ke,labelList:new Ke(Pe.Show,!1),loader:new class aC extends Ke{constructor(n=Nd){super(),this.template=n}},logo:new class oC extends Ke{constructor(n=!0){super(),this.isHyperLink=n}},media:new class rC extends Ke{constructor(n=qn.Small){super(),this.template=n}},menu:new Ke,nodeInfo:new Ke(Pe.Hide,!1),pagination:new Ke,presenter:new Ke(Pe.Hide,!1),reset:new Ke,search:new Ke,quiz:new Ke,titleOnly:new Ke,pocToolbar:new Ke(Pe.Hide,!1),toolbar:new Ke,tools:new Ke,anatomyLabels:new Ke,tutorial:new Ke(Pe.Hide,!1),internetExplorerWarning:new Ke,legend:new Ke,undo:new Ke,whiteboard:new Ke,visibilityLayers:new Ke,contextActions:new Ke,toggleLabels:new Ke},jf={lang:"en",canFullscreen:!1,canHover:!1,canTouch:!1,drawerCoversContent:!1,fullscreenActive:!1,help:{tab:di.Basics},initialUI:Df,inputEnabled:!0,inputMode:Io.Mouse,interactType:Mo.Play,onDemand:!1,layout:Or.Default,labelsBreakpoint:480,menuOpen:!1,multiPickModeEnabled:!1,openWindows:[pt.Loader],presentationActive:!1,searchDisplayMode:an.Tree,nodeInfo:{show:!1,fallback:Fa.Wikipedia},tutorial:{pageSize:0,pageIndex:-1},tutorialSeen:!0,ui:Df,usePrintImage:!1,whiteboard:{enabled:!1,locked:!1,hasPaint:!1,hasText:!1,brushSize:pC.size,brushColor:dC.color,textSize:uC.size,eraserSize:gC.size,annotateMode:Fi.Paint},scrim:{show:!1,label:""},chapterCallToActionSeen:!1};let O=Dd=class{constructor(n){this.storageService=n}static getUI(n){return n.ui}static getInitialUI(n){return n.initialUI}static getLabelsBreakpoint(n){return n.labelsBreakpoint}static getInputEnabled(n){return n.inputEnabled}static getFullscreenActive(n){return n.fullscreenActive}static getPresentationActive(n){return n.presentationActive}static getDrawerCoversContent(n){return n.drawerCoversContent}static getShowNodeInfo(n){return n.nodeInfo.show}static getNodeInfoFallback(n){return n.nodeInfo.fallback}static getViewLanguage(n){return n.lang}static getInteractType(n){return n.interactType}static getOnDemand(n){return n.onDemand}static getLayout(n){return n.layout}static getInputMode(n){return n.inputMode}static getShowHelpTab(n){return n.help.tab}static getTutorial(n){return n.tutorial}static getTutorialSeen(n){return n.tutorialSeen}static getWhiteboardEnabled(n){return n.whiteboard.enabled}static isWhiteboardLocked(n){return n.whiteboard.locked}static getWhiteboardBrushSize(n){return n.whiteboard.brushSize}static getWhiteboardTextSize(n){return n.whiteboard.textSize}static getWhiteboardEraserSize(n){return n.whiteboard.eraserSize}static getWhiteboardAnnotateMode(n){return n.whiteboard.annotateMode}static getWhiteboardBrushColor(n){return n.whiteboard.brushColor}static getWhiteboardHasPaint(n){return n.whiteboard.hasPaint}static getWhiteboardHasText(n){return n.whiteboard.hasText}static getCanTouch(n){return n.canTouch}static getCanHover(n){return n.canHover}static getMultiPickModeEnabled(n){return n.multiPickModeEnabled}static getSearchDisplayMode(n){return n.searchDisplayMode}static getUsePrintImage(n){return n.usePrintImage}static getOpenWindow(n){return n.openWindows.length>0?n.openWindows.sort()[0]:null}static getMenuOpen(n){return n.menuOpen}static getScrim(n){return n.scrim}static getChapterCallToActionSeen(n){return n.chapterCallToActionSeen}static shouldWindowOpen(n){return(0,l.P1)([Dd],e=>e.openWindows.indexOf(n)>=0)}setUI(n,e){const o=n.getState().ui;n.patchState({ui:{...o,...e.ui}})}setInitialUI(n,e){n.patchState({initialUI:e.ui})}setInputEnabled(n,e){n.patchState({inputEnabled:e.enabled})}setCanHover(n,e){n.patchState({canHover:e.canHover})}setCanTouch(n,e){n.patchState({canTouch:e.canTouch})}setCanFullscreen(n,e){n.patchState({canFullscreen:e.canFullscreen})}setSearchDisplayMode(n,e){n.patchState({searchDisplayMode:e.mode})}setViewLanguage(n,{lang:e}){n.patchState({lang:e})}toggleNodeInfo(n,{show:e}){n.patchState({nodeInfo:{...n.getState().nodeInfo,show:e}})}setNodeInfoConfig(n,{fallback:e}){n.patchState({nodeInfo:{...n.getState().nodeInfo,fallback:e}})}togglePresentation(n,e){n.patchState({presentationActive:e.active})}toggleHelp(n,e){n.patchState({help:{tab:e.tab}})}setLoaderType(n,e){n.patchState({interactType:e.interactType})}setOnDemand(n,e){n.patchState({onDemand:e.onDemand})}setInputMode(n,{inputMode:e}){n.patchState({inputMode:e})}SetLayout(n,e){n.patchState({layout:e.layout})}setTutorial(n,e){const o=n.getState().tutorial;n.patchState({tutorial:{...o,...e.tutorial}})}startTutorial(n,e){n.patchState({tutorial:{...n.getState().tutorial,pageIndex:e.intro?-1:0}}),n.dispatch(new T.TutorialSeen(!0))}tutorialSeen(n,e){this.storageService.setLocalItem(fn.GettingStartedTutorial,e.seen),n.patchState({tutorialSeen:e.seen})}tutorialPrevious(n,e){const o=n.getState().tutorial,s=Math.max(o.pageIndex-1,0);n.dispatch(new T.SetTutorial({...o,pageIndex:s}))}tutorialNext(n,e){const o=n.getState().tutorial,s=Math.min(o.pageIndex+1,o.pageSize-1);n.dispatch(new T.SetTutorial({...o,pageIndex:s}))}setWhiteboardEnabled(n,{enabled:e}){n.patchState({whiteboard:{...n.getState().whiteboard,enabled:e}})}setWhiteboardLocked(n,{locked:e}){n.patchState({whiteboard:{...n.getState().whiteboard,locked:e}})}setWhiteboardBrushSize(n,{brushSize:e}){n.patchState({whiteboard:{...n.getState().whiteboard,brushSize:e}})}setWhiteboardTextSize(n,{size:e}){n.patchState({whiteboard:{...n.getState().whiteboard,textSize:e}})}setWhiteboardEraserSize(n,{eraserSize:e}){n.patchState({whiteboard:{...n.getState().whiteboard,eraserSize:e}})}setWhiteboardAnnotateMode(n,{mode:e}){n.patchState({whiteboard:{...n.getState().whiteboard,annotateMode:e}})}setWhiteboardBrushColor(n,{brushColor:e}){n.patchState({whiteboard:{...n.getState().whiteboard,brushColor:e}})}setWhiteboardHasPaint(n,{hasPaint:e}){n.patchState({whiteboard:{...n.getState().whiteboard,hasPaint:e}})}setWhiteboardHasText(n,{hasText:e}){n.patchState({whiteboard:{...n.getState().whiteboard,hasText:e}})}setMultiPickModeEnabled(n,e){n.patchState({multiPickModeEnabled:e.enabled})}setLabelBreakpoint(n,e){n.patchState({labelsBreakpoint:e.labelsBreakpoint})}setUsePrintImage(n,e){n.patchState({usePrintImage:e.usePrintImage})}setWindows(n,e){n.patchState({openWindows:e.windows})}openWindow(n,e){const o=n.getState().openWindows;o.indexOf(e.window)<0&&n.patchState({openWindows:[e.window,...o]})}closeWindow(n,e){let o=n.getState().openWindows;null!=e.window?o=o.filter(s=>s!==e.window):o.shift(),n.patchState({openWindows:[...o]})}toggleWindow(n,e){const o=n.getState().openWindows.indexOf(e.window)>=0;n.dispatch((null!=e.show?e.show:!o)?new T.OpenWindow(e.window):new T.CloseWindow(e.window))}toggleMenu(n,e){n.patchState({menuOpen:e.open})}showScrim(n,e){n.patchState({scrim:{show:!0,label:e.label}})}hideScrim(n,e){n.patchState({scrim:{show:!1,label:""}})}setChapterCallToActionSeen(n,e){n.patchState({chapterCallToActionSeen:e.chapterCallToActionSeen})}ngxsOnInit(n){Rn.onFullscreenChange().subscribe(o=>{n.patchState({fullscreenActive:Rn.isFullscreen()})}),n.patchState({tutorialSeen:this.storageService.getLocalJSON(fn.GettingStartedTutorial)||!1})}};O.\u0275fac=function(n){return new(n||O)(i.LFG(dn))},O.\u0275prov=i.Yz7({token:O,factory:O.\u0275fac}),re([(0,l.aU)(T.SetUI),v("design:type",Function),v("design:paramtypes",[Object,T.SetUI]),v("design:returntype",void 0)],O.prototype,"setUI",null),re([(0,l.aU)(T.SetInitialUI),v("design:type",Function),v("design:paramtypes",[Object,T.SetInitialUI]),v("design:returntype",void 0)],O.prototype,"setInitialUI",null),re([(0,l.aU)(T.SetInputEnabled),v("design:type",Function),v("design:paramtypes",[Object,T.SetInputEnabled]),v("design:returntype",void 0)],O.prototype,"setInputEnabled",null),re([(0,l.aU)(T.SetCanHover),v("design:type",Function),v("design:paramtypes",[Object,T.SetCanHover]),v("design:returntype",void 0)],O.prototype,"setCanHover",null),re([(0,l.aU)(T.SetCanTouch),v("design:type",Function),v("design:paramtypes",[Object,T.SetCanTouch]),v("design:returntype",void 0)],O.prototype,"setCanTouch",null),re([(0,l.aU)(T.SetCanFullscreen),v("design:type",Function),v("design:paramtypes",[Object,T.SetCanFullscreen]),v("design:returntype",void 0)],O.prototype,"setCanFullscreen",null),re([(0,l.aU)(T.SetSearchDisplayMode),v("design:type",Function),v("design:paramtypes",[Object,T.SetSearchDisplayMode]),v("design:returntype",void 0)],O.prototype,"setSearchDisplayMode",null),re([(0,l.aU)(T.SetViewLanguage),v("design:type",Function),v("design:paramtypes",[Object,T.SetViewLanguage]),v("design:returntype",void 0)],O.prototype,"setViewLanguage",null),re([(0,l.aU)(T.ToggleNodeInfo),v("design:type",Function),v("design:paramtypes",[Object,T.ToggleNodeInfo]),v("design:returntype",void 0)],O.prototype,"toggleNodeInfo",null),re([(0,l.aU)(T.SetNodeInfoConfig),v("design:type",Function),v("design:paramtypes",[Object,T.SetNodeInfoConfig]),v("design:returntype",void 0)],O.prototype,"setNodeInfoConfig",null),re([(0,l.aU)(T.TogglePresentation),v("design:type",Function),v("design:paramtypes",[Object,T.TogglePresentation]),v("design:returntype",void 0)],O.prototype,"togglePresentation",null),re([(0,l.aU)(T.ToggleHelpTab),v("design:type",Function),v("design:paramtypes",[Object,T.ToggleHelpTab]),v("design:returntype",void 0)],O.prototype,"toggleHelp",null),re([(0,l.aU)(T.SetInteractType),v("design:type",Function),v("design:paramtypes",[Object,T.SetInteractType]),v("design:returntype",void 0)],O.prototype,"setLoaderType",null),re([(0,l.aU)(T.SetOnDemand),v("design:type",Function),v("design:paramtypes",[Object,T.SetOnDemand]),v("design:returntype",void 0)],O.prototype,"setOnDemand",null),re([(0,l.aU)(T.SetInputMode),v("design:type",Function),v("design:paramtypes",[Object,T.SetInputMode]),v("design:returntype",void 0)],O.prototype,"setInputMode",null),re([(0,l.aU)(T.SetLayout),v("design:type",Function),v("design:paramtypes",[Object,T.SetLayout]),v("design:returntype",void 0)],O.prototype,"SetLayout",null),re([(0,l.aU)(T.SetTutorial),v("design:type",Function),v("design:paramtypes",[Object,T.SetTutorial]),v("design:returntype",void 0)],O.prototype,"setTutorial",null),re([(0,l.aU)(T.StartTutorial),v("design:type",Function),v("design:paramtypes",[Object,T.StartTutorial]),v("design:returntype",void 0)],O.prototype,"startTutorial",null),re([(0,l.aU)(T.TutorialSeen),v("design:type",Function),v("design:paramtypes",[Object,T.TutorialSeen]),v("design:returntype",void 0)],O.prototype,"tutorialSeen",null),re([(0,l.aU)(T.TutorialPrevious),v("design:type",Function),v("design:paramtypes",[Object,T.TutorialPrevious]),v("design:returntype",void 0)],O.prototype,"tutorialPrevious",null),re([(0,l.aU)(T.TutorialNext),v("design:type",Function),v("design:paramtypes",[Object,T.TutorialNext]),v("design:returntype",void 0)],O.prototype,"tutorialNext",null),re([(0,l.aU)(T.SetWhiteboardEnabled),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardEnabled]),v("design:returntype",void 0)],O.prototype,"setWhiteboardEnabled",null),re([(0,l.aU)(T.SetWhiteboardLocked),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardLocked]),v("design:returntype",void 0)],O.prototype,"setWhiteboardLocked",null),re([(0,l.aU)(T.SetWhiteboardBrushSize),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardBrushSize]),v("design:returntype",void 0)],O.prototype,"setWhiteboardBrushSize",null),re([(0,l.aU)(T.SetWhiteboardTextSize),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardTextSize]),v("design:returntype",void 0)],O.prototype,"setWhiteboardTextSize",null),re([(0,l.aU)(T.SetWhiteboardEraserSize),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardEraserSize]),v("design:returntype",void 0)],O.prototype,"setWhiteboardEraserSize",null),re([(0,l.aU)(T.SetWhiteboardAnnotateMode),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardAnnotateMode]),v("design:returntype",void 0)],O.prototype,"setWhiteboardAnnotateMode",null),re([(0,l.aU)(T.SetWhiteboardBrushColor),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardBrushColor]),v("design:returntype",void 0)],O.prototype,"setWhiteboardBrushColor",null),re([(0,l.aU)(T.SetWhiteboardHasPaint),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardHasPaint]),v("design:returntype",void 0)],O.prototype,"setWhiteboardHasPaint",null),re([(0,l.aU)(T.SetWhiteboardHasText),v("design:type",Function),v("design:paramtypes",[Object,T.SetWhiteboardHasText]),v("design:returntype",void 0)],O.prototype,"setWhiteboardHasText",null),re([(0,l.aU)(T.SetMultiPickModeEnabled),v("design:type",Function),v("design:paramtypes",[Object,T.SetMultiPickModeEnabled]),v("design:returntype",void 0)],O.prototype,"setMultiPickModeEnabled",null),re([(0,l.aU)(T.SetLabelBreakpoint),v("design:type",Function),v("design:paramtypes",[Object,T.SetLabelBreakpoint]),v("design:returntype",void 0)],O.prototype,"setLabelBreakpoint",null),re([(0,l.aU)(T.SetUsePrintImage),v("design:type",Function),v("design:paramtypes",[Object,T.SetUsePrintImage]),v("design:returntype",void 0)],O.prototype,"setUsePrintImage",null),re([(0,l.aU)(T.SetWindows),v("design:type",Function),v("design:paramtypes",[Object,T.SetWindows]),v("design:returntype",void 0)],O.prototype,"setWindows",null),re([(0,l.aU)(T.OpenWindow),v("design:type",Function),v("design:paramtypes",[Object,T.OpenWindow]),v("design:returntype",void 0)],O.prototype,"openWindow",null),re([(0,l.aU)(T.CloseWindow),v("design:type",Function),v("design:paramtypes",[Object,T.CloseWindow]),v("design:returntype",void 0)],O.prototype,"closeWindow",null),re([(0,l.aU)(T.ToggleWindow),v("design:type",Function),v("design:paramtypes",[Object,T.ToggleWindow]),v("design:returntype",void 0)],O.prototype,"toggleWindow",null),re([(0,l.aU)(T.ToggleMenu),v("design:type",Function),v("design:paramtypes",[Object,T.ToggleMenu]),v("design:returntype",void 0)],O.prototype,"toggleMenu",null),re([(0,l.aU)(T.ShowScrim),v("design:type",Function),v("design:paramtypes",[Object,T.ShowScrim]),v("design:returntype",void 0)],O.prototype,"showScrim",null),re([(0,l.aU)(T.HideScrim),v("design:type",Function),v("design:paramtypes",[Object,T.HideScrim]),v("design:returntype",void 0)],O.prototype,"hideScrim",null),re([(0,l.aU)(T.SetChapterCallToActionSeen),v("design:type",Function),v("design:paramtypes",[Object,T.SetChapterCallToActionSeen]),v("design:returntype",void 0)],O.prototype,"setChapterCallToActionSeen",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getUI",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getInitialUI",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getLabelsBreakpoint",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getInputEnabled",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getFullscreenActive",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getPresentationActive",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getDrawerCoversContent",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getShowNodeInfo",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getNodeInfoFallback",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getViewLanguage",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getInteractType",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getOnDemand",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getLayout",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getInputMode",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getShowHelpTab",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getTutorial",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getTutorialSeen",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardEnabled",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"isWhiteboardLocked",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardBrushSize",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardTextSize",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardEraserSize",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardAnnotateMode",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardBrushColor",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardHasPaint",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getWhiteboardHasText",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getCanTouch",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getCanHover",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getMultiPickModeEnabled",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getSearchDisplayMode",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getUsePrintImage",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getOpenWindow",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getMenuOpen",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getScrim",null),re([(0,l.Qf)(),v("design:type",Function),v("design:paramtypes",[Je]),v("design:returntype",void 0)],O,"getChapterCallToActionSeen",null),O=Dd=re([(0,l.ZM)({name:"view",defaults:jf}),v("design:paramtypes",[dn])],O);let Qf=(()=>{class t{constructor(e,o){this.animationService=e,this.store=o}getGeometries(){return{}}getGeometryCompressionSupported(){return!0}getLoadedAssets(){return{}}getLights(){return{}}getMaterials(){return{}}getTextureCompressionSupported(){return!0}getMorphs(){return{}}getAssetLibrary(e,o,s,r,a){return new Promise(c=>{c(void 0)})}getAssetNamespaces(){const e={},o=this.getLoadedAssets();return Object.keys(o).map(s=>s.split("/")[0]).forEach(s=>{e[s]=!0}),Object.keys(e)}enableLightLib(e){const s=this.getLights()[e];if(Array.isArray(s)){const r={};s.forEach(a=>{r[a]=!0})}}setBranchLights(e,o){const s=this.store.selectSnapshot(_.getSelectedChapter);s.lights.libraries[0]!==o&&(s.lights.libraries[0]=o,this.enableLightLib(o))}loadLightLib(e){var o=this;return(0,Pn.Z)(function*(){return o.getAssetLibrary("light","lights",e,"outline",{}).then(()=>{const s=o.getLights();if(Array.isArray(s[e]))return e;throw new Error})})()}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Un),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class zo{}class fC{}class bC{}let yC=(()=>{class t{constructor(){}getOnlyText(e){return e.map(o=>{if(o.type===zi.Markdown)return o.markdown}).join("")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Zf(t,n,e){return n===Xe.Bookmark?`/search/bookmarks/tr/${e}/${t}`:`/tr/${e}/${t}.json`}let Us=(()=>{class t{constructor(e,o,s,r,a,c){this.http=e,this.animationService=o,this.engineService=s,this.chapterService=r,this.contentBlocksService=a,this.store=c}getLoadChapter(e,o){const s=new fC;return s.activate=!1,s.chapterId=o.id,s.readyState={model:!0,animation:!0},s}getStory(e,o,s="en"){const r=o===Xe.Bookmark?this.getBookmark(e):this.getContent(e);if("en"===s)return r;{let a;return r.pipe((0,Ii.V)(c=>(a=c,this.getStoryTranslation(e,o,s)))).pipe((0,J.U)(c=>this.translateStory(a,c)),(0,Vn.K)(()=>r))}}getContentRoot(){return!0===se.offline?typeof localBaseDirectory>"u"?"":localBaseDirectory:"/"}getContent(e){return this.http.get(this.getContentRoot()+`content/modules/${e}.json`).pipe((0,J.U)(o=>this.normalizeStory(o)))}getBookmark(e){return this.http.get("/search/bookmarks/data",{params:{be:e}}).pipe((0,J.U)(o=>this.normalizeStory(o.bookmark)))}getStoryChapters(e,o,s){return s.chapters.map((r,a)=>this.chapterService.getChapter(s,o,r,a))}getStoryLoadChapters(e){return e.chapters.map(s=>this.getLoadChapter(e,s))}loadChapter(e){var o=this;return(0,Pn.Z)(function*(){const s=o.engineService.engine.story.chapters,r=o.store.selectSnapshot(_.getStoryChapters),a=o.store.selectSnapshot(_.getSelectedChapterIndex),c=r.findIndex(d=>d.id===e.chapterId),p=s[c];return p.load().then(()=>c===a?o.animationService.setChapter(e.chapterId):p.id)})()}addChapterToEngine(e,o){var s=this;return(0,Pn.Z)(function*(){const a=s.chapterService.processChapterForEngine(e),c=s.engineService.engine.story.createChapter(a,o);return s.engineService.engine.story.chapters[c].load().then(()=>{s.store.dispatch(new gi(e))})})()}removeChapterFromEngine(e){this.engineService.engine.story.chapters.splice(e,1)}moveChapterInEngine(e,o){const r=this.engineService.engine.story.chapters.splice(e,1)[0];this.engineService.engine.story.chapters.splice(o,0,r),r.activate()}getStoryTranslation(e,o,s){const r=Zf(e,o,s);return this.http.get(r).pipe((0,J.U)(a=>(0,sn.yE)(bC,a)))}getStoryLang(e,o,s){if("en"===s)return(0,Ue.of)("en");const r=Zf(e,o,s);return this.http.head(r).pipe((0,J.U)(()=>!0),(0,Vn.K)(()=>(0,Ue.of)(!1)),(0,J.U)(a=>a?s:"en"))}getStoryType(e){return e.indexOf("/")>=0?Xe.Module:Xe.Bookmark}translateStory(e,o){const r=e.chapters||[],a=e.sceneGraph||[],c=o.objects||{},p=o.chapters||[];return e.displayName=o.displayName||e.displayName,e.description=o.description||e.description,a.forEach(d=>{(d.objects||[]).forEach(g=>{this.translateObject(g,c)})}),r.forEach((d,u)=>{const g=p[u];if(g){this.translateMetaInfo(d,g);const y=g.annotations||[];(d.annotations||[]).forEach((ge,F)=>{const R=y[F];R&&this.translateMetaInfo(ge,R)});const B=g.hotspots||[];(d.hotspots||[]).forEach((ge,F)=>{const R=B[F];R&&this.translateMetaInfo(ge,R)});const V=g.quizQuestions||[];(d.quizQuestions||[]).forEach((ge,F)=>{const R=V[F];R&&this.translateQuizQuestion(ge,R)})}}),e}translateQuizQuestion(e,o){if(o.nextLabel&&(e.nextLabel=o.nextLabel),["questionPrompt","explanation"].forEach(s=>{const a=o[s]||[];(e[s]||[]).forEach((c,p)=>{const d=a[p];d&&(c.markdown=d.markdown)})}),e.data&&o.data){const r=o.data.options||[];(e.data.options||[]).forEach((a,c)=>{const p=r[c];p&&(e.type===Re.LabelAnatomy?this.translateMetaInfo(a.label,p.label):a.label=p.label)})}}translateMetaInfo(e,o){const{title:s,description:r}=o;e.hasOwnProperty("displayName")&&(e.displayName=s),e.hasOwnProperty("title")&&(e.title=s),e.hasOwnProperty("description")&&(e.description=r)}translateObject(e,o){const r=o[e.objectId];r&&(e.displayName=r);const a=e.objects;a&&a.forEach(c=>{this.translateObject(c,o)})}exportWrittenContent(e,o,s){const r=[];return r.push(`\n${e.displayName}\n    `),o.forEach((a,c)=>{r.push(`\n---\n\n# Chapter ${c+1}: ${a.displayName||"-No Title-"}\n\n${a.description||"-No Description-"}\n      `),a.legend.length&&(r.push("\n## Legend\n"),a.legend.forEach(d=>{r.push(`\n* ${d.label} (${wo.rgbToHex(d.colors,!0)})\n`)}));const p=s.filter(d=>d.chapterId===a.id);p.length&&(r.push("\n## Labels\n"),p.forEach(d=>{r.push(`\n* ${d.title}\n`),d.description&&r.push(`\n  > ${d.description}\n`)}))}),r.join("")}exportQuizKey(e){const o=[];return e.forEach((s,r)=>{switch(o.push(`\n# QUESTION ${r+1} (${I1[s.type]})\n\n## PROMPT\n${this.contentBlocksService.getOnlyText(s.questionPrompt)}\n      `),s.type){case Re.MultipleChoice:s.data.options.forEach((a,c)=>{o.push(`\n## ANSWER ${c+1} ${s.data.correctAnswer===a.value?"- CORRECT":""}\n${a.label}\n            `)});break;case Re.SelectAnatomy:o.push("\n## ANSWERS\n          "),s.data.correctAnswer.forEach((a,c)=>{o.push(`\n${a}\n            `)});break;case Re.LabelAnatomy:s.data.options.forEach((a,c)=>{o.push(`\n## ANSWER ${c+1}\n${a.label.title}\n            `)})}this.contentBlocksService.getOnlyText(s.explanation).length&&o.push(`\n  \n## EXPLANATION\n${this.contentBlocksService.getOnlyText(s.explanation)}\n        `),o.push("\n\n\n      ")}),o.join("")}normalizeStory(e){return e.chapters.forEach(o=>{o.id||(o.id=Td())}),e}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(Un),i.LFG(et),i.LFG(Pr),i.LFG(yC),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Kt,de=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},S=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Bf={loading:!1,chapters:[],chaptersViewed:[],selectedChapter:null,isChapterAnimated:!1,thumbnails:new Map,patches:[],inversePatches:[]};let _=Kt=class{constructor(n,e,o,s,r,a){this.store=n,this.chapterService=e,this.animationService=o,this.assetService=s,this.sceneService=r,this.storyService=a}static getStoryChapters(n){return n.chapters}static getChaptersViewed(n){return n.chaptersViewed}static getChapter(n){return(0,l.P1)([Kt],e=>e.chapters.find(o=>o.id===n))}static getSelectedChapterId(n){return n.selectedChapter}static getSelectedChapter(n){return n.chapters.find(e=>e.id===n.selectedChapter)||null}static getNextChapter(n){const e=(0,xe.clamp)(Kt.getSelectedChapterIndex(n)+1,0,n.chapters.length-1);return n.chapters[e]}static getPreviousChapter(n){const e=(0,xe.clamp)(Kt.getSelectedChapterIndex(n)-1,0,n.chapters.length-1);return n.chapters[e]}static getSelectedChapterIndex(n){return n.chapters.findIndex(e=>e.id===n.selectedChapter)}static getSelectedChapterTitle(n){return n.chapters.find(e=>e.id===n.selectedChapter).displayName}static getChapterCount(n){return n.chapters.length}static getRegisteredThumbnails(n){return n.thumbnails}static getIsChapterAnimated(n){return n.isChapterAnimated}static getSelectedChapterReadyState(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.readyState??{model:!1,animation:!1}}static getChaptersLoaded(n){return{count:n.chapters.length,modelChapters:n.chapters.filter(e=>e.readyState.model),animationChapters:n.chapters.filter(e=>e.readyState.animation)}}static getAllChaptersModelsReady(n){return n.chapters.length>0&&n.chapters.every(e=>e.readyState.model)}static getSelectedChapterModelReady(n){const e=Kt.getSelectedChapterReadyState(n);return!(0,m.isNil)(e)&&e.model}static getSelectedChapterAnimationReady(n){const e=Kt.getSelectedChapterReadyState(n);return!(0,m.isNil)(e)&&e.animation}static getAllChaptersAnimationsReady(n){return n.chapters.length>0&&n.chapters.every(e=>e.readyState.animation)}static getSelectedChapterBackground(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.background??_r}static getAllChaptersBackground(n){return n.chapters.map(e=>e?.background)}static getSelectedChapterAllAudio(n){const e=n.chapters.find(o=>o.id===n.selectedChapter);return e&&e.media?Object.values(e.media).filter(s=>"audio"===s.streamType):[]}static getSelectedChapterAudio(n,e){return this.getSelectedChapterAllAudio(n).find(s=>s.lang===e.lang)}static getSelectedChapterLegend(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.legend??[]}static getSelectedChapterClippingPlanes(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.clippingPlanes}static getChapterCamera(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.camera?.location}static findChapter(n,e){return n.find(o=>o.id===e)}static getAllChaptersCurrentLayers(n){return n.chapters.map(e=>e?.sliderLayers?.current?.layers??[])}static getSelectedChapterSrcLayers(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.sliderLayers?.src?.layers??[]}static getSelectedChapterCurrentLayers(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.sliderLayers?.current?.layers??[]}static getSelectedChapterCurrentLayersIndex(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.sliderLayers?.current?.index}static getSelectedChapterCurrentLayersPosition(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.sliderLayers?.current?.position}static getSelectedChapterContentBlocks(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.contentBlocks??[]}static getSelectedChapterTimelineMap(n){const{chapters:e,selectedChapter:o}=n;return Kt.findChapter(e,o)?.timelineMap??[]}setChapters(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters=e.chapters}))}SetChapterCameraAction(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).camera.action=e.cameraAction}))}setChapterUI(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).ui=e.ui}))}setChapterInfo(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===e.chapterId);s.description=e.description,s.displayName=e.displayName}))}setChapterLegend(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).legend=e.legend}))}addToChapterLegend(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).legend.push(e.legend)}))}ReorderChapters(n,e){this.storyService.moveChapterInEngine(e.previousIndex,e.currentIndex),n.patchState(H.Uy(n.getState(),s=>{(0,is.bA)(s.chapters,e.previousIndex,e.currentIndex)}));const o=n.getState().chapters.map(s=>s.id);n.dispatch(new ee.ReorderQuestions(o))}SetChapterReadyState(n,e){const o=H.Uy(n.getState(),s=>{if(e.chapterId){const r=s.chapters.find(a=>a.id===e.chapterId);r&&(r.readyState={...r.readyState,...e.readyState})}});n.patchState(o)}BuildChapterVisibilityLayers(n,e){const o=H.Uy(n.getState(),s=>{if(e.chapterId){const r=s.chapters.findIndex(c=>c.id===e.chapterId),a=s.chapters[r];a.sliderLayers=this.chapterService.buildVisibilityLayers(a,r)}});n.patchState(o)}SetChapterPostProcessing(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(c=>c.id===e.chapterId),a=s.properties||{};s.customData={...s.customData?s.customData:{},postprocess:e.effects},s.properties={...a,...e.properties}}))}SetChapterTransitions(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===e.chapterId);s.transitions=s.transitions||{},s.transitions[e.key]=e.transition}))}setChapterProperties(n,e){const o=e.chapterIds,s=e.properties;n.patchState(H.Uy(n.getState(),r=>{r.chapters.filter(a=>o.includes(a.id)).forEach(a=>{a.properties={...a.properties??{},...s}})}))}removeChapterProperties(n,e){const o=e.chapterIds,s=e.properties;n.patchState(H.Uy(n.getState(),r=>{r.chapters.filter(a=>o.includes(a.id)).forEach(a=>{a?.properties&&s.forEach(c=>{delete a.properties[c]})})}))}SetChapterTransparencyMode(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).transparencyMode=e.transparencyMode}))}applyChapterPatch(n,e){const o=H.QE(n.getState(),e.patches);n.patchState(H.Uy(o,s=>{s.patches=[],s.inversePatches=[]}))}setChapterClippingPlane(n,e){const[o,s,r]=H.aS(n.getState(),c=>{const p=c.chapters.find(d=>d.id===e.chapterId);p.clippingPlanes.clips=e.clips,p.clippingPlanes.enabled=e.enabled,p.clippingPlanes.boundary=p.clippingPlanes.boundary??this.sceneService.getSceneBoundary()}),a=H.Uy(o,c=>{c.patches.push(...s),c.inversePatches.push(...r)});e.record&&n.dispatch(new Nt.SavePatches([{forward:a.patches,inverse:[...a.inversePatches].reverse(),patchAction:Dc}])),n.patchState(e.record?H.Uy(a,c=>{c.patches=[],c.inversePatches=[]}):a)}setChapterBackground(n,e){e.background&&n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).background=e.background}))}setAllChaptersBackground(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.forEach(s=>{s.background=e.background})}))}resetSelectedChapterBackground(n,e){const{selectedChapter:o}=n.getState();this.store.dispatch(new ks(o,_r))}setSelectedChapterBackground(n,{background:e}){const o=n.getState().selectedChapter;this.store.dispatch(new ks(o,e))}selectChapter(n,e){if(!e.chapter)return;this.store.dispatch([new Rt(!1),new Ms]);const o=this.animationService.isChapterAnimated(e.chapter);this.store.dispatch(new dr(!!e.chapter));const s=H.Uy(n.getState(),r=>{r.chaptersViewed.some(a=>e.chapter.id===a)||r.chaptersViewed.push(e.chapter.id),r.selectedChapter=e.chapter?e.chapter.id:null,r.isChapterAnimated=o});n.patchState(s)}selectChapterById(n,{chapterId:e}){this.store.dispatch(new dr(!0)),n.patchState({selectedChapter:e})}duplicateChapter(n,e){const o=e.chapter,s=this.chapterService.copyChapter(o,e.chapterId),r=this.store.selectSnapshot(Kt.getSelectedChapterBackground),a=this.store.selectSnapshot(Wt.getRegisteredThumbnails),c=a.get(o.id);if((0,m.isNil)(c))if(o.thumbnails){const u=new Cr;u.chapterId=s.id,u.snapshot=o.thumbnails.default,a.set(s.id,u)}else n.dispatch(new xr(s.id,r,fi.JPEG,92,Cf.medium,"square"));else a.set(s.id,c);const d=n.getState().chapters.findIndex(u=>u.id==o.id)+1;n.patchState(H.Uy(n.getState(),u=>{u.chapters.splice(d,0,s)})),this.storyService.addChapterToEngine(s,d).then(()=>{}).catch(u=>{console.error(`Error importing chapter "${s.id}":`,u)})}nextChapter(n,e){const o=this.store.selectSnapshot(Kt.getNextChapter);n.dispatch(new gi(o))}previousChapter(n,e){const o=this.store.selectSnapshot(Kt.getPreviousChapter);n.dispatch(new gi(o))}lastChapter(n,e){const o=n.getState().chapters;n.dispatch(new gi(o[o.length-1]))}firstChapter(n,e){const o=n.getState().chapters;n.dispatch(new gi(o[0]))}removeChapter(n,e){const{chapters:o,selectedChapter:s}=n.getState();if(1===o.length)return;const r=o.findIndex(a=>a.id===e.chapter.id);if(this.storyService.removeChapterFromEngine(r),n.patchState(H.Uy(n.getState(),a=>{a.chapters.splice(r,1)})),e.chapter.id===s){const a=n.getState().chapters,c=Math.min(r,a.length-1);n.dispatch(new gi(a[c]))}n.dispatch(new Ad(e.chapter))}resetStoryChaptersState(n,e){n.setState(Bf)}RecordCamera(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===e.chapterId);s.camera.location=e.camera,e.rotationCenter&&(s.camera.rotationCenter=e.rotationCenter)}))}setChapterCurrentLayersIndexPosition(n,e){const[o,s,r]=H.aS(n.getState(),c=>{const d=c.chapters.find(u=>u.id===e.chapterId).sliderLayers.current;d.index=e.index,d.position=e.position}),a=H.Uy(o,c=>{c.patches.push(...s),c.inversePatches.push(...r)});n.patchState(a),e.record&&n.dispatch(new Nt.SavePatches([{forward:a.patches,inverse:a.inversePatches,patchAction:Dc}]))}setChapterMedia(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).media=e.media}))}setChapterContentBlocks(n,e){e.contentBlocks=[...e.contentBlocks.filter(o=>o.type===zi.Ticker),...e.contentBlocks.filter(o=>o.type!==zi.Ticker)],n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).contentBlocks=e.contentBlocks}))}setChapterTimelineMap(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===o.selectedChapter).timelineMap=e.timelineMaps}))}addChapterTimelineMap(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===o.selectedChapter);e.timelineMaps.forEach(r=>{s.timelineMap.push(r)})}))}updateChapterTimelineMap(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===o.selectedChapter);e.updates.forEach(r=>{const a=s.timelineMap.findIndex(c=>c.id===r.id);s.timelineMap.splice(a,1),s.timelineMap.push(r)})}))}removeFromChapterTimelineMap(n,e){n.patchState(H.Uy(n.getState(),o=>{const s=o.chapters.find(r=>r.id===o.selectedChapter);e.timelineMapIds.forEach(r=>{const a=s.timelineMap.findIndex(c=>c.id===r);s.timelineMap.splice(a,1)})}))}SetChapterLights(n,e){n.patchState(H.Uy(n.getState(),o=>{o.chapters.find(r=>r.id===e.chapterId).lights.libraries=[e.lights]})),this.assetService.setBranchLights(e.chapterId,e.lights)}};_.\u0275fac=function(n){return new(n||_)(i.LFG(l.yh),i.LFG(Pr),i.LFG(Un),i.LFG(Qf),i.LFG(Ut),i.LFG(Us))},_.\u0275prov=i.Yz7({token:_,factory:_.\u0275fac}),de([(0,l.aU)(Pa),S("design:type",Function),S("design:paramtypes",[Object,Pa]),S("design:returntype",void 0)],_.prototype,"setChapters",null),de([(0,l.aU)(zm),S("design:type",Function),S("design:paramtypes",[Object,zm]),S("design:returntype",void 0)],_.prototype,"SetChapterCameraAction",null),de([(0,l.aU)(Am),S("design:type",Function),S("design:paramtypes",[Object,Am]),S("design:returntype",void 0)],_.prototype,"setChapterUI",null),de([(0,l.aU)(Lm),S("design:type",Function),S("design:paramtypes",[Object,Lm]),S("design:returntype",void 0)],_.prototype,"setChapterInfo",null),de([(0,l.aU)(Fm),S("design:type",Function),S("design:paramtypes",[Object,Fm]),S("design:returntype",void 0)],_.prototype,"setChapterLegend",null),de([(0,l.aU)(Um),S("design:type",Function),S("design:paramtypes",[Object,Um]),S("design:returntype",void 0)],_.prototype,"addToChapterLegend",null),de([(0,l.aU)(Rm),S("design:type",Function),S("design:paramtypes",[Object,Rm]),S("design:returntype",void 0)],_.prototype,"ReorderChapters",null),de([(0,l.aU)(jc),S("design:type",Function),S("design:paramtypes",[Object,jc]),S("design:returntype",void 0)],_.prototype,"SetChapterReadyState",null),de([(0,l.aU)(_d),S("design:type",Function),S("design:paramtypes",[Object,_d]),S("design:returntype",void 0)],_.prototype,"BuildChapterVisibilityLayers",null),de([(0,l.aU)(Nm),S("design:type",Function),S("design:paramtypes",[Object,Nm]),S("design:returntype",void 0)],_.prototype,"SetChapterPostProcessing",null),de([(0,l.aU)(Em),S("design:type",Function),S("design:paramtypes",[Object,Em]),S("design:returntype",void 0)],_.prototype,"SetChapterTransitions",null),de([(0,l.aU)(Dm),S("design:type",Function),S("design:paramtypes",[Object,Dm]),S("design:returntype",void 0)],_.prototype,"setChapterProperties",null),de([(0,l.aU)(jm),S("design:type",Function),S("design:paramtypes",[Object,jm]),S("design:returntype",void 0)],_.prototype,"removeChapterProperties",null),de([(0,l.aU)(Qm),S("design:type",Function),S("design:paramtypes",[Object,Qm]),S("design:returntype",void 0)],_.prototype,"SetChapterTransparencyMode",null),de([(0,l.aU)(Dc),S("design:type",Function),S("design:paramtypes",[Object,Dc]),S("design:returntype",void 0)],_.prototype,"applyChapterPatch",null),de([(0,l.aU)(Zm),S("design:type",Function),S("design:paramtypes",[Object,Zm]),S("design:returntype",void 0)],_.prototype,"setChapterClippingPlane",null),de([(0,l.aU)(ks),S("design:type",Function),S("design:paramtypes",[Object,ks]),S("design:returntype",void 0)],_.prototype,"setChapterBackground",null),de([(0,l.aU)(Qc),S("design:type",Function),S("design:paramtypes",[Object,Qc]),S("design:returntype",void 0)],_.prototype,"setAllChaptersBackground",null),de([(0,l.aU)(Bm),S("design:type",Function),S("design:paramtypes",[Object,Bm]),S("design:returntype",void 0)],_.prototype,"resetSelectedChapterBackground",null),de([(0,l.aU)(Vm),S("design:type",Function),S("design:paramtypes",[Object,Object]),S("design:returntype",void 0)],_.prototype,"setSelectedChapterBackground",null),de([(0,l.aU)(gi),S("design:type",Function),S("design:paramtypes",[Object,gi]),S("design:returntype",void 0)],_.prototype,"selectChapter",null),de([(0,l.aU)(Ps),S("design:type",Function),S("design:paramtypes",[Object,Object]),S("design:returntype",void 0)],_.prototype,"selectChapterById",null),de([(0,l.aU)(qm),S("design:type",Function),S("design:paramtypes",[Object,qm]),S("design:returntype",void 0)],_.prototype,"duplicateChapter",null),de([(0,l.aU)(Mm),S("design:type",Function),S("design:paramtypes",[Object,Mm]),S("design:returntype",void 0)],_.prototype,"nextChapter",null),de([(0,l.aU)(Im),S("design:type",Function),S("design:paramtypes",[Object,Im]),S("design:returntype",void 0)],_.prototype,"previousChapter",null),de([(0,l.aU)(yd),S("design:type",Function),S("design:paramtypes",[Object,yd]),S("design:returntype",void 0)],_.prototype,"lastChapter",null),de([(0,l.aU)(u1),S("design:type",Function),S("design:paramtypes",[Object,yd]),S("design:returntype",void 0)],_.prototype,"firstChapter",null),de([(0,l.aU)($m),S("design:type",Function),S("design:paramtypes",[Object,$m]),S("design:returntype",void 0)],_.prototype,"removeChapter",null),de([(0,l.aU)(xd),S("design:type",Function),S("design:paramtypes",[Object,xd]),S("design:returntype",void 0)],_.prototype,"resetStoryChaptersState",null),de([(0,l.aU)(Gm),S("design:type",Function),S("design:paramtypes",[Object,Gm]),S("design:returntype",void 0)],_.prototype,"RecordCamera",null),de([(0,l.aU)(vd),S("design:type",Function),S("design:paramtypes",[Object,vd]),S("design:returntype",void 0)],_.prototype,"setChapterCurrentLayersIndexPosition",null),de([(0,l.aU)(Jm),S("design:type",Function),S("design:paramtypes",[Object,Jm]),S("design:returntype",void 0)],_.prototype,"setChapterMedia",null),de([(0,l.aU)(Hm),S("design:type",Function),S("design:paramtypes",[Object,Hm]),S("design:returntype",void 0)],_.prototype,"setChapterContentBlocks",null),de([(0,l.aU)(Xm),S("design:type",Function),S("design:paramtypes",[Object,Cd]),S("design:returntype",void 0)],_.prototype,"setChapterTimelineMap",null),de([(0,l.aU)(Cd),S("design:type",Function),S("design:paramtypes",[Object,Cd]),S("design:returntype",void 0)],_.prototype,"addChapterTimelineMap",null),de([(0,l.aU)(Ym),S("design:type",Function),S("design:paramtypes",[Object,Ym]),S("design:returntype",void 0)],_.prototype,"updateChapterTimelineMap",null),de([(0,l.aU)(Wm),S("design:type",Function),S("design:paramtypes",[Object,Wm]),S("design:returntype",void 0)],_.prototype,"removeFromChapterTimelineMap",null),de([(0,l.aU)(Km),S("design:type",Function),S("design:paramtypes",[Object,Km]),S("design:returntype",void 0)],_.prototype,"SetChapterLights",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getStoryChapters",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getChaptersViewed",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterId",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapter",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getNextChapter",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getPreviousChapter",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterIndex",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterTitle",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getChapterCount",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getRegisteredThumbnails",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getIsChapterAnimated",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterReadyState",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getChaptersLoaded",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getAllChaptersModelsReady",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterModelReady",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterAnimationReady",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getAllChaptersAnimationsReady",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterBackground",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getAllChaptersBackground",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterAllAudio",null),de([(0,l.Qf)([O]),S("design:type",Function),S("design:paramtypes",[Ge,Je]),S("design:returntype",void 0)],_,"getSelectedChapterAudio",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterLegend",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getSelectedChapterClippingPlanes",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",void 0)],_,"getChapterCamera",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Array)],_,"getAllChaptersCurrentLayers",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Array)],_,"getSelectedChapterSrcLayers",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Array)],_,"getSelectedChapterCurrentLayers",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Number)],_,"getSelectedChapterCurrentLayersIndex",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Number)],_,"getSelectedChapterCurrentLayersPosition",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Array)],_,"getSelectedChapterContentBlocks",null),de([(0,l.Qf)(),S("design:type",Function),S("design:paramtypes",[Ge]),S("design:returntype",Array)],_,"getSelectedChapterTimelineMap",null),_=Kt=de([(0,l.ZM)({name:"storyChapters",defaults:Bf}),S("design:paramtypes",[l.yh,Pr,Un,Qf,Ut,Us])],_);var jd,Xt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ce=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const _C={storedCameras:{},cameraMotion:new bd,panMode:"rotate",zoomed:!1,lockCamera:!1,cameraFlyTo:void 0,chapterCameraEnabled:!0};let Ne=jd=class{constructor(n,e,o){this.cameraService=n,this.store=e,this.actions=o}static getStoredCamera(n){return(0,l.P1)([jd],e=>e.storedCameras[n]||null)}static getCameraMotion(n){return n.cameraMotion}static getPanMode(n){return n.panMode}static getZoomed(n){return n.zoomed}static getLockCamera(n){return n.lockCamera}static getChapterCameraEnabled(n){return n.chapterCameraEnabled}storeCamera(n,e){const o=e.camera||this.cameraService.getCamera(),s=n.getState().storedCameras;s[e.id]={...o},n.patchState({storedCameras:{...s}})}clearCamera(n,e){const o=n.getState().storedCameras;delete o[e.id],n.patchState({storedCameras:{...o}})}setCameraFlyTo(n,e){n.patchState(H.Uy(n.getState(),o=>{o.cameraFlyTo=e.camera}))}applyCameraPatch(n,e){const o=H.QE(n.getState(),e.patches);n.patchState(o);const s=void 0===o.cameraFlyTo?this.store.selectSnapshot(_.getChapterCamera):o.cameraFlyTo;n.dispatch(new Zn(s,!0,1))}moveCamera(n,e){n.patchState({cameraMotion:{...e.cameraMotion}})}resetCamera(n,e){const o=this.store.selectSnapshot(_.getSelectedChapter),s=this.cameraService.flyToCamera(o.camera.location);return(0,Yc.D)(s).pipe((0,vo.b)(()=>{n.patchState({cameraMotion:new bd})}))}zoomCamera(n,e){const{cameraMotion:o}=n.getState();o.zoom=e.value,n.patchState({cameraMotion:{...o}})}panCameraX(n,e){const{cameraMotion:o}=n.getState();o.panX=e.value,n.patchState({cameraMotion:{...o}})}panCameraY(n,e){const{cameraMotion:o}=n.getState();o.panY=e.value,n.patchState({cameraMotion:{...o}})}rotateCameraX(n,e){const{cameraMotion:o}=n.getState();n.patchState({cameraMotion:{...o,rotateX:e.value}})}rotateCameraY(n,e){const{cameraMotion:o}=n.getState();o.rotateY=e.value,n.patchState({cameraMotion:{...o}})}SetCameraMode(n,e){n.patchState({panMode:e.mode})}setZoomed(n,e){n.patchState({zoomed:e.zoomed})}lockCamera(n,e){n.patchState({lockCamera:e.lock})}setChapterCameraEnabled(n,e){n.patchState({chapterCameraEnabled:e.enabled})}};Ne.\u0275fac=function(n){return new(n||Ne)(i.LFG(Bn),i.LFG(l.yh),i.LFG(l.eX))},Ne.\u0275prov=i.Yz7({token:Ne,factory:Ne.\u0275fac}),Xt([(0,l.aU)(dm),Ce("design:type",Function),Ce("design:paramtypes",[Object,dm]),Ce("design:returntype",void 0)],Ne.prototype,"storeCamera",null),Xt([(0,l.aU)(pm),Ce("design:type",Function),Ce("design:paramtypes",[Object,pm]),Ce("design:returntype",void 0)],Ne.prototype,"clearCamera",null),Xt([(0,l.aU)(Ac),Ce("design:type",Function),Ce("design:paramtypes",[Object,Ac]),Ce("design:returntype",void 0)],Ne.prototype,"setCameraFlyTo",null),Xt([(0,l.aU)(Lc),Ce("design:type",Function),Ce("design:paramtypes",[Object,Lc]),Ce("design:returntype",void 0)],Ne.prototype,"applyCameraPatch",null),Xt([(0,l.aU)(hr),Ce("design:type",Function),Ce("design:paramtypes",[Object,hr]),Ce("design:returntype",void 0)],Ne.prototype,"moveCamera",null),Xt([(0,l.aU)(cd),Ce("design:type",Function),Ce("design:paramtypes",[Object,cd]),Ce("design:returntype",void 0)],Ne.prototype,"resetCamera",null),Xt([(0,l.aU)(um),Ce("design:type",Function),Ce("design:paramtypes",[Object,um]),Ce("design:returntype",void 0)],Ne.prototype,"zoomCamera",null),Xt([(0,l.aU)(gm),Ce("design:type",Function),Ce("design:paramtypes",[Object,gm]),Ce("design:returntype",void 0)],Ne.prototype,"panCameraX",null),Xt([(0,l.aU)(hm),Ce("design:type",Function),Ce("design:paramtypes",[Object,hm]),Ce("design:returntype",void 0)],Ne.prototype,"panCameraY",null),Xt([(0,l.aU)(fm),Ce("design:type",Function),Ce("design:paramtypes",[Object,fm]),Ce("design:returntype",void 0)],Ne.prototype,"rotateCameraX",null),Xt([(0,l.aU)(bm),Ce("design:type",Function),Ce("design:paramtypes",[Object,bm]),Ce("design:returntype",void 0)],Ne.prototype,"rotateCameraY",null),Xt([(0,l.aU)(zc),Ce("design:type",Function),Ce("design:paramtypes",[Object,zc]),Ce("design:returntype",void 0)],Ne.prototype,"SetCameraMode",null),Xt([(0,l.aU)(pd),Ce("design:type",Function),Ce("design:paramtypes",[Object,pd]),Ce("design:returntype",void 0)],Ne.prototype,"setZoomed",null),Xt([(0,l.aU)(dd),Ce("design:type",Function),Ce("design:paramtypes",[Object,dd]),Ce("design:returntype",void 0)],Ne.prototype,"lockCamera",null),Xt([(0,l.aU)(Ic),Ce("design:type",Function),Ce("design:paramtypes",[Object,Ic]),Ce("design:returntype",void 0)],Ne.prototype,"setChapterCameraEnabled",null),Xt([(0,l.Qf)(),Ce("design:type",Function),Ce("design:paramtypes",[Sa]),Ce("design:returntype",void 0)],Ne,"getCameraMotion",null),Xt([(0,l.Qf)(),Ce("design:type",Function),Ce("design:paramtypes",[Sa]),Ce("design:returntype",void 0)],Ne,"getPanMode",null),Xt([(0,l.Qf)(),Ce("design:type",Function),Ce("design:paramtypes",[Sa]),Ce("design:returntype",void 0)],Ne,"getZoomed",null),Xt([(0,l.Qf)(),Ce("design:type",Function),Ce("design:paramtypes",[Sa]),Ce("design:returntype",void 0)],Ne,"getLockCamera",null),Xt([(0,l.Qf)(),Ce("design:type",Function),Ce("design:paramtypes",[Sa]),Ce("design:returntype",void 0)],Ne,"getChapterCameraEnabled",null),Ne=jd=Xt([(0,l.ZM)({name:"engineCamera",defaults:_C}),Ce("design:paramtypes",[Bn,l.yh,l.eX])],Ne);var Ve=(()=>(function(t){t.Select="Select",t.Hide="Hide",t.Paint="Paint",t.Eyedropper="Eyedropper",t.Label="Label",t.Isolate="Isolate",t.Fade="Fade",t.Position="Position",t.Quiz="Quiz"}(Ve||(Ve={})),Ve))(),Xi=(()=>(function(t){t.Capture="capture",t.DoNotCaptureShowMessage="do_not_capture_show_message",t.DoNotCapture="do_not_capture"}(Xi||(Xi={})),Xi))(),je=A(8510),Qd=A(7615);let Vf=(()=>{class t{constructor(e){this.http=e,this.nodeInfoCache=new Map}queryNodeInfo(e,o,s="en",r=!0){if(se.offline)return(0,Ue.of)(void 0);const c=`/search/descriptions?name=${e}&plan=${o===Fa.Wikipedia?"wiki":o}&ol=${s}`,p=c;if(r&&this.nodeInfoCache.has(p)){const d=this.nodeInfoCache.get(p);return(0,Ue.of)(d)}return this.http.get(c).pipe((0,J.U)(d=>({label:e,latinLabel:d.latin_term,description:d.description,source:d.source,sourceLink:d.url})),(0,Vn.K)(d=>404===d.status?(0,Ue.of)(void 0):(0,Qd._)(d)),(0,vo.b)(d=>this.nodeInfoCache.set(p,d)))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Tr,Nn=(()=>(function(t){t.File="file",t.TTS="tts",t.None="none"}(Nn||(Nn={})),Nn))(),ue=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},P=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const xC=new lm(0,0,0,0,Ss.Hidden);let M=Tr=class{constructor(n,e,o,s,r,a,c,p,d){this.store=n,this.graphService=e,this.engineService=o,this.contentInfoService=s,this.animationService=r,this.postProcessingService=a,this.engineRendererService=c,this.cameraService=p,this.sceneService=d}static getEngine(n){return n.engine}static getReady(n){return n.ready}static getDisplay(n){return n.display}static getScrollMode(n){return n.scrollMode}static getVisible(n){return n.visible}static getViewGraph(n){return n.viewGraph}static getViewGraphNode(n){return e=>n.viewGraph.nodes[e]}static getEnginePosition(n){return n.enginePosition}static getChapter(n){return n.chapter}static getActiveTool(n){return n.activeTool}static getShowCameraBar(n){return n.showCameraBar}static getShowProgressBar(n){return n.showProgressBar}static getShowLabels(n){return n.showLabels}static getAnimationPlaying(n){return n.animationPlaying}static getPlayAudio(n){return n.playAudio}static getPlayAudioType(n){return n.playAudioType}static getAutoplay(n){return n.autoplay}static getXrayModeEnabled(n){return n.xrayModeEnabled}static getHoveredNode(n){return n.hoveredNode}static getLabelEditNode(n){return n.labelEditNode}static getQuerying(n){return n.queryingAnatomy}static getContextmenu(n){return n.contextmenu}static getPlaybackSpeed(n){return n.playbackSpeed}static getWatermarkEnabled(n){return n.watermarkEnabled}static getWebGLContextName(n){return n.webGLContextName}load(n,e){n.dispatch(new jp("engine"))}loadSuccess({patchState:n},e){n({engine:e.result})}setReady(n,e){n.patchState({ready:e.ready})}setDisplay(n,e){n.patchState({display:e.display})}setZoomViaScrollAllowed(n,e){n.patchState({scrollMode:e.scrollMode})}setVisible(n,e){n.patchState({visible:e.visible})}setEnginePosition(n,e){n.patchState({enginePosition:{...e.position,right:e.position.left+e.position.width,bottom:e.position.top+e.position.height}})}resetEnginePosition(n,e){n.patchState({enginePosition:xC})}setChapter(n,e){n.patchState({chapter:e.chapterId})}setActiveTool(n,e){n.patchState({activeTool:e.tool})}setGraph(n,e){n.patchState({viewGraph:{...e.graph}})}clearGraph(n,e){n.patchState({viewGraph:{nodes:{},successors:{},predecessors:{},roots:{}}})}setXrayMode(n,e){n.patchState({xrayModeEnabled:e.enabled})}toggleProgressBar(n,e){n.patchState({showProgressBar:e.show})}toggleCameraBar(n,e){n.patchState({showCameraBar:e.show})}toggleLabels(n,e){const o=null!=e.show?e.show:!n.getState().showLabels;n.patchState({showLabels:o})}synchronizeVisibleNodes(n,e){const o=n.getState().viewGraph,s=this.stateMapToNodeIds(o,e.leafVisibilityState),r={};s.forEach(a=>{const p=this.sceneService.getLeafIds(a).reduce((d,u)=>d||e.nodes[u].shown,!1);r[a]={shown:p}}),this.graphService.synchronize({...o},{shown:"trueWins"},r),n.patchState({viewGraph:{...o}})}synchronizeRenderableNodes(n,e){const o=n.getState().viewGraph,s=this.stateMapToNodeIds(o,e.leafRenderableState),r={};s.forEach(a=>{r[a]={renderable:!0}}),this.graphService.synchronize(o,{renderable:"falseWins"},r)}synchronizePickableNodes(n,e){const o=n.getState().viewGraph,s=this.stateMapToNodeIds(o,e.leafPickableState),r={};s.forEach(a=>{const p=this.sceneService.getLeafIds(a).reduce((d,u)=>d||this.sceneService.getObjectById(u).pickable,!1);r[a]={pickable:p}}),this.graphService.synchronize(o,{pickable:"trueWins"},r),n.patchState({viewGraph:{...o}})}playChapterAnimation(n,e){const r=-1===(this.store.selectSnapshot(_.getSelectedChapter)?.ui?.play?.count??0);this.animationService.setAnimationLoop(r),this.animationService.restart(),n.getState().animationPlaying||this.animationService.pause()}toggleAnimation(n,e){e.play?this.animationService.unpause():this.animationService.pause()}setAnimationPlaying(n,e){n.patchState({animationPlaying:e.playing})}setPlaybackSpeed(n,e){n.patchState({playbackSpeed:e.speed})}playAudio(n,e){n.patchState({playAudio:e.play})}setAudioType(n,e){n.patchState({playAudioType:e.playAudioType})}setAutoplay(n,e){n.patchState({autoplay:e.enable})}setObjectLayerOrder(n,e){const o=n.getState().viewGraph,s=isNaN(e.layer)?0:e.layer;let r=[];e.nodes.forEach(a=>{const c=this.graphService.getDescendants(o,a.id,!0);r=r.concat(c)}),r.forEach(a=>{this.sceneService.setObjectLayer(a,s),this.graphService.setState(o,a,{layer:s})}),n.patchState({viewGraph:{...o}})}setObjectDisplayName(n,e){const o=this.sceneService.getObjectById(e.nodeId);o&&(o.displayName=e.displayName)}autoSortObjectLayers(n,e){const o=n.getState().viewGraph;let r=0;const a=this.sceneService.getEnabledLeafIds(),c=this.sceneService.getObjectLayerValues(a);Object.keys(c).map(p=>parseInt(p,10)).sort((p,d)=>p-d).forEach(p=>{c[p].sort((d,u)=>u.value-d.value).forEach(d=>{const u=20*r;this.sceneService.setObjectLayer(d.nodeId,u),this.graphService.setState(o,d.nodeId,{layer:u}),r++})}),n.patchState({viewGraph:{...o}})}resetObjectLayers(n,e){const o=n.getState().viewGraph;this.sceneService.getEnabledLeafIds().forEach(r=>{this.sceneService.setObjectLayer(r,0),this.graphService.setState(o,r,{layer:0})}),n.patchState({viewGraph:{...o}})}setPostProcessingEffects(n,{effects:e}){this.postProcessingService.setPostProcessingFeatures(e)}setProperties(n,{properties:e}){this.engineService.setProperties({...e})}setTransparencyMode(n,{mode:e}){this.engineRendererService.setTransparencyMode(e)}expandNode(n,e){const o=this.store.selectSnapshot(Tr.getViewGraph);(function $0(t,n,e=!1,o="ascending"){const s=e?[n]:[];let r=t.predecessors[n];for(;r;)s.push(r),r=t.predecessors[r];return"descending"===o&&s.reverse(),s})(o,e.node.id,!0).forEach(r=>{o.nodes[r].boolState.expanded=!0}),this.store.dispatch(new yo(o))}collapseNode(n,e){const o=this.store.selectSnapshot(Tr.getViewGraph);o.nodes[e.node.id].boolState.expanded=!1,this.store.dispatch(new yo(o))}collapseAllViewTreeNodes(n,e){const o=this.store.selectSnapshot(Tr.getViewGraph);Object.values(o.nodes).forEach(s=>{s.boolState.expanded=!1}),this.store.dispatch(new yo(o))}hoverNode(n,e){n.patchState({hoveredNode:e.node})}setLabelEditNode(n,e){n.patchState({labelEditNode:e.node})}queryNodeInfo(n,{node:e,fallback:o,lang:s}){n.patchState({queryingAnatomy:!0}),this.contentInfoService.queryNodeInfo(e.label,o,s).pipe((0,je.x)(()=>n.patchState({queryingAnatomy:!1}))).subscribe(r=>n.dispatch(new Pc(e,r)),()=>n.dispatch(new om(e)))}queryNodeInfoSuccess(n,{node:e,info:o}){n.dispatch(new xa(e,o))}setNodeInfo(n,{node:e,info:o}){const s=this.store.selectSnapshot(Tr.getViewGraph),r=s.nodes[e.id];r&&o&&(r.description=o.description,r.info=o,this.store.dispatch(new yo(s)))}setContextMenu(n,e){n.patchState({contextmenu:{node:e.node,hit:e.hit}})}setWatermarkEnabled(n,{enabled:e}){n.patchState({watermarkEnabled:e})}setWebGLContext(n,e){n.patchState({webGLContextName:e.context})}stateMapToNodeIds(n,e){const o=Object.keys(e).map(s=>this.sceneService.getViewNode(n,s)).filter(s=>!!s).map(s=>s.id);return new Set(o)}};function SC(t,n){const e=h=>void 0!==h.objectId,[o,s]=(0,m.partition)(t,e),[r,a]=(0,m.partition)(n,e),c=function CC(t,n){return n.reduce((e,o)=>{for(const s of t)(0,m.isEqual)(s,o)||e.push(o);return e},t)}(s,a),{newSceneGraph:p,graphsMerged:d,objectIdsUniqueToNew:u,objectIdsUniqueToOriginal:g}=function wC(t,n){const e=t.reduce((r,a)=>(r[a.objectId]=a,r),{}),o=n.reduce((r,a)=>{if(void 0===r.nodes[a.objectId])return r.nodes[a.objectId]=a,r;if(!(0,m.isEqual)(a,r.nodes[a.objectId])){const c=function vC(t,n){const e={},o={};return{root:function s(a,c){if(a.objectId!==c.objectId)return e[c.objectId]=!0,[a,c];if(void 0===a.objects&&c.objects){for(const u of c.objects)e[u.objectId]=!0;return[{...c}]}if(a.objects&&void 0===c.objects){for(const u of a.objects)o[u.objectId]=!0;return[{...a}]}if(void 0===a.objects&&void 0===c.objects)return[{...a}];const p=[];for(const u of a.objects){const g=c.objects.find(h=>h.objectId===u.objectId);g?p.push(s(u,g)):(o[u.objectId]=!0,p.push(u))}for(const u of c.objects)a.objects.find(h=>h.objectId===u.objectId)||(e[u.objectId]=!0,p.push(u));const d={...a};return d.objects=(0,m.flatten)(p),[d]}(t,n),objectIdsUniqueToNew:e,objectIdsUniqueToOriginal:o}}(r.nodes[a.objectId],a);r.nodes[a.objectId]=c.root[0],r.graphsMerged.push(a.objectId),r.objectIdsUniqueToNew[a.objectId]=c.objectIdsUniqueToNew,r.objectIdsUniqueToOriginal[a.objectId]=c.objectIdsUniqueToOriginal}return r},{nodes:e,graphsMerged:[],objectIdsUniqueToNew:{},objectIdsUniqueToOriginal:{}});return{newSceneGraph:Object.keys(o.nodes).reduce((r,a)=>(r.push(o.nodes[a]),r),[]),graphsMerged:o.graphsMerged,objectIdsUniqueToNew:o.objectIdsUniqueToNew,objectIdsUniqueToOriginal:o.objectIdsUniqueToOriginal}}(o,r);return{sceneGraph:[...c,...p],graphsMerged:d,objectIdsUniqueToNew:u,objectIdsUniqueToOriginal:g}}function qf(t,n,e){const o=function PC(t,n){const e={};for(const o of t){const s=Object.keys(n[o]);for(const r of s)e[r]=!1}return e}(n,e);return t.map(s=>({...s,showObjects:{...s.showObjects,...o},selectObjects:{...s.selectObjects,...o},pickThroughObjects:{...s.pickThroughObjects,...o}}))}function nl(t){return t.split("/").length>1?Xe.Module:Xe.Bookmark}function $f(t,n){return t.map(e=>{if(!(0,m.isEmpty)(e.lights))return e;const o={libraries:[...n],lights:[]};return{...e,lights:o}})}function Gf(t){return t.customData&&t.customData.particleSystems?t.customData.particleSystems.reduce((n,e)=>(n[Mi.getParticleIdRoot(e.id)]=e.id,n),{}):{}}function Jf(t,n){return t.customData&&t.customData.particleSystems?t.customData.particleSystems.map(e=>{const o=Mi.getParticleIdRoot(e.id);return{...e,id:n[o]}}):[]}function Hf(t,n){return t.map(e=>(e.customData&&e.customData.particleSystems&&(e.customData.particleSystems=e.customData.particleSystems.map(o=>n[Mi.getParticleIdRoot(o)])),e))}function Yf(t,n){return t.map(e=>e.id).reduce((e,o)=>(t.some(r=>r.id===o&&(0,m.get)(r,"customData.particleSystems",[]).length>0)&&(e[o]=n),e),{})}function IC(t,n,e,o,s=Xe.Bookmark,r=$t.idWithPrefix){const{sceneGraph:a,graphsMerged:c,objectIdsUniqueToNew:p,objectIdsUniqueToOriginal:d}=SC(t.sceneGraph,e.sceneGraph),u=function TC(t,n){const e=(a,c)=>(0,m.uniq)([...a,...c]);return{lights:e(t.lights,n.lights),tweens:e(t.tweens,n.tweens),reflections:e(t.reflections,n.reflections)}}(t.assetLibraries,e.assetLibraries),g=function OC(t,n,e,o){n=n||{};const s=(r,a)=>a.includes("/")?a:`${function kC(t){return nl(t)===Xe.Bookmark?t:t.split("/").pop()}(r)}/${a}`;return{...(0,m.mapKeys)(t=t||{},(r,a)=>s(e,a)),...(0,m.mapKeys)(n,(r,a)=>s(o,a))}}(t.reflections,e.reflections,n,o),h=$f(t.chapters,t.assetLibraries.lights),y=$f(e.chapters,e.assetLibraries.lights),V=function MC(t,n,e,o,s){const r=Gf(t),a=Object.values(r),c=Gf(n);for(const y in c)if(c.hasOwnProperty(y)&&a.includes(c[y])){const B=Mi.generateParticleId(y,s);c[y]=B}const p=[...Jf(t,r),...Jf(n,c)],d=Hf(e,r),u=Hf(o,c),g={...Yf(d,r),...Yf(u,c)};return{mergedParticles:p,currentChapters:d,importedChapters:u,tweenParticleLookup:(0,m.pickBy)(g,(y,k)=>!(0,m.isEmpty)(y))}}(t,e,qf(h,c,p),qf(y,c,d).map(D=>({...D,id:r("chapter")})),r),ge=[...V.currentChapters,...V.importedChapters],F={...t.customData,particleSystems:V.mergedParticles},R="module"===s?t.tags:[];return{...t,assetLibraries:u,chapters:ge,sceneGraph:a,customData:F,tags:R,reflections:g,stateId:(0,m.uniq)([...t.stateId,...e.stateId]),tweenParticleLookup:V.tweenParticleLookup}}M.\u0275fac=function(n){return new(n||M)(i.LFG(l.yh),i.LFG(Oi),i.LFG(et),i.LFG(Vf),i.LFG(Un),i.LFG(Od),i.LFG(Po),i.LFG(Bn),i.LFG(Ut))},M.\u0275prov=i.Yz7({token:M,factory:M.\u0275fac}),ue([(0,l.aU)(Gh),P("design:type",Function),P("design:paramtypes",[Object,Gh]),P("design:returntype",void 0)],M.prototype,"load",null),ue([(0,l.aU)(jp),P("design:type",Function),P("design:paramtypes",[Object,jp]),P("design:returntype",void 0)],M.prototype,"loadSuccess",null),ue([(0,l.aU)(Qp),P("design:type",Function),P("design:paramtypes",[Object,Qp]),P("design:returntype",void 0)],M.prototype,"setReady",null),ue([(0,l.aU)(yc),P("design:type",Function),P("design:paramtypes",[Object,yc]),P("design:returntype",void 0)],M.prototype,"setDisplay",null),ue([(0,l.aU)(_c),P("design:type",Function),P("design:paramtypes",[Object,_c]),P("design:returntype",void 0)],M.prototype,"setZoomViaScrollAllowed",null),ue([(0,l.aU)(dr),P("design:type",Function),P("design:paramtypes",[Object,dr]),P("design:returntype",void 0)],M.prototype,"setVisible",null),ue([(0,l.aU)(Xp),P("design:type",Function),P("design:paramtypes",[Object,Xp]),P("design:returntype",void 0)],M.prototype,"setEnginePosition",null),ue([(0,l.aU)(ed),P("design:type",Function),P("design:paramtypes",[Object,ed]),P("design:returntype",void 0)],M.prototype,"resetEnginePosition",null),ue([(0,l.aU)(Zp),P("design:type",Function),P("design:paramtypes",[Object,Zp]),P("design:returntype",void 0)],M.prototype,"setChapter",null),ue([(0,l.aU)(Cs),P("design:type",Function),P("design:paramtypes",[Object,Cs]),P("design:returntype",void 0)],M.prototype,"setActiveTool",null),ue([(0,l.aU)(yo),P("design:type",Function),P("design:paramtypes",[Object,yo]),P("design:returntype",void 0)],M.prototype,"setGraph",null),ue([(0,l.aU)(Z0),P("design:type",Function),P("design:paramtypes",[Object,yo]),P("design:returntype",void 0)],M.prototype,"clearGraph",null),ue([(0,l.aU)(xc),P("design:type",Function),P("design:paramtypes",[Object,xc]),P("design:returntype",void 0)],M.prototype,"setXrayMode",null),ue([(0,l.aU)($p),P("design:type",Function),P("design:paramtypes",[Object,$p]),P("design:returntype",void 0)],M.prototype,"toggleProgressBar",null),ue([(0,l.aU)(Yh),P("design:type",Function),P("design:paramtypes",[Object,Yh]),P("design:returntype",void 0)],M.prototype,"toggleCameraBar",null),ue([(0,l.aU)(Wo),P("design:type",Function),P("design:paramtypes",[Object,Wo]),P("design:returntype",void 0)],M.prototype,"toggleLabels",null),ue([(0,l.aU)(Bp),P("design:type",Function),P("design:paramtypes",[Object,Bp]),P("design:returntype",void 0)],M.prototype,"synchronizeVisibleNodes",null),ue([(0,l.aU)(Vp),P("design:type",Function),P("design:paramtypes",[Object,Vp]),P("design:returntype",void 0)],M.prototype,"synchronizeRenderableNodes",null),ue([(0,l.aU)(qp),P("design:type",Function),P("design:paramtypes",[Object,qp]),P("design:returntype",void 0)],M.prototype,"synchronizePickableNodes",null),ue([(0,l.aU)(Cc),P("design:type",Function),P("design:paramtypes",[Object,Cc]),P("design:returntype",void 0)],M.prototype,"playChapterAnimation",null),ue([(0,l.aU)(_o),P("design:type",Function),P("design:paramtypes",[Object,_o]),P("design:returntype",void 0)],M.prototype,"toggleAnimation",null),ue([(0,l.aU)(Gp),P("design:type",Function),P("design:paramtypes",[Object,Gp]),P("design:returntype",void 0)],M.prototype,"setAnimationPlaying",null),ue([(0,l.aU)(Jp),P("design:type",Function),P("design:paramtypes",[Object,Jp]),P("design:returntype",void 0)],M.prototype,"setPlaybackSpeed",null),ue([(0,l.aU)(ws),P("design:type",Function),P("design:paramtypes",[Object,ws]),P("design:returntype",void 0)],M.prototype,"playAudio",null),ue([(0,l.aU)(Hp),P("design:type",Function),P("design:paramtypes",[Object,Hp]),P("design:returntype",void 0)],M.prototype,"setAudioType",null),ue([(0,l.aU)(Yp),P("design:type",Function),P("design:paramtypes",[Object,Yp]),P("design:returntype",void 0)],M.prototype,"setAutoplay",null),ue([(0,l.aU)(Wp),P("design:type",Function),P("design:paramtypes",[Object,Wp]),P("design:returntype",void 0)],M.prototype,"setObjectLayerOrder",null),ue([(0,l.aU)(Kp),P("design:type",Function),P("design:paramtypes",[Object,Kp]),P("design:returntype",void 0)],M.prototype,"setObjectDisplayName",null),ue([(0,l.aU)(Kh),P("design:type",Function),P("design:paramtypes",[Object,Kh]),P("design:returntype",void 0)],M.prototype,"autoSortObjectLayers",null),ue([(0,l.aU)(Xh),P("design:type",Function),P("design:paramtypes",[Object,Xh]),P("design:returntype",void 0)],M.prototype,"resetObjectLayers",null),ue([(0,l.aU)(em),P("design:type",Function),P("design:paramtypes",[Object,em]),P("design:returntype",void 0)],M.prototype,"setPostProcessingEffects",null),ue([(0,l.aU)(tm),P("design:type",Function),P("design:paramtypes",[Object,tm]),P("design:returntype",void 0)],M.prototype,"setProperties",null),ue([(0,l.aU)(nm),P("design:type",Function),P("design:paramtypes",[Object,nm]),P("design:returntype",void 0)],M.prototype,"setTransparencyMode",null),ue([(0,l.aU)(ur),P("design:type",Function),P("design:paramtypes",[Object,ur]),P("design:returntype",void 0)],M.prototype,"expandNode",null),ue([(0,l.aU)(wc),P("design:type",Function),P("design:paramtypes",[Object,wc]),P("design:returntype",void 0)],M.prototype,"collapseNode",null),ue([(0,l.aU)(im),P("design:type",Function),P("design:paramtypes",[Object,im]),P("design:returntype",void 0)],M.prototype,"collapseAllViewTreeNodes",null),ue([(0,l.aU)(gr),P("design:type",Function),P("design:paramtypes",[Object,gr]),P("design:returntype",void 0)],M.prototype,"hoverNode",null),ue([(0,l.aU)(Sc),P("design:type",Function),P("design:paramtypes",[Object,Sc]),P("design:returntype",void 0)],M.prototype,"setLabelEditNode",null),ue([(0,l.aU)(td),P("design:type",Function),P("design:paramtypes",[Object,td]),P("design:returntype",void 0)],M.prototype,"queryNodeInfo",null),ue([(0,l.aU)(Pc),P("design:type",Function),P("design:paramtypes",[Object,Pc]),P("design:returntype",void 0)],M.prototype,"queryNodeInfoSuccess",null),ue([(0,l.aU)(xa),P("design:type",Function),P("design:paramtypes",[Object,xa]),P("design:returntype",void 0)],M.prototype,"setNodeInfo",null),ue([(0,l.aU)(_a),P("design:type",Function),P("design:paramtypes",[Object,_a]),P("design:returntype",void 0)],M.prototype,"setContextMenu",null),ue([(0,l.aU)(sm),P("design:type",Function),P("design:paramtypes",[Object,sm]),P("design:returntype",void 0)],M.prototype,"setWatermarkEnabled",null),ue([(0,l.aU)(nd),P("design:type",Function),P("design:paramtypes",[Object,nd]),P("design:returntype",void 0)],M.prototype,"setWebGLContext",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getEngine",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getReady",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getDisplay",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getScrollMode",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getVisible",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getViewGraph",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getViewGraphNode",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getEnginePosition",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getChapter",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getActiveTool",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getShowCameraBar",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getShowProgressBar",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getShowLabels",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getAnimationPlaying",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getPlayAudio",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getPlayAudioType",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getAutoplay",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getXrayModeEnabled",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getHoveredNode",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getLabelEditNode",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getQuerying",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getContextmenu",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getPlaybackSpeed",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getWatermarkEnabled",null),ue([(0,l.Qf)(),P("design:type",Function),P("design:paramtypes",[zt]),P("design:returntype",void 0)],M,"getWebGLContextName",null),M=Tr=ue([(0,l.ZM)({name:"engine",defaults:{loading:!1,ready:!1,viewGraph:{nodes:{},successors:{},predecessors:{},roots:{}},hoveredNode:void 0,labelEditNode:void 0,queryingAnatomy:!1,engine:"",chapter:"",showProgressBar:!0,showCameraBar:!0,showLabels:!0,activeTool:Ve.Select,animationPlaying:!1,autoplay:!0,playAudio:!1,playAudioType:Nn.None,display:!0,visible:!0,scrollMode:Xi.Capture,playbackSpeed:1,xrayModeEnabled:!1,contextmenu:{node:null,hit:null},watermarkEnabled:!1,webGLContextName:void 0},children:[Ne]}),P("design:paramtypes",[l.yh,Oi,et,Vf,Un,Od,Po,Bn,Ut])],M);var os,kn,eo=A(1183);function Wf(t){return function AC(t){return new b.y(n=>{const e=new Image;e.onload=()=>{const o=function zC(t){const n=document.createElement("canvas"),e=n.getContext("2d");return n.width=t.naturalWidth,n.height=t.naturalHeight,e.drawImage(t,0,0),n}(e);n.next(o),n.complete()},e.onerror=()=>{const o=document.createElement("canvas");n.next(o),n.complete()},e.src=t})}(t).pipe((0,$.h)(n=>!(0,m.isNil)(n)),(0,eo.w)(n=>new b.y(e=>{n.toBlob(o=>{e.next(o),e.complete()},"image/jpeg",100)})))}function Kf(t,n){return{showObjects:(0,m.mapKeys)(t.showObjects,(a,c)=>kn.renamespaceValue(c,n)),selectObjects:(0,m.mapKeys)(t.selectObjects,(a,c)=>kn.renamespaceValue(c,n)),pickThroughObjects:(0,m.mapKeys)(t.pickThroughObjects,(a,c)=>kn.renamespaceValue(c,n)),synchronization:(0,m.mapKeys)(t.synchronization,(a,c)=>kn.renamespaceValue(c,n))}}function LC(t,n){const e=o=>o.map(s=>s.type===Fn.flyToChapter||s.type===Fn.flyToObject?{...s,value:kn.renamespaceValue(s.value,n)}:s);return(t||[]).map(o=>({...o,objectId:kn.renamespaceValue(o.objectId,n),states:o.states.map(s=>({...s,errands:e(s.errands)}))}))}function FC(t,n){return(t||[]).map(e=>(e.data.timeline=n[e.data.timeline]||e.data.timeline,e))}function UC(t,n){return(t||[]).map(e=>(e.objectId&&(e.objectId=kn.renamespaceValue(e.objectId,n)),e))}function RC(t,n){return t?{xray:(0,m.mapKeys)(t.xray,(e,o)=>kn.renamespaceValue(o,n)),highlight:(0,m.mapKeys)(t.highlight,(e,o)=>kn.renamespaceValue(o,n))}:{}}function NC(t,n){const o={...t};return Array.isArray(t.layers)&&(o.layers=t.layers.map(s=>({...s,objectIds:s.objectIds.map(r=>kn.renamespaceValue(r,n))}))),o}function Xf(t,n){for(const e of t)["objectId","displayName","geometryId","morphId","materialId","transformId"].forEach(o=>{e[o]&&(e[o]=kn.renamespaceValue(e[o],n))}),Xf(e.objects||[],n);return t}function jC(t,n){function e(r=[]){return r.map(a=>({...a,src:kn.renamespaceValue(a.src,n)}))}let s=[];return t&&Array.isArray(t.particleSystems)&&(s=t.particleSystems.map(function o(r){return{...r,textures:e(r.textures)}})),s}function QC(t,n){const e=function DC(t,n){return"string"==typeof t?[n[t]||t]:t.map(e=>n[e]||e)}(t.stateId,n),o=t.assetLibraries.tweens.map(d=>kn.renamespaceValue(d,n)),s=t.assetLibraries.reflections.map(d=>kn.renamespaceValue(d,n)),r=(0,m.mapValues)(t.reflections,(d,u)=>kn.renamespaceValue(d,n)),a=function EC(t,n){return t.map(e=>({...e,...Kf(e,n),colorRecipeObjects:RC(e.colorRecipeObjects,n),timelineMap:FC(e.timelineMap,n),labels:LC(e.labels,n),hotspots:UC(e.hotspots,n),visibilityLayers:NC(e.sliderLayers,n)}))}(t.chapters,n),c=Xf(t.sceneGraph,n),p={...t.customData,particleSystems:jC(t.customData,n)};return{...t,stateId:e,...Kf(t,n),assetLibraries:{...t.assetLibraries,tweens:o,reflections:s},reflections:r,chapters:a,sceneGraph:c,customData:p}}!function(t){function o(a,c){const p=new Cr;if(a.thumbnails)p.legacy=!1,p.storyId=c,p.chapterId=a.id,p.urls={...a.thumbnails};else{const u=`/thumbs/${Xe.Bookmark===nl(c)?"bookmarks":"modules"}/${c.replace(".json","")}`;p.legacy=!0,p.storyId=c,p.chapterId=a.id,p.urls={small:`${u}/small/chapters/${a.id}.jpg`,large:`${u}/large/chapters/${a.id}.jpg`}}return p}t.generateLegacyThumbnail=function n(a,c){const u=`/thumbs/${Xe.Bookmark===nl(a)?"bookmarks":"modules"}/${a.replace(".json","")}`;return{small:`${u}/small/chapters/${c}.jpg`,large:`${u}/large/chapters/${c}.jpg`}},t.generateThumbnails=function e(a){return a.reduce((c,{originalChapterId:p,newChapterId:d,originalStoryId:u})=>{const g=Xe.Bookmark===nl(u),h=new Cr;h.storyId=u,h.chapterId=p;const k=`/thumbs/${g?"bookmarks":"modules"}/${u.replace(".json","")}`;return h.urls={small:`${k}/small/chapters/${p}.jpg`,large:`${k}/large/chapters/${p}.jpg`},c.set(d,h),c},new Map)},t.getChapterThumbnail=o,t.getChapterThumbnails=function s(a,c){return c.reduce((p,d)=>{const u=o(d,a);return p.set(d.id,u),p},new Map)},t.makeFreshThumbnail=function r(a,c,p){return Wf(p).pipe((0,$.h)(d=>!(0,m.isNil)(d)),(0,J.U)(d=>{const u=new Cr;return u.snapshot=URL.createObjectURL(d),u.chapterId=c,u.storyId=a,u}))}}(os||(os={})),function(t){function n(r,a){const c=Object.entries(a);return c.sort((p,d)=>p[0].length===d[0].length?0:p[0].length<d[0].length?1:-1),c.reduce((p,[d,u])=>{if(p.startsWith(d)){const g=new RegExp(`^${d}`);p=p.replace(g,u)}return p},r||"")}t.renamespaceValue=n,t.renamespaceKeys=function e(r,a){return Object.entries(r).reduce((c,[p,d])=>(c[n(p,a)]=d,c),{})},t.renamespaceAssetLibrary=function o(r,a,c){if(!c)return r;const p=r.tweens.map(u=>n(u,a)),d=r.reflections.map(u=>n(u,a));return{...r,tweens:p,reflections:d}},t.renamespaceReflections=function s(r,a,c){return c?(0,m.mapValues)(r,p=>n(p,a)):r}}(kn||(kn={}));const il="context-label";class bi{}let ol=(()=>{class t{constructor(e,o){this.engineService=e,this.sceneService=o,this.markers=new Map,this.initMarkerEvents()}getMarkerWorldPosition(e){if((0,m.isNil)(e))return;const o=he.clone(e.marker3D.position);return he.scale(o,o,1/xe.BIODIGITAL_SCENE_SCALE),o}getMarkerById(e){return this.markers.get(e)}createMarker(e){const{id:o,objectId:s,primitiveIndex:r,renderableIndex:a,barycentric:c,pos:p}=e,d=this.engineService.engine,u=d.story.activeChapter,g=r>=0?"primitive":"object";if(!s)return console.warn("An object id is required for creating a marker.",{id:o}),null;const h=u.anatomyObjects.get(s);if((0,m.isNil)(h))return console.warn("A valid object id is required for creating a marker.",{id:o,objectId:s}),null;let y=p?he.clone(p):void 0;"object"===g&&(0,m.isNil)(y)&&(y=this.sceneService.getObjectBoundaryCenter(s)),(0,m.isNil)(y)||he.scale(y,y,xe.BIODIGITAL_SCENE_SCALE);const B=new xe.BioDigitalScreenMarker(d,u,{object:h,trackingMode:g,renderableIndex:a||0,primitiveIndex:r,barycenter:c||[1/3,1/3,1/3],worldPosition:y},o);return this.markers.set(o,B),B.update(),B}deleteMarker(e){this.markers.get(e)?.destroy(),this.markers.delete(e)}deleteMarkers(){this.markers.forEach(e=>e.destroy()),this.markers.clear()}initMarkerEvents(){this.engineService.engineCreated$.subscribe(e=>{e.renderer.on("update",()=>{0!==this.markers.size&&(this.markers.forEach(o=>o.update()),this.engineService.fireEvent(pe.SceneMarkersUpdated,this.markers))})})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Mr,nt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},G=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const eb={enableContextLabel:{enable:!0,enableInfo:!0,enableActions:!0},loading:!1,labelsCollapsed:!1,labelsCollapsedMode:ko.None,labelScale:null,labels:[],contextLabel:null,selectedLabel:null,draggable:{pin:!0,tag:!0}};let te=Mr=class{constructor(n,e){this.store=n,this.markerService=e}static getLabels(n){return n.labels}static getLabelsCollapsed(n){return n.labelsCollapsed}static getLabelsCollapsedMode(n){return n.labelsCollapsedMode}static getSelectedLabelId(n){return n.selectedLabel}static getSelectedLabel(n){return n.labels.find(e=>e.id===n.selectedLabel)||null}static getContextLabel(n){return n.contextLabel}static getChapterLabels(n,e){return n.labels.filter(o=>o.chapterId===e.selectedChapter)}static getChapterSequentialLabels(n){return(0,l.P1)([Mr,_],(e,o)=>e.labels.filter(s=>s.chapterId===o.selectedChapter&&s.pinType===St.Sequential&&s.sequentialType===n))}static getLabelSequence(n){return(0,l.P1)([Mr,Mr.getChapterSequentialLabels(ii.Alphabetical),Mr.getChapterSequentialLabels(ii.Numerical)],(e,o,s)=>{if(n.pinType!==St.Sequential)return null;switch(n.sequentialType){case ii.Alphabetical:const r=o.findIndex(a=>a.id===n.id);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(r);case ii.Numerical:return s.findIndex(a=>a.id===n.id)+1}})}static getEnableContextLabel(n){return n.enableContextLabel.enable}static getEnableContextLabelInfo(n){return n.enableContextLabel.enableInfo}static getEnableContextLabelActions(n){return n.enableContextLabel.enableActions}static getLabelsDraggable(n){return n.draggable}static getLabelScale(n){return n.labelScale}PatchLabels(n,e){const o=H.QE(n.getState(),e.patches);n.patchState(o)}setLabelOffset(n,e){const[o,s,r]=H.aS(n.getState(),a=>{const c=a.labels.find(p=>p.id===e.labelId);c&&(c.offset=e.offset)});n.patchState(o),this.savePatches(s,r)}setLabels(n,e){n.patchState(H.Uy(n.getState(),o=>{o.labels=e.labels}))}setLabel(n,e){const[o,s,r]=H.aS(n.getState(),a=>{a.labels=a.labels.map(c=>c.id===e.label.id?e.label:c)});n.patchState(o),e.record&&this.savePatches(s,r)}setLabelStates(n,e){const[o,s,r]=H.aS(n.getState(),a=>{a.labels.find(p=>p.id===e.id).states=e.states});n.patchState(o),this.savePatches(s,r)}setLabelScale(n,e){n.patchState({labelScale:e.scale})}addLabel(n,e){const[o,s,r]=H.aS(n.getState(),a=>{const c=e.label.id||$t.idWithPrefix("label"),p={...e.label,id:c};a.labels.push(p)});n.patchState(o),this.savePatches(s,r)}addContextLabel(n,e){const o=H.Uy(n.getState(),s=>{s.contextLabel={...e.label,id:il}});n.patchState(o)}removeLabel(n,e){const[o,s,r]=H.aS(n.getState(),a=>{a.labels=a.labels.filter(c=>c.id!==e.label.id)});n.patchState(o),this.markerService.deleteMarker(e.label.id),this.savePatches(s,r)}removeContextLabel(n,e){const o=H.Uy(n.getState(),s=>{s.contextLabel=void 0});this.markerService.deleteMarker(il),n.patchState(o)}removeAllChapterLabels(n,e){const[o,s,r]=H.aS(n.getState(),a=>{const[c,p]=(0,m.partition)(a.labels,d=>d.chapterId!==e.chapter.id);p.forEach(d=>this.markerService.deleteMarker(d.id)),a.labels=c});n.patchState(o),this.savePatches(s,r)}selectLabel(n,e){n.patchState({selectedLabel:e.label?e.label.id:null})}resetLabels(n,e){const o=n.getState();this.markerService.deleteMarker(il),o.labels.forEach(s=>{this.markerService.deleteMarker(s.id)}),n.setState(H.Uy(n.getState(),s=>{}))}convertLabels(n,e){const[o,s,r]=H.aS(n.getState(),a=>{e.labels.forEach(c=>{const p=a.labels.findIndex(d=>d.id===c.id);a.labels[p]={...a.labels[p],...e.fields}})});n.setState({...o}),this.savePatches(s,r)}enableContextLabel(n,e){n.patchState({enableContextLabel:{...e}})}setLabelsShown(n,{labels:e,shown:o}){const s=n.getState().labels.map(r=>{const a=e.some(c=>c.id===r.id);return{...r,shown:a?o:r.shown}});n.patchState({labels:[...s]})}setAllLabelsShown(n,{show:e}){const o=n.getState().labels;n.dispatch(new To(o,e))}setLabelsCollapsed(n,{collapsed:e,collapsedMode:o}){n.patchState({labelsCollapsed:e,labelsCollapsedMode:o})}setLabelsDraggable(n,e){n.patchState({draggable:{...e.draggable}})}savePatches(n,e){this.store.dispatch(new Nt.SavePatches([{forward:n,inverse:e,patchAction:Md}]))}};te.\u0275fac=function(n){return new(n||te)(i.LFG(l.yh),i.LFG(ol))},te.\u0275prov=i.Yz7({token:te,factory:te.\u0275fac}),nt([(0,l.aU)(Md),G("design:type",Function),G("design:paramtypes",[Object,Md]),G("design:returntype",void 0)],te.prototype,"PatchLabels",null),nt([(0,l.aU)(Id),G("design:type",Function),G("design:paramtypes",[Object,Id]),G("design:returntype",void 0)],te.prototype,"setLabelOffset",null),nt([(0,l.aU)(el),G("design:type",Function),G("design:paramtypes",[Object,el]),G("design:returntype",void 0)],te.prototype,"setLabels",null),nt([(0,l.aU)(Fs),G("design:type",Function),G("design:paramtypes",[Object,Fs]),G("design:returntype",void 0)],te.prototype,"setLabel",null),nt([(0,l.aU)(If),G("design:type",Function),G("design:paramtypes",[Object,If]),G("design:returntype",void 0)],te.prototype,"setLabelStates",null),nt([(0,l.aU)(tl),G("design:type",Function),G("design:paramtypes",[Object,tl]),G("design:returntype",void 0)],te.prototype,"setLabelScale",null),nt([(0,l.aU)(Ls),G("design:type",Function),G("design:paramtypes",[Object,Ls]),G("design:returntype",void 0)],te.prototype,"addLabel",null),nt([(0,l.aU)(zd),G("design:type",Function),G("design:paramtypes",[Object,zd]),G("design:returntype",void 0)],te.prototype,"addContextLabel",null),nt([(0,l.aU)(kr),G("design:type",Function),G("design:paramtypes",[Object,kr]),G("design:returntype",void 0)],te.prototype,"removeLabel",null),nt([(0,l.aU)(Oo),G("design:type",Function),G("design:paramtypes",[Object,Oo]),G("design:returntype",void 0)],te.prototype,"removeContextLabel",null),nt([(0,l.aU)(Ad),G("design:type",Function),G("design:paramtypes",[Object,Ad]),G("design:returntype",void 0)],te.prototype,"removeAllChapterLabels",null),nt([(0,l.aU)(ns),G("design:type",Function),G("design:paramtypes",[Object,ns]),G("design:returntype",void 0)],te.prototype,"selectLabel",null),nt([(0,l.aU)(Ld),G("design:type",Function),G("design:paramtypes",[Object,Ld]),G("design:returntype",void 0)],te.prototype,"resetLabels",null),nt([(0,l.aU)(zf),G("design:type",Function),G("design:paramtypes",[Object,zf]),G("design:returntype",void 0)],te.prototype,"convertLabels",null),nt([(0,l.aU)(Fd),G("design:type",Function),G("design:paramtypes",[Object,Fd]),G("design:returntype",void 0)],te.prototype,"enableContextLabel",null),nt([(0,l.aU)(To),G("design:type",Function),G("design:paramtypes",[Object,To]),G("design:returntype",void 0)],te.prototype,"setLabelsShown",null),nt([(0,l.aU)(La),G("design:type",Function),G("design:paramtypes",[Object,La]),G("design:returntype",void 0)],te.prototype,"setAllLabelsShown",null),nt([(0,l.aU)(Ud),G("design:type",Function),G("design:paramtypes",[Object,Ud]),G("design:returntype",void 0)],te.prototype,"setLabelsCollapsed",null),nt([(0,l.aU)(Rd),G("design:type",Function),G("design:paramtypes",[Object,Rd]),G("design:returntype",void 0)],te.prototype,"setLabelsDraggable",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getLabels",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getLabelsCollapsed",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getLabelsCollapsedMode",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getSelectedLabelId",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getSelectedLabel",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getContextLabel",null),nt([(0,l.Qf)([_]),G("design:type",Function),G("design:paramtypes",[bi,Ge]),G("design:returntype",void 0)],te,"getChapterLabels",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getEnableContextLabel",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getEnableContextLabelInfo",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getEnableContextLabelActions",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getLabelsDraggable",null),nt([(0,l.Qf)(),G("design:type",Function),G("design:paramtypes",[bi]),G("design:returntype",void 0)],te,"getLabelScale",null),te=Mr=nt([(0,l.ZM)({name:"labels",defaults:eb}),G("design:paramtypes",[l.yh,ol])],te);let tb=(()=>{class t{constructor(e){this.engineService=e}createEngineClippingPlanes(e){return(0,xe.makeClippingPlanes)(e)}setClippingPlanes(e){const{renderer:o,story:s}=this.engineService.engine,{activeChapter:r}=s;if((0,m.isNil)(r))return;const a=this.createEngineClippingPlanes(e);r.clippingPlanes.length=0,r.clippingPlanes.push(...a),o.setClippingPlanes(a)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Zd=1e-4;function sl(t,n){const e={};return Math.abs(t[0]-n)>=Zd&&(e.x=t[0]),Math.abs(t[1]-n)>=Zd&&(e.y=t[1]),Math.abs(t[2]-n)>=Zd&&(e.z=t[2]),e.x||e.y||e.z?e:null}function nb(t,n){if(n[t.objectId])return null;let e={objectId:t.objectId,displayName:t.displayName,layer:t.layer};return t.transformId?e.transformId=t.transformId:e=function ZC(t,n){const e=xe.vec3Pool.get();he.scale(e,t.sceneNode.rotation,180/Math.PI);const o={translate:sl(t.sceneNode.position,0),rotate:sl(e,0),scale:sl(t.sceneNode.scale,1),pivot:sl(t.sceneNode.origin,0)};return xe.vec3Pool.release(e),(0,m.isNull)(o.translate)||(n.translate=o.translate),(0,m.isNull)(o.rotate)||(n.rotate=o.rotate),(0,m.isNull)(o.scale)||(n.scale=o.scale),(0,m.isNull)(o.pivot)||(n.pivot=o.pivot),n.transformId&&(console.error("There should not be a transform"),delete n.transformId),n}(t,e),e=function BC(t,n){const o=(t.renderables??[]).map(s=>{const{geometryId:r,morphId:a,materialId:c,layer:p}=s;return{geometryId:r,morphId:a,materialId:c,layer:p}});return 1===o.length?n={...n,...o[0]}:o.length>1&&(n.renderables=o),n}(t,e),t.children&&t.children.length&&(e.objects=[]),t.children.forEach(o=>{const s=nb(o,n);null!==s&&e.objects.push(s)},this),e}let Bd=(()=>{class t{constructor(e,o,s,r,a,c,p,d){this.store=e,this.engineService=o,this.chapterSerializer=s,this.animationService=r,this.chapterService=a,this.paintService=c,this.clippingPlanesService=p,this.sceneService=d}serializeUI(e){const o={...e.ui};return e.chapters.length>1&&(o.scrubber=!1,o.playPause=!1,o.tour={chapters:!0}),o}serializeAnimation(e){return this.animationService.isChapterAnimated(e)?{play:{startTime:e.timelineMap[0].start,loop:!1!==e.loop,numChapters:1}}:{}}getClippedObjects(){const e=this.store.selectSnapshot(_.getSelectedChapterClippingPlanes),o=this.clippingPlanesService.createEngineClippingPlanes(e);return 0===o.length?{}:this.sceneService.getLeafIds().reduce((s,r)=>{const a=this.sceneService.getObjectById(r);return this.sceneService.isObjectCulledByClip(a,o)&&(s[r]=!0),s},{})}generateTrimObjectMap(e){const o={};if(e.graph.hidden){const r=this.store.selectSnapshot(Se.getAllNodeState);Object.values(r).forEach(a=>{Object.entries(a).forEach(([c,p])=>{!1!==o[c]&&(o[c]=!(p.shown||p.shownSetByTween))})})}const s=e.graph.clipped?this.getClippedObjects():{};return{...o,...s}}trimObjects(e,o){if(o[e.objectId])return null;const s=[];return e.children.forEach(r=>{const a=this.trimObjects(r,o);(0,m.isNil)(a)||s.push(a)}),e.children=s,e}serialize(e,o,s=!1,r,a,c){const p=(0,m.cloneDeep)(r),d=this.generateTrimObjectMap(o),u=this.sceneService.getRootObjects();p.sceneGraph=function VC(t,n){const e=[];return Object.entries(t).forEach(([o,s])=>{const r=nb(s,n);null!==r&&e.push(r)},this),e}(u,d);const g=[];Object.values(u).forEach(ce=>{const ye=this.trimObjects(ce,d);null!==ye&&g.push(ye)},this);const h=Oc(this.paintService.getColorRecipes()),y=od(g,h),k=this.store.selectSnapshot(te.getLabels);p.chapters=a.map(ce=>this.chapterSerializer.serializeChapter(y,ce,e,k,c)),p.ui=this.serializeUI(p),p.animation=this.serializeAnimation(a[0]),p.customData={...p.customData,particleSystems:this.store.selectSnapshot(Fe.getParticleSystemsList)};const B=this.store.selectSnapshot(U.getAllQuestions),K=this.store.selectSnapshot(U.getQuizSettings);K&&B.length>0?p.quizSettings=K:delete p.quizSettings,p.tweenParticleLookup=this.store.selectSnapshot(Fe.getTweenParticleLookup);const V=a.reduce((ce,ye)=>ce.concat(this.chapterService.getChapterLightLibraries(ye)),[]),ge=Array.from(new Set(V));p.assetLibraries.lights.forEach(ce=>{ge.includes(ce)||ge.push(ce)}),p.assetLibraries.lights=ge;const F=this.getReflectionLibraries(p.reflections),R=a.reduce((ce,ye)=>ce.concat(this.chapterService.getChapterReflectionLibraries(ye)),[]);p.assetLibraries.reflections=Array.from(new Set(F.concat(R)));const D=[...Object.values(p.assetLibraries)].flat(),I=this.getSceneGraphStateIds(p.sceneGraph);return p.stateId=Array.from(new Set(D.map(this.getStateId).concat(I))),{story:s?QC(p,e):p}}getReflectionLibraries(e){return e=e||{},Object.values(e).map(s=>{const r=s.split(".");return[r[0],r[1]].join("/")})}getSceneGraphStateIds(e){return e.map(o=>o.objectId.split("-")[0])}getStateId(e){return e.split("/")[0]}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(et),i.LFG(Mf),i.LFG(Un),i.LFG(Pr),i.LFG(wr),i.LFG(tb),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class ib{constructor(){this.graph={hidden:!1,clipped:!1,disabled:!1,transparent:!1}}}var Vd,On=A(3626),ft=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ne=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const ob={loading:!1,incoming:{id:void 0,type:void 0},storyId:void 0,storyType:void 0,storyLang:void 0,loadingChapter:null,loadChapters:[],loadChaptersRemaining:[],thumbnailLookup:[]};let we=Vd=class{constructor(n,e,o,s,r,a){this.store=n,this.storyService=e,this.serializeModuleService=o,this.storageService=s,this.sceneService=r,this.engineService=a,this.reload=se.native}static getStory(n){return n.story}static getStoryId(n){return n.storyId}static getLoadingChapter(n){return n.loadingChapter}static getLoadChapters(n){return n.loadChapters}static getLoadChaptersRemaining(n){return n.loadChaptersRemaining}static getStoryInfo(n){return{id:n.storyId,type:n.storyType}}static getIncomingStoryInfo(n){return n.incoming}static getStoryTags(n){return(0,m.get)(n,"story.tags",[])}static getStoryLanguage(n){return n.storyLang??ui.lang}setStoryText(n,e){const o=n.getState().story;o&&n.patchState({story:{...o,displayName:e.displayName}})}setStoryTags(n,{tags:e}){const o=n.getState().story;o&&n.patchState({story:{...o,tags:e}})}setStoryLightLibs(n,e){const o=n.getState().story;o&&n.patchState({story:{...o,assetLibraries:{...o.assetLibraries,lights:e.lightLibs}}})}setStory(n,e){n.patchState({story:e.story})}SetStoryId(n,e){n.patchState({storyId:e.id})}setIncomingStory(n,e){const o=n.getState(),{id:s,type:r,reset:a}=e;(s!==o.storyId||a)&&n.patchState({incoming:{id:s,type:r}})}unloadStory(n,e){console.log("unload story"),this.engineService.setStory(null)}loadStory(n,e){const o=e.preview?(0,Yc.D)(this.storageService.getDatabaseItem(fa.PreviewStory)):this.storyService.getStory(e.id,e.type,e.lang),s=this.storyService.getStoryLang(e.id,e.type,e.lang);(0,On.D)([o,s]).subscribe(([r,a])=>{n.dispatch(new bc(r,e.id,e.type,a))},()=>{!0===this.reload?(this.reload=!1,this.loadStory(n,e)):n.dispatch(new Bh(e.id,e.type))})}loadStorySuccess(n,e){n.patchState({story:e.story,storyId:e.id,storyLang:e.lang}),n.dispatch(new Np(e.id,e.story,e.type))}buildStoryWorkflow(n,e,o,s,r=0,a=new Map,c=!0){if((0,m.isNil)(this.engineService.engine))return;c&&this.engineService.setStory(o),this.engineService.engine.start();const p=this.storyService.getStoryChapters(e,s,o);let d=[];p.forEach(K=>{d=[...d,...K.labels]});const u=this.storyService.getStoryLoadChapters(o);n.patchState({loadChapters:u,loadChaptersRemaining:u,incoming:{id:void 0,type:void 0}});const g=p.reduce((K,V)=>{const ge=this.sceneService.getChapterSceneGraph(V.id);return K[V.id]=M1(ge,V.showObjects,V.pickThroughObjects,V.synchronization),K},{});n.dispatch(new wd(g)),n.dispatch(new Bc(p[r].id)),n.dispatch(new Pa(p)),n.dispatch(new Jc(a)),n.dispatch(new el(d)),n.dispatch(new gi(p[r]));const h=(0,m.get)(o,"tweenParticleLookup",{}),y=(0,m.get)(o,"customData.particleSystems",[]),k=p.reduce((K,V)=>(K[V.id]=(0,m.get)(V,"customData.particleSystems",[]),K),{});n.dispatch(new be.SetParticleState(y,k,h)),n.dispatch(new ee.ResetQuizState),o.quizSettings&&n.dispatch(new ee.SetQuizSettings(o.quizSettings));const B=mf(p);n.dispatch(new ee.SetQuestions(B)),n.dispatch(new Dp),n.dispatch(new T.SetChapterCallToActionSeen(!1)),n.dispatch(new Up)}importStorySuccess(n,e){const o=n.getState(),s=o.storyType,r=o.storyId,c=new ib,d=this.store.selectSnapshot(Vd.getStory),u=this.store.selectSnapshot(_.getStoryChapters),g=Xc(u,!1),h=this.serializeModuleService.serialize({},c,!1,d,u,g).story,y=IC(h,r,e.story,e.id,se.exportType),k=y.chapters.slice(h.chapters.length).reduce((K,V,ge)=>(K[e.story.chapters[ge].id]=V.id,K),{}),B=e.story.chapters.reduce((K,V)=>{const ge=V.thumbnails?V.thumbnails.large:os.generateLegacyThumbnail(e.id,V.id).large,F=os.makeFreshThumbnail(r,k[V.id],ge);return K.push(F),K},[]);(0,On.D)(B).subscribe(K=>{const V=this.store.selectSnapshot(Wt.getRegisteredThumbnails);K.forEach(ge=>{V.set(ge.chapterId,ge)}),this.buildStoryWorkflow(n,r,y,s,y.chapters.length-1,V)})}buildStory(n,e){const o=os.getChapterThumbnails(e.id,e.story.chapters);this.buildStoryWorkflow(n,e.id,e.story,e.type,e.chapterIdx||0,o,e.replaceActiveStory)}loadChapter(n){const e=n.getState().loadChaptersRemaining[0];!e||(n.patchState({loadingChapter:e}),this.storyService.loadChapter(e).then(()=>{}).catch(o=>{(0,m.isNil)(this.engineService.engine?.story)?console.warn(`Loading of chapter ${e.chapterId} cancelled.`):console.error(o)}).finally(()=>{1===this.engineService.engine?.story?.chapters?.find(s=>s.id===e.chapterId)?.loadProgress&&n.dispatch([new pr(e),new Up])}))}reorderLoadChapters(n,e){const{loadChaptersRemaining:o}=n.getState(),[s,r]=(0,m.partition)(o,a=>a.chapterId===e.chapterId);n.patchState({loadChaptersRemaining:[...s,...r]})}loadChapterSuccess(n,e){const o=n.getState().loadChaptersRemaining.filter(s=>s.chapterId!==e.chapter.chapterId);n.patchState({loadingChapter:null,loadChaptersRemaining:o}),n.dispatch(new jc(e.chapter.chapterId,{model:!0,animation:!1,...e.chapter.readyState})),n.dispatch(new _d(e.chapter.chapterId))}synchronizeChapters(n){const e=this.store.selectSnapshot(_.getStoryChapters),{story:o}=n.getState();n.patchState({story:{...o,chapters:[...e]}})}importStory(n,e){this.storyService.getStory(e.id,e.type,e.lang).subscribe(o=>{n.dispatch(new Ep(o,e.id,e.type))})}resetStory(n){n.setState(ob)}mergeBridgeModuleSuccess(n,{story:e}){const o=n.getState(),s=this.store.selectSnapshot(_.getSelectedChapterIndex),r=os.getChapterThumbnails(o.storyId,e.chapters);this.buildStoryWorkflow(n,o.storyId,e,Xe.Module,s,r)}};we.\u0275fac=function(n){return new(n||we)(i.LFG(l.yh),i.LFG(Us),i.LFG(Bd),i.LFG(dn),i.LFG(Ut),i.LFG(et))},we.\u0275prov=i.Yz7({token:we,factory:we.\u0275fac}),ft([(0,l.aU)(jh),ne("design:type",Function),ne("design:paramtypes",[Object,jh]),ne("design:returntype",void 0)],we.prototype,"setStoryText",null),ft([(0,l.aU)(Qh),ne("design:type",Function),ne("design:paramtypes",[Object,Qh]),ne("design:returntype",void 0)],we.prototype,"setStoryTags",null),ft([(0,l.aU)(Zh),ne("design:type",Function),ne("design:paramtypes",[Object,Zh]),ne("design:returntype",void 0)],we.prototype,"setStoryLightLibs",null),ft([(0,l.aU)(Eh),ne("design:type",Function),ne("design:paramtypes",[Object,Eh]),ne("design:returntype",void 0)],we.prototype,"setStory",null),ft([(0,l.aU)(Dh),ne("design:type",Function),ne("design:paramtypes",[Object,Dh]),ne("design:returntype",void 0)],we.prototype,"SetStoryId",null),ft([(0,l.aU)(fc),ne("design:type",Function),ne("design:paramtypes",[Object,fc]),ne("design:returntype",void 0)],we.prototype,"setIncomingStory",null),ft([(0,l.aU)(Fp),ne("design:type",Function),ne("design:paramtypes",[Object,Fp]),ne("design:returntype",void 0)],we.prototype,"unloadStory",null),ft([(0,l.aU)(mc),ne("design:type",Function),ne("design:paramtypes",[Object,mc]),ne("design:returntype",void 0)],we.prototype,"loadStory",null),ft([(0,l.aU)(bc),ne("design:type",Function),ne("design:paramtypes",[Object,bc]),ne("design:returntype",void 0)],we.prototype,"loadStorySuccess",null),ft([(0,l.aU)(Ep),ne("design:type",Function),ne("design:paramtypes",[Object,Ep]),ne("design:returntype",void 0)],we.prototype,"importStorySuccess",null),ft([(0,l.aU)(Np),ne("design:type",Function),ne("design:paramtypes",[Object,Np]),ne("design:returntype",void 0)],we.prototype,"buildStory",null),ft([(0,l.aU)(Up),ne("design:type",Function),ne("design:paramtypes",[Object]),ne("design:returntype",void 0)],we.prototype,"loadChapter",null),ft([(0,l.aU)(Rp),ne("design:type",Function),ne("design:paramtypes",[Object,Rp]),ne("design:returntype",void 0)],we.prototype,"reorderLoadChapters",null),ft([(0,l.aU)(pr),ne("design:type",Function),ne("design:paramtypes",[Object,pr]),ne("design:returntype",void 0)],we.prototype,"loadChapterSuccess",null),ft([(0,l.aU)(D0),ne("design:type",Function),ne("design:paramtypes",[Object]),ne("design:returntype",void 0)],we.prototype,"synchronizeChapters",null),ft([(0,l.aU)(Vh),ne("design:type",Function),ne("design:paramtypes",[Object,Vh]),ne("design:returntype",void 0)],we.prototype,"importStory",null),ft([(0,l.aU)(qh),ne("design:type",Function),ne("design:paramtypes",[Object]),ne("design:returntype",void 0)],we.prototype,"resetStory",null),ft([(0,l.aU)(j0),ne("design:type",Function),ne("design:paramtypes",[Object,Object]),ne("design:returntype",void 0)],we.prototype,"mergeBridgeModuleSuccess",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getStory",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getStoryId",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getLoadingChapter",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getLoadChapters",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getLoadChaptersRemaining",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getStoryInfo",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getIncomingStoryInfo",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getStoryTags",null),ft([(0,l.Qf)(),ne("design:type",Function),ne("design:paramtypes",[zo]),ne("design:returntype",void 0)],we,"getStoryLanguage",null),we=Vd=ft([(0,l.ZM)({name:"story",defaults:ob}),ne("design:paramtypes",[l.yh,Us,Bd,dn,Ut,et])],we);var bt=A(3663),yt=A(6562),Ui=(()=>(function(t){t[t.Content=0]="Content",t[t.Label=1]="Label",t[t.Tools=2]="Tools",t[t.Search=3]="Search",t[t.Help=4]="Help",t[t.NodeInfo=5]="NodeInfo",t[t.LabelInfo=6]="LabelInfo"}(Ui||(Ui={})),Ui))();const sb=["ui-bd.class","ui-play-pause","ui-camera-mode","ui-center","ui-cross-section","ui-dissect","ui-fs","ui-tools-display","ui-tree","ui-zoom","ui-zoom-in","ui-zoom-out","ui-pan","ui-share","ui-keys","ui-slider","o","background.color-stops","background.gradient-type","dd","dn","image-display","imageDisplay","imageSrc","pre","referrer"];function qd(t){const{id:n,s:e,m:o,be:s,b:r}=t;let a="";if(n)a=n;else if(s)a=s;else if(r){const c=parseInt(r,10);a=Number.isNaN(c)?"":function GC(t){const e=(a,c)=>[Math.floor(a/c),a%c],o=[];let r,s=t;for(;s>0;)[s,r]=e(s,62),o.unshift("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[r]);return o.join("")}(c)}else o&&(a=function JC(t,n="male"){return t.includes("/")?t:`production/${n}Adult/${t}`}(o,"female"===e?"female":"male"));return a.replace(/\.json$/,"")}function rb(t){return qd(t).includes("/")?"module":"bookmark"}const ab={type:t=>rb(t),id:t=>qd(t),background:t=>t.bgstd||t["background.colors"]||t.background};function $d(t){if(3===t.length){const{0:n,1:e,2:o}=t;return{x:n,y:e,z:o}}return null}const XC={camera:function WC(t){const n=t.split(",").map(o=>parseFloat(o));if(n.length%3!=0||n.some(o=>Number.isNaN(o)))return null;{const o=n.slice(0,3),s=n.slice(3,6),r=n.slice(6,9);return{eye:$d(o),look:$d(s),up:$d(r)}}},background:function KC(t){const n=wo.getColors(t);return n?{colors:[...n[0][255],...n[1][255]],gradientType:"radial",colorStops:[0,100]}:null}};function ew(t){const n=e=>{if(e){const o=e.toLowerCase();if("true"===o)return!0;if("false"===o)return!1;if(!isNaN(Number(o)))return Number(o)}return e};return Object.keys(t).reduce((e,o)=>{const r=(XC[o]||n)(t[o]);return"load-rotate"===o&&isNaN(Number(r))||(e[o]=r),e},{})}let nw=(()=>{class t{constructor(e){this.store=e}chapterHasTransition(e,o){const r=(0,m.get)(e,o?"transitions.pre":"transitions.post");return!!r&&(o?r.onPrevious:r.onNext)}searchChapterTransitions(e,o,s){let r=[...s],a=r.findIndex(u=>u.id===e),c=r.findIndex(u=>u.id===o);const p=c<a;if(p&&(r=r.reverse(),a=r.findIndex(u=>u.id===e),c=r.findIndex(u=>u.id===o)),a<0||c<0||a===c)return null;const d=r.slice(a,c).find(u=>this.chapterHasTransition(u,p));return d?p?d.transitions.pre:d.transitions.post:null}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Ua;!function(t){t.SetBreakpoint=(()=>{class e{constructor(s){this.breakpoint=s}}return e.type="[View] Set Breakpoint",e})()}(Ua||(Ua={}));var _t=(()=>(function(t){t[t.XSmall=0]="XSmall",t[t.Small=1]="Small",t[t.Medium=2]="Medium",t[t.Large=3]="Large",t[t.XLarge=4]="XLarge"}(_t||(_t={})),_t))(),cb=A(2289),$n=A(7211),rl=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},to=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};class lb{}let Pt=class{constructor(n,e){this.breakpointObserver=n,this.store=e}static getBreakpoint(n){return n.breakpoint}static getBreakpointLabel(n){return["(max-width: 374px)","(max-width: 599px)","(max-width: 959px)","(max-width: 1439px)","(min-width: 1440px)"][n.breakpoint]}setBreakpoint(n,e){n.patchState({breakpoint:e.breakpoint})}ngxsOnInit(n){const e=this.breakpointObserver.observe(["(max-width: 374px)"]),o=this.breakpointObserver.observe(["(max-width: 599px)"]),s=this.breakpointObserver.observe(["(max-width: 959px)"]),r=this.breakpointObserver.observe(["(max-width: 1439px)"]),a=this.breakpointObserver.observe(["(min-width: 1440px)"]);(0,bt.a)(e,o,s,r,a).pipe((0,J.U)(([c,p,d,u,g])=>c.matches?_t.XSmall:p.matches?_t.Small:d.matches?_t.Medium:u.matches?_t.Large:g.matches?_t.XLarge:null),(0,$n.x)(),(0,$.h)(c=>null!=c)).subscribe(c=>{n.dispatch(new Ua.SetBreakpoint(c))})}};Pt.\u0275fac=function(n){return new(n||Pt)(i.LFG(cb.Yg),i.LFG(l.yh))},Pt.\u0275prov=i.Yz7({token:Pt,factory:Pt.\u0275fac}),rl([(0,l.aU)(Ua.SetBreakpoint),to("design:type",Function),to("design:paramtypes",[Object,Ua.SetBreakpoint]),to("design:returntype",void 0)],Pt.prototype,"setBreakpoint",null),rl([(0,l.Qf)(),to("design:type",Function),to("design:paramtypes",[lb]),to("design:returntype",void 0)],Pt,"getBreakpoint",null),rl([(0,l.Qf)(),to("design:type",Function),to("design:paramtypes",[lb]),to("design:returntype",void 0)],Pt,"getBreakpointLabel",null),Pt=rl([(0,l.ZM)({name:"breakpoint",defaults:{breakpoint:null}}),to("design:paramtypes",[cb.Yg,l.yh])],Pt);var x=(()=>(function(t){t.AnatomyLabels="anatomyLabels",t.Audio="audio",t.Camera="camera",t.Column="column",t.ColumnToggle="column-toggle",t.ContextActions="contextActions",t.Description="description",t.Drawer="drawer",t.Fullscreen="fullscreen",t.Help="help",t.InternetExplorerWarning="internetExplorerWarning",t.LabelList="labelList",t.Labels="labels",t.Layout="layout",t.Legend="legend",t.Loader="loader",t.Logo="logo",t.Media="media",t.Mediabar="mediabar",t.Menu="menu",t.NodeInfo="nodeInfo",t.Pagination="pagination",t.PocToolbar="pocToolbar",t.Presenter="presenter",t.Reset="reset",t.Search="search",t.ScrubberButton="scrubberButton",t.ScrubberItem="scrubberItem",t.TitleOnly="title-only",t.ToggleLabels="toggleLabels",t.Toolbar="toolbar",t.Tools="tools",t.Tutorial="tutorial",t.Undo="undo",t.VisibilityLayers="visibilityLayers",t.Whiteboard="whiteboard"}(x||(x={})),x))(),Tn=(()=>(function(t){t.Drawer="drawer",t.Column="column"}(Tn||(Tn={})),Tn))();let Gd=(()=>{class t{constructor(e,o){this.storyLoadProgress=e,this.chapterLoadProgress=o}}return t.type="[Engine Progress] Set Progress",t})(),al=(()=>{class t{constructor(){}}return t.type="[Engine Progress] Reset Progress",t})();var Ra=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},si=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const pb={storyLoadProgress:0,chapterLoadProgress:0};let yn=class{constructor(){}static getStoryLoadProgress(n){return n.storyLoadProgress}static getChapterLoadProgress(n){return n.chapterLoadProgress}setProgress(n,e){n.patchState({storyLoadProgress:e.storyLoadProgress,chapterLoadProgress:e.chapterLoadProgress})}resetProgress(n,e){n.setState({...pb})}};yn.\u0275fac=function(n){return new(n||yn)},yn.\u0275prov=i.Yz7({token:yn,factory:yn.\u0275fac}),Ra([(0,l.aU)(Gd),si("design:type",Function),si("design:paramtypes",[Object,Gd]),si("design:returntype",void 0)],yn.prototype,"setProgress",null),Ra([(0,l.aU)(al),si("design:type",Function),si("design:paramtypes",[Object,al]),si("design:returntype",void 0)],yn.prototype,"resetProgress",null),Ra([(0,l.Qf)(),si("design:type",Function),si("design:paramtypes",[Object]),si("design:returntype",void 0)],yn,"getStoryLoadProgress",null),Ra([(0,l.Qf)(),si("design:type",Function),si("design:paramtypes",[Object]),si("design:returntype",void 0)],yn,"getChapterLoadProgress",null),yn=Ra([(0,l.ZM)({name:"engineProgress",defaults:pb}),si("design:paramtypes",[])],yn);let ri=(()=>{class t{constructor(e,o){this.store=e,this.chapterService=o,this.ui=null,this.breakpoint=null}getBase(){return{ui:this.store.selectSnapshot(O.getUI),layout:this.store.selectSnapshot(O.getLayout),breakpoint:this.store.selectSnapshot(Pt.getBreakpoint),hideUI:this.isUIHidden()}}isUIHidden(){const e=this.store.selectSnapshot(O.getOpenWindow),o=this.store.selectSnapshot(_.getSelectedChapterIndex),s=this.store.selectSnapshot(O.getUI),r=e===pt.Loader&&o<=0&&s.loader.template===Ai.Circle,a=this.store.selectSnapshot(yn.getStoryLoadProgress);return r||0===a||e===pt.OnDemand||e===pt.Interact||e===pt.Tutorial||e===pt.Whiteboard}isDrawerVisible(){const{hideUI:e,ui:o,layout:s}=this.getBase();return!e&&this.getViewLayout(s)===Tn.Drawer&&(o.drawer.enable&&"none"!==this.getVisibleContent()||o.nodeInfo.status===Pe.Show||o.labelInfo.status===Pe.Show)}isColumnVisible(){const{hideUI:e,layout:o,ui:s}=this.getBase();return!e&&s.column.status!==Pe.Collapse&&this.getViewLayout(o)===Tn.Column&&s.column.enable&&"full"===this.getVisibleContent()}isColumnToggleVisible(){const{hideUI:e,layout:o,ui:s}=this.getBase();return!e&&!this.store.selectSnapshot(U.getQuizModeActive)&&this.getViewLayout(o)===Tn.Column&&s.column.enable&&"full"===this.getVisibleContent()}isTitleOnlyVisible(){const{hideUI:e,ui:o,layout:s,breakpoint:r}=this.getBase();return!(e||this.getViewLayout(s)===Tn.Drawer||r<_t.Large)&&o.titleOnly.enable&&"titleOnly"===this.getVisibleContent()}isToolsVisible(){const{hideUI:e}=this.getBase();return!e&&this.isUIVisible(x.Tools)}isPocToolbarVisible(){const{hideUI:e}=this.getBase();return!e&&this.isUIVisible(x.PocToolbar)}isToolbarVisible(){const{hideUI:e,ui:o}=this.getBase();return!e&&o.toolbar.enable}isLogoVisible(){const{ui:e}=this.getBase();return this.store.selectSnapshot(O.getOpenWindow)!==pt.OnDemand&&e.logo.enable}isCameraVisible(){const{hideUI:e,ui:o}=this.getBase();return!e&&o.camera.enable}isPaginationVisible(){const{hideUI:e,ui:o}=this.getBase();return!(e||this.store.selectSnapshot(_.getChapterCount)<=1)&&o.pagination.enable}isMediaVisible(){const{hideUI:e,ui:o}=this.getBase();return!e&&(this.store.selectSnapshot(_.getIsChapterAnimated)&&o.media.enable)}isMediabarVisible(){const{hideUI:e}=this.getBase();return!e&&this.isMediaVisible()}isScrubberVisible(e){const{hideUI:o,ui:s,breakpoint:r}=this.getBase();if(o)return!1;const a=this.isMediaVisible&&s.media.template===qn.Full;switch(e){case x.ScrubberButton:return a&&r>_t.Small;case x.ScrubberItem:return a&&r<=_t.Small}}isMenuVisible(){const{hideUI:e,ui:o}=this.getBase();return!e&&(o.fullscreen.enable||o.help.enable||o.search.enable||o.tools.enable||o.whiteboard.enable||o.tutorial.enable)&&o.menu.enable}isNodeInfoColumnVisible(){const{hideUI:e,ui:o,breakpoint:s}=this.getBase();return!e&&(!!(s>=_t.Large&&this.isUIVisible(x.NodeInfo))||(s<_t.Large?!o.drawer.enable&&this.isUIVisible(x.NodeInfo):void 0))}isNodeInfoVisible(e){const{hideUI:o,breakpoint:r}=this.getBase();return!o&&(r>=_t.Large&&e===Tn.Column||r<_t.Large&&e===Tn.Drawer)&&this.isUIVisible(x.NodeInfo)}getAudioPlaybackType(){const{hideUI:e,ui:o}=this.getBase(),s=this.store.selectSnapshot(_.getSelectedChapter),r=this.store.selectSnapshot(U.getQuizModeActive),a=s?.ui?.config?.audio??Nn.File;if(e||r||!o.audio.enable||a===Nn.None)return Nn.None;const u=this.store.selectSnapshot(_.getSelectedChapterAudio),g=!(0,m.isNil)(u);if(a===Nn.File&&g)return Nn.File;const y=(0,m.trim)(s?.description??"").length>0;return a===Nn.TTS&&y?Nn.TTS:Nn.None}isAudioVisible(){return this.getAudioPlaybackType()!==Nn.None}isSearchColumnVisible(){const{hideUI:e}=this.getBase();return!e&&this.isUIVisible(x.Search)}isUndoVisible(){const{hideUI:e,ui:s}=this.getBase();return!e&&s.undo.enable}isVisibilityLayersVisible(){const{hideUI:e,ui:o}=this.getBase();if(e)return!1;const s=o.visibilityLayers.enable,r=this.store.selectSnapshot(_.getSelectedChapterCurrentLayers);return s&&this.chapterService.hasVisibilityLayers(r)}isVisible(e){switch(e){case x.Audio:return this.isAudioVisible();case x.Camera:return this.isCameraVisible();case x.Column:return this.isColumnVisible();case x.ColumnToggle:return this.isColumnToggleVisible();case x.Drawer:return this.isDrawerVisible();case x.Logo:return this.isLogoVisible();case x.Media:return this.isMediaVisible();case x.Mediabar:return this.isMediabarVisible();case x.Menu:return this.isMenuVisible();case x.Pagination:return this.isPaginationVisible();case x.Search:return this.isSearchColumnVisible();case x.ScrubberButton:return this.isScrubberVisible(x.ScrubberButton);case x.ScrubberItem:return this.isScrubberVisible(x.ScrubberItem);case x.TitleOnly:return this.isTitleOnlyVisible();case x.Tools:return this.isToolsVisible();case x.PocToolbar:return this.isPocToolbarVisible();case x.Toolbar:return this.isToolbarVisible();case x.Undo:return this.isUndoVisible();case x.VisibilityLayers:return this.isVisibilityLayersVisible();default:return this.isUIVisible(e)}}isUIVisible(e){const{hideUI:o,ui:s}=this.getBase();return s[e]?!o&&s[e].enable&&s[e].status!==Pe.Hide:(console.warn("Attempting to check visibility of a non-existent element: ${element}"),!1)}isUIEnabled(e){const{ui:o}=this.getBase();return o[e].enable}getVisibleContent(){const{ui:e}=this.getBase(),o=this.store.selectSnapshot(te.getChapterLabels),s=this.store.selectSnapshot(_.getSelectedChapter),r=s?.description,a=s?.displayName,c=(0,m.get)(s,"legend",[]),p=(0,m.get)(s,"contentBlocks",[]).length,d=e.labelList.enable&&o.length>0,u=null!=r&&(0,m.trim)(r).length>0,g=null!=a&&(0,m.trim)(a).length>0,h=e.legend.enable&&c.length>0,y=this.store.selectSnapshot(U.getQuizModeActive);return d||u||h||y||p?"full":g?"titleOnly":"none"}getViewLayout(e){const{width:o,height:s}=document.body.getBoundingClientRect(),r=o/s>=1?"landscape":"portrait",{breakpoint:a}=this.getBase(),p=384+(se.application===mt.Viewer?0:56);switch(e){case Or.ColumnOnly:return Tn.Column;case Or.DrawerOnly:return Tn.Drawer;default:return"portrait"===r?Tn.Drawer:a>=_t.Large||s<=p&&o>=708?Tn.Column:Tn.Drawer}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(Pr))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),db=(()=>{class t{constructor(e,o){this.query=e,this.lang=o}}return t.type="[Bookmarks] Load",t})(),ub=(()=>{class t{constructor(e,o,s){this.organizationId=e,this.query=o,this.lang=s}}return t.type="[Bookmarks] Load Organization Bookmarks",t})(),gb=(()=>{class t{constructor(e,o,s,r){this.organizationId=e,this.collectionId=o,this.query=s,this.lang=r}}return t.type="[Bookmarks] Load Collection Bookmarks",t})(),Jd=(()=>{class t{constructor(e,o,s=!1){this.id=e,this.type=o,this.preview=s}}return t.type="[Bookmarks] Select Bookmark",t})(),Hd=(()=>{class t{constructor(e){this.bookmark=e}}return t.type="[Bookmarks] Select Bookmark Success",t})(),Na=(()=>{class t{constructor(e){this.result=e}}return t.type="[Bookmarks] Load Success",t})(),hb=(()=>{class t{constructor(e){this.bookmarkId=e}}return t.type="[Bookmarks] Delete Bookmark",t})(),Yd=(()=>{class t{constructor(e){this.bookmarkId=e}}return t.type="[Bookmarks] Bookmark Delete Success",t})(),iw=(()=>{class t{constructor(e,o){this.bookmarkId=e,this.message=o}}return t.type="[Bookmarks] Bookmark Delete Fail",t})(),mb=(()=>{class t{constructor(e){this.bookmarkIds=e}}return t.type="[Bookmarks] BulkDelete Bookmark",t})(),Wd=(()=>{class t{constructor(e){this.bookmarkIds=e}}return t.type="[Bookmarks] Bookmark BulkDelete Success",t})(),ow=(()=>{class t{constructor(e,o){this.bookmarkIds=e,this.message=o}}return t.type="[Bookmarks] Bookmark BulkDelete Fail",t})(),fb=(()=>{class t{constructor(e,o,s=!0){this.bookmarkEntry=e,this.inplace=o,this.includeIndex=s}}return t.type="[Bookmarks] Save Bookmark",t})(),cl=(()=>{class t{constructor(e,o,s){this.bookmark=e,this.story=o,this.method=s}}return t.type="[Bookmarks] Bookmark Saved",t})(),Kd=(()=>{class t{constructor(e,o){this.bookmarkEntry=e,this.error=o}}return t.type="[Bookmarks] Bookmark Save Failed",t})(),bb=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Cancel Save Bookmark",t})(),Xd=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Reset",t})(),yb=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Clear Bookmarks",t})(),_b=(()=>{class t{constructor(e){this.sort=e}}return t.type="[Bookmarks] Sort",t})(),xb=(()=>{class t{constructor(e,o){this.id=e,this.checked=o}}return t.type="[Bookmarks] Check Bookmark",t})(),vb=(()=>{class t{constructor(e){this.ids=e}}return t.type="[Bookmarks] Set Checked Bookmarks",t})(),Cb=(()=>{class t{constructor(e,o,s,r,a,c,p,d,u){this.bookmarks=e,this.organizationId=o,this.collections=s,this.widgetURL=r,this.userLanguage=a,this.userApp=c,this.widgetOptions=p,this.offlineEnabled=d,this.productAccountId=u}}return t.type="[Bookmarks] Export Bookmarks",t})(),sw=(()=>{class t{constructor(e){this.bookmarks=e}}return t.type="[Bookmarks] Export Bookmarks Success",t})(),rw=(()=>{class t{constructor(e){this.bookmarks=e}}return t.type="[Bookmarks] Export Bookmarks Error",t})(),eu=(()=>{class t{constructor(e,o=[],s=new Map){this.bookmark=e,this.addCollections=o,this.removeCollections=s}}return t.type="[Bookmarks] Update Bookmark Collections",t})(),wb=(()=>{class t{constructor(e,o,s){this.bookmark=e,this.addCollections=o,this.removeCollections=s}}return t.type="[Bookmarks] Update Bookmark Collections Success",t})(),Sb=(()=>{class t{constructor(e,o,s){this.bookmark=e,this.addCollections=o,this.removeCollections=s}}return t.type="[Bookmarks] Update Bookmark Collections Error",t})(),aw=(()=>{class t{constructor(e,o){this.bookmark=e,this.collections=o}}return t.type="[Bookmarks] Add Bookmark Collections Success",t})(),cw=(()=>{class t{constructor(e,o){this.bookmark=e,this.collections=o}}return t.type="[Bookmarks] Add Bookmark Collections Error",t})(),tu=(()=>{class t{constructor(e,o){this.bookmark=e,this.collections=o}}return t.type="[Bookmarks] Remove Bookmark Collections Success",t})(),lw=(()=>{class t{constructor(e,o){this.bookmark=e,this.collections=o}}return t.type="[Bookmarks] Remove Bookmark Collections Error",t})(),Pb=(()=>{class t{constructor(e,o,s,r=ui.lang,a,c){this.id=e,this.title=o,this.type=s,this.lang=r,this.groupAccess=a,this.collections=c}}return t.type="[Bookmarks] Copy Bookmark",t})(),pw=(()=>{class t{constructor(e){this.newBookmark=e}}return t.type="[Bookmarks] Copy Bookmark Success",t})(),dw=(()=>{class t{constructor(e,o){this.id=e,this.error=o}}return t.type="[Bookmarks] Copy Bookmark Failure",t})(),kb=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Cancel Copy Bookmark",t})(),Ob=(()=>{class t{constructor(e){this.title=e}}return t.type="[Bookmarks] Set Bookmark Text",t})(),Tb=(()=>{class t{constructor(e){this.viewMode=e}}return t.type="[Bookmarks] Set Bookmark View Mode",t})(),Mb=(()=>{class t{constructor(e){this.category=e}}return t.type="[Bookmarks] Set Selected Category",t})();const it=jf.ui;class Ir{}const ot=(t,n)=>(0,m.isNil)(t)?n:t;function xt(...t){return!!t.some(n=>!0===n)||!t.some(n=>!1===n)&&void 0}function nu(t,n,e){return Object.values(qn).indexOf(e)>=0?e:!1===t?qn.None:null!=n?n?qn.Full:qn.Small:null}function iu(t){return Object.values(Ai).includes(t)?t:null}function Ib(t){const n=null!=t["ui-all"]?zb(t["ui-all"]):new Ir;return zr({[x.Layout]:t["ui-layout"],[x.Loader]:iu(t["ui-loader"]),[x.NodeInfo]:t["ui-anatomy-descriptions"],[x.Tools]:t["ui-tools"],[x.PocToolbar]:t["ui-poc"],[x.Toolbar]:t["ui-toolbar"],[x.Media]:nu(null,xt(t["ui-scrubber"],t["ui-scrubber.chapters"],t["ui-scrubber.tour"]),t["ui-media-controls"]),[x.Audio]:t["ui-audio"],[x.Fullscreen]:t["ui-fullscreen"],[x.Help]:t["ui-help"],[x.Camera]:t["ui-nav"],[x.Presenter]:t["ui-presenter"],[x.Menu]:t["ui-menu"],[x.Pagination]:t["ui-tour"],[x.Search]:xt(t["ui-search"],t["ui-object-tree"]),[x.Column]:xt(t["ui-info"],t["ui-panel"]),[x.Drawer]:xt(t["ui-info"],t["ui-panel"]),[x.Description]:xt(t["ui-info"]),[x.TitleOnly]:xt(t["ui-info"]),[x.Logo]:xt(t["ui-bd"],t["ui-logo"]),logoIsHyperLink:xt(t["ui-bd.link"],t["ui-logo.islink"]),[x.Labels]:t["ui-labels"],[x.LabelList]:t["ui-label-list"],[x.InternetExplorerWarning]:t["ie-warning"],all:t["ui-all"],drawerExpanded:t["ui-info-expand"],[x.AnatomyLabels]:xt(t["ui-anatomy-labels"]),[x.Tutorial]:xt(t["ui-tutorial"]),[x.Legend]:xt(t["ui-legend"]),[x.Undo]:xt(t["ui-undo"],t["ui-reset"]),[x.Whiteboard]:xt(t["ui-whiteboard"]),[x.VisibilityLayers]:xt(t["ui-visibility-layers"],t["ui-layers"]),[x.ContextActions]:xt(t["ui-context-actions"]),[x.ToggleLabels]:void 0},n)}function zb(t){return{[x.Loader]:t?Nd:Ai.None,[x.Column]:t,[x.Drawer]:t,[x.Tools]:t,[x.PocToolbar]:!1,[x.Toolbar]:t,[x.Fullscreen]:t,[x.Help]:t,[x.Camera]:t,[x.Search]:t,[x.Presenter]:t,[x.Menu]:t,[x.Audio]:t,[x.Pagination]:t,[x.NodeInfo]:t,[x.Labels]:null,[x.LabelList]:t,[x.Media]:null,[x.TitleOnly]:t,[x.Undo]:t,all:t,drawerExpanded:null,logoIsHyperLink:null,[x.AnatomyLabels]:null,[x.Logo]:!0,[x.Tutorial]:null,[x.InternetExplorerWarning]:!0,[x.Legend]:!0,[x.Whiteboard]:t,[x.VisibilityLayers]:t,[x.ContextActions]:t,[x.ToggleLabels]:!0}}function zr(t,n,e=!1){return null==n?t:(0,m.uniq)([...Object.keys(t),...Object.keys(n)]).reduce((s,r)=>(s[r]=null==t[r]||e&&null!=n[r]?n[r]:t[r],s),new Ir)}function Ab(t,n){const e=JSON.parse(JSON.stringify(t));return e.loader.enable=ot(n[x.Loader]!==Ai.None,it.loader.enable),null!=n[x.Loader]&&(e.loader.template=n[x.Loader]),e.nodeInfo.enable=ot(n[x.NodeInfo],it.nodeInfo.enable),e.pagination.enable=ot(n[x.Pagination],it.pagination.enable),e.drawer.isExpanded=ot(n.drawerExpanded,it.drawer.isExpanded),e.tools.enable=ot(n[x.Tools],it.tools.enable),e.pocToolbar.enable=ot(n[x.PocToolbar],it.pocToolbar.enable),e.toolbar.enable=ot(n[x.Toolbar],it.toolbar.enable),e.media.enable=ot(n[x.Media]!==qn.None,it.media.enable),e.media.template=n[x.Media],e.fullscreen.enable=ot(n[x.Fullscreen],it.fullscreen.enable),e.help.enable=ot(n[x.Help],it.help.enable),e.description.enable=ot(n[x.Description],it.description.enable),e.titleOnly.enable=ot(n[x.TitleOnly],it.titleOnly.enable),e.camera.enable=ot(n[x.Camera],it.camera.enable),e.search.enable=ot(n[x.Search],it.search.enable),e.presenter.enable=ot(n[x.Presenter],it.presenter.enable),e.menu.enable=ot(n[x.Menu],it.menu.enable),e.logo.enable=ot(n[x.Logo],it.logo.enable),e.logo.isHyperLink=ot(n.logoIsHyperLink,it.logo.isHyperLink),e.internetExplorerWarning.enable=ot(n.internetExplorerWarning,it.internetExplorerWarning.enable),e.undo.enable=ot(n[x.Undo],it.undo.enable),e.labels.enable=ot(n[x.Labels],it.labels.enable),e.labelList.enable=ot(n[x.LabelList],it.labelList.enable),e.audio.enable=ot(n[x.Audio],it.audio.enable),e.reset.enable=ot(n[x.Reset],it.reset.enable),e.column.enable=ot(n[x.Column],it.column.enable),e.drawer.enable=ot(n[x.Drawer],it.drawer.enable),e.anatomyLabels.enable=ot(n[x.AnatomyLabels],it.anatomyLabels.enable),e.tutorial.enable=ot(n[x.Tutorial],it.tutorial.enable),e.whiteboard.enable=ot(n[x.Whiteboard],it.whiteboard.enable),e.visibilityLayers.enable=ot(n[x.VisibilityLayers],it.visibilityLayers.enable),e.contextActions.enable=ot(n[x.ContextActions],it.contextActions.enable),e.toggleLabels.enable=ot(n[x.ToggleLabels],it.toggleLabels.enable),e}var Mn,He=A(5412);!function(t){t.SetTheme=(()=>{class c{constructor(d){this.theme=d}}return c.type="[Layout] Set Theme",c})(),t.SetSidenav=(()=>{class c{constructor(d){this.sidenav=d}}return c.type="[Layout] Set Sidenav",c})(),t.ToggleSidenav=(()=>{class c{constructor(d){this.open=d}}return c.type="[Layout] Toggle Sidenav",c})(),t.SetHeader=(()=>{class c{constructor(d){this.siteHeaderType=d}}return c.type="[Layout] Set Header",c})(),t.SetFooter=(()=>{class c{constructor(d){this.siteFooterType=d}}return c.type="[Layout] Set Footer",c})(),t.ResetLayout=(()=>{class c{constructor(){}}return c.type="[Layout] Reset",c})()}(Mn||(Mn={}));class ll{}var pl=(()=>(function(t){t.Light="theme-light",t.Dark="theme-dark"}(pl||(pl={})),pl))(),Rs=(()=>(function(t){t[t.Application=0]="Application",t[t.Search=1]="Search",t[t.View=2]="View",t[t.Hide=3]="Hide",t[t.Share=4]="Share"}(Rs||(Rs={})),Rs))(),dl=(()=>(function(t){t[t.Mobile=0]="Mobile",t[t.None=1]="None"}(dl||(dl={})),dl))(),Ri=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},dt=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Lb={theme:pl.Light,sidenav:{enabled:!0,open:!1},siteHeader:Rs.Application,siteFooter:dl.None};let Et=class{static getTheme(n){return n.theme}static getSidenav(n){return n.sidenav}static getSiteHeader(n){return n.siteHeader}static getSiteFooter(n){return n.siteFooter}setTheme({patchState:n},{theme:e}){n({theme:e})}setHeader(n,e){n.patchState({siteHeader:e.siteHeaderType})}setFooter(n,e){n.patchState({siteFooter:e.siteFooterType})}setSidenav(n,e){n.patchState({sidenav:{...e.sidenav}})}toggleSidenav(n,e){const o=n.getState().sidenav;n.patchState({sidenav:{...o,open:e.open}})}resetLayout(n,e){n.setState(Lb)}};function ou(t,n=!0){return.01*(window.innerHeight-(n&&t!==Rs.Hide?56:0))}Et.\u0275fac=function(n){return new(n||Et)},Et.\u0275prov=i.Yz7({token:Et,factory:Et.\u0275fac}),Ri([(0,l.aU)(Mn.SetTheme),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.SetTheme]),dt("design:returntype",void 0)],Et.prototype,"setTheme",null),Ri([(0,l.aU)(Mn.SetHeader),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.SetHeader]),dt("design:returntype",void 0)],Et.prototype,"setHeader",null),Ri([(0,l.aU)(Mn.SetFooter),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.SetFooter]),dt("design:returntype",void 0)],Et.prototype,"setFooter",null),Ri([(0,l.aU)(Mn.SetSidenav),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.SetSidenav]),dt("design:returntype",void 0)],Et.prototype,"setSidenav",null),Ri([(0,l.aU)(Mn.ToggleSidenav),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.ToggleSidenav]),dt("design:returntype",void 0)],Et.prototype,"toggleSidenav",null),Ri([(0,l.aU)(Mn.ResetLayout),dt("design:type",Function),dt("design:paramtypes",[Object,Mn.ResetLayout]),dt("design:returntype",void 0)],Et.prototype,"resetLayout",null),Ri([(0,l.Qf)(),dt("design:type",Function),dt("design:paramtypes",[ll]),dt("design:returntype",void 0)],Et,"getTheme",null),Ri([(0,l.Qf)(),dt("design:type",Function),dt("design:paramtypes",[ll]),dt("design:returntype",void 0)],Et,"getSidenav",null),Ri([(0,l.Qf)(),dt("design:type",Function),dt("design:paramtypes",[ll]),dt("design:returntype",void 0)],Et,"getSiteHeader",null),Ri([(0,l.Qf)(),dt("design:type",Function),dt("design:paramtypes",[ll]),dt("design:returntype",void 0)],Et,"getSiteFooter",null),Et=Ri([(0,l.ZM)({name:"layout",defaults:Lb})],Et);var f=A(6895);let lt=(()=>{class t{constructor(){}get iconClass(){let e=`fas fa-${this.icon}`;return this.size&&(e+=` fa-${this.size}`),e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-icon"]],inputs:{icon:"icon",size:"size"},decls:1,vars:1,consts:[[3,"ngClass"]],template:function(e,o){1&e&&i._UZ(0,"i",0),2&e&&i.Q6J("ngClass",o.iconClass)},dependencies:[f.mk],encapsulation:2,changeDetection:0}),t})();function xw(t,n){1&t&&(i.TgZ(0,"div"),i.Hsn(1),i.qZA())}const vw=["*"];let Fb=(()=>{class t{constructor(e){this.changeDetector=e,this.hide=!1,this._isActive=!1}get isActive(){return this._isActive}set isActive(e){this._isActive=e,this.changeDetector.markForCheck()}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-tab"]],inputs:{label:"label",hide:"hide"},ngContentSelectors:vw,decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,o){1&e&&(i.F$t(),i.YNc(0,xw,2,0,"div",0)),2&e&&i.Q6J("ngIf",o.isActive)},dependencies:[f.O5],changeDetection:0}),t})();var Ao=A(9787);const Cw=["tabButton"],ww=function(t,n,e,o){return{"tabs__label--dark":t,"tabs__label--light":n,"tabs__label--dark-active":e,"tabs__label--light-active":o}};function Sw(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",5,6),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.handleTabSelect(r))}),i._uU(2),i.qZA()}if(2&t){const e=n.$implicit,o=i.oxw();i.Q6J("ngClass",i.l5B(4,ww,"dark"==o.tabTheme,"light"==o.tabTheme,"dark"==o.tabTheme&&o.isTabActive(e),"light"==o.tabTheme&&o.isTabActive(e))),i.uIk("aria-selected",o.isTabActive(e))("tabIndex",o.isTabActive(e)?0:-1),i.xp6(2),i.hij(" ",e.label," ")}}const Pw=function(t,n){return{"tabs--small":t,"tabs--medium":n}},kw=["*"];let Ow=(()=>{class t{constructor(e){this.changeDetector=e,this.display="normal",this.tabTheme="dark",this.activeTabChange=new i.vpe,this._activeTab=new Hi.X(0),this.tabSize="small",this.tabAlign="default",this.ngUnsubscribe=new X.x}get activeTab(){return this._activeTab.value}set activeTab(e){null!=e&&("string"==typeof e&&(e=e.toUpperCase()),this._activeTab.next(e))}get tabItems(){return this._tabItems}set tabItems(e){this._tabItems=e}ngOnInit(){}ngAfterContentInit(){this._tabs.changes.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.mapTabs(),this.changeDetector.markForCheck()}),this.mapTabs(),this._activeTab.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.showTab(e)}),this._activeTab.pipe((0,Ao.G)(),(0,$.h)(([e,o])=>e!==o),(0,w.R)(this.ngUnsubscribe)).subscribe(([e,o])=>{this.activeTabChange.next(o)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTabSelect(e){this._activeTab.next(e.index)}mapTabs(){this.tabItems=this._tabs.map((e,o)=>({index:o,label:e.label||`Item ${o}`,tab:e}))}showTab(e){this._tabs.forEach((o,s)=>{switch(typeof e){case"number":o.isActive=e===s;break;case"string":o.isActive=e.toString().toUpperCase()===o.label.toUpperCase()}}),this.changeDetector.markForCheck()}isTabActive(e){return("string"==typeof this._activeTab.value?e.label.toUpperCase():e.index)===this._activeTab.value}shiftTab(e){const s=(this.tabItems.find(r=>this.isTabActive(r)).index+e+this.tabItems.length)%this.tabItems.length;this._activeTab.next(s),this._buttonRefs.toArray()[s].nativeElement.focus()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-tabs"]],contentQueries:function(e,o,s){if(1&e&&i.Suo(s,Fb,4),2&e){let r;i.iGM(r=i.CRH())&&(o._tabs=r)}},viewQuery:function(e,o){if(1&e&&i.Gf(Cw,5),2&e){let s;i.iGM(s=i.CRH())&&(o._buttonRefs=s)}},inputs:{display:"display",tabTheme:"tabTheme",activeTab:"activeTab",tabSize:"tabSize",tabAlign:"tabAlign"},outputs:{activeTabChange:"activeTabChange"},ngContentSelectors:kw,decls:6,vars:7,consts:[[1,"tabs",3,"ngClass"],["role","tablist",1,"tabs__labels",3,"keyup.arrowright","keyup.arrowleft"],["tabElements",""],["class","tabs__label","role","tab","type","button","data-test","tabButton",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"tabs__content"],["role","tab","type","button","data-test","tabButton",1,"tabs__label",3,"ngClass","click"],["tabButton",""]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0)(1,"div",1,2),i.NdJ("keyup.arrowright",function(){return o.shiftTab(1)})("keyup.arrowleft",function(){return o.shiftTab(-1)}),i.YNc(3,Sw,3,9,"button",3),i.qZA(),i.TgZ(4,"div",4),i.Hsn(5),i.qZA()()),2&e&&(i.Q6J("ngClass",i.WLB(4,Pw,"small"==o.tabSize,"medium"==o.tabSize)),i.xp6(1),i.ekj("tabs__labels--center","center"===o.tabAlign),i.xp6(2),i.Q6J("ngForOf",o.tabItems))},dependencies:[f.mk,f.sg],styles:['.text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.tabs__labels[_ngcontent-%COMP%]{margin-bottom:8px}.tabs__labels--center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.tabs__label[_ngcontent-%COMP%]{padding:2px 4px 4px;margin-right:8px;font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase;font-weight:500;-webkit-user-select:none;user-select:none;position:relative;background:none;border:none}.tabs__label[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid;margin-top:4px;width:0;transition:.25s ease;position:absolute;bottom:0;left:0}.tabs__label[_ngcontent-%COMP%]:hover{cursor:pointer}.tabs__label--dark[_ngcontent-%COMP%]{color:#96a8c0}.tabs__label--dark[_ngcontent-%COMP%]:after{border-color:#2d72dc}.tabs__label--dark[_ngcontent-%COMP%]:hover, .tabs__label--dark-active[_ngcontent-%COMP%]{color:#fff}.tabs__label--dark-active[_ngcontent-%COMP%]:after{width:100%}.tabs__label--light[_ngcontent-%COMP%]{color:#374a68}.tabs__label--light[_ngcontent-%COMP%]:after{border-color:#2d72dc}.tabs__label--light[_ngcontent-%COMP%]:hover, .tabs__label--light-active[_ngcontent-%COMP%]{color:#283853}.tabs__label--light-active[_ngcontent-%COMP%]:after{width:100%}.tabs--medium[_ngcontent-%COMP%]   .tabs__label[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}'],changeDetection:0}),t})();function Tw(t,n){if(1&t&&(i.TgZ(0,"label",11),i._uU(1),i.qZA()),2&t){const e=i.oxw().$implicit;i.xp6(1),i.Oqu(e.pronunciation)}}function Mw(t,n){if(1&t&&(i.TgZ(0,"span")(1,"kbd",9),i._uU(2),i.qZA(),i.YNc(3,Tw,2,1,"label",10),i.qZA()),2&t){const e=n.$implicit;i.xp6(1),i.uIk("aria-hidden",e.hasOwnProperty("pronunciation")),i.xp6(1),i.hij(" ",e.shortcut," "),i.xp6(1),i.Q6J("ngIf",e.hasOwnProperty("pronunciation"))}}function Iw(t,n){if(1&t&&(i.TgZ(0,"tr")(1,"th",7),i._uU(2),i.qZA(),i.TgZ(3,"td",8),i.YNc(4,Mw,4,3,"span",6),i.qZA()()),2&t){const e=n.$implicit;i.xp6(2),i.Oqu(e.label),i.xp6(2),i.Q6J("ngForOf",e.keys)}}function zw(t,n){if(1&t&&(i.TgZ(0,"div",2)(1,"h2",3),i._uU(2),i.qZA(),i.TgZ(3,"table",4)(4,"tr"),i._UZ(5,"th"),i.TgZ(6,"th",5),i._uU(7,"Keyboard Shortcut"),i.qZA()(),i.YNc(8,Iw,5,2,"tr",6),i.qZA()()),2&t){const e=n.$implicit;i.xp6(2),i.Oqu(e.label),i.xp6(6),i.Q6J("ngForOf",e.shortcuts)}}var Ni=(()=>(function(t){t.Left="\u2190",t.Right="\u2192",t.Up="\u2191",t.Down="\u2193",t.Command="\u2318"}(Ni||(Ni={})),Ni))();let Aw=(()=>{class t{constructor(){this.shortcutGroups=[{label:"Navigation",shortcuts:[{keys:[{shortcut:",",pronunciation:"Comma."},{shortcut:"Pg-Up",pronunciation:"page-up"}],label:"Previous chapter"},{keys:[{shortcut:".",pronunciation:"Period."},{shortcut:"Pg-Down",pronunciation:"Page-down."}],label:"Next chapter"},{keys:[{shortcut:"/",pronunciation:"Forward slash."}],label:"Open Search"},{keys:[{shortcut:"Ctrl + Enter"}],label:"Enter Fullscreen"},{keys:[{shortcut:"Ctrl/Cmd + ,",pronunciation:"Control or command plus comma."}],label:"Toggle Description"},{keys:[{shortcut:"Shift + /"}],label:"Open Help"}]},{label:"Tools",shortcuts:[{keys:[{shortcut:"1"}],label:'Use "Select" tool'},{keys:[{shortcut:"2"}],label:'Use "Hide" tool'},{keys:[{shortcut:"3"}],label:'Use "Fade" tool'},{keys:[{shortcut:"del",pronunciation:"Delete."},{shortcut:"backspace"}],label:"Hide selected structure"},{keys:[{shortcut:"Shift + R"}],label:"Reset chapter"},{keys:[{shortcut:"Ctrl/Cmd + Z",pronunciation:"Control or command plus z."}],label:"Undo"},{keys:[{shortcut:"Ctrl/Cmd + Shift + Z",pronunciation:"Control or command plus shift pluz z."},{shortcut:"Ctrl/Cmd + Y",pronunciation:"Control or command plus y."}],label:"Redo"}]},{label:"Pan",shortcuts:[{keys:[{shortcut:"W"}],label:"Pan up"},{keys:[{shortcut:"S"}],label:"Pan down"},{keys:[{shortcut:"A"}],label:"Pan left"},{keys:[{shortcut:"D"}],label:"Pan right"},{keys:[{shortcut:"Shift + W"}],label:"Slow pan up"},{keys:[{shortcut:"Shift + S"}],label:"Slow pan down"},{keys:[{shortcut:"Shift + A"}],label:"Slow pan left"},{keys:[{shortcut:"Shift + D"}],label:"Slow pan right"}]},{label:"Rotate",shortcuts:[{keys:[{shortcut:Ni.Up}],label:"Rotate up"},{keys:[{shortcut:Ni.Down}],label:"Rotate down"},{keys:[{shortcut:Ni.Left}],label:"Rotate left"},{keys:[{shortcut:Ni.Right}],label:"Rotate right"},{keys:[{shortcut:`Shift + ${Ni.Up}`}],label:"Slow rotate up"},{keys:[{shortcut:`Shift + ${Ni.Down}`}],label:"Slow rotate down"},{keys:[{shortcut:`Shift + ${Ni.Left}`}],label:"Slow rotate left"},{keys:[{shortcut:`Shift + ${Ni.Right}`}],label:"Slow rotate right"}]},{label:"Zoom",shortcuts:[{keys:[{shortcut:"E"},{shortcut:"=",pronunciation:"Equals."}],label:"Zoom in"},{keys:[{shortcut:"C"},{shortcut:"-",pronunciation:"Hyphen."}],label:"Zoom out"},{keys:[{shortcut:"Shift + E"},{shortcut:"Shift + =",pronunciation:"Shift plus equals."}],label:"Slow zoom in"},{keys:[{shortcut:"Shift + C"},{shortcut:"Shift + -",pronunciation:"Shift plus hyphen."}],label:"Slow zoom out"}]}]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-shortcuts"]],decls:2,vars:1,consts:[[1,"view-shortcuts"],["class","view-shortcuts__group",4,"ngFor","ngForOf"],[1,"view-shortcuts__group"],[1,"view-shortcuts__label","text-bold"],[1,"view-shortcuts__table"],["scope","col",1,"view-shortcuts__cell-header"],[4,"ngFor","ngForOf"],["scope","row",1,"view-shortcuts__cell-header"],[1,"view-shortcuts__cell","view-shortcuts__cell--key"],[1,"view-shortcuts__key"],["class","visually-hidden",4,"ngIf"],[1,"visually-hidden"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.YNc(1,zw,9,2,"div",1),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngForOf",o.shortcutGroups))},dependencies:[f.sg,f.O5],styles:[".view-shortcuts[_ngcontent-%COMP%]{display:flex;flex-direction:column}.view-shortcuts__group[_ngcontent-%COMP%]{width:100%;padding-bottom:32px;margin-top:32px}.view-shortcuts__label[_ngcontent-%COMP%]{padding:8px 0 12px}.view-shortcuts__table[_ngcontent-%COMP%]{width:100%}.view-shortcuts__cell[_ngcontent-%COMP%]{padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__cell-header[_ngcontent-%COMP%]{text-align:left;padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__key[_ngcontent-%COMP%]{border-radius:4px;display:inline-flex;padding:4px;margin-right:4px;background:black;color:#fff;justify-content:center;align-items:center;font-family:monospace;font-size:16px}"],changeDetection:0}),t})();const Uw=["viewHelp"];class Ar{constructor(n,e,o,s){this.dialogRef=n,this.renderer=e,this.store=o,this.data=s,this.helpTypeEnum=di,this.activeTab=di.Basics,this.ngUnsubscribe=new X.x,this.activeTab=s.tab}ngOnInit(){this.initWindowSizeObserver()}ngAfterViewInit(){this.updateViewHeight()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWindowSizeObserver(){this.renderer.listen("window","resize",()=>{this.updateViewHeight()})}updateViewHeight(){const e=ou(this.store.selectSnapshot(Et.getSiteHeader),!1);this.viewHelp.nativeElement.style.setProperty("--vh",`${e}px`)}handleCloseClick(){this.dialogRef.close()}}Ar.\u0275fac=function(n){return new(n||Ar)(i.Y36(He.so),i.Y36(i.Qsj),i.Y36(l.yh),i.Y36(He.WI))},Ar.\u0275cmp=i.Xpm({type:Ar,selectors:[["app-help-dialog"]],viewQuery:function(n,e){if(1&n&&i.Gf(Uw,7),2&n){let o;i.iGM(o=i.CRH())&&(e.viewHelp=o.first)}},decls:126,vars:1,consts:[["role","dialog","aria-labelledby","helpTitle",1,"view-help"],["viewHelp",""],["id","helpTitle",1,"view-help__header"],["type","button",1,"view-help__close",3,"click"],["icon","times","aria-hidden","true"],[1,"visually-hidden"],[1,"view-help__inner"],["tabSize","medium","tabAlign","center","cdkFocusInitial","",3,"activeTab"],["label","Navigation Basics","id","helpBasics","aria-controls","basicsPanel"],["role","tabpanel","aria-labelledby","helpBasics","tabindex","0","id","basicsPanel"],[1,"view-help__group"],[1,"view-help__item"],[1,"view-help__image"],["src","assets/images/widget/help-rotate.svg","alt","A heart with an arrow wrapped around it, which symbolises objects being rotated withing the 3D viewport."],[1,"view-help__label"],["src","assets/images/widget/help-pan.svg","alt","A heart with left and right arrows pointing away from it, which symbolises objects being panned within the 3D viewport"],["src","assets/images/widget/help-zoom.svg","alt","A heart with a magnifying glass over it, which symbolises zooming into and out from an object within the 3D viewport."],["src","assets/images/widget/help-learn.svg","alt","A heart with a smaller region colored in blue and a popup window specifying that the Right Ventricle is selected."],["label","All Controls","id","helpAll","aria-controls","allPanel"],["role","tabpanel","aria-labelledby","helpAll","tabindex","0","id","allPanel"],[1,"view-help__section-header"],["src","assets/images/widget/help-mouse-hold-left.svg","alt","A mouse with the left button being held in."],["src","assets/images/widget/help-mouse-hold-right.svg","alt","A mouse with the right button being held in."],["src","assets/images/widget/help-mouse-single-click-left.svg","alt","A mouse with the left button being clicked."],["src","assets/images/widget/help-mouse-double-click-left.svg","alt","A mouse with the left button being double clicked."],["src","assets/images/widget/help-mouse-long-press-left.svg","alt","A mouse with the left button being held in for a long duration."],["src","assets/images/widget/help-keyboard-rotate.svg","alt","The arrow keys."],["src","assets/images/widget/help-keyboard-pan.svg","alt","The W, A, S and D keys."],["src","assets/images/widget/help-keyboard-zoom.svg","alt","The plus and minus keys grouped together or the E and C keys grouped together."],["src","assets/images/widget/help-keyboard-slow-motion.svg","alt","The shift key."],["src","assets/images/widget/help-trackpad-single-tap.svg","alt","A finger clicking the trackpad once."],["src","assets/images/widget/help-trackpad-double-tap.svg","alt","A finger clicking the trackpad twice."],["src","assets/images/widget/help-trackpad-long-press.svg","alt","A finger pressing for a long duration on the trackpad."],["src","assets/images/widget/help-trackpad-scroll.svg","alt","Two fingers pressing the trackpad while moving vertically."],["icon","plus","aria-hidden","true",1,"view-help__icon"],["icon","minus","aria-hidden","true",1,"view-help__icon"],["icon","location","aria-hidden","true",1,"view-help__icon"],["icon","arrows","aria-hidden","true",1,"view-help__icon"],["label","Keyboard Shortcuts","id","helpShortcuts","aria-controls","shortcutsPanel"],["role","tabpanel","aria-labelledby","helpShortcuts","tabindex","0","id","shortcutsPanel"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0,1)(2,"h2",2),i._uU(3,"Help"),i.qZA(),i.TgZ(4,"button",3),i.NdJ("click",function(){return e.handleCloseClick()}),i._UZ(5,"app-icon",4),i.TgZ(6,"span",5),i._uU(7,"Close help modal"),i.qZA()(),i.TgZ(8,"div",6)(9,"app-tabs",7)(10,"app-tab",8)(11,"div",9)(12,"ul",10)(13,"li",11)(14,"div",12),i._UZ(15,"img",13),i.qZA(),i.TgZ(16,"div",14),i._uU(17,"Rotate"),i.qZA(),i._uU(18," Click and drag or use one finger to change the viewing angle. "),i.qZA(),i.TgZ(19,"li",11)(20,"div",12),i._UZ(21,"img",15),i.qZA(),i.TgZ(22,"div",14),i._uU(23,"Pan"),i.qZA(),i._uU(24," Hold the shift key and drag or use two fingers to move the model's position. "),i.qZA(),i.TgZ(25,"li",11)(26,"div",12),i._UZ(27,"img",16),i.qZA(),i.TgZ(28,"div",14),i._uU(29,"Zoom"),i.qZA(),i._uU(30," Scroll up and down or pinch with two fingers to zoom in or out. "),i.qZA(),i.TgZ(31,"li",11)(32,"div",12),i._UZ(33,"img",17),i.qZA(),i.TgZ(34,"div",14),i._uU(35,"Explore the Anatomy"),i.qZA(),i._uU(36," Click or tap an anatomic structure or label to learn more. "),i.qZA()()()(),i.TgZ(37,"app-tab",18)(38,"div",19)(39,"h3",20),i._uU(40,"Mouse"),i.qZA(),i.TgZ(41,"ul",10)(42,"li",11)(43,"div",12),i._UZ(44,"img",21),i.qZA(),i._uU(45," Hold left button to rotate "),i.qZA(),i.TgZ(46,"li",11)(47,"div",12),i._UZ(48,"img",22),i.qZA(),i._uU(49," Hold right button to pan "),i.qZA(),i.TgZ(50,"li",11)(51,"div",12),i._UZ(52,"img",23),i.qZA(),i._uU(53," Single-click left button to select a structure "),i.qZA(),i.TgZ(54,"li",11)(55,"div",12),i._UZ(56,"img",24),i.qZA(),i._uU(57," Double-click left button to auto-focus on a structure "),i.qZA(),i.TgZ(58,"li",11)(59,"div",12),i._UZ(60,"img",25),i.qZA(),i._uU(61," Long-click to fly to a structure "),i.qZA()(),i.TgZ(62,"h3",20),i._uU(63,"Keyboard"),i.qZA(),i.TgZ(64,"ul",10)(65,"li",11)(66,"div",12),i._UZ(67,"img",26),i.qZA(),i._uU(68," Rotate with arrows "),i.qZA(),i.TgZ(69,"li",11)(70,"div",12),i._UZ(71,"img",27),i.qZA(),i._uU(72," Pan up (W), left (A), down (S), right(D) "),i.qZA(),i.TgZ(73,"li",11)(74,"div",12),i._UZ(75,"img",28),i.qZA(),i._uU(76," Zoom out (-, C) and zoom in (+, E) "),i.qZA(),i.TgZ(77,"li",11)(78,"div",12),i._UZ(79,"img",29),i.qZA(),i._uU(80," Hold with any previous key to slow down motion "),i.qZA()(),i.TgZ(81,"h3",20),i._uU(82,"Trackpad"),i.qZA(),i.TgZ(83,"ul",10)(84,"li",11)(85,"div",12),i._UZ(86,"img",30),i.qZA(),i._uU(87," Single-tap to auto-focus a structure "),i.qZA(),i.TgZ(88,"li",11)(89,"div",12),i._UZ(90,"img",31),i.qZA(),i._uU(91," Double-tap to select a structure "),i.qZA(),i.TgZ(92,"li",11)(93,"div",12),i._UZ(94,"img",32),i.qZA(),i._uU(95," Long-press to fly to a structure "),i.qZA(),i.TgZ(96,"li",11)(97,"div",12),i._UZ(98,"img",33),i.qZA(),i._uU(99," Scroll up and down to zoom "),i.qZA()(),i.TgZ(100,"h3",20),i._uU(101,"In-App"),i.qZA(),i.TgZ(102,"ul",10)(103,"li",11),i._UZ(104,"app-icon",34),i.TgZ(105,"span",5),i._uU(106," The plus symbol, which represents zooming in in the camera control menu. "),i.qZA(),i._uU(107," Zoom in "),i.qZA(),i.TgZ(108,"li",11),i._UZ(109,"app-icon",35),i.TgZ(110,"span",5),i._uU(111," The minus symbol, which represents zooming out in the camera control menu. "),i.qZA(),i._uU(112," Zoom out "),i.qZA(),i.TgZ(113,"li",11),i._UZ(114,"app-icon",36),i.TgZ(115,"span",5),i._uU(116," The map pin symbol, which resets the camera in the camera control menu. "),i.qZA(),i._uU(117," Recenter 3D Model "),i.qZA(),i.TgZ(118,"li",11),i._UZ(119,"app-icon",37),i.TgZ(120,"span",5),i._uU(121," Arrows pointing in four directions, which represents panning in the camera control menu. "),i.qZA(),i._uU(122," Pan "),i.qZA()()()(),i.TgZ(123,"app-tab",38)(124,"div",39),i._UZ(125,"app-view-shortcuts"),i.qZA()()()()()),2&n&&(i.xp6(9),i.Q6J("activeTab",e.activeTab))},dependencies:[lt,Fb,Ow,Aw],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-help{background-color:#101823e6;color:#fff;display:flex;align-items:center;flex-direction:column;position:fixed;top:0;left:0;right:0;z-index:10000;height:100vh;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:auto}.view-help__inner{width:100%;max-width:1140px;height:99vh;height:calc(var(--vh, 1vh) * 99);padding:32px;position:relative}.view-help__close{color:#fff;width:40px;height:40px;display:flex;align-items:center;justify-content:center;position:fixed;right:8px;top:8px;z-index:10;border:none;background:none}.view-help__header{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase;font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__section-header{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;border-bottom:1px solid rgba(255,255,255,.3);font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__label{font-size:14px;letter-spacing:.35px;line-height:1.4em;font-weight:600;margin-bottom:12px}.view-help__group{display:flex;justify-content:space-around;flex-wrap:wrap}.view-help__item{font-size:12px;letter-spacing:.3px;line-height:1.4em;display:flex;flex-flow:column;text-align:center;padding:20px;flex:0 1 180px}.view-help__image{justify-content:center;margin-bottom:16px;width:160px;height:100px}.view-help__icon{font-size:24px;margin-bottom:16px}\n"],encapsulation:2,changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(O.getCanTouch),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],Ar.prototype,"canTouch$",void 0);var no=A(2687);let ut=(()=>{class t{constructor(e,o,s,r,a,c,p,d){this.dialog=e,this.store=o,this.location=s,this.transitionService=r,this.sceneService=a,this.layoutService=c,this.pendoService=p,this.liveAnnouncer=d}initStory(e,o,s){const r="preview"===e;this.store.dispatch(new Jd(e,o,r)),this.store.dispatch(new fc(e,o,!0));const a=this.store.select(M.getReady),c=this.store.select(we.getIncomingStoryInfo);(0,bt.a)([a,c]).pipe((0,$.h)(([p,d])=>p&&!!d.id),(0,yt.q)(1)).subscribe(()=>{this.store.dispatch(new gi),this.store.dispatch(new mc(e,o,s,r))})}nextChapter(e){const o=this.store.selectSnapshot(_.getSelectedChapterIndex),s=this.store.selectSnapshot(_.getStoryChapters);this.pendoService.trackOncePerSession(lr.DiscoveredChapterNav,{source:e,breakpoint:this.store.selectSnapshot(Pt.getBreakpointLabel)});const r=s[o+1];r&&this.selectChapter(r)}previousChapter(e){const o=this.store.selectSnapshot(_.getSelectedChapterIndex),s=this.store.selectSnapshot(_.getStoryChapters);this.pendoService.trackOncePerSession(lr.DiscoveredChapterNav,{source:e,breakpoint:this.store.selectSnapshot(Pt.getBreakpointLabel)});const r=s[o-1];r&&this.selectChapter(r)}selectChapter(e){var o=this;return(0,Pn.Z)(function*(){if(!o.store.selectSnapshot(U.getQuizModeActive)){const a=o.store.selectSnapshot(_.getSelectedChapterId),c=e.id,p=o.store.selectSnapshot(_.getStoryChapters),d=o.transitionService.searchChapterTransitions(a,c,p);o.pendoService.trackOncePerSession(lr.DiscoveredChapterNav,{source:"Chapter List",breakpoint:o.store.selectSnapshot(Pt.getBreakpointLabel)}),d&&(yield o.chapterTransition(d)),o.store.dispatch([new Rp(e.id),new gi(e)])}const r=document.getElementById("chapter-title");r&&setTimeout(()=>r.querySelector("button").focus(),200)})()}chapterTransition(e){return new Promise(o=>{e.camera&&this.store.dispatch(new Zn(e.camera,!0,e.duration)),e.fadeColor&&this.store.dispatch(new Hh(e.fadeColor,e.duration)),setTimeout(()=>{o(!0)},1e3*e.duration)})}hideSelectedStructures(){const e=this.store.selectSnapshot(Se.getCheckedNodeIds);this.store.dispatch(new rn(!1,e))}selectTool(e){this.store.selectSnapshot(U.getQuizModeActive)&&e===Ve.Select&&(e=Ve.Quiz),this.store.dispatch(new Cs(e))}toggleColumn(e){const o=this.store.selectSnapshot(O.getUI);o.column.status=(e=e??o.column.status!==Pe.Show)?Pe.Show:Pe.Collapse,this.store.dispatch(new T.SetUI(o))}togglePresentation(){this.store.selectSnapshot(O.getPresentationActive)?this.stopPresentation():this.startPresentation()}startPresentation(){this.store.dispatch(new T.TogglePresentation(!0))}stopPresentation(){this.store.dispatch(new T.TogglePresentation(!1))}toggleHelp(e=di.Basics){0===this.dialog.openDialogs.length&&this.dialog.open(Ar,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{tab:e}})}toggleInteract(e){this.store.dispatch(new T.ToggleWindow(pt.Interact,e))}toggleOnDemand(e){this.store.dispatch(new T.SetOnDemand(e)),this.store.dispatch(new T.ToggleWindow(pt.OnDemand,e))}toggleTutorial(e){this.store.dispatch(new T.ToggleWindow(pt.Tutorial,e)),e&&this.store.dispatch(new T.StartTutorial(!0))}toggleWhiteboard(e){this.store.dispatch(new T.ToggleWindow(pt.Whiteboard,e)),e&&(this.store.dispatch(new _o(!1)),this.store.dispatch(new T.SetWhiteboardEnabled(!0)))}showLabels(e){const o=this.store.selectSnapshot(O.getUI);e=(0,m.isNil)(e)?!o.labels.shown:e,o.labels.shown=e,this.store.dispatch(new T.SetUI(o))}toggleLabels(e){this.store.dispatch(new Wo(e))}toggleSearch(e=an.List,o){this.store.selectSnapshot(Pt.getBreakpoint);const r=this.store.selectSnapshot(O.getUI);r.search.status=(o=o??r.search.status!==Pe.Show)?Pe.Show:Pe.Hide,o&&(r.nodeInfo.status=Pe.Hide),this.store.dispatch(new T.SetSearchDisplayMode(e)),this.store.dispatch(new T.SetUI(r))}toggleNodeInfo(e){this.toggleInfoLayout("nodeInfo",e)}toggleLabelInfo(e){this.toggleInfoLayout("labelInfo",e)}toggleInfoLayout(e,o){const s=this.store.selectSnapshot(O.getUI);(o=o??s[e].status===Pe.Hide)?(s[e].status=Pe.Show,["nodeInfo","labelInfo"].filter(a=>a!==e).forEach(a=>s[a].status=Pe.Hide)):s[e].status=Pe.Hide,this.store.dispatch(new T.SetUI(s))}delegateNodeClick(e,o){if(this.clearSelectedLabel(),e||o.srcEvent.shiftKey)if(o.srcEvent.shiftKey||this.store.selectSnapshot(O.getMultiPickModeEnabled))this.checkNode(e);else switch(this.store.selectSnapshot(M.getActiveTool)){case Ve.Hide:this.hideNode(e);break;case Ve.Select:this.selectNode(e);break;case Ve.Isolate:this.isolateNode(e);break;case Ve.Fade:this.fadeNode(e)}else this.clearSelectedNodes()}clearSelectedLabel(){this.store.dispatch(new ns)}clearSelectedNodes(){this.store.dispatch(new Ms),this.store.dispatch(new Rt(!1))}clearFadedNodes(){const e=this.store.selectSnapshot(_.getSelectedChapterId);this.store.dispatch(new Nt.UndoAll(e))}checkNode(e,o){void 0!==e&&(null==o&&(o=this.store.selectSnapshot(Se.getNodes)[e.id].checked),this.store.dispatch(new Rt(!o,[e.id])),this.store.dispatch(new Ms(e.id)))}fadeNode(e){this.store.dispatch(new Xo(es,[e.id]))}isolateNode(e){this.store.dispatch(new rn(!1)),this.store.dispatch(new rn(!0,[e.id]))}selectNode(e){const o=!this.store.selectSnapshot(Se.getNodes)[e.id].checked;this.store.dispatch(new Rt(!1)),o&&(this.store.dispatch(new Rt(!0,[e.id])),this.store.dispatch(new Ms(e.id))),this.store.dispatch(new ur(e));const s=this.store.selectSnapshot(O.getNodeInfoFallback),r=this.store.selectSnapshot(O.getViewLanguage);this.store.dispatch(new td(e,s,r))}hideNode(e){this.store.dispatch(new rn(!1,[e.id])),this.store.dispatch(new Rt(!1))}selectLabel(e,o=!1){const{objectId:s,states:r}=e;this.store.dispatch(new ns(e)),o&&s&&0===r.length&&this.store.dispatch(new Wi(s,!0))}initChapter(e){var o=this;return(0,Pn.Z)(function*(){const s=o.sceneService.getChapterSceneGraph(e.id);o.store.dispatch(new yo(s)),o.store.selectSnapshot(Ne.getChapterCameraEnabled)&&o.store.dispatch(new Zn(e.camera.location,e.camera.action===Sr.FlyTo,void 0,e.camera.rotationCenter))})()}playChapterFromStart(){this.store.dispatch(new Wh)}resetCamera(){const o=this.store.selectSnapshot(_.getSelectedChapter)?.camera?.location;(0,m.isNil)(o)||this.store.dispatch(new Zn(o))}resetChapter(){this.resetCamera();const e=this.store.selectSnapshot(_.getSelectedChapterId);this.store.dispatch(new Nt.UndoAll(e)).subscribe(()=>{this.liveAnnouncer.announce("reset complete")}),this.store.dispatch(new Rt(!1)),this.store.dispatch(new Oo)}resetLayout(){const{ui:e}=this.store.selectSnapshot(O);this.layoutService.isUIHidden()?Object.keys(e).forEach(o=>{e[o].status=Pe.Hide}):(Object.keys(e).forEach(o=>{e[o].status=Pe.Show}),e.search.status=Pe.Hide,e.tools.status=Pe.Hide,e.nodeInfo.status=Pe.Hide,e.labelInfo.status=Pe.Hide,e.media.status=Pe.Hide,e.visibilityLayers.status=Pe.Hide),this.store.dispatch(new T.SetUI(e))}undo(){this.store.dispatch(new Nt.Undo(this.store.selectSnapshot(_.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("undo complete")})}redo(){this.store.dispatch(new Nt.Redo(this.store.selectSnapshot(_.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("redo complete")})}toggleAnimation(){const e=!this.store.selectSnapshot(M.getAnimationPlaying);this.store.dispatch(new _o(e))}toggleAudio(){const e=this.store.selectSnapshot(M.getPlayAudio);this.store.dispatch(new ws(!e))}toggleToolbar(e){const o=this.store.selectSnapshot(O.getUI);o.media.status=Pe.Hide,o.tools.status=Pe.Hide,o.toolbar.status=Pe.Hide,o.visibilityLayers.status=Pe.Hide,"none"!==e?o[e].status=Pe.Show:this.selectTool(Ve.Select),this.store.dispatch(new T.SetUI(o))}closeToolbar(){const e=this.store.selectSnapshot(O.getUI);e.media.status=Pe.Hide,e.tools.status=Pe.Hide,e.visibilityLayers.status=Pe.Hide,this.selectTool(Ve.Select),this.store.dispatch(new T.SetUI(e))}normalizeQueryParams(e){const o={...e};return{id:qd(o),type:rb(o),lang:e.lang}}sanitizeRouteId(e){return e=e.replace(/\.json$/,""),this.location.replaceState("view",`?id=${e}`),e}openInNewTab(){const e=window.document.location.href;window.open(e)}getComputedTransform(e){const r=getComputedStyle(e).transform.replace("matrix3d","").replace("matrix","").replace("(","").replace(")","").split(",").map(p=>p.trim()).map(p=>parseInt(p,10)),a=16===r.length?r[12]:r[4],c=16===r.length?r[13]:r[5];return Number.isNaN(a)||Number.isNaN(c)?null:{x:a,y:c}}inferDrawerMode(e){let o=Ui.Content;return e.nodeInfo.status===Pe.Show?o=Ui.NodeInfo:e.labelInfo.status===Pe.Show&&(o=Ui.LabelInfo),o}setUI(e){let o=e.baseUIConfig??new Ir;o=zr(o,e.apiUIConfig),o=zr(o,e.urlUIConfig),o=zr(o,e.chapterUIConfig),e.quizUIConfig&&(o=zr(o,e.quizUIConfig,!0));const r=Ab(this.store.selectSnapshot(O.getUI),o);this.store.dispatch(new T.SetUI(r))}setViewLanguage(e="en"){this.store.dispatch(new T.SetViewLanguage(e))}setAnatomyDescriptionFallback(e){this.store.dispatch(new T.SetNodeInfoConfig(e))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(He.uw),i.LFG(l.yh),i.LFG(f.Ye),i.LFG(nw),i.LFG(Ut),i.LFG(ri),i.LFG(Ln),i.LFG(no.Kd))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Rw=(()=>{class t{constructor(e){this.viewService=e}initialize(){window.BDGlobalActions={toggleTutorial:e=>this.viewService.toggleTutorial(e)}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Lr=(()=>(function(t){t.APIKey="apikey",t.UserAnalyticId="uaid",t.ProductKey="productkey",t.UserId="userid"}(Lr||(Lr={})),Lr))(),Ub=A(3353),Fr=(()=>(function(t){t.Web="web",t.Android="mobile_android",t.iOS="mobile_ios"}(Fr||(Fr={})),Fr))();let Yn=(()=>{class t{constructor(e){this.platform=e}get productKey(){return se.productKey}get productType(){if(se.native){if(this.platform.ANDROID)return Fr.Android;if(this.platform.IOS)return Fr.iOS}return Fr.Web}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Ub.t4))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var su;!function(t){t.lazyLoadScript=function n(e){return new Promise((o,s)=>{const{src:r}=e;if(document.querySelector(`script[src="${r}"]`))o(void 0);else{const c=document.createElement("script");e&&Object.entries(e).forEach(([p,d])=>{"src"!==p&&(c.attributes[p]=d)}),c.src=r,c.onload=()=>o(void 0),c.onerror=()=>s(),document.body.appendChild(c)}})}}(su||(su={}));var Nw=A(3422);class Ur{constructor(n,e,o,s,r,a,c,p){this.store=n,this.router=e,this.ga=o,this.pendoService=s,this.globalActionsService=r,this.engineService=a,this.productService=c,this.renderer2=p,this.title="Biodigital Human",this.ngUnsubscribe=new X.x}ngOnInit(){this.initPendo(),this.initPageAnalytics(),this.initInputObserver(),this.initGPUAnalytics(),this.initStats(),this.globalActionsService.initialize()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initPendo(){this.pendoService.appendScript(),this.pendoService.initialize({visitor:{id:""},account:{}})}initInputObserver(){this.inputEnabled$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.store.dispatch(new T.SetInputEnabled(n))})}initPageAnalytics(){this.router.events.pipe((0,$.h)(n=>n instanceof We.m2),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{})}initGPUAnalytics(){const{dk:n,uaid:e,"app-productkey":o}=this.store.selectSnapshot(tt.getWidgetUrlConfig);let a,c;n?(a=Lr.APIKey,c=n):e?(a=Lr.UserAnalyticId,c=e):o&&(a=Lr.ProductKey,c=o),this.engineService.initAnalytics(this.productService.productType,o||this.productService.productKey,a,c)}initStats(){const n=new URLSearchParams(window.location.search),e="true"===n.get("ui-stats"),o=n.get("engine-context");("webgl"===o||"webgl2"===o)&&this.store.dispatch(new nd(o)),e&&su.lazyLoadScript({src:"//mrdoob.github.io/stats.js/build/stats.min.js"}).then(()=>{const r=new window.Stats,a=document.querySelector("#container")??document.body;this.renderer2.setStyle(r.dom,"position","absolute"),this.renderer2.appendChild(a,r.dom),requestAnimationFrame(function c(){r.update(),requestAnimationFrame(c)})})}}Ur.\u0275fac=function(n){return new(n||Ur)(i.Y36(l.yh),i.Y36(We.F0),i.Y36(Nw.$r),i.Y36(Ln),i.Y36(Rw),i.Y36(et),i.Y36(Yn),i.Y36(i.Qsj))},Ur.\u0275cmp=i.Xpm({type:Ur,selectors:[["app-root"]],decls:1,vars:0,template:function(n,e){1&n&&i._UZ(0,"router-outlet")},dependencies:[We.lC],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(tt.getInputEnabled),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],Ur.prototype,"inputEnabled$",void 0);var cn=A(6502),Gn=A(9963),jw=A(8565),_n=(()=>(function(t){t[t.Main=0]="Main",t[t.Media=1]="Media",t[t.Tools=2]="Tools",t[t.Whiteboard=3]="Whiteboard",t[t.VisibilityLayers=4]="VisibilityLayers",t[t.Empty=5]="Empty"}(_n||(_n={})),_n))(),Rr=A(4457),me=(()=>(function(t){t.AnnotationsCreated="annotations.created",t.AnnotationsDestroyed="annotations.destroyed",t.AnnotationsHidden="annotations.hidden",t.AnnotationsShown="annotations.shown",t.QuizEntered="quiz.entered",t.QuizExited="quiz.exited",t.QuizQuestionLoaded="quiz.questionLoaded",t.QuizAnswerSelected="quiz.answerSelected",t.QuizAnswerSubmitted="quiz.answerSubmitted",t.QuizCompleted="quiz.completed",t.LabelsCreated="labels.created",t.LabelsUpdated="labels.updated",t.LabelsMoved="labels.moved",t.LabelsDestroyed="labels.destroyed",t.LabelsChapterInfo="labels.chapterInfo",t.LabelsShown="labels.shown",t.LabelsHidden="labels.hidden",t.LabelsEnabled="labels.enabled",t.LabelsDisabled="labels.disabled",t.LabelsEntered="labels.entered",t.LabelsLeft="labels.left",t.LabelsPicked="labels.picked",t.HotspotsDisplayUpdated="hotspots.displayUpdated",t.HotspotsEntered="hotspots.entered",t.HotspotsLeft="hotspots.left",t.HotspotsPicked="hotspots.picked",t.HotspotsPositionUpdated="hotspots.positionUpdated",t.NativeDeleteData="native.deleteData",t.NativeUpgrade="native.upgrade",t.NativeRestore="native.restore",t.NativeShare="native.share",t.NativeGoogleSignUp="native.googleSignUp",t.NativeDebugMessage="native.debugMessage",t.NativeSetSdkOffline="native.setSdkOffline",t.NativeSetBaseDirectory="native.setBaseDirectory"}(me||(me={})),me))();let Lo=(()=>{class t extends zh{}return t.\u0275fac=function(){let n;return function(o){return(n||(n=i.n5z(t)))(o||t)}}(),t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Ns=(()=>{class t{constructor(e,o,s){this.store=e,this.viewService=o,this.applicationEventService=s}startQuiz(){this.viewService.toggleColumn(!0),this.store.dispatch(new ee.SetQuizActive(!0));const e=this.store.selectSnapshot(U.getAllQuestions)[0].id;this.store.dispatch(new ee.SetActiveQuestion(e))}resetQuiz(){this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new ee.SetQuizActive(!1)),this.store.dispatch(new ee.SetActiveSubmission(void 0)),this.store.dispatch(new ee.ClearSubmissions),this.store.dispatch(new ee.SetQuizLifecycle(mi.Question))}exitQuiz(){this.resetQuiz(),setTimeout(()=>{this.store.dispatch(new Zn(this.store.selectSnapshot(_.getChapterCamera),!1))})}submitQuestion(e,o){const s=this.store.selectSnapshot(U.getAllQuestions).find(p=>p.id===e),{launchMode:r,quizSettings:a}=this.store.selectSnapshot(U);this.store.dispatch(new ee.SubmitQuestionAnswer({questionId:s.id,answer:o})),this.store.dispatch(new ee.SetActiveSubmission({questionId:s.id,answer:o})),this.applicationEventService.fireEvent(me.QuizAnswerSubmitted,{questionId:s.id,answer:o}),r===Ia.Learning&&s.type!==Re.Instructions&&!1!==a.showExplanation?this.store.dispatch(new ee.SetQuizLifecycle(mi.Explanation)):this.nextQuestion()}nextQuestion(){this.store.selectSnapshot(U.hasQuestionRemaining)?(this.store.dispatch(new ee.SetQuizLifecycle(mi.Question)),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new ee.NextQuestion)):(this.store.dispatch(new ee.SetQuizLifecycle(mi.Review)),this.applicationEventService.fireEvent(me.QuizCompleted,!0))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(ut),i.LFG(Lo))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Qw(t,n){if(1&t&&i._UZ(0,"app-icon",5),2&t){const e=i.oxw();i.Q6J("icon",e.icon)}}function Zw(t,n){if(1&t&&i._UZ(0,"span",6),2&t){const e=i.oxw();i.Udp("background-image","url("+e.src+")")}}function Bw(t,n){if(1&t&&(i.TgZ(0,"span",7),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.label," ")}}const Vw=function(t,n,e,o,s,r,a,c,p,d,u,g,h,y,k,B,K){return{"pin-button--selected":t,"pin-button--disabled":n,"pin-button--small":e,"pin-button--medium":o,"pin-button--large":s,"pin-button--ghost":r,"pin-button--primary":a,"pin-button--secondary":c,"pin-button--outline":p,"pin-button--floating":d,"pin-button--dark":u,"pin-button--row":g,"pin-button--circle":h,"pin-button--square":y,"pin-button--rounded":k,"pin-button--fill":B,"pin-button--left":K}},qw=["*"];var ul=(()=>(function(t){t.Circle="circle",t.Rounded="rounded",t.Square="square"}(ul||(ul={})),ul))(),gl=(()=>(function(t){t.Left="left",t.Center="center"}(gl||(gl={})),gl))();let In=(()=>{class t{constructor(e){this.elRef=e,this.selectable=!1,this.size="medium",this.buttonType="default",this.buttonShape=ul.Circle,this.buttonAlign=gl.Center,this.direction="column",this.fill=!1,this._selected=!1,this.disabled=!1,this.selectedChange=new i.vpe}get selected(){return this._selected}set selected(e){this._selected=e,this.selectedChange=new i.vpe}ngOnInit(){}handleClick(){this.disabled||this.selectable&&(this.selected=!this.selected)}focus(e){this.elRef&&this.elRef.nativeElement.focus()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.SBq))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-pin-button"],["button","app-pin-button",""]],inputs:{icon:"icon",src:"src",description:"description",label:"label",selectable:"selectable",size:"size",buttonType:"buttonType",buttonShape:"buttonShape",buttonAlign:"buttonAlign",direction:"direction",fill:"fill",selected:"selected",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},ngContentSelectors:qw,decls:6,vars:22,consts:[[1,"pin-button",3,"ngClass","click"],[1,"pin-button__pin"],["style","font-size: 14px !important",3,"icon",4,"ngIf"],["class","pin-button__image",3,"backgroundImage",4,"ngIf"],["class","pin-button__label",4,"ngIf"],[2,"font-size","14px !important",3,"icon"],[1,"pin-button__image"],[1,"pin-button__label"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"span",0),i.NdJ("click",function(){return o.handleClick()}),i.TgZ(1,"span",1),i.YNc(2,Qw,1,1,"app-icon",2),i.YNc(3,Zw,1,2,"span",3),i.Hsn(4),i.qZA(),i.YNc(5,Bw,2,1,"span",4),i.qZA()),2&e&&(i.Q6J("ngClass",i.rFY(4,Vw,[o.selected,o.disabled,"small"===o.size,"medium"===o.size,"large"===o.size,"ghost"===o.buttonType,"primary"===o.buttonType,"secondary"===o.buttonType,"outline"===o.buttonType,"floating"===o.buttonType,"dark"===o.buttonType,"row"===o.direction,"circle"==o.buttonShape,"square"==o.buttonShape,"rounded"==o.buttonShape,o.fill,"left"===o.buttonAlign])),i.xp6(2),i.Q6J("ngIf",o.icon),i.xp6(1),i.Q6J("ngIf",o.src),i.xp6(2),i.Q6J("ngIf",o.label))},dependencies:[f.mk,f.O5,lt],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}button[app-pin-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all}button[app-pin-button]::-moz-focus-inner{border:0}button[app-pin-button]:not([disabled]):hover{cursor:pointer}button[app-pin-button]:focus .pin-button__pin{outline:#ffffff solid 2px;outline-offset:-4px}button[app-pin-button]:focus :not(.pin-button--selected) .pin-button__pin{outline:#2d72dc solid 2px!important;outline-offset:-2px}button[app-pin-button]:focus :not(.pin-button--selected).pin-button--dark .pin-button__pin{background-color:#61779e!important}button[app-pin-button]:focus .pin-button--secondary .pin-button__pin{outline:#ffffff solid 2px;outline-offset:-4px}button[app-pin-button][disabled]{pointer-events:none}.pin-button{display:inline-flex;flex-flow:column;align-items:center;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.pin-button:hover{cursor:pointer}.pin-button:hover:not(.pin-button--selected):not(.pin-button--disabled) .pin-button__pin{background:rgba(215,224,234,.6)}.pin-button:not(.pin-button--selected):active:hover .pin-button__pin{background:#d7e0ea}.pin-button--selected .pin-button__pin{background-color:#2d72dc;color:#fff}.pin-button--selected .pin-button__label{color:#2d72dc;font-weight:600}.pin-button--small .pin-button__pin{border-radius:14px;min-width:28px;height:28px}.pin-button--small .pin-button__label{margin-top:0}.pin-button--large .pin-button__pin{font-size:20px;letter-spacing:.5px;line-height:1.4em}.pin-button--left .pin-button__pin{justify-content:flex-start}.pin-button--row{flex-direction:row}.pin-button--row .pin-button__label{margin:0 0 0 4px}.pin-button--ghost:not(.pin-button--selected) .pin-button__pin{background:transparent}.pin-button--outline:not(.pin-button--selected) .pin-button__pin{background:transparent;border:1px solid #96a8c0}.pin-button--primary .pin-button__pin{background:#de3535;color:#fff}.pin-button--primary:not(.pin-button--selected):not(.pin-button--disabled) .pin-button__pin{background:#de3535!important;color:#fff}.pin-button--primary:not(.pin-button--selected):not(.pin-button--disabled):hover .pin-button__pin{background:#e24b4b}.pin-button--secondary .pin-button__pin{background:#2d72dc;color:#fff}.pin-button--secondary:not(.pin-button--selected):not(.pin-button--disabled) .pin-button__pin{background:#2d72dc;color:#fff}.pin-button--secondary:not(.pin-button--selected):not(.pin-button--disabled):hover .pin-button__pin{background:#4381e0}.pin-button--disabled{opacity:.2}.pin-button--disabled:hover{cursor:auto}.pin-button--fill,.pin-button--fill .pin-button__pin{width:100%;height:100%}.pin-button--floating .pin-button__pin{background-color:#fff;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.pin-button--dark .pin-button__pin{color:#f9fafd;background-color:#1c2a3f!important;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.pin-button--square .pin-button__pin{border-radius:4px}.pin-button--circle .pin-button__pin{border-radius:50%}.pin-button--rounded .pin-button__pin{border-radius:20px}.pin-button__pin{--pin-button-pin-color: #1c2a3f;border-radius:20px;display:flex;font-size:12px;float:left;min-width:40px;height:40px;align-items:center;justify-content:center;position:relative;background-color:#eaeff5;color:#1c2a3f;color:var(--pin-button-pin-color);transition:background-color 125ms}.pin-button__label{font-size:10px;letter-spacing:.25px;line-height:1.4em;color:#1c2a3f;padding:2px 0 4px}.pin-button__image{width:100%;height:100%;background-size:50%;background-repeat:no-repeat;background-position:center}\n"],encapsulation:2,changeDetection:0}),t})(),Ea=(()=>{class t{constructor(){}onClick(e){e.stopPropagation(),e.stopImmediatePropagation()}onEnterUp(e){e.stopPropagation(),e.stopImmediatePropagation()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=i.lG2({type:t,selectors:[["","appEventFence",""]],hostBindings:function(e,o){1&e&&i.NdJ("click",function(r){return o.onClick(r,r.target)})("keyup.enter",function(r){return o.onEnterUp(r,r.target)})}}),t})();function $w(t,n){if(1&t&&(i.TgZ(0,"div",3),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.label," ")}}const Gw=function(t,n,e){return[t,n,e]};var hl=(()=>(function(t){t.Small="small",t.Medium="medium",t.Large="large",t.Huge="huge"}(hl||(hl={})),hl))(),ml=(()=>(function(t){t.Horizontal="horizontal",t.Vertical="vertical"}(ml||(ml={})),ml))(),fl=(()=>(function(t){t.Inline="inline",t.Block="block",t.Fill="fill"}(fl||(fl={})),fl))();let Da=(()=>{class t{constructor(){this.size=hl.Medium,this.label="",this.direction=ml.Horizontal,this.render=fl.Fill}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-spinner"]],inputs:{size:"size",label:"label",direction:"direction",render:"render"},decls:3,vars:6,consts:[[1,"spinner","spinner--horizontal",3,"ngClass"],[1,"spinner__circle"],["class","spinner__label",4,"ngIf"],[1,"spinner__label"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"div",1),i.YNc(2,$w,2,1,"div",2),i.qZA()),2&e&&(i.Q6J("ngClass",i.kEZ(2,Gw,"spinner--"+o.size,"spinner--"+o.render,"spinner--"+o.direction)),i.xp6(2),i.Q6J("ngIf",o.label.length))},dependencies:[f.mk,f.O5],styles:['@keyframes spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:14px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:16px}.spinner--horizontal[_ngcontent-%COMP%]{flex-direction:row}.spinner--vertical[_ngcontent-%COMP%]{align-items:center;flex-direction:column}.spinner--vertical[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{padding:8px 0 0}.spinner--inline[_ngcontent-%COMP%]{display:inline-flex}.spinner--block[_ngcontent-%COMP%]{display:flex}.spinner--fill[_ngcontent-%COMP%]{display:flex;height:100%}.spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:50%;border:2px solid rgba(16,24,35,.1);position:relative}.spinner__circle[_ngcontent-%COMP%]:after{animation:spinner .4s linear infinite;content:" ";border-radius:50%;border:2px solid transparent;border-top-color:#fff3;border-right-color:#10182333;box-sizing:border-box;position:absolute;display:block;width:14px;height:14px;top:-2px;left:-2px}.spinner__label[_ngcontent-%COMP%]{padding-left:8px;font-size:14px;text-transform:uppercase}.theme-dark[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#fff3}.theme-light[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#10182399}'],changeDetection:0}),t})();var Nr=(()=>(function(t){t.Normal="normal",t.Compact="compact"}(Nr||(Nr={})),Nr))(),En=A(5432),Rb=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Nb=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Jw=["image"],Hw=["imagePre"],Yw=["imagePost"],Ww=["imageContainer"];function Kw(t,n){if(1&t&&(i._UZ(0,"span",8),i.ALo(1,"markdown")),2&t){const e=i.oxw();i.Q6J("innerHTML",i.lcZ(1,1,e.label),i.oJD)}}function Xw(t,n){if(1&t&&i._UZ(0,"img",9,10),2&t){const e=i.oxw();i.Q6J("src",e.imageUrl,i.LSH)}}function eS(t,n){if(1&t&&i._UZ(0,"img",11,12),2&t){const e=i.oxw();i.Q6J("src",e.imageUrl,i.LSH)}}class Es{constructor(n,e,o){this.renderer=n,this.engineService=e,this.animationService=o,this.ngUnsubscribe=new X.x,this.loopImage=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,$.h)(n=>!!n.animation),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}initTimelineListener(){(0,Li.T)(this.engineService.getEvent(pe.TimelineScrubbed),this.engineService.getEvent(pe.TimelinePlaying)).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.getChapterPercent();this.moveImage(e)})}moveImage(n){const o=this.image.nativeElement.getBoundingClientRect().width;this.renderer.setStyle(this.imageContainer.nativeElement,"transform",`translate(${n/100*-o}px, 0)`),this.loopImage&&(this.renderer.setStyle(this.imagePre.nativeElement,"transform",`translate(${-o}px, 0)`),this.renderer.setStyle(this.imagePost.nativeElement,"transform",`translate(${o}px, 0)`))}getChapterPercent(){if((0,m.isNil)(this.timerange))return 0;const{firstTime:n,lastTime:e}=this.timerange,o=this.animationService.getTime();return Math.max(n,Math.min(o,e))/e*100}}function tS(t,n){if(1&t&&i._UZ(0,"app-ticker-block-item",3),2&t){const e=n.$implicit,o=i.oxw(2);i.Q6J("imageUrl",e.urls.default)("label",e.caption)("loopImage",o.tickerBlock.loopImage)}}function nS(t,n){if(1&t&&(i.TgZ(0,"div",1),i.YNc(1,tS,1,3,"app-ticker-block-item",2),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.tickerBlock.images)}}Es.\u0275fac=function(n){return new(n||Es)(i.Y36(i.Qsj),i.Y36(et),i.Y36(Un))},Es.\u0275cmp=i.Xpm({type:Es,selectors:[["app-ticker-block-item"]],viewQuery:function(n,e){if(1&n&&(i.Gf(Jw,7),i.Gf(Hw,5),i.Gf(Yw,5),i.Gf(Ww,7)),2&n){let o;i.iGM(o=i.CRH())&&(e.image=o.first),i.iGM(o=i.CRH())&&(e.imagePre=o.first),i.iGM(o=i.CRH())&&(e.imagePost=o.first),i.iGM(o=i.CRH())&&(e.imageContainer=o.first)}},inputs:{label:"label",imageUrl:"imageUrl",loopImage:"loopImage"},decls:8,vars:4,consts:[[1,"ticker-block-item"],["class","ticker-block-item__label html",3,"innerHTML",4,"ngIf"],[1,"ticker-block__image-container"],["imageContainer",""],["class","ticker-block-item__image ticker-block-item__image--pre",3,"src",4,"ngIf"],["class","ticker-block-item__image ticker-block-item__image--post",3,"src",4,"ngIf"],[1,"ticker-block-item__image",3,"src"],["image",""],[1,"ticker-block-item__label","html",3,"innerHTML"],[1,"ticker-block-item__image","ticker-block-item__image--pre",3,"src"],["imagePre",""],[1,"ticker-block-item__image","ticker-block-item__image--post",3,"src"],["imagePost",""]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,Kw,2,3,"span",1),i.TgZ(2,"div",2,3),i.YNc(4,Xw,2,1,"img",4),i.YNc(5,eS,2,1,"img",5),i._UZ(6,"img",6,7),i.qZA()()),2&n&&(i.xp6(1),i.Q6J("ngIf",e.label),i.xp6(3),i.Q6J("ngIf",e.loopImage),i.xp6(1),i.Q6J("ngIf",e.loopImage),i.xp6(1),i.Q6J("src",e.imageUrl,i.LSH))},dependencies:[f.O5,En.NO],styles:['.ticker-block-item[_ngcontent-%COMP%]{background:rgb(249,250,253);background:linear-gradient(90deg,rgb(249,250,253) 20%,rgba(255,255,255,0) 40%,rgb(255,255,255) 60%,rgb(249,250,253) 80%);overflow:hidden;padding-left:50%;position:relative}.ticker-block-item[_ngcontent-%COMP%]:hover   .ticker-block-item__label[_ngcontent-%COMP%]{background:rgba(255,255,255,.9)}.ticker-block-item[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;left:50%;top:0;height:100%;width:1px;background:rgb(255,0,0);box-shadow:0 0 0 4px #f003;z-index:10}.ticker-block-item__label[_ngcontent-%COMP%]{position:absolute;z-index:10;left:4px;top:4px;border-radius:8px;padding:2px 6px;font-size:12px;border:1px solid rgba(16,24,35,.5);background:rgba(255,255,255,.55)}.ticker-block-item__image-container[_ngcontent-%COMP%]{position:relative}.ticker-block-item__image[_ngcontent-%COMP%]{display:block}.ticker-block-item__image--pre[_ngcontent-%COMP%], .ticker-block-item__image--post[_ngcontent-%COMP%]{position:absolute;top:0;left:0}'],changeDetection:0}),Rb([(0,l.Ph)(M.getAnimationPlaying),Nb("design:type",b.y)],Es.prototype,"animationPlaying$",void 0),Rb([(0,l.Ph)(_.getSelectedChapterReadyState),Nb("design:type",b.y)],Es.prototype,"chapterReadyState$",void 0);let iS=(()=>{class t{constructor(){this.ngUnsubscribe=new X.x}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-ticker-block"]],inputs:{tickerBlock:"tickerBlock"},decls:1,vars:1,consts:[["class","ticker-block",4,"ngIf"],[1,"ticker-block"],[3,"imageUrl","label","loopImage",4,"ngFor","ngForOf"],[3,"imageUrl","label","loopImage"]],template:function(e,o){1&e&&i.YNc(0,nS,2,1,"div",0),2&e&&i.Q6J("ngIf",o.tickerBlock)},dependencies:[f.sg,f.O5,Es],changeDetection:0}),t})(),bl=(()=>{class t{constructor(e,o){this.domSanitizer=e,this.markdownService=o}set html(e){this.safeHTML=this.domSanitizer.bypassSecurityTrustHtml(e||"")}set markdownText(e){this.html=this.markdownService.parse(e)}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(ys.H7),i.Y36(En.Zy))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-html"]],inputs:{html:"html",markdownText:"markdownText"},decls:1,vars:1,consts:[[1,"html",3,"innerHTML"]],template:function(e,o){1&e&&i._UZ(0,"div",0),2&e&&i.Q6J("innerHTML",o.safeHTML,i.oJD)},encapsulation:2,changeDetection:0}),t})(),oS=(()=>{class t{constructor(){this.layout=Nr.Normal}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-markdown-block"]],inputs:{markdownBlock:"markdownBlock",layout:"layout"},decls:2,vars:1,consts:[[1,"markdown-block"],[3,"markdownText"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"app-html",1),i.qZA()),2&e&&(i.xp6(1),i.Q6J("markdownText",o.markdownBlock.markdown))},dependencies:[bl],encapsulation:2,changeDetection:0}),t})();var Gt=A(266);function sS(t,n){1&t&&(i.TgZ(0,"div",4),i._UZ(1,"app-spinner",5),i.qZA())}let rS=(()=>{class t{constructor(e,o,s){this.dialogRef=e,this.data=o,this.changeRef=s,this.config=o}ngOnInit(){}handleCloseClick(){this.dialogRef.close()}handleImageLoaded(){this.imageLoaded=!0,this.changeRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.so),i.Y36(He.WI),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-image-dialog"]],decls:4,vars:7,consts:[["role","dialog","aria-modal","true",1,"image-dialog",3,"click","keyup.enter"],["class","image-dialog__loading flex flex-column p-8",4,"ngIf"],[1,"image-dialog__image",3,"src","title","alt","load"],["type","button","app-pin-button","","buttonType","dark","size","large","icon","times","aria-label","Close","matTooltip","Close","matTooltipPosition","left",1,"image-dialog__close"],[1,"image-dialog__loading","flex","flex-column","p-8"],["size","huge"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.NdJ("click",function(){return o.handleCloseClick()})("keyup.enter",function(){return o.handleCloseClick()}),i.YNc(1,sS,2,0,"div",1),i.TgZ(2,"img",2),i.NdJ("load",function(){return o.handleImageLoaded()}),i.qZA(),i._UZ(3,"button",3),i.qZA()),2&e&&(i.uIk("aria-label",(o.config.title||o.config.alt||"")+" Image Dialog"),i.xp6(1),i.Q6J("ngIf",!o.imageLoaded),i.xp6(1),i.Q6J("src",o.config.src,i.LSH)("title",o.config.title||"")("alt",o.config.alt||""),i.uIk("aria-label",o.config.title||""),i.xp6(1),i.uIk("aria-label","Close Dialog"))},dependencies:[f.O5,Gt.gM,In,Da],styles:[".image-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.image-dialog__loading[_ngcontent-%COMP%]{position:absolute}.image-dialog__image[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}.image-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;right:24px}"],changeDetection:0}),t})();var yi=(()=>(function(t){t.AboutDialog="AboutDialog",t.AddTeamModelDialog="AddTeamModelDialog",t.AssignUserRoleDialog="AssignUserRoleDialog",t.BulkUpdateDialog="BulkUpdateDialog",t.BookmarkAccessDialog="BookmarkAccessDialog",t.ClipboardDialog="ClipboardDialog",t.ShareUrlDialog="ShareUrlDialog",t.ConfirmDialog="ConfirmDialog",t.ContactDialog="ContactDialog",t.GroupRestrictionDialog="GroupRestrictionDialog",t.ImageDialog="ImageDialog",t.ImportDialog="ImportDialog",t.JoinDomainDialog="JoinDomainDialog",t.LimitDialog="LimitDialog",t.ManageDialog="ManageDialog",t.PremiumContentDialog="PremiumContentDialog",t.PricingDialog="PricingDialog",t.ProfileDialog="ProfileDialog",t.QuizSettingsDialog="QuizSettingsDialog",t.SaveAsBookmarkDialog="SaveAsBookmarkDialog",t.SaveBookmarkDialog="SaveBookmarkDialog",t.SaveModuleDialog="SaveModuleDialog",t.TransferUserContentDialog="TransferUserContentDialog",t.RemoveUserDialog="RemoveUserDialog",t.MergeModuleDialog="MergeModuleDialog",t.MergeConflictDialog="MergeConflictDialog",t.WelcomeTourDialog="WelcomeTourDialog",t.TrialExpiredDialog="TrialExpiredDialog",t.PremiumAccessDialog="PremiumAccessDialog",t.ConfirmRoleDialog="ConfirmRoleDialog",t.CollectionNameDialog="CollectionNameDialog",t.PublicViewGateDialog="PublicViewGateDialog"}(yi||(yi={})),yi))();const aS=["imageView"];let cS=(()=>{class t{constructor(e){this.dialog=e,this.fit="normal",this.fullscreenEnabled=!1}handleFullscreen(e){this.dialog.open(rS,{id:yi.ImageDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{src:this.fullscreenSrc||this.src,alt:this.alt||""}}),e.stopPropagation()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.uw))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-image-view"]],viewQuery:function(e,o){if(1&e&&i.Gf(aS,7),2&e){let s;i.iGM(s=i.CRH())&&(o.imageView=s.first)}},inputs:{fit:"fit",fitSize:"fitSize",src:"src",fullscreenSrc:"fullscreenSrc",alt:"alt"},decls:7,vars:8,consts:[["role","button","tabindex","0","matTooltip","Expand",1,"image-view",3,"click","keyup.enter"],["imageView",""],[1,"visually-hidden"],[1,"image-view__image",3,"src"],["aria-hidden","true",1,"image-view__overlay"],["icon","expand-alt",1,"image-view__icon"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0,1),i.NdJ("click",function(r){return o.handleFullscreen(r)})("keyup.enter",function(r){return o.handleFullscreen(r)}),i.TgZ(2,"span",2),i._uU(3,"Click to expand the image"),i.qZA(),i._UZ(4,"img",3),i.TgZ(5,"div",4),i._UZ(6,"app-icon",5),i.qZA()()),2&e&&(i.ekj("image-view--auto-fit","auto"===o.fit),i.xp6(4),i.Udp("max-width","auto"===o.fit&&o.fitSize?o.fitSize+"px":"100%")("max-height","auto"===o.fit&&o.fitSize?o.fitSize+"px":"100%"),i.Q6J("src",o.src,i.LSH),i.uIk("alt",o.alt))},dependencies:[lt,Gt.gM],styles:[".image-view[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:inherit;min-height:32px;position:relative;background-color:#f9fafd}.image-view__image[_ngcontent-%COMP%]{width:auto;height:auto}.image-view--auto-fit[_ngcontent-%COMP%]   .image-view__image[_ngcontent-%COMP%]{max-width:100%;height:auto}.image-view__overlay[_ngcontent-%COMP%]{background:rgba(28,42,63,.3);color:#fff;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px;position:absolute;inset:0;opacity:0;transition:opacity .25s}.image-view__icon[_ngcontent-%COMP%]{text-shadow:0 0 2px rgba(0,0,0,.6)}.image-view[_ngcontent-%COMP%]:hover{cursor:pointer}.image-view[_ngcontent-%COMP%]:hover   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}.image-view[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.image-view[_ngcontent-%COMP%]:focus   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),t})();function lS(t,n){if(1&t&&(i.TgZ(0,"div",6),i._UZ(1,"app-image-view",7),i.qZA()),2&t){const e=i.oxw(2);i.ekj("mb-3",e.currentImage.caption),i.xp6(1),i.Q6J("src",e.currentImage.urls.small)("fullscreenSrc",e.currentImage.urls.default)("alt",e.currentImage.alt)("fit",e.fit)("fitSize",e.fitSize)}}function pS(t,n){if(1&t&&i._UZ(0,"app-html",8),2&t){const e=i.oxw(2);i.Q6J("markdownText",e.currentImage.caption)}}function dS(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",9)(1,"button",10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePrevClick())}),i.qZA(),i.TgZ(2,"button",11),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleNextClick())}),i.qZA()()}}function uS(t,n){if(1&t&&(i.TgZ(0,"div",1)(1,"div",2),i.YNc(2,lS,2,7,"div",3),i.YNc(3,pS,1,1,"app-html",4),i.YNc(4,dS,3,0,"div",5),i.qZA()()),2&t){const e=i.oxw();i.ekj("images-block--slideshow",e.images&&e.images.length>1),i.xp6(2),i.Q6J("ngIf",e.currentImage.urls),i.xp6(1),i.Q6J("ngIf",e.currentImage.caption),i.xp6(1),i.Q6J("ngIf",e.images.length>1)}}let hS=(()=>{class t{constructor(){this.layout=Nr.Normal}get imagesBlock(){return this._imagesBlock}set imagesBlock(e){this._imagesBlock=e;const o=(0,m.get)(e,"images",[]);o.length&&(this.images=o,this.currentImage=this.images[0])}get fit(){return"compact"===this.layout?"auto":"normal"}get fitSize(){return"compact"===this.layout?100:void 0}ngOnInit(){}handlePrevClick(){let e=this.getCurrentImageIndex();e--,e<0&&(e=this.images.length-1),this.currentImage=this.images[e]}handleNextClick(){let e=this.getCurrentImageIndex();e++,e>=this.images.length&&(e=0),this.currentImage=this.images[e]}getCurrentImageIndex(){return this.images.indexOf(this.currentImage)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-images-block"]],inputs:{imagesBlock:"imagesBlock",layout:"layout"},decls:1,vars:1,consts:[["class","images-block",3,"images-block--slideshow",4,"ngIf"],[1,"images-block"],[1,"images-block__content"],["class","images-block__image-container",3,"mb-3",4,"ngIf"],["class","images-block__caption",3,"markdownText",4,"ngIf"],["class","images-block__actions",4,"ngIf"],[1,"images-block__image-container"],[1,"images-block__image-view",3,"src","fullscreenSrc","alt","fit","fitSize"],[1,"images-block__caption",3,"markdownText"],[1,"images-block__actions"],["type","button","app-pin-button","","icon","chevron-left","size","small","buttonType","ghost","matTooltip","Previous Image","aria-label","Previous Image",3,"click"],["type","button","app-pin-button","","icon","chevron-right","size","small","buttonType","ghost","matTooltip","Next Image","aria-label","Next Image",3,"click"]],template:function(e,o){1&e&&i.YNc(0,uS,5,5,"div",0),2&e&&i.Q6J("ngIf",o.currentImage)},dependencies:[f.O5,In,bl,cS,Gt.gM],styles:[".images-block__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.images-block__label{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;color:#374a68;font-weight:600;display:flex;align-items:center;min-height:28px}.images-block__image-container{display:flex;justify-content:center;background-color:#f9fafd}.images-block__image-view{display:flex;height:100%;min-height:32px}.images-block__caption{font-size:12px;margin-top:12px}.images-block__actions{display:flex;justify-content:flex-end;margin-top:14px}.images-block--slideshow .images-block__image-container{height:200px}\n"],encapsulation:2,changeDetection:0}),t})();function mS(t,n){if(1&t&&i._UZ(0,"app-ticker-block",6),2&t){const e=i.oxw().$implicit;i.Q6J("tickerBlock",e)}}function fS(t,n){if(1&t&&i._UZ(0,"app-markdown-block",7),2&t){const e=i.oxw().$implicit,o=i.oxw(2);i.Q6J("markdownBlock",e)("layout",o.layout)}}function bS(t,n){if(1&t&&i._UZ(0,"app-images-block",8),2&t){const e=i.oxw().$implicit,o=i.oxw(2);i.Q6J("imagesBlock",e)("layout",o.layout)}}function yS(t,n){if(1&t&&(i.TgZ(0,"div"),i.ynx(1,2),i.YNc(2,mS,1,1,"app-ticker-block",3),i.YNc(3,fS,1,2,"app-markdown-block",4),i.YNc(4,bS,1,2,"app-images-block",5),i.BQk(),i.qZA()),2&t){const e=n.$implicit;i.ekj("mv-2",n.index>0),i.xp6(1),i.Q6J("ngSwitch",e.type),i.xp6(1),i.Q6J("ngSwitchCase","ticker"),i.xp6(1),i.Q6J("ngSwitchCase","markdown"),i.xp6(1),i.Q6J("ngSwitchCase","images")}}function _S(t,n){if(1&t&&(i.ynx(0),i.YNc(1,yS,5,6,"div",1),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.contentBlocks)}}let ja=(()=>{class t{constructor(){this._contentBlocks=[],this.layout=Nr.Normal,this.include=[],this.exclude=[]}get contentBlocks(){return this._contentBlocks.filter(e=>!this.include.length||this.include.includes(e.type)).filter(e=>!this.exclude.length||!this.exclude.includes(e.type))}set contentBlocks(e){this._contentBlocks=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-content-blocks"]],inputs:{contentBlocks:"contentBlocks",layout:"layout",include:"include",exclude:"exclude"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"mv-2",4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"tickerBlock",4,"ngSwitchCase"],[3,"markdownBlock","layout",4,"ngSwitchCase"],[3,"imagesBlock","layout",4,"ngSwitchCase"],[3,"tickerBlock"],[3,"markdownBlock","layout"],[3,"imagesBlock","layout"]],template:function(e,o){1&e&&i.YNc(0,_S,2,1,"ng-container",0),2&e&&i.Q6J("ngIf",o.contentBlocks.length>0)},dependencies:[f.sg,f.O5,f.RF,f.n9,iS,oS,hS],encapsulation:2,changeDetection:0}),t})();var W=A(4006),Ei=(()=>(function(t){t.Dark="dark",t.Light="light",t.Themed="themed"}(Ei||(Ei={})),Ei))();const xS=["app-button",""],vS=function(t,n,e,o,s,r,a,c,p,d,u,g,h,y,k,B,K,V,ge,F,R,D,I,ce){return{"app-button--xsmall":t,"app-button--small":n,"app-button--medium":e,"app-button--large":o,"app-button--flat":s,"app-button--default":r,"app-button--primary":a,"app-button--white":c,"app-button--info":p,"app-button--outline":d,"app-button--text":u,"app-button--light":g,"app-button--dark":h,"app-button--themed":y,"app-button--circle":k,"app-button--rounded":B,"app-button--square":K,"app-button--selected":V,"app-button--uppercase":ge,"app-button--disabled":F,"app-button--no-border":R,"app-button--expanded":D,"app-button--left":I,"app-button--loading":ce}},CS=["*"];var yl=(()=>(function(t){t.XSmall="xsmall",t.Small="small",t.Medium="medium",t.Large="large"}(yl||(yl={})),yl))(),_l=(()=>(function(t){t.Default="default",t.Flat="flat",t.Primary="primary",t.Info="info",t.Outline="outline",t.Text="text",t.White="white"}(_l||(_l={})),_l))(),xl=(()=>(function(t){t.Default="default",t.Circle="circle",t.Rounded="rounded",t.Square="square"}(xl||(xl={})),xl))(),vl=(()=>(function(t){t.Left="left",t.Center="center"}(vl||(vl={})),vl))();let Dn=(()=>{class t{constructor(){this.buttonSize=yl.Medium,this.buttonType=_l.Default,this.buttonTheme=Ei.Dark,this.buttonShape=xl.Default,this.buttonAlign=vl.Center,this.uppercase=!0,this.selected=!1,this.expanded=!1,this.loading=!1,this.bordered=!0}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["button","app-button",""],["a","app-button",""]],hostVars:1,hostBindings:function(e,o){2&e&&i.Ikx("disabled",o.disabled)},inputs:{buttonSize:"buttonSize",buttonType:"buttonType",buttonTheme:"buttonTheme",buttonShape:"buttonShape",buttonAlign:"buttonAlign",uppercase:"uppercase",selected:"selected",expanded:"expanded",loading:"loading",disabled:"disabled",bordered:"bordered"},attrs:xS,ngContentSelectors:CS,decls:3,vars:26,consts:[[1,"app-button",3,"ngClass"],[1,"app-button__container"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"span",0)(1,"span",1),i.Hsn(2),i.qZA()()),2&e&&i.Q6J("ngClass",i.rFY(1,vS,["xsmall"==o.buttonSize,"small"==o.buttonSize,"medium"==o.buttonSize,"large"==o.buttonSize,"flat"==o.buttonType,"default"==o.buttonType,"primary"==o.buttonType,"white"==o.buttonType,"info"==o.buttonType,"outline"==o.buttonType,"text"==o.buttonType,"light"==o.buttonTheme,"dark"==o.buttonTheme,"themed"==o.buttonTheme,"circle"==o.buttonShape,"rounded"==o.buttonShape,"square"==o.buttonShape,o.selected,o.uppercase,o.disabled,!o.bordered,o.expanded,"left"===o.buttonAlign,o.loading]))},dependencies:[f.mk],styles:['.text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}a[app-button],button[app-button]{border-color:transparent;background:none;border-width:0;padding:0;margin:0;border-radius:4px;outline:0 none}a[app-button]:not([disabled]):hover,button[app-button]:not([disabled]):hover{cursor:pointer}a[app-button]:focus .app-button,button[app-button]:focus .app-button{outline:#2d72dc solid 2px!important}.app-button{font-size:13px;letter-spacing:.325px;line-height:1.4em;align-items:center;border-radius:4px;display:flex;font-family:Inter UI,sans-serif;justify-content:center;padding:0 16px;position:relative;text-align:center;transition:background-color .12s;width:100%}.app-button:after{content:" ";background-color:#283853;border-radius:4px;display:block;position:absolute;inset:0;opacity:0;z-index:1;transition:opacity .06s}.app-button:not(.app-button--disabled):hover:after{opacity:.7}.app-button__container{position:relative;z-index:2;width:100%}.app-button--uppercase{text-transform:uppercase}.app-button--expanded{display:flex;flex:1}.app-button--xsmall{height:24px;min-width:24px;padding:0 8px;font-size:10px;letter-spacing:.25px;line-height:1.4em}.app-button--small{height:32px;min-width:32px;padding:0 12px;font-size:13px;letter-spacing:.325px;line-height:1.4em}.app-button--medium{height:36px;min-width:36px;padding:0 16px;font-size:13px;letter-spacing:.325px;line-height:1.4em}.app-button--large{height:48px;min-width:48px;padding:0 16px;font-size:14px;letter-spacing:.35px;line-height:1.4em}.app-button--no-border{border-radius:0!important}.app-button--no-border:after{border-radius:0!important}.app-button--left{text-align:left}.app-button--themed{color:#374a68}.app-button--themed:hover{color:#1c2a3f}.app-button--themed:after{background-color:#d7e0ea}.app-button--dark{color:#d7e0ea}.app-button--dark:hover{color:#fff}.app-button--dark:after{background-color:#283853}.app-button--dark.app-button--flat{background:#374a68}.app-button--dark.app-button--default{background:transparent}.app-button--dark.app-button--outline{background:transparent;border:1px solid #374a68;transition:border-color .12s}.app-button--dark.app-button--outline:hover{border-color:#96a8c0}.app-button--dark.app-button--outline:hover:after{background-color:transparent;display:none}.app-button--dark.app-button--text{background:transparent;color:#d7e0ea}.app-button--dark.app-button--text:hover{color:#fff}.app-button--dark.app-button--text:hover:after{display:none}.app-button--dark.app-button--selected{background-color:#2d72dc;color:#fff}.app-button--dark.app-button--selected:hover:after{display:none}.app-button--light{color:#283853}.app-button--light:hover{color:#1c2a3f}.app-button--light:after{background-color:#96a8c0}.app-button--light:not(.app-button--disabled):hover:after{opacity:.6}.app-button--light::-moz-focus-inner{border:0}.app-button--light:not([disabled]):hover{cursor:pointer}.app-button--light[disabled]{pointer-events:none}.app-button--light.app-button--flat{background:#d7e0ea;font-weight:500}.app-button--light.app-button--flat.app-button--selected{background-color:#96a8c0}.app-button--light.app-button--default{background:transparent;color:#131c2a}.app-button--light.app-button--default:not(.app-button--disabled):hover:after{opacity:.2}.app-button--light.app-button--outline{background:transparent;border:1px solid #96a8c0;color:#283853;transition:border-color .12s}.app-button--light.app-button--outline:after{display:none}.app-button--light.app-button--outline:hover{background:rgba(55,74,104,.05);border-color:#374a68;color:#1c2a3f}.app-button--light.app-button--outline:hover:after{background-color:transparent}.app-button--light.app-button--selected{background-color:#eaeff5}.app-button--light.app-button--selected:hover:after{display:none}.app-button--light.app-button--text{color:#283853}.app-button--light.app-button--text:hover{color:#1c2a3f}.app-button--light.app-button--text:hover:after{display:none}.app-button.app-button--primary{background:#de3535;color:#fff}.app-button.app-button--primary:after{background:#f9fafd}.app-button.app-button--primary:hover:after{opacity:.1}.app-button.app-button--white{background:white;color:#283853;transition:border-color .12s}.app-button.app-button--white:hover{border-color:#96a8c0}.app-button.app-button--white:hover:after{background-color:#131c2a;display:none}.app-button.app-button--info{background:#2d72dc;color:#fff}.app-button.app-button--info:after{background:#f9fafd}.app-button.app-button--info:hover:after{opacity:.1}.app-button--selected{background-color:#2d72dc}.app-button--disabled:not(.app-button--loading){opacity:.5}.app-button--loading{background-color:#eaeff5!important;color:#61779e!important}.app-button--circle{border-radius:50%}.app-button--circle.app-button--xsmall{width:24px}.app-button--circle.app-button--small{width:32px;padding:0 6px}.app-button--circle.app-button--medium{width:36px;padding:0 8px}.app-button--circle.app-button--large{width:48px}.app-button--circle:after{border-radius:50%}.app-button--square{padding:0}.app-button--square.app-button--xsmall{width:24px;height:24px}.app-button--square.app-button--small{width:32px;height:32px}.app-button--square.app-button--medium{width:36px;height:36px}.app-button--square.app-button--large{width:48px;height:48px}.app-button--rounded{border-radius:18px}.app-button--rounded:after{border-radius:18px}\n'],encapsulation:2,changeDetection:0}),t})();var Cl=A(1948);const wS=[[["app-list-item"]]],SS=["app-list-item"];var wl=(()=>(function(t){t.Default="default",t.Commafied="commafied",t.flat="flat",t.inline="inline"}(wl||(wl={})),wl))();let PS=(()=>{class t{constructor(){this.listType=wl.Default}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-list"]],inputs:{listType:"listType"},ngContentSelectors:SS,decls:2,vars:1,consts:[[1,"list",3,"ngClass"]],template:function(e,o){1&e&&(i.F$t(wS),i.TgZ(0,"div",0),i.Hsn(1),i.qZA()),2&e&&i.Q6J("ngClass","list--"+o.listType)},dependencies:[f.mk],styles:['.list{display:flex;flex-direction:column}.list--default app-list-item{display:list-item;margin-left:16px;list-style-type:disc}.list--commafied{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--commafied app-list-item:not(:last-child):after{content:", ";float:right;padding-right:4px}.list--flat app-list-item:not(:last-child){margin-bottom:4px}.list--inline{display:inline-flex;align-items:center;display:flex;flex-direction:row;flex-wrap:wrap}.list--inline app-list-item{margin:0 8px 4px 0}.list__item{display:block}\n'],encapsulation:2,changeDetection:0}),t})();const kS=["*"];let OS=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-list-item"]],ngContentSelectors:kS,decls:1,vars:0,template:function(e,o){1&e&&(i.F$t(),i.Hsn(0))},encapsulation:2,changeDetection:0}),t})();function TS(t,n){if(1&t&&(i.TgZ(0,"app-list-item")(1,"div",1),i._uU(2),i.qZA()()),2&t){const e=n.$implicit;i.xp6(1),i.uIk("data-id",e.id),i.xp6(1),i.Oqu(e.label)}}let Eb=(()=>{class t{constructor(e,o,s){this.store=e,this.graphService=o,this.changeRef=s}get objectIds(){return this._objectIds}set objectIds(e){this._objectIds=e;const o=this.store.selectSnapshot(M.getViewGraph);this.nodes=this.graphService.getNodes(o,e),this.changeRef.markForCheck()}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(Oi),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-object-tree"]],inputs:{objectIds:"objectIds"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"text-14","text-medium","mv-1"]],template:function(e,o){1&e&&(i.TgZ(0,"app-list"),i.YNc(1,TS,3,2,"app-list-item",0),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngForOf",o.nodes))},dependencies:[f.sg,PS,OS],changeDetection:0}),t})(),IS=(()=>{class t{constructor(e){this.controlContainer=e}get control(){return this.formControl||this.controlContainer.control.get(this.formControlName)}registerOnTouched(e){this.formControlDirective.valueAccessor.registerOnTouched(e)}registerOnChange(e){this.formControlDirective.valueAccessor.registerOnChange(e)}writeValue(e){this.formControlDirective.valueAccessor.writeValue(e)}setDisabledState(e){this.formControlDirective.valueAccessor.setDisabledState(e)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(W.gN))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-base-accessor-control"]],viewQuery:function(e,o){if(1&e&&i.Gf(W.oH,7),2&e){let s;i.iGM(s=i.CRH())&&(o.formControlDirective=s.first)}},inputs:{formControl:"formControl",formControlName:"formControlName"},decls:0,vars:0,template:function(e,o){},encapsulation:2}),t})(),zS=(()=>{class t{constructor(){}get value(){return this._value}set value(e){(0,m.isEqual)(this._value,e)||(this._value=e,this.setFormValues(e),this.onChange(e))}onChange(e){}onTouched(){}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}writeValue(e){this.value=e}setDisabledState(e){this.disabled=e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-abstract-input-control"]],inputs:{value:"value",disabled:"disabled"},decls:0,vars:0,template:function(e,o){},encapsulation:2}),t})();function AS(t,n){if(1&t&&(i.TgZ(0,"option",9),i._uU(1),i.qZA()),2&t){const e=n.$implicit;i.Q6J("value",e.value),i.xp6(1),i.hij(" ",e.label.title," ")}}function LS(t,n){if(1&t&&(i.TgZ(0,"select",6)(1,"option",7),i._uU(2,"Select"),i.qZA(),i.YNc(3,AS,2,2,"option",8),i.qZA()),2&t){const e=i.oxw();i.xp6(3),i.Q6J("ngForOf",e.options)}}let Db=(()=>{class t extends zS{constructor(e,o){super(),this.formBuilder=e,this.changeRef=o,this.outline=!0,this.valueChange=new i.vpe,this.ngUnsubscribe=new X.x,this.form=this.formBuilder.group({value:[""]}),this.valueControl=this.form.get("value")}get options(){return this._options}set options(e){const o=(0,m.clone)(e);this._options=o.sort((s,r)=>s.label.title.localeCompare(r.label.title)),this.changeRef.markForCheck()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(({value:e})=>{this.writeValue(e),this.valueChange.next(e)})}setDisabledState(e){super.setDisabledState(e),e?this.form.disable():this.form.enable(),this.changeRef.markForCheck()}setFormValues(e){this.valueControl.setValue(e),this.changeRef.markForCheck()}getSelectedOption(){const e=this.valueControl.value;return this.options.find(o=>o.value===e)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(W.QS),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-quiz-label-anatomy-select"]],inputs:{options:"options",outline:"outline"},outputs:{valueChange:"valueChange"},features:[i._Bn([{provide:W.JU,useExisting:(0,i.Gpc)(()=>t),multi:!0}]),i.qOj],decls:7,vars:5,consts:[[1,"label",3,"formGroup"],[1,"label__select-label","flex","text-12"],[1,"flex","justify-between","p-2","flex-auto"],[1,"mr-2"],["icon","caret-down","size","lg"],["class","input label__select","placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",4,"ngIf"],["placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",1,"input","label__select"],["value","","data-test","questionAnswerOption"],["class","label__option","data-test","questionAnswerOption",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswerOption",1,"label__option",3,"value"]],template:function(e,o){if(1&e&&(i.TgZ(0,"div",0)(1,"label",1)(2,"div",2)(3,"div",3),i._uU(4),i.qZA(),i._UZ(5,"app-icon",4),i.qZA(),i.YNc(6,LS,4,1,"select",5),i.qZA()()),2&e){let s;i.ekj("label--empty",""===o.valueControl.value),i.Q6J("formGroup",o.form),i.xp6(4),i.Oqu((null==(s=o.getSelectedOption())||null==s.label?null:s.label.title)||"Select"),i.xp6(2),i.Q6J("ngIf",!o.disabled)}},dependencies:[f.sg,f.O5,lt,W.YN,W.Kr,W.EJ,W.JJ,W.JL,W.sg,W.u],styles:[".label[_ngcontent-%COMP%]{overflow:hidden}.label__select-label[_ngcontent-%COMP%]{color:#101823;position:relative}.label__select[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;opacity:.01}.label--empty[_ngcontent-%COMP%]   .label__select-label[_ngcontent-%COMP%]{color:#96a8c0}"],changeDetection:0}),t})(),jb=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-answer-number"]],inputs:{number:"number"},decls:3,vars:1,consts:[[1,"number","text-10","text-medium"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div"),i._uU(2),i.qZA()()),2&e&&(i.xp6(2),i.Oqu(o.number))},styles:[".number[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:#131c2a;border:1px solid rgba(55,74,104,.5);border-radius:50%}"],changeDetection:0}),t})();function RS(t,n){if(1&t&&(i.TgZ(0,"div",3)(1,"div",4),i._UZ(2,"app-view-quiz-answer-number",5),i.qZA(),i.TgZ(3,"div",6),i._UZ(4,"app-quiz-label-anatomy-select",7),i.qZA()()),2&t){const e=n.index,o=i.oxw();i.xp6(2),i.Q6J("number",e+1),i.xp6(2),i.Q6J("options",o.options)("formControlName",e)}}class Er{constructor(n){this.formBuilder=n,this.valueChange=new i.vpe,this.ngUnsubscribe=new X.x,this._options=[],this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}get options(){return this._options}set options(n){(0,m.isEqual)(n,this._options)||(this._options=n,this.buildFormOptions(n))}ngOnInit(){this.initFormListeners(),this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(({options:n})=>{this.valueChange.next(n)})}init(){this.activeSubmission$.pipe((0,$.h)(n=>!(0,m.isNil)(n)&&!(0,m.isNil)(n.answer)),(0,Ao.G)(),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{const o=function MS(t,n,e){const o=n.findIndex((r,a)=>!(0,m.isEqual)(t[a],r)),s=n[o];return n.map((r,a)=>(0,m.isEqual)(s,r)&&a!==o?e:r)}(n.answer||[],e.answer||[],"");(0,m.isEqual)(e,o)||this.form.patchValue({options:o||[]})}),this.activeSubmission$.pipe((0,$.h)(n=>!(0,m.isNil)(n)&&!(0,m.isNil)(n.answer)&&Array.isArray(n.answer)),(0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const o=n.answer;(0,m.isEqual)(this.form.value.options,o)||this.form.patchValue({options:o},{emitEvent:!1,onlySelf:!0})})}buildFormOptions(n){this.optionsArray.clear(),n.forEach(()=>{this.optionsArray.push(this.formBuilder.control(""))}),this.optionsArray.setValue(n.map(()=>""))}}Er.\u0275fac=function(n){return new(n||Er)(i.Y36(W.QS))},Er.\u0275cmp=i.Xpm({type:Er,selectors:[["app-view-quiz-label-anatomy"]],inputs:{options:"options"},outputs:{valueChange:"valueChange"},decls:3,vars:2,consts:[[1,"options",3,"formGroup"],["formArrayName","options"],["class","options__item mb-4","data-test","questionAnswer",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"options__item","mb-4"],[1,"mr-2"],[3,"number"],[1,"options__item-select"],[3,"options","formControlName"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,RS,5,3,"div",2),i.qZA()()),2&n&&(i.Q6J("formGroup",e.form),i.xp6(2),i.Q6J("ngForOf",e.options))},dependencies:[f.sg,W.JJ,W.JL,W.sg,W.u,W.CE,Db,jb],styles:[".options__item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.options__item-select[_ngcontent-%COMP%]{border:1px solid #96a8c0;border-radius:4px;flex:1 1 auto}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(U.getActiveSubmission),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],Er.prototype,"activeSubmission$",void 0);var Qb=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Zb=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function NS(t,n){if(1&t&&(i.TgZ(0,"mat-radio-button",8),i._uU(1),i.qZA()),2&t){const e=n.$implicit;i.Q6J("value",e.value),i.xp6(1),i.hij(" ",e.label," ")}}function ES(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div")(1,"mat-radio-group",6),i.NdJ("change",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleMultipleChoiceChange(s))}),i.YNc(2,NS,2,2,"mat-radio-button",7),i.qZA()()}if(2&t){const e=i.oxw(2);i.xp6(2),i.Q6J("ngForOf",e.question.data.options)}}function DS(t,n){if(1&t&&(i.TgZ(0,"div",10),i._UZ(1,"app-view-quiz-object-tree",11),i.qZA()),2&t){const e=i.oxw(3);i.xp6(1),i.Q6J("objectIds",e.question.data.correctAnswer)}}function jS(t,n){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,DS,2,1,"div",9),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.question.data.showAnswerList)}}function QS(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div")(1,"app-view-quiz-label-anatomy",12),i.NdJ("valueChange",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleLabelAnatomyChanges(s))}),i.qZA()()}if(2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("options",e.question.data.options)}}function ZS(t,n){if(1&t&&(i.TgZ(0,"div",1)(1,"div",2),i._UZ(2,"app-content-blocks",3),i.qZA(),i.TgZ(3,"div",4),i.YNc(4,ES,3,1,"div",5),i.YNc(5,jS,2,1,"div",5),i.YNc(6,QS,2,1,"div",5),i.qZA()()),2&t){const e=i.oxw();i.xp6(2),i.Q6J("contentBlocks",e.question.questionPrompt),i.xp6(1),i.Q6J("ngSwitch",e.question.type),i.xp6(1),i.Q6J("ngSwitchCase",e.QuestionType.MultipleChoice),i.xp6(1),i.Q6J("ngSwitchCase",e.QuestionType.SelectAnatomy),i.xp6(1),i.Q6J("ngSwitchCase",e.QuestionType.LabelAnatomy)}}class ss{constructor(n,e){this.changeRef=n,this.viewService=e,this.disabled=!1,this.QuestionType=Re,this.ngUnsubscribe=new X.x}get question(){return this._question}set question(n){this._question=n,this.initQuestionListeners()}get value(){return this._value}set value(n){this._value=n,this.onChange(n)}handleMultipleChoiceChange(n){this.writeValue(n.value)}handleLabelAnatomyChanges(n){this.writeValue(n)}ngOnInit(){}initQuestionListeners(){switch(this.question.type){case Re.SelectAnatomy:this.initSelectAnatomyListeners(),this.viewService.toggleToolbar("tools");break;case Re.Instructions:this.initInstructions(),this.viewService.toggleToolbar("none");break;default:this.viewService.toggleToolbar("none")}}initSelectAnatomyListeners(){this.checkedNodesIds$.pipe((0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.writeValue(n),this.changeRef.markForCheck()})}initInstructions(){setTimeout(()=>{this.writeValue("-"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onChange(n){}onTouched(){}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}writeValue(n){this.value=n}setDisabledState(n){this.disabled=n}}function BS(t,n){if(1&t&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" of ",e.total,"")}}ss.\u0275fac=function(n){return new(n||ss)(i.Y36(i.sBO),i.Y36(ut))},ss.\u0275cmp=i.Xpm({type:ss,selectors:[["app-view-quiz-question"]],inputs:{question:"question",value:"value"},features:[i._Bn([{provide:W.JU,useExisting:(0,i.Gpc)(()=>ss),multi:!0}])],decls:1,vars:1,consts:[["class","view-quiz-question text-14 mb-8","data-test","question",4,"ngIf"],["data-test","question",1,"view-quiz-question","text-14","mb-8"],["data-test","questionPrompt",1,"view-quiz-question__prompt","mb-4"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"flex","flex-column",3,"change"],["data-test","questionAnswer","class","view-quiz-question__option",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"view-quiz-question__option",3,"value"],["class","ml-3",4,"ngIf"],[1,"ml-3"],[3,"objectIds"],[3,"options","valueChange"]],template:function(n,e){1&n&&i.YNc(0,ZS,7,5,"div",0),2&n&&i.Q6J("ngIf",e.question)},dependencies:[f.sg,f.O5,f.RF,f.n9,Cl.VQ,Cl.U0,ja,Eb,Er],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-quiz-question__option{font-size:14px;letter-spacing:.35px;line-height:1.4em;padding:12px 0 12px 12px;white-space:normal!important}.view-quiz-question__option>*{white-space:normal!important}.view-quiz-question__option .mat-radio-label{align-items:flex-start!important}.view-quiz-question__option .mat-radio-label-content{padding-left:12px!important}\n"],encapsulation:2,changeDetection:0}),Qb([(0,l.Ph)(Se.getCheckedNodeIds),Zb("design:type",b.y)],ss.prototype,"checkedNodesIds$",void 0),Qb([(0,l.Ph)(U.getActiveSubmission),Zb("design:type",b.y)],ss.prototype,"activeSubmission$",void 0);let VS=(()=>{class t{constructor(){this.index=0,this.total=0}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-progress"]],inputs:{index:"index",total:"total"},decls:4,vars:2,consts:[["data-test","quizProgress",1,"view-quiz-progress"],[1,"text-semibold"],[4,"ngIf"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"span",1),i._uU(2),i.qZA(),i.YNc(3,BS,2,1,"span",2),i.qZA()),2&e&&(i.xp6(2),i.hij("Question ",o.index+1,""),i.xp6(1),i.Q6J("ngIf",o.total>1))},dependencies:[f.O5],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.view-quiz-progress[_ngcontent-%COMP%]{color:#374a68;font-size:12px;letter-spacing:.3px;line-height:1.4em}"],changeDetection:0}),t})();function qS(t,n){1&t&&i._UZ(0,"app-icon",6)}function $S(t,n){1&t&&i._UZ(0,"app-icon",7)}function GS(t,n){1&t&&(i.TgZ(0,"span",8),i._UZ(1,"span",9),i.qZA())}const JS=["*"];let ru=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-answer-option"]],inputs:{correct:"correct"},ngContentSelectors:JS,decls:7,vars:7,consts:[["data-test","answerOptionContainer",1,"option"],[1,"flex","relative",3,"ngSwitch"],["class","option__icon option__icon--correct","style","font-size: 20px","icon","check-circle",4,"ngSwitchCase"],["class","option__icon option__icon--incorrect","style","font-size: 20px","icon","times-circle",4,"ngSwitchCase"],["class","option__icon",4,"ngSwitchDefault"],[1,"pl-2"],["icon","check-circle",1,"option__icon","option__icon--correct",2,"font-size","20px"],["icon","times-circle",1,"option__icon","option__icon--incorrect",2,"font-size","20px"],[1,"option__icon"],[1,"mat-radio-outer-circle"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,qS,1,0,"app-icon",2),i.YNc(3,$S,1,0,"app-icon",3),i.YNc(4,GS,2,0,"span",4),i.TgZ(5,"div",5),i.Hsn(6),i.qZA()()()),2&e&&(i.ekj("option--correct",!0===o.correct)("option--incorrect",!1===o.correct),i.xp6(1),i.Q6J("ngSwitch",o.correct),i.xp6(1),i.Q6J("ngSwitchCase",!0),i.xp6(1),i.Q6J("ngSwitchCase",!1))},dependencies:[f.RF,f.n9,f.ED,lt],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.option[_ngcontent-%COMP%]{padding:12px;border-radius:4px;margin-bottom:8px;color:#131c2a}.option--correct[_ngcontent-%COMP%]{border:1px solid #83e692;background-color:#f0fff0}.option--incorrect[_ngcontent-%COMP%]{border:1px solid #f44336;background-color:#ffe2db}.option__icon[_ngcontent-%COMP%]{position:relative;flex:0 0 20px;justify-content:center}.option__icon--correct[_ngcontent-%COMP%]{color:#83e692}.option__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}"],changeDetection:0}),t})();function HS(t,n){if(1&t&&(i.TgZ(0,"div")(1,"app-view-quiz-answer-option",1)(2,"div",2),i._uU(3),i.qZA()()()),2&t){const e=n.$implicit,o=i.oxw();i.xp6(1),i.Q6J("correct",o.isOptionAnswerCorrect(o.question,e.value,o.answer)),i.xp6(2),i.hij(" ",e.label," ")}}let YS=(()=>{class t{constructor(){}ngOnInit(){}isOptionAnswerCorrect(e,o,s){const r=As(e,[o]);return o===s[0]||r?r:void 0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-multiple-choice-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"correct"],[1,"text-semibold"]],template:function(e,o){1&e&&i.YNc(0,HS,4,2,"div",0),2&e&&i.Q6J("ngForOf",o.question.data.options)},dependencies:[f.sg,ru],changeDetection:0}),t})();function WS(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",6)(1,"button",7),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectedObjectsClick(s.answer))}),i._uU(2," Highlight My Answer "),i.qZA(),i.TgZ(3,"button",8),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleCorrectObjectsClick(s.question.data.correctAnswer))}),i._uU(4," Highlight Correct Answer "),i.qZA()()}}let KS=(()=>{class t{constructor(e,o,s){this.graphService=e,this.viewService=o,this.store=s}get isCorrect(){return As(this.question,this.answer)}fadeNonselected(e){const o=this.store.selectSnapshot(M.getViewGraph),s=this.graphService.getInverseSelection(o,e),r=this.graphService.getNodes(o,s);this.store.dispatch(new Xo(es,r.map(a=>a.id)))}handleCorrectObjectsClick(e){this.highlightNodes(e)}handleSelectedObjectsClick(e){this.highlightNodes(e)}highlightNodes(e){const o=e.filter(s=>s&&""!==s);this.resetSelectAndFade(),this.repositionCamera(o),this.fadeNonselected(o)}repositionCamera(e){1===e.length?this.store.dispatch(new Wi(e[0])):this.viewService.resetCamera()}resetSelectAndFade(){this.viewService.clearSelectedNodes(),this.viewService.clearFadedNodes()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(Oi),i.Y36(ut),i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-select-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:9,vars:4,consts:[[3,"correct"],["selectAnatomyAnswer",""],[1,"flex","flex-column","text-semibold"],[1,"mt-2","ml-2"],[3,"objectIds"],["class","mt-4",4,"ngIf"],[1,"mt-4"],["buttonType","outline","buttonTheme","light","app-button","","data-test","highlightUserAnswers",1,"w-100","mv-2",3,"click"],["buttonType","outline","buttonTheme","light","app-button","","data-test","highlightCorrectAnswers",1,"w-100","mv-2",3,"click"]],template:function(e,o){if(1&e&&(i.TgZ(0,"div")(1,"app-view-quiz-answer-option",0,1)(3,"div",2)(4,"div"),i._uU(5),i.qZA(),i.TgZ(6,"div",3),i._UZ(7,"app-view-quiz-object-tree",4),i.qZA()()(),i.YNc(8,WS,5,0,"div",5),i.qZA()),2&e){const s=i.MAs(2);i.xp6(1),i.Q6J("correct",o.isCorrect),i.xp6(4),i.hij("",s.correct?"Correct":"Incorrect","! You selected:"),i.xp6(2),i.Q6J("objectIds",o.answer),i.xp6(1),i.Q6J("ngIf",!o.summary&&!o.isCorrect)}},dependencies:[f.O5,Dn,Eb,ru],changeDetection:0}),t})();function XS(t,n){if(1&t&&(i.TgZ(0,"div",9),i._uU(1),i.qZA()),2&t){const e=i.oxw().$implicit;i.xp6(1),i.hij(" ",e.label.title," ")}}function e2(t,n){if(1&t&&(i.TgZ(0,"div"),i._uU(1," You selected "),i.TgZ(2,"em",9),i._uU(3),i.qZA(),i._uU(4,". "),i.qZA(),i.TgZ(5,"div",10),i._uU(6," This is the "),i.TgZ(7,"em",9),i._uU(8),i.qZA(),i._uU(9,". "),i.qZA()),2&t){const e=i.oxw(),o=e.index,s=e.$implicit,r=i.oxw();i.xp6(3),i.Oqu(r.getSelectedUserOption(o).label.title.trim()),i.xp6(5),i.Oqu(s.label.title.trim())}}function t2(t,n){if(1&t&&(i.TgZ(0,"div",1)(1,"div",2),i._UZ(2,"app-view-quiz-answer-number",3),i.qZA(),i.TgZ(3,"div",4)(4,"app-view-quiz-answer-option",5,6),i.YNc(6,XS,2,1,"div",7),i.YNc(7,e2,10,2,"ng-template",null,8,i.W1O),i.qZA()()()),2&t){const e=n.index,o=i.MAs(5),s=i.MAs(8),r=i.oxw();i.xp6(2),i.Q6J("number",e+1),i.xp6(2),i.Q6J("correct",r.isOptionAnswerCorrect(e)),i.xp6(2),i.Q6J("ngIf",o.correct)("ngIfElse",s)}}let n2=(()=>{class t{constructor(){}ngOnInit(){}isOptionAnswerCorrect(e){return this.answer[e]===this.question.data.correctAnswer[e]}getSelectedUserOption(e){const o=this.answer[e];return this.question.data.options.find(s=>s.value===o)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-label-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:[["class","answers",4,"ngFor","ngForOf"],[1,"answers"],[1,"mt-2","mr-2"],[3,"number"],[1,"answers__option"],[3,"correct"],["answerOption",""],["class","text-semibold",4,"ngIf","ngIfElse"],["falseBlock",""],[1,"text-semibold"],[1,"mt-1"]],template:function(e,o){1&e&&i.YNc(0,t2,9,4,"div",0),2&e&&i.Q6J("ngForOf",o.question.data.options)},dependencies:[f.sg,f.O5,ru,jb],styles:[".answers[_ngcontent-%COMP%]{display:flex;flex-direction:row}.answers__option[_ngcontent-%COMP%]{flex:1 1 auto}"],changeDetection:0}),t})();function i2(t,n){if(1&t&&(i.TgZ(0,"div",7),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij("",e.questionNumber,".")}}function o2(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-view-quiz-multiple-choice-answer",8),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("question",e.question)("answer",e.answer)("summary",e.summary)}}function s2(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-view-quiz-select-anatomy-answer",8),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("question",e.question)("answer",e.answer)("summary",e.summary)}}function r2(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-view-quiz-label-anatomy-answer",8),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("question",e.question)("answer",e.answer)("summary",e.summary)}}let Bb=(()=>{class t{constructor(e){this.store=e,this.QuestionType=Re}ngOnInit(){this.initAnswerConfig()}initAnswerConfig(){const{type:e}=this.question;this.store.dispatch(new ee.SetQuizPickMode(e===Re.SelectAnatomy?"none":"single"))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-quiz-answer"]],inputs:{question:"question",questionNumber:"questionNumber",answer:"answer",summary:"summary"},decls:11,vars:7,consts:[["data-test","answer",1,"answer"],[1,"answer__prompt"],["class","mr-1",4,"ngIf"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"answer__explanation"],[1,"mr-1"],[3,"question","answer","summary"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,i2,2,1,"div",2),i.TgZ(3,"div"),i._UZ(4,"app-content-blocks",3),i.qZA()(),i.TgZ(5,"div",4),i.YNc(6,o2,2,3,"div",5),i.YNc(7,s2,2,3,"div",5),i.YNc(8,r2,2,3,"div",5),i.qZA(),i.TgZ(9,"div",6),i._UZ(10,"app-content-blocks",3),i.qZA()()),2&e&&(i.xp6(2),i.Q6J("ngIf",o.questionNumber),i.xp6(2),i.Q6J("contentBlocks",o.question.questionPrompt),i.xp6(1),i.Q6J("ngSwitch",o.question.type),i.xp6(1),i.Q6J("ngSwitchCase",o.QuestionType.MultipleChoice),i.xp6(1),i.Q6J("ngSwitchCase",o.QuestionType.SelectAnatomy),i.xp6(1),i.Q6J("ngSwitchCase",o.QuestionType.LabelAnatomy),i.xp6(2),i.Q6J("contentBlocks",o.question.explanation))},dependencies:[f.O5,f.RF,f.n9,ja,YS,KS,n2],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.answer[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.answer__prompt[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.answer__explanation[_ngcontent-%COMP%]{padding-top:24px}"],changeDetection:0}),t})();var a2=A(7837),Di=A(8661);class ht{}let au=(()=>{class t{constructor(){}}return t.type="[Auth] Is Logged In",t})(),Sl=(()=>{class t{constructor(){}}return t.type="[Auth] Is Logged In Success",t})(),Pl=(()=>{class t{constructor(){}}return t.type="[Auth] Is Logged In Failure",t})(),Vb=(()=>{class t{constructor(e){this.login=e}}return t.type="[Auth] Login With Biodigital",t})(),qb=(()=>{class t{constructor(){}}return t.type="[Auth] Initialize Google Auth",t})(),c2=(()=>{class t{constructor(e){this.credential=e}}return t.type="[Auth] Authenticate With Google",t})(),l2=(()=>{class t{constructor(){}}return t.type="[Auth] Prompt With Google",t})(),cu=(()=>{class t{constructor(e){this.promptResult=e}}return t.type="[Auth] Prompt With Google Success",t})(),$b=(()=>{class t{constructor(e){this.login=e}}return t.type="[Auth] Login With Google",t})(),kl=(()=>{class t{constructor(e,o){this.loginType=e,this.response=o}}return t.type="[Auth] Login Success",t})(),Ol=(()=>{class t{constructor(e,o,s){this.loginType=e,this.error=o,this.login=s}}return t.type="[Auth] Login Failure",t})(),Gb=(()=>{class t{constructor(){}}return t.type="[Auth] Logout",t})(),lu=(()=>{class t{constructor(){}}return t.type="[Auth] Logout Success",t})(),p2=(()=>{class t{constructor(){}}return t.type="[Auth] Logout Failure",t})(),Jb=(()=>{class t{constructor(){}}return t.type="[Auth] Get Environment Settings",t})(),pu=(()=>{class t{constructor(e){this.environmentSettings=e}}return t.type="[Auth] Get Environment Settings Success",t})(),d2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Get Environment Settings Failure",t})(),du=(()=>{class t{constructor(e=!1){this.hardCheck=e}}return t.type="[Auth] Get User Profile",t})(),uu=(()=>{class t{constructor(e){this.userProfile=e}}return t.type="[Auth] Get User Profile Success",t})(),u2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Get User Profile Failure",t})(),gu=(()=>{class t{constructor(e){this.userProfile=e}}return t.type="[Auth] Update User Profile",t})(),Hb=(()=>{class t{constructor(e){this.userProfile=e}}return t.type="[Auth] Update User Profile Success",t})(),g2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Update User Profile Failure",t})(),Yb=(()=>{class t{constructor(){}}return t.type="[Auth] Delete User Profile",t})(),h2=(()=>{class t{constructor(e){this.userEmail=e}}return t.type="[Auth] Delete User Profile Success",t})(),m2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Delete User Profile Failure",t})(),Wb=(()=>{class t{constructor(e){this.email=e}}return t.type="[Auth] Check Profile",t})(),hu=(()=>{class t{constructor(e){this.profile=e}}return t.type="[Auth] Check Profile Success",t})(),f2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Check Profile Failure",t})(),Tl=(()=>{class t{constructor(){}}return t.type="[Auth] Get User Roles",t})(),Kb=(()=>{class t{constructor(e){this.email=e}}return t.type="[Auth] Reset Password",t})(),b2=(()=>{class t{constructor(e){this.email=e}}return t.type="[Auth] Reset Password Success",t})(),y2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Reset Password Failure",t})(),Xb=(()=>{class t{constructor(e){this.email=e}}return t.type="[Auth] Transfer Facebook Account",t})(),_2=(()=>{class t{constructor(e){this.email=e}}return t.type="[Auth] Transfer Facebook Account Success",t})(),ey=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Transfer Facebook Account Failure",t})(),ty=(()=>{class t{constructor(e,o,s){this.currentPassword=e,this.newPassword=o,this.confirmNewPassword=s}}return t.type="[Auth] Update Password",t})(),x2=(()=>{class t{constructor(){}}return t.type="[Auth] Update Password Success",t})(),v2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Update Password Failure",t})(),Ml=(()=>{class t{constructor(){}}return t.type="[Auth] Check Session",t})(),ny=(()=>{class t{constructor(e){this.value=e}}return t.type="[Auth] Sign Up",t})(),mu=(()=>{class t{constructor(e){this.response=e}}return t.type="[Auth] Sign Up Success",t})(),fu=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Sign Up Failure",t})(),bu=(()=>{class t{constructor(e){this.locale=e}}return t.type="[Auth] Set User Locale",t})(),yu=(()=>{class t{constructor(e){this.locale=e}}return t.type="[Auth] Set User Locale Success",t})(),Qa=(()=>{class t{constructor(){}}return t.type="[Auth] Check Locale",t})(),_u=(()=>{class t{constructor(){}}return t.type="[Auth] Get User Apps",t})(),xu=(()=>{class t{constructor(e){this.apps=e}}return t.type="[Auth] Set User Apps",t})(),Il=(()=>{class t{constructor(){}}return t.type="[Auth] Check Selected App",t})(),zl=(()=>{class t{constructor(e){this.appId=e}}return t.type="[Auth] Set Selected User App",t})(),iy=(()=>{class t{constructor(e){this.message=e}}return t.type="[Auth] Send User Message",t})(),C2=(()=>{class t{constructor(e){this.message=e}}return t.type="[Auth] Send User Message Success",t})(),w2=(()=>{class t{constructor(e){this.err=e}}return t.type="[Auth] Send User Message Fail",t})(),oy=(()=>{class t{constructor(e,o){this.type=e,this.mode=o}}return t.type="[Auth] Get User Message",t})(),S2=(()=>{class t{constructor(e){this.message=e}}return t.type="[Auth] Get User Message Success",t})(),P2=(()=>{class t{constructor(e){this.type=e}}return t.type="[Auth] Get User Message Fail",t})(),sy=(()=>{class t{constructor(e){this.messageSeenId=e}}return t.type="[Auth] Set Message Viewed",t})(),k2=(()=>{class t{constructor(){}}return t.type="[Auth] Set Message Viewed Success",t})(),O2=(()=>{class t{constructor(){}}return t.type="[Auth] Set Message Viewed Fail",t})(),Al=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Verify Fail",t})(),vu=(()=>{class t{constructor(){}}return t.type="[Auth] Reset",t})(),ry=(()=>{class t{constructor(e,o){this.email=e,this.token=o}}return t.type="[Auth] Request Verification Code",t})(),T2=(()=>{class t{constructor(e){this.response=e}}return t.type="[Auth] Request Verification Code Success",t})(),M2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Request Verification Code Fail",t})(),ay=(()=>{class t{constructor(e,o,s){this.email=e,this.token=o,this.code=s}}return t.type="[Auth] Verify Profile",t})(),cy=(()=>{class t{constructor(e){this.response=e}}return t.type="[Auth] Verify Profile Success",t})(),Cu=(()=>{class t{constructor(e){this.error=e}}return t.type="[Auth] Verify Profile Fail",t})(),ly=(()=>{class t{constructor(e,o){this.contentId=e,this.contentType=o}}return t.type="[Auth] Set Content Viewed",t})(),I2=(()=>{class t{constructor(){}}return t.type="[Auth] Set Content Viewed Success",t})(),wu=(()=>{class t{constructor(){}}return t.type="[Auth] Check Content Viewed",t})(),z2=(()=>{class t{constructor(e){this.contentViews=e}}return t.type="[Auth] Check Content Viewed Success",t})(),py=(()=>{class t{constructor(e){this.isDeveloperReferral=e}}return t.type="[Auth] Set Developer Referral",t})();class dy{}class uy{}!function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,Uh.D)(()=>dy),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],uy.prototype,"organizations",void 0);class Su{static fromJSON(n){const e=new Su;return e.email=n.user_email,e.credentials=n.credentials,e.isUser=n.is_user,e.isThirdParty=n.user_is_third_party,e.thirdPartyProvider=n.user_third_party_provider,e.isDeveloper=n.user_is_developer,e.isDeveloperActive=n.user_is_developer_active,e.isDeveloperVerified=n.user_is_developer_verified,e.isTeamMember=n.user_is_team_member,e.firstName=n.user_first_name,e.lastName=n.user_last_name,e.name=`${n.firstName} ${n.lastName}`,e}}class Pu{static fromJSON(n){const e=new Pu;return e.google=n.google_api_key,e}}class ku{constructor(){this.version=4,this.groupInviteMode=0,this.groupCodeMode=0}}class F2 extends ku{constructor(){super(...arguments),this.version=4}static toJSON(n){return{version:n.version,app_producttype:n.app_producttype,app_productkey:n.app_productkey,email:n.email,password:n.password,first_name:n.firstName,last_name:n.lastName,group_invite_mode:n.groupInviteMode,group_invite_key:n.groupInviteKey,group_code_mode:n.groupCodeMode,group_code:n.groupCode,group_ovid_mode:n.groupOvidMode,group_ovid_osptok:n.groupOvidOsptok,platform:n.platform,return_to:n.returnTo,brand_id:n.brandId,locale_id:n.localeId,timestamp:n.timestamp,site_verify_response:n.site_verify_response}}}class U2 extends ku{constructor(n){super(),this.token=n}static toJSON(n){return{id_token:n.token,version:n.version,app_producttype:n.app_producttype,app_productkey:n.app_productkey,group_invite_mode:n.groupInviteMode,group_invite_key:n.groupInviteKey,group_code_mode:n.groupCodeMode,group_code:n.groupCode,group_ovid_mode:n.groupOvidMode,group_ovid_osptok:n.groupOvidOsptok,platform:n.platform,return_to:n.returnTo,brand_id:n.brandId,locale_id:n.localeId,timestamp:n.timestamp,site_verify_response:n.site_verify_response}}}class R2 extends ku{constructor(n,e,o){super(),this.email=n,this.password=e,this.rememberMe=o}static toJSON(n){return{id_token:n.token,version:n.version,app_producttype:n.app_producttype,app_productkey:n.app_productkey,group_invite_mode:n.groupInviteMode,group_invite_key:n.groupInviteKey,group_code_mode:n.groupCodeMode,group_code:n.groupCode,group_ovid_mode:n.groupOvidMode,group_ovid_osptok:n.groupOvidOsptok,email:n.email,password:n.password,email_remember_me:n.rememberMe,platform:n.platform,return_to:n.returnTo,brand_id:n.brandId,locale_id:n.localeId,timestamp:n.timestamp,site_verify_response:n.site_verify_response}}}var gy=A(4700),Ll=(()=>(function(t){t.Zendesk="zendesk"}(Ll||(Ll={})),Ll))();class hy{}var At=(()=>(function(t){t.AssignRole="assignRole",t.RemoveUser="removeUser",t.TransferContent="transferContent",t.CreateCollection="createCollection",t.DeleteCollection="deleteCollection",t.EditTeamAccount="editTeamAccount",t.EditTeamBookmarks="editTeamBookmarks",t.EditAllTeamBookmarks="editAllTeamBookmarks",t.AddTeamBookmarks="addTeamBookmarks",t.RemoveTeamBookmarks="removeTeamBookmarks",t.EditBookmarks="editBookmarks",t.PublishBookmarks="publishBookmarks",t.SavePrivateBookmarks="savePrivateBookmarks",t.CopyUrl="copyURL",t.ViewBookmarks="viewBookmarks",t.InviteUsers="inviteUsers",t.ViewUsers="viewUsers",t.ExportCSV="exportCSV",t.DuplicateTeamBookmarks="duplicateTeamBookmarks"}(At||(At={})),At))(),Wn=(()=>(function(t){t.Admin="admin",t.Creator="creator",t.Viewer="viewer"}(Wn||(Wn={})),Wn))();const my=[At.ViewBookmarks,At.CopyUrl,At.SavePrivateBookmarks,At.ExportCSV],Ou=[...my,At.ViewUsers,At.InviteUsers,At.PublishBookmarks,At.EditBookmarks,At.EditTeamBookmarks,At.RemoveTeamBookmarks,At.AddTeamBookmarks,At.DuplicateTeamBookmarks],N2=[...Ou,At.EditTeamAccount,At.EditAllTeamBookmarks,At.CreateCollection,At.TransferContent,At.RemoveUser,At.AssignRole],Fl=[Wn.Viewer,Wn.Creator,Wn.Admin],Tu={role_id:void 0,role_name:Wn.Creator,role_display_name:"",role_description:"",permissions:[...Ou]},E2={[Wn.Viewer]:my,[Wn.Creator]:Ou,[Wn.Admin]:N2},D2={[Wn.Viewer]:"Can view team content and edit personal content",[Wn.Creator]:"Can edit and view team content",[Wn.Admin]:"Can manage team settings and edit all content"};function j2(t){return E2[t]||[]}function Za(t){const n=(0,m.get)(t,"role_name",Tu.role_name),e=(0,m.get)(t,"role_description",D2[n]),o=(0,m.get)(t,"permissions",void 0);return{...t,role_description:e,permissions:(0,m.isNil)(o)?j2(n):o}}class Q2{}class Z2{}class B2{}var rs=(()=>(function(t){t.DomainAlert="join_group_through_domain_alert",t.WelcomeTour="welcome_tour_alert",t.CompleteProfileAlert="complete_profile_alert"}(rs||(rs={})),rs))();let Mu=(()=>{class t{constructor(e,o){this.http=e,this.storageService=o}getUserMessage(e,o="",s=!0){const r=this.getCachedMessage(e);return s&&r?(0,Ue.of)(r):this.http.get(`/ws/user/message?version=2&type=${e}&mode=${o}`).pipe((0,J.U)(a=>{const{message_seen_id:c,show_alert:p}=a;let d;switch(e){case rs.DomainAlert:d=(0,sn.yE)(dy,a.join_organization);break;case rs.WelcomeTour:d=`${a.tour_version}`;break;case rs.CompleteProfileAlert:const{is_new_user:u,is_team_user:g}=a||{};d=(0,sn.yE)(B2,{is_new_user:u,is_team_user:g})}return{messageSeenId:c,messageType:e,showUserAlert:p,messageData:d}}),(0,vo.b)(a=>{a.showUserAlert||this.addCachedMessage(a)}))}setUserMessageViewed(e){return this.http.post("/ws/user/message",{version:2,message_seen_id:e})}sendMessage(e){return this.http.post("/ws/user/message",e)}getCachedMessage(e){return this.getCachedMessages().find(s=>s.messageType===e)}getCachedMessages(){return this.storageService.getSessionItem(_s.UserMessagesSeen)||[]}addCachedMessage(e){if(!this.getCachedMessage(e.messageType)){const o=this.getCachedMessages();this.storageService.setSessionItem(_s.UserMessagesSeen,[...o,e])}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(dn))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const V2=["harvard.edu","liberty.edu"];let Dr=(()=>{class t{constructor(e,o,s,r,a){this.http=e,this.reCaptchaV3Service=o,this.userMessageService=s,this.productService=r,this.RECAPTCHA_V3_SITE_KEY=a}loginWithBiodigital(e){return this.http.post("/ws/user/sign/in",R2.toJSON(e))}loginWithGoogle(e){return this.http.post("/ws/user/sign/in/google",U2.toJSON(e))}logout(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/user/sign/out")}checkProfile(e){return this.http.post("/ws/user/profile/check",{version:2,email:e}).pipe((0,J.U)(o=>{const s=Su.fromJSON(o);return s.isThirdParty=""!==s.thirdPartyProvider,s}))}getUserProfile(e){return this.http.get(e?"/ws/user/profile?version=2&subscription_hard_check=1":"/ws/user/profile?version=2").pipe((0,J.U)(s=>{const r=(0,sn.yE)(uy,s);return r.organizations.forEach(a=>{const c=(0,m.get)(a,"user_role",Tu);a.user_role=Za(c)}),r}))}getUserRoles(){return this.http.get("/ws/organization/user/roles").pipe((0,J.U)(e=>e.user_roles.map(o=>Za((0,sn.yE)(hy,o)))))}updaterUserProfile(e){return this.http.post("/ws/user/profile?version=2",e)}deleteUserProfile(){return this.http.post("/ws/user/profile/delete",{}).pipe((0,J.U)(e=>e.deleted_user_email))}getEnvironmentSettings(){return this.http.get("/ws/environment/settings?version=2").pipe((0,J.U)(e=>Pu.fromJSON(e)))}getUserApps(){return this.http.get("/ws/developer/apps/profile").pipe((0,J.U)(e=>e&&e.apps?JSON.parse(e.apps):[]))}getGroupConfigFromRoute(e){const s=e.queryParams.code||"",r=e.queryParams.group_invite||"",a=e.queryParams.osptok||"";return{group:e.queryParams.group||"",groupCode:s,groupCodeMode:s?1:0,groupInviteMode:r?1:0,groupInviteKey:r,groupOvidMode:a?1:0,groupOvidOsptok:a}}getPlatformConfigFromRoute(e){const{zendesk_signin:o,return_to:s,brand_id:r,locale_id:a,timestamp:c}=e.queryParams;if("1"===o)return{platform:Ll.Zendesk,returnTo:s,brandId:r,localeId:a,timestamp:c}}isLoggedIn(){return this.http.get(`/ws/user/is/signed-in?version=4&app_producttype=${this.productService.productType}&app_productkey=${this.productService.productKey}`)}getProfileRestrictions(e){let o=!1,s=!1,r="";return e.organizations.forEach(a=>{o||s||(r=a.name,o=a.user_is_subscribed&&a.email_domain_restriction&&!a.user_has_email_domain_access,s=a.user_is_subscribed&&a.ip_address_restriction&&!a.user_has_domain_access)}),{organizationName:r,email:o,ip:s}}resetPassword(e){return this.http.post("/ws/user/password/forgot",{email:e})}deactivateFacebook(e){return this.http.post("/ws/user/sign/in/facebook/deactivate",e)}updatePassword(e,o,s){return this.http.post("/ws/user/password/change",{current_password:e,new_password:o,confirm_new_password:s})}signUp(e){return this.http.post("/ws/user/sign/up",F2.toJSON(e))}verifyToken(e){return this.http.post("/ws/recaptcha/siteverify",{recaptcha_reponse_token:e,recaptcha_version:"v3"}).pipe((0,J.U)(o=>o))}isHuman(e,o=!1){return o&&grecaptcha.reset(this.RECAPTCHA_V3_SITE_KEY),this.reCaptchaV3Service.execute(e).pipe((0,Di.z)(s=>this.verifyToken(s)),(0,J.U)(s=>({isHuman:s.action===e&&s.score>.2,verification:s})))}isReCaptchaWhiteListed(e){return V2.some(o=>new RegExp(`${o}$`,"i").test(e))}isValidGoogleDomain(){return new Set(["human-qa.biodigital.com","human-staging.biodigital.com","human.biodigital.com","loft.biodigital.com","loft-qa.biodigital.com","qa.biodigital.com","localhost:4200","localhost:4201"]).has(window.location.host)}requestVerificationCode(e){const o={...e,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/request",o).pipe((0,J.U)(s=>(0,sn.yE)(Q2,s)))}verifyProfile(e){const o={...e,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/confirm",o).pipe((0,J.U)(s=>(0,sn.yE)(Z2,s)))}checkProfileIncomplete(){return this.userMessageService.getUserMessage(rs.CompleteProfileAlert,"v2",!1).pipe((0,Vn.K)(()=>(0,Ue.of)({messageType:rs.CompleteProfileAlert,messageData:{},showUserAlert:!1})))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(gy.YC),i.LFG(Mu),i.LFG(Yn),i.LFG(gy.We))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Iu=(()=>{class t{constructor(e){this.organizations=e}}return t.type="[Organizations] Set Organizations",t})(),fy=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Organizations] Select Organization",t})(),by=(()=>{class t{constructor(e){this.collection=e}}return t.type="[Organizations] Select Collection",t})(),zu=(()=>{class t{constructor(e){this.organizationId=e}}return t.type="[Organizations] Get Collections",t})(),Au=(()=>{class t{constructor(e){this.collections=e}}return t.type="[Organizations] Get Collections Success",t})(),yy=(()=>{class t{constructor(e,o){this.organizationId=e,this.collectionName=o}}return t.type="[Organizations] Add Collection",t})(),Lu=(()=>{class t{constructor(e,o){this.organizationId=e,this.collectionName=o}}return t.type="[Organizations] Add Collection Success",t})(),Fu=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Add Collection Error",t})(),_y=(()=>{class t{constructor(e){this.collection=e}}return t.type="[Organizations] Remove Collection",t})(),Uu=(()=>{class t{constructor(e){this.collection=e}}return t.type="[Organizations] Remove Collection Success",t})(),Ru=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Remove Collection Error",t})(),xy=(()=>{class t{constructor(e){this.collection=e}}return t.type="[Organizations] Set Collection Rename Mode",t})(),vy=(()=>{class t{constructor(e,o){this.collection=e,this.collectionName=o}}return t.type="[Organizations] Rename Collection",t})(),Nu=(()=>{class t{constructor(e,o){this.collection=e,this.collectionName=o}}return t.type="[Organizations] Rename Collection Success",t})(),Eu=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Rename Collection Error",t})(),Cy=(()=>{class t{constructor(e,o){this.organizationId=e,this.collections=o}}return t.type="[Organizations] Reorder Collections",t})(),Du=(()=>{class t{constructor(e,o){this.organizationId=e,this.collections=o}}return t.type="[Organizations] Reorder Collections Success",t})(),q2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Reorder Collections Error",t})(),ju=(()=>{class t{constructor(){}}return t.type="[Organizations] Reset",t})(),wy=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Organizations] Create Organization",t})(),Sy=(()=>{class t{constructor(){}}return t.type="[Organizations] Create Organization Success",t})(),Qu=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Create Organization Fail",t})(),Py=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Organizations] Update Organization",t})(),$2=(()=>{class t{constructor(){}}return t.type="[Organizations] Update Organization Success",t})(),G2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Update Organization Fail",t})(),ky=(()=>{class t{constructor(e){this.request=e}}return t.type="[Organizations] Get Organization Profile",t})(),Zu=(()=>{class t{constructor(e){this.organizationProfile=e}}return t.type="[Organizations] Get Organization Profile Success",t})(),J2=(()=>{class t{constructor(e){this.error=e}}return t.type="[Organizations] Get Organization Profile Fail",t})(),Oy=(()=>{class t{constructor(){}}return t.type="[Organizations] Clear Organization Profile",t})();var H2=A(7742);function Ty(t,n){return()=>{if(n===ui.id)return(0,Ue.of)({});const e=U0[n]??n;return t.get(`assets/locales/${e}.json`).pipe((0,Vn.K)(()=>(0,Ue.of)(void 0)),(0,eo.w)(s=>{const r=s?.translations;return(0,m.isNil)(r)?console.warn(`Translations not found for locale: ${e}`):(0,H2.XJ)(r),(0,Ue.of)(s)}))}}let Bu=(()=>{class t{constructor(e){this.view=e}}return t.type="[Edit] Set view",t})(),Vu=(()=>{class t{constructor(){}}return t.type="[Edit] Next view",t})(),Y2=(()=>{class t{constructor(){}}return t.type="[Edit] Previous view",t})(),My=(()=>{class t{constructor(e){this.show=e}}return t.type="[Edit] Show columns",t})(),Iy=(()=>{class t{constructor(e,o){this.column=e,this.show=o}}return t.type="[Edit] Show column",t})(),zy=(()=>{class t{constructor(e){this.show=e}}return t.type="[Edit] Show Timeline Editor",t})(),qu=(()=>{class t{constructor(){}}return t.type="[Edit] Reset",t})(),Ay=(()=>{class t{constructor(e){this.layerOrderMode=e}}return t.type="[Edit] Set Layer Order Mode",t})(),Ly=(()=>{class t{constructor(e){this.show=e}}return t.type="[Edit] Show Tree Node Ids",t})(),Fy=(()=>{class t{constructor(e){this.show=e}}return t.type="[Edit] Show Root Nodess",t})(),Uy=(()=>{class t{constructor(e){this.size=e}}return t.type="[Edit] Set Canvas Size",t})(),Ry=(()=>{class t{constructor(e){this.enable=e}}return t.type="[Edit] Auto Capture",t})();class W2{constructor(n,e,o){this.category=n,this.message=e,this.log=o}}let Ny=(()=>{class t{constructor(e){this.http=e,this.log={}}logError(e,o=!1){const s=`${e.category}${e.message}`;return o&&this.log[s]?(0,Ue.of)():(this.log[s]=!0,this.http.post("/ws/human-error",e))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Ee;!function(t){t.SetSearchMode=(()=>{class ie{constructor(Ae){this.searchMode=Ae}}return ie.type="[Gallery] Set Search Mode",ie})(),t.SetViewMode=(()=>{class ie{constructor(Ae){this.viewMode=Ae}}return ie.type="[Gallery] Set View Mode",ie})(),t.ShowFilters=(()=>{class ie{constructor(Ae,An=!1){this.show=Ae,this.triggerDrawer=An}}return ie.type="[Gallery] Show Filters",ie})(),t.GetStudioOptions=(()=>{class ie{constructor(Ae){this.organizationId=Ae}}return ie.type="[Gallery] Get Studio Options",ie})(),t.GetStudioOptionsSuccess=(()=>{class ie{constructor(Ae){this.options=Ae}}return ie.type="[Gallery] Get Studio Options Success",ie})(),t.SearchLoft=(()=>{class ie{constructor(Ae){this.config=Ae}}return ie.type="[Gallery] Search Loft",ie})(),t.SearchLoftSuccess=(()=>{class ie{constructor(Ae){this.bookmarks=Ae}}return ie.type="[Gallery] Search Loft Success",ie})(),t.SetSearchConfig=(()=>{class ie{constructor(Ae,An){this.config=Ae,this.options=An}}return ie.type="[Gallery] Set Search Config",ie})(),t.SetSearchOptions=(()=>{class ie{constructor(Ae){this.options=Ae}}return ie.type="[Gallery] Set Search Options",ie})(),t.SetActiveTags=(()=>{class ie{constructor(Ae){this.activeTags=Ae}}return ie.type="[Gallery] Set Active Tags",ie})(),t.SearchCategory=(()=>{class ie{constructor(Ae){this.categoryId=Ae}}return ie.type="[Gallery] Search Category",ie})(),t.SearchStudio=(()=>{class ie{constructor(){}}return ie.type="[Gallery] Search Studio",ie})(),t.SearchStudioSuccess=(()=>{class ie{constructor(Ae){this.bookmarks=Ae}}return ie.type="[Gallery] Search Studio Success",ie})(),t.SearchSuccess=(()=>{class ie{constructor(Ae){this.bookmarks=Ae}}return ie.type="[Gallery] Search Success",ie})(),t.SelectBookmark=(()=>{class ie{constructor(Ae){this.result=Ae}}return ie.type="[Gallery] Select Bookmark",ie})(),t.SetSidenav=(()=>{class ie{constructor(Ae){this.sidenav=Ae}}return ie.type="[Gallery] Set Sidenav",ie})(),t.SetBulkActions=(()=>{class ie{constructor(Ae){this.bulkActions=Ae}}return ie.type="[Gallery] Set Bulk Actions",ie})(),t.SetCardActions=(()=>{class ie{constructor(Ae){this.cardActions=Ae}}return ie.type="[Gallery] Set Card Actions",ie})(),t.ClearResults=(()=>{class ie{constructor(){}}return ie.type="[Gallery] Clear Results",ie})(),t.CheckItem=(()=>{class ie{constructor(Ae,An){this.id=Ae,this.checked=An}}return ie.type="[Gallery] Check Item",ie})(),t.CheckAll=(()=>{class ie{constructor(){}}return ie.type="[Gallery] Check All",ie})(),t.UncheckAll=(()=>{class ie{constructor(){}}return ie.type="[Gallery] Uncheck All",ie})(),t.SetCheckedItems=(()=>{class ie{constructor(Ae){this.ids=Ae}}return ie.type="[Gallery] Set Checked Items",ie})(),t.Reset=(()=>{class ie{constructor(){}}return ie.type="[Gallery] Reset",ie})()}(Ee||(Ee={}));var Ul=(()=>(function(t){t.Web="web",t.Mobile="mobilesdk"}(Ul||(Ul={})),Ul))();let K2=(()=>{class t{constructor(){}}return t.type="[Subscription] Reset Subscription State",t})();const X2={"Sign in":"3971305","Sign up":"3971297"};let Ey=(()=>{class t{constructor(e){this.config=e,this.initialized=!1}initialize(){if(!this.config.enabled||this.initialized)return;const e=`\n      _linkedin_partner_id = "${this.config.linkedinId}"; \n      window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || []; \n      window._linkedin_data_partner_ids.push(_linkedin_partner_id);\n      (function(){var s = document.getElementsByTagName("script")[0]; var b = document.createElement("script"); b.type = "text/javascript";b.async = true; b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js"; s.parentNode.insertBefore(b, s);})();\n    `,o=document.createElement("script");o.textContent=e,document.body.appendChild(o),this.initialized=!0}track(e){const o=X2[e];if(o){const s=document.createElement("img");s.height=1,s.width=1,s.style.display="none",s.alt="",s.src=`https://px.ads.linkedin.com/collect/?pid=${this.config.linkedinId}&conversionId=${o}&fmt=gif`,document.body.appendChild(s)}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG("linkedinConfig"))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Ds=(()=>(function(t){t.Free="free",t.Premium="premium",t.Team="team"}(Ds||(Ds={})),Ds))();let $u=(()=>{class t{constructor(e,o){this.http=e,this.productService=o}trackContentPublish(e,o){return this.http.post("/ws/user/analytics/content/inapp/publish",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:o,content_id:e})}trackContentView(e,o){return this.http.post("/ws/user/analytics/content/inapp/view",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:o,content_id:e})}checkContentView(){return this.http.get("/ws/user/content/inapp/view/check")}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(Yn))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function io(t,n){return(0,m.get)(t,"permissions",[]).includes(n)}function Gu(t){return Array.isArray(t.group_access)&&t.group_access.length>0}var Ba,ae=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},C=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Rl=se.application===mt.Studio,Ju={loading:!1,requestingCode:!1,profileStatus:"ready",auth2:null,googleCredential:null,googlePromptResult:null,loggedIn:null,userLocale:null,userRoles:[],contentViews:{limit_reached:!1,inapp_view_limit:0,inapp_view_count:0},developerReferral:!1};let q=Ba=class{constructor(n,e,o,s,r,a,c,p,d){this.authService=n,this.userMessageService=e,this.storageService=o,this.errorLoggingService=s,this.linkedinInsights=r,this.pendoService=a,this.contentViewService=c,this.productService=p,this.httpClient=d}static getLoggedIn(n){return n.loggedIn}static getEnvironmentSettings(n){return n.environmentSettings}static getUserProfile(n){return n.userProfile}static getUserRole(n){if(!(0,m.isNil)(n.userProfile))return(0,m.get)(n,"userProfile.organizations[0].user_role",Tu)}static getUserRoles(n){return n.userRoles}static getUserType(n){if(!(0,m.isNil)(n.userProfile)){const{premium_account:e,premium_account_type:o}=n.userProfile;if(e)return"group"===o?Ds.Team:Ds.Premium}return Ds.Free}static canInviteUsers(n){if(!(0,m.isNil)(n.userProfile)){const e=Ba.getUserType(n);return io(Ba.getUserRole(n),At.InviteUsers)&&e===Ds.Team}return!1}static getUserAccountSettings(n){return(0,m.get)(n,"userProfile.account_settings",[])}static getAuth2(n){return n.auth2}static getGooglePromptResult(n){return n.googlePromptResult}static getProfileCheck(n){return n.profileCheck}static getLoading(n){return n.loading}static getVerifyingProfile(n){return"verifying"===n.profileStatus}static getProfileUpdating(n){return"updating"===n.profileStatus}static getProfileDeleting(n){return"deleting"===n.profileStatus}static getUserLocale(n){return n.userLocale}static getUserLanguage(n){return n.userLocale?.lang||ui.lang}static getUserApps(n){return(0,m.get)(n,"userApps",[])}static getSelectedUserApp(n){return(n.userApps||[]).find(o=>o.id===n.selectedAppId)}static getUserFullName(n){return(0,m.isNil)(n.userProfile)?null:(0,m.trim)([n.userProfile.first_name??"",n.userProfile.last_name??""].join(" "))}static getUserEmail(n){return(0,m.isNil)(n.userProfile)?null:n.userProfile.email}static isPrivateUser(n){return!(0,m.isNil)(n.userProfile)&&0===(0,m.get)(n,"userProfile.organizations",[]).length}static isPremiumUser(n){return!0===(0,m.get)(n,"userProfile.premium_account_valid")}static isAdmin(n){const e=this.getUserRole(n);return!!e&&e.role_name===Wn.Admin}static isDeveloperReferral(n){return n.developerReferral}static getContentViews(n){return n.contentViews}static getContentViewsReached(n){return!Ba.isPremiumUser(n)&&n.contentViews.limit_reached}initializeGoogleAuth(n){const e=navigator.userAgent.indexOf("Mozilla/5.0 (Android 10; Mobile; rv:97.0) Gecko/97.0 Firefox/97.0")>=0,o={client_id:se.googleAuthKey,ux_mode:"popup",itp_support:!1,callback:s=>{n.patchState({googleCredential:s.credential}),n.dispatch(new c2(s.credential))}};e&&(o.ux_mode="redirect",o.login_uri="https://"+window.location.host+"/auth.html"),google.accounts.id.initialize(o)}promptWithGoogle(n){google.accounts.id.prompt(e=>{const o={dismissedReason:e.getDismissedReason(),momentType:e.getMomentType(),notDisplayedReason:e.getNotDisplayedReason(),skippedReason:e.getSkippedReason()};n.dispatch(new cu(o))})}promptWithGoogleSuccess(n,e){n.patchState({googlePromptResult:e.promptResult})}isLoggedIn(n,e){n.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(o.signed_in?new Sl:new Pl)})}isLoggedInSuccess(n,e){n.patchState({loggedIn:!0})}isLoggedInFailure(n,e){n.patchState({loggedIn:!1})}login(n,e){n.patchState({loading:!0}),this.verify("studio_login",e.login.email,n).pipe((0,Di.z)(o=>this.authService.loginWithBiodigital({...e.login,...o?{site_verify_response:o}:null})),(0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new kl("biodigital",o))},o=>{this.logFailure("LOGIN_FAILURE",o),n.dispatch(new Ol("biodigital",o,e.login))})}loginWithGoogle(n,e){n.patchState({loading:!0}),this.authService.loginWithGoogle(e.login).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new kl("google",o))},o=>{(1===e.login.groupCodeMode||1===e.login.groupInviteMode)&&this.logFailure("GOOGLE_SIGNUP_FAILURE",o),n.dispatch(new Ol("google",o,e.login))})}loginSuccess(n,e){Rl&&(this.linkedinInsights.track("Sign in"),"google"===e.loginType&&"signup"===e.response.authentication_type?this.pendoService.trackSignUp(e.loginType):this.pendoService.trackSignIn(e.loginType)),n.dispatch(new au),n.dispatch(new Qa)}loginFailure(n,e){Rl&&this.pendoService.track("Sign In - Failure",{type:e.loginType,error:(0,m.get)(e,"error.error.error.message")||"There was an error logging in.",statusCode:e.error?.status})}logout(n,e){n.patchState({loading:!0}),this.authService.logout().pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(()=>n.dispatch(new lu),()=>n.dispatch(new p2))}logoutSuccess(n,e){n.setState(Ju),n.dispatch(new vu),n.dispatch(new K2),n.dispatch(new Xd),n.dispatch(new qu),n.dispatch(new ed),n.dispatch(new Ld),n.dispatch(new Mn.ResetLayout),n.dispatch(new ju),n.dispatch(new qh),n.dispatch(new xd),n.dispatch(new Ee.Reset),this.storageService.clearSessionStorage()}checkProfile(n,e){return n.patchState({loading:!0}),this.authService.checkProfile(e.email).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new hu(o))},o=>{n.dispatch(new f2(o))})}checkProfileSuccess(n,e){n.patchState({profileCheck:e.profile})}getUserProfile(n,{hardCheck:e}){return n.patchState({loading:!0}),this.authService.getUserProfile(e).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new uu(o))},o=>{n.dispatch(new u2(o))})}getUserProfileSuccess(n,e){n.patchState({userProfile:e.userProfile}),n.dispatch(new Iu(e.userProfile.organizations)),n.dispatch(new _u),n.dispatch(new Qa)}updateUserProfile(n,{userProfile:e}){n.patchState({profileStatus:"updating"}),this.authService.updaterUserProfile(e).pipe((0,je.x)(()=>n.patchState({profileStatus:"ready"}))).subscribe(()=>{n.dispatch(new Hb(e))},o=>{n.dispatch(new g2(o))})}updateUserProfileSuccess(n,{userProfile:e}){this.pendoService.updateVisitorData(e)}deleteUserProfile(n,e){n.patchState({profileStatus:"deleting"}),this.authService.deleteUserProfile().pipe((0,je.x)(()=>n.patchState({profileStatus:"ready"}))).subscribe(o=>{n.dispatch(new h2(o))},o=>{n.dispatch(new m2(o))})}getUserRoles(n,e){this.authService.getUserRoles().subscribe(o=>{n.patchState({userRoles:o})})}getUserApps(n,e){this.authService.getUserApps().subscribe(o=>{n.dispatch(new xu(o)),n.dispatch(new Il)},o=>{})}setUserApps(n,{apps:e}){n.patchState({userApps:e})}setSelectedUserApp(n,{appId:e}){n.patchState({selectedAppId:e}),null!==e?this.storageService.setLocalItem(fn.UserAppId,e):this.storageService.removeLocalItem(fn.UserAppId)}checkSelectedUserApp(n,e){const o=n.getState().userApps,s=this.storageService.getLocalItem(fn.UserAppId);if(s){const r=parseInt(s,10);n.dispatch(new zl(r))}else if(o&&o.length){const r=o.find(a=>a.app_platform.some(c=>c.type===Ul.Web));n.dispatch(new zl(r?r.id:void 0))}}checkSession(n,e){n.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{o.signed_in?(n.dispatch(new Sl),n.dispatch(new du),n.dispatch(new Tl)):n.dispatch(new Pl)})}getEnvironmentSettings(n,e){return n.patchState({loading:!0}),this.authService.getEnvironmentSettings().pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new pu(o))},o=>{n.dispatch(new d2(o))})}GetEnvironmentSettingsSuccess(n,e){n.patchState({environmentSettings:e.environmentSettings})}resetPassword(n,e){n.patchState({loading:!0}),this.authService.resetPassword(e.email).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(()=>{n.dispatch(new b2(e.email))},o=>{n.dispatch(new y2(o))})}transferFacebookAccount(n,e){n.patchState({loading:!0}),this.verify("deactivate_facebook",e.email,n).pipe((0,Di.z)(o=>this.authService.deactivateFacebook({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...o?{site_verify_response:o}:null,user_email:e.email})),(0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(o.conversion_complete&&o.reset_password_email_sent?new _2(e.email):new ey(new Error("Facebook deactivation failed")))},o=>{n.dispatch(new ey(o))})}updatePassword(n,e){const{currentPassword:o,newPassword:s,confirmNewPassword:r}=e;this.authService.updatePassword(o,s,r).subscribe(()=>{n.dispatch(new x2)},a=>{n.dispatch(new v2(a))})}signUp(n,e){n.patchState({loading:!0}),this.verify("studio_signup",e.value.email,n).pipe((0,Di.z)(o=>this.authService.signUp({...e.value,...o?{site_verify_response:o}:null})),(0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new mu(o))},o=>{n.dispatch(new fu(o))})}signUpSuccess(n,e){Rl&&this.pendoService.trackSignUp("biodigital")}signUpFailure(n,e){Rl&&this.pendoService.track("Sign Up - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error signing up.",statusCode:e.error?.status}),this.logFailure("BIODIGITAL_SIGNUP_FAILURE",e)}setUserLocale(n,{locale:e}){this.storageService.setLocalItem(fn.Locale,e.id),n.patchState({userLocale:e}),n.dispatch(new yu(e))}setUserLocaleSuccess(n,{locale:e}){Ty(this.httpClient,e.id)().subscribe(()=>{})}checkLocale(n,e){const o=Nh(),s=ya.find(r=>r.id===o)||ui;n.dispatch(new bu(s))}sendUserMessage(n,{message:e}){this.userMessageService.sendMessage(e).subscribe(()=>{n.dispatch(new C2(e))},o=>{n.dispatch(new w2(o))})}getUserMessage(n,{type:e,mode:o}){this.userMessageService.getUserMessage(e,o).subscribe(s=>{n.dispatch(new S2(s))},()=>{n.dispatch(new P2(e))})}setUserMessageViewed(n,{messageSeenId:e}){this.userMessageService.setUserMessageViewed(e).subscribe(()=>n.dispatch(new k2),()=>n.dispatch(new O2))}resetAuth(n,e){n.setState(Ju)}requestVerificationCode(n,{email:e,token:o}){n.patchState({requestingCode:!0}),this.authService.requestVerificationCode({user_email:e,verification_jwt:o}).pipe((0,je.x)(()=>n.patchState({requestingCode:!1}))).subscribe(s=>{n.dispatch(new T2(s))},s=>{n.dispatch(new M2(s))})}verifyProfile(n,{email:e,token:o,code:s}){const r=s.toUpperCase();n.patchState({profileStatus:"verifying"}),this.authService.verifyProfile({user_email:e,verification_code:r,verification_jwt:o}).pipe((0,je.x)(()=>n.patchState({profileStatus:"ready"}))).subscribe(a=>{n.dispatch(new cy(a)),n.dispatch(new Ml)},a=>{n.dispatch(new Cu(a))})}verifyProfileSuccess(n){this.pendoService.track("Email Verify - Success",{platform:this.productService.productType})}verifyProfileFail(n,e){this.pendoService.track("Email Verify - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error with email verification.",statusCode:e.error?.status})}setContentView(n,{contentId:e,contentType:o}){this.contentViewService.trackContentView(e,o).subscribe(()=>{n.dispatch(new I2),n.dispatch(new wu)})}checkContentViews(n,e){this.contentViewService.checkContentView().subscribe(o=>{n.patchState({contentViews:o}),n.dispatch(new z2(o))})}setDeveloperReferral(n,e){n.patchState({developerReferral:e.isDeveloperReferral})}logFailure(n,e){const o=(0,m.get)(e,"message")||"",s=(0,m.get)(e,"error.error.message")||"";this.errorLoggingService.logError(new W2(n,o,s)).subscribe()}verify(n,e,o){return this.authService.isReCaptchaWhiteListed(e)?(0,Ue.of)(null):this.authService.isHuman(n).pipe((0,vo.b)(s=>{s.isHuman||o.dispatch(new Al)}),(0,$.h)(s=>s.isHuman),(0,J.U)(s=>s.verification))}ngxsOnInit(n){n.dispatch(new Ml),n.dispatch(new Qa),n.dispatch(new Il),n.dispatch(new qb)}};q.\u0275fac=function(n){return new(n||q)(i.LFG(Dr),i.LFG(Mu),i.LFG(dn),i.LFG(Ny),i.LFG(Ey),i.LFG(Ln),i.LFG($u),i.LFG(Yn),i.LFG(at.eN))},q.\u0275prov=i.Yz7({token:q,factory:q.\u0275fac}),ae([(0,l.aU)(qb),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],q.prototype,"initializeGoogleAuth",null),ae([(0,l.aU)(l2),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],q.prototype,"promptWithGoogle",null),ae([(0,l.aU)(cu),C("design:type",Function),C("design:paramtypes",[Object,cu]),C("design:returntype",void 0)],q.prototype,"promptWithGoogleSuccess",null),ae([(0,l.aU)(au),C("design:type",Function),C("design:paramtypes",[Object,au]),C("design:returntype",void 0)],q.prototype,"isLoggedIn",null),ae([(0,l.aU)(Sl),C("design:type",Function),C("design:paramtypes",[Object,Sl]),C("design:returntype",void 0)],q.prototype,"isLoggedInSuccess",null),ae([(0,l.aU)(Pl),C("design:type",Function),C("design:paramtypes",[Object,Pl]),C("design:returntype",void 0)],q.prototype,"isLoggedInFailure",null),ae([(0,l.aU)(Vb),C("design:type",Function),C("design:paramtypes",[Object,Vb]),C("design:returntype",void 0)],q.prototype,"login",null),ae([(0,l.aU)($b),C("design:type",Function),C("design:paramtypes",[Object,$b]),C("design:returntype",void 0)],q.prototype,"loginWithGoogle",null),ae([(0,l.aU)(kl),C("design:type",Function),C("design:paramtypes",[Object,kl]),C("design:returntype",void 0)],q.prototype,"loginSuccess",null),ae([(0,l.aU)(Ol),C("design:type",Function),C("design:paramtypes",[Object,Ol]),C("design:returntype",void 0)],q.prototype,"loginFailure",null),ae([(0,l.aU)(Gb),C("design:type",Function),C("design:paramtypes",[Object,Gb]),C("design:returntype",void 0)],q.prototype,"logout",null),ae([(0,l.aU)(lu),C("design:type",Function),C("design:paramtypes",[Object,lu]),C("design:returntype",void 0)],q.prototype,"logoutSuccess",null),ae([(0,l.aU)(Wb),C("design:type",Function),C("design:paramtypes",[Object,Wb]),C("design:returntype",void 0)],q.prototype,"checkProfile",null),ae([(0,l.aU)(hu),C("design:type",Function),C("design:paramtypes",[Object,hu]),C("design:returntype",void 0)],q.prototype,"checkProfileSuccess",null),ae([(0,l.aU)(du),C("design:type",Function),C("design:paramtypes",[Object,du]),C("design:returntype",void 0)],q.prototype,"getUserProfile",null),ae([(0,l.aU)(uu),C("design:type",Function),C("design:paramtypes",[Object,uu]),C("design:returntype",void 0)],q.prototype,"getUserProfileSuccess",null),ae([(0,l.aU)(gu),C("design:type",Function),C("design:paramtypes",[Object,gu]),C("design:returntype",void 0)],q.prototype,"updateUserProfile",null),ae([(0,l.aU)(Hb),C("design:type",Function),C("design:paramtypes",[Object,gu]),C("design:returntype",void 0)],q.prototype,"updateUserProfileSuccess",null),ae([(0,l.aU)(Yb),C("design:type",Function),C("design:paramtypes",[Object,Yb]),C("design:returntype",void 0)],q.prototype,"deleteUserProfile",null),ae([(0,l.aU)(Tl),C("design:type",Function),C("design:paramtypes",[Object,Tl]),C("design:returntype",void 0)],q.prototype,"getUserRoles",null),ae([(0,l.aU)(_u),C("design:type",Function),C("design:paramtypes",[Object,_u]),C("design:returntype",void 0)],q.prototype,"getUserApps",null),ae([(0,l.aU)(xu),C("design:type",Function),C("design:paramtypes",[Object,xu]),C("design:returntype",void 0)],q.prototype,"setUserApps",null),ae([(0,l.aU)(zl),C("design:type",Function),C("design:paramtypes",[Object,zl]),C("design:returntype",void 0)],q.prototype,"setSelectedUserApp",null),ae([(0,l.aU)(Il),C("design:type",Function),C("design:paramtypes",[Object,Il]),C("design:returntype",void 0)],q.prototype,"checkSelectedUserApp",null),ae([(0,l.aU)(Ml),C("design:type",Function),C("design:paramtypes",[Object,Ml]),C("design:returntype",void 0)],q.prototype,"checkSession",null),ae([(0,l.aU)(Jb),C("design:type",Function),C("design:paramtypes",[Object,Jb]),C("design:returntype",void 0)],q.prototype,"getEnvironmentSettings",null),ae([(0,l.aU)(pu),C("design:type",Function),C("design:paramtypes",[Object,pu]),C("design:returntype",void 0)],q.prototype,"GetEnvironmentSettingsSuccess",null),ae([(0,l.aU)(Kb),C("design:type",Function),C("design:paramtypes",[Object,Kb]),C("design:returntype",void 0)],q.prototype,"resetPassword",null),ae([(0,l.aU)(Xb),C("design:type",Function),C("design:paramtypes",[Object,Xb]),C("design:returntype",void 0)],q.prototype,"transferFacebookAccount",null),ae([(0,l.aU)(ty),C("design:type",Function),C("design:paramtypes",[Object,ty]),C("design:returntype",void 0)],q.prototype,"updatePassword",null),ae([(0,l.aU)(ny),C("design:type",Function),C("design:paramtypes",[Object,ny]),C("design:returntype",void 0)],q.prototype,"signUp",null),ae([(0,l.aU)(mu),C("design:type",Function),C("design:paramtypes",[Object,mu]),C("design:returntype",void 0)],q.prototype,"signUpSuccess",null),ae([(0,l.aU)(fu),C("design:type",Function),C("design:paramtypes",[Object,fu]),C("design:returntype",void 0)],q.prototype,"signUpFailure",null),ae([(0,l.aU)(bu),C("design:type",Function),C("design:paramtypes",[Object,bu]),C("design:returntype",void 0)],q.prototype,"setUserLocale",null),ae([(0,l.aU)(yu),C("design:type",Function),C("design:paramtypes",[Object,yu]),C("design:returntype",void 0)],q.prototype,"setUserLocaleSuccess",null),ae([(0,l.aU)(Qa),C("design:type",Function),C("design:paramtypes",[Object,Qa]),C("design:returntype",void 0)],q.prototype,"checkLocale",null),ae([(0,l.aU)(iy),C("design:type",Function),C("design:paramtypes",[Object,iy]),C("design:returntype",void 0)],q.prototype,"sendUserMessage",null),ae([(0,l.aU)(oy),C("design:type",Function),C("design:paramtypes",[Object,oy]),C("design:returntype",void 0)],q.prototype,"getUserMessage",null),ae([(0,l.aU)(sy),C("design:type",Function),C("design:paramtypes",[Object,sy]),C("design:returntype",void 0)],q.prototype,"setUserMessageViewed",null),ae([(0,l.aU)(vu),C("design:type",Function),C("design:paramtypes",[Object,vu]),C("design:returntype",void 0)],q.prototype,"resetAuth",null),ae([(0,l.aU)(ry),C("design:type",Function),C("design:paramtypes",[Object,ry]),C("design:returntype",void 0)],q.prototype,"requestVerificationCode",null),ae([(0,l.aU)(ay),C("design:type",Function),C("design:paramtypes",[Object,ay]),C("design:returntype",void 0)],q.prototype,"verifyProfile",null),ae([(0,l.aU)(cy),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],q.prototype,"verifyProfileSuccess",null),ae([(0,l.aU)(Cu),C("design:type",Function),C("design:paramtypes",[Object,Cu]),C("design:returntype",void 0)],q.prototype,"verifyProfileFail",null),ae([(0,l.aU)(ly),C("design:type",Function),C("design:paramtypes",[Object,ly]),C("design:returntype",void 0)],q.prototype,"setContentView",null),ae([(0,l.aU)(wu),C("design:type",Function),C("design:paramtypes",[Object,wu]),C("design:returntype",void 0)],q.prototype,"checkContentViews",null),ae([(0,l.aU)(py),C("design:type",Function),C("design:paramtypes",[Object,py]),C("design:returntype",void 0)],q.prototype,"setDeveloperReferral",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getLoggedIn",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getEnvironmentSettings",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getUserProfile",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",hy)],q,"getUserRole",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",Array)],q,"getUserRoles",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",String)],q,"getUserType",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",Boolean)],q,"canInviteUsers",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",Array)],q,"getUserAccountSettings",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",Object)],q,"getAuth2",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",Object)],q,"getGooglePromptResult",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getProfileCheck",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getLoading",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getVerifyingProfile",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getProfileUpdating",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getProfileDeleting",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getUserLocale",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",String)],q,"getUserLanguage",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getUserApps",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getSelectedUserApp",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getUserFullName",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getUserEmail",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"isPrivateUser",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"isPremiumUser",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"isAdmin",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"isDeveloperReferral",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getContentViews",null),ae([(0,l.Qf)(),C("design:type",Function),C("design:paramtypes",[ht]),C("design:returntype",void 0)],q,"getContentViewsReached",null),q=Ba=ae([(0,l.ZM)({name:"auth",defaults:Ju}),C("design:paramtypes",[Dr,Mu,dn,Ny,Ey,Ln,$u,Yn,at.eN])],q);let nP=(()=>{class t{constructor(e,o,s){this.http=e,this.markdownService=o,this.store=s}downloadResultsPDF(e="",o="",s="",r,a){return this.http.post("/ws/mc/pdf",this.getPDFHTML(e,o,s,r,a),{responseType:"arraybuffer",headers:new at.WM({"Content-Type":"text/html; charset=utf-8"})}).pipe((0,J.U)(c=>{const p=new Blob([c],{type:"application/pdf"}),d=window.URL.createObjectURL(p),u=(s||"Quiz Results").replace(/ /g,"_").replace(/\W/g,"").toLowerCase(),g=document.createElement("a");return g.download=u,g.href=d,g.click(),!0}),(0,Vn.K)(()=>(0,Ue.of)(!1)))}getPDFHTML(e,o,s,r,a){return`\n    <html>\n      <head>\n        <style>\n          @page {\n            size: letter portrait;\n        \n            @frame header_frame {\n              -pdf-frame-content: header;\n              left: 40pt;\n              width: 532pt;\n              top: 40pt;\n              height: 56pt;\n            }\n        \n            @frame content_frame {\n              left: 40pt;\n              width: 532pt;\n              top: 96pt;\n              height: 656pt;\n            }\n        \n            @frame footer_frame {\n              -pdf-frame-content: footer;\n              left: 40pt;\n              width: 532pt;\n              top: 752pt;\n              height: 20pt;\n            }\n          }\n        </style>\n      </head>\n      <body style="font-size: 12px">\n        <div id="header">\n          <table>\n            <tr>\n              <td style="text-align: left; font-weight: 900">${e}</td>\n              <td style="text-align: right">\n                <span style="font-weight: 900">Score: </span>\n                <span>${a.correctTotal} out of ${a.scorableTotal}</span>\n              </td>\n            </tr>\n            <tr>\n              <td style="text-align: left">${o}</td>\n              <td style="text-align: right">\n                <span style="font-weight: 900">Percentage: </span>\n                <span>${a.score}%</span>\n              </td>\n            </tr>\n          </table>\n        </div>\n        <div id="footer">\n          <div style="text-align: center; color: rgb(40, 56, 83); font-size: 10px">\n            Page <pdf:pagenumber> of <pdf:pagecount>\n          </div>\n        </div>\n\n        \x3c!-- PDF CONTENT --\x3e\n\n        <div style="font-weight: 900">${s}</div>\n        <div style="font-size: 10px">QUIZ RESULTS</div>\n\n        <br />\n\n        ${this.createPDFResponses(r,a)}\n        \n      </body>\n    </html>\n    `}createPDFResponses(e,o){const s=e.filter(p=>p.type!==Re.Instructions),r=this.markdownService.renderer.list,a=this.markdownService.renderer.listitem;this.markdownService.renderer.list=p=>p.replace(/,$/,""),this.markdownService.renderer.listitem=p=>` ${p},`;const c=s.map(p=>{const d=this.getNormalizedAnswer(o.questionAnswers[p.id]);return this.createPDFResponse(p,d)}).join("\n      <br />\n      <br />\n    ");return this.markdownService.renderer.list=r,this.markdownService.renderer.listitem=a,`\n      <ol>\n        ${c}\n      </ol>\n    `}getNormalizedAnswer(e){return typeof e>"u"?[]:"string"==typeof e?[e]:e}createPDFResponse(e,o){let s=this.convertContentBlockArray(e.questionPrompt);e.type===Re.SelectAnatomy&&e.data.showAnswerList&&(s=`${s} ${this.printAnatomyList(e.data.correctAnswer)}.`);const r=As(e,o);return`\n      <li style="font-weight: 900">\n        ${s}\n        <div style="font-weight: 400">\n          <img src="${(r?"correct":"incorrect")+".svg"}" />\n          <span style="font-weight: 900; white-space: pre">${r?"  Correct!  ":"  Incorrect!  "}</span>\n          ${this.getResponseText(e,o,r)}\n        </div>\n        <p style="font-weight: 400; font-style: italic; margin-bottom: 0">\n          ${this.convertContentBlockArray(e.explanation)}\n        </p>\n      </li>\n    `}getResponseText(e,o,s){let r="";switch(e.type){case Re.MultipleChoice:r=`You selected: ${this.getMultipleChoiceLabel(e,o[0])}.`,s||(r=`${r} The correct answer is: ${this.getMultipleChoiceLabel(e,e.data.correctAnswer)}.`);break;case Re.LabelAnatomy:r=`You labeled the anatomy ${s?"correctly":"incorrectly. The correct answer is"}: ${this.printLabelList(e)}.`;break;case Re.SelectAnatomy:s||(r=`You selected: ${this.printAnatomyList(o)}.`)}return r}printAnatomyList(e){const o=this.store.selectSnapshot(M.getViewGraph);return e.map(s=>ni(o,s)?.label).join(", ")}printLabelList(e){return e.data.correctAnswer.map((o,s)=>`${s+1}. ${e.data.options.find(a=>a.value===o).label.title}`).join(", ")}getMultipleChoiceLabel(e,o){return e.data.options.find(r=>r.value===o)?.label}convertContentBlockArray(e){return e.filter(o=>o.type===zi.Markdown).map(o=>{const s=this.markdownService.parse(o.markdown);return this.stripHTML(s)}).join("\n")}stripHTML(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(En.Zy),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var _i=A(7009);const iP=["progressCircle"];let oP=(()=>{class t{constructor(e,o){this.renderer=e,this.changeRef=o,this._size="medium",this._progress=0,this.progressColor="#5BB96F",this.strokeWidth=8,this.diameter=120}get size(){return this._size}set size(e){this._size=e,this.updateCircle()}get progress(){return this._progress}set progress(e){this._progress=e,this.updateCircle()}ngOnInit(){}ngAfterViewInit(){this.updateCircle()}updateCircle(){switch(this.size){case"small":this.strokeWidth=4,this.diameter=60;break;case"medium":this.strokeWidth=8,this.diameter=120;break;case"large":this.strokeWidth=16,this.diameter=240}if(this.progressCircleRef){const o=2*this.progressCircleRef.nativeElement.r.baseVal.value*Math.PI,s=o-this.progress/100*o;this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}this.changeRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-progress-circle"]],viewQuery:function(e,o){if(1&e&&i.Gf(iP,7),2&e){let s;i.iGM(s=i.CRH())&&(o.progressCircleRef=s.first)}},inputs:{size:"size",progress:"progress",progressColor:"progressColor"},decls:9,vars:19,consts:[["role","progressbar","aria-valuemin","0","aria-valuemax","100","data-test","progress",1,"progress"],["stroke","#F9FAFD","fill","transparent",1,"progress__circle"],["fill","transparent",1,"progress__circle"],["progressCircle",""],["data-test","progressPercentage",1,"progress__label","text-semibold"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.O4$(),i.TgZ(1,"svg")(2,"g"),i._UZ(3,"circle",1),i.qZA(),i.TgZ(4,"g"),i._UZ(5,"circle",2,3),i.qZA()(),i.kcU(),i.TgZ(7,"div",4),i._uU(8),i.qZA()()),2&e&&(i.ekj("progress--small","small"===o.size)("progress--medium","medium"===o.size)("progress--large","large"===o.size),i.uIk("aria-valuenow",o.progress),i.xp6(1),i.uIk("width",o.diameter)("height",o.diameter),i.xp6(2),i.uIk("stroke-width",o.strokeWidth)("r",o.diameter/2-2*o.strokeWidth)("cx",o.diameter/2)("cy",o.diameter/2),i.xp6(2),i.uIk("stroke",o.progressColor)("stroke-width",o.strokeWidth)("r",o.diameter/2-2*o.strokeWidth)("cx",o.diameter/2)("cy",o.diameter/2),i.xp6(3),i.hij("",o.progress,"%"))},styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.progress[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.progress__ring[_ngcontent-%COMP%]{position:absolute;z-index:1}.progress__circle[_ngcontent-%COMP%]{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.progress__label[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2}.progress--small[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.progress--medium[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.progress--large[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}"],changeDetection:0}),t})();var Fo=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Uo=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function sP(t,n){if(1&t&&(i.TgZ(0,"div",4)(1,"div",5),i._UZ(2,"app-progress-circle",6),i.TgZ(3,"div",7),i._uU(4,"Quiz Complete"),i.qZA(),i.TgZ(5,"div",8),i._uU(6),i.qZA()()()),2&t){const e=i.oxw();i.xp6(2),i.Q6J("progress",null==e.quizScore?null:e.quizScore.score),i.xp6(4),i.AsE(" You answered ",null==e.quizScore?null:e.quizScore.correctTotal," of ",null==e.quizScore?null:e.quizScore.scorableTotal," questions correctly. ")}}function rP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleResultsClick())}),i._UZ(1,"app-icon",15),i._uU(2," Download Results as PDF "),i.qZA()}}function aP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",16),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleToggleSummaryClick())}),i._uU(1),i.qZA()}if(2&t){const e=i.oxw(2);i.xp6(1),i.hij(" ",e.showExplanation?"Hide Summary":"Show Summary"," ")}}function cP(t,n){if(1&t&&(i.TgZ(0,"div",19),i._UZ(1,"app-view-quiz-answer",20),i.qZA()),2&t){const e=n.$implicit,o=n.index,s=i.oxw(3);i.xp6(1),i.Q6J("question",e)("questionNumber",o+1)("answer",null==s.quizScore?null:s.quizScore.questionAnswers[e.id])("summary",!0)}}function lP(t,n){if(1&t&&(i.TgZ(0,"div",17),i.YNc(1,cP,2,4,"div",18),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",e.questions)}}function pP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",21),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleRestartClick())}),i._uU(1," Take Again "),i.qZA()}}function dP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",22),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleExitClick())}),i._uU(1," Back to View "),i.qZA()}}function uP(t,n){if(1&t&&(i.ynx(0),i.YNc(1,rP,3,0,"button",9),i.YNc(2,aP,2,1,"button",10),i.YNc(3,lP,2,1,"div",11),i.YNc(4,pP,2,0,"button",12),i.ALo(5,"async"),i.YNc(6,dP,2,0,"button",13),i.ALo(7,"async"),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.showSummaryEnabled&&e.showExplanationEnabled),i.xp6(1),i.Q6J("ngIf",e.showSummaryEnabled&&e.showExplanationEnabled),i.xp6(1),i.Q6J("ngIf",e.showExplanationEnabled&&e.showExplanation),i.xp6(1),i.Q6J("ngIf",i.lcZ(5,5,e.enableQuizRetake$)),i.xp6(2),i.Q6J("ngIf",!1===i.lcZ(7,7,e.quizLocked$))}}function gP(t,n){1&t&&(i.TgZ(0,"div",23),i._UZ(1,"app-spinner",24),i.qZA())}class Kn{constructor(n,e,o,s){this.changeRef=n,this.quizService=e,this.quizPDFService=o,this.snackbar=s,this.questions=[],this.showSummaryEnabled=!1,this.showExplanationEnabled=!1,this.showExplanation=!1,this.loadingPDF=!1,this.ngUnsubscribe=new X.x,this.pdfInputs=new a2.t(1)}ngOnInit(){this.initReviewListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.pdfInputs.complete()}initReviewListeners(){(0,bt.a)([this.userFullName$,this.userEmail$,this.story$,this.questions$,this.submissions$]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o,s,r])=>{this.questions=s,this.quizScore=yf(s,r),this.pdfInputs.next([n,e,o,s,this.quizScore]),this.changeRef.markForCheck()}),this.quizSettings$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(({showSummary:n,showExplanation:e})=>{this.showSummaryEnabled=!1!==n,this.showExplanationEnabled=!1!==e,this.changeRef.markForCheck()})}handleToggleSummaryClick(){this.showExplanation=!this.showExplanation}handleResultsClick(){this.loadingPDF=!0,this.pdfInputs.pipe((0,yt.q)(1),(0,Di.z)(([n,e,o,s,r])=>this.quizPDFService.downloadResultsPDF(n,e,o.displayName.toUpperCase(),s,r)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.loadingPDF=!1,n||this.snackbar.open("Error opening the results PDF."),this.changeRef.markForCheck()})}handleRestartClick(){this.quizService.resetQuiz(),this.quizService.startQuiz()}handleExitClick(){this.quizService.exitQuiz()}}Kn.\u0275fac=function(n){return new(n||Kn)(i.Y36(i.sBO),i.Y36(Ns),i.Y36(nP),i.Y36(_i.ux))},Kn.\u0275cmp=i.Xpm({type:Kn,selectors:[["app-view-quiz-review"]],decls:4,vars:3,consts:[["data-test","quizReview",1,"review"],["class","review__container","data-test","quizDownload",4,"ngIf"],[4,"ngIf"],["class","review__loading mt-10",4,"ngIf"],["data-test","quizDownload",1,"review__container"],["data-test","quizSummary",1,"text-center"],["progressColor","#2d72dc","size","medium",3,"progress"],["data-html2canvas-ignore","true",1,"mt-8","text-18","text-semibold"],[1,"mv-4","text-14","text-medium"],["class","w-100","app-button","","buttonType","outline","buttonTheme","light","data-test","quizGetResultsButton",3,"click",4,"ngIf"],["class","w-100 mt-3","app-button","","buttonType","outline","buttonTheme","light","data-test","quizToggleSummaryButton",3,"click",4,"ngIf"],["class","review__summary mt-3","data-test","quizExplanation",4,"ngIf"],["class","mt-8 w-100","app-button","","buttonType","info","buttonTheme","light","data-test","quizTakeAgainButton",3,"click",4,"ngIf"],["class","mt-3 w-100","app-button","","buttonType","info","buttonTheme","light","data-test","quizExitButton",3,"click",4,"ngIf"],["app-button","","buttonType","outline","buttonTheme","light","data-test","quizGetResultsButton",1,"w-100",3,"click"],["icon","external-link-alt",1,"mr-1"],["app-button","","buttonType","outline","buttonTheme","light","data-test","quizToggleSummaryButton",1,"w-100","mt-3",3,"click"],["data-test","quizExplanation",1,"review__summary","mt-3"],["class","mv-6",4,"ngFor","ngForOf"],[1,"mv-6"],[3,"question","questionNumber","answer","summary"],["app-button","","buttonType","info","buttonTheme","light","data-test","quizTakeAgainButton",1,"mt-8","w-100",3,"click"],["app-button","","buttonType","info","buttonTheme","light","data-test","quizExitButton",1,"mt-3","w-100",3,"click"],[1,"review__loading","mt-10"],["size","huge","direction","vertical","label","Loading"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,sP,7,3,"div",1),i.YNc(2,uP,8,9,"ng-container",2),i.YNc(3,gP,2,0,"div",3),i.qZA()),2&n&&(i.xp6(1),i.Q6J("ngIf",e.showSummaryEnabled),i.xp6(1),i.Q6J("ngIf",!e.loadingPDF),i.xp6(1),i.Q6J("ngIf",e.loadingPDF))},dependencies:[f.sg,f.O5,Dn,lt,Da,oP,Bb,f.Ov],styles:[".review[_ngcontent-%COMP%]{position:relative}.review__summary[_ngcontent-%COMP%]{background-color:#f9fafd;padding:4px 12px}"],changeDetection:0}),Fo([(0,l.Ph)(U.getAllQuestions),Uo("design:type",b.y)],Kn.prototype,"questions$",void 0),Fo([(0,l.Ph)(U.getAllSubmissions),Uo("design:type",b.y)],Kn.prototype,"submissions$",void 0),Fo([(0,l.Ph)(U.getQuizSettings),Uo("design:type",b.y)],Kn.prototype,"quizSettings$",void 0),Fo([(0,l.Ph)(U.getQuizModeLocked),Uo("design:type",b.y)],Kn.prototype,"quizLocked$",void 0),Fo([(0,l.Ph)(U.getEnableQuizRetake),Uo("design:type",b.y)],Kn.prototype,"enableQuizRetake$",void 0),Fo([(0,l.Ph)(q.getUserProfile),Uo("design:type",b.y)],Kn.prototype,"userProfile$",void 0),Fo([(0,l.Ph)(q.getUserFullName),Uo("design:type",b.y)],Kn.prototype,"userFullName$",void 0),Fo([(0,l.Ph)(q.getUserEmail),Uo("design:type",b.y)],Kn.prototype,"userEmail$",void 0),Fo([(0,l.Ph)(we.getStory),Uo("design:type",b.y)],Kn.prototype,"story$",void 0);var Xn,ji=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Qi=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function hP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleExitClick())}),i.TgZ(1,"span",11),i._uU(2,"Exit Quiz"),i.qZA()()}}function mP(t,n){if(1&t&&(i._UZ(0,"app-view-quiz-progress",12),i.ALo(1,"async"),i.ALo(2,"async")),2&t){const e=i.oxw(2);i.Q6J("index",i.lcZ(1,2,e.questionIndex$))("total",i.lcZ(2,4,e.questionTotal$))}}function fP(t,n){if(1&t&&(i.TgZ(0,"div",5)(1,"div",6)(2,"h1",7),i._uU(3,"Quiz"),i.qZA(),i.YNc(4,hP,3,0,"button",8),i.ALo(5,"async"),i.qZA(),i.YNc(6,mP,3,6,"app-view-quiz-progress",9),i.ALo(7,"async"),i.ALo(8,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(4),i.Q6J("ngIf",!i.lcZ(5,2,e.quizLocked$)),i.xp6(2),i.Q6J("ngIf",(null==(o=i.lcZ(7,4,e.quizSettings$))?null:o.showProgress)&&i.lcZ(8,6,e.lifecycle$)!==e.Lifecycle.Review)}}function bP(t,n){if(1&t&&(i._UZ(0,"app-view-quiz-question",16),i.ALo(1,"async")),2&t){const e=i.oxw(2);i.Q6J("question",i.lcZ(1,1,e.question$))}}function yP(t,n){if(1&t&&(i.TgZ(0,"div"),i._uU(1),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw(3);let o;i.xp6(1),i.hij(" ",(null==(o=i.lcZ(2,1,e.question$))?null:o.nextLabel)||e.defaultNextButtonNext," ")}}function _P(t,n){1&t&&(i.TgZ(0,"div"),i._uU(1,"Submit"),i.qZA())}function xP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",17),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleSubmit())}),i.TgZ(1,"div",18),i.ALo(2,"async"),i.YNc(3,yP,3,3,"div",19),i.YNc(4,_P,2,0,"div",20),i.qZA()()}if(2&t){const e=i.oxw(2);let o;i.Q6J("disabled",!e.form.valid),i.xp6(1),i.Q6J("ngSwitch",null==(o=i.lcZ(2,3,e.question$))?null:o.type),i.xp6(2),i.Q6J("ngSwitchCase",e.quizQuestionType.Instructions)}}function vP(t,n){if(1&t&&(i.TgZ(0,"div",13),i.YNc(1,bP,2,3,"app-view-quiz-question",14),i.ALo(2,"async"),i.YNc(3,xP,5,5,"button",15),i.ALo(4,"async"),i.ALo(5,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.Q6J("formGroup",e.form),i.xp6(1),i.Q6J("ngIf",i.lcZ(2,3,e.question$)),i.xp6(2),i.Q6J("ngIf",(null==(o=i.lcZ(4,5,e.quizSettings$))?null:o.showSubmit)&&i.lcZ(5,7,e.lifecycle$)===e.Lifecycle.Question)}}function CP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",24),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.nextQuestion())}),i._uU(1),i.ALo(2,"async"),i.qZA()}if(2&t){const e=i.oxw(2);let o;i.xp6(1),i.hij(" ",(null==(o=i.lcZ(2,1,e.question$))?null:o.nextLabel)||e.defaultNextButtonNext," ")}}function wP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",26),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(3);return i.KtG(s.handleViewSummaryClick())}),i._uU(1," See Results "),i.qZA()}}function SP(t,n){if(1&t&&(i.ynx(0),i.YNc(1,wP,2,0,"button",25),i.ALo(2,"async"),i.BQk()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",i.lcZ(2,1,e.quizReviewEnabled$))}}function PP(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"div",21),i._UZ(2,"app-view-quiz-answer",22),i.ALo(3,"async"),i.ALo(4,"async"),i.qZA(),i.ynx(5,18),i.ALo(6,"async"),i.YNc(7,CP,3,3,"button",23),i.YNc(8,SP,3,3,"ng-container",20),i.BQk()()),2&t){const e=i.oxw();i.xp6(2),i.Q6J("question",i.lcZ(3,5,e.question$))("answer",i.lcZ(4,7,e.submission$).answer)("summary",!1),i.xp6(3),i.Q6J("ngSwitch",i.lcZ(6,9,e.hasQuestionsRemaining$)),i.xp6(2),i.Q6J("ngSwitchCase",!0)}}function kP(t,n){1&t&&(i.ynx(0),i._UZ(1,"app-view-quiz-review"),i.BQk())}function OP(t,n){if(1&t&&(i.TgZ(0,"div",27),i._uU(1),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(1),i.hij(" ",1===(null==(o=i.lcZ(2,1,e.questions$))?null:o.length)?"Answer":"Answers"," submitted ")}}class zn{constructor(n,e,o,s,r,a){this.store=n,this.actions=e,this.formBuilder=o,this.viewService=s,this.applicationEventService=r,this.quizService=a,this.defaultNextButtonNext="Next Question",this.showHeader=!0,this.Lifecycle=mi,this.quizQuestionType=Re,this.sceneConfigStash={},this.ngUnsubscribe=new X.x}ngOnInit(){if(!this.store.selectSnapshot(U.getActiveQuestionId)){const n=this.store.selectSnapshot(U).questions[0].id;this.store.dispatch(new ee.SetActiveQuestion(n))}this.store.dispatch(new ee.SetQuizLifecycle(mi.Question)),this.form=this.formBuilder.group({question:new W.p4("",this.getQuizValidation())}),this.initQuestionObserver(),this.initAnswerObserver(),this.initEngineInteractionObserver(),this.applicationEventService.fireEvent(me.QuizEntered,!0)}ngOnDestroy(){Object.entries(this.sceneConfigStash).forEach(([n,e])=>{this.store.dispatch(new ks(n,e.background))}),this.applicationEventService.fireEvent(me.QuizExited,!0),this.viewService.selectTool(Ve.Select),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}get answer(){const n=this.form.get("question").value;return Array.isArray(n)?n:[n]}initQuestionObserver(){this.question$.pipe((0,w.R)(this.ngUnsubscribe),(0,$.h)(n=>void 0!==n)).subscribe(n=>{const e=this.store.selectSnapshot(_.getSelectedChapterId);n.chapterId!==e&&this.store.dispatch(new Ps(n.chapterId)),this.form.reset(),this.setSceneConfig(n),this.store.dispatch(new ee.SetActiveSubmission(void 0)),n.type===Re.Instructions&&this.form.get("question").setValue("-"),this.applicationEventService.fireEvent(me.QuizQuestionLoaded,n)})}initAnswerObserver(){this.form.get("question").valueChanges.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.store.selectSnapshot(U.getActiveQuestion),o=this.store.selectSnapshot(U.getActiveSubmission);void 0!==e&&(this.store.selectSnapshot(U.getAllSubmissions).some(s=>s.questionId===e.id)||((!o||!(0,m.isEqual)(o.answer,n))&&this.store.dispatch(new ee.SetActiveSubmission({questionId:e.id,answer:n})),(0,m.isNil)(n)||this.applicationEventService.fireEvent(me.QuizAnswerSelected,{questionId:e.id,answerId:n})))})}initEngineInteractionObserver(){this.viewService.selectTool(Ve.Quiz),this.store.dispatch(new ee.SetQuizPickMode("single")),this.actions.pipe((0,l.xt)(vc),(0,$.h)(o=>{const{node:s,event:r}=o;return!(0,m.isNil)(s)&&this.store.selectSnapshot(M.getActiveTool)===Ve.Quiz&&!r.srcEvent.shiftKey})).pipe((0,$.h)(()=>"none"!==this.store.selectSnapshot(U.getPickMode)),(0,w.R)(this.ngUnsubscribe)).subscribe(o=>{"single"===this.store.selectSnapshot(U.getPickMode)&&this.viewService.clearSelectedNodes();const r=(0,m.get)(o,"hit.objectId");if(r){const c=this.store.selectSnapshot(Se.getCheckedNodeIds).includes(r);this.store.dispatch(new Rt(!c,[r]))}}),this.question$.pipe((0,$n.x)((o,s)=>(0,m.get)(o,"id")===(0,m.get)(s,"id")),(0,$.h)(o=>!(0,m.isNil)(o))).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(o=>{const{type:s,data:r}=o;this.store.dispatch(new ee.SetQuizPickMode(s===Re.SelectAnatomy&&r.correctAnswer.length>1&&"any"!==r.selectType?"multi":"single"))})}handleSubmit(){const n=this.store.selectSnapshot(U.getActiveQuestion);(this.form.valid||n.type===Re.Instructions)&&this.quizService.submitQuestion(n.id,this.answer)}handleViewSummaryClick(){this.viewSummary()}handleExitClick(){this.quizService.exitQuiz()}nextQuestion(){this.quizService.nextQuestion()}viewSummary(){this.store.dispatch(new ee.SetQuizLifecycle(mi.Review)),this.applicationEventService.fireEvent(me.QuizCompleted,!0)}setSceneConfig(n){const{camera:e,background:o}=n?.sceneConfig||{},s=this.store.selectSnapshot(_.getChapter(n.chapterId));e&&(this.setStash(n.chapterId,{camera:s.camera.location}),setTimeout(()=>{this.store.dispatch(new Zn(e.location,!0,1))})),o&&(this.setStash(n.chapterId,{background:s.background}),this.store.dispatch(new ks(n.chapterId,o)))}setStash(n,e){this.sceneConfigStash[n]={...this.sceneConfigStash[n]||{},...e}}getQuizValidation(){return n=>{const e=n.value,o=Array.isArray(e)?e:[e],r=function L1(t){switch((0,m.get)(t,"type","")){case Re.MultipleChoice:const e=(0,m.get)(t,"data.correctAnswer","");return e&&""!==e;case Re.SelectAnatomy:case Re.LabelAnatomy:return(0,m.get)(t,"data.correctAnswer",[]).length>0;default:return!0}}(this.store.selectSnapshot(U.getActiveQuestion)),a=o.some(c=>(0,m.isNil)(c)||""===c);return r&&a?{invalidValues:a}:null}}}zn.\u0275fac=function(n){return new(n||zn)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(W.QS),i.Y36(ut),i.Y36(Lo),i.Y36(Ns))},zn.\u0275cmp=i.Xpm({type:zn,selectors:[["app-view-quiz"]],inputs:{showHeader:"showHeader"},decls:13,vars:19,consts:[["data-test","quiz",1,"view-quiz"],["class","pb-2 mb-4 view-quiz__header",4,"ngIf"],["role","form",3,"formGroup",4,"ngIf"],[4,"ngIf"],["class","text-16 text-bold text-center",4,"ngIf"],[1,"pb-2","mb-4","view-quiz__header"],[1,"flex"],[1,"text-20","text-semibold","flex-grow"],["app-pin-button","","icon","times","size","small","data-test","quizHeaderExit",3,"click",4,"ngIf"],["class","mt-3",3,"index","total",4,"ngIf"],["app-pin-button","","icon","times","size","small","data-test","quizHeaderExit",3,"click"],[1,"visually-hidden"],[1,"mt-3",3,"index","total"],["role","form",3,"formGroup"],["formControlName","question",3,"question",4,"ngIf"],["app-button","","class","w-100","buttonType","info","data-test","questionSubmit",3,"disabled","click",4,"ngIf"],["formControlName","question",3,"question"],["app-button","","buttonType","info","data-test","questionSubmit",1,"w-100",3,"disabled","click"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"mb-8"],[3,"question","answer","summary"],["app-button","","buttonType","info","class","w-100","data-test","questionNextButton",3,"click",4,"ngSwitchCase"],["app-button","","buttonType","info","data-test","questionNextButton",1,"w-100",3,"click"],["data-test","quizViewSummaryButton","app-button","","buttonType","info","class","w-100",3,"click",4,"ngIf"],["data-test","quizViewSummaryButton","app-button","","buttonType","info",1,"w-100",3,"click"],[1,"text-16","text-bold","text-center"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0),i.YNc(1,fP,9,8,"div",1),i.YNc(2,vP,6,9,"div",2),i.ALo(3,"async"),i.YNc(4,PP,9,11,"ng-container",3),i.ALo(5,"async"),i.YNc(6,kP,2,0,"ng-container",3),i.ALo(7,"async"),i.ALo(8,"async"),i.YNc(9,OP,3,3,"div",4),i.ALo(10,"async"),i.ALo(11,"async"),i.ALo(12,"async"),i.qZA()),2&n){let o;i.xp6(1),i.Q6J("ngIf",e.showHeader),i.xp6(1),i.Q6J("ngIf",i.lcZ(3,5,e.lifecycle$)===e.Lifecycle.Question),i.xp6(2),i.Q6J("ngIf",i.lcZ(5,7,e.lifecycle$)===e.Lifecycle.Explanation),i.xp6(2),i.Q6J("ngIf",i.lcZ(7,9,e.lifecycle$)===e.Lifecycle.Review&&i.lcZ(8,11,e.quizReviewEnabled$)),i.xp6(3),i.Q6J("ngIf",!(i.lcZ(10,13,e.hasQuestionsRemaining$)||i.lcZ(11,15,e.quizReviewEnabled$)||null!=(o=i.lcZ(12,17,e.quizSettings$))&&o.showExplanation))}},dependencies:[f.O5,f.RF,f.n9,f.ED,Dn,In,W.JJ,W.JL,W.sg,W.u,ss,VS,Bb,Kn,f.Ov],styles:[".view-quiz__header[_ngcontent-%COMP%]{border-bottom:1px solid #eaeff5}"],changeDetection:0}),ji([(0,l.Ph)(U.getQuizReviewEnabled),Qi("design:type",b.y)],zn.prototype,"quizReviewEnabled$",void 0),ji([(0,l.Ph)(U.getActiveQuestion),Qi("design:type",b.y)],zn.prototype,"question$",void 0),ji([(0,l.Ph)(U.getAllQuestions),Qi("design:type",b.y)],zn.prototype,"questions$",void 0),ji([(0,l.Ph)(U.getActiveQuestionIndex),Qi("design:type",b.y)],zn.prototype,"questionIndex$",void 0),ji([(0,l.Ph)(U.getQuestionTotal),Qi("design:type",b.y)],zn.prototype,"questionTotal$",void 0),ji([(0,l.Ph)(U.getCorrectAnswerTotal),Qi("design:type",b.y)],zn.prototype,"correctAnswerTotal$",void 0),ji([(0,l.Ph)(U.hasQuestionRemaining),Qi("design:type",b.y)],zn.prototype,"hasQuestionsRemaining$",void 0),ji([(0,l.Ph)(U.getQuizSettings),Qi("design:type",b.y)],zn.prototype,"quizSettings$",void 0),ji([(0,l.Ph)(U.getLifecycle),Qi("design:type",b.y)],zn.prototype,"lifecycle$",void 0),ji([(0,l.Ph)(U.getQuizModeLocked),Qi("design:type",b.y)],zn.prototype,"quizLocked$",void 0),ji([(0,l.Ph)(U.getActiveSubmission),Qi("design:type",b.y)],zn.prototype,"submission$",void 0),function(t){function c(d,u,g=!1){const h=d.createElement("div");return d.setProperty(h,"innerHTML",u),g&&h.querySelectorAll("p").forEach(k=>{d.setProperty(k,"textContent",k.textContent+" ")}),(0,m.trim)(h.textContent)}t.normalize=function n(d){return`${d||""}`.replace(/&#(\d+);/g,(g,h)=>String.fromCharCode(h)).replace(/(&.+;)/gi,(g,h)=>String.fromCharCode(g.charCodeAt(0)))},t.prettyPrint=function e(d){return`${d||""}`.trim().replace(/([A-Z])/g," $1").replace(/^./,g=>g.toUpperCase()).trim()},t.parseEmails=function o(d){return d.split(",").map(u=>u.trim()).filter(u=>!!u)},t.validateEmail=function s(d){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(d)},t.toTitleCase=function r(d){return d.replace(/\w\S*/g,u=>u.charAt(0).toUpperCase()+u.substring(1).toLowerCase())},t.getPlainTextFromMarkdown=function a(d,u,g,h=!1){return c(d,u.parse(g),h)},t.getPlainTextFromHTML=c,t.splitTextByCharacterCount=function p(d,u){for(var g=[];d.length>u;){var h=d.substring(0,u).lastIndexOf(" ");g.push(d.substring(0,h=h<=0?u:h));var y=d.indexOf(" ",h)+1;(y<h||y>h+u)&&(y=h),d=d.substring(y)}return g.push(d),g}}(Xn||(Xn={}));var jr=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Qr=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function TP(t,n){if(1&t&&(i.TgZ(0,"div",3),i._UZ(1,"app-html",4),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("markdownText",e.chapterDescription)}}const MP=function(t,n){return{"view-description--layout-column":t,"view-description--layout-drawer":n}};class Zi{constructor(n,e,o,s){this.store=n,this.viewUIService=e,this.layoutService=o,this.changeDetectorRef=s,this.viewLayout=x,this.ngUnsubscribe=new X.x,this.storyTitle="",this.chapterTitle="",this.chapterDescription="",this.layout=Tn.Drawer,this._isPopulated=!1,this.isPopulatedChange=new i.vpe}get isPopulated(){return this._isPopulated}set isPopulated(n){this._isPopulated=n,this.isPopulatedChange.emit(this.isPopulated)}ngOnInit(){this.initContentListener(),this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isEnabled(n){return this.layoutService.isUIEnabled(n)}initContentListener(){(0,bt.a)(this.story$,this.chapter$).pipe((0,$.h)(([n,e])=>!(0,m.isNil)(n)&&!(0,m.isNil)(e)),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{this.storyTitle=se.application!==mt.Viewer?Xn.normalize(n.displayName):"",this.chapterTitle=Xn.normalize(e.displayName),this.chapterDescription=(0,m.trim)(e.description),this.isPopulated=""!==this.storyTitle||!!this.chapterTitle||!!this.chapterDescription})}initLayoutListener(){this.layout$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.changeDetectorRef.markForCheck()})}}function IP(t,n){1&t&&i._UZ(0,"img",9)}function zP(t,n){1&t&&i._UZ(0,"img",9)}function AP(t,n){1&t&&i._UZ(0,"img",10)}function LP(t,n){1&t&&i._UZ(0,"img",11)}function FP(t,n){if(1&t&&(i.ynx(0),i.YNc(1,IP,1,0,"img",6),i.YNc(2,zP,1,0,"img",6),i.YNc(3,AP,1,0,"img",7),i.YNc(4,LP,1,0,"img",8),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.label.pinType==e.labelPinType.Default),i.xp6(1),i.Q6J("ngIf",e.label.pinType==e.labelPinType.Sequential),i.xp6(1),i.Q6J("ngIf",e.label.pinType===e.labelPinType.Plus||e.label.pinType===e.labelPinType.PlusMinus&&!e.selected),i.xp6(1),i.Q6J("ngIf",e.label.pinType===e.labelPinType.Minus||e.label.pinType===e.labelPinType.PlusMinus&&e.selected)}}function UP(t,n){1&t&&i._UZ(0,"img",15)}function RP(t,n){1&t&&i._UZ(0,"img",15)}function NP(t,n){1&t&&i._UZ(0,"img",16)}function EP(t,n){1&t&&i._UZ(0,"img",17)}function DP(t,n){if(1&t&&(i.YNc(0,UP,1,0,"img",12),i.YNc(1,RP,1,0,"img",12),i.YNc(2,NP,1,0,"img",13),i.YNc(3,EP,1,0,"img",14)),2&t){const e=i.oxw();i.Q6J("ngIf",e.label.pinType==e.labelPinType.Default),i.xp6(1),i.Q6J("ngIf",e.label.pinType==e.labelPinType.Sequential),i.xp6(1),i.Q6J("ngIf",e.label.pinType===e.labelPinType.Plus||e.label.pinType===e.labelPinType.PlusMinus&&!e.selected),i.xp6(1),i.Q6J("ngIf",e.label.pinType===e.labelPinType.Minus||e.label.pinType===e.labelPinType.PlusMinus&&e.selected)}}Zi.\u0275fac=function(n){return new(n||Zi)(i.Y36(l.yh),i.Y36(ri),i.Y36(ri),i.Y36(i.sBO))},Zi.\u0275cmp=i.Xpm({type:Zi,selectors:[["app-view-description"]],inputs:{layout:"layout",isPopulated:"isPopulated"},outputs:{isPopulatedChange:"isPopulatedChange"},decls:4,vars:5,consts:[[1,"view-description",3,"ngClass"],[1,"view-description__inner"],["class","view-description__body",4,"ngIf"],[1,"view-description__body"],[3,"markdownText"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1)(2,"section"),i.YNc(3,TP,2,1,"div",2),i.qZA()()()),2&n&&(i.Q6J("ngClass",i.WLB(2,MP,"column"===e.layout,"drawer"===e.layout)),i.xp6(3),i.Q6J("ngIf",e.chapterDescription))},dependencies:[f.mk,f.O5,bl],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-description{color:#131c2a;display:flex;flex-direction:column;justify-content:left}.view-description--layout-column .view-description__chapter-title{font-size:18px;letter-spacing:.45px;line-height:1.4em}.view-description--layout-column .view-description__body{padding:4px 8px 12px}.view-description--layout-drawer .view-description__story-title{text-align:center}.view-description--layout-drawer .view-description__story-title--large{font-size:14px;letter-spacing:.35px;line-height:1.4em}.view-description--layout-drawer .view-description__body{padding-top:4px}.view-description__inner{flex:1 0 auto}.view-description__story-title{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase;word-wrap:break-word;overflow-wrap:break-word;flex-grow:1;font-weight:600;color:#374a68}.view-description__story-title--large{font-size:18px;letter-spacing:.45px;line-height:1.4em;text-transform:initial}.view-description__body{font-size:14px;letter-spacing:.35px;line-height:1.4em;word-wrap:break-word;overflow-wrap:break-word;padding-top:8px;color:#374a68}\n"],encapsulation:2,changeDetection:0}),jr([(0,l.Ph)(we.getStory),Qr("design:type",b.y)],Zi.prototype,"story$",void 0),jr([(0,l.Ph)(we.getStoryLanguage),Qr("design:type",b.y)],Zi.prototype,"storyLanguage$",void 0),jr([(0,l.Ph)(_.getSelectedChapter),Qr("design:type",b.y)],Zi.prototype,"chapter$",void 0),jr([(0,l.Ph)(_.getSelectedChapterIndex),Qr("design:type",b.y)],Zi.prototype,"chapterIndex$",void 0),jr([(0,l.Ph)(_.getChapterCount),Qr("design:type",b.y)],Zi.prototype,"chapterCount$",void 0),jr([(0,l.Ph)(O.getUI),Qr("design:type",b.y)],Zi.prototype,"layout$",void 0);const jP=function(t,n){return{"label-pin__text--white":t,"label-pin__text--black":n}};function QP(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"div",18),i._uU(2),i.qZA(),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngClass",i.WLB(2,jP,e.labelTheme===e.labelThemeEnum.StudioNext,e.labelTheme===e.labelThemeEnum.Annotation)),i.xp6(1),i.hij(" ",e.sequence," ")}}const ZP=function(t,n,e,o){return{"label-pin--light":t,"label-pin--dark":n,"label-pin--none":e,"label-pin--selected":o}};let jy=(()=>{class t{constructor(){this.labelPinType=St,this.labelThemeEnum=qt,this.labelTheme=qt.StudioNext,this.selected=!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-label-pin"]],inputs:{label:"label",labelTheme:"labelTheme",selected:"selected",sequence:"sequence"},decls:7,vars:9,consts:[[1,"label-pin",3,"ngClass"],["pin",""],[4,"ngIf","ngIfElse"],["lightPins",""],[4,"ngIf"],[1,"label__glow"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg",1,"label-pin__image"],[1,"label-pin__text",3,"ngClass"]],template:function(e,o){if(1&e&&(i.TgZ(0,"div",0,1),i.YNc(2,FP,5,4,"ng-container",2),i.YNc(3,DP,4,4,"ng-template",null,3,i.W1O),i.YNc(5,QP,3,5,"ng-container",4),i._UZ(6,"div",5),i.qZA()),2&e){const s=i.MAs(4);i.Q6J("ngClass",i.l5B(4,ZP,o.labelTheme===o.labelThemeEnum.StudioNext,o.labelTheme===o.labelThemeEnum.Annotation,o.label.pinType===o.labelPinType.None,o.selected)),i.xp6(2),i.Q6J("ngIf",o.labelTheme===o.labelThemeEnum.Annotation)("ngIfElse",s),i.xp6(3),i.Q6J("ngIf",o.label.pinType===o.labelPinType.Sequential)}},dependencies:[f.mk,f.O5],styles:['.label-pin[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;position:relative;transition:background-color .12s;z-index:10}.label-pin__text[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;top:0;z-index:10;width:100%;height:100%;justify-content:center;align-items:center;font-size:10px!important;color:#101823}.label-pin[_ngcontent-%COMP%]:before{content:" ";background-color:transparent;border:2px solid transparent;border-radius:50%;box-sizing:border-box;display:block;position:absolute;top:0;left:0;z-index:-2;height:100%;width:100%}.label-pin--light.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label-pin--light.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#101823}.label-pin--dark.label-pin[_ngcontent-%COMP%]:before{background-color:#000000bf}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#2d72dc}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:after{background-color:#2d72dc}.label-pin--dark.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#fff}.label-pin--none.label-pin[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),t})();var Qy=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Zy=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const BP=function(t){return{"view-labels__item--selected":t}};function VP(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"li")(1,"button",2),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.handleLabelClick(r))})("keyup.enter",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.handleLabelClick(r))}),i.ALo(2,"async"),i.ALo(3,"async"),i.TgZ(4,"span",3),i._uU(5,"Navigate to description for, "),i.qZA(),i.TgZ(6,"div",4)(7,"div",5),i._UZ(8,"app-label-pin",6),i.qZA()(),i.TgZ(9,"div",7),i._UZ(10,"div",8),i.ALo(11,"markdown"),i.qZA()()()}if(2&t){const e=n.$implicit,o=i.oxw();let s,r;i.xp6(1),i.Q6J("ngClass",i.VKq(11,BP,(null==(s=i.lcZ(2,5,o.selectedLabel$))?null:s.id)===e.id)),i.uIk("aria-current",(null==(r=i.lcZ(3,7,o.selectedLabel$))?null:r.id)===e.id),i.xp6(7),i.Q6J("label",e)("sequence",o.getLabelSequence(e)),i.xp6(2),i.Q6J("innerHTML",i.lcZ(11,9,e.title),i.oJD)}}class js{constructor(n,e){this.viewService=n,this.store=e,this.labelPinType=St,this.labelSequentialtype=ii}ngOnInit(){}getLabelSequence(n){return this.store.selectSnapshot(te.getLabelSequence(n))}handleLabelClick(n){this.viewService.selectLabel(n,!0)}}function qP(t,n){if(1&t&&(i.TgZ(0,"div",6),i._uU(1),i.qZA()),2&t){const e=i.oxw().$implicit;i.xp6(1),i.Oqu(e.description)}}function $P(t,n){if(1&t&&(i.TgZ(0,"li",2),i._UZ(1,"div",3),i.TgZ(2,"div",4)(3,"div"),i._uU(4),i.qZA(),i.YNc(5,qP,2,1,"div",5),i.qZA()()),2&t){const e=n.$implicit,o=i.oxw();i.xp6(1),i.Udp("background-color",o.getComputedColor(e.colors)),i.xp6(3),i.Oqu(e.label),i.xp6(1),i.Q6J("ngIf",e.description)}}js.\u0275fac=function(n){return new(n||js)(i.Y36(ut),i.Y36(l.yh))},js.\u0275cmp=i.Xpm({type:js,selectors:[["app-view-labels"]],decls:3,vars:3,consts:[[1,"view-labels"],[4,"ngFor","ngForOf"],[1,"view-labels__item",3,"ngClass","click","keyup.enter"],[1,"visually-hidden"],[1,"view-labels__pre"],[1,"view-labels__pin"],[3,"label","sequence"],[1,"view-labels__body"],[1,"view-labels__title","html",3,"innerHTML"]],template:function(n,e){1&n&&(i.TgZ(0,"ul",0),i.YNc(1,VP,12,13,"li",1),i.ALo(2,"async"),i.qZA()),2&n&&(i.xp6(1),i.Q6J("ngForOf",i.lcZ(2,1,e.labels$)))},dependencies:[f.mk,f.sg,jy,En.NO,f.Ov],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-labels__item{background:none;border:0;border-left:4px solid transparent;border-radius:2px;display:flex;padding:12px 8px;margin-bottom:4px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;text-align:left}.view-labels__item:focus{outline:#2d72dc solid 2px!important}.view-labels__item:hover{background:#eaeff5}.view-labels__item--selected{background:#f0f8ff;border-left:4px solid #2d72dc}.view-labels__item--selected:hover{background:#f0f8ff}.view-labels__pre{flex:0 0 32px;display:flex;justify-content:center;position:relative}.view-labels__pin{display:flex;align-items:center;justify-content:center;position:absolute}.view-labels__title{color:#131c2a;font-size:14px;letter-spacing:.35px;line-height:1.4em}.view-labels__description{color:#374a68;padding-top:4px;font-size:14px;letter-spacing:.35px;line-height:1.4em}.view-labels__label{position:absolute;font-size:10px;top:3px}\n"],encapsulation:2,changeDetection:0}),Qy([(0,l.Ph)(te.getChapterLabels),Zy("design:type",b.y)],js.prototype,"labels$",void 0),Qy([(0,l.Ph)(te.getSelectedLabel),Zy("design:type",b.y)],js.prototype,"selectedLabel$",void 0);let GP=(()=>{class t{constructor(){}ngOnInit(){}getComputedColor(e){return wo.rgbToHex(e,!0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-legend"]],inputs:{legend:"legend"},decls:2,vars:1,consts:[["aria-label","Legend","role","complementary",1,"view-legend"],["class","view-legend__item",4,"ngFor","ngForOf"],[1,"view-legend__item"],[1,"view-legend__color","mh-2"],[1,"view-legend__content","text-14"],["class","mv-2",4,"ngIf"],[1,"mv-2"]],template:function(e,o){1&e&&(i.TgZ(0,"ul",0),i.YNc(1,$P,6,4,"li",1),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngForOf",o.legend))},dependencies:[f.sg,f.O5],styles:['.view-legend{display:flex;flex-direction:column}.view-legend__item{padding:8px 0;display:flex;flex-direction:row;justify-content:flex-start;align-items:flex-start}.view-legend__content{display:flex;flex-direction:column}.view-legend__color{content:" ";display:block;flex:0 0 16px;width:16px;height:16px;border-radius:50%}.view-legend__color:after{content:" "}\n'],encapsulation:2,changeDetection:0}),t})();function JP(t,n){if(1&t&&(i.TgZ(0,"div",2)(1,"h2",3),i._uU(2),i.qZA(),i.Hsn(3,1,["class","view-panel__actions","actions",""]),i.qZA()),2&t){const e=i.oxw();i.xp6(2),i.hij(" ",e.label," ")}}const HP=["*",[["","actions",""]]],YP=function(t,n){return{"view-panel--padding-none":t,"view-panel--padding-dense":n}},WP=["*","[actions]"];let By=(()=>{class t{constructor(){this.label="",this.showHeader=!0,this.padding="normal"}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-panel"]],inputs:{label:"label",showHeader:"showHeader",padding:"padding"},ngContentSelectors:WP,decls:3,vars:5,consts:[[1,"view-panel",3,"ngClass"],["class","view-panel__header",4,"ngIf"],[1,"view-panel__header"],[1,"view-panel__label"]],template:function(e,o){1&e&&(i.F$t(HP),i.TgZ(0,"div",0),i.YNc(1,JP,4,1,"div",1),i.Hsn(2),i.qZA()),2&e&&(i.Q6J("ngClass",i.WLB(2,YP,"none"===o.padding,"dense"===o.padding)),i.xp6(1),i.Q6J("ngIf",o.showHeader))},dependencies:[f.mk,f.O5],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-panel{border-bottom:1px solid #eaeff5;padding:0 0 32px;margin-bottom:16px}.view-panel--padding-none{padding:0;margin:0}.view-panel--padding-dense{padding:0 0 8px;margin:0 0 8px}.view-panel__label{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;color:#374a68;font-weight:600;display:flex;align-items:center;min-height:28px}.view-panel__header{display:flex;flex-direction:row;align-items:flex-start;justify-content:space-between;margin-bottom:16px}\n"],encapsulation:2,changeDetection:0}),t})();var Nl=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},El=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function KP(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-content-blocks",7),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("contentBlocks",i.lcZ(2,2,e.contentBlocks$))("include",e.contentBlockTypes.Ticker)}}function XP(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-content-blocks",8),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("contentBlocks",i.lcZ(2,2,e.contentBlocks$))("exclude",e.contentBlockTypes.Ticker)}}function ek(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"app-view-panel",4),i.YNc(1,KP,3,4,"div",5),i.ALo(2,"async"),i.TgZ(3,"app-view-description",6),i.NdJ("isPopulatedChange",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.isPopulated=s)}),i.qZA(),i.YNc(4,XP,3,4,"div",5),i.ALo(5,"async"),i.qZA()}if(2&t){const e=i.oxw();let o,s;i.Q6J("showHeader",!1)("hidden",!e.isPopulated),i.xp6(1),i.Q6J("ngIf",(null==(o=i.lcZ(2,6,e.contentBlocks$))?null:o.length)>0),i.xp6(2),i.Q6J("isPopulated",e.isPopulated)("layout",e.layout),i.xp6(1),i.Q6J("ngIf",(null==(s=i.lcZ(5,8,e.contentBlocks$))?null:s.length)>0)}}function tk(t,n){if(1&t&&(i.TgZ(0,"app-view-panel",9),i._UZ(1,"app-view-legend",10),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("legend",i.lcZ(2,1,e.chapter$).legend)}}function nk(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",13)(1,"button",14),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePrevClick())}),i.qZA(),i.TgZ(2,"button",15),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleNextClick())}),i.qZA()()}}function ik(t,n){if(1&t&&(i.TgZ(0,"app-view-panel",11),i.YNc(1,nk,3,0,"div",12),i.ALo(2,"async"),i._UZ(3,"app-view-labels"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(1),i.Q6J("ngIf",(null==(o=i.lcZ(2,1,e.labels$))?null:o.length)>1)}}class oo{constructor(n,e,o,s){this.store=n,this.viewService=e,this.layoutService=o,this.changeDetectorRef=s,this.ngUnsubscribe=new X.x,this.layout=Tn.Column,this.viewLayout=x,this.isPopulated=!0,this.descriptionVisible=!1,this.legendVisible=!1,this.labelListVisible=!1,this.contentBlockTypes=zi}ngOnInit(){this.store.select(O.getUI).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.descriptionVisible=this.isVisible(x.Description),this.legendVisible=this.isVisible(x.Legend),this.labelListVisible=this.isVisible(x.LabelList),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isVisible(n){return this.layoutService.isUIVisible(n)}isEnabled(n){return this.layoutService.isUIEnabled(n)}handlePrevClick(){this.selectLabel(-1)}handleNextClick(){this.selectLabel(1)}selectLabel(n){const e=this.store.selectSnapshot(te.getChapterLabels),o=e.length,s=this.store.selectSnapshot(te.getSelectedLabelId),r=e.findIndex(d=>d.id===s),p=e[((-1!==r?r+n:0)%o+o)%o];p&&this.viewService.selectLabel(p,!0)}}oo.\u0275fac=function(n){return new(n||oo)(i.Y36(l.yh),i.Y36(ut),i.Y36(ri),i.Y36(i.sBO))},oo.\u0275cmp=i.Xpm({type:oo,selectors:[["app-view-content-mode"]],inputs:{layout:"layout"},decls:7,vars:9,consts:[[1,"view-content-mode"],["role","complementary","aria-describedby","view-title",3,"showHeader","hidden",4,"ngIf"],["label","Legend",4,"ngIf"],["label","Labels","role","complementary","aria-label","Labels",4,"ngIf"],["role","complementary","aria-describedby","view-title",3,"showHeader","hidden"],[4,"ngIf"],[3,"isPopulated","layout","isPopulatedChange"],[3,"contentBlocks","include"],[3,"contentBlocks","exclude"],["label","Legend"],[3,"legend"],["label","Labels","role","complementary","aria-label","Labels"],["actions","","class","flex",4,"ngIf"],["actions","",1,"flex"],["app-pin-button","","icon","chevron-left","size","small","buttonType","ghost","aria-label","Previous Label","matTooltip","Previous Label","data-test","previousLabelButton",3,"click"],["app-pin-button","","icon","chevron-right","size","small","buttonType","ghost","aria-label","Next Label","matTooltip","Next Label","data-test","nextLabelButton",3,"click"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0),i.YNc(1,ek,6,10,"app-view-panel",1),i.YNc(2,tk,3,3,"app-view-panel",2),i.ALo(3,"async"),i.ALo(4,"async"),i.YNc(5,ik,4,3,"app-view-panel",3),i.ALo(6,"async"),i.qZA()),2&n){let o,s;i.xp6(1),i.Q6J("ngIf",e.descriptionVisible),i.xp6(1),i.Q6J("ngIf",(null==(o=i.lcZ(3,3,e.chapter$))?null:o.legend)&&(null==(o=i.lcZ(4,5,e.chapter$))?null:o.legend.length)>0&&e.legendVisible),i.xp6(3),i.Q6J("ngIf",(null==(s=i.lcZ(6,7,e.labels$))?null:s.length)&&e.labelListVisible)}},dependencies:[f.O5,Gt.gM,In,ja,Zi,js,GP,By,f.Ov],styles:[".view-content-mode[_ngcontent-%COMP%]{padding-bottom:24px}"],changeDetection:0}),Nl([(0,l.Ph)(_.getStoryChapters),El("design:type",b.y)],oo.prototype,"chapters$",void 0),Nl([(0,l.Ph)(_.getSelectedChapter),El("design:type",b.y)],oo.prototype,"chapter$",void 0),Nl([(0,l.Ph)(_.getSelectedChapterContentBlocks),El("design:type",b.y)],oo.prototype,"contentBlocks$",void 0),Nl([(0,l.Ph)(te.getChapterLabels),El("design:type",b.y)],oo.prototype,"labels$",void 0);var jt=A(8255),Zr=A(5700);let sk=(()=>{class t{transform(e,o){return function ok(t){if(null==t)return"";const n=new RegExp(/[^a-zA-Z0-9_]/,"gi");return t.replace(n,"_")}(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"elementID",type:t,pure:!0}),t})();var Va=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},qa=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const rk=["chapterMenu"];function ak(t,n){1&t&&i.Hsn(0)}function ck(t,n){1&t&&i.GkF(0)}function lk(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"button",5),i.NdJ("menuOpened",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleMenuOpened())}),i.YNc(2,ck,1,0,"ng-container",6),i.qZA(),i.BQk()}if(2&t){const e=i.oxw(),o=i.MAs(5),s=i.MAs(1);i.xp6(1),i.Q6J("buttonShape",e.buttonShape)("fill",!0)("matMenuTriggerFor",o),i.xp6(1),i.Q6J("ngTemplateOutlet",s)}}function pk(t,n){1&t&&(i.TgZ(0,"span",12),i._uU(1,"current"),i.qZA())}const dk=function(t,n){return{"view-chapters__item--viewed":t,"view-chapters__item--selected":n}};function uk(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.handleChapterClick(r))}),i.ALo(1,"elementID"),i.ALo(2,"async"),i.TgZ(3,"div",8),i._uU(4),i.qZA(),i.TgZ(5,"div",9),i._uU(6),i.qZA(),i.YNc(7,pk,2,0,"span",10),i.ALo(8,"async"),i._UZ(9,"div",11),i.qZA()}if(2&t){const e=n.$implicit,o=n.index,s=i.oxw();i.Q6J("ngClass",i.WLB(13,dk,s.isViewed(e.id),e.id===i.lcZ(2,9,s.selectedChapterId$))),i.uIk("data-chapter-id",i.lcZ(1,7,e.id)),i.xp6(4),i.hij("",o+1,"."),i.xp6(2),i.Oqu(e.displayName),i.xp6(1),i.Q6J("ngIf",e.id===i.lcZ(8,11,s.selectedChapterId$)),i.xp6(2),i.Q6J("defaultImage",s.defaultImage)("lazyLoad",s.getChapterThumb(e.id))}}class xi{constructor(n,e){this.store=n,this.viewService=e,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png",this.buttonShape="circle"}handleChapterClick(n){this.viewService.selectChapter(n)}handleMenuOpened(){const n=this.store.selectSnapshot(_.getSelectedChapterIndex);this.chapterMenu._allItems.toArray()[n].focus()}getChapterThumb(n){const o=this.store.selectSnapshot(Wt.getRegisteredThumbnails).get(n);return o?o.snapshot||o.urls.small:""}isViewed(n){return this.store.selectSnapshot(_.getChaptersViewed).some(e=>e===n)}}xi.\u0275fac=function(n){return new(n||xi)(i.Y36(l.yh),i.Y36(ut))},xi.\u0275cmp=i.Xpm({type:xi,selectors:[["app-view-chapters"]],viewQuery:function(n,e){if(1&n&&i.Gf(rk,7),2&n){let o;i.iGM(o=i.CRH())&&(e.chapterMenu=o.first)}},inputs:{defaultImage:"defaultImage",buttonShape:"buttonShape"},ngContentSelectors:["*"],decls:8,vars:7,consts:[["contentTmp",""],[4,"ngIf","ngIfElse"],[1,"view-chapters"],["chapterMenu","matMenu"],["mat-menu-item","","class","view-chapters__item",3,"ngClass","click",4,"ngFor","ngForOf"],["app-pin-button","","buttonAlign","left","buttonType","ghost","data-test","viewChaptersButton",1,"w-100","h-100",3,"buttonShape","fill","matMenuTriggerFor","menuOpened"],[4,"ngTemplateOutlet"],["mat-menu-item","",1,"view-chapters__item",3,"ngClass","click"],[1,"view-chapters__index"],[1,"view-chapters__title"],["class","visually-hidden",4,"ngIf"],[1,"view-chapters__thumb",3,"defaultImage","lazyLoad"],[1,"visually-hidden"]],template:function(n,e){if(1&n&&(i.F$t(),i.YNc(0,ak,1,0,"ng-template",null,0,i.W1O),i.YNc(2,lk,3,4,"ng-container",1),i.ALo(3,"async"),i.TgZ(4,"mat-menu",2,3),i.YNc(6,uk,10,16,"button",4),i.ALo(7,"async"),i.qZA()),2&n){const o=i.MAs(1);let s;i.xp6(2),i.Q6J("ngIf",(null==(s=i.lcZ(3,3,e.chapters$))?null:s.length)>1)("ngIfElse",o),i.xp6(4),i.Q6J("ngForOf",i.lcZ(7,5,e.chapters$))}},dependencies:[f.mk,f.sg,f.O5,f.tP,jt.VK,jt.OP,jt.p6,In,Zr.z1,f.Ov,sk],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-chapters{min-width:300px;max-height:320px;overflow:auto;padding:8px}.view-chapters button.mat-menu-item{height:auto;font-size:14px;letter-spacing:.35px;line-height:1.4em}.view-chapters button.mat-button-toggle-focus-overlay{display:none}.view-chapters__item{height:auto;white-space:normal;display:flex!important;padding:8px!important;border-radius:4px;border:2px solid transparent;background-color:transparent;color:#131c2a;margin-bottom:4px;transition:background-color 125ms,color 125ms,border 125ms}.view-chapters__item:hover{cursor:pointer;background:#eaeff5}.view-chapters__item--selected{border-color:#2d72dc}.view-chapters__index{display:flex;flex:0 0 32px;justify-content:center}.view-chapters__thumb{background-color:#f9fafd;border-radius:4px;background-repeat:no-repeat;flex:0 0 56px;height:56px;width:56px;transition:border-color .1s}.view-chapters__title{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word;white-space:normal;display:flex;flex:1 1 auto;padding-right:4px}.view-chapters__thumb{background-size:cover}\n"],encapsulation:2,changeDetection:0}),Va([(0,l.Ph)(_.getStoryChapters),qa("design:type",b.y)],xi.prototype,"chapters$",void 0),Va([(0,l.Ph)(_.getSelectedChapterId),qa("design:type",b.y)],xi.prototype,"selectedChapterId$",void 0),Va([(0,l.Ph)(_.getSelectedChapterIndex),qa("design:type",b.y)],xi.prototype,"selectedChapterIndex$",void 0),Va([(0,l.Ph)(Wt.getRegisteredThumbnails),qa("design:type",b.y)],xi.prototype,"thumbnails$",void 0),Va([(0,l.Ph)(_.getChaptersViewed),qa("design:type",b.y)],xi.prototype,"chaptersViewed$",void 0);let hk=(()=>{class t{transform(e,o){return Xn.normalize(`${e||""}`)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"textNormalize",type:t,pure:!0}),t})();var $a=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ga=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const mk=function(t){return{"view-description__story-title--large":t}};function fk(t,n){if(1&t&&(i.TgZ(0,"h1",7),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngClass",i.VKq(2,mk,!e.chapterTitle)),i.xp6(1),i.hij(" ",e.storyTitle," ")}}function bk(t,n){if(1&t&&(i.TgZ(0,"span"),i._uU(1),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij("",i.lcZ(2,1,e.chapterIndex$)+1,".")}}function yk(t,n){1&t&&i._UZ(0,"app-icon",8)}const _k=function(t,n){return{"view-title--clickable":t,"view-title--large":n}};class vi{constructor(n,e){this.layoutService=n,this.changeDetectorRef=e,this._isPopulated=!1,this.isPopulatedChange=new i.vpe,this._menuEnabled=!0,this.viewLayout=x,this.ngUnsubscribe=new X.x,this.storyTitle="",this.chapterTitle=""}get isPopulated(){return this._isPopulated}set isPopulated(n){this._isPopulated=n,this.isPopulatedChange.emit(this.isPopulated)}get menuEnabled(){return this._menuEnabled}set menuEnabled(n){this._menuEnabled=n}ngOnInit(){this.initContentListener(),this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isEnabled(n){return this.layoutService.isUIEnabled(n)}initContentListener(){(0,bt.a)([this.story$,this.chapter$]).pipe((0,$.h)(([n,e])=>null!=e&&null!=n),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{this.storyTitle=se.application!==mt.Viewer?Xn.normalize(n.displayName):"",this.chapterTitle=Xn.normalize(e.displayName),this.isPopulated=!!this.chapterTitle||!!this.storyTitle})}initLayoutListener(){this.layout$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.changeDetectorRef.markForCheck()})}}vi.\u0275fac=function(n){return new(n||vi)(i.Y36(ri),i.Y36(i.sBO))},vi.\u0275cmp=i.Xpm({type:vi,selectors:[["app-view-title"]],viewQuery:function(n,e){if(1&n&&i.Gf(xi,5),2&n){let o;i.iGM(o=i.CRH())&&(e.chapterListComponentMenu=o.first)}},inputs:{size:"size",isPopulated:"isPopulated",menuEnabled:"menuEnabled"},outputs:{isPopulatedChange:"isPopulatedChange"},decls:12,vars:16,consts:[[1,"view-title",3,"ngClass"],["buttonShape","square","id","chapter-title"],[1,"p-2"],["id","view-title","class","view-title__story",3,"ngClass",4,"ngIf"],["id","view-title",1,"view-title__chapter"],[4,"ngIf"],["icon","caret-down",4,"ngIf"],["id","view-title",1,"view-title__story",3,"ngClass"],["icon","caret-down"]],template:function(n,e){1&n&&(i.TgZ(0,"section",0),i.ALo(1,"async"),i.TgZ(2,"app-view-chapters",1)(3,"div",2),i.YNc(4,fk,2,4,"h1",3),i.TgZ(5,"h1",4),i.YNc(6,bk,3,3,"span",5),i.ALo(7,"async"),i._uU(8),i.ALo(9,"textNormalize"),i.YNc(10,yk,1,0,"app-icon",6),i.ALo(11,"async"),i.qZA()()()()),2&n&&(i.Q6J("ngClass",i.WLB(13,_k,i.lcZ(1,5,e.chapterCount$)>1&&e.menuEnabled,"large"===e.size)),i.xp6(4),i.Q6J("ngIf",e.storyTitle&&e.storyTitle!=e.chapterTitle),i.xp6(2),i.Q6J("ngIf",i.lcZ(7,7,e.chapterCount$)>1&&e.menuEnabled),i.xp6(2),i.hij(" ",i.lcZ(9,9,e.chapterTitle)," "),i.xp6(2),i.Q6J("ngIf",i.lcZ(11,11,e.chapterCount$)>1&&e.menuEnabled))},dependencies:[f.mk,f.O5,lt,xi,f.Ov,hk],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-title{word-wrap:break-word;overflow-wrap:break-word;border-radius:4px;padding:4px;margin:0 -4px;transition:background-color 125ms}.view-title--large{font-size:18px;letter-spacing:.45px;line-height:1.4em}.view-title__story{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase;word-wrap:break-word;overflow-wrap:break-word;text-align:left;font-weight:600;color:var(--view-description-secondary-color)}.view-title__chapter{font-size:14px;letter-spacing:.35px;line-height:1.4em;text-align:left;font-weight:600;color:#131c2a}\n"],encapsulation:2,changeDetection:0}),$a([(0,l.Ph)(we.getStory),Ga("design:type",b.y)],vi.prototype,"story$",void 0),$a([(0,l.Ph)(_.getSelectedChapter),Ga("design:type",b.y)],vi.prototype,"chapter$",void 0),$a([(0,l.Ph)(_.getChapterCount),Ga("design:type",b.y)],vi.prototype,"chapterCount$",void 0),$a([(0,l.Ph)(_.getSelectedChapterIndex),Ga("design:type",b.y)],vi.prototype,"chapterIndex$",void 0),$a([(0,l.Ph)(O.getUI),Ga("design:type",b.y)],vi.prototype,"layout$",void 0);var Ci=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},wi=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const xk=["viewDrawer"],vk=["viewDrawerOuter"];function Ck(t,n){if(1&t&&(i.TgZ(0,"div",7),i._UZ(1,"app-spinner",8),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(1),i.Q6J("label",null==(o=i.lcZ(2,1,e.scrim$))?null:o.label)}}function wk(t,n){1&t&&i._UZ(0,"app-icon",22)}function Sk(t,n){1&t&&i._UZ(0,"app-icon",23)}function Pk(t,n){if(1&t&&(i.TgZ(0,"div",24),i._UZ(1,"app-content-blocks",25),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw(2);let o;i.xp6(1),i.Q6J("contentBlocks",null==(o=i.lcZ(2,2,e.selectedLabel$))?null:o.contentBlocks)("layout","compact")}}function kk(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"div",9)(2,"div",10)(3,"button",11),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleLabelBack())}),i._UZ(4,"app-icon",12),i.qZA()(),i.TgZ(5,"div",13),i._UZ(6,"app-html",14),i.ALo(7,"async"),i.qZA(),i.TgZ(8,"div",15)(9,"button",16),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggleClick())}),i.YNc(10,wk,1,0,"app-icon",17),i.YNc(11,Sk,1,0,"app-icon",18),i.qZA()()(),i.YNc(12,Pk,3,4,"div",19),i.ALo(13,"async"),i.TgZ(14,"div",20),i._UZ(15,"app-html",21),i.ALo(16,"async"),i.qZA(),i.BQk()}if(2&t){const e=i.oxw();let o,s,r;i.xp6(6),i.Q6J("markdownText",null==(o=i.lcZ(7,7,e.selectedLabel$))?null:o.title),i.xp6(3),i.uIk("aria-expanded",e.open)("aria-label",e.open?"Close Info Panel":"Open Info Panel"),i.xp6(1),i.Q6J("ngIf",!e.open),i.xp6(1),i.Q6J("ngIf",e.open),i.xp6(1),i.Q6J("ngIf",null==(s=i.lcZ(13,9,e.selectedLabel$))?null:s.contentBlocks),i.xp6(3),i.Q6J("markdownText",null==(r=i.lcZ(16,11,e.selectedLabel$))?null:r.description)}}function Ok(t,n){1&t&&(i.ynx(0),i._UZ(1,"app-view-title",30),i.BQk()),2&t&&(i.xp6(1),i.Q6J("menuEnabled",!1))}function Tk(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",36),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(3);return i.KtG(s.handleExitQuiz())}),i._UZ(1,"app-icon",37),i.qZA()}}function Mk(t,n){if(1&t&&(i.TgZ(0,"span",38)(1,"span",39),i._uU(2),i.ALo(3,"async"),i.qZA(),i._uU(4),i.ALo(5,"async"),i.qZA()),2&t){const e=i.oxw(3);i.xp6(2),i.hij("Question ",i.lcZ(3,2,e.activeQuestionIndex$)+1,""),i.xp6(2),i.hij(" of ",i.lcZ(5,4,e.questionTotal$)," ")}}function Ik(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"div",31),i.YNc(2,Tk,2,0,"button",32),i.ALo(3,"async"),i.qZA(),i.TgZ(4,"div",13)(5,"div",33)(6,"span",34),i._uU(7,"Quiz"),i.qZA(),i.YNc(8,Mk,6,6,"span",35),i.ALo(9,"async"),i.ALo(10,"async"),i.qZA()(),i.BQk()),2&t){const e=i.oxw(2);let o;i.xp6(2),i.Q6J("ngIf",!i.lcZ(3,2,e.quizLocked$)),i.xp6(6),i.Q6J("ngIf",(null==(o=i.lcZ(9,4,e.quizSettings$))?null:o.showProgress)&&i.lcZ(10,6,e.questionRemaining$)>0)}}function zk(t,n){1&t&&i._UZ(0,"app-icon",22)}function Ak(t,n){1&t&&i._UZ(0,"app-icon",23)}function Lk(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",40),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleToggleClick())}),i.YNc(1,zk,1,0,"app-icon",17),i.YNc(2,Ak,1,0,"app-icon",18),i.qZA()}if(2&t){const e=i.oxw(2);i.uIk("aria-expanded",e.open)("aria-label",e.open?"Close Info Panel":"Open Info Panel"),i.xp6(1),i.Q6J("ngIf",!e.open),i.xp6(1),i.Q6J("ngIf",e.open)}}function Fk(t,n){1&t&&i._UZ(0,"app-view-content-mode",42)}function Uk(t,n){if(1&t&&(i.ynx(0),i.YNc(1,Fk,1,0,"app-view-content-mode",41),i.BQk()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.expandable)}}function Rk(t,n){1&t&&i._UZ(0,"app-view-quiz",43),2&t&&i.Q6J("showHeader",!1)}function Nk(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"article",9),i.YNc(2,Ok,2,1,"ng-container",26),i.ALo(3,"async"),i.YNc(4,Ik,11,8,"ng-container",26),i.ALo(5,"async"),i.TgZ(6,"div",27),i.YNc(7,Lk,3,4,"button",28),i.qZA()(),i.TgZ(8,"div",20),i.YNc(9,Uk,2,1,"ng-container",26),i.ALo(10,"async"),i.YNc(11,Rk,1,1,"app-view-quiz",29),i.ALo(12,"async"),i.qZA(),i.BQk()),2&t){const e=i.oxw();i.xp6(2),i.Q6J("ngIf",!i.lcZ(3,5,e.quizModeActive$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(5,7,e.quizModeActive$)),i.xp6(3),i.Q6J("ngIf",e.expandable),i.xp6(2),i.Q6J("ngIf",!i.lcZ(10,9,e.quizModeActive$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(12,11,e.quizModeActive$))}}const Ek=function(t,n,e,o){return{"view-drawer--closed":t,"view-drawer--active":n,"view-drawer--scrollable":e,"view-drawer--fixed":o}};class xn{constructor(n,e,o,s,r,a){this.renderer=n,this.changeDetectorRef=e,this.viewService=o,this.quizService=s,this.store=r,this.layoutService=a,this.offsetYChange=new i.vpe,this.breakpoints={minimumDrawer:{velocity:1/0,point:0},halfDrawer:{velocity:1,point:0}},this.ngUnsubscribe=new X.x,this.viewMode=Ui,this.viewToolsMode=_n,this.mode=Ui.Content,this.open=!1}get expandable(){return"full"===this.layoutService.getVisibleContent()||this.mode===Ui.LabelInfo||this.mode===Ui.NodeInfo||this.open}ngOnInit(){this.initWindowSizeObserver(),this.initLayoutObserver(),this.initQuizObserver()}ngAfterViewInit(){this.refresh(this.store.selectSnapshot(O.getUI).drawer.isExpanded)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWindowSizeObserver(){(0,Sf.z)((0,Dt.R)(window,"resize"),(0,Dt.R)(window,"orientationchange")).pipe((0,Rr.g)(0),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.refresh(!1)})}initLayoutObserver(){this.layout$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.updateMode(n),n.drawer.isExpanded!==this.open&&this.toggleDrawer(n.drawer.isExpanded)})}initQuizObserver(){const n=this.selectedChapterReady$.pipe((0,J.U)(e=>e&&e.model),(0,$.h)(e=>e),(0,cn.b)(300));(0,bt.a)([n,this.quizModeActive$]).pipe((0,$.h)(([e])=>e),(0,w.R)(this.ngUnsubscribe)).subscribe(([,e])=>{setTimeout(()=>{this.toggleDrawer(e),this.changeDetectorRef.markForCheck()})})}updateViewHeight(){const n=se.application!==mt.Viewer,o=ou(this.store.selectSnapshot(Et.getSiteHeader),n);this.viewDrawer.nativeElement.style.setProperty("--vh",`${o}px`)}updateStops(){const n=window.innerHeight,o=this.store.selectSnapshot(Et.getSiteHeader)===Rs.Hide?0:56;this.breakpoints.minimumDrawer.point=-64,this.breakpoints.halfDrawer.point=Math.floor(-.5*(n-o))}updateMode(n){this.mode=this.viewService.inferDrawerMode(n),this.changeDetectorRef.markForCheck()}resetDrawerPosition(n){setTimeout(()=>{this.slideDrawerToPoint(n?this.breakpoints.halfDrawer.point:this.breakpoints.minimumDrawer.point),this.open=n,this.changeDetectorRef.markForCheck()})}refresh(n){setTimeout(()=>{this.updateViewHeight(),this.updateStops(),this.resetDrawerPosition(n)})}handleToggleClick(){this.expandable&&this.toggleDrawer()}handleDrawerKeydown(n){("ArrowDown"===n.key||"ArrowUp"===n.key)&&n.stopPropagation()}handleLabelBack(){this.viewService.clearSelectedLabel()}toggleDrawer(n){null==n&&(n=!this.open),this.slideDrawerToPoint((n?this.breakpoints.halfDrawer:this.breakpoints.minimumDrawer).point),this.open=n}handleExitQuiz(){this.quizService.exitQuiz()}slideDrawerToPoint(n){this.viewDrawer&&(this.renderer.setStyle(this.viewDrawer.nativeElement,"transform",`translate3d(0, ${n}px, 0)`),this.offsetYChange.emit(n))}getDrawerY(){if(this.viewDrawer){const n=this.viewService.getComputedTransform(this.viewDrawer.nativeElement);return n?n.y:null}return null}}xn.\u0275fac=function(n){return new(n||xn)(i.Y36(i.Qsj),i.Y36(i.sBO),i.Y36(ut),i.Y36(Ns),i.Y36(l.yh),i.Y36(ri))},xn.\u0275cmp=i.Xpm({type:xn,selectors:[["app-view-drawer"]],viewQuery:function(n,e){if(1&n&&(i.Gf(xk,5),i.Gf(vk,5)),2&n){let o;i.iGM(o=i.CRH())&&(e.viewDrawer=o.first),i.iGM(o=i.CRH())&&(e.viewDrawerOuter=o.first)}},inputs:{expandable:"expandable"},outputs:{offsetYChange:"offsetYChange"},decls:9,vars:13,consts:[["data-test","viewPageDrawer",1,"view-drawer",3,"ngClass"],["viewDrawer",""],["class","view-drawer__scrim",4,"ngIf"],["role","region","aria-label","Chapter Description",1,"view-drawer__outer",3,"keydown"],["viewDrawerOuter",""],[1,"view-drawer__inner",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"view-drawer__scrim"],["size","large",3,"label"],[1,"view-drawer__header",2,"height","64px"],[1,"view-drawer__button","view-drawer__button--left"],["app-pin-button","","buttonType","outline",3,"click"],["icon","arrow-left"],[1,"view-drawer__title"],[1,"text-semibold","text-14",3,"markdownText"],[1,"view-drawer__button","view-drawer__button--right"],["app-pin-button","","buttonType","outline","data-test","drawerToggleButton",3,"click"],["icon","caret-up",4,"ngIf"],["icon","caret-down",4,"ngIf"],["class","mv-1","appEventFence","",4,"ngIf"],[1,"view-drawer__content"],[1,"text-14",3,"markdownText"],["icon","caret-up"],["icon","caret-down"],["appEventFence","",1,"mv-1"],[3,"contentBlocks","layout"],[4,"ngIf"],["appEventFence","",1,"view-drawer__button","view-drawer__button--right"],["type","button","app-pin-button","","buttonType","outline","data-test","drawerToggleButton",3,"click",4,"ngIf"],[3,"showHeader",4,"ngIf"],["alignTitle","center","size","medium",1,"view-drawer__title",3,"menuEnabled"],["appEventFence","",1,"view-drawer__button","view-drawer__button--left"],["app-pin-button","","buttonType","outline","type","button",3,"click",4,"ngIf"],[1,"flex","flex-column","text-center"],[1,"text-11","text-semibold","text-uppercase"],["class","text-14",4,"ngIf"],["app-pin-button","","buttonType","outline","type","button",3,"click"],["icon","times"],[1,"text-14"],[1,"text-semibold"],["type","button","app-pin-button","","buttonType","outline","data-test","drawerToggleButton",3,"click"],["layout","drawer",4,"ngIf"],["layout","drawer"],[3,"showHeader"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0,1),i.YNc(2,Ck,3,3,"div",2),i.ALo(3,"async"),i.TgZ(4,"div",3,4),i.NdJ("keydown",function(s){return e.handleDrawerKeydown(s)}),i.TgZ(6,"div",5),i.YNc(7,kk,17,13,"ng-container",6),i.YNc(8,Nk,13,13,"ng-container",6),i.qZA()()()),2&n){let o;i.Q6J("ngClass",i.l5B(8,Ek,!e.open,e.open,e.open,!e.expandable)),i.xp6(2),i.Q6J("ngIf",null==(o=i.lcZ(3,6,e.scrim$))?null:o.show),i.xp6(2),i.uIk("tabindex",e.open?0:-1),i.xp6(2),i.Q6J("ngSwitch",e.mode),i.xp6(1),i.Q6J("ngSwitchCase",e.viewMode.LabelInfo),i.xp6(1),i.Q6J("ngSwitchCase",e.viewMode.Content)}},dependencies:[f.mk,f.O5,f.RF,f.n9,In,Ea,lt,Da,ja,bl,zn,oo,vi,f.Ov],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-drawer{border-top:rgba(234,239,245,.8);box-shadow:0 -1px #1c2a3f29;background:rgba(255,255,255,.8);left:0;min-height:100vh;right:0;position:absolute;z-index:20;top:100vh;top:calc(var(--vh, 1vh) * 100);transform:translate3d(0,-56px,0);transition:transform .3s}.view-drawer--active,.view-drawer--closed{background-color:#fff}.view-drawer--scrollable{min-height:0}.view-drawer--scrollable .view-drawer__outer{height:50vh;height:calc(var(--vh, 1vh) * 50);overflow-y:scroll}.view-drawer--fixed{height:56px;overflow:hidden}.view-drawer--fixed .view-drawer__inner{height:56px;padding:0 16px}.view-drawer--fixed .view-drawer__content{justify-content:center;padding-top:0}.view-drawer__header{height:64px;display:flex;justify-content:center;align-items:center;position:relative}.view-drawer__title{display:flex;flex-grow:1;align-items:center;justify-content:center;height:64px;margin:0 64px;padding:0 8px}.view-drawer__button{height:40px;width:40px;display:flex;align-items:center;justify-content:center;position:absolute}.view-drawer__button--left{left:16px}.view-drawer__button--right{right:16px}.view-drawer__inner{position:relative}.view-drawer__outer{outline:none}.view-drawer__content{display:flex;flex:1 1 100%;flex-direction:column;max-width:600px;min-height:56px;margin:0 auto;padding:8px 16px 48px}.view-drawer__scrim{background-color:#fff;position:absolute;display:flex;justify-content:center;align-items:center;z-index:50;inset:0}\n"],encapsulation:2,changeDetection:0}),Ci([(0,l.Ph)(O.getUI),wi("design:type",b.y)],xn.prototype,"layout$",void 0),Ci([(0,l.Ph)(O.getScrim),wi("design:type",b.y)],xn.prototype,"scrim$",void 0),Ci([(0,l.Ph)(_.getSelectedChapterReadyState),wi("design:type",b.y)],xn.prototype,"selectedChapterReady$",void 0),Ci([(0,l.Ph)(_.getSelectedChapterIndex),wi("design:type",b.y)],xn.prototype,"chapterIndex$",void 0),Ci([(0,l.Ph)(_.getChapterCount),wi("design:type",b.y)],xn.prototype,"chapterCount$",void 0),Ci([(0,l.Ph)(te.getSelectedLabel),wi("design:type",b.y)],xn.prototype,"selectedLabel$",void 0),Ci([(0,l.Ph)(U.getQuizModeActive),wi("design:type",b.y)],xn.prototype,"quizModeActive$",void 0),Ci([(0,l.Ph)(U.getActiveQuestionIndex),wi("design:type",b.y)],xn.prototype,"activeQuestionIndex$",void 0),Ci([(0,l.Ph)(U.getQuestionTotal),wi("design:type",b.y)],xn.prototype,"questionTotal$",void 0),Ci([(0,l.Ph)(U.getQuestionsRemaining),wi("design:type",b.y)],xn.prototype,"questionRemaining$",void 0),Ci([(0,l.Ph)(U.getQuizSettings),wi("design:type",b.y)],xn.prototype,"quizSettings$",void 0),Ci([(0,l.Ph)(U.getQuizModeLocked),wi("design:type",b.y)],xn.prototype,"quizLocked$",void 0);var Br=(()=>(function(t){t.All="all",t.iOS="ios",t.Android="android"}(Br||(Br={})),Br))(),Qk=A(79);class Zk{constructor(n){this.players=n,this.index=0,this.playing=!1,this.eventSubject=new X.x,this.ngUnsubscribe=new X.x,this.init()}get currentPlayer(){return this.players[this.index]}play(){this.currentPlayer&&this.currentPlayer.play()}pause(){this.currentPlayer&&this.currentPlayer.pause()}stop(){this.currentPlayer&&this.currentPlayer.stop(),this.index=0}on(n,e){this.eventSubject.asObservable().pipe((0,$.h)(o=>o===n),(0,w.R)(this.ngUnsubscribe)).subscribe(e)}unload(){this.players.forEach(n=>n.unload()),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){const n=this.players.length;let e=0;this.players.forEach((o,s)=>{o.on("load",()=>{e++,e>=n&&this.eventSubject.next("load")}),o.on("play",()=>{this.playing||this.eventSubject.next("play"),this.playing=!0,this.index=s}),o.on("pause",()=>{this.playing=!1,this.eventSubject.next("pause")}),o.on("end",()=>{if(this.playing){const a=this.players[s+1];a?a.play():(this.playing=!1,this.index=0,this.eventSubject.next("end"))}}),o.on("stop",()=>{this.playing=!1,this.eventSubject.next("stop")}),o.on("loaderror",()=>{this.eventSubject.next("loaderror")}),o.on("playerror",()=>{this.eventSubject.next("playerror")})})}}const Vy="/media/audio",qk=new RegExp(`^${Vy}/(.*)/.*$`);let Dl=(()=>{class t{constructor(e){this.animationService=e,this.audioPlayers=new Map,this.audioEventSubject=new X.x}createAudioUploadEvent(e){return{type:"uploadFile",url:"/ws/media/audio/upload",method:"POST",file:e}}getAudioEvents(){return this.audioEventSubject.asObservable()}getAudioClips(e){return Object.values(e).filter(o=>"audio"===o.streamType)}createAudioClip(e,o,s){const r=this.getAudioUUID(o),{firstTime:a,lastTime:c}=this.animationService.getChapterTimeFrame();return[r,{clipId:r,streamType:"audio",fullUrl:o,time1:a,time2:c,lang:s}]}getAudioSrc(e){return e.match(Vy)?e:`/content/states/${e}`}getAudioPlayer(e){return this.audioPlayers.get(e)}addAudioPlayer(e,...o){this.removeAudioPlayer(e);const s=this.createAudioPlayer(o);return s.on("play",()=>{this.audioEventSubject.next({event:"play",id:e})}),s.on("pause",()=>{this.audioEventSubject.next({event:"pause",id:e})}),s.on("stop",()=>{this.audioEventSubject.next({event:"stop",id:e})}),s.on("end",()=>{this.audioEventSubject.next({event:"end",id:e})}),this.audioPlayers.set(e,s),s}removeAudioPlayer(e){const o=this.audioPlayers.get(e);o&&(o.unload(),this.audioPlayers.delete(e))}removeAllAudioPlayer(){this.audioPlayers.forEach((e,o)=>this.removeAudioPlayer(o))}stopAllAudio(){this.stopAudio()}stopAllOtherAudio(e){this.stopAudio(e)}createAudioPlayer(e){return e.length>1?this.createMultiPlayer(e):this.createSinglePlayer(e[0])}getAudioUUID(e){return e.match(qk)[1]}stopAudio(e){this.audioPlayers.forEach((o,s)=>{(!e||s!==e)&&o.stop()})}createSinglePlayer(e){return new Qk.Howl({src:e,format:["aac","m4a","mp3","ogg"]})}createMultiPlayer(e){const o=e.map(s=>this.createSinglePlayer(s));return new Zk(o)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Un))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var $k=A(8097),qy=A(3676);function Hu(t,n){return t.dispatch(new xc(!1)),n.fireEvent(pe.SceneXrayDisabled),!0}var un=A(5089);class Gk{constructor(n,e){this.store=n,this.particleSystemsService=e,this.ngUnsubscribe=new X.x,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const n=this.store.select(Fe.getParticleSystems),e=this.store.select(Fe.getVisisbleParticleSystems);(0,bt.a)([n,e]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([o])=>{const s=this.store.selectSnapshot(_.getSelectedChapterId),r=this.store.selectSnapshot(Fe.getVisibleParticleSystemsForChapter(s));this.particleSystemsService.setEngineParticles(o,s,r)})}}var jl=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ql=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};class ai{constructor(n,e,o){this.store=n,this.sceneService=e,this.paintService=o,this.currentLayers=[],this.nodesLayerIndex=0,this.objectsLayerIndex=0,this.nodeChapterOpacities={}}initObservables(){this.selectedChapterId$.pipe((0,$.h)(n=>!(0,m.isNil)(n))).subscribe(n=>{this.selectedChapterId=n,this.updateNodeChapterOpacities()}),this.selectedChapterCurrentLayers$.subscribe(n=>{this.currentLayers=n,this.nodesLayerIndex=this.objectsLayerIndex=this.store.selectSnapshot(_.getSelectedChapterCurrentLayersIndex)}),(0,bt.a)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$]).pipe((0,$.h)(([n,e])=>!(0,m.isNil)(n)&&!(0,m.isNil)(e))).subscribe(([n,e])=>{this.synchronizeScene(n,e,!0)})}recordLayerIndexPosition(n,e){this.store.dispatch(new vd(this.selectedChapterId,n,e,!0))}synchronizeScene(n,e,o){this.updateLayerIndex(n,this.currentLayers,o),this.updateLayerPosition(e,this.currentLayers,o)}fractionToIndex(n){const e=this.getThreshold(),o=Math.floor(n/e);return Math.min(this.currentLayers.length-2,o)}fractionToPosition(n,e){const o=this.getThreshold();return Math.max(0,Math.min((n-o*e)/o,1))}indexPositionToFraction(n,e){const o=this.getThreshold();return n*o+e*o}getThreshold(){return this.currentLayers.length>1?1/(this.currentLayers.length-1):1}getCurrentLayerIndexProp(n){return n?"nodesLayerIndex":"objectsLayerIndex"}updateLayerIndex(n,e,o){const s=this.getCurrentLayerIndexProp(o);n!==this[s]&&(this.restoreLayers(n,this[s],e,o),o&&(this.nodesLayerIndex=n),this.objectsLayerIndex=n)}updateLayerPosition(n,e,o){const s=this.getCurrentLayerIndexProp(o);this.setObjectsOpacity(e[this[s]].objectIds,1-n)}restoreLayers(n,e,o,s){const a=(n-e)/Math.abs(n-e);let c=[],p=e;for(;p!==n;)c=c.concat(o[p].objectIds),p+=a;const u=-1===a;this.setObjectsOpacity(c,1===a?0:1),s?this.setNodesShown(c,u):this.setObjectsShown(c,u),-1===a&&(s?this.setNodesShown(o[n].objectIds,!0):this.setObjectsShown(o[n].objectIds,!0))}setObjectsOpacity(n,e){n.forEach(o=>{const s=this.nodeChapterOpacities[o];let r;Array.isArray(s)?(r=s.slice(),r[0]=e*s[0],r[1]=e*s[1]):r=e*s,this.paintService.colorObject(o,{opacity:r})})}updateNodeChapterOpacities(){const e=this.store.selectSnapshot(Se.getAllNodeState)[this.selectedChapterId];this.nodeChapterOpacities={},Object.entries(e).forEach(([o,s])=>{if(this.nodeChapterOpacities[o]=1,s.paint&&Object.prototype.hasOwnProperty.call(s.paint,"opacity")){const r=Is(s.paint);!1!==r.opacity&&(this.nodeChapterOpacities[o]=r.opacity)}})}setObjectsShown(n,e){const o={};for(let s=0;s<n.length;s++)o[n[s]]=e;this.sceneService.setEnabledObjects({enabledByObject:o})}setNodesShown(n,e){this.store.dispatch(new rn(e,n,void 0,!1))}}ai.\u0275fac=function(n){return new(n||ai)(i.LFG(l.yh),i.LFG(Ut),i.LFG(wr))},ai.\u0275prov=i.Yz7({token:ai,factory:ai.\u0275fac,providedIn:"root"}),jl([(0,l.Ph)(_.getSelectedChapterCurrentLayers),Ql("design:type",b.y)],ai.prototype,"selectedChapterCurrentLayers$",void 0),jl([(0,l.Ph)(_.getSelectedChapterCurrentLayersIndex),Ql("design:type",b.y)],ai.prototype,"selectedChapterCurrentLayersIndex$",void 0),jl([(0,l.Ph)(_.getSelectedChapterCurrentLayersPosition),Ql("design:type",b.y)],ai.prototype,"selectedChapterCurrentLayersPosition$",void 0),jl([(0,l.Ph)(_.getSelectedChapterId),Ql("design:type",b.y)],ai.prototype,"selectedChapterId$",void 0);const Hk={"zh-CN":"cmn-CN",ja:"ja-JP","pt-PT":"pt-BR","es-ES":"es-MX"},Gy={voiceId:"Amy",localeId:"en-US",engine:"neural"},Yk=[Gy,{voiceId:"Mia",localeId:"es-MX",engine:"neural"},{voiceId:"Zhiyu",localeId:"cmn-CN",engine:"neural"},{voiceId:"Lea",localeId:"fr-FR",engine:"neural"},{voiceId:"Vicki",localeId:"de-DE",engine:"neural"},{voiceId:"Bianca",localeId:"it-IT",engine:"neural"},{voiceId:"Takumi",localeId:"ja-JP",engine:"neural"},{voiceId:"Camila",localeId:"pt-BR",engine:"neural"}];function Jy(t,n){return(t.length>3e3?Xn.splitTextByCharacterCount(t,3e3):[t]).map(s=>function Wk(t,n){const o=Hk[n]??n,r=Yk.find(d=>d.localeId===o)??Gy,{voiceId:a,engine:c}=r;return`/ws/polly/synthesize?text=${encodeURIComponent(t)}&voice_id=${a}&format=mp3&lang=${o}&engine=${c}&version=2`}(s,n))}const Hy={eng:"en",spa:"es",cmn:"zh",fra:"fr",deu:"de",ita:"it",jpn:"ja",por:"pt"},Xk=Object.keys(Hy);function eO(t,n){const e=t.franc(n,{minLength:0,only:Xk}),o=Hy[e];return ya.find(r=>r.lang===o)?.id}function Yy(t){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,Pn.Z)(function*(t){return A.e(811).then(A.bind(A,5811)).then(n=>eO(n,t))}),Yu.apply(this,arguments)}var qe=(()=>(function(t){t.DirectionalVelocity="DirectionalVelocity",t.Lifetime="Lifetime",t.PointPosition="PointPosition",t.RandomVelocity="RandomVelocity",t.SpherePosition="SpherePosition",t.CylinderPosition="CylinderPosition",t.CubePosition="CubePosition",t.RandomRotation="RandomRotation",t.RandomRotationSpeed="RandomRotationSpeed",t.RandomScale="RandomScale",t.SpriteAnimationDuration="SpriteAnimationDuration"}(qe||(qe={})),qe))(),st=(()=>(function(t){t.AgeColorBlend="AgeColorBlend",t.BrownianMotion="BrownianMotion",t.UniformForce="UniformForce",t.RadialForce="RadialForce",t.Friction="Friction",t.Gravity="Gravity",t.Path="Path",t.AxisForce="AxisForce",t.SpriteAnimation="SpriteAnimation"}(st||(st={})),st))(),Qt=(()=>(function(t){t.LifetimeKill="LifetimeKill",t.LifetimeStop="LifetimeStop",t.PathKill="PathKill",t.PathStop="PathStop",t.PathRadius="PathRadius",t.ShapeBounce="ShapeBounce",t.ShapeKill="ShapeKill",t.ShapeStop="ShapeStop"}(Qt||(Qt={})),Qt))(),Ja=(()=>(function(t){t.Sphere="Sphere",t.Plane="Plane",t.Cube="Cube",t.Cylinder="Cylinder"}(Ja||(Ja={})),Ja))(),Ha=(()=>(function(t){t.In="in",t.Out="out"}(Ha||(Ha={})),Ha))();const Wu={type:Ja.Cube,direction:Ha.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},tO=[Qt.ShapeBounce,Qt.ShapeKill,Qt.ShapeStop],Wy={[Qt.LifetimeKill]:{type:Qt.LifetimeKill},[Qt.LifetimeStop]:{type:Qt.LifetimeStop},[Qt.PathKill]:{type:Qt.PathKill},[Qt.PathStop]:{type:Qt.PathStop},[Qt.PathRadius]:{type:Qt.PathRadius},[Qt.ShapeBounce]:{type:Qt.ShapeBounce,trap:!1,shape:{...Wu}},[Qt.ShapeKill]:{type:Qt.ShapeKill,trap:!1,shape:{...Wu}},[Qt.ShapeStop]:{type:Qt.ShapeStop,trap:!1,shape:{...Wu}}},Zl={[qe.DirectionalVelocity]:{type:qe.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[qe.Lifetime]:{type:qe.Lifetime,average:2.5,variance:1},[qe.PointPosition]:{type:qe.PointPosition,position:[0,0,0]},[qe.RandomVelocity]:{type:qe.RandomVelocity,forceAverage:5,forceVariance:0},[qe.SpherePosition]:{type:qe.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[qe.CylinderPosition]:{type:qe.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[qe.CubePosition]:{type:qe.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[qe.RandomRotation]:{type:qe.RandomRotation,average:0,variance:0},[qe.RandomRotationSpeed]:{type:qe.RandomRotationSpeed,average:0,variance:180},[qe.RandomScale]:{type:qe.RandomScale,average:1,variance:0},[qe.SpriteAnimationDuration]:{type:qe.SpriteAnimationDuration,average:1,variance:0}},Ku={[st.AgeColorBlend]:{type:st.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[st.BrownianMotion]:{type:st.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[st.UniformForce]:{type:st.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[st.RadialForce]:{type:st.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[st.Friction]:{type:st.Friction,friction:.1},[st.Gravity]:{type:st.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[st.Path]:{type:st.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[st.AxisForce]:{type:st.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[st.SpriteAnimation]:{type:st.SpriteAnimation}},Ky={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},constraints:[Wy[Qt.LifetimeKill]],creators:[Zl[qe.PointPosition],Zl[qe.RandomVelocity],Zl[qe.Lifetime]],updaters:[Ku[st.AgeColorBlend],Ku[st.Friction]]};function Xy(){const t=JSON.parse(JSON.stringify(Ky)),{constraints:n,creators:e,updaters:o}=t;return{...t,constraints:n.map((s,r)=>({...s,id:$t.idWithPrefix("constraint")})),creators:e.map((s,r)=>({...s,id:$t.idWithPrefix("creator")})),updaters:o.map((s,r)=>({...s,id:$t.idWithPrefix("updater")}))}}function Xu(t){return{...Wy[t]}}function eg(t){return{...Zl[t]}}function tg(t){return{...Ku[t]}}function Bl(t){return(0,m.omitBy)(t,m.isNil)}function lO(t,n){return Bl(function rO(t,n){const{id:e,name:o,shape:s,trap:r}=n;return tO.includes(t)?{id:e,name:o,type:t,trap:r,shape:s}:{id:e,name:o,type:t}}(t,n))}function pO(t,n){return Bl(function aO(t,n){const{id:e,name:o,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:c,average:p,variance:d,position:u,scale:g,rotate:h,translate:y}=n;switch(t){case qe.DirectionalVelocity:return{id:e,name:o,type:t,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:c};case qe.Lifetime:return{id:e,name:o,type:t,average:p,variance:d};case qe.PointPosition:return{id:e,name:o,type:t,position:u};case qe.RandomVelocity:return{id:e,name:o,type:t,forceAverage:r,forceVariance:c};case qe.SpherePosition:case qe.CylinderPosition:case qe.CubePosition:return{id:e,name:o,type:t,scale:g,rotate:h,translate:y};case qe.RandomRotation:case qe.RandomRotationSpeed:case qe.RandomScale:case qe.SpriteAnimationDuration:return{id:e,name:o,type:t,average:p,variance:d};default:return}}(t,n))}function dO(t,n){return Bl(function cO(t,n){const{id:e,name:o,colors:s,position:r,direction:a,friction:c,frequency:p,forceAverage:d,radius:u,forceVariance:g,nodes:h,shape:y,directionAverage:k,directionVariance:B}=n;switch(t){case st.AgeColorBlend:return{id:e,name:o,type:t,colors:s,shape:y};case st.BrownianMotion:return{id:e,name:o,type:t,frequency:p,forceAverage:d,forceVariance:g,shape:y};case st.UniformForce:return{id:e,name:o,type:t,directionAverage:k,forceAverage:d,directionVariance:B,forceVariance:g,shape:y};case st.RadialForce:return{id:e,name:o,type:t,position:r,forceAverage:d,forceVariance:g,shape:y};case st.Friction:return{id:e,name:o,type:t,friction:c,shape:y};case st.Gravity:return{id:e,name:o,type:t,position:r,radius:u,forceAverage:d,forceVariance:g,shape:y};case st.Path:return{id:e,name:o,type:t,nodes:h,shape:y};case st.AxisForce:return{id:e,name:o,type:t,position:r,direction:a,forceAverage:d,forceVariance:g,shape:y};case st.SpriteAnimation:return{id:e,name:o,type:t};default:return}}(t,n))}let uO=(()=>{class t{constructor(e,o){this.engineService=e,this.store=o}createParticleSystem(e){const o={...Xy(),id:$t.idWithPrefix("system")};this.store.dispatch(new be.NewParticleSystem(o,e))}duplicateParticleSystem(e,o){this.store.dispatch(new be.DuplicateParticleSystem(e,o))}resetParticleSystem(e){const o={...Xy(),id:e};this.store.dispatch(new be.UpdateParticleSystem(e,o))}toggleParticleSystemVisible(e,o){const s=this.isParticleSystemVisible(e,o);this.store.dispatch(new be.SetParticleSystemVisible(e,!s,o))}isParticleSystemVisible(e,o){return this.store.selectSnapshot(Fe.getVisibleParticleSystemsForChapter(o)).includes(e)}addChapterParticleSystem(e,o){this.store.dispatch(new be.AssignParticle(e,o))}removeChapterParticleSystem(e,o){this.store.dispatch(new be.UnassignParticle(e,o))}removeAllChapterParticleSystem(e){this.store.selectSnapshot(Fe.particleSystemsForChapter(e)).forEach(s=>{this.removeChapterParticleSystem(s.id,e)})}createNewConstraint(e,o){const{id:s,constraints:r}=e;this.store.dispatch(new be.UpdateParticleSystem(s,{...e,constraints:[...r,{...Xu(o),id:$t.idWithPrefix("constraint")}]}))}duplicateConstraint(e,o){e.constraints=[...e.constraints,{...lO(o.type,o),id:$t.idWithPrefix("constraint")}],this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleConstraint(e.constraints.length-1))}resetConstraint(e,o){const s=e.constraints[o],{id:r,type:a}=s;e.constraints[o]={...Xu(a),id:r},this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}resetConstraints(e){e.constraints=e.constraints.map(o=>{const{id:s,type:r}=o;return{...Xu(r),id:s}}),this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}removeConstraint(e,o){e.constraints.splice(o,1),this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleConstraint(-1))}createNewCreator(e,o){const{id:s,creators:r}=e;this.store.dispatch(new be.UpdateParticleSystem(s,{...e,creators:[...r,{...eg(o),id:$t.idWithPrefix("creator")}]}))}duplicateCreator(e,o){e.creators=[...e.creators,{...pO(o.type,o),id:$t.idWithPrefix("creator")}],this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleCreator(e.creators.length-1))}resetCreator(e,o){const s=e.creators[o],{id:r,type:a}=s;e.creators[o]={...eg(a),id:r},this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}resetCreators(e){e.creators=e.creators.map(o=>{const{id:s,type:r}=o;return{...eg(r),id:s}}),this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}removeCreator(e,o){e.creators.splice(o,1),this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleConstraint(-1))}createNewUpdater(e,o){const{id:s,updaters:r}=e;this.store.dispatch(new be.UpdateParticleSystem(s,{...e,updaters:[...r,{...tg(o),id:$t.idWithPrefix("updater")}]}))}duplicateUpdater(e,o){e.updaters=[...e.updaters,{...dO(o.type,o),id:$t.idWithPrefix("updater")}],this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleUpdater(e.updaters.length-1))}resetUpdater(e,o){const s=e.updaters[o],{id:r,type:a}=s;e.updaters[o]={...tg(a),id:r},this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}resetUpdaters(e){e.updaters=e.updaters.map(o=>{const{id:s,type:r}=o;return{...tg(r),id:s}}),this.store.dispatch(new be.UpdateParticleSystem(e.id,e))}removeUpdater(e,o){e.updaters.splice(o,1),this.store.dispatch(new be.UpdateParticleSystem(e.id,e)),this.store.dispatch(new be.SelectParticleConstraint(-1))}setEngineParticles(e,o,s){const r=this.engineService.engine?.story,a=r?.chapters?.find(c=>c.id===o);(0,m.isNil)(a)||(r.particleSystemDefs.forEach((c,p)=>{(0,m.isNil)(e[p])&&r.particleSystemDefs.delete(p)}),Object.entries(e).forEach(([c,p])=>{const d=r.particleSystemDefs.get(c);((0,m.isNil)(d)||!(0,m.isEqual)(d,p))&&r.particleSystemDefs.set(c,p)}),a.particleSystemIds.forEach(c=>{s.includes(c)||a.particleSystemIds.delete(c)}),s.forEach(c=>{a.particleSystemIds.has(c)||a.particleSystemIds.add(c)}))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function gO(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",9),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.playAudio())}),i._UZ(1,"app-icon",10),i.qZA()}}function hO(t,n){if(1&t&&(i.TgZ(0,"div",11),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Oqu(e.latinLabel)}}function mO(t,n){if(1&t&&(i._UZ(0,"div",12),i.ALo(1,"markdown")),2&t){const e=i.oxw();i.Q6J("innerHTML",i.lcZ(1,1,e.description),i.oJD)}}let fO=(()=>{class t{constructor(e,o,s){this.dialogRef=e,this.mediaService=o,this.data=s,this.title=s.title,this.audioPlayer=s.audioPlayer,this.latinLabel=s.latinLabel,this.description=s.description}ngOnDestroy(){this.audioPlayer&&(this.audioPlayer=null)}handleCloseClick(){this.dialogRef.close()}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.so),i.Y36(Dl),i.Y36(He.WI))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-context-label-dialog"]],decls:10,vars:7,consts:[[1,"context-label-dialog","flex","flex-column"],[1,"flex","flex-row","justify-between","items-start"],[1,"flex","flex-row","items-start"],[1,"context-label-dialog__title","mt-2","mr-2",3,"innerHTML"],["class","context-label-dialog__audio","type","button","app-button","","buttonTheme","light","buttonSize","medium",3,"click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"context-label-dialog__close",3,"click"],["icon","times","size","lg"],["class","context-label-dialog__latin-label mt-1",4,"ngIf"],["class","context-label-dialog__description mt-6",3,"innerHTML",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","medium",1,"context-label-dialog__audio",3,"click"],["icon","volume-up"],[1,"context-label-dialog__latin-label","mt-1"],[1,"context-label-dialog__description","mt-6",3,"innerHTML"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div",2),i._UZ(3,"div",3),i.ALo(4,"markdown"),i.YNc(5,gO,2,0,"button",4),i.qZA(),i.TgZ(6,"button",5),i.NdJ("click",function(){return o.handleCloseClick()}),i._UZ(7,"app-icon",6),i.qZA()(),i.YNc(8,hO,2,1,"div",7),i.YNc(9,mO,2,3,"div",8),i.qZA()),2&e&&(i.xp6(3),i.Q6J("innerHTML",i.lcZ(4,5,o.title),i.oJD),i.xp6(2),i.Q6J("ngIf",o.audioPlayer),i.xp6(1),i.uIk("aria-label","Close"),i.xp6(2),i.Q6J("ngIf",o.latinLabel),i.xp6(1),i.Q6J("ngIf",o.description))},dependencies:[f.O5,Dn,lt,En.NO],styles:[".context-label-dialog{height:100%}.context-label-dialog__title{font-weight:700;font-size:20px;word-break:break-word}.context-label-dialog__latin-label{font-style:italic;font-weight:400;font-size:14px;letter-spacing:.02em}.context-label-dialog__description{font-size:14px;line-height:20px;overflow:auto;margin-right:-24px;padding-right:24px}.context-label-dialog__description p{padding-bottom:12px}\n"],encapsulation:2}),t})(),e_=(()=>{class t{constructor(e,o,s,r,a){this.store=e,this.graphService=o,this.cameraService=s,this.sceneService=r,this.liveAnnouncer=a}fadeInverse(e){const o=this.store.selectSnapshot(M.getViewGraph),s=this.graphService.getInverseSelection(o,[e.id]),r=this.graphService.getNodes(o,s);this.store.dispatch(new Xo(es,r.map(a=>a.id))).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}fade(e){this.store.dispatch(new Xo(es,[e.id])).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}hideInverse(e){const o=this.store.selectSnapshot(M.getViewGraph),s=this.graphService.getAllLeafDescendants(o,[e.id]),r=this.graphService.getInverseSelection(o,[e.id]),a={};s.forEach(y=>{a[y]=!0}),r.forEach(y=>{a[y]=!1});const c=new rn(void 0,void 0,a),p=sf(this.store.selectSnapshot(Se),c,this.sceneService);this.store.dispatch(new Ts(p.patches));const d=this.sceneService.getObjectBoundary(e.id),u=this.cameraService.getCameraAfterFlyTo(d),g=new Ac(u),h=function bO(t,n){const[e,o,s]=H.aS(t,r=>{r.cameraFlyTo=n.camera});return{nextState:e,patches:o,inversePatches:s}}(this.store.selectSnapshot(Ne),g);this.store.dispatch(new Lc(h.patches)).subscribe(()=>{this.liveAnnouncer.announce("Isolate complete")}),this.store.dispatch(new Ms),this.store.dispatch(new Rt(!1)),this.store.dispatch(new Nt.SavePatches([{forward:p.patches,inverse:p.inversePatches,patchAction:Ts},{forward:h.patches,inverse:h.inversePatches,patchAction:Lc}]))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(Oi),i.LFG(Bn),i.LFG(Ut),i.LFG(no.Kd))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var t_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},n_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const yO=["labelContainerEl"],_O=["labelEl"],xO=["wire"],vO=["tag"],CO=["pin"],wO=["title"];function SO(t,n){1&t&&(i.TgZ(0,"div",18),i._UZ(1,"app-icon",19),i.qZA())}const PO=function(t){return{"label__body--collapse":t}};function kO(t,n){if(1&t&&(i.TgZ(0,"div",20),i.Hsn(1,3),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngClass",i.VKq(1,PO,e.isCollapsed||e.descriptionCollapsed))}}const OO=[[["","label-header",""]],[["","label-actions",""]],[["","label-more",""]],[["","label-body",""]]],TO=function(t,n,e,o,s,r,a,c,p){return{"label--selected":t,"label--glow":n,"label--annotation":e,"label--invert":o,"label--studio":s,"label--context":r,"label--screenshot-mode":a,"label--auto-fit":c,"label--opaque":p}},MO=function(t){return{"label__wire--collapse":t}},IO=function(t,n,e,o){return{"label__tag--collapse":t,"label__tag--collapsible":n,"label__tag--floating":e,"label__tag--draggable":o}};class Ro{constructor(n,e,o,s,r,a,c,p,d){this.renderer=n,this.labelsService=e,this.engineService=o,this.cameraService=s,this.engineRendererService=r,this.store=a,this.actions=c,this.changeDetection=p,this.markerService=d,this.labelPinType=St,this.labelSequentialType=ii,this.labelUpdated=new i.vpe,this.offsetUpdated=new i.vpe,this.pinClicked=new i.vpe,this.tagClicked=new i.vpe,this.displayUpdated=new i.vpe,this.positionUpdated=new i.vpe,this.hoverStart=new i.vpe,this.hoverEnd=new i.vpe,this.labelOffsetUpdated=new i.vpe,this.fit="fixed",this.opaque=!1,this.fixedScale=0,this.isCollapsed=!1,this.tagCollapsed=!1,this.theme="classic",this.pinDraggable=!0,this.tagDraggable=!0,this._selected=!1,this.enginePosition=null,this.isBackgroundDark=!1,this.pinDragging=!1,this.screenshotMode=!1,this.hammerManagers=[],this.displayUpdated$=new X.x,this.positionUpdated$=new X.x,this.ngUnsubscribe=new X.x}get label(){return this._label}set label(n){const e=(0,m.isEmpty)(n),o=(0,m.isEmpty)(this.label);e&&!o?(this._label=null,this.destroyLabel()):e||(this._label={...n},this.initLabel(this.label))}set selected(n){n&&this.tagRef.nativeElement.focus(),this._selected=n}get selected(){return this._selected}ngOnInit(){this.initListeners()}ngAfterViewInit(){this.bindTagEvents(),this.bindPinEvents(),this.bindHoverEvents()}ngOnDestroy(){this.destroyLabel(),this.emitDisplayUpdated({id:this.label.id,inView:!1,shown:!1,objectShown:this.objectShown}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}destroyLabel(){this.hammerManagers.forEach(n=>n.destroy()),this.hammerManagers=[],this.deleteMarker(this.marker)}initListeners(){this.enginePosition$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.enginePosition=n}),this.engineService.getEvent(pe.SceneMarkersUpdated).pipe((0,$.h)(()=>!(0,m.isNil)(this.label)&&!(0,m.isNil)(this.enginePosition)),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.setCanvasPos()}),this.displayUpdated$.pipe((0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.displayUpdated.next(n)}),this.positionUpdated$.pipe((0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.positionUpdated.next(n)}),this.background$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=n.colors.slice(0,3),o=n.colors.slice(4,7);this.isBackgroundDark=!wo.isLight(e,o),this.changeDetection.markForCheck()}),this.actions.pipe((0,l.xt)(xr),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!0,this.changeDetection.detectChanges()}),this.actions.pipe((0,l.cx)(vr),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!1,this.changeDetection.markForCheck()})}bindTagEvents(){const n=new un.Manager(this.tagRef.nativeElement,{domEvents:!0});n.add(new un.Pan({direction:un.DIRECTION_ALL,threshold:3})),n.add(new un.Tap({event:"tap"})),n.on("pan",e=>{if(!this.tagDraggable)return;e.srcEvent.stopPropagation(),this.cachedTagOffset||(this.cachedTagOffset=this.label.offset);const o=[this.cachedTagOffset[0]+e.deltaX,this.cachedTagOffset[1]+e.deltaY];this.label.offset=o,e.isFinal&&(this.cachedTagOffset=null,this.offsetUpdated.next({labelId:this.label.id,offset:o}))}),n.on("tap",e=>{e.srcEvent.preventDefault(),e.srcEvent.stopPropagation(),this.tagClicked.next(e)}),this.hammerManagers.push(n)}bindPinEvents(){const n=new un.Manager(this.pinRef.nativeElement);n.add(new un.Pan({direction:un.DIRECTION_ALL,threshold:4})),n.add(new un.Tap({event:"tap"})),n.on("pan",e=>{if(!this.pinDraggable)return;e.srcEvent.stopPropagation(),this.pinDragging=!0;let{layerX:o,layerY:s}=e.changedPointers[0];if(o-=16,s-=16,this.marker&&this.deleteMarker(this.marker),this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${o}px, ${s}px)`),e.isFinal){this.pinDragging=!1;const r={...this.label},a=this.engineRendererService.pick(o,s),c="string"==typeof a.objectId;c&&(r.dir=this.cameraService.getDirection(a),r.objectId=a.objectId,r.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],r.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],r.primitiveIndex=a.triIndex),this.labelUpdated.next({label:r,shouldPreserve:c})}}),n.on("tap",e=>{e.srcEvent.preventDefault(),e.srcEvent.stopImmediatePropagation(),this.pinClicked.next(e)}),this.hammerManagers.push(n)}bindHoverEvents(){const n=this.labelRef.nativeElement;this.renderer.listen(n,"mouseenter",()=>{this.hoverStart.next({labelId:this.label.id})}),this.renderer.listen(n,"mouseleave",()=>{this.hoverEnd.next({labelId:this.label.id})})}initLabel(n){this.initMarker(n),this.ensureObjectId(n),this.initObjectSubscription(n)}initMarker(n){this.marker&&this.deleteMarker(this.marker),this.marker=this.markerService.createMarker(n)}checkLabelDisplay(){return{id:this.label.id,shown:this.label.shown,inView:this.isOnCanvas(),objectShown:!0}}ensureObjectId(n){if(!n.objectId&&this.marker){const[e,o]=this.marker.canvasPosition,s=this.engineRendererService.pick(e,o);s.objectId&&(n.objectId=s.objectId,n.states.forEach(r=>{r.errands.forEach(a=>{a.type===Fn.flyToObject&&(a.value=s.objectId)})}),this.labelUpdated.next({label:n,shouldPreserve:void 0}))}}initObjectSubscription(n){this.object$&&this.object$.unsubscribe(),n.objectId&&(this.object$=this.store.select(M.getViewGraphNode).pipe((0,J.U)(e=>e(n.objectId)),(0,$.h)(e=>!!e),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.objectShown=e.boolState.shown}))}deleteMarker(n){this.markerService.deleteMarker(n?.id),this.marker=null}setCanvasPos(){if(this.pinDragging||!this.marker)return void((0,m.isNil)(this.marker)&&this.setDisplay(!1));const n=this.isOccluded(),e=this.isOcclusionIgnored(),o=this.isOnCanvas(),s=n&&!e,r=void 0===this.objectShown?o&&!s:o&&this.objectShown&&!s;r!==this.shown&&(this.shown=r,this.setDisplay(r)),this.setElementPosition(),this.setElementScale(),this.setTagPosition(),this.setWirePosition();const[c,p]=this.marker.canvasPosition;this.positionUpdated$.next({positionUpdate:{id:this.label.id,canvasPos:{x:c,y:p},occluded:s},onCanvas:o})}isOcclusionIgnored(){return this.selected||!this.label.occludable}isOccluded(){return this.marker?.occluded}isOnCanvas(){if(!this.marker)return!1;const{offsetWidth:n,offsetHeight:e}=this.labelsService.getLabelContainer().nativeElement,[o,s]=this.marker.canvasPosition;return o>0&&s>0&&o<n&&s<e}setDisplay(n){this.renderer.setStyle(this.labelRef.nativeElement,"visibility",n?"visible":"hidden"),this.emitDisplayUpdated({id:this.label.id,inView:this.isOnCanvas(),shown:n,objectShown:this.objectShown})}setElementPosition(){const[n,e]=this.marker?.canvasPosition??[0,0];this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${n}px, ${e}px)`)}setElementScale(){let n;if(this.fixedScale)n=this.fixedScale;else{const o=this.store.selectSnapshot(M.getEnginePosition).width;n=o>1440?o/1440:1}const e=32*n-32;this.renderer.setStyle(this.labelRef.nativeElement,"transform-origin","top left"),this.renderer.setStyle(this.labelRef.nativeElement,"transform",`translate(-${e/2}px, -${e/2}px) scale(${n}, ${n})`)}setTagPosition(){const[n,e]=this.label.offset,o=this.tagRef.nativeElement.offsetWidth;let s;switch(s=this.label.pinType===St.None&&this.label.hideWire||n>0?"left":"right",s){case"left":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+n}px, ${e}px)`);break;case"right":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+n-o}px, ${e}px)`)}}setWirePosition(){let[n,e]=this.label.offset;switch(this.label.theme){case qt.Annotation:case qt.Classic:e+=this.titleRef.nativeElement.offsetHeight-16-2}const o=Math.sqrt(n*n+e*e);this.renderer.setStyle(this.wireRef.nativeElement,"width",`${o}px`),this.renderer.setStyle(this.wireRef.nativeElement,"transform",`rotate(${Math.atan2(e,n)}rad)`)}emitDisplayUpdated(n){this.label.id!==il&&(null==n.inView||null==n.shown||this.displayUpdated$.next(n))}}Ro.\u0275fac=function(n){return new(n||Ro)(i.Y36(i.Qsj),i.Y36(Os),i.Y36(et),i.Y36(Bn),i.Y36(Po),i.Y36(l.yh),i.Y36(l.eX),i.Y36(i.sBO),i.Y36(ol))},Ro.\u0275cmp=i.Xpm({type:Ro,selectors:[["app-generic-label"]],viewQuery:function(n,e){if(1&n&&(i.Gf(yO,7),i.Gf(_O,7),i.Gf(xO,7),i.Gf(vO,7),i.Gf(CO,7),i.Gf(wO,7)),2&n){let o;i.iGM(o=i.CRH())&&(e.labelContainerRef=o.first),i.iGM(o=i.CRH())&&(e.labelRef=o.first),i.iGM(o=i.CRH())&&(e.wireRef=o.first),i.iGM(o=i.CRH())&&(e.tagRef=o.first),i.iGM(o=i.CRH())&&(e.pinRef=o.first),i.iGM(o=i.CRH())&&(e.titleRef=o.first)}},hostVars:2,hostBindings:function(n,e){2&n&&i.ekj("selected",e.selected)},inputs:{fit:"fit",opaque:"opaque",fixedScale:"fixedScale",sequence:"sequence",hasContent:"hasContent",label:"label",isCollapsed:"isCollapsed",descriptionCollapsed:"descriptionCollapsed",tagCollapsed:"tagCollapsed",selected:"selected",theme:"theme",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},outputs:{labelUpdated:"labelUpdated",offsetUpdated:"offsetUpdated",pinClicked:"pinClicked",tagClicked:"tagClicked",displayUpdated:"displayUpdated",positionUpdated:"positionUpdated",hoverStart:"hoverStart",hoverEnd:"hoverEnd",labelOffsetUpdated:"labelOffsetUpdated"},ngContentSelectors:["[label-header]","[label-actions]","[label-more]","[label-body]"],decls:21,vars:26,consts:[["data-test","labelContainer",1,"label-container"],["labelContainerEl",""],["data-test","labelElement",1,"label",3,"ngClass"],["labelEl",""],[1,"label__pin"],["pin",""],[3,"label","labelTheme","selected","sequence"],[1,"label__glow"],[1,"label__wire",3,"ngClass"],["wire",""],["tabindex","0",1,"label__tag",3,"ngClass"],["tag",""],[1,"label__header"],["data-test","labelTitle",1,"label__title"],["title",""],["class","label__more",4,"ngIf"],["appEventFence","",1,"label__actions"],["class","label__body",3,"ngClass",4,"ngIf"],[1,"label__more"],["icon","caret-right"],[1,"label__body",3,"ngClass"]],template:function(n,e){1&n&&(i.F$t(OO),i.TgZ(0,"div",0,1)(2,"div",2,3)(4,"div",4,5),i._UZ(6,"app-label-pin",6)(7,"div",7),i.qZA(),i._UZ(8,"div",8,9),i.TgZ(10,"div",10,11)(12,"div",12)(13,"div",13,14),i.Hsn(15),i.qZA(),i.YNc(16,SO,2,0,"div",15),i.TgZ(17,"div",16),i.Hsn(18,1),i.qZA()(),i.YNc(19,kO,2,3,"div",17),i.Hsn(20,2),i.qZA()()()),2&n&&(i.xp6(2),i.Q6J("ngClass",i.rFY(9,TO,[e.selected,e.label.pinGlow,"annotation"===e.label.theme||"classic"===e.label.theme,e.isBackgroundDark,"studioNext"===e.label.theme,"context"===e.label.theme,e.screenshotMode,"auto"===e.fit,e.opaque])),i.xp6(4),i.Q6J("label",e.label)("labelTheme",e.label.theme)("selected",e.selected)("sequence",e.sequence),i.xp6(2),i.Q6J("ngClass",i.VKq(19,MO,e.isCollapsed||e.tagCollapsed||e.label.hideWire)),i.xp6(2),i.Q6J("ngClass",i.l5B(21,IO,e.isCollapsed||e.tagCollapsed,e.label.collapseDescription,e.label.hideWire,e.tagDraggable)),i.xp6(6),i.Q6J("ngIf",e.hasContent&&e.label.collapseDescription),i.xp6(3),i.Q6J("ngIf",e.hasContent))},dependencies:[f.mk,f.O5,Ea,lt,jy],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}@keyframes fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{opacity:1;display:block}}@keyframes fadeOut{0%{display:block;opacity:1}99%{opacity:0}to{opacity:0;display:none}}@keyframes glow{0%{box-shadow:0 0 #ffffff80}50%{box-shadow:0 0 8px 2px #ffffff80}to{box-shadow:0 0 #ffffff80}}@keyframes classic-glow{0%{transform:scale(.5)}10%{transform:scale(.5)}50%{transform:scale(1)}90%{transform:scale(.5)}to{transform:scale(.5)}}[_nghost-%COMP%], .label-container[_ngcontent-%COMP%]{display:block;position:absolute;z-index:10;width:160px;pointer-events:all;pointer-events:none}[_nghost-%COMP%]:hover, .label-container[_ngcontent-%COMP%]:hover{z-index:12}.selected[_nghost-%COMP%]{z-index:11}.label-container[_ngcontent-%COMP%]{left:-16px;top:-16px}.label[_ngcontent-%COMP%]{display:block;overflow:visible;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;height:32px}.label--screenshot-mode[_ngcontent-%COMP%]{text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:before, .label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:after{box-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{box-shadow:none!important;text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:none!important}.label--auto-fit[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:max-content;padding:0!important}.label--auto-fit[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding:0!important}.label__glow[_ngcontent-%COMP%]{display:none;position:absolute;width:32px;height:32px;border-radius:50%;z-index:0;top:0;left:0}.label--selected[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{transform:rotate(45deg)}.label__more[_ngcontent-%COMP%]{color:#374a68;display:none;flex:0 0 16px;height:16px;align-items:center;justify-content:center;transition:transform .15s ease-in-out}.label__pin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;position:absolute;pointer-events:all;transition:background-color .12s;z-index:10}.label__pin[_ngcontent-%COMP%]:hover{cursor:pointer}.label__pin--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__pin--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__wire[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;height:0;transform-origin:0 100%;pointer-events:none;z-index:1}.label__wire--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]{display:inline-block;left:16px;top:0;z-index:10;max-width:160px;pointer-events:all}.label__tag[_ngcontent-%COMP%]:hover{cursor:pointer}.label__tag--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__tag--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__tag--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important;border-radius:4px}.label__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label__title[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em;letter-spacing:0;line-height:140%;align-self:center}.label__body[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em;letter-spacing:0}.label__body--collapse[_ngcontent-%COMP%]{display:none}.label__icon[_ngcontent-%COMP%]{margin:0 -4px 0 4px}.label__actions[_ngcontent-%COMP%]{padding-left:4px}.label--studio.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:classic-glow 4s infinite}.label--studio.label--opaque[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#ffffffd9!important}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#2d72dc}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600}.label--studio.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid rgba(16,24,35,.5)}.label--studio.label[_ngcontent-%COMP%]   .label__wire--collapse[_ngcontent-%COMP%]{display:none}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background:rgba(255,255,255,.55);border:1px solid rgba(16,24,35,.5);box-shadow:0 0 24px #1018231a;padding:4px 8px;border-radius:4px}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.8)}.label--studio.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#101823;flex:1 1 auto}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#374a68;overflow-x:hidden;padding-top:4px}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.label--studio.label[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex}.label--studio.label.label--invert[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#ffffff80}.label--annotation.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff40;display:block;animation:classic-glow 4s infinite;top:-1px;left:-1px}.label--annotation.label--none[_ngcontent-%COMP%]{display:none}.label--annotation.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:10px;color:#eee}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--floating[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:none}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:focus{outline-offset:4px}.label--annotation.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;min-height:18px;width:100%;padding-bottom:4px;margin-bottom:-2px;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding-top:4px;color:#333}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#eee}.label--context.label[_ngcontent-%COMP%]{pointer-events:none}.label--context.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:classic-glow 4s infinite}.label--context.label[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%], .label--context.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{display:none}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;background:rgba(255,255,255,.7);border:1px solid rgba(16,24,35,.5);box-shadow:0 0 24px #1018231a;padding:0;border-radius:4px;width:200px;max-width:none;min-height:75px;opacity:1;transition:width .25s,opacity .1s}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.8);cursor:grab}.label--context.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{padding:4px 8px 0}.label--context.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;color:#101823}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid #eaeff5;color:#101823;overflow-x:hidden;padding-top:8px}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.context-label--large[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:300px}@media (min-width: 960px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:400px}}@media (max-width: 959px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{opacity:0}}"],changeDetection:0}),t_([(0,l.Ph)(M.getEnginePosition),n_("design:type",b.y)],Ro.prototype,"enginePosition$",void 0),t_([(0,l.Ph)(_.getSelectedChapterBackground),n_("design:type",b.y)],Ro.prototype,"background$",void 0);var ng=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ig=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const AO=["labelDescription"];function LO(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",13),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.playAudio())}),i._UZ(1,"app-icon",14),i.qZA()}}function FO(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",13),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleReadMoreClick())}),i._UZ(1,"app-icon",15),i.qZA()}if(2&t){const e=i.oxw(2);i.xp6(1),i.ekj("context-label__info--expanded",e.expanded)}}function UO(t,n){if(1&t&&(i.TgZ(0,"div",11),i.YNc(1,LO,2,0,"button",12),i.YNc(2,FO,2,2,"button",12),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.audioPlayer),i.xp6(1),i.Q6J("ngIf",e.enableInfo&&(null==e.node||null==e.node.info?null:e.node.info.description))}}function RO(t,n){if(1&t&&(i.TgZ(0,"i",16),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.node.info.latinLabel," ")}}function NO(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",17,18),i.NdJ("pointerdown",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleDescriptionPointerDown(s))})("wheel",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.stopPropagation(s))}),i.ALo(2,"markdown"),i.qZA()}if(2&t){const e=i.oxw();i.ekj("context-label__description--expanded",e.expanded),i.Q6J("innerHTML",i.lcZ(2,3,e.node.info.description),i.oJD)}}function EO(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",19)(1,"button",20),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.hideNode())}),i._uU(2," Hide "),i.qZA(),i.TgZ(3,"button",21),i._uU(4," Fade "),i._UZ(5,"app-icon",22),i.qZA(),i.TgZ(6,"button",20),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.hideInverseNodes())}),i._uU(7," Isolate "),i.qZA()()}if(2&t){i.oxw();const e=i.MAs(11);i.xp6(1),i.Q6J("bordered",!1),i.xp6(2),i.Q6J("matMenuTriggerFor",e)("bordered",!1),i.xp6(3),i.Q6J("bordered",!1)}}class as{constructor(n,e,o,s,r,a,c,p,d,u,g){this.store=n,this.actions=e,this.sceneService=o,this.viewService=s,this.dialog=r,this.engineService=a,this.nodeService=c,this.mediaService=p,this.renderer2=d,this.markdownService=u,this.changeDetectorRef=g,this.largeTitle=!1,this.expanded=!1,this.ngUnsubscribe=new X.x,this.id=$t.getUuid()}set label(n){this._label=n,this.largeTitle=this._label.title.length>60,this.createAudioPlayer(),this.setLabelNode()}get label(){return this._label}ngOnInit(){this.initInfoListeners(),this.initBreakpointListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.removeAudioPlayer()}setLabelNode(){const n=(0,m.get)(this.label,"objectId");if(n){const e=this.store.selectSnapshot(M.getViewGraph);this.node=this.sceneService.getViewNode(e,n)}else this.node=null;this.expanded=!1,this.changeDetectorRef.markForCheck()}initInfoListeners(){this.actions.pipe((0,l.cx)(xa),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.setLabelNode()})}initBreakpointListeners(){this.breakpoint$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{!this.expanded||(n<_t.Large&&!this.curDialog?this.openContextLabelDialog():n>=_t.Large&&this.curDialog&&this.curDialog?.close(!0))})}handleReadMoreClick(){this.node&&(this.expanded=!this.expanded,this.expanded&&this.store.selectSnapshot(Pt.getBreakpoint)<_t.Large&&this.openContextLabelDialog())}stopPropagation(n){n.stopPropagation()}handleDescriptionPointerDown(n){const e=this.labelDescription.nativeElement,o=e.offsetWidth-e.clientWidth;if(o>0){const r=e.getBoundingClientRect().right-o;n.clientX>r&&this.stopPropagation(n)}}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}createAudioPlayer(){var n=this;return(0,Pn.Z)(function*(){if(n.mediaService.removeAudioPlayer(n.id),n.localeCode||(n.localeCode=yield n.getLocaleCode()),"es-ES"===n.localeCode||"en-US"===n.localeCode){const o=Jy(Xn.getPlainTextFromMarkdown(n.renderer2,n.markdownService,n._label.title,!0),n.localeCode);n.audioPlayer=n.mediaService.addAudioPlayer(n.id,...o),n.changeDetectorRef.markForCheck()}})()}getLocaleCode(){var n=this;return(0,Pn.Z)(function*(){const e=n.store.selectSnapshot(we.getStoryInfo);let o=ui.id;if(e.type===Xe.Bookmark){let r=n.store.selectSnapshot(we.getStory).chapters.map(a=>a.description||"").join(" ").trim();if(!r){const a=n.store.selectSnapshot(M.getViewGraph);r=Object.values(a.nodes).map(p=>p.label).join(", ").trim()}return Yy(r)}return o=Rh(n.store.selectSnapshot(we.getStoryLanguage)).id,o})()}removeAudioPlayer(){this.mediaService.removeAudioPlayer(this.id)}hideNode(){this.store.dispatch(new rn(!1,[this.node.id]))}fadeInverseNodes(){this.nodeService.fadeInverse(this.node)}fadeNode(){this.nodeService.fade(this.node)}hideInverseNodes(){this.nodeService.hideInverse(this.node)}openContextLabelDialog(){this.curDialog=this.dialog.open(fO,{width:"calc(100% - 80px)",maxWidth:"100%",height:"calc(100% - 80px)",maxHeight:"100%",data:{title:this.label.title,audioPlayer:this.audioPlayer,latinLabel:this.node.info.latinLabel,description:this.node.info.description}}),this.curDialog.afterClosed().subscribe(n=>{this.curDialog=void 0,n||(this.expanded=!1,this.changeDetectorRef.markForCheck())})}}as.\u0275fac=function(n){return new(n||as)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(Ut),i.Y36(ut),i.Y36(He.uw),i.Y36(et),i.Y36(e_),i.Y36(Dl),i.Y36(i.Qsj),i.Y36(En.Zy),i.Y36(i.sBO))},as.\u0275cmp=i.Xpm({type:as,selectors:[["app-context-label"]],viewQuery:function(n,e){if(1&n&&i.Gf(AO,5),2&n){let o;i.iGM(o=i.CRH())&&(e.labelDescription=o.first)}},inputs:{label:"label",enableInfo:"enableInfo",enableActions:"enableActions"},decls:16,vars:15,consts:[[1,"context-label",3,"fixedScale","label"],["label-header","",1,"context-label__header","html",3,"innerHTML"],["title",""],["class","context-label__actions","label-actions","",4,"ngIf"],["label-more",""],["class","context-label__latin",4,"ngIf"],["class","context-label__description",3,"context-label__description--expanded","innerHTML","pointerdown","wheel",4,"ngIf"],["class","context-label__node-actions",4,"ngIf"],["fadeActions","matMenu"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["label-actions","",1,"context-label__actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xsmall",3,"click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xsmall",3,"click"],["icon","volume-up"],["icon","info-circle",1,"context-label__info"],[1,"context-label__latin"],[1,"context-label__description",3,"innerHTML","pointerdown","wheel"],["labelDescription",""],[1,"context-label__node-actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xsmall",1,"context-label__node-action",3,"bordered","click"],["type","button","app-button","","buttonTheme","light","buttonSize","xsmall",1,"context-label__node-action",3,"matMenuTriggerFor","bordered"],["icon","caret-down",1,"ml-1"]],template:function(n,e){1&n&&(i.TgZ(0,"app-generic-label",0),i.ALo(1,"async"),i._UZ(2,"div",1,2),i.ALo(4,"markdown"),i.YNc(5,UO,3,2,"div",3),i.ynx(6,4),i.YNc(7,RO,2,1,"i",5),i.YNc(8,NO,3,5,"div",6),i.YNc(9,EO,8,4,"div",7),i.TgZ(10,"mat-menu",null,8)(12,"button",9),i.NdJ("click",function(){return e.fadeNode()}),i._uU(13,"Fade This"),i.qZA(),i.TgZ(14,"button",10),i.NdJ("click",function(){return e.fadeInverseNodes()}),i._uU(15," Fade Everything Else "),i.qZA()(),i.BQk(),i.qZA()),2&n&&(i.ekj("context-label--expanded",e.expanded)("context-label--large",e.largeTitle),i.Q6J("fixedScale",i.lcZ(1,11,e.labelScale$))("label",e.label),i.xp6(2),i.Q6J("innerHTML",i.lcZ(4,13,e.label.title),i.oJD),i.xp6(3),i.Q6J("ngIf",e.node),i.xp6(2),i.Q6J("ngIf",e.node&&(null==e.node.info?null:e.node.info.latinLabel)),i.xp6(1),i.Q6J("ngIf",e.enableInfo&&(null==e.node||null==e.node.info?null:e.node.info.description)),i.xp6(1),i.Q6J("ngIf",e.node))},dependencies:[f.O5,Dn,lt,jt.VK,jt.OP,jt.p6,Ro,f.Ov,En.NO],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%], .context-label__latin[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.context-label[_ngcontent-%COMP%]{z-index:12}.context-label__header[_ngcontent-%COMP%]{word-break:break-word}.context-label__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.context-label__info--expanded[_ngcontent-%COMP%]{color:#2d72dc}.context-label__latin[_ngcontent-%COMP%]{display:block;padding:0 8px 4px;font-size:10px;letter-spacing:.25px;line-height:1.4em}.context-label__description[_ngcontent-%COMP%]{max-height:0;margin:0;overflow:auto;font-size:12px;line-height:18px;transition:max-height .25s,margin .25s}.context-label__node-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid rgba(16,24,35,.5);margin-top:4px}.context-label__node-action[_ngcontent-%COMP%]{border-radius:0;border-right:1px solid rgba(16,24,35,.5);flex:1}.context-label__node-action[_ngcontent-%COMP%]:last-child{border-right:0}@media (min-width: 960px){.context-label__description--expanded[_ngcontent-%COMP%]{margin:8px;max-height:200px}}"],changeDetection:0}),ng([(0,l.Ph)(M.getQuerying),ig("design:type",b.y)],as.prototype,"querying$",void 0),ng([(0,l.Ph)(te.getLabelScale),ig("design:type",b.y)],as.prototype,"labelScale$",void 0),ng([(0,l.Ph)(Pt.getBreakpoint),ig("design:type",b.y)],as.prototype,"breakpoint$",void 0);var o_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},s_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function DO(t,n){if(1&t&&(i.TgZ(0,"div",6),i._UZ(1,"app-content-blocks",7),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("contentBlocks",e.label.contentBlocks)("layout","compact")}}function jO(t,n){if(1&t&&(i._UZ(0,"div",8),i.ALo(1,"markdown")),2&t){const e=i.oxw();i.Q6J("innerHTML",i.lcZ(1,1,e.label.description),i.oJD)}}class Qs{constructor(n,e,o,s){this.changeDetectorRef=n,this.labelsService=e,this.store=o,this.applicationEventService=s,this.emitEvents=!0,this.collapsedMode=ko.None,this.collapsed=!1,this.pinDraggable=!1,this.tagDraggable=!1,this.descriptionCollapsed=!1,this.tagCollapsed=!1,this.ngUnsubscribe=new X.x}get isCollapsed(){if(this.collapsedMode===ko.Toggle){const n=this.store.selectSnapshot(te.getSelectedLabelId)===this.label.id;return this.collapsed&&!n}return this.collapsed}get hasContent(){return this.labelsService.hasContent(this.label)}ngOnInit(){this.selectedLabel$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>this.handleLabelSelected(n)),this.store.select(te.getChapterLabels).pipe((0,w.R)(this.ngUnsubscribe),(0,cn.b)(100)).subscribe(()=>{this.sequence=this.store.selectSnapshot(te.getLabelSequence(this.label)),this.changeDetectorRef.markForCheck()}),this.descriptionCollapsed=this.label.collapseDescription,this.tagCollapsed=this.label.hideTag}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleLabelUpdated(n){const{label:e,shouldPreserve:o}=n;this.store.dispatch(new Fs(e,o))}handleOffsetUpdated(n){const{labelId:e,offset:o}=n;this.store.dispatch(new Id(e,o))}handlePinClicked(n){this.selectLabel()}handleTagClicked(n){this.selectLabel()}selectLabel(){const n=this.store.selectSnapshot(te.getSelectedLabel);this.store.dispatch(new ns(n&&n.id===this.label.id?null:this.label)),this.emitEvent(me.HotspotsPicked,{id:this.label.id}),this.emitEvent(me.LabelsPicked,{labelId:this.label.id})}emitEvent(n,e){this.emitEvents&&this.applicationEventService.fireEvent(n,e)}handleDisplayUpdated(n){this.emitEvent(me.HotspotsDisplayUpdated,n)}handlePositionUpdated(n){this.emitEvent(me.HotspotsPositionUpdated,n.positionUpdate),this.emitEvent(me.LabelsMoved,{labelId:n.positionUpdate.id,canvasPosition:[n.positionUpdate.canvasPos.x,n.positionUpdate.canvasPos.y],occluded:n.positionUpdate.occluded||!n.onCanvas})}handleHoverStart(n){this.emitEvent(me.HotspotsEntered,{id:n.labelId}),this.emitEvent(me.LabelsEntered,{labelId:n.labelId})}handleHoverEnd(n){this.emitEvent(me.HotspotsLeft,{id:n.labelId}),this.emitEvent(me.LabelsLeft,{labelId:n.labelId})}handleLabelSelected(n){const e=n&&n.id===this.label.id,o=(0,m.get)(n,"states[1].errands"),s=this.store.selectSnapshot(Ne.getLockCamera);e&&o&&!s&&o.forEach(a=>{switch(a.type){case Fn.flyToObject:this.store.dispatch(new Wi(a.value));break;case Fn.flyToCamera:this.store.dispatch(new Zn(a.value))}this.store.dispatch(new pd(!0))}),this.tagCollapsed=!this.label.title&&!this.hasContent||(this.label.expandTag&&this.label.hideTag?!e:this.label.hideTag),this.descriptionCollapsed=this.label.showDescription&&this.label.collapseDescription?!e:this.label.collapseDescription}}function BO(t,n){1&t&&i._UZ(0,"app-icon",8)}function VO(t,n){1&t&&i._UZ(0,"app-icon",9)}function qO(t,n){if(1&t&&(i.TgZ(0,"div",10)(1,"em",11),i._uU(2),i.qZA(),i._uU(3,". "),i.qZA()),2&t){const e=i.oxw(2);i.xp6(2),i.Oqu(e.option.label.title)}}function $O(t,n){if(1&t&&(i.TgZ(0,"div",10)(1,"p",12),i._uU(2," You selected "),i.TgZ(3,"em",11),i._uU(4),i.qZA(),i._uU(5,". "),i.qZA(),i.TgZ(6,"p"),i._uU(7," This is the "),i.TgZ(8,"em",11),i._uU(9),i.qZA(),i._uU(10,". "),i.qZA()()),2&t){const e=i.oxw(2);let o;i.xp6(4),i.Oqu(null==(o=e.getSelectedLabel(e.options,e.control.value))?null:o.title.trim()),i.xp6(5),i.Oqu(e.option.label.title.trim())}}function GO(t,n){if(1&t&&(i.TgZ(0,"div",4),i.YNc(1,BO,1,0,"app-icon",5),i.YNc(2,VO,1,0,"app-icon",6),i.YNc(3,qO,4,1,"div",7),i.YNc(4,$O,11,2,"div",7),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngSwitch",e.correct),i.xp6(1),i.Q6J("ngSwitchCase",!0),i.xp6(1),i.Q6J("ngSwitchCase",!1),i.xp6(1),i.Q6J("ngSwitchCase",!0),i.xp6(1),i.Q6J("ngSwitchCase",!1)}}Qs.\u0275fac=function(n){return new(n||Qs)(i.Y36(i.sBO),i.Y36(Os),i.Y36(l.yh),i.Y36(Lo))},Qs.\u0275cmp=i.Xpm({type:Qs,selectors:[["app-story-label"]],inputs:{label:"label",emitEvents:"emitEvents",collapsedMode:"collapsedMode",collapsed:"collapsed",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},decls:9,vars:18,consts:[[3,"label","selected","fixedScale","sequence","isCollapsed","tagCollapsed","pinDraggable","tagDraggable","descriptionCollapsed","hasContent","labelUpdated","offsetUpdated","tagClicked","pinClicked","keydown.enter","displayUpdated","positionUpdated","hoverStart","hoverEnd"],["label-header","",1,"html",3,"innerHTML"],["title",""],["label-body","",1,"html"],["class","mv-1","appEventFence","",4,"ngIf"],["data-test","labelDescription",3,"innerHTML",4,"ngIf"],["appEventFence","",1,"mv-1"],[3,"contentBlocks","layout"],["data-test","labelDescription",3,"innerHTML"]],template:function(n,e){if(1&n&&(i.TgZ(0,"app-generic-label",0),i.NdJ("labelUpdated",function(s){return e.handleLabelUpdated(s)})("offsetUpdated",function(s){return e.handleOffsetUpdated(s)})("tagClicked",function(s){return e.handleTagClicked(s)})("pinClicked",function(s){return e.handlePinClicked(s)})("keydown.enter",function(s){return e.handleTagClicked(s)})("displayUpdated",function(s){return e.handleDisplayUpdated(s)})("positionUpdated",function(s){return e.handlePositionUpdated(s)})("hoverStart",function(s){return e.handleHoverStart(s)})("hoverEnd",function(s){return e.handleHoverEnd(s)}),i.ALo(1,"async"),i.ALo(2,"async"),i._UZ(3,"div",1,2),i.ALo(5,"markdown"),i.TgZ(6,"div",3),i.YNc(7,DO,2,2,"div",4),i.YNc(8,jO,2,3,"div",5),i.qZA()()),2&n){let o;i.Q6J("label",e.label)("selected",(null==(o=i.lcZ(1,12,e.selectedLabel$))?null:o.id)===e.label.id)("fixedScale",i.lcZ(2,14,e.labelScale$))("sequence",e.sequence)("isCollapsed",e.isCollapsed)("tagCollapsed",e.tagCollapsed)("pinDraggable",e.pinDraggable)("descriptionCollapsed",e.descriptionCollapsed)("hasContent",e.hasContent),i.xp6(3),i.Q6J("innerHTML",i.lcZ(5,16,e.label.title),i.oJD),i.xp6(4),i.Q6J("ngIf",e.label.contentBlocks),i.xp6(1),i.Q6J("ngIf",e.label.description)}},dependencies:[f.O5,Ea,ja,Ro,f.Ov,En.NO],changeDetection:0}),o_([(0,l.Ph)(te.getLabelScale),s_("design:type",b.y)],Qs.prototype,"labelScale$",void 0),o_([(0,l.Ph)(te.getSelectedLabel),s_("design:type",b.y)],Qs.prototype,"selectedLabel$",void 0);class cs extends IS{constructor(){super(...arguments),this.sequence=0,this.labelUpdated=new i.vpe}ngOnInit(){}handleLabelUpdated(n){this.labelUpdated.next(n.label)}handleOffsetUpdated(n){this.labelUpdated.next({...this.option.label,offset:n.offset})}getSelectedLabel(n,e){const o=this.options.find(s=>s.value===e);return o?o.label:void 0}}cs.\u0275fac=function(){let t;return function(e){return(t||(t=i.n5z(cs)))(e||cs)}}(),cs.\u0275cmp=i.Xpm({type:cs,selectors:[["app-quiz-label"]],inputs:{sequence:"sequence",collapsed:"collapsed",options:"options",option:"option",correct:"correct",mode:"mode"},outputs:{labelUpdated:"labelUpdated"},features:[i._Bn([{provide:W.JU,useExisting:(0,i.Gpc)(()=>cs),multi:!0}]),i.qOj],decls:5,vars:17,consts:[[1,"label","theme-light",3,"label","fit","opaque","fixedScale","pinDraggable","tagDraggable","isCollapsed","descriptionCollapsed","hasContent","sequence","labelUpdated","offsetUpdated"],["label-body","",1,"label__body"],[3,"outline","hidden","options","formControl"],["class","label__summary flex items-start",3,"ngSwitch",4,"ngIf"],[1,"label__summary","flex","items-start",3,"ngSwitch"],["class","label__icon label__icon--correct","style","font-size: 16px","icon","check-circle",4,"ngSwitchCase"],["class","label__icon label__icon--incorrect","style","font-size: 16px","icon","times-circle",4,"ngSwitchCase"],["class","label__text pl-2",4,"ngSwitchCase"],["icon","check-circle",1,"label__icon","label__icon--correct",2,"font-size","16px"],["icon","times-circle",1,"label__icon","label__icon--incorrect",2,"font-size","16px"],[1,"label__text","pl-2"],[1,"text-semibold"],[1,"pb-2"]],template:function(n,e){1&n&&(i.TgZ(0,"app-generic-label",0),i.NdJ("labelUpdated",function(s){return e.handleLabelUpdated(s)})("offsetUpdated",function(s){return e.handleOffsetUpdated(s)}),i.ALo(1,"async"),i.TgZ(2,"div",1),i._UZ(3,"app-quiz-label-anatomy-select",2),i.YNc(4,GO,5,5,"div",3),i.qZA()()),2&n&&(i.Q6J("label",e.option.label)("fit","summary"===e.mode?"fixed":"auto")("opaque",!0)("fixedScale",i.lcZ(1,15,e.labelScale$))("pinDraggable","edit"===e.mode)("tagDraggable","edit"===e.mode)("isCollapsed",e.collapsed)("descriptionCollapsed",!1)("hasContent",!0)("sequence",e.sequence),i.xp6(3),i.Q6J("outline",!1)("hidden","summary"===e.mode)("options",e.options)("formControl",e.control),i.xp6(1),i.Q6J("ngIf","summary"===e.mode))},dependencies:[f.O5,f.RF,f.n9,lt,W.JJ,W.oH,Db,Ro,f.Ov],styles:[".label__body[_ngcontent-%COMP%]{color:#101823;min-width:142px;max-width:200px}.label__icon[_ngcontent-%COMP%]{position:relative;flex-basis:0 0 20px;justify-content:center}.label__icon--correct[_ngcontent-%COMP%]{color:#83e692}.label__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}.label__text[_ngcontent-%COMP%]{flex-wrap:wrap}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(te.getLabelScale),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],cs.prototype,"labelScale$",void 0);var Vr=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},qr=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function JO(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"app-quiz-label",3),i.NdJ("labelUpdated",function(s){const a=i.CHM(e).index,c=i.oxw();return i.KtG(c.handleLabelUpdated(s,a))}),i.ALo(2,"async"),i.ALo(3,"async"),i.ALo(4,"async"),i.ALo(5,"async"),i.ALo(6,"async"),i.qZA(),i.BQk()}if(2&t){const e=n.$implicit,o=n.index,s=i.oxw();i.xp6(1),i.Q6J("mode",s.mode)("formControl",e)("option",i.lcZ(2,7,s.quizLabels$)[o])("options",i.lcZ(3,9,s.quizLabels$))("sequence",o+1)("correct",s.isCorrect(i.lcZ(4,11,s.quizLabels$)[o],i.lcZ(5,13,s.activeSubmitted$),o))("collapsed",i.lcZ(6,15,s.labelsCollapsed$))}}class Bi{constructor(n,e,o,s){this.store=n,this.formBuilder=e,this.changeRef=o,this.router=s,this.ngUnsubscribe=new X.x,this.mode="edit",this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.initQuizSubmissionListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.quizLabels$.pipe((0,$n.x)((n,e)=>{const o=n.map(r=>r.value),s=e.map(r=>r.value);return(0,m.isEqual)(o,s)}),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.store.selectSnapshot(U.getQuizModeActive);this.buildFormOptions(n,e),this.changeRef.markForCheck()}),(0,bt.a)([this.quizModeActive$,this.quizLabels$]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([n])=>{this.setFormEnabled(n),this.changeRef.markForCheck()})}initQuizSubmissionListeners(){this.activeSubmission$.pipe((0,$.h)(n=>!(0,m.isNil)(n)&&!(0,m.isNil)(n.answer)&&Array.isArray(n.answer)),(0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const o=n.answer;(0,m.isEqual)(this.form.value.options,o)||(this.form.patchValue({options:o},{emitEvent:!1,onlySelf:!0}),this.changeRef.markForCheck())}),this.form.valueChanges.pipe((0,$n.x)((n,e)=>(0,m.isEqual)(n,e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.store.selectSnapshot(U.getActiveQuestionId),o=this.store.selectSnapshot(U.getActiveSubmitted),s=this.store.selectSnapshot(U.getActiveSubmission),r=(0,m.isNil)(s)?[]:s.answer,a=n.options;!(0,m.isNil)(o)||((0,m.isEqual)(a,r)||this.store.dispatch(new ee.SetActiveSubmission({questionId:e,answer:a})),this.changeRef.markForCheck())}),(0,bt.a)([this.quizModeActive$,this.activeSubmitted$]).subscribe(([n,e])=>{this.mode=this.router.url.includes("/edit")?"edit":n&&!(0,m.isNil)(e)?"summary":"view",this.changeRef.markForCheck()})}isCorrect(n,e,o){if(!(0,m.isNil)(e))return e.answer[o]===n.value}handleLabelUpdated(n,e){const o=this.store.selectSnapshot(U.getActiveQuestion);o.data.options[e].label=n,this.store.dispatch(new ee.SetQuestion(o))}buildFormOptions(n,e){this.optionsArray.clear(),n.forEach(o=>{this.optionsArray.push(this.formBuilder.control(e?"":o.value))})}setFormEnabled(n){n?this.optionsArray.enable():this.optionsArray.disable()}}Bi.\u0275fac=function(n){return new(n||Bi)(i.Y36(l.yh),i.Y36(W.QS),i.Y36(i.sBO),i.Y36(We.F0))},Bi.\u0275cmp=i.Xpm({type:Bi,selectors:[["app-quiz-labels"]],decls:3,vars:2,consts:[["data-test","quizLabelsElement",3,"formGroup"],["formArrayName","options"],[4,"ngFor","ngForOf"],["data-test","appQuizLabel",3,"mode","formControl","option","options","sequence","correct","collapsed","labelUpdated"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,JO,7,17,"ng-container",2),i.qZA()()),2&n&&(i.Q6J("formGroup",e.form),i.xp6(2),i.Q6J("ngForOf",e.optionsArray.controls))},dependencies:[f.sg,W.JJ,W.JL,W.oH,W.sg,W.CE,cs,f.Ov],changeDetection:0}),Vr([(0,l.Ph)(te.getLabelsCollapsed),qr("design:type",b.y)],Bi.prototype,"labelsCollapsed$",void 0),Vr([(0,l.Ph)(U.getActiveQuestionLabels),qr("design:type",b.y)],Bi.prototype,"quizLabels$",void 0),Vr([(0,l.Ph)(U.getQuizModeActive),qr("design:type",b.y)],Bi.prototype,"quizModeActive$",void 0),Vr([(0,l.Ph)(U.getAllSubmissions),qr("design:type",b.y)],Bi.prototype,"allSubmissions$",void 0),Vr([(0,l.Ph)(U.getActiveSubmission),qr("design:type",b.y)],Bi.prototype,"activeSubmission$",void 0),Vr([(0,l.Ph)(U.getActiveSubmitted),qr("design:type",b.y)],Bi.prototype,"activeSubmitted$",void 0);var jn=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Qn=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function HO(t,n){if(1&t&&(i._UZ(0,"app-context-label",5),i.ALo(1,"async"),i.ALo(2,"async"),i.ALo(3,"async"),i.ALo(4,"async"),i.ALo(5,"async")),2&t){const e=i.oxw(3);let o,s;i.Q6J("label",i.lcZ(1,3,e.contextLabel$))("enableInfo",i.lcZ(2,5,e.enableContextLabelInfo$)&&(null==(o=i.lcZ(3,7,e.layout$))?null:o.nodeInfo.enable))("enableActions",i.lcZ(4,9,e.enableContextLabelActions$)&&(null==(s=i.lcZ(5,11,e.layout$))?null:s.contextActions.enable))}}function YO(t,n){if(1&t&&(i.ynx(0),i._UZ(1,"app-story-label",6),i.ALo(2,"async"),i.ALo(3,"async"),i.ALo(4,"async"),i.ALo(5,"async"),i.BQk()),2&t){const e=n.$implicit,o=i.oxw(3);let s,r;i.xp6(1),i.ekj("labels__label--hidden",!e.shown),i.Q6J("pinDraggable",null==(s=i.lcZ(2,7,o.draggable$))?null:s.pin)("tagDraggable",null==(r=i.lcZ(3,9,o.draggable$))?null:r.tag)("label",e)("collapsed",i.lcZ(4,11,o.labelsCollapsed$))("collapsedMode",i.lcZ(5,13,o.labelsCollapsedMode$))}}function WO(t,n){if(1&t&&(i.ynx(0),i.YNc(1,HO,6,13,"app-context-label",3),i.ALo(2,"async"),i.ALo(3,"async"),i.YNc(4,YO,6,15,"ng-container",4),i.ALo(5,"async"),i.BQk()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",i.lcZ(2,3,e.enableContextLabel$)&&i.lcZ(3,5,e.contextLabel$)),i.xp6(3),i.Q6J("ngForOf",i.lcZ(5,7,e.labels$))("ngForTrackBy",e.trackLabel)}}function KO(t,n){1&t&&(i.ynx(0),i._UZ(1,"app-quiz-labels"),i.BQk())}function XO(t,n){if(1&t&&(i.TgZ(0,"div",1),i.YNc(1,WO,6,9,"ng-container",2),i.YNc(2,KO,2,0,"ng-container",2),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.showAnatomyLabels),i.xp6(1),i.Q6J("ngIf",e.showQuizLabels)}}class en{constructor(n,e,o,s,r,a,c,p){this.action$=n,this.cameraService=e,this.changeDetector=o,this.elRef=s,this.labelsService=r,this.router=a,this.store=c,this.applicationEventService=p,this.interactive=!1,this.showAnatomyLabels=!1,this.showQuizLabels=!1,this.ngUnsubscribe=new X.x}ngOnInit(){this.bindEngineEvents(),this.bindApplicationEvents(),this.labelsService.setLabelContainer(this.elRef)}ngOnDestroy(){this.labelsService.setLabelContainer(null),this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}bindApplicationEvents(){this.action$.pipe((0,l.xt)(vc),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.handleClickNode(e)}),this.action$.pipe((0,l.xt)(_a),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{e.node&&this.store.dispatch(new Oo)}),this.labels$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.changeDetector.markForCheck()}),this.selectedLabel$.pipe((0,$.h)(e=>null==e),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(Ne.getZoomed),o=this.store.selectSnapshot(Ne.getLockCamera);e&&!o&&this.resetCamera()});const n=(0,bt.a)([this.activeTool$,this.activeQuestion$]).pipe((0,w.R)(this.ngUnsubscribe),(0,J.U)(([e,o])=>{const s=this.router.url.indexOf("/edit")>=0,r=(0,m.get)(o,"type")===Re.LabelAnatomy;return s?e===Ve.Quiz:r}));(0,bt.a)([this.showLabels$,n,this.activeQuestion$]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([e,o,s])=>{const r=(0,m.get)(s,"showChapterLabels");this.showQuizLabels=o,this.showAnatomyLabels=!this.showQuizLabels&&e||r,this.changeDetector.markForCheck()}),this.store.select(_.getSelectedChapterReadyState).pipe((0,$.h)(e=>null!=e),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.interactive=e.model,this.changeDetector.markForCheck()})}bindEngineEvents(){this.action$.pipe((0,l.xt)(Wo,La),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.applicationEventService.fireEvent(n.show?me.LabelsEnabled:me.LabelsDisabled,null)}),this.action$.pipe((0,l.xt)(Ls),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.applicationEventService.fireEvent(me.LabelsCreated,n.label)}),this.action$.pipe((0,l.xt)(Fs),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.applicationEventService.fireEvent(me.LabelsUpdated,n.label)}),this.action$.pipe((0,l.xt)(To),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{n.labels.forEach(e=>{this.applicationEventService.fireEvent(n.shown?me.LabelsShown:me.LabelsHidden,{labelId:e.id})})}),this.action$.pipe((0,l.xt)(kr),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.applicationEventService.fireEvent(me.LabelsDestroyed,n.label)})}handleClickNode(n){const e=this.store.selectSnapshot(M.getActiveTool);null!=n.node?e===Ve.Label?this.addLabel(n.hit,n.node):setTimeout(()=>{this.toggleContextLabel(n.hit,n.node)}):(this.store.dispatch(new ns(null)),this.store.dispatch(new Oo))}addLabel(n,e){const o=this.cameraService.getDirection(n),s=this.getLabelDefaults(n.objectId),r=s.hideWire?20:32;s.title=e.label,s.offset=[r,0],s.objectId=n.objectId,s.barycentric=[n.barycentric[0],n.barycentric[1],n.barycentric[2]],s.pos=[n.worldPos[0],n.worldPos[1],n.worldPos[2]],s.primitiveIndex=n.triIndex,s.renderableIndex=n.renderableIndex||0,s.dir=o,s.chapterId=this.store.selectSnapshot(_.getSelectedChapter).id,s.occludable=!0,s.shown=!0,this.store.dispatch(new Ls(s)),this.store.dispatch(new ns(s))}toggleContextLabel(n,e){const o=this.store.selectSnapshot(Se.getCheckedNodeIds);if(!this.store.selectSnapshot(M.getContextmenu).node&&o.some(r=>r===e.id)){const r=this.cameraService.getDirection(n),a=this.labelsService.makeDefaultStudioLabel();a.theme=qt.Context,a.title=e.label,a.offset=[32,0],a.objectId=n.objectId,a.barycentric=[n.barycentric[0],n.barycentric[1],n.barycentric[2]],a.pos=[n.worldPos[0],n.worldPos[1],n.worldPos[2]],a.primitiveIndex=n.triIndex,a.dir=r,a.occludable=!1,a.hideWire=!0,a.pinType=St.None,this.store.dispatch(new zd(a))}else this.store.dispatch(new Oo)}getLabelDefaults(n){let e=this.store.selectSnapshot(te.getSelectedLabel);if(null==e){let o=this.store.selectSnapshot(te.getChapterLabels);(!o||0===o.length)&&(o=this.store.selectSnapshot(te.getLabels)),o.length&&(e=(0,m.cloneDeep)(o[o.length-1]))}if(null!=e){const o=this.labelsService.makeDefaultStudioLabel();switch(o.hideWire=e.hideWire,o.pinGlow=e.pinGlow,o.pinType=e.pinType,o.theme=e.theme,o.sequentialType=e.sequentialType,o.states[0].errands[0]=new Oa,(0,m.get)(e,"states[1].errands[0].type")){case Fn.flyToObject:case Fn.flyToCamera:o.states[1].errands[0]=new ka(n)}return o}{const o=this.labelsService.makeDefaultStudioLabel();return o.states[0].errands[0]=new Oa,o.states[1].errands[0]=new ka(n),o}}trackLabel(n,e){const{id:o,shown:s,theme:r}=e;return`${o}${s}${r}`}resetCamera(){const e=this.store.selectSnapshot(_.getSelectedChapter)?.camera?.location;(0,m.isNil)(e)||this.store.dispatch(new Zn(e))}}en.\u0275fac=function(n){return new(n||en)(i.Y36(l.eX),i.Y36(Bn),i.Y36(i.sBO),i.Y36(i.SBq),i.Y36(Os),i.Y36(We.F0),i.Y36(l.yh),i.Y36(Lo))},en.\u0275cmp=i.Xpm({type:en,selectors:[["app-labels"]],decls:1,vars:1,consts:[["class","labels","data-test","labelsElement",4,"ngIf"],["data-test","labelsElement",1,"labels"],[4,"ngIf"],[3,"label","enableInfo","enableActions",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"label","enableInfo","enableActions"],["data-test","appStoryLabel",1,"labels__label",3,"pinDraggable","tagDraggable","label","collapsed","collapsedMode"]],template:function(n,e){1&n&&i.YNc(0,XO,3,2,"div",0),2&n&&i.Q6J("ngIf",e.interactive)},dependencies:[f.sg,f.O5,as,Qs,Bi,f.Ov],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;position:relative}.labels[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2;pointer-events:none}.labels__label--hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),jn([(0,l.Ph)(O.getUI),Qn("design:type",b.y)],en.prototype,"layout$",void 0),jn([(0,l.Ph)(te.getChapterLabels),Qn("design:type",b.y)],en.prototype,"labels$",void 0),jn([(0,l.Ph)(U.getQuizModeActive),Qn("design:type",b.y)],en.prototype,"quizModeActive$",void 0),jn([(0,l.Ph)(M.getActiveTool),Qn("design:type",b.y)],en.prototype,"activeTool$",void 0),jn([(0,l.Ph)(U.getActiveQuestion),Qn("design:type",b.y)],en.prototype,"activeQuestion$",void 0),jn([(0,l.Ph)(_.getSelectedChapter),Qn("design:type",b.y)],en.prototype,"selectedChapter$",void 0),jn([(0,l.Ph)(te.getSelectedLabel),Qn("design:type",b.y)],en.prototype,"selectedLabel$",void 0),jn([(0,l.Ph)(te.getLabelsCollapsed),Qn("design:type",b.y)],en.prototype,"labelsCollapsed$",void 0),jn([(0,l.Ph)(te.getLabelsCollapsedMode),Qn("design:type",b.y)],en.prototype,"labelsCollapsedMode$",void 0),jn([(0,l.Ph)(te.getContextLabel),Qn("design:type",b.y)],en.prototype,"contextLabel$",void 0),jn([(0,l.Ph)(M.getShowLabels),Qn("design:type",b.y)],en.prototype,"showLabels$",void 0),jn([(0,l.Ph)(Ne.getZoomed),Qn("design:type",b.y)],en.prototype,"zoomed$",void 0),jn([(0,l.Ph)(te.getEnableContextLabel),Qn("design:type",b.y)],en.prototype,"enableContextLabel$",void 0),jn([(0,l.Ph)(te.getEnableContextLabelInfo),Qn("design:type",b.y)],en.prototype,"enableContextLabelInfo$",void 0),jn([(0,l.Ph)(te.getEnableContextLabelActions),Qn("design:type",b.y)],en.prototype,"enableContextLabelActions$",void 0),jn([(0,l.Ph)(te.getLabelsDraggable),Qn("design:type",b.y)],en.prototype,"draggable$",void 0);const eT=function(t){return{"progress__bar--complete":t}},tT=function(t){return{width:t}};let nT=(()=>{class t{constructor(e,o){this.router=e,this.changeDetector=o,this.total=100,this._value=0,this.percentWidth=0,this.ngUnsubscribe=new X.x}get value(){return this._value}set value(e){this._value=e,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}ngOnInit(){this.router.events.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{e instanceof We.OD&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(We.F0),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-progress"]],inputs:{total:"total",value:"value"},decls:2,vars:7,consts:[[1,"progress"],["role","progressbar","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"div",1),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngClass",i.VKq(3,eT,100===o.percentWidth))("ngStyle",i.VKq(5,tT,o.percentWidth+"%")),i.uIk("aria-valuenow",o.percentWidth))},dependencies:[f.mk,f.PC],styles:["@keyframes progressSuccess{0%{width:100%!important;background:#38de38}50%{opacity:1;background:#38de38}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;height:4px;width:100%}.progress__bar[_ngcontent-%COMP%]{background:#de3535;height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:progressSuccess 2s linear forwards}"],changeDetection:0}),t})(),iT=(()=>{class t{constructor(e,o){this.store=e,this.changeDetectorRef=o,this.ngUnsubscribe=new X.x,this.storyLoadProgress=0}ngOnInit(){const e=this.store.select(yn.getChapterLoadProgress),o=this.store.select(we.getLoadingChapter);(0,bt.a)(e,o).pipe((0,$.h)(()=>{const s=this.store.selectSnapshot(we.getLoadChapters);return!(0,m.isNil)(s)&&s.length>0}),(0,w.R)(this.ngUnsubscribe)).subscribe(([s,r])=>{const a=!(0,m.isNil)(r)&&r.chapterId===this.store.selectSnapshot(_.getSelectedChapterId);this.storyLoadProgress=a?s:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-progress"]],decls:1,vars:2,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(e,o){1&e&&i._UZ(0,"app-progress",0),2&e&&i.Q6J("value",o.storyLoadProgress)("total",1)},dependencies:[nT],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0}),t})();var j=A(7340);function oT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1),i.NdJ("@show.done",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.onShowDone())}),i.TgZ(1,"div",2),i._uU(2,"Use control + scroll to zoom"),i.qZA()()}2&t&&i.Q6J("@show",void 0)}let sT=(()=>{class t{constructor(e,o){this.actions=e,this.changeDetectorRef=o,this.ngUnsubscribe=new X.x,this.show=!1}ngOnInit(){this.actions.pipe((0,l.xt)(Jh),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.eX),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(e,o){1&e&&i.YNc(0,oT,3,1,"div",0),2&e&&i.Q6J("ngIf",o.show)},dependencies:[f.O5],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:rgba(16,24,35,.5);font-size:16px;letter-spacing:.4px;line-height:1.4em;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,j.X$)("show",[(0,j.eR)(":enter",[(0,j.vP)([(0,j.oB)({opacity:"*"}),(0,j.jt)("500ms ease-in-out",(0,j.oB)({opacity:1})),(0,j.jt)("500ms 2000ms ease-in-out",(0,j.oB)({opacity:0}))])])])]},changeDetection:0}),t})();const rT=function(t,n){return{backgroundColor:t,duration:n}},aT=function(t,n){return{value:t,params:n}},lT=(0,j.oQ)([(0,j.oB)({opacity:"0",backgroundColor:"*"}),(0,j.vP)([(0,j.jt)("{{ duration }}ms {{ easing }}",(0,j.oB)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,j.jt)("250ms 500ms ease-in",(0,j.oB)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let pT=(()=>{class t{constructor(e,o,s){this.actions=e,this.changeDetectorRef=o,this.store=s,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new X.x}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,l.xt)(Hh),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.fadeIn(e.color,e.duration)})}handleFadeComplete(){this.store.dispatch(new Q0),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(e,o){this.isVisible=!0,this.color=e,this.duration=1e3*o,this.changeDetectorRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.eX),i.Y36(i.sBO),i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.NdJ("@fade.done",function(){return o.handleFadeComplete()}),i.qZA()),2&e&&i.Q6J("@fade",i.WLB(4,aT,o.isVisible,i.WLB(1,rT,o.color,o.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,j.X$)("fade",[(0,j.eR)("* => true",(0,j._7)(lT))])]},changeDetection:0}),t})();var $r=A(9344);let dT=(()=>{class t{constructor(e,o,s,r){this.engineService=e,this.cameraService=o,this.numberService=s,this.changeDetectionRef=r,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(pe.CameraUpdated).pipe((0,$r.e)(50)).subscribe(e=>{const o=this.numberService.roundModel(e.eye,0),{x:s,y:r,z:a}=o,c=Math.floor(100*this.cameraService.getCameraZoom()),p=this.numberService.roundNumber(e.dist,0);this.camera={x:s,y:r,z:a,zoom:c,dist:p},this.changeDetectionRef.markForCheck()})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(et),i.Y36(Bn),i.Y36(fd),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._uU(1),i.qZA()),2&e&&(i.xp6(1),i.xDo(" X:",null==o.camera?null:o.camera.x," Y:",null==o.camera?null:o.camera.y," Z:",null==o.camera?null:o.camera.z," Dist:",null==o.camera?null:o.camera.dist," Zoom:",null==o.camera?null:o.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0}),t})(),Vl=(()=>{class t{constructor(e){this.applicationEventService=e}getClipboardAPISupport(){return"clipboard"in navigator}getClipboardAPI(){return navigator.clipboard}nativeShareLink(e){(!0===se.native||se.platform===Yi.SDK)&&this.applicationEventService.fireEvent(me.NativeShare,{type:"shareLinkModel",value:JSON.stringify(e)})}copyToClipboard(e,o){if(!0===se.native||se.platform===Yi.SDK)return new b.y(s=>{this.applicationEventService.fireEvent(me.NativeShare,{type:o,value:e}),s.next(!0),s.complete()});if(this.getClipboardAPISupport()){const s=this.getClipboardAPI();return new b.y(r=>{s.writeText(e).then(()=>{r.next(!0),r.complete()}).catch(a=>{r.next(!1),r.complete()})})}return(0,Ue.of)(!1)}copyInputFieldValue(e){e.select();let o=!1;try{o=document.execCommand("copy")}catch{o=!1}return o}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Lo))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),og=(()=>{class t{constructor(e){this.colorRecipe=e}}return t.type="[Edit Paint] Set Color Recipe",t})(),r_=(()=>{class t{constructor(e){this.brushMode=e}}return t.type="[Edit Paint] Set Paint Brush Mode",t})(),sg=(()=>{class t{constructor(){}}return t.type="[Edit Paint] Clear Current Recipe",t})(),rg=(()=>{class t{constructor(){}}return t.type="[Edit Paint] Reset Paint",t})(),a_=(()=>{class t{constructor(e){this.recipe=e}}return t.type="[Edit Paint] Add Recent Recipe",t})(),c_=(()=>{class t{constructor(e){this.recipes=e}}return t.type="[Edit Paint] Set Recent Recipes",t})(),l_=(()=>{class t{constructor(){}}return t.type="[Edit Paint] Reset Story Recipes",t})(),p_=(()=>{class t{constructor(e,o){this.chapterId=e,this.recipes=o}}return t.type="[Edit Paint] Set Story Recipes For Chapter",t})(),d_=(()=>{class t{constructor(e){this.palette=e}}return t.type="[Edit Paint] Add Palette",t})(),u_=(()=>{class t{constructor(e){this.paletteId=e}}return t.type="[Edit Paint] Remove Palette",t})(),g_=(()=>{class t{constructor(e){this.palette=e}}return t.type="[Edit Paint] Update Palette",t})(),Zs=(()=>{class t{constructor(e){this.palettes=e}}return t.type="[Edit Paint] Set Palettes",t})(),h_=(()=>{class t{constructor(e,o){this.recipe=e,this.paletteId=o}}return t.type="[Edit Paint] Add Recipe to Palette",t})(),m_=(()=>{class t{constructor(e,o){this.paletteId=e,this.open=o}}return t.type="[Edit Paint] Toggle Palette",t})();var Bs=(()=>(function(t){t.Chapter="chapter",t.Label="label",t.Paint="paint",t.Position="position",t.Quiz="quiz"}(Bs||(Bs={})),Bs))();let ql=(()=>{class t{constructor(e,o,s){this.templateRef=e,this.viewContainer=o,this.router=s,this._appFlagApplicationMode="include"}get appFlagApplication(){return this._appFlagApplication}set appFlagApplication(e){this._appFlagApplication=e}get appFlagApplicationMode(){return this._appFlagApplicationMode}set appFlagApplicationMode(e){this._appFlagApplicationMode=e}get appFlagApplicationPage(){return this._appFlagApplicationPage}set appFlagApplicationPage(e){this._appFlagApplicationPage=e}get appFlagApplicationPlatform(){return this._appFlagApplicationPlatform}set appFlagApplicationPlatform(e){this._appFlagApplicationPlatform=e}get appFlagApplicationNative(){return this._appFlagApplicationNative}set appFlagApplicationNative(e){this._appFlagApplicationNative=e}ngOnInit(){this.update()}update(){let e=!1,o=!1,s=!1,r=!1,a=!1;if(""===this.appFlagApplication?o=!0:Array.isArray(this.appFlagApplication)?o=this.appFlagApplication.some(p=>p===se.application):"string"==typeof this.appFlagApplication&&(o=this.appFlagApplication===se.application),null==this.appFlagApplicationPage)s=!0;else{const p=this.router.url;Array.isArray(this.appFlagApplicationPage)?s=this.appFlagApplicationPage.some(d=>p.indexOf(d)>=0):"string"==typeof this.appFlagApplicationPage&&(s=p.indexOf(this.appFlagApplicationPage)>=0)}if(null==this.appFlagApplicationPlatform)r=!0;else{const p=se.platform;Array.isArray(this.appFlagApplicationPlatform)?r=this.appFlagApplicationPlatform.some(d=>p.indexOf(d)>=0):"string"==typeof this.appFlagApplicationPlatform&&(r=p.indexOf(this.appFlagApplicationPlatform)>=0)}null==this.appFlagApplicationNative?a=!0:(a=se.native,(Array.isArray(this.appFlagApplicationNative)?this.appFlagApplicationNative:[this.appFlagApplicationNative]).includes(Br.iOS)&&(a=se.native&&void 0!==window.webkit)),e=o&&s&&r&&a,e&&"include"===this.appFlagApplicationMode||!e&&"exclude"===this.appFlagApplicationMode?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Rgc),i.Y36(i.s_b),i.Y36(We.F0))},t.\u0275dir=i.lG2({type:t,selectors:[["","appFlagApplication",""]],inputs:{appFlagApplication:"appFlagApplication",appFlagApplicationMode:"appFlagApplicationMode",appFlagApplicationPage:"appFlagApplicationPage",appFlagApplicationPlatform:"appFlagApplicationPlatform",appFlagApplicationNative:"appFlagApplicationNative"}}),t})();var Ya=A(4850);const uT=["nodeActionsTrigger"];function gT(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"button",31),i._uU(2,"Select"),i.qZA(),i._UZ(3,"mat-divider"),i.BQk()),2&t){i.oxw();const e=i.MAs(26);i.xp6(1),i.Q6J("matMenuTriggerFor",e)}}function hT(t,n){if(1&t&&(i.ynx(0),i._UZ(1,"mat-divider"),i.TgZ(2,"button",32),i._uU(3," Selectable / Unselectable "),i.qZA(),i.BQk()),2&t){i.oxw();const e=i.MAs(45);i.xp6(2),i.Q6J("matMenuTriggerFor",e)}}function mT(t,n){1&t&&i._UZ(0,"mat-divider")}function fT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",33),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.editNodeLabel(s.node))}),i._uU(1," Edit Display Name "),i.qZA()}}function bT(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"button",30),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.copy(s.node.label))}),i._uU(2," Copy Display Name "),i.qZA(),i.BQk()}}function yT(t,n){if(1&t&&(i.ynx(0),i.TgZ(1,"button",34),i._uU(2," Copy "),i.qZA(),i.BQk()),2&t){i.oxw();const e=i.MAs(52);i.xp6(1),i.Q6J("matMenuTriggerFor",e)}}function _T(t,n){if(1&t){const e=i.EpF();i.ynx(0),i._UZ(1,"mat-divider"),i.TgZ(2,"button",35),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.samplePaint(s.node))}),i._uU(3," Sample Paint "),i.qZA(),i.BQk()}}function xT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",36),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.toggleVisible(s.node,!0))}),i._uU(1," Show This "),i.qZA()}}function vT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",37),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.toggleVisible(s.node,!1))}),i._uU(1," Hide This "),i.qZA()}}function CT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",38),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.togglePickable(s.node,!1))}),i._uU(1," Make Unselectable "),i.qZA()}}function wT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",39),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.togglePickable(s.node,!0))}),i._uU(1," Make Selectable "),i.qZA()}}let ag=(()=>{class t{constructor(e,o,s,r,a,c){this.store=e,this.clipboardService=o,this.snackbar=s,this.liveAnnouncer=r,this.nodeService=a,this.changeDetectorRef=c,this.application=mt,this.shortId="",this.theme="dark",this.eventCategory="",this.nodeActionsClosed=new i.vpe}get node(){return this._node}set node(e){this._node=e;const o=this.node.id.split("-");this.shortId=2===o.length?o[1]:o[0]}isNodeChecked(e){return this.store.selectSnapshot(Se.getNodes)[e].checked}isNodeShown(e){return this.store.selectSnapshot(Se.getNodes)[e].shown}checkNode(e,o){const s=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new Rt(s,[e.id]))}checkInverse(e){this.store.dispatch(new Rt(!0)),this.store.dispatch(new Rt(!1,[e.id]))}setCheckedNodes(e,o){this.store.dispatch(new Rt(!1));const s=void 0===o?!this.isNodeChecked(e.id):o;this.store.dispatch(new Rt(s,[e.id]))}flyToNode(e){this.store.dispatch(new Wi(e.id)).subscribe(()=>{this.liveAnnouncer.announce("Fly to complete")})}hideNode(e){this.store.dispatch(new rn(!1,[e.id]))}showNode(e){this.store.dispatch(new rn(!0,[e.id])),this.changeDetectorRef.markForCheck()}toggleVisible(e,o){const s=void 0===o?this.isNodeShown(e.id):o;this.store.dispatch(new rn(s,[e.id])),this.changeDetectorRef.markForCheck()}togglePickable(e,o){this.store.dispatch(new Ta(o,[e.id])),this.changeDetectorRef.markForCheck()}makeEverythingElseUnpickale(e){this.store.dispatch(new Ta(!1)),this.store.dispatch(new Ta(!0,[e.id]))}hideInverse(e){this.nodeService.hideInverse(e)}fadeNode(e){this.nodeService.fade(e)}fadeInverseNodes(e){this.nodeService.fadeInverse(e)}editNodeLabel(e){this.store.dispatch(new ur(e)),this.store.dispatch(new Sc(e))}copy(e){this.clipboardService.copyToClipboard(e,"text").subscribe(()=>{this.snackbar.open(`Copied ${e} to clipboard.`)})}onMenuClosed(){this.nodeActionsClosed.emit()}samplePaint(e){const o=this.store.selectSnapshot(Se.getNodePaint)(e.id);!function H1(t){return!(0,m.isNil)(t)&&(!(0,m.isNil)(t.brightness)&&!1!==t.brightness||!(0,m.isNil)(t.contrast)&&!1!==t.contrast||!(0,m.isNil)(t.opacity)&&!1!==t.opacity||!(0,m.isNil)(t.saturation)&&!1!==t.saturation||!(0,m.isNil)(t.tintColor)&&!1!==t.tintColor)}(Is(o))?this.store.dispatch(new sg):this.store.dispatch(new og(o)),this.store.dispatch(new Cs(Ve.Paint)),this.store.dispatch(new Bu(Bs.Paint))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(Vl),i.Y36(_i.ux),i.Y36(no.Kd),i.Y36(e_),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-node-actions"]],viewQuery:function(e,o){if(1&e&&i.Gf(uT,7),2&e){let s;i.iGM(s=i.CRH())&&(o.nodeActionsTrigger=s.first)}},inputs:{node:"node",theme:"theme",eventCategory:"eventCategory"},outputs:{nodeActionsClosed:"nodeActionsClosed"},decls:60,vars:31,consts:[["app-button","","data-test","nodeActionsTrigger","buttonSize","xsmall",3,"buttonTheme","matMenuTriggerFor","menuClosed"],["nodeActionsTrigger","matMenuTrigger"],["icon","ellipsis-v","aria-hidden","true"],[1,"visually-hidden"],[3,"overlapTrigger"],["nodeActions","matMenu"],[4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsHideShow",3,"click"],["mat-menu-item","","data-test","nodeActionsIsolate",3,"click"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationPage"],["mat-menu-item","","data-test","nodeActionsFlyTo",3,"click"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click",4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["selectActions","matMenu"],["mat-menu-item","","data-test","nodeActionsSelectThis",3,"click"],["mat-menu-item","","data-test","nodeActionsSelectEverythingElse",3,"click"],["fadeActions","matMenu"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["showHideActions","matMenu"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["pickableActions","matMenu"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsEverythingElseUnpickable",3,"click"],["copyActions","matMenu"],["mat-menu-item","","data-test","nodeActionsCopyShortID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyFullID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyDisplayName",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPickableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsSamplePaint",3,"click"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click"]],template:function(e,o){if(1&e&&(i.ynx(0),i.TgZ(1,"button",0,1),i.NdJ("menuClosed",function(){return o.onMenuClosed()}),i._UZ(3,"app-icon",2),i.TgZ(4,"span",3),i._uU(5),i.qZA()(),i.TgZ(6,"mat-menu",4,5),i.YNc(8,gT,4,1,"ng-container",6),i.TgZ(9,"button",7),i.NdJ("click",function(){return o.toggleVisible(o.node,!o.node.boolState.shown)}),i._uU(10),i.qZA(),i.TgZ(11,"button",8),i.NdJ("click",function(){return o.hideInverse(o.node)}),i._uU(12," Isolate "),i.qZA(),i._UZ(13,"mat-divider"),i.TgZ(14,"button",9),i._uU(15," Fade "),i.qZA(),i.YNc(16,hT,4,1,"ng-container",10),i._UZ(17,"mat-divider"),i.TgZ(18,"button",11),i.NdJ("click",function(){return o.flyToNode(o.node)}),i._uU(19,"Fly To"),i.qZA(),i.YNc(20,mT,1,0,"mat-divider",6),i.YNc(21,fT,2,0,"button",12),i.YNc(22,bT,3,0,"ng-container",6),i.YNc(23,yT,3,1,"ng-container",6),i.YNc(24,_T,4,0,"ng-container",6),i.qZA(),i.TgZ(25,"mat-menu",null,13)(27,"button",14),i.NdJ("click",function(){return o.checkNode(o.node,!0)}),i._uU(28," Select This "),i.qZA(),i.TgZ(29,"button",15),i.NdJ("click",function(){return o.checkInverse(o.node)}),i._uU(30," Select Everything Else "),i.qZA()(),i.TgZ(31,"mat-menu",null,16)(33,"button",17),i.NdJ("click",function(){return o.fadeNode(o.node)}),i._uU(34," Fade This "),i.qZA(),i.TgZ(35,"button",18),i.NdJ("click",function(){return o.fadeInverseNodes(o.node)}),i._uU(36," Fade Everything Else "),i.qZA()(),i.TgZ(37,"mat-menu",null,19),i.YNc(39,xT,2,0,"button",20),i.YNc(40,vT,2,0,"button",21),i._UZ(41,"mat-divider"),i.TgZ(42,"button",22),i.NdJ("click",function(){return o.hideInverse(o.node)}),i._uU(43,"Hide Everything Else"),i.qZA()(),i.TgZ(44,"mat-menu",null,23),i.YNc(46,CT,2,0,"button",24),i.YNc(47,wT,2,0,"button",25),i._UZ(48,"mat-divider"),i.TgZ(49,"button",26),i.NdJ("click",function(){return o.makeEverythingElseUnpickale(o.node)}),i._uU(50," Make Everything Else Unselectable "),i.qZA()(),i.TgZ(51,"mat-menu",null,27)(53,"button",28),i.NdJ("click",function(){return o.copy(o.shortId)}),i._uU(54," Copy Short ID "),i.qZA(),i.TgZ(55,"button",29),i.NdJ("click",function(){return o.copy(o.node.id)}),i._uU(56," Copy Full ID "),i.qZA(),i._UZ(57,"mat-divider"),i.TgZ(58,"button",30),i.NdJ("click",function(){return o.copy(o.node.label)}),i._uU(59," Copy Display Name "),i.qZA()(),i.BQk()),2&e){const s=i.MAs(7),r=i.MAs(32);i.xp6(1),i.Q6J("buttonTheme",o.theme)("matMenuTriggerFor",s),i.xp6(4),i.hij("",o.node.label," menu"),i.xp6(1),i.Q6J("overlapTrigger",!0),i.xp6(2),i.Q6J("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(2),i.hij(" ",o.node.boolState.shown?"Hide":"Show"," "),i.xp6(4),i.Q6J("matMenuTriggerFor",r),i.xp6(2),i.Q6J("appFlagApplication",o.application.All)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit"),i.xp6(4),i.Q6J("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(1),i.Q6J("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(1),i.Q6J("appFlagApplication",o.application.Studio)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(1),i.Q6J("appFlagApplication",o.application.Loft)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(1),i.Q6J("appFlagApplication",o.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),i.xp6(15),i.Q6J("ngIf",!o.node.boolState.shown),i.xp6(1),i.Q6J("ngIf",o.node.boolState.shown),i.xp6(6),i.Q6J("ngIf",o.node.boolState.pickable),i.xp6(1),i.Q6J("ngIf",!o.node.boolState.pickable)}},dependencies:[f.O5,ql,jt.VK,jt.OP,jt.p6,Ya.d,Dn,lt],changeDetection:0}),t})(),ST=(()=>{class t{constructor(e){this.store=e}ngOnInit(){}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger.openMenu()}onNodeActionsClosed(){this.store.dispatch(new _a(null,null))}getNodeActionsStyles(){return{"left.px":this.hit?this.hit.canvasPos.x:0,"top.px":this.hit?this.hit.canvasPos.y:0}}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-contextmenu"]],viewQuery:function(e,o){if(1&e&&i.Gf(ag,7),2&e){let s;i.iGM(s=i.CRH())&&(o.nodeActionsComponent=s.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"ngStyle","node","nodeActionsClosed"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"app-node-actions",1),i.NdJ("nodeActionsClosed",function(){return o.onNodeActionsClosed()}),i.qZA()()),2&e&&(i.xp6(1),i.Q6J("ngStyle",o.getNodeActionsStyles())("node",o.node))},dependencies:[f.PC,ag],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]}),t})();var Zt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Bt=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const PT=["engine"];function kT(t,n){1&t&&i._UZ(0,"div",7)}function OT(t,n){if(1&t&&i._UZ(0,"app-engine-contextmenu",8),2&t){const e=i.oxw();i.Q6J("node",e.contextmenuNode)("hit",e.contextmenuHit)}}function TT(t,n){1&t&&i._UZ(0,"div",9)}function MT(t,n){1&t&&i._UZ(0,"app-engine-progress",10)}function IT(t,n){1&t&&(i.ynx(0),i._UZ(1,"app-engine-camera-position"),i.BQk())}var No=(()=>(function(t){t[t.Pan=.4]="Pan",t[t.PanSlow=.04]="PanSlow",t[t.Zoom=5]="Zoom",t[t.ZoomSlow=1]="ZoomSlow",t[t.Rotate=.3]="Rotate",t[t.RotateSlow=.03]="RotateSlow"}(No||(No={})),No))(),Vi=(()=>(function(t){t[t.Rotate=6]="Rotate",t[t.Pan=1.75]="Pan",t[t.Zoom=2.5]="Zoom"}(Vi||(Vi={})),Vi))(),ln=(()=>(function(t){t[t.Zoom=-6]="Zoom",t[t.TrackZoom=.5]="TrackZoom",t[t.Pan=1.25]="Pan",t[t.Rotate=1.5]="Rotate",t[t.Friction=.85]="Friction",t[t.ZoomFriction=.85]="ZoomFriction",t[t.FrictionThreshold=.002]="FrictionThreshold"}(ln||(ln={})),ln))(),so=(()=>(function(t){t.Hide="engine--cursor-hide",t.Label="engine--cursor-label",t.Paint="engine--cursor-paint",t.Eyedropper="engine--cursor-eyedropper",t.Crosshair="engine--cursor-crosshair",t.Default=""}(so||(so={})),so))(),$l=(()=>(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.LeftAndRight=4]="LeftAndRight"}($l||($l={})),$l))();const f_=1e3/60;class vt{constructor(n,e,o,s,r,a,c,p,d,u,g,h,y,k,B,K,V){this.actions=n,this.animationService=e,this.cameraService=o,this.changeDetecton=s,this.engineService=r,this.sceneService=a,this.markdownService=c,this.mediaService=p,this.paintService=d,this.renderer=u,this.storageService=g,this.store=h,this.applicationEventService=y,this.visibilityLayersService=k,this.particleSystemsService=B,this.engineRendererService=K,this.clippingPlanesService=V,this.VERSION=xe.VERSION,this.flyCamera=!0,this.visible=!1,this.application=mt,this.cursorClass=so.Default,this.chapterReady=!1,this.showDebug=se.application===mt.Loft||this.storageService.getLocalItem(fn.CameraDebug),this.ngUnsubscribe=new X.x,this.display=!1,this.engineVisible=!0,this.background=new Hi.X(null),this.ctrlPressed=!1,this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,this.lastProgress=0,this.inputEnabled=!0,se.application===mt.Loft&&A.e(357).then(A.t.bind(A,9357,23)).then(F=>{window.pako=F}),se.deploy===pn.Production&&(se.application===mt.Studio||se.application===mt.Viewer)||console.table({Commit:xe.COMMIT,Time:new Date(xe.TIMESTAMP).toLocaleString(),Version:xe.VERSION})}wheel(n){const e=this.store.selectSnapshot(M.getScrollMode),o=n.ctrlKey;e===Xi.DoNotCaptureShowMessage&&!o&&this.store.dispatch(new Jh(!0)),(e===Xi.Capture||o)&&(n.preventDefault(),this.handleWheel(n))}contextmenu(n){this.handleContextMenu(n)}mouseout(){this.handleMouseOut()}convertToLeafStateMap(n,e){const o={};return Object.entries(e).forEach(([s,r])=>{o[s]={},o[s][n]=r}),o}ngOnInit(){this.particleStateListener=new Gk(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initChapterAudio(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.engineService.destroyEngine(),this.changeDetecton.detach(),this.particleStateListener.destroy(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const n=this.store.selectSnapshot(M.getWebGLContextName);this.engineService.initEngine(n);const e=this.engineElement.nativeElement,o=this.engineRendererService.getCanvas();o.style.zIndex="1",o.dataset.test="engineCanvas",e.prepend(o)}bindEngineEvents(){this.engineService.getEvent(pe.Loaded).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Qp(!0))}),this.engineService.getEvent(pe.TimelineChapterActivated).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(me.LabelsChapterInfo,this.store.selectSnapshot(te.getChapterLabels))}),(0,Li.T)(this.engineService.getEvent(pe.TimelinePlayed),this.engineService.getEvent(pe.TimelinePaused)).pipe((0,w.R)(this.ngUnsubscribe),(0,$.h)(()=>null!=this.store.selectSnapshot(_.getSelectedChapterId)),(0,cn.b)(50),(0,J.U)(()=>this.animationService.isPlaying())).subscribe(n=>{this.store.dispatch(new Gp(n))}),(0,_m.R)().pipe((0,$.h)(()=>this.visible&&!(0,m.isNil)(this.engineService.engine?.story)),(0,w.R)(this.ngUnsubscribe)).subscribe(({timestamp:n})=>{this.inputEnabled&&this.handleMouseInputEngineTick(n),this.handleCameraTick(n),this.deltaTime=window.performance.now()}),this.engineService.getEvent(pe.TweenVisibilityUpdate).pipe((0,$n.x)((n,e)=>JSON.stringify(n)===JSON.stringify(e)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=Object.keys(n).filter(s=>!0===n[s]),o=Object.keys(n).filter(s=>!1===n[s]);e.length>0&&this.store.dispatch(new rn(!0,e,void 0,!1,!0)),o.length>0&&this.store.dispatch(new rn(!1,o,void 0,!1,!0))}),this.engineService.getEvent(pe.SceneObjectRenderable).pipe((0,$k.e)(1e3),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{if(n.length){const e={};n.forEach(o=>{e[o.objectId]={renderable:!0}}),this.store.dispatch(new Vp(e))}}),this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{if(1!==n&&Math.floor(100*n)===Math.floor(100*this.lastProgress))return;this.lastProgress=n;const e=this.store.selectSnapshot(we.getLoadChapters).length,r=1/e,p=n*r+(e-Math.max(this.store.selectSnapshot(we.getLoadChaptersRemaining).length,1))*r;this.progress=p.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new Gd(p,n))}),this.engineService.getEvent(pe.CameraUpdated).pipe((0,$.h)(()=>!this.cameraAnimating),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(pe.CameraRested).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,l.xt)(pr),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,$.h)(n=>null!=n),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.repositionEngine(n)}),this.store.select(M.getXrayModeEnabled).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.store.selectSnapshot(Se.getCheckedNodes),o=this.store.selectSnapshot(Se.getNodes),s=this.store.selectSnapshot(M.getViewGraph);!1===n?(Object.keys(o||[]).forEach(r=>{this.paintService.paint(s,r,o[r].paint)}),e.forEach(r=>this.paintService.highlight(s,r.objectId,!0))):(this.paintService.paintAll(s,Object.keys(o),es),this.paintService.paintAll(s,e.map(r=>r.objectId),br))}),this.actions.pipe((0,l.xt)(Wh),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.display=n,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.engineVisible=n,this.changeDetecton.markForCheck()}),this.visibilityLayersService.initObservables(),this.contextmenu$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.contextmenuNode=n.node,this.contextmenuHit=n.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,$.h)(n=>!(0,m.isNil)(n)),(0,Ao.G)(),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{const o=this.store.selectSnapshot(_.getSelectedChapterId);if(this.store.selectSnapshot(_.getSelectedChapterReadyState).model){const a=e.id;if(n.id===a&&o===a)return;this.animationService.setChapter(a).then(()=>{this.store.dispatch(new Bc(a)),Hu(this.store,this.engineService),this.store.dispatch(new Ac(void 0))})}}),(0,bt.a)([this.clippingPlanes$,this.readyState$]).pipe((0,$.h)(([n,e])=>!(0,m.isNil)(n)&&!0===e?.model),(0,$n.x)(m.isEqual),(0,cn.b)(0),(0,w.R)(this.ngUnsubscribe)).subscribe(([n])=>{this.clippingPlanesService.setClippingPlanes(n)}),(0,bt.a)([this.selectedChapterId$,this.readyState$,this.autoplay$]).pipe((0,$.h)(([n,e,o])=>!(0,m.isNil)(n)&&!(0,m.isNil)(e)&&!(0,m.isNil)(o)),(0,w.R)(this.ngUnsubscribe)).subscribe(([,n,e])=>{const o=(0,m.get)(n,"animation",!1),s=this.store.selectSnapshot(_.getSelectedChapter),r=(0,m.get)(s,"ui.play.autoplay",!0),a=o&&e&&r;a&&(this.store.dispatch(new Cc),this.store.dispatch(new _o(a)))})}bindCameraEvents(){this.actions.pipe((0,l.xt)(Zn),(0,$.h)(n=>!(0,m.isNil)(n.camera)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{(n.animate?this.flyToCamera(n.camera,n.animationDuration):this.jumpToCamera(n.camera)).then(()=>{this.store.dispatch(new ad),n.rotationCenter&&this.cameraService.setCameraRotationCenter(n.rotationCenter)})}),this.actions.pipe((0,l.xt)(mm),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.cameraService.panCameraStatic(n.x,n.y,n.z)}),this.actions.pipe((0,l.xt)(ym),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.cameraService.rotateCameraStatic(n.x,n.y)}),this.actions.pipe((0,l.xt)(ld),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.cameraService.setAbsoluteZoom(n.value)}),this.actions.pipe((0,l.xt)(Wi),(0,$.h)(n=>!!n.objectId),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{(n.animate?this.flyToObject(n.objectId,n.animationDuration):this.jumpToObject(n.objectId)).then(()=>{this.store.dispatch(new ad)})})}bindToolEvents(){this.activeTool$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{switch(Object.values(so).forEach(e=>{e&&this.renderer.removeClass(this.engineElement.nativeElement,e)}),n){case Ve.Hide:this.renderer.addClass(this.engineElement.nativeElement,so.Hide);break;case Ve.Label:this.renderer.addClass(this.engineElement.nativeElement,so.Label);break;case Ve.Paint:this.renderer.addClass(this.engineElement.nativeElement,so.Paint);break;case Ve.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,so.Eyedropper);break;case Ve.Quiz:this.renderer.addClass(this.engineElement.nativeElement,so.Crosshair)}})}bindMouseEvents(){this.mouseMove$=(0,Dt.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.handleMousePan(n)}),this.mouseMove$.pipe((0,qy.p)(10),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.handleMouseHover(n)}),this.mouseLeave$=(0,Dt.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,qy.p)(10),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(n){return(0,Dt.R)(window,n).pipe((0,$.h)(e=>(0,m.isEmpty)(document.querySelectorAll(".cdk-overlay-pane, div.tour"))))}bindKeyEvents(){const n=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((s,r)=>(s[r]=!1,s),{}),e=new Hi.X(n);let o;this.bindWindowKeyEvent("keydown").pipe((0,$.h)(s=>!(s.repeat||s.metaKey||s.ctrlKey)),(0,$.h)(s=>{const a=s.target.nodeName.toLowerCase();return!(["input","textarea","select","option"].indexOf(a)>=0)}),(0,w.R)(this.ngUnsubscribe)).subscribe(s=>{e.next({...e.value,[s.key.toLowerCase()]:!0,shiftKey:s.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,$.h)(s=>!!s.key),(0,w.R)(this.ngUnsubscribe)).subscribe(s=>{1===Object.values(o).filter(a=>!0===a).length?(this.applyMotion(o,!0),e.next({...e.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1===o.shiftKey})):e.next({...e.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1})}),e.pipe((0,$.h)(()=>this.inputEnabled),(0,w.R)(this.ngUnsubscribe)).subscribe(s=>{o=s,!1===s.hasMomentum&&this.applyMotion(s,!1)}),this.bindWindowKeyEvent("keydown").pipe((0,$.h)(s=>"Control"===s.key),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.ctrlPressed=!0}),this.bindWindowKeyEvent("keyup").pipe((0,$.h)(s=>"Control"===s.key),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.ctrlPressed=!1})}applyMotion(n,e){const o=new bd,s=n.shiftKey?No.ZoomSlow:No.Zoom,r=n.shiftKey?No.PanSlow:No.Pan,a=n.shiftKey?No.RotateSlow:No.Rotate;o.zoom+=n.c||n["-"]||n._?s:0,o.zoom-=n.e||n["="]||n["+"]?s:0,o.panX-=n.d?r:0,o.panX+=n.a?r:0,o.panY+=n.w?r:0,o.panY-=n.s?r:0,o.rotateX-=n.arrowright?a:0,o.rotateX+=n.arrowleft?a:0,o.rotateY+=n.arrowup?a:0,o.rotateY-=n.arrowdown?a:0,o.applyFriction=e,this.store.dispatch(new hr(o))}initChangeListener(){this.store.select(Se.getPatches).pipe((0,$.h)(n=>n.length>0),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=n.reduce((p,d)=>{const u=d.path[d.path.length-1];return void 0!==p[u]&&p[u].push(d),p},{shown:[],checked:[],paint:[],pickable:[]}),o=p=>e[p].reduce((d,u)=>(d[u.path[2]]=u.value,d),{}),s=o("checked"),r=o("shown"),a=o("paint"),c=o("pickable");if(!(0,m.isEmpty)(r)){const p=Object.keys(r),d=this.sceneService.getObjectsById(p),u=p.reduce((k,B)=>(this.sceneService.isLeaf(d[B])&&(k[B]=r[B]),k),{});this.engineService.fireEvent(pe.SceneObjectsShown,{enabledObjectsUpdate:u});const g=this.store.selectSnapshot(Se.getNodes),h=Object.values(g).reduce((k,B)=>(k[B.objectId]=B.shown,k),{});this.sceneService.setNodesVisible(h);const y=this.convertToLeafStateMap("shown",h);this.store.dispatch(new Bp(y,g))}if(!(0,m.isEmpty)(s)){this.engineService.fireEvent(pe.SceneObjectsSelected,{selectedObjectsUpdate:s});const p=this.store.selectSnapshot(M.getViewGraph),d=this.store.selectSnapshot(M.getXrayModeEnabled)?(u,g)=>this.paintService.paint(p,u,!0===g?br:es):(u,g)=>this.paintService.highlight(p,u,g);Object.entries(s).forEach(([u,g])=>{d(u,g)})}if(!(0,m.isEmpty)(a))for(const[p,d]of Object.entries(a))this.paintService.colorObject(p,Is(d));if(!(0,m.isEmpty)(c)){const p=this.store.selectSnapshot(Se.getNodes),d=Object.values(p).reduce((u,g)=>(u[g.objectId]=g.pickable,u),{});this.sceneService.setNodesPickable(d),this.store.dispatch(new qp(this.convertToLeafStateMap("pickable",d),p))}})}initChapterAudio(){(0,bt.a)([this.selectedChapterId$,this.playAudio$,this.playAudioType$]).pipe((0,cn.b)(0),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{this.playAudio(n&&e)}),(0,bt.a)([this.selectedChapterId$,this.playAudioType$,this.mediaService.getAudioEvents()]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o])=>{const{id:s,event:r}=o;this.getChapterAudioId(n,e)===s&&"end"===r&&this.store.dispatch(new ws(!1))})}initBackgroundListener(){(0,bt.a)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",function D1(t){const n=t.colors,e=`rgba(${n[0]},${n[1]}, ${n[2]}, ${n[3]}) ${t.colorStops[0]}%`,o=`rgba(${n[4]},${n[5]}, ${n[6]}, ${n[7]}) ${t.colorStops[1]}%`;return"radial"===t.gradientType?`radial-gradient(circle, ${e}, ${o})`:`linear-gradient(180deg, ${e}, ${o})`}(n)),this.isBackgroundCheckered(n)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",e?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",o?1:0)})}initPlaybackSpeedListener(){this.store.select(M.getPlaybackSpeed).pipe((0,$.h)(()=>this.store.selectSnapshot(_.getSelectedChapterAnimationReady)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.animationService.setPlaybackRate(n)})}repositionEngine(n){this.renderer.setStyle(this.engineElement.nativeElement,"left",`${n.left}px`),this.renderer.setStyle(this.engineElement.nativeElement,"top",`${n.top}px`),this.renderer.setStyle(this.engineElement.nativeElement,"width",`${n.width}px`),this.renderer.setStyle(this.engineElement.nativeElement,"height",`${n.height}px`),this.renderer.setStyle(this.engineElement.nativeElement,"zIndex",`${n.visibility}`),this.renderer.setStyle(this.engineElement.nativeElement,"visibility",n.visibility===Ss.Shown?"visible":"hidden"),this.visible=n.visibility===Ss.Shown}bindHumanInteractions(){this.hammerManager=new un.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new un.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new un.Tap({event:"singletap"})),this.hammerManager.add(new un.Pan({event:"pan",pointers:0})),this.hammerManager.add(new un.Pinch({event:"pinch"})),this.hammerManager.add(new un.Press({time:500})),this.hammerManager.on("singletap",o=>{this.handleTap(o)}),this.hammerManager.on("doubletap",o=>{this.handleDoubleTap(o)}),this.hammerManager.on("press",o=>{o.preventDefault(),o.srcEvent.stopImmediatePropagation(),this.handlePress(o)}),this.hammerManager.on("pan",o=>{o.preventDefault(),this.handlePan(o)}),this.hammerManager.on("panend",o=>{this.handlePanEnd(o)}),this.hammerManager.on("pinchend",o=>{this.handlePinchEnd(o)});let n=0,e=0;this.hammerManager.on("pinchstart",o=>{n=o.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",o=>{if(this.pinchTicks>0)return;const s=Math.abs(o.deltaX)>60||Math.abs(o.deltaY)>60,r=o.scale>1.25||o.scale<.75;this.pinchMode?("pan"===this.pinchMode&&r&&!s&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&s&&!r&&(this.pinchMode="pan")):this.pinchMode=r?"pinch":"pan";const a=o.scale-n;n=o.scale;const c=e;e=0===a?0:a>0?1:-1,this.cameraService.setCameraPan(o.velocityX*ln.Pan,o.velocityY*ln.Pan),e+c!==0&&this.cameraService.setRelativeZoom(a*ln.Zoom)})}handleMouseHover(n){if(n.buttons!==$l.None)return;const{offsetX:e,offsetY:o}=n,s=this.pickAtCanvasPosition(e,o,!1);if(s.objectId){const r=this.store.selectSnapshot(M.getViewGraph),a=this.sceneService.getViewNode(r,s.objectId),c=this.store.selectSnapshot(M.getHoveredNode);(!c||c.id!==a.id)&&this.store.dispatch(new gr(a,s))}else null!=this.store.selectSnapshot(M.getHoveredNode)&&this.store.dispatch(new gr(null))}handleMouseLeave(){this.store.dispatch(new gr(null))}handleMousePan(n){if(2===n.buttons||4===n.buttons){let{movementX:e,movementY:o}=n;e/=16,o/=16,this.cameraService.setCameraPan(e,o)}}handleMouseOut(){this.store.dispatch(new gr(null))}handleWheel(n){let e=0;0===n.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(n.deltaY)<10?"trackpad":"wheel"),e="trackpad"===this.scrollType?n.deltaY*ln.TrackZoom:Math.sign(n.deltaY)*Vi.Zoom):(this.scrollType="wheel",e=n.deltaY*Vi.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(e)>40&&(e=40*Math.sign(e)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(e):this.zoomWithVelocity(e)}zoomWithVelocity(n){this.cameraService.setCameraZoom(n),requestAnimationFrame(()=>{n*=.85,Math.abs(n)>1&&this.zoomWithVelocity(n)})}handleContextMenu(n){n.preventDefault();const{offsetX:e,offsetY:o}=n,s=this.pickAtCanvasPosition(e,o),r=this.getNodeFromHit(s);this.store.dispatch(new _a(r,s))}handlePanEnd(n){const e=this.store.selectSnapshot(Ne.getCameraMotion);if(this.pinchTicks>0||e.panX===n.velocityX&&e.panY===n.velocityY)return;const o=this.store.selectSnapshot(Ne.getPanMode);n.srcEvent.shiftKey||"pan"===o?(e.panX=n.velocityX*ln.Pan,e.panY=n.velocityY*ln.Pan):(e.rotateX=n.velocityX*ln.Rotate,e.rotateY=n.velocityY*ln.Rotate),e.applyFriction=!0,this.store.dispatch(new hr(e))}handlePinchEnd(n){const e=this.store.selectSnapshot(Ne.getCameraMotion);if("pan"===this.pinchMode)e.panX=n.velocityX*ln.Pan,e.panY=n.velocityY*ln.Pan;else{const o=n.velocity>0?1:-1;e.zoom=Math.sqrt(n.velocityX*n.velocityX+n.velocityY*n.velocityY)*-o*ln.Zoom}e.applyFriction=!0,this.store.dispatch(new hr(e)),this.pinchTicks=10}handleTap(n){const{offsetX:e,offsetY:o}=this.getOffset(n),s=this.pickAtCanvasPosition(e,o),r=this.getNodeFromHit(s);this.store.dispatch(new vc(r,n,s))}handleDoubleTap(n){const{offsetX:e,offsetY:o}=this.getOffset(n),s=this.pickAtCanvasPosition(e,o),r=this.getNodeFromHit(s);r&&this.store.dispatch(new Wi(r.id))}handlePress(n){const{offsetX:e,offsetY:o}=this.getOffset(n),s=this.pickAtCanvasPosition(e,o),r=this.getNodeFromHit(s);r&&this.store.dispatch(new Wi(r.id))}handlePan(n){if(this.pinchTicks>0)return;const e=this.store.selectSnapshot(Ne.getPanMode),{velocityX:o,velocityY:s}=n;n.srcEvent.shiftKey||"pan"===e?this.cameraService.setCameraPan(o*ln.Pan,s*ln.Pan):this.cameraService.setCameraRotation(o*ln.Rotate,s*ln.Rotate)}handleMouseInputEngineTick(n){const e=this.cameraService.tickCameraRotation(),o=this.cameraService.tickCameraPan(),s=this.cameraService.tickCameraZoom(),r=Math.min(15,(window.performance.now()-this.deltaTime)/f_);if((e.vx||e.vy)&&this.cameraService.rotateCameraStatic(0!==e.vx?r*e.vx*Vi.Rotate:0,0!==e.vy?r*e.vy*Vi.Rotate:0),o.x||o.y){const a=this.cameraService.getLookDistance(),c=Math.max(a/80,.01);this.cameraService.panCameraStatic(r*o.x*c*Vi.Pan,r*o.y*c*Vi.Pan,r*o.z*c*Vi.Pan)}0!==s&&this.cameraService.setRelativeZoom(r*s*Vi.Zoom)}handleCameraTick(n){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const e=this.store.selectSnapshot(Ne.getCameraMotion);this.cameraService.setCameraPan(e.panX,e.panY),this.cameraService.setCameraRotation(e.rotateX,e.rotateY),this.cameraService.setCameraZoom(e.zoom),this.cameraService.tickCamera(n)}getFriction(n){if(0===n)return 0;const e=(window.performance.now()-this.deltaTime)/f_;let s=n*Math.max(0,ln.Friction+.1*(1-e));return Math.abs(s)<ln.FrictionThreshold&&(s=0),s}applyFriction(){const n=this.store.selectSnapshot(Ne.getCameraMotion);!0===n.applyFriction&&(n.rotateX=this.getFriction(n.rotateX),n.rotateY=this.getFriction(n.rotateY),n.panX=this.getFriction(n.panX),n.panY=this.getFriction(n.panY),n.zoom=this.getFriction(n.zoom),0===n.rotateX&&0===n.rotateY&&0===n.panX&&0===n.panY&&0===n.zoom&&(n.applyFriction=!1),this.store.dispatch(new hr(n)))}flyToObject(n,e){return this.cameraService.flyToObject(n,e)}flyToCamera(n,e){return this.cameraService.flyToCamera(n,e)}jumpToObject(n){return this.cameraService.jumpToObject(n)}jumpToCamera(n){return this.cameraService.jumpToCamera(n)}getNodeFromHit(n){let e;if(n.objectId){const o=this.store.selectSnapshot(M.getViewGraph);e=this.sceneService.getViewNode(o,n.objectId)}return e}pickAtCanvasPosition(n,e,o=!0){return this.engineRendererService.pick(n,e,o)}getOffset(n){let e=0,o=0;n.center?(e=n.center.x,o=n.center.y):(e=n.clientX,o=n.clientY);const r=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:e-r.left,offsetY:o-r.top}}playAudio(n){var e=this;return(0,Pn.Z)(function*(){e.store.selectSnapshot(_.getSelectedChapterId)?e.getChapterAudioConfig(n).then(({sources:s,audioId:r})=>{e.mediaService.stopAllOtherAudio(r);let a=e.mediaService.getAudioPlayer(r);(0,m.isNil)(a)&&s.length>0&&(a=e.mediaService.addAudioPlayer(r,...s)),a&&(n?a.play():a.pause())}):e.mediaService.stopAllAudio()})()}playChapterFromStart(){this.store.selectSnapshot(_.getSelectedChapter);const e=this.store.selectSnapshot(M.getPlayAudio);this.playAudio(e),this.store.dispatch(new Cc),this.store.dispatch(new _o(!0))}isTransparentBackground(n){return!!n&&Hc(this.background.getValue())}isBackgroundCheckered(n){return se.application!==mt.Viewer&&this.isTransparentBackground(n)}getChapterAudioConfig(n){var e=this;return(0,Pn.Z)(function*(){return new Promise(o=>{const s=e.store.selectSnapshot(_.getSelectedChapter),r=e.store.selectSnapshot(M.getPlayAudioType),a=e.getChapterAudioId(s?.id,r);if(r===Nn.File){const p=e.store.selectSnapshot(_.getSelectedChapterAudio)?.fullUrl??"",d=p?[e.mediaService.getAudioSrc(p)]:[];o({audioId:a,sources:d,type:r})}else if(r===Nn.TTS&&n){const p=Xn.getPlainTextFromMarkdown(e.renderer,e.markdownService,s?.description??"",!0),d=e.store.selectSnapshot(we.getStoryLanguage),u=ya.find(g=>g.lang===d)??ui;Yy(p).then(g=>{const y=Jy(p,g||u.id);o({audioId:a,sources:y,type:r})})}else o({audioId:a,sources:[],type:r})})})()}getChapterAudioId(n,e){return`${n}-chapter-audio-${e}`}}vt.\u0275fac=function(n){return new(n||vt)(i.Y36(l.eX),i.Y36(Un),i.Y36(Bn),i.Y36(i.sBO),i.Y36(et),i.Y36(Ut),i.Y36(En.Zy),i.Y36(Dl),i.Y36(wr),i.Y36(i.Qsj),i.Y36(dn),i.Y36(l.yh),i.Y36(Lo),i.Y36(ai),i.Y36(uO),i.Y36(Po),i.Y36(tb))},vt.\u0275cmp=i.Xpm({type:vt,selectors:[["app-engine"]],viewQuery:function(n,e){if(1&n&&i.Gf(PT,7),2&n){let o;i.iGM(o=i.CRH())&&(e.engineElement=o.first)}},hostBindings:function(n,e){1&n&&i.NdJ("wheel",function(s){return e.wheel(s)})("contextmenu",function(s){return e.contextmenu(s)})("mouseout",function(s){return e.mouseout(s)})},inputs:{inputEnabled:"inputEnabled"},decls:13,vars:16,consts:[["id","container","data-test","engine","role","complementary",1,"engine"],["engine",""],["class","engine__watermark","role","img","aria-label","watermark","data-test","engineWatermark",4,"ngIf"],[3,"node","hit",4,"ngIf"],["data-test","engineInputBlocker","class","engine__input-blocking",4,"ngIf"],["data-test","engineProgressBar",4,"ngIf"],[4,"ngIf"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0,1),i.ALo(2,"async"),i.YNc(3,kT,1,0,"div",2),i.ALo(4,"async"),i._UZ(5,"app-labels"),i.YNc(6,OT,1,2,"app-engine-contextmenu",3),i.YNc(7,TT,1,0,"div",4),i.YNc(8,MT,1,0,"app-engine-progress",5),i.ALo(9,"async"),i._UZ(10,"app-engine-scroll")(11,"app-engine-fade"),i.YNc(12,IT,2,0,"ng-container",6),i.qZA()),2&n){const o=i.MAs(1);i.uIk("data-progress",e.progress)("data-chapter-ready",e.chapterReady)("data-camera-animating",e.cameraAnimating)("data-story-id",i.lcZ(2,10,e.storyId$))("data-engine-version",e.VERSION),i.xp6(3),i.Q6J("ngIf",i.lcZ(4,12,e.watermarkEnabled$)),i.xp6(3),i.Q6J("ngIf",e.contextmenuNode),i.xp6(1),i.Q6J("ngIf",!e.inputEnabled),i.xp6(1),i.Q6J("ngIf",i.lcZ(9,14,e.showProgressBar$)),i.xp6(4),i.Q6J("ngIf",e.showDebug&&o)}},dependencies:[f.O5,en,iT,sT,pT,dT,ST,f.Ov],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.png) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.png) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.png) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea),linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea)}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0}),Zt([(0,l.Ph)(M.getReady),Bt("design:type",b.y)],vt.prototype,"ready$",void 0),Zt([(0,l.Ph)(M.getViewGraph),Bt("design:type",b.y)],vt.prototype,"viewGraph$",void 0),Zt([(0,l.Ph)(M.getEnginePosition),Bt("design:type",b.y)],vt.prototype,"enginePosition$",void 0),Zt([(0,l.Ph)(M.getHoveredNode),Bt("design:type",b.y)],vt.prototype,"hoveredNode$",void 0),Zt([(0,l.Ph)(M.getChapter),Bt("design:type",b.y)],vt.prototype,"chapter$",void 0),Zt([(0,l.Ph)(Se.getCheckedNodes),Bt("design:type",b.y)],vt.prototype,"checkedNodes$",void 0),Zt([(0,l.Ph)(M.getActiveTool),Bt("design:type",b.y)],vt.prototype,"activeTool$",void 0),Zt([(0,l.Ph)(M.getAnimationPlaying),Bt("design:type",b.y)],vt.prototype,"animationPlaying$",void 0),Zt([(0,l.Ph)(M.getAutoplay),Bt("design:type",b.y)],vt.prototype,"autoplay$",void 0),Zt([(0,l.Ph)(M.getPlayAudio),Bt("design:type",b.y)],vt.prototype,"playAudio$",void 0),Zt([(0,l.Ph)(M.getPlayAudioType),Bt("design:type",b.y)],vt.prototype,"playAudioType$",void 0),Zt([(0,l.Ph)(M.getDisplay),Bt("design:type",b.y)],vt.prototype,"engineDisplay$",void 0),Zt([(0,l.Ph)(M.getVisible),Bt("design:type",b.y)],vt.prototype,"engineVisible$",void 0),Zt([(0,l.Ph)(M.getShowProgressBar),Bt("design:type",b.y)],vt.prototype,"showProgressBar$",void 0),Zt([(0,l.Ph)(M.getContextmenu),Bt("design:type",b.y)],vt.prototype,"contextmenu$",void 0),Zt([(0,l.Ph)(we.getStoryId),Bt("design:type",b.y)],vt.prototype,"storyId$",void 0),Zt([(0,l.Ph)(_.getSelectedChapter),Bt("design:type",b.y)],vt.prototype,"selectedChapter$",void 0),Zt([(0,l.Ph)(_.getSelectedChapterId),Bt("design:type",b.y)],vt.prototype,"selectedChapterId$",void 0),Zt([(0,l.Ph)(_.getSelectedChapterReadyState),Bt("design:type",b.y)],vt.prototype,"readyState$",void 0),Zt([(0,l.Ph)(_.getSelectedChapterClippingPlanes),Bt("design:type",b.y)],vt.prototype,"clippingPlanes$",void 0),Zt([(0,l.Ph)(Ne.getCameraMotion),Bt("design:type",b.y)],vt.prototype,"cameraMotion$",void 0),Zt([(0,l.Ph)(_.getSelectedChapterBackground),Bt("design:type",b.y)],vt.prototype,"background$",void 0),Zt([(0,l.Ph)(M.getWatermarkEnabled),Bt("design:type",b.y)],vt.prototype,"watermarkEnabled$",void 0);let b_=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-pillbox-divider"]],decls:1,vars:0,consts:[[1,"pillbox-divider"]],template:function(e,o){1&e&&i._UZ(0,"div",0)},styles:[".pillbox-divider{-webkit-user-select:none;user-select:none;border-right:1px solid rgba(0,0,0,.1);height:18px;margin:0 8px}\n"],encapsulation:2,changeDetection:0}),t})();function AT(t,n){if(1&t){const e=i.EpF();i.ynx(0),i._UZ(1,"app-pillbox-divider"),i.TgZ(2,"button",2),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i.qZA(),i.BQk()}if(2&t){const e=i.oxw();i.xp6(2),i.Q6J("matTooltip","Close "+e.name),i.uIk("aria-label","Close "+e.name)}}const LT=function(t,n,e){return{"pillbox--padding-dense":t,"pillbox--padding-none":n,"pillbox--vertical":e}},FT=["*"];let Wa=(()=>{class t{constructor(){this.canExit=!1,this.padding="normal",this.orientation="horizontal",this.name="",this.eventCategory="",this.exit=new i.vpe}ngOnInit(){}handleExitClick(){this.exit.emit()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-pillbox"]],inputs:{canExit:"canExit",padding:"padding",orientation:"orientation",name:"name",eventCategory:"eventCategory"},outputs:{exit:"exit"},ngContentSelectors:FT,decls:3,vars:6,consts:[[1,"pillbox",3,"ngClass"],[4,"ngIf"],["data-test","closePillboxButton","app-pin-button","","buttonType","ghost","icon","times",3,"matTooltip","click"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0),i.Hsn(1),i.YNc(2,AT,3,2,"ng-container",1),i.qZA()),2&e&&(i.Q6J("ngClass",i.kEZ(2,LT,"dense"===o.padding,"none"===o.padding,"vertical"===o.orientation)),i.xp6(2),i.Q6J("ngIf",o.canExit))},dependencies:[f.mk,f.O5,In,Gt.gM,b_],styles:[".pillbox{border-radius:32px;background-color:#ffffffe6;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;color:#131c2a;padding:6px;display:inline-flex;justify-content:center;align-items:center;overflow:hidden;transition:padding .15s}.pillbox--padding-dense{padding:4px}.pillbox--padding-none{padding:0}.pillbox--vertical{flex-direction:column;padding:6px}\n"],encapsulation:2,changeDetection:0}),t})();var y_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},__=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function UT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",8),i.NdJ("touchend",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("out"))})("mouseup",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("out"))})("keyup.enter",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("out"))}),i.qZA()}}function RT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",9),i.NdJ("touchend",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("in"))})("mouseup",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("in"))})("keyup.enter",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.setZoomFixed("in"))}),i.qZA()}}function NT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.returnToChapterCamera())}),i.TgZ(1,"span",11),i._uU(2,"Clicking this button will reset the camera viewing the 3D model"),i.qZA()()}}function ET(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",12),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.togglePan())}),i.ALo(1,"async"),i.ALo(2,"async"),i.ALo(3,"async"),i.TgZ(4,"span",11),i._uU(5,"Clicking this button changes whether the mouse movement rotates or pans the camera"),i.qZA()()}if(2&t){const e=i.oxw(2);i.Q6J("selected","pan"===i.lcZ(1,3,e.panMode$))("matTooltip","pan"===i.lcZ(2,5,e.panMode$)?"Switch to Rotate Mode":"Switch to Pan Mode"),i.uIk("aria-pressed","pan"===i.lcZ(3,7,e.panMode$))}}function DT(t,n){if(1&t&&(i.TgZ(0,"app-pillbox",2)(1,"ul",3)(2,"li"),i.YNc(3,UT,1,0,"button",4),i.qZA(),i.TgZ(4,"li"),i.YNc(5,RT,1,0,"button",5),i.qZA(),i.TgZ(6,"li"),i.YNc(7,NT,3,0,"button",6),i.qZA(),i.TgZ(8,"li"),i.YNc(9,ET,6,9,"button",7),i.qZA()()()),2&t){const e=i.oxw();i.xp6(3),i.Q6J("ngIf",e.showZoom),i.xp6(2),i.Q6J("ngIf",e.showZoom),i.xp6(2),i.Q6J("ngIf",e.showResetPosition),i.xp6(2),i.Q6J("ngIf",e.showPan)}}class Vs{constructor(n,e,o){this.store=n,this.cameraService=e,this.liveAnnouncer=o,this.showNav=!0,this.showZoom=!0,this.showPan=!0,this.showResetPosition=!0,this.viewLayout=x,this.toolEnum=Ve,this.expandNav=!1,this.breakpointEnum=_t,this.padding="none",this.ngUnsubscribe=new X.x}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setZoomFixed(n){this.cameraService.setCameraZoomWithVelocity("in"===n?-8:8),this.liveAnnouncer.announce(`zoom ${n} complete`)}returnToChapterCamera(){const n=this.store.selectSnapshot(_.getSelectedChapter);this.store.dispatch(new Zn(n.camera.location)).subscribe(()=>{this.liveAnnouncer.announce("recenter complete")})}resetChapter(){this.returnToChapterCamera();const n=this.store.selectSnapshot(_.getSelectedChapterId);this.store.dispatch(new Nt.UndoAll(n)),this.store.dispatch(new Rt(!1)),this.store.dispatch(new Oo)}togglePan(){const n="pan"===this.store.selectSnapshot(Ne.getPanMode)?"rotate":"pan";this.store.dispatch(new zc(n))}toggleNav(){this.expandNav=!this.expandNav}}Vs.\u0275fac=function(n){return new(n||Vs)(i.Y36(l.yh),i.Y36(Bn),i.Y36(no.Kd))},Vs.\u0275cmp=i.Xpm({type:Vs,selectors:[["app-engine-camera-bar"]],inputs:{showNav:"showNav",showZoom:"showZoom",showPan:"showPan",showResetPosition:"showResetPosition"},decls:2,vars:1,consts:[["data-test","cameraBar",1,"camera-bar"],["eventCategory","Engine 3D Controls","orientation","vertical",4,"ngIf"],["eventCategory","Engine 3D Controls","orientation","vertical"],["aria-label","Camera Control Buttons",1,"camera-bar__nav"],["app-pin-button","","buttonType","ghost","icon","minus","tabIndex","0","data-test","cameraZoomOut","matTooltip","Zoom Out","matTooltipPosition","left",3,"touchend","mouseup","keyup.enter",4,"ngIf"],["app-pin-button","","buttonType","ghost","icon","plus","tabIndex","0","data-test","cameraZoomIn","matTooltip","Zoom In","matTooltipPosition","left",3,"touchend","mouseup","keyup.enter",4,"ngIf"],["app-pin-button","","icon","location","buttonType","ghost","tabIndex","0","matTooltip","Recenter 3D Model","matTooltipPosition","left","data-test","cameraReset",3,"click",4,"ngIf"],["app-pin-button","","tabIndex","0","icon","arrows-alt","buttonType","ghost","matTooltipPosition","left","data-test","cameraPan",3,"selected","matTooltip","click",4,"ngIf"],["app-pin-button","","buttonType","ghost","icon","minus","tabIndex","0","data-test","cameraZoomOut","matTooltip","Zoom Out","matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["app-pin-button","","buttonType","ghost","icon","plus","tabIndex","0","data-test","cameraZoomIn","matTooltip","Zoom In","matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["app-pin-button","","icon","location","buttonType","ghost","tabIndex","0","matTooltip","Recenter 3D Model","matTooltipPosition","left","data-test","cameraReset",3,"click"],[1,"visually-hidden"],["app-pin-button","","tabIndex","0","icon","arrows-alt","buttonType","ghost","matTooltipPosition","left","data-test","cameraPan",3,"selected","matTooltip","click"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,DT,10,4,"app-pillbox",1),i.qZA()),2&n&&(i.xp6(1),i.Q6J("ngIf",e.showNav))},dependencies:[f.O5,Gt.gM,In,Wa,f.Ov],styles:[":host{position:relative}.camera-bar{display:flex;flex-direction:column;align-items:center}.camera-bar button:not(:first-child){margin-top:4px}.camera-bar__nav{display:flex;flex-direction:column-reverse;overflow:hidden;transition:height .15s ease-in-out;justify-content:space-between}\n"],encapsulation:2,data:{animation:[(0,j.X$)("expand",[(0,j.eR)(":enter",[(0,j.vP)([(0,j.oB)({height:0}),(0,j.jt)("150ms ease-in-out",(0,j.oB)({height:"*"}))])]),(0,j.eR)(":leave",[(0,j.vP)([(0,j.jt)("150ms ease-in-out",(0,j.oB)({height:"0"}))])])]),(0,j.X$)("show",[(0,j.eR)(":enter",[(0,j.vP)([(0,j.oB)({height:"0"}),(0,j.jt)("125ms ease-in-out",(0,j.oB)({height:"*"}))])]),(0,j.eR)(":leave",[(0,j.vP)([(0,j.jt)("125ms 125ms ease-in-out",(0,j.oB)({height:"0"}))])])])]},changeDetection:0}),y_([(0,l.Ph)(Ne.getPanMode),__("design:type",b.y)],Vs.prototype,"panMode$",void 0),y_([(0,l.Ph)(Pt.getBreakpoint),__("design:type",b.y)],Vs.prototype,"breakpoint$",void 0);let jT=(()=>{class t{constructor(e){this.store=e,this.ngUnsubscribe=new X.x}get playText(){return(this.playing?"Pause":"Play")+" Audio"}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleAudioClick(){const e=this.store.selectSnapshot(M.getPlayAudio);this.store.dispatch(new ws(!e))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-engine-audio"]],inputs:{type:"type",playing:"playing"},decls:4,vars:5,consts:[["type","button","data-test","engineAudio",1,"engine-audio",3,"click"],[1,"engine-audio__icon",3,"icon"],[1,"engine-audio__label"]],template:function(e,o){1&e&&(i.TgZ(0,"button",0),i.NdJ("click",function(){return o.handleAudioClick()}),i._UZ(1,"app-icon",1),i.TgZ(2,"span",2),i._uU(3),i.qZA()()),2&e&&(i.uIk("aria-label",o.playText)("data-test-type",o.type)("data-test-playing",o.playing),i.xp6(1),i.Q6J("icon",o.playing?"volume-up":"volume-off"),i.xp6(2),i.Oqu(o.playText))},dependencies:[lt],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.engine-audio[_ngcontent-%COMP%]{border:none;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;color:#fff;border-radius:100px;height:40px;width:40px;padding:16px;display:flex;justify-content:center;align-items:center;transition:width ease-in-out .15s}.engine-audio[_ngcontent-%COMP%]:hover{background:#374a68;cursor:pointer;justify-content:flex-start;width:100%}.engine-audio[_ngcontent-%COMP%]:hover   .engine-audio__label[_ngcontent-%COMP%]{display:block;overflow:auto;flex:1 0 100%;opacity:1}.engine-audio__label[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;flex:0 1 0px;text-align:left;overflow:hidden;transition:flex .15s ease-in-out,opacity .15s ease-out;white-space:nowrap;padding-left:12px;opacity:0;display:none;scrollbar-width:none}.engine-audio__label[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"],changeDetection:0}),t})();var Gl=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Jl=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const QT=["slider"],ZT=["track"],BT=["bar"],VT=["handle"],qT=function(t){return{"view-poc-layers-slider--disabled":t}},$T=function(t){return{"view-poc-layers-slider__handle-touch":t}};class Eo{constructor(n,e,o,s){this.engineService=n,this.renderer=e,this.visibilityLayersService=o,this.changeDetectorRef=s,this.ngUnsubscribe=new X.x,this.currentLayers=[],this.fullOffset=0,this.dragMove=new X.x,this.dragPosition={x:0,y:0},this.currentLayerName="",this.currentOffset=0,this.assetsLoading=!1}ngOnInit(){this.initAssetListener(),this.initLayersObserver(),this.initIndexPositionObserver(),this.initDragMoveObserver()}ngAfterViewInit(){setTimeout(()=>{this.handle.nativeElement.focus()},200),this.fullOffset=this.track.nativeElement.offsetHeight}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initAssetListener(){this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.assetsLoading=n<1,this.changeDetectorRef.markForCheck()})}initLayersObserver(){this.selectedChapterCurrentLayers$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.currentLayers=n})}initIndexPositionObserver(){(0,bt.a)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,$.h)(([n,e,o])=>!(0,m.isNil)(n)&&!(0,m.isNil)(e)&&!(0,m.isNil)(o)),(0,cn.b)(0),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o])=>{this.currentLayerName=o[n].name;const s=this.visibilityLayersService.indexPositionToFraction(n,e);this.currentOffset=Math.round(100*s),this.setSliderBar(s),this.setSliderHandle(s)})}initDragMoveObserver(){this.dragMove.pipe((0,$r.e)(20),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>this.handleAuditedDrag())}handleDragEnded(){const n=this.calculateHandleFraction(),e=this.visibilityLayersService.fractionToIndex(n),o=this.visibilityLayersService.fractionToPosition(n,e);this.visibilityLayersService.recordLayerIndexPosition(e,o)}handleDragMoved(n){this.dragMove.next(n)}handleAuditedDrag(){const n=this.calculateHandleFraction(),e=this.visibilityLayersService.fractionToIndex(n),o=this.visibilityLayersService.fractionToPosition(n,e);this.currentLayerName=this.currentLayers[e].name,this.visibilityLayersService.synchronizeScene(e,o,!1),this.setSliderBar(n)}handleTrackClick(n){const e=n.offsetY/this.fullOffset,o=this.visibilityLayersService.fractionToIndex(e),s=this.visibilityLayersService.fractionToPosition(e,o);this.visibilityLayersService.recordLayerIndexPosition(o,s),this.visibilityLayersService.synchronizeScene(o,s,!1),this.setSliderBar(e)}handleKeyDown(n){switch(n.key){case"Home":this.handleIncriment(-1),n.stopPropagation();break;case"End":this.handleIncriment(1),n.stopPropagation();break;case"PageDown":this.handleIncriment(-.1),n.stopPropagation();break;case"PageUp":this.handleIncriment(.1),n.stopPropagation();break;case"ArrowLeft":case"ArrowDown":this.handleIncriment(-.01),n.stopPropagation();break;case"ArrowRight":case"ArrowUp":this.handleIncriment(.01),n.stopPropagation()}}handleIncriment(n){const e=(0,m.clamp)(this.calculateHandleFraction()+n,0,1),o=this.visibilityLayersService.fractionToIndex(e),s=this.visibilityLayersService.fractionToPosition(e,o);this.visibilityLayersService.recordLayerIndexPosition(o,s)}calculateHandleFraction(){const n=this.slider.nativeElement.getBoundingClientRect();return(this.handle.nativeElement.getBoundingClientRect().top-n.top)/this.fullOffset}setSliderBar(n){this.renderer.setStyle(this.bar.nativeElement,"height",100*n+"%")}setSliderHandle(n){this.dragPosition={y:n*this.fullOffset,x:this.dragPosition.x},this.changeDetectorRef.markForCheck()}}Eo.\u0275fac=function(n){return new(n||Eo)(i.Y36(et),i.Y36(i.Qsj),i.Y36(ai),i.Y36(i.sBO))},Eo.\u0275cmp=i.Xpm({type:Eo,selectors:[["app-view-poc-layers-slider"]],viewQuery:function(n,e){if(1&n&&(i.Gf(QT,7),i.Gf(ZT,7),i.Gf(BT,7),i.Gf(VT,7)),2&n){let o;i.iGM(o=i.CRH())&&(e.slider=o.first),i.iGM(o=i.CRH())&&(e.track=o.first),i.iGM(o=i.CRH())&&(e.bar=o.first),i.iGM(o=i.CRH())&&(e.handle=o.first)}},decls:10,vars:10,consts:[[1,"view-poc-layers-slider",3,"ngClass"],[1,"view-poc-layers-slider__group"],["slider",""],[1,"view-poc-layers-slider__track",3,"click"],["track",""],[1,"view-poc-layers-slider__bar"],["bar",""],["cdkDrag","","cdkDragLockAxis","y","cdkDragBoundary",".view-poc-layers-slider","role","slider","tabindex","0","aria-valuemin","0","aria-valuemax","100",1,"view-poc-layers-slider__handle",3,"cdkDragFreeDragPosition","ngClass","cdkDragEnded","cdkDragMoved","keydown"],["handle",""]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1,2)(3,"div",3,4),i.NdJ("click",function(s){return e.handleTrackClick(s)}),i._UZ(5,"div",5,6),i.qZA(),i.TgZ(7,"div",7,8),i.NdJ("cdkDragEnded",function(){return e.handleDragEnded()})("cdkDragMoved",function(s){return e.handleDragMoved(s)})("keydown",function(s){return e.handleKeyDown(s)}),i.ALo(9,"async"),i.qZA()()()),2&n&&(i.Q6J("ngClass",i.VKq(6,qT,e.assetsLoading)),i.xp6(7),i.Q6J("cdkDragFreeDragPosition",e.dragPosition)("ngClass",i.VKq(8,$T,i.lcZ(9,4,e.canTouch$))),i.uIk("aria-valuenow",e.currentOffset))},dependencies:[f.mk,is.Zt,f.Ov],styles:['.view-poc-layers-slider[_ngcontent-%COMP%]{height:214px;display:flex;justify-content:center;width:40px}.view-poc-layers-slider--disabled[_ngcontent-%COMP%]{opacity:.25;pointer-events:none}.view-poc-layers-slider__group[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;width:28px;height:100%}.view-poc-layers-slider__track[_ngcontent-%COMP%]{cursor:pointer;position:absolute;background:rgba(150,168,192,.6);z-index:1;width:5px;border-radius:5px;top:14px;bottom:14px}.view-poc-layers-slider__bar[_ngcontent-%COMP%]{position:absolute;background:#374a68;width:5px;border-radius:5px;z-index:2;height:0;top:0;pointer-events:none}.view-poc-layers-slider__handle[_ngcontent-%COMP%]{cursor:pointer;width:28px;height:28px;margin-top:-14px;top:14px;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-poc-layers-slider__handle[_ngcontent-%COMP%]:focus{outline:none;border:none}.view-poc-layers-slider__handle--hide[_ngcontent-%COMP%]{display:none}.view-poc-layers-slider__handle[_ngcontent-%COMP%]:after{content:"";width:12px;height:12px;border-radius:6px;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-poc-layers-slider__handle[_ngcontent-%COMP%]:hover:after, .view-poc-layers-slider__handle[_ngcontent-%COMP%]:focus:after{background:#2d72dc}'],changeDetection:0}),Gl([(0,l.Ph)(_.getSelectedChapterCurrentLayers),Jl("design:type",b.y)],Eo.prototype,"selectedChapterCurrentLayers$",void 0),Gl([(0,l.Ph)(_.getSelectedChapterCurrentLayersIndex),Jl("design:type",b.y)],Eo.prototype,"selectedChapterCurrentLayersIndex$",void 0),Gl([(0,l.Ph)(_.getSelectedChapterCurrentLayersPosition),Jl("design:type",b.y)],Eo.prototype,"selectedChapterCurrentLayersPosition$",void 0),Gl([(0,l.Ph)(O.getCanTouch),Jl("design:type",b.y)],Eo.prototype,"canTouch$",void 0);var x_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},v_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function GT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"li")(1,"button",12),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleLayersClick())}),i.TgZ(2,"span",4),i._UZ(3,"i",13)(4,"i",6),i.qZA()()()}if(2&t){const e=i.oxw();i.xp6(1),i.Q6J("selected","layers"===e.mode),i.xp6(3),i.Q6J("ngClass","layers"===e.mode?"fa-caret-left":"fa-caret-right")}}function JT(t,n){1&t&&i._UZ(0,"app-view-poc-layers-slider")}function HT(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",18)(1,"ul",2)(2,"li")(3,"button",19),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleSelectTool(s.toolEnum.Select))}),i.ALo(4,"async"),i.ALo(5,"async"),i.qZA()(),i.TgZ(6,"li")(7,"button",20),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleSelectTool(s.toolEnum.Hide))}),i.ALo(8,"async"),i.ALo(9,"async"),i.qZA()(),i.TgZ(10,"li")(11,"button",21),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleSelectTool(s.toolEnum.Fade))}),i.ALo(12,"async"),i.ALo(13,"async"),i.qZA()()()()}if(2&t){const e=i.oxw(2);i.xp6(3),i.Q6J("selected",i.lcZ(4,6,e.activeTool$)===e.toolEnum.Select),i.uIk("aria-pressed",i.lcZ(5,8,e.activeTool$)===e.toolEnum.Select),i.xp6(4),i.Q6J("selected",i.lcZ(8,10,e.activeTool$)===e.toolEnum.Hide),i.uIk("aria-pressed",i.lcZ(9,12,e.activeTool$)===e.toolEnum.Hide),i.xp6(4),i.Q6J("selected",i.lcZ(12,14,e.activeTool$)===e.toolEnum.Fade),i.uIk("aria-pressed",i.lcZ(13,16,e.activeTool$)===e.toolEnum.Fade)}}function YT(t,n){if(1&t&&(i.TgZ(0,"app-pillbox",14)(1,"container-element",15),i.YNc(2,JT,1,0,"app-view-poc-layers-slider",16),i.YNc(3,HT,14,18,"div",17),i.qZA()()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngSwitch",e.mode),i.xp6(1),i.Q6J("ngSwitchCase","layers"),i.xp6(1),i.Q6J("ngSwitchCase","selection")}}const WT=function(t,n,e){return{"fa-mouse-pointer":t,"fa-eye-slash":n,"fa-adjust":e}};class qs{constructor(n,e,o,s){this.chapterService=n,this.store=e,this.viewService=o,this.changeDetectorRef=s,this._mode=null,this.modeChanged=new i.vpe,this.ngUnsubscribe=new X.x,this.toolEnum=Ve,this.visibilityLayersVisible=!1}get mode(){return this._mode}set mode(n){this._mode=n,this.modeChanged.emit(this.mode)}ngOnInit(){this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLayoutListener(){this.currentChapterLayers$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.visibilityLayersVisible=this.chapterService.hasVisibilityLayers(n),this.mode=this.visibilityLayersVisible?"layers":null,this.changeDetectorRef.markForCheck()})}handleSelectTool(n){const e=this.store.selectSnapshot(M.getActiveTool);this.viewService.selectTool(n===e?Ve.Select:n)}handlePointerClick(){this.mode="selection"===this.mode?null:"selection"}handleLayersClick(){this.mode="layers"===this.mode?null:"layers"}handleSearchClick(){this.mode=null,this.viewService.toggleSearch(an.List)}handleWhiteboardClick(){this.mode=null,this.viewService.toggleWhiteboard(!0)}}qs.\u0275fac=function(n){return new(n||qs)(i.Y36(Pr),i.Y36(l.yh),i.Y36(ut),i.Y36(i.sBO))},qs.\u0275cmp=i.Xpm({type:qs,selectors:[["app-view-poc-toolbar-primary"]],outputs:{modeChanged:"modeChanged"},decls:18,vars:15,consts:[[1,"poc-toolbar"],["name","POC Toolbar","orientation","vertical"],[1,"poc-toolbar__buttons"],["app-pin-button","","buttonType","ghost","matTooltip","Select","matTooltipPosition","right",3,"selected","click"],[1,"poc-toolbar__icon-group"],[1,"fas","fa-mouse-pointer","poc-toolbar__icon",3,"ngClass"],[1,"fas","poc-toolbar__caret",3,"ngClass"],[4,"ngIf"],["app-pin-button","","buttonType","ghost","icon","search","matTooltip","Search","matTooltipPosition","right",3,"click"],["app-pin-button","","buttonType","ghost","icon","signature","matTooltip","Whiteboard","matTooltipPosition","right",3,"click"],[1,"poc-toolbar__secondary"],["name","POC selection","orientation","vertical",4,"ngIf"],["app-pin-button","","buttonType","ghost","matTooltip","Layers","matTooltipPosition","right",3,"selected","click"],[1,"fas","fa-layer-group","poc-toolbar__icon"],["name","POC selection","orientation","vertical"],[3,"ngSwitch"],[4,"ngSwitchCase"],["role","radiogroup","class","flex",4,"ngSwitchCase"],["role","radiogroup",1,"flex"],["app-pin-button","","buttonType","ghost","icon","mouse-pointer","aria-label","Select","matTooltip","Select","matTooltipPosition","right","data-test","viewToolsSelect",1,"view-tools__item",3,"selected","click"],["app-pin-button","","buttonType","ghost","icon","eye-slash","aria-label","Hide","matTooltip","Hide","matTooltipPosition","right","data-test","viewToolsHide",1,"view-tools__item",3,"selected","click"],["app-pin-button","","buttonType","ghost","aria-label","Fade","matTooltip","Fade","matTooltipPosition","right","icon","adjust","data-test","viewToolsFade",1,"view-tools__item",3,"selected","click"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"app-pillbox",1)(2,"ul",2)(3,"li")(4,"button",3),i.NdJ("click",function(){return e.handlePointerClick()}),i.TgZ(5,"span",4),i._UZ(6,"i",5),i.ALo(7,"async"),i.ALo(8,"async"),i.ALo(9,"async"),i._UZ(10,"i",6),i.qZA()()(),i.YNc(11,GT,5,2,"li",7),i.TgZ(12,"li")(13,"button",8),i.NdJ("click",function(){return e.handleSearchClick()}),i.qZA()(),i.TgZ(14,"li")(15,"button",9),i.NdJ("click",function(){return e.handleWhiteboardClick()}),i.qZA()()()(),i.TgZ(16,"div",10),i.YNc(17,YT,4,3,"app-pillbox",11),i.qZA()()),2&n&&(i.xp6(4),i.Q6J("selected","selection"===e.mode),i.xp6(2),i.Q6J("ngClass",i.kEZ(11,WT,i.lcZ(7,5,e.activeTool$)===e.toolEnum.Select,i.lcZ(8,7,e.activeTool$)===e.toolEnum.Hide,i.lcZ(9,9,e.activeTool$)===e.toolEnum.Fade)),i.xp6(4),i.Q6J("ngClass","selection"===e.mode?"fa-caret-left":"fa-caret-right"),i.xp6(1),i.Q6J("ngIf",e.visibilityLayersVisible),i.xp6(6),i.Q6J("ngIf",null!==e.mode))},dependencies:[f.mk,f.O5,f.RF,f.n9,In,Wa,Gt.gM,Eo,f.Ov],styles:[".poc-toolbar[_ngcontent-%COMP%]{display:flex}.poc-toolbar__buttons[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:not(:first-child){padding-top:4px}.poc-toolbar__icon-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(1,auto) 1fr;column-gap:3px;justify-items:center;align-items:center}.poc-toolbar__icon[_ngcontent-%COMP%]{grid-column-start:2;font-size:14px}.poc-toolbar__caret[_ngcontent-%COMP%]{margin-left:auto;font-size:10px}.poc-toolbar__secondary[_ngcontent-%COMP%]{display:inline;position:relative;top:0;left:12px}"],changeDetection:0}),x_([(0,l.Ph)(M.getActiveTool),v_("design:type",b.y)],qs.prototype,"activeTool$",void 0),x_([(0,l.Ph)(_.getSelectedChapterCurrentLayers),v_("design:type",b.y)],qs.prototype,"currentChapterLayers$",void 0);let C_=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-button-loader"]],decls:5,vars:0,consts:[["tabindex","0","type","button","aria-label","Interact in 3D","type","button",1,"button-loader"],[1,"button-loader__button"],["src","assets/images/widget/loading_experience/interact-in-3d-arrow.svg","alt","Interact in 3D",1,"button-loader__3d-arrow"],[1,"button-loader__label"]],template:function(e,o){1&e&&(i.TgZ(0,"button",0)(1,"div",1),i._UZ(2,"img",2),i.TgZ(3,"div",3),i._uU(4,"Interact in 3D"),i.qZA()()())},styles:[".m-1[_ngcontent-%COMP%]{margin:4px!important}.mv-1[_ngcontent-%COMP%]{margin-top:4px!important;margin-bottom:4px!important}.mh-1[_ngcontent-%COMP%]{margin-left:4px!important;margin-right:4px!important}.mt-1[_ngcontent-%COMP%]{margin-top:4px!important}.mr-1[_ngcontent-%COMP%]{margin-right:4px!important}.mb-1[_ngcontent-%COMP%]{margin-bottom:4px!important}.ml-1[_ngcontent-%COMP%]{margin-left:4px!important}.p-1[_ngcontent-%COMP%]{padding:4px!important}.pv-1[_ngcontent-%COMP%]{padding-top:4px!important;padding-bottom:4px!important}.ph-1[_ngcontent-%COMP%]{padding-left:4px!important;padding-right:4px!important}.pt-1[_ngcontent-%COMP%]{padding-top:4px!important}.pr-1[_ngcontent-%COMP%]{padding-right:4px!important}.pb-1[_ngcontent-%COMP%]{padding-bottom:4px!important}.pl-1[_ngcontent-%COMP%]{padding-left:4px!important}.m-2[_ngcontent-%COMP%]{margin:8px!important}.mv-2[_ngcontent-%COMP%]{margin-top:8px!important;margin-bottom:8px!important}.mh-2[_ngcontent-%COMP%]{margin-left:8px!important;margin-right:8px!important}.mt-2[_ngcontent-%COMP%]{margin-top:8px!important}.mr-2[_ngcontent-%COMP%]{margin-right:8px!important}.mb-2[_ngcontent-%COMP%]{margin-bottom:8px!important}.ml-2[_ngcontent-%COMP%]{margin-left:8px!important}.p-2[_ngcontent-%COMP%]{padding:8px!important}.pv-2[_ngcontent-%COMP%]{padding-top:8px!important;padding-bottom:8px!important}.ph-2[_ngcontent-%COMP%]{padding-left:8px!important;padding-right:8px!important}.pt-2[_ngcontent-%COMP%]{padding-top:8px!important}.pr-2[_ngcontent-%COMP%]{padding-right:8px!important}.pb-2[_ngcontent-%COMP%]{padding-bottom:8px!important}.pl-2[_ngcontent-%COMP%]{padding-left:8px!important}.m-3[_ngcontent-%COMP%]{margin:12px!important}.mv-3[_ngcontent-%COMP%]{margin-top:12px!important;margin-bottom:12px!important}.mh-3[_ngcontent-%COMP%]{margin-left:12px!important;margin-right:12px!important}.mt-3[_ngcontent-%COMP%]{margin-top:12px!important}.mr-3[_ngcontent-%COMP%]{margin-right:12px!important}.mb-3[_ngcontent-%COMP%]{margin-bottom:12px!important}.ml-3[_ngcontent-%COMP%]{margin-left:12px!important}.p-3[_ngcontent-%COMP%]{padding:12px!important}.pv-3[_ngcontent-%COMP%]{padding-top:12px!important;padding-bottom:12px!important}.ph-3[_ngcontent-%COMP%]{padding-left:12px!important;padding-right:12px!important}.pt-3[_ngcontent-%COMP%]{padding-top:12px!important}.pr-3[_ngcontent-%COMP%]{padding-right:12px!important}.pb-3[_ngcontent-%COMP%]{padding-bottom:12px!important}.pl-3[_ngcontent-%COMP%]{padding-left:12px!important}.m-4[_ngcontent-%COMP%]{margin:16px!important}.mv-4[_ngcontent-%COMP%]{margin-top:16px!important;margin-bottom:16px!important}.mh-4[_ngcontent-%COMP%]{margin-left:16px!important;margin-right:16px!important}.mt-4[_ngcontent-%COMP%]{margin-top:16px!important}.mr-4[_ngcontent-%COMP%]{margin-right:16px!important}.mb-4[_ngcontent-%COMP%]{margin-bottom:16px!important}.ml-4[_ngcontent-%COMP%]{margin-left:16px!important}.p-4[_ngcontent-%COMP%]{padding:16px!important}.pv-4[_ngcontent-%COMP%]{padding-top:16px!important;padding-bottom:16px!important}.ph-4[_ngcontent-%COMP%]{padding-left:16px!important;padding-right:16px!important}.pt-4[_ngcontent-%COMP%]{padding-top:16px!important}.pr-4[_ngcontent-%COMP%]{padding-right:16px!important}.pb-4[_ngcontent-%COMP%]{padding-bottom:16px!important}.pl-4[_ngcontent-%COMP%]{padding-left:16px!important}.m-5[_ngcontent-%COMP%]{margin:20px!important}.mv-5[_ngcontent-%COMP%]{margin-top:20px!important;margin-bottom:20px!important}.mh-5[_ngcontent-%COMP%]{margin-left:20px!important;margin-right:20px!important}.mt-5[_ngcontent-%COMP%]{margin-top:20px!important}.mr-5[_ngcontent-%COMP%]{margin-right:20px!important}.mb-5[_ngcontent-%COMP%]{margin-bottom:20px!important}.ml-5[_ngcontent-%COMP%]{margin-left:20px!important}.p-5[_ngcontent-%COMP%]{padding:20px!important}.pv-5[_ngcontent-%COMP%]{padding-top:20px!important;padding-bottom:20px!important}.ph-5[_ngcontent-%COMP%]{padding-left:20px!important;padding-right:20px!important}.pt-5[_ngcontent-%COMP%]{padding-top:20px!important}.pr-5[_ngcontent-%COMP%]{padding-right:20px!important}.pb-5[_ngcontent-%COMP%]{padding-bottom:20px!important}.pl-5[_ngcontent-%COMP%]{padding-left:20px!important}.m-6[_ngcontent-%COMP%]{margin:24px!important}.mv-6[_ngcontent-%COMP%]{margin-top:24px!important;margin-bottom:24px!important}.mh-6[_ngcontent-%COMP%]{margin-left:24px!important;margin-right:24px!important}.mt-6[_ngcontent-%COMP%]{margin-top:24px!important}.mr-6[_ngcontent-%COMP%]{margin-right:24px!important}.mb-6[_ngcontent-%COMP%]{margin-bottom:24px!important}.ml-6[_ngcontent-%COMP%]{margin-left:24px!important}.p-6[_ngcontent-%COMP%]{padding:24px!important}.pv-6[_ngcontent-%COMP%]{padding-top:24px!important;padding-bottom:24px!important}.ph-6[_ngcontent-%COMP%]{padding-left:24px!important;padding-right:24px!important}.pt-6[_ngcontent-%COMP%]{padding-top:24px!important}.pr-6[_ngcontent-%COMP%]{padding-right:24px!important}.pb-6[_ngcontent-%COMP%]{padding-bottom:24px!important}.pl-6[_ngcontent-%COMP%]{padding-left:24px!important}.m-7[_ngcontent-%COMP%]{margin:28px!important}.mv-7[_ngcontent-%COMP%]{margin-top:28px!important;margin-bottom:28px!important}.mh-7[_ngcontent-%COMP%]{margin-left:28px!important;margin-right:28px!important}.mt-7[_ngcontent-%COMP%]{margin-top:28px!important}.mr-7[_ngcontent-%COMP%]{margin-right:28px!important}.mb-7[_ngcontent-%COMP%]{margin-bottom:28px!important}.ml-7[_ngcontent-%COMP%]{margin-left:28px!important}.p-7[_ngcontent-%COMP%]{padding:28px!important}.pv-7[_ngcontent-%COMP%]{padding-top:28px!important;padding-bottom:28px!important}.ph-7[_ngcontent-%COMP%]{padding-left:28px!important;padding-right:28px!important}.pt-7[_ngcontent-%COMP%]{padding-top:28px!important}.pr-7[_ngcontent-%COMP%]{padding-right:28px!important}.pb-7[_ngcontent-%COMP%]{padding-bottom:28px!important}.pl-7[_ngcontent-%COMP%]{padding-left:28px!important}.m-8[_ngcontent-%COMP%]{margin:32px!important}.mv-8[_ngcontent-%COMP%]{margin-top:32px!important;margin-bottom:32px!important}.mh-8[_ngcontent-%COMP%]{margin-left:32px!important;margin-right:32px!important}.mt-8[_ngcontent-%COMP%]{margin-top:32px!important}.mr-8[_ngcontent-%COMP%]{margin-right:32px!important}.mb-8[_ngcontent-%COMP%]{margin-bottom:32px!important}.ml-8[_ngcontent-%COMP%]{margin-left:32px!important}.p-8[_ngcontent-%COMP%]{padding:32px!important}.pv-8[_ngcontent-%COMP%]{padding-top:32px!important;padding-bottom:32px!important}.ph-8[_ngcontent-%COMP%]{padding-left:32px!important;padding-right:32px!important}.pt-8[_ngcontent-%COMP%]{padding-top:32px!important}.pr-8[_ngcontent-%COMP%]{padding-right:32px!important}.pb-8[_ngcontent-%COMP%]{padding-bottom:32px!important}.pl-8[_ngcontent-%COMP%]{padding-left:32px!important}.m-9[_ngcontent-%COMP%]{margin:36px!important}.mv-9[_ngcontent-%COMP%]{margin-top:36px!important;margin-bottom:36px!important}.mh-9[_ngcontent-%COMP%]{margin-left:36px!important;margin-right:36px!important}.mt-9[_ngcontent-%COMP%]{margin-top:36px!important}.mr-9[_ngcontent-%COMP%]{margin-right:36px!important}.mb-9[_ngcontent-%COMP%]{margin-bottom:36px!important}.ml-9[_ngcontent-%COMP%]{margin-left:36px!important}.p-9[_ngcontent-%COMP%]{padding:36px!important}.pv-9[_ngcontent-%COMP%]{padding-top:36px!important;padding-bottom:36px!important}.ph-9[_ngcontent-%COMP%]{padding-left:36px!important;padding-right:36px!important}.pt-9[_ngcontent-%COMP%]{padding-top:36px!important}.pr-9[_ngcontent-%COMP%]{padding-right:36px!important}.pb-9[_ngcontent-%COMP%]{padding-bottom:36px!important}.pl-9[_ngcontent-%COMP%]{padding-left:36px!important}.m-10[_ngcontent-%COMP%]{margin:40px!important}.mv-10[_ngcontent-%COMP%]{margin-top:40px!important;margin-bottom:40px!important}.mh-10[_ngcontent-%COMP%]{margin-left:40px!important;margin-right:40px!important}.mt-10[_ngcontent-%COMP%]{margin-top:40px!important}.mr-10[_ngcontent-%COMP%]{margin-right:40px!important}.mb-10[_ngcontent-%COMP%]{margin-bottom:40px!important}.ml-10[_ngcontent-%COMP%]{margin-left:40px!important}.p-10[_ngcontent-%COMP%]{padding:40px!important}.pv-10[_ngcontent-%COMP%]{padding-top:40px!important;padding-bottom:40px!important}.ph-10[_ngcontent-%COMP%]{padding-left:40px!important;padding-right:40px!important}.pt-10[_ngcontent-%COMP%]{padding-top:40px!important}.pr-10[_ngcontent-%COMP%]{padding-right:40px!important}.pb-10[_ngcontent-%COMP%]{padding-bottom:40px!important}.pl-10[_ngcontent-%COMP%]{padding-left:40px!important}.text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.button-loader[_ngcontent-%COMP%]{border:0;width:100%;background:rgba(0,0,0,.2);display:flex;position:fixed;justify-content:center;align-items:center;inset:0;transition:background-color .25s,opacity .25s;z-index:10000}.button-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:rgba(0,0,0,.2)}@media print{.button-loader[_ngcontent-%COMP%]{display:none}}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__button[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__button[_ngcontent-%COMP%]{background-color:#2d72dc;transform:scale(1.1)}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__3d-arrow[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__3d-arrow[_ngcontent-%COMP%]{transform:scale(1.2)}.button-loader__button[_ngcontent-%COMP%]{display:flex;padding:12px 28px;border-radius:32px;align-items:center;transition:transform .25s,background-color .25s;background-color:#101823cc}.button-loader__3d-arrow[_ngcontent-%COMP%]{transition:transform .25s;margin-right:4px}.button-loader__label[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em;color:#fff;font-weight:600;margin-left:4px}"],changeDetection:0}),t})(),w_=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-hand-loader"]],decls:6,vars:0,consts:[["tabindex","0","type","button","aria-label","Interact in 3D",1,"hand-loader"],[1,"hand-loader__container"],[1,"hand-loader__circle"],["src","assets/images/widget/loading_experience/interact-in-3d-hand.svg","alt","Interact in 3D",1,"hand-loader__3d-hand"],[1,"hand-loader__label"]],template:function(e,o){1&e&&(i.TgZ(0,"button",0)(1,"div",1),i._UZ(2,"div",2)(3,"img",3),i.TgZ(4,"div",4),i._uU(5,"Interact in 3D"),i.qZA()()())},styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.hand-loader[_ngcontent-%COMP%]{border:0;width:100%;background:rgba(0,0,0,.2);display:flex;position:fixed;justify-content:center;align-items:center;inset:0;transition:background-color .25s,opacity .25s;z-index:10000}.hand-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:rgba(0,0,0,.2)}@keyframes handKeyframes{0%{transform:scale(1.2)}25%{transform:scale(1)}40%{transform:scale(1)}60%{transform:scale(1.2)}to{transform:scale(1.2)}}@keyframes circleKeyframes{0%{transform:scale(0)}20%{transform:scale(0);opacity:1}to{transform:scale(1);opacity:0}}.hand-loader[_ngcontent-%COMP%]:focus   .hand-loader__3d-hand[_ngcontent-%COMP%], .hand-loader[_ngcontent-%COMP%]:hover   .hand-loader__3d-hand[_ngcontent-%COMP%]{filter:drop-shadow(0 0 8px #2d72dc)}.hand-loader__container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.hand-loader__circle[_ngcontent-%COMP%]{background-color:#fff;position:absolute;left:50%;margin-left:-40.5px;margin-top:-1.5px;width:70px;height:70px;border-radius:50%;animation:circleKeyframes 2s infinite}.hand-loader__3d-hand[_ngcontent-%COMP%]{animation:handKeyframes 2s ease-in-out infinite;position:absolute;height:96px;width:86px;left:50%;margin-left:-43px;margin-top:27px;transition:filter .3s ease-out}.hand-loader__label[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em;font-weight:600;color:#fff;text-shadow:0px 1px 5px black;bottom:40px;position:absolute;text-align:center;width:100%}"],changeDetection:0}),t})();const KT=["circle"],XT=["progressCircle"],eM=["progressContainer"];let S_=(()=>{class t{constructor(e){this.renderer=e,this.ngUnsubscribe=new X.x,this._percent=0}get percent(){return this._percent}set percent(e){null!=e&&(this._percent=e,this.setProgress(this.percent))}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions()}initSizeObserver(){(0,Dt.R)(window,"resize").pipe((0,cn.b)(10),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(e=100){const o=this.getCircumference();return o-e/100*o}setProgress(e=0){e>=100&&(e=100);const o=this.getCircumference(),s=this.getOffset(e);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}updateDimensions(){const e=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*e),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*e),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(e-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${e}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${e}`);const o=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${o}`),setTimeout(()=>{this.renderer.setStyle(this.progressCircleRef.nativeElement,"transition","stroke-dashoffset 300ms")})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-play-loader"]],viewQuery:function(e,o){if(1&e&&(i.Gf(KT,7),i.Gf(XT,7),i.Gf(eM,7)),2&e){let s;i.iGM(s=i.CRH())&&(o.circleRef=s.first),i.iGM(s=i.CRH())&&(o.progressCircleRef=s.first),i.iGM(s=i.CRH())&&(o.progressContainerRef=s.first)}},inputs:{percent:"percent"},decls:10,vars:0,consts:[["tabindex","0","type","button","aria-label","Interact in 3D",1,"play-loader"],[1,"play-loader__circle"],["circle",""],[1,"play-loader__ring"],["progressContainer",""],[1,"play-loader__ring-inner"],["progressCircle",""],["icon","play",1,"play-loader__icon"],[1,"play-loader__label"]],template:function(e,o){1&e&&(i.TgZ(0,"button",0)(1,"div",1,2),i.O4$(),i.TgZ(3,"svg",3,4),i._UZ(5,"circle",5,6),i.qZA(),i.kcU(),i._UZ(7,"app-icon",7),i.TgZ(8,"div",8),i._uU(9,"3D"),i.qZA()()())},dependencies:[lt],styles:[".play-loader[_ngcontent-%COMP%]{--buttonSize: 35vw;border:0;width:100%;background:rgba(0,0,0,.2);display:flex;position:fixed;justify-content:center;align-items:center;inset:0;transition:background-color .25s,opacity .25s;z-index:10000}.play-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:rgba(0,0,0,.2)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__circle[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__circle[_ngcontent-%COMP%]{background:rgba(255,255,255,.8);transform:scale(1.1)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__icon[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__icon[_ngcontent-%COMP%]{color:#2d72dc;transform:scale(1.2)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__label[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__label[_ngcontent-%COMP%]{color:#fff}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__ring[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__ring[_ngcontent-%COMP%]{stroke:#2d72dc}.play-loader__circle[_ngcontent-%COMP%]{width:var(--buttonSize);height:var(--buttonSize);border-radius:50%;background-color:#101823cc;display:flex;align-items:center;justify-content:center;position:relative;transition:background-color .25s,color .25s,transform .25s}.play-loader__icon[_ngcontent-%COMP%]{font-size:calc(var(--buttonSize) / 2);color:#ffffffe6;transition:color .25s,transform .25s;margin-right:-10%}.play-loader__label[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:2;font-weight:600}.play-loader__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;stroke-width:4;stroke:#fff;fill:transparent;transform:rotate(-90deg)}@media (min-width: 600px){.play-loader__circle[_ngcontent-%COMP%]{width:160px;height:160px}.play-loader__icon[_ngcontent-%COMP%]{font-size:80px}}"],changeDetection:0}),t})();const tM=["textRef"];function nM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div")(1,"div",4),i.NdJ("cdkDragMoved",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.dragMoved(s,"corner1"))}),i.qZA(),i.TgZ(2,"div",5),i.NdJ("cdkDragMoved",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.dragMoved(s,"corner2"))}),i.qZA(),i.TgZ(3,"div",6),i.NdJ("cdkDragMoved",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.dragMoved(s,"corner3"))}),i.qZA(),i.TgZ(4,"div",7),i.NdJ("cdkDragMoved",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.dragMoved(s,"corner4"))}),i.qZA(),i.TgZ(5,"div",8),i.NdJ("cdkDragMoved",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.translateHandleMoved(s))}),i.qZA()()}if(2&t){const e=i.oxw();i.xp6(1),i.Q6J("cdkDragFreeDragPosition",e.dragHandles.corner1),i.xp6(1),i.Q6J("cdkDragFreeDragPosition",e.dragHandles.corner2),i.xp6(1),i.Q6J("cdkDragFreeDragPosition",e.dragHandles.corner3),i.xp6(1),i.Q6J("cdkDragFreeDragPosition",e.dragHandles.corner4),i.xp6(1),i.Q6J("cdkDragFreeDragPosition",e.dragHandles.translate)}}const iM=function(t){return{"whiteboard-label__label--active":t}};let oM=(()=>{class t{constructor(e,o){this.changeDetectorRef=e,this.renderer=o,this.active=!0,this.initialized=!1,this.labelActive=new i.vpe,this.labelEmpty=new i.vpe,this.dragHandles={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.handleCoords={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.textareaTransform={x:0,y:0,width:110,height:40},this.handleDocumentBackspace=s=>{const{activeElement:r}=this.textRef.nativeElement;"Backspace"===s.key&&this.active&&!r&&this.deleteLabel()},this.handleTextboxMouseDown=s=>{this.active=!0,this.labelActive.next(this.id),this.refreshHandles()},this.handleDocumentMouseDown=s=>{const r=s.target.className.includes("view-whiteboard__canvas"),a=s.target.className.includes("whiteboard-label__label"),c=s.target.dataset.id===this.id;this.isLabelEmpty()&&!c&&this.initialized?this.deleteLabel():(r||a&&!c)&&(this.active=!1,this.changeDetectorRef.markForCheck())},this.handleTextKeyDown=s=>{if(s.stopPropagation(),this.isLabelEmpty()&&"Backspace"===s.key)return void this.deleteLabel();const r=this.textRef.nativeElement.scrollHeight,{corner1:a,corner3:c,corner4:p}=this.handleCoords,d=a.y+r;this.handleCoords.corner3={...c,y:d},this.handleCoords.corner4={...p,y:d},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.updateTextarea(),this.changeDetectorRef.markForCheck()}}get id(){return this._id}set id(e){this._id=e,this.initialized=!1}set color(e){this.renderer.setStyle(this.textRef.nativeElement,"color",e)}set exporting(e){e&&(this.active=!1,this.labelActive.next(void 0))}set size(e){this.renderer.setStyle(this.textRef.nativeElement,"font-size",`${e}px`)}ngOnInit(){this.initHandles(),this.initInteractionListeners(),setTimeout(()=>{this.textRef.nativeElement.focus(),this.initialized=!0})}ngOnDestroy(){this.textRef.nativeElement.removeEventListener("keydown",this.handleTextKeyDown),this.textRef.nativeElement.removeEventListener("mousedown",this.handleTextboxMouseDown),this.mouseDownListener(),this.backspaceListener()}initHandles(){this.textareaTransform.x=this.initialPos.x,this.textareaTransform.y=this.initialPos.y;const{x:e,y:o,width:s,height:r}=this.textareaTransform;this.dragHandles.corner1={x:e,y:o},this.dragHandles.corner2={x:e+s,y:o},this.dragHandles.corner3={x:e+s,y:o+r},this.dragHandles.corner4={x:e,y:o+r},this.dragHandles.translate={x:e+s/2,y:o+-10},this.handleCoords.corner1={...this.dragHandles.corner1},this.handleCoords.corner2={...this.dragHandles.corner2},this.handleCoords.corner3={...this.dragHandles.corner3},this.handleCoords.corner4={...this.dragHandles.corner4},this.handleCoords.translate={...this.dragHandles.translate},this.updateTextarea()}initInteractionListeners(){this.mouseDownListener=this.renderer.listen("document","mousedown",this.handleDocumentMouseDown),this.backspaceListener=this.renderer.listen("document","keydown",this.handleDocumentBackspace),this.textRef.nativeElement.addEventListener("mousedown",this.handleTextboxMouseDown),this.textRef.nativeElement.addEventListener("keydown",this.handleTextKeyDown)}refreshHandles(){this.dragHandles.corner1={...this.handleCoords.corner1},this.dragHandles.corner2={...this.handleCoords.corner2},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.dragHandles.translate={...this.handleCoords.translate},this.changeDetectorRef.markForCheck()}isLabelEmpty(){return""===this.textRef.nativeElement.innerText||"\n"===this.textRef.nativeElement.innerText}deleteLabel(){this.labelEmpty.next(this.id)}updateTextarea(){const{corner1:e,corner2:o,corner3:s}=this.handleCoords;this.textareaTransform.x=e.x,this.textareaTransform.y=e.y,this.textareaTransform.width=o.x-e.x,this.textareaTransform.height=s.y-o.y,this.renderer.setStyle(this.textRef.nativeElement,"transform",`translate(${this.textareaTransform.x}px, ${this.textareaTransform.y}px)`),this.renderer.setStyle(this.textRef.nativeElement,"width",`${this.textareaTransform.width}px`),this.renderer.setStyle(this.textRef.nativeElement,"height",`${this.textareaTransform.height}px`)}updateTranslateHandle(){const{corner1:e,corner2:o}=this.handleCoords;this.handleCoords.translate={x:(o.x-e.x)/2+e.x,y:e.y+-10},this.dragHandles.translate={...this.handleCoords.translate}}setHandle(e,o,s){this.handleCoords[e]={...this.handleCoords[e],[o]:s[o]},this.dragHandles[e]={...this.handleCoords[e]}}addDiffToHandle(e,o){this.handleCoords[e]={x:this.handleCoords[e].x+o.x,y:this.handleCoords[e].y+o.y},this.dragHandles[e]={...this.handleCoords[e]}}translateHandleMoved(e){const o=e.source._dragRef.getFreeDragPosition(),s={x:o.x-this.handleCoords.translate.x,y:o.y-this.handleCoords.translate.y};this.handleCoords.translate={...o},this.addDiffToHandle("corner1",s),this.addDiffToHandle("corner2",s),this.addDiffToHandle("corner3",s),this.addDiffToHandle("corner4",s),this.updateTextarea()}dragMoved(e,o){const s=e.source._dragRef.getFreeDragPosition();this.handleCoords[o]={...s},"corner1"===o&&(this.setHandle("corner2","y",s),this.setHandle("corner4","x",s)),"corner2"===o&&(this.setHandle("corner1","y",s),this.setHandle("corner3","x",s)),"corner3"===o&&(this.setHandle("corner2","x",s),this.setHandle("corner4","y",s)),"corner4"===o&&(this.setHandle("corner1","x",s),this.setHandle("corner3","y",s)),this.updateTranslateHandle(),this.updateTextarea()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO),i.Y36(i.Qsj))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-whiteboard-label"]],viewQuery:function(e,o){if(1&e&&i.Gf(tM,7),2&e){let s;i.iGM(s=i.CRH())&&(o.textRef=s.first)}},inputs:{id:"id",initialPos:"initialPos",color:"color",exporting:"exporting",size:"size"},outputs:{labelActive:"labelActive",labelEmpty:"labelEmpty"},decls:4,vars:5,consts:[[1,"whiteboard-label"],[4,"ngIf"],["contenteditable","true","data-placeholder","Type..",1,"whiteboard-label__label",3,"ngClass"],["textRef",""],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-left",3,"cdkDragFreeDragPosition","cdkDragMoved"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-right",3,"cdkDragFreeDragPosition","cdkDragMoved"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-right",3,"cdkDragFreeDragPosition","cdkDragMoved"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-left",3,"cdkDragFreeDragPosition","cdkDragMoved"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--move",3,"cdkDragFreeDragPosition","cdkDragMoved"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.YNc(1,nM,6,5,"div",1),i._UZ(2,"div",2,3),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngIf",!0===o.active),i.xp6(1),i.Q6J("ngClass",i.VKq(3,iM,!0===o.active)),i.uIk("data-id",o.id))},dependencies:[f.mk,f.O5,is.Zt],styles:['.whiteboard-label[_ngcontent-%COMP%]{position:relative;z-index:1000}.whiteboard-label__handle[_ngcontent-%COMP%]{position:fixed;z-index:10;width:32px;height:32px;left:-16px;top:-16px}.whiteboard-label__handle[_ngcontent-%COMP%]:after{content:"";position:absolute;width:12px;height:12px;left:10px;top:10px;border-radius:50%;background-color:#2d72dc}.whiteboard-label__handle[_ngcontent-%COMP%]:hover{cursor:pointer}.whiteboard-label__handle--top-left[_ngcontent-%COMP%]:hover{cursor:nw-resize}.whiteboard-label__handle--top-right[_ngcontent-%COMP%]:hover{cursor:ne-resize}.whiteboard-label__handle--bottom-right[_ngcontent-%COMP%]:hover{cursor:se-resize}.whiteboard-label__handle--bottom-left[_ngcontent-%COMP%]:hover{cursor:sw-resize}.whiteboard-label__handle--move[_ngcontent-%COMP%]:hover{cursor:move}.whiteboard-label__label[_ngcontent-%COMP%]{box-sizing:border-box;position:absolute;border:none;padding:5px;overflow-y:hidden}.whiteboard-label__label--active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px #2d72dc}.whiteboard-label__label[_ngcontent-%COMP%]:focus{outline:none}.whiteboard-label__label[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#374a6880}'],changeDetection:0}),t})();var ls=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ps=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const sM=["colorBtn"];function rM(t,n){1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-icon",19),i.TgZ(2,"span",20),i._uU(3,"current"),i.qZA()())}function aM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.setTextSize(r.size))}),i.TgZ(1,"div",15)(2,"div",16),i.YNc(3,rM,4,0,"div",17),i.ALo(4,"async"),i.qZA(),i.TgZ(5,"div",18)(6,"span"),i._uU(7),i.qZA()()()()}if(2&t){const e=n.$implicit,o=i.oxw();i.xp6(3),i.Q6J("ngIf",e.size===i.lcZ(4,2,o.textSize$)),i.xp6(4),i.hij("",e.label,"px")}}function cM(t,n){1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-icon",19),i.TgZ(2,"span",20),i._uU(3,"current"),i.qZA()())}function lM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.setBrushSize(r.size))}),i.TgZ(1,"div",15)(2,"div",16),i.YNc(3,cM,4,0,"div",17),i.ALo(4,"async"),i.qZA(),i.TgZ(5,"div",18),i._UZ(6,"app-icon",21),i.TgZ(7,"span"),i._uU(8),i.qZA()()()()}if(2&t){const e=n.$implicit,o=i.oxw();i.xp6(3),i.Q6J("ngIf",e.size===i.lcZ(4,4,o.brushSize$)),i.xp6(3),i.Udp("font-size",e.size,"px"),i.xp6(2),i.Oqu(e.label)}}function pM(t,n){1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-icon",19),i.TgZ(2,"span",20),i._uU(3,"current"),i.qZA()())}function dM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.setEraserSize(r.size))}),i.TgZ(1,"div",15)(2,"div",16),i.YNc(3,pM,4,0,"div",17),i.ALo(4,"async"),i.qZA(),i.TgZ(5,"div",18),i._UZ(6,"app-icon",21),i.TgZ(7,"span"),i._uU(8),i.qZA()()()()}if(2&t){const e=n.$implicit,o=i.oxw();i.xp6(3),i.Q6J("ngIf",e.size===i.lcZ(4,4,o.eraserSize$)),i.xp6(3),i.Udp("font-size",e.size,"px"),i.xp6(2),i.Oqu(e.label)}}function uM(t,n){1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-icon",19),i.TgZ(2,"span",20),i._uU(3,"current"),i.qZA()())}function gM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw();return i.KtG(a.setBrushColor(r.color))}),i.TgZ(1,"div",15)(2,"div",16),i.YNc(3,uM,4,0,"div",17),i.ALo(4,"async"),i.qZA(),i.TgZ(5,"div",18),i._UZ(6,"span",22),i.TgZ(7,"span"),i._uU(8),i.qZA()()()()}if(2&t){const e=n.$implicit,o=i.oxw();i.xp6(3),i.Q6J("ngIf",e.color===i.lcZ(4,4,o.brushColor$)),i.xp6(3),i.Udp("background-color",e.color),i.xp6(2),i.Oqu(e.label)}}class ci{constructor(n){this.store=n,this.textSizes=Ff,this.brushSizes=Lf,this.brushColors=Ef,this.eraserSizes=Uf,this.modeEnum=Fi,this.downloadClick=new i.vpe,this.clearClick=new i.vpe,this.exitClick=new i.vpe,this.ngUnsubscribe=new X.x}ngOnInit(){}ngAfterViewInit(){this.brushColor$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.colorBtn.nativeElement.style.setProperty("--pin-button-pin-color",n)}),this.hasPaint$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{!n&&this.store.selectSnapshot(O.getWhiteboardAnnotateMode)===Fi.Erase&&this.handleModeSelect(Fi.Paint)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setBrushSize(n){this.store.dispatch(new T.SetWhiteboardBrushSize(n))}setBrushColor(n){this.store.dispatch(new T.SetWhiteboardBrushColor(n))}setTextSize(n){this.store.dispatch(new T.SetWhiteboardTextSize(n))}handleModeSelect(n){this.store.dispatch(new T.SetWhiteboardAnnotateMode(n))}setEraserSize(n){this.store.dispatch(new T.SetWhiteboardEraserSize(n))}handleDownloadClick(){this.downloadClick.next()}handleClearClick(){this.clearClick.next()}handleExitClick(){this.exitClick.next()}}ci.\u0275fac=function(n){return new(n||ci)(i.Y36(l.yh))},ci.\u0275cmp=i.Xpm({type:ci,selectors:[["app-view-whiteboard-tools"]],viewQuery:function(n,e){if(1&n&&i.Gf(sM,7,i.SBq),2&n){let o;i.iGM(o=i.CRH())&&(e.colorBtn=o.first)}},outputs:{downloadClick:"downloadClick",clearClick:"clearClick",exitClick:"exitClick"},decls:40,vars:54,consts:[[1,"view-whiteboard-tools"],["eventCategory","View Whiteboard Tools","name","Whiteboard","padding","dense",3,"canExit","exit"],["app-pin-button","","buttonType","ghost","icon","text-size","aria-label","Text","matTooltip","Text",1,"mr-1",3,"matMenuTriggerFor","selected","click"],["app-pin-button","","buttonType","ghost","icon","paint-brush","aria-label","Brush","matTooltip","Brush",1,"mr-1",3,"matMenuTriggerFor","selected","click"],["app-pin-button","","buttonType","ghost","icon","eraser","aria-label","Eraser","matTooltip","Eraser",3,"matMenuTriggerFor","selected","disabled","click"],["app-pin-button","","buttonType","ghost","icon","tint","aria-label","Color","matTooltip","Color",3,"matMenuTriggerFor","selected"],["colorBtn","matMenuTrigger"],["app-pin-button","","buttonType","ghost","icon","download","aria-label","Download","matTooltip","Download",3,"click"],["app-pin-button","","buttonType","ghost","aria-label","Clear","matTooltip","Clear",3,"disabled","click"],["textSizeMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["brushSizeMenu","matMenu"],["eraserSizeMenu","matMenu"],["brushColorMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","flex-row","items-center","justify-end"],[1,"view-whiteboard-tools__check"],[4,"ngIf"],[1,"view-whiteboard-tools__label"],["icon","check","aria-hidden","true",1,"mr-2"],[1,"visually-hidden"],["icon","circle","aria-hidden","true",1,"mr-2"],[1,"view-whiteboard-tools__swatch"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0)(1,"app-pillbox",1),i.NdJ("exit",function(){return e.handleExitClick()}),i.ALo(2,"async"),i.TgZ(3,"button",2),i.NdJ("click",function(){return e.handleModeSelect(e.modeEnum.Text)}),i.ALo(4,"async"),i.ALo(5,"async"),i.qZA(),i.TgZ(6,"button",3),i.NdJ("click",function(){return e.handleModeSelect(e.modeEnum.Paint)}),i.ALo(7,"async"),i.ALo(8,"async"),i.ALo(9,"async"),i.qZA(),i.TgZ(10,"button",4),i.NdJ("click",function(){return e.handleModeSelect(e.modeEnum.Erase)}),i.ALo(11,"async"),i.ALo(12,"async"),i.ALo(13,"async"),i.ALo(14,"async"),i.ALo(15,"async"),i.qZA(),i._UZ(16,"app-pillbox-divider")(17,"button",5,6)(19,"app-pillbox-divider"),i.TgZ(20,"button",7),i.NdJ("click",function(){return e.handleDownloadClick()}),i.qZA(),i._UZ(21,"app-pillbox-divider"),i.TgZ(22,"button",8),i.NdJ("click",function(){return e.handleClearClick()}),i.ALo(23,"async"),i.ALo(24,"async"),i.ALo(25,"async"),i.ALo(26,"async"),i._uU(27," Clear "),i.qZA(),i.TgZ(28,"mat-menu",null,9),i.YNc(30,aM,8,4,"button",10),i.qZA(),i.TgZ(31,"mat-menu",null,11),i.YNc(33,lM,9,6,"button",10),i.qZA(),i.TgZ(34,"mat-menu",null,12),i.YNc(36,dM,9,6,"button",10),i.qZA(),i.TgZ(37,"mat-menu",null,13),i.YNc(39,gM,9,6,"button",10),i.qZA()()()),2&n){const o=i.MAs(18),s=i.MAs(29),r=i.MAs(32),a=i.MAs(35),c=i.MAs(38);i.xp6(1),i.Q6J("canExit",!1===i.lcZ(2,24,e.isLocked$)),i.xp6(2),i.Q6J("matMenuTriggerFor",s)("selected",i.lcZ(4,26,e.mode$)===e.modeEnum.Text),i.uIk("aria-pressed",i.lcZ(5,28,e.mode$)===e.modeEnum.Text),i.xp6(3),i.Q6J("matMenuTriggerFor",r)("selected",i.lcZ(7,30,e.mode$)===e.modeEnum.Paint),i.uIk("aria-selected",i.lcZ(8,32,e.mode$)===e.modeEnum.Paint)("aria-pressed",i.lcZ(9,34,e.mode$)===e.modeEnum.Paint),i.xp6(4),i.Q6J("matMenuTriggerFor",a)("selected",i.lcZ(11,36,e.mode$)===e.modeEnum.Erase)("disabled",!1===i.lcZ(14,42,e.hasPaint$)),i.uIk("aria-selected",i.lcZ(12,38,e.mode$)===e.modeEnum.Erase)("aria-pressed",i.lcZ(13,40,e.mode$)===e.modeEnum.Erase)("aria-disabled",!1===i.lcZ(15,44,e.hasPaint$)),i.xp6(7),i.Q6J("matMenuTriggerFor",c)("selected",o.menuOpen),i.uIk("aria-selected",o.menuOpen)("aria-pressed",o.menuOpen),i.xp6(5),i.Q6J("disabled",!1===i.lcZ(23,46,e.hasPaint$)&&!1===i.lcZ(24,48,e.hasText$)),i.uIk("aria-disabled",!1===i.lcZ(25,50,e.hasPaint$)&&!1===i.lcZ(26,52,e.hasText$)),i.xp6(8),i.Q6J("ngForOf",e.textSizes),i.xp6(3),i.Q6J("ngForOf",e.brushSizes),i.xp6(3),i.Q6J("ngForOf",e.eraserSizes),i.xp6(3),i.Q6J("ngForOf",e.brushColors)}},dependencies:[f.sg,f.O5,jt.VK,jt.OP,jt.p6,Gt.gM,In,lt,Wa,b_,f.Ov],styles:[".view-whiteboard-tools__check{flex:2 1 0;color:#2d72dc}.view-whiteboard-tools__label{display:flex;flex:6 1 0;align-items:center}.view-whiteboard-tools__swatch{display:inline-block;width:14px;height:14px;border-radius:50%;margin-right:8px;box-shadow:0 0 0 1px #96a8c0}\n"],encapsulation:2,changeDetection:0}),ls([(0,l.Ph)(O.isWhiteboardLocked),ps("design:type",b.y)],ci.prototype,"isLocked$",void 0),ls([(0,l.Ph)(O.getWhiteboardAnnotateMode),ps("design:type",b.y)],ci.prototype,"mode$",void 0),ls([(0,l.Ph)(O.getWhiteboardBrushSize),ps("design:type",b.y)],ci.prototype,"brushSize$",void 0),ls([(0,l.Ph)(O.getWhiteboardTextSize),ps("design:type",b.y)],ci.prototype,"textSize$",void 0),ls([(0,l.Ph)(O.getWhiteboardBrushColor),ps("design:type",b.y)],ci.prototype,"brushColor$",void 0),ls([(0,l.Ph)(O.getWhiteboardEraserSize),ps("design:type",b.y)],ci.prototype,"eraserSize$",void 0),ls([(0,l.Ph)(O.getWhiteboardHasPaint),ps("design:type",b.y)],ci.prototype,"hasPaint$",void 0),ls([(0,l.Ph)(O.getWhiteboardHasText),ps("design:type",b.y)],ci.prototype,"hasText$",void 0);var Gr=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Jr=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const hM=["drawCanvas"],mM=["annotateWrapper"];function fM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"app-view-whiteboard-label",7),i.NdJ("labelActive",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleLabelActive(s))})("labelEmpty",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleLabelEmpty(s))}),i.ALo(1,"async"),i.qZA()}if(2&t){const e=n.$implicit,o=i.oxw();i.ekj("view-whiteboard__label--clickthrough",i.lcZ(1,7,o.annotateMode$)!==o.whiteboardAnnotateMode.Text),i.Q6J("exporting",o.exporting)("id",e.id)("initialPos",e.pos)("color",e.color)("size",e.size)}}const cg=fi.PNG;class qi{constructor(n,e,o,s,r){this.store=n,this.actions=e,this.viewService=o,this.clipboardService=s,this.changeRef=r,this.whiteboardAnnotateMode=Fi,this.labels=[],this.exporting=!1,this.brushSize=0,this.eraserSize=0,this.lineWidth=0,this.ngUnsubscribe=new X.x}initTextModeListener(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Tap({event:"tap"})),this.inputManager.on("tap",n=>{if(this.activeLabelId)return void(this.activeLabelId=void 0);const e=(0,m.uniqueId)();let o=n.center.x,s=n.center.y;void 0!==n.pointers[0].x&&(o=n.pointers[0].x,s=n.pointers[0].y);const r=this.store.selectSnapshot(O.getWhiteboardBrushColor),a=this.store.selectSnapshot(O.getWhiteboardTextSize);this.labels.push({id:e,pos:{x:o,y:s},color:r,size:a}),this.activeLabelId=e,this.changeRef.markForCheck(),this.dispatchHasText()})}handleLabelActive(n){this.activeLabelId=n;const e=this.labels.find(o=>o.id===n);e&&this.store.dispatch([new T.SetWhiteboardTextSize(e.size),new T.SetWhiteboardBrushColor(e.color)])}handleLabelEmpty(n){this.labels=this.labels.filter(e=>e.id!==n),this.changeRef.markForCheck(),this.dispatchHasText()}dispatchHasText(){this.store.dispatch(new T.SetWhiteboardHasText(this.labels.length>0))}ngOnInit(){this.canvasElement=this.drawCanvas.nativeElement,this.canvasContext=this.canvasElement.getContext("2d"),this.siteHeader=this.store.selectSnapshot(Et.getSiteHeader),this.store.dispatch(new Mn.SetHeader(Rs.Hide)),this.brushColor$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.labels.find(o=>o.id===this.activeLabelId);e&&(e.color=n,this.changeRef.markForCheck())}),this.textSize$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.labels.find(o=>o.id===this.activeLabelId);e&&(e.size=n,this.changeRef.markForCheck())}),this.annotateMode$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.inputManager&&this.inputManager.destroy(),n===Fi.Paint?(this.canvasContext.globalCompositeOperation="source-over",this.setLineWidth(this.brushSize),this.initInputListeners()):n===Fi.Text?this.initTextModeListener():n===Fi.Erase&&(this.canvasContext.globalCompositeOperation="destination-out",this.setLineWidth(this.eraserSize),this.initInputListeners())}),this.background$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=vf(n)?hC:mC;this.store.dispatch(new T.SetWhiteboardBrushColor(e.color))})}ngAfterViewInit(){this.initCanvasListeners()}ngOnDestroy(){this.inputManager.destroy(),this.inputManager=null,this.reset(),this.store.dispatch(new Mn.SetHeader(this.siteHeader)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initCanvasListeners(){this.brushSize$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.setBrushSize(n)}),this.brushColor$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.setBrushColor(n)}),this.eraserSize$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.setEraserSize(n)}),this.syncCanvas()}initInputListeners(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Pan({event:"pan",pointers:0})),this.inputManager.add(new Hammer.Tap({event:"tap"}));const n=new Map;this.inputManager.on("tap",e=>{e.pointers.forEach(o=>{if(void 0!==o.x){const{x:s,y:r}=o;this.drawPoint(s,r)}else{const{x:s,y:r}=e.center;this.drawPoint(s,r)}this.checkCanvasPaint()})}),this.inputManager.on("panstart",e=>{e.pointers.forEach(o=>{if(void 0===o.x)n.set(1,e.center);else{const{x:s,y:r}=o;n.set(o.pointerId,{x:s,y:r})}})}),this.inputManager.on("pan",e=>{e.pointers.forEach(o=>{let s=e.center.x,r=e.center.y,a=1;void 0!==o.pointerId&&(s=o.x,r=o.y,a=o.pointerId);const{x:c,y:p}=n.get(a);this.drawLine(c,p,s,r),this.drawPoint(s,r),n.set(a,{x:s,y:r})})}),this.inputManager.on("panend",()=>{n.clear(),this.checkCanvasPaint()})}handleResetClick(){this.reset()}handleDownloadClick(){this.exporting=!0,this.changeRef.detectChanges();const{width:n,height:e}=this.canvasElement,o=this.store.selectSnapshot(_.getSelectedChapterId),s=this.store.selectSnapshot(_.getSelectedChapterBackground),r=this.store.selectSnapshot(M.getWatermarkEnabled),a=document.querySelector(".engine__watermark"),c=[this.annotateElement.nativeElement];r&&!(0,m.isNil)(a)&&c.push(a),this.store.dispatch(new xr(o,s,cg,100,{width:n,height:e},"original",!0,!0,c)).pipe((0,Ii.V)(()=>this.actions.pipe((0,l.xt)(vr),(0,yt.q)(1))),(0,w.R)(this.ngUnsubscribe),(0,je.x)(()=>{this.exporting=!1,this.changeRef.markForCheck()})).subscribe(p=>{this.downloadSnapshot(p.blob)})}handleExitClick(){this.resetCanvas(),this.viewService.toggleWhiteboard(!1)}checkCanvasPaint(){const n=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),o=new Uint32Array(n.data.buffer).some(s=>0!==s);this.store.dispatch(new T.SetWhiteboardHasPaint(o))}drawPoint(n,e){const o=this.lineWidth/2,s=2*Math.PI;this.canvasContext.beginPath(),this.canvasContext.arc(n,e,o,0,s),this.canvasContext.fill()}drawLine(n,e,o,s){this.canvasContext.beginPath(),this.canvasContext.moveTo(n,e),this.canvasContext.lineTo(o,s),this.canvasContext.stroke(),this.canvasContext.closePath()}reset(){this.resetCanvas(),this.labels=[],this.changeRef.markForCheck(),this.dispatchHasText()}setBrushSize(n){this.brushSize=n,this.setLineWidth(n)}setBrushColor(n){this.canvasContext.fillStyle=n,this.canvasContext.strokeStyle=n}setEraserSize(n){this.eraserSize=n,this.setLineWidth(n)}setLineWidth(n){this.canvasContext.lineWidth=n,this.lineWidth=n}syncCanvas(){const n=this.store.selectSnapshot(O.getWhiteboardBrushSize),e=this.store.selectSnapshot(O.getWhiteboardBrushColor),o=this.store.selectSnapshot(O.getWhiteboardEraserSize),{width:s,height:r}=this.getScreenDimensions();this.canvasElement.width=s,this.canvasElement.height=r,this.setBrushSize(n),this.setBrushColor(e),this.setEraserSize(o),this.canvasContext.lineJoin="round"}resetCanvas(){const{width:n,height:e}=this.canvasElement;this.canvasContext.clearRect(0,0,n,e),this.store.dispatch(new T.SetWhiteboardHasPaint(!1))}downloadSnapshot(n){const{displayName:e}=this.store.selectSnapshot(we.getStory),r=`${(e||"").replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}_drawing.${cg===fi.PNG?"png":"jpg"}`;!0===se.native||se.platform===Yi.SDK?So.blobToBase64(n).pipe((0,Ii.V)(a=>this.clipboardService.copyToClipboard(a,"image")),(0,w.R)(this.ngUnsubscribe)).subscribe(a=>{}):So.exportImage(n,cg,r)}getScreenDimensions(){const{innerWidth:n,innerHeight:e}=window;return{width:n,height:e}}}qi.\u0275fac=function(n){return new(n||qi)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(ut),i.Y36(Vl),i.Y36(i.sBO))},qi.\u0275cmp=i.Xpm({type:qi,selectors:[["app-view-whiteboard"]],viewQuery:function(n,e){if(1&n&&(i.Gf(hM,7),i.Gf(mM,7)),2&n){let o;i.iGM(o=i.CRH())&&(e.drawCanvas=o.first),i.iGM(o=i.CRH())&&(e.annotateElement=o.first)}},decls:10,vars:15,consts:[[1,"view-whiteboard"],["annotateWrapper",""],["class","view-whiteboard__label",3,"view-whiteboard__label--clickthrough","exporting","id","initialPos","color","size","labelActive","labelEmpty",4,"ngFor","ngForOf"],["data-test","drawCanvas",1,"view-whiteboard__canvas"],["drawCanvas",""],[1,"view-whiteboard__tools"],[3,"clearClick","downloadClick","exitClick"],[1,"view-whiteboard__label",3,"exporting","id","initialPos","color","size","labelActive","labelEmpty"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0,1),i.ALo(2,"async"),i.ALo(3,"async"),i.ALo(4,"async"),i.YNc(5,fM,2,9,"app-view-whiteboard-label",2),i._UZ(6,"canvas",3,4),i.TgZ(8,"div",5)(9,"app-view-whiteboard-tools",6),i.NdJ("clearClick",function(){return e.handleResetClick()})("downloadClick",function(){return e.handleDownloadClick()})("exitClick",function(){return e.handleExitClick()}),i.qZA()()()),2&n&&(i.ekj("view-whiteboard--exporting",e.exporting)("view-whiteboard--cursor-paint",i.lcZ(2,9,e.annotateMode$)===e.whiteboardAnnotateMode.Paint)("view-whiteboard--cursor-erase",i.lcZ(3,11,e.annotateMode$)===e.whiteboardAnnotateMode.Erase)("view-whiteboard--cursor-text",i.lcZ(4,13,e.annotateMode$)===e.whiteboardAnnotateMode.Text),i.xp6(5),i.Q6J("ngForOf",e.labels))},dependencies:[f.sg,oM,ci,f.Ov],styles:[".view-whiteboard{position:fixed;inset:0;z-index:20;display:flex;flex-direction:column;align-items:center;justify-content:space-between;box-shadow:inset 0 0 0 4px #38de38;padding:8px;transition:border .3s linear}.view-whiteboard--exporting{box-shadow:none}.view-whiteboard--exporting .view-whiteboard__tools{display:none}.view-whiteboard--cursor-paint:hover{cursor:url(/assets/images/cursor-whiteboard-paint.svg) 7 20,pointer}.view-whiteboard--cursor-erase:hover{cursor:url(/assets/images/cursor-whiteboard-erase.svg) 7 20,pointer}.view-whiteboard--cursor-text:hover{cursor:url(/assets/images/cursor-whiteboard-text.svg) 7 20,pointer}.view-whiteboard__label{position:absolute;top:0;left:0;z-index:10}.view-whiteboard__label--clickthrough{pointer-events:none}.view-whiteboard__canvas{position:fixed;inset:0;z-index:1}.view-whiteboard__tools{z-index:1;right:8px;bottom:8px;position:absolute}\n"],encapsulation:2,changeDetection:0}),Gr([(0,l.Ph)(O.getWhiteboardAnnotateMode),Jr("design:type",b.y)],qi.prototype,"annotateMode$",void 0),Gr([(0,l.Ph)(O.getWhiteboardBrushSize),Jr("design:type",b.y)],qi.prototype,"brushSize$",void 0),Gr([(0,l.Ph)(O.getWhiteboardBrushColor),Jr("design:type",b.y)],qi.prototype,"brushColor$",void 0),Gr([(0,l.Ph)(O.getWhiteboardTextSize),Jr("design:type",b.y)],qi.prototype,"textSize$",void 0),Gr([(0,l.Ph)(O.getWhiteboardEraserSize),Jr("design:type",b.y)],qi.prototype,"eraserSize$",void 0),Gr([(0,l.Ph)(_.getSelectedChapterBackground),Jr("design:type",b.y)],qi.prototype,"background$",void 0);const xM=["viewColumn"];function vM(t,n){if(1&t&&(i.TgZ(0,"div",6),i._UZ(1,"app-spinner",7),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(1),i.Q6J("label",null==(o=i.lcZ(2,1,e.scrim$))?null:o.label)}}const CM=[[["","view-column-header",""]],"*"],wM=function(t,n,e){return{"view-column--unpadded":t,"view-column--left":n,"view-column--right":e}};class $s{constructor(){this.unpadded=!1,this.placement="left"}ngOnInit(){}}$s.\u0275fac=function(n){return new(n||$s)},$s.\u0275cmp=i.Xpm({type:$s,selectors:[["app-view-column"]],viewQuery:function(n,e){if(1&n&&i.Gf(xM,5),2&n){let o;i.iGM(o=i.CRH())&&(e.viewColumn=o.first)}},inputs:{unpadded:"unpadded",placement:"placement"},ngContentSelectors:["[view-column-header]","*"],decls:9,vars:8,consts:[[1,"view-column",3,"ngClass"],["viewColumn",""],["class","view-column__scrim",4,"ngIf"],[1,"view-column__inner"],[1,"view-column__header"],[1,"view-column__body"],[1,"view-column__scrim"],["size","large",3,"label"]],template:function(n,e){if(1&n&&(i.F$t(CM),i.TgZ(0,"div",0,1),i.YNc(2,vM,3,3,"div",2),i.ALo(3,"async"),i.TgZ(4,"article",3)(5,"div",4),i.Hsn(6),i.qZA(),i.TgZ(7,"div",5),i.Hsn(8,1),i.qZA()()()),2&n){let o;i.Q6J("ngClass",i.kEZ(4,wM,e.unpadded,"left"===e.placement,"right"===e.placement)),i.xp6(2),i.Q6J("ngIf",null==(o=i.lcZ(3,2,e.scrim$))?null:o.show)}},dependencies:[f.mk,f.O5,Da,f.Ov],styles:[".view-column[_ngcontent-%COMP%]{pointer-events:initial;background:#ffffff;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;color:#131c2a;width:320px;height:100%;position:absolute;z-index:30}.view-column--left[_ngcontent-%COMP%]{left:0}.view-column--right[_ngcontent-%COMP%]{right:0;box-shadow:0 -1px 24px #0006}.view-column--unpadded[_ngcontent-%COMP%]   .view-column__body[_ngcontent-%COMP%]{padding:0}.view-column__inner[_ngcontent-%COMP%]{background:#ffffff;border-right:1px solid #eaeff5;display:flex;flex-direction:column;height:100%;width:320px;position:absolute;left:0;z-index:10}.view-column__header[_ngcontent-%COMP%]{flex-shrink:1;background:#ffffff}.view-column__header[_ngcontent-%COMP%]:empty{display:none}.view-column__body[_ngcontent-%COMP%]{overflow-y:auto;flex-grow:1;height:100%;padding:16px 12px}.view-column__scrim[_ngcontent-%COMP%]{background-color:#fff;position:absolute;display:flex;justify-content:center;align-items:center;z-index:50;inset:0}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(O.getScrim),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],$s.prototype,"scrim$",void 0);var k_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},O_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function PM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleCloseClick())}),i.qZA()}2&t&&i.uIk("aria-label","Close")}function kM(t,n){if(1&t&&(i.TgZ(0,"i",8),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.node.info.latinLabel," ")}}function OM(t,n){if(1&t&&i._UZ(0,"p",9),2&t){const e=i.oxw();i.ekj("text-italic",!(null!=e.node.info&&e.node.info.description)),i.Q6J("innerHTML",e.formatHTML((null==e.node.info?null:e.node.info.description)||"No description available"),i.oJD)}}function TM(t,n){if(1&t&&(i.TgZ(0,"a",10),i._uU(1," View source "),i.qZA()),2&t){const e=i.oxw();i.uIk("href",null==e.node.info?null:e.node.info.sourceLink,i.LSH)}}const MM=function(t,n){return{"view-node-description--layout-column":t,"view-node-description--layout-drawer":n}};class Gs{constructor(n,e,o){this.store=n,this.actions=e,this.changeRef=o,this.layout=Tn.Drawer,this.showClose=!0,this.isOpen=!1,this.ngUnsubscribe=new X.x}ngOnInit(){this.initInfoListeners(),this.store.select(Se.getSelectedNode).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{void 0!==n&&(this.node=this.store.selectSnapshot(M.getViewGraphNode)(n.objectId))})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleHideClick(n){this.store.dispatch(new rn(!1,[n.id]))}handleCloseClick(){const n=this.store.selectSnapshot(O.getUI);n.nodeInfo.status=Pe.Hide,this.store.dispatch(new T.SetUI(n))}initInfoListeners(){this.actions.pipe((0,l.cx)(Pc,om,xa),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.isOpen=!0,this.changeRef.markForCheck()})}formatHTML(n){return n.trim().replace(new RegExp("\r?\n","g"),"<br><br>")}}Gs.\u0275fac=function(n){return new(n||Gs)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(i.sBO))},Gs.\u0275cmp=i.Xpm({type:Gs,selectors:[["app-view-node-description"]],inputs:{layout:"layout",showClose:"showClose"},decls:9,vars:11,consts:[[1,"view-node-description",3,"ngClass"],[1,"view-node-description__header","mb-3"],["type","button","app-pin-button","","size","small","icon","arrow-left","class","mr-1 mt-1",3,"click",4,"ngIf"],[1,"view-node-description__title"],["class","mv-1 text-14 text-medium text-italic",4,"ngIf"],["class","view-node-description__body mv-2",3,"text-italic","innerHTML",4,"ngIf"],["class","view-node-description__attribution text-link text-underline mv-1","target","_blank","rel","noreferrer nofollow",4,"ngIf"],["type","button","app-pin-button","","size","small","icon","arrow-left",1,"mr-1","mt-1",3,"click"],[1,"mv-1","text-14","text-medium","text-italic"],[1,"view-node-description__body","mv-2",3,"innerHTML"],["target","_blank","rel","noreferrer nofollow",1,"view-node-description__attribution","text-link","text-underline","mv-1"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,PM,1,1,"button",2),i.TgZ(3,"h2",3),i._uU(4),i.qZA()(),i.YNc(5,kM,2,1,"i",4),i.YNc(6,OM,1,3,"p",5),i.ALo(7,"async"),i.YNc(8,TM,2,1,"a",6),i.qZA()),2&n&&(i.Q6J("ngClass",i.WLB(8,MM,"column"===e.layout,"drawer"===e.layout)),i.xp6(2),i.Q6J("ngIf",e.showClose),i.xp6(2),i.Oqu(null==e.node?null:e.node.label),i.xp6(1),i.Q6J("ngIf",null==e.node.info?null:e.node.info.latinLabel),i.xp6(1),i.Q6J("ngIf",!i.lcZ(7,6,e.querying$)),i.xp6(2),i.Q6J("ngIf",null==e.node.info?null:e.node.info.sourceLink))},dependencies:[f.mk,f.O5,In,f.Ov],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-node-description{display:flex;flex-direction:column}.view-node-description--layout-drawer .view-node-description__body{margin-top:8px}.view-node-description--layout-column .view-node-description__body{margin-top:4px}.view-node-description__header{display:flex}.view-node-description__title{font-size:18px;letter-spacing:.45px;line-height:1.4em;flex:1 1 auto;font-weight:600;align-self:center}.view-node-description--layout-drawer .view-node-description__title{font-size:14px;letter-spacing:.35px;line-height:1.4em}.view-node-description__body{font-size:14px;letter-spacing:.35px;line-height:1.4em;color:#374a68}.view-node-description__attribution{font-size:12px;letter-spacing:.3px;line-height:1.4em;color:#374a68}.view-node-description__actions{cursor:pointer;outline:none;border:none;background:transparent;padding:4px 8px}\n"],encapsulation:2,changeDetection:0}),k_([(0,l.Ph)(M.getQuerying),O_("design:type",b.y)],Gs.prototype,"querying$",void 0),k_([(0,l.Ph)(we.getStoryLanguage),O_("design:type",b.y)],Gs.prototype,"storyLanguage$",void 0);let IM=(()=>{class t{constructor(){}supportsWebGl(){const e=document.createElement("canvas"),o=e.getContext("webgl")||e.getContext("experimental-webgl");return o&&o instanceof WebGLRenderingContext}isHoverSupported(){return window.matchMedia("(hover: hover)").matches}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),T_=(()=>{class t{constructor(e,o){this.el=e,this.compatibilityService=o}ngAfterContentInit(){this.compatibilityService.isHoverSupported()&&setTimeout(()=>{this.el.nativeElement.focus()},0)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.SBq),i.Y36(IM))},t.\u0275dir=i.lG2({type:t,selectors:[["input","appAutoFocus",""]]}),t})(),zM=(()=>{class t{constructor(){}onClick(e,o){o.select()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=i.lG2({type:t,selectors:[["","appSelectOnFocus",""]],hostBindings:function(e,o){1&e&&i.NdJ("click",function(r){return o.onClick(r,r.target)})}}),t})();var M_=A(2324);function I_(t,n,e){rm(t,n);const o=va(e,n.id);if(o){const s=t.successors[o]||[];return s.push(n.id),t.successors[o]=(0,m.uniq)(s),t.predecessors[n.id]=o,I_(t,ni(e,o),e)}return function q0(t,n){rm(t,n);const e=ni(t,n.id);t.roots[e.id]=e}(t,n),t}var Ka=A(7376);class ei{}class ds{}var lg,Hl=(()=>(function(t){t[t.Modify=0]="Modify",t[t.Replace=1]="Replace"}(Hl||(Hl={})),Hl))(),Vt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},fe=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const z_={currentRecipe:{tintColor:[1,0,0],saturation:!1,contrast:!1,brightness:!1,opacity:!1},brushMode:Hl.Replace,storyRecipes:{},recentRecipes:[],uniqueStoryRecipes:[],palettes:[]};let gt=lg=class{constructor(n){this.storageService=n}static getCurrentRecipe(n){return n.currentRecipe}static getCurrentRecipeForEngine(n){return Is(n.currentRecipe)}static getPaintBrushMode(n){return n.brushMode}static getRecentRecipes(n){return n.recentRecipes}static getStoryRecipes(n){return n.storyRecipes}static getUniqueStoryRecipes(n){return n.uniqueStoryRecipes}static getPalettes(n){return n.palettes}static getCurrentChapterRecipes(n,e){return n.storyRecipes[e.selectedChapter]}static getChapterRecipes(n){return(0,l.P1)([lg],e=>e.storyRecipes[n])}setCurrentRecipe(n,{colorRecipe:e}){n.patchState({currentRecipe:e})}setBrushMode(n,e){n.patchState({brushMode:e.brushMode})}clearCurrentRecipe(n,e){n.patchState({currentRecipe:null})}resetPaint(n,e){n.setState(z_)}addRecentRecipe(n,e){let o=n.getState().recentRecipes;o.some(r=>function J1(t,n){return!(!t||!n)&&JSON.stringify(t,Object.keys(t).sort())===JSON.stringify(n,Object.keys(n).sort())}(r,e.recipe))||(o.splice(0,0,e.recipe),o.length>14&&(o=o.slice(0,14)),this.storageService.setLocalItem(fn.RecentRecipes,o),n.patchState({recentRecipes:[...o]}))}setRecentRecipes(n,e){const o=(0,m.isNil)(e.recipes)?[]:[...e.recipes];n.patchState({recentRecipes:o}),this.storageService.setLocalItem(fn.RecentRecipes,o)}setStoryRecipesForChapter(n,e){const o=Tf(e.recipes),s=n.getState().storyRecipes;s[e.chapterId]=[...o],n.patchState({storyRecipes:s});const a=Tf(Object.values(s).reduce((c,p)=>[...c,...p],[])).sort(Y1);n.patchState({uniqueStoryRecipes:a})}resetStoryRecipes(n,e){n.patchState({storyRecipes:{}})}addPalette(n,e){e.palette.id=$t.idWithPrefix("palette");const o=[...n.getState().palettes,e.palette];n.dispatch(new Zs(o))}updatePalette(n,e){const o=n.getState().palettes,s=o.findIndex(r=>r.id===e.palette.id);s>=0&&(o[s]={...e.palette}),n.dispatch(new Zs(o))}removePalette(n,e){const o=[...n.getState().palettes.filter(s=>s.id!==e.paletteId)];n.dispatch(new Zs(o))}setPalettes(n,e){const o=(0,m.cloneDeep)(e.palettes?[...e.palettes]:[]);n.patchState({palettes:o}),localStorage.setItem(fn.PaintPalettes,JSON.stringify(o))}addRecipeToPalette(n,e){const o=n.getState().palettes,s=o.findIndex(r=>r.id===e.paletteId);s>=0&&o[s].recipes.push(e.recipe),n.dispatch(new Zs(o))}togglePalette(n,e){const o=n.getState().palettes,s=o.findIndex(r=>r.id===e.paletteId);s>=0&&(o[s].open=(0,m.isNil)(e.open)?!o[s].open:e.open,n.dispatch(new Zs(o)))}ngxsOnInit(n){}};gt.\u0275fac=function(n){return new(n||gt)(i.LFG(dn))},gt.\u0275prov=i.Yz7({token:gt,factory:gt.\u0275fac}),Vt([(0,l.aU)(og),fe("design:type",Function),fe("design:paramtypes",[Object,og]),fe("design:returntype",void 0)],gt.prototype,"setCurrentRecipe",null),Vt([(0,l.aU)(r_),fe("design:type",Function),fe("design:paramtypes",[Object,r_]),fe("design:returntype",void 0)],gt.prototype,"setBrushMode",null),Vt([(0,l.aU)(sg),fe("design:type",Function),fe("design:paramtypes",[Object,sg]),fe("design:returntype",void 0)],gt.prototype,"clearCurrentRecipe",null),Vt([(0,l.aU)(rg),fe("design:type",Function),fe("design:paramtypes",[Object,rg]),fe("design:returntype",void 0)],gt.prototype,"resetPaint",null),Vt([(0,l.aU)(a_),fe("design:type",Function),fe("design:paramtypes",[Object,a_]),fe("design:returntype",void 0)],gt.prototype,"addRecentRecipe",null),Vt([(0,l.aU)(c_),fe("design:type",Function),fe("design:paramtypes",[Object,c_]),fe("design:returntype",void 0)],gt.prototype,"setRecentRecipes",null),Vt([(0,l.aU)(p_),fe("design:type",Function),fe("design:paramtypes",[Object,p_]),fe("design:returntype",void 0)],gt.prototype,"setStoryRecipesForChapter",null),Vt([(0,l.aU)(l_),fe("design:type",Function),fe("design:paramtypes",[Object,l_]),fe("design:returntype",void 0)],gt.prototype,"resetStoryRecipes",null),Vt([(0,l.aU)(d_),fe("design:type",Function),fe("design:paramtypes",[Object,d_]),fe("design:returntype",void 0)],gt.prototype,"addPalette",null),Vt([(0,l.aU)(g_),fe("design:type",Function),fe("design:paramtypes",[Object,g_]),fe("design:returntype",void 0)],gt.prototype,"updatePalette",null),Vt([(0,l.aU)(u_),fe("design:type",Function),fe("design:paramtypes",[Object,u_]),fe("design:returntype",void 0)],gt.prototype,"removePalette",null),Vt([(0,l.aU)(Zs),fe("design:type",Function),fe("design:paramtypes",[Object,Zs]),fe("design:returntype",void 0)],gt.prototype,"setPalettes",null),Vt([(0,l.aU)(h_),fe("design:type",Function),fe("design:paramtypes",[Object,h_]),fe("design:returntype",void 0)],gt.prototype,"addRecipeToPalette",null),Vt([(0,l.aU)(m_),fe("design:type",Function),fe("design:paramtypes",[Object,m_]),fe("design:returntype",void 0)],gt.prototype,"togglePalette",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getCurrentRecipe",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getCurrentRecipeForEngine",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getPaintBrushMode",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getRecentRecipes",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getStoryRecipes",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getUniqueStoryRecipes",null),Vt([(0,l.Qf)(),fe("design:type",Function),fe("design:paramtypes",[ds]),fe("design:returntype",void 0)],gt,"getPalettes",null),Vt([(0,l.Qf)([_]),fe("design:type",Function),fe("design:paramtypes",[ds,Ge]),fe("design:returntype",void 0)],gt,"getCurrentChapterRecipes",null),gt=lg=Vt([(0,l.ZM)({name:"editPaint",defaults:z_}),fe("design:paramtypes",[dn])],gt);class Js{constructor(n,e,o){this.label=n,this.width=e,this.height=o}}const A_=new Js("Don't Resize",-1,-1);new Js("Common (Mobile)",360,640),new Js("Common (Minimum)",300,300);new Js("Common (Publish Default)",700,550),new Js("iPhone X",375,812),new Js("iPad (Portrait)",768,1024),new Js("iPad (Landscape)",1024,768);var kt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},oe=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const L_={view:Bs.Chapter,showColumns:!0,showLeftColumn:!0,showRightColumn:!0,showHeader:!0,showFooter:!0,showTimelineEditor:!1,autoCapture:se.application!==mt.Loft,record:!0,layerOrderMode:!1,showTreeNodeIds:!1,showRootNodes:!1,canvasSize:A_,canvasSettings:{emulateDrawer:!0,emulateColumn:!0}};let Ye=class{constructor(n){this.storageService=n}static getView(n){return n.view}static getShowColumns(n){return n.showColumns}static getShowLeftColumn(n){return n.showLeftColumn}static getShowRightColumn(n){return n.showRightColumn}static getShowHeader(n){return n.showHeader}static getShowFooter(n){return n.showFooter}static getShowTimelineEditor(n){return n.showTimelineEditor}static getRecord(n){return n.record}static getLayerOrderMode(n){return n.layerOrderMode}static getShowTreeNodeIds(n){return n.showTreeNodeIds}static getCanvasSize(n){return n.canvasSize}static getCanvasSettings(n){return n.canvasSettings}static getAutoCapture(n){return n.autoCapture}static getShowRootNodes(n){return n.showRootNodes}SetLayerOrderMode(n,e){n.patchState({layerOrderMode:e.layerOrderMode})}ShowTreeNodeIds(n,e){const o=null!=e.show?e.show:!n.getState().showTreeNodeIds;n.patchState({showTreeNodeIds:o})}showRootNodes(n,e){n.patchState({showRootNodes:e.show})}setView(n,e){n.patchState({view:e.view})}nextView(n,e){const{view:o}=n.getState(),s=Object.values(Bs),r=s[s.indexOf(o)+1]||s[0];n.patchState({view:r})}previousView(n,e){const{view:o}=n.getState(),s=Object.values(Bs),r=s[s.indexOf(o)-1]||s[s.length-1];n.patchState({view:r})}showColumns(n,e){n.patchState({showColumns:e.show})}showColumn(n,e){switch(e.column){case"left":n.patchState({showLeftColumn:e.show});break;case"right":n.patchState({showRightColumn:e.show});break;case"header":n.patchState({showHeader:e.show});break;case"footer":n.patchState({showFooter:e.show})}}showTimelineEditor(n,e){n.patchState({showTimelineEditor:e.show})}resetEditPage(n,e){n.setState(L_),n.dispatch(new rg)}setCanvasSize(n,e){n.patchState({canvasSize:e.size})}autoCapture(n,e){n.patchState({autoCapture:e.enable}),se.application===mt.Studio&&this.storageService.setLocalItem(fn.AutoCapture,e.enable)}ngxsOnInit(n){setTimeout(()=>{this.initAutoCapture(n)})}initAutoCapture(n){if(se.application===mt.Studio){const e=this.storageService.getLocalJSON(fn.AutoCapture);"boolean"==typeof e&&n.patchState({autoCapture:e})}}};Ye.\u0275fac=function(n){return new(n||Ye)(i.LFG(dn))},Ye.\u0275prov=i.Yz7({token:Ye,factory:Ye.\u0275fac}),kt([(0,l.aU)(Ay),oe("design:type",Function),oe("design:paramtypes",[Object,Ay]),oe("design:returntype",void 0)],Ye.prototype,"SetLayerOrderMode",null),kt([(0,l.aU)(Ly),oe("design:type",Function),oe("design:paramtypes",[Object,Ly]),oe("design:returntype",void 0)],Ye.prototype,"ShowTreeNodeIds",null),kt([(0,l.aU)(Fy),oe("design:type",Function),oe("design:paramtypes",[Object,Fy]),oe("design:returntype",void 0)],Ye.prototype,"showRootNodes",null),kt([(0,l.aU)(Bu),oe("design:type",Function),oe("design:paramtypes",[Object,Bu]),oe("design:returntype",void 0)],Ye.prototype,"setView",null),kt([(0,l.aU)(Vu),oe("design:type",Function),oe("design:paramtypes",[Object,Vu]),oe("design:returntype",void 0)],Ye.prototype,"nextView",null),kt([(0,l.aU)(Y2),oe("design:type",Function),oe("design:paramtypes",[Object,Vu]),oe("design:returntype",void 0)],Ye.prototype,"previousView",null),kt([(0,l.aU)(My),oe("design:type",Function),oe("design:paramtypes",[Object,My]),oe("design:returntype",void 0)],Ye.prototype,"showColumns",null),kt([(0,l.aU)(Iy),oe("design:type",Function),oe("design:paramtypes",[Object,Iy]),oe("design:returntype",void 0)],Ye.prototype,"showColumn",null),kt([(0,l.aU)(zy),oe("design:type",Function),oe("design:paramtypes",[Object,zy]),oe("design:returntype",void 0)],Ye.prototype,"showTimelineEditor",null),kt([(0,l.aU)(qu),oe("design:type",Function),oe("design:paramtypes",[Object,qu]),oe("design:returntype",void 0)],Ye.prototype,"resetEditPage",null),kt([(0,l.aU)(Uy),oe("design:type",Function),oe("design:paramtypes",[Object,Uy]),oe("design:returntype",void 0)],Ye.prototype,"setCanvasSize",null),kt([(0,l.aU)(Ry),oe("design:type",Function),oe("design:paramtypes",[Object,Ry]),oe("design:returntype",void 0)],Ye.prototype,"autoCapture",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getView",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowColumns",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowLeftColumn",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowRightColumn",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowHeader",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowFooter",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowTimelineEditor",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getRecord",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getLayerOrderMode",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowTreeNodeIds",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getCanvasSize",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getCanvasSettings",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getAutoCapture",null),kt([(0,l.Qf)(),oe("design:type",Function),oe("design:paramtypes",[ei]),oe("design:returntype",void 0)],Ye,"getShowRootNodes",null),Ye=kt([(0,l.ZM)({name:"edit",defaults:L_,children:[gt]}),oe("design:paramtypes",[dn])],Ye);var Yl=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Wl=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function DM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",11),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExpandClick(s.node,s.node.boolState.expanded))}),i._UZ(1,"app-icon",12),i.qZA()}if(2&t){const e=i.oxw();i.Q6J("buttonTheme",e.theme),i.uIk("aria-label",e.node.boolState.expanded?"Collapse "+e.node.label:"Expand "+e.node.label)("aria-expanded",e.node.boolState.expanded),i.xp6(1),i.ekj("rotate-45",e.node.boolState.expanded)}}function jM(t,n){if(1&t&&(i.TgZ(0,"div",18),i._uU(1),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.hij(" ",e.shortId," ")}}const QM=function(t){return{"tree-node__label--padded":t}};function ZM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",13),i.NdJ("dblclick",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.setEditLabelMode(!0))}),i.TgZ(1,"div",14),i.YNc(2,jM,2,1,"div",15),i.ALo(3,"async"),i.TgZ(4,"div",16)(5,"span",17),i._uU(6,"Select"),i.qZA(),i._uU(7),i.qZA()()()}if(2&t){const e=i.oxw();i.Q6J("ngClass",i.VKq(6,QM,!e.hasChildren&&e.nested)),i.uIk("aria-current",e.checked),i.xp6(2),i.Q6J("ngIf",i.lcZ(3,4,e.showTreeNodeIds$)),i.xp6(5),i.hij(" ",e.node.label," ")}}function BM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"input",19),i.NdJ("blur",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleObjectLabel(s))})("keyup",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleObjectLabel(s))}),i.qZA()}if(2&t){const e=i.oxw();i.Q6J("value",e.node.label)}}function VM(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"input",20),i.NdJ("change",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleLayerOrder(s,r.node))}),i.qZA()}if(2&t){const e=i.oxw();i.Q6J("value",e.node.numState.layer)}}const qM=function(t,n,e,o){return{"tree-node--light":t,"tree-node--hidden":n,"tree-node--selected":e,"tree-node--unpickable":o}};class ro{constructor(n,e,o,s,r){this.store=n,this.graphService=e,this.sceneService=o,this.router=s,this.changeDetection=r,this.themeEnum=Ei,this.isLoft="module"===se.exportType,this.nested=!0,this._theme=Ei.Dark,this.checked=!1,this.hasChildren=!1,this.editLabelMode=!1,this.sanitizedID="",this.parentId="",this.shortId="",this.ngUnsubscribe=new X.x}get node(){return this._node}set node(n){this._node=n,this.sanitizedID=this.graphService.sanitizeNodeID(this.node.id),this.checked=this.isNodeChecked(this.node.id);const e=this.node.id.split("-");2===e.length?(this.parentId=e[0],this.shortId=e[1]):(this.shortId=e[0],this.parentId=""),this.shortId=this.shortId.replace(/_/g," "),this.nested&&(this.hasChildren=xo(this.graph,this.node.id).length>0),this.changeDetection.markForCheck()}get theme(){return this._theme}set theme(n){this._theme=n}isNodeChecked(n){return this.store.selectSnapshot(Se.getNodes)[n].checked}isNodeShown(n){return this.store.selectSnapshot(Se.getNodes)[n].shown}ngOnInit(){this.checkedNodesIds$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.checked=n.some(e=>e===this.node.id),this.changeDetection.markForCheck()}),this.labelEditNode$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.editLabelMode=n===this.node}),this.isEditMode=this.router.url.indexOf("/edit")>=0}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleExpandClick(n,e){this.store.dispatch(e?new wc(n):new ur(n))}handleNodeClick(n,e){n.shiftKey?this.checkNode(e):(this.setCheckedNodes(e),this.isFlyToNodeEnabled(e)&&this.store.dispatch(new Wi(e.id)),this.handleExpandClick(e,!e.boolState.expanded))}toggleVisible(n,e){const o=void 0===e?!this.isNodeShown(n.id):e;this.store.dispatch(new rn(o,[n.id])),this.changeDetection.markForCheck()}handleLayerOrder(n,e){const s=parseInt(n.target.value,10);this.setLayerOrder(e,s)}checkNode(n,e){const o=void 0===e?!this.isNodeChecked(n.id):e;this.store.dispatch(new Rt(o,[n.id]))}setCheckedNodes(n,e){this.store.dispatch(new Rt(!1));const o=void 0===e?!this.isNodeChecked(n.id):e;this.store.dispatch(new Rt(o,[n.id]))}setLayerOrder(n,e){this.store.dispatch(new Wp([n],e)),this.changeDetection.markForCheck()}handleObjectLabel(n){const e=n.target;n instanceof KeyboardEvent?("enter"===n.key.toLowerCase()&&(this.setLabel(e.value),this.setEditLabelMode(!1)),"escape"===n.key.toLowerCase()&&this.setEditLabelMode(!1)):n instanceof FocusEvent&&"blur"===n.type&&(this.setLabel(e.value),this.setEditLabelMode(!1))}setLabel(n){this.node.label=n,this.store.dispatch(new Kp(this.node.id,n))}setEditLabelMode(n){this.isEditMode&&this.store.dispatch(new Sc(n?this.node:null))}isFlyToNodeEnabled(n){return!this.isEditMode&&(n.boolState.shown||this.sceneService.isObjectLoaded(n.id))}}function $M(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2).$implicit,r=i.oxw();return i.KtG(r.handleExpandClick(s,!0))}),i.qZA()}if(2&t){const e=i.oxw(2).$implicit;i.Q6J("title",e.label)}}function GM(t,n){if(1&t&&(i.TgZ(0,"div",4),i.YNc(1,$M,1,1,"div",5),i._UZ(2,"app-tree-group",2),i.qZA()),2&t){const e=i.oxw().$implicit,o=i.oxw();i.xp6(1),i.Q6J("ngIf",o.hasChildren(e)),i.xp6(1),i.Q6J("graph",o.graph)("node",e)("theme",o.theme)}}ro.\u0275fac=function(n){return new(n||ro)(i.Y36(l.yh),i.Y36(Oi),i.Y36(Ut),i.Y36(We.F0),i.Y36(i.sBO))},ro.\u0275cmp=i.Xpm({type:ro,selectors:[["app-tree-nested-node"]],inputs:{graph:"graph",node:"node",nested:"nested",theme:"theme"},decls:14,vars:18,consts:[["data-test","treeNode",1,"tree-node",3,"ngClass","keyup.enter","click"],["app-button","","appEventFence","","buttonSize","xsmall","class","tree-node__button","data-test","treeNodeExpand",3,"buttonTheme","click",4,"ngIf"],["class","tree-node__label","tabindex","0","role","button",3,"ngClass","dblclick",4,"ngIf"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel","class","input",3,"value","blur","keyup",4,"ngIf"],["appEventFence","","type","text","data-test","treeNodeLayerOrder","class","input input--small tree-node__layer-order",3,"value","change",4,"ngIf"],["app-button","","buttonSize","xsmall","data-test","treeNodeVisible","appEventFence","",1,"tree-node__visible",3,"buttonTheme","click"],["icon","eye","data-test","treeNodeVisibleTrue","size","xs",1,"text-14","tree-node__eye"],[1,"tree-node__eye","visually-hidden"],["icon","eye-slash","data-test","treeNodeVisibleFalse","size","xs",1,"text-14","tree-node__eye-slash"],[1,"tree-node__eye-slash","visually-hidden"],["eventCategory","Search Node","appEventFence","",3,"theme","node"],["app-button","","appEventFence","","buttonSize","xsmall","data-test","treeNodeExpand",1,"tree-node__button",3,"buttonTheme","click"],["icon","caret-right",1,"inline-block","text-14"],["tabindex","0","role","button",1,"tree-node__label",3,"ngClass","dblclick"],[1,"flex","flex-column"],["data-test","treeNodeId","class","text-10 text-uppercase","style","opacity: 0.7",4,"ngIf"],["data-test","treeNodeLabel"],[1,"visually-hidden"],["data-test","treeNodeId",1,"text-10","text-uppercase",2,"opacity","0.7"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"value","blur","keyup"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"value","change"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.NdJ("keyup.enter",function(s){return e.handleNodeClick(s,e.node)})("click",function(s){return e.handleNodeClick(s,e.node)}),i.YNc(1,DM,2,5,"button",1),i.YNc(2,ZM,8,8,"div",2),i.YNc(3,BM,1,1,"input",3),i.YNc(4,VM,1,1,"input",4),i.ALo(5,"async"),i.TgZ(6,"button",5),i.NdJ("click",function(){return e.toggleVisible(e.node)}),i._UZ(7,"app-icon",6),i.TgZ(8,"span",7),i._uU(9),i.qZA(),i._UZ(10,"app-icon",8),i.TgZ(11,"span",9),i._uU(12),i.qZA()(),i._UZ(13,"app-node-actions",10),i.qZA()),2&n&&(i.Q6J("ngClass",i.l5B(13,qM,e.theme===e.themeEnum.Light,!e.node.boolState.shown,e.checked,!e.node.boolState.pickable)),i.uIk("data-id",e.sanitizedID),i.xp6(1),i.Q6J("ngIf",e.nested&&e.hasChildren),i.xp6(1),i.Q6J("ngIf",!e.editLabelMode),i.xp6(1),i.Q6J("ngIf",e.editLabelMode),i.xp6(1),i.Q6J("ngIf",i.lcZ(5,11,e.layerOrderMode$)),i.xp6(2),i.Q6J("buttonTheme",e.theme),i.xp6(3),i.hij("hide ",e.node.label,""),i.xp6(3),i.hij("show ",e.node.label,""),i.xp6(1),i.Q6J("theme",e.theme)("node",e.node))},dependencies:[f.mk,f.O5,lt,Dn,ag,T_,Ea,f.Ov],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}:host{display:block}.tree-node{border-radius:4px;padding:4px;margin-bottom:4px;display:flex;align-items:center;height:100%;-webkit-user-select:none;user-select:none;min-width:200px;transition:background-color .12s}.tree-node--light{padding-right:12px}.tree-node--light:focus{outline:#2d72dc solid 2px!important;outline-offset:-2px;border-radius:4px}.tree-node--light .tree-node__label{color:#101823;font-size:13px;letter-spacing:.325px;line-height:1.4em}.tree-node--light.tree-node--selected{background:transparent;border-left-color:transparent}.tree-node--light.tree-node--selected .tree-node__label{color:#101823!important}.tree-node--light.tree-node--selected .tree-node__expand,.tree-node--light.tree-node--selected .tree-node__visible{color:#101823}.tree-node--light.tree-node--unpickable{border:none}.tree-node--light.tree-node--hidden .tree-node__label{color:#61779e}.tree-node--light .tree-node__expand,.tree-node--light .tree-node__visible{background-color:transparent;color:#96a8c0;border-radius:4px}.tree-node--selected{background-color:#2d72dc}.tree-node--selected .tree-node__label{color:#fff}.tree-node--unpickable{border:1px dashed #61779e}.tree-node--hidden .tree-node__expand,.tree-node--hidden .tree-node__visible,.tree-node--hidden .tree-node__label{color:#96a8c0}.tree-node--hidden .tree-node__visible{visibility:visible}.tree-node.tree-node--hidden.tree-node--selected .tree-node__expand,.tree-node.tree-node--hidden.tree-node--selected .tree-node__visible,.tree-node.tree-node--hidden.tree-node--selected .tree-node__label{color:#fff}.tree-node__label{font-size:12px;letter-spacing:.3px;line-height:1.4em;letter-spacing:.5px;font-weight:400;line-height:1.3em;color:#d7e0ea;padding:8px 4px 8px 12px;display:flex;align-items:center;flex:1 1 100%;min-height:28px}.tree-node__label--padded{padding-left:36px}.tree-node__button{display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center;border:none}.tree-node__expand i{transition:transform .12s}.tree-node__expand--open app-icon{transform:rotate(45deg)}.tree-node .tree-node__expand+.tree-node__label{margin-left:-8px}.tree-node__expand,.tree-node__visible{border-radius:4px;color:#d7e0ea;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center;border:none}.tree-node__layer-order{font-size:10px;flex:0 0 56px;min-height:28px;height:28px;padding:4px;margin:2px;text-align:center}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}@media (hover: hover){.tree-node__visible{visibility:hidden}.tree-node:hover,.tree-node:focus-within{cursor:pointer}.tree-node:hover .tree-node__visible,.tree-node:focus-within .tree-node__visible{visibility:visible}.tree-node:hover .tree-node__label,.tree-node:focus-within .tree-node__label{color:#fff}.tree-node--light:hover,.tree-node--light:focus-within{background-color:#d6ecff}.tree-node--light:hover .tree-node__label,.tree-node--light:focus-within .tree-node__label{color:#101823}.tree-node--light.tree-node--selected{background-color:#d6ecff}.tree-node--light.tree-node--selected:hover{background-color:#bde0ff}.tree-node--light.tree-node--selected .tree-node__label{color:#101823}.tree-node--light.tree-node--selected .tree-node__expand:hover,.tree-node--light.tree-node--selected .tree-node__visible:hover,.tree-node--light .tree-node__expand:hover,.tree-node--light .tree-node__visible:hover{background-color:transparent;color:inherit}.tree-node__expand:hover,.tree-node__visible:hover{background-color:#1c2a3f;color:#fff;cursor:pointer}.tree-node--selected .tree-node__expand:hover,.tree-node--selected .tree-node__visible:hover{background-color:#2d72dc}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:hover:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}}\n"],encapsulation:2,changeDetection:0}),Yl([(0,l.Ph)(Se.getCheckedNodeIds),Wl("design:type",b.y)],ro.prototype,"checkedNodesIds$",void 0),Yl([(0,l.Ph)(Ye.getLayerOrderMode),Wl("design:type",b.y)],ro.prototype,"layerOrderMode$",void 0),Yl([(0,l.Ph)(M.getLabelEditNode),Wl("design:type",b.y)],ro.prototype,"labelEditNode$",void 0),Yl([(0,l.Ph)(Ye.getShowTreeNodeIds),Wl("design:type",b.y)],ro.prototype,"showTreeNodeIds$",void 0);const JM=function(t){return{"tree-group--light":t}};function HM(t,n){if(1&t&&(i.TgZ(0,"div",1),i._UZ(1,"app-tree-nested-node",2),i.YNc(2,GM,3,4,"div",3),i.qZA()),2&t){const e=n.$implicit,o=i.oxw();i.Q6J("ngClass",i.VKq(5,JM,o.theme===o.themeEnum.Light)),i.xp6(1),i.Q6J("graph",o.graph)("node",e)("theme",o.theme),i.xp6(1),i.Q6J("ngIf",e.boolState.expanded)}}let YM=(()=>{class t{constructor(e,o){this.graphService=e,this.store=o,this.themeEnum=Ei,this.graphSubject=new Hi.X(null),this.theme=Ei.Dark,this.nodes=[],this.ngUnsubscribe=new X.x}get graph(){return this._graph}set graph(e){!e||(this._graph=e,this.graphSubject.next(e))}ngOnInit(){this.graphSubject.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{!e||this.getNodes()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}getNodes(){const e=this.node?xo(this.graph,this.node.id):id(this.graph);this.nodes=this.graphService.getNodes(this.graph,e)}countChildren(e){return xo(this.graph,e.id).length}hasChildren(e){return this.countChildren(e)>0}trackTreeNode(e,o){return o.id}handleExpandClick(e,o){this.store.dispatch(o?new wc(e):new ur(e))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(Oi),i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-tree-group"]],inputs:{graph:"graph",theme:"theme",node:"node"},decls:1,vars:2,consts:[["class","tree-group",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tree-group",3,"ngClass"],[3,"graph","node","theme"],["class","tree-group__children",4,"ngIf"],[1,"tree-group__children"],["class","tree-group__collapse",3,"title","click",4,"ngIf"],[1,"tree-group__collapse",3,"title","click"]],template:function(e,o){1&e&&i.YNc(0,HM,3,7,"div",0),2&e&&i.Q6J("ngForOf",o.nodes)("ngForTrackBy",o.trackTreeNode)},dependencies:[f.mk,f.sg,f.O5,t,ro],styles:['.text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.tree-group[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:after{background:#eaeff5}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover{background:transparent}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#d7e0ea}.tree-group__children[_ngcontent-%COMP%]{padding-left:20px}.tree-group__children[_ngcontent-%COMP%]{position:relative}.tree-group__collapse[_ngcontent-%COMP%]{position:absolute;left:0;top:0;bottom:0;width:20px;z-index:1}.tree-group__collapse[_ngcontent-%COMP%]:after{content:" ";display:block;position:absolute;width:1px;left:10px;top:0;bottom:0;background:#1c2a3f}.tree-group__collapse[_ngcontent-%COMP%]:hover{cursor:pointer}.tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#283853}'],changeDetection:0}),t})();class Hr{constructor(n,e){this.store=n,this.graphService=e,this.theme=Ei.Dark,this.ngUnsubscribe=new X.x}ngOnInit(){this.store.select(Se.getCheckedNodes).pipe((0,$.h)(n=>1===n.length),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{setTimeout(()=>{this.scrollNodeIntoView(n[0])})})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}scrollNodeIntoView(n){const e=this.graphService.sanitizeNodeID(n.objectId),o=document.querySelector(`[data-id="${e}"]`);o&&"scrollBehavior"in document.documentElement.style&&o.scrollIntoView({behavior:"smooth",block:"nearest"})}}function XM(t,n){1&t&&(i.TgZ(0,"div",4),i._uU(1,"No results"),i.qZA())}function eI(t,n){if(1&t&&(i.TgZ(0,"div",5),i._UZ(1,"app-tree",6),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("theme",e.theme)("searchGraph",e.searchGraph)}}function tI(t,n){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-tree-nested-node",9),i.qZA()),2&t){const e=n.$implicit,o=i.oxw(2);i.xp6(1),i.Q6J("theme",o.theme)("nested",!1)("node",e)("graph",o.prunedViewGraph)}}function nI(t,n){if(1&t&&(i.TgZ(0,"cdk-virtual-scroll-viewport",7),i.YNc(1,tI,2,4,"div",8),i.qZA()),2&t){const e=i.oxw();i.Udp("height",e.searchHeight,"px"),i.Q6J("itemSize",64),i.xp6(1),i.Q6J("cdkVirtualForOf",e.searchResults)("cdkVirtualForTrackBy",e.trackTreeNode)}}Hr.\u0275fac=function(n){return new(n||Hr)(i.Y36(l.yh),i.Y36(Oi))},Hr.\u0275cmp=i.Xpm({type:Hr,selectors:[["app-tree"]],inputs:{theme:"theme",searchGraph:"searchGraph"},decls:2,vars:4,consts:[[3,"theme","graph"]],template:function(n,e){1&n&&(i._UZ(0,"app-tree-group",0),i.ALo(1,"async")),2&n&&i.Q6J("theme",e.theme)("graph",e.searchGraph?e.searchGraph:i.lcZ(1,2,e.viewGraph$))},dependencies:[YM,f.Ov]}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(M.getViewGraph),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],Hr.prototype,"viewGraph$",void 0);let iI=(()=>{class t{constructor(e,o,s,r,a,c){this.renderer=e,this.changeDetectorRef=o,this.elementRef=s,this.sceneService=r,this.store=a,this.liveAnnouncer=c,this._query="",this._displayMode=an.List,this.displayModeChange=new i.vpe,this.theme=Ei.Dark,this.treeSearchDisplayMode=an,this.searchResults=[],this.searchHeight=0,this.ngUnsubscribe=new X.x,this.numResults$=new Hi.X(0)}get query(){return this._query}set query(e){this._query=e||"",this.handleQueryChange(),void 0!==this.viewGraph&&this.numResults$.next(this.searchResults.length)}get displayMode(){return this._displayMode}set displayMode(e){null!=e&&(this._displayMode=e,this.handleQueryChange(),this.displayModeChange.emit(this.displayMode))}get viewGraph(){return this._viewGraph}set viewGraph(e){this._viewGraph=e,this.leafNodes=this.sceneService.getLeafIds(),this.buildPrunedViewGraph(this.displayMode),this.handleQueryChange(),this.changeDetectorRef.markForCheck()}ngOnInit(){}buildPrunedViewGraph(e){const o=this.store.selectSnapshot(_.getSelectedChapter),s=this.sceneService.createViewGraph({objectVisibilities:o.showObjects,chapterId:o.id});this.prunedViewGraph=s}ngAfterViewInit(){this.renderer.listen("window","resize",e=>{this.resize()}),this.numResults$.pipe((0,cn.b)(600)).subscribe(e=>{this.liveAnnouncer.announce(`${this.searchResults.length} structures found`)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleQueryChange(){const e=this.search(this._query,this.displayMode===an.List?this.prunedViewGraph:this.viewGraph);this.displayMode===an.Tree&&(this.searchGraph=function AM(t,n){return n.reduce((o,s)=>I_(o,s,t),{nodes:{},successors:{},predecessors:{},roots:{}})}(this.viewGraph,e)),this.searchResults=e,this.resize()}resize(){this.getSearchHeight().pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.searchHeight=e,this.changeDetectorRef.markForCheck()})}getSearchHeight(){return new b.y(o=>{setTimeout(()=>{const s=this.elementRef.nativeElement.offsetHeight;null!=s&&(o.next(s),o.complete())})})}search(e,o){return void 0===o?[]:(e=(0,M_.Od)(e.toLowerCase()),Object.values(o.nodes).filter(r=>0===e.length||(0,M_.Od)(r.label.toLowerCase()).indexOf(e)>=0).sort((r,a)=>r.label.localeCompare(a.label)))}trackTreeNode(e,o){return o.id}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(i.sBO),i.Y36(i.SBq),i.Y36(Ut),i.Y36(l.yh),i.Y36(no.Kd))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-tree-search"]],inputs:{query:"query",displayMode:"displayMode",viewGraph:"viewGraph",theme:"theme"},outputs:{displayModeChange:"displayModeChange"},decls:4,vars:3,consts:[[1,"tree-search"],["class","tree-search__empty",4,"ngIf"],["class","pr-3 pv-3",4,"ngIf"],["class","pv-3",3,"itemSize","height",4,"ngIf"],[1,"tree-search__empty"],[1,"pr-3","pv-3"],[1,"tree-search__tree",3,"theme","searchGraph"],[1,"pv-3",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"mr-3",2,"height","64px",3,"theme","nested","node","graph"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.YNc(1,XM,2,0,"div",1),i.YNc(2,eI,2,2,"div",2),i.YNc(3,nI,2,5,"cdk-virtual-scroll-viewport",3),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngIf",0===o.searchResults.length),i.xp6(1),i.Q6J("ngIf",o.displayMode===o.treeSearchDisplayMode.Tree),i.xp6(1),i.Q6J("ngIf",o.displayMode===o.treeSearchDisplayMode.List))},dependencies:[f.O5,Ka.xd,Ka.x0,Ka.N7,Hr,ro],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.tree-search{display:flex;flex-direction:column;flex:1 1 auto;height:100%}.tree-search__tree{flex-grow:1;width:100%}.tree-search__empty{font-size:14px;letter-spacing:.35px;line-height:1.4em;padding:12px;font-style:italic;margin-top:12px}.tree-search cdk-virtual-scroll-viewport{flex:1 1 auto}.tree-search cdk-virtual-scroll-viewport .cdk-virtual-scroll-content-wrapper{padding-right:12px}\n"],encapsulation:2,changeDetection:0}),t})();var F_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},U_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const oI=["searchInput"],sI=["tabButton"],R_=function(t){return{"view-search__action--selected":t}};class Hs{constructor(n,e,o){this.viewService=n,this.sceneService=e,this.store=o,this.ngUnsubscribe=new X.x,this.query="",this.themeEnum=Ei,this.treeSearchDisplayMode=an}ngOnInit(){this.initViewGraphSubscription(),this.initDisplayModeSubscription()}initViewGraphSubscription(){this.store.select(_.getSelectedChapterId).pipe((0,$.h)(n=>!(0,m.isNil)(n)),(0,$n.x)(),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.store.dispatch(new yo(this.sceneService.createViewGraph({chapterId:n})))})}initDisplayModeSubscription(){this.searchDisplayMode$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{setTimeout(()=>{this.searchInput.nativeElement.focus()})})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleSearchKeyup(n,e){"Escape"===n.key&&(this.handleExitClick(),this.searchInput.nativeElement.blur()),this.query=e}handleExitClick(){this.query="",this.viewService.toggleSearch(null,!1)}toggleDisplayMode(){let n=this.store.selectSnapshot(O.getSearchDisplayMode);n=n===an.List?an.Tree:an.List,this.setDisplayMode(n)}setDisplayMode(n){this.store.dispatch(new T.SetSearchDisplayMode(n))}handleTreeButtonClick(){this.setDisplayMode(an.Tree)}handleListButtonClick(){this.setDisplayMode(an.List)}getActiveTab(){switch(this.store.selectSnapshot(O.getSearchDisplayMode)){case an.List:return"searchTab";case an.Tree:return"treeTab";default:return null}}shiftFocus(n,e){n.stopPropagation();const o=this._buttonRefs.toArray(),r=(o.findIndex(a=>a.nativeElement==document.activeElement)+e+o.length)%o.length;o[r].nativeElement.focus()}}Hs.\u0275fac=function(n){return new(n||Hs)(i.Y36(ut),i.Y36(Ut),i.Y36(l.yh))},Hs.\u0275cmp=i.Xpm({type:Hs,selectors:[["app-view-search"]],viewQuery:function(n,e){if(1&n&&(i.Gf(oI,5),i.Gf(sI,5)),2&n){let o;i.iGM(o=i.CRH())&&(e.searchInput=o.first),i.iGM(o=i.CRH())&&(e._buttonRefs=o)}},decls:29,vars:33,consts:[["role","dialog","cdkTrapFocus","",1,"view-search",3,"keyup.escape"],[1,"view-search__header"],[1,"view-search__actions-row"],["role","tablist",1,"view-search__actions",3,"keydown.arrowleft","keydown.arrowright"],["type","button","role","tab","id","treeTab",1,"view-search__action",3,"ngClass","click","keyup.space"],["tabButton",""],["aria-hidden","true",1,"view-search__action-icon",3,"icon"],["type","button","role","tab","id","searchTab",1,"view-search__action",3,"ngClass","click","keyup.space"],["aria-hidden","true","icon","search",1,"view-search__action-icon"],["type","button","matTooltip","Close Search","aria-label","Close Search",1,"view-search__exit",3,"click"],["icon","times"],[1,"view-search__input-row"],[1,"view-search__input-container"],["icon","search",1,"view-search__input-icon"],["appAutoFocus","","appSelectOnFocus","","role","search","type","text","aria-label","Start typing the search term, then use tab to navigate the results","placeholder","Search Anatomy",1,"view-search__input",3,"value","keyup"],["searchInput",""],["role","tabpanel",1,"view-search__body"],[3,"displayMode","theme","query","viewGraph"]],template:function(n,e){if(1&n){const o=i.EpF();i.TgZ(0,"div",0),i.NdJ("keyup.escape",function(){return e.handleExitClick()}),i.TgZ(1,"div",1)(2,"div",2)(3,"div",3),i.NdJ("keydown.arrowleft",function(r){return e.shiftFocus(r,-1)})("keydown.arrowright",function(r){return e.shiftFocus(r,1)}),i.TgZ(4,"button",4,5),i.NdJ("click",function(){return e.handleTreeButtonClick()})("keyup.space",function(){return e.handleTreeButtonClick()}),i.ALo(6,"async"),i.ALo(7,"async"),i.ALo(8,"async"),i._UZ(9,"app-icon",6),i._uU(10,"Tree "),i.qZA(),i.TgZ(11,"button",7,5),i.NdJ("click",function(){return e.handleListButtonClick()})("keyup.space",function(){return e.handleListButtonClick()}),i.ALo(13,"async"),i.ALo(14,"async"),i.ALo(15,"async"),i._UZ(16,"app-icon",8),i._uU(17,"Search "),i.qZA()(),i.TgZ(18,"button",9),i.NdJ("click",function(){return e.handleExitClick()}),i._UZ(19,"app-icon",10),i.qZA()(),i.TgZ(20,"div",11)(21,"div",12),i._UZ(22,"app-icon",13),i.TgZ(23,"input",14,15),i.NdJ("keyup",function(r){i.CHM(o);const a=i.MAs(24);return i.KtG(e.handleSearchKeyup(r,a.value))}),i.qZA()()()(),i.TgZ(25,"div",16),i._UZ(26,"app-tree-search",17),i.ALo(27,"async"),i.ALo(28,"async"),i.qZA()()}2&n&&(i.xp6(4),i.Q6J("ngClass",i.VKq(29,R_,i.lcZ(6,13,e.searchDisplayMode$)===e.treeSearchDisplayMode.Tree)),i.uIk("aria-selected",i.lcZ(7,15,e.searchDisplayMode$)===e.treeSearchDisplayMode.Tree)("tabIndex",i.lcZ(8,17,e.searchDisplayMode$)===e.treeSearchDisplayMode.Tree?0:-1),i.xp6(5),i.Q6J("icon","sitemap"),i.xp6(2),i.Q6J("ngClass",i.VKq(31,R_,i.lcZ(13,19,e.searchDisplayMode$)===e.treeSearchDisplayMode.List)),i.uIk("aria-selected",i.lcZ(14,21,e.searchDisplayMode$)===e.treeSearchDisplayMode.List)("tabIndex",i.lcZ(15,23,e.searchDisplayMode$)===e.treeSearchDisplayMode.List?0:-1),i.xp6(12),i.Q6J("value",e.query),i.xp6(2),i.uIk("aria-labelledby",e.getActiveTab()),i.xp6(1),i.Q6J("displayMode",i.lcZ(27,25,e.searchDisplayMode$))("theme",e.themeEnum.Light)("query",e.query)("viewGraph",i.lcZ(28,27,e.viewGraph$)))},dependencies:[f.mk,Gt.gM,T_,zM,lt,iI,no.mK,f.Ov],styles:['.text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-search{display:flex;flex-direction:column;height:100%}@keyframes appear{0%{background-color:transparent}}.view-search__header{flex:0 0 auto;flex-direction:column;display:flex;animation:appear .25s ease-out}.view-search__actions-row{flex:0 0 auto;display:flex;padding:0 12px;justify-content:space-between;align-items:center;border-bottom:1px solid #d7e0ea}.view-search__actions{display:flex;height:56px;flex:1;justify-content:space-between}.view-search__action{font-size:14px;letter-spacing:.35px;line-height:1.4em;font-weight:500;text-transform:uppercase;background:transparent;display:flex;align-items:center;justify-content:center;border:0;border-bottom:2px solid transparent;color:#374a68;cursor:pointer;width:49%;padding-top:4px}.view-search__action:hover:not(.view-search__action--selected){color:#131c2a;border-bottom-color:#d7e0ea}.view-search__action--selected{color:#131c2a;border-bottom-color:#2d72dc}.view-search__action-icon{margin-right:8px}.view-search__exit{display:flex;align-items:center;justify-content:center;border:0;border-radius:50%;color:#374a68;background-color:#d7e0ea;opacity:.8;cursor:pointer;width:28px;height:28px;margin-left:12px;outline:none}.view-search__input-row{flex:0 0 auto;display:flex;padding:12px}.view-search__input-container{background-color:#fff;border:1px solid #ffffff;display:flex;flex-grow:1;border-radius:4px}.view-search__input-container:hover{border-color:#61779e}.view-search__input-container:focus-within{outline:#2d72dc solid 2px!important;outline-offset:-2px}.view-search__input-icon{background:0 0;display:flex;align-items:center;justify-content:center;color:#61779e;width:36px;height:36px;outline:0}.view-search__input{font-size:13px;letter-spacing:.325px;line-height:1.4em;font-weight:400;color:#131c2a;background:transparent;border:1px solid transparent;outline:none;flex:1 0 auto;padding:8px 12px 8px 0}.view-search__input::-ms-clear{display:none}.view-search__input::placeholder{color:#61779e;opacity:1}.view-search__body{flex:1 1 100%;overflow-y:scroll;padding-left:12px}.view-search__input{font-family:Inter UI,"Font Awesome 5 Pro"!important}@media not all and (-webkit-min-device-pixel-ratio: 0),not all and (min-resolution: .001dpcm){@supports (-webkit-appearance: none){.view-search__input{font-size:16px;padding:4px 8px;width:0}}}\n'],encapsulation:2,changeDetection:0}),F_([(0,l.Ph)(M.getViewGraph),U_("design:type",b.y)],Hs.prototype,"viewGraph$",void 0),F_([(0,l.Ph)(O.getSearchDisplayMode),U_("design:type",b.y)],Hs.prototype,"searchDisplayMode$",void 0);var pg=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},dg=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function rI(t,n){1&t&&(i.ynx(0),i._UZ(1,"app-view-title")(2,"app-view-content-mode",6),i.BQk())}function aI(t,n){1&t&&i._UZ(0,"app-view-quiz")}function cI(t,n){if(1&t&&(i.TgZ(0,"app-view-column",3),i.ynx(1,4),i.YNc(2,rI,3,0,"ng-container",5),i.ALo(3,"async"),i.YNc(4,aI,1,0,"app-view-quiz",5),i.ALo(5,"async"),i.BQk(),i.qZA()),2&t){const e=i.oxw();i.Q6J("@slideInOut",void 0),i.xp6(2),i.Q6J("ngIf",!i.lcZ(3,3,e.quizModeActive$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(5,5,e.quizModeActive$))}}function lI(t,n){1&t&&(i.TgZ(0,"app-view-column",7),i._UZ(1,"app-view-search"),i.qZA()),2&t&&i.Q6J("unpadded",!0)("@slideInOut",void 0)}function pI(t,n){1&t&&(i.TgZ(0,"app-view-column",3),i._UZ(1,"app-view-node-description",6),i.qZA()),2&t&&i.Q6J("@slideInOut",void 0)}const dI=function(){return{"view-column-container--header-offset":!0}};class us{constructor(n,e,o){this.viewService=n,this.layoutService=e,this.changeDetectorRef=o,this.ngUnsubscribe=new X.x,this.viewLayout=x,this.application=mt,this.columnVisible=!1,this.searchVisible=!1,this.nodeInfoVisible=!1}ngOnInit(){this.initLayoutObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLayoutObserver(){(0,bt.a)(this.layout$,this.chapter$).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([])=>{this.columnVisible=this.layoutService.isVisible(x.Column),this.searchVisible=this.layoutService.isVisible(x.Search),this.nodeInfoVisible=this.layoutService.isVisible(x.NodeInfo),this.changeDetectorRef.markForCheck()})}handleSearchClick(){this.viewService.toggleSearch(null,!0)}}us.\u0275fac=function(n){return new(n||us)(i.Y36(ut),i.Y36(ri),i.Y36(i.sBO))},us.\u0275cmp=i.Xpm({type:us,selectors:[["app-view-column-container"]],decls:4,vars:5,consts:[["data-test","viewPageColumn",1,"view-column-container",3,"ngClass"],["class","view-column-container__inner",4,"ngIf"],["class","view-column-container__inner",3,"unpadded",4,"ngIf"],[1,"view-column-container__inner"],["view-column-body",""],[4,"ngIf"],["layout","column"],[1,"view-column-container__inner",3,"unpadded"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,cI,6,7,"app-view-column",1),i.YNc(2,lI,2,2,"app-view-column",2),i.YNc(3,pI,2,1,"app-view-column",1),i.qZA()),2&n&&(i.Q6J("ngClass",i.DdM(4,dI)),i.xp6(1),i.Q6J("ngIf",e.columnVisible),i.xp6(1),i.Q6J("ngIf",e.searchVisible),i.xp6(1),i.Q6J("ngIf",e.nodeInfoVisible))},dependencies:[f.mk,f.O5,zn,$s,oo,Gs,Hs,vi,f.Ov],styles:[".view-column-container{pointer-events:none;height:100%;width:320px;position:absolute;left:0;top:0;z-index:30}.view-column-container app-view-column{position:absolute;left:0;top:0;height:100%;z-index:40}\n"],encapsulation:2,data:{animation:[(0,j.X$)("slideInOut",[(0,j.eR)(":enter",[(0,j.oB)({transform:"translateX(-320px)"}),(0,j.jt)("300ms ease-in-out",(0,j.oB)({transform:"*"}))]),(0,j.eR)(":leave",[(0,j.jt)("300ms ease-in-out",(0,j.oB)({transform:"translateX(-320px)"}))])])]},changeDetection:0}),pg([(0,l.Ph)(_.getSelectedChapter),dg("design:type",b.y)],us.prototype,"chapter$",void 0),pg([(0,l.Ph)(O.getUI),dg("design:type",b.y)],us.prototype,"layout$",void 0),pg([(0,l.Ph)(U.getQuizModeActive),dg("design:type",b.y)],us.prototype,"quizModeActive$",void 0);var N_=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},E_=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function uI(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggle())})("keyup.enter",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggle())}),i._UZ(1,"app-icon",2),i.qZA()}if(2&t){const e=i.oxw();i.Q6J("@show",void 0)("matTooltip",e.isIn?"Open Info Panel":"Close Info Panel"),i.uIk("aria-label",e.isIn?"Open Info Panel":"Close Info Panel")("aria-expanded",!e.isIn),i.xp6(1),i.Q6J("icon",e.isIn?"caret-right":"caret-left")}}class Ys{constructor(n,e,o,s){this.viewService=n,this.layoutService=e,this.changeDetectorRef=o,this.store=s,this.ngUnsubscribe=new X.x,this.isIn=!1,this.columnToggleVisible=!1}ngOnInit(){(0,bt.a)(this.chapter$,this.layout$).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{this.isIn=e.column.status===Pe.Collapse,this.columnToggleVisible=this.layoutService.isVisible(x.ColumnToggle),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isVisible(){return this.layoutService.isVisible(x.ColumnToggle)}handleToggle(){this.viewService.toggleColumn(),this.viewService.toggleSearch(null,!1),this.viewService.toggleNodeInfo(!1),this.viewService.toggleLabelInfo(!1),this.changeDetectorRef.markForCheck()}}Ys.\u0275fac=function(n){return new(n||Ys)(i.Y36(ut),i.Y36(ri),i.Y36(i.sBO),i.Y36(l.yh))},Ys.\u0275cmp=i.Xpm({type:Ys,selectors:[["app-view-column-toggle"]],decls:1,vars:1,consts:[["class","view-column-toggle","data-test","viewInformationPanel","role","button","tabindex","0","matTooltipPosition","right",3,"matTooltip","click","keyup.enter",4,"ngIf"],["data-test","viewInformationPanel","role","button","tabindex","0","matTooltipPosition","right",1,"view-column-toggle",3,"matTooltip","click","keyup.enter"],[3,"icon"]],template:function(n,e){1&n&&i.YNc(0,uI,2,5,"div",0),2&n&&i.Q6J("ngIf",e.columnToggleVisible)},dependencies:[f.O5,Gt.gM,lt],styles:[".view-column-toggle{color:#131c2a;background:rgba(255,255,255,.8);box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;border-radius:0 4px 4px 0;display:flex;justify-content:center;align-items:center;width:24px;height:48px}.view-column-toggle:hover{background-color:#eaeff5;cursor:pointer}\n"],encapsulation:2,data:{animation:[(0,j.X$)("show",[(0,j.eR)(":enter",[(0,j.oB)({opacity:0,transform:"translateX(-32px)"}),(0,j.jt)("300ms ease-in-out",(0,j.oB)({opacity:1,transform:"*"}))]),(0,j.eR)(":leave",[(0,j.jt)("300ms ease-in-out",(0,j.oB)({transform:"translateX(-32px)",opacity:0}))])])]},changeDetection:0}),N_([(0,l.Ph)(O.getUI),E_("design:type",b.y)],Ys.prototype,"layout$",void 0),N_([(0,l.Ph)(_.getSelectedChapter),E_("design:type",b.y)],Ys.prototype,"chapter$",void 0);class ao{}var Kl=A(8879);class gI{}var gs=(()=>(function(t){t.UserGeneratedTour="user_generated_tour",t.Animated="animated",t.Quiz="quiz",t.ModeQuiz="mode_quiz",t.ModeContent="mode_content"}(gs||(gs={})),gs))(),co=(()=>(function(t){t.Private="private",t.Group="enterprise",t.Public="public"}(co||(co={})),co))();const Yr=1e4,ug="/ws/user/bookmark/v4",D_={headers:new at.WM({"Content-Type":"application/json; charset=utf-8"})};let Xa=(()=>{class t{constructor(e,o,s,r,a){this.store=e,this.http=o,this.serializeModuleService=s,this.storyService=r,this.productService=a}getBookmarkData(e){return this.http.get(`/search/bookmarks/data?be=${e}`).pipe((0,Kl.a)(o=>o.pipe((0,Rr.g)(1e3),(0,yt.q)(3))),(0,J.U)(o=>((o=o.bookmark).moduleId=o.customData?o.customData.moduleId:o.modules.activeModules[0],(0,sn.yE)(gI,o))))}getBookmarkModel(e){return this.http.get(`/ws/search/bookmarks?eid=${e}`).pipe((0,Kl.a)(o=>o.pipe((0,Rr.g)(1e3),(0,yt.q)(3))),(0,J.U)(o=>(0,sn.yE)(vs,o.bookmark_info)),(0,J.U)(o=>ar(o)))}getUserBookmarks(e,o="",s=Yr,r,a){const c={q:o,page_size:`${s}`,ol:r};return(0,m.isNil)(a)||(c.is_owner=""+(a?1:0)),this.http.get(`/ws/search/bookmarks/${e}`,{params:c}).pipe((0,Kl.a)(p=>p.pipe((0,Rr.g)(1e3),(0,yt.q)(3))),(0,J.U)(p=>p.map(d=>(0,sn.yE)(vs,d)).map(d=>ar(d))))}getUserConditions(e,o="",s,r,a=Yr){let c="";switch(e){case co.Private:c="user";break;case co.Group:c="group"}return this.http.get(`/ws/search/conditions/private?q=${o}&page_size=${a}&ol=${s}`).pipe((0,J.U)(p=>p.filter(d=>d.module_accessor_level===c&&(!r||d.module_accessor_id===r))),(0,J.U)(p=>(0,sn.yE)(vs,p)),(0,J.U)(p=>p.map(d=>ar(d))))}getPrivateBookmarks(e="",o,s=Yr){return this.getUserBookmarks(co.Private,e,s,o,!0)}getPrivateConditions(e="",o){return this.getUserConditions(co.Private,e,o)}getOrganizationBookmarks(e,o="",s=Yr,r){return this.getUserBookmarks(co.Private,o,s,r).pipe((0,J.U)(a=>a.filter(c=>c.tags.includes("enterprise")).filter(c=>c.group_access.some(p=>p.group_id===e))))}getOrganizationConditions(e,o="",s){return this.getUserConditions(co.Group,o,s,e)}getOrganizationContent(e,o="",s){return(0,On.D)([this.getOrganizationBookmarks(e,o,Yr,s),this.getOrganizationConditions(e,o,s)]).pipe((0,J.U)(([r,a])=>[...r,...a]))}getPrivateContent(e="",o){return(0,On.D)([this.getPrivateBookmarks(e,o),this.getPrivateConditions(e,o)]).pipe((0,J.U)(([s,r])=>[...s,...r]))}createBookmarkStory(e,o){return this.serializeModuleService.serialize({},new ib,!1,{...this.store.selectSnapshot(we.getStory),displayName:e},this.store.selectSnapshot(_.getStoryChapters),o)}getPublicBookmarks(e="",o){return this.getUserBookmarks(co.Public,e,Yr,o)}saveBookmark(e){const o=this.getNormalizedBookmarkEntry(e);let s;return s=this.http.post(e.id?`${ug}/update`:`${ug}/save`,o,D_),s.pipe((0,Ii.V)(r=>this.getBookmarkModel(r.id)))}deleteBookmark(e){return this.http.delete(`${ug}/delete?eid=${e}&app_producttype=${this.productService.productType}&app_productkey=${this.productService.productKey}`).pipe((0,Vn.K)(a=>{const{error:c}=a.error;return(0,Qd._)(c?c.message:"")}))}atMaxFreeBookmarkCount(){return this.http.get("/ws/user/content/limit/check?version=2").pipe((0,Vn.K)(e=>(0,Ue.of)({limit_reached:!1})))}filterByTags(e,o,s=!1){return e.filter(r=>s?o.every(a=>r.tags.includes(a)):o.some(a=>r.tags.includes(a)))}getGalleryTags(e){if(e){const o=[],r=function eP(t,n){const e=io(t,At.EditBookmarks);return!!e&&(n.type===Xe.Module?e:!(!0!==n.is_owner)||!!Gu(n)&&function Dy(t,n){if(io(t,At.EditAllTeamBookmarks))return!0;const o=io(t,At.EditTeamBookmarks),s=Gu(n)&&n.group_access[0].member_edit;return o&&s}(t,n))}(this.store.selectSnapshot(q.getUserRole),e);return e.type===Xe.Bookmark&&!r&&o.push("View Only"),e.animated&&o.push("Animated"),e.tour&&o.push("Tour"),e.quiz&&o.push("Quiz"),o}return[]}getShowcase(e,o="en"){const r=[],a=this.getPrivateBookmarks("",o,10).pipe((0,J.U)(c=>this.createPrivateShowcase(c)));if(r.push(a),!(0,m.isNil)(e)){const c=this.getOrganizationBookmarks(e.id,"",10,o).pipe((0,J.U)(p=>this.createOrganizationShowcase(p,e)));r.push(c)}return(0,On.D)(r)}createMockBookmark(e){return{author:"",author_first_name:"",author_last_name:"",cost:0,create_date_time:new Date,description:"",id:"",is_owner:!0,last_editor:"",last_editor_first_name:"",last_editor_last_name:"",tags:[],thumbnail_url:"",title:"",update_date_time:new Date,type:Xe.Bookmark,...e?{animated:!0,tour:!0}:{}}}createMockBookmarks(e){return[...Array(e).keys()].map(o=>this.createMockBookmark(o%2==0))}createPrivateShowcase(e){return{title:"Pick up where you left off",description:"",url:"/results/bookmarks?type=Private",bookmarks:e}}createOrganizationShowcase(e,o){return{title:`Recently added to ${o.name}`,description:"Recently added models to your Team library.",url:`/results/bookmarks?organizationId=${o.id}&type=Organization`,bookmarks:e}}translateBookmark(e,o,s,r){const a=s===Xe.Module||s===Xe.Internal?o.replace(".json",""):o;return(0,On.D)([this.storyService.getStory(e,Xe.Bookmark),this.storyService.getStoryTranslation(a,s,r)]).pipe((0,J.U)(([c,p])=>this.storyService.translateStory(c,p)),(0,Ii.V)(c=>this.saveBookmark({isOwner:!0,title:c.displayName.substr(0,60),id:e,index:c})),(0,J.U)(c=>c.id),(0,Vn.K)(c=>404===c.status?(0,Ue.of)(e):(0,Qd._)(c)))}getNormalizedBookmarkEntry(e){let o,s,r,a;if(e.isOwner){if(o=e.add_group_access?this.getGroupAccess(e.add_group_access):[],e.remove_group_access&&e.remove_group_access.forEach(c=>{const p=this.getNormalizeGroupAccess({group_id:c.group_id,remove:!0});o.push(p)}),s=this.getNormalizedBool(e.public_access),e.index){r={},e.index.chapters&&(r[gs.UserGeneratedTour]=this.getNormalizedBool(e.index.chapters.length>1));const c=(e.index.tags||[]).includes("animated");r[gs.Animated]=this.getNormalizedBool(c),r[gs.ModeQuiz]=this.getNormalizedBool(e.viewMode===ki.Quiz),r[gs.ModeContent]=this.getNormalizedBool(e.viewMode===ki.Content);const p=(0,m.get)(e.index,"quizSettings.enabled",!1);r[gs.Quiz]=this.getNormalizedBool(p)}a=this.getNormalizedBool(e.is_content_copy)}return{eid:e.id,name:e.title,description:e.description,index:e.index,group_access:o,public_access:s,flags:r,is_content_copy:a,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}getGroupAccess(e){return e.map(o=>this.getNormalizeGroupAccess(o))}getNormalizeGroupAccess(e){const{group_id:o,group_name:s,member_edit:r,visible:a,remove:c}=e;return{group_id:o,group_name:s,member_edit:this.getNormalizedBool(r),visibility:this.getNormalizedBool(a),remove:this.getNormalizedBool(c)}}getNormalizedBool(e){return!0===e?"1":!1===e?"0":""}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(at.eN),i.LFG(Bd),i.LFG(Us),i.LFG(Yn))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const j_={label:"Relevance",fields:[],ascending:!0},Xl={label:"Most Recent",fields:["collection_content_createdate","update_date_time","create_date_time"],ascending:!1},ec={label:"Title (A-Z)",fields:["title"],ascending:!0},ep={label:"Title (Z-A)",fields:["title"],ascending:!1},Q_={label:"Author (A-Z)",fields:["author"],ascending:!0},Z_={label:"Author (Z-A)",fields:["author"],ascending:!1};var Ws=(()=>(function(t){t.Enabled="enabled",t.Disabled="disabled",t.Locked="locked"}(Ws||(Ws={})),Ws))();class gg{constructor(){this.background={colors:null},this.uiAnnotations=!1,this.uiAudio=!0,this.uiMedia=qn.Full,this.uiInfo=!0,this.uiFullscreen=!0,this.uiScrubber=!1,this.uiHelp=!0,this.uiBd="",this.loadRotate=null,this.initial={button:!1,handHint:!1,play:!1},this.disableScroll={alert:!1,overlay:!1},this.uiQuiz={mode:Ws.Enabled,number:void 0},this.autoLoad=!0,this.uiTour=!1,this.uiNav=!0,this.uiSearch=!0,this.uiTools=!0,this.uiUndo=!0,this.uiLabelList=!0,this.uiChapterList=!1,this.all=!1,this.collapseLabel=null,this.uiMenu=!0,this.uiAnatomyDescriptions=!0,this.uiTutorial=!1,this.uiLegend=!0,this.uiLoader=Nd,this.uiWhiteboard=!0,this.uiVisibilityLayers=!0,this.uiAnatomyLabels=!0}}const hg={title:"Desktop",type:"desktop",dimensions:{width:700,height:550},orientation:"vertical"};var hI=A(6172);const mg=new i.OlP(""),B_=new i.OlP(""),V_=se.deploy===pn.Production?"https://human.biodigital.com":window.location.origin,fI=se.deploy===pn.Local?"https://localhost:4202":`${V_}/viewer`;let bI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[{provide:mg,useValue:V_},{provide:B_,useValue:fI}],imports:[f.ez]}),t})();var tp=(()=>(function(t){t.Responsive="responsive",t.Fixed="fixed"}(tp||(tp={})),tp))(),Ks=(()=>(function(t){t.Single="share.widget.link",t.Bulk="share.widget.export"}(Ks||(Ks={})),Ks))();const q_={headers:new at.WM({"Content-Type":"application/json; charset=utf-8"})},Wr=new gg,fg={id:"embedded-human",dimensions:hg.dimensions,fullScreen:!0};let Kr=(()=>{class t{constructor(e,o,s,r,a,c,p,d){this.http=e,this.cameraService=o,this.numberService=s,this.orgnanizationService=r,this.contentViewService=a,this.matSnackbar=c,this.APP_BASE_URL=p,this.VIEWER_BASE_URL=d}exportBookmarks(e,o,s,r,a,c,p,d,u=!1,g=""){this.matSnackbar.open(`Exporting ${e.length} models to CSV...`);const h=[{label:"Title",field:"title"},{label:"ID",field:"id"},{label:"Collection",field:"collection"},{label:"URL",field:"url"},{label:"iFrame",field:"iFrame"},{label:"Author",field:"author"},{label:"Thumbnail URL",field:"thumbnail_url"},{label:"Created Date",field:"create_date_time"},{label:"Updated Date",field:"update_date_time"}];u&&h.push({label:"Offline Package URL",field:"offline_url"});const y=d?(0,Ue.of)(null):this.getUAID(Ks.Bulk),k=u?this.getDownloadURLs(e):(0,Ue.of)([]),B=new Map,K=s.length?(0,On.D)(s.map(V=>this.orgnanizationService.getCollectionContent(o,V.collection_id,"",p).pipe((0,J.U)(ge=>{ge.forEach(F=>{B.set(F.id,V)})})))):(0,Ue.of)(!0);return(0,On.D)([y,k,K]).pipe((0,J.U)(([V,ge])=>e.map((F,R)=>{const{id:D,title:I,author:ce,thumbnail_url:ye,create_date_time:ie,update_date_time:rt}=F,Ae=B.get(F.id)?.collection_name??"",An=this.getWidgetURL(F,r,a,null,V,p,d,g),mo=this.getWidgetEmbed(An,c),Ho=this.buildThumbnailURL(ye),on=ge[R]||"";return{title:I,id:D,collection:Ae,url:An,iFrame:mo,author:ce,thumbnail_url:Ho,create_date_time:(0,f.p6)(new Date(ie),"shortDate","en"),update_date_time:(0,f.p6)(new Date(rt),"shortDate","en"),offline_url:on}})),(0,eo.w)(V=>function mI(t,n,e=!0){const o=new hI.N,s=[];return e&&s.push(n.map(r=>r.label)),t.forEach(r=>{const a=n.map(c=>r[c.field]);s.push(a)}),new b.y(r=>{const a=o.unparse(s,{quotes:!0,header:!1});r.next(a),r.complete()})}(V,h)),(0,eo.w)(V=>{const F=`BioDigital-Widgets-${(new Date).toISOString().split("T")[0]}-export.csv`,R=new Blob([V],{type:"text/csv;charset=utf-8"});return(0,Wc.saveAs)(R,F),(0,Ue.of)(!0)}))}generateWidgetURL(e,o,s,r,a,c,p,d){const u=p||!a?(0,Ue.of)(null):this.getUAID(a);return(0,On.D)([u,this.contentViewService.trackContentPublish(e.id,e.type)]).pipe((0,J.U)(([g])=>this.getWidgetURL(e,o,s,r,g,c,p,d)))}getWidgetURL(e,o,s,r,a,c="en",p,d){s=s||Wr;const u="bookmark"===e.type,g={};g[u?"id":"m"]=`${u?e.id:e.module_name}`;const k={...g,...this.getParamsForUIOptions(s||Wr),...this.getParamsForLoadingExperience(s||Wr),...this.getParamsForScrollMode(s||Wr),...this.getParamsForLoadRotate(s||Wr),...this.getParamsForLabelScale(s||Wr)},B=(0,m.get)(s,"background.colors");if(Array.isArray(B)&&B.length>=3){const V=B.slice(0,4).map(ge=>this.numberService.roundNumber(ge,3));k["background.colors"]=`${V}`}if(r){const{eye:V,look:ge,up:F}=this.cameraService.roundCamera(r,3);k.camera=`${[V.x,V.y,V.z,ge.x,ge.y,ge.z,F.x,F.y,F.z]}`}p?k.dk=p.app_apikey:a&&(k.uaid=a),c&&"en"!==c&&(k.lang=c),d&&(k.paid=d);const K=this.isCustomWidget(e.embed_url_path)?e.embed_url_path:o;return this.buildWidgetURL(K,k)}generateWidgetEmbed(e,o,s,r,a,c,p,d,u){return this.generateWidgetURL(e,o,s,a,c,p,d,u).pipe((0,J.U)(g=>this.getWidgetEmbed(g,r)))}getWidgetEmbed(e,o){const{width:s,height:r,type:a}=o||fg.dimensions;let c="";return c=a===tp.Responsive?`style="aspect-ratio: ${s} / ${r}; width: 100%"`:`width="${s}" height="${r}"`,`<iframe id="${fg.id}" frameBorder="0" ${c} allowFullScreen="${fg.fullScreen}" loading="lazy" src="${e}"></iframe>`}getImageEmbed(e,o,s){const r=`BioDigital Human: ${e}`.replace(/"/g,"&quot;");return`<a href="${o}" target="_blank"><img src="${s}" alt="${r}" title="${r}" /></a>`}getUAID(e){return this.http.post("/ws/user/analytics",{analytic_type:`${e}`,analytic_platform:"app"},q_).pipe((0,J.U)(s=>s.id))}getDownloadURLs(e){const o=e.filter(s=>!s.favorite&&!s.unavailable).map(s=>({type:s.type,id:"module"===s.type?s.module_name:s.id}));return this.http.post("/ws/download/reserve",{content:o},{headers:{"Content-Type":"application/json"}}).pipe((0,J.U)(s=>{const r=s.tokens;return e.map(a=>{const c=a.type,p="module"===a.type?a.module_name:a.id,d=r.find(u=>u.type===c&&u.id===p);return d&&d.token?this.buildDownloadURL(d.token):""})}),(0,Vn.K)(()=>(0,Ue.of)(e.map(()=>""))))}extendWidgetOptions(e,o){const s=this.expandWidgetOptions(o);return this.deepExtendWidgetOptions(e,s),e}getWidgetConfig(e){const o={};return Object.keys(e).forEach(r=>{const a=e[r];if(null!==a){const c=this.getConfigName(r);o[c]=a}}),o}getConfigName(e){const s=this.camelToDashCase(e).replace(/^ui-/g,"");return this.dashCaseToCamelCase(s)}getParamsForLoadingExperience(e){const o={};return e.autoLoad||(o["auto-load"]=!1),e.initial.button?o["initial.button"]=!0:e.initial.handHint?o["initial.hand"]=!0:e.initial.play?o["initial.play"]=!0:o["initial.none"]=!0,o}getParamsForScrollMode(e){return e.disableScroll.alert?{"disable-scroll.alert":!0}:e.disableScroll.overlay?{"disable-scroll":!0}:{"disable-scroll":!1}}getParamsForLoadRotate(e){return"number"==typeof e.loadRotate?{"load-rotate":e.loadRotate}:{}}getParamsForLabelScale(e){return{}}getParamsForUIOptions(e){return{"ui-anatomy-descriptions":e.uiAnatomyDescriptions,"ui-anatomy-labels":e.uiAnatomyLabels,"ui-audio":e.uiAudio,"ui-chapter-list":e.uiChapterList,"ui-fullscreen":e.uiFullscreen,"ui-help":e.uiHelp,"ui-info":e.uiInfo,"ui-label-list":e.uiLabelList,"ui-layers":e.uiVisibilityLayers,"ui-loader":e.uiLoader,"ui-media-controls":e.uiMedia,"ui-menu":e.uiMenu,"ui-nav":e.uiNav,"ui-search":e.uiSearch,"ui-tools":e.uiTools,"ui-tutorial":e.uiTutorial,"ui-undo":e.uiUndo,"ui-whiteboard":e.uiWhiteboard,...this.getParamsForUIQuiz(e)}}getParamsForUIQuiz(e){const o={},s=(0,m.get)(e,"uiQuiz.mode"),r=(0,m.get)(e,"uiQuiz.number");return s===Ws.Disabled&&(o["ui-quiz"]=!1),s===Ws.Locked&&(o["ui-quiz-locked"]=!0),(0,m.isNil)(r)||(o["ui-quiz-start"]=r,o["ui-quiz-end"]=r),o}camelToDashCase(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}dashCaseToCamelCase(e){return e.replace(/-([a-z])/g,o=>o[1].toUpperCase())}isCustomWidget(e){return/widgets\/([^\/]+)\//.test(e)}saveUserImage(e,o="jpeg"){return this.http.post("/ws/user/image/v1-0",{image_src:e,image_type:o},q_).pipe((0,J.U)(s=>s.url))}buildWidgetURL(e,o){const s=Object.entries(o).map(([c,p])=>`${c}=${p}`).join("&");let r="",a=e.replace(/^\/|\/$/g,"");return!1===o["auto-load"]&&"viewer"===a&&(a="tiny-viewer",r="/tiny-viewer"),se.deploy===pn.Local?`${this.VIEWER_BASE_URL}${r}/?${s}`:`${this.APP_BASE_URL}/${a}/?${s}`}buildThumbnailURL(e){return`${this.APP_BASE_URL}${e}`}buildDownloadURL(e){return`${this.APP_BASE_URL}/download?t=${e}`}deepExtendWidgetOptions(e,o){Object.entries(e).forEach(([s,r])=>{const a=typeof r;[s,this.camelToDashCase(s),this.getConfigName(s)].forEach(p=>{if(o.hasOwnProperty(p)&&null!==o[p]){const d=o[p];null===r?e[s]=d:a===typeof d&&("object"===a?this.deepExtendWidgetOptions(r,d):e[s]=d)}})})}expandWidgetOptions(e){const o={};return Object.entries(e).forEach(([s,r])=>{const a=s.split(".");if(a.length>1){const c=a[0],p=a.slice(1).join(".");(null===o[c]||"object"!=typeof o[c])&&(o[c]={}),o[c][p]=r}else o[s]=e[s]}),o}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(Bn),i.LFG(fd),i.LFG(bo),i.LFG($u),i.LFG(_i.ux),i.LFG(mg),i.LFG(B_))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const tc={main:[{title:"All Models",id:"all",type:"Category",translations:{es:{title:"Todas las Categor\xedas"},zh:{title:"\u6240\u6709\u7c7b\u522b"},fr:{title:"Toutes les cat\xe9gories"},de:{title:"Alle Kategorien"},it:{title:"Tutte le categorie"},ja:{title:"\u3059\u3079\u3066\u306e\u30ab\u30c6\u30b4\u30ea"},pt:{title:"Todas as categorias"}}}],categories:[{title:"Anatomy by Regions",id:"regional",type:"Category",translations:{es:{title:"Anatom\xeda regional"},zh:{title:"\u5c40\u90e8\u89e3\u5256"},fr:{title:"Anatomie par r\xe9gions"},de:{title:"Vollst\xe4ndige Anatomie"},it:{title:"Anatomia regionale"},ja:{title:"\u5404\u90e8\u4f4d\u306e\u69cb\u9020"},pt:{title:"Anatomia por Regi\xf5es"}}},{title:"Anatomy by Systems",id:"system",type:"Category",translations:{es:{title:"Anatom\xeda sistem\xe1tica"},zh:{title:"\u7cfb\u7edf\u89e3\u5256"},fr:{title:"Anatomie par syst\xe8mes"},de:{title:"Systematische Anatomie"},it:{title:"Anatomia sistemica"},ja:{title:"\u5404\u5668\u5b98\u7cfb\u306e\u69cb\u9020"},pt:{title:"Anatomia por Sistemas"}}},{title:"Complete Anatomy",id:"complete anatomy",type:"Category",translations:{de:{title:"Vollst\xe4ndige Anatomie"},es:{title:"Anatom\xeda completa"},fr:{title:"Anatomie compl\xe8te"},it:{title:"Anatomia completa"},ja:{title:"\u4eba\u4f53\u306e\u5168\u4f53\u69cb\u9020"},pt:{title:"Anatomia Completa"},zh:{title:"\u5b8c\u6574\u89e3\u5256"}}},{title:"Bony Landmarks",id:"Bony Landmarks",type:"Category",translations:{de:{title:"Kn\xf6cherne Orientierungspunkte"},es:{title:"Puntos de referencia \xf3seos"},fr:{title:"Rep\xe8res osseux"},it:{title:"Punti di repere ossei"},ja:{title:"\u9aa8\u306e\u30e9\u30f3\u30c9\u30de\u30fc\u30af"},pt:{title:"Marcos \xd3sseos"},zh:{title:"\u9aa8\u6027\u6807\u5fd7"}}},{title:"Cross Sections & Micro Anatomy",id:"Cross Section and Micro Anatomy",type:"Category",translations:{de:{title:"Querschnitte und mikroskopische Anatomie"},es:{title:"Cortes transversales y microanatom\xeda"},fr:{title:"Coupes transversales et micro anatomie"},it:{title:"Sezioni trasversali & anatomia microscopica"},ja:{title:"\u65ad\u9762\u56f3\u30fb\u30de\u30a4\u30af\u30ed\u89e3\u5256\u5b66"},pt:{title:"Sec\xe7\xf5es Transversais e Microanatomia"},zh:{title:"\u6a2a\u65ad\u9762&\u663e\u5fae\u89e3\u5256"}}},{title:"Origins & Insertions",id:"Origins and Insertions",type:"Category",translations:{de:{title:"Urspr\xfcnge und Ans\xe4tze"},es:{title:"Or\xedgenes e inserciones"},fr:{title:"Origines et insertions"},it:{title:"Origini ed inserzioni"},ja:{title:"\u8d77\u59cb\u30fb\u505c\u6b62"},pt:{title:"Origens & Inser\xe7\xf5es"},zh:{title:"\u8d77\u6e90\u4e0e\u63d2\u5165"}}},{title:"Anatomy Quizzes",id:"quiz",type:"Category",translations:{de:{title:"Anatomie Quizfragen"},es:{title:"Pruebas de anatom\xeda"},fr:{title:"Quizz d'anatomie"},it:{title:"Domande di anatomia"},ja:{title:"\u89e3\u5256\u5b66\u30af\u30a4\u30ba"},pt:{title:"Question\xe1rios de Anatomia"},zh:{title:"\u89e3\u5256\u5b66\u6d4b\u9a8c"}}}],specialties:[{title:"Allergy & Immunology",id:"Allergy and Immunology",type:"Category",translations:{de:{title:"Allergie und Immunologie"},es:{title:"Alergia e inmunolog\xeda"},fr:{title:"Allergie et immunologie"},it:{title:"Allergologia ed immunologia"},ja:{title:"\u30a2\u30ec\u30eb\u30ae\u30fc\u3068\u514d\u75ab\u5b66"},pt:{title:"Alergia & Imunologia"},zh:{title:"\u8fc7\u654f\u4e0e\u514d\u75ab\u5b66"}}},{title:"Cardiology",id:"Cardiology",type:"Category",translations:{de:{title:"Kardiologie"},es:{title:"Cardiolog\xeda"},fr:{title:"Cardiologie"},it:{title:"Cardiologia"},ja:{title:"\u5fc3\u81d3\u75c5\u5b66"},pt:{title:"Cardiologia"},zh:{title:"\u5fc3\u810f\u79d1"}}},{title:"Dentistry",id:"Dentistry",type:"Category",translations:{de:{title:"Zahnmedizin"},es:{title:"Odontolog\xeda"},fr:{title:"Dentisterie"},it:{title:"Odontoiatria"},ja:{title:"\u6b6f\u5b66"},pt:{title:"Odontologia"},zh:{title:"\u7259\u79d1"}}},{title:"Dermatology",id:"Dermatology",type:"Category",translations:{de:{title:"Dermatologie"},es:{title:"Dermatolog\xeda"},fr:{title:"Dermatologie"},it:{title:"Dermatologia"},ja:{title:"\u76ae\u819a\u5b66"},pt:{title:"Dermatologia"},zh:{title:"\u76ae\u80a4\u79d1"}}},{title:"Endocrinology",id:"Endocrinology",type:"Category",translations:{de:{title:"Endokrinologie"},es:{title:"Endocrinolog\xeda"},fr:{title:"Endocrinologie"},it:{title:"Endocrinologia"},ja:{title:"\u5185\u5206\u6ccc\u5b66"},pt:{title:"Endocrinologia"},zh:{title:"\u5185\u5206\u6ccc\u79d1"}}},{title:"Gastroenterology",id:"Gastroenterology and Hepatology",type:"Category",translations:{de:{title:"Gastroenterologie"},es:{title:"Gastroenterolog\xeda"},fr:{title:"Gastroent\xe9rologie"},it:{title:"Gastroenterologia"},ja:{title:"\u80c3\u8178\u5b66\u30fb\u809d\u81d3\u5b66"},pt:{title:"Gastroenterologia"},zh:{title:"\u80c3\u80a0\u79d1&\u809d\u810f\u79d1"}}},{title:"Gynecology",id:"Gynecology",type:"Category",translations:{de:{title:"Gyn\xe4kologie"},es:{title:"Ginecolog\xeda"},fr:{title:"Gyn\xe9cologie"},it:{title:"Ginecologia"},ja:{title:"\u5a66\u4eba\u79d1\u5b66"},pt:{title:"Ginecologia"},zh:{title:"\u5987\u79d1"}}},{title:"Hematology & Oncology",id:"Oncology and Hematology",type:"Category",translations:{de:{title:"H\xe4matologie und Onkologie"},es:{title:"Hematolog\xeda/Oncolog\xeda"},fr:{title:"H\xe9matologie et oncologie"},it:{title:"Ematologia & oncologia"},ja:{title:"\u816b\u760d\u5b66\u30fb\u8840\u6db2\u5b66"},pt:{title:"Hematologia e Oncologia"},zh:{title:"\u80bf\u7624\u79d1/\u8840\u6db2\u79d1"}}},{title:"Infectious Disease",id:"Infectious Disease",type:"Category",translations:{de:{title:"Infektionskrankheit"},es:{title:"Enfermedades Infecciosas"},fr:{title:"Maladies infectieuses"},it:{title:"Malattie infettive"},ja:{title:"\u611f\u67d3\u75c7"},pt:{title:"Doen\xe7a Infecciosa"},zh:{title:"\u4f20\u67d3\u75c5"}}},{title:"Nephrology",id:"Nephrology",type:"Category",translations:{de:{title:"Nephrologie"},es:{title:"Nefrolog\xeda"},fr:{title:"N\xe9phrologie"},it:{title:"Nefrologia"},ja:{title:"\u814e\u81d3\u5b66"},pt:{title:"Nefrologia"},zh:{title:"\u80be\u79d1"}}},{title:"Neurology & Psychiatry",id:"Neurology and Psychiatry",type:"Category",translations:{de:{title:"Neurologie und Psychiatrie"},es:{title:"Neurolog\xeda y Psiquiatr\xeda"},fr:{title:"Neurologie et psychiatrie"},it:{title:"Neurologia & psichiatria"},ja:{title:"\u795e\u7d4c\u5b66\u30fb\u7cbe\u795e\u533b\u5b66"},pt:{title:"Neurologia e Psiquiatria"},zh:{title:"\u795e\u7ecf\u79d1&\u7cbe\u795e\u79d1"}}},{title:"Obstetrics",id:"Obstetrics",type:"Category",translations:{de:{title:"Geburtshilfe"},es:{title:"Obstetricia "},fr:{title:"Obst\xe9trique"},it:{title:"Ostetricia"},ja:{title:"\u7523\u79d1\u5b66"},pt:{title:"Obstetr\xedcia"},zh:{title:"\u4ea7\u79d1"}}},{title:"Ophthalmology",id:"Ophthalmology",type:"Category",translations:{de:{title:"Ophthalmologie"},es:{title:"Oftalmolog\xeda"},fr:{title:"Ophtalmologie"},it:{title:"Oftalmologia"},ja:{title:"\u773c\u79d1\u5b66"},pt:{title:"Oftalmologia"},zh:{title:"\u773c\u79d1"}}},{title:"Orthopedics",id:"Orthopedics",type:"Category",translations:{de:{title:"Orthop\xe4die"},es:{title:"Ortopedia"},fr:{title:"Orthop\xe9die"},it:{title:"Ortopedia"},ja:{title:"\u6574\u5f62\u5916\u79d1\u5b66"},pt:{title:"Ortopedia"},zh:{title:"\u9aa8\u79d1"}}},{title:"Otolaryngology",id:"Otolaryngology",type:"Category",translations:{de:{title:"Otolaryngologie"},es:{title:"Otorrinolaringolog\xeda"},fr:{title:"Otorhinolaryngologie"},it:{title:"Otorinolaringoiatria"},ja:{title:"\u8033\u9f3b\u79d1\u5b66"},pt:{title:"Otorrinolaringologia"},zh:{title:"\u8033\u9f3b\u5589\u79d1"}}},{title:"Pediatrics",id:"Pediatrics",type:"Category",translations:{de:{title:"P\xe4diatrie"},es:{title:"Pediatr\xeda"},fr:{title:"P\xe9diatrie"},it:{title:"Pediatria"},ja:{title:"\u5c0f\u5150\u79d1\u5b66"},pt:{title:"Pediatria"},zh:{title:"\u513f\u79d1"}}},{title:"Physical Therapy",id:"Physical Therapy",type:"Category",translations:{de:{title:"Physiotherapie"},es:{title:"Fisioterapia"},fr:{title:"Kin\xe9sith\xe9rapie"},it:{title:"Fisioterapia"},ja:{title:"\u7406\u5b66\u7642\u6cd5"},pt:{title:"Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597"}}},{title:"Primary Care",id:"Primary Care",type:"Category",translations:{de:{title:"Prim\xe4rversorgung"},es:{title:"Atenci\xf3n primaria"},fr:{title:"Soins de sant\xe9 primaires"},it:{title:"Assistenza sanitaria di base"},ja:{title:"\u30d7\u30e9\u30a4\u30de\u30ea\u30fc\u30b1\u30a2"},pt:{title:"Aten\xe7\xe3o Prim\xe1ria"},zh:{title:"\u521d\u7ea7\u536b\u751f\u4fdd\u5065"}}},{title:"Pulmonology",id:"Pulmonology and Respiratory",type:"Category",translations:{de:{title:"Pulmonologie"},es:{title:"Neumolog\xeda"},fr:{title:"Pneumologie"},it:{title:"Pneumologia"},ja:{title:"\u547c\u5438\u5668\u5b66"},pt:{title:"Pneumologia"},zh:{title:"\u80ba\u75c5\u79d1/\u547c\u5438\u79d1"}}},{title:"Rheumatology",id:"Rheumatology",type:"Category",translations:{de:{title:"Rheumatologie"},es:{title:"Reumatolog\xeda"},fr:{title:"Rhumatologie"},it:{title:"Reumatologia"},ja:{title:"\u30ea\u30a6\u30de\u30c1\u5b66"},pt:{title:"Reumatologia"},zh:{title:"\u98ce\u6e7f\u79d1"}}},{title:"Urology",id:"Urology",type:"Category",translations:{de:{title:"Urologie"},es:{title:"Urolog\xeda"},fr:{title:"Urologie"},it:{title:"Urologia"},ja:{title:"\u6ccc\u5c3f\u5668\u79d1\u5b66"},pt:{title:"Urologia"},zh:{title:"\u6ccc\u5c3f\u5916\u79d1"}}}],community:[{title:"Community Bookmarks",id:"public",type:"Community",translations:{de:{title:"Community-Lesezeichen"},es:{title:"Marcadores de la comunidad"},fr:{title:"Signets communautaires"},it:{title:"Segnalibri della community"},ja:{title:"\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306e\u30d6\u30c3\u30af\u30de\u30fc\u30af"},pt:{title:"Favoritos da comunidade"},zh:{title:"\u793e\u533a\u4e66\u7b7e"}}}]};var Xr=(()=>(function(t){t.Student="Student",t.Faculty="Faculty",t.Administrator="Administrator",t.TeacherFaculty="Teacher / Faculty",t.PatientCaregiver="Patient / Caregiver",t.IndustryProfessional="Industry Professional",t.InstructionalDesigner="Instructional Designer",t.Marketing="Marketing",t.TrainingManager="Training Manager",t.ManagerOfMedicalEducation="Manager of Medical Education",t.Developer="Developer",t.BrandProductManager="Brand / Product Manager",t.ScientificCommunications="Scientific Communications",t.ProductManager="Product Manager",t.Editor="Editor",t.ContentManager="Content Manager",t.DesignUserExperience="Design / User Experience",t.Executive="Executive",t.TechnologyIT="Technology / IT",t.Clinician="Clinician",t.PatientEducation="Patient Education",t.Innovation="Innovation",t.PhysicalTherapist="Physical Therapist",t.OccupationalTherapist="Occupational Therapist",t.PersonalTrainer="Personal Trainer",t.Librarian="Librarian",t.SalesTraining="Sales Training",t.ProfessionalEducation="Professional Education"}(Xr||(Xr={})),Xr))(),Do=(()=>(function(t){t.MedicalDevice="Medical Device",t.Pharma="Pharma",t.ConsumerHealth="Consumer Health",t.EdTraining="Education & Training",t.DigitalHealth="Digital Health",t.ProviderHospitalPractice="Provider (Hospital & Practice)"}(Do||(Do={})),Do))();const yI=[{icon:"search",tag:"Heart",params:{categoryId:"all",query:"Heart",type:"Category"}},{icon:"search",tag:"Brain",params:{categoryId:"all",query:"Brain",type:"Category"}},{icon:"search",tag:"Cardiology",params:{categoryId:"Cardiology",type:"Category"}},{icon:"search",tag:"COVID-19",params:{categoryId:"all",query:"COVID-19",type:"Category"}},{icon:"search",tag:"Treatments",params:{categoryId:"all",query:"Treatments",type:"Category"}},{icon:"search",tag:"Eye",params:{categoryId:"all",query:"Eye",type:"Category"}},{icon:"search",tag:"Skull",params:{categoryId:"all",query:"Skull",type:"Category"}},{icon:"search",tag:"Nervous System",params:{categoryId:"all",query:"Nervous System",type:"Category"}},{icon:"search",tag:"Muscles",params:{categoryId:"all",query:"Muscles",type:"Category"}},{icon:"search",tag:"Skeleton",params:{categoryId:"all",query:"Skeleton",type:"Category"}},{icon:"search",tag:"Digestive System",params:{categoryId:"all",query:"Digestive System",type:"Category"}}],G_=[{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-muscular-system.jpg"},{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-cardiovascular-system.jpg"},{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-nervous-system.jpg"},{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-multiple-systems.jpg"}],_I={images:G_,title:"Visualize anatomy, disease, and treatments in interactive 3D"},bg={images:[{path:"assets/images/hero/biodigital-human-body-systems.jpg",objectPosition:"50% 50%"}],title:"Improve learning with anatomy, physiology, and pathology in interactive 3D"},J_={images:[{objectPosition:"50% 50%",path:"assets/images/hero/biodigital-human-asthma.jpg"},{objectPosition:"50% 50%",path:"assets/images/hero/biodigital-human-asthma-ephitellium-releases-cytokines.jpg"},{objectPosition:"25% 50%",path:"assets/images/hero/biodigital-human-asthma-cytokines-activate-t-cells.jpg"}],title:"Transform professional and patient education in interactive 3D"},PI={[Xr.Student]:bg,[Xr.TeacherFaculty]:bg,[Xr.Clinician]:J_},kI={[Do.MedicalDevice]:{images:[{path:"assets/images/hero/biodigital-human-rotator-cuff-repair.jpg",objectPosition:"75% 50%"}],title:"Transform education & training with interactive 3D"},[Do.Pharma]:{images:[{path:"assets/images/hero/biodigital-human-covid-19.jpg",objectPosition:"75% 50%"}],title:"Transform your scientific communication with interactive 3D"},[Do.ConsumerHealth]:{images:G_,title:"Level up your user experience with interactive 3D"},[Do.EdTraining]:{images:[{path:"assets/images/hero/biodigital-human-sodium-potassium-pump.jpg",objectPosition:"75% 50%"}],title:"Customize & publish anatomy, disease, and treatments in interactive 3D"},[Do.DigitalHealth]:{images:[{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-tachycardia.jpg"},{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-tachycardia-conduction-system.jpg"},{objectPosition:"75% 50%",path:"assets/images/hero/biodigital-human-tachycardia-conduction-system-electrical-signals.jpg"}],title:"Level up your content with interactive 3D"},[Do.ProviderHospitalPractice]:J_};var jo=(()=>(function(t){t.PersonalUse="Personal Use",t.Education="Education",t.Business="Business"}(jo||(jo={})),jo))();const OI=["live"];let ip=(()=>{class t{constructor(e){this.http=e}search(e="",o=[],s="en"){const r=e.split(/[ ]+/).join("+"),a=OI.concat(o).filter(c=>""!==c&&null!=c).map(c=>`"${c}"`).join("+");return this.http.get(`/search?k=${r}&t=${a}&il=${s}&ol=${s}&odns=true`).pipe((0,J.U)(c=>this.resultsToBookmarks(c)))}searchInternal(e="",o=""){return this.http.get(`/ws/search/internal?k=${e}&dir=${o}`).pipe((0,J.U)(s=>this.resultsToBookmarks(s)))}getAnatomyCategory(e,o,s=[],r){return this.search(e,[o,...s],r)}getConditionModel(e){if(se.offline)return(0,Ue.of)(null);const o=this.toDatabaseContentId(e);return this.http.get(`/search/conditions?q=${o}`).pipe((0,Kl.a)(s=>s.pipe((0,Rr.g)(1e3),(0,yt.q)(3))),(0,J.U)(s=>this.resultsToBookmarks(s)),(0,J.U)(s=>s[0]))}getShowcase(){return this.http.get("/ws/product/app/settings/homepage-showcase").pipe((0,J.U)(e=>(e.forEach(o=>(o.bookmarks=this.resultsToBookmarks(o.bookmarks),o)),e)))}createMockShowcase(e){return{title:" ",description:" ",url:"",bookmarks:[...e],loading:!0}}createMockShowcases(e,o){return[...Array(e).keys()].map(()=>this.createMockShowcase(o))}resultsToBookmarks(e){return e.forEach(o=>{o=ar(o)}),(0,sn.yE)(vs,e)}getBookmarkCategory(e){if(!e.tags)return null;const o=tc.categories.map(s=>s.id.toLocaleLowerCase());return e.tags.find(s=>o.includes(s.toLocaleLowerCase()))}getStoryCategory(e){if(!e.tags)return null;const o=function $_(){return[...tc.main,...tc.categories,...tc.specialties,...tc.community]}().map(s=>s.id.toLocaleLowerCase());return e.tags.find(s=>o.includes(s.toLocaleLowerCase()))}toAppContentId(e){return e.replace("Condition.content.","").replace(".json","").split(".").join("/")}toDatabaseContentId(e){return e.match("Condition.content")?e:`Condition.content.${e.replace(".json","").split("/").join(".")}.json`}getHeroContent(e){const o=hc(e.account_settings);let r;switch((0,m.get)(o,"account_purpose.value","")){case jo.PersonalUse:{const a=(0,m.get)(o,"account_role.value","");r=PI[a];break}case jo.Education:r=bg;break;case jo.Business:{const a=(0,m.get)(o,"account_field.value","");r=kI[a];break}}return r||_I}getHeroQuickTags(){return(0,Ue.of)(yI)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function H_(t,n,e){const o=n.map(s=>t[s]).filter(s=>!(0,m.isNil)(s));return e?o.sort().shift():o.sort().pop()}function yg(t,n,e){if(0===n.length)return t;const o=new Intl.Collator("en-US",{sensitivity:"base"});return t.sort((s,r)=>{const a=H_(s,n,e)||"",c=H_(r,n,e)||"";return(e?1:-1)*o.compare(a.toString(),c.toString())})}class TI{}let _g=(()=>{class t{constructor(e){this.http=e}generateFreshChapterImages(e,o,s=!1){const r=[];return e.forEach(a=>{const c=os.getChapterThumbnail(a,o);(c.legacy||s)&&r.push(os.makeFreshThumbnail(c.storyId,c.chapterId,c.urls.large))}),r.length?(0,On.D)(r):(0,Ue.of)([])}saveChapterThumbnails(e,o,s){return e.reduce((a,c)=>{const u=o.get(s[c.id]),g=(0,m.get)(u,"snapshot");return g&&a.push(this.saveNewChapterImage(c.id,g)),a},[])}saveNewChapterImage(e,o){return new b.y(s=>{Wf(o).pipe((0,eo.w)(r=>this.saveImageBlob(r)),(0,J.U)(r=>({chapterId:e,...r}))).subscribe(r=>{s.next(r),s.complete()},()=>{s.next(null),s.complete()})})}getIndexThumbnail(e,o="large"){return`${typeof localBaseDirectory>"u"?"":localBaseDirectory}thumbs/modules/${e}/${o}/index.jpg`}saveImageBlob(e){const s=new File([e],"image.jpg",{type:"image/jpeg"}),r=new FormData;return r.append("file",s),this.http.post("/ws/media/images/upload",r)}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var nc=(()=>(function(t){t.WoltersKluwer="wolters_kluwer"}(nc||(nc={})),nc))();const xg={[nc.WoltersKluwer]:"https://tools.ovid.com/support/index_inner.html"}[nc.WoltersKluwer],AI={};function vg(t,n){const e=(0,m.get)(t,"error.error.error_id",""),o=(0,m.get)(t,"error.error.message",""),s=function LI(t,n){switch(t){case"OPPH01.00122":case"SUH01.00122":case"SIH01.00122":case"FSH01.00122":case"GSH01.00122":return`We were unable to find an account associated with your institution. \n      Please contact your administrator [here](${xg}) and provide this error ID: ${t}.`;case"OPPH01.00123":case"SUH01.00123":case"SIH01.00123":case"FSH01.00123":case"GSH01.00123":return`There are multiple team accounts associated with your institution. \n      Please contact your administrator [here](${xg}) and provide this error ID: ${t}.`;case"OPPH01.00124":case"OPPH01.00125":case"OPPH01.00110":case"OPPH01.00111":case"OPPH01.00112":case"SUH01.00124":case"SUH01.00110":case"SUH01.00111":case"SUH01.00112":case"SIH01.00124":case"SIH01.00110":case"SIH01.00111":case"SIH01.00112":case"FSH01.00124":case"FSH01.00125":case"FSH01.00110":case"FSH01.00111":case"FSH01.00112":case"GSH01.00124":case"GSH01.00110":case"GSH01.00111":case"GSH01.00112":return`There was an issue with retrieving information from your institution. \n      Please try again or contact your administrator [here](${xg}) and provide this error ID: ${t}.`;default:return AI[t]||""}}(e);return s||(o?o.replace(/^\[(.+)\]$/,"$1").replace(/^\'(.+)\'$/,"$1"):"")}var $e=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Z=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function W_(t,n,e,o,s,r){return r?(0,Yc.D)(e.getDatabaseItem(fa.PreviewBookmark)):s===Xe.Bookmark?t.getBookmarkModel(o):n.getConditionModel(o)}const K_={loading:!0,exporting:!1,copying:!1,saving:!1,bookmarks:[],selectedBookmark:null,sort:Xl,checkedBookmarks:[],selectedCategory:null};let Le=class{constructor(n,e,o,s,r,a,c,p,d,u,g){this.store=n,this.actions=e,this.bookmarksService=o,this.imagesService=s,this.storyService=r,this.exploreService=a,this.publishService=c,this.organizationsService=p,this.snackbar=d,this.pendoService=u,this.storageService=g}static getBookmarks(n){const{bookmarks:e,sort:o}=n,{ascending:s,fields:r}=o;return yg(e,r,s)}static getCheckedBookmarks(n){return n.checkedBookmarks}static getSelectedBookmark(n){return n.selectedBookmark}static getSelectedBookmarkViewMode(n){return n.selectedBookmark.viewMode||ki.All}static getLoading(n){return n.loading}static getExporting(n){return n.exporting}static getSaving(n){return n.saving}static getCopying(n){return n.copying}static getSort(n){return n.sort}static getSelectedCategory(n){return n.selectedCategory}loadBookmarks(n,e){n.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),(0,On.D)(this.bookmarksService.getPrivateBookmarks(e.query,e.lang),this.bookmarksService.getPrivateConditions(e.query,e.lang)).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(([o,s])=>{n.dispatch(new Na([...o,...s]))})}loadOrganizationBookmarks(n,{organizationId:e,query:o,lang:s}){n.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.bookmarksService.getOrganizationContent(e,o,s).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(r=>{n.dispatch(new Na(r))})}loadCollectionBookmarks(n,e){n.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.organizationsService.getCollectionContent(e.organizationId,e.collectionId,e.query,e.lang).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>{n.dispatch(new Na(o))})}loadSuccess({patchState:n},e){n({bookmarks:e.result})}selectBookmark(n,e){const{id:o,type:s,preview:r}=e;W_(this.bookmarksService,this.exploreService,this.storageService,o,s,r).subscribe(c=>{n.dispatch(new Hd(c))})}selectBookmarkSuccess(n,e){let{bookmark:o}=e;o&&(o=ar(o)),n.patchState({selectedBookmark:o})}saveBookmark(n,e){var o=this;return(0,Pn.Z)(function*(){let s;n.patchState({saving:!0});const r=e.bookmarkEntry,a=o.store.selectSnapshot(_.getStoryChapters),c=!1===e.inplace,p=Xc(a,c);c&&(yield(0,Th.z)(o.store.dispatch(new be.UpdateTweenParticleLookupChapters(p)))),e.includeIndex&&(s=o.bookmarksService.createBookmarkStory(r.title,p),r.index=s.story);let d=(0,Ue.of)([]);if(e.includeIndex){const u=o.store.selectSnapshot(Wt.getRegisteredThumbnails),g=o.imagesService.saveChapterThumbnails(r.index.chapters,u,(0,m.invert)(p));g.length&&(d=(0,On.D)(g))}d.pipe((0,Di.z)(u=>{const g=o.store.selectSnapshot(Wt.getRegisteredThumbnails);return u.forEach(h=>{const y=new Cr;y.storyId=r.id,y.chapterId=h.chapterId,y.urls={small:h.uris.small,large:h.uris.large},g.set(h.chapterId,y);const k=r.index.chapters.findIndex(B=>B.id===h.chapterId);k>=0&&(r.index.chapters[k].thumbnails={...h.uris})}),n.dispatch(new Jc(g)),o.bookmarksService.saveBookmark(r)})).subscribe(u=>{n.patchState({saving:!1});const g=s?s.story:null,h=r.id?"update":"save",y=Array.isArray(r.addCollections)&&r.addCollections.length>0,k=r.removeCollections&&Array.from(r.removeCollections.keys()).length>0;y||k?(o.actions.pipe((0,l.xt)(wb,Sb),(0,yt.q)(1)).subscribe(()=>{n.dispatch(new cl(u,g,h))}),n.dispatch(new eu(u,r.addCollections,r.removeCollections))):n.dispatch(new cl(u,g,h))},u=>{n.dispatch(new Kd(r,u))}),o.pendoService.track("Bookmark Save - Start")})()}saveBookmarkSuccess(n,e){const o=e.bookmark,s=n.getState().bookmarks,r=s.findIndex(a=>a.id===o.id);-1!==r&&(s[r]=o,n.patchState({bookmarks:[...s]})),"save"===e.method&&n.patchState({selectedBookmark:e.bookmark}),this.pendoService.track("Bookmark Save - Success")}saveBookmarkFail(n,e){const o=e.bookmarkEntry?.id||"",s=o.includes("/")?Xe.Module:Xe.Bookmark,r=vg(e.error),a=e.error?.status;this.pendoService.track("Bookmark Save - Failure",{contentId:o,contentType:s,error:r,statusCode:a,application:se.application})}deleteBookmark(n,e){const o=e.bookmarkId;this.bookmarksService.deleteBookmark(o).subscribe(()=>{n.dispatch(new Yd(o))},s=>{n.dispatch(new iw(o,s))})}deleteBookmarkSuccess(n,e){const o=n.getState().bookmarks.filter(s=>s.id!==e.bookmarkId);n.patchState({bookmarks:[...o]}),this.snackbar.open("Successfully deleted 3D model")}bulkDeleteBookmark(n,e){const o=e.bookmarkIds,s=e.bookmarkIds.map(r=>this.bookmarksService.deleteBookmark(r));(0,On.D)(s).subscribe(()=>{n.dispatch(new Wd(o))},r=>{n.dispatch(new ow(o,r))})}bulkDeleteBookmarkSuccess(n,e){const o=n.getState().bookmarks.filter(s=>!e.bookmarkIds.some(r=>r===s.id));n.patchState({bookmarks:[...o]}),this.snackbar.open("Successfully deleted 3D models")}sortBookmarks(n,e){const o=n.getState().bookmarks;n.patchState({sort:e.sort,bookmarks:[...o]})}clearBookmarks(n,e){n.patchState({bookmarks:[],checkedBookmarks:[]})}resetBookmarks(n,e){n.setState(K_)}checkBookmark(n,e){let o=n.getState().checkedBookmarks;const s=o.some(r=>r===e.id);e.checked&&!s?o=[...o,e.id]:e.checked||(o=o.filter(r=>r!==e.id)),n.patchState({checkedBookmarks:o})}setCheckedBookmarks(n,e){n.patchState({checkedBookmarks:e.ids})}exportBookmarks(n,e){const{bookmarks:o,organizationId:s,collections:r,widgetURL:a,widgetOptions:c,offlineEnabled:p,productAccountId:d}=e,u=c||new gg;n.patchState({exporting:!0}),this.publishService.exportBookmarks(o,s,r,a,u,null,e.userLanguage,e.userApp,p,d).pipe((0,je.x)(()=>{n.patchState({exporting:!1})})).subscribe(g=>{n.dispatch(g?new sw(o):new rw(o))})}updateBookmarkCollections(n,e){const o=e.addCollections,s=o.map(p=>({collection_id:p.collection_id,content_list:[{content_type:e.bookmark.type,content_id:e.bookmark.id}]})),r=Array.from(e.removeCollections.keys()),a=r.map(p=>({collection_id:p.collection_id,collection_content_id_list:[e.removeCollections.get(p)]})),c=o.concat(r)[0].group_id;this.organizationsService.updateCollectionContent(c,s,a).subscribe(()=>{o.length>0&&n.dispatch(new aw(e.bookmark,o)),r.length>0&&n.dispatch(new tu(e.bookmark,r)),n.dispatch(new wb(e.bookmark,o,r))},()=>{o.length>0&&n.dispatch(new cw(e.bookmark,o)),r.length>0&&n.dispatch(new lw(e.bookmark,r)),n.dispatch(new Sb(e.bookmark,o,r))})}removeBookmarkCollectionSuccess(n,e){const{bookmarks:o,selectedCategory:s}=n.getState();if("collection"===s){const r=e.bookmark.id,a=o.filter(c=>c.id!==r);n.patchState({bookmarks:[...a]})}}copyBookmark(n,e){this.pendoService.track("Bookmark Copy - Start");const{groupAccess:o,collections:s}=e;let r,a,c,p,d;n.patchState({copying:!0,saving:!0});const u=W_(this.bookmarksService,this.exploreService,this.storageService,e.id,e.type,!1),g=this.storyService.getStory(e.id,e.type,e.lang);(0,On.D)([u,g]).pipe((0,J.U)(([h,y])=>{a=(0,m.cloneDeep)(y),c=(0,m.cloneDeep)(y),p=Xc(a.chapters,!0),c.chapters.forEach(k=>{k.id=p[k.id]}),c.tweenParticleLookup&&(c.tweenParticleLookup=yr.updateChapterIds(c.tweenParticleLookup,p)),d=h.viewMode}),(0,eo.w)(()=>this.imagesService.generateFreshChapterImages(a.chapters,e.id)),(0,eo.w)(h=>{const y=h.map(k=>this.imagesService.saveNewChapterImage(k.chapterId,k.snapshot));return y.length?(0,On.D)(y):(0,Ue.of)([])}),(0,J.U)(h=>{h.forEach(y=>{y.chapterId=p[y.chapterId]}),c.chapters.forEach(y=>{const k=h.find(B=>B.chapterId===y.id);k&&(y.thumbnails={...k.uris})})}),(0,eo.w)(()=>{const h=new TI;return h.title=e.title,h.isOwner=!0,h.index=c,h.viewMode=d,h.is_content_copy=!0,o&&(h.add_group_access=[o]),this.bookmarksService.saveBookmark(h)}),(0,vo.b)(h=>{r=h}),(0,eo.w)(()=>{if(o&&s&&s.length>0){const h=s[0].group_id,y=s.map(k=>({collection_id:k.collection_id,content_list:[{content_type:r.type,content_id:r.id}]}));return this.organizationsService.updateCollectionContent(h,y,[])}return(0,Ue.of)(!0)}),(0,je.x)(()=>{n.patchState({copying:!1,saving:!1})})).subscribe(()=>{this.pendoService.track("Bookmark Copy - Success"),n.dispatch(new pw(r))},h=>{this.pendoService.track("Bookmark Copy - Failure"),n.dispatch(new dw(e.id,h))})}setBookmarkText(n,e){const o=n.getState().selectedBookmark;n.patchState({selectedBookmark:{...o,title:e.title}})}setBookmarkViewMode(n,e){const o=n.getState().selectedBookmark;n.patchState({selectedBookmark:{...o,viewMode:e.viewMode}})}setSelectedCategory(n,{category:e}){n.patchState({selectedCategory:e||null})}cancelSaveBookmark(n,e){n.patchState({saving:!1})}cancelCopyBookmark(n,e){n.patchState({copying:!1})}};var ea;function FI(t,n){if(1&t&&(i.TgZ(0,"div",7)(1,"div",8),i._UZ(2,"app-icon",9),i.qZA()()),2&t){const e=i.oxw(2);i.xp6(2),i.Q6J("icon",e.icon)}}function UI(t,n){if(1&t&&(i.TgZ(0,"h3",10),i._uU(1),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Oqu(e.title)}}function RI(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",11),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleDismissClicked())}),i._UZ(1,"app-icon",12),i.qZA()}}function NI(t,n){if(1&t&&(i.TgZ(0,"div",1)(1,"div",2),i.YNc(2,FI,3,1,"div",3),i.TgZ(3,"div",4),i.YNc(4,UI,2,1,"h3",5),i.TgZ(5,"p"),i.Hsn(6),i.qZA()()(),i.YNc(7,RI,2,0,"button",6),i.qZA()),2&t){const e=i.oxw();i.ekj("message-toggle--message","message"===e.type)("message-toggle--error","error"===e.type)("message-toggle--notification","notification"===e.type)("message-toggle--warning","warning"===e.type)("message-toggle--rounded","rounded"===e.toggleStyle)("message-toggle--light","light"===e.theme)("message-toggle--dark","dark"===e.theme)("message-toggle--left","left"===e.toggleAlign)("message-toggle--center","center"===e.toggleAlign),i.Q6J("@show",void 0),i.xp6(2),i.Q6J("ngIf",e.icon),i.xp6(2),i.Q6J("ngIf",e.title),i.xp6(3),i.Q6J("ngIf",e.dismiss)}}Le.\u0275fac=function(n){return new(n||Le)(i.LFG(l.yh),i.LFG(l.eX),i.LFG(Xa),i.LFG(_g),i.LFG(Us),i.LFG(ip),i.LFG(Kr),i.LFG(bo),i.LFG(_i.ux),i.LFG(Ln),i.LFG(dn))},Le.\u0275prov=i.Yz7({token:Le,factory:Le.\u0275fac}),$e([(0,l.aU)(db),Z("design:type",Function),Z("design:paramtypes",[Object,db]),Z("design:returntype",void 0)],Le.prototype,"loadBookmarks",null),$e([(0,l.aU)(ub),Z("design:type",Function),Z("design:paramtypes",[Object,ub]),Z("design:returntype",void 0)],Le.prototype,"loadOrganizationBookmarks",null),$e([(0,l.aU)(gb),Z("design:type",Function),Z("design:paramtypes",[Object,gb]),Z("design:returntype",void 0)],Le.prototype,"loadCollectionBookmarks",null),$e([(0,l.aU)(Na),Z("design:type",Function),Z("design:paramtypes",[Object,Na]),Z("design:returntype",void 0)],Le.prototype,"loadSuccess",null),$e([(0,l.aU)(Jd),Z("design:type",Function),Z("design:paramtypes",[Object,Jd]),Z("design:returntype",void 0)],Le.prototype,"selectBookmark",null),$e([(0,l.aU)(Hd),Z("design:type",Function),Z("design:paramtypes",[Object,Hd]),Z("design:returntype",void 0)],Le.prototype,"selectBookmarkSuccess",null),$e([(0,l.aU)(fb),Z("design:type",Function),Z("design:paramtypes",[Object,fb]),Z("design:returntype",Promise)],Le.prototype,"saveBookmark",null),$e([(0,l.aU)(cl),Z("design:type",Function),Z("design:paramtypes",[Object,cl]),Z("design:returntype",void 0)],Le.prototype,"saveBookmarkSuccess",null),$e([(0,l.aU)(Kd),Z("design:type",Function),Z("design:paramtypes",[Object,Kd]),Z("design:returntype",void 0)],Le.prototype,"saveBookmarkFail",null),$e([(0,l.aU)(hb),Z("design:type",Function),Z("design:paramtypes",[Object,hb]),Z("design:returntype",void 0)],Le.prototype,"deleteBookmark",null),$e([(0,l.aU)(Yd),Z("design:type",Function),Z("design:paramtypes",[Object,Yd]),Z("design:returntype",void 0)],Le.prototype,"deleteBookmarkSuccess",null),$e([(0,l.aU)(mb),Z("design:type",Function),Z("design:paramtypes",[Object,mb]),Z("design:returntype",void 0)],Le.prototype,"bulkDeleteBookmark",null),$e([(0,l.aU)(Wd),Z("design:type",Function),Z("design:paramtypes",[Object,Wd]),Z("design:returntype",void 0)],Le.prototype,"bulkDeleteBookmarkSuccess",null),$e([(0,l.aU)(_b),Z("design:type",Function),Z("design:paramtypes",[Object,_b]),Z("design:returntype",void 0)],Le.prototype,"sortBookmarks",null),$e([(0,l.aU)(yb),Z("design:type",Function),Z("design:paramtypes",[Object,yb]),Z("design:returntype",void 0)],Le.prototype,"clearBookmarks",null),$e([(0,l.aU)(Xd),Z("design:type",Function),Z("design:paramtypes",[Object,Xd]),Z("design:returntype",void 0)],Le.prototype,"resetBookmarks",null),$e([(0,l.aU)(xb),Z("design:type",Function),Z("design:paramtypes",[Object,xb]),Z("design:returntype",void 0)],Le.prototype,"checkBookmark",null),$e([(0,l.aU)(vb),Z("design:type",Function),Z("design:paramtypes",[Object,vb]),Z("design:returntype",void 0)],Le.prototype,"setCheckedBookmarks",null),$e([(0,l.aU)(Cb),Z("design:type",Function),Z("design:paramtypes",[Object,Cb]),Z("design:returntype",void 0)],Le.prototype,"exportBookmarks",null),$e([(0,l.aU)(eu),Z("design:type",Function),Z("design:paramtypes",[Object,eu]),Z("design:returntype",void 0)],Le.prototype,"updateBookmarkCollections",null),$e([(0,l.aU)(tu),Z("design:type",Function),Z("design:paramtypes",[Object,tu]),Z("design:returntype",void 0)],Le.prototype,"removeBookmarkCollectionSuccess",null),$e([(0,l.aU)(Pb),Z("design:type",Function),Z("design:paramtypes",[Object,Pb]),Z("design:returntype",void 0)],Le.prototype,"copyBookmark",null),$e([(0,l.aU)(Ob),Z("design:type",Function),Z("design:paramtypes",[Object,Ob]),Z("design:returntype",void 0)],Le.prototype,"setBookmarkText",null),$e([(0,l.aU)(Tb),Z("design:type",Function),Z("design:paramtypes",[Object,Tb]),Z("design:returntype",void 0)],Le.prototype,"setBookmarkViewMode",null),$e([(0,l.aU)(Mb),Z("design:type",Function),Z("design:paramtypes",[Object,Mb]),Z("design:returntype",void 0)],Le.prototype,"setSelectedCategory",null),$e([(0,l.aU)(bb),Z("design:type",Function),Z("design:paramtypes",[Object,bb]),Z("design:returntype",void 0)],Le.prototype,"cancelSaveBookmark",null),$e([(0,l.aU)(kb),Z("design:type",Function),Z("design:paramtypes",[Object,kb]),Z("design:returntype",void 0)],Le.prototype,"cancelCopyBookmark",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getBookmarks",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getCheckedBookmarks",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getSelectedBookmark",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getSelectedBookmarkViewMode",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getLoading",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getExporting",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getSaving",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getCopying",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getSort",null),$e([(0,l.Qf)(),Z("design:type",Function),Z("design:paramtypes",[ao]),Z("design:returntype",void 0)],Le,"getSelectedCategory",null),Le=$e([(0,l.ZM)({name:"bookmarks",defaults:K_}),Z("design:paramtypes",[l.yh,l.eX,Xa,_g,Us,ip,Kr,bo,_i.ux,Ln,dn])],Le),function(t){t.slideTransition=(0,j.oQ)([(0,j.oB)({transform:"translateY({{ from }}%)",opacity:0}),(0,j.jt)("{{ duration }}ms ease-out",(0,j.oB)({transform:"translateY({{ to }})",opacity:1}))]),t.fadeIn=(0,j.oQ)([(0,j.oB)({opacity:0}),(0,j.jt)("{{ duration }}ms ease-out",(0,j.oB)({opacity:1}))]),t.fadeOut=(0,j.oQ)([(0,j.oB)({opacity:"*"}),(0,j.jt)("{{ duration }}ms ease-in",(0,j.oB)({opacity:0}))])}(ea||(ea={}));const EI=["*"];let op=(()=>{class t{constructor(e){this.changeRef=e,this.type="message",this.theme="light",this.toggleAlign="left",this.showDelay=0,this.hideDelay=5e3,this.dismiss=!1,this.toggleStyle="rounded",this.handleDismiss=new X.x,this._shown=!0,this.shownSubject=new X.x,this.ngUnsubscribe=new X.x}get shown(){return this._shown}set shown(e){this._shown!==e&&(this._shown=e,this.shownSubject.next(e),this.changeRef.markForCheck())}ngOnInit(){this.initViewShownListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismissClicked(){this.handleDismiss.next()}initViewShownListeners(){this.shownSubject.pipe((0,$.h)(()=>this.hideDelay>0),(0,cn.b)(this.hideDelay),(0,$.h)(e=>e),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this._shown=!1,this.changeRef.markForCheck()})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-message-toggle"]],inputs:{type:"type",theme:"theme",toggleAlign:"toggleAlign",icon:"icon",title:"title",showDelay:"showDelay",hideDelay:"hideDelay",dismiss:"dismiss",toggleStyle:"toggleStyle",shown:"shown"},outputs:{handleDismiss:"handleDismiss"},ngContentSelectors:EI,decls:1,vars:1,consts:[["class","message-toggle flex flex-row items-start justify-between",3,"message-toggle--message","message-toggle--error","message-toggle--notification","message-toggle--warning","message-toggle--rounded","message-toggle--light","message-toggle--dark","message-toggle--left","message-toggle--center",4,"ngIf"],[1,"message-toggle","flex","flex-row","items-start","justify-between"],[1,"message-toggle__wrapper","flex","flex-row","flex-auto"],["class","mr-3",4,"ngIf"],[1,"message-toggle__content"],["class","text-semibold mb-1",4,"ngIf"],["class","message-toggle__icon message-toggle__dismiss",3,"click",4,"ngIf"],[1,"mr-3"],[1,"message-toggle__icon"],[3,"icon"],[1,"text-semibold","mb-1"],[1,"message-toggle__icon","message-toggle__dismiss",3,"click"],["icon","times"]],template:function(e,o){1&e&&(i.F$t(),i.YNc(0,NI,8,22,"div",0)),2&e&&i.Q6J("ngIf",o.shown)},dependencies:[f.O5,lt],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}:root{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle{padding:16px;box-sizing:border-box;font-size:13px;line-height:20px;color:var(--message-toggle-color);background-color:var(--message-toggle-background-color)}.message-toggle--rounded{border-radius:4px}.message-toggle__icon{display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:1px;color:#fff;font-size:16px;background:none;border:none;color:var(--message-toggle-icon-color)}.message-toggle__content{padding:0 2px;word-break:break-word}.message-toggle__dismiss{font-size:14px;color:var(--message-toggle-color)}.message-toggle--left .message-toggle__content{flex:1 1 auto}.message-toggle--center .message-toggle__wrapper{justify-content:center}.message-toggle.message-toggle--message{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0fff0;--message-toggle-icon-color: #33cd54}.message-toggle.message-toggle--notification{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle.message-toggle--warning{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fffcf0;--message-toggle-icon-color: #ffb92e}.message-toggle.message-toggle--error{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fff3f0;--message-toggle-icon-color: #f44336}.message-toggle--dark.message-toggle--message{--message-toggle-background-color: #e3ffe5}.message-toggle--dark.message-toggle--notification{--message-toggle-background-color: #d6ecff}.message-toggle--dark.message-toggle--warning{--message-toggle-background-color: #fff6d1}.message-toggle--dark.message-toggle--error{--message-toggle-background-color: #ffe2db}\n"],encapsulation:2,data:{animation:[(0,j.X$)("show",[(0,j.eR)(":enter",[(0,j._7)(ea.fadeIn,{params:{duration:300}})]),(0,j.eR)(":leave",[(0,j._7)(ea.fadeOut,{params:{duration:300}})])])]},changeDetection:0}),t})();function QI(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1)(1,"app-message-toggle",2),i.NdJ("handleDismiss",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleDismiss())}),i.TgZ(2,"div"),i._uU(3," This model is not optimized for use on mobile devices. For an optimal experience, please switch to a desktop device or try our Anatomy by Regions. "),i.qZA()()()}2&t&&(i.xp6(1),i.Q6J("dismiss",!0))}class ta{constructor(n){this.changeRef=n,this.shown=!1,this.ngUnsubscribe=new X.x}ngOnInit(){this.bookmark$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=(0,m.get)(n,"tags",[]);this.shown=e.includes("complete anatomy"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismiss(){this.shown=!1,this.changeRef.markForCheck()}}function ZI(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1)(1,"app-message-toggle",2),i.NdJ("handleDismiss",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleDismiss())}),i.TgZ(2,"div"),i._uU(3," This model appears to be performing slowly on your device. For an optimal experience, please switch to a different device or try another model. "),i.qZA()()()}2&t&&(i.xp6(1),i.Q6J("dismiss",!0))}ta.\u0275fac=function(n){return new(n||ta)(i.Y36(i.sBO))},ta.\u0275cmp=i.Xpm({type:ta,selectors:[["app-view-content-warning"]],decls:2,vars:3,consts:[["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"dismiss","handleDismiss"]],template:function(n,e){1&n&&(i.YNc(0,QI,4,1,"div",0),i.ALo(1,"async")),2&n&&i.Q6J("ngIf",i.lcZ(1,1,e.bookmark$)&&e.shown)},dependencies:[f.O5,op,f.Ov],styles:[".warning{position:fixed;top:0;left:0;right:0;z-index:1001}\n"],encapsulation:2,changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(Le.getSelectedBookmark),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ta.prototype,"bookmark$",void 0);const Xs=[];let sp,rp,VI=(()=>{class t{constructor(e,o){this.storageService=e,this.changeRef=o,this.shown=!1,this.sampling=!1}ngOnInit(){this.storageService.getLocalItem(fn.Iphone12Warning)||this.testDevices()}ngOnDestroy(){this.sampling=!1}testDevices(){const e=window.matchMedia("only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"),o=window.matchMedia("only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"),s=window.matchMedia("only screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"),r=e.matches||o.matches||s.matches,a=/iPhone|iPad/.test(navigator.userAgent),c=/OS\s14/.test(navigator.userAgent);r&&a&&c&&this.startFrameSampling()}startFrameSampling(){this.sampling=!0,sp=0,rp=Date.now();const e=()=>{this.frame()?(this.shown=!0,this.changeRef.markForCheck()):this.sampling&&requestAnimationFrame(e)};requestAnimationFrame(e)}frame(){sp++;const e=Date.now();if(e>=rp+500){const s=Math.floor(500*sp/(e-rp)*2);if(Xs.push(s),Xs.length>3&&Xs.shift(),3===Xs.length&&(Xs[0]+Xs[1]+Xs[2])/3<10)return!0;rp=e,sp=0}}handleDismiss(){this.shown=!1,this.changeRef.markForCheck(),this.storageService.setLocalItem(fn.Iphone12Warning,!0)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(dn),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-iphone12-warning"]],decls:1,vars:1,consts:[["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"dismiss","handleDismiss"]],template:function(e,o){1&e&&i.YNc(0,ZI,4,1,"div",0),2&e&&i.Q6J("ngIf",o.shown)},dependencies:[f.O5,op],styles:[".warning[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1002}"],changeDetection:0}),t})();const qI=["viewLoader"],$I=["*"];let GI=(()=>{class t{constructor(e,o,s){this.renderer=e,this.viewService=o,this.actions=s,this.ngUnsubscribe=new X.x}handleClick(){this.renderer.addClass(this.viewLoaderRef.nativeElement,"view-loader--disappear"),setTimeout(()=>{this.viewService.toggleInteract(!1),this.viewService.playChapterFromStart()},250)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(ut),i.Y36(l.eX))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-loader"]],viewQuery:function(e,o){if(1&e&&i.Gf(qI,7),2&e){let s;i.iGM(s=i.CRH())&&(o.viewLoaderRef=s.first)}},ngContentSelectors:$I,decls:4,vars:0,consts:[["role","dialog",1,"view-loader"],["viewLoader",""],["role","button",3,"click"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0,1)(2,"div",2),i.NdJ("click",function(){return o.handleClick()}),i.Hsn(3),i.qZA()())},encapsulation:2,changeDetection:0}),t})();var wg=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Sg=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const X_=function(t,n,e,o){return{"view-logo--full-color":t,"view-logo--full-white":n,"view-logo--small-color":e,"view-logo--small-white":o}};function JI(t,n){if(1&t&&(i.ynx(0),i._UZ(1,"a",1),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("href","https://www.biodigital.com?utm_source="+(e.isNative?"human_mobile":"human_web")+"&utm_medium=PLG&utm_campaign=poweredby&ref=poweredby",i.LSH)("ngClass",i.l5B(2,X_,"color"===e.logoColor&&"full"===e.logoSize,"white"===e.logoColor&&"full"===e.logoSize,"color"===e.logoColor&&"small"===e.logoSize,"white"===e.logoColor&&"small"===e.logoSize))}}function HI(t,n){if(1&t&&(i.ynx(0),i._UZ(1,"span",2),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngClass",i.l5B(1,X_,"color"===e.logoColor&&"full"===e.logoSize,"white"===e.logoColor&&"full"===e.logoSize,"color"===e.logoColor&&"small"===e.logoSize,"white"===e.logoColor&&"small"===e.logoSize))}}class Qo{constructor(){this.logoSize="full",this.logoColor="color",this.contentTitle="",this.source="",this.isNative=!1,this.isLight=!0,this.breakpoint=_t,this.ngUnsubscribe=new X.x}ngOnInit(){this.isNative=se.native}}Qo.\u0275fac=function(n){return new(n||Qo)},Qo.\u0275cmp=i.Xpm({type:Qo,selectors:[["app-view-logo"]],inputs:{logoSize:"logoSize",logoColor:"logoColor",contentTitle:"contentTitle"},decls:4,vars:6,consts:[[4,"ngIf"],["target","_blank","title","Powered by BioDigital","aria-label","Powered by BioDigital (opens in a new tab)","data-test","viewLogo",1,"view-logo",3,"href","ngClass"],["title","Powered by BioDigital",1,"view-logo",3,"ngClass"]],template:function(n,e){if(1&n&&(i.YNc(0,JI,2,7,"ng-container",0),i.ALo(1,"async"),i.YNc(2,HI,2,6,"ng-container",0),i.ALo(3,"async")),2&n){let o,s;i.Q6J("ngIf",null==(o=i.lcZ(1,2,e.layout$))?null:o.logo.isHyperLink),i.xp6(2),i.Q6J("ngIf",!(null!=(s=i.lcZ(3,4,e.layout$))&&s.logo.isHyperLink))}},dependencies:[f.mk,f.O5,f.Ov],styles:["[_nghost-%COMP%]{display:flex;height:52px;align-items:center}.view-logo[_ngcontent-%COMP%]:focus{border-radius:4px;outline:#2d72dc solid 2px!important}.view-logo--small-color[_ngcontent-%COMP%]{width:28px;height:44px;background:url(logo-color.svg) center center no-repeat}.view-logo--full-color[_ngcontent-%COMP%]{width:120px;height:32px;background:url(powered-by-biodigital-color.svg) center center no-repeat}.view-logo--small-white[_ngcontent-%COMP%]{width:28px;height:44px;background:url(logo-white.svg) center center no-repeat}.view-logo--full-white[_ngcontent-%COMP%]{width:120px;height:32px;background:url(powered-by-biodigital-white.svg) center center no-repeat}.view-logo[_ngcontent-%COMP%]:not([hidden]){display:flex}.view-logo[href][_ngcontent-%COMP%]:hover{cursor:pointer}"],changeDetection:0}),wg([(0,l.Ph)(O.getUI),Sg("design:type",b.y)],Qo.prototype,"layout$",void 0),wg([(0,l.Ph)(_.getSelectedChapterBackground),Sg("design:type",b.y)],Qo.prototype,"background$",void 0),wg([(0,l.Ph)(Pt.getBreakpoint),Sg("design:type",b.y)],Qo.prototype,"breakpoint$",void 0);const YI=["*"];let WI=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-list-container"],["","app-view-list-container",""]],ngContentSelectors:YI,decls:2,vars:0,consts:[[1,"view-list-container"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0),i.Hsn(1),i.qZA())},styles:[".view-list-container{display:flex;flex-direction:column}\n"],encapsulation:2,changeDetection:0}),t})();const KI=function(t){return{"view-list-item--selected":t}},XI=["*"];let e3=(()=>{class t{constructor(){this.selected=!1}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-list-item"],["","app-view-list-item",""]],inputs:{selected:"selected"},ngContentSelectors:XI,decls:2,vars:3,consts:[[1,"view-list-item",3,"ngClass"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"div",0),i.Hsn(1),i.qZA()),2&e&&i.Q6J("ngClass",i.VKq(1,KI,o.selected))},dependencies:[f.mk],styles:['.text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.button{font-size:12px;letter-spacing:.3px;line-height:1.4em;align-items:center;background:none;border-color:transparent;border-radius:4px;border-width:0;color:inherit;display:flex;font-family:Inter UI,sans-serif;justify-content:center;margin:0;outline:0 none;padding:0 16px;position:relative;text-align:center;text-decoration:none;transition:background-color .12s;width:100%}.button:not([disabled]):hover{cursor:pointer}.button:focus .button--themed{outline:#2d72dc solid 2px!important}.button:after{content:" ";background-color:#283853;border-radius:4px;display:block;position:absolute;inset:0;opacity:0;z-index:1;transition:opacity .06s}.button:not(.button--disabled):hover:after{opacity:.7}.button__container{position:relative;z-index:2;width:100%}.button--uppercase{text-transform:uppercase}.button--expanded{display:flex;flex:1}.button--xsmall{height:24px;min-width:24px;padding:0 8px;font-size:10px;letter-spacing:.25px;line-height:1.4em}.button--small{height:32px;min-width:32px;padding:0 12px;font-size:12px;letter-spacing:.3px;line-height:1.4em}.button--medium{height:36px;min-width:36px;padding:0 16px;font-size:12px;letter-spacing:.3px;line-height:1.4em}.button--large{height:48px;min-width:48px;padding:0 16px;font-size:14px;letter-spacing:.35px;line-height:1.4em}.button--no-border{border-radius:0!important}.button--no-border:after{border-radius:0!important}.button--left{text-align:left}.button--themed{color:#374a68}.button--themed:hover{color:#1c2a3f}.button--themed:after{background-color:#d7e0ea}.button--dark{color:#d7e0ea}.button--dark:hover{color:#fff}.button--dark:after{background-color:#283853}.button--dark.button--flat{background:#374a68}.button--dark.button--default{background:transparent}.button--dark.button--outline{background:transparent;border:1px solid #374a68;transition:border-color .12s}.button--dark.button--outline:hover{border-color:#96a8c0}.button--dark.button--outline:hover:after{background-color:transparent;display:none}.button--dark.button--text{background:transparent;color:#d7e0ea}.button--dark.button--text:hover{color:#fff}.button--dark.button--text:hover:after{display:none}.button--dark.button--selected{background-color:#2d72dc;color:#fff}.button--dark.button--selected:hover:after{display:none}.button--light{color:#283853}.button--light:hover{color:#1c2a3f}.button--light:after{background-color:#96a8c0}.button--light:not(.button--disabled):hover:after{opacity:.6}.button--light.button--flat{background:#d7e0ea;font-weight:500}.button--light.button--flat.button--selected{background-color:#96a8c0}.button--light.button--default{background:transparent;color:#131c2a}.button--light.button--default:not(.button--disabled):hover:after{opacity:.2}.button--light.button--outline{background:transparent;border:1px solid #96a8c0;color:#283853;transition:border-color .12s}.button--light.button--outline:after{display:none}.button--light.button--outline:hover{background:rgba(55,74,104,.05);border-color:#374a68;color:#1c2a3f}.button--light.button--outline:hover:after{background-color:transparent}.button--light.button--selected{background-color:#eaeff5}.button--light.button--selected:hover:after{display:none}.button--light.button--text{color:#283853}.button--light.button--text:hover{color:#1c2a3f}.button--light.button--text:hover:after{display:none}.button--primary{background:#de3535;color:#fff}.button--primary:after{background:#f9fafd}.button--primary:not([disabled]):hover:after{opacity:.1}.button--info{background:#3892dc;color:#fff}.button--info:after{background:#f9fafd}.button--info:hover:after{opacity:.1}.button--selected{background-color:#2d72dc}.button--disabled{opacity:.5}.button--circle{border-radius:50%}.button--circle.button--xsmall{width:24px}.button--circle.button--small{width:32px;padding:0 6px}.button--circle.button--medium{width:36px;padding:0 8px}.button--circle.button--large{width:48px}.button--circle:after{border-radius:50%}.button--rounded{border-radius:18px}.button--rounded:after{border-radius:18px}[app-view-list-item]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all;display:flex;width:100%}[app-view-list-item]::-moz-focus-inner{border:0}[app-view-list-item]:not([disabled]):hover{cursor:pointer}.view-list-item{font-size:14px;letter-spacing:.35px;line-height:1.4em;display:flex;flex-grow:1;flex-direction:row;padding:12px;border-radius:2px;border-left:4px solid transparent;background-color:transparent;color:#131c2a;transition:background-color 125ms,color 125ms,border 125ms}.view-list-item:hover{cursor:pointer;background:#eaeff5}.view-list-item:focus{outline:#2d72dc solid 2px!important}.view-list-item--selected{border-left:4px solid #2d72dc;background-color:#f0f8ff}.view-list-item__index{display:flex;flex:0 0 32px;justify-content:center}.view-list-item__title{word-wrap:break-word;overflow-wrap:break-word;display:flex;flex:1 1 auto;padding-right:4px}.view-list-item__thumb{background-color:#f9fafd;background-size:cover;border-radius:4px;background-repeat:no-repeat;flex:0 0 56px;height:56px;width:56px;transition:border-color .1s}\n'],encapsulation:2,changeDetection:0}),t})();var ap=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},cp=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function t3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",2),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleCloseClick())}),i.qZA()}}function n3(t,n){1&t&&(i.TgZ(0,"span"),i._uU(1,"Hide Labels"),i.qZA())}function i3(t,n){1&t&&(i.TgZ(0,"span"),i._uU(1,"Show Labels"),i.qZA())}function o3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"app-view-column",3)(1,"nav",4)(2,"app-view-panel",5),i._UZ(3,"app-view-logo"),i.qZA(),i.TgZ(4,"app-view-panel",5)(5,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleCloseClick())}),i._uU(6,"Close"),i.qZA()(),i.TgZ(7,"app-view-panel",5)(8,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggleToolbar("tools"))}),i._UZ(9,"app-icon",7),i._uU(10," Open Explore Tools "),i.qZA(),i.TgZ(11,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggleToolbar("media"))}),i._UZ(12,"app-icon",8),i._uU(13," Open Media Controls "),i.qZA(),i.TgZ(14,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSearchClick())}),i._UZ(15,"app-icon",9),i._uU(16," Search Anatomy "),i.qZA()(),i.TgZ(17,"app-view-panel",5)(18,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleFullscreenClick())}),i._UZ(19,"app-icon",10),i._uU(20," Enter Fullscreen "),i.qZA()(),i.TgZ(21,"app-view-panel",5)(22,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggleLabelsClick())}),i._UZ(23,"app-icon",11),i.YNc(24,n3,2,0,"span",12),i.ALo(25,"async"),i.YNc(26,i3,2,0,"span",12),i.ALo(27,"async"),i.qZA()(),i.TgZ(28,"app-view-panel",5)(29,"button",13),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleTutorialClick())}),i.ALo(30,"async"),i._uU(31," Launch Tutorial "),i.qZA(),i.TgZ(32,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleHelpBasicsClick())}),i._uU(33,"3D Navigation Basics"),i.qZA(),i.TgZ(34,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleHelpShortcutsClick())}),i._uU(35,"Keyboard Shortcuts"),i.qZA()()()()}if(2&t){const e=i.oxw();let o;i.Q6J("@slideInOut",void 0),i.xp6(2),i.Q6J("showHeader",!1),i.xp6(2),i.Q6J("showHeader",!1),i.xp6(3),i.Q6J("showHeader",!1),i.xp6(10),i.Q6J("showHeader",!1),i.xp6(4),i.Q6J("showHeader",!1),i.xp6(3),i.Q6J("ngIf",i.lcZ(25,10,e.showLabels$)),i.xp6(2),i.Q6J("ngIf",!i.lcZ(27,12,e.showLabels$)),i.xp6(2),i.Q6J("showHeader",!1),i.xp6(1),i.Q6J("disabled",!(null!=(o=i.lcZ(30,14,e.selectedChapterReady$))&&o.model))}}class Zo{constructor(n,e){this.store=n,this.viewService=e}ngOnInit(){}handleCloseClick(){this.store.dispatch(new T.ToggleMenu(!1))}handleToggleLabelsClick(){this.viewService.toggleLabels()}handleFullscreenClick(){this.handleCloseClick(),Rn.toggleFullscreen()}handleNewTabClick(){this.handleCloseClick(),this.viewService.openInNewTab()}handleSearchClick(){this.handleCloseClick(),this.viewService.toggleSearch()}handleTutorialClick(){this.handleCloseClick(),this.viewService.toggleTutorial(!0)}handleHelpBasicsClick(){this.handleCloseClick(),this.viewService.toggleHelp(di.Basics)}handleHelpShortcutsClick(){this.handleCloseClick(),this.viewService.toggleHelp(di.Shortcuts)}handleToggleToolbar(n){this.handleCloseClick();const e=this.store.selectSnapshot(O.getUI);e.media.status=Pe.Hide,e.tools.status=Pe.Hide,e.toolbar.status=Pe.Hide,e[n].status=Pe.Show,this.store.dispatch(new T.SetUI(e))}}Zo.\u0275fac=function(n){return new(n||Zo)(i.Y36(l.yh),i.Y36(ut))},Zo.\u0275cmp=i.Xpm({type:Zo,selectors:[["app-view-menu-column"]],decls:4,vars:6,consts:[["class","view-menu-scrim",3,"click",4,"ngIf"],["placement","right","class","view-menu-column",4,"ngIf"],[1,"view-menu-scrim",3,"click"],["placement","right",1,"view-menu-column"],["app-view-list-container",""],["padding","dense",3,"showHeader"],["app-view-list-item","",3,"click"],["icon","pen",1,"mr-3"],["icon","play",1,"mr-3"],["icon","search",1,"mr-3"],["icon","expand",1,"mr-3"],["icon","tag",1,"mr-3"],[4,"ngIf"],["app-view-list-item","",3,"disabled","click"]],template:function(n,e){1&n&&(i.YNc(0,t3,1,0,"div",0),i.ALo(1,"async"),i.YNc(2,o3,36,16,"app-view-column",1),i.ALo(3,"async")),2&n&&(i.Q6J("ngIf",i.lcZ(1,2,e.menuOpen$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(3,4,e.menuOpen$)))},dependencies:[f.O5,lt,$s,WI,e3,Qo,By,f.Ov],styles:[".view-menu-column[_ngcontent-%COMP%]{position:absolute;top:0;right:0;z-index:10000;height:100%}.view-menu-scrim[_ngcontent-%COMP%]{background:rgba(0,0,0,.2);display:flex;position:fixed;justify-content:center;align-items:center;inset:0;transition:background-color .25s,opacity .25s;z-index:10000}.view-menu-scrim[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:rgba(0,0,0,.2)}"],data:{animation:[(0,j.X$)("slideInOut",[(0,j.eR)(":enter",[(0,j.oB)({transform:"translateX(320px)"}),(0,j.jt)("200ms ease-out",(0,j.oB)({transform:"*"}))]),(0,j.eR)(":leave",[(0,j.jt)("200ms",(0,j.oB)({transform:"translateX(320px)"}))])])]},changeDetection:0}),ap([(0,l.Ph)(_.getSelectedChapterReadyState),cp("design:type",b.y)],Zo.prototype,"selectedChapterReady$",void 0),ap([(0,l.Ph)(O.getMenuOpen),cp("design:type",b.y)],Zo.prototype,"menuOpen$",void 0),ap([(0,l.Ph)(O.getCanTouch),cp("design:type",b.y)],Zo.prototype,"canTouch$",void 0),ap([(0,l.Ph)(M.getShowLabels),cp("design:type",b.y)],Zo.prototype,"showLabels$",void 0);var er=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},tr=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function s3(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"button",15),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleTreeClick())}),i._UZ(2,"app-icon",16),i.TgZ(3,"span",17),i._uU(4,"Anatomy Tree"),i.qZA()(),i.TgZ(5,"button",18),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSearchClick())}),i._UZ(6,"app-icon",19),i.TgZ(7,"span",17),i._uU(8,"Search"),i.qZA()(),i._UZ(9,"mat-divider"),i.BQk()}}function r3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",20),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.toggleToolbar("visibilityLayers"))}),i._UZ(1,"app-icon",21),i.TgZ(2,"span",17),i._uU(3,"Layers"),i.qZA()()}}function a3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",22),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleDrawClick())}),i.ALo(1,"async"),i._UZ(2,"app-icon",23),i.TgZ(3,"span",17),i._uU(4,"Draw"),i.qZA()()}if(2&t){const e=i.oxw();let o;i.Q6J("disabled",!(null!=(o=i.lcZ(1,1,e.selectedChapterReady$))&&o.model))}}function c3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",24),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleTakeQuizClick())}),i.ALo(1,"async"),i.ALo(2,"async"),i._UZ(3,"app-icon",25),i.TgZ(4,"span",17),i._uU(5,"Take Quiz"),i.qZA()()}if(2&t){const e=i.oxw();let o;i.Q6J("disabled",!(null!=(o=i.lcZ(1,1,e.selectedChapterReady$))&&o.model)||i.lcZ(2,3,e.quizActive$))}}function l3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",26),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.toggleToolbar("media"))}),i._UZ(1,"app-icon",27),i._uU(2," Open Media Bar "),i.qZA()}}function p3(t,n){if(1&t&&(i.TgZ(0,"button",28),i._uU(1," Settings "),i.qZA()),2&t){i.oxw();const e=i.MAs(16);i.Q6J("matMenuTriggerFor",e)}}function d3(t,n){if(1&t&&(i.TgZ(0,"button",28),i._uU(1,"Help"),i.qZA()),2&t){i.oxw();const e=i.MAs(20);i.Q6J("matMenuTriggerFor",e)}}function u3(t,n){1&t&&(i.ynx(0),i._uU(1,"Exit Fullscreen"),i.BQk())}function g3(t,n){1&t&&(i.ynx(0),i._uU(1,"Enter Fullscreen"),i.BQk())}function h3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",31),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleFullscreenClick())}),i.YNc(1,u3,2,0,"ng-container",3),i.YNc(2,g3,2,0,"ng-container",3),i.qZA()}if(2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.isFullscreen),i.xp6(1),i.Q6J("ngIf",!e.isFullscreen)}}function m3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",33),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(3);return i.KtG(s.handleNewTabClick())}),i._uU(1," Open in New Tab "),i.qZA()}}function f3(t,n){if(1&t&&(i.ynx(0),i.YNc(1,m3,2,0,"button",32),i.BQk()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",!e.canFullscreen)}}function b3(t,n){if(1&t&&(i.ynx(0),i.YNc(1,h3,3,2,"button",29),i.YNc(2,f3,2,1,"ng-container",30),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.canFullscreen),i.xp6(1),i.Q6J("appFlagApplication",e.application.All)("appFlagApplicationMode","exclude")("appFlagApplicationNative",e.nativePlatform.All)}}function y3(t,n){1&t&&(i.ynx(0),i._uU(1,"Hide Labels"),i.BQk())}function _3(t,n){1&t&&(i.ynx(0),i._uU(1,"Show Labels"),i.BQk())}function x3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",34),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleToggleLabelsClick())}),i.YNc(1,y3,2,0,"ng-container",3),i.ALo(2,"async"),i.YNc(3,_3,2,0,"ng-container",3),i.ALo(4,"async"),i.qZA()}if(2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",i.lcZ(2,2,e.showLabels$)),i.xp6(2),i.Q6J("ngIf",!i.lcZ(4,4,e.showLabels$))}}class Si{constructor(n,e,o,s,r){this.viewUIService=n,this.viewService=e,this.quizService=o,this.changeDetectorRef=s,this.store=r,this.application=mt,this.nativePlatform=Br,this.bookmarkViewMode=ki,this.viewUI=x,this.isFullscreen=!1,this.canFullscreen=!1,this.ngUnsubscribe=new X.x,this.visibilityLayersVisible=!1,this.showTakeQuiz=!1}ngOnInit(){this.canFullscreen=Rn.canFullscreen(),this.initFullscreenListener(),this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFullscreenListener(){this.fullscreen$=Rn.onFullscreenChange(),this.fullscreen$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.isFullscreen=Rn.isFullscreen(),this.changeDetectorRef.markForCheck()})}initLayoutListener(){this.store.select(O.getUI).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.visibilityLayersVisible=this.viewUIService.isVisible(x.VisibilityLayers),this.changeDetectorRef.markForCheck()})}initTakeQuizButton(){(0,bt.a)([this.hasQuiz$,this.quizEnabled$,this.quizLocked$,this.selectedBookmarkViewMode$]).pipe((0,J.U)(([n,e,o,s])=>!(!n||!e)&&(!(!o||s===ki.Content)||void 0)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.showTakeQuiz=n})}handleToggleLabelsClick(){this.viewService.showLabels()}handleFullscreenClick(){Rn.toggleFullscreen()}handleTutorialClick(){this.viewService.toggleTutorial(!0)}handleTakeQuizClick(){this.quizService.startQuiz()}handleHelpBasicsClick(){this.viewService.toggleHelp(di.Basics)}handleHelpShortcutsClick(){this.viewService.toggleHelp(di.Shortcuts)}handlePresentClick(){this.viewService.togglePresentation()}handleNewTabClick(){this.viewService.openInNewTab()}handleSearchClick(){this.viewService.toggleSearch(an.List,!0)}handleTreeClick(){this.viewService.toggleSearch(an.Tree,!0)}handleDrawClick(){this.viewService.toggleWhiteboard(!0)}toggleToolbar(n){this.viewService.toggleToolbar(n)}isEnabled(n){return this.viewUIService.isUIEnabled(n)}isVisible(n){return this.viewUIService.isVisible(n)}}function w3(t,n){1&t&&i._UZ(0,"app-play-loader")}function S3(t,n){1&t&&i._UZ(0,"app-button-loader")}function P3(t,n){1&t&&i._UZ(0,"app-hand-loader")}function k3(t,n){1&t&&i._UZ(0,"div",7)}Si.\u0275fac=function(n){return new(n||Si)(i.Y36(ri),i.Y36(ut),i.Y36(Ns),i.Y36(i.sBO),i.Y36(l.yh))},Si.\u0275cmp=i.Xpm({type:Si,selectors:[["app-view-menu"]],decls:28,vars:22,consts:function(){let t,n;return t=$localize`:␟41aac9cecddc9f345c263d3742192e68e227e413␟2102825898069375693:Menu`,n=$localize`:␟781f36678b1ae19cf094db4be9baeb470db61e94␟8845498072006738037:View Menu`,[["type","button","data-test","viewMenu","matTooltip",t,"app-pin-button","","buttonType","secondary","icon","bars","aria-label",n,2,"width","52px","height","52px",3,"matMenuTriggerFor","fill"],[1,"view-menu"],["viewMenu","matMenu"],[4,"ngIf"],["mat-menu-item","","data-test","viewLayersButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewDrawButton",3,"disabled","click",4,"ngIf"],["mat-menu-item","","data-test","viewQuizButton",3,"disabled","click",4,"ngIf"],["mat-menu-item","","data-test","viewMediaBarButton",3,"click",4,"ngIf"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["settingsMenu","matMenu"],["mat-menu-item","","data-test","viewToggleLabels",3,"click",4,"ngIf"],["helpMenu","matMenu"],["mat-menu-item","","data-test","viewLaunchTutorial",3,"disabled","click"],["mat-menu-item","","data-test","view3DNavigationBasics",3,"click"],["mat-menu-item","","data-test","viewKeyboardShortcuts",3,"click"],["mat-menu-item","","data-test","viewTreeButton",3,"click"],["icon","sitemap",1,"view-menu__icon"],[1,"ml-2"],["mat-menu-item","","data-test","viewSearchButton",3,"click"],["icon","search",1,"view-menu__icon"],["mat-menu-item","","data-test","viewLayersButton",3,"click"],["icon","layer-group",1,"view-menu__icon"],["mat-menu-item","","data-test","viewDrawButton",3,"disabled","click"],["icon","signature",1,"view-menu__icon"],["mat-menu-item","","data-test","viewQuizButton",3,"disabled","click"],["icon","check",1,"view-menu__icon"],["mat-menu-item","","data-test","viewMediaBarButton",3,"click"],["icon","play",1,"view-menu__icon"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","viewHandleFullscreen",3,"click",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],["mat-menu-item","","data-test","viewHandleFullscreen",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","viewToggleLabels",3,"click"]]},template:function(n,e){if(1&n&&(i._UZ(0,"button",0),i.TgZ(1,"mat-menu",1,2),i.YNc(3,s3,10,0,"ng-container",3),i.YNc(4,r3,4,0,"button",4),i.YNc(5,a3,5,3,"button",5),i.YNc(6,c3,6,5,"button",6),i.ALo(7,"async"),i.ALo(8,"async"),i.ALo(9,"async"),i.ALo(10,"async"),i.YNc(11,l3,3,0,"button",7),i._UZ(12,"mat-divider"),i.YNc(13,p3,2,1,"button",8),i.YNc(14,d3,2,1,"button",8),i.qZA(),i.TgZ(15,"mat-menu",null,9),i.YNc(17,b3,3,4,"ng-container",3),i.YNc(18,x3,5,6,"button",10),i.qZA(),i.TgZ(19,"mat-menu",null,11)(21,"button",12),i.NdJ("click",function(){return e.handleTutorialClick()}),i.ALo(22,"async"),i._uU(23," Launch Tutorial "),i.qZA(),i.TgZ(24,"button",13),i.NdJ("click",function(){return e.handleHelpBasicsClick()}),i._uU(25," 3D Navigation Basics "),i.qZA(),i.TgZ(26,"button",14),i.NdJ("click",function(){return e.handleHelpShortcutsClick()}),i._uU(27," Keyboard Shortcuts "),i.qZA()()),2&n){const o=i.MAs(2);let s;i.Q6J("matMenuTriggerFor",o)("fill",!0),i.xp6(3),i.Q6J("ngIf",e.isEnabled(e.viewUI.Search)),i.xp6(1),i.Q6J("ngIf",e.visibilityLayersVisible),i.xp6(1),i.Q6J("ngIf",e.isEnabled(e.viewUI.Whiteboard)),i.xp6(1),i.Q6J("ngIf",i.lcZ(7,12,e.hasQuiz$)&&i.lcZ(8,14,e.quizEnabled$)&&!i.lcZ(9,16,e.quizLocked$)&&i.lcZ(10,18,e.selectedBookmarkViewMode$)!==e.bookmarkViewMode.Content),i.xp6(5),i.Q6J("ngIf",e.isVisible(e.viewUI.ScrubberItem)),i.xp6(2),i.Q6J("ngIf",e.isEnabled(e.viewUI.Fullscreen)||e.isEnabled(e.viewUI.ToggleLabels)),i.xp6(1),i.Q6J("ngIf",e.isEnabled(e.viewUI.Help)),i.xp6(3),i.Q6J("ngIf",e.isEnabled(e.viewUI.Fullscreen)),i.xp6(1),i.Q6J("ngIf",e.isEnabled(e.viewUI.ToggleLabels)),i.xp6(3),i.Q6J("disabled",!(null!=(s=i.lcZ(22,20,e.selectedChapterReady$))&&s.model))}},dependencies:[f.O5,jt.VK,jt.OP,jt.p6,Gt.gM,Ya.d,In,ql,lt,f.Ov],styles:[".view-menu__icon[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;width:16px}"],changeDetection:0}),er([(0,l.Ph)(Le.getSelectedBookmarkViewMode),tr("design:type",b.y)],Si.prototype,"selectedBookmarkViewMode$",void 0),er([(0,l.Ph)(_.getSelectedChapterReadyState),tr("design:type",b.y)],Si.prototype,"selectedChapterReady$",void 0),er([(0,l.Ph)(U.hasQuiz),tr("design:type",b.y)],Si.prototype,"hasQuiz$",void 0),er([(0,l.Ph)(U.getQuizEnabled),tr("design:type",b.y)],Si.prototype,"quizEnabled$",void 0),er([(0,l.Ph)(U.getQuizModeLocked),tr("design:type",b.y)],Si.prototype,"quizLocked$",void 0),er([(0,l.Ph)(U.getQuizModeActive),tr("design:type",b.y)],Si.prototype,"quizActive$",void 0),er([(0,l.Ph)(M.getShowLabels),tr("design:type",b.y)],Si.prototype,"showLabels$",void 0);class na{constructor(n,e,o,s){this.changeRef=n,this.viewService=e,this.bookmarksService=o,this.imagesService=s,this.thumbnailURL="",this.interactionType=Mo}ngOnInit(){this.setThumbnailUrl()}handleClick(){this.viewService.toggleOnDemand(!1),this.viewService.toggleInteract(!1)}setThumbnailUrl(){this.contentType===Xe.Bookmark?this.bookmarksService.getBookmarkModel(this.contentId).subscribe(n=>{this.thumbnailURL=n.thumbnail_url,this.changeRef.markForCheck()}):(this.thumbnailURL=this.imagesService.getIndexThumbnail(this.contentId),this.changeRef.markForCheck())}getPoweredByUrl(){return(typeof localBaseDirectory>"u"?"":localBaseDirectory)+"assets/images/powered-by-biodigital-logo.svg"}}na.\u0275fac=function(n){return new(n||na)(i.Y36(i.sBO),i.Y36(ut),i.Y36(Xa),i.Y36(_g))},na.\u0275cmp=i.Xpm({type:na,selectors:[["app-view-ondemand"]],inputs:{contentId:"contentId",contentType:"contentType"},decls:10,vars:9,consts:[[1,"ondemand",3,"click"],[1,"ondemand__image",3,"lazyLoad"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","ondemand__blank-overlay",4,"ngSwitchCase"],[1,"ondemand__logo"],[3,"src"],[1,"ondemand__blank-overlay"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.NdJ("click",function(){return e.handleClick()}),i._UZ(1,"div",1),i.TgZ(2,"div",2),i.ALo(3,"async"),i.YNc(4,w3,1,0,"app-play-loader",3),i.YNc(5,S3,1,0,"app-button-loader",3),i.YNc(6,P3,1,0,"app-hand-loader",3),i.YNc(7,k3,1,0,"div",4),i.qZA(),i.TgZ(8,"div",5),i._UZ(9,"img",6),i.qZA()()),2&n&&(i.xp6(1),i.Q6J("lazyLoad",e.thumbnailURL),i.xp6(1),i.Q6J("ngSwitch",i.lcZ(3,7,e.interactType$)),i.xp6(2),i.Q6J("ngSwitchCase",e.interactionType.Play),i.xp6(1),i.Q6J("ngSwitchCase",e.interactionType.Button),i.xp6(1),i.Q6J("ngSwitchCase",e.interactionType.Hand),i.xp6(1),i.Q6J("ngSwitchCase",e.interactionType.None),i.xp6(2),i.Q6J("src",e.getPoweredByUrl(),i.LSH))},dependencies:[f.RF,f.n9,Zr.z1,C_,w_,S_,f.Ov],styles:[".ondemand__blank-overlay[_ngcontent-%COMP%]{background:rgba(0,0,0,.2);display:flex;position:fixed;justify-content:center;align-items:center;inset:0;transition:background-color .25s,opacity .25s;z-index:10000}.ondemand__blank-overlay[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:rgba(0,0,0,.2)}.ondemand__image[_ngcontent-%COMP%]{position:absolute;inset:0;background-size:cover;background-repeat:no-repeat;background-position:center center;filter:blur(6px);z-index:1000}.ondemand__logo[_ngcontent-%COMP%]{position:absolute;bottom:40px;justify-content:center;width:100%;z-index:20000;display:flex}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(O.getInteractType),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],na.prototype,"interactType$",void 0);class ia{constructor(n,e){this.store=n,this.changeDetectorRef=e,this.ngUnsubscribe=new X.x,this.visible=!1}beforePrint(n){this.visible=!0,this.changeDetectorRef.markForCheck()}afterPrint(n){this.visible=!1,this.changeDetectorRef.markForCheck()}ngOnInit(){this.initImageUrlListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initImageUrlListener(){(0,bt.a)(this.storyChapters$,this.store.select(Wt.getRegisteredThumbnails)).pipe((0,$.h)(([n,e])=>n.length>0&&e.size>0),(0,J.U)(([n,e])=>e.get(n[0].id).urls.large),(0,$n.x)(),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.imageUrl=n,this.changeDetectorRef.markForCheck()})}}ia.\u0275fac=function(n){return new(n||ia)(i.Y36(l.yh),i.Y36(i.sBO))},ia.\u0275cmp=i.Xpm({type:ia,selectors:[["app-view-print"]],hostBindings:function(n,e){1&n&&i.NdJ("beforeprint",function(){return e.beforePrint()},!1,i.Jf7)("afterprint",function(){return e.afterPrint()},!1,i.Jf7)},decls:3,vars:1,consts:[[1,"view-print"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",1,"view-print__scrim"],[1,"view-print__image",3,"src"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i._UZ(1,"img",1)(2,"img",2),i.qZA()),2&n&&(i.xp6(2),i.Q6J("src",e.imageUrl,i.LSH))},styles:[".view-print[_ngcontent-%COMP%]{background-color:#fff;display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10000;justify-content:space-around;margin:auto;margin-top:0!important}@media print{.view-print[_ngcontent-%COMP%]{display:flex}}.view-print__scrim[_ngcontent-%COMP%]{display:block;width:100%;height:100%;position:absolute;z-index:-1;inset:0}.view-print__image[_ngcontent-%COMP%]{display:block;flex:1 1 auto;object-fit:contain;margin:0 auto;z-index:1}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(_.getStoryChapters),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ia.prototype,"storyChapters$",void 0);const M3=["circle"],I3=["progressCircle"],z3=["progressContainer"];function A3(t,n){if(1&t&&(i.O4$(),i.kcU(),i.TgZ(0,"div",9),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij("",e.percent,"%")}}const L3=function(t){return{"view-progress--active":t}},F3=function(t){return{"view-progress__ring--pulse":t}};let U3=(()=>{class t{constructor(e,o){this.renderer=e,this.changeDetectorRef=o,this.ngUnsubscribe=new X.x,this.label="Loading...",this._show=!1,this._percent=new Hi.X(0)}get show(){return this._show}set show(e){setTimeout(()=>{this._show=e,this.changeDetectorRef.markForCheck()})}get percent(){return Math.floor(this._percent.value)}set percent(e){null!=e&&this._percent.next(e)}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions(),this.initPercentObserver()}initPercentObserver(){this._percent.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.label=this.getLoadingLabel(this.percent),this.renderProgress(0===this.percent?100:this.percent),this.changeDetectorRef.markForCheck()})}initSizeObserver(){(0,Dt.R)(window,"resize").pipe((0,cn.b)(10),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(e=100){const o=this.getCircumference();return o-e/100*o}renderProgress(e){e>=100&&(e=100);const o=this.getCircumference(),s=this.getOffset(e);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}getLoadingLabel(e){return 100===e?"Launching...":"Loading..."}updateDimensions(){const e=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*e),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*e),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(e-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${e}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${e}`);const o=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${o}`)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.Qsj),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-progress"]],viewQuery:function(e,o){if(1&e&&(i.Gf(M3,7),i.Gf(I3,7),i.Gf(z3,7)),2&e){let s;i.iGM(s=i.CRH())&&(o.circleRef=s.first),i.iGM(s=i.CRH())&&(o.progressCircleRef=s.first),i.iGM(s=i.CRH())&&(o.progressContainerRef=s.first)}},inputs:{show:"show",percent:"percent"},decls:10,vars:10,consts:[["data-test","viewProgress","role","alert",1,"view-progress",3,"ngClass"],["aria-hidden","true",1,"view-progress__circle"],["circle",""],[1,"view-progress__ring",3,"ngClass"],["progressContainer",""],[1,"view-progress__ring-inner"],["progressCircle",""],["class","view-progress__count",4,"ngIf"],[1,"view-progress__label"],[1,"view-progress__count"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div",1,2),i.O4$(),i.TgZ(3,"svg",3,4),i._UZ(5,"circle",5,6),i.qZA(),i.YNc(7,A3,2,1,"div",7),i.kcU(),i.TgZ(8,"div",8),i._uU(9),i.qZA()()()),2&e&&(i.Q6J("ngClass",i.VKq(6,L3,o.show)),i.uIk("aria-busy",o.show),i.xp6(1),i.Q6J("@isOpen",o.show?"open":"closed"),i.xp6(2),i.Q6J("ngClass",i.VKq(8,F3,0===o.percent||100===o.percent)),i.xp6(4),i.Q6J("ngIf",o.percent>0&&o.percent<100),i.xp6(2),i.hij(" ",o.label," "))},dependencies:[f.mk,f.O5],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.view-progress[_ngcontent-%COMP%]{--circleSize: 35vw;pointer-events:none;position:absolute;display:flex;justify-content:center;align-items:center;inset:0;z-index:1000;transition:background-color .15s}@keyframes progressPulse{0%{stroke-width:4}50%{stroke-width:1}to{stroke-width:4}}.view-progress--active[_ngcontent-%COMP%]{background-color:#0003}.view-progress__circle[_ngcontent-%COMP%]{transform:scale(0);width:var(--circleSize);height:var(--circleSize);border-radius:50%;background-color:#101823cc;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.view-progress__count[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em;color:#fff;font-weight:700}.view-progress__label[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em;color:#fffc}.view-progress__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;opacity:1;stroke-dashoffset:0;stroke-width:4;stroke:#fffc;fill:transparent;transform:rotate(-90deg)}.view-progress__ring--pulse[_ngcontent-%COMP%]{animation:progressPulse ease-in-out infinite 2s}@media (min-width: 600px){.view-progress__circle[_ngcontent-%COMP%]{width:160px;height:160px}}"],data:{animation:[(0,j.X$)("isOpen",[(0,j.SB)("open",(0,j.oB)({transform:"scale(1)"})),(0,j.SB)("closed",(0,j.oB)({transform:"scale(0)"})),(0,j.eR)("closed => open",[(0,j.jt)("300ms ease-out")]),(0,j.eR)("open => closed",[(0,j.jt)("150ms ease-in")])])]},changeDetection:0}),t})();var R3=A(5638),lp=A(6722),N3=A(9705),pp=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},dp=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const E3=["slider"],D3=["track"],j3=["bar"],Q3=["handle"],Z3=function(t){return{"view-layers-slider__handle-touch":t}};class Bo{constructor(n,e,o){this.renderer=n,this.visibilityLayersService=e,this.changeDetectorRef=o,this.ngUnsubscribe=new X.x,this.currentLayers=[],this.fullOffset=0,this.dragMove=new X.x,this.dragPosition={x:0,y:0},this.currentLayerName="",this.currentOffset=0}ngOnInit(){this.initLayersObserver(),this.initIndexPositionObserver(),this.initDragMoveObserver()}ngAfterViewInit(){setTimeout(()=>{this.handle.nativeElement.focus()},200),this.fullOffset=this.track.nativeElement.offsetWidth}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLayersObserver(){this.selectedChapterCurrentLayers$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.currentLayers=n})}initIndexPositionObserver(){(0,bt.a)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,$.h)(([n,e,o])=>!(0,m.isNil)(n)&&!(0,m.isNil)(e)&&!(0,m.isNil)(o)),(0,cn.b)(0),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o])=>{this.currentLayerName=o[n].name;const s=this.visibilityLayersService.indexPositionToFraction(n,e);this.currentOffset=Math.round(100*s),this.setSliderBar(s),this.setSliderHandle(s)})}initDragMoveObserver(){this.dragMove.pipe((0,$r.e)(20),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>this.handleAuditedDrag())}handleDragEnded(){const n=this.calculateHandleFraction(),e=this.visibilityLayersService.fractionToIndex(n),o=this.visibilityLayersService.fractionToPosition(n,e);this.visibilityLayersService.recordLayerIndexPosition(e,o)}handleDragMoved(n){this.dragMove.next(n)}handleAuditedDrag(){const n=this.calculateHandleFraction(),e=this.visibilityLayersService.fractionToIndex(n),o=this.visibilityLayersService.fractionToPosition(n,e);this.currentLayerName=this.currentLayers[e].name,this.visibilityLayersService.synchronizeScene(e,o,!1),this.setSliderBar(n)}handleTrackClick(n){const e=n.offsetX/this.fullOffset,o=this.visibilityLayersService.fractionToIndex(e),s=this.visibilityLayersService.fractionToPosition(e,o);this.visibilityLayersService.recordLayerIndexPosition(o,s)}handleKeyDown(n){switch(n.key){case"Home":this.handleIncriment(-1),n.stopPropagation();break;case"End":this.handleIncriment(1),n.stopPropagation();break;case"PageDown":this.handleIncriment(-.1),n.stopPropagation();break;case"PageUp":this.handleIncriment(.1),n.stopPropagation();break;case"ArrowLeft":case"ArrowDown":this.handleIncriment(-.01),n.stopPropagation();break;case"ArrowRight":case"ArrowUp":this.handleIncriment(.01),n.stopPropagation()}}handleIncriment(n){const e=(0,m.clamp)(this.calculateHandleFraction()+n,0,1),o=this.visibilityLayersService.fractionToIndex(e),s=this.visibilityLayersService.fractionToPosition(e,o);this.visibilityLayersService.recordLayerIndexPosition(o,s)}calculateHandleFraction(){const n=this.slider.nativeElement.getBoundingClientRect();return(this.handle.nativeElement.getBoundingClientRect().left-n.left)/this.fullOffset}setSliderBar(n){this.renderer.setStyle(this.bar.nativeElement,"width",100*n+"%")}setSliderHandle(n){this.dragPosition={x:n*this.fullOffset,y:this.dragPosition.y},this.changeDetectorRef.markForCheck()}}Bo.\u0275fac=function(n){return new(n||Bo)(i.Y36(i.Qsj),i.Y36(ai),i.Y36(i.sBO))},Bo.\u0275cmp=i.Xpm({type:Bo,selectors:[["app-view-layers-slider"]],viewQuery:function(n,e){if(1&n&&(i.Gf(E3,7),i.Gf(D3,7),i.Gf(j3,7),i.Gf(Q3,7)),2&n){let o;i.iGM(o=i.CRH())&&(e.slider=o.first),i.iGM(o=i.CRH())&&(e.track=o.first),i.iGM(o=i.CRH())&&(e.bar=o.first),i.iGM(o=i.CRH())&&(e.handle=o.first)}},decls:9,vars:8,consts:[[1,"view-layers-slider"],["slider",""],[1,"view-layers-slider__track",3,"click"],["track",""],[1,"view-layers-slider__bar"],["bar",""],["cdkDrag","","cdkDragLockAxis","x","cdkDragBoundary",".view-layers-slider","role","slider","tabindex","0","aria-valuemin","0","aria-valuemax","100",1,"view-layers-slider__handle",3,"cdkDragFreeDragPosition","ngClass","matTooltip","cdkDragEnded","cdkDragMoved","keydown"],["handle",""]],template:function(n,e){1&n&&(i.TgZ(0,"div",0,1)(2,"div",2,3),i.NdJ("click",function(s){return e.handleTrackClick(s)}),i._UZ(4,"div",4,5),i.qZA(),i.TgZ(6,"div",6,7),i.NdJ("cdkDragEnded",function(){return e.handleDragEnded()})("cdkDragMoved",function(s){return e.handleDragMoved(s)})("keydown",function(s){return e.handleKeyDown(s)}),i.ALo(8,"async"),i.qZA()()),2&n&&(i.xp6(6),i.Q6J("cdkDragFreeDragPosition",e.dragPosition)("ngClass",i.VKq(6,Z3,i.lcZ(8,4,e.canTouch$)))("matTooltip",e.currentLayerName),i.uIk("aria-valuenow",e.currentOffset))},dependencies:[f.mk,is.Zt,Gt.gM,f.Ov],styles:['.view-layers-slider[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;height:28px;width:100%}.view-layers-slider__track[_ngcontent-%COMP%]{position:absolute;background:rgba(150,168,192,.6);z-index:1;height:5px;border-radius:5px;left:14px;right:14px}.view-layers-slider__bar[_ngcontent-%COMP%]{position:absolute;background:#374a68;height:5px;border-radius:5px;z-index:2;width:0;left:0;pointer-events:none}.view-layers-slider__handle[_ngcontent-%COMP%]{width:28px;height:28px;margin-left:-14px;left:14px;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-layers-slider__handle--hide[_ngcontent-%COMP%]{display:none}.view-layers-slider__handle[_ngcontent-%COMP%]:after{content:"";width:12px;height:12px;border-radius:6px;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-layers-slider__handle[_ngcontent-%COMP%]:hover:after{background:#2d72dc}'],changeDetection:0}),pp([(0,l.Ph)(_.getSelectedChapterCurrentLayers),dp("design:type",b.y)],Bo.prototype,"selectedChapterCurrentLayers$",void 0),pp([(0,l.Ph)(_.getSelectedChapterCurrentLayersIndex),dp("design:type",b.y)],Bo.prototype,"selectedChapterCurrentLayersIndex$",void 0),pp([(0,l.Ph)(_.getSelectedChapterCurrentLayersPosition),dp("design:type",b.y)],Bo.prototype,"selectedChapterCurrentLayersPosition$",void 0),pp([(0,l.Ph)(O.getCanTouch),dp("design:type",b.y)],Bo.prototype,"canTouch$",void 0);const B3=function(t,n,e){return{"view-layers-bar__slider--large":t,"view-layers-bar__slider--small":n,"view-layers-bar__slider--disabled":e}};let V3=(()=>{class t{constructor(e,o,s){this.store=e,this.engineService=o,this.changeDetectorRef=s,this.ngUnsubscribe=new X.x,this.assetsLoading=!1}ngOnInit(){this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.assetsLoading=e<1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isLarge(){return this.store.selectSnapshot(Pt.getBreakpoint)>=_t.Medium}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(et),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-layers-bar"]],decls:2,vars:5,consts:[[1,"view-layers-bar"],[1,"view-layers-bar__slider",3,"ngClass"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"app-view-layers-slider",1),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngClass",i.kEZ(1,B3,o.isLarge(),!o.isLarge(),o.assetsLoading)))},dependencies:[f.mk,Bo],styles:[".view-layers-bar[_ngcontent-%COMP%]{display:flex}.view-layers-bar__slider[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-left:4px}.view-layers-bar__slider--large[_ngcontent-%COMP%]{width:300px}.view-layers-bar__slider--small[_ngcontent-%COMP%]{width:180px}.view-layers-bar__slider--disabled[_ngcontent-%COMP%]{opacity:.25;pointer-events:none}"],changeDetection:0}),t})();var Pg=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},kg=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const q3=["scrubber"],$3=["track"],G3=["bar"],J3=["handle"],H3=function(t){return{"view-scrubber--draggable":t}},Y3=function(t,n){return{"view-scrubber__handle--hide":t,"view-scrubber__handle-touch":n}};class Vo{constructor(n,e,o,s,r,a){this.engineService=n,this.animationService=e,this.renderer=o,this.viewService=s,this.changeDetectorRef=r,this.store=a,this.showHandle=!0,this.ngUnsubscribe=new X.x,this.trackWidth=0,this.dragPosition={x:16,y:0},this.playing=!0,this.scrubbing=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngAfterViewInit(){this.initDragListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,$.h)(n=>!(0,m.isNil)(n)&&n.animation),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(this.animationService.getTime())})}initTimelineListener(){this.engineService.getEvent(pe.TimelinePlaying).pipe((0,$r.e)(20),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.tick(n.time)}),this.engineService.getEvent(pe.TimelineScrubbed).pipe((0,$r.e)(20),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.getPercent(n.time);this.setScrubberBar(e)})}initDragListener(){this.dragInstance.moved.pipe((0,$r.e)(20),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=this.calculateHandlePercent();this.scrubToPercent(e)})}handleDragStart(){this.scrubbing=!0,this.playing=this.store.selectSnapshot(M.getAnimationPlaying),this.playing&&this.animationService.pause(),this.store.dispatch(new _o(!1))}handleDragEnd(){this.scrubbing=!1,this.store.dispatch(new _o(this.playing)),this.playing&&this.animationService.unpause()}handleTrackClick(n){if(!this.showHandle)return;const e=n.offsetX/this.track.nativeElement.getBoundingClientRect().width*100;this.playing=this.store.selectSnapshot(M.getAnimationPlaying),this.scrubToPercent(e),this.setScrubberBar(e),this.setScrubberHandle(e),this.store.dispatch(new _o(this.playing))}tick(n){if(!this.timerange||this.scrubbing)return;const e=this.getPercent(n);this.setScrubberBar(e),this.setScrubberHandle(e)}getPercent(n){return n/this.timerange.lastTime*100}calculateHandlePercent(){const{left:n,right:e}=this.scrubber.nativeElement.getBoundingClientRect(),s=e-n-this.handle.nativeElement.offsetWidth,a=(this.handle.nativeElement.getBoundingClientRect().left-n)/s*100;return Math.min(Math.max(a,0),100)}scrubToPercent(n){this.animationService.scrub(n/100*this.timerange.lastTime)}handlePlayClick(){this.viewService.toggleAnimation()}setScrubberBar(n){this.renderer.setStyle(this.bar.nativeElement,"width",`${n}%`)}setScrubberHandle(n){0===this.trackWidth&&(this.trackWidth=this.track.nativeElement.offsetWidth-32),this.showHandle&&(this.dragPosition={...this.dragPosition,x:16+this.trackWidth*(n/100)},this.changeDetectorRef.markForCheck())}}Vo.\u0275fac=function(n){return new(n||Vo)(i.Y36(et),i.Y36(Un),i.Y36(i.Qsj),i.Y36(ut),i.Y36(i.sBO),i.Y36(l.yh))},Vo.\u0275cmp=i.Xpm({type:Vo,selectors:[["app-view-scrubber"]],viewQuery:function(n,e){if(1&n&&(i.Gf(q3,7),i.Gf($3,7),i.Gf(G3,7),i.Gf(J3,7),i.Gf(is.Zt,5)),2&n){let o;i.iGM(o=i.CRH())&&(e.scrubber=o.first),i.iGM(o=i.CRH())&&(e.track=o.first),i.iGM(o=i.CRH())&&(e.bar=o.first),i.iGM(o=i.CRH())&&(e.handle=o.first),i.iGM(o=i.CRH())&&(e.dragInstance=o.first)}},inputs:{showHandle:"showHandle"},decls:9,vars:10,consts:[[1,"view-scrubber",3,"ngClass"],["scrubber",""],[1,"view-scrubber__track",3,"click"],["track",""],[1,"view-scrubber__bar"],["bar",""],["cdkDrag","","cdkDragLockAxis","x","cdkDragBoundary",".view-scrubber",1,"view-scrubber__handle",3,"cdkDragFreeDragPosition","ngClass","cdkDragStarted","cdkDragEnded"],["handle",""]],template:function(n,e){1&n&&(i.TgZ(0,"div",0,1)(2,"div",2,3),i.NdJ("click",function(s){return e.handleTrackClick(s)}),i._UZ(4,"div",4,5),i.qZA(),i.TgZ(6,"div",6,7),i.NdJ("cdkDragStarted",function(){return e.handleDragStart()})("cdkDragEnded",function(){return e.handleDragEnd()}),i.ALo(8,"async"),i.qZA()()),2&n&&(i.Q6J("ngClass",i.VKq(5,H3,e.showHandle)),i.xp6(6),i.Q6J("cdkDragFreeDragPosition",e.dragPosition)("ngClass",i.WLB(7,Y3,!e.showHandle,i.lcZ(8,3,e.canTouch$))))},dependencies:[f.mk,is.Zt,f.Ov],styles:['.view-scrubber{position:relative;display:flex;justify-content:center;align-items:center;height:40px;width:100%}.view-scrubber:hover .view-scrubber__handle:after{opacity:1}.view-scrubber--draggable .view-scrubber__track{left:16px;right:16px}.view-scrubber__track{border-radius:2px;position:absolute;background:rgba(150,168,192,.6);z-index:1;height:4px;left:0;right:0}.view-scrubber__bar{border-radius:2px;position:absolute;background:#374a68;height:4px;z-index:2;width:0;left:0}.view-scrubber__handle{width:40px;height:40px;margin-left:-16px;left:0;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-scrubber__handle--hide{display:none}.view-scrubber__handle:after{opacity:1;transition:opacity .25s;content:"";width:8px;height:8px;border-radius:4px;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-scrubber__handle:hover:after{background:#2d72dc}.view-scrubber__handle:hover{cursor:pointer}.view-scrubber__handle-touch:after{opacity:1}\n'],encapsulation:2,changeDetection:0}),Pg([(0,l.Ph)(M.getAnimationPlaying),kg("design:type",b.y)],Vo.prototype,"animationPlaying$",void 0),Pg([(0,l.Ph)(_.getSelectedChapterReadyState),kg("design:type",b.y)],Vo.prototype,"chapterReadyState$",void 0),Pg([(0,l.Ph)(O.getCanTouch),kg("design:type",b.y)],Vo.prototype,"canTouch$",void 0);var Tg=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Mg=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function W3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",9),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePlayClick())}),i.ALo(1,"async"),i.ALo(2,"async"),i.qZA()}if(2&t){const e=i.oxw(2);i.Q6J("matTooltip",i.lcZ(1,2,e.animationPlaying$)?"Pause":"Play")("icon",i.lcZ(2,4,e.animationPlaying$)?"pause":"play")}}function K3(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePlayChapterFromStartClick())}),i.qZA()}}function X3(t,n){1&t&&i._UZ(0,"app-view-scrubber",11)}function ez(t,n){if(1&t&&(i.TgZ(0,"div",3),i.YNc(1,W3,3,6,"button",4),i.YNc(2,K3,1,0,"button",5),i.YNc(3,X3,1,0,"app-view-scrubber",6),i.TgZ(4,"button",7)(5,"span",8),i._uU(6),i.ALo(7,"async"),i.qZA()()()),2&t){const e=i.oxw(),o=i.MAs(2);i.xp6(1),i.Q6J("ngIf",e.showPlayPause),i.xp6(1),i.Q6J("ngIf",e.showPlayPause),i.xp6(1),i.Q6J("ngIf",e.showScrubber),i.xp6(1),i.Q6J("matMenuTriggerFor",o),i.xp6(2),i.hij("",i.lcZ(7,5,e.playbackSpeed$),"x")}}class qo{constructor(n,e,o,s,r){this.animationService=n,this.viewService=e,this.layoutService=o,this.store=s,this.changeDetectorRef=r,this.viewLayout=x,this.size="small",this.showPlayPause=!0,this.showScrubber=!0,this.showBar=!0,this.ngUnsubscribe=new X.x}get template(){return this._template}set template(n){this._template=n,this.updateLayoutProperties(this.template)}ngOnInit(){this.initChapterListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,$.h)(n=>!(0,m.isNil)(n)&&n.animation),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}updateLayoutProperties(n){this.showBar=n!==qn.None,this.showScrubber=n===qn.Full,this.showPlayPause=n!==qn.None}handlePlayClick(){this.viewService.toggleAnimation()}handlePlayChapterFromStartClick(){this.viewService.playChapterFromStart()}setPlaybackSpeed(n){this.store.dispatch(new Jp(n))}}qo.\u0275fac=function(n){return new(n||qo)(i.Y36(Un),i.Y36(ut),i.Y36(ri),i.Y36(l.yh),i.Y36(i.sBO))},qo.\u0275cmp=i.Xpm({type:qo,selectors:[["app-view-media-bar"]],inputs:{template:"template",size:"size"},decls:11,vars:1,consts:[["class","view-media-bar",4,"ngIf"],["playbackMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"view-media-bar"],["app-pin-button","","buttonType","ghost","data-test","Play/Pause__small","matTooltipPosition","above",3,"matTooltip","icon","click",4,"ngIf"],["app-pin-button","","buttonType","ghost","matTooltipPosition","above","matTooltip","Play Chapter from Start","icon","step-backward",3,"click",4,"ngIf"],["class","view-media-bar__scrubber","data-test","Scrub__small",4,"ngIf"],["app-pin-button","","buttonType","ghost","matTooltipPosition","above","matTooltip","Playback Speed",3,"matMenuTriggerFor"],[1,"text-semibold"],["app-pin-button","","buttonType","ghost","data-test","Play/Pause__small","matTooltipPosition","above",3,"matTooltip","icon","click"],["app-pin-button","","buttonType","ghost","matTooltipPosition","above","matTooltip","Play Chapter from Start","icon","step-backward",3,"click"],["data-test","Scrub__small",1,"view-media-bar__scrubber"]],template:function(n,e){1&n&&(i.YNc(0,ez,8,7,"div",0),i.TgZ(1,"mat-menu",null,1)(3,"button",2),i.NdJ("click",function(){return e.setPlaybackSpeed(1)}),i._uU(4,"Normal"),i.qZA(),i.TgZ(5,"button",2),i.NdJ("click",function(){return e.setPlaybackSpeed(.5)}),i._uU(6,"0.5"),i.qZA(),i.TgZ(7,"button",2),i.NdJ("click",function(){return e.setPlaybackSpeed(.25)}),i._uU(8,"0.25"),i.qZA(),i.TgZ(9,"button",2),i.NdJ("click",function(){return e.setPlaybackSpeed(.1)}),i._uU(10,"0.1"),i.qZA()()),2&n&&i.Q6J("ngIf",e.showBar)},dependencies:[f.O5,jt.VK,jt.OP,jt.p6,Gt.gM,In,Vo,f.Ov],styles:[".view-media-bar{display:flex}.view-media-bar__scrubber{width:120px;display:flex;justify-content:center;align-items:center}\n"],encapsulation:2,changeDetection:0}),Tg([(0,l.Ph)(M.getAnimationPlaying),Mg("design:type",b.y)],qo.prototype,"animationPlaying$",void 0),Tg([(0,l.Ph)(_.getSelectedChapterReadyState),Mg("design:type",b.y)],qo.prototype,"chapterReadyState$",void 0),Tg([(0,l.Ph)(M.getPlaybackSpeed),Mg("design:type",b.y)],qo.prototype,"playbackSpeed$",void 0);var oa=A(8184);class Ig{constructor(n,e,o){this.overlay=n,this.content=e,this.data=o,this.afterClosed=new X.x,this.afterClosed$=this.afterClosed.asObservable(),n.backdropClick().subscribe(()=>this._close("backdropClick",o)),this.entered$=(0,Li.T)((0,Dt.R)(n.overlayElement,"mouseenter"),(0,Dt.R)(n.overlayElement,"mouseleave")).pipe((0,J.U)(s=>"mouseenter"===s.type),(0,w.R)(this.afterClosed$))}close(n){this._close("close",n)}_close(n,e){this.overlay.dispose(),this.afterClosed.next({type:n,data:e}),this.afterClosed.complete()}}var sa=A(4080);function tz(t,n){if(1&t&&i._UZ(0,"div",4),2&t){const e=i.oxw();i.Q6J("innerHTML",e.content,i.oJD)}}function nz(t,n){1&t&&i.GkF(0)}function iz(t,n){if(1&t&&(i.ynx(0),i.YNc(1,nz,1,0,"ng-container",5),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngTemplateOutlet",e.content)("ngTemplateOutletContext",e.context)}}function oz(t,n){1&t&&i.GkF(0)}function sz(t,n){if(1&t&&(i.ynx(0),i.YNc(1,oz,1,0,"ng-container",6),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngComponentOutlet",e.content)}}let rz=(()=>{class t{constructor(e){this.popupRef=e,this.renderMethod="component"}ngOnInit(){this.content=this.popupRef.content,"string"==typeof this.content?this.renderMethod="text":this.content instanceof i.Rgc&&(this.renderMethod="template",this.context={close:this.popupRef.close.bind(this.popupRef)})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(Ig))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-popup"]],decls:5,vars:4,consts:[[1,"popup"],[3,"ngSwitch"],[3,"innerHTML",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"innerHTML"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.ynx(1,1),i.YNc(2,tz,1,1,"div",2),i.YNc(3,iz,2,2,"ng-container",3),i.YNc(4,sz,2,1,"ng-container",3),i.BQk(),i.qZA()),2&e&&(i.xp6(1),i.Q6J("ngSwitch",o.renderMethod),i.xp6(1),i.Q6J("ngSwitchCase","text"),i.xp6(1),i.Q6J("ngSwitchCase","template"),i.xp6(1),i.Q6J("ngSwitchCase","component"))},dependencies:[f.$G,f.tP,f.RF,f.n9],styles:["[_nghost-%COMP%]{width:100%;height:100%}.popup[_ngcontent-%COMP%]{background:white;border-radius:4px;padding:8px;overflow-y:auto;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}"],changeDetection:0}),t})();var $i=(()=>(function(t){t.Above="above",t.Below="below",t.Left="left",t.Right="right"}($i||($i={})),$i))();const az={[$i.Above]:{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-12},[$i.Below]:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:12},[$i.Left]:{originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-12},[$i.Right]:{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:12}};let ex=(()=>{class t{constructor(e,o){this.overlay=e,this.injector=o}open(e){const{origin:o,content:s,data:r,width:a,height:c,hasBackdrop:p}=e,d=this.overlay.create(this.getOverlayConfig({origin:o,width:a,height:c,hasBackdrop:p})),u=new Ig(d,s,r),g=this.createInjector(u,this.injector);return d.attach(new sa.C5(rz,null,g)),u}createInjector(e,o){const s=new WeakMap([[Ig,e]]);return new sa.nK(o,s)}getPositionStrategy(e,o){return this.overlay.position().flexibleConnectedTo(e).withPositions(this.getPositions(o))}getOverlayConfig({origin:e,width:o,height:s,hasBackdrop:r}){return new oa.X_({width:o,height:s,hasBackdrop:r??!0,backdropClass:"popup-scrim",positionStrategy:this.getOverlayPosition(e),scrollStrategy:this.overlay.scrollStrategies.reposition()})}getOverlayPosition(e,o){return o=o||[$i.Above,$i.Below,$i.Left,$i.Right],this.overlay.position().flexibleConnectedTo(e).withPositions(this.getPositions(o)).withPush(!0)}getPositions(e){return e.map(o=>az[o])}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(oa.aV),i.LFG(i.zs3))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var li=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},pi=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const cz=["chapterCount"],lz=["mediaToggle"],pz=["nextChapter"],dz=["tooltip"];function uz(t,n){if(1&t&&(i.TgZ(0,"div",11),i._UZ(1,"div",12),i.TgZ(2,"div",13)(3,"div",14),i._uU(4),i.qZA(),i.TgZ(5,"div",15),i._uU(6),i.qZA()()()),2&t){const e=i.oxw(3);i.xp6(1),i.Q6J("defaultImage",e.defaultImage)("lazyLoad",e.getChapterThumb(e.tooltipChapter.id)),i.xp6(3),i.Oqu(e.tooltipChapter.position),i.xp6(2),i.Oqu(e.tooltipChapter.title)}}function gz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",4)(1,"button",5),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePreviousClick())})("mouseenter",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleChapterNavEnter(s,"previous"))})("mouseleave",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleChapterNavLeave())})("focus",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleChapterNavEnter(s,"previous"))})("blur",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleChapterNavLeave())}),i.ALo(2,"async"),i.ALo(3,"async"),i.qZA(),i.TgZ(4,"button",6,7),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleNextClick())})("mouseenter",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleChapterNavEnter(s,"next"))})("mouseleave",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleChapterNavLeave())})("focus",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handleChapterNavEnter(s,"next"))})("blur",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleChapterNavLeave())}),i.ALo(6,"async"),i.ALo(7,"async"),i.ALo(8,"async"),i.ALo(9,"async"),i.qZA(),i.TgZ(10,"div",8,9),i.YNc(12,uz,7,4,"div",10),i.qZA()()}if(2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("disabled",0===i.lcZ(2,9,e.chapterIndex$)),i.uIk("aria-disabled",0===i.lcZ(3,11,e.chapterIndex$)),i.xp6(3),i.ekj("view-tools__item--sonar",e.chapterCallToAction),i.Q6J("disabled",i.lcZ(8,17,e.chapterIndex$)===i.lcZ(9,19,e.chapterCount$)-1),i.uIk("aria-disabled",i.lcZ(6,13,e.chapterIndex$)===i.lcZ(7,15,e.chapterCount$)-1),i.xp6(6),i.ekj("view-tools__tooltip-container--out",e.tooltipChapter),i.xp6(2),i.Q6J("ngIf",e.tooltipChapter)}}function hz(t,n){if(1&t&&(i.TgZ(0,"div",16)(1,"app-view-chapters",17)(2,"div",18),i._uU(3),i.ALo(4,"async"),i.ALo(5,"async"),i._UZ(6,"app-icon",19),i.qZA(),i.TgZ(7,"span",20),i._uU(8),i.ALo(9,"async"),i.ALo(10,"async"),i.qZA()()()),2&t){const e=i.oxw(2);i.xp6(3),i.AsE(" ",i.lcZ(4,4,e.chapterIndex$)+1," of ",i.lcZ(5,6,e.chapterCount$)," "),i.xp6(5),i.AsE(" Toggle Chapter List, Chapter ",i.lcZ(9,8,e.chapterIndex$)+1," of ",i.lcZ(10,10,e.chapterCount$)," ")}}function mz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",23),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(3);return i.KtG(s.handlePlayClick())}),i.ALo(1,"async"),i.ALo(2,"async"),i.ALo(3,"async"),i.qZA()}if(2&t){const e=i.oxw(3);i.Q6J("icon",i.lcZ(1,3,e.animationPlaying$)?"pause":"play")("matTooltip",i.lcZ(3,7,e.animationPlaying$)?"Pause Animation":"Play Animation"),i.uIk("aria-label",i.lcZ(2,5,e.animationPlaying$)?"Pause Animation":"Play Animation")}}function fz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",24),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(3);return i.KtG(s.toggleToolbar("media"))}),i._UZ(1,"app-view-scrubber",25),i.qZA()}2&t&&(i.xp6(1),i.Q6J("showHandle",!1))}function bz(t,n){if(1&t&&(i.TgZ(0,"div",16),i.YNc(1,mz,4,9,"button",21),i.YNc(2,fz,2,1,"button",22),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("ngIf",e.isVisible(e.viewUI.Media)),i.xp6(1),i.Q6J("ngIf",e.isVisible(e.viewUI.ScrubberButton))}}function yz(t,n){if(1&t&&(i.ynx(0),i.YNc(1,gz,13,21,"div",2),i.YNc(2,hz,11,12,"div",3),i.YNc(3,bz,3,2,"div",3),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.paginationVisible),i.xp6(1),i.Q6J("ngIf",e.paginationVisible&&!e.collapsePagination),i.xp6(1),i.Q6J("ngIf",e.mediaVisible)}}function _z(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"div",16)(2,"div",26)(3,"button",27),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectTool(s.toolEnum.Select))}),i.ALo(4,"async"),i.ALo(5,"async"),i.qZA(),i.TgZ(6,"button",28),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectTool(s.toolEnum.Hide))}),i.ALo(7,"async"),i.ALo(8,"async"),i.qZA(),i.TgZ(9,"button",29),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectTool(s.toolEnum.Fade))}),i.ALo(10,"async"),i.ALo(11,"async"),i.qZA()()(),i.BQk()}if(2&t){const e=i.oxw();i.xp6(3),i.Q6J("selected",i.lcZ(4,6,e.activeTool$)===e.toolEnum.Select),i.uIk("aria-pressed",i.lcZ(5,8,e.activeTool$)===e.toolEnum.Select),i.xp6(3),i.Q6J("selected",i.lcZ(7,10,e.activeTool$)===e.toolEnum.Hide),i.uIk("aria-pressed",i.lcZ(8,12,e.activeTool$)===e.toolEnum.Hide),i.xp6(3),i.Q6J("selected",i.lcZ(10,14,e.activeTool$)===e.toolEnum.Fade),i.uIk("aria-pressed",i.lcZ(11,16,e.activeTool$)===e.toolEnum.Fade)}}class vn{constructor(n,e,o,s,r,a,c){this.viewService=n,this.viewUIService=e,this.store=o,this.actions=s,this.changeDetectorRef=r,this.popupService=a,this.platform=c,this.viewToolsMode=_n,this.viewUI=x,this.breakpointEnum=_t,this.canFullscreen=!0,this.isFullscreen=!1,this.toolEnum=Ve,this.mediaControlsEnum=qn,this.paginationVisible=!1,this.mediaVisible=!1,this.tooltipChapter=null,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png",this.chapterCallToAction=!1,this.ngUnsubscribe=new X.x,this.platformSupportsMouseEvents=!this.platform.IOS&&!this.platform.ANDROID,this.animate=!0,this._mode=_n.Main,this.collapsePagination=!1,this.collapseScrubber=!1,this.modeChange=new i.vpe}get mode(){return this._mode}set mode(n){this._mode=n}ngOnInit(){this.canFullscreen=Rn.canFullscreen(),this.initLayoutListener(),this.initBreakpointListener(),this.initFullscreenListener(),this.mode===_n.Main&&!this.store.selectSnapshot(O.getChapterCallToActionSeen)&&this.initChapterCallToAction()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.chapterCallToActionTimeout&&clearTimeout(this.chapterCallToActionTimeout)}initLayoutListener(){this.store.select(O.getUI).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.mediaTemplate=n.media.template,this.paginationVisible=this.viewUIService.isVisible(x.Pagination),this.mediaVisible=this.viewUIService.isVisible(x.Media),this.changeDetectorRef.markForCheck()})}initBreakpointListener(){this.store.select(Pt.getBreakpoint).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.breakpoint=n,this.changeDetectorRef.markForCheck()})}initFullscreenListener(){this.fullscreen$=Rn.onFullscreenChange(),this.fullscreen$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.isFullscreen=Rn.isFullscreen(),this.changeDetectorRef.markForCheck()})}initChapterCallToAction(){this.chapterCallToActionTimeout=setTimeout(()=>{this.setCallToAction(!0),this.actions.pipe((0,l.xt)(gi),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.setCallToAction(!1)}),this.chapterCallToActionTimeout=setTimeout(()=>{this.chapterCallToAction&&this.setCallToAction(!1)},7500)},2500)}handleSelectTool(n){const e=this.store.selectSnapshot(M.getActiveTool);this.viewService.selectTool(n===e?Ve.Select:n)}handlePlayClick(){this.viewService.toggleAnimation()}handleMenuClick(){this.store.dispatch(new T.ToggleMenu(!0))}handlePreviousClick(){this.setCallToAction(!1),this.viewService.previousChapter("Toolbar")}handleNextClick(){this.setCallToAction(!1),this.viewService.nextChapter("Toolbar")}handleMediaClick(){this.toggleMediaPopup()}handleChapterNavEnter(n,e){this.platformSupportsMouseEvents&&!this.chapterCallToAction&&this.setTooltip(e,this.getTooltipOffset(n.target))}handleChapterNavLeave(){this.platformSupportsMouseEvents&&!this.chapterCallToAction&&(this.tooltipChapter=null)}toggleMediaPopup(){this.mediaPopup?this.mediaPopup.close():(this.mediaPopup=this.popupService.open({origin:this.mediaToggle.nativeElement,content:qo,width:"300px"}),this.mediaPopup.afterClosed$.pipe((0,w.R)(this.ngUnsubscribe),(0,yt.q)(1)).subscribe(n=>{this.mediaPopup=null}))}toggleToolbar(n){this.viewService.toggleToolbar(n)}isEnabled(n){return this.viewUIService.isUIEnabled(n)}isVisible(n){return this.viewUIService.isVisible(n)}getChapterThumb(n){const o=this.store.selectSnapshot(Wt.getRegisteredThumbnails).get(n);return o.snapshot||o.urls.small}setTooltip(n,e=0){const s=this.store.selectSnapshot("previous"===n?_.getPreviousChapter:_.getNextChapter);s?(this.tooltipChapter={id:s.id,position:("previous"===n?"Previous":"Next")+" Chapter",title:s.displayName},this.tooltip&&(this.tooltip.nativeElement.style.left=`${e}px`)):this.tooltipChapter=null}getTooltipOffset(n){return n?n.offsetLeft+n.offsetWidth/2:0}setCallToAction(n){if(n){const e=this.nextChapter?.nativeElement;this.setTooltip("next",this.getTooltipOffset(e)),this.store.dispatch(new T.SetChapterCallToActionSeen(n))}else this.tooltipChapter=null;this.chapterCallToAction=n,this.changeDetectorRef.markForCheck()}}vn.\u0275fac=function(n){return new(n||vn)(i.Y36(ut),i.Y36(ri),i.Y36(l.yh),i.Y36(l.eX),i.Y36(i.sBO),i.Y36(ex),i.Y36(Ub.t4))},vn.\u0275cmp=i.Xpm({type:vn,selectors:[["app-view-tools"]],viewQuery:function(n,e){if(1&n&&(i.Gf(cz,5),i.Gf(lz,5),i.Gf(pz,5,i.SBq),i.Gf(dz,5)),2&n){let o;i.iGM(o=i.CRH())&&(e.chapterCount=o.first),i.iGM(o=i.CRH())&&(e.mediaToggle=o.first),i.iGM(o=i.CRH())&&(e.nextChapter=o.first),i.iGM(o=i.CRH())&&(e.tooltip=o.first)}},inputs:{animate:"animate",mode:"mode",collapsePagination:"collapsePagination",collapseScrubber:"collapseScrubber"},outputs:{modeChange:"modeChange"},features:[i._Bn([ex])],decls:3,vars:2,consts:[["role","toolbar","aria-label","Tools","data-test","viewTools",1,"view-tools"],[4,"ngIf"],["class","view-tools__group","role","navigation","aria-label","Chapters",4,"ngIf"],["class","view-tools__group",4,"ngIf"],["role","navigation","aria-label","Chapters",1,"view-tools__group"],["data-test","viewToolsPreviousChapter","aria-label","Previous Chapter","app-pin-button","","buttonType","ghost","icon","chevron-left",1,"view-tools__item",3,"disabled","click","mouseenter","mouseleave","focus","blur"],["data-test","viewToolsNextChapter","aria-label","Next Chapter","app-pin-button","","buttonType","ghost","icon","chevron-right",1,"view-tools__item",3,"disabled","click","mouseenter","mouseleave","focus","blur"],["nextChapter",""],["aria-hidden","true",1,"view-tools__tooltip-container"],["tooltip",""],["class","view-tools__tooltip",4,"ngIf"],[1,"view-tools__tooltip"],[1,"view-tools__chapters-thumb",3,"defaultImage","lazyLoad"],[1,"flex","flex-column"],[1,"view-tools__chapter-position"],[1,"view-tools__chapter-title"],[1,"view-tools__group"],["buttonShape","rounded"],["aria-hidden","true",1,"ph-2","text-13","text-semibold",2,"white-space","nowrap"],["icon","caret-up",1,"ml-2"],[1,"visually-hidden"],["data-test","viewToolsPlay","app-pin-button","","buttonType","ghost","class","view-tools__item",3,"icon","matTooltip","click",4,"ngIf"],["data-test","viewToolsMedia","app-pin-button","","buttonType","ghost","class","view-tools__item","aria-label","Open Media Bar","matTooltip","Open Media Bar",3,"click",4,"ngIf"],["data-test","viewToolsPlay","app-pin-button","","buttonType","ghost",1,"view-tools__item",3,"icon","matTooltip","click"],["data-test","viewToolsMedia","app-pin-button","","buttonType","ghost","aria-label","Open Media Bar","matTooltip","Open Media Bar",1,"view-tools__item",3,"click"],[2,"width","32px","margin","0 8px",3,"showHandle"],["role","radiogroup",1,"flex"],["app-pin-button","","buttonType","ghost","icon","mouse-pointer","aria-label","Select","matTooltip","Select","data-test","viewToolsSelect",1,"view-tools__item",3,"selected","click"],["app-pin-button","","buttonType","ghost","icon","eye-slash","aria-label","Hide","matTooltip","Hide","data-test","viewToolsHide",1,"view-tools__item",3,"selected","click"],["app-pin-button","","buttonType","ghost","aria-label","Fade","matTooltip","Fade","icon","adjust","data-test","viewToolsFade",1,"view-tools__item",3,"selected","click"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,yz,4,3,"ng-container",1),i.YNc(2,_z,12,18,"ng-container",1),i.qZA()),2&n&&(i.xp6(1),i.Q6J("ngIf",e.mode===e.viewToolsMode.Main),i.xp6(1),i.Q6J("ngIf",e.mode===e.viewToolsMode.Tools))},dependencies:[f.O5,Gt.gM,In,lt,Zr.z1,xi,Vo,f.Ov],styles:['.text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-tools{display:flex;justify-content:center;overflow:hidden}@keyframes viewToolsToggle{0%{opacity:1}50%{opacity:0}to{opacity:1}}@keyframes sonarEffect{0%{opacity:0;transform:scale(.5)}40%{opacity:.5}to{transform:scale(1);opacity:0}}.view-tools--swap{animation:viewToolsToggle .3s ease-in-out}.view-tools--dense .view-tools__divider{margin:4px}.view-tools__inner{display:flex;justify-content:center}.view-tools__group{border-right:1px solid rgba(0,0,0,.1);padding:0 8px;display:flex}.view-tools__group:empty{display:none}.view-tools__group:empty:first-of-type+.view-tools__group:not(:empty){padding-left:0}.view-tools__group:first-of-type{padding-left:0}.view-tools__group:last-of-type{border-right:none;padding-right:0}.view-tools__item{display:flex;align-items:center}.view-tools__item:not(:last-child){margin-right:4px}.view-tools__item--sonar{position:relative}.view-tools__item--sonar:after{pointer-events:none;position:absolute;width:100%;height:100%;border-radius:50%;border:2px solid #2d72dc;content:"";box-sizing:border-box;animation:sonarEffect 1s ease-out .2s 6 forwards;opacity:0;transform:scale(.7)}.view-tools__divider{border-right:1px solid rgba(0,0,0,.1);margin:4px 8px}.view-tools__count{font-size:12px;letter-spacing:.3px;line-height:1.4em;white-space:nowrap}.view-tools__tooltip-container{display:block;position:absolute;height:0;width:0;transform:translate(-50%,-100%);margin-top:-16px;opacity:0;transition:opacity .4s}.view-tools__tooltip-container--out{opacity:1;height:96px;width:280px}.view-tools__tooltip{display:flex;background-color:#ffffffe6;border-radius:4px;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;padding:8px}.view-tools__chapters-thumb{background-color:#f9fafd;border-radius:4px;background-repeat:no-repeat;background-size:cover;flex:0 0 80px;height:80px;width:80px;margin-right:16px}.view-tools__chapter-position{font-size:14px;font-weight:600;margin-bottom:4px;white-space:nowrap}.view-tools__chapter-title{font-size:12px;font-weight:400;line-height:18px;overflow-wrap:break-word;word-break:break-word;white-space:normal}@media (max-width: 600px){.view-tools__chapters-thumb{display:none}.view-tools__chapter-position{font-size:12px;margin-bottom:0}.view-tools__chapter-title{display:none}.view-tools__tooltip-container--out{height:auto;width:auto}}\n'],encapsulation:2,changeDetection:0}),li([(0,l.Ph)(_.getSelectedChapterReadyState),pi("design:type",b.y)],vn.prototype,"selectedChapterReady$",void 0),li([(0,l.Ph)(M.getActiveTool),pi("design:type",b.y)],vn.prototype,"activeTool$",void 0),li([(0,l.Ph)(O.getPresentationActive),pi("design:type",b.y)],vn.prototype,"presentationActive$",void 0),li([(0,l.Ph)(_.getIsChapterAnimated),pi("design:type",b.y)],vn.prototype,"isChapterAnimated$",void 0),li([(0,l.Ph)(M.getShowLabels),pi("design:type",b.y)],vn.prototype,"showLabels$",void 0),li([(0,l.Ph)(M.getAnimationPlaying),pi("design:type",b.y)],vn.prototype,"animationPlaying$",void 0),li([(0,l.Ph)(te.getChapterLabels),pi("design:type",b.y)],vn.prototype,"labels$",void 0),li([(0,l.Ph)(_.getSelectedChapterTitle),pi("design:type",b.y)],vn.prototype,"chapterTitle$",void 0),li([(0,l.Ph)(_.getSelectedChapterIndex),pi("design:type",b.y)],vn.prototype,"chapterIndex$",void 0),li([(0,l.Ph)(_.getNextChapter),pi("design:type",b.y)],vn.prototype,"nextChapter$",void 0),li([(0,l.Ph)(_.getPreviousChapter),pi("design:type",b.y)],vn.prototype,"previousChapter$",void 0),li([(0,l.Ph)(_.getChapterCount),pi("design:type",b.y)],vn.prototype,"chapterCount$",void 0),li([(0,l.Ph)(O.getCanTouch),pi("design:type",b.y)],vn.prototype,"canTouch$",void 0);const xz=["viewToolbar"],vz=["exploreTrigger"];function Cz(t,n){if(1&t&&(i.TgZ(0,"app-pillbox",6),i._UZ(1,"app-view-tools",7),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("collapsePagination",e.collapsePagination)("collapseScrubber",e.collapseScrubber)("mode",e.viewToolsMode.Main)}}function wz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"app-pillbox",8)(1,"button",9,10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleExploreToolsClick())}),i.qZA()()}2&t&&(i.xp6(1),i.Q6J("matTooltip","Explore"),i.uIk("aria-label","Explore"))}function Sz(t,n){if(1&t&&(i.TgZ(0,"div",3),i.YNc(1,Cz,2,3,"app-pillbox",4),i.YNc(2,wz,3,2,"app-pillbox",5),i.qZA()),2&t){const e=i.oxw();i.Q6J("@inOutAnimation",void 0),i.xp6(1),i.Q6J("ngIf",e.isVisible(e.viewUI.Pagination)||e.isVisible(e.viewUI.Mediabar)),i.xp6(1),i.Q6J("ngIf",e.isEnabled(e.viewUI.Tools))}}function Pz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",3)(1,"app-pillbox",11),i.NdJ("exit",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i._UZ(2,"app-view-media-bar",12),i.qZA()()}if(2&t){const e=i.oxw();i.Q6J("@inOutAnimation",void 0),i.xp6(1),i.Q6J("canExit",e.canExit),i.xp6(1),i.Q6J("template",e.mediaTemplate)}}function kz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",3)(1,"app-pillbox",13),i.NdJ("exit",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i._UZ(2,"app-view-tools",14),i.qZA()()}if(2&t){const e=i.oxw();i.Q6J("@inOutAnimation",void 0),i.xp6(1),i.Q6J("canExit",e.canExit),i.xp6(1),i.Q6J("mode",e.viewToolsMode.Tools)}}function Oz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",3)(1,"app-pillbox",15),i.NdJ("exit",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i._UZ(2,"app-view-layers-bar"),i.qZA()()}if(2&t){const e=i.oxw();i.Q6J("@inOutAnimation",void 0),i.xp6(1),i.Q6J("canExit",e.canExit)}}let Tz=(()=>{class t{constructor(e,o,s,r,a){this.store=e,this.changeDetectorRef=o,this.viewService=s,this.viewUIService=r,this.elementRef=a,this.viewUI=x,this.canExit=!0,this.mode=_n.Main,this.lockMode=!1,this.position="center",this.ngUnsubscribe=new X.x,this.breakpoint=_t,this.viewToolsMode=_n,this.viewLayout=x,this.collapsePagination=!1,this.collapseScrubber=!1,this.modeSubject=new Hi.X(_n.Main)}ngOnInit(){this.initLayoutListener(),this.initBreakpointListener(),this.initFocusListeners()}initLayoutListener(){this.store.select(O.getUI).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{this.lockMode||(this.mode=_n.Main,this.viewUIService.isUIVisible(x.Media)&&(this.mediaTemplate=e.media.template,this.mode=_n.Media),this.viewUIService.isToolsVisible()&&(this.mode=_n.Tools),this.viewUIService.isVisibilityLayersVisible()&&this.viewUIService.isUIVisible(x.VisibilityLayers)&&(this.mode=_n.VisibilityLayers),this.modeSubject.next(this.mode),this.changeDetectorRef.markForCheck())})}initBreakpointListener(){this.store.select(Pt.getBreakpoint).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{const o=e<=_t.Small;this.collapseScrubber=o,this.collapsePagination=o,this.changeDetectorRef.markForCheck()})}initFocusListeners(){const e=this.modeSubject.asObservable().pipe((0,lp.O)(this.mode),(0,Ao.G)(),(0,$.h)(([o,s])=>o===_n.Tools&&s===_n.Main),(0,$n.x)(),(0,w.R)(this.ngUnsubscribe));(0,Dt.R)(this.elementRef.nativeElement,"keypress").pipe((0,N3.n)(()=>this.mode===_n.Tools),(0,eo.w)(()=>e.pipe((0,w.R)((0,R3.H)(125)))),(0,cn.b)(301),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.exploreTrigger&&this.exploreTrigger.focus()})}isVisible(e){return this.viewUIService.isVisible(e)}isEnabled(e){return this.viewUIService.isUIEnabled(e)}handleExitClick(){const e=this.store.selectSnapshot(O.getUI);e.media.status=Pe.Hide,e.tools.status=Pe.Hide,e.visibilityLayers.status=Pe.Hide,this.viewService.selectTool(Ve.Select),this.store.dispatch(new T.SetUI(e))}handleExploreToolsClick(){this.viewService.toggleToolbar("tools")}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(i.sBO),i.Y36(ut),i.Y36(ri),i.Y36(i.SBq))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-toolbar"]],viewQuery:function(e,o){if(1&e&&(i.Gf(xz,5),i.Gf(vz,5)),2&e){let s;i.iGM(s=i.CRH())&&(o.viewToolbar=s.first),i.iGM(s=i.CRH())&&(o.exploreTrigger=s.first)}},inputs:{canExit:"canExit",mode:"mode",lockMode:"lockMode",position:"position"},decls:5,vars:4,consts:[[3,"ngSwitch"],["data-test","viewToolbar","class","view-toolbar",4,"ngSwitchDefault"],["data-test","viewToolbar","class","view-toolbar",4,"ngSwitchCase"],["data-test","viewToolbar",1,"view-toolbar"],["eventCategory","View Primary Toolbar","name","Primary Toolbar",4,"ngIf"],["name","Explore Toolbar","class","ml-3",4,"ngIf"],["eventCategory","View Primary Toolbar","name","Primary Toolbar"],[3,"collapsePagination","collapseScrubber","mode"],["name","Explore Toolbar",1,"ml-3"],["data-test","viewExploreToolbar","icon","mouse-pointer","app-pin-button","","buttonType","ghost",3,"matTooltip","click"],["exploreTrigger",""],["eventCategory","View Media Bar","name","Media Bar",3,"canExit","exit"],[3,"template"],["eventCategory","View Explore Tools","name","Explore Tools",3,"canExit","exit"],[3,"mode"],["name","Visibility Layers",3,"canExit","exit"]],template:function(e,o){1&e&&(i.ynx(0,0),i.YNc(1,Sz,3,3,"div",1),i.YNc(2,Pz,3,3,"div",2),i.YNc(3,kz,3,3,"div",2),i.YNc(4,Oz,3,2,"div",2),i.BQk()),2&e&&(i.Q6J("ngSwitch",o.mode),i.xp6(2),i.Q6J("ngSwitchCase",o.viewToolsMode.Media),i.xp6(1),i.Q6J("ngSwitchCase",o.viewToolsMode.Tools),i.xp6(1),i.Q6J("ngSwitchCase",o.viewToolsMode.VisibilityLayers))},dependencies:[f.O5,f.RF,f.n9,f.ED,Gt.gM,In,Wa,V3,qo,vn],styles:[".view-toolbar{position:absolute;display:flex;z-index:20;bottom:0;right:0}\n"],encapsulation:2,data:{animation:[(0,j.X$)("inOutAnimation",[(0,j.eR)(":enter",[(0,j.oB)({opacity:0,transform:"translateY(200px)"}),(0,j.jt)("300ms ease-in-out",(0,j.oB)({opacity:1,transform:"*"}))]),(0,j.eR)(":leave",[(0,j.jt)("300ms ease-in-out",(0,j.oB)({transform:"translateY(200px)",opacity:0}))])])]},changeDetection:0}),t})();const Mz=["app-view-rounded-button",""];function Iz(t,n){if(1&t&&i._UZ(0,"app-icon",3),2&t){const e=i.oxw();i.Q6J("icon",e.icon)}}let Ag=(()=>{class t{constructor(){this.iconPlacement="left",this.compact=!1,this.buttonType="outline"}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["button","app-view-rounded-button",""]],inputs:{icon:"icon",iconPlacement:"iconPlacement",label:"label",compact:"compact",buttonType:"buttonType",shadow:"shadow"},attrs:Mz,decls:4,vars:12,consts:[[1,"view-rounded-button"],["class","view-rounded-button__icon mh-1",3,"icon",4,"ngIf"],[1,"view-rounded-button__label","mh-1"],[1,"view-rounded-button__icon","mh-1",3,"icon"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.YNc(1,Iz,1,1,"app-icon",1),i.TgZ(2,"div",2),i._uU(3),i.qZA()()),2&e&&(i.ekj("view-rounded-button--outline","outline"===o.buttonType)("view-rounded-button--solid","solid"===o.buttonType)("view-rounded-button--shadow",o.shadow)("view-rounded-button--compact",o.compact)("view-rounded-button--reverse","right"===o.iconPlacement),i.xp6(1),i.Q6J("ngIf",o.icon),i.xp6(2),i.Oqu(o.label))},dependencies:[f.O5,lt],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}button[app-view-rounded-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all}button[app-view-rounded-button]:hover .view-rounded-button,button[app-view-rounded-button]:focus .view-rounded-button{color:#f9fafd;border-color:#f9fafd;background:rgba(249,250,253,.25)}button[app-view-rounded-button]:hover .view-rounded-button--solid,button[app-view-rounded-button]:focus .view-rounded-button--solid{border-color:#f9fafd40}.view-rounded-button{cursor:pointer;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:12px 16px;border-style:solid;border-width:1px;border-radius:24px;color:#f9fafd;border-color:#f9fafd}.view-rounded-button__label{font-size:16px;letter-spacing:.4px;line-height:1.4em}.view-rounded-button--solid{color:#060502;border-color:#060502;background:#f9fafd}.view-rounded-button--shadow{box-shadow:0 0 8px #00000052}.view-rounded-button--reverse{flex-direction:row-reverse}.view-rounded-button--compact{padding:4px 8px}\n"],encapsulation:2,changeDetection:0}),t})();var $o=(()=>(function(t){t.CameraZoom="camera-zoom",t.CameraRotate="camera-rotate",t.CameraPan="camera-pan",t.NodeSelection="node-selection"}($o||($o={})),$o))();function tx(t,n,e=1e3,o=.001){return Lg(t).pipe((0,lp.O)(n.getCameraZoom()),(0,J.U)(()=>n.getCameraZoom()),(0,Ao.G)(),(0,J.U)(([s,r])=>r-s),(0,$.h)(s=>Math.abs(s)>o),(0,cn.b)(e))}function nx(t,n,e=125){return Lg(t).pipe((0,lp.O)(n.getLookDirection()),(0,J.U)(()=>n.getLookDirection()),(0,Ao.G)(),(0,J.U)(([o,s])=>function Nz(t,n){return he.angle(t,n)>.001}(o,s)),(0,$.h)(o=>o),(0,cn.b)(e))}function ix(t){return{camera:t.getCamera(),zoom:t.getCameraZoom()}}function Lg(t){return t.getEvent(pe.CameraRested)}function ox(t){const{eye:n,look:e}=t,o=he.fromValues(n.x,n.y,n.z),s=he.fromValues(e.x,e.y,e.z),r=he.create();return he.sub(r,o,s),r}var sx=A(5620);function Dz(t,n){if(1&t&&(i.TgZ(0,"h2",6),i._uU(1),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.hij(" ",e.title," ")}}function jz(t,n){if(1&t&&i._UZ(0,"img",7),2&t){const e=i.oxw(2);i.Q6J("src",e.image,i.LSH)("alt",e.alt)}}function Qz(t,n){if(1&t&&(i.TgZ(0,"div",1),i.YNc(1,Dz,2,1,"h2",2),i.TgZ(2,"article",3),i.Hsn(3),i.qZA(),i.YNc(4,jz,1,2,"img",4),i.TgZ(5,"div",5),i.Hsn(6,1),i.qZA()()),2&t){const e=i.oxw();i.ekj("slide--expanded","expanded"===e.spacing),i.Q6J("@refresh",void 0),i.xp6(1),i.Q6J("ngIf",e.title),i.xp6(3),i.Q6J("ngIf",e.image)}}const Zz=["*",[["","slide-footer",""]]],Bz=["*","[slide-footer]"];let Fg=(()=>{class t{constructor(e,o,s,r,a,c){this.store=e,this.actions=o,this.engineService=s,this.cameraService=r,this.engineRendererService=a,this.changeRef=c,this.alt="",this.spacing="compact",this.exitEnabled=!0,this.triggerDelay=300,this.triggerComplete=new i.vpe,this._shown=!1,this.ngUnsubscribe=new X.x}set shown(e){this._shown=e,this.initTrigger(),this.changeRef.markForCheck()}get shown(){return this._shown}ngOnInit(){}ngAfterViewInit(){this.initTrigger()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTrigger(){if(this.ngUnsubscribe.next(),this.shown&&this.trigger){const e=this.resetCamera(),o=this.store.selectSnapshot(O.getCanTouch);(function zz(t,n,e,o,s,r){switch(t){case $o.CameraZoom:return r?tx(e,o):function Az(t,n,e,o=1e3,s=.001){const r=e.getCanvas(),a=(0,Dt.R)(r,"wheel"),c=(0,Dt.R)(r,"touchmove").pipe((0,$.h)(d=>2===d.touches.length)),p=tx(t,n,o,s);return(0,Li.T)(a,c).pipe((0,Ii.V)(()=>p))}(e,o,s);case $o.CameraPan:return function Uz(t,n,e,o=125){const s=e.getCanvas(),r=(0,Dt.R)(s,"mousemove").pipe((0,$.h)(p=>1===p.buttons&&p.shiftKey||2===p.buttons||4===p.buttons)),a=(0,Dt.R)(s,"touchmove").pipe((0,$.h)(p=>2===p.touches.length)),c=function Fz(t,n,e=125){return Lg(t).pipe((0,lp.O)(ix(n)),(0,J.U)(()=>ix(n)),(0,cn.b)(e),(0,Ao.G)(),(0,J.U)(([o,s])=>function Ez(t,n){const s=ox(t.camera),r=ox(n.camera),a=he.create();he.sub(a,s,r);const c=a.reduce((d,u)=>d+u),p=n.zoom-t.zoom;return(0!==p||0!==c)&&Math.abs(c)<1&&Math.abs(p)<.001}(o,s)),(0,$.h)(o=>o))}(t,n,o);return(0,Li.T)(r,a).pipe((0,Ii.V)(()=>c))}(e,o,s);case $o.CameraRotate:return r?nx(e,o):function Lz(t,n,e,o,s=1e3){const r=o.getCanvas(),a=(0,Dt.R)(r,"mousemove").pipe((0,$.h)(d=>1===d.buttons)),c=(0,Dt.R)(r,"touchmove").pipe((0,$.h)(d=>1===d.touches.length)),p=nx(n,e,s);return(0,Li.T)(a,c).pipe((0,Ii.V)(()=>p),(0,$.h)(()=>"rotate"===t.selectSnapshot(Ne.getPanMode)),(0,cn.b)(125))}(n,e,o,s);case $o.NodeSelection:return function Rz(t){return t.select(Se.getCheckedNodes).pipe((0,Ao.G)(),(0,$.h)(([n,e])=>e.length>0))}(n)}})(this.trigger,this.store,this.engineService,this.cameraService,this.engineRendererService,o).pipe((0,sx.u)(e),(0,Rr.g)(this.triggerDelay),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.triggerComplete.next()})}}resetCamera(){const o=this.store.selectSnapshot(_.getSelectedChapter)?.camera?.location;return(0,m.isNil)(o)?(0,Ue.of)(void 0):this.store.dispatch(new Zn(o,!0)).pipe((0,Di.z)(()=>this.actions.pipe((0,l.xt)(ad))),(0,yt.q)(1))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(et),i.Y36(Bn),i.Y36(Po),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-tour-slide"]],inputs:{title:"title",image:"image",alt:"alt",spacing:"spacing",shown:"shown",exitEnabled:"exitEnabled",trigger:"trigger",triggerDelay:"triggerDelay"},outputs:{triggerComplete:"triggerComplete"},ngContentSelectors:Bz,decls:1,vars:1,consts:[["class","slide",3,"slide--expanded",4,"ngIf"],[1,"slide"],["class","slide__title",4,"ngIf"],[1,"slide__content"],["class","slide__image",3,"src","alt",4,"ngIf"],[1,"slide__footer"],[1,"slide__title"],[1,"slide__image",3,"src","alt"]],template:function(e,o){1&e&&(i.F$t(Zz),i.YNc(0,Qz,7,5,"div",0)),2&e&&i.Q6J("ngIf",o.shown)},dependencies:[f.O5],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.slide[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;max-width:500px}.slide__title[_ngcontent-%COMP%]{margin-bottom:16px;font-weight:600;font-size:18px;letter-spacing:.45px;line-height:1.4em}.slide__content[_ngcontent-%COMP%]{margin-bottom:16px;font-size:16px;letter-spacing:.4px;line-height:1.4em;line-height:1.5em;max-width:100%}.slide__image[_ngcontent-%COMP%]{margin:24px auto;max-width:100%;min-height:1px}.slide__footer[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;font-weight:500;display:flex;flex-direction:row;align-items:center;justify-content:center;max-width:100%}.slide--expanded[_ngcontent-%COMP%]   .slide__title[_ngcontent-%COMP%]{margin:16px}.slide--expanded[_ngcontent-%COMP%]   .slide__content[_ngcontent-%COMP%]{margin:48px}.slide--expanded[_ngcontent-%COMP%]   .slide__image[_ngcontent-%COMP%]{margin:48px auto}@media (max-width: 768px){.slide[_ngcontent-%COMP%]{max-width:400px}.slide__image[_ngcontent-%COMP%]{margin:16px}.slide__title[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em;margin-bottom:12px}.slide__content[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;margin-bottom:12px}.slide__footer[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}}@media (max-width: 640px){.slide[_ngcontent-%COMP%]{max-width:320px}}@media (max-width: 480px){.slide[_ngcontent-%COMP%]{max-width:240px}.slide__title[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;margin-bottom:8px}.slide__content[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em;margin-bottom:8px}.slide__image[_ngcontent-%COMP%]{margin:4px auto}.slide__footer[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}}@media (max-width: 320px){.slide[_ngcontent-%COMP%]{max-width:160px}}"],data:{animation:[(0,j.X$)("refresh",[(0,j.eR)(":enter",[(0,j._7)(ea.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),t})();function Vz(t,n){1&t&&(i.TgZ(0,"div",1)(1,"div",2),i.Hsn(2),i.qZA()())}const qz=["*"];let Ug=(()=>{class t{constructor(e){this.changeRef=e,this.selectedSlideIndex=0,this._shown=!1,this.ngUnsubscribe=new X.x}set shown(e){this._shown=e,this.setSelectedSlide(0)}get shown(){return this._shown}ngOnInit(){}ngAfterViewInit(){this.initListeners(),setTimeout(()=>{this.setSlideShown(this.selectedSlideIndex)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}goToPrevSlide(){this.setSelectedSlide(this.selectedSlideIndex-1)}goToNextSlide(){this.setSelectedSlide(this.selectedSlideIndex+1)}setSelectedSlide(e){if(this.selectedSlideIndex=e,this.slides){const s=Math.max(0,Math.min(this.slides.length-1,e));this.selectedSlideIndex=s}this.setSlideShown(this.selectedSlideIndex)}initListeners(){(0,Li.T)(...this.slides.map(e=>e.triggerComplete.asObservable())).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.goToNextSlide()})}setSlideShown(e){this.slides&&this.slides.forEach((o,s)=>{o.shown=s===e}),this.changeRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-tour-page"]],contentQueries:function(e,o,s){if(1&e&&i.Suo(s,Fg,4),2&e){let r;i.iGM(r=i.CRH())&&(o.slides=r)}},inputs:{shown:"shown"},ngContentSelectors:qz,decls:1,vars:1,consts:[["class","page",4,"ngIf"],[1,"page"],[1,"page__contents"]],template:function(e,o){1&e&&(i.F$t(),i.YNc(0,Vz,3,0,"div",0)),2&e&&i.Q6J("ngIf",o.shown)},dependencies:[f.O5],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.page__contents[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}@media (max-width: 768px){.page__contents[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}}@media (max-width: 480px){.page__contents[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}}"],changeDetection:0}),t})();function Jz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",5)(1,"button",6),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handlePrevClick())}),i.qZA(),i.TgZ(2,"div",7),i._uU(3),i.qZA(),i.TgZ(4,"button",8),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleNextClick())}),i.qZA()()}if(2&t){const e=i.oxw().$implicit;i.xp6(1),i.Q6J("disabled",e.pageIndex<1),i.uIk("aria-disabled",e.pageIndex<1)("tabindex",e.pageIndex<1?-1:0),i.xp6(2),i.AsE("",e.pageIndex+1," / ",e.pageSize,""),i.xp6(1),i.Q6J("disabled",e.pageIndex===e.pageSize-1),i.uIk("aria-disabled",e.pageIndex===e.pageSize-1)("tabindex",e.pageIndex===e.pageSize-1?-1:0)}}const Hz=function(t){return{"pages--opaquer":t}};function Yz(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1)(1,"button",2),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i.qZA(),i.TgZ(2,"div",3),i.Hsn(3),i.qZA(),i.YNc(4,Jz,5,8,"div",4),i.qZA()}if(2&t){const e=n.$implicit;i.Q6J("ngClass",i.VKq(2,Hz,e.pageIndex==e.pageSize-1)),i.xp6(4),i.Q6J("ngIf",e.pageIndex<e.pageSize-1)}}class nr{constructor(n,e){this.store=n,this.changeRef=e,this.ngUnsubscribe=new X.x}ngOnInit(){}ngAfterViewInit(){this.tutorial$.pipe((0,w.R)(this.ngUnsubscribe),(0,$.h)(n=>null!=n&&n.pageSize>0)).subscribe(n=>{this.handleTutorialPages(n)}),this.store.dispatch(new T.SetTutorial({pageSize:this.pages.length,pageIndex:0}))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePrevClick(){this.store.dispatch(new T.TutorialPrevious)}handleNextClick(){this.store.dispatch(new T.TutorialNext)}handleExitClick(){this.store.dispatch(new T.ToggleWindow(pt.Tutorial,!1))}handleTutorialPages(n){this.pages.forEach((e,o)=>{e.shown=o===n.pageIndex}),this.changeRef.markForCheck()}}nr.\u0275fac=function(n){return new(n||nr)(i.Y36(l.yh),i.Y36(i.sBO))},nr.\u0275cmp=i.Xpm({type:nr,selectors:[["app-view-tour-pages"]],contentQueries:function(n,e,o){if(1&n&&i.Suo(o,Ug,4),2&n){let s;i.iGM(s=i.CRH())&&(e.pages=s)}},ngContentSelectors:["*"],decls:2,vars:3,consts:[["class","pages",3,"ngClass",4,"ngIf"],[1,"pages",3,"ngClass"],["app-pin-button","","buttonType","dark","size","medium","icon","times","aria-label","Exit Tutorial","matTooltip","Exit Tutorial","matTooltipPosition","right","data-test","tutorialExitButton",1,"pages__close",3,"click"],[1,"pages__contents"],["class","pages__footer",4,"ngIf"],[1,"pages__footer"],["app-pin-button","","buttonType","dark","size","large","icon","angle-left","aria-label","Previous Tutorial Step","matTooltip","Previous Tutorial Step","matTooltipPosition","left","data-test","tutorialPreviousButton",1,"pages__nav",3,"disabled","click"],[1,"mh-8"],["app-pin-button","","buttonType","dark","size","large","icon","angle-right","aria-label","Next Tutorial Step","matTooltip"," Next Tutorial Step","matTooltipPosition","right","data-test","tutorialNextButton",1,"pages__nav",3,"disabled","click"]],template:function(n,e){1&n&&(i.F$t(),i.YNc(0,Yz,5,4,"div",0),i.ALo(1,"async")),2&n&&i.Q6J("ngIf",i.lcZ(1,1,e.tutorial$))},dependencies:[f.mk,f.O5,Gt.gM,In,f.Ov],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.pages[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:20px auto 48px;max-width:600px;position:relative;background:rgba(16,24,35,.8);border-radius:16px;padding:24px 28px 20px}.pages--opaquer[_ngcontent-%COMP%]{background:rgba(16,24,35,.9)}.pages__footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;font-size:16px;letter-spacing:.4px;line-height:1.4em;font-weight:500}.pages__close[_ngcontent-%COMP%]{z-index:1;position:absolute;top:8px;right:8px;align-self:flex-end;display:flex;align-items:center;justify-content:center}.pages__contents[_ngcontent-%COMP%]{padding:16px 0}@media (max-width: 768px){.pages[_ngcontent-%COMP%]{margin:16px 12% 48px;border-radius:10px;padding:18px 22px 14px}.pages__contents[_ngcontent-%COMP%]{padding:24px 0}.pages__footer[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.pages__nav[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}}@media (max-width: 480px){.pages[_ngcontent-%COMP%]{margin:12px 10% 48px;border-radius:8px;padding:24px 20px 12px}.pages__footer[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.pages__nav[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(O.getTutorial),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],nr.prototype,"tutorial$",void 0);let rx=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-tour-success"]],inputs:{inline:"inline"},decls:2,vars:2,consts:[[1,"view-tour-success"],["icon","check",1,"view-tour-success__icon"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"app-icon",1),i.qZA()),2&e&&i.ekj("view-tour-success--inline",o.inline)},dependencies:[lt],styles:[".text-8{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header{font-weight:700}.text--code{font-family:Courier New,Courier,monospace}.text-uppercase{text-transform:uppercase}.text-xlight{font-weight:200}.text-light{font-weight:300}.text-medium{font-weight:500}.text-semibold{font-weight:600}.text-bold{font-weight:700}.text-underline{text-decoration:underline}.text-italic{font-style:italic}.text-bright{color:#fff}.text-dim{color:#96a8c0}.text-error{color:#ed4758}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link,.text-link:visited{color:inherit;cursor:pointer}.text-link:not(.text-underline),.text-link:visited:not(.text-underline){text-decoration:none}.text-success{color:#38de38}.text-danger{color:#de3535}.text-info{color:#2d72dc}.text-nowrap{white-space:nowrap}.text-pre-line{white-space:pre-line}.view-tour-success{width:52px;height:52px;display:flex;background-color:#1bbc66;border-radius:50%;justify-content:center;align-items:center}.view-tour-success__icon{font-size:36px;letter-spacing:.9px;line-height:1.4em;color:#fff}.view-tour-success--inline{display:inline-flex;width:32px;height:32px}.view-tour-success--inline .view-tour-success__icon{font-size:18px;letter-spacing:.45px;line-height:1.4em}@media (max-width: 768px){.view-tour-success{width:36px;height:36px}.view-tour-success__icon{font-size:20px;letter-spacing:.5px;line-height:1.4em}.view-tour-success--inline{display:inline-flex;width:24px;height:24px}.view-tour-success--inline .view-tour-success__icon{font-size:12px;letter-spacing:.3px;line-height:1.4em}}\n"],encapsulation:2,changeDetection:0}),t})();function Kz(t,n){if(1&t&&i._UZ(0,"app-icon",5),2&t){const e=i.oxw(2);i.Q6J("icon",e.icon)}}function Xz(t,n){if(1&t&&(i.TgZ(0,"span",6),i._uU(1),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Oqu(e.label)}}function eA(t,n){if(1&t&&(i.ynx(0),i.YNc(1,Kz,1,1,"app-icon",3),i.YNc(2,Xz,2,1,"span",4),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.icon),i.xp6(1),i.Q6J("ngIf",e.icon)}}function tA(t,n){if(1&t&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.label," ")}}let nA=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-tour-tip-button"]],inputs:{label:"label",icon:"icon"},decls:3,vars:2,consts:[[1,"view-tour-tip-button","mv-1","mh-1",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"icon",4,"ngIf"],["class","visually-hidden",4,"ngIf"],[3,"icon"],[1,"visually-hidden"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i.YNc(1,eA,3,2,"ng-container",1),i.YNc(2,tA,2,1,"span",2),i.qZA()),2&e&&(i.Q6J("ngSwitch",!!o.icon),i.xp6(1),i.Q6J("ngSwitchCase",!0))},dependencies:[f.O5,f.RF,f.n9,f.ED,lt],styles:[".view-tour-tip-button{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;color:#131c2a;background-color:#fff;border-radius:2px;font-weight:700;padding:4px;width:24px;height:24px}@media (max-width: 768px){.view-tour-tip-button{width:20px;height:20px}}\n"],encapsulation:2,changeDetection:0}),t})();function sA(t,n){1&t&&(i.ynx(0),i._uU(1," Hold the control key and scroll up and down to zoom in or out. "),i.BQk())}function rA(t,n){1&t&&(i.ynx(0),i._uU(1," Scroll up and down to zoom in or out. "),i.BQk())}class ra{constructor(n){this.viewService=n,this.triggers=$o}ngOnInit(){this.captureScroll$=this.scrollMode$.pipe((0,J.U)(n=>n===Xi.Capture))}handleStartClick(){this.viewService.toggleTutorial(!1)}}ra.\u0275fac=function(n){return new(n||ra)(i.Y36(ut))},ra.\u0275cmp=i.Xpm({type:ra,selectors:[["app-view-tour-desktop"]],decls:62,vars:12,consts:[["title","Rotate",3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"text-semibold"],["icon","caret-up","label","up"],["icon","caret-down","label","down"],["icon","caret-left","label","left"],["icon","caret-right","label","right"],["title","Zoom",3,"trigger","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["label","+"],["label","-"],["title","Pan",3,"trigger"],["label","W"],["label","A"],["label","S"],["label","D"],["title","Explore the Anatomy",3,"trigger"],["image","assets/images/tutorial/tutorial-toolbar@3x.png","alt","Screenshot showing the various toolbars used to interact with 3D content"],["slide-footer","",1,"flex","flex-column","items-center","justify-center"],["app-view-rounded-button","","buttonType","solid","label","Start Exploring!","aria-label","Start Exploring",1,"mt-4",3,"click"]],template:function(n,e){1&n&&(i.TgZ(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",0),i._uU(3," Click and drag the model to change the viewing angle. "),i.qZA(),i.TgZ(4,"app-view-tour-slide")(5,"div",1)(6,"div"),i._UZ(7,"app-view-tour-success",2),i.TgZ(8,"strong",3),i._uU(9,"Tip:"),i.qZA(),i._uU(10," You can also use the arrow keys "),i._UZ(11,"app-view-tour-tip-button",4)(12,"app-view-tour-tip-button",5)(13,"app-view-tour-tip-button",6)(14,"app-view-tour-tip-button",7),i._uU(15," to rotate. "),i.qZA()()()(),i.TgZ(16,"app-view-tour-page")(17,"app-view-tour-slide",8),i.ALo(18,"async"),i.YNc(19,sA,2,0,"ng-container",9),i.YNc(20,rA,2,0,"ng-container",10),i.qZA(),i.TgZ(21,"app-view-tour-slide")(22,"div",1)(23,"div"),i._UZ(24,"app-view-tour-success",2),i.TgZ(25,"strong",3),i._uU(26,"Tip:"),i.qZA(),i._uU(27," You can also use "),i._UZ(28,"app-view-tour-tip-button",11),i._uU(29," to zoom in and "),i._UZ(30,"app-view-tour-tip-button",12),i._uU(31," to zoom out. "),i.qZA()()()(),i.TgZ(32,"app-view-tour-page")(33,"app-view-tour-slide",13),i._uU(34," Hold the shift key and drag to move the model's position. "),i.qZA(),i.TgZ(35,"app-view-tour-slide")(36,"div",1)(37,"div"),i._UZ(38,"app-view-tour-success",2),i.TgZ(39,"strong",3),i._uU(40,"Tip:"),i.qZA(),i._uU(41," You can also use the "),i._UZ(42,"app-view-tour-tip-button",14)(43,"app-view-tour-tip-button",15)(44,"app-view-tour-tip-button",16)(45,"app-view-tour-tip-button",17),i._uU(46," keys to pan. "),i.qZA()()()(),i.TgZ(47,"app-view-tour-page")(48,"app-view-tour-slide",18),i._uU(49," Click on an individual part of the model to highlight anatomy. "),i.qZA(),i.TgZ(50,"app-view-tour-slide")(51,"div",1)(52,"div"),i._UZ(53,"app-view-tour-success",2),i.TgZ(54,"strong",3),i._uU(55,"Tip:"),i.qZA(),i._uU(56," Double-click to zoom in on specific structures. "),i.qZA()()()(),i.TgZ(57,"app-view-tour-page")(58,"app-view-tour-slide",19),i._uU(59," Use the toolbar to navigate through the 3D experience, launch deeper exploration tools, and relaunch this tutorial. "),i.TgZ(60,"div",20)(61,"button",21),i.NdJ("click",function(){return e.handleStartClick()}),i.qZA()()()()()),2&n&&(i.xp6(2),i.Q6J("trigger",e.triggers.CameraRotate),i.xp6(5),i.Q6J("inline",!0),i.xp6(10),i.Q6J("trigger",e.triggers.CameraZoom)("ngSwitch",i.lcZ(18,10,e.captureScroll$)),i.xp6(2),i.Q6J("ngSwitchCase",!1),i.xp6(5),i.Q6J("inline",!0),i.xp6(9),i.Q6J("trigger",e.triggers.CameraPan),i.xp6(5),i.Q6J("inline",!0),i.xp6(10),i.Q6J("trigger",e.triggers.NodeSelection),i.xp6(5),i.Q6J("inline",!0))},dependencies:[f.RF,f.n9,f.ED,Ag,Ug,nr,Fg,rx,nA,f.Ov],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(M.getScrollMode),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ra.prototype,"scrollMode$",void 0);let aA=(()=>{class t{constructor(e){this.viewService=e,this.triggers=$o}handleStartClick(){this.viewService.toggleTutorial(!1)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(ut))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-view-tour-mobile"]],decls:31,vars:5,consts:[["title","Rotate",3,"trigger"],["title","Zoom",3,"trigger"],["title","Pan",3,"trigger"],["title","Explore the Anatomy",3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"text-semibold"],["title","Toolbar","image","assets/images/tutorial/tutorial-toolbar@3x.png","alt","Toolbars used for navigating content"],["slide-footer","",1,"flex","flex-column","items-center","justify-center"],["app-view-rounded-button","","buttonType","solid","label","Start Exploring!","aria-label","Start Exploring",1,"mt-4",3,"click"]],template:function(e,o){1&e&&(i.TgZ(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",0),i._uU(3," Tap and drag with one finger to change the viewing angle. "),i.qZA(),i.TgZ(4,"app-view-tour-slide"),i._UZ(5,"app-view-tour-success"),i.qZA()(),i.TgZ(6,"app-view-tour-page")(7,"app-view-tour-slide",1),i._uU(8," Pinch with two fingers to zoom in or out. "),i.qZA(),i.TgZ(9,"app-view-tour-slide"),i._UZ(10,"app-view-tour-success"),i.qZA()(),i.TgZ(11,"app-view-tour-page")(12,"app-view-tour-slide",2),i._uU(13," Use two fingers to adjust the model's position. "),i.qZA(),i.TgZ(14,"app-view-tour-slide"),i._UZ(15,"app-view-tour-success"),i.qZA()(),i.TgZ(16,"app-view-tour-page")(17,"app-view-tour-slide",3),i._uU(18," Tap on an individual part of the model to highlight anatomy. "),i.qZA(),i.TgZ(19,"app-view-tour-slide")(20,"div",4)(21,"div"),i._UZ(22,"app-view-tour-success",5),i.TgZ(23,"strong",6),i._uU(24,"Tip:"),i.qZA(),i._uU(25," Double-tap to zoom in on specific structures. "),i.qZA()()()(),i.TgZ(26,"app-view-tour-page")(27,"app-view-tour-slide",7),i._uU(28," Use the toolbar to navigate through the 3D experience, launch deeper exploration tools, and relaunch this tutorial. "),i.TgZ(29,"div",8)(30,"button",9),i.NdJ("click",function(){return o.handleStartClick()}),i.qZA()()()()()),2&e&&(i.xp6(2),i.Q6J("trigger","camera-rotate"),i.xp6(5),i.Q6J("trigger",o.triggers.CameraZoom),i.xp6(5),i.Q6J("trigger",o.triggers.CameraPan),i.xp6(5),i.Q6J("trigger",o.triggers.NodeSelection),i.xp6(5),i.Q6J("inline",!0))},dependencies:[Ag,Ug,nr,Fg,rx],changeDetection:0}),t})();var ax=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},cx=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function cA(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",3)(1,"h2",4),i._uU(2,"Getting Started"),i.qZA(),i.TgZ(3,"p",5),i._uU(4," Welcome! This tutorial will teach you how to navigate and explore in 3D using your "),i._UZ(5,"button",6),i.ALo(6,"async"),i.ALo(7,"async"),i.TgZ(8,"mat-menu",null,7)(10,"button",8),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectInputModeClick(s.inputModes.Mouse))}),i._uU(11),i.qZA(),i.TgZ(12,"button",8),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleSelectInputModeClick(s.inputModes.Touch))}),i._uU(13),i.qZA()()(),i.TgZ(14,"div",9)(15,"button",10),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleExitClick())}),i.qZA(),i.TgZ(16,"button",11),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleStartClick())}),i.qZA()()()}if(2&t){const e=i.MAs(9),o=i.oxw();i.xp6(5),i.Q6J("compact",!0)("label",o.inputModesText[i.lcZ(6,6,o.inputMode$)])("matMenuTriggerFor",e),i.uIk("aria-label",o.inputModesText[i.lcZ(7,8,o.inputMode$)]),i.xp6(6),i.hij(" ",o.inputModesText[o.inputModes.Mouse]," "),i.xp6(2),i.hij(" ",o.inputModesText[o.inputModes.Touch]," ")}}function lA(t,n){1&t&&i._UZ(0,"app-view-tour-mobile")}function pA(t,n){1&t&&i._UZ(0,"app-view-tour-desktop")}function dA(t,n){if(1&t&&(i.TgZ(0,"div",12),i.ALo(1,"async"),i.YNc(2,lA,1,0,"app-view-tour-mobile",13),i.YNc(3,pA,1,0,"app-view-tour-desktop",14),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngSwitch",i.lcZ(1,2,e.inputMode$)),i.xp6(2),i.Q6J("ngSwitchCase",e.inputModes.Touch)}}const uA={[Io.Mouse]:"mouse, trackpad, or keyboard",[Io.Touch]:"touchscreen"};class ir{constructor(n,e,o){this.store=n,this.viewService=e,this.storageService=o,this.inputModes=Io,this.inputModesText=uA,this.tourStarted=!1,this.tourEnded=!1,this.ngUnsubscribe=new X.x}ngOnInit(){this.initListeners(),this.store.dispatch(new T.TutorialSeen(!0))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.tutorial$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(({pageIndex:n,pageSize:e})=>{this.tourStarted=n>-1,this.tourEnded=n===e-1}),(0,Dt.R)(window,"keyup").pipe((0,$.h)(n=>"Escape"===n.key),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.exit()})}handleExitClick(){this.exit()}handleStartClick(){this.store.dispatch(new T.StartTutorial(!1))}handleSelectInputModeClick(n){this.store.dispatch(new T.SetInputMode(n))}exit(){this.viewService.toggleTutorial(!1)}}ir.\u0275fac=function(n){return new(n||ir)(i.Y36(l.yh),i.Y36(ut),i.Y36(dn))},ir.\u0275cmp=i.Xpm({type:ir,selectors:[["app-view-tour"]],decls:3,vars:7,consts:[["role","dialog","aria-label","Getting Started Tutorial","cdkTrapFocus","",1,"tour"],["class","tour__intro",4,"ngIf"],["class","tour__contents",3,"ngSwitch",4,"ngIf"],[1,"tour__intro"],[1,"tour__title"],[1,"tour__welcome"],["app-view-rounded-button","","buttonType","outline","icon","chevron-down","iconPlacement","right",1,"tour__input-selection","text-small",3,"compact","label","matMenuTriggerFor"],["inputSelectionMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"tour__footer"],["app-view-rounded-button","","buttonType","outline","label","No, Thanks.","data-test","tutorialExitButton",1,"mr-3","text-medium",3,"click"],["app-view-rounded-button","","buttonType","solid","label","Start Tutorial","aria-label","Start Tutorial","data-test","tutorialStartButton",1,"ml-3","text-medium",3,"click"],[1,"tour__contents",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,cA,17,10,"div",1),i.YNc(2,dA,4,4,"div",2),i.qZA()),2&n&&(i.ekj("tour--started",e.tourStarted)("tour--ended",e.tourEnded),i.Q6J("@refresh",void 0),i.xp6(1),i.Q6J("ngIf",!e.tourStarted),i.xp6(1),i.Q6J("ngIf",e.tourStarted))},dependencies:[f.O5,f.RF,f.n9,f.ED,jt.VK,jt.OP,jt.p6,no.mK,Ag,ra,aA,f.Ov],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.tour[_ngcontent-%COMP%]{color:#fff;position:absolute;inset:0;z-index:100;pointer-events:none;display:flex;flex-direction:column;align-items:center;overflow:auto}.tour__title[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.tour__welcome[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em;margin:16px auto 32px}.tour__intro[_ngcontent-%COMP%]{background:rgba(16,24,35,.9);border-radius:16px;margin:auto;padding:28px 32px;text-align:center;max-width:560px}.tour__input-selection[_ngcontent-%COMP%]{vertical-align:middle}.tour__header[_ngcontent-%COMP%]{flex:none;align-self:flex-end;justify-self:flex-start;margin:24px}.tour__contents[_ngcontent-%COMP%]{flex:auto;display:flex;flex-direction:column;justify-content:flex-end;width:100%}.tour__footer[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em;display:flex;flex-direction:row;align-items:center;justify-content:center}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:32px;letter-spacing:.8px;line-height:1.4em;cursor:pointer}.tour--ended[_ngcontent-%COMP%]   .tour__contents[_ngcontent-%COMP%]{justify-content:center}@media (max-width: 768px){.tour__intro[_ngcontent-%COMP%]{border-radius:12px;padding:20px 24px;margin:auto 12%;max-width:100%}.tour__intro__title[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.tour__intro__content[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;max-width:80%}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:14px;letter-spacing:.35px;line-height:1.4em}.tour__footer[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}}@media (max-width: 480px){.tour__intro[_ngcontent-%COMP%]{border-radius:8px;padding:16px 20px;margin:auto 10%}.tour__intro__title[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.tour__intro__content[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em;margin:12px auto 16px}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:12px;letter-spacing:.3px;line-height:1.4em}.tour__footer[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}}"],data:{animation:[(0,j.X$)("refresh",[(0,j.eR)(":enter",[(0,j._7)(ea.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),ax([(0,l.Ph)(O.getTutorial),cx("design:type",b.y)],ir.prototype,"tutorial$",void 0),ax([(0,l.Ph)(O.getInputMode),cx("design:type",b.y)],ir.prototype,"inputMode$",void 0);var Go=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Lt=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};let gn=class{constructor(n){this.store=n}static canUndo(n,e){return n.stacksForChapter[e.selectedChapter].undoStack.length>0}static canRedo(n,e){return n.stacksForChapter[e.selectedChapter].redoStack.length>0}static getUndoCount(n,e){return n.stacksForChapter[e.selectedChapter].undoStack.length||0}reset(n,e){n.patchState(H.Uy(n.getState(),o=>{o.stacksForChapter={}}))}undoAll(n,e){const o=n.getState();if(void 0===o.stacksForChapter[e.chapterId])return;const s=[...o.stacksForChapter[e.chapterId].undoStack].reverse(),r=s.flat().reduce((c,p)=>(void 0===c[p.patchAction]&&(c[p.patchAction]={action:p.patchAction,patches:[]}),c[p.patchAction].patches=[...c[p.patchAction].patches,...p.inverse],c),{});Object.keys(r).forEach(c=>{n.dispatch(new r[c].action(r[c].patches))});const a=H.Uy(o,c=>{c.stacksForChapter[e.chapterId].undoStack=[],c.stacksForChapter[e.chapterId].redoStack=s});n.patchState(a)}preserveState(n,e){const o=this.store.selectSnapshot(_.getSelectedChapterId),s=H.Uy(n.getState(),r=>{0===e.patches.length||e.patches.some(c=>0===c.forward.length)&&e.patches.some(c=>0===c.inverse.length)||(void 0===r.stacksForChapter[o]&&(r.stacksForChapter[o]={redoStack:[],undoStack:[]}),r.stacksForChapter[o].redoStack=[],r.stacksForChapter[o].undoStack.push(e.patches))});n.patchState(s)}redo(n,e){const o=n.getState(),s=(0,m.get)(o.stacksForChapter[e.chapterId],"redoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=H.Uy(o,c=>{c.stacksForChapter[e.chapterId].redoStack.pop(),c.stacksForChapter[e.chapterId].undoStack.push(r)});n.patchState(a),r.forEach(c=>{n.dispatch(new c.patchAction(c.forward))})}undo(n,e){const o=n.getState(),s=(0,m.get)(o.stacksForChapter[e.chapterId],"undoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=H.Uy(o,c=>{c.stacksForChapter[e.chapterId].undoStack.pop(),c.stacksForChapter[e.chapterId].redoStack.push(r)});n.patchState(a),r.forEach(c=>{n.dispatch(new c.patchAction(c.inverse))})}};gn.\u0275fac=function(n){return new(n||gn)(i.LFG(l.yh))},gn.\u0275prov=i.Yz7({token:gn,factory:gn.\u0275fac}),Go([(0,l.aU)(Nt.Reset),Lt("design:type",Function),Lt("design:paramtypes",[Object,Nt.Reset]),Lt("design:returntype",void 0)],gn.prototype,"reset",null),Go([(0,l.aU)(Nt.UndoAll),Lt("design:type",Function),Lt("design:paramtypes",[Object,Nt.UndoAll]),Lt("design:returntype",void 0)],gn.prototype,"undoAll",null),Go([(0,l.aU)(Nt.SavePatches),Lt("design:type",Function),Lt("design:paramtypes",[Object,Nt.SavePatches]),Lt("design:returntype",void 0)],gn.prototype,"preserveState",null),Go([(0,l.aU)(Nt.Redo),Lt("design:type",Function),Lt("design:paramtypes",[Object,Nt.Redo]),Lt("design:returntype",void 0)],gn.prototype,"redo",null),Go([(0,l.aU)(Nt.Undo),Lt("design:type",Function),Lt("design:paramtypes",[Object,Nt.Undo]),Lt("design:returntype",void 0)],gn.prototype,"undo",null),Go([(0,l.Qf)([_]),Lt("design:type",Function),Lt("design:paramtypes",[Object,Ge]),Lt("design:returntype",Boolean)],gn,"canUndo",null),Go([(0,l.Qf)([_]),Lt("design:type",Function),Lt("design:paramtypes",[Object,Ge]),Lt("design:returntype",Boolean)],gn,"canRedo",null),Go([(0,l.Qf)([_]),Lt("design:type",Function),Lt("design:paramtypes",[Object,Ge]),Lt("design:returntype",Number)],gn,"getUndoCount",null),gn=Go([(0,l.ZM)({name:"undo",defaults:{stacksForChapter:{}}}),Lt("design:paramtypes",[l.yh])],gn);var Rg=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ng=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function hA(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",1)(1,"app-pillbox",2)(2,"button",3),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleUndoClick())}),i.ALo(3,"async"),i.ALo(4,"async"),i.qZA(),i.TgZ(5,"button",4),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleRedoClick())}),i.ALo(6,"async"),i.ALo(7,"async"),i.qZA(),i.TgZ(8,"button",5),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleResetClick())}),i.ALo(9,"async"),i.ALo(10,"async"),i.TgZ(11,"span",6),i._uU(12,"Reset"),i.qZA()()()()}if(2&t){const e=i.oxw();i.Q6J("@show",void 0),i.xp6(2),i.Q6J("disabled",!1===i.lcZ(4,9,e.canUndo$)),i.uIk("aria-disabled",!1===i.lcZ(3,7,e.canUndo$)),i.xp6(3),i.Q6J("disabled",!1===i.lcZ(7,13,e.canRedo$)),i.uIk("aria-disabled",!1===i.lcZ(6,11,e.canRedo$)),i.xp6(3),i.Q6J("disabled",!1===i.lcZ(10,17,e.canUndo$)),i.uIk("aria-disabled",!1===i.lcZ(9,15,e.canUndo$))}}class hs{constructor(n){this.viewService=n}ngOnInit(){}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}}hs.\u0275fac=function(n){return new(n||hs)(i.Y36(ut))},hs.\u0275cmp=i.Xpm({type:hs,selectors:[["app-view-undo"]],decls:2,vars:3,consts:[["class","view-undo",4,"ngIf"],[1,"view-undo"],["padding","dense"],["app-pin-button","","data-test","undo-btn","buttonType","ghost","icon","undo","aria-label","Undo","matTooltip","Undo",1,"mr-2",3,"disabled","click"],["buttonType","ghost","app-pin-button","","data-test","redo-btn","aria-label","Redo","matTooltip","Redo","icon","redo",1,"mr-2",3,"disabled","click"],["app-pin-button","","buttonShape","rounded","buttonType","ghost","data-test","reset-btn",3,"disabled","click"],[1,"ph-4","text-bold"]],template:function(n,e){1&n&&(i.YNc(0,hA,13,19,"div",0),i.ALo(1,"async")),2&n&&i.Q6J("ngIf",i.lcZ(1,1,e.canUndo$))},dependencies:[f.O5,Gt.gM,In,Wa,f.Ov],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;width:100%;padding:16px 0;pointer-events:none}@media (max-width: 600px){[_nghost-%COMP%]{justify-content:right;padding-right:16px}}"],data:{animation:[(0,j.X$)("show",[(0,j.eR)(":enter",(0,j.vP)([(0,j.oB)({transform:"translateY(-100%)",opacity:0}),(0,j.jt)("150ms ease-in-out",(0,j.oB)({transform:"translateY(0%)",opacity:1}))]))])]},changeDetection:0}),Rg([(0,l.Ph)(gn.canUndo),Ng("design:type",b.y)],hs.prototype,"canUndo$",void 0),Rg([(0,l.Ph)(gn.canRedo),Ng("design:type",b.y)],hs.prototype,"canRedo$",void 0),Rg([(0,l.Ph)(gn.getUndoCount),Ng("design:type",b.y)],hs.prototype,"undoCount$",void 0);var Jt=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ht=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const mA=["engineContainer"],fA=["viewContainer"],bA=["view"],yA=["viewCameraBar"],_A=["viewLogo"],xA=["viewSceneBase"],vA=["viewToolbar"],CA=["drawer"];function wA(t,n){1&t&&i._UZ(0,"app-view-column-container")}const SA=function(t,n){return{"view-page__title-only--poc":t,"view-page__title-only--poc-expanded":n}};function PA(t,n){if(1&t&&(i.TgZ(0,"div",26),i._UZ(1,"app-view-title",27),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngClass",i.WLB(1,SA,e.pocToolbarVisible,e.pocToolbarVisible&&e.pocExpanded))}}function kA(t,n){if(1&t&&(i.TgZ(0,"div",28),i._UZ(1,"app-engine-audio",29),i.ALo(2,"async"),i.ALo(3,"async"),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("type",i.lcZ(2,2,e.audioType$))("playing",i.lcZ(3,4,e.audioPlaying$))}}const OA=function(t){return{"view-page__undo--offset":t}};function TA(t,n){if(1&t&&(i.TgZ(0,"div",30),i._UZ(1,"app-view-undo"),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngClass",i.VKq(1,OA,(e.searchVisible||e.nodeInfoVisible)&&!e.columnVisible))}}function MA(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"app-view-poc-toolbar-primary",33),i.NdJ("modeChanged",function(s){i.CHM(e);const r=i.oxw(2);return i.KtG(r.handlePocMode(s))}),i.qZA()}}const IA=function(t){return{"view-page__poc-toolbar--offset":t}};function zA(t,n){if(1&t&&(i.TgZ(0,"div",31),i.YNc(1,MA,1,0,"app-view-poc-toolbar-primary",32),i.ALo(2,"async"),i.qZA()),2&t){const e=i.oxw();i.Q6J("ngClass",i.VKq(4,IA,(e.searchVisible||e.nodeInfoVisible)&&!e.columnVisible)),i.xp6(1),i.Q6J("ngIf",i.lcZ(2,2,e.viewWindow$)!==e.viewWindow.Whiteboard)}}function AA(t,n){1&t&&i._UZ(0,"app-view-toolbar",34)}function LA(t,n){1&t&&(i.TgZ(0,"div",35),i._UZ(1,"app-view-menu",36),i.qZA())}function FA(t,n){if(1&t&&i._UZ(0,"app-engine-camera-bar",37),2&t){const e=i.oxw();i.Q6J("showNav",e.cameraVisible)}}function UA(t,n){if(1&t&&(i.TgZ(0,"div",38),i._UZ(1,"app-view-logo",39),i.ALo(2,"async"),i.ALo(3,"async"),i.qZA()),2&t){const e=i.oxw();let o;i.xp6(1),i.Q6J("logoColor",e.isBackgroundLight?"color":"white")("logoSize",i.lcZ(2,3,e.breakpoint$)>e.breakpoint.Small?"full":"small")("contentTitle",null==(o=i.lcZ(3,5,e.story$))?null:o.displayName)}}function RA(t,n){if(1&t){const e=i.EpF();i.ynx(0),i.TgZ(1,"app-view-drawer",40,41),i.NdJ("offsetYChange",function(s){i.CHM(e);const r=i.oxw();return i.KtG(r.handleDrawerOffsetChange(s))}),i.qZA(),i.BQk()}}function NA(t,n){1&t&&i._UZ(0,"div",42)}function EA(t,n){if(1&t&&i._UZ(0,"app-view-ondemand",43),2&t){const e=i.oxw();i.Q6J("contentId",e.contentId)("contentType",e.contentType)}}function DA(t,n){if(1&t&&(i._UZ(0,"app-view-progress",44),i.ALo(1,"async")),2&t){const e=i.oxw();i.Q6J("show",i.lcZ(1,2,e.viewWindow$)===e.viewWindow.Loader)("percent",e.chapterLoadProgress)}}function jA(t,n){if(1&t&&i._UZ(0,"app-play-loader",46),2&t){const e=i.oxw(2);i.Q6J("percent",e.chapterLoadProgress)}}function QA(t,n){1&t&&i._UZ(0,"app-button-loader")}function ZA(t,n){1&t&&i._UZ(0,"app-hand-loader")}function BA(t,n){if(1&t&&(i.TgZ(0,"app-view-loader"),i.YNc(1,jA,1,1,"app-play-loader",45),i.ALo(2,"async"),i.YNc(3,QA,1,0,"app-button-loader",4),i.ALo(4,"async"),i.YNc(5,ZA,1,0,"app-hand-loader",4),i.ALo(6,"async"),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf","play"===i.lcZ(2,3,e.interactType$)),i.xp6(2),i.Q6J("ngIf","button"===i.lcZ(4,5,e.interactType$)),i.xp6(2),i.Q6J("ngIf","hand"===i.lcZ(6,7,e.interactType$))}}function VA(t,n){1&t&&i._UZ(0,"app-view-tour")}function qA(t,n){1&t&&i._UZ(0,"app-view-whiteboard")}function $A(t,n){1&t&&i._UZ(0,"app-view-print")}function GA(t,n){1&t&&i._UZ(0,"app-view-content-warning")}const JA=function(t,n,e){return{"view-page--column-in":t,"view-page--column-out":n,"view-page--drawer-push":e}};class Ot{constructor(n,e,o,s,r,a,c,p,d,u,g,h,y,k,B){this.activatedRoute=n,this.renderer=e,this.changeDetectorRef=o,this.store=s,this.actions=r,this.liveAnnouncer=a,this.viewService=c,this.quizService=p,this.layoutService=d,this.animationService=u,this.engineService=g,this.pendoService=h,this.mediaService=y,this.engineRendererService=k,this.title=B,this.application=mt,this.nativePlatform=Br,this.breakpoint=_t,this.viewLayoutStatus=Pe,this.viewMode=Ui,this.viewUI=x,this.viewWindow=pt,this.columnLayoutStatus=Pe.Hide,this.drawerExpandable=!0,this.drawerOpen=!1,this.drawerY=0,this.loadLabel="",this.chapterLoadProgress=0,this.chaptersLoaded=0,this.isBackgroundLight=!0,this.selectedChapterLoading=!1,this.viewToolsMode=_n,this.audioVisible=!1,this.cameraVisible=!1,this.columnVisible=!1,this.drawerVisible=!1,this.logoVisible=!1,this.menuVisible=!1,this.nodeInfoVisible=!1,this.searchVisible=!1,this.titleOnlyVisible=!1,this.pocToolbarVisible=!1,this.toolbarVisible=!1,this.undoVisible=!1,this.pocExpanded=!1,this.ngUnsubscribe=new X.x,this.audioListening=new X.x}onClick(n){this.handleFirstClickTracking(n)}ngOnInit(){this.resetScene();const n=this.viewService.normalizeQueryParams(this.activatedRoute.snapshot.queryParams);this.contentId=n.id,this.contentType=n.type,this.contentLang=n.lang}ngAfterViewInit(){this.viewService.setViewLanguage(this.contentLang),this.loadStory(),this.store.dispatch(new Rd({tag:!0,pin:!1})),this.store.dispatch(new Yp(!0));const n=this.store.selectSnapshot(O.getUI).loader.template;this.store.dispatch(new $p(n===Ai.Bar)),n!==Ai.None&&this.store.dispatch(new T.ToggleWindow(pt.Loader,!0)),this.checkCapabilities(),this.initSizeObservers(),this.initHeaderObserver(),this.initLayoutObserver(),this.initBreakpointObservers(),this.initKeyboardObserver(),this.initLoadProgressObserver(),this.initWindowObserver(),this.initBackgroundColorObserver(),this.initResponsiveLabels(),this.initNodeObserver(),this.initChapterObserver(),this.initAudioObserver(),this.initAccessibility(),this.positionRelativeElements(this.drawerY),this.storyId$.pipe((0,$.h)(o=>!(0,m.isNil)(o)&&"preview"!==o),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>this.initPendoEvents())}ngOnDestroy(){this.store.dispatch(new yc(!1)),this.store.dispatch(new al),this.store.dispatch(new Oo),Rn.isFullscreen()&&Rn.exitFullscreen(),this.quizService.exitQuiz(),this.unbindKeyboard(),this.store.dispatch(new ws(!1)),this.mediaService.stopAllAudio(),this.mediaService.removeAllAudioPlayer(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}loadStory(){this.onDemand$.pipe((0,$.h)(n=>!n),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.initStory(this.contentId,this.contentType,this.contentLang)})}checkCapabilities(){const n=this.renderer.listen("window","mouseover",()=>{n(),this.store.dispatch(new T.SetCanHover(!0))}),e="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;this.store.dispatch(new T.SetCanTouch(e)),this.store.dispatch(new T.SetCanFullscreen(Rn.canFullscreen())),this.store.dispatch(new T.SetInputMode(e?Io.Touch:Io.Mouse))}initBreakpointObservers(){this.breakpoint$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.handleResize()})}initResponsiveLabels(){const n=(0,Dt.R)(window,"resize").pipe((0,cn.b)(100)),e=this.store.select(O.getLabelsBreakpoint),o=this.store.select(te.getSelectedLabel),s=this.store.select(te.getLabelsCollapsed);o.pipe((0,$.h)(()=>this.store.selectSnapshot(te.getLabelsCollapsed)),(0,w.R)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(!!r)}),s.pipe((0,$.h)(()=>!!this.store.selectSnapshot(te.getSelectedLabel)),(0,w.R)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(r)}),(0,bt.a)(n,e).pipe((0,$.h)(([,r])=>!(0,m.isNil)(r)),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.checkLabelsCollapsed()}),this.checkLabelsCollapsed()}initSizeObservers(){const n=jw({strategy:"scroll"});(0,Dt.R)(window,"resize").pipe((0,cn.b)(10),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.updateViewHeight(),this.refreshLayout()}),new b.y(s=>{n.listenTo(this.engineContainer.nativeElement,()=>{s.next()})}).pipe((0,cn.b)(10)).subscribe(()=>{this.resizeEngineContainer()})}initHeaderObserver(){this.store.select(Et.getSiteHeader).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.updateViewHeight()})}initLayoutObserver(){this.layout$.pipe((0,$.h)(n=>null!=n),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.refreshLayout()})}initKeyboardObserver(){this.inputEnabled$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{n?this.bindKeyboard():this.unbindKeyboard()})}initNodeObserver(){this.actions.pipe((0,l.xt)(vc),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.viewService.delegateNodeClick(n.node,n.event)}),this.store.select(Se.getSelectedNode).pipe((0,Ao.G)(),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e])=>{const o=(0,m.get)(n,"objectId",void 0),s=(0,m.get)(e,"objectId",void 0);(void 0===e||o!==s)&&this.viewService.toggleNodeInfo(!1)})}initChapterObserver(){this.store.select(_.getSelectedChapterId).pipe((0,$.h)(n=>!!n),(0,J.U)(()=>this.store.selectSnapshot(_.getSelectedChapter)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.viewService.initChapter(n),this.store.dispatch(new Oo),this.setPageTitle(n),this.refreshLayout()})}initLoadProgressObserver(){this.chapterLoadProgress=0,this.store.select(yn.getChapterLoadProgress).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{const e=100*n,o=this.store.selectSnapshot(_.getSelectedChapterId),s=this.store.selectSnapshot(we.getLoadingChapter);!(0,m.isNil)(s)&&o===s.chapterId&&(this.store.dispatch(new T.ToggleWindow(pt.Loader,!0)),this.chapterLoadProgress=e,this.changeDetectorRef.markForCheck())}),this.store.select(yn.getStoryLoadProgress).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.engineService.fireEvent(pe.HumanProgress,{progress:n})}),this.actions.pipe((0,l.cx)(pr),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.chapterLoadProgress=100,this.changeDetectorRef.markForCheck(),this.store.dispatch(new T.ToggleWindow(pt.Loader,!1));const n=this.store.selectSnapshot(we.getLoadChaptersRemaining);console.log("chapters remaining ",n.length),0==n.length&&(console.log("fire scene,loaded"),this.engineService.fireEvent(pe.SceneLoaded))})}initWindowObserver(){this.viewWindow$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.viewService.resetLayout(),n===pt.Tutorial?(this.viewService.resetChapter(),this.viewService.toggleLabels(!1)):this.viewService.toggleLabels(!0)})}initBackgroundColorObserver(){this.background$.pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.isBackgroundLight=vf(n),this.changeDetectorRef.markForCheck()})}initAudioObserver(){const n=(0,Li.T)(this.ngUnsubscribe,this.audioListening),e=this.viewWindow$.pipe((0,J.U)(o=>o===pt.Tutorial||o===pt.Interact),(0,$.h)(o=>o),(0,yt.q)(1));(0,bt.a)(this.viewWindow$,e,this.audio$).pipe((0,$.h)(([o])=>(0,m.isNil)(o)),(0,w.R)(n)).subscribe(([,o,s])=>{o?(0,m.isNil)(s)||this.playAudio():this.stopAudioListening()}),this.store.select(O.getUI).pipe((0,J.U)(()=>this.layoutService.getAudioPlaybackType()),(0,$n.x)(),(0,w.R)(this.ngUnsubscribe)).subscribe(o=>{this.store.dispatch(new Hp(o)),this.changeDetectorRef.markForCheck()})}initPendoEvents(){const n={totalQuestions:0};this.store.select(U.getQuestionTotal).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{n.totalQuestions=e}),this.store.select(U.getQuizModeActive).pipe((0,$.h)(()=>this.store.selectSnapshot(U.getQuestionTotal)>0),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{e&&this.pendoService.track("Quiz - Entered",n)}),this.actions.pipe((0,l.xt)(ee.SubmitQuestionAnswer),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(U.getActiveQuestionIndex),o=this.store.selectSnapshot(U.getQuestionsRemaining);0===e&&this.pendoService.track("Quiz - First Question Answered",n),0===o&&this.pendoService.track("Quiz - Completed",n)}),this.store.select(_.getSelectedChapterModelReady).pipe((0,$.h)(e=>e),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{const e=this.store.selectSnapshot(we.getStoryId),o=this.store.selectSnapshot(we.getStory);this.pendoService.trackOncePerPage("View - Loaded",{id:e,chapters:o.chapters.length,tour:o.tags.includes("tour"),animated:o.tags.includes("animated"),quiz:this.store.selectSnapshot(U.hasQuiz),edit:!1})})}initAccessibility(){this.actions.pipe((0,l.xt)(rn)).subscribe(n=>{this.liveAnnouncer.announce("Object "+(n.show?"shown":"hidden"))})}handleFirstClickTracking(n){n.composedPath().some(r=>"APP-SITE-HEADER"===r.nodeName)||1===this.store.selectSnapshot(yn.getStoryLoadProgress)&&this.pendoService.trackOncePerPage("First Click")}stopAudioListening(){this.audioListening.next(),this.audioListening.complete()}playAudio(){this.store.dispatch(new ws(!0)),this.stopAudioListening()}handleColumnToggle(){this.viewService.toggleColumn(),this.changeDetectorRef.markForCheck()}handleDrawerOffsetChange(n){this.drawerY=n,this.drawerOpen=-64!==n,this.positionRelativeElements(this.drawerY)}handlePocMode(n){this.pocExpanded=null!==n,this.changeDetectorRef.markForCheck()}checkLabelsCollapsed(){const n=this.store.selectSnapshot(Pt.getBreakpoint),e=this.store.selectSnapshot(O.getLabelsBreakpoint),o=this.isLabelBreaking(e);this.store.dispatch(new Ud(o,n>=_t.Large?ko.Toggle:ko.None))}isLabelBreaking(n){return window.innerWidth<n}bindKeyboard(){Gn.bind("1",()=>this.viewService.selectTool(Ve.Select)),Gn.bind("2",()=>this.viewService.selectTool(Ve.Hide)),Gn.bind("3",()=>this.viewService.selectTool(Ve.Fade)),Gn.bind(["command+,","ctrl+,"],n=>{n.preventDefault(),this.store.selectSnapshot(Pt.getBreakpoint)>_t.Medium?this.viewService.toggleColumn():this.drawer.toggleDrawer(),this.changeDetectorRef.markForCheck()}),Gn.bind(["command+enter","ctrl+enter","command+p"],n=>{n.preventDefault(),Rn.toggleFullscreen()}),Gn.bind("meta+z",n=>{n.preventDefault(),this.viewService.undo()}),Gn.bind(["meta+y","meta+shift+z"],n=>{n.preventDefault(),this.viewService.redo()}),Gn.bind([".","pagedown"],()=>this.viewService.nextChapter("Keyboard")),Gn.bind([",","pageup"],()=>this.viewService.previousChapter("Keyboard")),Gn.bind(["del","backspace"],n=>{n.preventDefault(),this.viewService.hideSelectedStructures()}),Gn.bind("R",n=>{n.preventDefault(),this.viewService.resetChapter()}),Gn.bind("/",()=>this.viewService.toggleSearch()),Gn.bind("?",()=>this.viewService.toggleHelp()),Gn.bind("space",n=>{n.preventDefault(),this.viewService.toggleAnimation()})}unbindKeyboard(){Gn.reset()}resizeEngineContainer(){const{top:n,left:e,width:o,height:s}=this.engineContainer.nativeElement.getBoundingClientRect(),r=new lm(e,n,o,s,Ss.Shown);this.store.dispatch(new Xp(r))}updateViewHeight(){const n=se.application!==mt.Viewer,o=ou(this.store.selectSnapshot(Et.getSiteHeader),n);this.view.nativeElement.style.setProperty("--vh",`${o}px`)}handleResize(){this.viewService.resetLayout()}resetScene(){this.store.dispatch(new yc(!0)),this.store.dispatch(new dr(!1)),this.store.dispatch(new Cs(Ve.Select)),this.store.dispatch(new al),this.store.dispatch(new dd(!1)),this.engineService.getEvent(pe.AssetsLoadProgress).pipe((0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new dr(!0))})}refreshLayout(){const n=this.store.selectSnapshot(O.getUI);this.columnLayoutStatus=n.column.status,this.audioVisible=this.layoutService.isVisible(x.Audio),this.cameraVisible=this.layoutService.isVisible(x.Camera),this.columnVisible=this.layoutService.isVisible(x.Column),this.drawerVisible=this.layoutService.isVisible(x.Drawer),this.logoVisible=this.layoutService.isVisible(x.Logo),this.menuVisible=this.layoutService.isVisible(x.Menu),this.nodeInfoVisible=this.layoutService.isVisible(x.NodeInfo),this.searchVisible=this.layoutService.isVisible(x.Search),this.titleOnlyVisible=this.layoutService.isVisible(x.TitleOnly),this.pocToolbarVisible=this.layoutService.isVisible(x.PocToolbar),this.toolbarVisible=this.layoutService.isVisible(x.Toolbar),this.undoVisible=this.layoutService.isVisible(x.Undo),this.updateViewHeight(),this.resizeEngineContainer(),this.store.dispatch(new Fd(!1!==n.anatomyLabels.enable,!1!==n.nodeInfo.enable,!0)),this.store.dispatch(new Wo(!1!==n.labels.enable&&!1!==n.labels.shown)),setTimeout(()=>{this.drawer?this.positionRelativeElements(this.drawerY):this.positionRelativeElements(),this.changeDetectorRef.markForCheck()})}positionRelativeElements(n=0){this.store.selectSnapshot(Pt.getBreakpoint),null!=this.viewCameraBar&&this.cameraVisible&&this.renderer.setStyle(this.viewCameraBar.nativeElement,"transform",`translate3d(-4px, ${this.menuVisible?-64:0}px, 0)`),this.renderer.setStyle(this.viewToolbar.nativeElement,"transform","translate3d(-8px, 0, 0)"),this.renderer.setStyle(this.viewSceneBase.nativeElement,"transform","translate3d(0, -16px, 0)"),this.renderer.setStyle(this.view.nativeElement,"padding-bottom",-n+"px")}setPageTitle(n){const e=(0,m.get)(n,"displayName");this.title.setTitle((e?`${e} | `:"")+"BioDigital Human Platform")}isVisible(n){return this.layoutService.isVisible(n)}isEnabled(n){return this.layoutService.isUIEnabled(n)}}Ot.\u0275fac=function(n){return new(n||Ot)(i.Y36(We.gz),i.Y36(i.Qsj),i.Y36(i.sBO),i.Y36(l.yh),i.Y36(l.eX),i.Y36(no.Kd),i.Y36(ut),i.Y36(Ns),i.Y36(ri),i.Y36(Un),i.Y36(et),i.Y36(Ln),i.Y36(Dl),i.Y36(Po),i.Y36(ys.Dx))},Ot.\u0275cmp=i.Xpm({type:Ot,selectors:[["app-view-page"]],viewQuery:function(n,e){if(1&n&&(i.Gf(mA,7),i.Gf(fA,7),i.Gf(bA,7),i.Gf(yA,5),i.Gf(_A,5),i.Gf(xA,7),i.Gf(vA,5),i.Gf(CA,5,xn)),2&n){let o;i.iGM(o=i.CRH())&&(e.engineContainer=o.first),i.iGM(o=i.CRH())&&(e.viewContainer=o.first),i.iGM(o=i.CRH())&&(e.view=o.first),i.iGM(o=i.CRH())&&(e.viewCameraBar=o.first),i.iGM(o=i.CRH())&&(e.viewLogo=o.first),i.iGM(o=i.CRH())&&(e.viewSceneBase=o.first),i.iGM(o=i.CRH())&&(e.viewToolbar=o.first),i.iGM(o=i.CRH())&&(e.drawer=o.first)}},hostBindings:function(n,e){1&n&&i.NdJ("click",function(s){return e.onClick(s)},!1,i.evT)},decls:43,vars:41,consts:[["role","main"],["viewContainer",""],[1,"view-page",3,"ngClass"],["view",""],[4,"ngIf"],["class","view-page__title-only",3,"ngClass",4,"ngIf"],[1,"view-page__engine"],["engineContainer",""],["class","view-page__audio",4,"ngIf"],["class","view-page__undo",3,"ngClass",4,"ngIf"],["class","view-page__poc-toolbar",3,"ngClass",4,"ngIf"],[1,"view-page__column-toggle"],[1,"view-page__scene-base"],["viewSceneBase",""],[1,"view-page__toolbar"],["viewToolbar",""],["position","right",4,"ngIf"],["class","view-page__menu",4,"ngIf"],[1,"view-page__camera-bar"],["viewCameraBar",""],[3,"showNav",4,"ngIf"],["class","view-page__logo",4,"ngIf"],["class","view-block-input",4,"ngIf"],[3,"contentId","contentType",4,"ngIf"],[3,"show","percent",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],[1,"view-page__title-only",3,"ngClass"],["layout","column"],[1,"view-page__audio"],[3,"type","playing"],[1,"view-page__undo",3,"ngClass"],[1,"view-page__poc-toolbar",3,"ngClass"],[3,"modeChanged",4,"ngIf"],[3,"modeChanged"],["position","right"],[1,"view-page__menu"],[1,"ml-4"],[3,"showNav"],[1,"view-page__logo"],[3,"logoColor","logoSize","contentTitle"],[3,"offsetYChange"],["drawer",""],[1,"view-block-input"],[3,"contentId","contentType"],[3,"show","percent"],[3,"percent",4,"ngIf"],[3,"percent"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0,1)(2,"div",2,3),i.YNc(4,wA,1,0,"app-view-column-container",4),i._UZ(5,"app-view-menu-column"),i.YNc(6,PA,2,4,"div",5),i.ALo(7,"async"),i.TgZ(8,"div",6,7),i._UZ(10,"app-engine"),i.YNc(11,kA,4,6,"div",8),i.YNc(12,TA,2,3,"div",9),i.YNc(13,zA,3,6,"div",10),i.TgZ(14,"div",11),i._UZ(15,"app-view-column-toggle"),i.qZA(),i.TgZ(16,"div",12,13)(18,"div",14,15),i.YNc(20,AA,1,0,"app-view-toolbar",16),i.qZA(),i.YNc(21,LA,2,0,"div",17),i.TgZ(22,"div",18,19),i.YNc(24,FA,1,1,"app-engine-camera-bar",20),i.qZA(),i.YNc(25,UA,4,7,"div",21),i.qZA(),i.YNc(26,RA,3,0,"ng-container",4),i.qZA()()(),i.YNc(27,NA,1,0,"div",22),i.ALo(28,"async"),i.YNc(29,EA,1,2,"app-view-ondemand",23),i.ALo(30,"async"),i.YNc(31,DA,2,4,"app-view-progress",24),i.ALo(32,"async"),i.YNc(33,BA,7,9,"app-view-loader",4),i.ALo(34,"async"),i.YNc(35,VA,1,0,"app-view-tour",4),i.ALo(36,"async"),i.YNc(37,qA,1,0,"app-view-whiteboard",4),i.ALo(38,"async"),i.YNc(39,$A,1,0,"app-view-print",4),i.ALo(40,"async"),i.YNc(41,GA,1,0,"app-view-content-warning",25),i._UZ(42,"app-view-iphone12-warning")),2&n){let o,s;i.xp6(2),i.Q6J("ngClass",i.kEZ(37,JA,e.columnVisible,!e.columnVisible,e.drawerVisible)),i.xp6(2),i.Q6J("ngIf",e.columnVisible||e.searchVisible||e.nodeInfoVisible),i.xp6(2),i.Q6J("ngIf",e.titleOnlyVisible&&(null==(o=i.lcZ(7,21,e.chapter$))?null:o.displayName)),i.xp6(5),i.Q6J("ngIf",e.audioVisible),i.xp6(1),i.Q6J("ngIf",e.undoVisible),i.xp6(1),i.Q6J("ngIf",e.pocToolbarVisible),i.xp6(7),i.Q6J("ngIf",e.toolbarVisible),i.xp6(1),i.Q6J("ngIf",e.menuVisible),i.xp6(3),i.Q6J("ngIf",e.cameraVisible),i.xp6(1),i.Q6J("ngIf",e.logoVisible),i.xp6(1),i.Q6J("ngIf",e.drawerVisible),i.xp6(1),i.Q6J("ngIf",!i.lcZ(28,23,e.inputEnabled$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(30,25,e.viewWindow$)===e.viewWindow.OnDemand),i.xp6(2),i.Q6J("ngIf","circle"===(null==(s=i.lcZ(32,27,e.layout$))?null:s.loader.template)),i.xp6(2),i.Q6J("ngIf",i.lcZ(34,29,e.viewWindow$)===e.viewWindow.Interact),i.xp6(2),i.Q6J("ngIf",i.lcZ(36,31,e.viewWindow$)===e.viewWindow.Tutorial),i.xp6(2),i.Q6J("ngIf",i.lcZ(38,33,e.viewWindow$)===e.viewWindow.Whiteboard),i.xp6(2),i.Q6J("ngIf",i.lcZ(40,35,e.usePrintImage$)),i.xp6(2),i.Q6J("appFlagApplication",e.application.All)("appFlagApplicationMode","include")("appFlagApplicationNative",e.nativePlatform.All)}},dependencies:[f.mk,f.O5,vt,Vs,jT,ql,qs,C_,w_,S_,qi,us,Ys,ta,xn,VI,GI,Qo,Zo,Si,na,ia,U3,vi,Tz,ir,hs,f.Ov],styles:[".view-page{border:none;width:100vw;height:100vh;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:hidden;transition:padding-left .25s,padding-bottom .3s}.view-page--column-in{padding-left:320px}.view-page--column-out{padding-left:0}.view-page--drawer-push{padding-bottom:64px}.view-page__audio{position:absolute;z-index:10;top:12px;left:12px}.view-page__column{height:100%}.view-page__poc-toolbar{position:absolute;left:16px;top:16px;z-index:10;transition:left .3s ease-in-out}.view-page__poc-toolbar--offset{left:336px}.view-page__column-toggle{position:absolute;top:50%;margin-top:-18px;left:0;z-index:10}.view-page__engine{width:100%;height:100%;position:relative}.view-page__menu{position:absolute;right:20px;bottom:0;z-index:30}.view-page__camera-bar{position:absolute;bottom:0;right:16px;z-index:20}.view-page__logo{display:inline-block;position:absolute;left:16px;bottom:0;z-index:10}.view-page__media-bar{position:absolute;left:50%;margin-left:-100px;width:200px;bottom:0;z-index:10;justify-content:center}.view-page__media-bar:not([hidden]){display:flex}.view-page__notifications{position:absolute;top:12px;right:12px;z-index:20}.view-page__title-only{position:absolute;top:8px;left:8px;max-width:304px;z-index:10;padding:12px;border-radius:4px;background:rgba(255,255,255,.8);box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d;color:#131c2a}.view-page__title-only--poc{top:16px;left:88px}.view-page__title-only--poc-expanded{top:16px;left:144px}.view-page__scene-base{position:absolute;left:0;bottom:0;right:0;z-index:10;transition:transform .3s}.view-page__toolbar{position:absolute;display:inline-block;z-index:25;bottom:0;right:76px;transition:transform .25s}.view-page__undo{position:absolute;display:flex;justify-content:center;pointer-events:none;left:0;z-index:10;width:100%;padding-left:0;transition:padding-left .3s}.view-page__undo--offset{padding-left:320px}.view-block-input{position:fixed;inset:0;z-index:10000}@media (max-width: 959px){.view-page__poc-toolbar{left:16px}}\n"],encapsulation:2,changeDetection:0}),Jt([(0,l.Ph)(we.getStory),Ht("design:type",b.y)],Ot.prototype,"story$",void 0),Jt([(0,l.Ph)(we.getStoryId),Ht("design:type",b.y)],Ot.prototype,"storyId$",void 0),Jt([(0,l.Ph)(O.getUI),Ht("design:type",b.y)],Ot.prototype,"layout$",void 0),Jt([(0,l.Ph)(O.getInputEnabled),Ht("design:type",b.y)],Ot.prototype,"inputEnabled$",void 0),Jt([(0,l.Ph)(O.getFullscreenActive),Ht("design:type",b.y)],Ot.prototype,"fullscreenActive$",void 0),Jt([(0,l.Ph)(O.getDrawerCoversContent),Ht("design:type",b.y)],Ot.prototype,"drawerCoversContent$",void 0),Jt([(0,l.Ph)(O.getInteractType),Ht("design:type",b.y)],Ot.prototype,"interactType$",void 0),Jt([(0,l.Ph)(O.getOnDemand),Ht("design:type",b.y)],Ot.prototype,"onDemand$",void 0),Jt([(0,l.Ph)(O.getShowHelpTab),Ht("design:type",b.y)],Ot.prototype,"showHelpTab$",void 0),Jt([(0,l.Ph)(O.getUsePrintImage),Ht("design:type",b.y)],Ot.prototype,"usePrintImage$",void 0),Jt([(0,l.Ph)(O.getOpenWindow),Ht("design:type",b.y)],Ot.prototype,"viewWindow$",void 0),Jt([(0,l.Ph)(O.getTutorialSeen),Ht("design:type",b.y)],Ot.prototype,"tutorialSeen$",void 0),Jt([(0,l.Ph)(yn.getStoryLoadProgress),Ht("design:type",b.y)],Ot.prototype,"storyLoadProgress$",void 0),Jt([(0,l.Ph)(Pt.getBreakpoint),Ht("design:type",b.y)],Ot.prototype,"breakpoint$",void 0),Jt([(0,l.Ph)(_.getSelectedChapter),Ht("design:type",b.y)],Ot.prototype,"chapter$",void 0),Jt([(0,l.Ph)(_.getSelectedChapterReadyState),Ht("design:type",b.y)],Ot.prototype,"selectedChapterReady$",void 0),Jt([(0,l.Ph)(_.getChaptersLoaded),Ht("design:type",b.y)],Ot.prototype,"chaptersLoaded$",void 0),Jt([(0,l.Ph)(_.getSelectedChapterBackground),Ht("design:type",b.y)],Ot.prototype,"background$",void 0),Jt([(0,l.Ph)(_.getSelectedChapterAudio),Ht("design:type",b.y)],Ot.prototype,"audio$",void 0),Jt([(0,l.Ph)(M.getPlayAudio),Ht("design:type",b.y)],Ot.prototype,"audioPlaying$",void 0),Jt([(0,l.Ph)(M.getPlayAudioType),Ht("design:type",b.y)],Ot.prototype,"audioType$",void 0),Jt([(0,l.Ph)(te.getSelectedLabel),Ht("design:type",b.y)],Ot.prototype,"selectedLabel$",void 0);let Eg=(()=>{class t{constructor(){}resolve(e){const o={...e.queryParams};return function tw(t){const n=function HC(t){const n=Object.keys(t),e=n.filter(o=>sb.includes(o));if(e.length>0){const o=[`The following URL parameters have been deprecated: "${e.join('", "')}"`,"Please contact support@biodigital.com for more information."];console.warn(o.join("\n"))}return n.reduce((o,s)=>(sb.includes(s)&&delete o[s],o),t)}(t),e=function YC(t){return Object.keys(ab).filter(n=>typeof t[n]>"u").reduce((n,e)=>{const s=(0,ab[e])(t);return typeof s<"u"&&(n[e]=s),n},t)}(n);return ew(e)}(Object.keys(o).reduce((r,a)=>{const c=Array.isArray(o[a]);return r[a]=c?(0,m.last)(o[a]):o[a],r},{}))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})();var YA=A(5126),WA=A(4104);function ms(t,n){const{procName:e,actionFn:o,aliases:s=[],mapFnIn:r,mapFnOut:a,hideDefinition:c=!1}=n,p=function(u){const g=this,h=r?r(u):u,y=o(h);if(!(typeof y>"u"))if(y instanceof b.y)y.subscribe(B=>{const K=a?a(B):B;g.setResult(K)});else{const k=a?a(y):y;g.setResult(k)}};[e,...s].forEach(u=>{t.defineAPIProcedure(u,p,{hidden:c})})}var L=(()=>(function(t){t.AnnotationsCreate="annotations.create",t.AnnotationsDestroy="annotations.destroy",t.AnnotationsInfo="annotations.info",t.AnnotationsSetDescription="annotations.setDescription",t.AnnotationsSetLabelsShown="annotations.setLabelsShown",t.AnnotationsSetTitle="annotations.setTitle",t.AnnotationsUpdate="annotations.update",t.AnnotationsSetEnabled="annotations.setEnabled",t.CameraInfo="camera.info",t.CameraOrbit="camera.orbit",t.CameraPan="camera.pan",t.CameraReset="camera.reset",t.CameraSet="camera.set",t.CameraZoom="camera.zoom",t.setCameraMode="camera.setCameraMode",t.CameraDisableChapterCamera="camera.disableChapterCamera",t.CameraEnableChapterCamera="camera.enableChapterCamera",t.GetAnnotationInfo="annotations.info",t.HideAnnotations="annotations.hide",t.HotspotsCreate="hotspots.create",t.HotspotsDestroy="hotspots.destroy",t.HotspotsHide="hotspots.hide",t.HotspotsInfo="hotspots.info",t.HotspotsShow="hotspots.show",t.HotspotsTypes="hotspots.types",t.HotspotsUpdate="hotspots.update",t.HumanInfo="human.info",t.HumanCanvasInfo="human.canvasInfo",t.InputDisable="input.disable",t.InputEnable="input.enable",t.LabelsCreate="labels.create",t.LabelsDestroy="labels.destroy",t.LabelsInfo="labels.info",t.LabelsHide="labels.hide",t.LabelsSetEnabled="labels.setEnabled",t.LabelsShow="labels.show",t.LabelsUpdate="labels.update",t.LabelsCanvasUpdate="labels.canvasUpdate",t.LabelsSetScale="labels.setScale",t.NativeErrorMessage="native.errorMessage",t.NativeSetSdkOffline="native.setSdkOffline",t.NativeSetAppVersion="native.setAppVersion",t.NativeRedirect="native.redirect",t.NativeReload="native.reload",t.NativeOfflineModelIds="native.offlineModelIDs",t.QuizInfo="quiz.info",t.QuizEnter="quiz.enter",t.QuizExit="quiz.exit",t.QuizQuestion="quiz.currentQuestion",t.QuizSubmit="quiz.submit",t.QuizNextQuestion="quiz.next",t.QuizPreviousQuestion="quiz.previous",t.QuizSelectQuestion="quiz.select",t.QuizSet="quiz.set",t.QuizReset="quiz.reset",t.SceneMetaData="scene.metadata",t.SceneSetHighlightColor="scene.setHighlightColor",t.SceneColorObject="scene.colorObject",t.SceneDisableHighlight="scene.disableHighlight",t.SceneEnableHighlight="scene.enableHighlight",t.SceneGetColor="scene.getColor",t.SceneInfo="scene.info",t.SceneLoad="scene.load",t.ScenePick="scene.pick",t.SceneReset="scene.reset",t.SceneSelectObjects="scene.selectObjects",t.SceneShowObjects="scene.showObjects",t.SceneTransformObject="scene.transformObject",t.SceneUncolorObject="scene.uncolorObject",t.SceneUnload="scene.unload",t.SceneSnapshot="scene.snapshot",t.SceneCapture="scene.capture",t.SceneRestore="scene.restore",t.SceneEnableXrayMode="scene.enableXray",t.SceneDisableXrayMode="scene.disableXray",t.SceneSetLayersSliderPosition="scene.setLayersSliderPosition",t.SceneGetLayers="scene.getLayers",t.SceneSetBaseDirectory="scene.setBaseDirectory",t.ShowAnnotations="annotations.show",t.SetAnnotationsShown="annotations.setShown",t.TimelineInfo="timeline.info",t.TimelineQuery="timeline.query",t.TimelineNext="timeline.nextChapter",t.TimelinePause="timeline.pause",t.TimelinePlay="timeline.play",t.TimelinePrev="timeline.previousChapter",t.TimelineSet="timeline.set",t.UIGetBackground="ui.getBackground",t.UIGetDisplay="ui.getDisplay",t.UIGetWorldPosition="ui.getWorldPosition",t.UISetBackground="ui.setBackground",t.UIPresetBackground="ui.presetBackground",t.UISetDisplay="ui.setDisplay",t.UIResetDisplay="ui.resetDisplay",t.UISnapshot="ui.snapshot",t.focusObject="focus.focusObject",t.dissectSetEnabled="dissect.setEnabled",t.pickSingleSetEnabled="pick.single.setEnabled",t.pickMultiSetEnabled="pick.multi.setEnabled",t.getCanvasPos="scene.getCanvasPos",t.sceneSetClickMode="scene.setClickMode",t.sceneGetClickMode="scene.getClickMode",t.IsolateObject="scene.isolateObject",t.UISetOndemand="ui.setOndemand",t.UISetLoadingExperience="ui.setLoadingExperience",t.UISetScrollCaptureMode="ui.setScrollCaptureMode",t.UISetTutorial="ui.setTutorial",t.UISetQuizLock="ui.setQuizLock"}(L||(L={})),L))();function Dg(t){const n=t.captureCamera();return{position:n.lookAt.eye,target:n.lookAt.look,up:n.lookAt.up,zoom:n.zoom}}var ic,eL=A(7176),lx=A(5318);!function(t){t.isLegacyCaptureFormat=function n(s){return void 0!==s.engineVersion},t.convertCaptureFormat=function e(s){const r=Object.keys(s.objects).reduce((a,c)=>(a.push({objectId:c,selected:!1,hidden:!1}),a),[]);return{storyId:s.timeline.rootName.replace(".json",""),camera:{lookAt:s.camera,zoom:void 0},labels:[],objects:r,background:[],activeChapterId:s.timeline.scrub?s.timeline.scrub.chapterId:void 0}},t.convertMediaFormat=function o(s){const r={};return Object.entries(s).forEach(([a,c])=>{r[a]={fullUrl:c.fullUrl,lang:c.lang,streamType:c.streamType}}),r}}(ic||(ic={}));let px=(()=>{class t{}return t.type="[Analytics] Authorize App",t})(),nL=(()=>{class t{constructor(e,o){this.userType=e,this.response=o}}return t.type="[Analytics] Auth Success",t})(),dx=(()=>{class t{constructor(e,o){this.userType=e,this.response=o}}return t.type="[Analytics] Auth Failure",t})(),oc=(()=>{class t{constructor(e,o){this.interaction=e,this.source=o}}return t.type="[Analytics] Log Interaction",t})(),jg=(()=>{class t{constructor(e,o){this.interaction=e,this.response=o}}return t.type="[Analyics] Log Interaction Success",t})(),iL=(()=>{class t{constructor(e,o){this.interaction=e,this.response=o}}return t.type="[Analyics] Log Interaction Failure",t})(),ux=(()=>{class t{}return t.type="[Analytics] Log View Analytic",t})(),Qg=(()=>{class t{}return t.type="[Analytics] Log Interaction Chance",t})(),gx=(()=>{class t{}return t.type="[Analytics] Log First Interaction",t})(),Zg=(()=>{class t{}return t.type="[Analytics] Reset First Interaction",t})();function hx(t){if(!t)return null;const{objectId:n,canvasPos:e,worldPos:o}=t;return{objectId:n||void 0,canvasPosition:e?{x:e.x,y:e.y}:void 0,mode:"query",position:o?{x:o[0],y:o[1],z:o[2]}:void 0}}function Bg(t,n,e){const o=t.getObjectById(e).parent;return null!==o&&(n[o.objectId].checked||Bg(t,n,o.objectId))}function mx(t,n){const e=n.includes("/")?Xe.Module:Xe.Bookmark;t.dispatch(new mc(n,e))}function fx(t,n){return t.dispatch(new xc(!0)),n.fireEvent(pe.SceneXrayEnabled),!0}function pL(t){return t.find(e=>e.type==zi.Images)?.images?.filter(e=>null!=e.urls?.default).map(e=>e.urls.default)??[]}function uL(t,n,e,o,s,r,a,c,p,d,u,g){return[{procName:L.SceneMetaData,actionFn:()=>{const h=t.selectSnapshot(we.getStory),y=t.selectSnapshot(_.getStoryChapters);return{title:h.displayName,description:h.description,chapters:y.map(k=>({id:k.id,title:k.displayName,description:k.description,isAnimated:a.isChapterAnimated(k),loops:a.isChapterLooped(k),duration:a.getChapterTimeFrame(),media:ic.convertMediaFormat(k.media),images:k.contentBlocks?pL(k.contentBlocks):[],thumbnail:k.thumbnails?k.thumbnails.default:""}))}}},{procName:L.focusObject,actionFn:h=>(function lL(t,n,e){t.select&&t.xray?fx(n,e):Hu(n,e),t.select&&n.dispatch(new Rt(!0,[t.objectId])),n.dispatch(new Wi(t.objectId,!0,1))}(h,t,e),!0),hideDefinition:!0},{procName:L.dissectSetEnabled,actionFn:h=>(t.dispatch(new Cs(h.enable?Ve.Hide:Ve.Select)),!0),hideDefinition:!0},{procName:L.sceneSetClickMode,actionFn:h=>(t.dispatch(new Cs("select"===h?Ve.Select:"hide"===h?Ve.Hide:"fade"===h?Ve.Fade:Ve.Select)),!0)},{procName:L.sceneGetClickMode,actionFn:()=>t.selectSnapshot(M.getActiveTool)},{procName:L.pickSingleSetEnabled,actionFn:h=>{const y=(()=>{switch(h.enable){case void 0:return!t.selectSnapshot(O.getMultiPickModeEnabled);case!0:return!1;case!1:return!0}})();return t.dispatch(new T.SetMultiPickModeEnabled(y)),!0},hideDefinition:!0},{procName:L.pickMultiSetEnabled,actionFn:h=>{const y=void 0===h.enable?!t.selectSnapshot(O.getMultiPickModeEnabled):h.enable;return t.dispatch(new T.SetMultiPickModeEnabled(y)),!0},hideDefinition:!0},{procName:L.getCanvasPos,actionFn:h=>{const y=u.getCanvas();return function tL(t,n,e,o,s){e&&he.add(n,e,n);const r=t.getViewMat(),a=t.getProjMat(),c=lx.create();he.transformMat4(c,n,r),c[3]=1,lx.transformMat4(c,c,a);const d=c[1],u=c[3];return[Math.round((1+c[0]/u)*o/2),Math.round((1-d/u)*s/2)]}(u,h.worldPos,h.offset,y.width,y.height)},hideDefinition:!0},{procName:L.SceneCapture,actionFn:()=>function rL(t,n,e){const o=e.captureCamera(),s=n.selectSnapshot(Se.getNodes),r=Object.keys(s).map(g=>({objectId:g,selected:s[g].checked||Bg(t,s,g),hidden:!s[g].shown})),a=n.selectSnapshot(_.getStoryChapters).map(g=>({chapterId:g.id,background:g.background||_r})),c=n.selectSnapshot(we.getStoryId);return{camera:o,labels:n.selectSnapshot(te.getLabels),storyId:c,objects:r,background:a,activeChapterId:n.selectSnapshot(_.getSelectedChapterId)}}(g,t,s)},{procName:L.SceneRestore,actionFn:h=>{const y=ic.isLegacyCaptureFormat(h),k=y?ic.convertCaptureFormat(h):h;return function cL(t,n,e,o,s){return new b.y(r=>{o.getEvent(pe.HumanStarted).pipe((0,eL.P)()).subscribe(()=>{(function aL(t,n,e,o=!1){return new Promise(s=>{e.selectSnapshot(M.getViewGraph);const a=n.objects.filter(g=>!0===g.selected).map(g=>g.objectId),c=o?t.getLeafIds().filter(h=>void 0===n.objects.find(B=>B.objectId===h)):n.objects.filter(g=>!0===g.hidden).map(g=>g.objectId),p=n.background.map(g=>new ks(g.chapterId,g.background)),d=n.activeChapterId?[new Ps(n.activeChapterId)]:[],u=void 0!==n.camera.zoom?[new ld(n.camera.zoom)]:[];setTimeout(()=>{e.dispatch([new Zn(n.camera.lookAt,!1),new el(n.labels),new rn(!1,c),new Rt(!0,a),...u,...d,...p]),s(void 0)})})})(t,n,e,s).then(()=>{o.fireEvent(pe.SceneRestored),r.next(!0),r.complete()})}),mx(e,n.storyId)})}(g,k,t,e,y)}},{procName:L.SceneEnableXrayMode,actionFn:()=>fx(t,e)},{procName:L.SceneDisableXrayMode,actionFn:()=>Hu(t,e)},{procName:L.SceneLoad,actionFn:h=>(n.pipe((0,l.xt)(bc),(0,yt.q)(1)).subscribe(()=>{e.fireEvent(pe.SceneReady)}),mx(t,h),t.dispatch(new Zg),!0)},{procName:L.SceneUnload,actionFn:()=>(function sL(t){t.dispatch(new Fp)}(t),t.dispatch(new Zg),!0)},{procName:L.SceneSetBaseDirectory,actionFn:h=>(d.fireEvent(me.NativeSetBaseDirectory,h),!0)},{procName:L.NativeSetSdkOffline,actionFn:h=>(d.fireEvent(me.NativeSetSdkOffline,h),!0)},{procName:L.SceneReset,actionFn:()=>(c.resetChapter(),!0)},{procName:L.SceneInfo,actionFn:h=>{const y=h&&h.objectId?[h.objectId]:Object.keys(g.getObjects()),k=t.selectSnapshot(we.getStory).displayName;return function oL(t,n,e,o){const s=o.selectSnapshot(Se.getNodes);return{name:n,objects:e.reduce((c,p)=>(c[p]=(c=>{const p=t.getObjectById(c),d=t.isLeaf(p)?s[c].checked||Bg(t,s,c):void 0;return{objectId:p.objectId,name:p.displayName,description:"",shown:p.shown,selected:d,children:p.children.map(u=>u.objectId),parent:p.parent?p.parent.objectId:null}})(p),c),{})}}(g,k,y,t)}},{procName:L.ScenePick,actionFn:h=>hx(u.pick(h.x,h.y))},{procName:L.SceneSelectObjects,actionFn:h=>{const y=!0===h.replace,k=h;return delete k.replace,y&&t.dispatch(new Rt(!1)),t.dispatch(new Rt(!1,[],k)),!0}},{procName:L.SceneShowObjects,actionFn:h=>{delete h.replace;const y=(B,K)=>{const V=g.getObjectById(B).children;let ge={[B]:K};for(const F of V)void 0===h[F.objectId]&&(ge[F.objectId]=K,ge={...ge,...y(F.objectId,K)});return ge},k=Object.entries(h).reduce((B,[K,V])=>({...B,...y(K,V)}),{});return t.dispatch(new rn(!1,[],k)),!0}},{procName:L.IsolateObject,actionFn:h=>{const y="string"==typeof h?[h]:h,k=t.selectSnapshot(M.getViewGraph),B=r.getInverseSelection(k,y),K=r.getNodes(k,B);return t.dispatch(new rn(!1,K.map(V=>V.id))),!0}},{procName:L.SceneTransformObject,actionFn:h=>(g.transformObject(h.objectId,h),!0)},{procName:L.SceneColorObject,actionFn:h=>{const{objectId:y,tintColor:k,saturation:B,contrast:K,brightness:V,opacity:ge}=h;return t.dispatch(new Xo(af({tintColor:k,saturation:B,contrast:K,brightness:V,opacity:ge}),[y])),!0}},{procName:L.SceneGetColor,actionFn:h=>Is(t.selectSnapshot(Se.getNodePaint)(h.objectId))},{procName:L.SceneUncolorObject,actionFn:h=>(t.dispatch(new Xo(br,[h.objectId])),!0)},{procName:L.SceneDisableHighlight,actionFn:()=>(o.disableHighlight(),!0)},{procName:L.SceneEnableHighlight,actionFn:()=>(o.enableHighlight(),!0)},{procName:L.SceneSetHighlightColor,actionFn:h=>(o.setHighlightColor(h),!0)},{procName:L.SceneSetLayersSliderPosition,actionFn:h=>{const y=Math.min(1,Math.max(h.position,0)),k=p.fractionToIndex(y),B=p.fractionToPosition(y,k);return h.record?p.recordLayerIndexPosition(k,B):p.synchronizeScene(k,B,!1),!0}},{procName:L.SceneGetLayers,actionFn:()=>t.selectSnapshot(_.getAllChaptersCurrentLayers)}]}function Jo(t,n,e,o){t.defineAPIEvent(n,{events:e||[n],map:o||(s=>s)})}function bx(t){return wo.getColors(t).map(e=>e[255])}function yx(t,n){const e=t.selectSnapshot(_.getSelectedChapterBackground),{colors:o,colorStops:s,gradientType:r}=e,a=n.gradientType||r,c=n.colorStops||s;if(n.colors){const[p,d]=n.colors;return{colors:[...p,...d],gradientType:a,colorStops:c}}return{colors:o,gradientType:a,colorStops:c}}function up(t){return t.selectSnapshot(te.getChapterLabels)}function _x(t,n){return function PL(t,n){return t.find(e=>n===e.id)}(up(t),n)}function Vg(t,n){const e=t.getMarkerById(n.id),o=t.getMarkerWorldPosition(e);return{annotationId:n.id,objectId:n.objectId||null,title:n.title,description:n.description,shown:n.shown,occludable:n.occludable,position:o?wt.fromArray(o):null,canvasPosition:e?{x:e.canvasPosition[0],y:e.canvasPosition[1]}:null}}function qg(t,n){const e=_x(t,n.annotationId);return e?{...e,...n}:null}function $g(t,n){return n&&t.dispatch(new Fs(n)),!0}function Gg(t,n){return t.dispatch(new La(n)),!0}function xx(t,n){return t.reduce((e,o)=>({...e,[`${o}`]:n}),{})}function Jg(t,n){return function AL(t,n){return Object.entries(t).filter(([e,o])=>n(e,o)).reduce((e,[o,s])=>({...e,[`${o}`]:s}),{})}(t,(e,o)=>o===n)}function vx(t,n){return Object.keys(Jg(t,n))}function Cx(t,n,e){return function kL(t,n){return t.filter(e=>n.includes(e.id))}(t,vx(n,e))}function wx(t,n,e){const o=vx(n,e).map(r=>function OL(t,...n){const e=n.map(s=>t.filter(a=>s===a.objectId));return function SL(t){const n=new Set(t);return Array.from(n.values())}([].concat(...e))}(t,r)).map(r=>r.map(a=>a.id));return xx([].concat(...o),e)}function UL(t,n){return[{eventName:me.AnnotationsCreated,aliasEvents:[me.LabelsCreated],mapFn:e=>Vg(t,e)},{eventName:me.AnnotationsDestroyed,aliasEvents:[me.LabelsDestroyed],mapFn:e=>({annotationId:e.id})},{eventName:me.AnnotationsShown,aliasEvents:[me.LabelsEnabled],mapFn:()=>!0},{eventName:me.AnnotationsHidden,aliasEvents:[me.LabelsDisabled],mapFn:()=>!0}]}function RL(t,n,e,o){return[{procName:L.AnnotationsInfo,actionFn:()=>up(t),mapFnOut:s=>function ML(t,n){return n.reduce((e,o)=>(e[o.id]=Vg(t,o),e),{})}(e,s)},{procName:L.AnnotationsCreate,mapFnIn:s=>function TL(t,n,e,o){const s=n.selectSnapshot(_.getSelectedChapter),r=t.getObjectById(o.objectId)?o.objectId:void 0;return e.deserializeAnnotation({annotationId:o.annotationId,title:o.title,description:o.description,objectId:r,pos:o.position,occludable:o.occludable,labelOffset:o.labelOffset,shown:o.shown,labelShown:o.shown},s,qt.Annotation)}(o,t,n,s),actionFn:s=>function IL(t,n){return n.objectId?(t.dispatch(new Ls(n)),n):null}(t,s),mapFnOut:s=>s?Vg(e,s):null},{procName:L.AnnotationsUpdate,mapFnIn:s=>qg(t,s),actionFn:s=>$g(t,s)},{procName:L.AnnotationsSetTitle,mapFnIn:s=>qg(t,s),actionFn:s=>$g(t,s),hideDefinition:!0},{procName:L.AnnotationsSetDescription,mapFnIn:s=>qg(t,s),actionFn:s=>$g(t,s),hideDefinition:!0},{procName:L.AnnotationsDestroy,mapFnIn:s=>_x(t,s),actionFn:s=>function zL(t,n){return n&&t.dispatch(new kr(n)),!0}(t,s)},{procName:L.ShowAnnotations,actionFn:()=>Gg(t,!0)},{procName:L.SetAnnotationsShown,actionFn:()=>Gg(t,!0),hideDefinition:!0},{procName:L.HideAnnotations,actionFn:()=>Gg(t,!1)},{procName:L.AnnotationsSetLabelsShown,mapFnIn:s=>function LL(t,n){const{annotations:e,objects:o,replace:s}=n,a=e||{},c=o||{},p=up(t),d={...Jg(a,!0),...Jg(a,!1),...wx(p,c,!0),...wx(p,c,!1)};return s?{...xx(p.map(u=>u.id),!1),...d}:d}(t,s),actionFn:s=>function FL(t,n){const e=up(t),o=Cx(e,n,!1),s=Cx(e,n,!0);t.dispatch(new To(s,!0)),t.dispatch(new To(o,!1))}(t,s),hideDefinition:!0}]}const NL={};function Sx(t,n){n.hasOwnProperty("data")&&(n[t]=n.data)}const lo={hotspotSeedId:0,hotspotIdMap:new Map,getHotspotMap:t=>{const{hotspotIdMap:n,createHotspotId:e}=lo;return t.selectSnapshot(te.getLabels).forEach(s=>{const r=s.id;typeof n.get(r)>"u"&&e(r)}),n},createHotspotId:t=>(lo.hotspotSeedId++,lo.hotspotIdMap.set(t,lo.hotspotSeedId),lo.hotspotSeedId),getHotspotIdByLabel:(t,n,e)=>{const{getHotspotMap:o,createHotspotId:s}=lo,a=o(t).get(n);return e&&typeof a>"u"?s(n):a},getLabelIdByHotspotId:(t,n)=>{const e=lo.getHotspotMap(t),o=Array.from(e).find(([s,r])=>r===n);return o?o[0]:null}};function Px(t,n){const e=t.selectSnapshot(te.getLabels);return typeof n<"u"?e.filter(o=>o.chapterId===n):e}function gp(t,n){const e=Px(t),o=lo.getLabelIdByHotspotId(t,n);return e.find(s=>s.id===o)}function kx(t){return t===Ti.CirclePlus?St.Plus:t===Ti.CircleMinus?St.Minus:St.Default}function Hg(t,n){return lo.getHotspotIdByLabel(t,n)}function hp(t,n){return{...n,id:Hg(t,n.id)}}function Ox(t,n,e){const o=n.selectSnapshot(_.getStoryChapters);return e.map(s=>function QL(t,n,e,o){const{id:s,chapterId:r,title:a,objectId:c}=o,p=e.findIndex(y=>r===y.id),d=lo.getHotspotIdByLabel(n,s,!0),u=t.getMarkerById(s),g=t.getMarkerWorldPosition(u),h=u?.marker3D?.direction;return{id:d,title:a,objectId:c,position:g?Tx(g):null,direction:h?Tx(h):null,canvasPosition:u?ZL(u.canvasPosition):null,chapterScope:p,type:o.pinType===St.PlusMinus?Ti.CirclePlus:Ti.Circle,shown:o.shown,data:NL[o.id]}}(t,n,o,s))}function Tx(t){return{x:t[0],y:t[1],z:t[2]}}function mp(t){return[t.x,t.y,t.z]}function ZL(t){return{x:t[0],y:t[1]}}function Mx(t,n,e){return t.dispatch(new To(n,e)),!0}function Yg(t,n){if("number"==typeof n){const e=gp(t,n);return e?[e]:[]}return Px(t)}function JL(t){return[{eventName:me.HotspotsEntered,mapFn:n=>hp(t,n)},{eventName:me.HotspotsLeft,mapFn:n=>hp(t,n)},{eventName:me.HotspotsPicked,mapFn:n=>hp(t,n)},{eventName:me.HotspotsDisplayUpdated,mapFn:n=>hp(t,n)},{eventName:me.HotspotsPositionUpdated,mapFn:n=>function DL(t,n){const{id:e,canvasPos:o}=n,{x:s,y:r}=o;return{id:Hg(t,e),canvasPosition:{x:s,y:r,0:s,1:r},occluded:n.occluded}}(t,n)}]}function HL(t,n,e){return[{procName:L.HotspotsInfo,actionFn:o=>{const s="number"==typeof o?o:void 0;if(void 0!==s){const r=gp(t,s);return Ox(e,t,[r])[0]}{const r=Yg(t,s);return Ox(e,t,r)}}},{procName:L.HotspotsTypes,mapFnIn:()=>function BL(){return Object.values(Ti).map(t=>`${t}`)}(),actionFn:o=>o},{procName:L.HotspotsCreate,mapFnIn:o=>function EL(t,n,e){const{title:o,objectId:s,position:r,direction:a,chapterScope:c,type:p}=e,d=t.selectSnapshot(_.getStoryChapters),u=t.selectSnapshot(_.getSelectedChapter),g=t.selectSnapshot(_.getSelectedChapterIndex),h="number"==typeof c?c:g,y=d[h]||u,k=!1!==e.shown,B=k&&!!o,K={title:o,type:p||Ti.CircleLabel,objectId:s,pos:r?mp(r):null,dir:a?mp(a):null,shown:k,symbol:"",className:""},V=n.deserializeHotspots({},y,h,K);return V.title=o,V.expandTag=!0,V.flyTo=!1,V.flyToTarget=null,V.occludable=!0,V.pinGlow=!1,V.pinType=St.PlusMinus,V.shown=k,V.hideTag=!B,V.hideWire=!0,V.theme=qt.StudioNext,V.pinType=kx(p),Sx(V.id,e),V}(t,n,o),actionFn:o=>function VL(t,n){return n.objectId?(t.dispatch(new Ls(n)),n):null}(t,o),mapFnOut:o=>o?Hg(t,o.id):null},{procName:L.HotspotsUpdate,mapFnIn:o=>function GL(t,n){const e=gp(t,n.id);return e?function jL(t,n){const{title:e,objectId:o,direction:s,position:r,shown:a,type:c}=t,p={...n,title:e,objectId:o,shown:a,pos:r?mp(r):null,dir:s?mp(s):null,pinType:c?kx(c):null};return Sx(n.id,t),{...n,...(0,m.omitBy)(p,m.isNil)}}(n,e):null}(t,o),actionFn:o=>o?function qL(t,n){return t.dispatch(new Fs(n)),n}(t,o):null},{procName:L.HotspotsDestroy,mapFnIn:o=>gp(t,o),actionFn:o=>o?function $L(t,n){return t.dispatch(new kr(n)),n}(t,o):null},{procName:L.HotspotsShow,mapFnIn:o=>Yg(t,o),actionFn:o=>Mx(t,o,!0)},{procName:L.HotspotsHide,mapFnIn:o=>Yg(t,o),actionFn:o=>Mx(t,o,!1)}]}function Ix(t){return t.selectSnapshot(te.getChapterLabels)}function zx(t,n){return t.dispatch(new La(n)),!0}function aa(t,n){return Ix(t).find(o=>n===o.id)}function Wg(t,n){return Ix(t).filter(o=>n.includes(o.id))}function Kg(t,n,e){return n&&n.objectId?(t.dispatch(e?new Ls(n):new Fs(n)),n):null}function Ax(t,n){const e=document.createElement("span");return e.innerHTML=t,(0,m.trim)(e.textContent).length<=n}function Lx(t,n,e){const o=(0,m.cloneDeep)(t);return o.title=n.title&&Ax(n.title,100)?n.title:o.title,o.description=n.description&&Ax(n.description,300)?n.description:o.description,o.theme=n.theme||o.theme,o.pinType=n.pinType||o.pinType,o.sequentialType=n.sequentialType||o.sequentialType,o.offset=function XL(t,n){return n||[-(t.hideWire?20:32),0]}(o,n.labelOffset),o.pinGlow=void 0!==n.pinGlow?n.pinGlow:o.pinGlow,o.hideWire=void 0!==n.hideWire?n.hideWire:o.hideWire,o.hideTag=void 0!==n.hideTag?n.hideTag:o.hideTag,o.collapseDescription=void 0!==n.collapseDescription?n.collapseDescription:o.collapseDescription,o.occludable=void 0!==n.occludable?n.occludable:o.occludable,o.cameraPosition=n.flyToCamera||o.cameraPosition,o.flyTo=function e6(t,n){return!1!==n&&(n||t.flyTo)}(o,n.flyTo),o.states=function t6(t){if(!t.flyTo)return[];const n=[new Ko,new Ko];n[0].errands=[new Oa],n[1].errands=t.cameraPosition?[new ef(t.cameraPosition)]:[new ka(t.objectId)]}(o),o}function ca(t,n){if(n){const e=t.getMarkerById(n.id),o=t.getMarkerWorldPosition(e);return{labelId:n.id,objectId:n.objectId,title:n.title,description:n.description,theme:n.theme,pinType:n.pinType,labelOffset:n.offset,hideWire:n.hideWire,pinGlow:n.pinGlow,occludable:n.occludable,sequentialType:n.sequentialType,shown:n.shown,collapseDescription:n.collapseDescription,hideTag:n.hideTag,flyTo:!0===n.flyTo,flyToCamera:n.cameraPosition,position:o??n.pos,canvasPosition:e?.canvasPosition??[-1,-1],occluded:e?.occluded??!0}}return null}function Fx(t,n){return n.reduce((e,o)=>(e[o.id]=ca(t,o),e),{})}function Xg(t){return t.selectSnapshot(U.getAllQuestions)}function eh(t,n){return Xg(t).find(e=>e.id===n)}function Ux(t){return eh(t,nh(t))}function la(t){return{enabled:t.selectSnapshot(U.getQuizEnabled),active:t.selectSnapshot(U.getQuizModeActive),questions:l6(Xg(t)),questionId:nh(t),submissions:s6(t,th(t))}}function s6(t,n){return n.map(e=>Rx(t,e))}function Rx(t,n){const e=Ux(t);return{questionId:n.questionId,answerIds:e.data.correctAnswer,correctAnswerIds:sh(e),correct:As(e,n.answer)}}function th(t){return t.selectSnapshot(U.getAllSubmissions)}function nh(t){return t.selectSnapshot(U.getActiveQuestionId)}function ih(t){const n=Ux(t),e=function o6(t){return th(t).find(e=>e.questionId===nh(t))}(t);return{question:oh(n),submission:e?Rx(t,e):void 0}}function Nx(t){return t.map(n=>function r6(t){const n=t.type;switch(n){case zi.Markdown:const{markdown:e}=t;return{type:n,content:e};case zi.Images:const{images:o}=t;return{type:n,content:o.map(r=>r.urls.default)};default:return{type:n,content:""}}}(n))}function oh(t){let n=[],e="";switch(t.type){case Re.MultipleChoice:const o=t.data;n=function a6(t){return t.map(n=>function c6(t){return{answerId:t.value,displayText:t.label}}(n))}(o.options),e=o.correctAnswer;break;case Re.SelectAnatomy:n=t.data.correctAnswer.map(a=>({answerId:a,displayText:a})),e="";break;case Re.LabelAnatomy:n=t.data.options.map(a=>({answerId:a.value,displayText:a.label.title})),e=""}return{questionId:t.id,questionType:t.type,questionPrompt:Nx(t.questionPrompt),answerExplanation:Nx(t.explanation),answers:n,answerId:e}}function l6(t,n){const e=t.map(o=>oh(o));return typeof n<"u"?e.filter(o=>n.includes(o.questionId)):e}function sh(t){const n=oh(t);switch(n.questionType){case Re.LabelAnatomy:case Re.SelectAnatomy:return n.answers.map(({answerId:e})=>e);case Re.Instructions:return["-"];default:return[n.answerId]}}var u6=A(5612),sc=(()=>(function(t){t.InvalidUAID="analytic id does not exist",t.InvalidDeveloperId="Client id invalid",t.InvalidProductKey="app product key",t.MissingUAID="analytic id missing",t.WebOnlyAPI="Api key only compatible with Web Widget",t.AndroidOnlyAPI="Api key only compatible with Mobile Widget SDK for Android",t.IOSOnlyAPI="Api key only compatible with Mobile Widget SDK for iOS",t.MixedAPIKeys="Use of both an app product key and an app api key not allowed",t.ProductKeyNotRegistered='App product key "xxx" has not been registered or is incorrect.  Ensure it has been registered by the system admin',t.ProductKeyInvalidAppBundleID='The app product key "xxx" has not been authorized to be used for app bundle id "yyy".  Confirm the correct values are being used from the system admin',t.ProductKeyBundleIDWhitelist='Use of app product key "xxx" requires the affiliated app bundle id (app_domain) to be white-listed.  Ensure the system admin has white-listed "yyy"',t.ImproperProductKeyUsage='Improper use of app product key "xxx" detected. Contact the system admin if issue continues',t.InvalidPlatformSource="Invalid platform source",t.MissingSource="Missing source",t.MissingPlatform="Missing platform",t.MissingAppDomain="Missing app domain",t.APIKeyMissing="Api key missing",t.APIKeyInvalid="Api key invalid",t.DeveloperDeactivated="Developer account for api key is deactivated",t.BundleIDNotAllowed="App bundle id not allowed",t.BundleIDUnregistered="App bundle id unregistered"}(sc||(sc={})),sc))();class g6{}const h6={headers:new at.WM({"Content-Type":"application/json; charset=utf-8"})},Ex="127.0.0.1";let rh=(()=>{class t{constructor(e,o){this.http=e,this.storageService=o}getAnalytic(e){return se.offline?(fetch("https://human.biodigital.com/ws/user/analytics?analytic_id="+e,{method:"GET",mode:"no-cors"}),(0,Ue.of)({success:!0})):this.http.get("/ws/user/analytics?analytic_id="+e).pipe((0,J.U)(()=>({success:!0})),(0,Vn.K)(s=>(0,Ue.of)(this.parseError(s))))}sendAnalytic(e){if(se.offline){const r=e instanceof gc?"https://human.biodigital.com/ws/user/analytics":"https://human.biodigital.com/ws/developer/apps/access/key",a=(0,u6.stringify)(e);if(navigator.onLine)this.sendOfflineAnalytic(r,a),this.sendSavedOfflineMessages(r);else{const c=(new Date).toISOString().substring(0,19);this.storageService.setDatabaseAnalyticItem({url:r,message:"offline_event=1&event_timestamp="+c+"&"+a})}return(0,Ue.of)({success:!0})}return this.http.post(e instanceof gc?"/ws/user/analytics":"/ws/developer/apps/access/key",e,h6).pipe((0,J.U)(()=>({success:!0})),(0,Vn.K)(r=>(0,Ue.of)(this.parseError(r))))}sendOfflineAnalytic(e,o){var s=this;return(0,Pn.Z)(function*(){fetch(e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:o}).catch(()=>{navigator.onLine?setTimeout(()=>{fetch(e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:o})},300):s.storageService.setDatabaseAnalyticItem({url:e,message:o})})})()}sendSavedOfflineMessages(e){this.storageService.getDatabaseOfflineAnalytics(o=>{o.forEach(s=>{this.sendOfflineAnalytic(s.url??e,s.message)})})}buildUserAnalytic(e,o,s){const{widgetUrlConfig:r,parentUrl:a}=e,c=r.uaid,p=a.domain,d={...this.buildAppActivityData(e),parent_analytic_identifier:c,referer_domain:p,[`${o}_source`]:s},u={analytic_platform:fo.Widget,analytic_type:o,analytic_data:d};return se.offline&&(u.app_domain=Ex),(0,sn.yE)(gc,u)}buildDeveloperAnalytic(e,o,s=fo.Widget,r){const{widgetUrlConfig:a,parentUrl:c,embedded:p}=e;return(0,sn.yE)(g6,{platform:s,app_activity:o,app_productkey:a["app-productkey"],app_userid:a["app-userid"],app_apikey:a.dk,app_domain:se.offline?Ex:c.full,app_activity_data:r,widget_is_fullscreen:!p})}buildAppActivityData(e){const{engineVersion:o,engineAPIVersion:s,widgetUrlConfig:r}=e,a={engine_version:o,api_version:s};return Object.entries(r).filter(([c])=>"dk"!==c).forEach(([c,p])=>{a[`url_param_${c}`]=p}),(0,sn.yE)(Oh,a)}parseError(e){if(se.offline)return{success:!0,message:"",errorCode:null};const o=e.error.error,s=e.status,a=o&&o.message?o.message:"";return{success:s>=500&&s<=504,message:a,errorCode:Object.values(sc).includes(a)?a:null}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(dn))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Gi=(()=>(function(t){t.Init="init",t.View="view",t.ChanceInteraction="interactionc",t.FirstInteraction="interactionf",t.Call="call"}(Gi||(Gi={})),Gi))();class f6{constructor(n,e,o){this.subject=n,this.callId=e,this.procedureName=o}setResult(n){const{callId:e,procedureName:o}=this;this.subject.next({callId:e,value:n,procedureName:o})}}const b6=Object.values(pe),y6=Object.values(me);let ah=(()=>{class t{constructor(e,o){this.engineService=e,this.applicationEventService=o,this.proceduresMap={},this.hiddenProcedures={},this.eventsMap={},this.resultsSubject=new X.x,this.logEntries=[],this.ngUnsubscribe=new X.x,this.init()}getAPIProcedureNames(){return Object.keys(this.proceduresMap).filter(e=>!(!0===this.hiddenProcedures[e]))}getAPIEventNames(){const e=Object.keys(this.eventsMap);return[pe.HumanReady,...e]}logAPIProcedure(e){this.logEntries.length>1e4&&this.logEntries.shift(),this.logEntries.push({engine_version:Ap,api_version:"2.0.1",identifier:e,category:e.split(".")[0]})}getAPILog(){return this.logEntries}resetAPILog(){this.logEntries.length=0}callAPIProcedure(e,o,s){const r=this.proceduresMap[o];r?r(e,s):console.warn("API:",`Target procedure not found: ${o}`)}defineAPIEvent(e,o){this.eventsMap[e]&&console.warn("API:",`Redefining event: ${e}`),this.eventsMap[e]=o||e}defineAPIProcedure(e,o,s){this.proceduresMap[e]&&console.warn("API:",`Redefining procedure: ${e}`),this.hiddenProcedures[e]=!0===s?.hidden,this.proceduresMap[e]=(r,a)=>{o.call(new f6(this.resultsSubject,r,e),a||{})}}onResults(){return this.resultsSubject.asObservable()}getEvent(e,o){let s;if(b6.includes(e)?s=this.engineService.getEvent(e):y6.includes(e)&&(s=this.applicationEventService.getEvent(e)),!(0,m.isNil)(s))return o?s.pipe((0,yt.q)(1)):s}init(){const e=this;this.defineAPIProcedure("apiEvents.on",function(o){e.enableEvent.call(e,this,o,!1)},{hidden:!0}),this.defineAPIProcedure("apiEvents.once",function(o){e.enableEvent.call(e,this,o,!0)},{hidden:!0})}enableEvent(e,o,s){if(!this.eventsMap[o])return void console.warn("API:",`Event: ${o} not defined.`);const r=this.eventsMap[o];if("string"==typeof r){const a=this.getEvent(r,s);a?a.subscribe(c=>{e.setResult(c)}):console.warn("API:",`Error defining event: ${o}`)}else this.mapEvents(e,r,s)}mapEvents(e,o,s){const r=o.events,a=o.map;o.init&&o.init();const p=r.map(d=>{const u=this.getEvent(d,s);if(u)return u;console.warn("API:",`Error defining event: ${d}`)}).filter(d=>!(0,m.isNil)(d));(0,Li.T)(...p).subscribe(function c(d){const u=a?a(d):d;null!==u&&e.setResult(u||{})})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(Lo))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),_6=(()=>{class t{constructor(e,o,s){this.engineService=e,this.rpcService=o,this.zone=s,this.responseQueue=[],this.listening=!1,this.listen()}listen(){this.listening||(this.ngUnsubscribe||(this.ngUnsubscribe=new X.x),this.zone.runOutsideAngular(()=>{this._listen()}))}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null,this.listening=!1)}_listen(){this.listening=!0,this.engineService.getEvent(pe.Started).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.sendResponse({message:"status",status:"ready"})}),this.rpcService.onResults().pipe((0,w.R)(this.ngUnsubscribe)).subscribe(({callId:e,value:o})=>{this.sendResponse({results:{[e]:o}})}),(0,Dt.R)(window,"message").pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{const o=this.getClientRequest(e.data);if(!o)return;const{action:s,call:r}=o;"connect"===s?this.client||(this.client=e.source,this.clientOrigin=e.origin,this.sendResponse({message:"connected"}),this.flushResponseQueue()):r&&this.executeCall(o)})}getClientRequest(e){try{return JSON.parse(e)}catch{return}}sendResponse(e){const o=JSON.stringify(e);this.client?this.postClientMessage(o):this.responseQueue.push(o)}postClientMessage(e){this.client.postMessage(e,this.clientOrigin)}flushResponseQueue(){for(;this.responseQueue.length>0;)this.postClientMessage(this.responseQueue.pop())}executeCall(e){const{id:o,call:s,params:r}=e;try{this.rpcService.callAPIProcedure(o,s,r),this.rpcService.logAPIProcedure(s)}catch(a){console.error("API:",`Error executing API call [callId: ${o}, procedure: ${s}]: ${a}`)}}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(et),i.LFG(ah),i.LFG(i.R0b))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),x6=(()=>{class t{constructor(e,o,s,r,a,c,p,d,u,g,h,y,k,B,K,V,ge,F){this.store=e,this.actions=o,this.cameraService=s,this.engineService=r,this.animationService=a,this.paintService=c,this.labelsService=p,this.graphService=d,this.viewService=u,this.analyticsService=g,this.visibilityLayersService=h,this.quizService=y,this.rpcService=k,this.windowClient=B,this.applicationEventService=K,this.engineRendererService=V,this.markerService=ge,this.sceneService=F,this.webGLInfo=r.getWEBGLInfo()}listen(e,o){this.ngUnsubscribe||(this.ngUnsubscribe=new X.x),se.native&&this.initNativeEventListeners(),this.initProcedures(),this.initEvents(),e&&o&&this.logAPIUsage(o)}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}logAPIUsage(e){setInterval(()=>{const s=this.rpcService.getAPILog(),r=(0,m.uniqBy)(s,a=>a.identifier);if(r.length>0){const a=JSON.stringify(r),c=this.analyticsService.buildDeveloperAnalytic(e,Gi.Call,fo.WidgetAPI,a);this.analyticsService.sendAnalytic(c).pipe((0,w.R)(this.ngUnsubscribe)).subscribe({next:p=>{},error:p=>{throw new Error(p)}}),this.rpcService.resetAPILog()}},1e4)}initEvents(){Jo(this.rpcService,pe.HumanProgress,void 0,e=>e),function gL(t){return[{eventName:pe.HumanReady,aliasEvents:[pe.HumanStarted]},{eventName:pe.Error,aliasEvents:[pe.HumanError],mapFn:n=>n},{eventName:pe.HumanCanvasResized,aliasEvents:[pe.CanvasResized],mapFn:()=>t.selectSnapshot(M.getEnginePosition)}]}(this.store).forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),function dL(){return[{eventName:pe.SceneLoaded,mapFn:t=>t},{eventName:pe.ScenePicked,aliasEvents:[pe.PickPicked],mapFn:hx},{eventName:pe.SceneObjectsSelected,mapFn:t=>t.selectedObjectsUpdate},{eventName:pe.SceneObjectsShown,mapFn:t=>t.enabledObjectsUpdate},{eventName:pe.SceneReady,aliasEvents:[pe.Started,pe.SceneReady]},{eventName:pe.SceneRestored,mapFn:()=>!0},{eventName:pe.SceneXrayEnabled,mapFn:()=>!0},{eventName:pe.SceneXrayDisabled,mapFn:()=>!0},{eventName:me.NativeShare,mapFn:t=>t},{eventName:me.NativeDebugMessage,mapFn:t=>t}]}().forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),function KA(t){return[{eventName:pe.CameraUpdated,aliasEvents:[pe.CameraRested],mapFn:()=>Dg(t)}]}(this.cameraService).forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),function mL(){return[{eventName:pe.TimelinePlaying,mapFn:t=>t},{eventName:pe.TimelineCompleted,mapFn:()=>!0},{eventName:pe.TimelineChapterTransition,aliasEvents:[pe.TimelineChapterActivated],mapFn:t=>({previousChapter:t.oldChapterIndex,currentChapter:t.newChapterIndex,time:t.time})}]}().forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),[].forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),[].forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),function n6(t,n){return[...UL(n),...JL(t),{eventName:me.LabelsChapterInfo,mapFn:e=>Fx(n,e)},{eventName:me.LabelsCreated,mapFn:e=>ca(n,e)},{eventName:me.LabelsUpdated,mapFn:e=>ca(n,e)},{eventName:me.LabelsDestroyed,mapFn:e=>({labelId:e.id})},{eventName:me.LabelsEntered,mapFn:e=>e},{eventName:me.LabelsLeft,mapFn:e=>e},{eventName:me.LabelsPicked,mapFn:e=>e},{eventName:me.LabelsMoved,mapFn:e=>e},{eventName:me.LabelsEnabled,mapFn:()=>!0},{eventName:me.LabelsDisabled,mapFn:()=>!0},{eventName:me.LabelsShown,mapFn:e=>e},{eventName:me.LabelsHidden,mapFn:e=>e}]}(this.store,this.markerService).forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)}),function p6(t){return[{eventName:me.QuizEntered,mapFn:()=>la(t)},{eventName:me.QuizExited,mapFn:()=>!0},{eventName:me.QuizQuestionLoaded,mapFn:n=>n},{eventName:me.QuizAnswerSelected,mapFn:n=>{const{questionId:e,answerId:o}=n;return{questionId:e,answerId:o,correctAnswerIds:sh(eh(t,n.questionId))}}},{eventName:me.QuizAnswerSubmitted,mapFn:n=>{const e=eh(t,n.questionId),o=sh(e);return{questionId:n.questionId,answerIds:n.answer,correctAnswerIds:o,correct:As(e,n.answer)}}},{eventName:me.QuizCompleted,mapFn:()=>yf(Xg(t),th(t))}]}(this.store).forEach(e=>{Jo(this.rpcService,e.eventName,e.aliasEvents,e.mapFn)})}initProcedures(){(function hL(t,n,e,o){return[{procName:L.HumanInfo,actionFn:()=>({version:t,webglInfo:n,apiFunctions:e.getAPIProcedureNames().sort(),apiEvents:e.getAPIEventNames().sort()})},{procName:L.HumanCanvasInfo,actionFn:()=>o.selectSnapshot(M.getEnginePosition)}]})(Ap,this.webGLInfo,this.rpcService,this.store).forEach(e=>{ms(this.rpcService,e)}),uL(this.store,this.actions,this.engineService,this.paintService,this.cameraService,this.graphService,this.animationService,this.viewService,this.visibilityLayersService,this.applicationEventService,this.engineRendererService,this.sceneService).forEach(e=>{ms(this.rpcService,e)}),function XA(t,n){return[{procName:L.CameraInfo,actionFn:()=>Dg(n)},{procName:L.CameraOrbit,actionFn:e=>(t.dispatch(new ym(void 0===e.pitch?0:e.pitch,void 0===e.yaw?0:e.yaw)),!0)},{procName:L.CameraPan,actionFn:e=>(t.dispatch(new mm(void 0===e.x?0:e.x,void 0===e.y?0:e.y,void 0===e.z?0:e.z)),!0)},{procName:L.CameraReset,actionFn:()=>t.dispatch(new cd)},{procName:L.CameraSet,actionFn:e=>{const o=e.animate||!1;if(e.objectId)return t.dispatch(new Wi(e.objectId,o,e.animationDuration)),!0;const s=Dg(n);return t.dispatch(new Zn({eye:e.position||s.position,look:e.target||s.target,up:e.up||s.up},o)),!0}},{procName:L.CameraZoom,actionFn:e=>(t.dispatch(new ld(e||0)),!0)},{procName:L.setCameraMode,actionFn:e=>(t.dispatch(new zc("pan"===e?"pan":"rotate")),!0)},{procName:L.CameraDisableChapterCamera,actionFn:()=>(t.dispatch(new Ic(!1)),!0)},{procName:L.CameraEnableChapterCamera,actionFn:()=>(t.dispatch(new Ic(!0)),!0)}]}(this.store,this.cameraService).forEach(e=>{ms(this.rpcService,e)}),function bL(t,n,e,o){return[{procName:L.TimelineQuery,actionFn:()=>({chapters:t.selectSnapshot(_.getStoryChapters).map(r=>({description:r.description,displayName:r.displayName,annotations:r.labels.map(d=>({title:d.title,description:d.description}))}))}),hideDefinition:!0},{procName:L.TimelineInfo,actionFn:()=>function fL(t,n){const e=n.getChapterTimeFrame();return{time:n.getTime(),startTime:e.firstTime,endTime:e.lastTime,chapters:t.selectSnapshot(_.getStoryChapters).map(o=>o.id),playing:n.isPlaying()}}(t,e)},{procName:L.TimelinePlay,actionFn:s=>{if(e.setAnimationLoop(s.loop||!1),void 0===s.time&&void 0===s.chapterId)return e.play(),!0;let a=s.chapterId;return void 0===a&&(a=e.mapGlobalTimeToChapterId(s.time)),new b.y(c=>{n.pipe((0,l.cx)(Ps),(0,yt.q)(1)).subscribe(()=>{let p;void 0!==s.time&&(p=(0,xe.clamp)(e.mapChapterGlobalTime(a,s.time),0,e.getChapterDuration()),e.pause(),e.scrub(p)),e.play(),c.next(!0),c.complete()}),t.dispatch(new Ps(a))})}},{procName:L.TimelinePause,actionFn:()=>(e.pause(),!0)},{procName:L.TimelineSet,actionFn:s=>{if(void 0===s.time&&void 0===s.chapterId)return!0;let r=s.chapterId;return void 0===r&&(r=e.mapGlobalTimeToChapterId(s.time)),new b.y(a=>{n.pipe((0,l.cx)(Ps),(0,yt.q)(1)).subscribe(()=>{let c;void 0!==s.time&&(c=(0,xe.clamp)(e.mapChapterGlobalTime(r,s.time),0,e.getChapterDuration()),e.pause(),e.scrub(c)),a.next(!0),a.complete()}),t.dispatch(new Ps(r))})}},{procName:L.TimelineNext,actionFn:()=>(o.nextChapter("API"),!0)},{procName:L.TimelinePrev,actionFn:()=>(o.previousChapter("API"),!0)}]}(this.store,this.actions,this.animationService,this.viewService).forEach(e=>{ms(this.rpcService,e)}),function _L(t){return[{procName:L.InputEnable,actionFn:()=>(t.dispatch(new uc(!0)),!0)},{procName:L.InputDisable,actionFn:()=>(t.dispatch(new uc(!1)),!0)}]}(this.store).forEach(e=>{ms(this.rpcService,e)}),function wL(t,n,e,o){const s=new Hi.X(!1);return n.pipe((0,l.cx)(Pa)).subscribe(()=>{s.next(!0)}),[{procName:L.UIGetBackground,actionFn:()=>function xL(t){const{colors:n,gradientType:e,colorStops:o}=t;return{colors:Array.isArray(n)?[[n[0],n[1],n[2],n[3]],[n[4],n[5],n[6],n[7]]]:[[0,0,0,0],[0,0,0,0]],gradientType:e,colorStops:o}}(t.selectSnapshot(_.getSelectedChapterBackground))},{procName:L.UISetBackground,mapFnIn:r=>{const{colors:a,colorStops:c,gradientType:p}=r;return{colors:a&&bx(a),gradientType:p,colorStops:c}},actionFn:r=>{if(r){const a=yx(t,r);t.dispatch(new Vm(a))}return!0}},{procName:L.UIPresetBackground,mapFnIn:r=>{const{colors:a,colorStops:c,gradientType:p}=r;return{colors:a&&bx(a),gradientType:p,colorStops:c}},actionFn:r=>{if(r){const a=yx(t,r);se.platform===Yi.SDK&&s.next(!1),s.pipe((0,$.h)(c=>!!c),(0,yt.q)(1)).subscribe(()=>{t.dispatch(new Qc(a))})}return!0}},{procName:L.UIGetWorldPosition,actionFn:r=>{const{worldPos:a}=e.pick(r.x,r.y);if(a){const{0:c,1:p,2:d}=a;return{x:c,y:p,z:d}}return null}},{procName:L.UISetOndemand,actionFn:r=>(t.dispatch([new T.ToggleWindow(pt.OnDemand,r.enabled)]),!0)},{procName:L.UISetLoadingExperience,actionFn:r=>((0,m.isEmpty)(r)?t.dispatch([new T.SetInteractType(Mo.None),new T.CloseWindow(pt.Interact)]):t.dispatch([new T.SetInteractType(r),new T.OpenWindow(pt.Interact)]),!0)},{procName:L.UISetScrollCaptureMode,actionFn:r=>(t.dispatch(new _c(r)),!0)},{procName:L.UISetTutorial,actionFn:r=>(t.dispatch([new T.ToggleWindow(pt.Tutorial,r.enabled),new T.StartTutorial(r.enabled)]),!0)},{procName:L.UIGetDisplay,actionFn:()=>{const r=t.selectSnapshot(O.getUI);return{audio:r.audio.enable,fullscreen:r.fullscreen.enable,help:r.help.enable,nav:r.camera.enable,cameraMode:r.camera.enable,center:r.camera.enable,zoomIn:r.camera.enable,zoomOut:r.camera.enable,info:r.column.enable||r.drawer.enable,infoExpand:r.drawer.isExpanded,playPause:r.media.enable,scrubber:r.media.enable,"scrubber.chapters":r.media.enable,tools:r.tools.enable,"tools-display":r.tools.enable,tour:r.pagination.enable,"tour.chapters":r.pagination.enable,objectTree:r.search.enable,anatomyLabels:r.anatomyLabels.enable,share:!1,dissect:!1,xray:!1,annotations:!1,crossSection:!1,isolate:!1}}},{procName:L.UISetDisplay,actionFn:r=>{const a=function uw(t){const n=null!=t.all?zb(t.all):new Ir;return zr({all:t.all,[x.Loader]:iu(t.loader),[x.Help]:xt(t.help,t.help),[x.Tools]:xt(t.tools,t.tools),[x.Layout]:t.layout,[x.PocToolbar]:t.poc,[x.Toolbar]:t.toolbar,[x.Fullscreen]:xt(t.fullscreen,t.fullscreen),[x.Search]:xt(t.objectTree,t.search),[x.Audio]:t.audio,[x.Media]:nu(t.playPause,xt(t.scrubber,t["scrubber.chapters"]),t.media),[x.Camera]:xt(t.nav,t.cameraMode,t.center,t.zoomIn,t.zoomOut,t.nav),[x.Pagination]:xt(t.tour,t["tour.chapters"]),[x.Column]:xt(t.info,t.info),[x.Drawer]:xt(t.info,t.info),[x.TitleOnly]:xt(t.info,t.info),[x.LabelList]:xt(t.labelList,t.labelList),[x.NodeInfo]:t.anatomyDescriptions,[x.Legend]:t.legend,[x.Menu]:t.menu,[x.InternetExplorerWarning]:void 0,[x.Logo]:t.logo,drawerExpanded:t.infoExpand,[x.Labels]:void 0,[x.Presenter]:void 0,logoIsHyperLink:void 0,[x.Tutorial]:void 0,[x.AnatomyLabels]:xt(t.anatomyLabels,t.anatomyLabels),[x.Undo]:xt(t.reset,t.undo),[x.Whiteboard]:t.whiteboard,[x.VisibilityLayers]:t.visibilityLayers,[x.ContextActions]:t.contextActions,[x.ToggleLabels]:void 0},n)}(r);return t.dispatch(new Mp(a)),r}},{procName:L.UIResetDisplay,actionFn:()=>{const r=t.selectSnapshot(O.getInitialUI);t.dispatch(new T.SetUI(r))}},{procName:L.UISetQuizLock,actionFn:r=>(n.pipe((0,l.xt)(Dp),(0,yt.q)(1)).subscribe(()=>{t.dispatch(new ee.SetQuizLocked(r)),t.dispatch(new ee.SetEnableQuizRetake(r)),!0===r&&o.startQuiz()}),!0)},{procName:L.UISnapshot,aliases:[L.SceneSnapshot],mapFnIn:r=>{const{width:a,height:c}=e.getCanvas();return{width:a,height:c,openInTab:!1,fileType:"jpeg",quality:.92,...r}},actionFn:r=>{const{width:a,height:c,openInTab:p,fileType:d}=r,u=t.selectSnapshot(_.getSelectedChapterId),g={width:a,height:c},h="jpeg"===d?fi.JPEG:fi.PNG,y=t.selectSnapshot(_.getSelectedChapterBackground);return t.dispatch(new xr(u,y,h,.92,g,"original",!0,!0)).pipe((0,Di.z)(()=>n.pipe((0,l.xt)(vr),(0,yt.q)(1))),(0,Di.z)(k=>So.blobToBase64(k.blob)),(0,vo.b)(k=>{p&&k&&function vL(t){const n=window.open("","_blank");if(n){const e=n.document.createElement("img");e.src=t,n.document.body.appendChild(e)}}(k)}),(0,Vn.K)(()=>(0,Ue.of)(null)))}}]}(this.store,this.actions,this.engineRendererService,this.quizService).forEach(e=>{ms(this.rpcService,e)}),function i6(t,n,e,o,s,r){return[...RL(t,n,o,s),...HL(t,n,o),{procName:L.LabelsInfo,actionFn:a=>a.length>0?Wg(t,a):t.selectSnapshot(te.getChapterLabels),mapFnOut:a=>Fx(o,a)},{procName:L.LabelsCreate,mapFnIn:a=>a.labelId&&aa(t,a.labelId)?null:a.objectId&&a.position?function YL(t,n,e){const o=n.makeDefaultStudioLabel();o.id=e.labelId||$t.idWithPrefix("label"),o.objectId=e.objectId,o.pos=e.position,o.renderableIndex=0,o.occludable=!0,o.flyTo=!0,o.description="",o.shown=!0;const s=t.selectSnapshot(_.getSelectedChapter);return o.chapterId=s.id,Lx(o,e)}(t,n,a):(console.log("attempt to create a label with no objectId and position"),null),actionFn:a=>Kg(t,a,!0),mapFnOut:a=>ca(o,a)},{procName:L.LabelsUpdate,mapFnIn:a=>aa(t,a.labelId)?function WL(t,n){return Lx(aa(t,n.labelId),n,t.selectSnapshot(_.getSelectedChapter))}(t,a):null,actionFn:a=>Kg(t,a,!1),mapFnOut:a=>ca(o,a)},{procName:L.LabelsCanvasUpdate,mapFnIn:a=>aa(t,a.labelId)?function KL(t,n,e,o){const s=aa(t,o.labelId),r=o.canvasPosition,a=n.pick(r[0],r[1]);return a&&a.objectId?(s.objectId=a.objectId,s.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],s.offset=[s.hideWire?20:32,0],s.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],s.primitiveIndex=a.triIndex,s.renderableIndex=a.renderableIndex||0,s.dir=e.getDirection(a),s):null}(t,e,r,a):null,actionFn:a=>Kg(t,a,!1),mapFnOut:a=>ca(o,a)},{procName:L.LabelsDestroy,mapFnIn:a=>aa(t,a),actionFn:a=>a?(t.dispatch(new kr(a)),{labelId:a.id}):null},{procName:L.LabelsShow,actionFn:a=>(a.length>0?t.dispatch(new To(Wg(t,a),!0)):zx(t,!0),!0)},{procName:L.LabelsHide,actionFn:a=>(a.length>0?t.dispatch(new To(Wg(t,a),!1)):zx(t,!1),!0)},{procName:L.LabelsSetEnabled,aliases:[L.AnnotationsSetEnabled],actionFn:a=>{t.dispatch(new Wo(a.enable))},hideDefinition:!0},{procName:L.LabelsSetScale,actionFn:a=>{t.dispatch(new tl(a.scale))}}]}(this.store,this.labelsService,this.engineRendererService,this.markerService,this.sceneService,this.cameraService).forEach(e=>{ms(this.rpcService,e)}),function d6(t,n){function e(o){return t.selectSnapshot(U.getQuizModeActive)?o():{error:"quiz mode is not active"}}return[{procName:L.QuizInfo,actionFn:()=>t.selectSnapshot(U.hasQuiz)?la(t):null},{procName:L.QuizSubmit,actionFn:o=>e(()=>(n.submitQuestion(o.questionId,o.answerIds),la(t)))},{procName:L.QuizQuestion,actionFn:()=>e(()=>ih(t))},{procName:L.QuizEnter,actionFn:()=>t.selectSnapshot(U.hasQuiz)?(n.startQuiz(),!0):{error:"quiz not found"}},{procName:L.QuizExit,actionFn:()=>(n.exitQuiz(),!0)},{procName:L.QuizSelectQuestion,actionFn:o=>e(()=>(t.dispatch(new ee.SetActiveQuestion(o)),la(t)))},{procName:L.QuizNextQuestion,actionFn:()=>e(()=>(n.nextQuestion(),ih(t)))},{procName:L.QuizPreviousQuestion,actionFn:()=>e(()=>(t.dispatch(new ee.SetQuizLifecycle(mi.Question)),t.dispatch(new ee.PreviousQuestion),ih(t)))},{procName:L.QuizReset,actionFn:()=>(n.resetQuiz(),la(t))},{procName:L.QuizSet,actionFn:o=>{const{settings:s,startNumber:r,endNumber:a,locked:c}=o;if(!(0,m.isNil)(s)){const d=t.selectSnapshot(U.getQuizSettings);t.dispatch(new ee.SetQuizSettings({...d,...s}))}if("number"==typeof r||"number"==typeof a){const u=mf(t.selectSnapshot(_.getStoryChapters)),y=u.slice("number"==typeof r?r-1:0,"number"==typeof a?a:u.length);t.dispatch(new ee.SetQuestions(y))}return"boolean"==typeof c&&t.dispatch(new ee.SetQuizLocked(c)),t.dispatch(new ee.SetQuizQuestionsMode("number"==typeof r&&"number"==typeof a?"restricted":"all")),la(t)}}]}(this.store,this.quizService).forEach(e=>{ms(this.rpcService,e)})}initNativeEventListeners(){this.applicationEventService.getEvent(me.NativeSetBaseDirectory).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{window.localBaseDirectory=e}),this.applicationEventService.getEvent(me.NativeSetSdkOffline).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(e=>{window.sdkOffline=!0===e})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(l.yh),i.LFG(l.eX),i.LFG(Bn),i.LFG(et),i.LFG(Un),i.LFG(wr),i.LFG(Os),i.LFG(Oi),i.LFG(ut),i.LFG(rh),i.LFG(ai),i.LFG(Ns),i.LFG(ah),i.LFG(_6),i.LFG(Lo),i.LFG(Po),i.LFG(ol),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var fp=(()=>(function(t){t.Auth="auth"}(fp||(fp={})),fp))();class Dx{}var ch,po=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Ct=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const v6={authenticated:!1,bypassAnalytics:!1,activeRequests:new Set,loggedInteractions:{init:!1,view:!1,interactionc:!1,interactionf:!1,call:!1}};let Cn=ch=class{constructor(n,e){this.store=n,this.analyticsService=e}static isAuthenticated(n){return n.authenticated}static isFirstInteractionLogged(n){return n.loggedInteractions.interactionf}authorizeAnalyticId(n){const{activeRequests:e}=n.getState();if(!e.has(Gi.Init)){const o=this.store.selectSnapshot(tt.getWidgetState),{embedded:s,userType:r,widgetUrlConfig:a}=o,c=a["bypass-analytics"];let p;n.patchState({bypassAnalytics:c}),!s||se.native||c?n.patchState({authenticated:!0}):(p=r===Yo.User?this.analyticsService.getAnalytic(a.uaid):this.analyticsService.sendAnalytic(this.analyticsService.buildDeveloperAnalytic(o,Gi.Init,fo.WidgetAPI,this.analyticsService.buildAppActivityData(o))),e.add(Gi.Init),n.patchState({activeRequests:e}),p.pipe((0,je.x)(()=>{e.delete(Gi.Init),n.patchState({activeRequests:e})})).subscribe(d=>{const u=d.success;n.patchState({authenticated:u}),n.dispatch(u?new nL(r,d):new dx(r,d))}))}}logInteraction(n,{interaction:e,source:o}){const{activeRequests:s}=n.getState();if(!s.has(e)){const r=this.store.selectSnapshot(tt.getWidgetState),c=r.userType===Yo.User?this.analyticsService.buildUserAnalytic(r,e,o):this.analyticsService.buildDeveloperAnalytic(r,e,fo.Widget,this.analyticsService.buildAppActivityData(r));s.add(e),n.patchState({activeRequests:s}),this.analyticsService.sendAnalytic(c).pipe((0,je.x)(()=>{s.delete(e),n.patchState({activeRequests:s})})).subscribe(p=>{n.dispatch(p.success?new jg(e,p):new iL(e,p))})}}logInteractionSuccess(n,e){const{loggedInteractions:o}=n.getState();o[e.interaction]=!0,n.patchState({loggedInteractions:o})}initView(n){const e=["interactive","complete"].includes(document.readyState),o=e?(0,Ue.of)(e):(0,Dt.R)(document,"DOMContentLoaded");this.store.select(ch.isAuthenticated).pipe((0,sx.u)(o),(0,$.h)(s=>!0===s),(0,yt.q)(1)).subscribe(()=>{n.getState().bypassAnalytics||this.store.dispatch(new oc(Gi.View))})}logInteractionChance(n){const e=n.getState();!e.loggedInteractions.interactionc&&!e.bypassAnalytics&&n.dispatch(new oc(Gi.ChanceInteraction))}logFirstInteraction(n){n.getState().loggedInteractions.interactionf||n.dispatch([new Qg,new oc(Gi.FirstInteraction)])}resetFirstInteraction(n){const e=n.getState().loggedInteractions;e.interactionf=!1,n.patchState({loggedInteractions:e})}ngxsOnInit(n){n.dispatch(new ux)}};Cn.\u0275fac=function(n){return new(n||Cn)(i.LFG(l.yh),i.LFG(rh))},Cn.\u0275prov=i.Yz7({token:Cn,factory:Cn.\u0275fac}),po([(0,l.aU)(px),Ct("design:type",Function),Ct("design:paramtypes",[Object]),Ct("design:returntype",void 0)],Cn.prototype,"authorizeAnalyticId",null),po([(0,l.aU)(oc),Ct("design:type",Function),Ct("design:paramtypes",[Object,oc]),Ct("design:returntype",void 0)],Cn.prototype,"logInteraction",null),po([(0,l.aU)(jg),Ct("design:type",Function),Ct("design:paramtypes",[Object,jg]),Ct("design:returntype",void 0)],Cn.prototype,"logInteractionSuccess",null),po([(0,l.aU)(ux),Ct("design:type",Function),Ct("design:paramtypes",[Object]),Ct("design:returntype",void 0)],Cn.prototype,"initView",null),po([(0,l.aU)(Qg),Ct("design:type",Function),Ct("design:paramtypes",[Object]),Ct("design:returntype",void 0)],Cn.prototype,"logInteractionChance",null),po([(0,l.aU)(gx),Ct("design:type",Function),Ct("design:paramtypes",[Object]),Ct("design:returntype",void 0)],Cn.prototype,"logFirstInteraction",null),po([(0,l.aU)(Zg),Ct("design:type",Function),Ct("design:paramtypes",[Object]),Ct("design:returntype",void 0)],Cn.prototype,"resetFirstInteraction",null),po([(0,l.Qf)(),Ct("design:type",Function),Ct("design:paramtypes",[Dx]),Ct("design:returntype",void 0)],Cn,"isAuthenticated",null),po([(0,l.Qf)(),Ct("design:type",Function),Ct("design:paramtypes",[Dx]),Ct("design:returntype",void 0)],Cn,"isFirstInteractionLogged",null),Cn=ch=po([(0,l.ZM)({name:"modules",defaults:v6}),Ct("design:paramtypes",[l.yh,rh])],Cn);const C6=new Set([L.CameraOrbit,L.CameraPan,L.CameraReset,L.CameraSet,L.CameraZoom,L.LabelsCreate,L.LabelsDestroy,L.LabelsHide,L.LabelsShow,L.LabelsUpdate,L.QuizEnter,L.QuizExit,L.QuizSubmit,L.QuizNextQuestion,L.QuizPreviousQuestion,L.QuizReset,L.QuizSet,L.SceneColorObject,L.ScenePick,L.SceneReset,L.SceneRestore,L.SceneSelectObjects,L.SceneSetLayersSliderPosition,L.SceneShowObjects,L.SceneTransformObject,L.SceneUncolorObject,L.TimelineNext,L.TimelinePause,L.TimelinePlay,L.TimelinePrev,L.TimelineSet,L.UISnapshot]);var jx=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Qx=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function w6(t,n){1&t&&i._UZ(0,"div",3)}class or{constructor(n,e,o,s,r,a,c,p,d,u,g,h,y,k){this.document=n,this.store=e,this.actions=o,this.activatedRoute=s,this.widgetAPIHandler=r,this.errorService=a,this.engineService=c,this.cameraService=p,this.storageService=d,this.renderer=u,this.engineRendererService=g,this.viewService=h,this.quizService=y,this.rpcService=k,this.title="Biodigital Human",this.environmentApplication=mt,this.environmentPlatform=Yi,this.ngUnsubscribe=new X.x}ngOnInit(){this.initErrorHandling(),this.initAnalytics();const{data:n}=this.activatedRoute.snapshot,e=n.widgetUrlConfig;this.initWidgetBreakpoints(e),this.initWidgetLabelScale(e),this.initWidgetLayout(e),this.initWidgetSetup(e),this.initCustomWidgetSettings(e.paid),this.store.dispatch(new px),this.initBackgroundFromWidget(e),this.initBackgroundFromChapter(),this.initCamera(e),this.initRotation(e),this.initQuizInteractions(e),this.widgetAPIHandler.listen(se.deploy===pn.Production),this.initChaptersReadyListener(),this.initHumanReadyListener(),this.initDynamicLayout()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWidgetSetup(n){const e=window!==window.top,o=e?BD_DOCUMENT_REFERRER:window.location.href;this.store.dispatch(new Tp(o,e,n));const s=this.store.selectSnapshot(O.getUI),r=Ib(n),a=Ab(s,r);this.store.dispatch(new T.SetUI(a)),this.store.dispatch(new T.SetInitialUI(a));const c=function mw(t){return t["disable-scroll"]?Xi.DoNotCapture:t["disable-scroll.alert"]||t["disable-scroll.overlay"]?Xi.DoNotCaptureShowMessage:Xi.Capture}(n);this.store.dispatch(new _c(c));const p=function fw(t){return!0===t["ui-print-image"]}(n),d=function yw(t){return!1===t["auto-load"]}(n);(function _w(t){return!0===t["ui-poc-whiteboard"]})(n)&&(this.viewService.toggleWhiteboard(!0),this.store.dispatch(new T.SetWhiteboardLocked(!0)));const{interactType:u,isInteractActive:g}=function bw(t,n,e){const o=t["initial.play"]||t.initial||t["initial.button"]||t["initial.hand"]||t["initial.hand-hint"]||n;return{interactType:(()=>{switch(!0){case t.initial:case t["initial.button"]:return Mo.Button;case t["initial.hand"]:case t["initial.hand-hint"]:return Mo.Hand;case t["initial.play"]:return Mo.Play;default:return e}})(),isInteractActive:o}}(n,this.store.selectSnapshot(O.shouldWindowOpen(pt.Interact)),this.store.selectSnapshot(O.getInteractType)),h=this.storageService.getLocalItem(fn.GettingStartedTutorial),y=!0===r.tutorial&&"true"!==h;this.store.dispatch([new T.SetOnDemand(d),new T.ToggleWindow(pt.OnDemand,d),new T.SetInteractType(u),new T.ToggleWindow(pt.Interact,g),new T.ToggleWindow(pt.Tutorial,y),new T.StartTutorial(y),new T.SetUsePrintImage(p)])}initCustomWidgetSettings(n){se.offline||n&&(this.store.select(tt.getWidgetSettings).pipe((0,$.h)(e=>!(0,m.isNil)(e)&&e.length>0),(0,w.R)(this.ngUnsubscribe)).subscribe(e=>{e.forEach(o=>{o.anatomy_description_fallback&&this.viewService.setAnatomyDescriptionFallback(o.anatomy_description_fallback)})}),this.store.dispatch(new Ip(n)))}initErrorHandling(){this.actions.pipe((0,l.xt)(Bh),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>this.handleContentErrors()),this.actions.pipe((0,l.xt)(dx),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>this.handleAuthErrors(n))}initWidgetBreakpoints({"ui-collapse-label":n,"annotation-collapse":e}){const o=[n,e].find(s=>!(0,m.isNil)(s));(0,m.isNil)(o)||this.store.dispatch(new T.SetLabelBreakpoint(o))}initWidgetLabelScale({"label-scale":n}){(0,m.isNil)(n)||this.store.dispatch(new tl(n))}initWidgetLayout({"ui-layout":n}){(0,m.isNil)(n)||this.store.dispatch(new T.SetLayout(n))}initQuizInteractions(n){const e=this.store.select(Le.getSelectedBookmark);(0,bt.a)([this.store.select(U.hasQuiz),e]).pipe((0,$.h)(([o,s])=>!(0,m.isNil)(s)&&o),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(([o,s])=>{const r=this.store.selectSnapshot(U.getAllQuestions),a=n["ui-quiz"];a&&this.store.dispatch(new ee.SetQuizEnabled("false"!=`${a}`));const p="true"==`${n["ui-quiz-locked"]}`,d=s.viewMode===ki.Quiz;this.store.dispatch(new ee.SetQuizLocked(p||d)),p&&this.store.dispatch(new ee.SetEnableQuizRetake(!1));const u=parseInt(n["ui-quiz-start"],10),g=parseInt(n["ui-quiz-end"],10),h=r.length,y=isNaN(u)?1:u,k=isNaN(g)?h:g;if(1!==y||k!==h){const V=r.filter((ge,F)=>{const R=F+1;return R>=y&&R<=k});this.store.dispatch(new ee.SetQuestions(V))}const K=isNaN(u)&&isNaN(g)?"all":"restricted";this.store.dispatch(new ee.SetQuizQuestionsMode(K)),(p||d)&&setTimeout(()=>{this.quizService.startQuiz()})})}initAnalytics(){this.getIntersectionObserver(this.document.body,.75).pipe((0,yt.q)(1)).subscribe(()=>{this.store.dispatch(new Qg)});const n=this.getDocumentInteraction(),e=this.rpcService.onResults().pipe((0,$.h)(o=>C6.has(o.procedureName)));(0,Li.T)(n,e).pipe((0,cn.b)(125),(0,w.R)(this.isFirstInteractionLogged$.pipe((0,$.h)(o=>!0===o)))).subscribe(()=>{this.store.dispatch(new gx)})}initBackgroundFromWidget({background:n}){n&&(this.setWidgetTransparent(Hc(n)),this.actions.pipe((0,l.cx)(Pa),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Qc(n))}))}initBackgroundFromChapter(){this.store.select(_.getSelectedChapter).pipe((0,$.h)(n=>null!=n),(0,J.U)(n=>Hc(n.background)),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.setWidgetTransparent(n)})}initCamera({camera:n}){n&&this.actions.pipe((0,l.xt)(pr),(0,yt.q)(1),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Zn(n,!1))})}initRotation({"load-rotate":n}){if(n){let e=performance.now();(0,YA.F)(0,WA.r).pipe((0,J.U)(()=>n*(performance.now()-e)*.001),(0,vo.b)(()=>e=performance.now()),(0,w.R)(this.isFirstInteractionLogged$.pipe((0,$.h)(o=>!0===o))),(0,w.R)(this.ngUnsubscribe)).subscribe(o=>{this.cameraService.rotateCameraStatic(0,o)}),this.isFirstInteractionLogged$.pipe((0,$.h)(o=>!0===o),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(_.getSelectedChapter),s=(0,m.get)(o,"camera.location");s&&this.store.dispatch(new Zn(s,!0,2))})}}initHumanReadyListener(){this.actions.pipe((0,l.xt)(se.platform===Yi.SDK?Dp:$h)).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.engineService.fireEvent(pe.Started,null)})}initChaptersReadyListener(){this.store.select(_.getAllChaptersModelsReady).pipe((0,$.h)(n=>!0===n),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new $h)})}initDynamicLayout(){(0,bt.a)([this.store.select(tt.getWidgetApiUIConfig),this.store.select(tt.getWidgetUrlConfig),this.store.select(_.getSelectedChapter),this.store.select(U.getQuizModeActive),this.store.select(U.getActiveQuestion)]).pipe((0,$.h)(([n,e,o])=>null!=o&&null!=e),(0,w.R)(this.ngUnsubscribe)).subscribe(([n,e,o,s,r])=>{const a=Ib(e),c=function gw(t){if(!t||!t.config)return null;const n=new Ir;return n[x.Column]=t.config.info,n[x.Drawer]=t.config.info,n[x.Fullscreen]=t.config.fullscreen,n[x.Search]=t.config.objectTree,n[x.Camera]=t.config.nav,n[x.Loader]=iu(t.config.loader),n[x.Whiteboard]=t.config.whiteboard,n[x.VisibilityLayers]=t.config.visibilityLayers,n[x.ContextActions]=t.config.contextActions,n[x.Audio]=(0,m.isNil)(t.config.audio)?null:t.config.audio!==Nn.None,n[x.Media]=nu(t.config.playPause,t.config.scrubber,t.config.mediaControls),n}(o.ui),p=function hw(){const t=new Ir;return t.search=!1,t.pagination=!1,t.labelList=!1,t.labels=!1,t.anatomyLabels=!1,t.nodeInfo=!1,t.toggleLabels=!1,t.legend=!1,t}();this.viewService.setUI({apiUIConfig:n,urlUIConfig:a,chapterUIConfig:c,quizUIConfig:s?p:null})})}handleContentErrors(){this.store.dispatch(new fc(null,null)),this.errorService.redirectToErrorPage(xs.Content)}handleAuthErrors(n){se.deploy!==pn.Local&&this.errorService.redirectToErrorPage(fp.Auth,n.response.errorCode)}getDocumentInteraction(){let n,e;return new b.y(o=>{n=new un.Manager(document.documentElement),n.add([new un.Tap({event:"singletap"}),new un.Tap({event:"doubletap",taps:2}),new un.Pan({event:"pan",direction:un.DIRECTION_ALL,threshold:0})]),e=()=>o.next(),n.on("panstart",e),n.on("singletap",e),document.documentElement.addEventListener("keypress",e),document.documentElement.addEventListener("focusin",e),document.documentElement.addEventListener("wheel",e)}).pipe((0,je.x)(()=>{n&&(n.destroy(),n=null),document.documentElement.removeEventListener("keypress",e),document.documentElement.removeEventListener("focusin",e),document.documentElement.removeEventListener("wheel",e)}),(0,w.R)(this.ngUnsubscribe))}getIntersectionObserver(n,e){return new b.y(o=>{const r=new IntersectionObserver(a=>{a[0].intersectionRatio>=e&&(o.next(n),o.complete(),r.unobserve(n))},{root:null,threshold:e});r.observe(n)})}setWidgetTransparent(n){n?this.renderer.setStyle(document.body,"background","none transparent"):this.renderer.removeStyle(document.body,"background")}}or.\u0275fac=function(n){return new(n||or)(i.Y36(f.K0),i.Y36(l.yh),i.Y36(l.eX),i.Y36(We.gz),i.Y36(x6),i.Y36(Ih),i.Y36(et),i.Y36(Bn),i.Y36(dn),i.Y36(i.Qsj),i.Y36(Po),i.Y36(ut),i.Y36(Ns),i.Y36(ah))},or.\u0275cmp=i.Xpm({type:or,selectors:[["app-widget-master"]],decls:4,vars:3,consts:[[1,"widget","theme-light"],[1,"widget__messages","pt-2","pr-2","pl-2"],["class","widget-shell",4,"appFlagApplication","appFlagApplicationPlatform","appFlagApplicationMode"],[1,"widget-shell"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i._UZ(1,"router-outlet")(2,"div",1),i.qZA(),i.YNc(3,w6,1,0,"div",2)),2&n&&(i.xp6(3),i.Q6J("appFlagApplication",e.environmentApplication.All)("appFlagApplicationPlatform",e.environmentPlatform.SDK)("appFlagApplicationMode","exclude"))},dependencies:[We.lC,ql],styles:[".widget__messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:fixed;top:0;left:0;right:0;z-index:101}.widget-shell[_ngcontent-%COMP%]{pointer-events:none;position:fixed;inset:0;z-index:99999;border:1px solid #eaeff5}"]}),jx([(0,l.Ph)(tt.getBypassAnalytics),Qx("design:type",b.y)],or.prototype,"bypassAnalytics$",void 0),jx([(0,l.Ph)(Cn.isFirstInteractionLogged),Qx("design:type",b.y)],or.prototype,"isFirstInteractionLogged$",void 0);const S6={title:"We're unable to find the model you're looking for.",description:'Please check your URL or visit the <a href="/" target="_blank">BioDigital Human</a> to see what\'s available in our 3D model library.'},P6={title:"Your BioDigital Human embed requires proper authentication.",description:""},k6={[sc.InvalidUAID]:{title:"Authentication Issues",description:"Your Human Widget has invalid user credentials.",url:"https://support.biodigital.com"}};function O6(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",13),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleSeeDetailsClick())}),i._uU(1," See Details "),i.qZA()}}function T6(t,n){if(1&t&&(i.TgZ(0,"textarea",14),i._uU(1,"        "),i.qZA()),2&t){const e=i.oxw(2);i.Q6J("value",e.sceneJSErrorReport)}}function M6(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div")(1,"h1",3),i._uU(2,"The BioDigital Human encountered an error."),i.qZA(),i.TgZ(3,"h2",4),i._uU(4," Error: "),i.TgZ(5,"span",5),i._uU(6),i.qZA()(),i.TgZ(7,"div",6),i._uU(8," To receive assistance with this error, please follow these steps: "),i.qZA(),i.TgZ(9,"ol",7)(10,"li",8)(11,"button",9),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleDownloadClick())}),i._uU(12," Download "),i.qZA(),i._uU(13," the error report. "),i.qZA(),i.TgZ(14,"li",8)(15,"button",9),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleActionClick(s.supportURL))}),i._uU(16," Share the report "),i.qZA(),i._uU(17," with the customer support team. "),i.qZA()(),i.TgZ(18,"div",10),i.YNc(19,O6,2,0,"button",11),i.TgZ(20,"div"),i.YNc(21,T6,2,1,"textarea",12),i.qZA()()()}if(2&t){const e=i.oxw();i.xp6(6),i.Oqu(e.sceneJSErrorTeaser),i.xp6(13),i.Q6J("ngIf",!e.viewSceneJSErrorDetails),i.xp6(2),i.Q6J("ngIf",e.viewSceneJSErrorDetails)}}function I6(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"div",3),i._uU(1),i.qZA(),i.TgZ(2,"div",15),i.ynx(3),i.TgZ(4,"button",9),i.NdJ("click",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.handleActionClick(s.supportURL))}),i._uU(5," Contact Support "),i.qZA(),i.BQk(),i.qZA(),i._UZ(6,"div",16)}if(2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.title," "),i.xp6(5),i.Q6J("innerHTML",e.description,i.oJD)}}const Zx=[{path:"",component:or,resolve:{widgetUrlConfig:Eg},children:[{path:"",component:Ot},{path:"error",component:(()=>{class t{constructor(e,o,s){this.route=e,this.snackBar=o,this.engineService=s,this.supportURL="https://support.biodigital.com",this.isSceneJSError=!1,this.viewSceneJSErrorDetails=!1}handleSeeDetailsClick(){this.viewSceneJSErrorDetails=!0}buildSceneJSErrorReport(e,o){return{contentId:e,error:JSON.parse(atob(o)),webglInfo:this.engineService.getWEBGLInfo()}}get title(){return this.errorConfig.title}get description(){return this.errorConfig.description}ngOnInit(){const{errorType:e,errorCode:o,errorBlob:s,errorUrl:r}=this.route.snapshot.queryParams;if(e===xs.SceneJS){this.isSceneJSError=!0;const a=this.buildSceneJSErrorReport(r,s);this.sceneJSErrorTeaser=a.error.errorName,this.sceneJSErrorReport=JSON.stringify(a,null,2)}else this.errorConfig=e===xs.Content?S6:k6[o]||P6}handleDownloadClick(){(0,Wc.saveAs)(new Blob([this.sceneJSErrorReport],{type:"text/plain"}),"BioDigital_Error_Report.txt")}handleActionClick(e){window.open(e)||this.snackBar.open("Unable to open link in new window, please check your pop-up settings.")}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(We.gz),i.Y36(_i.ux),i.Y36(et))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-error-page"]],decls:4,vars:2,consts:[[1,"error"],[4,"ngIf","ngIfElse"],["notSceneJSError",""],[1,"text-24","text-bold"],[1,"text-16","mt-4","mb-8"],[1,"text-semibold"],[1,"text-16","mb-4"],[1,"text-16"],[1,"mv-4"],["app-button","","buttonType","outline","buttonTheme","light",3,"click"],[1,"mt-8"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xsmall",3,"click",4,"ngIf"],["class","error__details mt-2",3,"value",4,"ngIf"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xsmall",3,"click"],[1,"error__details","mt-2",3,"value"],[1,"flex","items-start","mt-10"],[1,"error__description","text-16","mt-8",3,"innerHTML"]],template:function(e,o){if(1&e&&(i.TgZ(0,"div",0),i.YNc(1,M6,22,3,"div",1),i.YNc(2,I6,7,2,"ng-template",null,2,i.W1O),i.qZA()),2&e){const s=i.MAs(3);i.xp6(1),i.Q6J("ngIf",o.isSceneJSError)("ngIfElse",s)}},dependencies:[f.O5,Dn],styles:[".error[_ngcontent-%COMP%]{margin:0 auto;max-width:640px;display:flex;flex-direction:column;padding:40px;color:#283853}.error[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style:decimal}.error__details[_ngcontent-%COMP%]{width:100%;height:200px}.error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#283853}"],changeDetection:0}),t})()}]}],z6=!0===se.offline?We.Bz.forRoot(Zx,{useHash:!0}):We.Bz.forRoot(Zx);let A6=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[Eg],imports:[z6,We.Bz]}),t})();var Bx=A(5013),L6=A(7851),rc=A(6709),F6=A(3238),Vx=A(4859),qx=A(4385),$x=A(3683),Gx=A(811),Jx=A(3267),Hx=A(3162);const U6={disabled:!0,animation:{enterDuration:0,exitDuration:0}},R6={...(0,Gt.LP)(),touchGestures:"off"};let Ie=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[{provide:_i.Ve,useValue:{duration:3e3}},{provide:F6.Y2,useValue:U6},{provide:Gt.Jm,useValue:R6}],imports:[is._t,Bx.HT,rc.p9,rc.p9,Vx.ot,Cl.Fk,qx.LD,jt.Tx,$x.g0,Gx.vV,He.Is,Gt.AV,_i.ZX,Ya.t,Jx.SJ,Ka.Cl,oa.U8,sa.eL,is._t,Bx.HT,L6.nZ,rc.p9,rc.p9,Vx.ot,Cl.Fk,qx.LD,jt.Tx,$x.g0,Gx.vV,He.Is,Gt.AV,_i.ZX,Ya.t,Jx.SJ,Ka.Cl,oa.U8,sa.eL,Hx.Cv]}),t})();var Yx=A(2851);let hn=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),ac=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[Ie,W.u5,f.ez,hn]}),t})(),Wx=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,W.u5]}),t})();class Kx{}let Xx=(()=>{class t{constructor(e){if(!e.accountUrl)throw new Error("Missing accountUrl. Please set in app config via ZendeskWidgetProvider");this.window=function N6(){return window}();let o=this.window;o.zEmbed||function(s,r){var a,c,p,u,g=[],h=document.createElement("iframe");o.zEmbed=function(){g.push(arguments)},o.zE=o.zE||o.zEmbed,h.src="javascript:false",h.title="",h.style.cssText="display: none",(p=(p=document.getElementsByTagName("script"))[p.length-1]).parentNode.insertBefore(h,p),u=h.contentWindow.document;try{c=u}catch{a=document.domain,h.src='javascript:var d=document.open();d.domain="'+a+'";void(0);',c=u}c.open()._l=function(){var y=this.createElement("script");a&&(this.domain=a),y.id="js-iframe-async",y.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost=e.accountUrl,this.zEQueue=g,this.body.appendChild(y)},c.write('<body onload="document._l();">'),c.close()}(),this.window.zE(()=>{e.beforePageLoad(this.window.zE)})}setLocale(e){this.window.zE(()=>{this.window.zE.setLocale(e)})}identify(e){this.window.zE(()=>{(0,m.isNil)(e)?this.window.zE("webWidget","clear"):this.window.zE.identify({name:this.getUserFullName(e),email:e.email})})}hide(){this.window.zE(()=>{this.window.zE.hide()})}show(){this.window.zE(()=>{this.window.zE.show()})}activate(e){this.window.zE(()=>{this.window.zE.activate(e)})}showWidget(e="help"){this.hide(),this.setSettings({webWidget:{helpCenter:{suppress:"contact"===e}}}),this.activate({hideOnClose:!0})}setHelpCenterSuggestions(e){this.window.zE(()=>{this.window.zE.setHelpCenterSuggestions(e)})}setSettings(e){this.window.zE(()=>{this.window.zE("webWidget","updateSettings",e)})}updateFromProfile(e){const o=[];if(null!=e){const{premium_account:r,premium_account_type:a,developer_account:c,subscription:p}=e;r?(o.push(`premium_account_${a}`),p&&o.push(`subscription_${p.subscription_provider}`)):o.push("free_account"),c&&o.push("developer_account")}const s=function zI(t){return!t?.organizations[0]?.external_account?.is_external_account&&function II(t){return!0===t?.premium_account_valid||"group"===t?.premium_account_type}(t)}(e);this.setSettings({webWidget:{position:{horizontal:"right",vertical:"bottom"},offset:{horizontal:"0px",vertical:"0px"},contactForm:{suppress:!s,tags:o,fields:[{id:"name",prefill:{"*":this.getUserFullName(e)}}]}}})}getUserFullName(e){if(e){const{first_name:o,last_name:s}=e;return`${o} ${s}`}return""}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(Kx))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),E6=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:e,useClass:e},{provide:Xx,useClass:Xx,deps:[e]}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})();class D6 extends Kx{constructor(){super(...arguments),this.accountUrl="biodigital.zendesk.com"}beforePageLoad(n){n.setLocale("en"),n.hide()}}let j6=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[E6.forRoot(D6)]}),t})(),Jn=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn,Ie]}),t})(),uo=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),pa=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,uo,Ie,Jn,hn]}),t})(),lh=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn,Ie,Jn,pa,uo]}),t})(),fs=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),ev=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Zr.mZ,Ie,fs,uo]}),t})(),bp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),ph=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),yp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Jn,Ie]}),t})(),_p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),dh=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,fs]}),t})(),xp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn]}),t})(),tv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn]}),t})(),Q6=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,ac,hn]}),t})(),nv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Jn,hn]}),t})();var iv=A(8580);let ov=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn]}),t})(),Qe=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[We.Bz,Jn,ev,Yx.e4,dh,f.ez,uo,hn,bp,ac,Ie,xp,pa,yp,ph,fs,W.UX,Wx,_p,tv,lh,j6,nv,iv.XD,ov,En.JP.forChild(),Jn,ev,dh,uo,bp,hn,ac,xp,pa,ph,yp,Q6,fs,Wx,_p,tv,lh,ov]}),t})();var Z6=A(7228),B6=A(5932),V6=A(6076),q6=A(878),$6=A(7672),G6=A(3331),J6=A(9627);[Z6.Z,B6.Z,V6.Z,q6.Z,$6.Z,G6.Z,J6.Z].forEach(t=>{(0,f.qS)(t)});let sv=(()=>{class t{static forRoot(){return{ngModule:t,providers:[{provide:i.soG,useFactory:Nh},{provide:i.ip1,useFactory:Ty,deps:[at.eN,i.soG],multi:!0}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})();class cc{}let uh=(()=>{class t{constructor(e){this.widgetURL=e}}return t.type="[Publish] Set Widget URL",t})(),rv=(()=>{class t{constructor(e){this.dimensions=e}}return t.type="[Publish] Set Dimensions",t})(),av=(()=>{class t{constructor(e,o,s,r){this.model=e,this.widgetOptions=o,this.camera=s,this.dimensions=r}}return t.type="[Publish] Get iFrame",t})(),gh=(()=>{class t{constructor(e){this.embed=e}}return t.type="[Publish] Get iFrame Success",t})(),H6=(()=>{class t{constructor(){}}return t.type="[Publish] Get iFrame Fail",t})(),cv=(()=>{class t{constructor(e,o,s){this.model=e,this.widgetOptions=o,this.camera=s}}return t.type="[Publish] Get URL",t})(),hh=(()=>{class t{constructor(e,o){this.model=e,this.url=o}}return t.type="[Publish] Get URL Success",t})(),mh=(()=>{class t{constructor(e){this.model=e}}return t.type="[Publish] Get URL Fail",t})(),lv=(()=>{class t{constructor(e){this.publishing=e}}return t.type="[Publish] Set Publishing",t})(),pv=(()=>{class t{constructor(){}}return t.type="[Publish] Reset Publishing",t})(),dv=(()=>{class t{constructor(e,o="jpeg"){this.imageData=e,this.imageType=o}}return t.type="[Publish] Save Publish Image",t})(),fh=(()=>{class t{constructor(e){this.imageURL=e}}return t.type="[Publish] Save Publish Image Success",t})(),Y6=(()=>{class t{constructor(){}}return t.type="[Publish] Save Publish Image Fail",t})(),uv=(()=>{class t{constructor(e,o,s,r,a){this.model=e,this.imageData=o,this.fileType=s,this.widgetOptions=r,this.camera=a}}return t.type="[Publish] Get Publish Image Code",t})(),W6=(()=>{class t{constructor(e){this.embed=e}}return t.type="[Publish] Get Publish Image Code Success",t})(),K6=(()=>{class t{constructor(){}}return t.type="[Publish] Get Publish Image Code Fail",t})();class Tt{}var Oe=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},z=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const gv={loading:!1,creating:!1,updating:!1,loadingCollections:!1,addingCollection:!1,reorderingCollections:!1,removingCollection:!1,updatingCollection:!1,collectionRenaming:null};let _e=class{constructor(n,e,o,s){this.organizationsService=n,this.publishService=e,this.pendoService=o,this.productService=s}static getOrganizations(n){return n.organizations}static getOrganization(n){return n.organization}static getOrganizationLogo(n){return n.organization?n.organization.group_logos.default:""}static getSelectedOrganization(n){return n.selectedOrganization}static getSelectedOrganizationProductAccountId(n){return(0,m.get)(n,"organization.product_acctid")}static getOrganizationProfile(n){return n.organizationProfile}static getOrganizationAccountSettings(n){return function X6(t,n){return t.filter(e=>e.type===n).map(e=>{const{name:o,value:s}=e;return{[o]:{value:s}}})}((0,m.get)(n,"organization.group_attributes",[]),"account_settings")}static getCollections(n){return n.collections}static getSelectedCollection(n){return n.selectedCollection}static getReorderingCollections(n){return n.reorderingCollections}static getAddingCollection(n){return n.addingCollection}static getRemovingCollection(n){return n.removingCollection}static getUpdatingCollection(n){return n.updatingCollection}static getCollectionRenaming(n){return n.collectionRenaming}static getWidgetURL(n){return n.widgetURL}static getWidgetOptions(n){return n.widgetOptions}static getAppFeatures(n){return n.appFeatures}static getCreating(n){return n.creating}static getUpdating(n){return n.updating}static getLoading(n){return n.loading}static getCollectionsLoading(n){return n.loadingCollections}static hasOrganization(n){return!(0,m.isNil)(n.organization)}static isTrial(n){return(0,m.get)(n,"organization.subscription.type","").includes("Trial")}static isTrialExpired(n){return!0===(0,m.get)(n,"organization.subscription.expired",!1)}static getSubscriptionEndDate(n){const e=(0,m.get)(n,"organization.subscription.paid_through_date_time");return(0,m.isNil)(e)?void 0:new Date(e)}static getExternalAccount({organization:n}){return n?.external_account}selectOrganization(n,e){const o=e.organization;n.patchState({selectedOrganization:o,selectedCollection:null}),o&&n.dispatch(new zu(o.id))}setOrganizations(n,e){const o=e.organizations||[],s=o[0];let r,a=null,c={...n.getState().appFeatures};if(s&&s.group_attributes){const p=s.group_attributes,d=this.organizationsService.getOrganizationAttribute(p,"widget_settings","widget_custom_url_path");d&&d.value&&(r=d.value);const u=this.organizationsService.getOrganizationAttribute(p,"widget_settings","widget_url_params");u&&u.value&&(a=this.publishService.extendWidgetOptions(new gg,u.value));const g=this.organizationsService.getOrganizationAttribute(p,"app_settings","web_app_features");g&&(c={...c,...g.value})}n.patchState({organization:s,organizations:o,widgetURL:r,widgetOptions:a,appFeatures:c}),n.dispatch(new uh(r))}getCollections(n,e){n.patchState({loadingCollections:!0}),this.organizationsService.getCollections({group_id:e.organizationId}).pipe((0,je.x)(()=>n.patchState({loadingCollections:!1}))).subscribe(o=>{n.dispatch(new Au(o))})}getCollectionsSuccess(n,e){n.patchState({collections:e.collections})}selectCollection(n,e){const{organization:o,selectedOrganization:s}=n.getState();n.patchState({selectedOrganization:s||o,selectedCollection:e.collection})}addCollection(n,e){n.patchState({addingCollection:!0}),this.organizationsService.addCollection(e.organizationId,e.collectionName).pipe((0,je.x)(()=>{n.patchState({addingCollection:!1})})).subscribe(()=>{n.dispatch(new Lu(e.organizationId,e.collectionName))},o=>{n.dispatch(new Fu(o))})}addCollectionSuccess(n,e){this.pendoService.track("Add Collection - Success",{platform:this.productService.productType})}addCollectionError(n,e){this.pendoService.track("Add Collection - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error with collection creation."})}removeCollection(n,e){n.patchState({removingCollection:!0}),this.organizationsService.removeCollection(e.collection).pipe((0,je.x)(()=>{n.patchState({removingCollection:!1})})).subscribe(()=>{n.dispatch(new Uu(e.collection))},o=>{n.dispatch(new Ru(o))})}removeCollectionSuccess(n,e){this.pendoService.track("Remove Collection - Success",{platform:this.productService.productType})}removeCollectionError(n,e){this.pendoService.track("Remove Collection - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error with collection removal."})}setCollectionRenameMode(n,e){n.patchState({collectionRenaming:e.collection})}renameCollection(n,e){n.patchState({updatingCollection:!0}),this.organizationsService.renameCollection(e.collection,e.collectionName).pipe((0,je.x)(()=>{n.patchState({updatingCollection:!1})})).subscribe(()=>{n.dispatch(new Nu(e.collection,e.collectionName))},o=>{n.dispatch(new Eu(o))})}renameCollectionSuccess(n,e){this.pendoService.track("Rename Collection - Success",{platform:this.productService.productType})}renameCollectionError(n,e){this.pendoService.track("Rename Collection - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error with collection renaming."})}reorderCollections(n,e){n.patchState({reorderingCollections:!0}),this.organizationsService.reorderCollections(e.organizationId,e.collections).pipe((0,je.x)(()=>{n.patchState({reorderingCollections:!1})})).subscribe(()=>{n.dispatch(new Du(e.organizationId,e.collections))},o=>{n.dispatch(new q2(o))})}reorderCollectionsSuccess(n,e){n.patchState({collections:[...e.collections]})}resetOrganizations(n,e){n.setState(gv)}createOrganization(n,{organization:e}){n.patchState({creating:!0}),this.organizationsService.createOrganization(e).pipe((0,je.x)(()=>n.patchState({creating:!1}))).subscribe(()=>n.dispatch(new Sy),o=>n.dispatch(new Qu(o)))}createOrganizationSuccess(n){this.pendoService.track("Team Creation - Success",{platform:this.productService.productType})}createOrganizationFail(n,e){this.pendoService.track("Team Creation - Failure",{error:(0,m.get)(e,"error.error.error.message")||"There was an error with team creation."})}updateOrganization(n,{organization:e}){n.patchState({updating:!0}),this.organizationsService.updateOrganization(e).pipe((0,je.x)(()=>n.patchState({updating:!1}))).subscribe(()=>n.dispatch(new $2),o=>n.dispatch(new G2(o)))}getOrganizationProfile(n,{request:e}){n.patchState({loading:!0}),this.organizationsService.getPublicProfile(e).pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(o=>n.dispatch(new Zu(o)),o=>n.dispatch(new J2(o)))}getOrganizationProfileSuccess(n,{organizationProfile:e}){n.patchState({organizationProfile:e})}clearOrganizationProfile(n,e){n.patchState({organizationProfile:void 0})}};_e.\u0275fac=function(n){return new(n||_e)(i.LFG(bo),i.LFG(Kr),i.LFG(Ln),i.LFG(Yn))},_e.\u0275prov=i.Yz7({token:_e,factory:_e.\u0275fac}),Oe([(0,l.aU)(fy),z("design:type",Function),z("design:paramtypes",[Object,fy]),z("design:returntype",void 0)],_e.prototype,"selectOrganization",null),Oe([(0,l.aU)(Iu),z("design:type",Function),z("design:paramtypes",[Object,Iu]),z("design:returntype",void 0)],_e.prototype,"setOrganizations",null),Oe([(0,l.aU)(zu),z("design:type",Function),z("design:paramtypes",[Object,zu]),z("design:returntype",void 0)],_e.prototype,"getCollections",null),Oe([(0,l.aU)(Au),z("design:type",Function),z("design:paramtypes",[Object,Au]),z("design:returntype",void 0)],_e.prototype,"getCollectionsSuccess",null),Oe([(0,l.aU)(by),z("design:type",Function),z("design:paramtypes",[Object,by]),z("design:returntype",void 0)],_e.prototype,"selectCollection",null),Oe([(0,l.aU)(yy),z("design:type",Function),z("design:paramtypes",[Object,yy]),z("design:returntype",void 0)],_e.prototype,"addCollection",null),Oe([(0,l.aU)(Lu),z("design:type",Function),z("design:paramtypes",[Object,Lu]),z("design:returntype",void 0)],_e.prototype,"addCollectionSuccess",null),Oe([(0,l.aU)(Fu),z("design:type",Function),z("design:paramtypes",[Object,Fu]),z("design:returntype",void 0)],_e.prototype,"addCollectionError",null),Oe([(0,l.aU)(_y),z("design:type",Function),z("design:paramtypes",[Object,_y]),z("design:returntype",void 0)],_e.prototype,"removeCollection",null),Oe([(0,l.aU)(Uu),z("design:type",Function),z("design:paramtypes",[Object,Uu]),z("design:returntype",void 0)],_e.prototype,"removeCollectionSuccess",null),Oe([(0,l.aU)(Ru),z("design:type",Function),z("design:paramtypes",[Object,Ru]),z("design:returntype",void 0)],_e.prototype,"removeCollectionError",null),Oe([(0,l.aU)(xy),z("design:type",Function),z("design:paramtypes",[Object,xy]),z("design:returntype",void 0)],_e.prototype,"setCollectionRenameMode",null),Oe([(0,l.aU)(vy),z("design:type",Function),z("design:paramtypes",[Object,vy]),z("design:returntype",void 0)],_e.prototype,"renameCollection",null),Oe([(0,l.aU)(Nu),z("design:type",Function),z("design:paramtypes",[Object,Nu]),z("design:returntype",void 0)],_e.prototype,"renameCollectionSuccess",null),Oe([(0,l.aU)(Eu),z("design:type",Function),z("design:paramtypes",[Object,Eu]),z("design:returntype",void 0)],_e.prototype,"renameCollectionError",null),Oe([(0,l.aU)(Cy),z("design:type",Function),z("design:paramtypes",[Object,Cy]),z("design:returntype",void 0)],_e.prototype,"reorderCollections",null),Oe([(0,l.aU)(Du),z("design:type",Function),z("design:paramtypes",[Object,Du]),z("design:returntype",void 0)],_e.prototype,"reorderCollectionsSuccess",null),Oe([(0,l.aU)(ju),z("design:type",Function),z("design:paramtypes",[Object,ju]),z("design:returntype",void 0)],_e.prototype,"resetOrganizations",null),Oe([(0,l.aU)(wy),z("design:type",Function),z("design:paramtypes",[Object,wy]),z("design:returntype",void 0)],_e.prototype,"createOrganization",null),Oe([(0,l.aU)(Sy),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",void 0)],_e.prototype,"createOrganizationSuccess",null),Oe([(0,l.aU)(Qu),z("design:type",Function),z("design:paramtypes",[Object,Qu]),z("design:returntype",void 0)],_e.prototype,"createOrganizationFail",null),Oe([(0,l.aU)(Py),z("design:type",Function),z("design:paramtypes",[Object,Py]),z("design:returntype",void 0)],_e.prototype,"updateOrganization",null),Oe([(0,l.aU)(ky),z("design:type",Function),z("design:paramtypes",[Object,ky]),z("design:returntype",void 0)],_e.prototype,"getOrganizationProfile",null),Oe([(0,l.aU)(Zu),z("design:type",Function),z("design:paramtypes",[Object,Zu]),z("design:returntype",void 0)],_e.prototype,"getOrganizationProfileSuccess",null),Oe([(0,l.aU)(Oy),z("design:type",Function),z("design:paramtypes",[Object,Oy]),z("design:returntype",void 0)],_e.prototype,"clearOrganizationProfile",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getOrganizations",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getOrganization",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",String)],_e,"getOrganizationLogo",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getSelectedOrganization",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",String)],_e,"getSelectedOrganizationProductAccountId",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getOrganizationProfile",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",Array)],_e,"getOrganizationAccountSettings",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getCollections",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getSelectedCollection",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getReorderingCollections",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getAddingCollection",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getRemovingCollection",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getUpdatingCollection",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getCollectionRenaming",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getWidgetURL",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getWidgetOptions",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getAppFeatures",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getCreating",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getUpdating",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getLoading",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getCollectionsLoading",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"hasOrganization",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"isTrial",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"isTrialExpired",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",void 0)],_e,"getSubscriptionEndDate",null),Oe([(0,l.Qf)(),z("design:type",Function),z("design:paramtypes",[Tt]),z("design:returntype",Object)],_e,"getExternalAccount",null),_e=Oe([(0,l.ZM)({name:"organizations",defaults:gv}),z("design:paramtypes",[bo,Kr,Ln,Yn])],_e);var wn=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Te=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const hv="/viewer",mv={publishing:!1,widgetURL:hv,dimensions:hg.dimensions,minDimensions:{width:300,height:400},aspectRatio:{width:4,height:3}};let Ft=class{constructor(n,e,o,s){this.publishService=n,this.store=e,this.snackbar=o,this.pendoService=s}static getDimensions(n){return n.dimensions}static getAspectRatio(n){return n.aspectRatio}static getMinDimensions(n){return n.minDimensions}static getWidgetURL(n){return n.widgetURL}static getPublishing(n){return n.publishing}setPublishWidgetURL(n,e){n.patchState({widgetURL:e.widgetURL||hv})}setPublishDimensions(n,e){n.patchState({dimensions:e.dimensions})}getPublishURL(n,e){const{model:o,camera:s,widgetOptions:r}=e,{widgetURL:a}=n.getState(),c=this.store.selectSnapshot(q.getUserLanguage),p=this.store.selectSnapshot(q.getSelectedUserApp),d=this.store.selectSnapshot(_e.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetURL(o,a,r,s,Ks.Single,c,p,d).subscribe(u=>{n.dispatch(new hh(o,u))},()=>{n.dispatch(new mh(o))})}getPublishURLSuccess(n,e){this.pendoService.track("Publish - Success",{type:"url",source:"publish"})}getPublishURLFail(n,e){this.snackbar.open("Unable to generate URL.")}getPublishIFrame(n,e){const{model:o,camera:s,widgetOptions:r}=e,a=n.getState(),c=a.widgetURL,p=e.dimensions??a.dimensions,d=this.store.selectSnapshot(q.getUserLanguage),u=this.store.selectSnapshot(q.getSelectedUserApp),g=this.store.selectSnapshot(_e.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetEmbed(o,c,r,p,s,Ks.Single,d,u,g).subscribe(h=>{n.dispatch(new gh(h))},()=>{n.dispatch(new H6)})}setPublishIFrameSuccess(n,e){this.pendoService.track("Publish - Success",{type:"iframe",source:"publish"})}savePublishImage(n,{imageData:e,imageType:o}){this.publishService.saveUserImage(e,o).subscribe(s=>{n.dispatch(new fh(s))},()=>{n.dispatch(new Y6)})}savePublishImageSuccess(n,e){this.pendoService.track("Publish - Success",{type:"image",source:"publish"})}getPublishImage(n,e){const{model:o,camera:s,widgetOptions:r,imageData:a,fileType:c}=e,{widgetURL:p}=n.getState(),d=this.store.selectSnapshot(q.getUserLanguage),u=this.store.selectSnapshot(q.getSelectedUserApp);(0,On.D)(this.publishService.generateWidgetURL(o,p,r,s,Ks.Single,d,u),this.publishService.saveUserImage(a,c)).subscribe(([g,h])=>{const y=this.publishService.getImageEmbed(o.title,g,h);n.dispatch(new W6(y))},()=>{n.dispatch(new K6)})}setPublishing(n,{publishing:e}){n.patchState({publishing:e})}resetPublish(n,e){n.setState(mv)}};Ft.\u0275fac=function(n){return new(n||Ft)(i.LFG(Kr),i.LFG(l.yh),i.LFG(_i.ux),i.LFG(Ln))},Ft.\u0275prov=i.Yz7({token:Ft,factory:Ft.\u0275fac}),wn([(0,l.aU)(uh),Te("design:type",Function),Te("design:paramtypes",[Object,uh]),Te("design:returntype",void 0)],Ft.prototype,"setPublishWidgetURL",null),wn([(0,l.aU)(rv),Te("design:type",Function),Te("design:paramtypes",[Object,rv]),Te("design:returntype",void 0)],Ft.prototype,"setPublishDimensions",null),wn([(0,l.aU)(cv),Te("design:type",Function),Te("design:paramtypes",[Object,cv]),Te("design:returntype",void 0)],Ft.prototype,"getPublishURL",null),wn([(0,l.aU)(hh),Te("design:type",Function),Te("design:paramtypes",[Object,hh]),Te("design:returntype",void 0)],Ft.prototype,"getPublishURLSuccess",null),wn([(0,l.aU)(mh),Te("design:type",Function),Te("design:paramtypes",[Object,mh]),Te("design:returntype",void 0)],Ft.prototype,"getPublishURLFail",null),wn([(0,l.aU)(av),Te("design:type",Function),Te("design:paramtypes",[Object,av]),Te("design:returntype",void 0)],Ft.prototype,"getPublishIFrame",null),wn([(0,l.aU)(gh),Te("design:type",Function),Te("design:paramtypes",[Object,gh]),Te("design:returntype",void 0)],Ft.prototype,"setPublishIFrameSuccess",null),wn([(0,l.aU)(dv),Te("design:type",Function),Te("design:paramtypes",[Object,dv]),Te("design:returntype",void 0)],Ft.prototype,"savePublishImage",null),wn([(0,l.aU)(fh),Te("design:type",Function),Te("design:paramtypes",[Object,fh]),Te("design:returntype",void 0)],Ft.prototype,"savePublishImageSuccess",null),wn([(0,l.aU)(uv),Te("design:type",Function),Te("design:paramtypes",[Object,uv]),Te("design:returntype",void 0)],Ft.prototype,"getPublishImage",null),wn([(0,l.aU)(lv),Te("design:type",Function),Te("design:paramtypes",[Object,lv]),Te("design:returntype",void 0)],Ft.prototype,"setPublishing",null),wn([(0,l.aU)(pv),Te("design:type",Function),Te("design:paramtypes",[Object,pv]),Te("design:returntype",void 0)],Ft.prototype,"resetPublish",null),wn([(0,l.Qf)(),Te("design:type",Function),Te("design:paramtypes",[cc]),Te("design:returntype",void 0)],Ft,"getDimensions",null),wn([(0,l.Qf)(),Te("design:type",Function),Te("design:paramtypes",[cc]),Te("design:returntype",void 0)],Ft,"getAspectRatio",null),wn([(0,l.Qf)(),Te("design:type",Function),Te("design:paramtypes",[cc]),Te("design:returntype",void 0)],Ft,"getMinDimensions",null),wn([(0,l.Qf)(),Te("design:type",Function),Te("design:paramtypes",[cc]),Te("design:returntype",void 0)],Ft,"getWidgetURL",null),wn([(0,l.Qf)(),Te("design:type",Function),Te("design:paramtypes",[cc]),Te("design:returntype",void 0)],Ft,"getPublishing",null),Ft=wn([(0,l.ZM)({name:"publish",defaults:mv}),Te("design:paramtypes",[Kr,l.yh,_i.ux,Ln])],Ft);let e4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,hn,W.u5,W.UX]}),t})(),fv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,W.UX,Qe,Yx.e4,iv.XD,e4,l.$l.forFeature([Ft])]}),t})(),vp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([Le]),f.ez,Ie,W.UX,Qe,We.Bz,fv]}),t})();class tn{}var Cp=(()=>(function(t){t[t.Query=0]="Query",t[t.Path=1]="Path"}(Cp||(Cp={})),Cp))(),lc=(()=>(function(t){t[t.List=0]="List",t[t.Card=1]="Card"}(lc||(lc={})),lc))();const t4=se.application===mt.Loft?lc.List:lc.Card;var da=(()=>(function(t){t.Success="success",t.Fail="fail"}(da||(da={})),da))();const n4="cdb/content",i4="cdb/copy/content",o4={headers:new at.WM({"Content-Type":"application/json; charset=utf-8"})},s4=["production","client","preview","internal_content","public_preview","demos","social","exports","real_data"];let bv=(()=>{class t{constructor(e,o){this.http=e,this.sceneService=o}saveModule(e,o){o=this.formatModulePath(o);const s=[n4,"modules",o].join("/"),r=this.JSONStringify(e);return this.http.put(s,r,o4).pipe((0,J.U)(()=>da.Success),(0,Vn.K)(({status:a})=>(0,Ue.of)(a>=200&&a<=202?da.Success:da.Fail)))}mergeModule(e,o,s="exception"){return this.http.post("/cdb/merge/modules",{loft:`${e}.json`,bridge:`${o}.json`,merge_option:s})}copyState(e,o){const s=[i4,"states",o].join("/"),r={headers:new at.WM({"Content-Type":"application/json; charset=utf-8","source-state":e})};return this.http.put(s,{},r)}listContents(e,o,s,r=!1){const a=this.generateModulePath(e,o||"",s||"");return this.http.get(`/cdb/ls/content/modules/${a}`).pipe((0,J.U)(c=>r?c.contents.map(d=>{const u=d.name.replace("/content/modules/","").replace(".json",""),g=d.name.split("/").pop().replace("/content/modules","").replace(".json",""),h=new vs;return h.id=u,h.title=g,h.type=Xe.Module,h}):c.contents))}getState(e){return this.http.get(`/cdb/ls/content/states/${e}`).pipe((0,J.U)(o=>o.contents))}getClients(){return this.http.get("/search/client").pipe((0,J.U)(e=>e.clients))}getUsedStates(){const e={};return Object.values(this.sceneService.getObjects()).reduce((o,s)=>(["transformId","morphId","geometryId","materialId"].forEach(r=>{const a=this.getPropertyState(s,r);a.length&&(e[a]=!0)}),s.hasOwnProperty("renderables")&&["morphId","geometryId","materialId"].forEach(r=>{s.renderables.forEach(c=>{const p=this.getPropertyState(c,r);p.length&&(e[p]=!0)})}),o),{}),Object.keys(e)}parseScenePath(e){const o=e.split("/");return 1===o.length?null:{fullPath:`https://qa.biodigital.com/content/modules/${e}`,relativePath:o.slice(0,o.length-1).join("/"),sceneName:o[o.length-1]}}formatModulePath(e){let o=e;return/\.json$/.test(e)||(o=`${o}.json`),o}getPrimaryCategories(){return(0,Ue.of)(s4)}getSecondaryCategories(e){switch(e){case"production":return(0,Ue.of)(["maleAdult","femaleAdult"]);case"client":return this.getClients();default:return(0,Ue.of)([])}}generateSaveModule(e){const o=this.parseScenePath(e),s=o.relativePath.split("/");return{id:e,name:o.sceneName,primaryCategory:s[0]||"",secondaryCategory:s[1]||""}}generateModulePath(e,o,s){const r=[];return e.length&&r.push(e),o.length&&r.push(o),s.length&&(s.indexOf(".json")<0&&(s=`${s}.json`),r.push(s)),r.join("/")}getPropertyState(e,o){return null!=e[o]?e[o].split("/")[0]:""}JSONStringify(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,o=>"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(Ut))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var nn=(()=>(function(t){t.Organization="Organization",t.Collection="Collection",t.Private="Private",t.Category="Category",t.Community="Community",t.Internal="Internal",t.Loft="Loft"}(nn||(nn={})),nn))();class r4{constructor(n="",e,o=25,s=0){this.query=n,this.sortBy=e,this.pageSize=o,this.offset=s}}class yv{}let _v=(()=>{class t{constructor(e){this.store=e}ngOnInit(){}close(){this.store.dispatch(new Ee.ShowFilters(!1,!0))}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(l.yh))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-gallery-drawer"]],decls:8,vars:2,consts:[["appEventFence","","data-test","galleryDrawer",1,"gallery-drawer"],[1,"gallery-drawer__header"],[1,"gallery-drawer__label"],["app-button","","buttonType","ghost","buttonTheme","light","type","button","title","Close","data-test","galleryDrawerClose",3,"click"],["icon","times","size","lg"],[1,"gallery-drawer__body"],["viewMode","expanded"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),i._uU(3,"Filters"),i.qZA(),i.TgZ(4,"button",3),i.NdJ("click",function(){return o.close()}),i._UZ(5,"app-icon",4),i.qZA()(),i.TgZ(6,"div",5),i._UZ(7,"app-gallery-filters",6),i.qZA()()),2&e&&(i.Q6J("@expand",void 0),i.xp6(4),i.uIk("aria-label","Close"))},styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.gallery-drawer[_ngcontent-%COMP%]{box-shadow:0 11px 15px #0003,0 24px 38px #00000024,0 9px 46px #0000001f;background:white;border-radius:16px 16px 0 0;display:block;position:fixed;bottom:0;top:auto;width:100vw}.gallery-drawer__header[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em;font-weight:600;border-bottom:1px solid #eaeff5;height:52px;padding:0 12px 0 20px;display:flex;align-items:center}.gallery-drawer__label[_ngcontent-%COMP%]{flex:1 0 auto}.gallery-drawer__body[_ngcontent-%COMP%]{padding:20px}"],data:{animation:[(0,j.X$)("expand",[(0,j.eR)(":enter",[(0,j.vP)([(0,j.oB)({top:"100%"}),(0,j.jt)("250ms ease-in-out",(0,j.oB)({top:"*"}))])])])]},changeDetection:0}),t})(),xv=(()=>{class t{constructor(e,o){this.overlay=e,this.store=o}openDrawer(){this.overlayRef||this._createOverlay();const e=new sa.C5(_v);this.overlayRef.attach(e)}closeDrawer(){this.overlayRef.detach()}_createOverlay(){const e=new oa.X_({hasBackdrop:!0,scrollStrategy:this.overlay.scrollStrategies.block()});this.overlayRef=this.overlay.create(e),this.overlayRef.backdropClick().subscribe(()=>{this.store.dispatch(new Ee.ShowFilters(!1,!0))})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(oa.aV),i.LFG(l.yh))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const wp={title:"Tags",tags:["Animated","Tour","Quiz","featured","new"]},bh={title:"Type",tags:["Anatomy","Disease","Pharmacology","Physiology","Procedure"]},yh={title:"Level of Detail",tags:["Gross Anatomy","Tissue","Cellular","Molecular"]},vv={title:"Downloaded",tags:["Downloaded"]},m4=[{title:"Status",tags:["Live","obsolete"]},{title:"Paywall",tags:["Premium","Basic"]},{title:"Platform",tags:["web platform","ios platform","android platform"]},wp,{title:"Flags",tags:["animated","tour","Audio","low definition"]},{title:"Gender",tags:["male","female"]},bh,yh,{title:"Anatomy Categories",tags:["complete anatomy","system","regional","Bony Landmarks","Cross Section","Cross Section and Micro Anatomy","Micro Anatomy","Origins and Insertions"]},{title:"Clinical Specialty",tags:["Allergy and Immunology","Cardiology","Dentistry","Dermatology","Endocrinology","Gastroenterology and Hepatology","Gynecology","Infectious Disease","Nephrology","Neurology and Psychiatry","Obstetrics","Oncology and Hematology","Ophthalmology","Orthopedics","Otolaryngology","Pediatrics","Physical Therapy","Primary Care","Pulmonology and Respiratory","Rheumatology","Urology"]},{title:"Health Conditions",tags:["Blood, Heart and Circulation","Brain and Nerves","Ear, Nose and Throat","Eyes and Vision","Immune System","Lungs and Breathing","Mouth and Teeth","Bones, Joints and Muscles","Digestive System","Endocrine System","Female Reproductive System","Male Reproductive System","Skin, Hair and Nail"]},vv];class f4{constructor(n,e=[],o=""){this.categoryId=n,this.tags=e,this.query=o,this.type=nn.Category}}class b4{constructor(n="",e=[]){this.query=n,this.tags=e,this.categoryId="public",this.type=nn.Community}}class Mt{static getOfflineModelIDs(){return Mt._offlineModelIDs$}static setOfflineModelIDs(n){Mt._offlineModelIDs.next(n)}static getOfflineModelIDList(){return this._offlineModelIDs.getValue()}static setStore(n){Mt.store=n}static setServices(n,e){Mt.rpcService=n,Mt.applicationEventService=e}static setSnackBar(n){Mt.snackBar=n}static setRouter(n){Mt.router=n}static debug(n){this.fire(me.NativeDebugMessage,n)}static fire(n,e){Mt.applicationEventService&&Mt.applicationEventService.fireEvent(n,e)}on(n,e){Mt.rpcService&&Mt.rpcService.getEvent(n,!1).subscribe(e)}send(n,e){let o=null,s={};switch(n){case L.NativeErrorMessage:o=Mt.snackBar.open(e,"OK",{duration:6e3,verticalPosition:"top"}),o.onAction().subscribe(()=>{o.dismiss()});break;case L.NativeSetAppVersion:Mt.appVersion=e.appVersion;break;case L.NativeRedirect:s=JSON.parse(e.queryItems),Mt.router.navigate([e.url],{queryParams:s});break;case L.NativeReload:window.location.href=e.url;break;case L.NativeOfflineModelIds:Mt.setOfflineModelIDs(e.modelIds);break;default:Mt.debug("unprocessed HumanWindowAPI send "+n)}}}Mt.store=null,Mt.snackBar=null,Mt.router=null,Mt.appVersion="",Mt._offlineModelIDs=new Hi.X([]),Mt._offlineModelIDs$=Mt._offlineModelIDs.asObservable();var Ze=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Q=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Cv={loading:!0,searchMode:Cp.Query,viewMode:t4,showFilters:!1,searchResults:{total:0,items:[]},checkedResults:[],searchConfig:null,searchOptions:null,sidenav:{enabled:!0,open:!0,disableClose:!1},bulkActions:{enabled:!0,active:!1,items:[]},cardActions:{enabled:!0}},y4=[...bh.tags,...yh.tags,...wp.tags];let ze=class{constructor(n,e,o,s,r,a){this.organizationsService=n,this.modulesService=e,this.exploreService=o,this.bookmarksService=s,this.galleryService=r,this.store=a}static getLoading(n){return n.loading}static getSearchMode(n){return n.searchMode}static getSearchConfig(n){return n.searchConfig}static getSearchOptions(n){return n.searchOptions}static getAvailableTags(n){const e=[],o=n.searchResults.items,s=se.native?Mt.getOfflineModelIDList():[];return o.forEach(r=>{r.tags.forEach(a=>{"quiz"===a&&(a="Quiz"),y4.includes(a)&&!e.includes(a)&&e.push(a)}),se.native&&s.includes(r.id)&&!e.includes("Downloaded")&&e.push("Downloaded")}),e}static getActiveTags(n){const o={};return n.searchConfig.tags.forEach(s=>{const r=m4.find(c=>c.tags.some(p=>p===s)),a=(0,m.get)(r,"title","");o[a]=s}),o}static getActiveTagsCount(n){return(0,m.compact)(n.searchConfig.tags).length}static getSearchType(n){return n.searchConfig?n.searchConfig.type:null}static getSearchGroup(n){switch(n.searchConfig?.type){case nn.Category:case nn.Community:case nn.Internal:case nn.Loft:return Xe.Module;case nn.Collection:case nn.Private:case nn.Organization:return Xe.Bookmark}}static getViewMode(n){return n.viewMode}static getShowFilters(n){return n.showFilters}static getSort(n){return n.searchOptions.sortBy}static getSortOptions(n){switch(n.searchConfig.type){case nn.Loft:return[ec,ep];case nn.Category:return[j_,Xl,ec,ep];default:return[Xl,ec,ep,Q_,Z_]}}static getSidenav(n){return n.sidenav}static getBulkActions(n){return n.bulkActions}static getBulkActionsAvailable(n){const{enabled:e,items:o}=n.bulkActions;return e&&o.length>0}static getBulkActionsActive(n){return n.bulkActions.active}static getCardActions(n){return n.cardActions}static getFilteredResults(n,e){const{searchResults:o,searchOptions:s}=n,{ascending:r,fields:a}=s.sortBy,{offset:c,pageSize:p}=s,d=yg(o.items,a,r).slice(c,c+p);return{...o,items:d}}static getAllResults(n,e){const{searchResults:o,searchOptions:s}=n,{ascending:r,fields:a}=s.sortBy,c=yg(o.items,a,r);return{total:o.total,items:c}}static getCheckedResults(n){return n.checkedResults}setSearchMode(n,e){n.patchState({searchMode:e.searchMode})}setViewMode(n,e){n.patchState({viewMode:e.viewMode})}showFilters(n,e){n.patchState({showFilters:e.show}),e.triggerDrawer&&(e.show?this.galleryService.openDrawer():this.galleryService.closeDrawer())}setSearchOptions(n,e){n.patchState({searchOptions:{...e.options}})}setActiveTags(n,e){const s={...n.getState().searchConfig,tags:(0,m.flatten)(Object.values(e.activeTags))};this.store.dispatch(new Ee.SetSearchConfig(s))}setSearchConfig(n,e){const o=e.config||n.getState().searchConfig,s=e.options||n.getState().searchOptions;null!==o&&n.patchState({searchOptions:{...s},searchConfig:{...o}})}searchCategory(n,{categoryId:e}){const o="public"===e?new b4(""):new f4(e);n.dispatch(new Ee.SetSearchConfig(o))}searchStudio(n,e){const{searchConfig:o,searchOptions:s}=n.getState(),r=new r4("",ec),a=this.store.selectSnapshot(q.getUserLanguage);n.patchState({loading:!0,searchOptions:{...s,pageSize:r.pageSize,offset:r.offset},checkedResults:[]});let c=new b.y;switch(o.type){case nn.Category:c=this.exploreService.getAnatomyCategory(o.query,"all"===o.categoryId?"":o.categoryId,o.tags.filter(d=>!d.startsWith("Downloaded")),a);break;case nn.Organization:c=this.bookmarksService.getOrganizationContent(o.organizationId,o.query,a);break;case nn.Collection:c=this.organizationsService.getCollectionContent(o.organizationId,o.collectionId,o.query,a);break;case nn.Community:c=this.bookmarksService.getPublicBookmarks(o.query,a);break;case nn.Private:c=this.bookmarksService.getPrivateContent(o.query,a);break;case nn.Internal:c=this.exploreService.searchInternal(o.query,o.directory);break;case nn.Loft:const p=o.query.indexOf(".json")>0;c=this.modulesService.listContents(o.primary,o.secondary,p?o.query:"",!0).pipe((0,J.U)(d=>p?d:d.filter(u=>u.title.indexOf(o.query)>=0)))}c.pipe((0,je.x)(()=>n.patchState({loading:!1}))).subscribe(p=>{const d=se.native?Mt.getOfflineModelIDList():[],u=o.tags.includes("Downloaded")?p.filter(g=>d.includes(g.id)):p;n.dispatch(new Ee.SearchSuccess(u))})}searchSuccess(n,e){n.patchState({searchResults:{items:e.bookmarks,total:e.bookmarks.length}})}checkItem(n,e){let o=n.getState().checkedResults;const s=o.some(r=>r===e.id);e.checked&&!s?o=[...o,e.id]:e.checked||(o=o.filter(r=>r!==e.id)),n.patchState({checkedResults:o})}checkAll(n,e){const o=n.getState().searchResults.items.map(s=>s.id);n.patchState({checkedResults:o})}uncheckAll(n,e){n.patchState({checkedResults:[]})}setCheckedItems(n,e){n.patchState({checkedResults:e.ids})}setSidenav(n,e){n.patchState({sidenav:{...e.sidenav}})}setCardActions(n,e){n.patchState({cardActions:{...e.cardActions}})}setBulkActions(n,e){const{bulkActions:o}=n.getState();n.patchState({bulkActions:{...o,...e.bulkActions}})}clearResults(n,e){n.patchState({searchResults:{items:[],total:0}})}resetGallery(n,e){n.patchState(Cv)}};ze.\u0275fac=function(n){return new(n||ze)(i.LFG(bo),i.LFG(bv),i.LFG(ip),i.LFG(Xa),i.LFG(xv),i.LFG(l.yh))},ze.\u0275prov=i.Yz7({token:ze,factory:ze.\u0275fac}),Ze([(0,l.aU)(Ee.SetSearchMode),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetSearchMode]),Q("design:returntype",void 0)],ze.prototype,"setSearchMode",null),Ze([(0,l.aU)(Ee.SetViewMode),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetViewMode]),Q("design:returntype",void 0)],ze.prototype,"setViewMode",null),Ze([(0,l.aU)(Ee.ShowFilters),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.ShowFilters]),Q("design:returntype",void 0)],ze.prototype,"showFilters",null),Ze([(0,l.aU)(Ee.SetSearchOptions),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetSearchOptions]),Q("design:returntype",void 0)],ze.prototype,"setSearchOptions",null),Ze([(0,l.aU)(Ee.SetActiveTags),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetActiveTags]),Q("design:returntype",void 0)],ze.prototype,"setActiveTags",null),Ze([(0,l.aU)(Ee.SetSearchConfig),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetSearchConfig]),Q("design:returntype",void 0)],ze.prototype,"setSearchConfig",null),Ze([(0,l.aU)(Ee.SearchCategory),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SearchCategory]),Q("design:returntype",void 0)],ze.prototype,"searchCategory",null),Ze([(0,l.aU)(Ee.SearchStudio),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SearchStudio]),Q("design:returntype",void 0)],ze.prototype,"searchStudio",null),Ze([(0,l.aU)(Ee.SearchSuccess),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SearchSuccess]),Q("design:returntype",void 0)],ze.prototype,"searchSuccess",null),Ze([(0,l.aU)(Ee.CheckItem),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.CheckItem]),Q("design:returntype",void 0)],ze.prototype,"checkItem",null),Ze([(0,l.aU)(Ee.CheckAll),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.CheckAll]),Q("design:returntype",void 0)],ze.prototype,"checkAll",null),Ze([(0,l.aU)(Ee.UncheckAll),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.UncheckAll]),Q("design:returntype",void 0)],ze.prototype,"uncheckAll",null),Ze([(0,l.aU)(Ee.SetCheckedItems),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetCheckedItems]),Q("design:returntype",void 0)],ze.prototype,"setCheckedItems",null),Ze([(0,l.aU)(Ee.SetSidenav),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetSidenav]),Q("design:returntype",void 0)],ze.prototype,"setSidenav",null),Ze([(0,l.aU)(Ee.SetCardActions),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetCardActions]),Q("design:returntype",void 0)],ze.prototype,"setCardActions",null),Ze([(0,l.aU)(Ee.SetBulkActions),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.SetBulkActions]),Q("design:returntype",void 0)],ze.prototype,"setBulkActions",null),Ze([(0,l.aU)(Ee.ClearResults),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.ClearResults]),Q("design:returntype",void 0)],ze.prototype,"clearResults",null),Ze([(0,l.aU)(Ee.Reset),Q("design:type",Function),Q("design:paramtypes",[Object,Ee.Reset]),Q("design:returntype",void 0)],ze.prototype,"resetGallery",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getLoading",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSearchMode",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSearchConfig",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSearchOptions",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getAvailableTags",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getActiveTags",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getActiveTagsCount",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSearchType",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSearchGroup",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getViewMode",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getShowFilters",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSort",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSortOptions",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getSidenav",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getBulkActions",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getBulkActionsAvailable",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",Boolean)],ze,"getBulkActionsActive",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getCardActions",null),Ze([(0,l.Qf)([q]),Q("design:type",Function),Q("design:paramtypes",[tn,ht]),Q("design:returntype",yv)],ze,"getFilteredResults",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn,ht]),Q("design:returntype",yv)],ze,"getAllResults",null),Ze([(0,l.Qf)(),Q("design:type",Function),Q("design:paramtypes",[tn]),Q("design:returntype",void 0)],ze,"getCheckedResults",null),ze=Ze([(0,l.ZM)({name:"gallery",defaults:Cv}),Q("design:paramtypes",[bo,bv,ip,Xa,xv,l.yh])],ze);const _4=["app-pill-button",""],x4=function(t){return{"pill-button--selected":t}},v4=["*"];let C4=(()=>{class t{constructor(){this.selected=!1}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["button","app-pill-button",""],["a","app-pill-button",""]],inputs:{selected:"selected"},attrs:_4,ngContentSelectors:v4,decls:2,vars:3,consts:[[1,"pill-button",3,"ngClass"]],template:function(e,o){1&e&&(i.F$t(),i.TgZ(0,"span",0),i.Hsn(1),i.qZA()),2&e&&i.Q6J("ngClass",i.VKq(1,x4,o.selected))},dependencies:[f.mk],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}[_nghost-%COMP%]{border-color:transparent;background:none;border-width:0;padding:0;margin:0;border-radius:4px;outline:0 none}[_nghost-%COMP%]:not([disabled]):hover{cursor:pointer}[_nghost-%COMP%]:focus   .pill-button[_ngcontent-%COMP%]{outline:#2d72dc solid 2px!important}[_nghost-%COMP%]:disabled   .pill-button[_ngcontent-%COMP%], [_nghost-%COMP%]:disabled:hover   .pill-button[_ngcontent-%COMP%]{background-color:#f9fafd;color:#96a8c0}.pill-button[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em;font-family:Inter UI,sans-serif;font-weight:500;color:#374a68;display:flex;align-items:center;justify-content:center;background-color:#eaeff5;border-radius:100px;padding:8px 16px;transition:background-color .12s,color .12s;width:100%}.pill-button[_ngcontent-%COMP%]:hover{background-color:#d7e0ea}.pill-button--selected[_ngcontent-%COMP%], .pill-button--selected[_ngcontent-%COMP%]:hover{background-color:#2d72dc;color:#fff}"],changeDetection:0}),t})();function P4(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"li",9)(1,"button",10),i.NdJ("click",function(){const r=i.CHM(e).$implicit,a=i.oxw().$implicit,c=i.oxw(2);return i.KtG(c.setTag(a.title,c.activeTags[a.title]===r?"":r))}),i.ALo(2,"async"),i._uU(3),i.ALo(4,"titlecase"),i.qZA()()}if(2&t){const e=n.$implicit,o=i.oxw().$implicit,s=i.oxw(2);let r;i.xp6(1),i.Q6J("disabled",!(null!=(r=i.lcZ(2,3,s.availableTags$))&&r.includes(e)))("selected",s.activeTags[o.title]===e),i.xp6(2),i.hij(" ",i.lcZ(4,5,e)," ")}}function k4(t,n){if(1&t&&(i.TgZ(0,"div",5)(1,"h2",6),i._uU(2),i.qZA(),i.TgZ(3,"ul",7),i.YNc(4,P4,5,7,"li",8),i.qZA()()),2&t){const e=n.$implicit;i.xp6(2),i.Oqu(e.title),i.xp6(2),i.Q6J("ngForOf",e.tags)}}function O4(t,n){if(1&t&&(i.TgZ(0,"div",3),i.YNc(1,k4,5,2,"div",4),i.qZA()),2&t){const e=i.oxw();i.Q6J("@show",void 0),i.xp6(1),i.Q6J("ngForOf",e.tagGroups)}}function T4(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"li",9)(1,"button",14),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2).$implicit,r=i.oxw(2);return i.KtG(r.setTag(s.title,""))}),i.TgZ(2,"span",15),i._uU(3),i.ALo(4,"titlecase"),i.qZA(),i._UZ(5,"app-icon",16),i.qZA()()}if(2&t){const e=i.oxw().$implicit;i.xp6(3),i.Oqu(i.lcZ(4,1,e))}}function M4(t,n){if(1&t&&(i.ynx(0),i.YNc(1,T4,6,3,"li",13),i.BQk()),2&t){const e=n.$implicit,o=i.oxw().$implicit,s=i.oxw(2);i.xp6(1),i.Q6J("ngIf",s.activeTags[o.title]===e)}}function I4(t,n){if(1&t&&(i.ynx(0),i.YNc(1,M4,2,1,"ng-container",12),i.BQk()),2&t){const e=n.$implicit;i.xp6(1),i.Q6J("ngForOf",e.tags)}}function z4(t,n){if(1&t&&(i.TgZ(0,"ul",11),i.YNc(1,I4,2,1,"ng-container",12),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngForOf",e.tagGroups)}}class ua{constructor(n,e,o){this.changeDetectorRef=n,this.store=e,this.router=o,this.activeTagList=[],this.ngUnsubscribe=new X.x,this._viewMode="expanded",this.tagGroups=[],this._activeTags={},this.selectedTagChange=new i.vpe}get viewMode(){return this._viewMode}set viewMode(n){this._viewMode=n}get activeTags(){return this._activeTags}set activeTags(n){null==n&&(n={}),this._activeTags=n,this.activeTagList=Object.values(this.activeTags).reduce((e,o)=>(""!=o&&e.push(o),e),[]),this.changeDetectorRef.markForCheck()}ngOnInit(){this.store.select(ze.getActiveTags).pipe((0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.activeTags=n}),this.tagGroups=[],se.native&&this.tagGroups.push(vv),this.isExplore()&&(this.tagGroups=this.tagGroups.concat([bh,yh,{...wp,tags:(0,m.without)(wp.tags,"Quiz")}]))}isExplore(){return this.router.url.indexOf("/results/modules")>=0}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setTag(n,e){const o=this.store.selectSnapshot(ze.getActiveTags);o[n]=e,this.store.dispatch(new Ee.SetActiveTags(o))}}ua.\u0275fac=function(n){return new(n||ua)(i.Y36(i.sBO),i.Y36(l.yh),i.Y36(We.F0))},ua.\u0275cmp=i.Xpm({type:ua,selectors:[["app-gallery-filters"]],inputs:{viewMode:"viewMode"},outputs:{selectedTagChange:"selectedTagChange"},decls:3,vars:2,consts:[["data-test","galleryFilters",1,"gallery-filters"],["class","gallery-filters__expanded","data-test","galleryFiltersExpanded",4,"ngIf"],["class","gallery-filters__tags","data-test","galleryFiltersSummary",4,"ngIf"],["data-test","galleryFiltersExpanded",1,"gallery-filters__expanded"],["class","gallery-filters__group",4,"ngFor","ngForOf"],[1,"gallery-filters__group"],[1,"gallery-filters__header"],[1,"gallery-filters__tags"],["class","gallery-filters__tag",4,"ngFor","ngForOf"],[1,"gallery-filters__tag"],["app-pill-button","","data-test","galleryFiltersTag",3,"disabled","selected","click"],["data-test","galleryFiltersSummary",1,"gallery-filters__tags"],[4,"ngFor","ngForOf"],["class","gallery-filters__tag",4,"ngIf"],["app-pill-button","","data-test","galleryFiltersTag",3,"click"],[1,"mr-2"],["icon","times"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0),i.YNc(1,O4,2,2,"div",1),i.YNc(2,z4,2,1,"ul",2),i.qZA()),2&n&&(i.xp6(1),i.Q6J("ngIf","expanded"===e.viewMode),i.xp6(1),i.Q6J("ngIf","summary"===e.viewMode))},dependencies:[C4,f.sg,f.O5,lt,f.Ov,f.rS],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.gallery-filters__expanded[_ngcontent-%COMP%]{display:grid;grid-template-columns:33% 33% 33%;grid-gap:16px}.gallery-filters__header[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em;font-weight:600;padding-bottom:12px}.gallery-filters__tag[_ngcontent-%COMP%]{display:inline-block;margin:0 12px 12px 0}@media (max-width: 1179px){.gallery-filters__expanded[_ngcontent-%COMP%]{grid-template-columns:100%}}@media (max-width: 540px){.gallery-filters__group[_ngcontent-%COMP%]{padding:0 0 24px}}"],data:{animation:[(0,j.X$)("show",[(0,j.eR)(":enter",[(0,j.oB)({height:"0"}),(0,j.jt)("250ms ease-out",(0,j.oB)({height:"*"}))])])]},changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(ze.getAvailableTags),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ua.prototype,"availableTags$",void 0);let A4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,sa.eL,dh,hn,Jn,Qe]}),t})(),L4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([ze]),Zr.mZ,We.Bz,Jn,f.ez,W.UX,vp,uo,ac,Ie,xp,fs,Qe,rc.p9,A4]}),t})();i.B6R(_v,function(){return[Dn,Ea,lt,ua]},[]);let wv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,We.Bz,Qe]}),t})(),F4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[Qe,Ie,f.ez,We.Bz,xp,sv,W.UX,vp,L4,wv,l.$l.forFeature([Et])]}),t})(),U4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,En.JP.forChild()]}),t})(),Sp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Qe,Ie,U4]}),t})(),_h=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([U]),f.ez,hn,W.UX]}),t})(),xh=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([we,_,te,Wt]),f.ez,Qe,Ie,pa,Sp,W.UX,En.JP.forChild(),_h]}),t})(),Sv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([M,Ne,Se,yn,Fe]),f.ez,uo,Ie,W.u5,xh,Qe,pa]}),t})(),R4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,fv,l.$l.forFeature([_e])]}),t})(),Pv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),kv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),Ov=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),Tv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),Mv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),Iv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),zv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),Av=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Jn]}),t})(),Lv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),Fv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),Uv=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})();var Hn;!function(t){t.OpenLimit=(()=>{class c{constructor(){}}return c.type="[Dialog] Open Limit",c})(),t.CloseLimit=(()=>{class c{constructor(d){this.upgrade=d}}return c.type="[Dialog] Close Limit",c})(),t.OpenPremiumContent=(()=>{class c{constructor(){}}return c.type="[Dialog] Open Premium Content",c})(),t.ClosePremiumContent=(()=>{class c{constructor(d){this.confirmed=d}}return c.type="[Dialog] Close Premium Content",c})(),t.OpenUpgrade=(()=>{class c{constructor(){}}return c.type="[Dialog] Open Upgrade",c})(),t.CloseUpgrade=(()=>{class c{constructor(){}}return c.type="[Dialog] Close Upgrade",c})()}(Hn||(Hn={}));let E4=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-limit-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"pt-1","pb-6"],[1,"text-14","pb-3"],[1,"text-14"],["mat-dialog-actions","",1,"pt-2"],["app-button","","buttonTheme","light","cdkFocusInitial","",1,"mr-2",3,"mat-dialog-close"],["app-button","","buttonType","primary",3,"mat-dialog-close"]],template:function(e,o){1&e&&(i.TgZ(0,"h1",0),i._uU(1,"New Bookmark Limit Reached"),i.qZA(),i.TgZ(2,"div",1)(3,"div",2),i._uU(4," You've reached your limit of 5 3D models in your Library. You can make changes to this model, but you will not be able to save as a new model. "),i.qZA(),i.TgZ(5,"div",3),i._uU(6,"Upgrade to a Premium Plan to save unlimited 3D models."),i.qZA()(),i.TgZ(7,"div",4)(8,"button",5),i._uU(9," OK "),i.qZA(),i.TgZ(10,"button",6),i._uU(11,"Upgrade Now"),i.qZA()()),2&e&&(i.xp6(8),i.Q6J("mat-dialog-close",!1),i.xp6(2),i.Q6J("mat-dialog-close",!0))},dependencies:[He.ZT,He.uh,He.xY,He.H8,Dn],changeDetection:0}),t})();function D4(t,n){if(1&t&&(i.TgZ(0,"button",7),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.settings.miscText," ")}}function j4(t,n){if(1&t&&(i.TgZ(0,"button",8),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.Q6J("mat-dialog-close",!1),i.xp6(1),i.hij(" ",e.settings.cancelText," ")}}function Q4(t,n){if(1&t&&(i.TgZ(0,"button",9),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.Q6J("mat-dialog-close",!0),i.xp6(1),i.hij(" ",e.settings.confirmText," ")}}let Z4=(()=>{class t{constructor(e,o){this.dialogRef=e,this.data=o,this.settings={titleText:"Confirm Action",bodyText:"",confirmText:"Confirm",confirmColor:"primary",cancelText:"Cancel",confirmEnabled:!0,cancelEnabled:!0,miscText:""},o&&(this.settings={...this.settings,...o})}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.so),i.Y36(He.WI))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-confirm-dialog"]],decls:10,vars:8,consts:[["data-test","confirmDialog","role","alertdialog","aria-modal","true"],["mat-dialog-title",""],["mat-dialog-content","",1,"pt-4","pb-6","text-14"],["mat-dialog-actions","",1,"dialog__actions","pt-2"],["app-button","","buttonTheme","light",3,"mat-dialog-close",4,"ngIf"],["type","button","class","mr-1","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close",4,"ngIf"],["app-button","","buttonTheme","light",3,"mat-dialog-close"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",1,"mr-1",3,"mat-dialog-close"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"h1",1),i._uU(2),i.qZA(),i.TgZ(3,"p",2),i._uU(4),i.qZA(),i.TgZ(5,"div",3),i.YNc(6,D4,2,1,"button",4),i.TgZ(7,"div"),i.YNc(8,j4,2,2,"button",5),i.YNc(9,Q4,2,2,"button",6),i.qZA()()()),2&e&&(i.uIk("aria-label",o.settings.titleText),i.xp6(2),i.hij(" ",o.settings.titleText," "),i.xp6(2),i.hij(" ",o.settings.bodyText," "),i.xp6(1),i.ekj("dialog__actions--compact",!o.settings.miscText),i.xp6(1),i.Q6J("ngIf",o.settings.miscText),i.xp6(2),i.Q6J("ngIf",o.settings.cancelEnabled),i.xp6(1),i.Q6J("ngIf",o.settings.confirmEnabled))},dependencies:[f.O5,He.ZT,He.uh,He.xY,He.H8,Dn],styles:["[_nghost-%COMP%]{display:block}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}@media (min-width: 480px){[_nghost-%COMP%]{min-width:320px}}"],changeDetection:0}),t})();const B4=["copyField"];let V4=(()=>{class t{constructor(e,o,s){this.dialogRef=e,this.data=o,this.clipboardService=s,this.settings={title:"Copy to Clipboard",copyText:""},this.settings={...this.settings,...o}}get rowCount(){return this.settings.copyText.split(/\r?\n/).length+1}ngOnInit(){}ngAfterViewInit(){const e=this.copyField.nativeElement;e.focus(),e.select()}handleCopyClick(){const e=this.clipboardService.copyInputFieldValue(this.copyField.nativeElement);this.close(e)}handleCancelClick(){this.close(!1)}close(e){this.dialogRef.close(e)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.so),i.Y36(He.WI),i.Y36(Vl))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-clipboard-dialog"]],viewQuery:function(e,o){if(1&e&&i.Gf(B4,7),2&e){let s;i.iGM(s=i.CRH())&&(o.copyField=s.first)}},decls:11,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"copy","flex"],[1,"copy__input","flex-auto",3,"value","rows"],["copyField",""],["mat-dialog-actions",""],["app-button","","buttonTheme","light",3,"click"],["app-button","","buttonType","primary",3,"click"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0),i._uU(1),i.qZA(),i.TgZ(2,"div",1)(3,"textarea",2,3),i._uU(5,"  "),i.qZA()(),i.TgZ(6,"div",4)(7,"button",5),i.NdJ("click",function(){return o.handleCancelClick()}),i._uU(8,"Cancel"),i.qZA(),i.TgZ(9,"button",6),i.NdJ("click",function(){return o.handleCopyClick()}),i._uU(10,"Copy to Clipboard"),i.qZA()()),2&e&&(i.xp6(1),i.hij(" ",o.settings.title,"\n"),i.xp6(2),i.Q6J("value",o.settings.copyText)("rows",o.rowCount))},dependencies:[He.uh,He.xY,He.H8,Dn],styles:[".copy[_ngcontent-%COMP%]{min-width:480px}"],changeDetection:0}),t})();const q4=["modalContents"];let Rv=(()=>{class t{constructor(e,o,s,r,a,c){this.dialogRef=e,this.data=o,this.sanitizer=s,this.renderer=r,this.pendoService=a,this.productService=c}onMessage(e){switch(e.data.action){case"close":this.dialogRef.close(e.data);break;case"track":this.pendoService.track(e.data.label,{...e.data.metadata,platform:this.productService.productType})}}ngOnInit(){this.title=this.data.title,this.url=this.data.url?this.sanitizer.bypassSecurityTrustResourceUrl(this.data.url):"",this.renderer.setStyle(this.modalContents.nativeElement,"background-color",this.data.backgroundColor||"#ffffff")}closeDialog(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(He.so),i.Y36(He.WI),i.Y36(ys.H7),i.Y36(i.Qsj),i.Y36(Ln),i.Y36(Yn))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-iframe-dialog"]],viewQuery:function(e,o){if(1&e&&i.Gf(q4,7),2&e){let s;i.iGM(s=i.CRH())&&(o.modalContents=s.first)}},hostBindings:function(e,o){1&e&&i.NdJ("message",function(r){return o.onMessage(r)},!1,i.Jf7)},decls:6,vars:3,consts:[["role","dialog","aria-modal","true",1,"modal"],[1,"modal__contents"],["modalContents",""],["cdkFocusInitial","",1,"modal__frame",3,"src"],["app-button","","buttonTheme","dark","buttonType","white","buttonShape","circle","type","button","title","Close",1,"modal__close",3,"click"],["icon","times","size","lg"]],template:function(e,o){1&e&&(i.TgZ(0,"div",0)(1,"div",1,2),i._UZ(3,"iframe",3),i.qZA(),i.TgZ(4,"button",4),i.NdJ("click",function(){return o.closeDialog()}),i._UZ(5,"app-icon",5),i.qZA()()),2&e&&(i.uIk("aria-label",o.title),i.xp6(3),i.Q6J("src",o.url,i.uOi),i.xp6(1),i.uIk("aria-label","Close"))},dependencies:[lt,Dn],styles:[".modal[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative}.modal__close[_ngcontent-%COMP%]{margin-bottom:4px;align-self:flex-end;cursor:pointer;position:absolute;right:12px;top:12px}.modal__contents[_ngcontent-%COMP%]{flex-grow:1}.modal__frame[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0}),t})(),Nv=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Users] Join Organization",t})(),$4=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Users] Join Organization Success",t})(),G4=(()=>{class t{constructor(e){this.organization=e}}return t.type="[Users] Join Organization Fail",t})(),Ev=(()=>{class t{constructor(e){this.code=e}}return t.type="[Users] Join Organization With Code",t})(),Dv=(()=>{class t{constructor(e){this.organizationName=e}}return t.type="[Users] Join Organization With Code Success",t})(),J4=(()=>{class t{constructor(e){this.error=e}}return t.type="[Users] Join Organization With Code Fail",t})(),Pp=(()=>{class t{constructor(e,o){this.groupEID=e,this.invites=o}}return t.type="[Users] Send Organization Invite",t})(),jv=(()=>{class t{constructor(e){this.responses=e}}return t.type="[Users] Send Organization Invite Success",t})(),Qv=(()=>{class t{constructor(e){this.error=e}}return t.type="[Users] Send Organization Invite Fail",t})(),Zv=(()=>{class t{constructor(e){this.groupId=e}}return t.type="[Users] Get Organization Users",t})(),vh=(()=>{class t{constructor(e){this.users=e}}return t.type="[Users] Get Organization Users Success",t})(),H4=(()=>{class t{constructor(e){this.error=e}}return t.type="[Users] Get Organization Users Fail",t})(),Bv=(()=>{class t{constructor(e){this.groupId=e}}return t.type="[Users] Get Organization Invited Users",t})(),Ch=(()=>{class t{constructor(e){this.invites=e}}return t.type="[Users] Get Organization Invited Users Success",t})(),Y4=(()=>{class t{constructor(e){this.error=e}}return t.type="[Users] Get Organization Invited Users Fail",t})(),W4=(()=>{class t{}return t.type="[Users] Reset",t})(),Vv=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Update User Roles",t})(),K4=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Update User Roles Success",t})(),X4=(()=>{class t{}return t.type="[Users] Update User Roles Fail",t})(),qv=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Remove Organization User",t})(),eF=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Remove Organization User Success",t})(),tF=(()=>{class t{}return t.type="[Users] Remove Organization User Fail",t})(),$v=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Transfer Organization Content",t})(),nF=(()=>{class t{constructor(e,o){this.groupId=e,this.users=o}}return t.type="[Users] Transfer Organization Content Success",t})(),iF=(()=>{class t{}return t.type="[Users] Transfer Organization Content Fail",t})();var oF=A(414),sF=A(9415),rF=A(3861);let Jv=(()=>{class t{constructor(e){this.http=e}getOrganizationUsers(e){const o=Lp(e);return this.http.get(`/ws/organization/users${o}`).pipe((0,J.U)(s=>s.users),(0,J.U)(s=>s.map(r=>({...r,user_role:Za(r.user_role)}))))}getOrganizationInvites(e){const o=Lp(e);return this.http.get(`/ws/organization/invite${o}`).pipe((0,J.U)(s=>s.invites),(0,J.U)(s=>s.map(r=>({...r,invite_user:{...r.inviter_user,user_role:Za(r.inviter_user.user_role)},invitee_user:{...r.invitee_user,user_role:Za(r.invitee_user.user_role)}}))))}sendOrganizationInvites(e,o,s){return this.http.post("/ws/organization/invite",{version:2,group_eid:e,invite_emails:o,site_verify_response:s}).pipe((0,J.U)(r=>{const{messages:a}=r.results_summary;return a}))}addUserToOrganization(e){return this.http.post("/ws/organization/user/add",{group_eid:e})}addUserWithGroupCode(e){return this.http.post("/ws/organization/user/add",{group_code:e}).pipe((0,J.U)(o=>o.organization_name))}updateUserRoles(e,o){return this.batchUsers(o,r=>this.http.post("/ws/organization/users",{group_id:e,update_users:r.map(a=>({user_id:a.userId,role_id:a.roleId}))}))}removeUsers(e,o){return this.batchUsers(o,r=>this.http.post("/ws/organization/users",{group_id:e,remove_users:r.map(a=>this.createTransferRequest(a))}))}transferUserContent(e,o){return this.batchUsers(o,r=>this.http.post("/ws/organization/bookmark/transfer",{group_id:e,transfer_bookmarks:r.map(a=>this.createTransferRequest(a))}))}createUserDisplayModel(e,o){return{name:this.formatUserName(e),initials:this.formatBadgeLabel(e),email:e.user_email,id:e.user_id,role:e.user_role,selected:!1,invitationStatus:o}}batchUsers(e,o){let s=0;const r=[];for(;s<e.length;){const c=e.slice(s,s+50);r.push(o(c)),s+=50}const a=(0,oF.x)(r,sF.N).pipe((0,rF.u)());return(0,On.D)(a).pipe((0,J.U)(()=>!0))}createTransferRequest(e){const{sourceUserId:o,targetUserId:s}=e;return"number"==typeof s?{user_id:o,group_bookmarks:{transfer_ownership:1,transfer_user_id:s}}:{user_id:o}}formatUserName(e){const{user_first_name:o,user_last_name:s}=e,r=[o,s].filter(a=>!!a);return r.length>0?r.join(" "):""}formatBadgeLabel(e){const{user_first_name:o,user_last_name:s}=e;return[o,s].filter(a=>!!a).map(a=>a[0]).join("")}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class pc{}var Sn=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Me=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const Hv={joining:!1,inviting:!1,loadingUsers:!1,loadingInvites:!1,users:[],invites:[]};let It=class{constructor(n,e,o,s){this.usersService=n,this.pendoService=e,this.productService=o,this.authService=s}static getUsers(n){return n.users}static getInvites(n){return n.invites}static getUsersLoading(n){return n.loadingUsers}static getJoining(n){return n.joining}static getInviting(n){return n.inviting}joinOrganization(n,{organization:e}){n.patchState({joining:!0}),this.usersService.addUserToOrganization(e.eid).pipe((0,je.x)(()=>n.patchState({joining:!1}))).subscribe(()=>n.dispatch(new $4(e)),()=>n.dispatch(new G4(e)))}joinOrganizationWithCode(n,{code:e}){n.patchState({joining:!0}),this.usersService.addUserWithGroupCode(e).pipe((0,je.x)(()=>n.patchState({joining:!1}))).subscribe(o=>n.dispatch(new Dv(o)),o=>n.dispatch(new J4(o)))}joinOrganizationWithCodeSuccess(){this.pendoService.track("Account Upgrade - Free Individual to Team")}sendOrganizationInvite(n,{groupEID:e,invites:o}){n.patchState({inviting:!0}),this.authService.isHuman("invites",!0).pipe((0,vo.b)(s=>{s.isHuman||n.dispatch(new Al(new Error("reCAPTCHA error. Refresh the page and try again.")))}),(0,$.h)(s=>s.isHuman),(0,Di.z)(s=>this.usersService.sendOrganizationInvites(e,o,s.verification)),(0,je.x)(()=>n.patchState({inviting:!1}))).subscribe(s=>n.dispatch(new jv(s)),s=>n.dispatch(new Qv(s)))}getOrganizationUsers(n,{groupId:e}){n.patchState({loadingUsers:!0}),this.usersService.getOrganizationUsers({group_id:e}).pipe((0,je.x)(()=>n.patchState({loadingUsers:!1}))).subscribe(o=>n.dispatch(new vh(o)),o=>n.dispatch(new H4(o)))}getOrganizationUsersSuccess(n,{users:e}){n.patchState({users:e})}getOrganizationUserInvites(n,{groupId:e}){n.patchState({loadingInvites:!0}),this.usersService.getOrganizationInvites({group_id:e,version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}).pipe((0,je.x)(()=>n.patchState({loadingInvites:!1}))).subscribe(o=>n.dispatch(new Ch(o)),o=>n.dispatch(new Y4(o)))}getOrganizationUserInvitesSuccess(n,{invites:e}){n.patchState({invites:e})}resetOrganizations(n){n.setState(Hv)}updateUserRoles(n,{groupId:e,users:o}){this.usersService.updateUserRoles(e,o).subscribe(()=>n.dispatch(new K4(e,o)),()=>n.dispatch(new X4))}removeOrganizationUser(n,{groupId:e,users:o}){this.usersService.removeUsers(e,o).subscribe(()=>n.dispatch(new eF(e,o)),()=>n.dispatch(new tF))}transferOrganizationContent(n,{groupId:e,users:o}){this.usersService.transferUserContent(e,o).subscribe(()=>n.dispatch(new nF(e,o)),()=>n.dispatch(new iF))}};function Yv(t){return n=>{const e=Xn.parseEmails(n.value),o=e.filter(c=>!Xn.validateEmail(c)),s=e.length,r="number"==typeof t&&s>t;let a={};return r&&(a={...a,maxEmailsExceeded:r,currentEmailCount:s}),o.length>0&&(a={...a,invalidEmails:o}),Object.keys(a).length>0?(0,Ue.of)(a):(0,Ue.of)(null)}}It.\u0275fac=function(n){return new(n||It)(i.LFG(Jv),i.LFG(Ln),i.LFG(Yn),i.LFG(Dr))},It.\u0275prov=i.Yz7({token:It,factory:It.\u0275fac}),Sn([(0,l.aU)(Nv),Me("design:type",Function),Me("design:paramtypes",[Object,Nv]),Me("design:returntype",void 0)],It.prototype,"joinOrganization",null),Sn([(0,l.aU)(Ev),Me("design:type",Function),Me("design:paramtypes",[Object,Ev]),Me("design:returntype",void 0)],It.prototype,"joinOrganizationWithCode",null),Sn([(0,l.aU)(Dv),Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",void 0)],It.prototype,"joinOrganizationWithCodeSuccess",null),Sn([(0,l.aU)(Pp),Me("design:type",Function),Me("design:paramtypes",[Object,Pp]),Me("design:returntype",void 0)],It.prototype,"sendOrganizationInvite",null),Sn([(0,l.aU)(Zv),Me("design:type",Function),Me("design:paramtypes",[Object,Zv]),Me("design:returntype",void 0)],It.prototype,"getOrganizationUsers",null),Sn([(0,l.aU)(vh),Me("design:type",Function),Me("design:paramtypes",[Object,vh]),Me("design:returntype",void 0)],It.prototype,"getOrganizationUsersSuccess",null),Sn([(0,l.aU)(Bv),Me("design:type",Function),Me("design:paramtypes",[Object,Bv]),Me("design:returntype",void 0)],It.prototype,"getOrganizationUserInvites",null),Sn([(0,l.aU)(Ch),Me("design:type",Function),Me("design:paramtypes",[Object,Ch]),Me("design:returntype",void 0)],It.prototype,"getOrganizationUserInvitesSuccess",null),Sn([(0,l.aU)(W4),Me("design:type",Function),Me("design:paramtypes",[Object]),Me("design:returntype",void 0)],It.prototype,"resetOrganizations",null),Sn([(0,l.aU)(Vv),Me("design:type",Function),Me("design:paramtypes",[Object,Vv]),Me("design:returntype",void 0)],It.prototype,"updateUserRoles",null),Sn([(0,l.aU)(qv),Me("design:type",Function),Me("design:paramtypes",[Object,qv]),Me("design:returntype",void 0)],It.prototype,"removeOrganizationUser",null),Sn([(0,l.aU)($v),Me("design:type",Function),Me("design:paramtypes",[Object,$v]),Me("design:returntype",void 0)],It.prototype,"transferOrganizationContent",null),Sn([(0,l.Qf)(),Me("design:type",Function),Me("design:paramtypes",[pc]),Me("design:returntype",void 0)],It,"getUsers",null),Sn([(0,l.Qf)(),Me("design:type",Function),Me("design:paramtypes",[pc]),Me("design:returntype",void 0)],It,"getInvites",null),Sn([(0,l.Qf)(),Me("design:type",Function),Me("design:paramtypes",[pc]),Me("design:returntype",void 0)],It,"getUsersLoading",null),Sn([(0,l.Qf)(),Me("design:type",Function),Me("design:paramtypes",[pc]),Me("design:returntype",void 0)],It,"getJoining",null),Sn([(0,l.Qf)(),Me("design:type",Function),Me("design:paramtypes",[pc]),Me("design:returntype",void 0)],It,"getInviting",null),It=Sn([(0,l.ZM)({name:"users",defaults:Hv}),Me("design:paramtypes",[Jv,Ln,Yn,Dr])],It);const aF=["labelEl"];function cF(t,n){1&t&&i.GkF(0)}function lF(t,n){if(1&t&&(i.TgZ(0,"label",null,3),i.YNc(2,cF,1,0,"ng-container",4),i.qZA()),2&t){const e=i.oxw(),o=i.MAs(4);i.uIk("aria-label",e.label),i.xp6(2),i.Q6J("ngTemplateOutlet",o)}}function pF(t,n){1&t&&i.GkF(0)}function dF(t,n){if(1&t&&(i.TgZ(0,"div"),i.YNc(1,pF,1,0,"ng-container",4),i.qZA()),2&t){const e=i.oxw(),o=i.MAs(4);i.uIk("aria-label",e.label),i.xp6(1),i.Q6J("ngTemplateOutlet",o)}}function uF(t,n){if(1&t&&(i.TgZ(0,"div",8),i._uU(1),i.qZA()),2&t){const e=i.oxw(2);i.ekj("text-uppercase",e.uppercase),i.xp6(1),i.hij(" ",e.label," ")}}function gF(t,n){if(1&t&&(i.YNc(0,uF,2,3,"div",5),i.TgZ(1,"div",6),i.Hsn(2),i.TgZ(3,"div",7),i.Hsn(4,1),i.qZA()()),2&t){const e=i.oxw();i.Q6J("ngIf",e.label)}}const hF=["*",[["","form-field-help",""]]],mF=function(t,n,e,o){return{"field--light":t,"field--dark":n,"field--inline":e,"field--compact":o}},fF=["*","[form-field-help]"];let bF=(()=>{class t{constructor(){this.display="block",this.theme="dark",this.uppercase=!0,this.isCompact=!1,this.labelElement=!0,this.ngUnsubscribe=new X.x}ngOnInit(){}ngAfterViewInit(){this.labelEl&&this.initLabel()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLabel(){this.labelEl.nativeElement.querySelectorAll("[contenteditable]").length>0&&(0,Dt.R)(this.labelEl.nativeElement,"click").pipe((0,w.R)(this.ngUnsubscribe)).subscribe(s=>{s.preventDefault()})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-form-field"]],viewQuery:function(e,o){if(1&e&&i.Gf(aF,5),2&e){let s;i.iGM(s=i.CRH())&&(o.labelEl=s.first)}},inputs:{label:"label",display:"display",theme:"theme",uppercase:"uppercase",isCompact:"isCompact",labelElement:"labelElement"},ngContentSelectors:fF,decls:5,vars:8,consts:[["data-test","formField",1,"field",3,"ngClass"],[4,"ngIf"],["contentTemplate",""],["labelEl",""],[4,"ngTemplateOutlet"],["class","field__label text-10","data-test","formFieldLabel",3,"text-uppercase",4,"ngIf"],[1,"field__input"],[1,"field__help","text-dim","text-11"],["data-test","formFieldLabel",1,"field__label","text-10"]],template:function(e,o){1&e&&(i.F$t(hF),i.TgZ(0,"div",0),i.YNc(1,lF,3,2,"label",1),i.YNc(2,dF,2,2,"div",1),i.YNc(3,gF,5,1,"ng-template",null,2,i.W1O),i.qZA()),2&e&&(i.Q6J("ngClass",i.l5B(3,mF,"light"===o.theme,"dark"===o.theme,"inline"===o.display,o.isCompact)),i.xp6(1),i.Q6J("ngIf",o.labelElement),i.xp6(1),i.Q6J("ngIf",!o.labelElement))},dependencies:[f.mk,f.O5,f.tP],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.field[_ngcontent-%COMP%]{padding-bottom:16px;display:block;width:100%}.field__input[_ngcontent-%COMP%]{margin-top:4px}.field--light[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#374a68}.field--dark[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#96a8c0}.field--inline[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:auto}.field--inline[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{margin-right:8px}.field--inline[_ngcontent-%COMP%]   .field__input[_ngcontent-%COMP%]{margin-top:auto}.field--compact[_ngcontent-%COMP%]{padding-bottom:0}.field__help[_ngcontent-%COMP%]:not(:empty){padding-top:4px}"],changeDetection:0}),t})();var Wv=A(9549),Kv=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},Xv=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};function yF(t,n){if(1&t&&(i.TgZ(0,"div",7)(1,"app-message-toggle",8),i._uU(2),i.qZA()()),2&t){const e=i.oxw(2);i.xp6(2),i.hij(" ",e.sentResponses.length," invite(s) have been sent. Please allow up to a few minutes for invitees to receive their invitations. ")}}function _F(t,n){if(1&t&&(i.ynx(0),i.YNc(1,yF,3,1,"div",6),i.BQk()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.sentResponses.length>0)}}function xF(t,n){if(1&t&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&t){const e=n.$implicit;i.xp6(1),i.hij(" ",e," ")}}function vF(t,n){if(1&t&&(i.TgZ(0,"div",16)(1,"app-message-toggle",17)(2,"div"),i._uU(3),i.qZA(),i.YNc(4,xF,2,1,"div",18),i.qZA()()),2&t){const e=i.oxw(3);i.xp6(3),i.hij("There was an error sending ",e.errorResponses.length," invite(s)."),i.xp6(1),i.Q6J("ngForOf",e.formatResponses(e.errorResponses))}}function CF(t,n){if(1&t&&(i.TgZ(0,"div",16)(1,"app-message-toggle",17),i._uU(2),i.qZA()()),2&t){const e=i.oxw(3);i.xp6(2),i.hij(" ",e.errorMessage," ")}}function wF(t,n){if(1&t&&(i.TgZ(0,"div",19)(1,"mat-error"),i._uU(2),i.qZA()()),2&t){const e=i.oxw().$implicit,o=i.oxw(2);i.xp6(2),i.AsE(" Please limit your entry to ",o.maxEmailCount,". Current count: ",null==e.errors?null:e.errors.currentEmailCount,". ")}}function SF(t,n){if(1&t&&(i.TgZ(0,"div",19)(1,"mat-error"),i._uU(2),i.qZA()()),2&t){const e=i.oxw().$implicit,o=i.oxw(2);i.xp6(2),i.AsE(" ",o.formatEmails(null==e.errors?null:e.errors.invalidEmails)," ",1===e.errors.invalidEmails.length?"is not a valid email address.":"are not valid email addresses."," ")}}function PF(t,n){if(1&t&&(i.TgZ(0,"option",24),i._uU(1),i.qZA()),2&t){const e=n.$implicit;i.Q6J("value",e.role_id),i.xp6(1),i.hij(" ",e.role_display_name," ")}}function kF(t,n){1&t&&(i.TgZ(0,"div",19)(1,"mat-error"),i._uU(2," Please select a valid role. "),i.qZA()())}function OF(t,n){if(1&t&&(i.TgZ(0,"app-form-field",20)(1,"select",21)(2,"option",22),i._uU(3,"--"),i.qZA(),i.YNc(4,PF,2,2,"option",23),i.qZA(),i.YNc(5,kF,3,0,"div",14),i.qZA()),2&t){const e=n.$implicit,o=i.oxw(3);i.xp6(4),i.Q6J("ngForOf",o.availableRoles),i.xp6(1),i.Q6J("ngIf",e.touched&&e.invalid)}}function TF(t,n){if(1&t&&(i.ynx(0,10),i.YNc(1,vF,5,2,"div",11),i.YNc(2,CF,3,1,"div",11),i.TgZ(3,"app-form-field",12)(4,"textarea",13),i._uU(5,"          "),i.qZA(),i.YNc(6,wF,3,2,"div",14),i.YNc(7,SF,3,2,"div",14),i.qZA(),i.YNc(8,OF,6,2,"app-form-field",15),i.BQk()),2&t){const e=n.$implicit,o=i.oxw(2);i.Q6J("formGroup",o.form),i.xp6(1),i.Q6J("ngIf",o.errorResponses.length>0),i.xp6(1),i.Q6J("ngIf",o.errorMessage),i.xp6(2),i.Q6J("placeholder","Enter up to "+o.maxEmailCount+" email addresses separated by commas"),i.xp6(2),i.Q6J("ngIf",null==e.errors?null:e.errors.maxEmailsExceeded),i.xp6(1),i.Q6J("ngIf",null==e.errors?null:e.errors.invalidEmails),i.xp6(1),i.Q6J("ngIf",o.form.get("roleId"))}}function MF(t,n){if(1&t&&i.YNc(0,TF,9,7,"ng-container",9),2&t){const e=i.oxw();i.Q6J("ngIf",e.form.get("emails"))}}function IF(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",29),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleCancelClick())}),i._uU(1),i.qZA()}if(2&t){const e=i.oxw(2);i.Q6J("uppercase","inline"===e.layout),i.xp6(1),i.hij(" ",e.cancelText," ")}}function zF(t,n){if(1&t){const e=i.EpF();i.TgZ(0,"button",30),i.NdJ("click",function(){i.CHM(e);const s=i.oxw(2);return i.KtG(s.handleInviteClick())}),i.ALo(1,"async"),i._uU(2),i.qZA()}if(2&t){const e=i.oxw(2);i.Q6J("uppercase","inline"===e.layout)("disabled",e.form.invalid||i.lcZ(1,3,e.inviting$)),i.xp6(2),i.hij(" ",e.errorResponses.length>0?"Try Again":e.sendText," ")}}function AF(t,n){1&t&&i.GkF(0)}function LF(t,n){1&t&&i.GkF(0)}function FF(t,n){if(1&t&&(i.ynx(0),i.YNc(1,AF,1,0,"ng-container",31),i.YNc(2,LF,1,0,"ng-container",31),i.BQk()),2&t){i.oxw();const e=i.MAs(3),o=i.MAs(5);i.xp6(1),i.Q6J("ngTemplateOutlet",e),i.xp6(1),i.Q6J("ngTemplateOutlet",o)}}function UF(t,n){1&t&&i.GkF(0)}function RF(t,n){1&t&&i.GkF(0)}function NF(t,n){if(1&t&&(i.YNc(0,UF,1,0,"ng-container",31),i.YNc(1,RF,1,0,"ng-container",31)),2&t){i.oxw();const e=i.MAs(5),o=i.MAs(3);i.Q6J("ngTemplateOutlet",e),i.xp6(1),i.Q6J("ngTemplateOutlet",o)}}function EF(t,n){if(1&t&&(i.TgZ(0,"div")(1,"div",25),i.YNc(2,IF,2,2,"ng-template",null,26,i.W1O),i.YNc(4,zF,3,5,"ng-template",null,27,i.W1O),i.YNc(6,FF,3,2,"ng-container",2),i.YNc(7,NF,2,2,"ng-template",null,28,i.W1O),i.qZA()()),2&t){const e=i.MAs(8),o=i.oxw();i.xp6(6),i.Q6J("ngIf","inline"===o.layout)("ngIfElse",e)}}class sr{constructor(n,e,o,s){this.store=n,this.actions=e,this.formBuilder=o,this.changeRef=s,this.maxEmailCount=50,this.availableRoles=[],this.layout="inline",this.enableActions=!0,this.sendText="Send invites",this.cancelText="Cancel",this.inviteSent=new i.vpe,this.inviteCancelled=new i.vpe,this.ngUnsubscribe=new X.x,this.sent=!1,this.sentResponses=[],this.errorResponses=[]}get valid(){return this.form.valid}ngOnInit(){this.initForm(),this.initInviteListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.store.dispatch(new Tl),this.currentUserRole=this.store.selectSnapshot(q.getUserRole),this.userRoles$.pipe((0,$.h)(n=>n.length>0),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.availableRoles=n.filter(e=>Fl.indexOf(e.role_name)<=Fl.indexOf(this.currentUserRole.role_name)),this.changeRef.markForCheck()}),this.form=this.formBuilder.group({emails:["",W.kI.required,Yv(this.maxEmailCount).bind(this)],roleId:["",W.kI.required]})}initInviteListeners(){this.actions.pipe((0,l.xt)(Pp),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.resetState(),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xt)(jv),(0,w.R)(this.ngUnsubscribe)).subscribe(({responses:n})=>{this.resetState(),this.sentResponses=n.filter(e=>"success"===e.status),this.errorResponses=n.filter(e=>"error"===e.status),this.sent=0===this.errorResponses.length,this.sent&&this.inviteSent.next(n),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xt)(Qv,Al),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.resetState(),this.errorMessage=vg(n.error)||"There was an error sending the invites, please try again.",this.changeRef.markForCheck()})}handleCancelClick(){this.inviteCancelled.next()}backToFormClick(){this.resetState(),this.changeRef.markForCheck()}handleInviteClick(){const{eid:n}=this.organization,o=Xn.parseEmails(this.form.value.emails).map(s=>({user_email:s,role_id:parseInt(this.form.value.roleId,10)}));this.store.dispatch(new Pp(n,o))}formatEmails(n){return n.join(", ")}formatResponses(n){const e=n.map(s=>s.reason);return[...new Set([...e])].map(s=>{const r=n.filter(c=>c.reason===s).map(c=>c.email),a=this.formatEmails(r);return`"${s}": ${a}`})}resetState(){this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.errorMessage=""}}sr.\u0275fac=function(n){return new(n||sr)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(W.QS),i.Y36(i.sBO))},sr.\u0275cmp=i.Xpm({type:sr,selectors:[["app-team-invite"]],inputs:{organization:"organization",layout:"layout",enableActions:"enableActions",sendText:"sendText",cancelText:"cancelText"},outputs:{inviteSent:"inviteSent",inviteCancelled:"inviteCancelled"},ngContentSelectors:["*"],decls:8,vars:7,consts:[[1,"invite"],[1,"theme-light"],[4,"ngIf","ngIfElse"],["sendFormTmp",""],[4,"ngIf"],[1,"invite__footer"],["class","mv-1",4,"ngIf"],[1,"mv-1"],["data-test","teamInviteSuccess","type","message"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","mb-4",4,"ngIf"],["theme","light","label","Invite via email"],["formControlName","emails","data-test","teamInviteEmails","rows","8",1,"invite__input","input",3,"placeholder"],["class","mt-1",4,"ngIf"],["theme","light","label","Role",4,"ngIf"],[1,"mb-4"],["type","error"],[4,"ngFor","ngForOf"],[1,"mt-1"],["theme","light","label","Role"],["formControlName","roleId",1,"input"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"invite__buttons"],["cancelBtnTmp",""],["sendBtnTmp",""],["blockBtnTmp",""],["app-button","","buttonSize","large","buttonTheme","light","buttonType","default","data-test","skipInvitesButton",1,"invite__button",3,"uppercase","click"],["app-button","","buttonSize","large","buttonType","primary","data-test","sendInvitesButton",1,"invite__button",3,"uppercase","disabled","click"],[4,"ngTemplateOutlet"]],template:function(n,e){if(1&n&&(i.F$t(),i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,_F,2,1,"ng-container",2),i.YNc(3,MF,1,1,"ng-template",null,3,i.W1O),i.qZA(),i.YNc(5,EF,9,2,"div",4),i.TgZ(6,"div",5),i.Hsn(7,0,["[select]","invite - footer"]),i.qZA()()),2&n){const o=i.MAs(4);i.ekj("invite--inline","inline"===e.layout)("invite--block","block"===e.layout),i.xp6(2),i.Q6J("ngIf",e.sent)("ngIfElse",o),i.xp6(3),i.Q6J("ngIf",e.enableActions&&!e.sent)}},dependencies:[Dn,f.sg,f.O5,f.tP,bF,Wv.TO,W.YN,W.Kr,W.Fj,W.EJ,W.JJ,W.JL,W.sg,W.u,op,f.Ov],styles:[".invite__input[_ngcontent-%COMP%]{resize:vertical}.invite__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.invite__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.invite__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:8px auto}.invite--inline[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin-left:16px}.invite--inline[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end}.invite--block[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin:16px 0}.invite--block[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end;flex-direction:column}"],changeDetection:0}),Kv([(0,l.Ph)(It.getInviting),Xv("design:type",b.y)],sr.prototype,"inviting$",void 0),Kv([(0,l.Ph)(q.getUserRoles),Xv("design:type",b.y)],sr.prototype,"userRoles$",void 0);class ga{constructor(n,e){this.dialogRef=n,this.data=e,this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.ngUnsubscribe=new X.x,this.organization=e.organization}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleInviteSent(n){setTimeout(()=>{this.inviteComplete()},5e3)}handleInviteCancelled(){this.inviteComplete()}inviteComplete(){this.dialogRef.close()}}ga.\u0275fac=function(n){return new(n||ga)(i.Y36(He.so),i.Y36(He.WI))},ga.\u0275cmp=i.Xpm({type:ga,selectors:[["app-team-invite-dialog"]],decls:10,vars:3,consts:[[1,"dialog"],["mat-dialog-title",""],[1,"flex","flex-row","justify-between"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",3,"click"],["icon","times","size","lg"],["mat-dialog-content","",1,"theme-light","p-6"],["sentText","Send invites","cancelText","Cancel",3,"organization","layout","inviteSent","inviteCancelled"]],template:function(n,e){1&n&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),i._uU(4,"Invite Members"),i.qZA(),i.TgZ(5,"button",3),i.NdJ("click",function(){return e.handleInviteCancelled()}),i._UZ(6,"app-icon",4),i.qZA()()(),i._UZ(7,"mat-divider"),i.TgZ(8,"div",5)(9,"app-team-invite",6),i.NdJ("inviteSent",function(s){return e.handleInviteSent(s)})("inviteCancelled",function(){return e.handleInviteCancelled()}),i.qZA()()()),2&n&&(i.xp6(5),i.uIk("aria-label","Close"),i.xp6(4),i.Q6J("organization",e.organization)("layout","inline"))},dependencies:[He.uh,He.xY,Ya.d,Dn,lt,sr],styles:[".dialog[_ngcontent-%COMP%]{width:480px;min-height:320px}.dialog__input[_ngcontent-%COMP%]{resize:vertical}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}@media (max-width: 480px){.dialog[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(It.getInviting),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ga.prototype,"inviting$",void 0);let e0=(()=>{class t{constructor(){}}return t.type="[Share] Reset",t})(),kp=(()=>{class t{constructor(e){this.shareEmail=e}}return t.type="[Share] Share Email Link",t})(),t0=(()=>{class t{constructor(e){this.shareEmail=e}}return t.type="[Share] Share Email Link Success",t})(),n0=(()=>{class t{constructor(e){this.error=e}}return t.type="[Share] Share Email Link Fail",t})();var go=(()=>(function(t){t.Facebook="facebook",t.LinkedIn="linkedin",t.Twitter="twitter"}(go||(go={})),go))(),dc=(()=>(function(t){t.Model="model",t.Quiz="quiz"}(dc||(dc={})),dc))();let i0=(()=>{class t{constructor(e,o){this.http=e,this.APP_BASE_URL=o}shareEmailLink(e){return this.http.post("/ws/user/share/email",e)}generateShareLink(e,o="en"){const s=e.thumbnail_url.replace("/small/","/large/");return{type:e.quiz?dc.Quiz:dc.Model,title:e.title,relativeUrl:this.createShareUrl(e,"share",o,!1,!1),fullUrl:this.createShareUrl(e,"share",o,!0,!1),thumbUrl:s,social:[{type:go.Facebook,url:`https://www.facebook.com/sharer/sharer.php?u=${this.createShareUrl(e,go.Facebook,o,!0,!0)}`},{type:go.LinkedIn,url:`https://www.linkedin.com/sharing/share-offsite/?url=${this.createShareUrl(e,go.LinkedIn,o,!0,!0)}`},{type:go.Twitter,url:`http://twitter.com/share?url=${this.createShareUrl(e,go.Twitter,o,!0,!0)}`}]}}createShareUrl(e,o,s,r,a){const c=e.id.replace(".json",""),p=Object.values(go).includes(o),u=`/view?id=${c}&lang=${s}&ref=${o}`,g=r||p?`${p?"https://human.biodigital.com":this.APP_BASE_URL}${u}`:u;return a?encodeURIComponent(g):g}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(at.eN),i.LFG(mg))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Op=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},ho=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};const o0={sharing:!1};let Ji=class{constructor(n,e,o){this.shareService=n,this.productService=e,this.authService=o}static getSharing(n){return n.sharing}resetShare(n,e){n.setState(o0)}sendEmail(n,{shareEmail:e}){n.patchState({sharing:!0}),this.authService.isHuman("share_email",!0).pipe((0,vo.b)(o=>{o.isHuman||n.dispatch(new Al(new Error("reCAPTCHA error. Refresh the page and try again.")))}),(0,$.h)(o=>o.isHuman),(0,Di.z)(o=>this.shareService.shareEmailLink({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,site_verify_response:o.verification,...e})),(0,je.x)(()=>n.patchState({sharing:!1}))).subscribe(()=>n.dispatch(new t0(e)),o=>n.dispatch(new n0(o)))}};Ji.\u0275fac=function(n){return new(n||Ji)(i.LFG(i0),i.LFG(Yn),i.LFG(Dr))},Ji.\u0275prov=i.Yz7({token:Ji,factory:Ji.\u0275fac}),Op([(0,l.aU)(e0),ho("design:type",Function),ho("design:paramtypes",[Object,e0]),ho("design:returntype",void 0)],Ji.prototype,"resetShare",null),Op([(0,l.aU)(kp),ho("design:type",Function),ho("design:paramtypes",[Object,kp]),ho("design:returntype",void 0)],Ji.prototype,"sendEmail",null),Op([(0,l.Qf)(),ho("design:type",Function),ho("design:paramtypes",[class ZF{}]),ho("design:returntype",void 0)],Ji,"getSharing",null),Ji=Op([(0,l.ZM)({name:"share",defaults:o0}),ho("design:paramtypes",[i0,Yn,Dr])],Ji);const qF=["emailField"];function $F(t,n){1&t&&(i.ynx(0),i.TgZ(1,"div",11)(2,"app-message-toggle",12),i._uU(3," Your email was successfully sent. "),i.qZA()(),i.BQk())}function GF(t,n){if(1&t&&(i.TgZ(0,"div",11)(1,"app-message-toggle",20),i._uU(2),i.qZA()()),2&t){const e=i.oxw(2);i.xp6(2),i.hij(" ",e.errorMessage," ")}}function JF(t,n){1&t&&i._UZ(0,"app-spinner",21)}function HF(t,n){1&t&&(i.TgZ(0,"div",24)(1,"mat-error"),i._uU(2,"Please enter a valid email address."),i.qZA()())}function YF(t,n){if(1&t&&(i.TgZ(0,"div",26)(1,"mat-error"),i._uU(2),i.qZA()()),2&t){const e=i.oxw(2).$implicit,o=i.oxw(2);i.xp6(2),i.AsE(" Maximum email addresses excceeded, ",e.currentEmailCount," of ",o.maxEmailCount," max. ")}}function WF(t,n){if(1&t&&i.YNc(0,YF,3,2,"div",25),2&t){const e=i.oxw().$implicit;i.Q6J("ngIf",e.maxEmailsExceeded)}}function KF(t,n){if(1&t&&(i.ynx(0),i.YNc(1,HF,3,0,"div",22),i.YNc(2,WF,1,1,"ng-template",null,23,i.W1O),i.BQk()),2&t){const e=n.$implicit,o=i.MAs(3);i.xp6(1),i.Q6J("ngIf",e.invalidEmails)("ngIfElse",o)}}function XF(t,n){if(1&t){const e=i.EpF();i.YNc(0,GF,3,1,"div",13),i.TgZ(1,"form",14),i.NdJ("submit",function(){i.CHM(e);const s=i.oxw();return i.KtG(s.submitForm(s.config.shareLink))}),i.TgZ(2,"textarea",15,16),i._uU(4,"        "),i.qZA(),i.TgZ(5,"button",17),i.ALo(6,"async"),i.ALo(7,"async"),i.YNc(8,JF,1,0,"app-spinner",18),i.ALo(9,"async"),i._uU(10),i.ALo(11,"async"),i.qZA()(),i.YNc(12,KF,4,2,"ng-container",19)}if(2&t){const e=i.oxw();i.Q6J("ngIf",e.errorMessage),i.xp6(1),i.Q6J("formGroup",e.form),i.xp6(4),i.Q6J("disabled",!e.form.valid||i.lcZ(6,8,e.sharing$))("loading",i.lcZ(7,10,e.sharing$)),i.uIk("aria-label","Send Email"),i.xp6(3),i.Q6J("ngIf",i.lcZ(9,12,e.sharing$)),i.xp6(2),i.hij(" ",i.lcZ(11,14,e.sharing$)?"Sending":"Send Email"," "),i.xp6(2),i.Q6J("ngIf",e.form.get("emails").errors)}}function eU(t,n){if(1&t&&(i.TgZ(0,"a",27),i.ALo(1,"titlecase"),i.ALo(2,"titlecase"),i._UZ(3,"img",6),i.qZA()),2&t){const e=n.$implicit;i.Q6J("href",e.url,i.LSH)("matTooltip","Share via "+i.lcZ(2,7,e.type)),i.uIk("aria-label","Share via "+i.lcZ(1,5,e.type))("data-test",e.type+"LinkButton"),i.xp6(3),i.Q6J("src","/assets/images/social/"+e.type+"-share.svg",i.LSH)}}function tU(t,n){if(1&t&&(i.TgZ(0,"p",28),i._uU(1),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.hij(" ",e.config.description," ")}}class ha{constructor(n,e,o,s,r,a,c,p){this.store=n,this.actions=e,this.dialogRef=o,this.data=s,this.clipboardService=r,this.snackBar=a,this.formBuilder=c,this.changeRef=p,this.maxEmailCount=50,this.config={title:"Share"},this.emailSent=!1,this.errorMessage="",this.formError="",this.ngUnsubscribe=new X.x,this.config={...this.config,...s},this.initForm()}ngOnInit(){this.initEmailListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({emails:["",W.kI.required,Yv(this.maxEmailCount).bind(this)]})}initEmailListeners(){this.actions.pipe((0,l.xt)(kp),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!1,this.errorMessage="",this.changeRef.markForCheck()}),this.actions.pipe((0,l.xt)(t0),(0,w.R)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!0,this.errorMessage="",setTimeout(()=>{this.emailSent=!1,this.form.setValue({emails:""}),this.changeRef.markForCheck(),setTimeout(()=>this.focus())},5e3),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xt)(n0),(0,w.R)(this.ngUnsubscribe)).subscribe(n=>{this.emailSent=!1,this.errorMessage=vg(n.error)||"There was an error sending the email.",setTimeout(()=>this.focus()),this.changeRef.markForCheck()})}focus(){const n=this.emailField?.nativeElement;n&&n.focus()}submitForm(n){const{type:e,title:o,relativeUrl:s,thumbUrl:r}=n,a=Xn.parseEmails(this.form.value.emails);this.store.dispatch(new kp({share_type:e,share_title:o,share_thumbnail_path:r,share_link_path:s,share_emails:a}))}handleCopyClick(n,e){this.clipboardService.copyToClipboard(n,"url").pipe((0,w.R)(this.ngUnsubscribe)).subscribe(o=>{this.snackBar.open(`Link ${o?"copied":"not copied"}.`)}),e.preventDefault()}handleCloseClick(){this.dialogRef.close()}}ha.\u0275fac=function(n){return new(n||ha)(i.Y36(l.yh),i.Y36(l.eX),i.Y36(He.so),i.Y36(He.WI),i.Y36(Vl),i.Y36(_i.ux),i.Y36(W.qu),i.Y36(i.sBO))},ha.\u0275cmp=i.Xpm({type:ha,selectors:[["app-share-url-dialog"]],viewQuery:function(n,e){if(1&n&&i.Gf(qF,5),2&n){let o;i.iGM(o=i.CRH())&&(e.emailField=o.first)}},decls:14,vars:9,consts:[["role","dialog","aria-modal","true","data-test","shareUrlDialog",1,"share-url-dialog"],[1,"share-url-dialog__title","mb-5"],[4,"ngIf","ngIfElse"],["emailFormTmp",""],[1,"share-url-dialog__social"],["target","_blank","aria-label","Copy Link","matTooltip","Copy Link","matTooltipPosition","below","data-test","copyLinkButton",1,"share-url-dialog__social-link",3,"href","click"],[3,"src"],["class","share-url-dialog__social-link","target","_blank","matTooltipPosition","below",3,"href","matTooltip",4,"ngFor","ngForOf"],["class","share-url-dialog__description mv-3",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"share-url-dialog__close",3,"click"],["icon","times","size","lg"],[1,"mv-2"],["type","message"],["class","mv-2",4,"ngIf"],[1,"share-url-dialog__form",3,"formGroup","submit"],["rows","1","formControlName","emails","placeholder","Email, comma separated","data-test","emailEntryField",1,"share-url-dialog__input","input","theme-light"],["emailField",""],["type","submit","app-button","","buttonType","primary","title","'Send Email'","data-test","emailLinkButton",1,"share-url-dialog__submit",3,"disabled","loading"],["size","small","class","mr-2","render","inline",4,"ngIf"],[4,"ngIf"],["type","error"],["size","small","render","inline",1,"mr-2"],["class","mv-1",4,"ngIf","ngIfElse"],["maxEmailErrorTmp",""],[1,"mv-1"],["class","flex flex-column mv-1",4,"ngIf"],[1,"flex","flex-column","mv-1"],["target","_blank","matTooltipPosition","below",1,"share-url-dialog__social-link",3,"href","matTooltip"],[1,"share-url-dialog__description","mv-3"]],template:function(n,e){if(1&n&&(i.TgZ(0,"div",0)(1,"h2",1),i._uU(2),i.qZA(),i.ynx(3),i.YNc(4,$F,4,0,"ng-container",2),i.YNc(5,XF,13,16,"ng-template",null,3,i.W1O),i.BQk(),i.TgZ(7,"div",4)(8,"a",5),i.NdJ("click",function(s){return e.handleCopyClick(null==e.config.shareLink?null:e.config.shareLink.fullUrl,s)}),i._UZ(9,"img",6),i.qZA(),i.YNc(10,eU,4,9,"a",7),i.qZA(),i.YNc(11,tU,2,1,"p",8),i.TgZ(12,"button",9),i.NdJ("click",function(){return e.handleCloseClick()}),i._UZ(13,"app-icon",10),i.qZA()()),2&n){const o=i.MAs(6);i.uIk("aria-label",e.config.title+" Dialog"),i.xp6(2),i.hij(" ",e.config.title," "),i.xp6(2),i.Q6J("ngIf",e.emailSent)("ngIfElse",o),i.xp6(4),i.Q6J("href",null==e.config.shareLink?null:e.config.shareLink.fullUrl,i.LSH),i.xp6(1),i.Q6J("src","/assets/images/social/link-share.svg",i.LSH),i.xp6(1),i.Q6J("ngForOf",null==e.config.shareLink?null:e.config.shareLink.social),i.xp6(1),i.Q6J("ngIf",e.config.description),i.xp6(1),i.uIk("aria-label","Close")}},dependencies:[f.sg,f.O5,Wv.TO,Gt.gM,Dn,lt,Da,op,W._Y,W.Fj,W.JJ,W.JL,W.sg,W.u,f.Ov,f.rS],styles:[".text-8[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.2px;line-height:1.4em}.text-8.text-uppercase[_ngcontent-%COMP%]{font-size:8px;letter-spacing:.48px;line-height:1.25em;text-transform:uppercase}.text-9[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.225px;line-height:1.4em}.text-9.text-uppercase[_ngcontent-%COMP%]{font-size:9px;letter-spacing:.54px;line-height:1.25em;text-transform:uppercase}.text-10[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.25px;line-height:1.4em}.text-10.text-uppercase[_ngcontent-%COMP%]{font-size:10px;letter-spacing:.6px;line-height:1.25em;text-transform:uppercase}.text-11[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.275px;line-height:1.4em}.text-11.text-uppercase[_ngcontent-%COMP%]{font-size:11px;letter-spacing:.66px;line-height:1.25em;text-transform:uppercase}.text-12[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.3px;line-height:1.4em}.text-12.text-uppercase[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase}.text-13[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.325px;line-height:1.4em}.text-13.text-uppercase[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.78px;line-height:1.25em;text-transform:uppercase}.text-14[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.35px;line-height:1.4em}.text-14.text-uppercase[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.84px;line-height:1.25em;text-transform:uppercase}.text-16[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.4px;line-height:1.4em}.text-16.text-uppercase[_ngcontent-%COMP%]{font-size:16px;letter-spacing:.96px;line-height:1.25em;text-transform:uppercase}.text-18[_ngcontent-%COMP%]{font-size:18px;letter-spacing:.45px;line-height:1.4em}.text-18.text-uppercase[_ngcontent-%COMP%]{font-size:18px;letter-spacing:1.08px;line-height:1.25em;text-transform:uppercase}.text-20[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.5px;line-height:1.4em}.text-20.text-uppercase[_ngcontent-%COMP%]{font-size:20px;letter-spacing:1.2px;line-height:1.25em;text-transform:uppercase}.text-22[_ngcontent-%COMP%]{font-size:22px;letter-spacing:.55px;line-height:1.4em}.text-22.text-uppercase[_ngcontent-%COMP%]{font-size:22px;letter-spacing:1.32px;line-height:1.25em;text-transform:uppercase}.text-24[_ngcontent-%COMP%]{font-size:24px;letter-spacing:.6px;line-height:1.4em}.text-24.text-uppercase[_ngcontent-%COMP%]{font-size:24px;letter-spacing:1.44px;line-height:1.25em;text-transform:uppercase}.text-28[_ngcontent-%COMP%]{font-size:28px;letter-spacing:.7px;line-height:1.4em}.text-28.text-uppercase[_ngcontent-%COMP%]{font-size:28px;letter-spacing:1.68px;line-height:1.25em;text-transform:uppercase}.text-header[_ngcontent-%COMP%]{font-weight:700}.text--code[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace}.text-uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.text-xlight[_ngcontent-%COMP%]{font-weight:200}.text-light[_ngcontent-%COMP%]{font-weight:300}.text-medium[_ngcontent-%COMP%]{font-weight:500}.text-semibold[_ngcontent-%COMP%]{font-weight:600}.text-bold[_ngcontent-%COMP%]{font-weight:700}.text-underline[_ngcontent-%COMP%]{text-decoration:underline}.text-italic[_ngcontent-%COMP%]{font-style:italic}.text-bright[_ngcontent-%COMP%]{color:#fff}.text-dim[_ngcontent-%COMP%]{color:#96a8c0}.text-error[_ngcontent-%COMP%]{color:#ed4758}.text-left[_ngcontent-%COMP%]{text-align:left}.text-center[_ngcontent-%COMP%]{text-align:center}.text-right[_ngcontent-%COMP%]{text-align:right}.text-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.text-link[_ngcontent-%COMP%], .text-link[_ngcontent-%COMP%]:visited{color:inherit;cursor:pointer}.text-link[_ngcontent-%COMP%]:not(.text-underline), .text-link[_ngcontent-%COMP%]:visited:not(.text-underline){text-decoration:none}.text-success[_ngcontent-%COMP%]{color:#38de38}.text-danger[_ngcontent-%COMP%]{color:#de3535}.text-info[_ngcontent-%COMP%]{color:#2d72dc}.text-nowrap[_ngcontent-%COMP%]{white-space:nowrap}.text-pre-line[_ngcontent-%COMP%]{white-space:pre-line}.share-url-dialog[_ngcontent-%COMP%]{position:relative;max-width:420px}.share-url-dialog__title[_ngcontent-%COMP%]{color:#1c2a3f;font-size:20px;letter-spacing:.5px;line-height:1.4em;font-weight:500}.share-url-dialog__description[_ngcontent-%COMP%]{color:#61779e;font-size:11px;letter-spacing:.275px;line-height:1.4em}.share-url-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:8px}.share-url-dialog__submit[_ngcontent-%COMP%]{flex:1 0 120px}.share-url-dialog__social[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;margin-top:32px;margin-bottom:20px}.share-url-dialog__social-link[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:100%;cursor:pointer}.share-url-dialog__social-link[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.share-url-dialog__social-link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.share-url-dialog__input[_ngcontent-%COMP%], .share-url-dialog__input[_ngcontent-%COMP%]:disabled{background-color:#f9fafd;color:#61779e;font-size:12px;letter-spacing:.3px;line-height:1.4em;opacity:1;resize:vertical;max-height:240px}.share-url-dialog__close[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-12px}@media (max-width: 480px){.share-url-dialog__form[_ngcontent-%COMP%]{flex-wrap:wrap}}"],changeDetection:0}),function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);s>3&&r&&Object.defineProperty(n,e,r)}([(0,l.Ph)(Ji.getSharing),function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",n)}(0,b.y)],ha.prototype,"sharing$",void 0);const s0={maxWidth:"100vw",width:"100vw",height:"100vh",panelClass:"full-modal"};let r0=(()=>{class t{constructor(e,o,s,r,a,c,p){this.dialog=e,this.applicationEventService=o,this.router=s,this.store=r,this.pendoService=a,this.productService=c,this.organizationsService=p}get isMobile(){return window.innerWidth<=959}openClipboardDialog(e,o){const s={data:{id:yi.ClipboardDialog,copyText:e},...o};return this.dialog.open(V4,s)}openShareDialog(e,o,s){return this.dialog.open(ha,{id:yi.ShareUrlDialog,disableClose:!0,data:{title:o,description:s,shareLink:e},maxWidth:"90vw"})}openConfirmDialog(e){const o={id:yi.ConfirmDialog,...e};return this.dialog.open(Z4,o)}openLimitDialog(){return this.closeAllDialogs(),this.dialog.open(E4,{id:yi.LimitDialog,width:"480px"})}openUpgradeDialog(e=!0){e&&this.closeAllDialogs();const o=this.store.selectSnapshot(q.getUserProfile),s=this.getContactProfileParams(o),r=o.premium_account_valid?o.premium_account_type:"free",a=(0,m.get)(o,"organizations[0].subscription.type","").toLowerCase(),c=this.store.selectSnapshot(_e.isTrialExpired),p=hc(o.account_settings);let u;switch((0,m.get)(p,"account_purpose.value","")){case jo.Business:u="business.html";break;case jo.Education:u="school.html";break;default:u="individual.html"}const g={...s,accountType:r,subscription:a,expired:c},B=`${se.native?"":{[pn.Local]:"https://localhost:1234",[pn.QA]:"https://pricing-qa.biodigital.com",[pn.Staging]:"https://pricing.biodigital.com",[pn.Production]:"https://pricing.biodigital.com"}[se.deploy]}/${u}?${this.serializeQueryParams(g)}`,K={id:yi.PricingDialog,...s0,data:{title:"Upgrade",url:B,backgroundColor:"#0B1220"}},V=encodeURIComponent(this.router.url);return this.dialog.open(Rv,K).afterClosed().subscribe(ge=>{if(ge){const F={action:"",plan:"",...ge.metadata},R={business:["starter","premium","enterprise"],education:["class","institution"]};let D="Individual";Object.entries(R).forEach(([ce,ye])=>{ye.indexOf(F.plan)&&(D=ce)}),F.action&&this.pendoService.track(`Pricing - ${(0,m.capitalize)(F.action)} - ${(0,m.capitalize)(F.plan)}`,{platform:this.productService.productType,page:D});let I="";switch(F.action){case"buy":if(se.native)return void this.applicationEventService.fireEvent(me.NativeUpgrade);this.router.navigate(["/account/profile"],{queryParams:{section:"subscription",mode:"edit"}});break;case"contact":this.openContactDialog("pricing page");break;case"try":switch(!0){case R.business.includes(F.plan):I=`/account/workflow/team/create?purpose=Business&returnTo=${V}`;break;case R.education.includes(F.plan):I=`/account/workflow/team/create?purpose=Education&returnTo=${V}`;break;default:I="account/workflow"}this.router.navigateByUrl(I)}}else this.pendoService.track("Pricing - Exit")})}openContactDialog(e=""){const o=this.store.selectSnapshot(_e.getOrganization),s=(0,m.isNil)(o)?"":`${o.id}`,r=this.store.selectSnapshot(q.getUserProfile),a=this.getContactProfileParams(r),c={[pn.Local]:"http://craft-sandbox.biodigital.local",[pn.QA]:"http://craft-sandbox.biodigital.local",[pn.Staging]:"https://www.biodigital.com",[pn.Production]:"https://www.biodigital.com"},p=se.native?c[pn.Production]:c[se.deploy];if(se.native){const d=this.serializeQueryParams({...a,organizationId:s,utm_source:"human-mobile",utm_campaign:e});return window.open(`${p}/contact?${d}`,"_blank")}{const u=`${p}/headless/contact-us?${this.serializeQueryParams({...a,organizationId:s,utm_source:"human-web",utm_campaign:e})}`,g={id:yi.ContactDialog,...s0,data:{title:"Contact Us",url:u}};return this.dialog.open(Rv,g)}}openPremiumContentDialog(){const e=se.native||!this.isMobile;return this.openConfirmDialog({id:yi.PremiumContentDialog,data:{titleText:"Premium Content",bodyText:e?"This is premium content. Upgrade to a Premium Plan for unlimited access.":"This is premium content. Visit us on desktop to upgrade to a premium plan.",confirmText:"Upgrade Now",confirmEnabled:e,cancelText:"OK",confirmColor:"warn"}})}openAddUserDialog(){const e=this.store.selectSnapshot(_e.getOrganization);this.dialog.open(ga,{id:yi.AddTeamModelDialog,disableClose:!1,data:{organization:e}})}closeAllDialogs(){this.dialog.closeAll()}getContactProfileParams(e){const{first_name:o,last_name:s,email:r}=e,a=(0,m.get)(e,"organizations[0].name",""),c=(0,m.get)(e,"organizations[0].group_attributes",[]),p=hc(e.account_settings),d=(0,m.get)(p,"account_purpose.value",""),u=(0,m.get)(p,"account_field.value",""),g=(0,m.get)(p,"account_field.value",""),h=(0,m.get)(p,"account_role.value",""),y=this.organizationsService.getOrganizationAttribute(c,"account_settings","account_company_size"),k=this.organizationsService.getOrganizationAttribute(c,"account_settings","account_company_website");return{first_name:o,last_name:s,email:r,company:a,website:k?k.value:"",purpose:d,role:h,program_type:g,program_size:y?y.value:"",industry:d===jo.Education?"Academia":u}}serializeQueryParams(e){return Object.entries(e).map(([o,s])=>{const r="string"!=typeof s?JSON.stringify(s):s;return`${o}=${encodeURIComponent(r)}`}).join("&")}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(He.uw),i.LFG(Lo),i.LFG(We.F0),i.LFG(l.yh),i.LFG(Ln),i.LFG(Yn),i.LFG(bo))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var rr=function(t,n,e,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(r=(s<3?a(r):s>3?a(n,e,r):a(n,e))||r);return s>3&&r&&Object.defineProperty(n,e,r),r},mn=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};let ti=class{constructor(n){this.dialogService=n}static getOpenDialog(n){return n.openDialog}openLimit(n,e){this.dialogService.openLimitDialog().afterClosed().subscribe(s=>{n.dispatch(new Hn.CloseLimit(s))})}closeLimit(n,e){e.upgrade&&this.dialogService.openUpgradeDialog()}openPremiumContent(n,e){this.dialogService.openPremiumContentDialog().afterClosed().subscribe(s=>{n.dispatch(new Hn.ClosePremiumContent(s))})}closePremiumContent(n,e){e.confirmed&&n.dispatch(new Hn.OpenUpgrade)}openUpgrade(n,e){this.dialogService.openUpgradeDialog()}};ti.\u0275fac=function(n){return new(n||ti)(i.LFG(r0))},ti.\u0275prov=i.Yz7({token:ti,factory:ti.\u0275fac}),rr([(0,l.aU)(Hn.OpenLimit),mn("design:type",Function),mn("design:paramtypes",[Object,Hn.OpenLimit]),mn("design:returntype",void 0)],ti.prototype,"openLimit",null),rr([(0,l.aU)(Hn.CloseLimit),mn("design:type",Function),mn("design:paramtypes",[Object,Hn.CloseLimit]),mn("design:returntype",void 0)],ti.prototype,"closeLimit",null),rr([(0,l.aU)(Hn.OpenPremiumContent),mn("design:type",Function),mn("design:paramtypes",[Object,Hn.OpenPremiumContent]),mn("design:returntype",void 0)],ti.prototype,"openPremiumContent",null),rr([(0,l.aU)(Hn.ClosePremiumContent),mn("design:type",Function),mn("design:paramtypes",[Object,Hn.ClosePremiumContent]),mn("design:returntype",void 0)],ti.prototype,"closePremiumContent",null),rr([(0,l.aU)(Hn.OpenUpgrade),mn("design:type",Function),mn("design:paramtypes",[Object,Hn.OpenUpgrade]),mn("design:returntype",void 0)],ti.prototype,"openUpgrade",null),rr([(0,l.Qf)(),mn("design:type",Function),mn("design:paramtypes",[class N4{}]),mn("design:returntype",void 0)],ti,"getOpenDialog",null),ti=rr([(0,l.ZM)({name:"dialog",defaults:{openDialog:null}}),mn("design:paramtypes",[r0])],ti);let a0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),c0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),l0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),p0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe]}),t})(),d0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,W.u5,W.UX,Qe]}),t})(),u0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),g0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),h0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,hn,Jn]}),t})();var iU=A(6666);let oU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Qe,Ie,Hx.Cv,Sp,iU.TA]}),t})(),sU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,W.u5,bp,W.UX,fs,Jn,oU,_p]}),t})(),m0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX,sU]}),t})(),rU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),aU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),f0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),b0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),y0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),cU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.u5,W.UX]}),t})(),_0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,En.JP.forChild()]}),t})(),x0=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Qe,W.UX]}),t})(),lU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([ti]),Pv,kv,Ov,x0,Tv,Mv,y0,Iv,zv,h0,Av,Lv,Fv,Uv,a0,c0,l0,p0,d0,u0,g0,m0,f0,b0,_p,bp,Qe,_0,Pv,kv,Ov,x0,Tv,Mv,y0,Iv,zv,h0,Av,Lv,Fv,Uv,a0,m0,c0,l0,p0,d0,u0,g0,rU,aU,f0,b0,wv,cU,_0]}),t})();const pU=[];let dU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[We.Bz.forChild(pU),We.Bz]}),t})(),uU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez]}),t})(),gU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,hn]}),t})(),hU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Ie,Jn,uo,hn,Sp,ac,W.UX,_h,fs]}),t})(),mU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,Jn,yp,no.rt,Ie]}),t})(),fU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([O]),En.JP.forChild(),f.ez,Sv,dU,Ie,W.UX,W.u5,Jn,uo,hn,ph,yp,uU,lh,fs,pa,Zr.mZ,vp,xh,Sp,Qe,gU,_h,hU,no.rt,mU,nv]}),t})(),v0=(()=>{class t{intercept(e,o){return o.handle(e).pipe((0,J.U)(s=>(s instanceof at.Zn&&s.body&&s.body.hasOwnProperty("results")&&(s=s.clone({body:s.body.results})),s)))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),bU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[Eg],imports:[l.$l.forFeature([tt]),f.ez,Qe]}),t})(),yU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,We.Bz,Jn,uo,hn]}),t})(),C0=(()=>{class t{parse(e){e=e.replace(/&amp;/g,"&");const s=(new We.sz).parse(e);return this.ensureQueryParam(s.queryParams,"dk",e),this.ensureQueryParam(s.queryParams,"uaid",e),s}serialize(e){return(new We.sz).serialize(e).replace(/%2F/g,"/")}ensureQueryParam(e,o,s){if(e.hasOwnProperty(o))return e;const r=this.getParameterByName(o,s);return null!==r&&(e[o]=r),e}getParameterByName(e,o){o||(o=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(o);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac}),t})(),_U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([Pt]),f.ez]}),t})(),xU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[l.$l.forFeature([gn]),f.ez]}),t})();var vU=A(8011);function CU(){const t=new vU.Th;return t.link=(n,e,o)=>`<a href="${function wU(t){return t.match(/^(?:(?:(?:ht)tps?):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i)?t:""}(n)}" target="_blank" rel="noreferrer nofollow">${o}</a>`,t.paragraph=n=>`<p>${n}</p>`,t.image=(n,e,o)=>"",{renderer:t,gfm:!1}}let SU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,En.JP.forRoot({markedOptions:{provide:En.TX,useFactory:CU}})]}),t})(),PU=(()=>{class t{constructor(){}static forRoot(e){return{ngModule:t,providers:[Ln,{provide:"pendoConfig",useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({}),t})(),kU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[f.ez,l.$l.forFeature([Cn])]}),t})();H.MD(),H.vI(),H.Fl(!1);const OU=[{provide:at.TP,useClass:v0,multi:!0},{provide:We.Hx,useClass:C0},{provide:f.mr,useValue:"./"},{provide:f.S$,useClass:f.Do}],TU=[{provide:at.TP,useClass:v0,multi:!0},{provide:We.Hx,useClass:C0}];let MU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t,bootstrap:[Ur]}),t.\u0275inj=i.cJS({providers:!0===se.offline?OU:TU,imports:[l.$l.forRoot(),_U,sv.forRoot(),PU.forRoot({enabled:!1,pendoId:se.pendoId}),SU,ys.b2,S0.PW,at.JF,Sv,vp,F4,R4,xh,xU,lU,fU,yU,bU,kU,bI,A6]}),t})();se.production&&(0,i.G48)(),ys.q6().bootstrapModule(MU).catch(t=>console.error(t))},9521:()=>{},7639:()=>{},9125:()=>{},4654:()=>{}},ma=>{ma.O(0,[736],()=>ma(ma.s=9695)),ma.O()}]);