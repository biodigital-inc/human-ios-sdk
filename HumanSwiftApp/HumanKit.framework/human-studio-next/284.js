(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[284],{25284:(qi,wn,v)=>{"use strict";v.r(wn),v.d(wn,{EditModule:()=>f_});var E=v(60177),C=v(38645),e=v(54438),h=v(67271),a=v(65763),g=v(32408),b=v(85052),y=v(15877),d=v(35426),m=v(82656),f=v(76718),k=v(19827),u=v(2573),F=v(45415),w=v(41862);class N{}var G=v(92676),D=v(81881);class q{constructor(t,n,i){this.label=t,this.width=n,this.height=i}}const le=new q("Don't Resize",-1,-1),Re=new q("Mobile",360,640),Je=new q("Desktop",1280,720),nn=new q("Tablet",768,1024);function z(s,t,n){return`${s}: ${t} x ${n}`}var ce,K=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},U=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Tt={view:F.x.Chapter,leftColumnCollapsed:!1,showTimelineEditor:!1,record:!0,layerOrderMode:!1,showTreeNodeIds:!1,showRootNodes:!1,canvasSize:le,canvasSettings:{emulateDrawer:!1,emulateColumn:!1}};let X=((ce=class{static getView(t){return t.view}static getLeftColumnCollapsed(t){return t.leftColumnCollapsed}static getShowTimelineEditor(t){return t.showTimelineEditor}static getRecord(t){return t.record}static getLayerOrderMode(t){return t.layerOrderMode}static getShowTreeNodeIds(t){return t.showTreeNodeIds}static getCanvasSize(t){return t.canvasSize}static getCanvasSettings(t){return t.canvasSettings}static getShowRootNodes(t){return t.showRootNodes}SetLayerOrderMode(t,n){t.patchState({layerOrderMode:n.layerOrderMode})}ShowTreeNodeIds(t,n){const i=null!=n.show?n.show:!t.getState().showTreeNodeIds;t.patchState({showTreeNodeIds:i})}showRootNodes(t,n){t.patchState({showRootNodes:n.show})}setView(t,n){t.patchState({view:n.view})}nextView(t,n){const{view:i}=t.getState(),o=Object.values(F.x),r=o[o.indexOf(i)+1]||o[0];t.patchState({view:r})}previousView(t,n){const{view:i}=t.getState(),o=Object.values(F.x),r=o[o.indexOf(i)-1]||o[o.length-1];t.patchState({view:r})}setLeftColumnCollapsed(t,n){t.patchState({leftColumnCollapsed:n.collapsed})}showTimelineEditor(t,n){t.patchState({showTimelineEditor:n.show})}resetEditPage(t,n){t.setState(Tt),t.dispatch(new D.yk)}setCanvasSize(t,n){t.patchState({canvasSize:n.size})}}).\u0275fac=function(t){return new(t||ce)},ce.\u0275prov=e.jDH({token:ce,factory:ce.\u0275fac}),ce);K([(0,a.rc)(w.zA),U("design:type",Function),U("design:paramtypes",[Object,w.zA]),U("design:returntype",void 0)],X.prototype,"SetLayerOrderMode",null),K([(0,a.rc)(w.m3),U("design:type",Function),U("design:paramtypes",[Object,w.m3]),U("design:returntype",void 0)],X.prototype,"ShowTreeNodeIds",null),K([(0,a.rc)(w.N6),U("design:type",Function),U("design:paramtypes",[Object,w.N6]),U("design:returntype",void 0)],X.prototype,"showRootNodes",null),K([(0,a.rc)(w.yF),U("design:type",Function),U("design:paramtypes",[Object,w.yF]),U("design:returntype",void 0)],X.prototype,"setView",null),K([(0,a.rc)(w.$j),U("design:type",Function),U("design:paramtypes",[Object,w.$j]),U("design:returntype",void 0)],X.prototype,"nextView",null),K([(0,a.rc)(w.hE),U("design:type",Function),U("design:paramtypes",[Object,w.$j]),U("design:returntype",void 0)],X.prototype,"previousView",null),K([(0,a.rc)(w.HZ),U("design:type",Function),U("design:paramtypes",[Object,w.HZ]),U("design:returntype",void 0)],X.prototype,"setLeftColumnCollapsed",null),K([(0,a.rc)(w.ud),U("design:type",Function),U("design:paramtypes",[Object,w.ud]),U("design:returntype",void 0)],X.prototype,"showTimelineEditor",null),K([(0,a.rc)(w.tV),U("design:type",Function),U("design:paramtypes",[Object,w.tV]),U("design:returntype",void 0)],X.prototype,"resetEditPage",null),K([(0,a.rc)(w.IW),U("design:type",Function),U("design:paramtypes",[Object,w.IW]),U("design:returntype",void 0)],X.prototype,"setCanvasSize",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getView",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getLeftColumnCollapsed",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getShowTimelineEditor",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getRecord",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getLayerOrderMode",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getShowTreeNodeIds",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getCanvasSize",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getCanvasSettings",null),K([(0,a.MD)(),U("design:type",Function),U("design:paramtypes",[N]),U("design:returntype",void 0)],X,"getShowRootNodes",null),X=K([(0,a.Uw)({name:"edit",defaults:Tt,children:[G.i]})],X);var _=v(55494),x=v(22679),P=v(35160),M=v(21082),j=v(14264),S=v(37925),it=v(38399),Te=v(36110),at=v(19833),he=v(17365),Bt=v(32914),W=v(87996),lt=v(87145),Ae=v(11756),on=v(39705),xt=v(60830),_e=v(66056),oe=v(47610),Oa=v(24911),rr=v(15810),Aa=v(4664),Ue=v(38753),V=v(33013),I=v(94495),Et=v(7431),ar=v(3829),Xe=v(47632),Ee=v(21523),Q=v(47555),wt=v(12347),ye=v(93915),Ua=v(40634),Ne=v(16823),ct=v(28407),c=v(89417),Z=v(34006),R=v(49204),Hi=v(74394),lr=v(24477),Va=v(28722),se=v(11789),cr=v(95419),pr=v(44334),Ke=v(65776),Dt=v(91442),dr=v(31462),Me=v(27180),Fn=v(11040),Gt=v(45144),Ve=v(66571),La=v(13955),mr=v(70744),Wi=v(63508),$t=v(11876),Go=v(13976),we=v(24418),Le=v(95416),te=v(81391),De=v(82765),Ye=v(5951),Ce=v(14823),Qe=v(71997),L=v(21007);let ur=(()=>{var s;class t{constructor(i,o){this.templateRef=i,this.viewContainer=o}ngOnInit(){this.update()}update(){"bookmark"===we.c.exportType?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.C4Q),e.rXU(e.c1b))},s.\u0275dir=e.FsC({type:s,selectors:[["","appFlagExternal",""]]}),t})();var hr=v(82124),ee=v(87505),Ft=v(98101),Y=v(26779),Ji=v(77242),Ki=v(41640),Pt=v(87424),Rt=v(57018),me=v(18111),Pn=v(11562);let Mt=(()=>{var s;class t{get value(){return this.getColorFromHex(this._value)}set value(i){const o=this.getHexFromColor(i);o!==this._value&&(this._value=o,this.propagateChange(i),this.changeDetectorRef.markForCheck())}get hexValue(){return this._value}constructor(i){this.changeDetectorRef=i,this.colorPosition="left",this.useRootContainer=!0,this.dataTestAttributeVal="",this.type="hex",this.decimal=!0,this.alpha=!1,this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{},this.propagateChange=o=>{}}ngOnInit(){}handleColorPickerChange(i){this.value=this.getColorFromHex(i),this.changeDetectorRef.markForCheck()}writeValue(i){this.value=i}registerOnChange(i){this.propagateChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.disabled=i}getColorFromHex(i){switch(this.type){case"rgb":return se.T.hexToRgb(i,this.decimal);case"rgba":return se.T.hexToRgba(i,this.decimal);case"rgbColor":const[o,r,l]=se.T.hexToRgb(i,this.decimal);return{r:o,g:r,b:l};default:return i}}getHexFromColor(i){if("object"==typeof i&&"r"in i){const{r:o,g:r,b:l}=i;return se.T.rgbToHex([o,r,l],this.decimal)}if(Array.isArray(i)){const[o,r,l,p]=i;return 4===i.length?se.T.rgbaToHex([o,r,l,p],this.decimal):se.T.rgbToHex([o,r,l],this.decimal)}return i.toString()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-color-picker-input"]],inputs:{value:"value",colorPosition:"colorPosition",useRootContainer:"useRootContainer",dataTestAttributeVal:"dataTestAttributeVal",type:"type",decimal:"decimal",alpha:"alpha"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:3,vars:9,consts:[[1,"color-picker-input"],["type","text","cpOutputFormat","hex",1,"input","color-picker-input__input",3,"colorPickerChange","disabled","value","colorPicker","cpAlphaChannel","cpUseRootViewContainer","cpPosition"],[1,"color-picker-input__color"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"input",1),e.bIt("colorPickerChange",function(l){return o.handleColorPickerChange(l)}),e.k0s(),e.nrm(2,"div",2),e.k0s()),2&i&&(e.R7$(),e.Y8G("disabled",o.disabled)("value",o.hexValue)("colorPicker",o.hexValue)("cpAlphaChannel",o.alpha?"always":"disabled")("cpUseRootViewContainer",o.useRootContainer)("cpPosition",o.colorPosition),e.BMQ("data-test",o.dataTestAttributeVal),e.R7$(),e.xc7("background",o.hexValue))},dependencies:[Pn.bk],styles:[".color-picker-input[_ngcontent-%COMP%]{position:relative}.color-picker-input__input[_ngcontent-%COMP%]{padding-right:36px;width:100%}.color-picker-input__color[_ngcontent-%COMP%]{pointer-events:none;border:1px solid #1b283c;display:block;position:absolute;right:6px;top:6px;z-index:10;height:24px;width:24px;border-radius:50%}.theme-light[_nghost-%COMP%]   .color-picker-input__color[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .color-picker-input__color[_ngcontent-%COMP%]{border-color:#96a8c0}"],changeDetection:0}),t})();var Zi=v(9065),Ot=function(s){return s.Basic="basic",s.Extended="extended",s.Full="full",s}(Ot||{});function $o(s,t){return Array(t+1).join(s)}var Qa=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function Oo(s){return Ao(s,Qa)}var fr=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function gr(s){return Ao(s,fr)}var br=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Ao(s,t){return t.indexOf(s.nodeName)>=0}function _r(s,t){return s.getElementsByTagName&&t.some(function(n){return s.getElementsByTagName(n).length})}var Be={};function eo(s){return s?s.replace(/(\n+\s*)+/g,"\n"):""}function Cr(s){for(var t in this.options=s,this._keep=[],this._remove=[],this.blankRule={replacement:s.blankReplacement},this.keepReplacement=s.keepReplacement,this.defaultRule={replacement:s.defaultReplacement},this.array=[],s.rules)this.array.push(s.rules[t])}function Uo(s,t,n){for(var i=0;i<s.length;i++){var o=s[i];if(Ja(o,t,n))return o}}function Ja(s,t,n){var i=s.filter;if("string"==typeof i){if(i===t.nodeName.toLowerCase())return!0}else if(Array.isArray(i)){if(i.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof i)throw new TypeError("`filter` needs to be a string, array, or function");if(i.call(s,t,n))return!0}}function Vo(s){var t=s.nextSibling||s.parentNode;return s.parentNode.removeChild(s),t}function vr(s,t,n){return s&&s.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}Be.paragraph={filter:"p",replacement:function(s){return"\n\n"+s+"\n\n"}},Be.lineBreak={filter:"br",replacement:function(s,t,n){return n.br+"\n"}},Be.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(s,t,n){var i=Number(t.nodeName.charAt(1));return"setext"===n.headingStyle&&i<3?"\n\n"+s+"\n"+$o(1===i?"=":"-",s.length)+"\n\n":"\n\n"+$o("#",i)+" "+s+"\n\n"}},Be.blockquote={filter:"blockquote",replacement:function(s){return"\n\n"+(s=(s=s.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},Be.list={filter:["ul","ol"],replacement:function(s,t){var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+s:"\n\n"+s+"\n\n"}},Be.listItem={filter:"li",replacement:function(s,t,n){s=s.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var i=n.bulletListMarker+"   ",o=t.parentNode;if("OL"===o.nodeName){var r=o.getAttribute("start"),l=Array.prototype.indexOf.call(o.children,t);i=(r?Number(r)+l:l+1)+".  "}return i+s+(t.nextSibling&&!/\n$/.test(s)?"\n":"")}},Be.indentedCodeBlock={filter:function(s,t){return"indented"===t.codeBlockStyle&&"PRE"===s.nodeName&&s.firstChild&&"CODE"===s.firstChild.nodeName},replacement:function(s,t,n){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},Be.fencedCodeBlock={filter:function(s,t){return"fenced"===t.codeBlockStyle&&"PRE"===s.nodeName&&s.firstChild&&"CODE"===s.firstChild.nodeName},replacement:function(s,t,n){for(var B,o=((t.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],r=t.firstChild.textContent,l=n.fence.charAt(0),p=3,T=new RegExp("^"+l+"{3,}","gm");B=T.exec(r);)B[0].length>=p&&(p=B[0].length+1);var A=$o(l,p);return"\n\n"+A+o+"\n"+r.replace(/\n$/,"")+"\n"+A+"\n\n"}},Be.horizontalRule={filter:"hr",replacement:function(s,t,n){return"\n\n"+n.hr+"\n\n"}},Be.inlineLink={filter:function(s,t){return"inlined"===t.linkStyle&&"A"===s.nodeName&&s.getAttribute("href")},replacement:function(s,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var i=eo(t.getAttribute("title"));return i&&(i=' "'+i.replace(/"/g,'\\"')+'"'),"["+s+"]("+n+i+")"}},Be.referenceLink={filter:function(s,t){return"referenced"===t.linkStyle&&"A"===s.nodeName&&s.getAttribute("href")},replacement:function(s,t,n){var r,l,i=t.getAttribute("href"),o=eo(t.getAttribute("title"));switch(o&&(o=' "'+o+'"'),n.linkReferenceStyle){case"collapsed":r="["+s+"][]",l="["+s+"]: "+i+o;break;case"shortcut":r="["+s+"]",l="["+s+"]: "+i+o;break;default:var p=this.references.length+1;r="["+s+"]["+p+"]",l="["+p+"]: "+i+o}return this.references.push(l),r},references:[],append:function(s){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},Be.emphasis={filter:["em","i"],replacement:function(s,t,n){return s.trim()?n.emDelimiter+s+n.emDelimiter:""}},Be.strong={filter:["strong","b"],replacement:function(s,t,n){return s.trim()?n.strongDelimiter+s+n.strongDelimiter:""}},Be.code={filter:function(s){return"CODE"===s.nodeName&&!("PRE"===s.parentNode.nodeName&&!s.previousSibling&&!s.nextSibling)},replacement:function(s){if(!s)return"";s=s.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(s)?" ":"",n="`",i=s.match(/`+/gm)||[];-1!==i.indexOf(n);)n+="`";return n+t+s+t+n}},Be.image={filter:"img",replacement:function(s,t){var n=eo(t.getAttribute("alt")),i=t.getAttribute("src")||"",o=eo(t.getAttribute("title"));return i?"!["+n+"]("+i+(o?' "'+o+'"':"")+")":""}},Cr.prototype={add:function(s,t){this.array.unshift(t)},keep:function(s){this._keep.unshift({filter:s,replacement:this.keepReplacement})},remove:function(s){this._remove.unshift({filter:s,replacement:function(){return""}})},forNode:function(s){return s.isBlank?this.blankRule:(t=Uo(this.array,s,this.options))||(t=Uo(this._keep,s,this.options))||(t=Uo(this._remove,s,this.options))?t:this.defaultRule;var t},forEach:function(s){for(var t=0;t<this.array.length;t++)s(this.array[t],t)}};var Yo,Lo=typeof window<"u"?window:{},nl=function Za(){var s=Lo.DOMParser,t=!1;try{(new s).parseFromString("","text/html")&&(t=!0)}catch{}return t}()?Lo.DOMParser:function el(){var s=function(){};return s.prototype.parseFromString=function tl(){var s=!1;try{document.implementation.createHTMLDocument("").open()}catch{Lo.ActiveXObject&&(s=!0)}return s}()?function(t){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(t),n.close(),n}:function(t){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(t),n.close(),n},s}();function il(s,t){var n;return function Ka(s){var t=s.element,n=s.isBlock,i=s.isVoid,o=s.isPre||function(H){return"PRE"===H.nodeName};if(t.firstChild&&!o(t)){for(var r=null,l=!1,p=null,T=vr(p,t,o);T!==t;){if(3===T.nodeType||4===T.nodeType){var B=T.data.replace(/[ \r\n\t]+/g," ");if((!r||/ $/.test(r.data))&&!l&&" "===B[0]&&(B=B.substr(1)),!B){T=Vo(T);continue}T.data=B,r=T}else{if(1!==T.nodeType){T=Vo(T);continue}n(T)||"BR"===T.nodeName?(r&&(r.data=r.data.replace(/ $/,"")),r=null,l=!1):i(T)||o(T)?(r=null,l=!0):r&&(l=!1)}var A=vr(p,T,o);p=T,T=A}r&&(r.data=r.data.replace(/ $/,""),r.data||Vo(r))}}({element:n="string"==typeof s?function ol(){return Yo=Yo||new nl}().parseFromString('<x-turndown id="turndown-root">'+s+"</x-turndown>","text/html").getElementById("turndown-root"):s.cloneNode(!0),isBlock:Oo,isVoid:gr,isPre:t.preformattedCode?sl:null}),n}function sl(s){return"PRE"===s.nodeName||"CODE"===s.nodeName}function rl(s,t){return s.isBlock=Oo(s),s.isCode="CODE"===s.nodeName||s.parentNode.isCode,s.isBlank=function al(s){return!gr(s)&&!function Ha(s){return Ao(s,br)}(s)&&/^\s*$/i.test(s.textContent)&&!function qa(s){return _r(s,fr)}(s)&&!function Wa(s){return _r(s,br)}(s)}(s),s.flankingWhitespace=function ll(s,t){if(s.isBlock||t.preformattedCode&&s.isCode)return{leading:"",trailing:""};var n=function cl(s){var t=s.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}(s.textContent);return n.leadingAscii&&yr("left",s,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&yr("right",s,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}}(s,t),s}function yr(s,t,n){var i,o,r;return"left"===s?(i=t.previousSibling,o=/ $/):(i=t.nextSibling,o=/^ /),i&&(3===i.nodeType?r=o.test(i.nodeValue):n.preformattedCode&&"CODE"===i.nodeName?r=!1:1===i.nodeType&&!Oo(i)&&(r=o.test(i.textContent))),r}var pl=Array.prototype.reduce,dl=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function to(s){if(!(this instanceof to))return new to(s);this.options=function Ya(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)n.hasOwnProperty(i)&&(s[i]=n[i])}return s}({},{rules:Be,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(n,i){return i.isBlock?"\n\n":""},keepReplacement:function(n,i){return i.isBlock?"\n\n"+i.outerHTML+"\n\n":i.outerHTML},defaultReplacement:function(n,i){return i.isBlock?"\n\n"+n+"\n\n":n}},s),this.rules=new Cr(this.options)}function kr(s){var t=this;return pl.call(s.childNodes,function(n,i){var o="";return 3===(i=new rl(i,t.options)).nodeType?o=i.isCode?i.nodeValue:t.escape(i.nodeValue):1===i.nodeType&&(o=ul.call(t,i)),Sr(n,o)},"")}function ml(s){var t=this;return this.rules.forEach(function(n){"function"==typeof n.append&&(s=Sr(s,n.append(t.options)))}),s.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function ul(s){var t=this.rules.forNode(s),n=kr.call(this,s),i=s.flankingWhitespace;return(i.leading||i.trailing)&&(n=n.trim()),i.leading+t.replacement(n,s,this.options)+i.trailing}function Sr(s,t){var n=function Xa(s){for(var t=s.length;t>0&&"\n"===s[t-1];)t--;return s.substring(0,t)}(s),i=function za(s){return s.replace(/^\n*/,"")}(t),o=Math.max(s.length-n.length,t.length-i.length);return n+"\n\n".substring(0,o)+i}to.prototype={turndown:function(s){if(!function hl(s){return null!=s&&("string"==typeof s||s.nodeType&&(1===s.nodeType||9===s.nodeType||11===s.nodeType))}(s))throw new TypeError(s+" is not a string, or an element/document/fragment node.");if(""===s)return"";var t=kr.call(this,new il(s,this.options));return ml.call(this,t)},use:function(s){if(Array.isArray(s))for(var t=0;t<s.length;t++)this.use(s[t]);else{if("function"!=typeof s)throw new TypeError("plugin must be a Function or an Array of Functions");s(this)}return this},addRule:function(s,t){return this.rules.add(s,t),this},keep:function(s){return this.rules.keep(s),this},remove:function(s){return this.rules.remove(s),this},escape:function(s){return dl.reduce(function(t,n){return t.replace(n[0],n[1])},s)}};const fl=to;var gl=v(1314);const bl=new fl({headingStyle:"atx"}).keep(gl.cb);var Cl=v(91163),no=v(68947),io=v(35286);const vl=["containerEl"],yl=["toolbarEl"],kl=["editEl"],Sl={[Ot.Basic]:["superscript","subscript"],[Ot.Extended]:["bold","italic","anchor","superscript","subscript"],[Ot.Full]:["bold","italic","anchor","orderedlist","unorderedlist","superscript","subscript"]};let At=(()=>{var s;class t{set rows(i){this._rows=i,this.setRows(i)}get rows(){return this._rows}get value(){return this._value}set value(i){i!==this.value&&(this._value=i,this.handleValueUpdate())}constructor(i,o){this.renderer2=i,this.markdownService=o,this.resizeable=!0,this.inline=!0,this.compact=!1,this.mode=Ot.Full,this.textMode="textarea",this.textValue="",this.editorFocused=(0,e.vPA)(!1),this.valueChanges=new b.B,this.ngUnsubscribe=new b.B}ngAfterViewInit(){this.initEditor(),this.initListeners(),this.initContentLabel()}ngOnDestroy(){this.editor.destroy(),this.valueChanges.complete(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEditor(){var i=this;return(0,ct.A)(function*(){i.editor=new Cl(i.editEl.nativeElement,{toolbar:{relativeContainer:i.inline?i.toolbarEl.nativeElement:null,buttons:Sl[i.mode]},targetBlank:!0,buttonLabels:"fontawesome",paste:{forcePlainText:i.mode===Ot.Basic,cleanPastedHTML:i.mode!==Ot.Basic},anchor:{linkValidation:!0},disableReturn:"text"===i.textMode,placeholder:!!i.placeholder&&{text:i.placeholder}}),i.getEditorValueChanges(i.editor).pipe((0,j.p)(o=>{const r="number"==typeof i.maxLength,l=no.l.getPlainTextFromHTML(i.renderer2,o),p=r&&l.length>i.maxLength;return p&&i.setEditorValue(i.value),!p}),(0,Zi.Z)(125),(0,S.Q)(i.ngUnsubscribe)).subscribe(o=>{const r=function _l(s){return bl.turndown(s)}(o);r!==i.value&&(i.value=r,i.onChange(i.value))}),i.getEditorEvent(i.editor,"focus").pipe((0,S.Q)(i.ngUnsubscribe)).subscribe(()=>{i.editorFocused.set(!0)}),i.getEditorEvent(i.editor,"blur").pipe((0,S.Q)(i.ngUnsubscribe)).subscribe(()=>{i.editorFocused.set(!1)}),i.setEditorValue(i.value),i.setRows(i.rows)})()}initListeners(){(0,d.R)(this.editEl.nativeElement,"keydown").pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{i.stopPropagation()})}initContentLabel(){const i=this.containerEl.nativeElement.closest("label");if(!(0,R.isNil)(i)){const o=i.getAttribute("aria-label")||"",r="textarea"===this.textMode;this.editEl.nativeElement.setAttribute("aria-label",o),this.editEl.nativeElement.setAttribute("aria-multiline",r.toString())}}getValueChanges(){return this.valueChanges.asObservable()}getEditorValue(i){return i.getContent(0)}getEditorValueChanges(i){return this.getEditorEvent(i,"editableInput").pipe((0,Te.T)(()=>this.getEditorValue(i)))}getEditorEvent(i,o){return new u.c(r=>{i.subscribe(o,l=>{r.next(l)})})}setEditorValue(i){var o=this;return(0,ct.A)(function*(){if(o.editor){const r=yield o.markdownService.parse(i);o.editor.setContent(r)}})()}setRows(i){if(this.editEl&&this.editEl.nativeElement){this.renderer2.setStyle(this.editEl.nativeElement,"height",typeof i>"u"?"auto":16+16*i+"px")}}onChange(i){}onTouched(){}writeValue(i){i!==this.value&&(this.value=i,this.setEditorValue(i))}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.disabled=i||void 0}handleValueUpdate(){var i=this;return(0,ct.A)(function*(){i.textValue=yield no.l.getPlainTextFromMarkdown(i.renderer2,i.markdownService,i.value),i.valueChanges.next(i.value)})()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.sFG),e.rXU(io.Rl))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-rich-text-edit"]],viewQuery:function(i,o){if(1&i&&(e.GBs(vl,7),e.GBs(yl,7),e.GBs(kl,7)),2&i){let r;e.mGM(r=e.lsd())&&(o.containerEl=r.first),e.mGM(r=e.lsd())&&(o.toolbarEl=r.first),e.mGM(r=e.lsd())&&(o.editEl=r.first)}},inputs:{rows:"rows",disabled:"disabled",resizeable:"resizeable",inline:"inline",compact:"compact",mode:"mode",textMode:"textMode",maxLength:"maxLength",placeholder:"placeholder"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:6,vars:13,consts:[["containerEl",""],["editEl",""],["toolbarEl",""],[1,"rich-text-edit"],["role","textbox",1,"rich-text-edit__editor","html","input"],[1,"rich-text-edit__toolbar","medium-editor-toolbar-container"]],template:function(i,o){1&i&&(e.j41(0,"div",3,0),e.nrm(2,"div",4,1)(4,"div",5,2),e.k0s()),2&i&&(e.AVh("rich-text-edit--inline",!0===o.inline)("medium-editor-focused",o.editorFocused())("medium-editor-compact",o.compact),e.R7$(2),e.AVh("rich-text-edit__editor--text","text"===o.textMode)("rich-text-edit__editor--textarea","textarea"===o.textMode)("rich-text-edit__editor--resizeable",o.resizeable),e.BMQ("data-disable-editing",o.disabled))},styles:[".input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,textarea.input{border:1px solid #1b283c;border-radius:4px;background-color:#101823;color:#fff;display:block;min-height:36px;width:100%;font-size:12px;padding:8px 12px;font-family:Inter,sans-serif}@supports (font-variation-settings: normal){.input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,textarea.input{font-family:Inter UI var alt,sans-serif}}.input:focus,[type=text].input:focus,[type=number].input:focus,[type=email].input:focus,[type=password].input:focus,[type=file].input:focus,[type=url].input:focus,select.input:focus,textarea.input:focus{outline:#2d72dc solid 2px!important}.input:focus.ng-invalid,[type=text].input:focus.ng-invalid,[type=number].input:focus.ng-invalid,[type=email].input:focus.ng-invalid,[type=password].input:focus.ng-invalid,[type=file].input:focus.ng-invalid,[type=url].input:focus.ng-invalid,select.input:focus.ng-invalid,textarea.input:focus.ng-invalid{outline-color:#ed4758!important;outline-width:1px!important}.input--small,[type=text].input--small,[type=number].input--small,[type=email].input--small,[type=password].input--small,[type=file].input--small,[type=url].input--small,select.input--small,textarea.input--small{font-size:12px;padding:8px;min-height:auto}.input--large,[type=text].input--large,[type=number].input--large,[type=email].input--large,[type=password].input--large,[type=file].input--large,[type=url].input--large,select.input--large,textarea.input--large{font-size:16px;padding:12px}.input--success,[type=text].input--success,[type=number].input--success,[type=email].input--success,[type=password].input--success,[type=file].input--success,[type=url].input--success,select.input--success,textarea.input--success{border-color:#38de38!important}.input:disabled,[type=text].input:disabled,[type=number].input:disabled,[type=email].input:disabled,[type=password].input:disabled,[type=file].input:disabled,[type=url].input:disabled,select.input:disabled,textarea.input:disabled{opacity:.4}.input.ng-dirty.ng-invalid,[type=text].input.ng-dirty.ng-invalid,[type=number].input.ng-dirty.ng-invalid,[type=email].input.ng-dirty.ng-invalid,[type=password].input.ng-dirty.ng-invalid,[type=file].input.ng-dirty.ng-invalid,[type=url].input.ng-dirty.ng-invalid,select.input.ng-dirty.ng-invalid,textarea.input.ng-dirty.ng-invalid{border:1px solid #ed4758}textarea.input--nonresizable{resize:none}select.input{height:36px}input.theme-dark,select.theme-dark,textarea.theme-dark,.theme-dark .input[type=text],.theme-dark .input[type=number],.theme-dark .input[type=email],.theme-dark .input[type=password],.theme-dark .input[type=file],.theme-dark .input[type=url],.theme-dark select.input,.theme-dark textarea.input{background-color:#101823;border:1px solid #374a68;color:#fff}input.theme-light,select.theme-light,textarea.theme-light,.theme-light .input[type=text],.theme-light .input[type=number],.theme-light .input[type=email],.theme-light .input[type=password],.theme-light .input[type=file],.theme-light .input[type=url],.theme-light select.input,.theme-light textarea.input{background-color:#fff;border:1px solid #96a8c0;color:#283853}input.theme-light:focus,select.theme-light:focus,textarea.theme-light:focus,.theme-light .input[type=text]:focus,.theme-light .input[type=number]:focus,.theme-light .input[type=email]:focus,.theme-light .input[type=password]:focus,.theme-light .input[type=file]:focus,.theme-light .input[type=url]:focus,.theme-light select.input:focus,.theme-light textarea.input:focus{background-color:#fff}input.theme-light::placeholder,select.theme-light::placeholder,textarea.theme-light::placeholder,.theme-light .input[type=text]::placeholder,.theme-light .input[type=number]::placeholder,.theme-light .input[type=email]::placeholder,.theme-light .input[type=password]::placeholder,.theme-light .input[type=file]::placeholder,.theme-light .input[type=url]::placeholder,.theme-light select.input::placeholder,.theme-light textarea.input::placeholder{color:#374a6880}.rich-text-edit{border-radius:4px;padding:0;position:relative}.rich-text-edit__toolbar{display:none;border-top:none;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.rich-text-edit__editor{font-size:12px;border-bottom:none!important}.rich-text-edit__editor--text{border:none!important;box-shadow:none!important;display:inline-block;height:1em}.rich-text-edit__editor--textarea{border:none!important;box-shadow:none!important;overflow:auto;contain:size}.rich-text-edit__editor--resizeable{resize:vertical}.rich-text-edit--inline{display:flex;flex-direction:column}.rich-text-edit--inline .rich-text-edit__toolbar{display:block}.theme-dark .rich-text-edit,.theme-dark .rich-text-edit__editor--text,.theme-dark .rich-text-edit__editor--textarea{background-color:#101823;border:1px solid #374a68;color:#fff}.theme-light .rich-text-edit{background-color:#fff;border:1px solid #96a8c0;color:#283853}.theme-light .rich-text-edit:focus{background-color:#fff}.theme-light .rich-text-edit::placeholder{color:#374a6880}.theme-light .rich-text-edit__editor--text,.theme-light .rich-text-edit__editor--textarea{background-color:#fff;border:1px solid #96a8c0;color:#283853}.theme-light .rich-text-edit__editor--text:focus,.theme-light .rich-text-edit__editor--textarea:focus{background-color:#fff}.theme-light .rich-text-edit__editor--text::placeholder,.theme-light .rich-text-edit__editor--textarea::placeholder{color:#374a6880}\n",'.medium-editor-anchor-preview,.medium-editor-toolbar{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;z-index:2000}@keyframes medium-editor-image-loading{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes medium-editor-pop-upwards{0%{opacity:0;transform:matrix(.97,0,0,1,0,12)}20%{opacity:.7;transform:matrix(.99,0,0,1,0,2)}40%{opacity:1;transform:matrix(1,0,0,1,0,-1)}to{transform:scale(1)}}.medium-editor-anchor-preview{left:0;line-height:1.4;max-width:280px;position:absolute;text-align:center;top:0;word-break:break-all;word-wrap:break-word;visibility:hidden}.medium-editor-anchor-preview a{color:#fff;display:inline-block;margin:5px 5px 10px}.medium-editor-placeholder-relative:after,.medium-editor-placeholder:after{content:attr(data-placeholder)!important;white-space:pre;padding:inherit;margin:inherit;font-style:italic}.medium-editor-anchor-preview-active{visibility:visible}.medium-editor-dragover{background:#ddd}.medium-editor-image-loading{animation:medium-editor-image-loading 1s infinite ease-in-out;background-color:#333;border-radius:100%;display:inline-block;height:40px;width:40px}.medium-editor-placeholder{position:relative}.medium-editor-placeholder:after{position:absolute;left:0;top:0}.medium-editor-placeholder-relative,.medium-editor-placeholder-relative:after{position:relative}.medium-toolbar-arrow-over:before,.medium-toolbar-arrow-under:after{border-style:solid;content:"";display:block;height:0;left:50%;margin-left:-8px;position:absolute;width:0}.medium-toolbar-arrow-under:after{border-width:8px 8px 0}.medium-toolbar-arrow-over:before{border-width:0 8px 8px;top:-8px}.medium-editor-toolbar{left:0;position:absolute;top:0;visibility:hidden}.medium-editor-toolbar ul{margin:0;padding:0}.medium-editor-toolbar li{float:left;list-style:none;margin:0;padding:0}.medium-editor-toolbar li button{box-sizing:border-box;cursor:pointer;display:block;font-size:14px;line-height:1.33;margin:0;padding:15px;text-decoration:none}.medium-editor-toolbar li button:focus{outline:0}.medium-editor-toolbar li .medium-editor-action-underline{text-decoration:underline}.medium-editor-toolbar li .medium-editor-action-pre{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;font-weight:100;padding:15px 0}.medium-editor-toolbar-active{visibility:visible}.medium-editor-sticky-toolbar{position:fixed;top:1px}.medium-editor-relative-toolbar{position:relative}.medium-editor-toolbar-active.medium-editor-stalker-toolbar{animation:medium-editor-pop-upwards .16s forwards linear}.medium-editor-action-bold{font-weight:bolder}.medium-editor-action-italic{font-style:italic}.medium-editor-toolbar-form{display:none}.medium-editor-toolbar-form a,.medium-editor-toolbar-form input{font-family:Helvetica Neue,Helvetica,Arial,sans-serif}.medium-editor-toolbar-form .medium-editor-toolbar-form-row{line-height:14px;margin-left:5px;padding-bottom:5px}.medium-editor-toolbar-form .medium-editor-toolbar-input,.medium-editor-toolbar-form label{border:none;box-sizing:border-box;font-size:14px;margin:0;padding:6px;width:316px;display:inline-block}.medium-editor-toolbar-form .medium-editor-toolbar-input:focus,.medium-editor-toolbar-form label:focus{-webkit-appearance:none;appearance:none;border:none;box-shadow:none;outline:0}.medium-editor-toolbar-form a{display:inline-block;font-size:24px;font-weight:bolder;margin:0 10px;text-decoration:none}.medium-editor-toolbar-form-active{display:block}.medium-editor-toolbar-actions:after{clear:both;content:"";display:table}.medium-editor-element{word-wrap:break-word;min-height:30px}.medium-editor-element img{max-width:100%}.medium-editor-element sub{vertical-align:sub}.medium-editor-element sup{vertical-align:super}.medium-editor-hidden{display:none}\n',".input,:root .medium-editor-toolbar-form .medium-editor-toolbar-input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,textarea.input{border:1px solid #1b283c;border-radius:4px;background-color:#101823;color:#fff;display:block;min-height:36px;width:100%;font-size:12px;padding:8px 12px;font-family:Inter,sans-serif}@supports (font-variation-settings: normal){.input,:root .medium-editor-toolbar-form .medium-editor-toolbar-input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,textarea.input{font-family:Inter UI var alt,sans-serif}}.input:focus,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:focus,[type=text].input:focus,[type=number].input:focus,[type=email].input:focus,[type=password].input:focus,[type=file].input:focus,[type=url].input:focus,select.input:focus,textarea.input:focus{outline:#2d72dc solid 2px!important}.input:focus.ng-invalid,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:focus.ng-invalid,[type=text].input:focus.ng-invalid,[type=number].input:focus.ng-invalid,[type=email].input:focus.ng-invalid,[type=password].input:focus.ng-invalid,[type=file].input:focus.ng-invalid,[type=url].input:focus.ng-invalid,select.input:focus.ng-invalid,textarea.input:focus.ng-invalid{outline-color:#ed4758!important;outline-width:1px!important}.input--small,[type=text].input--small,[type=number].input--small,[type=email].input--small,[type=password].input--small,[type=file].input--small,[type=url].input--small,select.input--small,textarea.input--small{font-size:12px;padding:8px;min-height:auto}.input--large,[type=text].input--large,[type=number].input--large,[type=email].input--large,[type=password].input--large,[type=file].input--large,[type=url].input--large,select.input--large,textarea.input--large{font-size:16px;padding:12px}.input--success,[type=text].input--success,[type=number].input--success,[type=email].input--success,[type=password].input--success,[type=file].input--success,[type=url].input--success,select.input--success,textarea.input--success{border-color:#38de38!important}.input:disabled,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:disabled,[type=text].input:disabled,[type=number].input:disabled,[type=email].input:disabled,[type=password].input:disabled,[type=file].input:disabled,[type=url].input:disabled,select.input:disabled,textarea.input:disabled{opacity:.4}.input.ng-dirty.ng-invalid,:root .medium-editor-toolbar-form .ng-dirty.ng-invalid.medium-editor-toolbar-input,[type=text].input.ng-dirty.ng-invalid,[type=number].input.ng-dirty.ng-invalid,[type=email].input.ng-dirty.ng-invalid,[type=password].input.ng-dirty.ng-invalid,[type=file].input.ng-dirty.ng-invalid,[type=url].input.ng-dirty.ng-invalid,select.input.ng-dirty.ng-invalid,textarea.input.ng-dirty.ng-invalid{border:1px solid #ed4758}textarea.input--nonresizable{resize:none}select.input,:root .medium-editor-toolbar-form select.medium-editor-toolbar-input{height:36px}input.theme-dark,select.theme-dark,textarea.theme-dark,.theme-dark .input[type=text],:root .theme-dark .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=text].medium-editor-toolbar-input,.theme-dark .input[type=number],:root .theme-dark .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=number].medium-editor-toolbar-input,.theme-dark .input[type=email],:root .theme-dark .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=email].medium-editor-toolbar-input,.theme-dark .input[type=password],:root .theme-dark .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=password].medium-editor-toolbar-input,.theme-dark .input[type=file],:root .theme-dark .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=file].medium-editor-toolbar-input,.theme-dark .input[type=url],:root .theme-dark .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=url].medium-editor-toolbar-input,.theme-dark select.input,:root .theme-dark .medium-editor-toolbar-form select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark select.medium-editor-toolbar-input,.theme-dark textarea.input,:root .theme-dark .medium-editor-toolbar-form textarea.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark textarea.medium-editor-toolbar-input{background-color:#101823;border:1px solid #374a68;color:#fff}input.theme-light,select.theme-light,textarea.theme-light,.theme-light .input[type=text],:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input,.theme-light .input[type=number],:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input,.theme-light .input[type=email],:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input,.theme-light .input[type=password],:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input,.theme-light .input[type=file],:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input,.theme-light .input[type=url],:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input,.theme-light select.input,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input,.theme-light textarea.input,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input{background-color:#fff;border:1px solid #96a8c0;color:#283853}input.theme-light:focus,select.theme-light:focus,textarea.theme-light:focus,.theme-light .input[type=text]:focus,:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input:focus,.theme-light .input[type=number]:focus,:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input:focus,.theme-light .input[type=email]:focus,:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input:focus,.theme-light .input[type=password]:focus,:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input:focus,.theme-light .input[type=file]:focus,:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input:focus,.theme-light .input[type=url]:focus,:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input:focus,.theme-light select.input:focus,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input:focus,.theme-light textarea.input:focus,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input:focus{background-color:#fff}input.theme-light::placeholder,select.theme-light::placeholder,textarea.theme-light::placeholder,.theme-light .input[type=text]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input::placeholder,.theme-light .input[type=number]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input::placeholder,.theme-light .input[type=email]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input::placeholder,.theme-light .input[type=password]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input::placeholder,.theme-light .input[type=file]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input::placeholder,.theme-light .input[type=url]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input::placeholder,.theme-light select.input::placeholder,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input::placeholder,.theme-light textarea.input::placeholder,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input::placeholder{color:#374a6880}:root{--medium-toolbar-color: #131c2a;--medium-font-color: $gray-60;--medium-hover-font-color: $gray-60;--medium-selected-font-color: $gray-70;--medium-toolbar-border-color: $gray-20}:root .medium-editor-element{min-height:inherit}:root .medium-editor-relative-toolbar.medium-editor-toolbar{visibility:visible!important}:root .medium-toolbar-arrow-under:after{top:36px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:0;border-top:8px solid var(--medium-font-color)}:root .medium-toolbar-arrow-over:before{top:-8px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--medium-font-color);border-top:0}:root .medium-editor-toolbar{background-color:transparent;border-top:1px solid transparent;opacity:.3;z-index:500;margin-top:2px}:root .medium-editor-toolbar.medium-editor-stalker-toolbar{background-color:var(--medium-toolbar-color);border:1px solid var(--medium-toolbar-border-color);border-radius:4px;opacity:1}:root .medium-editor-toolbar li{margin:2px;padding:0}:root .medium-editor-toolbar li button{min-width:32px;height:32px;padding:8px;background-color:transparent;border:0;border-radius:0;color:var(--medium-font-color);transition:background-color .3s ease-in;font-size:12px}:root .medium-editor-action{color:var(--medium-font-color);border-top:1px solid transparent}:root .medium-editor-action:hover{color:var(--medium-hover-font-color);border-radius:4px}:root .medium-editor-action.medium-editor-button-active{color:var(--medium-selected-font-color)}:root .medium-editor-focused .medium-editor-toolbar{background-color:var(--medium-toolbar-color);border-top:1px solid var(--medium-toolbar-border-color);opacity:1}:root .medium-editor-compact .medium-editor-toolbar li{margin:0;padding:0}:root .medium-editor-compact .medium-editor-toolbar li button{min-width:30px;height:30px;padding:4px}:root .medium-editor-toolbar-form{padding:4px;border-radius:4px;color:var(--medium-selected-font-color)}:root .medium-editor-toolbar-form .medium-editor-toolbar-input{flex:1;box-sizing:border-box;color:var(--medium-selected-font-color)!important;background-color:var(--medium-toolbar-color)!important}:root .medium-editor-toolbar-form .medium-editor-toolbar-save,:root .medium-editor-toolbar-form .medium-editor-toolbar-close{margin:8px;padding:0;width:auto;height:auto;font-size:1em}:root .medium-editor-toolbar-form a{color:var(--medium-selected-font-color)}:root .medium-editor-toolbar-form-active{display:flex;flex-direction:row;align-items:center}:root .medium-editor-toolbar-anchor-preview{border-radius:4px;border:1px solid var(--medium-font-color);background-color:var(--medium-toolbar-color);color:var(--medium-font-color);font-size:12}:root .medium-editor-placeholder:after{color:var(--medium-font-color)}.theme-dark{--medium-toolbar-color: #131c2a;--medium-font-color: rgba(150, 168, 192, .6);--medium-hover-font-color: rgba(150, 168, 192, .8);--medium-selected-font-color: #d7e0ea;--medium-toolbar-border-color: #1c2a3f}.theme-light{--medium-toolbar-color: #f9fafd;--medium-font-color: rgba(40, 56, 83, .6);--medium-hover-font-color: rgba(40, 56, 83, .8);--medium-selected-font-color: #283853;--medium-toolbar-border-color: #d7e0ea}\n"],encapsulation:2,changeDetection:0}),t})();var Rn=v(56657);function Tl(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",6)(1,"div",7),e.nrm(2,"app-icon",8),e.k0s(),e.j41(3,"div",9)(4,"app-form-field",10),e.nrm(5,"app-content-upload-input",11),e.k0s(),e.j41(6,"div",12)(7,"app-form-field",13),e.nrm(8,"app-rich-text-edit",14,0)(10,"app-character-counter",15),e.k0s(),e.j41(11,"app-form-field",16),e.nrm(12,"textarea",17),e.k0s()()(),e.j41(13,"div",18)(14,"button",19),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRemoveImage(o))}),e.nrm(15,"app-icon",20),e.k0s()()()}if(2&s){const n=t.$implicit,i=e.sdS(9);e.Y8G("formGroup",n),e.R7$(4),e.Y8G("labelElement",!1),e.R7$(),e.Y8G("canDelete",!1),e.R7$(3),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",i)}}let xl=(()=>{var s;class t{get imageBlockImages(){return this.controlContainer.control.get("images")}constructor(i,o){this.controlContainer=i,this.formBuilder=o}handleAddImage(){const i=new pr.Y;this.imageBlockImages.push(this.addImage(i))}addImage(i){return this.formBuilder.group({urls:i.urls,alt:[i.alt,c.k0.maxLength(200)],caption:[i.caption,c.k0.maxLength(200)]})}handleRemoveImage(i){this.imageBlockImages.removeAt(i)}handleImageDrop(i){const{previousIndex:o,currentIndex:r}=i,l=this.imageBlockImages.at(o);this.imageBlockImages.removeAt(o),this.imageBlockImages.insert(r,l)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ZU),e.rXU(c.ze))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-images-block"]],decls:7,vars:2,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","images",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button",1,"w-40",3,"click"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],[1,"flex","edit-block__body"],["label","Image",1,"pr-1",2,"flex","0 0 240px",3,"labelElement"],["type","image","formControlName","urls",3,"canDelete"],[1,"grow"],["label","Label"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],["label","Alt"],["formControlName","alt",1,"input","edit-block__alt"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle","matTooltip","Remove Image",3,"click"],["icon","times"]],template:function(i,o){1&i&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2,"Images"),e.k0s(),e.j41(3,"div",3),e.bIt("cdkDropListDropped",function(l){return o.handleImageDrop(l)}),e.DNE(4,Tl,16,8,"div",4),e.j41(5,"button",5),e.bIt("click",function(){return o.handleAddImage()}),e.EFF(6," Add Image "),e.k0s()(),e.bVm()),2&i&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(4),e.Y8G("ngForOf",o.imageBlockImages.controls))},dependencies:[E.Sq,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,ee.K,Ft.P,Y.R,Rn.c,te.O7,te.T1,te.Fb,At,L.Q,Ce.oV],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__body[_ngcontent-%COMP%]{flex:1 0 auto}.edit-block__alt[_ngcontent-%COMP%]{resize:vertical}"],changeDetection:0}),t})();var Mn=v(59369);function El(s,t){1&s&&(e.qex(0),e.j41(1,"mat-checkbox",4),e.EFF(2,"Show EKG Graph"),e.k0s(),e.bVm())}function wl(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",11)(1,"div",12),e.nrm(2,"app-icon",13),e.k0s(),e.j41(3,"div",14)(4,"app-form-field",15),e.nrm(5,"app-content-upload-input",16),e.k0s(),e.j41(6,"app-form-field",17),e.nrm(7,"app-rich-text-edit",18,0)(9,"app-character-counter",19),e.k0s()(),e.j41(10,"div",20)(11,"button",21),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG(2);return e.Njj(r.handleRemoveImage(o))}),e.nrm(12,"app-icon",22),e.k0s()()()}if(2&s){const n=t.$implicit,i=e.sdS(8);e.Y8G("formGroup",n),e.R7$(4),e.Y8G("labelElement",!1),e.R7$(),e.Y8G("canDelete",!1),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",i)}}function Fl(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"app-form-field",5)(2,"mat-checkbox",6),e.EFF(3,"Loop"),e.k0s(),e.qex(4,7),e.EFF(5," Creates the appearance of a continuous uninterrupted image "),e.bVm(),e.k0s(),e.j41(6,"div",8),e.bIt("cdkDropListDropped",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleImageDrop(o))}),e.DNE(7,wl,13,8,"div",9),e.j41(8,"button",10),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleAddImage())}),e.EFF(9," Add EKG Image "),e.k0s()(),e.bVm()}if(2&s){const n=e.XpG();e.R7$(7),e.Y8G("ngForOf",n.images.controls)}}let Pl=(()=>{var s;class t{get images(){return this.controlContainer.control.get("images")}constructor(i,o){this.controlContainer=i,this.formBuilder=o,this.environmentApplication=Me.c}handleAddImage(){const i=new dr.F;this.images.push(this.addBlock(i))}addBlock(i){return this.formBuilder.group({urls:i.urls,alt:[i.alt,c.k0.maxLength(200)],caption:[i.caption,c.k0.maxLength(200)]})}handleRemoveImage(i){this.images.removeAt(i)}handleImageDrop(i){const{previousIndex:o,currentIndex:r}=i,l=this.images.at(o);this.images.removeAt(o),this.images.insert(r,l)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ZU),e.rXU(c.ze))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-ticker-block"]],decls:5,vars:3,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],[4,"appFlagApplication"],["formControlName","enable",1,"text-xs"],["label","Loop Image",1,"grow"],["formControlName","loopImage",1,"text-xs"],["form-field-help",""],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","images",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button",1,"w-40",3,"click"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],[1,"flex","edit-block__body"],["label","Image",1,"pr-1",2,"flex","0 0 240px",3,"labelElement"],["type","image","formControlName","urls",3,"canDelete"],["label","Label",1,"grow"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle","matTooltip","Remove Image",3,"click"],["icon","times"]],template:function(i,o){1&i&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2,"EKG"),e.k0s(),e.DNE(3,El,3,0,"ng-container",3)(4,Fl,10,1,"ng-container",3),e.bVm()),2&i&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(3),e.Y8G("appFlagApplication",o.environmentApplication.Studio),e.R7$(),e.Y8G("appFlagApplication",o.environmentApplication.Loft))},dependencies:[E.Sq,c.BC,c.cb,c.j4,c.JD,c.v8,ee.K,Ft.P,Y.R,Rn.c,te.O7,te.T1,te.Fb,At,L.Q,De.So,Ce.oV,Mn.Y],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__body[_ngcontent-%COMP%]{flex:1 0 auto}"],changeDetection:0}),t})();var jn=v(21424),zo=v(39596);function Rl(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",6)(1,"div",7),e.nrm(2,"app-icon",8),e.k0s(),e.j41(3,"app-form-field",9)(4,"app-content-upload-input",10),e.bIt("uploadInput",function(o){const r=e.eBV(n).index,l=e.XpG();return e.Njj(l.handleUploadInput(o,r))}),e.k0s(),e.j41(5,"div",11),e.EFF(6),e.k0s()(),e.j41(7,"app-form-field",12),e.nrm(8,"app-rich-text-edit",13,0)(10,"app-character-counter",14),e.k0s(),e.j41(11,"div",15)(12,"button",16),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRemoveVideo(o))}),e.nrm(13,"app-icon",17),e.k0s()()()}if(2&s){const n=t.$implicit,i=t.index,o=e.sdS(9),r=e.XpG();e.Y8G("formGroup",n),e.R7$(3),e.Y8G("labelElement",!1),e.R7$(),e.Y8G("canDelete",!1)("showExtensions",!1),e.R7$(2),e.SpI(" ",r.videoBlockVideos.value[i].srcFilename," "),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",o)}}let Ml=(()=>{var s;class t{get videoBlockVideos(){return this.controlContainer.control.get("videos")}constructor(i,o,r,l){this.controlContainer=i,this.formBuilder=o,this.store=r,this.userAccessService=l}ngOnDestroy(){this.filterVideos()}handleAddVideo(){if(this.store.selectSnapshot(jn.q.isValidPaidSubscription)){const i=new mr.Q;this.videoBlockVideos.push(this.createVideo(i))}else this.userAccessService.openVideoUploadGate()}createVideo(i){return this.formBuilder.group({url:i.url,caption:[i.caption,c.k0.maxLength(200)],srcFilename:i.srcFilename})}handleRemoveVideo(i){this.videoBlockVideos.removeAt(i)}handleVideoDrop(i){const{previousIndex:o,currentIndex:r}=i,l=this.videoBlockVideos.at(o);this.videoBlockVideos.removeAt(o),this.videoBlockVideos.insert(r,l)}handleUploadInput(i,o){const r=i.file?.name||"";this.videoBlockVideos.at(o).patchValue({srcFilename:r})}filterVideos(){const i=this.videoBlockVideos.value;for(let o=i.length-1;o>=0;o--)i[o].url||this.videoBlockVideos.removeAt(o)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ZU),e.rXU(c.ze),e.rXU(a.il),e.rXU(zo.p))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-videos-block"]],decls:7,vars:3,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","videos",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","data-test","addVideo",1,"w-40",3,"click","disabled"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],["label","Video",1,"edit-block__video",3,"labelElement"],["type","video","formControlName","url",3,"uploadInput","canDelete","showExtensions"],[1,"mb-1","break-words","text-2xs"],["label","Video Caption",1,"grow"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle","matTooltip","Remove Video",3,"click"],["icon","times"]],template:function(i,o){1&i&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2,"Videos"),e.k0s(),e.j41(3,"div",3),e.bIt("cdkDropListDropped",function(l){return o.handleVideoDrop(l)}),e.DNE(4,Rl,14,10,"div",4),e.j41(5,"button",5),e.bIt("click",function(){return o.handleAddVideo()}),e.EFF(6," Add Video "),e.k0s()(),e.bVm()),2&i&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(4),e.Y8G("ngForOf",o.videoBlockVideos.controls),e.R7$(),e.Y8G("disabled",o.videoBlockVideos.controls.length>=3))},dependencies:[E.Sq,c.BC,c.cb,c.j4,c.JD,c.v8,ee.K,Ft.P,Y.R,Rn.c,te.O7,te.T1,te.Fb,At,L.Q,Ce.oV],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__video[_ngcontent-%COMP%]{width:240px;min-width:240px;padding-right:4px}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}"],changeDetection:0}),t})();var Ze=v(59429);const jl=(s,t,n,i)=>({"text-to-speech--light":s,"text-to-speech--dark":t,"text-to-speech--compact":n,"text-to-speech--inline":i});function Il(s,t){if(1&s&&(e.j41(0,"span",5),e.EFF(1),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.JRh(n.playStateText)}}let Nl=(()=>{var s;class t{get text(){return this._text}set text(i){this._text=i,this.resetAudioState()}get localeId(){return this._localeId}set localeId(i){this._localeId=i,this.resetAudioState()}set language(i){const o=Fn.IB.find(r=>r.lang===i)||Fn.q;this.localeId=o.id}get playStateText(){return this.playing?"Stop narration":"Listen to narration"}constructor(i,o){this.changeRef=i,this.mediaService=o,this.theme="dark",this.readyState="empty",this.playing=!1,this.ended=!1,this.ngUnsubscribe=new b.B,this.id=Ze.u.getUuid()}ngOnDestroy(){this.destroyAudio(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayToggleClicked(){this.toggleAudio()}toggleAudio(){this.playing?this.pause():this.play(this.ended)}pause(){var i=this;return(0,ct.A)(function*(){const o=yield i.mediaService.getAudioPlayer(i.id);(0,R.isNil)(o)||o.pause()})()}play(i=!1){var o=this;return(0,ct.A)(function*(){let r;o.mediaService.hasAudioPlayer(o.id)?r=yield o.mediaService.getAudioPlayer(o.id):(r=yield o.mediaService.addAudioPlayer(o.id,o.mediaService.getTTSSources(o.text,o.localeId),!1),o.initAudioPlayer(r)),(0,R.isNil)(r)||(o.mediaService.stopAllOtherAudio(o.id),i&&r.stop(),r.play())})()}initAudioPlayer(i){this.readyState="loading",i.on("load",()=>{this.readyState="ready",this.changeRef.markForCheck()}),i.on("loaderror",()=>{this.resetAudioState(),this.changeRef.markForCheck()}),i.on("play",()=>{this.playing=!0,this.ended=!1,this.changeRef.markForCheck()}),i.on("pause",()=>{this.playing=!1,this.changeRef.markForCheck()}),i.on("end",()=>{this.playing=!1,this.ended=!0,this.changeRef.markForCheck()}),i.on("stop",()=>{this.playing=!1,this.changeRef.markForCheck()}),i.on("playerror",()=>{this.playing=!1,this.changeRef.markForCheck()}),this.changeRef.markForCheck()}resetAudioState(){this.destroyAudio(),this.readyState="empty",this.playing=!1,this.ended=!1,this.changeRef.markForCheck()}destroyAudio(){this.mediaService.removeAudioPlayer(this.id)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.gRc),e.rXU(cr.u))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-text-to-speech"]],inputs:{text:"text",localeId:"localeId",compact:"compact",inline:"inline",theme:"theme",language:"language"},decls:5,vars:10,consts:[[1,"text-to-speech",3,"ngClass"],["type","button","data-test","textNarrationButton",1,"text-to-speech__button","w-full",3,"click","disabled"],[1,"flex","flex-row","items-center"],[1,"text-to-speech__icon",3,"icon"],["class","text-to-speech__label flex-auto",4,"ngIf"],[1,"text-to-speech__label","flex-auto"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"button",1),e.bIt("click",function(){return o.handlePlayToggleClicked()}),e.j41(2,"div",2),e.nrm(3,"app-icon",3),e.DNE(4,Il,2,1,"span",4),e.k0s()()()),2&i&&(e.Y8G("ngClass",e.ziG(5,jl,"light"===o.theme,"dark"===o.theme,o.compact,o.inline)),e.R7$(),e.Y8G("disabled","loading"===o.readyState),e.BMQ("aria-label",o.playStateText),e.R7$(2),e.Y8G("icon",o.playing?"pause":"play"),e.R7$(),e.Y8G("ngIf",!o.compact))},dependencies:[E.YU,E.bT,Y.R],styles:[".text-to-speech__button[_ngcontent-%COMP%]{padding:4px 8px;cursor:pointer;background:none;border:none;border-radius:4px}.text-to-speech__button[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.text-to-speech__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid;border-radius:50%;font-size:.75rem;line-height:1rem}.text-to-speech__label[_ngcontent-%COMP%]{margin-left:12px;text-align:left;font-size:.875rem;line-height:1.25rem}.text-to-speech--inline[_ngcontent-%COMP%]{display:inline-block}.text-to-speech--compact[_ngcontent-%COMP%]{padding:4px}.text-to-speech--compact[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{width:20px;height:20px;font-size:.625rem;line-height:.75rem}.text-to-speech--compact[_ngcontent-%COMP%]   .text-to-speech__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.text-to-speech--light[_ngcontent-%COMP%]   .text-to-speech__button[_ngcontent-%COMP%]{color:#374a68}.text-to-speech--light[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{border-color:#96a8c0}.text-to-speech--dark[_ngcontent-%COMP%]   .text-to-speech__button[_ngcontent-%COMP%]{color:#96a8c0}.text-to-speech--dark[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{border-color:#374a68}"],changeDetection:0}),t})();var Bl=v(89079),qe=v(49206),oo=v(3272),Tr=v(72026),xr=v(11818),Dl=v(4763),Er=v(2096),Ut=v(45189);let Xo=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD,c.X1,Ut.G,io.y2.forChild()]}),t})();const Gl=(s,t)=>t.value.id;function $l(s,t){if(1&s&&(e.j41(0,"div",1),e.EFF(1),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.JRh(n.label())}}function Ol(s,t){if(1&s&&(e.j41(0,"app-form-field",17),e.nrm(1,"input",19),e.k0s()),2&s){const n=e.XpG(2);e.Y8G("isCompact",!0),e.R7$(),e.Y8G("placeholder","e.g.,"+n.defaultReviewProcessUrl)}}function Al(s,t){1&s&&(e.j41(0,"app-form-field",18),e.nrm(1,"input",20),e.k0s()),2&s&&e.Y8G("isCompact",!0)}function Ul(s,t){if(1&s&&(e.j41(0,"app-form-field",11)(1,"div",12)(2,"div",13)(3,"mat-checkbox",4),e.nrm(4,"app-badge",14),e.k0s()(),e.j41(5,"div",15)(6,"mat-checkbox",4),e.nrm(7,"app-badge",16),e.k0s()()()(),e.DNE(8,Ol,2,2,"app-form-field",17)(9,Al,2,1,"app-form-field",18)),2&s){const n=e.XpG();e.Y8G("labelElement",!1)("isCompact",!0),e.R7$(8),e.vxM(8,n.form.value.reviewed.enabled?8:-1),e.R7$(),e.vxM(9,n.form.value.collaborated.enabled?9:-1)}}function Vl(s,t){if(1&s&&e.nrm(0,"input",6),2&s){const n=e.XpG();e.Y8G("value",n.updateDateText())}}function Ll(s,t){if(1&s){const n=e.RV6();e.j41(0,"li",21)(1,"span",22),e.EFF(2),e.k0s(),e.j41(3,"div",23),e.nrm(4,"app-rich-text-edit",24),e.k0s(),e.j41(5,"button",25),e.bIt("click",function(){const o=e.eBV(n).$index,r=e.XpG(2);return e.Njj(r.removeReferenceClick(o))}),e.j41(6,"span",26),e.EFF(7,"Remove reference"),e.k0s(),e.nrm(8,"app-icon",27),e.k0s()()}if(2&s){const i=t.$index;e.Y8G("formGroup",t.$implicit),e.R7$(2),e.SpI("",i+1,"."),e.R7$(2),e.Y8G("inline",!0)("compact",!0)}}function Yl(s,t){if(1&s&&(e.j41(0,"ol",9),e.Z7z(1,Ll,9,4,"li",21,Gl),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.Dyx(n.referencesFormArray.controls)}}let wr=(()=>{var s;class t extends qe.n{get referencesFormArray(){return this.form.controls.references}constructor(){super(),this.defaultReviewProcessUrl=Er.eq,this.enabledSource=e.hFB.required(),this.label=(0,e.hFB)(""),this.updateDate=e.hFB.required(),this.updateDateText=(0,e.EWP)(()=>{const i=this.updateDate();return i?new Date(i).toLocaleDateString():""}),this.form=new c.gE({reviewed:new c.gE({enabled:new c.MJ(!1),authors:new c.MJ(""),url:new c.MJ(Er.eq)}),collaborated:new c.gE({enabled:new c.MJ(!1),authors:new c.MJ(""),url:new c.MJ("")}),references:new c.Yp([]),audit:new c.gE({enabled:new c.MJ(!1)})}),this.initFormListeners()}initFormListeners(){this.form.valueChanges.pipe((0,Bl.pQ)()).subscribe(i=>{this.value=i})}setFormValues(i){(0,R.isEqual)({...this.form.value,audit:{...this.form.value.audit,timestamp:void 0}},{...i,audit:{...i.audit,timestamp:void 0}})||(this.referencesFormArray.clear({emitEvent:!1}),i.references.forEach(()=>{this.referencesFormArray.push(new c.gE({id:new c.MJ(""),label:new c.MJ("")}),{emitEvent:!1})}),this.form.patchValue(i,{emitEvent:!1}))}handleAddReferenceClick(){const i=this.value,{references:o}=i;this.value={...i,references:[...o,{id:Ze.u.idWithPrefix("source-reference"),label:""}]}}removeReferenceClick(i){this.form.controls.references.removeAt(i)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-source-info-form"]],inputs:{enabledSource:[e.Mj6.SignalBased,"enabledSource"],label:[e.Mj6.SignalBased,"label"],updateDate:[e.Mj6.SignalBased,"updateDate"]},standalone:!0,features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3,e.aNF],decls:16,vars:7,consts:[[1,"flex","flex-col","gap-4","theme-light","source-info-form",3,"formGroup"],[1,"text-sm","font-bold"],[1,"text-xs","source-info-form__blurb"],["label","Updated On","formGroupName","audit",3,"isCompact","labelElement"],["formControlName","enabled"],[1,"text-xs"],["type","text","disabled","",1,"mt-1","input",3,"value"],[1,"flex","flex-col","gap-4","mt-6"],[1,"text-sm","font-semibold"],["formArrayName","references",1,"flex","flex-col","gap-4"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",1,"w-40",3,"click"],["label","Trust Badges",3,"labelElement","isCompact"],[1,"flex","flex-row","gap-6"],["formGroupName","reviewed"],["theme","blue","icon","check","label","Medically Reviewed"],["formGroupName","collaborated"],["theme","green","icon","check","label","Built in Collaboration"],["label","Review Process Link","formGroupName","reviewed",3,"isCompact"],["label","Collaborators","formGroupName","collaborated",3,"isCompact"],["type","text","formControlName","url",1,"input",3,"placeholder"],["type","text","formControlName","authors","placeholder","e.g., Bill Nye, The Science Guy",1,"input"],[1,"flex","flex-row","items-start","justify-between","gap-3",3,"formGroup"],[1,"text-xs","text-right",2,"flex","0 1 20px"],[1,"flex-auto"],["textMode","text","mode","extended","placeholder","e.g., Gilroy, Anne M, et al. Atlas of Anatomy. New York, Thieme, 2020.","formControlName","label",3,"inline","compact"],["app-button","","buttonShape","square","buttonTheme","light",3,"click"],[1,"sr-only"],["icon","times"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.DNE(1,$l,2,1,"div",1),e.j41(2,"div",2),e.EFF(3," Include the details of the source information in your content. "),e.k0s(),e.DNE(4,Ul,10,4),e.j41(5,"app-form-field",3)(6,"mat-checkbox",4)(7,"span",5),e.EFF(8,'Show "Updated on" date'),e.k0s()(),e.DNE(9,Vl,1,1,"input",6),e.k0s(),e.j41(10,"div",7)(11,"h2",8),e.EFF(12,"References"),e.k0s(),e.DNE(13,Yl,3,0,"ol",9),e.j41(14,"button",10),e.bIt("click",function(){return o.handleAddReferenceClick()}),e.EFF(15," Add Reference "),e.k0s()()()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(),e.vxM(1,o.label()?1:-1),e.R7$(3),e.vxM(4,o.enabledSource()?4:-1),e.R7$(),e.Y8G("isCompact",!0)("labelElement",!1),e.R7$(4),e.vxM(9,o.form.value.audit.enabled?9:-1),e.R7$(4),e.vxM(13,o.referencesFormArray.controls.length>0?13:-1))},dependencies:[c.X1,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,oo.D,ee.K,De.g7,De.So,Tr.o,Y.R,xr.C,L.Q,Dl.n,Xo,At],styles:[".source-info-form[_ngcontent-%COMP%]{color:#131c2a}.source-info-form__blurb[_ngcontent-%COMP%]{color:#1c2a3f}"]}),t})();var In,sn=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},rn=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const zl=["lightLibInput"],Fr=s=>({"content__section--selected":s}),Xl=s=>({"content__check-group--split":s});function Ql(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",17),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleChapterClick(o))}),e.j41(1,"div",18),e.EFF(2),e.k0s(),e.j41(3,"div",12),e.EFF(4),e.k0s()()}if(2&s){const n=t.$implicit,i=t.index,o=e.XpG();e.Y8G("ngClass",e.eq3(3,Fr,n.id===o.selectedChapterId)),e.R7$(2),e.SpI("",i+1,"."),e.R7$(2),e.SpI(" ",n.displayName||"-No Title-"," ")}}function ql(s,t){if(1&s&&(e.qex(0),e.j41(1,"div",27),e.nrm(2,"app-source-info-form",28),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s(),e.bVm()),2&s){let n;const i=e.XpG(2);e.R7$(2),e.Y8G("enabledSource",!1)("updateDate",null!==(n=null==(n=e.bMT(3,2,i.bookmark$))?null:n.update_date_time)&&void 0!==n?n:null==(n=e.bMT(4,4,i.bookmark$))?null:n.create_date_time)}}function Hl(s,t){if(1&s&&(e.j41(0,"div",49)(1,"mat-checkbox",50),e.EFF(2),e.k0s()()),2&s){const n=t.$implicit;e.Y8G("formGroupName",t.index),e.R7$(2),e.SpI(" ",n.get("tag").value," ")}}function Wl(s,t){if(1&s&&(e.j41(0,"app-panel",46)(1,"div",47),e.DNE(2,Hl,3,2,"div",48),e.k0s()()),2&s){const n=t.$implicit;e.Y8G("formGroupName",t.index)("label",n.get("title").value)("isCompact",!0),e.R7$(),e.Y8G("ngClass",e.eq3(5,Xl,n.get("tags").controls.length>=3)),e.R7$(),e.Y8G("ngForOf",n.get("tags").controls)}}function Jl(s,t){if(1&s&&(e.j41(0,"li"),e.EFF(1),e.j41(2,"span",51),e.EFF(3),e.nI1(4,"uppercase"),e.k0s()()),2&s){const n=t.$implicit;e.R7$(),e.SpI(" ",n.libId," "),e.R7$(2),e.SpI("(",e.bMT(4,2,n.type),")")}}function Kl(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"div",29)(2,"app-tabs",30)(3,"app-tab",31)(4,"button",32),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleClearTagsSelectionClick())}),e.EFF(5," Clear Tags "),e.k0s(),e.j41(6,"div",33),e.DNE(7,Wl,3,7,"app-panel",34),e.k0s()(),e.j41(8,"app-tab",35),e.nrm(9,"app-source-info-form",36),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s(),e.j41(12,"app-tab",37)(13,"div",38)(14,"div",39),e.EFF(15,"Any unused libraries will be removed during save."),e.k0s(),e.j41(16,"app-panel",40)(17,"ul",41),e.DNE(18,Jl,5,4,"li",42),e.k0s(),e.j41(19,"div",43)(20,"input",44,1),e.bIt("input",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.checkGetLightLib())}),e.k0s(),e.j41(22,"button",45),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleLoadLightsLib())}),e.EFF(23," Load Library "),e.k0s()()()()()()(),e.bVm()}if(2&s){let n;const i=e.XpG(2);e.R7$(2),e.Y8G("scrollable",!0)("tabPadded",!0),e.R7$(5),e.Y8G("ngForOf",i.tagCategories.controls),e.R7$(2),e.Y8G("enabledSource",!0)("updateDate",null!==(n=null==(n=e.bMT(10,7,i.bookmark$))?null:n.update_date_time)&&void 0!==n?n:null==(n=e.bMT(11,9,i.bookmark$))?null:n.create_date_time),e.R7$(9),e.Y8G("ngForOf",i.lightLibs),e.R7$(4),e.Y8G("disabled",i.disableGetLightLib)}}function Zl(s,t){if(1&s&&(e.j41(0,"div",19)(1,"form",20)(2,"app-form-field",21),e.nrm(3,"input",22,0)(5,"app-character-counter",23),e.k0s(),e.nrm(6,"mat-divider",24),e.DNE(7,ql,5,6,"ng-container",25)(8,Kl,24,11,"ng-container",26),e.k0s()()),2&s){const n=e.sdS(4),i=e.XpG();e.R7$(),e.Y8G("formGroup",i.bookmarkForm),e.R7$(4),e.Y8G("field",n)}}function ec(s,t){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-images-block",52),e.j41(2,"div",74),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const n=e.XpG().$implicit;e.R7$(),e.Y8G("formGroup",n)}}function tc(s,t){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-videos-block",52),e.j41(2,"div",74),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const n=e.XpG().$implicit;e.R7$(),e.Y8G("formGroup",n)}}function nc(s,t){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-ticker-block",52),e.j41(2,"div",74),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const n=e.XpG(2).$implicit;e.R7$(),e.Y8G("formGroup",n)}}function ic(s,t){if(1&s&&(e.qex(0),e.DNE(1,nc,4,1,"ng-container",75),e.bVm()),2&s){const n=e.XpG(3);e.R7$(),e.Y8G("ngIf",n.showTickerBlock)}}function oc(s,t){1&s&&(e.j41(0,"div",72),e.DNE(1,ec,4,1,"ng-container",73)(2,tc,4,1,"ng-container",73)(3,ic,2,1,"ng-container",73),e.k0s()),2&s&&(e.Y8G("ngSwitch",t.$implicit.value.type),e.R7$(),e.Y8G("ngSwitchCase","images"),e.R7$(),e.Y8G("ngSwitchCase","videos"),e.R7$(),e.Y8G("ngSwitchCase","ticker"))}function sc(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",76),e.nrm(1,"app-color-picker-input",77)(2,"input",78),e.j41(3,"button",79),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG(2);return e.Njj(r.handleRemoveLegendItem(o))}),e.nrm(4,"app-icon",80),e.k0s()()}2&s&&(e.Y8G("formGroupName",t.index),e.R7$(),e.Y8G("useRootContainer",!1))}function rc(s,t){if(1&s&&(e.j41(0,"div")(1,"div",81)(2,"div",82),e.nrm(3,"app-text-to-speech",83),e.nI1(4,"async"),e.k0s()()()),2&s){const n=e.XpG(2);e.R7$(3),e.Y8G("text",n.narrationText)("language",e.bMT(4,2,n.storyLanguage$))}}function ac(s,t){if(1&s&&(e.j41(0,"option",104)(1,"span"),e.EFF(2),e.nI1(3,"uppercase"),e.k0s()()),2&s){const n=t.$implicit,i=e.XpG(4);e.Y8G("value",n.lang)("disabled",i.usedLocales.includes(n.lang)),e.R7$(2),e.Lme("",n.title," (",e.bMT(3,4,n.lang),")")}}function lc(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",87)(1,"div",88)(2,"div",89)(3,"button",90),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG(3);return e.Njj(r.handleRemoveAudioItem(o))}),e.j41(4,"div",67)(5,"span",91),e.EFF(6,"replace file"),e.k0s(),e.nrm(7,"app-icon",80),e.k0s()()(),e.j41(8,"div",92)(9,"div",93),e.EFF(10,"Language"),e.k0s(),e.j41(11,"div",94)(12,"div",95)(13,"div",96),e.nrm(14,"img",97),e.j41(15,"span",98),e.EFF(16),e.k0s()(),e.nrm(17,"app-icon",99),e.k0s(),e.j41(18,"select",100),e.bIt("change",function(o){const r=e.eBV(n).index,l=e.XpG(3);return e.Njj(l.handleAudioItemChange(o,r))}),e.DNE(19,ac,4,6,"option",101),e.k0s()(),e.j41(20,"div",102)(21,"app-content-upload-input",103),e.bIt("uploadSuccess",function(o){const r=e.eBV(n).index,l=e.XpG(3);return e.Njj(l.onAudioFileSuccess(o,r))}),e.k0s()()()()()}if(2&s){const n=t.$implicit,i=t.index,o=e.XpG(3);e.Y8G("formGroupName",i),e.R7$(14),e.Y8G("src",o.getLocaleFlag(n.value.lang),e.B4B),e.R7$(2),e.JRh(o.getLocaleString(n.value.lang)),e.R7$(3),e.Y8G("ngForOf",o.locales),e.R7$(2),e.Y8G("canDelete",!1)}}function cc(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",105),e.bIt("click",function(){e.eBV(n);const o=e.XpG(3);return e.Njj(o.handleAddAudioItem())}),e.EFF(1," Add Audio "),e.k0s()}}function pc(s,t){if(1&s&&(e.j41(0,"div")(1,"div",84),e.DNE(2,lc,22,5,"div",85),e.k0s(),e.DNE(3,cc,2,0,"button",86),e.k0s()),2&s){const n=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",n.audio.controls),e.R7$(),e.Y8G("ngIf",n.usedLocales.length<n.locales.length)}}function dc(s,t){1&s&&e.eu8(0)}function mc(s,t){1&s&&e.nrm(0,"mat-divider",112),2&s&&e.Y8G("vertical",!0)}function uc(s,t){1&s&&(e.j41(0,"mat-radio-group",129)(1,"app-list",125)(2,"app-list-item")(3,"mat-radio-button",71),e.EFF(4,"Play once"),e.k0s()(),e.j41(5,"app-list-item")(6,"mat-radio-button",71),e.EFF(7,"Play indefinitely"),e.k0s()()()()),2&s&&(e.R7$(3),e.Y8G("value",1),e.R7$(3),e.Y8G("value",-1))}function hc(s,t){1&s&&(e.j41(0,"mat-checkbox",130),e.EFF(1," Loop to Audio "),e.k0s())}function fc(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",113)(1,"div",60),e.EFF(2," Animation "),e.j41(3,"button",114),e.bIt("click",function(){e.eBV(n);const o=e.XpG(3);return e.Njj(o.applyAnimationsToAll())}),e.nrm(4,"app-icon",69),e.k0s()(),e.j41(5,"div",115)(6,"app-form-field",116),e.DNE(7,uc,8,2,"mat-radio-group",117)(8,hc,2,0,"mat-checkbox",118),e.nrm(9,"mat-divider",119),e.j41(10,"mat-checkbox",120),e.EFF(11," Autoplay "),e.k0s()(),e.j41(12,"app-form-field",121),e.qex(13,122),e.j41(14,"span",123),e.EFF(15,"Note:"),e.k0s(),e.EFF(16," Save to preview changes in Viewer. "),e.bVm(),e.j41(17,"mat-radio-group",124)(18,"app-list",125)(19,"app-list-item")(20,"mat-radio-button",126),e.EFF(21,"None"),e.k0s()(),e.j41(22,"app-list-item")(23,"mat-radio-button",127),e.EFF(24,"Play/Pause"),e.k0s()(),e.j41(25,"app-list-item")(26,"mat-radio-button",128),e.EFF(27,"Scrubber"),e.k0s()()()()()()()}if(2&s){const n=e.XpG(3);e.R7$(7),e.Y8G("ngIf",!n.hasAudio),e.R7$(),e.Y8G("ngIf",n.hasAudio)}}function gc(s,t){if(1&s&&(e.j41(0,"option",71),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n.libId),e.R7$(),e.Lme(" ",n.libId," (",e.bMT(2,3,n.type),") ")}}function bc(s,t){1&s&&(e.qex(0),e.j41(1,"mat-checkbox",134)(2,"span",38),e.EFF(3,"Enable skin options"),e.k0s()(),e.bVm())}function _c(s,t){if(1&s&&(e.j41(0,"option",71),e.EFF(1),e.k0s()),2&s){const n=t.$implicit,i=e.XpG(6);e.Y8G("value",n),e.R7$(),e.SpI(" ",i.layersModesTitles[n]," ")}}function Cc(s,t){if(1&s&&(e.j41(0,"app-form-field",138)(1,"select",139),e.DNE(2,_c,2,2,"option",111),e.k0s()()),2&s){const n=e.XpG(5);e.R7$(2),e.Y8G("ngForOf",n.layersModes)}}function vc(s,t){if(1&s&&(e.j41(0,"div",135)(1,"mat-checkbox",136)(2,"span",38),e.EFF(3,"Enable layer slider"),e.k0s()(),e.DNE(4,Cc,3,1,"app-form-field",137),e.k0s()),2&s){const n=e.XpG(4);e.R7$(4),e.Y8G("ngIf",!0===n.formVisibilityLayers.value)}}function yc(s,t){if(1&s&&(e.qex(0),e.nrm(1,"mat-divider",24),e.j41(2,"div",131)(3,"div",132),e.EFF(4,"Anatomy Configuration"),e.k0s(),e.DNE(5,bc,4,0,"ng-container",75),e.nI1(6,"async"),e.DNE(7,vc,5,1,"div",133),e.nI1(8,"async"),e.k0s(),e.bVm()),2&s){let n;const i=e.XpG(3);e.R7$(5),e.Y8G("ngIf",!i.isEmpty(e.bMT(6,2,i.skinVariants$))),e.R7$(2),e.Y8G("ngIf",(null==(n=e.bMT(8,4,i.visibilityLayers$))?null:n.length)>0)}}function kc(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"div",27),e.nrm(2,"mat-divider"),e.k0s(),e.j41(3,"div",106),e.DNE(4,dc,1,0,"ng-container",107)(5,mc,1,1,"mat-divider",108)(6,fc,28,2,"div",109),e.k0s(),e.nrm(7,"mat-divider",24),e.j41(8,"div",66)(9,"div",60),e.EFF(10,"Lights"),e.k0s(),e.j41(11,"select",110),e.bIt("change",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleLightsChange())}),e.DNE(12,gc,3,5,"option",111),e.k0s()(),e.DNE(13,yc,9,6,"ng-container",75),e.nI1(14,"async"),e.nI1(15,"async"),e.bVm()}if(2&s){let n;e.XpG();const i=e.sdS(42),o=e.XpG();e.R7$(4),e.Y8G("ngTemplateOutlet",i),e.R7$(),e.Y8G("ngIf",o.selectedChapterAnimated),e.R7$(),e.Y8G("ngIf",o.selectedChapterAnimated),e.R7$(5),e.Y8G("disabled",0===o.selectedChapterLightLibs.length),e.R7$(),e.Y8G("ngForOf",o.selectedChapterLightLibs),e.R7$(),e.Y8G("ngIf",(null==(n=e.bMT(14,6,o.visibilityLayers$))?null:n.length)>0||!o.isEmpty(e.bMT(15,8,o.skinVariants$)))}}function Sc(s,t){1&s&&e.eu8(0)}function Tc(s,t){if(1&s&&(e.qex(0),e.nrm(1,"mat-divider",140),e.j41(2,"div",141),e.DNE(3,Sc,1,0,"ng-container",107),e.k0s(),e.bVm()),2&s){e.XpG();const n=e.sdS(42);e.R7$(3),e.Y8G("ngTemplateOutlet",n)}}function xc(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",142)(1,"div",60),e.EFF(2," Transitions "),e.j41(3,"button",143),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.applyTransitionsToAll())}),e.nrm(4,"app-icon",69),e.k0s()(),e.j41(5,"app-form-field",144)(6,"mat-radio-group",145)(7,"app-list",125)(8,"app-list-item")(9,"mat-radio-button",146),e.EFF(10,"Fly To This Chapter"),e.k0s()(),e.j41(11,"app-list-item")(12,"mat-radio-button",147),e.EFF(13,"Jump To This Chapter"),e.k0s()()()()()()}}function Ec(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",19)(1,"form",52)(2,"app-form-field",53),e.nrm(3,"input",54,0)(5,"app-character-counter",23),e.k0s(),e.j41(6,"app-form-field",55),e.nrm(7,"app-rich-text-edit",56,2)(9,"app-character-counter",23),e.k0s(),e.nrm(10,"mat-divider",57),e.qex(11,58),e.DNE(12,oc,4,4,"div",59),e.bVm(),e.j41(13,"div",38)(14,"div",60),e.EFF(15,"Legend"),e.k0s(),e.j41(16,"app-form-field",61)(17,"div",62),e.bIt("cdkDropListDropped",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleLegendItemDrop(o))}),e.DNE(18,sc,5,2,"div",63),e.k0s()(),e.j41(19,"button",64),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleAddLegendItem())}),e.EFF(20," Add Legend "),e.k0s()(),e.j41(21,"div",65),e.nrm(22,"mat-divider"),e.k0s(),e.j41(23,"div",66)(24,"div",67)(25,"div",60),e.EFF(26," Audio "),e.j41(27,"button",68),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleApplyAudioClick())}),e.nrm(28,"app-icon",69),e.k0s()()(),e.j41(29,"select",70)(30,"option",71),e.EFF(31,"Text to Speech Narration"),e.k0s(),e.j41(32,"option",71),e.EFF(33,"Audio File"),e.k0s(),e.j41(34,"option",71),e.EFF(35,"No Audio"),e.k0s()(),e.j41(36,"div",72),e.DNE(37,rc,5,4,"div",73)(38,pc,4,2,"div",73),e.k0s()(),e.DNE(39,kc,16,10,"ng-container",26)(40,Tc,4,1,"ng-container",25)(41,xc,14,0,"ng-template",null,3,e.C5r),e.k0s()()}if(2&s){const n=e.sdS(4),i=e.sdS(8),o=e.XpG();e.R7$(),e.Y8G("formGroup",o.chapterForm),e.R7$(4),e.Y8G("field",n),e.R7$(2),e.Y8G("inline",!0)("resizeable",!1)("rows",16)("maxLength",1e4),e.R7$(2),e.Y8G("field",i),e.R7$(3),e.Y8G("ngForOf",o.contentBlocks.controls),e.R7$(6),e.Y8G("ngForOf",o.legend.controls),e.R7$(12),e.Y8G("value",o.audioPlaybackType.TTS),e.R7$(2),e.Y8G("value",o.audioPlaybackType.File),e.R7$(2),e.Y8G("value",o.audioPlaybackType.None),e.R7$(2),e.Y8G("ngSwitch",o.audioTypeValue),e.R7$(),e.Y8G("ngSwitchCase",o.audioPlaybackType.TTS),e.R7$(),e.Y8G("ngSwitchCase",o.audioPlaybackType.File)}}const wc=Object.values(Gt.Y);class gt{get descriptionValue(){const{description:t}=this.chapterForm.value;return t}get audioTypeValue(){const{audioType:t}=this.chapterForm.value;return t}get hasAudio(){return this.audioTypeValue!==Gt.Y.None}get tagCategories(){return this.bookmarkForm.controls.tagCategories}get legend(){return this.chapterForm.get("legend")}get audio(){return this.chapterForm.get("audio")}get formSkinLayers(){return this.chapterForm.get("skinLayers")}get formVisibilityLayers(){return this.chapterForm.get("visibilityLayers")}get formVisibilityLayersMode(){return this.chapterForm.get("visibilityLayersMode")}constructor(t,n,i,o,r,l,p,T,B,A,H,ge){this.fb=t,this.formBuilder=n,this.dialogRef=i,this.data=o,this.store=r,this.animationService=l,this.mediaService=p,this.snackbar=T,this.changeRef=B,this.dialogService=A,this.assetService=H,this.contentBlocksService=ge,this.isEmpty=R.isEmpty,this.locales=Fn.IB,this.audioPlaybackType=Gt.Y,this.layersModeEnum=$t.Z,this.layersModes=Object.values($t.Z),this.layersModesTitles={[$t.Z.Single]:"Simple Slider",[$t.Z.Group]:"Detailed Slider"},this.environmentApplication=Me.c,this.showTickerBlock=!1,this.disableGetLightLib=!0,this.lightLibs=[],this.selectedChapterLightLibs=[],this.ngUnsubscribe=new b.B,this.usedLocales=[]}ngOnInit(){this.initBookmarkForm(),this.initChaptersForm(),this.initChapterAudio(),this.initLights()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initBookmarkForm(){this.bookmarkForm=new c.gE({displayName:new c.MJ("",[c.k0.maxLength(60),c.k0.required]),playthroughEnabled:new c.MJ(!1),tagCategories:new c.Yp([]),sourceInfo:new c.MJ({reviewed:null,collaborated:null,references:[],audit:null})});const t=this.store.selectSnapshot(Ee.J.getSelectedBookmark),n=this.store.selectSnapshot(x.t.getStory);this.setBookmarkFormValues(t,n),this.bookmarkForm.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleBookmarkFormChanges()})}initChaptersForm(){this.chapterForm=this.formBuilder.group({displayName:["",c.k0.maxLength(60)],description:["",c.k0.maxLength(1e4)],contentBlocks:new c.Bm([]),cameraAction:[""],playCount:[""],autoplay:[""],loopToAudio:[""],mediaControls:[""],legend:new c.Bm([]),audio:new c.Bm([]),lights:[""],skinLayers:[!1],visibilityLayers:[!1],visibilityLayersMode:[""],audioType:[""]}),this.selectChapter(this.data.chapterId?this.data.chapterId:""),this.chapterForm.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleChapterFormChanges()}),this.audio.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.usedLocales=t.map(n=>n.lang)}),(0,m.z)([this.formSkinLayers.valueChanges,this.formVisibilityLayersMode.valueChanges]).pipe((0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{t?(n===$t.Z.Single&&this.chapterForm.patchValue({visibilityLayersMode:$t.Z.Group}),this.formVisibilityLayersMode.disable()):this.formVisibilityLayersMode.enable()})}initChapterAudio(){const t=this.chapterForm.get("description");t.valueChanges.pipe((0,P.Z)(t.value),(0,W.B)(1e3),(0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{this.narrationText=n,this.changeRef.markForCheck()})}handleModuleClick(){this.selectChapter("")}handleChapterClick(t){this.selectChapter(t.id)}handleApplyAudioClick(){this.dialogService.openConfirmDialog({data:{titleText:"Audio Settings",bodyText:`Apply "${this.audioTypeValue===Gt.Y.TTS?"Text to Speech Narration":"Audio File"}" setting to all chapters?`,confirmText:"Apply",confirmColor:"warn"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{n&&this.applyAudioToAll()})}selectChapter(t){if(this.selectedChapterId=t,this.selectedChapter=this.store.selectSnapshot(I.N.getStoryChapters).find(n=>n.id===t),this.selectedChapterLightLibs=[],!(0,R.isNil)(this.selectedChapter)){const n=(0,Wi.VV)(this.selectedChapter)?.type??"legacy";this.selectedChapterLightLibs=this.lightLibs.filter(i=>i.type===n)}this.selectedChapterAnimated=this.selectedChapter&&this.animationService.isChapterAnimated(this.selectedChapter),this.selectedChapter&&this.setChapterFormValues(this.selectedChapter)}handleChapterFormChanges(){const t=this.store.selectSnapshot(I.N.getStoryChapters),n=t.findIndex(H=>H.id===this.selectedChapterId),i=t[n],{displayName:o,contentBlocks:r,description:l,cameraAction:p,legend:T}=this.chapterForm.value;this.store.dispatch(new V.O(i.id,l,o));const B=this.contentBlocksService.filterEmptyBlocks(r),A=this.contentBlocksService.findContentBlockByType(i.contentBlocks,Ke.m.Positions);A&&B.push(A),this.store.dispatch(new V.jo(i.id,B,!1)),this.store.dispatch(new V.VU(i.id,p)),this.store.dispatch(new V.sC(i.id,this.getFormUIConfig(i))),this.store.dispatch(new V.Lx(i.id,this.createLegendFromInputs(T)))}handleBookmarkFormChanges(){const{displayName:t,playthroughEnabled:n,sourceInfo:i}=this.bookmarkForm.value,o={enabled:n},l=this.bookmarkForm.controls.tagCategories.value.reduce((p,T)=>p.concat(this.getSelectedTagsByCategory(T)),[]);this.store.dispatch(new _e.fK(t)),this.store.dispatch(new Xe.e_(t)),this.store.dispatch(new _e.Hd(l)),this.store.dispatch(new _e.dr(o)),this.store.dispatch(new _e.Pv(i))}setChapterFormValues(t){const n=t.description,i=t.displayName,o=t.contentBlocks,r=this.contentBlocksService.findContentBlockByType(o,Ke.m.Images)||new pr.D,l=this.contentBlocksService.findContentBlockByType(o,Ke.m.Videos)||new mr.F,p=this.contentBlocksService.findContentBlockByType(o,Ke.m.Ticker)||new dr.g,T=[r,l,p];this.contentBlocks.setControl(0,this.newImagesBlockFormGroup(r),{emitEvent:!1}),this.contentBlocks.setControl(1,this.newVideosBlockFormGroup(l),{emitEvent:!1}),this.contentBlocks.setControl(2,this.newTickerBlockFormGroup(p),{emitEvent:!1}),this.showTickerBlock=we.c.application===this.environmentApplication.Loft||!this.contentBlocksService.isEmptyBlock(p);const B=t.camera.action||"flyTo",A=(0,R.get)(t,"ui.play.count",1),H=(0,R.get)(t,"ui.play.autoplay",!0),ge=(0,R.get)(t,"ui.play.loopToAudio",!0),Se=(0,R.get)(t,"ui.config",{mediaControls:Va.Y.Full}),We=(0,lr.ld)(Se.playPause,Se.scrubber,Se.mediaControls),nt=Se?.audio,Xi=Object.values(t.media||{}).some(tn=>"audio"===tn.streamType),Oe=nt&&wc.includes(nt)?nt:Xi?Gt.Y.File:Gt.Y.None,en=t.legend||[],En=this.chapterForm.get("legend");En.clear();const Bo=this.createInputsFromLegend(en);Bo.forEach(tn=>{En.push(this.formBuilder.group(tn))});const Do=this.chapterForm.get("audio");Do.clear();const Qi=this.createAudioInputs();this.usedLocales=Qi.map(tn=>tn.lang),Qi.forEach(tn=>{Do.push(this.formBuilder.group(tn))});const sr=(0,Wi.VV)(t)?.libId,g_=this.store.selectSnapshot(x.t.getVariantSchema("skin")),b_=!(0,R.isEmpty)(g_),$a=Se?.skinLayers??b_,C_=Se.visibilityLayers??t.sliderLayers?.src?.layers?.length>0,v_=(0,lr.mf)(Se?.visibilityLayersMode,$a)??$t.Z.Single;this.chapterForm.patchValue({displayName:i,description:n,contentBlocks:T,cameraAction:B,playCount:A,autoplay:H,loopToAudio:ge,mediaControls:We,legend:Bo,audio:Qi,lights:sr,skinLayers:$a,visibilityLayers:C_,visibilityLayersMode:v_,audioType:Oe})}setBookmarkFormValues(t,n){const i=t.title,o=n.tags||[],r=n.playthroughSettings?.enabled??!1,l=(0,R.merge)({references:[],audit:{enabled:!1}},n.sourceInfo),p=this.getTagCategories(o),T=this.createTagCategorySelections(p,o),B=this.bookmarkForm.get("tagCategories");B.clear(),T.forEach(A=>{const H=this.formBuilder.group({title:"",tags:this.formBuilder.array(A.tags.map(ge=>this.formBuilder.group(ge)))});B.push(H)}),this.bookmarkForm.setValue({displayName:i,playthroughEnabled:r,tagCategories:T,sourceInfo:l})}closeDialog(){const t=this.store.selectSnapshot(I.N.getStoryChapters);this.dialogRef.close(t)}applyTransitionsToAll(){const t=this.store.selectSnapshot(I.N.getStoryChapters),{cameraAction:n}=this.chapterForm.value,i=t.map(o=>new V.VU(o.id,n));this.store.dispatch(i),this.snackbar.open("Transition properties applied to all chapters.")}applyAnimationsToAll(){const n=this.store.selectSnapshot(I.N.getStoryChapters).map(i=>{const o=(0,R.merge)(i.ui,this.getFormAnimationConfig(i));return new V.sC(i.id,o)});this.store.dispatch(n),this.snackbar.open("Animation properties applied to all chapters.")}applyAudioToAll(){const t=this.store.selectSnapshot(I.N.getStoryChapters),n=[];if(this.audioTypeValue===Gt.Y.File){const o=this.store.selectSnapshot(I.N.getChapter(this.selectedChapterId)),r=o.media??{},l=t.filter(p=>p.id!==o.id).map(p=>{const T=p.id,A=this.mergeChapterAudio(r,p.media??{});return new V.Eh(T,A)});n.push(...l)}const i=t.map(o=>{const r=(0,R.merge)(o.ui,this.getFormAudioConfig(o));return new V.sC(o.id,r)});n.push(...i),this.store.dispatch(n),this.snackbar.open("Audio settings applied to all chapters.")}getFormUIConfig(t){return(0,R.merge)(t.ui,this.getFormAnimationConfig(this.chapterForm.value),this.getFormAudioConfig(this.chapterForm.value),this.getFormLayersConfig(this.chapterForm.value))}getFormAnimationConfig(t){const{playCount:n,autoplay:i,mediaControls:o,loopToAudio:r}=t;return{play:{count:n,autoplay:i,loopToAudio:r},config:{mediaControls:o}}}getFormAudioConfig(t){const{audioType:n}=t;return{config:{audio:n}}}getFormLayersConfig(t){const{skinLayers:n,visibilityLayers:i,visibilityLayersMode:o}=t;return{config:{skinLayers:n,visibilityLayers:i,visibilityLayersMode:o}}}handleClearTagsSelectionClick(){this.setAllTagSelections(!1)}setAllTagSelections(t){const n=this.bookmarkForm.get("tagCategories").value,i=(0,R.cloneDeep)(n);i.forEach(o=>{o.tags.forEach(r=>r.checked=t)}),this.bookmarkForm.patchValue({tagCategories:i})}getAllTagsList(t){const i=[...Object.values(Hi.IZ).reduce((r,l)=>r.concat(l.tags),[]),...t];return[...new Set(i)].sort()}getTagCategories(t){const n=Object.values(Hi.IZ).reduce((o,r)=>[...o,...r.tags],[]),i=t.filter(o=>!n.includes(o));return i.length>0?[...Hi.IZ,{title:"Uncategorized",tags:i}]:[...Hi.IZ]}getSelectedTagsByCategory(t){return t.tags.filter(n=>n.checked).map(n=>n.tag)}createTagCategorySelections(t,n){return t.map(i=>({title:i.title,tags:i.tags.map(o=>({tag:o,checked:n.includes(o)})).sort((o,r)=>o.tag.toLowerCase()<r.tag.toLowerCase()?-1:1)}))}handleAddLegendItem(){this.store.dispatch(new V.jy(this.selectedChapterId,{label:"",colors:[1,0,0]})),this.selectChapter(this.selectedChapterId)}handleRemoveLegendItem(t){const i=[...this.store.selectSnapshot(I.N.getChapter(this.selectedChapterId)).legend];i.splice(t,1),this.store.dispatch(new V.Lx(this.selectedChapterId,i)),this.selectChapter(this.selectedChapterId)}handleLegendItemDrop(t){const{previousIndex:n,currentIndex:i}=t,r=this.store.selectSnapshot(I.N.getChapter(this.selectedChapterId)).legend||[],l=(0,Dt.W)(r,n,i);this.store.dispatch(new V.Lx(this.selectedChapterId,l)),this.selectChapter(this.selectedChapterId)}createInputsFromLegend(t){return t.map(n=>{const{label:i,colors:o}=n;return{label:i,color:se.T.rgbToHex(o,!0)}})}createLegendFromInputs(t){return t.map(n=>{const{label:i,color:o}=n;return{label:i,colors:se.T.hexToRgb(o,!0)}})}createAudioInputs(){return this.mediaService.getAudioClips(this.selectedChapter.media).map(t=>({clipId:t.clipId,lang:t.lang,fullUrl:t.fullUrl}))}handleAddAudioItem(){const t=this.formBuilder.group({clipId:"",lang:Fn.IB.filter(n=>!this.usedLocales.includes(n.lang))[0]?.lang,fullUrl:""});this.audio.push(t)}onAudioFileSuccess(t,n){const i=this.audio.at(n).value,[o,r]=this.mediaService.createAudioClip(this.selectedChapter,t,i.lang),l=Object.assign({},this.selectedChapter.media);l[o]=r,this.store.dispatch(new V.Eh(this.selectedChapterId,l)),this.selectChapter(this.selectedChapterId),this.snackbar.open(`Successfully added ${t}.`)}handleAudioItemChange(t,n){const i=this.audio.at(n).value;i.clipId&&this.updateAudioLang(i.clipId,i.lang)}updateAudioLang(t,n){const i=Object.assign({},this.selectedChapter.media);i[t].lang=n,this.store.dispatch(new V.Eh(this.selectedChapterId,i))}handleRemoveAudioItem(t){const n=this.audio.at(t).value;n.clipId?this.deleteAudio(n.clipId):this.audio.removeAt(t)}deleteAudio(t){const n=Object.assign({},this.selectedChapter.media),o=Object.prototype.hasOwnProperty.call(n,t)?t:(0,R.findKey)(n,r=>r.clipId===t);o?(delete n[o],this.store.dispatch(new V.Eh(this.selectedChapterId,n)),this.selectChapter(this.selectedChapterId),this.snackbar.open("Successfully deleted audio clip.")):this.snackbar.open("Deleting audio clip failed.")}get contentBlocks(){return this.chapterForm.get("contentBlocks")}newImagesBlockFormGroup(t){return this.formBuilder.group({type:"images",images:this.formBuilder.array(t.images.map(n=>this.formBuilder.group({urls:n.urls,alt:[n.alt,c.k0.maxLength(200)],caption:[n.caption,c.k0.maxLength(200)]})))})}newVideosBlockFormGroup(t){return this.formBuilder.group({type:"videos",videos:this.formBuilder.array(t.videos.map(n=>this.formBuilder.group({url:n.url,caption:[n.caption,c.k0.maxLength(200)],srcFilename:n.srcFilename})))})}newTickerBlockFormGroup(t){return this.formBuilder.group({type:"ticker",loopImage:!1,enable:t.enable,images:this.formBuilder.array(t.images.map(n=>this.formBuilder.group({urls:n.urls,alt:[n.alt,c.k0.maxLength(200)],caption:[n.caption,c.k0.maxLength(200)]})))})}checkGetLightLib(){this.disableGetLightLib=0===this.lightLibInput.nativeElement.value.length}handleLightsChange(){const t=this.chapterForm.get("lights").value;this.store.dispatch(new V.zh(this.selectedChapter.id,t))}handleLoadLightsLib(){const t=this.lightLibInput.nativeElement.value;this.lightLibs.some(i=>i.libId===t)?this.snackbar.open(`${t} is already loaded.`):this.assetService.loadLightLib(t).then(i=>{this.lightLibs.push(i);const o=this.lightLibs.filter(r=>"legacy"===r.type).map(r=>r.libId);this.store.dispatch(new _e.KM(o)),this.snackbar.open(`Successfully loaded ${t}.`),this.changeRef.markForCheck()},()=>{this.snackbar.open(`Unable to load ${t}.`)}).finally(()=>{this.lightLibInput.nativeElement.value="",this.disableGetLightLib=!0})}getLocaleFlag(t){return`/assets/images/flags/${this.getLocaleFromLang(t).country}.svg`}getLocaleString(t){const n=this.getLocaleFromLang(t);return`${n.title} (${n.lang.toUpperCase()})`}getLocaleFromLang(t){return Fn.IB.find(n=>n.lang===t)}initLights(){var t=this;return(0,ct.A)(function*(){const n=t.store.selectSnapshot(x.t.getStory),i=t.store.selectSnapshot(I.N.getStoryChapters),o=[...(0,Wi.UH)(n),...i.map(r=>(0,Wi.VV)(r))].filter(r=>!(0,R.isNil)(r));t.lightLibs=(0,R.uniqBy)(o,r=>r.libId)})()}mergeChapterAudio(t,n){const i={...n};return Object.entries(n).filter(([,o])=>"audio"===o.streamType).forEach(([o])=>{delete i[o]}),Object.entries(t).filter(([,o])=>"audio"===o.streamType).forEach(([o,r])=>{i[o]=r}),i}}(In=gt).\u0275fac=function(t){return new(t||In)(e.rXU(c.ok),e.rXU(c.ze),e.rXU(Z.CP),e.rXU(Z.Vh),e.rXU(a.il),e.rXU(wt.O),e.rXU(cr.u),e.rXU(Le.UG),e.rXU(e.gRc),e.rXU(Ve.o),e.rXU(La.I),e.rXU(Go.V))},In.\u0275cmp=e.VBU({type:In,selectors:[["app-content-dialog"]],viewQuery:function(t,n){if(1&t&&e.GBs(zl,5),2&t){let i;e.mGM(i=e.lsd())&&(n.lightLibInput=i.first)}},decls:23,vars:11,consts:[["displayName",""],["lightLibInput",""],["description",""],["editTransitionsTmp",""],[1,"content","theme-light"],[1,"content__header"],[1,"text-xl","font-semibold"],[1,"content__body"],[1,"content__sections"],[1,"mb-2"],[1,"content__section-label"],[1,"content__section",3,"click","ngClass"],[1,"content__title"],["class","content__section","data-test","contentChapterItem",3,"ngClass","click",4,"ngFor","ngForOf"],["class","content__editor",4,"ngIf"],[1,"content__footer"],["app-button","","buttonType","primary","buttonTheme","light","type","button","data-test","contentDialogClose",3,"mat-dialog-close"],["data-test","contentChapterItem",1,"content__section",3,"click","ngClass"],[1,"content__index"],[1,"content__editor"],[1,"flex","flex-col","h-full","theme-light",3,"formGroup"],["label","Model Title"],["type","text","formControlName","displayName","maxlength","60","placeholder","e.g. Human Heart","data-test","modelTitleDisplayName",1,"input"],[3,"field"],[1,"!my-4"],[4,"appFlagExternal"],[4,"appFlagInternal"],[1,"py-4"],["formControlName","sourceInfo","label","Source Information",3,"enabledSource","updateDate"],[1,"flex-auto",2,"overflow","auto"],["tabSize","medium","tabTheme","light",3,"scrollable","tabPadded"],["label","Content Tags"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","sm",1,"mb-4",3,"click"],["formArrayName","tagCategories"],[3,"formGroupName","label","isCompact",4,"ngFor","ngForOf"],["label","Source Information"],["formControlName","sourceInfo",3,"enabledSource","updateDate"],["label","Asset Libraries"],[1,"text-xs"],[1,"mb-2","text-xs"],["label","Lights"],[1,"mb-4"],[4,"ngFor","ngForOf"],[1,"flex"],["type","text","placeholder","Enter a library in the form <stateName>/<directoryName>",1,"input",3,"input"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",1,"flex-none","ml-3",3,"click","disabled"],[3,"formGroupName","label","isCompact"],["formArrayName","tags",1,"content__check-group",3,"ngClass"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["formControlName","checked"],[1,"font-semibold","text-uppercase"],[3,"formGroup"],["label","Chapter Title"],["type","text","formControlName","displayName","maxlength","60","data-test","chapterTitleInput",1,"w-full","input"],["label","Chapter Description"],["formControlName","description","data-test","chapterDescriptionInput",3,"inline","resizeable","rows","maxLength"],[1,"!my-8"],["formArrayName","contentBlocks"],[3,"ngSwitch",4,"ngFor","ngForOf"],[1,"mb-2","text-sm","font-bold"],["formArrayName","legend"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["class","flex flex-row items-center my-1 theme-light","cdkDrag","",3,"formGroupName",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","data-test","contentManagerAddLegend",1,"w-40",3,"click"],[1,"py-8"],[1,"py-2","text-xs"],[1,"flex","items-center"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply audio settings to all chapters","matTooltipPosition","above","title","Apply audio settings to all chapters",3,"click"],["icon","copy"],["formControlName","audioType","data-test","contentManagerAudioSelect",1,"mb-3","input"],[3,"value"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"my-8"],[4,"ngIf"],["cdkDrag","",1,"flex","flex-row","items-center","my-1","theme-light",3,"formGroupName"],["formControlName","color","dataTestAttributeVal","legendColorPicker",3,"useRootContainer"],["type","text","formControlName","label","placeholder","Legend label","data-test","contentMangerLegendLabel",1,"ml-2","input"],["app-button","","buttonType","text","buttonTheme","light","type","button","matTooltip","Remove",1,"mr-2",3,"click"],["icon","times"],[1,"content__tts-audio"],[1,"w-1/2"],["theme","light",3,"text","language"],["formArrayName","audio"],["class","flex flex-row items-center my-1 mb-3 theme-light content__audio",3,"formGroupName",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","class","w-40",3,"click",4,"ngIf"],[1,"flex","flex-row","items-center","my-1","mb-3","theme-light","content__audio",3,"formGroupName"],[1,"flex","flex-col","grow"],[1,"flex","justify-end"],["app-button","","buttonType","text","buttonTheme","light","buttonSize","sm","type","button","matTooltip","Remove Audio",1,"mr-2",3,"click"],[1,"pr-3","font-semibold","uppercase","text-2xs"],[1,"px-5"],[1,"pb-1","uppercase","text-2xs"],[1,"relative"],[1,"content__audio-language"],[1,"flex","items-center","pl-3"],["aria-hidden","true",1,"mr-3",3,"src"],["aria-hidden","true"],["icon","caret-down",1,"pr-4"],["formControlName","lang",1,"input","content__audio-language-select",3,"change"],["class","content__audio-language-option",3,"value","disabled",4,"ngFor","ngForOf"],[1,"mt-4","mb-8"],["type","audio","formControlName","fullUrl",3,"uploadSuccess","canDelete"],[1,"content__audio-language-option",3,"value","disabled"],["app-button","","buttonType","outline","buttonTheme","light","type","button",1,"w-40",3,"click"],[1,"py-2","text-xs","content__properties"],[4,"ngTemplateOutlet"],[3,"vertical",4,"ngIf"],["class","flex flex-col ml-2",4,"ngIf"],["formControlName","lights",1,"w-auto","input",3,"change","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],[1,"flex","flex-col","ml-2"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply animation to all chapters","matTooltipPosition","above","title","Apply animation to all chapters",3,"click"],[1,"content__properties"],["label","Looping"],["class","content__group","formControlName","playCount",4,"ngIf"],["formControlName","loopToAudio",4,"ngIf"],[1,"!my-4","mr-4"],["formControlName","autoplay"],["label","Media Controls"],["form-field-help",""],[1,"font-bold"],["formControlName","mediaControls",1,"content__group"],["listType","flat"],["value","none"],["value","small"],["value","full"],["formControlName","playCount",1,"content__group"],["formControlName","loopToAudio"],[1,"flex","flex-col","py-2","text-xs"],[1,"mb-3","text-sm","font-bold"],["class","flex flex-col gap-3",4,"ngIf"],["formControlName","skinLayers"],[1,"flex","flex-col","gap-3"],["formControlName","visibilityLayers"],["label","Slider Type",4,"ngIf"],["label","Slider Type"],["formControlName","visibilityLayersMode",1,"w-auto","input"],[1,"!mt-8","mb-4"],[1,"text-xs","content__properties"],[1,"flex","flex-col"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply transition to all chapters","matTooltipPosition","above","title","Apply transition to all chapters",3,"click"],["label","Chapter Transition"],["formControlName","cameraAction",1,"content__group"],["data-test","contentManagerFlyToRadio","value","flyTo"],["value","jumpTo"]],template:function(t,n){if(1&t&&(e.j41(0,"div",4)(1,"div",5)(2,"div",6),e.EFF(3,"Content Manager"),e.k0s()(),e.j41(4,"div",7)(5,"div",8)(6,"div",9)(7,"div",10),e.EFF(8,"Model"),e.k0s(),e.j41(9,"div",11),e.bIt("click",function(){return n.handleModuleClick()}),e.j41(10,"div",12),e.EFF(11),e.nI1(12,"async"),e.k0s()()(),e.j41(13,"div",9)(14,"div",10),e.EFF(15,"Chapters"),e.k0s(),e.DNE(16,Ql,5,5,"div",13),e.nI1(17,"async"),e.k0s()(),e.DNE(18,Zl,9,2,"div",14)(19,Ec,43,15,"div",14),e.k0s(),e.j41(20,"div",15)(21,"button",16),e.EFF(22," Done "),e.k0s()()()),2&t){let i;e.R7$(9),e.Y8G("ngClass",e.eq3(9,Fr,!n.selectedChapterId)),e.R7$(2),e.SpI(" ",(null==(i=e.bMT(12,5,n.story$))?null:i.displayName)||"-No Title-"," "),e.R7$(5),e.Y8G("ngForOf",e.bMT(17,7,n.chapters$)),e.R7$(2),e.Y8G("ngIf",!n.selectedChapterId),e.R7$(),e.Y8G("ngIf",n.selectedChapterId)}},dependencies:[E.YU,E.Sq,E.bT,E.T3,E.ux,E.e1,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.tU,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,De.So,Ye.VT,Ye._g,Z.tx,Ce.oV,Qe.q,L.Q,ur,hr.n,ee.K,Ft.P,Y.R,Ji.s,Ki.P,Pt.j,Rt.O,me.g,Mt,At,Rn.c,xl,Pl,Ml,Nl,wr,E.Jj,E.Pc],styles:[".content[_ngcontent-%COMP%]{height:100%;width:100%;padding:24px}.content__header[_ngcontent-%COMP%]{border-bottom:1px solid #d7e0ea;height:40px;display:flex;justify-content:space-between;align-items:center}.content__body[_ngcontent-%COMP%]{height:calc(90vh - 152px);display:flex}.content__footer[_ngcontent-%COMP%]{border-top:1px solid #d7e0ea;height:64px;display:flex;align-items:center;justify-content:flex-end}.content__section-label[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;color:#96a8c0;margin-bottom:4px}.content__sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 12px 0 0;flex:1 1 35%;overflow:auto}.content__index[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;padding:0 8px}.content__section[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:flex;padding:12px;border-left:4px solid transparent;border-radius:4px;margin-bottom:4px;cursor:pointer;transition:background-color .12s}.content__section[_ngcontent-%COMP%]:hover{background:#eaeff5}.content__section--selected[_ngcontent-%COMP%], .content__section--selected[_ngcontent-%COMP%]:hover{background:#eaeff5;color:#101823;border-color:#2d72dc}.content__title[_ngcontent-%COMP%]{word-break:break-word}.content__thumb[_ngcontent-%COMP%]{background:url(/assets/images/logo-dark-transparent.svg) center center no-repeat;background-size:50%;border-radius:4px;flex:0 0 64px;height:64px;margin-right:12px}.content__editor[_ngcontent-%COMP%]{border-left:1px solid #eaeff5;flex:1 1 75%;padding:16px 24px 48px 12px;overflow:auto}.content__group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.content__check-group[_ngcontent-%COMP%]{grid-template-columns:1fr;display:grid;grid-column-gap:12px;font-size:.75rem;line-height:1rem}.content__check-group--split[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.content__properties[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:grid;grid-template-columns:160px auto auto;grid-column-gap:8px}.content__block[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.content__block.cdk-drag-preview[_ngcontent-%COMP%] > .content__block-actions[_ngcontent-%COMP%], .content__block.cdk-drag-preview[_ngcontent-%COMP%] > .content__block-text[_ngcontent-%COMP%]{display:none}.content__block-handle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;flex:0 0 36px}.content__block-handle[_ngcontent-%COMP%]:hover{cursor:move}.content__block-image[_ngcontent-%COMP%]{flex:0 0 240px}.content__block-text[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px}.content__block-actions[_ngcontent-%COMP%]{flex:0 0 48px}.content__audio[_ngcontent-%COMP%]{background-color:#f9fafd;border-radius:4px}.content__tts-audio[_ngcontent-%COMP%]{padding:24px 0 24px 8px;border:1px dashed #96a8c0}.content__audio-language[_ngcontent-%COMP%]{padding:6px 0;display:flex;justify-content:space-between;align-items:center;background-color:#fff}.content__audio-language-option[_ngcontent-%COMP%]{font-size:13px}.content__audio-language-select[_ngcontent-%COMP%]{position:absolute;top:0;font-size:0;background:none!important;width:100%;height:36px;-webkit-appearance:none;appearance:none}"],changeDetection:0}),sn([(0,a.l6)(x.t.getStory),rn("design:type",u.c)],gt.prototype,"story$",void 0),sn([(0,a.l6)(Ee.J.getSelectedBookmark),rn("design:type",u.c)],gt.prototype,"bookmark$",void 0),sn([(0,a.l6)(x.t.getStoryLanguage),rn("design:type",u.c)],gt.prototype,"storyLanguage$",void 0),sn([(0,a.l6)(I.N.getStoryChapters),rn("design:type",u.c)],gt.prototype,"chapters$",void 0),sn([(0,a.l6)(I.N.getSelectedChapterSrcLayers),rn("design:type",u.c)],gt.prototype,"visibilityLayers$",void 0),sn([(0,a.l6)(x.t.getVariantSchema("skin")),rn("design:type",u.c)],gt.prototype,"skinVariants$",void 0);var bt=v(17766),ve=v(13409);const Fc={[Q.s.Select]:"mouse-pointer",[Q.s.Hide]:"eye-slash",[Q.s.Paint]:"fill-drip",[Q.s.Label]:"tag",[Q.s.Isolate]:"hand-point-up",[Q.s.Fade]:"lungs",[Q.s.Positions]:"location-dot",[Q.s.Quiz]:"user-graduate",[Q.s.Eyedropper]:"eye-dropper",[Q.s.Image]:"image",[Q.s.Dimensions]:"ruler",[Q.s.Background]:"square"};var je=v(73828),Vt=v(90856),Pr=v(38165),Pc=v(16606),Rc=v(3909),re=v(61295),so=v(75069),Rr=v(68504),Qo=v(37678),Mc=v(16e3),jc=v(82109),Ge=v(17215),qo=v(26629);class Ic{constructor(t){this.namespaceMap={},this.duplicate=!1,this.replace=!1,Object.assign(this,t)}}var Nn,Mr=v(21894),Ho=v(12374),jr=v(97978),an=v(97352),Nc=v(8961),Wo=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Jo=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Bc(s,t){1&s&&(e.j41(0,"div",28)(1,"app-message-toggle",29),e.EFF(2," The scene graph will be trimmed using the clipping planes of the currently active chapter. Objects shared with other chapters will be lost. A page reload is recommended. "),e.k0s()())}function Dc(s,t){if(1&s&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n," ")}}function Gc(s,t){if(1&s&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n," ")}}function $c(s,t){if(1&s&&(e.j41(0,"app-form-field",31)(1,"select",32),e.DNE(2,Gc,2,2,"option",18),e.nI1(3,"async"),e.k0s()()),2&s){const n=e.XpG();e.R7$(2),e.Y8G("ngForOf",e.bMT(3,1,n.secondaryCategoryOptions$))}}function Oc(s,t){if(1&s&&(e.j41(0,"div",37),e.nrm(1,"app-icon",38),e.j41(2,"span",39),e.EFF(3),e.k0s(),e.j41(4,"span",40),e.EFF(5,"(File exists)"),e.k0s()()),2&s){const n=e.XpG(2);e.R7$(3),e.JRh(n.modulePath)}}function Ac(s,t){if(1&s&&(e.j41(0,"div",41),e.nrm(1,"app-icon",42),e.j41(2,"span",39),e.EFF(3),e.k0s(),e.j41(4,"span",40),e.EFF(5,"(File exists and cannot be overwritten)"),e.k0s()()),2&s){const n=e.XpG(2);e.R7$(3),e.JRh(n.modulePath)}}function Uc(s,t){if(1&s&&(e.j41(0,"div",43),e.nrm(1,"app-icon",44),e.j41(2,"span",39),e.EFF(3),e.k0s()()),2&s){const n=e.XpG(2);e.R7$(3),e.JRh(n.modulePath)}}function Vc(s,t){if(1&s&&(e.j41(0,"div",33),e.DNE(1,Oc,6,1,"div",34)(2,Ac,6,1,"div",35)(3,Uc,4,1,"div",36),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.moduleExists&&!n.formDuplicateStates.value),e.R7$(),e.Y8G("ngIf",n.moduleExists&&n.formDuplicateStates.value),e.R7$(),e.Y8G("ngIf",!n.moduleExists)}}function Lc(s,t){1&s&&(e.j41(0,"app-form-field",45)(1,"mat-checkbox",46)(2,"span",7),e.EFF(3,"I intend to save to Production"),e.k0s()()())}function Yc(s,t){if(1&s&&(e.j41(0,"div",55)(1,"div",56)(2,"div",49)(3,"div",57),e.nrm(4,"mat-checkbox",58),e.k0s(),e.j41(5,"div",59),e.nrm(6,"input",60)(7,"input",61),e.k0s()()()()),2&s){const n=t.index;e.R7$(),e.Y8G("formGroupName",n)}}function zc(s,t){if(1&s){const n=e.RV6();e.j41(0,"div"),e.nrm(1,"mat-divider",47),e.j41(2,"app-form-field",48)(3,"div",49),e.nrm(4,"input",50,1),e.j41(6,"button",51),e.bIt("click",function(){e.eBV(n);const o=e.sdS(5),r=e.XpG();return e.Njj(r.handleReplaceClick(o.value))}),e.EFF(7," Replace "),e.k0s(),e.j41(8,"button",52),e.bIt("click",function(){e.eBV(n);const o=e.sdS(5),r=e.XpG();return e.Njj(r.handlePrependClick(o.value))}),e.EFF(9," Prepend "),e.k0s()(),e.j41(10,"div",53),e.DNE(11,Yc,8,1,"div",54),e.k0s()()()}if(2&s){const n=e.XpG();e.R7$(11),e.Y8G("ngForOf",n.formStates.controls)}}function Xc(s,t){1&s&&(e.qex(0),e.nrm(1,"app-spinner",62),e.EFF(2," Validating "),e.bVm())}function Qc(s,t){1&s&&(e.qex(0),e.nrm(1,"app-spinner",62),e.EFF(2," Saving "),e.bVm())}function qc(s,t){1&s&&(e.qex(0),e.EFF(1," Save Module "),e.bVm())}const Ir="[0-9a-zA-Z_]*",Nr=/^[0-9a-zA-Z_]+$/;class Bn{get formName(){return this.form.controls.name}get formStates(){return this.form.controls.states}get formPrimaryCategory(){return this.form.controls.primaryCategory}get formSecondaryCategory(){return this.form.controls.secondaryCategory}get formDuplicateStates(){return this.form.controls.duplicateStates}constructor(t,n,i,o,r,l,p,T){this.store=t,this.actions=n,this.formBuilder=i,this.modulesService=o,this.changeDetector=r,this.snackbar=l,this.dialogRef=p,this.data=T,this.graphTrimDescriptions=Mr.i,this.saving=!1,this.moduleExists=!1,this.validating=!1,this.ngUnsubscribe=new b.B,this.settings={...T},this.initForm()}ngOnInit(){this.store.dispatch(new Vt.lu),this.saveModule=this.generateSaveModule(),this.usedStates=this.modulesService.getUsedStates(),this.initApplicationListeners(),this.setFormValidators(),this.initFormListeners(),this.setFormValues(this.saveModule),this.populateStateValues()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initApplicationListeners(){this.actions.pipe((0,a.xi)(Vt.NZ),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleSaveSuccess(t.id)}),this.actions.pipe((0,a.xi)(Vt.G5),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleSaveFail(t.id)})}initFormListeners(){this.formPrimaryCategory.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.store.dispatch(new Vt.T_(t))}),(0,m.z)([this.formPrimaryCategory.valueChanges,this.formSecondaryCategory.valueChanges,this.formName.valueChanges,this.formDuplicateStates.valueChanges]).pipe((0,S.Q)(this.ngUnsubscribe),(0,W.B)(300)).subscribe(([t,n,i,o])=>{this.handleNameChange(t,n,i,o)}),(0,f.h)(this.formDuplicateStates.valueChanges,this.formStates.valueChanges).pipe((0,on.M)(()=>this.validating=!0),(0,W.B)(300),(0,Bt.n)(t=>this.checkStateGroups()),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.validating=!1,this.updateFormStates(t)})}initForm(){this.form=this.formBuilder.group({primaryCategory:this.formBuilder.control("",c.k0.required),secondaryCategory:this.formBuilder.control(""),name:this.formBuilder.control("",[c.k0.required,c.k0.pattern(Ir)]),trimUnavailable:this.formBuilder.control(!1),trimHidden:this.formBuilder.control(!1),trimClipped:this.formBuilder.control(!1),duplicateStates:this.formBuilder.control(!1),confirmProduction:this.formBuilder.control(!1,this.validateProductionSave),states:this.formBuilder.array([this.initStateForm("")])},{validators:[this.validateProductionSave]})}initStateForm(t){return this.formBuilder.group({include:[!0],oldState:[t],newState:[t,[c.k0.required,c.k0.pattern(Ir)]]})}handleReplaceClick(t){this.changeStatePrefix(t,"replace")}handlePrependClick(t){this.changeStatePrefix(t,"prepend")}handleSubmit(){this.form.valid&&this.save()}handleSaveSuccess(t){this.dialogRef.close(!0),this.snackbar.open(`"${t}" successfully saved.`)}handleSaveFail(t){this.dialogRef.close(),this.snackbar.open(`There was an error saving "${t}".`)}generateSaveModule(){return this.modulesService.generateSaveModule(this.settings.id)}populateStateValues(){for(;this.formStates.length>0;)this.formStates.removeAt(0);const t=[];this.modulesService.getUsedStates().forEach(n=>{const i={enabled:!0,state:n};this.formStates.push(this.initStateForm(i.state)),t.push(i)}),this.formStates.markAsDirty()}setFormValidators(){this.formPrimaryCategory.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(t){case"production":case"client":this.formSecondaryCategory.setValidators([c.k0.required]);break;default:this.formSecondaryCategory.setValidators(null),this.formSecondaryCategory.setValue("")}})}setFormValues(t){this.form.patchValue({primaryCategory:"exports"===t.primaryCategory?"preview":t.primaryCategory||"preview",secondaryCategory:t.secondaryCategory||"",name:t.name||"",trimUnavailable:!1,trimHidden:!1,trimClipped:!1,duplicateStates:!1})}save(){const t=this.modulesService.generateModulePath(this.formPrimaryCategory.value,this.formSecondaryCategory.value,this.formName.value),n=new Ic;this.formDuplicateStates.value&&(n.duplicate=!0,this.formStates.value.map(p=>{p.include&&(n.namespaceMap[p.oldState]=p.newState)}));const i=new Mr.F,{trimUnavailable:o,trimHidden:r,trimClipped:l}=this.form.value;i.graph.unavailable=o,i.graph.hidden=r,i.graph.clipped=l,this.saving=!0,this.store.dispatch(new Vt.oJ(t,n,i))}handleNameChange(t,n,i,o){if(this.modulePath=this.modulesService.generateModulePath(t,n,i),this.formName.errors){const{pattern:r,required:l}=this.formName.errors;if(r||l)return}this.modulePath&&i.length&&this.modulesService.listContents(t,n,i).subscribe(r=>{this.moduleExists=r.length>0;const l=o&&this.moduleExists,p=!Nr.test(i);this.formName.setErrors(l||p?{invalid:!0}:null),this.formName.markAsDirty(),this.changeDetector.markForCheck()})}validateProductionSave(t){const n=t.controls?.primaryCategory,i=t.controls?.confirmProduction;return n&&i&&"production"===n.value&&!1===i.value?{confirmProduction:!0}:null}checkStateGroups(){const t=this.formStates.controls.map(n=>this.validateStateGroup(n));return t.length>0?(0,m.z)(t):(0,y.of)([])}validateStateGroup(t){const i=t.controls.newState;return!0===this.formDuplicateStates.value&&!1!==t.controls.include.value?i.errors||0===i.value.length?(0,y.of)({stateControl:i,valid:!1}):this.modulesService.getState(i.value).pipe((0,Te.T)(r=>{const l=Nr.test(i.value);return{stateControl:i,valid:0===r.length&&l}})):(0,y.of)({stateControl:i,valid:!0})}updateFormStates(t){t.forEach(n=>{n.valid?(n.stateControl.setErrors(null),n.stateControl.markAsDirty()):n.stateControl.setErrors({stateTaken:!0})}),this.changeDetector.markForCheck()}changeStatePrefix(t,n){this.formStates.controls.forEach(i=>{const o=i.controls.newState;switch(n){case"prepend":o.setValue(`${t}_${o.value}`);break;case"replace":const r=new RegExp(/[^_]*/),l=o.value.replace(r,t);o.setValue(l)}})}}(Nn=Bn).\u0275fac=function(t){return new(t||Nn)(e.rXU(a.il),e.rXU(a.En),e.rXU(c.ok),e.rXU(jr.F),e.rXU(e.gRc),e.rXU(Le.UG),e.rXU(Z.CP),e.rXU(Z.Vh))},Nn.\u0275cmp=e.VBU({type:Nn,selectors:[["app-save-module-dialog"]],decls:43,vars:19,consts:[["name",""],["prefix",""],["mat-dialog-title",""],["mat-dialog-content",""],["data-test","saveDialog",1,"theme-light"],[3,"submit","formGroup"],["data-test","duplicateStates","formControlName","duplicateStates"],[1,"text-xs"],["form-field-help",""],["label","Trim Options",3,"labelElement"],[1,"flex","flex-row","items-center","justify-between"],["data-test","trimHidden","formControlName","trimHidden",3,"matTooltip"],["data-test","trimUnavailable","formControlName","trimUnavailable",3,"matTooltip"],["formControlName","trimClipped",3,"matTooltip"],["class","mt-2",4,"ngIf"],[1,"!mb-4"],["label","Primary Category"],["data-test","primaryCategory","formControlName","primaryCategory",1,"input"],[3,"value",4,"ngFor","ngForOf"],["label","Secondary Category",4,"ngIf"],["label","Name"],["data-test","moduleName","type","text","formControlName","name",1,"w-full","input"],["class","pt-2 text-xs",4,"ngIf"],["label","Production Save",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","data-test","saveModuleSubmit","buttonTheme","light","buttonType","primary",3,"click","disabled"],[1,"mt-2"],["type","danger","icon","exclamation-circle"],[3,"value"],["label","Secondary Category"],["data-test","secondaryCategory","formControlName","secondaryCategory",1,"input"],[1,"pt-2","text-xs"],["class","text-blue-600",4,"ngIf"],["class","text-red-700",4,"ngIf"],["class","text-green-500",4,"ngIf"],[1,"text-blue-600"],["icon","exclamation-triangle"],[1,"pl-2"],[1,"pl-2","font-bold"],[1,"text-red-700"],["icon","exclamation-circle"],[1,"text-green-500"],["icon","check-circle"],["label","Production Save"],["formControlName","confirmProduction"],[1,"!my-4"],["label","Prefix"],[1,"flex"],["type","text","pattern","[^ ]*",1,"input","flex-25","w-25"],["data-test","prefixReplace","type","button","app-button","","buttonType","outline","buttonTheme","light",1,"ml-2",3,"click"],["data-test","prefixPrepend","type","button","app-button","","buttonType","outline","buttonTheme","light",1,"ml-2",3,"click"],["formArrayName","states",1,"py-4","text-xs"],["class","mb-2",4,"ngFor","ngForOf"],[1,"mb-2"],[3,"formGroupName"],[1,"flex-shrink","pt-2","pr-2"],["data-test","includeState","formControlName","include","matTooltip","Include State"],[1,"grow"],["data-test","oldState","type","hidden","formControlName","oldState",1,"input"],["data-test","newState","type","text","formControlName","newState",1,"input"],["size","medium","render","inline",1,"ml-2"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"h1",2),e.EFF(1,"Save Module"),e.k0s(),e.j41(2,"div",3)(3,"div",4)(4,"form",5),e.bIt("submit",function(){return e.eBV(i),e.Njj(n.handleSubmit())}),e.j41(5,"app-form-field")(6,"mat-checkbox",6)(7,"span",7),e.EFF(8,"Duplicate Content States"),e.k0s()(),e.j41(9,"div",8),e.EFF(10," This requires that you specify the location for the new module, and new unused names for each of the content states. "),e.k0s()(),e.j41(11,"app-form-field",9)(12,"div",10)(13,"mat-checkbox",11)(14,"span",7),e.EFF(15,"Hidden Objects"),e.k0s()(),e.j41(16,"mat-checkbox",12)(17,"span",7),e.EFF(18,"Unavailable Objects"),e.k0s()(),e.j41(19,"mat-checkbox",13)(20,"span",7),e.EFF(21,"Clipped Objects"),e.k0s()()(),e.DNE(22,Bc,3,0,"div",14),e.k0s(),e.nrm(23,"mat-divider",15),e.j41(24,"app-form-field",16)(25,"select",17),e.DNE(26,Dc,2,2,"option",18),e.nI1(27,"async"),e.k0s()(),e.DNE(28,$c,4,3,"app-form-field",19),e.nI1(29,"async"),e.j41(30,"app-form-field",20),e.nrm(31,"input",21,0),e.DNE(33,Vc,4,3,"div",22),e.k0s(),e.DNE(34,Lc,4,0,"app-form-field",23)(35,zc,12,1,"div",24),e.k0s()()(),e.j41(36,"div",25)(37,"button",26),e.EFF(38,"Cancel"),e.k0s(),e.j41(39,"button",27),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSubmit())}),e.DNE(40,Xc,3,0,"ng-container",24)(41,Qc,3,0,"ng-container",24)(42,qc,2,0,"ng-container",24),e.k0s()()}if(2&t){let i;const o=e.sdS(32);e.R7$(4),e.Y8G("formGroup",n.form),e.R7$(7),e.Y8G("labelElement",!1),e.R7$(2),e.Y8G("matTooltip",n.graphTrimDescriptions.hidden),e.R7$(3),e.Y8G("matTooltip",n.graphTrimDescriptions.unavailable),e.R7$(3),e.Y8G("matTooltip",n.graphTrimDescriptions.clipped),e.R7$(3),e.Y8G("ngIf",n.form.value.trimClipped),e.R7$(4),e.Y8G("ngForOf",e.bMT(27,15,n.primaryCategoryOptions$)),e.R7$(2),e.Y8G("ngIf",null==(i=e.bMT(29,17,n.secondaryCategoryOptions$))?null:i.length),e.R7$(5),e.Y8G("ngIf",n.modulePath&&o.value.length),e.R7$(),e.Y8G("ngIf","production"===n.formPrimaryCategory.value),e.R7$(),e.Y8G("ngIf",n.formDuplicateStates.value),e.R7$(4),e.Y8G("disabled",n.saving||!n.form.valid||n.validating),e.R7$(),e.Y8G("ngIf",n.validating),e.R7$(),e.Y8G("ngIf",n.saving),e.R7$(),e.Y8G("ngIf",!n.validating&&!n.saving)}},dependencies:[E.Sq,E.bT,De.So,Z.tx,Z.BI,Z.E7,Z.Yi,Ce.oV,Qe.q,L.Q,ee.K,Y.R,an.tI,Nc.X,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,E.Jj],changeDetection:0}),Wo([(0,a.l6)(Ho.z.getSaveModule),Jo("design:type",u.c)],Bn.prototype,"saveModule$",void 0),Wo([(0,a.l6)(Ho.z.getPrimaryCategoryOptions("write")),Jo("design:type",u.c)],Bn.prototype,"primaryCategoryOptions$",void 0),Wo([(0,a.l6)(Ho.z.getSecondaryCategoryOptions),Jo("design:type",u.c)],Bn.prototype,"secondaryCategoryOptions$",void 0);var Lt=v(84370),Br=v(65881),Dr=v(62949),fe=v(87710),Dn=v(7213),Hc=v(59e3),Gr=v(82323),ro=v(65650),Wc=v(1580);const Jc=[.1,.25,.5,1,1.5,2];var ue,s;(s=ue||(ue={})).SetScale=(()=>{class T{constructor(A){this.scale=A}}return T.type="[Edit Timeline] Set Scale",T})(),s.SetSelectedTimelineMapIds=(()=>{class T{constructor(A){this.selectedTimelineMapIds=A}}return T.type="[Edit Timeline] Set selectedTimelineMapIds",T})(),s.AddToSelectedTimelineMapIds=(()=>{class T{constructor(A){this.selectedTimelineMapIds=A}}return T.type="[Edit Timeline] Add to selectedTimelineMapIds",T})(),s.RemoveFromSelectedTimelineMapIds=(()=>{class T{constructor(A){this.selectedTimelineMapIds=A}}return T.type="[Edit Timeline] Remove from selectedTimelineMapIds",T})(),s.SetOverlappingTimelineMapIds=(()=>{class T{constructor(A){this.overlappingTimelineMapIds=A}}return T.type="[Edit Timeline] Set overlappingTimelineMapIds",T})(),s.SetCopiedTimelineMaps=(()=>{class T{constructor(A){this.copiedTimelineMaps=A}}return T.type="[Edit Timeline] Set copiedTimelineMaps",T})();class ao{}var Yt,ot=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},pe=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Kc={scale:1,selectedTimelineMapIds:new Set([]),overlappingTimelineMapIds:new Set([]),copiedTimelineMaps:[]};let ke=((Yt=class{static getScale(t){return t.scale}static getSelectedTimelineMapIds(t){return t.selectedTimelineMapIds}static getOverlappingTimelineMapIds(t){return t.overlappingTimelineMapIds}static getCopiedTimelineMaps(t){return t.copiedTimelineMaps}setScale(t,{scale:n}){t.patchState({scale:n})}setSelectedTimelineMapIds(t,{selectedTimelineMapIds:n}){t.patchState({selectedTimelineMapIds:new Set(n)})}addSelectedTimelineMapId(t,n){const i=t.getState().selectedTimelineMapIds;n.selectedTimelineMapIds.forEach(o=>i.add(o)),t.patchState({selectedTimelineMapIds:new Set(Array.from(i))})}removeSelectedTimelineMapId(t,n){const i=t.getState().selectedTimelineMapIds;n.selectedTimelineMapIds.forEach(o=>i.delete(o)),t.patchState({selectedTimelineMapIds:new Set(Array.from(i))})}setOverlappingTimelineMapIds(t,{overlappingTimelineMapIds:n}){t.patchState({overlappingTimelineMapIds:new Set(n)})}setCopiedTimelineMaps(t,{copiedTimelineMaps:n}){t.patchState({copiedTimelineMaps:n})}}).\u0275fac=function(t){return new(t||Yt)},Yt.\u0275prov=e.jDH({token:Yt,factory:Yt.\u0275fac}),Yt);ot([(0,a.rc)(ue.SetScale),pe("design:type",Function),pe("design:paramtypes",[Object,ue.SetScale]),pe("design:returntype",void 0)],ke.prototype,"setScale",null),ot([(0,a.rc)(ue.SetSelectedTimelineMapIds),pe("design:type",Function),pe("design:paramtypes",[Object,ue.SetSelectedTimelineMapIds]),pe("design:returntype",void 0)],ke.prototype,"setSelectedTimelineMapIds",null),ot([(0,a.rc)(ue.AddToSelectedTimelineMapIds),pe("design:type",Function),pe("design:paramtypes",[Object,ue.AddToSelectedTimelineMapIds]),pe("design:returntype",void 0)],ke.prototype,"addSelectedTimelineMapId",null),ot([(0,a.rc)(ue.RemoveFromSelectedTimelineMapIds),pe("design:type",Function),pe("design:paramtypes",[Object,ue.RemoveFromSelectedTimelineMapIds]),pe("design:returntype",void 0)],ke.prototype,"removeSelectedTimelineMapId",null),ot([(0,a.rc)(ue.SetOverlappingTimelineMapIds),pe("design:type",Function),pe("design:paramtypes",[Object,ue.SetOverlappingTimelineMapIds]),pe("design:returntype",void 0)],ke.prototype,"setOverlappingTimelineMapIds",null),ot([(0,a.rc)(ue.SetCopiedTimelineMaps),pe("design:type",Function),pe("design:paramtypes",[Object,ue.SetCopiedTimelineMaps]),pe("design:returntype",void 0)],ke.prototype,"setCopiedTimelineMaps",null),ot([(0,a.MD)(),pe("design:type",Function),pe("design:paramtypes",[ao]),pe("design:returntype",void 0)],ke,"getScale",null),ot([(0,a.MD)(),pe("design:type",Function),pe("design:paramtypes",[ao]),pe("design:returntype",void 0)],ke,"getSelectedTimelineMapIds",null),ot([(0,a.MD)(),pe("design:type",Function),pe("design:paramtypes",[ao]),pe("design:returntype",void 0)],ke,"getOverlappingTimelineMapIds",null),ot([(0,a.MD)(),pe("design:type",Function),pe("design:paramtypes",[ao]),pe("design:returntype",void 0)],ke,"getCopiedTimelineMaps",null),ke=ot([(0,a.Uw)({name:"editTimeline",defaults:Kc})],ke);var ln=v(58398),pt=v(63365),$r=v(96728),Or=v(79898),lo=v(72865),Ar=v(54169),_t=v(28696),cn=v(43194),Ur=v(51452);let Zc=(()=>{var s;class t{constructor(i,o){this.store=i,this.dialogRef=o,this.actionMode=Or.g.Import,this.application=we.c.application,this.contentType=bt.c.Module,this.ngUnsubscribe=new b.B}ngOnInit(){this.initGallery()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initGallery(){const i=new lo.qS("exports"),o=this.store.selectSnapshot(cn.Y.getSearchOptions)||new Ar.n("",$r.Ir);this.store.dispatch(new _t.w.SetCardActions({enabled:!1})),this.store.dispatch(new _t.w.SetBulkActions({enabled:!1,items:[]})),this.store.dispatch(new _t.w.SetSearchConfig(i)),this.store.dispatch(new _t.w.SetSearchOptions(o))}handleSelect(i){this.dialogRef.close(i)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(a.il),e.rXU(Z.CP))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-merge-module-dialog"]],decls:5,vars:4,consts:[[1,"merge"],[1,"merge__header"],[1,"merge__body"],["selectLabel","Import",3,"selectBookmark","actionMode","application","contentType","showSourcePicker"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2,"Merge Module"),e.k0s(),e.j41(3,"div",2)(4,"app-gallery-container",3),e.bIt("selectBookmark",function(l){return o.handleSelect(l)}),e.k0s()()()),2&i&&(e.R7$(4),e.Y8G("actionMode",o.actionMode)("application",o.application)("contentType",o.contentType)("showSourcePicker",!1))},dependencies:[Ur.j],styles:["[_nghost-%COMP%]{display:block;position:relative;padding:12px;width:100%;height:100%}.merge[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.merge__header[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;border-bottom:solid 1px rgba(0,0,0,.12);padding:8px 20px;display:flex;align-items:center}.merge__body[_ngcontent-%COMP%]{flex:1 0 auto;position:relative}"],changeDetection:0}),t})(),ep=(()=>{var s;class t{constructor(i,o){this.dialogRef=i,this.data=o,this.resolve=new c.hs("loft")}ngOnInit(){}handleCancelClick(){this.dialogRef.close()}handleResolveClick(){this.dialogRef.close(this.resolve.value)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(Z.CP),e.rXU(Z.Vh))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-merge-conflict-dialog"]],decls:20,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"merge-conflict-dialog"],[1,"merge-conflict-dialog__message"],["icon","info-circle",1,"merge-conflict-dialog__message-icon","mr-3"],[1,"text-xs"],[1,"text-sm","mb-3"],[1,"text-xs","flex","flex-col",3,"formControl"],["value","loft",1,"mb-2"],["value","bridge"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","buttonType","default",3,"click"],["app-button","","buttonType","primary",3,"click"]],template:function(i,o){1&i&&(e.j41(0,"h1",0),e.EFF(1,"Resolve Merge Conflicts"),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"app-icon",4),e.j41(6,"p",5),e.EFF(7," There are conflicts with Particle Systems that prevent automatic merging. "),e.k0s()(),e.j41(8,"div",6),e.EFF(9,"Choose which changes to accept"),e.k0s(),e.j41(10,"mat-radio-group",7)(11,"mat-radio-button",8),e.EFF(12),e.k0s(),e.j41(13,"mat-radio-button",9),e.EFF(14),e.k0s()()()(),e.j41(15,"div",10)(16,"button",11),e.bIt("click",function(){return o.handleCancelClick()}),e.EFF(17," Cancel "),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return o.handleResolveClick()}),e.EFF(19,"Resolve and Merge"),e.k0s()()),2&i&&(e.R7$(10),e.Y8G("formControl",o.resolve),e.R7$(2),e.SpI("",o.data.loft," (current)"),e.R7$(2),e.SpI("",o.data.bridge," (incoming)"))},dependencies:[Ye.VT,Ye._g,Z.BI,Z.E7,Z.Yi,L.Q,Y.R,c.BC,c.l_],styles:[".merge-conflict-dialog[_ngcontent-%COMP%]{width:400px}.merge-conflict-dialog__message[_ngcontent-%COMP%]{display:flex;padding:12px;align-items:center;justify-content:center;background-color:#ffe2db;border-radius:4px}.merge-conflict-dialog__message-icon[_ngcontent-%COMP%]{color:#de3535}"],changeDetection:0}),t})();var tp=v(83513),be=v(74988),pn=v(35379),np=v(16058),ip=v(97443),Vr=v(12215),op=v(91443),sp=v(90265);const rp=["previewBody"];let ap=(()=>{var s;class t{constructor(i,o,r,l,p){this.dialogRef=i,this.publishService=o,this.changeDetectorRef=r,this.storageService=l,this.DeviceTypeEnum=pn.k,this.previewDimensions={[pn.k.Desktop]:Je,[pn.k.Tablet]:nn,[pn.k.Mobile]:Re},this.device=pn.k.Desktop,this.options={dimensions:{width:1,height:1,type:ip.M.Fixed},labelsEnabled:!0,labelScale:1,scalable:!0,backgroundColor:null,options:null},this.previewPadding=20,this.ngUnsubscribe=new b.B,this.data=p,this.formGroup=new c.gE({title:new c.MJ(""),width:new c.MJ(be.SJ.width,[c.k0.required,c.k0.min(be.SJ.width),c.k0.max(be.Av.width)]),height:new c.MJ(be.SJ.height,[c.k0.required,c.k0.min(be.SJ.height),c.k0.max(be.Av.height)])})}ngOnInit(){this.setEmbedUrl(),this.initFormListeners()}ngAfterViewInit(){const i=this.storageService.getSessionItem(Ge.d0.PreviewSize);i?this.setDimensions(i):this.setDevice(pn.k.Desktop)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCloseClick(){this.dialogRef.close()}setDeviceClick(i){this.setDevice(i)}setMaximizeClick(){this.viewerType=null;const{innerWidth:i,innerHeight:o}=window;this.setDimensions({width:i,height:o})}getDeviceTooltip(i){const{label:o,width:r,height:l}=this.previewDimensions[i];return z(o,r,l)}getMaximizeTooltip(){const{innerWidth:i,innerHeight:o}=window;return z("Maximize",i,o)}isMaximizeSelected(){const{innerWidth:i,innerHeight:o}=window,{width:r,height:l}=this.options.dimensions;return r===i&&l===o}setDevice(i){this.viewerType=null,this.setDimensions(this.previewDimensions[i])}initFormListeners(){this.formGroup.valueChanges.pipe((0,j.p)(()=>this.formGroup.valid),(0,W.B)(100),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(({width:i,height:o})=>{this.viewerType=null,this.setDimensions({width:i,height:o})})}setEmbedUrl(){const{lang:i,productAccountId:o,quizLocked:r,questionNumber:l}=this.data,p={id:"preview","ui-loader":"circle",lang:i};r&&(p["ui-quiz-locked"]=r,(0,R.isNil)(l)||(p["ui-quiz-start"]=l+1,p["ui-quiz-end"]=l+1)),o&&(p.paid=o),this.url=we.c.deploy===Vr.Z.Local||we.c.application===Me.c.Loft&&we.c.deploy===Vr.Z.QA?`/view?id=preview&lang=${i}`:this.publishService.buildWidgetURL("/viewer",p),this.changeDetectorRef.markForCheck()}setViewerType(i){Object.entries(this.previewDimensions).forEach(([o,r])=>{(0,R.isEqual)(r,i)&&(this.viewerType=o)})}setDimensions(i){this.setViewerType(i),this.formGroup.patchValue(i,{emitEvent:!1}),this.storageService.setSessionItem(Ge.d0.PreviewSize,i),Object.assign(this.options.dimensions,i),this.options={...this.options},this.changeDetectorRef.markForCheck()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(Z.CP),e.rXU(np.D),e.rXU(e.gRc),e.rXU(Ge.n$),e.rXU(Z.Vh))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-preview-dialog"]],viewQuery:function(i,o){if(1&i&&e.GBs(rp,5),2&i){let r;e.mGM(r=e.lsd())&&(o.previewBody=r.first)}},decls:24,vars:17,consts:[["previewBody",""],["data-test","preview",1,"preview"],[1,"preview__header"],[1,"text-base"],[1,"flex","items-center","theme-dark",3,"formGroup"],[1,"preview__devices"],["data-test","previewMaximizeButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","maximize"],["data-test","previewDesktopButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","desktop"],["data-test","previewTabletButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","tablet-alt"],["data-test","previewMobileButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","mobile-alt"],[1,"mx-3"],["isCompact","true","display","inline","label","width",1,"mr-4"],["data-test","previewWidth","type","number","formControlName","width",1,"input","input--small",2,"width","80px"],["isCompact","true","display","inline","label","height"],["data-test","previewHeight","type","number","formControlName","height",1,"input","input--small",2,"width","80px"],["data-test","previewClose","app-button","","buttonTheme","dark","buttonType","primary","buttonSize","sm",3,"click"],[1,"preview__body"],["theme","light",1,"preview__embed",3,"device","url","options","compact"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h2",3),e.EFF(3,"Preview"),e.k0s(),e.j41(4,"div",4)(5,"div",5)(6,"button",6),e.bIt("click",function(){return e.eBV(r),e.Njj(o.setMaximizeClick())}),e.nrm(7,"app-icon",7),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return e.eBV(r),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Desktop))}),e.nrm(9,"app-icon",9),e.k0s(),e.j41(10,"button",10),e.bIt("click",function(){return e.eBV(r),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Tablet))}),e.nrm(11,"app-icon",11),e.k0s(),e.j41(12,"button",12),e.bIt("click",function(){return e.eBV(r),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Mobile))}),e.nrm(13,"app-icon",13),e.k0s()(),e.nrm(14,"app-divider",14),e.j41(15,"app-form-field",15),e.nrm(16,"input",16),e.k0s(),e.j41(17,"app-form-field",17),e.nrm(18,"input",18),e.k0s()(),e.j41(19,"button",19),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleCloseClick())}),e.EFF(20," Exit Preview "),e.k0s()(),e.j41(21,"div",20,0),e.nrm(23,"app-embed-viewer",21),e.k0s()()}2&i&&(e.R7$(4),e.Y8G("formGroup",o.formGroup),e.R7$(2),e.Y8G("buttonType",o.isMaximizeSelected()?"info":"default")("matTooltip",o.getMaximizeTooltip()),e.BMQ("data-selected",o.isMaximizeSelected()),e.R7$(2),e.Y8G("buttonType","desktop"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Desktop)),e.BMQ("data-selected","desktop"===o.viewerType),e.R7$(2),e.Y8G("buttonType","tablet"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Tablet)),e.R7$(2),e.Y8G("buttonType","mobile"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Mobile)),e.R7$(11),e.xc7("padding",o.previewPadding,"px"),e.Y8G("device",o.device)("url",o.url)("options",o.options)("compact",!0))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,Ce.oV,L.Q,ee.K,Y.R,op.h,sp.B],styles:[".preview[_ngcontent-%COMP%]{height:100vh}.preview__header[_ngcontent-%COMP%]{height:48px;flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#131c2a;color:#d7e0ea;border-bottom:1px solid #283853}.preview__devices[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.preview__body[_ngcontent-%COMP%]{height:calc(100vh - 48px);background:#fff;padding-top:12px}.preview__embed[_ngcontent-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0}),t})();var lp=v(93844),Ct=v(58832),Fe=v(76016),cp=v(35650),co=v(62943),Ko=v(10352),Lr=v(32258),Yr=v(93547),Gn=v(25780);let $e=(()=>{var s;class t{get digitSizeInPixels(){return 40+8*this.digitSize}get value(){return this._value}set value(i){null!=i&&(null==this._initialValue&&(this._initialValue=i),this._value=i,this.propagateChange(this.value))}constructor(){this.theme="dark",this.min=0,this.max=100,this.step=1,this.digitSize=5,this.label="",this._value=0,this.disabled=!1,this.blurred=new e.bkB,this.mouseUp=new e.bkB,this.onChange=()=>{},this.onTouched=()=>{},this.propagateChange=i=>{}}ngOnInit(){}handleMouseUp(){this.mouseUp.emit()}handleBlur(){this.blurred.emit()}handleRangeDoubleClick(){this.value=this._initialValue}writeValue(i){this.value=i}registerOnChange(i){this.propagateChange=i}registerOnTouched(i){this.onTouched=i}setDisabledState(i){this.disabled=i}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-slider"]],inputs:{theme:"theme",min:"min",max:"max",step:"step",digitSize:"digitSize",value:"value",label:"label"},outputs:{blurred:"blurred",mouseUp:"mouseUp"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:5,vars:18,consts:[[1,"slider"],[1,"slider__range"],["type","range",1,"range",3,"ngModelChange","dblclick","mouseup","ngModel","min","max","step","disabled"],[1,"slider__input"],["type","number","data-test","sliderNumberInput",1,"input",3,"ngModelChange","blur","ngModel","min","max","step","disabled"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"input",2),e.mxI("ngModelChange",function(l){return e.DH7(o.value,l)||(o.value=l),l}),e.bIt("dblclick",function(){return o.handleRangeDoubleClick()})("mouseup",function(){return o.handleMouseUp()}),e.k0s()(),e.j41(3,"div",3)(4,"input",4),e.mxI("ngModelChange",function(l){return e.DH7(o.value,l)||(o.value=l),l}),e.bIt("blur",function(){return o.handleBlur()}),e.k0s()()()),2&i&&(e.R7$(2),e.AVh("light","light"===o.theme)("dark","dark"===o.theme),e.R50("ngModel",o.value),e.Y8G("min",o.min)("max",o.max)("step",o.step)("disabled",o.disabled),e.BMQ("aria-label",o.label),e.R7$(),e.xc7("flex-basis",o.digitSizeInPixels+"px"),e.R7$(),e.R50("ngModel",o.value),e.Y8G("min",o.min)("max",o.max)("step",o.step)("disabled",o.disabled),e.BMQ("aria-label",o.label))},dependencies:[c.me,c.Q0,c.MR,c.BC,c.VZ,c.zX,c.vS],styles:[".slider[_ngcontent-%COMP%]{align-items:center;display:flex}.slider__range[_ngcontent-%COMP%]{flex:1 1 100%}.slider__input[_ngcontent-%COMP%]{flex:0 0 40px;margin-left:8px}"]}),t})();var mp=v(345);let zr=(()=>{var s;class t{get isTransparent(){return this.color&&(0,co.ty)(this.color)}constructor(i){this.domSanitizer=i,this.size="medium"}getBackgroundCSS(){if(this.color&&!this.isTransparent){const i=(0,co.tH)(this.color);return this.domSanitizer.bypassSecurityTrustStyle(i)}return null}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(mp.up))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-swatch-item"]],inputs:{color:"color",size:"size",selected:"selected"},decls:1,vars:16,consts:[[1,"item"]],template:function(i,o){1&i&&e.nrm(0,"div",0),2&i&&(e.xc7("background-image",o.getBackgroundCSS()),e.AVh("item--x-small","x-small"===o.size)("item--small","small"===o.size)("item--medium","medium"===o.size)("item--large","large"===o.size)("item--x-large","x-large"===o.size)("item--selected",o.selected)("item--transparent",o.isTransparent))},styles:[".item[_ngcontent-%COMP%]{border-style:solid;border-width:1px;border-color:#eaeff5;border-radius:1px;cursor:pointer}.item--small[_ngcontent-%COMP%]{width:12px;height:12px}.item--medium[_ngcontent-%COMP%]{width:24px;height:24px}.item--large[_ngcontent-%COMP%]{width:36px;height:36px}.item--selected[_ngcontent-%COMP%]{border-color:#2d72dc;border-width:2px}.item--transparent[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f9fafd 48%,#de3535,#f9fafd 52%)}"],changeDetection:0}),t})();var $n,Zo=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},es=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const up=["presetTab"],hp=["customTab"];function fp(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-swatch-item",22),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handlePresetSelected(o))}),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("color",n)("size","medium")("selected",i.backgroundsEqual(n,i.presetBackground))}}function gp(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-swatch-item",23),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handlePresetSelected(o))}),e.k0s()}2&s&&e.Y8G("color",t.$implicit)("size","medium")}function bp(s,t){if(1&s){const n=e.RV6();e.j41(0,"div")(1,"app-form-field",24)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleFormColorSelected("color1",o))}),e.k0s()()()}if(2&s){const n=e.XpG();e.R7$(2),e.xc7("background",n.getFormBackgroundHex("color1")),e.Y8G("colorPicker",n.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled")}}function _p(s,t){if(1&s){const n=e.RV6();e.j41(0,"div")(1,"app-form-field",26)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleFormColorSelected("color1",o))}),e.k0s()(),e.j41(3,"app-form-field",27)(4,"span",28),e.nrm(5,"app-slider",29),e.k0s()(),e.j41(6,"app-form-field",30)(7,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleFormColorSelected("color2",o))}),e.k0s()(),e.j41(8,"app-form-field",31)(9,"span",28),e.nrm(10,"app-slider",32),e.k0s()()()}if(2&s){const n=e.XpG();e.R7$(2),e.xc7("background",n.getFormBackgroundHex("color1")),e.Y8G("colorPicker",n.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100),e.R7$(2),e.xc7("background",n.getFormBackgroundHex("color2")),e.Y8G("colorPicker",n.getFormBackgroundHex("color2"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100)}}function Cp(s,t){if(1&s){const n=e.RV6();e.j41(0,"div")(1,"app-form-field",33)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleFormColorSelected("color1",o))}),e.k0s()(),e.j41(3,"app-form-field",34)(4,"span",28),e.nrm(5,"app-slider",29),e.k0s()(),e.j41(6,"app-form-field",35)(7,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleFormColorSelected("color2",o))}),e.k0s()(),e.j41(8,"app-form-field",36)(9,"span",28),e.nrm(10,"app-slider",32),e.k0s()()()}if(2&s){const n=e.XpG();e.R7$(2),e.xc7("background",n.getFormBackgroundHex("color1")),e.Y8G("colorPicker",n.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100),e.R7$(2),e.xc7("background",n.getFormBackgroundHex("color2")),e.Y8G("colorPicker",n.getFormBackgroundHex("color2"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100)}}function vp(s,t){1&s&&(e.j41(0,"div")(1,"app-alert",37),e.EFF(2," The background of your application will appear behind the 3D model. "),e.k0s()())}class On{constructor(t,n,i,o,r){this.store=t,this.actions=n,this.fb=i,this.snackBar=o,this.popupRef=r,this.presetBackgrounds="module"===we.c.exportType?Ko.aN:Ko.vk,this.ngUnsubscribe=new b.B}ngOnInit(){this.initPresets(),this.initForm(),this.actions.pipe((0,a.rM)(V.EN),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Successfully applied color to all chapters.")})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initPresets(){this.presetBackground=this.store.selectSnapshot(I.N.getSelectedChapterBackground),this.background$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.presetBackground=t}),this.allChapterBackgrounds$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.distinctBackgrounds=t.filter((n,i)=>t.findIndex(o=>this.backgroundsEqual(n,o))===i)})}initForm(){const t=this.store.selectSnapshot(I.N.getSelectedChapterBackground);this.form=this.fb.group({type:["solid",[c.k0.required]],color1:["",[c.k0.required]],stop1:[0,[c.k0.required,c.k0.min(0),c.k0.max(100)]],color2:["",[c.k0.required]],stop2:[100,[c.k0.required,c.k0.min(0),c.k0.max(100)]]}),this.form.valueChanges.pipe((0,j.p)(()=>this.customTab.isActive),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applyFromCustom()}),t&&this.setCustomColorForm(t)}handleFormColorSelected(t,n){this.form.get(t).setValue(n)}handlePresetSelected(t){this.presetBackground=t,this.store.dispatch(new V.pb(t))}handleResetClick(){this.store.dispatch(new V.Wd)}handleTabChange(t){this.customTab.isActive&&this.presetBackground&&this.setCustomColorForm(this.presetBackground)}backgroundsEqual(t,n){return(0,R.isEqual)(t,n)}getBackgroundHex(t){const n=t.colors;return se.T.rgbToHex([n[0],n[1],n[2]])}getFormBackgroundHex(t){return this.form.get(t).value}applyAll(){const t=this.form.value.type;if(this.presetTab.isActive)this.store.dispatch(new V.EN(this.presetBackground));else if(this.customTab.isActive){const n=this.formToBackgroundColor(t);n&&this.store.dispatch(new V.EN(n))}}applyFromCustom(){const n=this.formToBackgroundColor(this.form.value.type);n&&this.store.dispatch(new V.pb(n))}setCustomColorForm(t){let n="solid",i="",o="",r=0,l=100;const{colors:p,gradientType:T,colorStops:B}=t,A=[p[0],p[1],p[2]],H=p.length<8?A:[p[4],p[5],p[6]];i=se.T.rgbToHex(A,!1),o=se.T.rgbToHex(H,!1),n=(0,co.ty)(t)?"transparent":(0,R.isEqual)(A,H)?"solid":T,r=B[0],l=B[1],this.form.patchValue({type:n,color1:i,stop1:r,color2:o,stop2:l})}formToBackgroundColor(t){const{color1:n,color2:i,stop1:o,stop2:r}=this.form.value;if("transparent"===t)return Ko.Vw;if(!this.form.valid||(0,R.isNil)(n)||(0,R.isNil)(i))return null;const p="radial"===t?"radial":"linear",T=[...se.T.hexToRgb(n,!1),1],B="solid"===t?T:[...se.T.hexToRgb(i,!1),1];return{colors:[...T,...B],gradientType:p,colorStops:[o,r]}}}($n=On).\u0275fac=function(t){return new(t||$n)(e.rXU(a.il),e.rXU(a.En),e.rXU(c.ze),e.rXU(Le.UG),e.rXU(Lr.W))},$n.\u0275cmp=e.VBU({type:$n,selectors:[["app-background-color-dialog"]],viewQuery:function(t,n){if(1&t&&(e.GBs(up,7),e.GBs(hp,7)),2&t){let i;e.mGM(i=e.lsd())&&(n.presetTab=i.first),e.mGM(i=e.lsd())&&(n.customTab=i.first)}},decls:35,vars:8,consts:[["presetTab",""],["customTab",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane",1,"background","theme-light"],["tabSize","medium","tabTheme","light",3,"activeTabChange"],["label","Presets"],[1,"background__section","mt-3"],[1,"background__swatches"],[3,"color","size","selected","click",4,"ngFor","ngForOf"],[1,"background__actions"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",3,"click"],[1,"text-2xs","text-nowrap"],["label","Currently Used"],[3,"color","size","click",4,"ngFor","ngForOf"],["label","Custom"],[1,"background__section","mt-4",3,"formGroup","ngSwitch"],["label","Type"],["formControlName","type",1,"input"],["value","solid"],["value","radial"],["value","linear"],["value","transparent"],[4,"ngSwitchCase"],[3,"click","color","size","selected"],[3,"click","color","size"],["label","Color"],["type","text","cpPosition","left",1,"input",3,"colorPickerChange","colorPicker","cpOutputFormat","cpAlphaChannel"],["label","Inner Color"],["label","Inner Radius"],["appEventFence",""],["theme","light","formControlName","stop1",3,"min","max"],["label","Outer Color"],["label","Outer Radius"],["theme","light","formControlName","stop2",3,"min","max"],["label","Starting Color"],["label","Starting Color Stop"],["label","Ending Color"],["label","Ending Color Stop"],["type","info","theme","light"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",2)(1,"app-tabs",3),e.bIt("activeTabChange",function(r){return e.eBV(i),e.Njj(n.handleTabChange(r))}),e.j41(2,"app-tab",4,0)(4,"div",5)(5,"app-form-field")(6,"div",6),e.DNE(7,fp,1,3,"app-swatch-item",7),e.k0s()(),e.j41(8,"div",8)(9,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.applyAll())}),e.j41(10,"span",10),e.EFF(11,"Apply to All"),e.k0s()(),e.j41(12,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.j41(13,"span",10),e.EFF(14,"Restore Original"),e.k0s()()(),e.j41(15,"app-form-field",11)(16,"div",6),e.DNE(17,gp,1,2,"app-swatch-item",12),e.k0s()()()(),e.j41(18,"app-tab",13,1)(20,"form",14)(21,"app-form-field",15)(22,"select",16)(23,"option",17),e.EFF(24,"Solid Color"),e.k0s(),e.j41(25,"option",18),e.EFF(26,"Radial Gradient"),e.k0s(),e.j41(27,"option",19),e.EFF(28,"Linear Gradient"),e.k0s(),e.j41(29,"option",20),e.EFF(30,"Transparent"),e.k0s()()(),e.DNE(31,bp,3,5,"div",21)(32,_p,11,14,"div",21)(33,Cp,11,14,"div",21)(34,vp,3,0,"div",21),e.k0s()()()()}2&t&&(e.R7$(7),e.Y8G("ngForOf",n.presetBackgrounds),e.R7$(10),e.Y8G("ngForOf",n.distinctBackgrounds),e.R7$(3),e.Y8G("formGroup",n.form)("ngSwitch",n.form.get("type").value),e.R7$(11),e.Y8G("ngSwitchCase","solid"),e.R7$(),e.Y8G("ngSwitchCase","radial"),e.R7$(),e.Y8G("ngSwitchCase","linear"),e.R7$(),e.Y8G("ngSwitchCase","transparent"))},dependencies:[E.Sq,E.ux,E.e1,te.T1,Yr.C,L.Q,Gn.L,ee.K,$e,Pt.j,Rt.O,zr,c.qT,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,Pn.bk],styles:[".background[_ngcontent-%COMP%]{width:296px;min-height:280px}.background__section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.background__swatches[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:8px}.background__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 24px}.background__actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:0}"],changeDetection:0}),Zo([(0,a.l6)(I.N.getSelectedChapterBackground),es("design:type",u.c)],On.prototype,"background$",void 0),Zo([(0,a.l6)(I.N.getAllChaptersBackground),es("design:type",u.c)],On.prototype,"allChapterBackgrounds$",void 0),Zo([(0,a.l6)(I.N.getSelectedChapterIndex),es("design:type",u.c)],On.prototype,"selectedChapterIndex$",void 0);var Un,An=v(94909),dn=v(21604),Xr=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Qr=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function yp(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",8)(1,"button",9),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeOriginal))}),e.nrm(2,"app-icon",10),e.k0s(),e.j41(3,"button",9),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeDesktop))}),e.nrm(4,"app-icon",11),e.k0s(),e.j41(5,"button",9),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeTablet))}),e.nrm(6,"app-icon",12),e.k0s(),e.j41(7,"button",9),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeMobile))}),e.nrm(8,"app-icon",13),e.k0s()()}if(2&s){const n=t.$implicit,i=e.XpG();e.R7$(),e.Y8G("buttonType",i.areDimensionsEqual(i.CanvasSizeOriginal,n)?"info":"default")("matTooltip",i.getTooltip(i.CanvasSizeOriginal)),e.R7$(2),e.Y8G("buttonType",i.areDimensionsEqual(i.CanvasSizeDesktop,n)?"info":"default")("matTooltip",i.getTooltip(i.CanvasSizeDesktop)),e.R7$(2),e.Y8G("buttonType",i.areDimensionsEqual(i.CanvasSizeTablet,n)?"info":"default")("matTooltip",i.getTooltip(i.CanvasSizeTablet)),e.R7$(2),e.Y8G("buttonType",i.areDimensionsEqual(i.CanvasSizeMobile,n)?"info":"default")("matTooltip",i.getTooltip(i.CanvasSizeMobile))}}class po{constructor(t,n){this.store=t,this.popupRef=n,this.CanvasSizeOriginal=le,this.CanvasSizeDesktop=Je,this.CanvasSizeTablet=nn,this.CanvasSizeMobile=Re,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setCanvasSizeClick(t){this.store.dispatch(new w.IW(t))}areDimensionsEqual(t,n){return t.width===n.width&&t.height===n.height}getTooltip(t){if((0,R.isEqual)(t,le)){const n=this.store.selectSnapshot(_.S.getEnginePosition),{viewportWidth:i,viewportHeight:o}=n;return z("Maximize",i,o)}{const{label:n,width:i,height:o}=t;return z(n,i,o)}}initForm(){const t=this.store.selectSnapshot(_.S.getEnginePosition),n=this.store.selectSnapshot(X.getCanvasSize),{width:i,height:o}=this.areDimensionsEqual(n,le)?{width:t.viewportWidth,height:t.viewportHeight}:n;this.form=new c.gE({width:new c.MJ(i,[c.k0.required,c.k0.min(be.gG.width),c.k0.max(be.ie.width)]),height:new c.MJ(o,[c.k0.required,c.k0.min(be.gG.height),c.k0.max(be.ie.height)])})}initFormListeners(){this.form.valueChanges.pipe((0,An.E)(this.canvasSize$),(0,W.B)(100),(0,j.p)(()=>this.form.valid),(0,S.Q)(this.ngUnsubscribe)).subscribe(([t])=>{const{width:n,height:i}=t;this.store.dispatch(new w.IW(new q("Custom",n,i)))}),this.canvasSize$.pipe((0,An.E)(this.enginePosition$),(0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{const{width:i,height:o}=t,{viewportWidth:r,viewportHeight:l}=n;"Custom"!=t.label&&(this.areDimensionsEqual(t,le)?this.form.setValue({width:r,height:l},{emitEvent:!1}):this.form.setValue({width:i,height:o},{emitEvent:!1}))})}}(Un=po).\u0275fac=function(t){return new(t||Un)(e.rXU(a.il),e.rXU(Lr.W))},Un.\u0275cmp=e.VBU({type:Un,selectors:[["app-dimensions-dialog"]],standalone:!0,features:[e.aNF],decls:13,vars:4,consts:[["role","dialog","aria-modal","true","aria-label","Dimensions Dialog","cdkDrag","","cdkDragRootElement",".cdk-overlay-pane",1,"dimensions-dialog","theme-light"],["class","dimensions-dialog__sizes",4,"ngIf"],[1,"!my-3"],[1,"dimensions-dialog__form",3,"formGroup"],[1,"dimensions-dialog__field"],[1,"dimensions-dialog__field-label"],["type","number","formControlName","width",1,"input"],["type","number","formControlName","height",1,"input"],[1,"dimensions-dialog__sizes"],["app-button","","buttonTheme","light","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","maximize"],["icon","desktop"],["icon","tablet-alt"],["icon","mobile-alt"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,yp,9,8,"div",1),e.nI1(2,"async"),e.nrm(3,"mat-divider",2),e.j41(4,"form",3)(5,"label",4)(6,"span",5),e.EFF(7,"Width"),e.k0s(),e.nrm(8,"input",6),e.k0s(),e.j41(9,"label",4)(10,"span",5),e.EFF(11,"Height"),e.k0s(),e.nrm(12,"input",7),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngIf",e.bMT(2,2,n.canvasSize$)),e.R7$(3),e.Y8G("formGroup",n.form))},dependencies:[E.MD,E.bT,E.Jj,Ut.G,te.T1,Ce.oV,Qe.q,te.ad,dn.G,L.Q,Y.R,c.X1,c.qT,c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,oo.D],styles:[".dimensions-dialog[_ngcontent-%COMP%]{position:relative;width:200px;overflow:hidden}.dimensions-dialog__sizes[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:2px}.dimensions-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.dimensions-dialog__field[_ngcontent-%COMP%]{display:flex;align-items:center}.dimensions-dialog__field-label[_ngcontent-%COMP%]{color:#61779e;font-size:.625rem;line-height:.75rem;text-transform:uppercase;width:80px}"],changeDetection:0}),Xr([(0,a.l6)(_.S.getEnginePosition),Qr("design:type",u.c)],po.prototype,"enginePosition$",void 0),Xr([(0,a.l6)(X.getCanvasSize),Qr("design:type",u.c)],po.prototype,"canvasSize$",void 0);var kp=v(5025),Hr=v(98020),Wr=v(20342),ts=v(1308),Sp=v(46799),Jr=v(20339),Kr=v(94604),Tp=v(41537),xp=v(51002),ns=v(29160),mn=v(79805);class Ep{constructor(){this.firstTime=0,this.lastTime=1}}var Vn,dt=v(515),wp=v(40621),is=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},os=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Fp=["scrubber"],Pp=s=>({"mr-4":s});function Rp(s,t){1&s&&e.nrm(0,"app-button-icon",7)}function Mp(s,t){1&s&&e.nrm(0,"app-button-icon",8)}function jp(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",4),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handlePlayClick())}),e.DNE(1,Rp,1,0,"app-button-icon",5),e.nI1(2,"async"),e.DNE(3,Mp,1,0,"app-button-icon",6),e.nI1(4,"async"),e.k0s()}if(2&s){const n=e.XpG();e.Y8G("buttonTheme",n.theme)("ngClass",e.eq3(8,Pp,n.showScrubber)),e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,4,n.animationPlaying$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,6,n.animationPlaying$))}}function Ip(s,t){if(1&s){const n=e.RV6();e.j41(0,"input",9,0),e.mxI("ngModelChange",function(o){e.eBV(n);const r=e.XpG();return e.DH7(r.percent,o)||(r.percent=o),e.Njj(o)}),e.bIt("mousedown",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleInputMouseDown())})("mouseup",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleInputMouseUp())}),e.k0s()}if(2&s){const n=e.XpG();e.R50("ngModel",n.percent)}}class Ln{get percent(){return this._percent}set percent(t){this._percent=t,this.animationService.isPlaying()||this.scrubPercent(this.percent)}constructor(t,n,i,o){this.changeDetection=t,this.animationService=n,this.store=i,this.engineService=o,this.theme="dark",this.showPlay=!0,this.showScrubber=!0,this.playing=!1,this.wasPlaying=!1,this.ngUnsubscribe=new b.B,this._percent=0,this.scrub$=new ns.t(0),this.interactive=!1,this.timeline=new Ep}ngOnInit(){this.bindApplicationEvents()}ngOnDestroy(){this.changeDetection.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.unsubscribe()}bindApplicationEvents(){this.chapterReadyState$.pipe((0,j.p)(t=>!!t.animation),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.initScrubber()}),this.engineService.getEvent(dt.X.TimelinePlaying).pipe((0,Zi.Z)(50),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>this.tick(t.time)),this.engineService.getEvent(dt.X.TimelineScrubbed).pipe((0,Zi.Z)(50),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.scrubber.nativeElement.value=this.getPercent(t.time)}),this.engineService.getEvent(dt.X.TimelineTimeFrameUpdated).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timeline=this.animationService.getChapterTimeFrame(),this.percent=this.getPercent(this.animationService.getTime()),this.changeDetection.markForCheck()}),this.animationPlaying$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>this.playing=t)}handleInputMouseDown(){this.wasPlaying=this.playing,this.store.dispatch(new oe.dE(!1))}handleInputMouseUp(){this.store.dispatch(new oe.dE(this.wasPlaying))}handlePlayClick(){this.play()}play(){const t=!this.store.selectSnapshot(_.S.getAnimationPlaying);this.store.dispatch(new oe.dE(t))}initScrubber(){this.timeline=this.animationService.getChapterTimeFrame(),this.percent=0,this.changeDetection.markForCheck()}tick(t){this.percent=this.getPercent(t),this.changeDetection.markForCheck()}getPercent(t){const{lastTime:n}=this.timeline;return 0===n?0:t/n*100}scrubPercent(t){this.animationService.scrub(t/100*this.timeline.lastTime)}}(Vn=Ln).\u0275fac=function(t){return new(t||Vn)(e.rXU(e.gRc),e.rXU(wt.O),e.rXU(a.il),e.rXU(mn.y))},Vn.\u0275cmp=e.VBU({type:Vn,selectors:[["app-engine-scrubber"]],viewQuery:function(t,n){if(1&t&&e.GBs(Fp,5),2&t){let i;e.mGM(i=e.lsd())&&(n.scrubber=i.first)}},inputs:{theme:"theme",showPlay:"showPlay",showScrubber:"showScrubber"},decls:3,vars:2,consts:[["scrubber",""],[1,"engine-scrubber"],["app-button","","buttonSize","sm","class","engine-scrubber__play",3,"buttonTheme","ngClass","click",4,"ngIf"],["class","engine-scrubber__input","type","range","style","width: 100%","min","0","max","100",3,"ngModel","ngModelChange","mousedown","mouseup",4,"ngIf"],["app-button","","buttonSize","sm",1,"engine-scrubber__play",3,"click","buttonTheme","ngClass"],["label","Play","iconPlacement","left","icon","play",4,"ngIf"],["label","Pause","iconPlacement","left","icon","pause",4,"ngIf"],["label","Play","iconPlacement","left","icon","play"],["label","Pause","iconPlacement","left","icon","pause"],["type","range","min","0","max","100",1,"engine-scrubber__input",2,"width","100%",3,"ngModelChange","mousedown","mouseup","ngModel"]],template:function(t,n){1&t&&(e.j41(0,"div",1),e.DNE(1,jp,5,10,"button",2)(2,Ip,2,1,"input",3),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",n.showPlay),e.R7$(),e.Y8G("ngIf",n.showScrubber))},dependencies:[E.YU,E.bT,c.me,c.MR,c.BC,c.vS,L.Q,wp.T,E.Jj],styles:["[_nghost-%COMP%]{display:block;width:100%}.engine-scrubber[_ngcontent-%COMP%]{justify-content:center;align-items:center;display:flex;position:relative;width:100%;-webkit-user-select:none;user-select:none}.engine-scrubber__input[_ngcontent-%COMP%]{width:100%}.engine-scrubber__play[_ngcontent-%COMP%]{width:80px}"],changeDetection:0}),is([(0,a.l6)(I.N.getSelectedChapterId),os("design:type",u.c)],Ln.prototype,"selectedChapterId$",void 0),is([(0,a.l6)(I.N.getSelectedChapterReadyState),os("design:type",u.c)],Ln.prototype,"chapterReadyState$",void 0),is([(0,a.l6)(_.S.getAnimationPlaying),os("design:type",u.c)],Ln.prototype,"animationPlaying$",void 0);var Yn,mo=v(78109),Np=v(44867);function Gp(s,t){if(1&s&&(e.j41(0,"div",1)(1,"div",2),e.EFF(2),e.k0s(),e.j41(3,"div",3),e.EFF(4),e.k0s()()),2&s){const n=t.ngIf,i=e.XpG();e.R7$(2),e.JRh(n.label),e.R7$(2),e.SpI(" ",i.nodeAncestors," ")}}class ss{constructor(t,n,i){this.graphService=t,this.store=n,this.changeDetection=i,this.ngUnsubscribe=new b.B}ngOnInit(){this.hoveredNode$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.nodeAncestors=this.getNodeAncestors(t).map(n=>n.label).slice(0,-1).join(" > "),this.nodeAncestors.length>160&&(this.nodeAncestors=`...${this.nodeAncestors.slice(-160)}`),this.changeDetection.markForCheck()})}ngOnDestroy(){this.changeDetection.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}getNodeAncestors(t){const n=this.store.selectSnapshot(_.S.getViewGraph);return(0,Np.DS)(n,t.id,!0).map(i=>n.nodes[i]).reverse()}}(Yn=ss).\u0275fac=function(t){return new(t||Yn)(e.rXU(mo.w),e.rXU(a.il),e.rXU(e.gRc))},Yn.\u0275cmp=e.VBU({type:Yn,selectors:[["app-engine-breadcrumb"]],decls:2,vars:3,consts:[["class","breadcrumb",4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb__node"],[1,"breadcrumb__ancestors"]],template:function(t,n){1&t&&(e.DNE(0,Gp,5,2,"div",0),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,n.hoveredNode$))},dependencies:[E.bT,E.Jj],styles:[".breadcrumb[_ngcontent-%COMP%]{animation:fadeIn .25s ease forwards;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.breadcrumb__node[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;color:#fff;font-weight:700}.theme-light[_nghost-%COMP%]   .breadcrumb__node[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .breadcrumb__node[_ngcontent-%COMP%]{color:#101823}.breadcrumb__ancestors[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;color:#96a8c0}.theme-light[_nghost-%COMP%]   .breadcrumb__ancestors[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .breadcrumb__ancestors[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(_.S.getHoveredNode),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ss.prototype,"hoveredNode$",void 0);var $=v(59115);const $p=["*"];var Zr=function(s){return s.Inline="inline",s.Block="block",s}(Zr||{});let un=(()=>{var s;class t{constructor(){this.render=Zr.Inline}ngOnInit(){}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-button-group"]],inputs:{render:"render"},ngContentSelectors:$p,decls:2,vars:0,consts:[[1,"app-button-group"]],template:function(i,o){1&i&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.k0s())},styles:["app-button-group{display:flex}.app-button-group{display:inline-flex;position:relative;width:100%}.app-button-group button[app-button]:first-child span{border-top-right-radius:0!important;border-bottom-right-radius:0!important}.app-button-group button[app-button]:last-child span{border-top-left-radius:0!important;border-bottom-left-radius:0!important}.app-button-group button[app-button]:last-child:not([data-button-type=outline]){transform:translate(1px)!important}.app-button-group button[app-button]:last-child[data-button-type=outline]{transform:translate(-1px)!important}.app-button-group button[app-button]:not(:first-child):not(:last-child){transform:translate(1px)!important;border-radius:0!important}.app-button-group button[app-button]:not(:first-child):not(:last-child) span{border-radius:0!important}.app-button-group button[app-button]:not(:first-child):not(:last-child)[data-button-type=outline]{transform:translate(-1px)!important}\n"],encapsulation:2,changeDetection:0}),t})();var Op=v(78183),rs=function(s){return s.Green="green",s.Yellow="yellow",s.Red="red",s}(rs||{});let ea=(()=>{var s;class t{constructor(){this.color=rs.Green}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-status"]],inputs:{color:"color"},decls:1,vars:1,consts:[["data-test","status",1,"status",3,"ngClass"]],template:function(i,o){1&i&&e.nrm(0,"div",0),2&i&&e.Y8G("ngClass","status--"+o.color)},dependencies:[E.YU],styles:[".status[_ngcontent-%COMP%]{--dot-color: #33cd54;height:8px;width:8px;border-radius:50%;background-color:var(--dot-color)}.status--green[_ngcontent-%COMP%]{--dot-color: #33cd54}.status--yellow[_ngcontent-%COMP%]{--dot-color: #ffb92e}.status--red[_ngcontent-%COMP%]{--dot-color: #f44336}"],changeDetection:0}),t})();var zn,uo=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},ho=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Ap(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",1)(1,"button",2),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handlePreviousClick())}),e.nrm(2,"app-icon",3),e.k0s(),e.j41(3,"span",4),e.EFF(4),e.nI1(5,"async"),e.k0s(),e.j41(6,"button",5),e.nI1(7,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleNextClick())}),e.nrm(8,"app-icon",6),e.k0s()()}if(2&s){let n,i;const o=e.XpG();e.R7$(),e.Y8G("disabled",0===o.chapterIndex),e.R7$(3),e.Lme(" ",o.chapterIndex+1," / ",null==(n=e.bMT(5,4,o.chapters$))?null:n.length," "),e.R7$(2),e.Y8G("disabled",o.chapterIndex===(null==(i=e.bMT(7,6,o.chapters$))?null:i.length)-1)}}class hn{constructor(t,n){this.store=t,this.changeDetectorRef=n,this.ngUnsubscribe=new b.B}ngOnInit(){this.selectedChapterIndex$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.chapterIndex=t,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePreviousClick(){this.store.dispatch(new V.F0)}handleNextClick(){this.store.dispatch(new V.tg)}}(zn=hn).\u0275fac=function(t){return new(t||zn)(e.rXU(a.il),e.rXU(e.gRc))},zn.\u0275cmp=e.VBU({type:zn,selectors:[["app-edit-chapter-pagination"]],decls:2,vars:3,consts:[["class","chapter-pagination","appEventFence","",4,"ngIf"],["appEventFence","",1,"chapter-pagination"],["type","button",1,"chapter-pagination__button","chapter-pagination__button--back",3,"click","disabled"],["size","lg","icon","angle-left"],[1,"chapter-pagination__count"],["type","button",1,"chapter-pagination__button","chapter-pagination__button--next",3,"click","disabled"],["size","lg","icon","angle-right"]],template:function(t,n){if(1&t&&(e.DNE(0,Ap,9,8,"div",0),e.nI1(1,"async")),2&t){let i;e.Y8G("ngIf",(null==(i=e.bMT(1,1,n.chapters$))?null:i.length)>1)}},dependencies:[E.bT,Gn.L,Y.R,E.Jj],styles:[".chapter-pagination{display:flex;height:56px;align-items:center;-webkit-user-select:none;user-select:none;position:relative}.chapter-pagination__button{background:transparent;border:none;color:#d7e0ea;padding:0 20px;flex:1 1 50%;height:100%;outline:none}.chapter-pagination__button:disabled{color:#61779e}.chapter-pagination__button:not(:disabled):hover{color:#fff;cursor:pointer}.chapter-pagination__button .app-button{height:100%}.chapter-pagination__button--back{text-align:left}.chapter-pagination__button--next{text-align:right}.chapter-pagination__count{font-size:.75rem;line-height:1rem;display:flex;align-items:center;white-space:nowrap;width:100%;height:100%;left:0;top:0;justify-content:center;position:absolute;pointer-events:none;z-index:10}\n"],encapsulation:2,changeDetection:0}),uo([(0,a.l6)(x.t.getStory),ho("design:type",u.c)],hn.prototype,"story$",void 0),uo([(0,a.l6)(I.N.getSelectedChapter),ho("design:type",u.c)],hn.prototype,"selectedChapter$",void 0),uo([(0,a.l6)(I.N.getSelectedChapterIndex),ho("design:type",u.c)],hn.prototype,"selectedChapterIndex$",void 0),uo([(0,a.l6)(I.N.getStoryChapters),ho("design:type",u.c)],hn.prototype,"chapters$",void 0);var O=v(12921),as=v(76939);const Up=["*"];function Vp(s,t){1&s&&e.SdG(0,0,["*ngIf","!currentPortal"])}function Lp(s,t){}function Yp(s,t){if(1&s&&e.DNE(0,Lp,0,0,"ng-template",1),2&s){const n=e.XpG();e.Y8G("cdkPortalOutlet",n.currentPortal)}}let et=(()=>{var s;class t{get currentPortal(){return this.portals[this.portals.length-1]}constructor(i,o){this.changeRef=i,this._viewContainerRef=o,this.portals=[],this.ngUnsubscribe=new b.B,this.portalSubscription=new b.B}ngOnInit(){this.initListeners()}ngOnDestroy(){this.currentPortal&&this.currentPortal.isAttached&&this.currentPortal.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.portalSubscription.asObservable().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.portals.push(i),this.changeRef.markForCheck()})}loadComponent(i){this.loadPortal(new as.A8(i))}loadTemplate(i){this.loadPortal(new as.VA(i,this._viewContainerRef))}loadPortal(i){this.portalSubscription.next(i)}back(){this.portals.pop(),this.changeRef.markForCheck()}exit(){this.portals.length=0,this.changeRef.markForCheck()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.gRc),e.rXU(e.c1b))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-portal"]],ngContentSelectors:Up,decls:2,vars:2,consts:[[4,"ngIf"],[3,"cdkPortalOutlet"]],template:function(i,o){1&i&&(e.NAR(),e.DNE(0,Vp,1,0,"ng-content",0)(1,Yp,1,1,null,0)),2&i&&(e.Y8G("ngIf",!o.currentPortal),e.R7$(),e.Y8G("ngIf",o.currentPortal))},dependencies:[E.bT,as.I3],changeDetection:0}),t})();var ae=v(35939),xe=v(38970),de=v(57535);const zp=[[["","column-group-header",""]],[["","column-group-body",""]]],Xp=["[column-group-header]","[column-group-body]"];let st=(()=>{var s;class t{get isActive(){return this._isActive}set isActive(i){this._isActive=i,this.show(this.isActive)}constructor(i,o){this.renderer=i,this.element=o,this._isActive=!1,this.compact=!0}ngOnInit(){}show(i){this.renderer.setStyle(this.element.nativeElement,"display",this.isActive?"flex":"none")}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(e.sFG),e.rXU(e.aKT))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-column-group"]],inputs:{label:"label",isActive:"isActive",compact:"compact"},ngContentSelectors:Xp,decls:5,vars:2,consts:[[1,"column-group"],[1,"column-group__header"],[1,"column-group__body"]],template:function(i,o){1&i&&(e.NAR(zp),e.j41(0,"div",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.SdG(4,1),e.k0s()()),2&i&&e.AVh("column-group--compact",o.compact)},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden}.column-group[_ngcontent-%COMP%]{height:100%;display:flex;flex:1 1 auto;flex-direction:column;overflow:hidden}.theme-light[_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%]{border-color:transparent}.theme-dark[_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%]{scrollbar-color:#96a8c0 #1c2a3f}.column-group__header[_ngcontent-%COMP%]{flex:0 1 auto;padding:8px 8px 12px}.column-group__header[_ngcontent-%COMP%]:empty{display:none}.column-group__body[_ngcontent-%COMP%]{border-top:1px solid #283853;display:flex;flex-direction:column;flex:1 1 100%;overflow-y:scroll;padding:0}.column-group--compact[_ngcontent-%COMP%]   .column-group__body[_ngcontent-%COMP%]{padding:0 12px 0 0}"],changeDetection:0}),t})();const Qp=[[["","column-nav",""]],[["","column-label",""]],[["","column-actions",""]],[["","column-header",""]],[["app-column-group"]],[["","column-group-actions",""]],[["","column-footer",""]]],qp=["[column-nav]","[column-label]","[column-actions]","[column-header]","app-column-group","[column-group-actions]","[column-footer]"],Hp=s=>({"column__tab--selected":s});function Wp(s,t){if(1&s&&(e.j41(0,"div",4),e.nrm(1,"app-spinner",5),e.j41(2,"div",6),e.EFF(3),e.k0s()()),2&s){const n=e.XpG();e.R7$(3),e.JRh(n.loadingLabel)}}function Jp(s,t){1&s&&(e.j41(0,"div",7)(1,"div",8)(2,"div",9),e.SdG(3),e.k0s(),e.j41(4,"div",10),e.SdG(5,1),e.k0s(),e.j41(6,"div",11),e.SdG(7,2),e.k0s()(),e.SdG(8,3),e.k0s())}function Kp(s,t){if(1&s){const n=e.RV6();e.j41(0,"span",18),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(3);return e.Njj(r.handleColumnGroupSelect(o))}),e.j41(1,"div",19),e.EFF(2),e.k0s()()}if(2&s){const n=t.$implicit,i=e.XpG(3);e.Y8G("ngClass",e.eq3(3,Hp,i.isColumnGroupSelected(n))),e.R7$(),e.BMQ("data-test","column"+n.label),e.R7$(),e.SpI(" ",n.label," ")}}function Zp(s,t){if(1&s&&(e.j41(0,"div",15),e.DNE(1,Kp,3,5,"span",16),e.j41(2,"div",17),e.SdG(3,5),e.k0s()()),2&s){const n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.columnGroups)}}function ed(s,t){1&s&&(e.j41(0,"div",20),e.SdG(1,6),e.k0s())}function td(s,t){if(1&s&&(e.qex(0),e.DNE(1,Zp,4,1,"div",12),e.j41(2,"div",13),e.SdG(3,4),e.k0s(),e.DNE(4,ed,2,0,"div",14),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.columnGroups.length>1),e.R7$(3),e.Y8G("ngIf",!n.loading)}}class nd{constructor(t,n,i){this.index=t,this.label=n,this.component=i}}let mt=(()=>{var s;class t{constructor(){this.showHeader=!0,this.loading=!1,this.loadingLabel="",this._selectedColumnGroup=new ns.t(0),this.selectedColumnGroupChange=new e.bkB,this.next=new e.bkB,this.previous=new e.bkB,this.ngUnsubscribe=new b.B}get selectedColumnGroup(){return this._selectedColumnGroup.value}set selectedColumnGroup(i){null!=i&&i!==this.selectedColumnGroup&&("string"==typeof i&&(i=i.toUpperCase()),this._selectedColumnGroup.next(i),this.selectedColumnGroupChange.emit(i))}ngAfterContentInit(){this.mapContentGroups(),this._selectedColumnGroup.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.showColumnGroup(i)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleColumnGroupSelect(i){this.selectedColumnGroup=i.label}mapContentGroups(){this.columnGroups=this.columnGroupsQuery.map((i,o)=>new nd(o,i.label,i))}showColumnGroup(i){this.columnGroups.forEach((o,r)=>{switch(typeof i){case"number":o.component.isActive=i===r;break;case"string":o.component.isActive=i.toString().toUpperCase()===o.label.toUpperCase()}})}isColumnGroupSelected(i){return("string"==typeof this._selectedColumnGroup.value?i.label.toUpperCase():i.index)===this._selectedColumnGroup.value}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-column"]],contentQueries:function(i,o,r){if(1&i&&e.wni(r,st,4),2&i){let l;e.mGM(l=e.lsd())&&(o.columnGroupsQuery=l)}},inputs:{label:"label",showHeader:"showHeader",loading:"loading",loadingLabel:"loadingLabel",selectedColumnGroup:"selectedColumnGroup"},outputs:{selectedColumnGroupChange:"selectedColumnGroupChange",next:"next",previous:"previous"},ngContentSelectors:qp,decls:4,vars:3,consts:[[1,"column"],["class","column__loading",4,"ngIf"],["class","column__header",4,"ngIf"],[4,"ngIf"],[1,"column__loading"],["size","large"],[1,"column__loading-label"],[1,"column__header"],[1,"column__title"],[1,"column__nav"],[1,"column__label"],[1,"column__actions"],["class","column__tabs",4,"ngIf"],[1,"column__group"],["class","column__footer",4,"ngIf"],[1,"column__tabs"],["class","column__tab",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"column__tabs-actions","flex-auto","flex","flex-row","items-center","justify-end"],[1,"column__tab",3,"click","ngClass"],[1,"column__tab-label"],[1,"column__footer"]],template:function(i,o){1&i&&(e.NAR(Qp),e.j41(0,"div",0),e.DNE(1,Wp,4,1,"div",1)(2,Jp,9,0,"div",2)(3,td,5,2,"ng-container",3),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",o.showHeader&&!o.loading),e.R7$(),e.Y8G("ngIf",!o.loading))},dependencies:[E.YU,E.Sq,E.bT,an.tI],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden;flex:1 1 auto}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;height:100%;overflow-y:hidden}.theme-light[_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]{color:#61779e}.theme-light[_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]:hover, .theme-light   [_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]:hover{color:#131c2a}.theme-light[_nghost-%COMP%]   .column__tab--selected[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__tab--selected[_ngcontent-%COMP%]{color:#131c2a}.theme-light[_nghost-%COMP%]   .column__footer[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__footer[_ngcontent-%COMP%]{border-color:#f9fafd}.column__loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex:1 1 100%;flex-direction:column}.column__loading-label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;padding-top:8px;color:#ffffff80}.column__header[_ngcontent-%COMP%]{flex:0 0 auto}.column__tabs[_ngcontent-%COMP%]{display:flex;align-items:baseline;flex:0 0 auto;padding:8px 12px 0}.column__tabs-action[_ngcontent-%COMP%]{color:#fff}.column__tab[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;text-transform:uppercase;color:#96a8c0;padding:8px;-webkit-user-select:none;user-select:none}.column__tab[_ngcontent-%COMP%]:first-child{padding-left:0}.column__tab[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid #2d72dc;margin-top:4px;width:0;transition:.25s ease}.column__tab[_ngcontent-%COMP%]:hover{color:#fff;cursor:pointer}.column__tab--selected[_ngcontent-%COMP%]{color:#fff}.column__tab--selected[_ngcontent-%COMP%]:after{width:100%}.column__tab-label[_ngcontent-%COMP%]{padding:0 4px}.column__title[_ngcontent-%COMP%]{align-items:center;flex:1 1 100%;display:flex;min-height:48px;padding:0 8px}.column__arrow[_ngcontent-%COMP%]{flex:0 0 32px;display:flex}.column__nav[_ngcontent-%COMP%]{display:flex}.column__label[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;min-height:28px;align-items:center;padding:0 8px}.column__actions[_ngcontent-%COMP%]{flex:0 1 auto}.column__search[_ngcontent-%COMP%]{padding:0 12px 8px}.column__body[_ngcontent-%COMP%]{height:100%;overflow-y:scroll}.column__footer[_ngcontent-%COMP%]{border-top:1px solid #283853;flex:0 0 auto}.column__group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 100%;height:100%;overflow:hidden}.column__group-header[_ngcontent-%COMP%]{flex:0 1 auto}'],changeDetection:0}),t})();const id=[[["","list-actions",""]],"*"],od=["[list-actions]","*"];let Ie=(()=>{var s;class t{constructor(i){this.portalComponent=i,this.navigate=new e.bkB}ngOnInit(){}handleNavigateClick(){this.navigate.emit(),this.portalComponent.back()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(et))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-portal-column"]],inputs:{label:"label"},outputs:{navigate:"navigate"},ngContentSelectors:od,decls:11,vars:1,consts:[["column-label",""],["column-nav",""],["app-button","",3,"click"],["icon","arrow-left","size","lg"],["column-actions",""],["column-group-body",""]],template:function(i,o){1&i&&(e.NAR(id),e.j41(0,"app-column")(1,"div",0),e.EFF(2),e.k0s(),e.j41(3,"div",1)(4,"button",2),e.bIt("click",function(){return o.handleNavigateClick()}),e.nrm(5,"app-icon",3),e.k0s()(),e.j41(6,"div",4),e.SdG(7),e.k0s(),e.j41(8,"app-column-group"),e.qex(9,5),e.SdG(10,1),e.bVm(),e.k0s()()),2&i&&(e.R7$(2),e.SpI(" ",o.label," "))},dependencies:[mt,st,Y.R,L.Q],changeDetection:0}),t})();var Xn;class ls{constructor(t,n){this.store=t,this.formBuilder=n,this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({colorEnabled:[!1],color:[""],alphaEnabled:[!1],alpha:[""],spritesEnabled:[!1],spriteRows:[0],spriteCols:[0],spriteStartFrame:[0],spriteEndFrame:[0]}),this.setValues(de.yB)}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((t,n)=>{const i=this.createParticleSystem(t),o=this.createParticleSystem(n);return(0,R.isEqual)(i,o)}),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setParticleSystem(t)})}initParticleSystemListeners(){this.particleSystem$.pipe((0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)})}handleResetClick(){this.resetFormValues()}setParticleSystem(t){const n=this.createParticleSystem(t);this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}setValues(t){(0,xe.bF)(t)&&this.setTextureValues(t.textures??[]),this.setSpriteValues(t)}setTextureValues(t){t.forEach(n=>{const{src:i,applyTo:o}=n,r=this.formGroup.get(o),l=this.formGroup.get(`${o}Enabled`);if(r){const p=!!i;r.setValue(i,{emitEvent:!1}),l.setValue(p,{emitEvent:!1})}})}resetFormValues(){this.formGroup.patchValue({colorEnabled:!1,color:"",alphaEnabled:!1,alpha:"",spritesEnabled:!1,...de.yB})}createParticleSystem(t){const{spritesEnabled:n,spriteRows:i,spriteCols:o,spriteStartFrame:r,spriteEndFrame:l}=t,p=this.store.selectSnapshot(O.B.getSelectedParticleSystem),T=this.getTextures(t);return(0,de.Ir)({...p,textures:T,spriteRows:n?i:void 0,spriteCols:n?o:void 0,spriteStartFrame:n?r:void 0,spriteEndFrame:n?l:void 0})}setSpriteValues(t){const{spriteRows:n,spriteCols:i,spriteStartFrame:o,spriteEndFrame:r}=t,p={spritesEnabled:[n,i,o,r].some(T=>!(0,R.isNil)(T)),...(0,de.Ir)({spriteRows:n,spriteCols:i,spriteStartFrame:o,spriteEndFrame:r})};this.formGroup.patchValue(p,{emitEvent:!1})}getTextures(t){const{colorEnabled:n,color:i,alphaEnabled:o,alpha:r}=t,l=[];return n&&i&&l.push({src:i,applyTo:"color"}),o&&r&&l.push({src:r,applyTo:"alpha"}),l}}(Xn=ls).\u0275fac=function(t){return new(t||Xn)(e.rXU(a.il),e.rXU(c.ze))},Xn.\u0275cmp=e.VBU({type:Xn,selectors:[["app-edit-particle-sprites"]],decls:22,vars:11,consts:[["systemActions","matMenu"],["label","Sprites"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[3,"overlapTrigger"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Color","toggleType","checkbox","formControlName","colorEnabled"],["type","text","formControlName","color","placeholder","path/of/texture",1,"input"],["label","Alpha","toggleType","checkbox","formControlName","alphaEnabled"],["type","text","formControlName","alpha","placeholder","path/of/texture",1,"input"],["label","Sprite Sheet","toggleType","checkbox","formControlName","spritesEnabled"],["label","Rows"],["formControlName","spriteRows",3,"min","max"],["label","Columns"],["formControlName","spriteCols",3,"min","max"],["label","Start Frame"],["formControlName","spriteStartFrame",3,"min","max"],["label","End Frame"],["formControlName","spriteEndFrame",3,"min","max"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",5,0)(6,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"div",7)(9,"app-panel",8),e.nrm(10,"input",9),e.k0s(),e.j41(11,"app-panel",10),e.nrm(12,"input",11),e.k0s(),e.j41(13,"app-panel",12)(14,"app-form-field",13),e.nrm(15,"app-slider",14),e.k0s(),e.j41(16,"app-form-field",15),e.nrm(17,"app-slider",16),e.k0s(),e.j41(18,"app-form-field",17),e.nrm(19,"app-slider",18),e.k0s(),e.j41(20,"app-form-field",19),e.nrm(21,"app-slider",20),e.k0s()()()()}if(2&t){const i=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(2),e.Y8G("overlapTrigger",!0),e.R7$(4),e.Y8G("formGroup",n.formGroup),e.R7$(7),e.Y8G("min",1)("max",16),e.R7$(2),e.Y8G("min",0)("max",16),e.R7$(2),e.Y8G("min",0)("max",255),e.R7$(2),e.Y8G("min",0)("max",255)}},dependencies:[c.me,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,Ie],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleSystem),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ls.prototype,"particleSystem$",void 0);var ta=v(1670),vt=v(93815);let fo=(()=>{var s;class t extends qe.n{constructor(i,o){super(),this.formBuilder=i,this.changeRef=o,this.xmin=0,this.xmax=100,this.ymin=0,this.ymax=100,this.zmin=0,this.zmax=100,this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({vec:this.formBuilder.array([0,0,0])})}ngOnInit(){this.formGroup.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.value=i.vec})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){this.formGroup.patchValue({vec:i}),this.changeRef.markForCheck()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-vector"]],inputs:{xmin:"xmin",xmax:"xmax",ymin:"ymin",ymax:"ymax",zmin:"zmin",zmax:"zmax"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:8,vars:13,consts:[[3,"formGroup"],["formArrayName","vec"],["label","X","display","inline"],[3,"min","max","step","formControlName"],["label","Y","display","inline"],["label","Z","display","inline"]],template:function(i,o){1&i&&(e.qex(0,0)(1,1),e.j41(2,"app-form-field",2),e.nrm(3,"app-slider",3),e.k0s(),e.j41(4,"app-form-field",4),e.nrm(5,"app-slider",3),e.k0s(),e.j41(6,"app-form-field",5),e.nrm(7,"app-slider",3),e.k0s(),e.bVm()()),2&i&&(e.Y8G("formGroup",o.formGroup),e.R7$(3),e.Y8G("min",o.xmin)("max",o.xmax)("step",.1)("formControlName",0),e.R7$(2),e.Y8G("min",o.ymin)("max",o.ymax)("step",.1)("formControlName",1),e.R7$(2),e.Y8G("min",o.zmin)("max",o.zmax)("step",.1)("formControlName",2))},dependencies:[c.BC,c.cb,c.j4,c.JD,c.v8,ee.K,$e],changeDetection:0}),t})(),yt=(()=>{var s;class t{transform(i,o){return no.l.prettyPrint(i)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=e.EJ8({name:"prettyPrint",type:s,pure:!0}),t})();var Qn;function cd(s,t){if(1&s&&(e.j41(0,"option",17),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",e.bMT(2,2,n)," ")}}function pd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-edit-particle-vector",19),e.k0s(),e.j41(3,"app-form-field",20),e.nrm(4,"app-slider",21),e.k0s(),e.j41(5,"app-form-field",22),e.nrm(6,"app-slider",23),e.k0s(),e.j41(7,"app-form-field",24),e.nrm(8,"app-slider",25),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",10)("step",.1),e.R7$(2),e.Y8G("min",0)("max",25),e.R7$(2),e.Y8G("min",0)("max",25))}function dd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function md(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",-180)("max",180),e.R7$(2),e.Y8G("min",-180)("max",180))}function ud(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",-720)("max",720),e.R7$(2),e.Y8G("min",0)("max",720))}function hd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function fd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function gd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",30),e.nrm(2,"app-edit-particle-vector",31),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10))}function bd(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",22),e.nrm(2,"app-slider",23),e.k0s(),e.j41(3,"app-form-field",24),e.nrm(4,"app-slider",25),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",25),e.R7$(2),e.Y8G("min",0)("max",25))}function _d(s,t){1&s&&e.eu8(0)}function Cd(s,t){if(1&s&&(e.qex(0),e.DNE(1,_d,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const n=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",n)}}function vd(s,t){1&s&&e.eu8(0)}function yd(s,t){if(1&s&&(e.qex(0),e.DNE(1,vd,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const n=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",n)}}function kd(s,t){1&s&&e.eu8(0)}function Sd(s,t){if(1&s&&(e.qex(0),e.DNE(1,kd,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const n=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",n)}}function Td(s,t){1&s&&(e.j41(0,"app-form-field",33),e.nrm(1,"app-edit-particle-vector",34),e.k0s(),e.j41(2,"app-form-field",35),e.nrm(3,"app-edit-particle-vector",36),e.k0s(),e.j41(4,"app-form-field",37),e.nrm(5,"app-edit-particle-vector",38),e.k0s()),2&s&&(e.R7$(),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-180)("xmax",180)("ymin",-180)("ymax",180)("zmin",-180)("zmax",180),e.R7$(2),e.Y8G("xmin",0)("xmax",20)("ymin",0)("ymax",20)("zmin",0)("zmax",20))}class cs{constructor(t,n,i,o){this.store=t,this.formBuilder=n,this.portalComponent=i,this.particleSystemsService=o,this.creatorsEnum=xe.Uy,this.creators=Object.values(xe.Uy),this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({id:[""],name:[""],type:[""],directionAverage:[[0,0,0]],forceAverage:[0],directionVariance:[0],forceVariance:[0],average:[0],variance:[0],position:[[0,0,0]],scale:[[0,0,0]],rotate:[[0,0,0]],translate:[[0,0,0]]})}ngOnInit(){this.initFormListeners(),this.initCreatorListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((n,i)=>(0,R.isEqual)(n,i)),(0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{const i=(0,de.xM)(n.type,n);this.updateSystem(i)});const t=this.formGroup.get("type");t.valueChanges.pipe((0,P.Z)(t.value),(0,ta.J)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(([n,i])=>{const o=de.Mj[i],r=(0,de.xM)(n,this.formGroup.value),l=(0,de.xM)(i,{...o,position:r.translate,translate:r.position,...r});this.setValues(l,!1)})}initCreatorListeners(){this.particleCreator$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t,!1)})}setValues(t,n){this.formGroup.patchValue({...t},{emitEvent:n})}handleDuplicateClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleCreator);this.particleSystemsService.duplicateCreator(t,n)}handleResetClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleCreatorIndex);this.particleSystemsService.resetCreator(t,n)}handleRemoveClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleCreatorIndex);this.particleSystemsService.removeCreator(t,n),this.portalComponent.back()}updateSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=this.store.selectSnapshot(O.B.getSelectedParticleCreatorIndex);n.creators[i]=t,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}}(Qn=cs).\u0275fac=function(t){return new(t||Qn)(e.rXU(a.il),e.rXU(c.ze),e.rXU(et),e.rXU(vt.c))},Qn.\u0275cmp=e.VBU({type:Qn,selectors:[["app-edit-particle-creator"]],decls:36,vars:18,consts:[["actionsMenu","matMenu"],["positionGroupTmp",""],["label","Creator"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"value"],["label","Direction Average"],["formControlName","directionAverage",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Direction Variance"],["formControlName","directionVariance",3,"min","max","step"],["label","Force Average"],["formControlName","forceAverage",3,"min","max"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max"],["label","Average"],["formControlName","average",3,"min","max"],["label","Variance"],["formControlName","variance",3,"min","max"],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],[4,"ngTemplateOutlet"],["label","Translate"],["formControlName","translate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Rotate"],["formControlName","rotate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Scale"],["formControlName","scale",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",2)(1,"div",3)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"app-panel",7)(13,"app-form-field",8),e.nrm(14,"input",9),e.k0s(),e.j41(15,"app-form-field",10)(16,"span",11),e.EFF(17),e.nI1(18,"async"),e.k0s()(),e.j41(19,"app-form-field",12)(20,"select",13),e.DNE(21,cd,3,4,"option",14),e.k0s()(),e.qex(22,15),e.DNE(23,pd,9,13,"ng-container",16)(24,dd,5,4,"ng-container",16)(25,md,5,4,"ng-container",16)(26,ud,5,4,"ng-container",16)(27,hd,5,4,"ng-container",16)(28,fd,5,4,"ng-container",16)(29,gd,3,6,"ng-container",16)(30,bd,5,4,"ng-container",16)(31,Cd,2,1,"ng-container",16)(32,yd,2,1,"ng-container",16)(33,Sd,2,1,"ng-container",16)(34,Td,6,18,"ng-template",null,1,e.C5r),e.bVm(),e.k0s()()}if(2&t){let i;const o=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(5),e.JRh(null==(i=e.bMT(18,16,n.particleCreator$))?null:i.id),e.R7$(4),e.Y8G("ngForOf",n.creators),e.R7$(),e.Y8G("ngSwitch",n.formGroup.get("type").value),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.DirectionalVelocity),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.Lifetime),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomRotation),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomRotationSpeed),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomScale),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.SpriteAnimationDuration),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.PointPosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomVelocity),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.SpherePosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.CylinderPosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.CubePosition)}},dependencies:[E.Sq,E.T3,E.ux,E.e1,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,Ie,fo,E.Jj,yt],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleCreator),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],cs.prototype,"particleCreator$",void 0);let xd=(()=>{var s;class t{constructor(i){this.portalComponent=i,this.itemClick=new e.bkB}onClick(){this.itemClick.next(this.portalComponent)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(et))},s.\u0275dir=e.FsC({type:s,selectors:[["","appPortalItem",""]],hostBindings:function(i,o){1&i&&e.bIt("click",function(){return o.onClick()})},outputs:{itemClick:"itemClick"}}),t})();const Ed=[[["","item-actions",""]]],wd=["[item-actions]"];let qn=(()=>{var s;class t{constructor(){this.active=!0,this.itemClick=new e.bkB}ngOnInit(){}handleItemClick(i){this.itemClick.next(i)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-portal-item"]],inputs:{label:"label",active:"active",hint:"hint"},outputs:{itemClick:"itemClick"},ngContentSelectors:wd,decls:4,vars:5,consts:[["appPortalItem","",1,"portal-item",3,"itemClick"],["toggleType","arrow",3,"toggleable","open","active","label","hint"],["panel-actions",""]],template:function(i,o){1&i&&(e.NAR(Ed),e.j41(0,"div",0),e.bIt("itemClick",function(l){return o.handleItemClick(l)}),e.j41(1,"app-panel",1)(2,"div",2),e.SdG(3),e.k0s()()()),2&i&&(e.R7$(),e.Y8G("toggleable",!1)("open",!1)("active",o.active)("label",o.label)("hint",o.hint))},dependencies:[me.g,xd],changeDetection:0}),t})();function Fd(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",18),e.bIt("itemClick",function(){const o=e.eBV(n),r=o.$implicit,l=o.index,p=e.XpG(2);return e.Njj(p.handleItemClicked(r,l))}),e.j41(1,"div",19)(2,"button",20),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,2)(6,"button",8),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleDuplicateClick(o))}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){const o=e.eBV(n),r=o.$implicit,l=o.index,p=e.XpG(2);return e.Njj(p.handleResetClick(r,l))}),e.EFF(9,"Reset"),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){const o=e.eBV(n),r=o.$implicit,l=o.index,p=e.XpG(2);return e.Njj(p.handleRemoveClick(r,l))}),e.EFF(11,"Remove"),e.k0s()()()()}if(2&s){const n=t.$implicit,i=e.sdS(5),o=e.XpG(2);e.Y8G("label",o.getComponentLabel(n))("hint",n.type),e.R7$(2),e.Y8G("matMenuTriggerFor",i)}}function Pd(s,t){if(1&s&&(e.qex(0),e.DNE(1,Fd,12,3,"app-portal-item",17),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngForOf",n.items)}}function Rd(s,t){if(1&s&&(e.j41(0,"div",21),e.EFF(1),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.SpI(" There are no ",n.type,"s in this chapter. ")}}function Md(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleAddClick(o))}),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("disabled",!i.isTypeAvailable(n)),e.R7$(),e.SpI(" ",e.bMT(2,2,n)," ")}}const jd=()=>!0;let ps=(()=>{var s;class t{constructor(i,o){this.dialogService=i,this.particleSystemsService=o,this.types=[],this.items=[],this.isTypeAvailable=jd,this.itemClick=new e.bkB,this.addClick=new e.bkB,this.duplicateClick=new e.bkB,this.removeClick=new e.bkB,this.resetAllClick=new e.bkB,this.resetClick=new e.bkB,this.removeAllClick=new e.bkB,this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleItemClicked(i,o){this.itemClick.next(o)}handleAddClick(i){this.addClick.next(i)}handleDuplicateClick(i){this.duplicateClick.next(i)}handleResetClick(i,o){this.resetClick.next(o)}handleRemoveClick(i,o){this.removeClick.next(o)}handleResetAllClick(){this.dialogService.openConfirmDialog({data:{titleText:`Reset ${this.type}s`,bodyText:`Would you like to reset all ${this.type}s?`}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{i&&this.resetAllClick.next()})}handleRemoveAllClick(){this.dialogService.openConfirmDialog({data:{titleText:`Remove All ${this.type}s`,bodyText:`Would you like to remove all ${this.type}s?`}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{i&&this.removeAllClick.next()})}getComponentLabel(i){let o;return o=i.name?`**${i.name}**\n\n${i.id}`:i.id,o}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(Ve.o),e.rXU(vt.c))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-list"]],inputs:{label:"label",type:"type",types:"types",items:"items",isTypeAvailable:"isTypeAvailable"},outputs:{itemClick:"itemClick",addClick:"addClick",duplicateClick:"duplicateClick",removeClick:"removeClick",resetAllClick:"resetAllClick",resetClick:"resetClick",removeAllClick:"removeAllClick"},decls:23,vars:9,consts:[["actionsMenu","matMenu"],["typesMenu","matMenu"],["itemActionsMenu","matMenu"],[3,"label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"list"],[1,"list__content"],[4,"ngIf"],[1,"flex","flex-col","items-center","my-2"],["class","list__message text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"matMenuTriggerFor"],["icon","angle-down"],["mat-menu-item","",3,"disabled","click",4,"ngFor","ngForOf"],[3,"label","hint","itemClick",4,"ngFor","ngForOf"],[3,"itemClick","label","hint"],["item-actions",""],["app-button","","buttonSize","xs",3,"matMenuTriggerFor"],[1,"list__message","text-xs","text-center","my-4"],["mat-menu-item","",3,"click","disabled"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.EFF(7,"Add New"),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleResetAllClick())}),e.EFF(9,"Reset to defaults"),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleRemoveAllClick())}),e.EFF(11),e.k0s()()(),e.j41(12,"div",9)(13,"div",10),e.DNE(14,Pd,2,1,"ng-container",11),e.j41(15,"div",12),e.DNE(16,Rd,2,1,"div",13),e.j41(17,"button",14),e.EFF(18),e.nrm(19,"app-icon",15),e.k0s()(),e.j41(20,"mat-menu",null,1),e.DNE(22,Md,3,4,"button",16),e.k0s()()()()}if(2&i){const r=e.sdS(5),l=e.sdS(21);e.Y8G("label",o.label),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(4),e.Y8G("matMenuTriggerFor",l),e.R7$(5),e.SpI("Remove all ",o.type,"s"),e.R7$(3),e.Y8G("ngIf",o.items.length>0),e.R7$(2),e.Y8G("ngIf",0===o.items.length),e.R7$(),e.Y8G("matMenuTriggerFor",l),e.R7$(),e.SpI(" Add ",o.type," "),e.R7$(4),e.Y8G("ngForOf",o.types)}},dependencies:[E.Sq,E.bT,$.kk,$.fb,$.Cp,L.Q,Y.R,qn,Ie,yt],styles:[".list[_ngcontent-%COMP%]{height:100%}.list__content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.list__message[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0}),t})();var Hn,na=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},ia=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Id=()=>[];class go{constructor(t,n,i){this.store=t,this.particleSystemsService=n,this.portalComponent=i,this.creatorTypes=Object.values(xe.Uy),this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}selectClick(t){this.selectItem(t),t>-1&&this.portalComponent.loadComponent(cs)}handleAddClick(t){this.createNew(t)}handleDuplicateClick(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.duplicateCreator(n,t)}handleRemoveClick(t){this.delete(t)}handleResetClick(t){this.resetDefault(t)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}selectItem(t){this.store.dispatch(new ae.u.SelectParticleCreator(t))}createNew(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.createNewCreator(n,t)}resetDefault(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetCreator(n,t)}resetDefaults(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetCreators(t)}delete(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);n.creators=n.creators.filter((i,o)=>o!==t),this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n)),this.selectItem(-1)}deleteAll(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.store.dispatch(new ae.u.UpdateParticleSystem(t.id,{...t,creators:[]}))}}(Hn=go).\u0275fac=function(t){return new(t||Hn)(e.rXU(a.il),e.rXU(vt.c),e.rXU(et))},Hn.\u0275cmp=e.VBU({type:Hn,selectors:[["app-edit-particle-creator-list"]],decls:2,vars:5,consts:[["label","Creators","type","creator",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(o){return n.selectClick(o)})("addClick",function(o){return n.handleAddClick(o)})("removeClick",function(o){return n.handleRemoveClick(o)})("duplicateClick",function(o){return n.handleDuplicateClick(o)})("resetClick",function(o){return n.handleResetClick(o)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let i;e.Y8G("types",n.creatorTypes)("items",(null==(i=e.bMT(1,2,n.particleSystem$))?null:i.creators)||e.lJ4(4,Id))}},dependencies:[ps,E.Jj],changeDetection:0}),na([(0,a.l6)(O.B.getSelectedParticleSystemId),ia("design:type",u.c)],go.prototype,"particleSystemId$",void 0),na([(0,a.l6)(O.B.getSelectedParticleSystem),ia("design:type",u.c)],go.prototype,"particleSystem$",void 0);let Nd=(()=>{var s;class t{constructor(i,o){this.formBuilder=i,this.store=o,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.formGroup=this.formBuilder.group({layer:[1],depthMask:[!1],roundPoints:[!1],perspectivePoints:[!1],addAlpha:[!1]}),this.setDefaults(!1)}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setParticleSystem(i)})}initParticleSystemListeners(){this.store.select(O.B.getSelectedParticleSystem).pipe((0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i.properties,!1)})}handleResetClick(){this.setDefaults(!0)}setValues(i,o){this.formGroup.patchValue({...i},{emitEvent:o})}setParticleSystem(i){const r={...this.store.selectSnapshot(O.B.getSelectedParticleSystem),properties:i};this.store.dispatch(new ae.u.UpdateParticleSystem(r.id,r))}setDefaults(i){this.setValues(de.Fq,i)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(a.il))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-properties"]],decls:23,vars:5,consts:[["systemActions","matMenu"],["label","Properties"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[3,"overlapTrigger"],["mat-menu-item","",3,"click"],[1,"text-xs",3,"formGroup"],["label","Layer"],["formControlName","layer",3,"min","max"],["formControlName","depthMask"],["formControlName","roundPoints"],["formControlName","perspectivePoints"],["formControlName","addAlpha"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",5,0)(6,"button",6),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"app-panel",7)(9,"app-form-field",8),e.nrm(10,"app-slider",9),e.k0s(),e.j41(11,"app-form-field")(12,"mat-checkbox",10),e.EFF(13,"Depth Mask"),e.k0s()(),e.j41(14,"app-form-field")(15,"mat-checkbox",11),e.EFF(16,"Round Points"),e.k0s()(),e.j41(17,"app-form-field")(18,"mat-checkbox",12),e.EFF(19,"Perspective Points"),e.k0s()(),e.j41(20,"app-form-field")(21,"mat-checkbox",13),e.EFF(22,"Add Alpha"),e.k0s()()()()}if(2&i){const r=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(2),e.Y8G("overlapTrigger",!0),e.R7$(4),e.Y8G("formGroup",o.formGroup),e.R7$(2),e.Y8G("min",0)("max",1e3)}},dependencies:[c.BC,c.cb,c.j4,c.JD,De.So,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,Ie],changeDetection:0}),t})();var bo=v(65571);let Bd=(()=>{var s;class t extends qe.Z{constructor(){super(...arguments),this.shapeDirectionEnum=xe.zu}ngOnInit(){}}return(s=t).\u0275fac=(()=>{let n;return function(o){return(n||(n=e.xGo(s)))(o||s)}})(),s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-direction-selector"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:7,vars:7,consts:[[3,"formControl"],[3,"value","matTooltip"],[1,"uppercase"]],template:function(i,o){1&i&&(e.j41(0,"mat-button-toggle-group",0)(1,"mat-button-toggle",1)(2,"div",2),e.EFF(3,"In"),e.k0s()(),e.j41(4,"mat-button-toggle",1)(5,"div",2),e.EFF(6,"Out"),e.k0s()()()),2&i&&(e.Y8G("formControl",o.control),e.R7$(),e.Y8G("value",o.shapeDirectionEnum.In)("matTooltip",o.shapeDirectionEnum.In),e.BMQ("aria-label",o.shapeDirectionEnum.In),e.R7$(3),e.Y8G("value",o.shapeDirectionEnum.Out)("matTooltip",o.shapeDirectionEnum.Out),e.BMQ("aria-label",o.shapeDirectionEnum.Out))},dependencies:[c.BC,c.l_,bo.ec,bo.pc,Ce.oV],changeDetection:0}),t})(),Dd=(()=>{var s;class t extends qe.Z{constructor(){super(...arguments),this.shapeTypesEnum=xe.Po}ngOnInit(){}}return(s=t).\u0275fac=(()=>{let n;return function(o){return(n||(n=e.xGo(s)))(o||s)}})(),s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-shape-selector"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:9,vars:13,consts:[[3,"formControl"],[3,"value","matTooltip"],["icon","circle"],["icon","diamond"],["icon","cube"],["icon","rectangle-portrait"]],template:function(i,o){1&i&&(e.j41(0,"mat-button-toggle-group",0)(1,"mat-button-toggle",1),e.nrm(2,"app-icon",2),e.k0s(),e.j41(3,"mat-button-toggle",1),e.nrm(4,"app-icon",3),e.k0s(),e.j41(5,"mat-button-toggle",1),e.nrm(6,"app-icon",4),e.k0s(),e.j41(7,"mat-button-toggle",1),e.nrm(8,"app-icon",5),e.k0s()()),2&i&&(e.Y8G("formControl",o.control),e.R7$(),e.Y8G("value",o.shapeTypesEnum.Sphere)("matTooltip",o.shapeTypesEnum.Sphere),e.BMQ("aria-label",o.shapeTypesEnum.Sphere),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Plane)("matTooltip",o.shapeTypesEnum.Plane),e.BMQ("aria-label",o.shapeTypesEnum.Plane),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Cube)("matTooltip",o.shapeTypesEnum.Cube),e.BMQ("aria-label",o.shapeTypesEnum.Cube),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Cylinder)("matTooltip",o.shapeTypesEnum.Cylinder),e.BMQ("aria-label",o.shapeTypesEnum.Cylinder))},dependencies:[c.BC,c.l_,bo.ec,bo.pc,Ce.oV,Y.R],changeDetection:0}),t})(),oa=(()=>{var s;class t extends qe.n{constructor(i,o){super(),this.formBuilder=i,this.changeRef=o,this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({type:[xe.Po.Cube],scale:[[0,0,0]],rotate:[[0,0,0]],translate:[[0,0,0]],direction:[xe.zu.In]})}ngOnInit(){this.formGroup.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.value=i})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){this.formGroup.patchValue(i),this.changeRef.markForCheck()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-shape"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:11,vars:19,consts:[[3,"formGroup"],["label","Shape Type"],["formControlName","type"],["label","Direction Selector"],["formControlName","direction"],["label","Translate"],["formControlName","translate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Rotate"],["formControlName","rotate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Scale"],["formControlName","scale",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(i,o){1&i&&(e.qex(0,0),e.j41(1,"app-form-field",1),e.nrm(2,"app-edit-particle-shape-selector",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-edit-particle-direction-selector",4),e.k0s(),e.j41(5,"app-form-field",5),e.nrm(6,"app-edit-particle-vector",6),e.k0s(),e.j41(7,"app-form-field",7),e.nrm(8,"app-edit-particle-vector",8),e.k0s(),e.j41(9,"app-form-field",9),e.nrm(10,"app-edit-particle-vector",10),e.k0s(),e.bVm()),2&i&&(e.Y8G("formGroup",o.formGroup),e.R7$(6),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-180)("xmax",180)("ymin",-180)("ymax",180)("zmin",-180)("zmax",180),e.R7$(2),e.Y8G("xmin",0)("xmax",20)("ymin",0)("ymax",20)("zmin",0)("zmax",20))},dependencies:[c.BC,c.cb,c.j4,c.JD,ee.K,Bd,Dd,fo],changeDetection:0}),t})();var Wn;function Od(s,t){if(1&s&&(e.j41(0,"option",15),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",e.bMT(2,2,n)," ")}}function Ad(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",16)(2,"mat-checkbox",17),e.EFF(3,"Trap Shape"),e.k0s()(),e.nrm(4,"app-edit-particle-shape",18),e.bVm())}class ds{get isShapeType(){const{type:t}=this.formGroup.value;return de.qA.includes(t)}constructor(t,n,i,o){this.store=t,this.formBuilder=n,this.portalComponent=i,this.particleSystemsService=o,this.constraintsEnum=xe.lc,this.shapeTypesEnum=xe.Po,this.availableConstraints=Object.values(xe.lc),this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({id:[""],name:[""],type:[""],trap:[!1],shape:[]})}ngOnInit(){this.initFormListeners(),this.initConstraintListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((n,i)=>(0,R.isEqual)(n,i)),(0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{const o=(0,de.qg)(n.type,n);this.updateSystem(o)});const t=this.formGroup.get("type");t.valueChanges.pipe((0,P.Z)(t.value),(0,ta.J)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(([n,i])=>{const o=de.Fg[i],r=(0,de.qg)(n,this.formGroup.value),l=(0,de.qg)(i,{...o,...r});this.setValues(l,!1)})}initConstraintListeners(){this.particleConstraint$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.availableConstraints=Object.values(xe.lc).filter(i=>(0,de.t0)(n,i)),this.setValues(t,!1)})}setValues(t,n){this.formGroup.patchValue({...t},{emitEvent:n})}handleDuplicateClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleConstraint);this.particleSystemsService.duplicateConstraint(t,n)}handleResetClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleConstraintIndex);this.particleSystemsService.resetConstraint(t,n)}handleRemoveClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleConstraintIndex);this.particleSystemsService.removeConstraint(t,n),this.portalComponent.back()}updateSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=this.store.selectSnapshot(O.B.getSelectedParticleConstraintIndex);n.constraints[i]=t,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}}(Wn=ds).\u0275fac=function(t){return new(t||Wn)(e.rXU(a.il),e.rXU(c.ze),e.rXU(et),e.rXU(vt.c))},Wn.\u0275cmp=e.VBU({type:Wn,selectors:[["app-edit-particle-constraint"]],decls:23,vars:7,consts:[["actionsMenu","matMenu"],["label","Constraint"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["label","Trap"],["formControlName","trap",1,"text-xs"],["formControlName","shape"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"app-panel",6)(13,"app-form-field",7),e.nrm(14,"input",8),e.k0s(),e.j41(15,"app-form-field",9)(16,"span",10),e.EFF(17),e.nI1(18,"async"),e.k0s()(),e.j41(19,"app-form-field",11)(20,"select",12),e.DNE(21,Od,3,4,"option",13),e.k0s()(),e.DNE(22,Ad,5,0,"ng-container",14),e.k0s()()}if(2&t){let i;const o=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(5),e.JRh(null==(i=e.bMT(18,5,n.particleConstraint$))?null:i.id),e.R7$(4),e.Y8G("ngForOf",n.availableConstraints),e.R7$(),e.Y8G("ngIf",n.isShapeType)}},dependencies:[E.Sq,E.bT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,De.So,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,me.g,Ie,oa,E.Jj,yt],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleConstraint),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ds.prototype,"particleConstraint$",void 0);var Jn,sa=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},ra=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Ud=()=>[];class _o{constructor(t,n,i){this.store=t,this.particleSystemsService=n,this.portalComponent=i,this.constraintTypes=Object.values(xe.lc),this.isConstraintAvailable=()=>!0,this.isConstraintAvailable=this.checkConstraintAvailable.bind(this)}ngOnInit(){}selectClick(t){this.selectItem(t)}handleAddClick(t){this.createNew(t)}handleDuplicateClick(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.duplicateConstraint(n,t)}handleRemoveClick(t){this.delete(t)}handleResetClick(t){this.resetDefault(t)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}checkConstraintAvailable(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);return(0,de.t0)(n,t)}selectItem(t){this.store.dispatch(new ae.u.SelectParticleConstraint(t)),t>-1&&this.portalComponent.loadComponent(ds)}createNew(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.createNewConstraint(n,t)}resetDefault(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetConstraint(n,t)}resetDefaults(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetConstraints(t)}delete(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);n.constraints=n.constraints.filter((i,o)=>o!==t),this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n)),this.selectItem(-1)}deleteAll(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.store.dispatch(new ae.u.UpdateParticleSystem(t.id,{...t,constraints:[]}))}}var Kn;function Yd(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-panel",14,1)(2,"div",15)(3,"button",5),e.nrm(4,"app-icon",6),e.k0s(),e.j41(5,"mat-menu",null,2)(7,"button",7),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRemovePathNodeClick(o))}),e.EFF(8,"Remove Node"),e.k0s(),e.j41(9,"button",7),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleDuplicatePathNodeClick(o))}),e.EFF(10," Duplicate Node "),e.k0s()()(),e.j41(11,"app-form-field",16),e.nrm(12,"app-edit-particle-vector",17),e.k0s(),e.j41(13,"app-form-field",18),e.nrm(14,"app-slider",19),e.k0s(),e.j41(15,"app-form-field",20),e.nrm(16,"app-slider",21),e.k0s(),e.j41(17,"app-form-field",22),e.nrm(18,"app-slider",23),e.k0s()()}if(2&s){const n=t.$implicit,i=t.index,o=e.sdS(1),r=e.sdS(6),l=e.XpG();e.Y8G("cdkDragDisabled",o.open)("open",!1)("label","Path Node #"+(i+1))("hint",l.formatNodeHint(n))("isCompact",!0)("formGroupName",i),e.R7$(3),e.Y8G("matMenuTriggerFor",r),e.R7$(9),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1)}}function zd(s,t){1&s&&(e.j41(0,"div",24),e.EFF(1," There are no Path Nodes in this updater. "),e.k0s())}(Jn=_o).\u0275fac=function(t){return new(t||Jn)(e.rXU(a.il),e.rXU(vt.c),e.rXU(et))},Jn.\u0275cmp=e.VBU({type:Jn,selectors:[["app-edit-particle-constraint-list"]],decls:2,vars:6,consts:[["label","Constraints","type","constraint",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items","isTypeAvailable"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(o){return n.selectClick(o)})("addClick",function(o){return n.handleAddClick(o)})("removeClick",function(o){return n.handleRemoveClick(o)})("duplicateClick",function(o){return n.handleDuplicateClick(o)})("resetClick",function(o){return n.handleResetClick(o)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let i;e.Y8G("types",n.constraintTypes)("items",(null==(i=e.bMT(1,3,n.particleSystem$))?null:i.constraints)||e.lJ4(5,Ud))("isTypeAvailable",n.isConstraintAvailable)}},dependencies:[ps,E.Jj],changeDetection:0}),sa([(0,a.l6)(O.B.getSelectedParticleSystemId),ra("design:type",u.c)],_o.prototype,"particleSystemId$",void 0),sa([(0,a.l6)(O.B.getSelectedParticleSystem),ra("design:type",u.c)],_o.prototype,"particleSystem$",void 0);const aa={position:[0,0,0],forceAverage:0,radius:0,forceVariance:0};class ms{constructor(t,n,i){this.formBuilder=t,this.store=n,this.dialogService=i,this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({nodes:this.formBuilder.array([])}),this.nodesFormArray=this.formGroup.get("nodes")}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(n)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)})}handleAddPathNodeClick(){this.addPathNode()}handleRemoveAllPathNodesClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Path Nodes",bodyText:`Would you like to remove all ${this.nodesFormArray.length} Path Nodes?`}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t){const n=this.createUpdaterFromValues({nodes:[]});this.updateSystem(n)}})}handleRemovePathNodeClick(t){this.nodesFormArray.removeAt(t)}handleDuplicatePathNodeClick(t){const n=this.createPathNodeFormGroup(t.value);this.nodesFormArray.push(n)}handlePathNodeDropped(t){const{previousIndex:n,currentIndex:i}=t,o=this.formGroup.value,{nodes:r}=o,l=(0,Dt.W)(r,n,i);this.nodesFormArray.clear(),l.forEach(p=>{const T=this.createPathNodeFormGroup(p);this.nodesFormArray.push(T)}),this.formGroup.patchValue({nodes:l})}addPathNode(){const t=this.createPathNodeFormGroup(aa);this.nodesFormArray.push(t)}createPathNodeFormGroup(t){const{position:n,forceAverage:i,radius:o,forceVariance:r}=t;return this.formBuilder.group({position:[n],forceAverage:[i],radius:[o],forceVariance:[r]})}setValues(t){t.type===xe.$t.Path&&typeof t.nodes<"u"&&this.nodesFormArray.length!==t.nodes.length&&(this.nodesFormArray.clear(),t.nodes.forEach(()=>{const n=this.createPathNodeFormGroup(aa);this.nodesFormArray.push(n)})),this.formGroup.patchValue({...t},{emitEvent:!1,onlySelf:!0})}formatNodeHint(t){const n=t.value,{position:i,forceAverage:o,radius:r,forceVariance:l}=n;return`Postition: [${i}], Force Average: ${o}, Radius: ${r}, Force Variance: ${l}`}createUpdaterFromValues(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleUpdater);return(0,de.MH)(n.type,{...n,...t})}updateSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=this.store.selectSnapshot(O.B.getSelectedParticleUpdaterIndex);n.updaters[i]=t,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}}var Zn;function qd(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-panel",13)(1,"div",14)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,1)(6,"button",6),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRemovePathColorClick(o))}),e.EFF(7,"Remove Color"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleDuplicatePathColorClick(o))}),e.EFF(9," Duplicate Color "),e.k0s()()(),e.nrm(10,"app-color-picker-input",15),e.k0s()}if(2&s){const n=t.index,i=e.sdS(5);e.Y8G("toggleable",!1)("label","Color #"+(n+1))("isCompact",!0),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(8),e.Y8G("formControlName",n)("alpha",!0)("decimal",!1)}}function Hd(s,t){1&s&&(e.j41(0,"div",16),e.EFF(1," There are no colors in this updater. "),e.k0s())}(Kn=ms).\u0275fac=function(t){return new(t||Kn)(e.rXU(c.ze),e.rXU(a.il),e.rXU(Ve.o))},Kn.\u0275cmp=e.VBU({type:Kn,selectors:[["app-edit-particle-updater-node"]],decls:19,vars:9,consts:[["pathNodeMenu","matMenu"],["nodePanel",""],["nodeActionsMenu","matMenu"],[3,"formGroup","label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["formArrayName","nodes"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["cdkDrag","","toggleType","arrow",3,"cdkDragDisabled","open","label","hint","isCompact","formGroupName",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","my-2"],["class","text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"click"],["cdkDrag","","toggleType","arrow",3,"cdkDragDisabled","open","label","hint","isCompact","formGroupName"],["panel-actions",""],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Force Average"],["formControlName","forceAverage",3,"min","max","step"],["label","Radius"],["formControlName","radius",3,"min","max","step"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max","step"],[1,"text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleAddPathNodeClick())}),e.EFF(7,"Add Node"),e.k0s(),e.j41(8,"button",7),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveAllPathNodesClick())}),e.EFF(9,"Remove All Nodes"),e.k0s()()(),e.qex(10,8),e.j41(11,"div",9),e.bIt("cdkDropListDropped",function(r){return e.eBV(i),e.Njj(n.handlePathNodeDropped(r))}),e.DNE(12,Yd,19,22,"app-panel",10),e.k0s(),e.j41(13,"div",11),e.DNE(14,zd,2,0,"div",12),e.nI1(15,"async"),e.nI1(16,"async"),e.j41(17,"button",13),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleAddPathNodeClick())}),e.EFF(18,"Add Node"),e.k0s()(),e.bVm(),e.k0s()}if(2&t){let i;const o=e.sdS(5);e.Y8G("formGroup",n.formGroup)("label","Path Nodes"),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(10),e.Y8G("ngForOf",n.nodesFormArray.controls),e.R7$(2),e.Y8G("ngIf",(null==(i=e.bMT(15,5,n.particleUpdater$))?null:i.nodes)&&0===(null==(i=e.bMT(16,7,n.particleUpdater$))?null:i.nodes.length))}},dependencies:[E.Sq,E.bT,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,Ie,fo,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleUpdater),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ms.prototype,"particleUpdater$",void 0);const la=[255,0,0,1];class us{constructor(t,n,i){this.formBuilder=t,this.store=n,this.dialogService=i,this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({colors:this.formBuilder.array([[0,0,0,1],[0,0,0,1],[0,0,0,1]])}),this.colorsFormArray=this.formGroup.get("colors")}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(n)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)})}handleAddPathColorClick(){this.addPathColor()}handleRemoveAllPathColorsClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Colors",bodyText:`Would you like to remove all ${this.colorsFormArray.length} colors?`}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t){const n=this.createUpdaterFromValues({colors:[]});this.updateSystem(n)}})}handleRemovePathColorClick(t){this.colorsFormArray.removeAt(t)}handleDuplicatePathColorClick(t){const n=this.createColorControl(t.value);this.colorsFormArray.push(n)}handlePathColorDropped(t){const{previousIndex:n,currentIndex:i}=t,o=this.formGroup.value,{colors:r}=o,l=(0,Dt.W)(r,n,i);this.colorsFormArray.clear(),l.forEach(p=>{const T=this.createColorControl(p);this.colorsFormArray.push(T)}),this.formGroup.patchValue({colors:l})}addPathColor(){const t=this.createColorControl(la);this.colorsFormArray.push(t)}createColorControl(t){const n=this.formBuilder.control([]);return n.setValue(t),n}setValues(t){let n=(0,R.get)(t,"colors",[]);Array.isArray(n)&&Array.isArray(n)&&(n=this.colorModelToFormColor(n)),this.colorsFormArray.length!==n.length&&(this.colorsFormArray.clear(),n.forEach(()=>{const i=this.createColorControl(la);this.colorsFormArray.push(i)})),this.formGroup.patchValue({colors:n},{emitEvent:!1,onlySelf:!0})}colorModelToFormColor(t){return t.map(([n,i,o,r])=>[n,i,o,r/255])}formColorToColorModel(t){return t.map(([n,i,o,r])=>[n,i,o,255*r])}createUpdaterFromValues(t){const n=t.colors,i=this.store.selectSnapshot(O.B.getSelectedParticleUpdater);return(0,de.MH)(i.type,{...i,colors:this.formColorToColorModel(n)})}updateSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=this.store.selectSnapshot(O.B.getSelectedParticleUpdaterIndex);n.updaters[i]=t,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}}var ei;function Kd(s,t){if(1&s&&(e.j41(0,"option",16),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const n=t.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",e.bMT(2,2,n)," ")}}function Zd(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"app-portal-item",17),e.bIt("itemClick",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleColorsClicked())}),e.k0s(),e.j41(2,"app-panel",18),e.nrm(3,"app-edit-particle-shape",19),e.k0s(),e.bVm()}2&s&&(e.R7$(),e.Y8G("label","Colors"))}function em(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",20),e.nrm(3,"app-slider",21),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",24),e.nrm(7,"app-slider",25),e.k0s()(),e.j41(8,"app-panel",18),e.nrm(9,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function tm(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",26),e.nrm(3,"app-edit-particle-vector",27),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",28),e.nrm(7,"app-slider",29),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",.5),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function nm(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",24),e.nrm(7,"app-slider",25),e.k0s()(),e.j41(8,"app-panel",18),e.nrm(9,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function im(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",32),e.nrm(3,"app-slider",33),e.k0s()(),e.j41(4,"app-panel",18),e.nrm(5,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("min",0)("max",1)("step",.01))}function om(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",34),e.nrm(7,"app-slider",35),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",10)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function sm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",37),e.bIt("itemClick",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handlePathNodesClicked())}),e.k0s()}if(2&s){const n=t.$implicit;e.Y8G("label","Path Nodes")("hint",(n.nodes?n.nodes.length:0)+" Path Nodes")}}function rm(s,t){if(1&s&&(e.qex(0),e.DNE(1,sm,1,2,"app-portal-item",36),e.nI1(2,"async"),e.j41(3,"app-panel",18),e.nrm(4,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,n.particleUpdater$))}}function am(s,t){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",38),e.nrm(5,"app-edit-particle-vector",39),e.k0s(),e.j41(6,"app-form-field",22),e.nrm(7,"app-slider",23),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}(Zn=us).\u0275fac=function(t){return new(t||Zn)(e.rXU(c.ze),e.rXU(a.il),e.rXU(Ve.o))},Zn.\u0275cmp=e.VBU({type:Zn,selectors:[["app-edit-particle-updater-color"]],decls:19,vars:9,consts:[["colorsMenu","matMenu"],["colorActionsMenu","matMenu"],[3,"formGroup","label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["formArrayName","colors"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["cdkDrag","",3,"toggleable","label","isCompact",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","my-2"],["class","text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"click"],["cdkDrag","",3,"toggleable","label","isCompact"],["panel-actions",""],["type","rgba",3,"formControlName","alpha","decimal"],[1,"text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",2)(1,"div",3)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleAddPathColorClick())}),e.EFF(7,"Add Color"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveAllPathColorsClick())}),e.EFF(9,"Remove All Colors"),e.k0s()()(),e.qex(10,7),e.j41(11,"div",8),e.bIt("cdkDropListDropped",function(r){return e.eBV(i),e.Njj(n.handlePathColorDropped(r))}),e.DNE(12,qd,11,7,"app-panel",9),e.k0s(),e.j41(13,"div",10),e.DNE(14,Hd,2,0,"div",11),e.nI1(15,"async"),e.nI1(16,"async"),e.j41(17,"button",12),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleAddPathColorClick())}),e.EFF(18,"Add Color"),e.k0s()(),e.bVm(),e.k0s()}if(2&t){let i;const o=e.sdS(5);e.Y8G("formGroup",n.formGroup)("label","Colors"),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(10),e.Y8G("ngForOf",n.colorsFormArray.controls),e.R7$(2),e.Y8G("ngIf",(null==(i=e.bMT(15,5,n.particleUpdater$))?null:i.colors)&&0===(null==(i=e.bMT(16,7,n.particleUpdater$))?null:i.colors.length))}},dependencies:[E.Sq,E.bT,c.BC,c.cb,c.j4,c.JD,c.v8,te.O7,te.T1,$.kk,$.fb,$.Cp,L.Q,Y.R,me.g,Mt,Ie,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleUpdater),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],us.prototype,"particleUpdater$",void 0);class hs{constructor(t,n,i,o,r){this.store=t,this.formBuilder=n,this.portalComponent=i,this.particleSystemsService=o,this.dialogService=r,this.particleUpdaterEnum=xe.$t,this.updaterTypes=Object.values(xe.$t),this.ngUnsubscribe=new b.B,this.formGroup=this.formBuilder.group({id:[""],type:[""],name:[""],position:[[0,0,0]],direction:[[0,0,0]],friction:0,frequency:0,forceAverage:0,radius:0,forceVariance:0,directionAverage:[[0,0,0]],directionVariance:0,shapeEnabled:[!1],shape:[de.C6]})}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(125),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(t)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)})}handleDuplicateClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleUpdater);this.particleSystemsService.duplicateUpdater(t,n)}handleResetClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleUpdaterIndex);this.particleSystemsService.resetUpdater(t,n)}handleRemoveClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem),n=this.store.selectSnapshot(O.B.getSelectedParticleUpdaterIndex);this.particleSystemsService.removeUpdater(t,n),this.portalComponent.back()}handlePathNodesClicked(){this.portalComponent.loadComponent(ms)}handleColorsClicked(){this.portalComponent.loadComponent(us)}setValues(t){if(this.formGroup){const n="shape"in t&&!(0,R.isNil)(t.shape);this.formGroup.patchValue({...t,shapeEnabled:n},{emitEvent:!1,onlySelf:!0})}}createUpdaterFromValues(t){const{type:n,shapeEnabled:i,shape:o}=t,r=this.store.selectSnapshot(O.B.getSelectedParticleUpdater);return(0,de.MH)(n,{...r,...t,shape:i?o:void 0})}updateSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=this.store.selectSnapshot(O.B.getSelectedParticleUpdaterIndex);n.updaters[i]=t,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}}(ei=hs).\u0275fac=function(t){return new(t||ei)(e.rXU(a.il),e.rXU(c.ze),e.rXU(et),e.rXU(vt.c),e.rXU(Ve.o))},ei.\u0275cmp=e.VBU({type:ei,selectors:[["app-edit-particle-updater"]],decls:32,vars:15,consts:[["actionsMenu","matMenu"],["label","Updater"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"value"],[3,"itemClick","label"],["label","Shape","toggleType","checkbox","formControlName","shapeEnabled"],["formControlName","shape"],["label","Frequency"],["formControlName","frequency",3,"min","max","step"],["label","Force Average"],["formControlName","forceAverage",3,"min","max","step"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max","step"],["label","Direction Average"],["formControlName","directionAverage",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Direction Variance"],["formControlName","directionVariance",3,"min","max","step"],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","friction"],["formControlName","friction",3,"min","max","step"],["label","Radius"],["formControlName","radius",3,"min","max","step"],[3,"label","hint","itemClick",4,"ngIf"],[3,"itemClick","label","hint"],["label","Direction"],["formControlName","direction",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"div",6)(13,"app-panel")(14,"app-form-field",7),e.nrm(15,"input",8),e.k0s(),e.j41(16,"app-form-field",9)(17,"span",10),e.EFF(18),e.nI1(19,"async"),e.k0s()(),e.j41(20,"app-form-field",11)(21,"select",12),e.DNE(22,Kd,3,4,"option",13),e.k0s()()(),e.qex(23,14),e.DNE(24,Zd,4,1,"ng-container",15)(25,em,10,9,"ng-container",15)(26,tm,12,15,"ng-container",15)(27,nm,10,12,"ng-container",15)(28,im,6,3,"ng-container",15)(29,om,12,15,"ng-container",15)(30,rm,5,3,"ng-container",15)(31,am,12,18,"ng-container",15),e.bVm(),e.k0s()()}if(2&t){let i;const o=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(6),e.JRh(null==(i=e.bMT(19,13,n.particleUpdater$))?null:i.id),e.R7$(4),e.Y8G("ngForOf",n.updaterTypes),e.R7$(),e.Y8G("ngSwitch",n.formGroup.get("type").value),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.AgeColorBlend),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.BrownianMotion),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.UniformForce),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.RadialForce),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Friction),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Gravity),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Path),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.AxisForce)}},dependencies:[E.Sq,E.bT,E.ux,E.e1,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,qn,Ie,oa,fo,E.Jj,yt],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleUpdater),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],hs.prototype,"particleUpdater$",void 0);var ti,ca=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},pa=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const lm=()=>[];class Co{constructor(t,n,i,o){this.store=t,this.dialogService=n,this.particleSystemsService=i,this.portalComponent=o,this.updaterTypes=Object.values(xe.$t),this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}selectClick(t){this.selectItem(t),t>-1&&this.portalComponent.loadComponent(hs)}handleRemoveClick(t){this.delete(t)}handleDuplicateClick(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.duplicateUpdater(n,t)}handleAddClick(t){this.createNew(t)}handleResetClick(t){this.resetDefault(t)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}selectItem(t){this.store.dispatch(new ae.u.SelectParticleUpdater(t))}createNew(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.createNewUpdater(n,t)}resetDefault(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetUpdater(n,t)}resetDefaults(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.particleSystemsService.resetUpdaters(t)}delete(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);n.updaters=n.updaters.filter((i,o)=>o!==t),this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n)),this.selectItem(-1)}deleteAll(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.store.dispatch(new ae.u.UpdateParticleSystem(t.id,{...t,updaters:[]}))}}var ni;(ti=Co).\u0275fac=function(t){return new(t||ti)(e.rXU(a.il),e.rXU(Ve.o),e.rXU(vt.c),e.rXU(et))},ti.\u0275cmp=e.VBU({type:ti,selectors:[["app-edit-particle-updater-list"]],decls:2,vars:5,consts:[["label","Updaters","type","updater",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(o){return n.selectClick(o)})("addClick",function(o){return n.handleAddClick(o)})("removeClick",function(o){return n.handleRemoveClick(o)})("duplicateClick",function(o){return n.handleDuplicateClick(o)})("resetClick",function(o){return n.handleResetClick(o)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let i;e.Y8G("types",n.updaterTypes)("items",(null==(i=e.bMT(1,2,n.particleSystem$))?null:i.updaters)||e.lJ4(4,lm))}},dependencies:[ps,E.Jj],changeDetection:0}),ca([(0,a.l6)(O.B.getSelectedParticleSystemId),pa("design:type",u.c)],Co.prototype,"particleSystemId$",void 0),ca([(0,a.l6)(O.B.getSelectedParticleSystem),pa("design:type",u.c)],Co.prototype,"particleSystem$",void 0);class fs{constructor(t,n){this.formBuilder=t,this.store=n,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({numParticles:[0],pointSize:[0],emissionAverage:[0],emissionVariance:[0]}),this.setValues((0,de.Vs)())}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(125),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setParticleSystem(t)})}initParticleSystemListeners(){this.particleSystem$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)})}handleResetClick(){this.reset()}setParticleSystem(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i=(0,de.Ir)({...n,...this.getParticleSystemFromForm(t)});this.store.dispatch(new ae.u.UpdateParticleSystem(i.id,i))}setValues(t){this.form&&this.form.patchValue(t,{emitEvent:!1,onlySelf:!0})}reset(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystemId);this.setValues({...(0,de.Vs)(),id:t})}getParticleSystemFromForm(t){const{numParticles:n,pointSize:i,emissionAverage:o,emissionVariance:r}=t;return{numParticles:n,pointSize:i,emissionAverage:o,emissionVariance:r}}}(ni=fs).\u0275fac=function(t){return new(t||ni)(e.rXU(c.ze),e.rXU(a.il))},ni.\u0275cmp=e.VBU({type:ni,selectors:[["app-edit-particle-system-basic-form"]],decls:17,vars:11,consts:[["actionsMenu","matMenu"],[3,"label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Number of Particles"],["formControlName","numParticles",3,"min","max"],["label","Point Size"],["formControlName","pointSize",3,"min","max"],["label","Emission Average"],["formControlName","emissionAverage",3,"min","max"],["label","Emission Variance"],["formControlName","emissionVariance",3,"min","max"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"app-panel",6)(9,"app-form-field",7),e.nrm(10,"app-slider",8),e.k0s(),e.j41(11,"app-form-field",9),e.nrm(12,"app-slider",10),e.k0s(),e.j41(13,"app-form-field",11),e.nrm(14,"app-slider",12),e.k0s(),e.j41(15,"app-form-field",13),e.nrm(16,"app-slider",14),e.k0s()()()}if(2&t){const i=e.sdS(5);e.Y8G("label","Quantity"),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(6),e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("min",0)("max",1e4),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",0)("max",1e4),e.R7$(2),e.Y8G("min",0)("max",1e4)}},dependencies:[c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,$e,me.g,Ie],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleSystem),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],fs.prototype,"particleSystem$",void 0);let dm=(()=>{var s;class t extends qe.n{constructor(i){super(),this.fb=i,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({id:this.fb.control(void 0),baseColor:this.fb.control(void 0),blendMode:this.fb.control(void 0),baseColorMaps:this.fb.control(void 0),baseColorFresnel:this.fb.control(void 0),opacity:this.fb.control(void 0),opacityMaps:this.fb.control(void 0),opacityFresnel:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(100),(0,j.p)(()=>this.form.valid),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=this.formToMaterial(i);this.writeValue(o)})}setFormValues(i){if(i?.material){const{material:o}=i;this.form.patchValue(o,{emitEvent:!1,onlySelf:!0})}}setDisabledState(i){i?this.form.disable():this.form.enable()}formToMaterial(i){const o={material:{...i,workflow:"unlit",type:"material"}};return(0,R.omitBy)(o,R.isNil)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ok))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-unlit-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:30,vars:17,consts:[[3,"formGroup"],["label","ID"],["type","text","formControlName","id",1,"input"],["label","Base Color"],["type","rgbColor","formControlName","baseColor",3,"decimal"],["label","Blend Mode"],["formControlName","blendMode",1,"input"],["value",""],["value","normal"],["value","add"],["label","Base Color Maps"],["disabled","",1,"input"],["label","Base Color Fresnel"],["label","Opacity"],["formControlName","opacity",3,"min","max","step"],["label","Opacity Maps"],["label","Opacity Fresnel"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"app-form-field",1),e.nrm(2,"input",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-color-picker-input",4),e.k0s(),e.j41(5,"app-form-field",5)(6,"select",6),e.nrm(7,"option",7),e.j41(8,"option",8),e.EFF(9,"Normal"),e.k0s(),e.j41(10,"option",9),e.EFF(11,"Add"),e.k0s()()(),e.j41(12,"app-form-field",10)(13,"textarea",11),e.EFF(14),e.nI1(15,"json"),e.k0s()(),e.j41(16,"app-form-field",12)(17,"textarea",11),e.EFF(18),e.nI1(19,"json"),e.k0s()(),e.j41(20,"app-form-field",13),e.nrm(21,"app-slider",14),e.k0s(),e.j41(22,"app-form-field",15)(23,"textarea",11),e.EFF(24),e.nI1(25,"json"),e.k0s()(),e.j41(26,"app-form-field",16)(27,"textarea",11),e.EFF(28),e.nI1(29,"json"),e.k0s()()()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("decimal",!0),e.R7$(10),e.JRh(e.bMT(15,9,null==o.form.value?null:o.form.value.baseColorMaps)),e.R7$(4),e.JRh(e.bMT(19,11,null==o.form.value?null:o.form.value.baseColorFresnel)),e.R7$(3),e.Y8G("min",0)("max",1)("step",.1),e.R7$(3),e.JRh(e.bMT(25,13,null==o.form.value?null:o.form.value.opacityMaps)),e.R7$(4),e.JRh(e.bMT(29,15,null==o.form.value?null:o.form.value.opacityFresnel)))},dependencies:[c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,ee.K,$e,Mt,E.TG],changeDetection:0}),t})(),mm=(()=>{var s;class t extends qe.n{constructor(i){super(),this.fb=i,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({id:this.fb.control(void 0),baseColor:this.fb.control(void 0),blendMode:this.fb.control(void 0),baseColorMaps:this.fb.control(void 0),baseColorFresnel:this.fb.control(void 0),opacity:this.fb.control(void 0),opacityMaps:this.fb.control(void 0),opacityFresnel:this.fb.control(void 0),emissive:this.fb.control(void 0),emissiveMaps:this.fb.control(void 0),emissiveFresnel:this.fb.control(void 0),ior:this.fb.control(void 0),metallic:this.fb.control(void 0),metallicMaps:this.fb.control(void 0),normalMaps:this.fb.control(void 0),occlusionMaps:this.fb.control(void 0),roughness:this.fb.control(void 0),roughnessMaps:this.fb.control(void 0),specularColor:this.fb.control(void 0),specularColorMaps:this.fb.control(void 0),specularFactor:this.fb.control(void 0),specularFactorMaps:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(100),(0,j.p)(()=>this.form.valid),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=this.formToMaterial(i);this.writeValue(o)})}setFormValues(i){i?.material&&this.form.patchValue(i?.material,{emitEvent:!1,onlySelf:!0})}setDisabledState(i){i?this.form.disable():this.form.enable()}formToMaterial(i){const o={material:{...i,workflow:"physical",type:"material"}};return(0,R.omitBy)(o,R.isNil)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ok))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-physical-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:49,vars:28,consts:[[3,"formGroup"],["label","ID"],["type","text","formControlName","id",1,"input"],["label","Base Color"],["type","rgbColor","formControlName","baseColor",3,"decimal"],["label","Emissive"],["type","rgbColor","formControlName","emissive",3,"decimal"],["label","Emissive Maps"],["disabled","",1,"input"],["label","Emissive Fresnel"],["label","IOR"],["type","number","formControlName","ior",1,"input"],["label","Metallic"],["type","number","formControlName","metallic",1,"input"],["label","Metallic Maps"],["label","Normal maps"],["label","Occlusion Maps"],["label","Roughness"],["type","number","formControlName","roughness",1,"input"],["label","Roughness Maps"],["label","Specular Color"],["type","rgbColor","formControlName","specularColor",3,"decimal"],["label","Specular Color Maps"],["label","Specular Factor"],["type","number","formControlName","specularFactor",1,"input"],["label","Save Factor Maps"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"app-form-field",1),e.nrm(2,"input",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-color-picker-input",4),e.k0s(),e.j41(5,"app-form-field",5),e.nrm(6,"app-color-picker-input",6),e.k0s(),e.j41(7,"app-form-field",7)(8,"textarea",8),e.EFF(9),e.nI1(10,"json"),e.k0s()(),e.j41(11,"app-form-field",9)(12,"textarea",8),e.EFF(13),e.nI1(14,"json"),e.k0s()(),e.j41(15,"app-form-field",10),e.nrm(16,"input",11),e.k0s(),e.j41(17,"app-form-field",12),e.nrm(18,"input",13),e.k0s(),e.j41(19,"app-form-field",14)(20,"textarea",8),e.EFF(21),e.nI1(22,"json"),e.k0s()(),e.j41(23,"app-form-field",15)(24,"textarea",8),e.EFF(25),e.nI1(26,"json"),e.k0s()(),e.j41(27,"app-form-field",16)(28,"textarea",8),e.EFF(29),e.nI1(30,"json"),e.k0s()(),e.j41(31,"app-form-field",17),e.nrm(32,"input",18),e.k0s(),e.j41(33,"app-form-field",19)(34,"textarea",8),e.EFF(35),e.nI1(36,"json"),e.k0s()(),e.j41(37,"app-form-field",20),e.nrm(38,"app-color-picker-input",21),e.k0s(),e.j41(39,"app-form-field",22)(40,"textarea",8),e.EFF(41),e.nI1(42,"json"),e.k0s()(),e.j41(43,"app-form-field",23),e.nrm(44,"input",24),e.k0s(),e.j41(45,"app-form-field",25)(46,"textarea",8),e.EFF(47),e.nI1(48,"json"),e.k0s()()()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("decimal",!0),e.R7$(2),e.Y8G("decimal",!0),e.R7$(3),e.JRh(e.bMT(10,12,null==o.form.value?null:o.form.value.emissiveMaps)),e.R7$(4),e.JRh(e.bMT(14,14,null==o.form.value?null:o.form.value.emissiveFresnel)),e.R7$(8),e.JRh(e.bMT(22,16,null==o.form.value?null:o.form.value.metallicMaps)),e.R7$(4),e.JRh(e.bMT(26,18,null==o.form.value?null:o.form.value.normalMaps)),e.R7$(4),e.JRh(e.bMT(30,20,null==o.form.value?null:o.form.value.occlusionMaps)),e.R7$(6),e.JRh(e.bMT(36,22,null==o.form.value?null:o.form.value.roughnessMaps)),e.R7$(3),e.Y8G("decimal",!0),e.R7$(3),e.JRh(e.bMT(42,24,null==o.form.value?null:o.form.value.specularColorMaps)),e.R7$(6),e.JRh(e.bMT(48,26,null==o.form.value?null:o.form.value.specularFactorMaps)))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,ee.K,Mt,E.TG],changeDetection:0}),t})(),um=(()=>{var s;class t extends qe.n{constructor(i){super(),this.fb=i,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){const{baseColor:i,alpha:o}=de.DT,{r,g:l,b:p}=i;this.form=this.fb.group({material:this.fb.group({color:this.fb.control([r,l,p,o])}),textures:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(100),(0,j.p)(()=>this.form.valid),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=this.formToMaterial(i);this.writeValue(o)})}setFormValues(i){const o=i?this.materialToForm(i):null;this.form.patchValue(o,{emitEvent:!1,onlySelf:!0})}setDisabledState(i){i?this.form.disable():this.form.enable()}formToMaterial(i){const{material:o,textures:r}=i,{color:l}=o,[p,T,B,A]=l;return{material:{baseColor:{r:p,g:T,b:B},alpha:A},textures:r}}materialToForm(i){const{material:o,textures:r}=i,{alpha:l,baseColor:p}=o,{r:T,g:B,b:A}=p;return{material:{color:[T,B,A,l??de.DT.alpha]},textures:r}}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ok))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-legacy-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:3,vars:3,consts:[[3,"formGroup"],["formGroupName","material"],["type","rgba","formControlName","color",3,"decimal","alpha"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.qex(1,1),e.nrm(2,"app-color-picker-input",2),e.bVm(),e.k0s()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("decimal",!0)("alpha",!0))},dependencies:[c.BC,c.cb,c.j4,c.JD,c.$R,Mt],changeDetection:0}),t})();var ii,oi;function gm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleDeleteClick())}),e.EFF(1," Delete Material "),e.k0s()}}function bm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-panel")(1,"button",8),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.createDefaultMaterial())}),e.EFF(2," Create Default Material "),e.k0s()()}}function _m(s,t){1&s&&(e.j41(0,"app-panel",13),e.nrm(1,"app-edit-legacy-material-form",14),e.k0s())}function Cm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(n);const o=e.XpG(4);return e.Njj(o.convertMaterialClick(o.form.value.unlitMaterial))}),e.EFF(1," Convert Material "),e.k0s()}}function vm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(n);const o=e.XpG(4);return e.Njj(o.convertMaterialClick(o.form.value.physicalMaterial))}),e.EFF(1," Convert Material "),e.k0s()}}function ym(s,t){if(1&s&&(e.j41(0,"div",18)(1,"p",19),e.EFF(2,' Note: This material is referenced by a "materialId", the values below are read-only. Click "Convert Materia" to convert to an inline material definition (editable). '),e.k0s(),e.DNE(3,Cm,2,0,"button",20)(4,vm,2,0,"button",20),e.k0s()),2&s){const n=e.XpG(3);e.R7$(3),e.Y8G("ngIf",n.form.value.unlitMaterial),e.R7$(),e.Y8G("ngIf",n.form.value.physicalMaterial)}}function km(s,t){if(1&s&&(e.j41(0,"app-panel",15),e.nrm(1,"input",16),e.DNE(2,ym,5,2,"div",17),e.k0s()),2&s){const n=e.XpG(2);e.R7$(2),e.Y8G("ngIf",n.form.value.unlitMaterial||n.form.value.physicalMaterial)}}function Sm(s,t){1&s&&(e.j41(0,"app-panel",21),e.nrm(1,"app-edit-unlit-material-form",22),e.k0s())}function Tm(s,t){1&s&&(e.j41(0,"app-panel",23),e.nrm(1,"app-edit-physical-material-form",24),e.k0s())}function xm(s,t){if(1&s&&(e.qex(0),e.DNE(1,_m,2,0,"app-panel",9)(2,km,3,1,"app-panel",10)(3,Sm,2,0,"app-panel",11)(4,Tm,2,0,"app-panel",12),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.form.value.legacyMaterial),e.R7$(),e.Y8G("ngIf",n.form.value.materialId),e.R7$(),e.Y8G("ngIf",n.form.value.unlitMaterial),e.R7$(),e.Y8G("ngIf",n.form.value.physicalMaterial)}}class gs{constructor(t,n,i,o,r){this.store=t,this.fb=n,this.changeRef=i,this.engineService=o,this.dialogService=r,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({materialId:this.fb.control(null),legacyMaterial:this.fb.control(null),unlitMaterial:this.fb.control(null),physicalMaterial:this.fb.control(null)})}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(100),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,An.E)(this.particleSystem$),(0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{const{materialId:i,legacyMaterial:o,unlitMaterial:r,physicalMaterial:l}=t,p={...(0,de.EA)(n),...i?{materialId:i}:{...o,...r,...l}};this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,p))})}initParticleSystemListeners(){this.particleSystem$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,M.F)((t,n)=>(0,R.isEqual)(t,n))).subscribe(t=>{(0,xe.bF)(t)?(this.activeMaterialSystem=t,this.setLegacyMaterial(t)):(0,xe.Xr)(t)?(this.activeMaterialSystem=t,this.setMaterialReference(t.materialId)):(0,xe.kC)(t)?(this.activeMaterialSystem=t,this.setParticleMaterial(t.material)):(this.activeMaterialSystem=null,this.setEmptyMaterial()),this.changeRef.markForCheck()})}createDefaultMaterial(){const n={...this.store.selectSnapshot(O.B.getSelectedParticleSystem),material:de.DT};this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n))}handleDeleteClick(){this.dialogService.openConfirmDialog({data:{titleText:"Delete Material",bodyText:"Are you sure you want to delete this material?",confirmText:"Delete",confirmColor:"warn"}}).afterClosed().pipe((0,he.s)(1),(0,An.E)(this.particleSystem$),(0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{if(t){const i=(0,de.EA)(n);this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,i))}})}convertMaterialClick(t){const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem),i={...(0,de.EA)(n),...t};this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,i))}setMaterialReference(t){this.engineService.server.getAsset("material",t).then(n=>{this.setParticleMaterial(n,t),this.changeRef.markForCheck()})}setParticleMaterial(t,n){let i,o;switch(t.workflow){case"physical":o={material:{...t,id:n??t.id}};break;case"unlit":i={material:{...t,id:n??t.id}}}this.form.setValue({materialId:n??null,legacyMaterial:null,unlitMaterial:i??null,physicalMaterial:o??null})}setLegacyMaterial(t){const{material:n,textures:i}=t;this.form.setValue({materialId:null,legacyMaterial:{material:n,textures:i},unlitMaterial:null,physicalMaterial:null})}setEmptyMaterial(){this.form.setValue({materialId:null,legacyMaterial:null,unlitMaterial:null,physicalMaterial:null})}}(ii=gs).\u0275fac=function(t){return new(t||ii)(e.rXU(a.il),e.rXU(c.ok),e.rXU(e.gRc),e.rXU(mn.y),e.rXU(Ve.o))},ii.\u0275cmp=e.VBU({type:ii,selectors:[["app-edit-particle-system-material-form"]],decls:9,vars:6,consts:[["actionsMenu","matMenu"],[3,"label","formGroup"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click",4,"ngIf"],[4,"ngIf"],["mat-menu-item","",3,"click"],["app-button","","buttonTheme","dark","buttonType","outline",1,"w-full",3,"click"],["label","Legacy Material",4,"ngIf"],["label","Material ID",4,"ngIf"],["label","Unlit Material",4,"ngIf"],["label","Physical Material",4,"ngIf"],["label","Legacy Material"],["formControlName","legacyMaterial"],["label","Material ID"],["type","text","formControlName","materialId",1,"input"],["class","my-2",4,"ngIf"],[1,"my-2"],[1,"my-2","text-sm","font-semibold","text-red-700"],["app-button","","buttonTheme","dark","buttonType","outline","class","w-full",3,"click",4,"ngIf"],["label","Unlit Material"],["formControlName","unlitMaterial"],["label","Physical Material"],["formControlName","physicalMaterial"]],template:function(t,n){if(1&t&&(e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0),e.DNE(6,gm,2,0,"button",5),e.k0s()(),e.DNE(7,bm,3,0,"app-panel",6)(8,xm,5,4,"ng-container",6),e.k0s()),2&t){const i=e.sdS(5);e.Y8G("label","Material")("formGroup",n.form),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(4),e.Y8G("ngIf",n.activeMaterialSystem),e.R7$(),e.Y8G("ngIf",!n.activeMaterialSystem),e.R7$(),e.Y8G("ngIf",n.activeMaterialSystem)}},dependencies:[E.bT,c.me,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,Y.R,me.g,Ie,dm,mm,um],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleSystem),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],gs.prototype,"particleSystem$",void 0);const bs=()=>[];function Fm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.loadCreators(o))}),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("label","Creators ("+n.length+")")("hint",i.formatHint(n))}}function Pm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.loadUpdaters(o))}),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("label","Updaters ("+n.length+")")("hint",i.formatHint(n))}}function Rm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.loadConstraints(o))}),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("label","Constraints ("+n.length+")")("hint",i.formatHint(n))}}class _s{constructor(t,n,i,o,r,l,p){this.formBuilder=t,this.store=n,this.actions=i,this.dialogService=o,this.particleSystemsService=r,this.eumPrintPipe=l,this.portalComponent=p,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({name:[""]}),this.setValues((0,de.Vs)())}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(125),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(O.B.getSelectedParticleSystem);t.name!==n.name&&(n.name=t.name,this.store.dispatch(new ae.u.UpdateParticleSystem(n.id,n)))})}initParticleSystemListeners(){this.particleSystem$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t)}),this.actions.pipe((0,a.xi)(ae.u.DuplicateParticleSystemSuccess),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.store.dispatch(new ae.u.SelectParticleSystem(t.id))})}setValues(t){this.form&&this.form.patchValue(t,{emitEvent:!1,onlySelf:!0})}handleDuplicateClick(){this.duplicateParticleSystem()}handleResetClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.dialogService.openConfirmDialog({data:{titleText:"Reset Particle System",bodyText:`Would you like to reset Particle System "${t.id}"?`,confirmText:"Remove"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{n&&this.resetParticleSystem()})}handleRemoveClick(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystem);this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle System",bodyText:`Would you like to remove Particle System "${t.id}" from this chapter?`,confirmText:"Remove"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{n&&this.removeParticleSystem()})}formatHint(t){return t.map(n=>this.eumPrintPipe.transform(n.type)).join(", ")}loadBasic(t){t.loadComponent(fs)}loadMaterial(t){t.loadComponent(gs)}loadSprites(t){t.loadComponent(ls)}loadProperties(t){t.loadComponent(Nd)}loadCreators(t){t.loadComponent(go)}loadConstraints(t){t.loadComponent(_o)}loadUpdaters(t){t.loadComponent(Co)}duplicateParticleSystem(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystemId),n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.duplicateParticleSystem(t,n)}resetParticleSystem(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystemId);this.particleSystemsService.resetParticleSystem(t)}removeParticleSystem(){const t=this.store.selectSnapshot(O.B.getSelectedParticleSystemId),n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.removeChapterParticleSystem(t,n),this.store.dispatch(new ae.u.SelectParticleSystem(null)),this.portalComponent.back()}}var si;function Im(s,t){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Apply Existing "),e.k0s()),2&s){e.XpG();const n=e.sdS(26);e.Y8G("matMenuTriggerFor",n)}}function Nm(s,t){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Duplicate Existing "),e.k0s()),2&s){e.XpG();const n=e.sdS(29);e.Y8G("matMenuTriggerFor",n)}}function Bm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleRemoveAllAssignClick())}),e.EFF(1," Remove All "),e.k0s()}}function Dm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-portal-item",23),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleParticleSystemClick(o))}),e.j41(1,"div",24)(2,"button",25),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleToggleParticleSystemVisible(o))}),e.nrm(3,"app-icon",26),e.k0s(),e.j41(4,"button",27),e.nrm(5,"app-icon",8),e.k0s(),e.j41(6,"mat-menu",null,4)(8,"button",9),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleDuplicateSystemClick(o))}),e.EFF(9,"Duplicate"),e.k0s(),e.j41(10,"button",9),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleResetParticleClick(o))}),e.EFF(11,"Reset"),e.k0s(),e.j41(12,"button",9),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleRemoveAssignClick(o))}),e.EFF(13,"Remove"),e.k0s()()()()}if(2&s){const n=t.$implicit,i=e.sdS(7),o=e.XpG(2);e.Y8G("label",o.getSystemLabel(n))("active",o.isSystemVisible(n)),e.R7$(3),e.Y8G("icon",o.isSystemVisible(n)?"eye":"eye-slash"),e.R7$(),e.Y8G("matMenuTriggerFor",i)}}function Gm(s,t){if(1&s&&(e.qex(0),e.DNE(1,Dm,14,4,"app-portal-item",22),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngForOf",n.assignedParticleSystem)}}function $m(s,t){1&s&&(e.j41(0,"div",28),e.EFF(1," There are no particle systems in this chapter. "),e.k0s())}function Om(s,t){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Apply Existing "),e.k0s()),2&s){e.XpG();const n=e.sdS(26);e.Y8G("matMenuTriggerFor",n)}}function Am(s,t){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Duplicate Existing "),e.k0s()),2&s){e.XpG();const n=e.sdS(29);e.Y8G("matMenuTriggerFor",n)}}function Um(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleApplyParticleClick(o))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit;e.R7$(),e.SpI(" ",n.id," ")}}function Vm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleDuplicacteParticleClick(o))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit;e.R7$(),e.SpI(" ",n.id," ")}}(oi=_s).\u0275fac=function(t){return new(t||oi)(e.rXU(c.ze),e.rXU(a.il),e.rXU(a.En),e.rXU(Ve.o),e.rXU(vt.c),e.rXU(yt),e.rXU(et))},oi.\u0275cmp=e.VBU({type:oi,selectors:[["app-edit-particle-systems-form"]],features:[e.Jv_([yt])],decls:30,vars:17,consts:[["actionsMenu","matMenu"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name","data-test","particleSystemName",1,"input"],["label","ID"],[1,"text-xs"],["label","Quantity",3,"itemClick"],["label","Material",3,"itemClick"],["label","Sprites",3,"itemClick"],["label","Properties",3,"itemClick"],[3,"label","hint","itemClick",4,"ngIf"],[3,"itemClick","label","hint"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column")(1,"div",1)(2,"button",2),e.nrm(3,"app-icon",3),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",4),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",4),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",4),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.qex(12),e.j41(13,"app-panel",5)(14,"app-form-field",6),e.nrm(15,"input",7),e.k0s(),e.j41(16,"app-form-field",8)(17,"span",9),e.EFF(18),e.nI1(19,"async"),e.k0s()()(),e.j41(20,"app-portal-item",10),e.bIt("itemClick",function(r){return e.eBV(i),e.Njj(n.loadBasic(r))}),e.k0s(),e.j41(21,"app-portal-item",11),e.bIt("itemClick",function(r){return e.eBV(i),e.Njj(n.loadMaterial(r))}),e.k0s(),e.j41(22,"app-portal-item",12),e.bIt("itemClick",function(r){return e.eBV(i),e.Njj(n.loadSprites(r))}),e.k0s(),e.j41(23,"app-portal-item",13),e.bIt("itemClick",function(r){return e.eBV(i),e.Njj(n.loadProperties(r))}),e.k0s(),e.DNE(24,Fm,1,2,"app-portal-item",14),e.nI1(25,"async"),e.DNE(26,Pm,1,2,"app-portal-item",14),e.nI1(27,"async"),e.DNE(28,Rm,1,2,"app-portal-item",14),e.nI1(29,"async"),e.bVm(),e.k0s()}if(2&t){let i,o,r,l;const p=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",p),e.R7$(11),e.Y8G("formGroup",n.form),e.R7$(5),e.JRh(null==(i=e.bMT(19,6,n.particleSystem$))?null:i.id),e.R7$(6),e.Y8G("ngIf",(null==(o=e.bMT(25,8,n.particleSystem$))?null:o.creators)||e.lJ4(14,bs)),e.R7$(2),e.Y8G("ngIf",(null==(r=e.bMT(27,10,n.particleSystem$))?null:r.updaters)||e.lJ4(15,bs)),e.R7$(2),e.Y8G("ngIf",(null==(l=e.bMT(29,12,n.particleSystem$))?null:l.constraints)||e.lJ4(16,bs))}},dependencies:[E.bT,c.me,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,me.g,qn,Ie,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getSelectedParticleSystem),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],_s.prototype,"particleSystem$",void 0);class Cs{constructor(t,n,i,o,r,l){this.store=t,this.actions=n,this.changeRef=i,this.particleSystemsService=o,this.dialogService=r,this.portalComponent=l,this.particleSystems=[],this.assignedParticleSystem=[],this.unassignedParticleSystem=[],this.particleSystemSelected=new e.bkB,this.chapterParticles=[],this.ngUnsubscribe=new b.B}ngOnInit(){this.initParticleListListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initParticleListListeners(){const t=this.store.select(O.B.getParticleSystemsList),n=this.store.select(I.N.getSelectedChapterId),i=this.store.select(O.B.getAssignedParticleSystems);(0,m.z)(t,i,n).pipe((0,j.p)(([o,r,l])=>!!l),(0,S.Q)(this.ngUnsubscribe)).subscribe(([o,r,l])=>{const p=r[l]||[];this.particleSystems=o,this.assignedParticleSystem=p.map(T=>o.find(B=>B.id===T)),this.unassignedParticleSystem=o.filter(T=>!p.includes(T.id)),this.changeRef.markForCheck()}),this.actions.pipe((0,a.xi)(ae.u.UnassignParticle),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(O.B.getParticleSystems),r=this.store.selectSnapshot(O.B.getAssignedParticleSystems),l=Object.keys(o),p=Object.values(r).reduce((B,A)=>B.concat(A),[]),T=l.filter(B=>!p.includes(B));T.length>0&&(T.forEach(B=>{this.store.dispatch(new ae.u.DeleteParticleSystem(B))}),this.changeRef.markForCheck())})}handleParticleSystemClick(t){this.particleSystemSelected.emit(t),this.store.dispatch(new ae.u.SelectParticleSystem(t.id)),this.portalComponent.loadComponent(_s)}handleDuplicateSystemClick(t){this.duplicateParticleSystem(t)}handleRemoveAllAssignClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle Systems",bodyText:"Would you like to remove all Particle Systems from this chapter?",confirmText:"Remove All"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.removeAllParticleAssignments()})}handleRemoveAssignClick(t){this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle System",bodyText:`Would you like to remove Particle System "${t.id}" from this chapter?`,confirmText:"Remove"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{n&&this.removeChapterParticleSystem(t.id)})}handleCreateParticleClick(){this.createParticleSystem()}handleApplyParticleClick(t){this.addChapterParticleSystem(t.id)}handleDuplicacteParticleClick(t){this.duplicateParticleSystem(t)}handleResetParticleClick(t){this.dialogService.openConfirmDialog({data:{titleText:"Reset Particle System",bodyText:`Would you like to reset Particle System "${t.id}"?`,confirmText:"Reset"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{n&&this.resetParticleSystem(t)})}handleToggleParticleSystemVisible(t){this.toggleParticleSystemVisible(t)}isSystemVisible(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);return this.particleSystemsService.isParticleSystemVisible(t.id,n)}getSystemLabel(t){let n;return n=t.name?`**${t.name}**\n\n${t.id}`:t.id,n}createParticleSystem(){const t=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.createParticleSystem(t)}resetParticleSystem(t){this.particleSystemsService.resetParticleSystem(t.id)}removeAllParticleAssignments(){const t=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.removeAllChapterParticleSystem(t)}addChapterParticleSystem(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.addChapterParticleSystem(t,n)}removeChapterParticleSystem(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.removeChapterParticleSystem(t,n)}duplicateParticleSystem(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.duplicateParticleSystem(t.id,n)}toggleParticleSystemVisible(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.particleSystemsService.toggleParticleSystemVisible(t.id,n)}}(si=Cs).\u0275fac=function(t){return new(t||si)(e.rXU(a.il),e.rXU(a.En),e.rXU(e.gRc),e.rXU(vt.c),e.rXU(Ve.o),e.rXU(et))},si.\u0275cmp=e.VBU({type:si,selectors:[["app-edit-particle-systems-list"]],outputs:{particleSystemSelected:"particleSystemSelected"},decls:32,vars:13,consts:[["particleListSystemsMenu","matMenu"],["particleCreateSystemsMenu","matMenu"],["applySystemsMenu","matMenu"],["duplicateSystemsMenu","matMenu"],["systemActions","matMenu"],["label","Particle Systems"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngIf"],[1,"list"],[1,"list__content"],[4,"ngIf"],[1,"flex","flex-col","items-center","my-2"],["class","list__message text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline","data-test","addParticleSystemButton",3,"matMenuTriggerFor"],["icon","angle-down"],["mat-menu-item","","data-test","createNewSystem",3,"click"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"matMenuTriggerFor"],["data-test","openParticleOptions",3,"label","active","click",4,"ngFor","ngForOf"],["data-test","openParticleOptions",3,"click","label","active"],["item-actions",""],["app-button","","buttonSize","xs",3,"click"],[3,"icon"],["app-button","","buttonSize","xs",3,"matMenuTriggerFor"],[1,"list__message","text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",5)(1,"div",6)(2,"button",7),e.nrm(3,"app-icon",8),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleCreateParticleClick())}),e.EFF(7,"Create new"),e.k0s(),e.DNE(8,Im,2,1,"button",10)(9,Nm,2,1,"button",10)(10,Bm,2,0,"button",11),e.k0s()(),e.j41(11,"div",12)(12,"div",13),e.DNE(13,Gm,2,1,"ng-container",14),e.j41(14,"div",15),e.DNE(15,$m,2,0,"div",16),e.j41(16,"button",17),e.EFF(17," Add Particle System "),e.nrm(18,"app-icon",18),e.k0s(),e.j41(19,"mat-menu",null,1)(21,"button",19),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleCreateParticleClick())}),e.EFF(22," Create new "),e.k0s(),e.DNE(23,Om,2,1,"button",10)(24,Am,2,1,"button",10),e.k0s()(),e.j41(25,"mat-menu",null,2),e.DNE(27,Um,2,1,"button",20),e.k0s(),e.j41(28,"mat-menu",null,3),e.DNE(30,Vm,2,1,"button",20),e.nI1(31,"async"),e.k0s()()()()}if(2&t){const i=e.sdS(5),o=e.sdS(20);e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(6),e.Y8G("ngIf",n.unassignedParticleSystem.length),e.R7$(),e.Y8G("ngIf",n.particleSystems.length),e.R7$(),e.Y8G("ngIf",n.assignedParticleSystem.length>0),e.R7$(3),e.Y8G("ngIf",n.assignedParticleSystem.length>0),e.R7$(2),e.Y8G("ngIf",0===n.assignedParticleSystem.length),e.R7$(),e.Y8G("matMenuTriggerFor",o),e.R7$(7),e.Y8G("ngIf",n.unassignedParticleSystem.length),e.R7$(),e.Y8G("ngIf",n.particleSystems.length),e.R7$(3),e.Y8G("ngForOf",n.unassignedParticleSystem),e.R7$(3),e.Y8G("ngForOf",e.bMT(31,11,n.particleSystems$))}},dependencies:[E.Sq,E.bT,$.kk,$.fb,$.Cp,L.Q,Y.R,qn,Ie,E.Jj],styles:[".list[_ngcontent-%COMP%]{height:100%}.list__content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.list__message[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(O.B.getParticleSystemsList),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Cs.prototype,"particleSystems$",void 0);class vo{}var yo=v(3266);function Lm(s,t){1&s&&(e.j41(0,"mat-checkbox",6),e.EFF(1,"Moving Forwards"),e.k0s())}function Ym(s,t){1&s&&(e.j41(0,"mat-checkbox",7),e.EFF(1,"Moving Backwards"),e.k0s())}function zm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleShowClick(o.transition))}),e.EFF(1," Preview "),e.k0s()}}function Xm(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleRemovePositionClick())}),e.EFF(1," Remove "),e.k0s()}}function Qm(s,t){if(1&s){const n=e.RV6();e.j41(0,"div")(1,"app-form-field",8),e.nrm(2,"app-color-picker-input",9),e.k0s(),e.j41(3,"app-form-field",10)(4,"div",11),e.nrm(5,"input",12),e.j41(6,"app-button-group")(7,"button",13),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleSecondClick(1))}),e.EFF(8," 1s "),e.k0s(),e.j41(9,"button",14),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleSecondClick(2))}),e.EFF(10," 2s "),e.k0s(),e.j41(11,"button",14),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleSecondClick(3))}),e.EFF(12," 3s "),e.k0s()()()(),e.j41(13,"app-form-field",15)(14,"button",16),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleRecordPositionClick())}),e.EFF(15," Capture Position "),e.k0s(),e.j41(16,"app-button-group",17),e.DNE(17,zm,2,0,"button",18)(18,Xm,2,0,"button",18),e.k0s()()()}if(2&s){const n=e.XpG();e.R7$(7),e.Y8G("uppercase",!1),e.R7$(2),e.Y8G("uppercase",!1),e.R7$(2),e.Y8G("uppercase",!1),e.R7$(6),e.Y8G("ngIf",n.transition.camera),e.R7$(),e.Y8G("ngIf",n.transition.camera)}}let qm=(()=>{var s;class t{get transition(){return this._transition}set transition(i){(0,R.isEqual)(i,this._transition)||(this._transition={...i},this.setFormValues(i),this.transitionChange.emit(this.transition),this.changeDetectorRef.markForCheck())}get settings(){return this._settings}set settings(i){(0,R.isEqual)(i,this._settings)||(this._settings={...this._settings,...i},this.changeDetectorRef.markForCheck())}constructor(i,o,r,l,p){this.formBuilder=i,this.store=o,this.cameraService=r,this.matSnackBar=l,this.changeDetectorRef=p,this._transition=new vo,this.transitionChange=new e.bkB,this._settings={onNext:!0,onPrevious:!0},this.ngUnsubscribe=new b.B;const T=new vo;this.form=this.formBuilder.group({fadeColor:"",duration:0,onNext:T.onNext,onPrevious:T.onPrevious})}ngOnInit(){this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleFormChanges(i))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleShowClick(i){this.store.dispatch(new Et.Ih(i.camera,!0,i.duration))}handleRecordPositionClick(){this.transition={...this.transition,camera:this.cameraService.getCamera()},this.matSnackBar.open("Position captured")}handleRemovePositionClick(){this.transition={...this.transition,camera:null},this.matSnackBar.open("Position removed")}handleFormChanges(i){const o={...this.transition,fadeColor:i.fadeColor,onNext:i.onNext,onPrevious:i.onPrevious,duration:i.duration};this.transition=o}handleSecondClick(i){this.form.patchValue({duration:i})}setFormValues(i){const o={duration:2,fadeColor:"",onNext:!1,onPrevious:!1,...i};this.form.setValue({fadeColor:o.fadeColor,duration:o.duration,onNext:o.onNext,onPrevious:o.onPrevious})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(a.il),e.rXU(yo.j),e.rXU(Le.UG),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-transition-form"]],inputs:{transition:"transition",settings:"settings"},outputs:{transitionChange:"transitionChange"},decls:6,vars:4,consts:[["autocomplete","off",3,"formGroup"],["label","Enable"],[1,"flex","flex-col","text-xs"],["formControlName","onNext","data-test","movingForwardsItem",4,"ngIf"],["formControlName","onPrevious","data-test","movingBackwardsItem",4,"ngIf"],[4,"ngIf"],["formControlName","onNext","data-test","movingForwardsItem"],["formControlName","onPrevious","data-test","movingBackwardsItem"],["label","Fade"],["formControlName","fadeColor","dataTestAttributeVal","transitionColorPicker"],["label","Duration (Seconds)"],[1,"flex"],["type","number","min","0","step",".1","formControlName","duration","required","",1,"w-1/4","mr-2","input"],["app-button","","buttonType","outline","data-test","transitionOneSecondButton",3,"click","uppercase"],["app-button","","buttonType","outline",3,"click","uppercase"],["label","Position"],["app-button","","buttonType","outline","buttonSize","sm","data-test","transitionCapturePosition",1,"w-full","mb-2",3,"click"],["render","block"],["app-button","","buttonType","outline","buttonSize","sm","class","w-full",3,"click",4,"ngIf"],["app-button","","buttonType","outline","buttonSize","sm",1,"w-full",3,"click"]],template:function(i,o){1&i&&(e.j41(0,"form",0)(1,"app-form-field",1)(2,"div",2),e.DNE(3,Lm,2,0,"mat-checkbox",3)(4,Ym,2,0,"mat-checkbox",4),e.k0s()(),e.DNE(5,Qm,19,5,"div",5),e.k0s()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(3),e.Y8G("ngIf",o.settings.onNext),e.R7$(),e.Y8G("ngIf",o.settings.onPrevious),e.R7$(),e.Y8G("ngIf",o.settings.onNext&&o.transition.onNext||o.settings.onPrevious&&o.transition.onPrevious))},dependencies:[E.bT,c.qT,c.me,c.Q0,c.BC,c.cb,c.YS,c.VZ,c.j4,c.JD,De.So,L.Q,un,ee.K,Mt],changeDetection:0}),t})();var ri;const Jm=()=>({onNext:!0,onPrevious:!1}),Km=()=>({onNext:!1,onPrevious:!0});function Zm(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-tabs",2)(1,"app-tab",3)(2,"div",4)(3,"app-edit-transition-form",5),e.bIt("transitionChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleTransitionChange(o,"post"))}),e.k0s()()(),e.j41(4,"app-tab",6)(5,"div",4)(6,"app-edit-transition-form",5),e.bIt("transitionChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleTransitionChange(o,"pre"))}),e.k0s()()()()}if(2&s){const n=e.XpG();e.R7$(3),e.Y8G("settings",e.lJ4(4,Jm))("transition",n.postTransition),e.R7$(3),e.Y8G("settings",e.lJ4(5,Km))("transition",n.preTransition)}}class vs{constructor(t,n){this.changeDetectorRef=t,this.store=n,this.ngUnsubscribe=new b.B}ngOnInit(){this.chapter$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.postTransition=(0,R.get)(t,"transitions.post")||new vo,this.preTransition=(0,R.get)(t,"transitions.pre")||new vo,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTransitionChange(t,n){const i=this.store.selectSnapshot(I.N.getSelectedChapter);this.store.dispatch(new V.sN(i.id,t,n))}}(ri=vs).\u0275fac=function(t){return new(t||ri)(e.rXU(e.gRc),e.rXU(a.il))},ri.\u0275cmp=e.VBU({type:ri,selectors:[["app-edit-transition"]],decls:4,vars:3,consts:[["label","Transitions"],["tabSize","small","tabTheme","dark",4,"ngIf"],["tabSize","small","tabTheme","dark"],["data-test","transitionPostChapter","label","Post-Chapter"],[1,"pt-1"],[3,"transitionChange","settings","transition"],["data-test","transitionPreChapter","label","Pre-Chapter"]],template:function(t,n){1&t&&(e.j41(0,"app-portal-column",0)(1,"app-panel"),e.DNE(2,Zm,7,6,"app-tabs",1),e.nI1(3,"async"),e.k0s()()),2&t&&(e.R7$(2),e.Y8G("ngIf",e.bMT(3,1,n.chapter$)))},dependencies:[E.bT,Pt.j,Rt.O,me.g,Ie,qm,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(I.N.getSelectedChapter),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],vs.prototype,"chapter$",void 0);var ko=v(11724);let eu=(()=>{var s;class t{constructor(i,o){this.formBuilder=i,this.store=o,this.transparencyModes=ko.TransparencyModeEnum,this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({mode:[ko.TransparencyModeEnum.Alpha]})}ngOnInit(){this.store.select(I.N.getSelectedChapterId).pipe((0,Te.T)(()=>this.store.selectSnapshot(I.N.getSelectedChapter)),(0,j.p)(i=>!(0,R.isNil)(i)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setFormValue(i.transparencyMode)}),this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setTransparencyMode(i.mode)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValue(i){this.form.setValue({mode:i},{emitEvent:!1})}setTransparencyMode(i,o=!0){this.store.dispatch(new oe._h(i)),o&&this.setChapterTransparencyMode(i)}setChapterTransparencyMode(i){const o=this.store.selectSnapshot(I.N.getSelectedChapter);this.store.dispatch(new V.Nw(o.id,i))}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(a.il))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-transparency-mode"]],decls:12,vars:6,consts:[["label","Transparency Mode"],[3,"open"],[3,"formGroup"],["formControlName","mode","data-test","transparencyModeSelect",1,"input"],[3,"value"]],template:function(i,o){1&i&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1)(2,"form",2)(3,"select",3)(4,"option",4),e.EFF(5,"Alpha (Default)"),e.k0s(),e.j41(6,"option",4),e.EFF(7,"Improved Alpha"),e.k0s(),e.j41(8,"option",4),e.EFF(9,"Add Alpha"),e.k0s(),e.j41(10,"option",4),e.EFF(11,"Alpha To Coverage"),e.k0s()()()()()),2&i&&(e.R7$(),e.Y8G("open",!0),e.R7$(),e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("value",o.transparencyModes.Alpha),e.R7$(2),e.Y8G("value",o.transparencyModes.ImprovedAlpha),e.R7$(2),e.Y8G("value",o.transparencyModes.AddAlpha),e.R7$(2),e.Y8G("value",o.transparencyModes.AlphaToCoverage))},dependencies:[c.qT,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,me.g,Ie],changeDetection:0}),t})();var Pe=function(s){return s.Blur="blur",s.RadialBlur="radialBlur",s.FXAA="fxaa",s.SSAO="sao",s.DOF="dof",s.GroundShadow="groundShadow",s}(Pe||{});const kt={[Pe.SSAO]:{effect:Pe.SSAO,sampleRadius:1.2,intensity:50,bias:.1,scale:.3,cutoff:0},[Pe.Blur]:{effect:Pe.Blur,blur:.1},[Pe.RadialBlur]:{effect:Pe.RadialBlur,radius:.1,center:[0,0],blur:.25},[Pe.DOF]:{effect:Pe.DOF,focusStart:0,focusEnd:5,blur:.5},[Pe.FXAA]:{effect:Pe.FXAA},[Pe.GroundShadow]:{effect:Pe.GroundShadow,blur:.5,opacity:1,xPos:0,yPos:0,zPos:0,size:10}};function ai(s,t){const n=kt[s],i=Object.keys(n).reduce((o,r)=>{const l=t[r];return typeof l<"u"&&(o[r]=l),o},{});return{effect:s,...n,...i}}const li={"fog.enabled":!1,"fog.density":1,"fog.color":[.96,.96,.96],"fog.start":0,"fog.end":50,"fog.mode":ko.FogModeNumericEnum.Linear,"fog.min":0,"fog.max":.75},tu=se.T.rgbToHex(li["fog.color"],!0);let nu=(()=>{var s;class t{constructor(i,o){this.formBuilder=i,this.store=o,this.fogModes=ko.FogModeNumericEnum,this.ngUnsubscribe=new b.B,this._defaultChapterEffects=[],this._defaultChapterProperties={},this.form=this.formBuilder.group({saoEnabled:!1,blurEnabled:!1,radialBlurEnabled:!1,dofEnabled:!1,fogEnabled:!1,groundShadowEnabled:!1,sao:this.formBuilder.group({...kt.sao}),blur:this.formBuilder.group({...kt.blur}),radialBlur:this.formBuilder.group({...kt.radialBlur,center:this.formBuilder.array([...kt.radialBlur.center])}),dof:this.formBuilder.group({...kt.dof}),fog:this.formBuilder.group({...li,"fog.color":tu}),groundShadow:this.formBuilder.group({...kt.groundShadow})})}ngOnInit(){this.initEvents()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEvents(){this.store.select(I.N.getSelectedChapterId).pipe((0,Te.T)(()=>this.store.selectSnapshot(I.N.getSelectedChapter)),(0,j.p)(i=>!(0,R.isNil)(i)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this._defaultChapterEffects=(i.customData||{postprocess:[]}).postprocess||[],this._defaultChapterProperties=i.properties||{},this.setFormValues(this._defaultChapterEffects,this._defaultChapterProperties)}),this.form.valueChanges.pipe((0,W.B)(100),(0,M.F)(R.isEqual),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleFormChanges(i)})}handleFormChanges(i){const o=this.getEffectFormValues(i),r=this.getFogEffectFormValues(i);this.applyEffects(o,r)}setFormValues(i,o){this.clearEffectsForm(),i.forEach(r=>{this.setEffectFormValues(r,!0)}),this.setFogEffectFormValues(o)}setEffectFormValues(i,o){const r=i.effect;this.form.patchValue({[`${r}Enabled`]:o,[r]:i},{emitEvent:!1})}clearEffectsForm(){Object.values(kt).forEach(i=>{this.setEffectFormValues(i,!1)}),this.setFogEffectFormValues({...li,"fog.enabled":!1})}getEffectFormValues(i){const o=[],{saoEnabled:r,blurEnabled:l,radialBlurEnabled:p,dofEnabled:T,groundShadowEnabled:B}=i,{sao:A,blur:H,radialBlur:ge,dof:Se,groundShadow:We}=i;return r&&o.push(ai(Pe.SSAO,A)),l&&o.push(ai(Pe.Blur,H)),p&&o.push(ai(Pe.RadialBlur,ge)),T&&o.push(ai(Pe.DOF,Se)),B&&o.push(ai(Pe.GroundShadow,We)),o.length>0&&o.push(kt.fxaa),o}setFogEffectFormValues(i){const o=this.createFogEffect(i),r=o["fog.enabled"],p=se.T.rgbToHex(o["fog.color"],!0);this.form.patchValue({fogEnabled:r,fog:{...o,"fog.color":p}},{emitEvent:!1})}getFogEffectFormValues(i){const{fogEnabled:o,fog:r}=i;return{...this.createFogEffect(r),"fog.enabled":o}}applyEffects(i,o){const r={...o};this.store.dispatch(new oe.uM(i)),this.store.dispatch(new oe.YI(r));const l=this.store.selectSnapshot(I.N.getSelectedChapter);this.store.dispatch(new V.rT(l.id,i,r))}createFogEffect(i){const o=Object.entries(li).reduce((l,[p,T])=>{const B=i[p];return(0,R.isNil)(B)||(l[p]=B),l},{...li}),r=i["fog.color"];return!(0,R.isNil)(r)&&"string"==typeof r&&(o["fog.color"]=se.T.hexToRgb(r,!0)),o}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(a.il))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-post-processing"]],decls:35,vars:34,consts:[["label","PostProcessing",3,"formGroup"],["label","Blur","toggleType","checkbox","formControlName","blurEnabled","formGroupName","blur","data-test","postProcessingBlur"],["label","Blur"],["formControlName","blur","data-test","postProcessingBlurInput",3,"min","max","step"],["label","Radial Blur","toggleType","checkbox","formControlName","radialBlurEnabled","formGroupName","radialBlur","data-test","postProcessingRadialBlur"],["label","Radius"],["formControlName","radius","data-test","postProcessingRadialBlurRadius",3,"min","max","step"],["formArrayName","center"],["label","Center X"],["formControlName","0","data-test","postProcessingRadialBlurCenterX",3,"min","max","step"],["label","Center Y"],["formControlName","1","data-test","postProcessingRadialBlurCenterY",3,"min","max","step"],["formControlName","blur","data-test","postProcessingRadialBlurInput",3,"min","max","step"],["label","Fog","toggleType","checkbox","formControlName","fogEnabled","formGroupName","fog","dataTestAttributeVal","fogPanel","data-test","postProcessingFog"],["label","Mode"],["formControlName","fog.mode","data-test","postProcessingFogMode",1,"input"],[3,"ngValue"],["label","Color"],["formControlName","fog.color","dataTestAttributeVal","fogColor"],["label","Density"],["formControlName","fog.density","data-test","postProcessingFogDensity",3,"min","max","step"],["label","Start"],["formControlName","fog.start","data-test","postProcessingFogStart",3,"min","max","step"],["label","End"],["formControlName","fog.end","data-test","postProcessingFogEnd",3,"min","max","step"],["label","Min"],["formControlName","fog.min","data-test","postProcessingFogMin",3,"min","max","step"],["label","Max"],["formControlName","fog.max","data-test","postProcessingFogMax",3,"min","max","step"]],template:function(i,o){1&i&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1)(2,"app-form-field",2),e.nrm(3,"app-slider",3),e.k0s()(),e.j41(4,"app-panel",4)(5,"app-form-field",5),e.nrm(6,"app-slider",6),e.k0s(),e.j41(7,"div",7)(8,"app-form-field",8),e.nrm(9,"app-slider",9),e.k0s(),e.j41(10,"app-form-field",10),e.nrm(11,"app-slider",11),e.k0s()(),e.j41(12,"app-form-field",2),e.nrm(13,"app-slider",12),e.k0s()(),e.j41(14,"app-panel",13)(15,"app-form-field",14)(16,"select",15)(17,"option",16),e.EFF(18,"Linear"),e.k0s(),e.j41(19,"option",16),e.EFF(20,"Exponential (v1)"),e.k0s(),e.j41(21,"option",16),e.EFF(22,"Exponential (v2)"),e.k0s()()(),e.j41(23,"app-form-field",17),e.nrm(24,"app-color-picker-input",18),e.k0s(),e.j41(25,"app-form-field",19),e.nrm(26,"app-slider",20),e.k0s(),e.j41(27,"app-form-field",21),e.nrm(28,"app-slider",22),e.k0s(),e.j41(29,"app-form-field",23),e.nrm(30,"app-slider",24),e.k0s(),e.j41(31,"app-form-field",25),e.nrm(32,"app-slider",26),e.k0s(),e.j41(33,"app-form-field",27),e.nrm(34,"app-slider",28),e.k0s()()()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(3),e.Y8G("min",0)("max",.25)("step",.01),e.R7$(3),e.Y8G("min",0)("max",2)("step",.1),e.R7$(3),e.Y8G("min",-1)("max",1)("step",.1),e.R7$(2),e.Y8G("min",-1)("max",1)("step",.1),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(4),e.Y8G("ngValue",o.fogModes.Linear),e.R7$(2),e.Y8G("ngValue",o.fogModes.Exponential),e.R7$(2),e.Y8G("ngValue",o.fogModes.ExponentialSquared),e.R7$(5),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01))},dependencies:[c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,ee.K,$e,me.g,Mt,Ie],changeDetection:0}),t})();var ci,iu=v(53799);function ru(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"app-panel",3)(2,"app-form-field",4)(3,"app-slider",5),e.bIt("mouseUp",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleEndInteraction())})("blurred",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleEndInteraction())}),e.k0s()(),e.j41(4,"app-form-field",6)(5,"app-slider",7),e.bIt("mouseUp",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleEndInteraction())})("blurred",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleEndInteraction())}),e.k0s()()(),e.bVm()}if(2&s){const n=t.$implicit;e.R7$(),e.FS9("label",n.label),e.FS9("formGroupName",n.formGroupName),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",5)("step",.01)}}class ys{constructor(t,n,i){this.formBuilder=t,this.store=n,this.changeDetectorRef=i,this.clipDirections=[{label:"Left",formGroupName:"left"},{label:"Right",formGroupName:"right"},{label:"Top",formGroupName:"top"},{label:"Bottom",formGroupName:"bottom"},{label:"Front",formGroupName:"front"},{label:"Back",formGroupName:"back"}],this.ngUnsubscribe=new b.B}ngOnInit(){this.initForm(),this.initFormListeners(),this.initClippingPlanesListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleEndInteraction(){this.handleFormChangeEvent(this.form.value,!0)}initForm(){const t=this.store.selectSnapshot(I.N.getSelectedChapterClippingPlanes),n=this.createFormFromClips(t),i={};Object.entries(n.clippingPlanes).map(([o,r])=>{i[o]=this.formBuilder.group(r)}),this.form=this.formBuilder.group({clippingPlanesEnabled:n.clippingPlanesEnabled,clippingPlanes:this.formBuilder.group(i)})}initFormListeners(){this.form.valueChanges.pipe((0,M.F)(R.isEqual),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=this.store.selectSnapshot(I.N.getSelectedChapterClippingPlanes).enabled!==t.clippingPlanesEnabled;this.handleFormChangeEvent(t,i)})}initClippingPlanesListeners(){this.clippingPlanes$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,M.F)(R.isEqual),(0,Zi.Z)(50),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.form.setValue(this.createFormFromClips(t),{emitEvent:!1}),this.changeDetectorRef.markForCheck()})}handleFormChangeEvent(t,n){const i=this.store.selectSnapshot(I.N.getSelectedChapterId),o=this.createClipsFromForm(t);this.store.dispatch(new V.Ej(i,o,t.clippingPlanesEnabled,n))}createFormFromClips(t){const{enabled:n,clips:i}=t;return{clippingPlanesEnabled:n,clippingPlanes:Object.entries(i).reduce((r,[l,p])=>(r[l]={progress:p.progress,fadeDistance:p.fadeDistance},r),{})}}createClipsFromForm(t){const{clippingPlanesEnabled:n,clippingPlanes:i}=t;return Object.entries(i).reduce((o,[r,l])=>{const p=n&&l.progress>0,T=n&&l.fadeDistance>0,B=iu.A[r];return o[r]={...l,clipId:B,enabled:p,fade:T},o},{})}}(ci=ys).\u0275fac=function(t){return new(t||ci)(e.rXU(c.ze),e.rXU(a.il),e.rXU(e.gRc))},ci.\u0275cmp=e.VBU({type:ci,selectors:[["app-edit-clipping-planes"]],decls:3,vars:2,consts:[["label","Clipping Planes",3,"formGroup"],["label","Enabled","toggleType","checkbox","formControlName","clippingPlanesEnabled","formGroupName","clippingPlanes","data-test","clippingPlanesEnabledPanel"],[4,"ngFor","ngForOf"],["toggleType","none",3,"label","formGroupName"],["label","Progress"],["formControlName","progress",3,"mouseUp","blurred","min","max","step"],["label","Fade Distance"],["formControlName","fadeDistance",3,"mouseUp","blurred","min","max","step"]],template:function(t,n){1&t&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1),e.DNE(2,ru,6,8,"ng-container",2),e.k0s()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("ngForOf",n.clipDirections))},dependencies:[E.Sq,c.BC,c.cb,c.j4,c.JD,c.$R,ee.K,$e,me.g,Ie],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(I.N.getSelectedChapterClippingPlanes),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ys.prototype,"clippingPlanes$",void 0);const ks={"camera.optics.near":.1,"camera.optics.far":5e3,"camera.optics.fov":55,"camera.zoomLimits":{max:300,min:.01}};var pi;function cu(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleResetClick([o]))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.R7$(),e.SpI(" ",i.propertyLabels[n]," ")}}function pu(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleApplyAllClick([o]))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.R7$(),e.SpI(" ",i.propertyLabels[n]," ")}}function du(s,t){if(1&s&&(e.j41(0,"app-list-item")(1,"div",19),e.EFF(2),e.k0s(),e.j41(3,"div",20),e.EFF(4),e.nI1(5,"json"),e.k0s()()),2&s){const n=t.$implicit;e.R7$(2),e.JRh(n.key),e.R7$(2),e.JRh(e.bMT(5,2,n.value))}}const mu={"camera.optics.fov":"Field of View","camera.zoomLimits":"Zoom Limits","camera.zoomLimits.min":"Zoom Limits (Min)","camera.zoomLimits.max":"Zoom Limits (Max)"};class Ss{constructor(t,n,i,o){this.store=t,this.formBuilder=n,this.engineService=i,this.changeRef=o,this.propertyLabels=mu,this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({properties:this.formBuilder.group({"camera.optics.fov":[null],"camera.zoomLimits":this.formBuilder.group({max:[null],min:[null]})})});const r=this.form.get("properties");this.cameraProperties=Object.keys(r.controls),this.form.patchValue({properties:{...ks}})}ngOnInit(){this.initFormListeners(),this.initChapterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(125),(0,S.Q)(this.ngUnsubscribe)).subscribe(({properties:t})=>{const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.engineService.setProperties(t);const i=this.getMinimumProperties(t,ks);this.store.dispatch(new V.R([n],i))})}initChapterListeners(){this.selectedChapter$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,M.F)((t,n)=>(0,R.isEqual)(t.properties,n.properties)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.properties??{},o=Object.keys(this.form.value.properties);this.extraProperties=(0,R.pickBy)(n,(r,l)=>!o.includes(l)),this.form.patchValue({properties:n},{emitEvent:!1}),this.changeRef.markForCheck()})}handleEndInteraction(){}handleResetClick(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId),i=this.getPropertiesBySource(t,ks);this.form.patchValue({properties:i}),this.store.dispatch(new V.X_([n],t))}handleApplyAllClick(t){const i=this.store.selectSnapshot(I.N.getSelectedChapter).properties??{},o=this.getPropertiesBySource(t,i),r=this.store.selectSnapshot(I.N.getStoryChapters).map(l=>l.id);this.store.dispatch(new V.R(r,o))}getMinimumProperties(t,n){return Object.entries(t).reduce((i,[o,r])=>((0,R.isEqual)(r,n[o])||(i[o]=r),i),{})}getPropertiesBySource(t,n){return t.reduce((i,o)=>(n?.[o]&&(i[o]=n[o]),i),{})}}(pi=Ss).\u0275fac=function(t){return new(t||pi)(e.rXU(a.il),e.rXU(c.ze),e.rXU(mn.y),e.rXU(e.gRc))},pi.\u0275cmp=e.VBU({type:pi,selectors:[["app-edit-chapter-properties"]],decls:32,vars:21,consts:[["propActionsMenu","matMenu"],["resetMenu","matMenu"],["applyMenu","matMenu"],["label","Properties",3,"formGroup"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["label","Camera Properties","formGroupName","properties"],[3,"label"],["formControlName","camera.optics.fov","data-test","propertiesCameraFOV",3,"mouseUp","blurred","min","max","step"],["formGroupName","camera.zoomLimits"],["formControlName","min","data-test","propertiesCameraMin",3,"mouseUp","blurred","min","max","step"],["formControlName","max","data-test","propertiesCameraMax",3,"mouseUp","blurred","min","max","step"],["label","Additional Properties"],["listType","flat",1,"text-xs"],[4,"ngFor","ngForOf"],[1,"font-semibold"],[1,"font-light"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.EFF(7,"Reset Defaults"),e.k0s(),e.j41(8,"button",7),e.EFF(9,"Apply to all chapters"),e.k0s()(),e.j41(10,"mat-menu",null,1)(12,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetClick(n.cameraProperties))}),e.EFF(13," All Camera Properties "),e.k0s(),e.DNE(14,cu,2,1,"button",9),e.k0s(),e.j41(15,"mat-menu",null,2)(17,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleApplyAllClick(n.cameraProperties))}),e.EFF(18," All Camera Properties "),e.k0s(),e.DNE(19,pu,2,1,"button",9),e.k0s()(),e.j41(20,"app-panel",10)(21,"app-form-field",11)(22,"app-slider",12),e.bIt("mouseUp",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.qex(23,13),e.j41(24,"app-form-field",11)(25,"app-slider",14),e.bIt("mouseUp",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.j41(26,"app-form-field",11)(27,"app-slider",15),e.bIt("mouseUp",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(i),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.bVm(),e.k0s(),e.j41(28,"app-panel",16)(29,"app-list",17),e.DNE(30,du,6,4,"app-list-item",18),e.nI1(31,"keyvalue"),e.k0s()()()}if(2&t){const i=e.sdS(5),o=e.sdS(11),r=e.sdS(16);e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(4),e.Y8G("matMenuTriggerFor",o),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(6),e.Y8G("ngForOf",n.cameraProperties),e.R7$(5),e.Y8G("ngForOf",n.cameraProperties),e.R7$(2),e.Y8G("label",n.propertyLabels["camera.optics.fov"]),e.R7$(),e.Y8G("min",20)("max",75)("step",5),e.R7$(2),e.Y8G("label",n.propertyLabels["camera.zoomLimits.min"]),e.R7$(),e.Y8G("min",5)("max",10)("step",.25),e.R7$(),e.Y8G("label",n.propertyLabels["camera.zoomLimits.max"]),e.R7$(),e.Y8G("min",10)("max",350)("step",10),e.R7$(3),e.Y8G("ngForOf",e.bMT(31,19,n.extraProperties))}},dependencies:[E.Sq,c.BC,c.cb,c.j4,c.JD,c.$R,$.kk,$.fb,$.Cp,L.Q,ee.K,Y.R,Ji.s,Ki.P,$e,me.g,Ie,E.TG,E.lG],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(I.N.getSelectedChapter),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Ss.prototype,"selectedChapter$",void 0);var di,Ts=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},xs=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function uu(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"app-portal",null,0)(3,"app-portal-item",3),e.nI1(4,"async"),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleTransitionClick(o))}),e.k0s(),e.j41(5,"app-portal-item",4),e.nI1(6,"async"),e.nI1(7,"prettyPrint"),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleTransparencyClick(o))}),e.k0s(),e.j41(8,"app-portal-item",5),e.nI1(9,"async"),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEffectsClick(o))}),e.k0s(),e.j41(10,"app-portal-item",6),e.nI1(11,"async"),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleClippingPlanesClick(o))}),e.k0s(),e.j41(12,"app-portal-item",7),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleParticlesClick(o))}),e.k0s(),e.j41(13,"app-portal-item",8),e.nI1(14,"async"),e.bIt("itemClick",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handlePropertiesClick(o))}),e.k0s()(),e.bVm()}if(2&s){let n;const i=e.XpG();e.R7$(3),e.Y8G("hint",i.getTransitionsHint(e.bMT(4,6,i.selectedChapter$))),e.R7$(2),e.Y8G("hint",e.bMT(7,10,null==(n=e.bMT(6,8,i.selectedChapter$))?null:n.transparencyMode)),e.R7$(3),e.Y8G("hint",i.getLookEffectsHint(e.bMT(9,12,i.selectedChapter$))),e.R7$(2),e.Y8G("hint",i.getClippingPlanesHint(e.bMT(11,14,i.clippingPlanes$))),e.R7$(2),e.Y8G("hint",i.getParticlesHint(i.chapterParticleSystems)),e.R7$(),e.Y8G("hint",i.getPropertiesHint(e.bMT(14,16,i.selectedChapter$)))}}function hu(s,t){1&s&&(e.j41(0,"app-column",9)(1,"app-column-group"),e.qex(2,10)(3),e.j41(4,"div",11),e.nrm(5,"img",12),e.EFF(6," Welcome to Human Studio! "),e.nrm(7,"br"),e.EFF(8,"Select a tool to get started. "),e.k0s(),e.bVm()(),e.k0s()()),2&s&&e.Y8G("showHeader",!1)}class mi{get chapterParticleSystems(){const t=this.store.selectSnapshot(I.N.getSelectedChapterId);return this.store.selectSnapshot(O.B.particleSystemsForChapter(t))}constructor(t,n){this.store=t,this.enumPrintPipe=n,this.application=Me.c,this.ngUnsubscribe=new b.B}ngOnInit(){}ngAfterViewInit(){this.initContentRefresh()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initContentRefresh(){const t=this.portals.first;t&&this.selectedChapterId$.pipe((0,M.F)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{t.exit()})}handleTransitionClick(t){t.loadComponent(vs)}handleTransparencyClick(t){t.loadComponent(eu)}handleEffectsClick(t){t.loadComponent(nu)}handleClippingPlanesClick(t){t.loadComponent(ys)}handleParticlesClick(t){t.loadComponent(Cs)}handlePropertiesClick(t){t.loadComponent(Ss)}getTransitionsHint(t){const n=(0,R.get)(t,"transitions.post"),o=[];return(0,R.get)(t,"transitions.pre")&&o.push("Pre Transition"),n&&o.push("Post Transition"),this.formatHint(o)}getLookEffectsHint(t){const n=t?.customData?.postprocess??[],i=t?.properties??{},o=n.map(r=>r.effect);return!0===i["fog.enabled"]&&o.push("fog"),this.formatHint(o)}getClippingPlanesHint(t){return this.formatHint(Object.keys((t||{clips:{}}).clips))}getParticlesHint(t){return this.formatHint(t.map(n=>n.id))}getPropertiesHint(t){return Object.keys(t?.properties??{}).join(", ")}formatHint(t){return t.map(n=>this.enumPrintPipe.transform(n)).join(", ")}}(di=mi).\u0275fac=function(t){return new(t||di)(e.rXU(a.il),e.rXU(yt))},di.\u0275cmp=e.VBU({type:di,selectors:[["app-edit-document-context"]],viewQuery:function(t,n){if(1&t&&e.GBs(et,5),2&t){let i;e.mGM(i=e.lsd())&&(n.portals=i)}},features:[e.Jv_([yt])],decls:2,vars:2,consts:[["portal",""],[4,"appFlagApplication"],[3,"showHeader",4,"appFlagApplication"],["label","Transitions","data-test","loftTransitions",3,"itemClick","hint"],["label","Transparency Mode","data-test","loftTransparencyMode",3,"itemClick","hint"],["label","Post Processing","data-test","loftPostProcessing",3,"itemClick","hint"],["label","Clipping Planes","data-test","loftClippingPlanes",3,"itemClick","hint"],["label","Particle Systems","data-test","loftParticles",3,"itemClick","hint"],["label","Properties","data-test","loftProperties",3,"itemClick","hint"],[3,"showHeader"],["column-group-body",""],[1,"context","text-sm"],["src","/assets/images/logo-blue.svg",1,"context__logo"]],template:function(t,n){1&t&&e.DNE(0,uu,15,18,"ng-container",1)(1,hu,9,1,"app-column",2),2&t&&(e.Y8G("appFlagApplication",n.application.Loft),e.R7$(),e.Y8G("appFlagApplication",n.application.Studio))},dependencies:[mt,st,Mn.Y,et,qn,E.Jj,yt],styles:["a[_ngcontent-%COMP%]{color:#96a8c080}.column[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.context[_ngcontent-%COMP%]{height:100%;flex-direction:column;display:flex;justify-content:center;padding:16px;text-align:center;color:#96a8c080}.context__logo[_ngcontent-%COMP%]{width:40px;display:block;margin:20px auto;opacity:.3}"],changeDetection:0}),Ts([(0,a.l6)(I.N.getSelectedChapterId),xs("design:type",u.c)],mi.prototype,"selectedChapterId$",void 0),Ts([(0,a.l6)(I.N.getSelectedChapter),xs("design:type",u.c)],mi.prototype,"selectedChapter$",void 0),Ts([(0,a.l6)(I.N.getSelectedChapterClippingPlanes),xs("design:type",u.c)],mi.prototype,"clippingPlanes$",void 0);var fu=v(78674);let gu=(()=>{var s;class t{constructor(i,o){this.previousRouteService=i,this.router=o,this.url=""}ngOnInit(){this.url=this.previousRouteService.getPreviousUrl()}exit(){switch(!0){case this.url.startsWith("/explore"):case this.url.startsWith("/results/"):case this.url.startsWith("/view"):this.router.navigateByUrl(this.url);break;default:this.router.navigateByUrl("/results/bookmarks")}}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(fu.g),e.rXU(C.Ix))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-exit"]],decls:2,vars:0,consts:[["app-button","","buttonType","outline","buttonSize","sm","buttonShape","square","compact","true","type","button","matTooltip","Exit","aria-label","Exit",3,"click"],["icon","right-from-bracket"]],template:function(i,o){1&i&&(e.j41(0,"button",0),e.bIt("click",function(){return o.exit()}),e.nrm(1,"app-icon",1),e.k0s())},dependencies:[Ce.oV,L.Q,Y.R],changeDetection:0}),t})();var da=v(76872),ma=v(24151),ua=v(79817),ha=v(90908),bu=v(69568),zt=function(s){return s.Object="object",s.Position="position",s}(zt||{}),fa=v(49746),So=v(95370),ga=v(16124),_u=v(26513);function Cu(s,t){1&s&&(e.j41(0,"app-form-field",56),e.nrm(1,"input",57),e.k0s())}function vu(s,t){if(1&s&&(e.j41(0,"app-form-field",58),e.nrm(1,"app-rich-text-edit",59,3)(3,"app-character-counter",18),e.k0s()),2&s){const n=e.sdS(2);e.R7$(),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",n)}}function yu(s,t){if(1&s&&(e.j41(0,"app-form-field",60)(1,"select",61)(2,"option",34),e.EFF(3,"Alphabetical"),e.k0s(),e.j41(4,"option",34),e.EFF(5,"Numerical"),e.k0s()()()),2&s){const n=e.XpG();e.R7$(2),e.Y8G("value",n.labelSequentialType.Alphabetical),e.R7$(2),e.Y8G("value",n.labelSequentialType.Numerical)}}function ku(s,t){1&s&&(e.j41(0,"div")(1,"mat-checkbox",62),e.EFF(2,"Show tag"),e.k0s()())}function Su(s,t){1&s&&(e.j41(0,"div")(1,"mat-checkbox",63),e.EFF(2,"Show all content"),e.k0s()())}function Tu(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-form-field")(1,"button",66),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleRecordPositionClick())}),e.EFF(2," Mark Position "),e.k0s()()}}function xu(s,t){if(1&s&&(e.j41(0,"div",64)(1,"app-form-field")(2,"select",65)(3,"option",34),e.EFF(4,"Zoom to label structure"),e.k0s(),e.j41(5,"option",34),e.EFF(6,"Zoom to fixed position"),e.k0s()()(),e.DNE(7,Tu,3,0,"app-form-field",53),e.k0s()),2&s){const n=e.XpG();e.R7$(3),e.Y8G("value",n.labelFlyTo.Object),e.R7$(2),e.Y8G("value",n.labelFlyTo.Position),e.R7$(2),e.Y8G("ngIf",n._flyToTarget===n.labelFlyTo.Position)}}const Eu={urls:null,alt:""},wu={url:null,caption:"",srcFilename:""};let Fu=(()=>{var s;class t{get label(){return this._label}set label(i){JSON.stringify(i)!==JSON.stringify(this._label)&&(this._label=i,this.setFormValues(i))}get _theme(){return this.form.get("theme").value}get _flyTo(){return this.form.get("flyTo").value}get _flyToTarget(){return this.form.get("flyToTarget").value}get _hideWire(){return this.form.get("hideWire").value}get hasImage(){const i=this.form.get("image").value;return!(0,R.isNil)(i.urls)}get hasVideo(){const i=this.form.get("video").value;return!(0,R.isNil)(i.url)}get video(){return this.form.get("video").value}constructor(i,o,r,l){this.formBuilder=i,this.store=o,this.cameraService=r,this.matSnackBar=l,this.labelTheme=da.D,this.labelPinType=ma.O,this.labelSequentialType=ua.C,this.labelFlyTo=zt,this.ngUnsubscribe=new b.B,this.open=!1,this.opened=new e.bkB;const p=new bu.e("");this.form=this.formBuilder.group({title:[p.title],description:[p.description],theme:[p.theme],pinType:[p.pinType,c.k0.required],sequentialType:[p.sequentialType,c.k0.required],pinGlow:[p.pinGlow],collapseDescription:[p.collapseDescription],hideWire:[p.hideWire],hideTag:[p.hideTag],expandTag:[p.expandTag],showDescription:[p.showDescription],flyTo:[!1],flyToTarget:[""],image:this.formBuilder.group({urls:[],alt:[""]}),video:this.formBuilder.group({url:[],caption:[""],srcFilename:[""]})})}ngOnInit(){this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleFormChanges(i))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleRecordPositionClick(){const i=JSON.parse(JSON.stringify(this.label.states)),o=this.prepareLabelStates(i);o[1].errands=[new So.v(this.cameraService.getCamera())],this.store.dispatch(new ye.HP(this.label.id,o)),this.matSnackBar.open("Recorded marked position")}handleRemove(){this.store.dispatch(new ye.vx(this.label))}handleFormChanges(i){const o=(0,R.cloneDeep)(this.label);if(o.title=i.title,o.description=i.description||"",o.theme=i.theme,o.pinType=i.pinType,o.sequentialType=i.sequentialType,o.pinGlow=i.pinGlow,o.collapseDescription=i.collapseDescription,o.hideWire=i.hideWire,o.hideTag=i.hideTag,o.expandTag=i.expandTag,o.showDescription=i.showDescription,i.flyTo)switch(o.states=this.prepareLabelStates(o.states),o.flyTo=i.flyTo,o.flyToTarget=i.flyToTarget,i.flyToTarget){case zt.Object:o.states[1].errands=[new fa.F(o.objectId)];break;case zt.Position:if(!((0,R.get)(o,"states[1].errands[0]")instanceof So.v)){const l=this.cameraService.getCamera();o.cameraPosition=l,o.states[1].errands=[new So.v(l)]}}else o.states&&o.states.length&&o.states[1]&&(o.states[1].errands=[]);o.contentBlocks=this.toContentBlocks(i),this.store.dispatch(new ye.lb(o,!0))}handleAlignClick(i){const o=(0,R.cloneDeep)(this.label),r=o.hideWire?20:32;switch(i){case"left":o.offset=[-r,0];break;case"right":o.offset=[r,0]}this.store.dispatch(new ye.lb(o,!0))}handleOpened(i){this.opened.emit({label:this.label,open:i})}prepareLabelStates(i){let o=i?[...i]:[];return o||(o=[]),o[0]||(o[0]=new ga.B,o[0].id=Ze.u.idWithPrefix("label-state")),o[1]||(o[1]=new ga.B,o[1].id=Ze.u.idWithPrefix("label-state")),o}setFormValues(i){const o={title:i.title,description:i.description||"",theme:i.theme,pinType:i.pinType,sequentialType:i.sequentialType,pinGlow:i.pinGlow,collapseDescription:i.collapseDescription,hideWire:i.hideWire,hideTag:i.hideTag,flyTo:null,flyToTarget:zt.Object,expandTag:i.expandTag,showDescription:i.showDescription,image:this.fromContentBlocks(i.contentBlocks||[],Ke.m.Images),video:this.fromContentBlocks(i.contentBlocks||[],Ke.m.Videos)},r=(0,R.get)(i,"states[1].errands[0]");r&&(o.flyTo=!0,o.flyToTarget=1==r instanceof So.v?zt.Position:zt.Object),this.form.setValue(o,{emitEvent:!1})}fromContentBlocks(i,o){const r=o===Ke.m.Images?Eu:wu,l=i.find(T=>T.type===o),p=(0,R.get)(l,`${o}[0]`,r);return{...r,...p}}toContentBlocks(i){const{urls:o,alt:r}=i.image,l=[];(!(0,R.isNil)(o)||r)&&l.push({type:Ke.m.Images,images:[{urls:o,alt:r}]});const{url:p,caption:T,srcFilename:B}=i.video;return p&&l.push({type:Ke.m.Videos,videos:[{url:p,caption:T,srcFilename:B}]}),l}handleUploadInput(i){const o=i.file?.name||"";this.form.get("video").patchValue({srcFilename:o},{emitEvent:!1})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(a.il),e.rXU(yo.j),e.rXU(Le.UG))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-label-widget"]],inputs:{label:"label",open:"open"},outputs:{opened:"opened"},decls:84,vars:32,consts:[["labelMenu","matMenu"],["title",""],["description",""],["caption",""],["toggleType","arrow",3,"opened","label","open"],["panel-prefix",""],[1,"flex","items-center","justify-start",2,"width","36px","height","36px"],[3,"label","labelTheme"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["autocomplete","off",3,"formGroup"],["tabSize","small","tabTheme","dark"],["label","Content"],[1,"pt-2","pl-1"],["label","Title",1,"pb-2"],["textMode","text","mode","basic","formControlName","title",3,"inline","compact","maxLength"],[3,"field"],["label","Description",1,"pb-2"],["textMode","textarea","formControlName","description","rows","9",3,"inline","compact","maxLength"],["formGroupName","image"],["label","Image",1,"block","mt-4",3,"labelElement"],["type","image","formControlName","urls"],["label","Image Alt",4,"ngIf"],["formGroupName","video"],["label","Video",1,"block","mt-4",3,"labelElement"],[1,"mb-1","break-words","text-2xs"],["data-test","labelUploadVideo","type","video","formControlName","url",3,"uploadInput","showExtensions"],["label","Video Caption",4,"ngIf"],["label","Style"],[1,"pt-2","pl-1","text-xs"],["label","Label Theme"],["formControlName","theme",1,"input"],[3,"value"],["label","Label Pin"],["formControlName","pinType",1,"input"],["label","Sequence Type",4,"ngIf"],["label","Label Type"],[1,"flex","gap-2"],["formControlName","hideWire",1,"grow","input",2,"display","inline-block","width","154px"],[3,"ngValue"],["app-button","","buttonType","outline","buttonShape","square","matTooltip","Align Left",3,"click"],["icon","caret-left"],["app-button","","buttonType","outline","buttonShape","square","matTooltip","Align Right",3,"click"],["icon","caret-right"],["formControlName","pinGlow"],["label","Actions"],["label","On load"],["listType","flat"],["formControlName","hideTag",1,"mr-4"],["formControlName","collapseDescription"],["label","On click"],[4,"ngIf"],["formControlName","flyTo"],["class","pt-2 pl-6",4,"ngIf"],["label","Image Alt"],["type","text","formControlName","alt",1,"input"],["label","Video Caption"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],["label","Sequence Type"],["formControlName","sequentialType",1,"input"],["formControlName","expandTag"],["formControlName","showDescription"],[1,"pt-2","pl-6"],["formControlName","flyToTarget",1,"input"],["app-button","","buttonType","outline","buttonSize","sm",1,"w-full",3,"click"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"app-panel",4),e.bIt("opened",function(p){return e.eBV(r),e.Njj(o.handleOpened(p))}),e.qex(1,5),e.j41(2,"div",6),e.nrm(3,"app-label-pin",7),e.k0s(),e.bVm(),e.j41(4,"span",8)(5,"button",9),e.nrm(6,"app-icon",10),e.k0s(),e.j41(7,"mat-menu",null,0)(9,"button",11),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleRemove())}),e.EFF(10,"Remove"),e.k0s()()(),e.j41(11,"form",12)(12,"app-tabs",13)(13,"app-tab",14)(14,"div",15)(15,"app-form-field",16),e.nrm(16,"app-rich-text-edit",17,1)(18,"app-character-counter",18),e.k0s(),e.j41(19,"app-form-field",19),e.nrm(20,"app-rich-text-edit",20,2)(22,"app-character-counter",18),e.k0s(),e.qex(23,21),e.j41(24,"app-form-field",22),e.nrm(25,"app-content-upload-input",23),e.k0s(),e.DNE(26,Cu,2,0,"app-form-field",24),e.bVm(),e.qex(27,25),e.j41(28,"app-form-field",26)(29,"div",27),e.EFF(30),e.k0s(),e.j41(31,"app-content-upload-input",28),e.bIt("uploadInput",function(p){return e.eBV(r),e.Njj(o.handleUploadInput(p))}),e.k0s()(),e.DNE(32,vu,4,5,"app-form-field",29),e.bVm(),e.k0s()(),e.j41(33,"app-tab",30)(34,"div",31)(35,"app-form-field",32)(36,"select",33)(37,"option",34),e.EFF(38,"Dark"),e.k0s(),e.j41(39,"option",34),e.EFF(40,"Light"),e.k0s()()(),e.j41(41,"app-form-field",35)(42,"select",36)(43,"option",34),e.EFF(44,"Circle"),e.k0s(),e.j41(45,"option",34),e.EFF(46,"Plus / Minus"),e.k0s(),e.j41(47,"option",34),e.EFF(48,"Sequential"),e.k0s(),e.j41(49,"option",34),e.EFF(50,"None"),e.k0s()()(),e.DNE(51,yu,6,2,"app-form-field",37),e.j41(52,"app-form-field",38)(53,"div",39)(54,"select",40)(55,"option",41),e.EFF(56,"Leader Line"),e.k0s(),e.j41(57,"option",41),e.EFF(58,"Floating"),e.k0s()(),e.j41(59,"app-button-group")(60,"button",42),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleAlignClick("left"))}),e.nrm(61,"app-icon",43),e.k0s(),e.j41(62,"button",44),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleAlignClick("right"))}),e.nrm(63,"app-icon",45),e.k0s()()()(),e.j41(64,"app-form-field")(65,"mat-checkbox",46),e.EFF(66," Make Pin Glow "),e.k0s()()()(),e.j41(67,"app-tab",47)(68,"div",31)(69,"app-form-field",48)(70,"app-list",49)(71,"app-list-item")(72,"mat-checkbox",50),e.EFF(73," Hide tag "),e.k0s()(),e.j41(74,"app-list-item")(75,"mat-checkbox",51),e.EFF(76," Hide all content "),e.k0s()()()(),e.j41(77,"app-form-field",52),e.DNE(78,ku,3,0,"div",53)(79,Su,3,0,"div",53),e.j41(80,"div")(81,"mat-checkbox",54),e.EFF(82,"Zoom label"),e.k0s(),e.DNE(83,xu,8,3,"div",55),e.k0s()()()()()()()}if(2&i){const r=e.sdS(8),l=e.sdS(17),p=e.sdS(21);e.Y8G("label",o.label.title)("open",o.open),e.R7$(3),e.Y8G("label",o.label)("labelTheme",o.label.theme),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(6),e.Y8G("formGroup",o.form),e.R7$(5),e.Y8G("inline",!0)("compact",!0)("maxLength",100),e.R7$(2),e.Y8G("field",l),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("maxLength",300),e.R7$(2),e.Y8G("field",p),e.R7$(2),e.Y8G("labelElement",!1),e.R7$(2),e.Y8G("ngIf",o.hasImage),e.R7$(2),e.Y8G("labelElement",!1),e.R7$(2),e.JRh(o.video.srcFilename),e.R7$(),e.Y8G("showExtensions",!1),e.R7$(),e.Y8G("ngIf",o.hasVideo),e.R7$(5),e.Y8G("value",o.labelTheme.Annotation),e.R7$(2),e.Y8G("value",o.labelTheme.StudioNext),e.R7$(4),e.Y8G("value",o.labelPinType.Default),e.R7$(2),e.Y8G("value",o.labelPinType.PlusMinus),e.R7$(2),e.Y8G("value",o.labelPinType.Sequential),e.R7$(2),e.Y8G("value",o.labelPinType.None),e.R7$(2),e.Y8G("ngIf","sequential"===o.label.pinType),e.R7$(4),e.Y8G("ngValue",!1),e.R7$(2),e.Y8G("ngValue",!0),e.R7$(21),e.Y8G("ngIf",o.label.hideTag),e.R7$(),e.Y8G("ngIf",o.label.collapseDescription),e.R7$(4),e.Y8G("ngIf",o._flyTo)}},dependencies:[E.bT,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,De.So,$.kk,$.fb,$.Cp,Ce.oV,L.Q,un,ee.K,Ft.P,Y.R,Ji.s,Ki.P,Pt.j,Rt.O,me.g,_u.b,At,Rn.c],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),t})();var ui,Xt=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Qt=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Pu(s,t){1&s&&(e.j41(0,"div",22)(1,"div",23),e.EFF(2,"Add a label"),e.k0s(),e.j41(3,"div",17),e.EFF(4,"Click on an object in the 3D scene to start adding labels."),e.k0s()())}function Ru(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",24)(1,"app-label-widget",25),e.nI1(2,"async"),e.bIt("opened",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleOpened(o))}),e.k0s(),e.j41(3,"div",26),e.nrm(4,"app-icon",27),e.k0s()()}if(2&s){let n;const i=t.$implicit,o=e.XpG();e.R7$(),e.Y8G("label",i)("open",(null==(n=e.bMT(2,3,o.selectedLabel$))?null:n.id)===i.id),e.BMQ("data-id",i.id)}}class St{constructor(t,n){this.store=t,this.formBuilder=n,this.activeToolEnum=Q.s,this.labelTheme=da.D,this.labelPinType=ma.O,this.labelSequentialType=ua.C,this.interactive=!1,this.widgetSubscriptions=[],this.ngUnsubscribe=new b.B,this.labelForm=this.formBuilder.group({title:[""],description:[""]})}ngOnInit(){this.bindApplicationEvents(),this.selectedLabel$.pipe((0,j.p)(t=>!!t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{setTimeout(()=>this.scrollLabelIntoView(t))})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.subscribeToOpen(),this.labelWidgets.changes.subscribe(()=>{this.unsubscribeToOpen(),this.subscribeToOpen()})}bindApplicationEvents(){this.selectedChapter$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.interactive=t.readyState.model})}unsubscribeToOpen(){this.widgetSubscriptions.forEach(t=>t.unsubscribe()),this.widgetSubscriptions=[]}subscribeToOpen(){this.labelWidgets.forEach(t=>{const n=t.opened.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.openWidget(t,i)});this.widgetSubscriptions.push(n)})}handleOpenWidgets(t){this.toggleWidgets(t)}handleOpened(t){this.store.dispatch(new ye.TR(t.label))}handleRemoveChapterLabels(){this.store.dispatch(new ye.u1(this.store.selectSnapshot(I.N.getSelectedChapter),!0))}handleNext(){this.store.dispatch(new w.$j)}handlePrevious(){this.store.dispatch(new w.hE)}handleCheckedChange(t){this.store.dispatch(new Et.pU(t.checked))}toggleWidgets(t){this.labelWidgets.forEach(n=>{n.open=t})}openWidget(t,n){this.toggleWidgets(!1),t.open=n}trackLabel(t,n){return n.id}convertLabels(t,n){const i=this.store.selectSnapshot(n?Ue.y.getChapterLabels:Ue.y.getLabels);this.store.dispatch(new ye.$K(i,t))}scrollLabelIntoView(t){const n=document.querySelector(`[data-id="${t.id}"]`);(0,ha.uK)()&&n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}handleDrop(t){const n=this.store.selectSnapshot(Ue.y.getChapterLabels);(0,te.HD)(n,t.previousIndex,t.currentIndex);let i=this.store.selectSnapshot(Ue.y.getLabels).filter(o=>!n.some(r=>r.id===o.id));i=[...i,...n],this.store.dispatch(new ye.gJ(i))}}(ui=St).\u0275fac=function(t){return new(t||ui)(e.rXU(a.il),e.rXU(c.ze))},ui.\u0275cmp=e.VBU({type:ui,selectors:[["app-edit-label-context"]],viewQuery:function(t,n){if(1&t&&e.GBs(me.g,5),2&t){let i;e.mGM(i=e.lsd())&&(n.labelWidgets=i)}},decls:54,vars:16,consts:[["labelMenu","matMenu"],["storyTrigger","matMenuTrigger"],["chapterTrigger","matMenuTrigger"],["convertMenu","matMenu"],["convertThemeMenu","matMenu"],["convertPinsMenu","matMenu"],[3,"loading"],["column-label",""],["column-actions",""],["app-button","",1,"context__actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],["label","Label"],["column-group-header",""],[1,"pl-2"],[3,"change","checked"],[1,"text-xs"],["column-group-body",""],["class","p-3",4,"ngIf"],["cdkDropList","",1,"labels",3,"cdkDropListDropped"],["class","labels__item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-3"],[1,"text-xs","font-bold"],["cdkDrag","",1,"labels__item"],[1,"grow",3,"opened","label","open"],["cdkDragHandle","",1,"labels__handle"],["icon","grip-lines"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column",6)(1,"div",7),e.EFF(2,"Labels"),e.k0s(),e.j41(3,"div",8)(4,"button",9),e.nrm(5,"app-icon",10),e.k0s(),e.j41(6,"mat-menu",null,0)(8,"button",11),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveChapterLabels())}),e.EFF(9," Remove this chapter's labels "),e.k0s(),e.nrm(10,"mat-divider"),e.j41(11,"button",12,1),e.EFF(13," Convert all labels "),e.k0s(),e.j41(14,"button",12,2),e.EFF(16," Convert this chapter's labels "),e.k0s()(),e.j41(17,"mat-menu",null,3)(19,"button",12),e.EFF(20,"Theme"),e.k0s(),e.j41(21,"button",12),e.EFF(22,"Pin"),e.k0s()(),e.j41(23,"mat-menu",null,4)(25,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({theme:n.labelTheme.Annotation},r.menuOpen))}),e.EFF(26," Dark Theme "),e.k0s(),e.j41(27,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({theme:n.labelTheme.StudioNext},r.menuOpen))}),e.EFF(28," Light Theme "),e.k0s()(),e.j41(29,"mat-menu",null,5)(31,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({pinType:n.labelPinType.Default},r.menuOpen))}),e.EFF(32," Circle "),e.k0s(),e.j41(33,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({pinType:n.labelPinType.PlusMinus},r.menuOpen))}),e.EFF(34," Plus / Minus "),e.k0s(),e.j41(35,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({pinType:n.labelPinType.Sequential,sequentialType:n.labelSequentialType.Alphabetical},r.menuOpen))}),e.EFF(36," Alphabetical "),e.k0s(),e.j41(37,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({pinType:n.labelPinType.Sequential,sequentialType:n.labelSequentialType.Numerical},r.menuOpen))}),e.EFF(38," Numerical "),e.k0s(),e.j41(39,"button",11),e.bIt("click",function(){e.eBV(i);const r=e.sdS(15);return e.Njj(n.convertLabels({pinType:n.labelPinType.None},r.menuOpen))}),e.EFF(40," None "),e.k0s()()(),e.j41(41,"app-column-group",13),e.qex(42,14),e.j41(43,"div",15)(44,"mat-checkbox",16),e.nI1(45,"async"),e.bIt("change",function(r){return e.eBV(i),e.Njj(n.handleCheckedChange(r))}),e.j41(46,"span",17),e.EFF(47,"Disable label zoom while editing"),e.k0s()()(),e.bVm(),e.qex(48,18),e.DNE(49,Pu,5,0,"div",19),e.nI1(50,"async"),e.j41(51,"div",20),e.bIt("cdkDropListDropped",function(r){return e.eBV(i),e.Njj(n.handleDrop(r))}),e.DNE(52,Ru,5,5,"div",21),e.nI1(53,"async"),e.k0s(),e.bVm(),e.k0s()()}if(2&t){let i;const o=e.sdS(7),r=e.sdS(18),l=e.sdS(24),p=e.sdS(30);e.Y8G("loading",!n.interactive),e.R7$(4),e.Y8G("matMenuTriggerFor",o),e.R7$(7),e.Y8G("matMenuTriggerFor",r),e.R7$(3),e.Y8G("matMenuTriggerFor",r),e.R7$(5),e.Y8G("matMenuTriggerFor",l),e.R7$(2),e.Y8G("matMenuTriggerFor",p),e.R7$(23),e.Y8G("checked",e.bMT(45,10,n.lockCamera$)),e.R7$(5),e.Y8G("ngIf",!(null!=(i=e.bMT(50,12,n.labels$))&&i.length)),e.R7$(3),e.Y8G("ngForOf",e.bMT(53,14,n.labels$))("ngForTrackBy",n.trackLabel)}},dependencies:[E.Sq,E.bT,te.O7,te.T1,te.Fb,De.So,$.kk,$.fb,$.Cp,Qe.q,L.Q,mt,st,Y.R,Fu,E.Jj],styles:[".context__actions[_ngcontent-%COMP%]{flex:0 1 auto}.labels__item[_ngcontent-%COMP%]{position:relative}.labels__item[_ngcontent-%COMP%]:hover   .labels__handle[_ngcontent-%COMP%]{opacity:1}.labels__handle[_ngcontent-%COMP%]{border:4px solid transparent;display:flex;align-items:center;justify-content:center;background:#131c2a;width:44px;height:36px;cursor:move;color:#96a8c0;position:absolute;left:4px;top:16px;z-index:10;opacity:0;transition:opacity .15s}.labels[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.2}"],changeDetection:0}),Xt([(0,a.l6)(x.t.getStory),Qt("design:type",u.c)],St.prototype,"story$",void 0),Xt([(0,a.l6)(I.N.getSelectedChapter),Qt("design:type",u.c)],St.prototype,"selectedChapter$",void 0),Xt([(0,a.l6)(Ue.y.getChapterLabels),Qt("design:type",u.c)],St.prototype,"labels$",void 0),Xt([(0,a.l6)(Ue.y.getSelectedLabel),Qt("design:type",u.c)],St.prototype,"selectedLabel$",void 0),Xt([(0,a.l6)(_.S.getChapter),Qt("design:type",u.c)],St.prototype,"chapter$",void 0),Xt([(0,a.l6)(_.S.getActiveTool),Qt("design:type",u.c)],St.prototype,"activeTool$",void 0),Xt([(0,a.l6)(ar.x.getLockCamera),Qt("design:type",u.c)],St.prototype,"lockCamera$",void 0);var qt=v(20458),ba=v(4951),_a=v(40470);class To{constructor(t){this.label=t||"",this.id=Ze.u.idWithPrefix("palette"),this.recipes=[],this.open=!0}}function Mu(s,t){1&s&&(e.j41(0,"app-alert",15),e.EFF(1," There was an error importing your palette. "),e.k0s())}let ju=(()=>{var s;class t{constructor(i,o,r){this.formBuilder=i,this.dialogRef=o,this.changeDetectorRef=r,this.hasError=!1}ngOnInit(){this.initForm()}initForm(){this.form=this.formBuilder.group({import:["",c.k0.required]})}handleSubmit(){const i=this.form.get("import").value;this.createPalette(i)}createPalette(i){this.hasError=!1;try{const o=JSON.parse(i),r=(0,_a.bj)(To,o);delete r.id,this.dialogRef.close(r)}catch{this.hasError=!0,this.changeDetectorRef.markForCheck()}}handleFile(i){var o=new FileReader;o.onload=r=>{this.createPalette(r.target.result)},o.readAsText(i.target.files[0])}onReaderLoad(i){this.createPalette(i.target.result)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(Z.CP),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-import-palette-dialog"]],decls:18,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["data-test","importPaletteDialog",1,"edit-import-palette-dialog","theme-light"],["type","danger","theme","light","class","mb-4 block",4,"ngIf"],["tabTheme","light"],["label","Paste Text"],["data-test","importForm",3,"submit","formGroup"],["label","Palette"],["formControlName","import","rows","6","name","import","data-test","importText",1,"input"],["label","Upload file"],["label","Palette File"],["type","file",1,"input",3,"change"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","buttonType","primary",3,"click"],["type","danger","theme","light",1,"mb-4","block"]],template:function(i,o){1&i&&(e.j41(0,"h1",0),e.EFF(1,"Import Palette"),e.k0s(),e.j41(2,"div",1)(3,"div",2),e.DNE(4,Mu,2,0,"app-alert",3),e.j41(5,"app-tabs",4)(6,"app-tab",5)(7,"form",6),e.bIt("submit",function(){return o.handleSubmit()}),e.j41(8,"app-form-field",7),e.nrm(9,"textarea",8),e.k0s()()(),e.j41(10,"app-tab",9)(11,"app-form-field",10)(12,"input",11),e.bIt("change",function(l){return o.handleFile(l)}),e.k0s()()()()()(),e.j41(13,"div",12)(14,"button",13),e.EFF(15,"Cancel"),e.k0s(),e.j41(16,"button",14),e.bIt("click",function(){return o.handleSubmit()}),e.EFF(17,"Import"),e.k0s()()),2&i&&(e.R7$(4),e.Y8G("ngIf",o.hasError),e.R7$(3),e.Y8G("formGroup",o.form))},dependencies:[E.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,Z.tx,Z.BI,Z.E7,Z.Yi,Yr.C,L.Q,ee.K,Pt.j,Rt.O],changeDetection:0}),t})();function ze(s){let t="";return"number"==typeof s?t=s.toFixed(2):(0,pt._U)(s)?t=function Iu(s){return`(Center: ${ze(s.center)}, Edge: ${ze(s.edge)}, Center Bias: ${ze(s.centerBias)}, Edge Bias: ${ze(s.edgeBias)}, Power: ${s.power})`}(s):(0,pt._o)(s)&&(t=function Nu(s){return se.T.rgbToHex(se.T.rgbFromDecimal(s)).toUpperCase()}(s)),t}var hi;const Gu=["palette"],$u=(s,t,n)=>({"paint-palette-swatch--slash":s,"paint-palette-swatch--selected":t,"paint-palette-swatch--large":n});function Ou(s,t){if(1&s&&(e.j41(0,"div",4),e.EFF(1),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.SpI(" ",n.label,"\n")}}class Ht{get engineRecipe(){return this._engineRecipe}set engineRecipe(t){this._engineRecipe=t,this.recipe=(0,pt.H)(this.engineRecipe)}get recipe(){return this._recipe}set recipe(t){this._recipe=t,this.recipe&&(this.updateStyle(this.recipe),this.updateTooltip())}get label(){return this._label}set label(t){this._label=t,this.updateTooltip()}constructor(t,n){this.renderer=t,this.changeDetectorRef=n,this.showLabel=!0,this.size="small",this.highlightSelected=!0,this.selected=!1,this.showSlash=!1,this.ngUnsubscribe=new b.B}ngOnInit(){this.currentRecipe$.pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(()=>this.highlightSelected),(0,j.p)(t=>!(0,R.isNil)(t))).subscribe(t=>{this.selected=this.isSelected(this.recipe,t),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateStyle(t){let n=1;if((0,pt._M)(t)&&(n=(0,R.isNumber)(t.opacity)?t.opacity>1?t.opacity/100:t.opacity:.4),(0,pt._U)(t.tintColor)){const i=se.T.rgbToHex(se.T.rgbFromDecimal(t.tintColor.center)),o=se.T.rgbToHex(se.T.rgbFromDecimal(t.tintColor.edge));this.renderer.setStyle(this.element.nativeElement,"background",`radial-gradient(${i} 0%, ${o} 60%)`)}else{const i=this.makeColor(t,n);this.renderer.setStyle(this.element.nativeElement,"background",i)}this.showSlash=!1===t.tintColor&&!1===t.brightness&&!1===t.contrast&&!1===t.opacity&&!1===t.saturation}makeColor(t,n=1){const i=t.tintColor;if(!i)return`rgba(255,255,255,${n})`;const[o,r,l]=i;return`rgba(${255*o}, ${255*r}, ${255*l}, ${n})`}updateTooltip(){if(!this.recipe)return;let t=[];this.label&&t.push(this.label);const n=[...t,...[{key:"Color",value:ze(this.recipe.tintColor)},{key:"Saturation",value:ze(this.recipe.saturation)},{key:"Contrast",value:ze(this.recipe.contrast)},{key:"Brightness",value:ze(this.recipe.brightness)},{key:"Opacity",value:ze(this.recipe.opacity)}].filter(i=>""!==i.value).map(i=>`${i.key}: ${i.value}`)].join("\n\n");this.tooltip=n}isSelected(t,n){return(0,R.isEqual)(t,n)}}function Au(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",12),e.nrm(1,"app-paint-swatch",13)(2,"input",14),e.j41(3,"button",15),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRemove(o))}),e.nrm(4,"app-icon",16),e.k0s()()}if(2&s){const n=t.$implicit,i=t.index,o=e.XpG();e.Y8G("formGroup",n),e.R7$(),e.Y8G("recipe",o.palette.recipes[i])("highlightSelected",!1)("showLabel",!1)}}(hi=Ht).\u0275fac=function(t){return new(t||hi)(e.rXU(e.sFG),e.rXU(e.gRc))},hi.\u0275cmp=e.VBU({type:hi,selectors:[["app-paint-swatch"],["button","app-paint-swatch",""]],viewQuery:function(t,n){if(1&t&&e.GBs(Gu,7),2&t){let i;e.mGM(i=e.lsd())&&(n.element=i.first)}},inputs:{engineRecipe:"engineRecipe",recipe:"recipe",label:"label",showLabel:"showLabel",size:"size",icon:"icon",highlightSelected:"highlightSelected"},decls:4,vars:7,consts:[["palette",""],["matTooltipClass","whitespace-pre-line","matTooltipPosition","above","data-test","paintPaletteSwatch",1,"paint-palette-swatch",3,"ngClass","matTooltip"],[1,"paint-palette-swatch__style"],["class","paint-palette-swatch__label",4,"ngIf"],[1,"paint-palette-swatch__label"]],template:function(t,n){1&t&&(e.j41(0,"div",1),e.nrm(1,"div",2,0),e.k0s(),e.DNE(3,Ou,2,1,"div",3)),2&t&&(e.Y8G("ngClass",e.sMw(3,$u,n.showSlash,n.selected,"large"===n.size))("matTooltip",n.tooltip),e.R7$(3),e.Y8G("ngIf",n.showLabel))},dependencies:[E.YU,E.bT,Ce.oV],styles:["[app-paint-swatch]{display:inline-flex;justify-content:center;align-items:center;flex-direction:column}button[app-paint-swatch]{cursor:pointer;background:none;border:none;margin:0;padding:0}.paint-palette-swatch__label{display:block;width:48px;height:20px;padding:4px 4px 0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#fff;font-size:9px}.paint-palette-swatch{cursor:pointer;background-color:#fff;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cg fill='%23CCCCCC' fill-opacity='1'%3E%3Cpath fill-rule='evenodd' d='M0 0h4v4H0V0zm4 4h4v4H4V4z'/%3E%3C/g%3E%3C/svg%3E\");border-radius:50%;display:flex;justify-content:center;align-items:center;width:24px;height:24px;position:relative}.paint-palette-swatch:hover:active{transform:scale(.9)}.paint-palette-swatch--large{width:36px;height:36px}.paint-palette-swatch--selected .paint-palette-swatch__style{box-shadow:0 0 0 2px #7fb6f5}.paint-palette-swatch--slash:after{content:\" \";position:absolute;height:3px;width:100%;background-color:#f44336cc;transform:rotate(135deg)}.paint-palette-swatch__style{position:absolute;width:100%;height:100%;border-radius:50%;box-shadow:0 0 0 1px #374a68}.paint-palette-swatch__icon{text-shadow:0 0px 2px rgba(0,0,0,.8)}\n"],encapsulation:2,changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(G.i.getCurrentRecipe),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Ht.prototype,"currentRecipe$",void 0);let Es=(()=>{var s;class t{get recipes(){return this.form.get("recipes")}constructor(i,o,r,l){this.dialogRef=i,this.data=o,this.formBuilder=r,this.store=l,this.ngUnsubscribe=new b.B,this.activeRecipeIndex=null,this.showDetails=!1,this.form=this.formBuilder.group({label:["",c.k0.required],recipes:this.formBuilder.array([])}),this.palette=(0,R.cloneDeep)(this.data.palette)}ngOnInit(){this.updateForm(this.palette),this.handleFormChanges()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateForm(i){this.form.get("label").setValue(i.label),i.recipes.forEach(o=>{const r=this.formBuilder.group({label:[o.label]});this.recipes.push(r)})}handleFormChanges(){this.form.get("recipes").valueChanges.pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(i=>i.length)).subscribe(i=>{this.palette.recipes.forEach((o,r)=>{this.palette.recipes[r].label=i[r].label})})}handleRemoveRecipe(i){this.palette.recipes.splice(i,1),this.store.dispatch(new D.ut(this.palette))}handleSubmit(){const i=(0,_a.bj)(To,{...this.palette,label:this.form.get("label").value});this.dialogRef.close(i)}handleRecipeDrop(i){const{previousIndex:o,currentIndex:r}=i;this.palette.recipes=(0,Dt.W)(this.palette.recipes,o,r),this.recipes.controls=(0,Dt.W)(this.recipes.controls,o,r)}handleRecipeClick(i){this.activeRecipeIndex=i,this.showDetails=!1}handleRemove(i){this.palette.recipes.splice(i,1),this.activeRecipeIndex=null}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(Z.CP),e.rXU(Z.Vh),e.rXU(c.ze),e.rXU(a.il))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-palette-dialog"]],decls:15,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["data-test","editPaletteDialog",1,"edit-palette-dialog","theme-light"],["data-test","editPaletteForm",3,"submit","formGroup"],["label","Label"],["type","text","formControlName","label","cdkFocusInitial","","data-test","paletteLabel",1,"input"],["label","Colors","cdkDropList","","cdkDropListOrientation","vertical","formArrayName","recipes",3,"cdkDropListDropped"],[1,"edit-palette-dialog__recipes","theme-light"],["data-test","paletteRecipe","class","edit-palette-dialog__item","cdkDrag","",3,"formGroup",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","buttonType","primary","data-test","paletteSubmit",3,"click"],["data-test","paletteRecipe","cdkDrag","",1,"edit-palette-dialog__item",3,"formGroup"],[1,"mr-2",3,"recipe","highlightSelected","showLabel"],["type","label","placeholder","Label (optional)","formControlName","label","tabindex","0",1,"input","theme-light"],["type","button","app-button","","buttonType","outline","buttonTheme","light","tabindex","-1",1,"ml-2",3,"click"],["icon","times"]],template:function(i,o){1&i&&(e.j41(0,"h1",0),e.EFF(1,"Manage Palette"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"div",2),e.j41(4,"form",3),e.bIt("submit",function(){return o.handleSubmit()}),e.j41(5,"app-form-field",4),e.nrm(6,"input",5),e.k0s(),e.j41(7,"app-form-field",6),e.bIt("cdkDropListDropped",function(l){return o.handleRecipeDrop(l)}),e.j41(8,"div",7),e.DNE(9,Au,5,4,"div",8),e.k0s()()()(),e.j41(10,"div",9)(11,"button",10),e.EFF(12,"Cancel"),e.k0s(),e.j41(13,"button",11),e.bIt("click",function(){return o.handleSubmit()}),e.EFF(14," Done "),e.k0s()()),2&i&&(e.R7$(4),e.Y8G("formGroup",o.form),e.R7$(5),e.Y8G("ngForOf",o.recipes.controls))},dependencies:[E.Sq,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,te.O7,te.T1,Z.tx,Z.BI,Z.E7,Z.Yi,L.Q,ee.K,Y.R,Ht],styles:[".edit-palette-dialog__recipes[_ngcontent-%COMP%]{padding:16px 0;max-height:320px;overflow-y:scroll}.edit-palette-dialog__item[_ngcontent-%COMP%]{border-radius:4px;display:flex;align-items:center;padding:8px}.edit-palette-dialog__item[_ngcontent-%COMP%]:hover{background:#eaeff5}"],changeDetection:0}),t})(),xo=(()=>{var s;class t{constructor(i,o,r,l,p){this.dialogService=i,this.clipboardService=o,this.snackbar=r,this.store=l,this.dialog=p}selectRecipe(i){this.store.dispatch(new D.Hr),this.store.dispatch(new D.WD(i)),this.store.dispatch(new oe.pL(Q.s.Paint))}copyPaletteToClipboard(i){const o=(0,R.cloneDeep)(i);delete o.open;const r=JSON.stringify(o);this.clipboardService.copyToClipboard(r,"text").pipe((0,he.s)(1)).subscribe(l=>{this.snackbar.open(l?"Successfully copied palette to clipboard.":"Failed to copy palette to clipboard.")})}downloadPalette(i){const o={...i};delete o.id,delete o.open;const l=`${i.label.toLocaleLowerCase()||"palette"}.json`,p=JSON.stringify(i),T=new Blob([p],{type:"text/plain;charset=utf-8"});(0,Qo.saveAs)(T,l)}removePalette(i){this.dialogService.openConfirmDialog({data:{titleText:"Remove Palette",bodyText:`Would you like to remove the '${i.label}' palette?`,confirmText:"Remove Palette"}}).afterClosed().pipe((0,he.s)(1),(0,j.p)(o=>!0===o)).subscribe(()=>{this.store.dispatch(new D.yG(i.id))})}openImportPalette(){this.dialog.open(ju,{width:"480px"}).afterClosed().pipe((0,he.s)(1),(0,j.p)(o=>!(0,R.isNil)(o))).subscribe(o=>{this.dialog.open(Es,{width:"480px",data:{palette:o}}).afterClosed().pipe((0,he.s)(1),(0,j.p)(l=>!(0,R.isNil)(l))).subscribe(l=>{this.store.dispatch(new D.hd(l))})})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.KVO(Ve.o),e.KVO(ba.W),e.KVO(Le.UG),e.KVO(a.il),e.KVO(Z.bZ))},s.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),t})();var fi,gi;function Lu(s,t){1&s&&(e.j41(0,"span"),e.EFF(1,"structure"),e.k0s())}function Yu(s,t){1&s&&(e.j41(0,"span"),e.EFF(1,"structures"),e.k0s())}class ws{constructor(t){this.store=t}handleClearClick(){this.store.dispatch(new re.q9(!1))}}function Qu(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.handleRecipeClick(o))}),e.k0s()}if(2&s){const n=t.$implicit;e.Y8G("recipe",n)("label",n.label)}}function qu(s,t){if(1&s&&(e.j41(0,"div",6)(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.DNE(4,Qu,1,2,"button",9),e.k0s()()),2&s){const n=t.$implicit;e.R7$(2),e.SpI(" ",n.label," "),e.R7$(2),e.Y8G("ngForOf",n.recipes)}}(fi=ws).\u0275fac=function(t){return new(t||fi)(e.rXU(a.il))},fi.\u0275cmp=e.VBU({type:fi,selectors:[["app-selected-nodes-panel"]],decls:13,vars:11,consts:[[1,"panel","text-xs","uppercase"],[1,"panel__count"],[4,"ngIf"],[1,"panel__clear"],["buttonSize","sm","app-button","",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"async"),e.nI1(4,"number"),e.DNE(5,Lu,2,0,"span",2),e.nI1(6,"async"),e.DNE(7,Yu,2,0,"span",2),e.nI1(8,"async"),e.EFF(9," selected "),e.k0s(),e.j41(10,"div",3)(11,"button",4),e.bIt("click",function(){return n.handleClearClick()}),e.EFF(12,"Clear"),e.k0s()()()),2&t&&(e.R7$(2),e.SpI(" ",e.bMT(4,5,e.bMT(3,3,n.checkedNodesCount$))," "),e.R7$(3),e.Y8G("ngIf",1===e.bMT(6,7,n.checkedNodesCount$)),e.R7$(2),e.Y8G("ngIf",e.bMT(8,9,n.checkedNodesCount$)>1))},dependencies:[L.Q,E.bT,E.Jj,E.QX],styles:[".panel[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px;justify-content:space-between;align-items:center}.panel__count[_ngcontent-%COMP%]{flex:1 0 auto}.panel__clear[_ngcontent-%COMP%]{flex:0 0 auto;opacity:.3}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(ve.z.getCheckedNodesCount),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],ws.prototype,"checkedNodesCount$",void 0);class Fs{constructor(t){this.editPaintService=t,this.name="",this.groupedPresets=[{label:"Colors",recipes:qt.Me},{label:"Effects",recipes:qt._d}]}ngOnInit(){}handleRecipeClick(t){this.editPaintService.selectRecipe(t)}isSelected(t,n){return JSON.stringify(t)===JSON.stringify(n)}}(gi=Fs).\u0275fac=function(t){return new(t||gi)(e.rXU(xo))},gi.\u0275cmp=e.VBU({type:gi,selectors:[["app-paint-presets"]],decls:7,vars:3,consts:[["toggleType","arrow",3,"open","noPadding"],["panel-label","",1,"font-semibold","px-3","py-2"],[1,"font-semibold","flex","items-center","px-",2,"min-height","36px"],[1,"px-3","pb-2"],[1,"paint-presets"],["class","paint-presets__group",4,"ngFor","ngForOf"],[1,"paint-presets__group"],[1,"text-2xs","uppercase","text-gray-400","py-2","pl-1"],[1,"px-1"],["app-paint-swatch","","class","mr-2 mb-2","data-test","paintPreset",3,"recipe","label","click",4,"ngFor","ngForOf"],["app-paint-swatch","","data-test","paintPreset",1,"mr-2","mb-2",3,"click","recipe","label"]],template:function(t,n){1&t&&(e.j41(0,"app-panel",0)(1,"div",1)(2,"div",2),e.EFF(3,"BioDigital"),e.k0s()(),e.j41(4,"div",3)(5,"div",4),e.DNE(6,qu,5,2,"div",5),e.k0s()()()),2&t&&(e.Y8G("open",!0)("noPadding",!0),e.R7$(6),e.Y8G("ngForOf",n.groupedPresets))},dependencies:[E.Sq,me.g,Ht],styles:[".paint-presets[_ngcontent-%COMP%]{display:flex;flex-flow:column}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(G.i.getCurrentRecipe),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Fs.prototype,"colorRecipe$",void 0);var Ca=v(45434),va=v(1367);const Hu=["tabsEl"];function Wu(s,t){if(1&s&&(e.qex(0),e.j41(1,"app-form-field",14),e.nrm(2,"app-slider",15),e.k0s(),e.bVm()),2&s){const n=e.XpG();e.R7$(2),e.Y8G("min",n.min)("max",n.max)}}function Ju(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",16),e.nrm(2,"app-color-picker-input",17),e.k0s(),e.bVm())}function Ku(s,t){if(1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-slider",15),e.k0s(),e.j41(3,"app-form-field",19),e.nrm(4,"app-slider",15),e.k0s(),e.bVm()),2&s){const n=e.XpG();e.R7$(2),e.Y8G("min",n.fresnelMin)("max",n.fresnelMax),e.R7$(2),e.Y8G("min",n.fresnelMin)("max",n.fresnelMax)}}function Zu(s,t){1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-color-picker-input",17),e.k0s(),e.j41(3,"app-form-field",19),e.nrm(4,"app-color-picker-input",17),e.k0s(),e.bVm())}let eh=(()=>{var s;class t{get value(){return this._value}set value(i){(0,R.isEqual)(i,this.value)||(this._value=i,this.setFormValues(i))}get colorMode(){return this._colorMode}set colorMode(i){this._colorMode=i}constructor(i){this.formBuilder=i,this.min=0,this.max=100,this.fresnelMin=0,this.fresnelMax=100,this._value=null,this.simpleMode="number",this.fresnelMode="scalar",this.valueUpdated=new e.bkB,this._colorMode="numeric",this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({numericValue:[0],hexValue:["#ff0000"],fresnel:this.formBuilder.group({center:this.formBuilder.group({numericValue:[100],hexValue:["#ff0000"]}),edge:this.formBuilder.group({numericValue:[0],hexValue:["#0000ff"]}),centerBias:[100],edgeBias:[0],power:[1]})})}ngOnInit(){this.form.valueChanges.pipe((0,W.B)(300),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.emitCurrentValue()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){"number"==typeof i?(this.setSimpleValues(i),this.colorMode="numeric"):Array.isArray(i)?(this.setRGBValues(i),this.colorMode="numeric"):(0,pt._U)(i)&&(Array.isArray(i.center)?this.setColorFresnesValues(i):this.setScalarFresnesValues(i),this.colorMode="fresnel")}setSimpleValues(i){this.form.patchValue({numericValue:i},{emitEvent:!1,onlySelf:!0})}setRGBValues(i){const o=se.T.rgbToHex(i,!0);this.form.patchValue({hexValue:o},{emitEvent:!1,onlySelf:!0})}setScalarFresnesValues(i){const{edge:o,center:r,edgeBias:l,centerBias:p,power:T}=i;this.form.patchValue({fresnel:{edge:{numericValue:100*o},center:{numericValue:100*r},edgeBias:100*l,centerBias:100*p,power:T}},{emitEvent:!1,onlySelf:!0})}setColorFresnesValues(i){const{edge:o,center:r,centerBias:l,edgeBias:p,power:T}=i,B=se.T.rgbToHex(o,!0),A=se.T.rgbToHex(r,!0);this.form.patchValue({fresnel:{edge:{hexValue:B},center:{hexValue:A},edgeBias:100*p,centerBias:100*l,power:T}},{emitEvent:!1,onlySelf:!0})}setColorMode(i){this.colorMode=0===i?"numeric":"fresnel",this.emitCurrentValue()}emitCurrentValue(){const i=this.getColorValue();this.valueUpdated.emit(i)}getColorValue(){const i=this.form.value;return"fresnel"===this.colorMode?"color"===this.fresnelMode?this.getColorFresnelValue(i):this.getSclarFresnelValue(i):"number"===this.simpleMode?this.getSimpleValue(i):this.getRGBValue(i)}getSimpleValue(i){const{numericValue:o}=i;return o}getRGBValue(i){const{hexValue:o}=i;return se.T.hexToRgb(o,!0)}getColorFresnelValue(i){const{fresnel:o}=i,{edge:r,center:l,edgeBias:p,centerBias:T,power:B}=o,A=se.T.hexToRgb(r.hexValue,!0),H=se.T.hexToRgb(l.hexValue,!0);return new Ca.m({edge:A,center:H,edgeBias:p/100,centerBias:T/100,power:B})}getSclarFresnelValue(i){const{fresnel:o}=i,{edge:r,center:l,centerBias:p,edgeBias:T,power:B}=o;return new va.R({edge:r.numericValue/100,center:l.numericValue/100,centerBias:p/100,edgeBias:T/100,power:B})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-paint-recipe"]],viewQuery:function(i,o){if(1&i&&e.GBs(Hu,7),2&i){let r;e.mGM(r=e.lsd())&&(o.tabs=r.first)}},inputs:{min:"min",max:"max",fresnelMin:"fresnelMin",fresnelMax:"fresnelMax",value:"value",simpleMode:"simpleMode",fresnelMode:"fresnelMode"},outputs:{valueUpdated:"valueUpdated"},decls:17,vars:14,consts:[["tabsEl",""],[1,"recipe",3,"formGroup"],["tabSize","small","tabTheme","dark",3,"activeTabChange","activeTab"],["label","Simple",3,"ngSwitch"],[1,"pt-2","pl-1"],[4,"ngSwitchCase"],["label","Advanced",3,"ngSwitch"],["formGroupName","fresnel",1,"pt-2","pl-1"],["label","Center Bias"],["formControlName","centerBias",3,"min","max"],["label","Edge Bias"],["formControlName","edgeBias",3,"min","max"],["label","Power"],["formControlName","power",3,"min","max"],["label","Value"],["formControlName","numericValue",3,"min","max"],["label","Color"],["formControlName","hexValue"],["label","Center","formGroupName","center"],["label","Edge","formGroupName","edge"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"form",1)(1,"app-tabs",2,0),e.bIt("activeTabChange",function(p){return e.eBV(r),e.Njj(o.setColorMode(p))}),e.j41(3,"app-tab",3)(4,"div",4),e.DNE(5,Wu,3,2,"ng-container",5)(6,Ju,3,0,"ng-container",5),e.k0s()(),e.j41(7,"app-tab",6)(8,"div",7),e.DNE(9,Ku,5,4,"ng-container",5)(10,Zu,5,0,"ng-container",5),e.j41(11,"app-form-field",8),e.nrm(12,"app-slider",9),e.k0s(),e.j41(13,"app-form-field",10),e.nrm(14,"app-slider",11),e.k0s(),e.j41(15,"app-form-field",12),e.nrm(16,"app-slider",13),e.k0s()()()()()}2&i&&(e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("activeTab","numeric"===o.colorMode?0:1),e.R7$(2),e.Y8G("ngSwitch",o.simpleMode),e.R7$(2),e.Y8G("ngSwitchCase","number"),e.R7$(),e.Y8G("ngSwitchCase","rgb"),e.R7$(),e.Y8G("ngSwitch",o.fresnelMode),e.R7$(2),e.Y8G("ngSwitchCase","scalar"),e.R7$(),e.Y8G("ngSwitchCase","color"),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",1)("max",5))},dependencies:[E.ux,E.e1,c.qT,c.BC,c.cb,c.j4,c.JD,c.$R,ee.K,$e,Pt.j,Rt.O,Mt],styles:[".recipe__heading[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px;font-size:.75rem;line-height:1rem;font-weight:700;color:#96a8c0}.theme-light[_nghost-%COMP%]   .recipe__heading[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .recipe__heading[_ngcontent-%COMP%]{color:1px solid #374a68}.recipe__group[_ngcontent-%COMP%]{padding-top:4px;padding-bottom:4px;border-top:1px solid #1c2a3f}.theme-light[_nghost-%COMP%]   .recipe__group[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .recipe__group[_ngcontent-%COMP%]{border-top:1px solid #eaeff5}"],changeDetection:0}),t})();var bi,th=v(68114);const oh=["tintColorRef"],sh=["saturationRef"],rh=["contrastRef"],ah=["brightnessRef"],lh=["opacityRef"];class Ps{constructor(t,n,i){this.formBuilder=t,this.store=n,this.changeDetector=i,this.paintBrushMode=th.u,this.ngUnsubscribe=new b.B;const{tintColor:o,saturation:r,contrast:l,brightness:p,opacity:T}=this.store.selectSnapshot(G.i.getCurrentRecipe),B=this.store.selectSnapshot(G.i.getPaintBrushMode);this.form=this.formBuilder.group({tintColorEnabled:this.isColorValueEnabled(o),saturationEnabled:this.isColorValueEnabled(r),contrastEnabled:this.isColorValueEnabled(l),brightnessEnabled:this.isColorValueEnabled(p),opacityEnabled:this.isColorValueEnabled(T),paintBrushMode:B})}ngOnInit(){this.colorRecipe$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.colorRecipe=t,this.changeDetector.markForCheck()}),this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleFormChanges(t)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFormChanges(t){this.handleRecipeUpdates({tintColor:this.tintColorRef.value,saturation:this.saturationRef.value,contrast:this.contrastRef.value,brightness:this.brightnessRef.value,opacity:this.opacityRef.value}),this.store.dispatch(new D.GG(t.paintBrushMode))}handleTintColorUpdates(t){this.colorRecipe={...this.colorRecipe,tintColor:t},this.isFeatureEnabled("tintColor")&&this.handleRecipeUpdates(this.colorRecipe)}handleOpacityUpdates(t){this.colorRecipe={...this.colorRecipe,opacity:t},this.isFeatureEnabled("opacity")&&this.handleRecipeUpdates(this.colorRecipe)}handleContrastUpdates(t){this.colorRecipe={...this.colorRecipe,contrast:t},this.isFeatureEnabled("contrast")&&this.handleRecipeUpdates(this.colorRecipe)}handleBrightnessUpdates(t){this.colorRecipe={...this.colorRecipe,brightness:t},this.isFeatureEnabled("brightness")&&this.handleRecipeUpdates(this.colorRecipe)}handleSaturationUpdates(t){this.colorRecipe={...this.colorRecipe,saturation:t},this.isFeatureEnabled("saturation")&&this.handleRecipeUpdates(this.colorRecipe)}handleRecipeUpdates(t){const n=this.store.selectSnapshot(G.i.getCurrentRecipe),{tintColor:i,saturation:o,contrast:r,brightness:l,opacity:p}=t,T={tintColor:this.isFeatureEnabled("tintColor")?i||[1,0,0]:void 0,saturation:this.isFeatureEnabled("saturation")?o||0:void 0,contrast:this.isFeatureEnabled("contrast")?r||0:void 0,brightness:this.isFeatureEnabled("brightness")?l||0:void 0,opacity:this.isFeatureEnabled("opacity")?p||100:void 0};(0,R.isEqual)(T,n)||this.store.dispatch(new D.WD(T))}isFeatureEnabled(t){return!0===this.form.get(`${t}Enabled`).value}isColorValueEnabled(t){return!(0,R.isNil)(t)&&!1!==t}}(bi=Ps).\u0275fac=function(t){return new(t||bi)(e.rXU(c.ze),e.rXU(a.il),e.rXU(e.gRc))},bi.\u0275cmp=e.VBU({type:bi,selectors:[["app-paint-widget-advanced"]],viewQuery:function(t,n){if(1&t&&(e.GBs(oh,7),e.GBs(sh,7),e.GBs(rh,7),e.GBs(ah,7),e.GBs(lh,7)),2&t){let i;e.mGM(i=e.lsd())&&(n.tintColorRef=i.first),e.mGM(i=e.lsd())&&(n.saturationRef=i.first),e.mGM(i=e.lsd())&&(n.contrastRef=i.first),e.mGM(i=e.lsd())&&(n.brightnessRef=i.first),e.mGM(i=e.lsd())&&(n.opacityRef=i.first)}},inputs:{label:"label"},decls:16,vars:26,consts:[["tintColorRef",""],["opacityRef",""],["saturationRef",""],["contrastRef",""],["brightnessRef",""],["autocomplete","off",3,"formGroup"],["label","Color","toggleType","checkbox","formControlName","tintColorEnabled"],["simpleMode","rgb","fresnelMode","color",3,"valueUpdated","value","min","max","fresnelMin","fresnelMax"],["label","Opacity","toggleType","checkbox","formControlName","opacityEnabled"],[3,"valueUpdated","value","min","max","fresnelMin","fresnelMax"],["label","Saturation","toggleType","checkbox","formControlName","saturationEnabled"],["label","Contrast","toggleType","checkbox","formControlName","contrastEnabled"],["label","Brightness","toggleType","checkbox","formControlName","brightnessEnabled"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"form",5)(1,"app-panel",6)(2,"app-paint-recipe",7,0),e.bIt("valueUpdated",function(r){return e.eBV(i),e.Njj(n.handleTintColorUpdates(r))}),e.k0s()(),e.j41(4,"app-panel",8)(5,"app-paint-recipe",9,1),e.bIt("valueUpdated",function(r){return e.eBV(i),e.Njj(n.handleOpacityUpdates(r))}),e.k0s()(),e.j41(7,"app-panel",10)(8,"app-paint-recipe",9,2),e.bIt("valueUpdated",function(r){return e.eBV(i),e.Njj(n.handleSaturationUpdates(r))}),e.k0s()(),e.j41(10,"app-panel",11)(11,"app-paint-recipe",9,3),e.bIt("valueUpdated",function(r){return e.eBV(i),e.Njj(n.handleContrastUpdates(r))}),e.k0s()(),e.j41(13,"app-panel",12)(14,"app-paint-recipe",9,4),e.bIt("valueUpdated",function(r){return e.eBV(i),e.Njj(n.handleBrightnessUpdates(r))}),e.k0s()()()}2&t&&(e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("value",n.colorRecipe.tintColor)("min",0)("max",255)("fresnelMin",0)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.opacity)("min",0)("max",100)("fresnelMin",0)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.saturation)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.contrast)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.brightness)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100))},dependencies:[c.qT,c.BC,c.cb,c.j4,c.JD,me.g,eh],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(G.i.getCurrentRecipe),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Ps.prototype,"colorRecipe$",void 0);var ch=v(43654),ph=v(15913);const ut={tintColor:[1,1,1],opacity:100,contrast:0,brightness:0,saturation:0};var _i;function uh(s,t){1&s&&(e.j41(0,"div",10)(1,"span",11),e.EFF(2,"Note:"),e.k0s(),e.EFF(3," The preset you have selected contains some settings that cannot be customized. "),e.k0s())}function hh(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-form-field",12)(1,"input",13),e.bIt("colorPickerChange",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleColorPickerChange(o))}),e.k0s()()}if(2&s){const n=e.XpG();e.R7$(),e.xc7("background",n.colorPickerHex),e.Y8G("colorPicker",n.colorPickerHex)("cpOutputFormat","hex")("cpAlphaChannel","disabled")("cpEyeDropper",!0)}}function fh(s,t){1&s&&(e.j41(0,"app-form-field",14),e.nrm(1,"app-slider",15),e.k0s()),2&s&&(e.R7$(),e.Y8G("min",0)("max",100))}class Rs{constructor(t,n,i){this.formBuilder=t,this.store=n,this.changeDetector=i,this.colorPickerHex="#ffffff",this.fresnelColor=!1,this.fresnelOpacity=!1,this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({tintColor:[[...ut.tintColor]],saturation:[ut.saturation],contrast:[ut.contrast],brightness:[ut.brightness],opacity:[ut.opacity]})}ngOnInit(){this.colorRecipe$.pipe((0,j.p)(t=>null!=t&&JSON.stringify(t)!==JSON.stringify(this.colorRecipe),(0,S.Q)(this.ngUnsubscribe))).subscribe(t=>{this.colorRecipe=t,this.fresnelColor=t.tintColor instanceof Ca.m,this.fresnelOpacity=t.opacity instanceof va.R,this.setFormValues(t),this.changeDetector.markForCheck()}),this.form.valueChanges.pipe((0,ph.s)(()=>(0,ch.O)(300)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleFormChanges(t)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){let n=ut.tintColor;Array.isArray(t.tintColor)&&(this.colorPickerHex=se.T.rgbToHex(t.tintColor,!0),n=t.tintColor);let i=ut.opacity;"number"==typeof t.opacity&&(i=t.opacity);let o=ut.contrast;"number"==typeof t.contrast&&(o=t.contrast);let r=ut.brightness;"number"==typeof t.brightness&&(r=t.brightness);let l=ut.saturation;"number"==typeof t.saturation&&(l=t.saturation),this.form.setValue({tintColor:n,saturation:l,contrast:o,brightness:r,opacity:i},{emitEvent:!1,onlySelf:!0})}handleFormChanges(t){const n={...this.colorRecipe};n.saturation=t.saturation,n.brightness=t.brightness,n.contrast=t.contrast,this.fresnelOpacity||(n.opacity=t.opacity),this.fresnelColor||(n.tintColor="string"==typeof t.tintColor?se.T.hexToRgb(t.tintColor,!0):t.tintColor),this.store.dispatch(new D.WD(n))}handleColorPickerChange(t){this.colorPickerHex=t,this.form.patchValue({tintColor:se.T.hexToRgb(t,!0)})}}(_i=Rs).\u0275fac=function(t){return new(t||_i)(e.rXU(c.ze),e.rXU(a.il),e.rXU(e.gRc))},_i.\u0275cmp=e.VBU({type:_i,selectors:[["app-paint-widget"]],inputs:{label:"label"},decls:10,vars:10,consts:[["autocomplete","off",3,"formGroup"],["class","pb-4 text-xs text-gray-400",4,"ngIf"],["label","Color",4,"ngIf"],["label","Opacity",4,"ngIf"],["label","Saturation"],["formControlName","saturation",3,"min","max"],["label","Contrast"],["formControlName","contrast",3,"min","max"],["label","Brightness"],["formControlName","brightness",3,"min","max"],[1,"pb-4","text-xs","text-gray-400"],[1,"font-bold"],["label","Color"],["type","text","cpPosition","left",1,"input",3,"colorPickerChange","colorPicker","cpOutputFormat","cpAlphaChannel","cpEyeDropper"],["label","Opacity"],["formControlName","opacity",3,"min","max"]],template:function(t,n){1&t&&(e.j41(0,"form",0),e.DNE(1,uh,4,0,"div",1)(2,hh,2,6,"app-form-field",2)(3,fh,2,2,"app-form-field",3),e.j41(4,"app-form-field",4),e.nrm(5,"app-slider",5),e.k0s(),e.j41(6,"app-form-field",6),e.nrm(7,"app-slider",7),e.k0s(),e.j41(8,"app-form-field",8),e.nrm(9,"app-slider",9),e.k0s()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.fresnelColor||n.fresnelOpacity),e.R7$(),e.Y8G("ngIf",!n.fresnelColor),e.R7$(),e.Y8G("ngIf",!n.fresnelOpacity),e.R7$(2),e.Y8G("min",-100)("max",100),e.R7$(2),e.Y8G("min",-100)("max",100),e.R7$(2),e.Y8G("min",-100)("max",100))},dependencies:[E.bT,Pn.bk,c.qT,c.BC,c.cb,c.j4,c.JD,ee.K,$e],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(G.i.getCurrentRecipe),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Rs.prototype,"colorRecipe$",void 0);var Ci,Ms=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},js=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function gh(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",t.$implicit)}function bh(s,t){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}function _h(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",t.$implicit)}function Ch(s,t){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}function vh(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",t.$implicit)}function yh(s,t){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}class vi{constructor(t,n){this.store=t,this.editPaintService=n,this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleRecipeClick(t){const n=(0,pt.H)(t);this.store.dispatch(new D.Hr),this.store.dispatch(new D.WD(n)),this.store.dispatch(new oe.pL(Q.s.Paint))}handleExport(t){const n=this.store.selectSnapshot(x.t.getStory).displayName||"Story Palette",i=this.store.selectSnapshot(G.i.getUniqueStoryRecipes).map(r=>(0,pt.H)(r)),o=new To(n);o.recipes=i,"copy"===t?this.editPaintService.copyPaletteToClipboard(o):this.editPaintService.downloadPalette(o)}}(Ci=vi).\u0275fac=function(t){return new(t||Ci)(e.rXU(a.il),e.rXU(xo))},Ci.\u0275cmp=e.VBU({type:Ci,selectors:[["app-paint-currently-used"]],decls:33,vars:21,consts:[["menu","matMenu"],["toggleType","arrow",3,"noPadding","open"],["panel-label","",1,"font-semibold","px-3","py-2"],[1,"font-semibold","flex","items-center",2,"min-height","36px"],["panel-actions","","appEventFence","",1,"py-2"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[1,"px-3","pb-2"],["tabSize","small","tabTheme","dark"],["label","This Model"],[1,"paint-currently-used","px-1"],["app-paint-swatch","","class","mr-2 mb-2",3,"engineRecipe","click",4,"ngFor","ngForOf"],["class","p-2",4,"ngIf"],["label","This Chapter"],["label","Recent"],["mat-menu-item","",3,"click"],["app-paint-swatch","",1,"mr-2","mb-2",3,"click","engineRecipe"],[1,"p-2"],[1,"text-2xs","text-gray-400","italic"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-panel",1)(1,"div",2)(2,"div",3),e.EFF(3,"Recent"),e.k0s()(),e.j41(4,"div",4)(5,"button",5),e.nrm(6,"app-icon",6),e.k0s()(),e.j41(7,"div",7)(8,"app-tabs",8)(9,"app-tab",9)(10,"div",10),e.DNE(11,gh,1,1,"button",11),e.nI1(12,"async"),e.k0s(),e.DNE(13,bh,3,0,"div",12),e.nI1(14,"async"),e.k0s(),e.j41(15,"app-tab",13)(16,"div",10),e.DNE(17,_h,1,1,"button",11),e.nI1(18,"async"),e.k0s(),e.DNE(19,Ch,3,0,"div",12),e.nI1(20,"async"),e.k0s(),e.j41(21,"app-tab",14)(22,"div",10),e.DNE(23,vh,1,1,"button",11),e.nI1(24,"async"),e.k0s(),e.DNE(25,yh,3,0,"div",12),e.nI1(26,"async"),e.k0s()()()(),e.j41(27,"mat-menu",null,0)(29,"button",15),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleExport("copy"))}),e.EFF(30," Copy this model's palette to clipboard "),e.k0s(),e.j41(31,"button",15),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleExport("download"))}),e.EFF(32,"Download this model's palette"),e.k0s()()}if(2&t){let i,o,r;const l=e.sdS(28);e.Y8G("noPadding",!0)("open",!0),e.R7$(5),e.Y8G("matMenuTriggerFor",l),e.R7$(6),e.Y8G("ngForOf",e.bMT(12,9,n.uniqueStoryRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(i=e.bMT(14,11,n.uniqueStoryRecipes$))&&i.length)),e.R7$(4),e.Y8G("ngForOf",e.bMT(18,13,n.chapterRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(o=e.bMT(20,15,n.chapterRecipes$))&&o.length)),e.R7$(4),e.Y8G("ngForOf",e.bMT(24,17,n.recentRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(r=e.bMT(26,19,n.recentRecipes$))&&r.length))}},dependencies:[E.Sq,E.bT,$.kk,$.fb,$.Cp,L.Q,Gn.L,Y.R,Pt.j,Rt.O,me.g,Ht,E.Jj],styles:[".paint-currently-used[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"],changeDetection:0}),Ms([(0,a.l6)(G.i.getRecentRecipes),js("design:type",u.c)],vi.prototype,"recentRecipes$",void 0),Ms([(0,a.l6)(G.i.getUniqueStoryRecipes),js("design:type",u.c)],vi.prototype,"uniqueStoryRecipes$",void 0),Ms([(0,a.l6)(G.i.getCurrentChapterRecipes),js("design:type",u.c)],vi.prototype,"chapterRecipes$",void 0);var fn=v(76774);let Is=(()=>{var s;class t{constructor(i){this.store=i}duplicateChapter(i){const o=(0,Br.G)(),l=this.store.selectSnapshot(O.B.particleSystemsForChapter(i.id)).map(ge=>new ae.u.AssignParticle(ge.id,o));this.store.dispatch(l);const p=this.store.selectSnapshot(O.B.getTweenParticleLookup)[i.id];void 0!==p&&this.store.dispatch(new ae.u.SetLookupForChapter(o,p)),this.store.selectSnapshot(Ue.y.getChapterLabels).forEach(ge=>{this.store.dispatch(new ye.Sh({...(0,R.cloneDeep)(ge),id:Ze.u.idWithPrefix("label"),chapterId:o},!1))}),this.store.selectSnapshot(fe.j.getQuizQuestionsByChapter(i.id)).forEach(ge=>{const Se=Ze.u.idWithPrefix("question"),We=(0,fn.z9)(ge,Se,o);this.store.dispatch(new Fe.B.AddQuestion(We))});const H=this.store.selectSnapshot(x.t.getStory);this.store.dispatch([new re.q9(!1),new re.rg(i.id,o),new V.PA(H,i,o)])}removeChapter(i){void 0!==this.store.selectSnapshot(O.B.getTweenParticleLookup)[i.id]&&this.store.dispatch(new ae.u.DeleteChapterLookup(i.id)),this.store.dispatch(new V.YA(i))}}return(s=t).\u0275fac=function(i){return new(i||s)(e.KVO(a.il))},s.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),t})();function kh(s,t){if(1&s&&(e.j41(0,"tr")(1,"td",6),e.EFF(2),e.k0s()()),2&s){const n=e.XpG();e.R7$(2),e.JRh(n.recipe.label)}}function Sh(s,t){if(1&s&&(e.j41(0,"tr")(1,"td",7),e.EFF(2),e.k0s(),e.j41(3,"td",8),e.EFF(4),e.k0s()()),2&s){const n=t.$implicit;e.R7$(2),e.JRh(n.label),e.R7$(2),e.JRh(n.value)}}let Th=(()=>{var s;class t{get recipe(){return this._recipe}set recipe(i){this._recipe=i,this.values=this.recipe?this.getValues(this.recipe):[]}constructor(){this.values=[]}ngOnInit(){}getValues(i){return[{label:"Color",value:ze(i.tintColor)},{label:"Saturation",value:ze(i.saturation)},{label:"Contrast",value:ze(i.contrast)},{label:"Brightness",value:ze(i.brightness)},{label:"Opacity",value:ze(i.opacity)}].filter(o=>""!=o.value)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-recipe-summary"]],inputs:{recipe:"recipe"},decls:6,vars:4,consts:[[1,"edit-recipe-summary"],["size","large",3,"recipe","highlightSelected"],[1,"edit-recipe-summary__details"],[1,"w-full"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","2",1,"px-2","pb-1","italic"],[1,"px-2","pb-1","w-1/2","font-semibold"],[1,"px-1","pb-1","w-1/2"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.nrm(1,"app-paint-swatch",1),e.j41(2,"div",2)(3,"table",3),e.DNE(4,kh,3,1,"tr",4)(5,Sh,5,2,"tr",5),e.k0s()()()),2&i&&(e.R7$(),e.Y8G("recipe",o.recipe)("highlightSelected",!1),e.R7$(3),e.Y8G("ngIf",o.recipe.label),e.R7$(),e.Y8G("ngForOf",o.values))},dependencies:[E.Sq,E.bT,Ht],styles:[".edit-recipe-summary[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px 0;align-items:flex-start;font-size:.625rem;line-height:.75rem}.edit-recipe-summary__details[_ngcontent-%COMP%]{flex-grow:1;max-height:160px;overflow-y:auto}.theme-light[_nghost-%COMP%]   .edit-recipe-summary[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .edit-recipe-summary[_ngcontent-%COMP%]{color:#101823}"],changeDetection:0}),t})();var yi;function wh(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleAddToPalette(o))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit;e.R7$(),e.SpI(" Add to ",n.label," ")}}function Fh(s,t){1&s&&e.nrm(0,"mat-divider")}class Ns{get recipe(){return this._recipe}set recipe(t){this._recipe=t}constructor(t,n,i,o){this.store=t,this.dialog=n,this.snackbar=i,this.editService=o,this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleAddToPalette(t){this.store.dispatch(new D.yJ(this.recipe,t.id)),this.store.dispatch(new D.wx(t.id,!0)),this.snackbar.open(`Successfully added to '${t.label}' palette.`)}handleNewPalette(){const t=new To;t.recipes.push(this.recipe),this.dialog.open(Es,{width:"480px",data:{palette:t}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(i=>!(0,R.isNil)(i))).subscribe(i=>{this.store.dispatch(new D.hd(i))})}}function Ph(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleRecipeClick(o))}),e.k0s()}if(2&s){const n=t.$implicit;e.Y8G("label",n.label)("recipe",n)}}(yi=Ns).\u0275fac=function(t){return new(t||yi)(e.rXU(a.il),e.rXU(Z.bZ),e.rXU(Le.UG),e.rXU(Is))},yi.\u0275cmp=e.VBU({type:yi,selectors:[["app-edit-paint-panel"]],inputs:{recipe:"recipe"},decls:13,vars:8,consts:[["paletteMenu","matMenu"],[1,"edit-paint-panel"],[1,"grow",3,"recipe"],[1,"flex","flex-col"],["app-button","","buttonType","outline","buttonSize","sm","buttonShape","square","matTooltip","Add to Palette","matTooltipPosition","above","data-test","addToPaletteButton",1,"pb-2",3,"matMenuTriggerFor"],["icon","plus"],["yPosition","above"],["mat-menu-item","","data-test","addToExistingPalette",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-menu-item","","data-test","addPaintToNewPaletteButton",3,"click"],["mat-menu-item","","data-test","addToExistingPalette",3,"click"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",1),e.nrm(1,"app-edit-recipe-summary",2),e.j41(2,"div",3)(3,"button",4),e.nrm(4,"app-icon",5),e.k0s()()(),e.j41(5,"mat-menu",6,0),e.DNE(7,wh,2,1,"button",7),e.nI1(8,"async"),e.DNE(9,Fh,1,0,"mat-divider",8),e.nI1(10,"async"),e.j41(11,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleNewPalette())}),e.EFF(12," Add to New Palette... "),e.k0s()()}if(2&t){let i;const o=e.sdS(6);e.R7$(),e.Y8G("recipe",n.recipe),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(4),e.Y8G("ngForOf",e.bMT(8,4,n.palettes$)),e.R7$(2),e.Y8G("ngIf",null==(i=e.bMT(10,6,n.palettes$))?null:i.length)}},dependencies:[E.Sq,E.bT,$.kk,$.fb,$.Cp,Ce.oV,Qe.q,L.Q,Y.R,Th,E.Jj],styles:[".edit-paint-panel[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px 12px;align-items:flex-start}.edit-paint-panel__list[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px;font-size:.625rem;line-height:.75rem;column-count:2;column-gap:8px;column-width:50%}.edit-paint-panel__item[_ngcontent-%COMP%]{padding-bottom:4px}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(G.i.getPalettes),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Ns.prototype,"palettes$",void 0);let Rh=(()=>{var s;class t{get palette(){return this._palette}set palette(i){this._palette=i}constructor(i,o,r){this.dialog=i,this.store=o,this.editPaintService=r,this.ngUnsubscribe=new b.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleEdit(i){this.dialog.open(Es,{width:"480px",data:{palette:i}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(r=>!(0,R.isNil)(r))).subscribe(r=>{this.store.dispatch(new D.ut(r))})}handleRemove(i){this.editPaintService.removePalette(i)}handleExport(i){this.editPaintService.copyPaletteToClipboard(i)}handleDownload(i){this.editPaintService.downloadPalette(i)}handlePanelOpened(i,o){const r=this.store.selectSnapshot(G.i.getPalettes),l=r.findIndex(p=>p.id===o);l>=0&&(r[l].open=i),this.store.dispatch(new D.T2(r))}handleRecipeClick(i){this.editPaintService.selectRecipe(i)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(Z.bZ),e.rXU(a.il),e.rXU(xo))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-palette-panel"]],inputs:{palette:"palette"},decls:20,vars:6,consts:[["menu","matMenu"],["toggleType","arrow","data-test","palettePanel",3,"opened","open","noPadding"],["panel-label","",1,"font-semibold","px-3","py-2"],["data-test","palettePanelLabel"],["panel-actions","","appEventFence","",1,"py-2"],["app-button","","data-test","palettePanelMenuButton",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[1,"flex","flex-wrap","px-3","pb-2"],["app-paint-swatch","","class","mr-2 mb-2",3,"label","recipe","click",4,"ngFor","ngForOf"],["mat-menu-item","","data-test","palettePanelEditButton",3,"click"],["mat-menu-item","","data-test","palettePanelRemoveButton",3,"click"],["mat-menu-item","","data-test","palettePanelCopyButton",3,"click"],["mat-menu-item","","data-test","palettePanelDownloadButton",3,"click"],["app-paint-swatch","",1,"mr-2","mb-2",3,"click","label","recipe"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"app-panel",1),e.bIt("opened",function(p){return e.eBV(r),e.Njj(o.handlePanelOpened(p,o.palette.id))}),e.j41(1,"div",2)(2,"span",3),e.EFF(3),e.k0s()(),e.j41(4,"div",4)(5,"button",5),e.nrm(6,"app-icon",6),e.k0s()(),e.j41(7,"div",7),e.DNE(8,Ph,1,2,"button",8),e.k0s()(),e.j41(9,"mat-menu",null,0)(11,"button",9),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleEdit(o.palette))}),e.EFF(12," Manage Palette... "),e.k0s(),e.j41(13,"button",10),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleRemove(o.palette))}),e.EFF(14," Remove... "),e.k0s(),e.nrm(15,"mat-divider"),e.j41(16,"button",11),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleExport(o.palette))}),e.EFF(17," Copy palette to clipboard "),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleDownload(o.palette))}),e.EFF(19," Download palette "),e.k0s()()}if(2&i){const r=e.sdS(10);e.Y8G("open",o.palette.open)("noPadding",!0),e.BMQ("data-test-value",o.palette.id),e.R7$(3),e.JRh(o.palette.label),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(3),e.Y8G("ngForOf",o.palette.recipes)}},dependencies:[E.Sq,$.kk,$.fb,$.Cp,Qe.q,L.Q,Gn.L,Y.R,me.g,Ht],styles:[".palette__button[_ngcontent-%COMP%]{cursor:pointer;width:24px;height:24px;display:inline-flex;justify-content:center;align-items:center;background:none;border:none;margin:0;padding:0}"],changeDetection:0}),t})();var ki,gn=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},bn=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Mh(s,t){1&s&&e.nrm(0,"app-edit-palette-panel",20),2&s&&e.Y8G("palette",t.$implicit)}function jh(s,t){1&s&&e.nrm(0,"app-paint-widget")}function Ih(s,t){if(1&s&&(e.j41(0,"app-column-group",21,1),e.qex(2,13),e.j41(3,"div",22),e.DNE(4,jh,1,0,"app-paint-widget",19),e.k0s(),e.bVm(),e.k0s()),2&s){const n=e.sdS(1);e.R7$(4),e.Y8G("ngIf",n.isActive)}}function Nh(s,t){1&s&&e.nrm(0,"app-paint-widget-advanced")}function Bh(s,t){if(1&s&&(e.j41(0,"app-column-group",21,2),e.qex(2,13),e.DNE(3,Nh,1,0,"app-paint-widget-advanced",19),e.bVm(),e.k0s()),2&s){const n=e.sdS(1);e.R7$(3),e.Y8G("ngIf",n.isActive)}}function Dh(s,t){if(1&s&&(e.nrm(0,"app-edit-paint-panel",23),e.nI1(1,"async")),2&s){const n=e.XpG();e.Y8G("recipe",e.bMT(1,1,n.currentRecipe$))}}function Gh(s,t){if(1&s){const n=e.RV6();e.qex(0),e.nrm(1,"app-selected-nodes-panel"),e.j41(2,"button",24),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handlePaintNodesClick())}),e.EFF(3," Apply Paint "),e.k0s(),e.bVm()}}class jt{constructor(t,n,i,o,r){this.store=t,this.actions=n,this.changeDetector=i,this.editPaintService=o,this.nodeService=r,this.activeToolEnum=Q.s,this.application=Me.c,this.ngUnsubscribe=new b.B}ngOnInit(){this.initInitialRecipe(),this.bindApplicationEvents()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initInitialRecipe(){null==this.store.selectSnapshot(G.i.getCurrentRecipe)&&this.store.dispatch(new D.WD(qt.Rn))}bindApplicationEvents(){this.actions.pipe((0,a.xi)(oe.zE),(0,j.p)(()=>{const t=this.store.selectSnapshot(_.S.getActiveTool);return[Q.s.Paint,Q.s.Eyedropper].includes(t)}),(0,j.p)(t=>null!=t.node&&!t.event.srcEvent.shiftKey),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(this.store.selectSnapshot(_.S.getActiveTool)){case Q.s.Eyedropper:this.handleEyeDropperNodeClicked(t);break;case Q.s.Paint:this.handlePaintNodeClicked(t)}}),this.selectedChapter$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.interactive=t.readyState.model,this.changeDetector.markForCheck()})}handleRecipeClick(t){this.editPaintService.selectRecipe(t)}handleClickTool(t){this.store.dispatch(new oe.pL(t))}handleClearChapterPaint(){const t=this.store.selectSnapshot(ve.z.getNodeIds);this.store.dispatch(new re.Jp(qt.NR,t))}handleImportPalette(){this.editPaintService.openImportPalette()}handlePaintNodesClick(){const t=this.store.selectSnapshot(ve.z.getCheckedNodeIds);this.nodeService.applyCurrentRecipe(t)}handleEyeDropperNodeClicked(t){const n=this.store.selectSnapshot(ve.z.getNodePaint)(t.node.id),i=(0,pt.Sf)(n);(0,ln.Jl)(i)?this.store.dispatch(new D.WD(n)):this.store.dispatch(new D.WD(qt.NR))}handlePaintNodeClicked(t){this.nodeService.applyCurrentRecipe([t.node.id])}handleNext(){this.store.dispatch(new w.$j)}handlePrevious(){this.store.dispatch(new w.hE)}handleEyedropperClick(){const t=this.store.selectSnapshot(_.S.getActiveTool)===Q.s.Eyedropper?Q.s.Paint:Q.s.Eyedropper;this.store.dispatch(new oe.pL(t))}}(ki=jt).\u0275fac=function(t){return new(t||ki)(e.rXU(a.il),e.rXU(a.En),e.rXU(e.gRc),e.rXU(xo),e.rXU(Kr.w))},ki.\u0275cmp=e.VBU({type:ki,selectors:[["app-edit-paint-context"]],decls:30,vars:16,consts:[["paintMenu","matMenu"],["customColorGroup",""],["advancedColorGroup",""],[3,"loading"],["column-label",""],["column-actions",""],["app-button","",3,"click","buttonType"],["icon","eye-dropper"],["app-button","","data-test","paintMenuButton",1,"context__actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","importPaletteButton",3,"click"],["label","Paints"],["column-group-body",""],[3,"palette",4,"ngFor","ngForOf"],["label","Customize",4,"appFlagApplication"],["column-footer",""],[1,"pb-4","ph-4"],[3,"recipe",4,"ngIf"],[4,"ngIf"],[3,"palette"],["label","Customize"],[1,"p-3"],[3,"recipe"],["buttonType","outline","app-button","","data-test","applyPaintButton",1,"w-full","mt-2",3,"click"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column",3)(1,"div",4),e.EFF(2,"Paint"),e.k0s(),e.j41(3,"div",5)(4,"button",6),e.nI1(5,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleEyedropperClick())}),e.nrm(6,"app-icon",7),e.k0s(),e.j41(7,"button",8),e.nrm(8,"app-icon",9),e.k0s(),e.j41(9,"mat-menu",null,0)(11,"button",10),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleClearChapterPaint())}),e.EFF(12,"Clear this chapter's paint"),e.k0s(),e.nrm(13,"mat-divider"),e.j41(14,"button",11),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleImportPalette())}),e.EFF(15," Import Palette... "),e.k0s()()(),e.j41(16,"app-column-group",12),e.qex(17,13),e.nrm(18,"app-paint-presets")(19,"app-paint-currently-used"),e.DNE(20,Mh,1,1,"app-edit-palette-panel",14),e.nI1(21,"async"),e.bVm(),e.k0s(),e.DNE(22,Ih,5,1,"app-column-group",15)(23,Bh,4,1,"app-column-group",15),e.j41(24,"div",16)(25,"div",17),e.DNE(26,Dh,2,3,"app-edit-paint-panel",18),e.nI1(27,"async"),e.DNE(28,Gh,4,0,"ng-container",19),e.nI1(29,"async"),e.k0s()()()}if(2&t){const i=e.sdS(10);e.Y8G("loading",!n.interactive),e.R7$(4),e.Y8G("buttonType",e.bMT(5,8,n.activeTool$)===n.activeToolEnum.Eyedropper?"info":"default"),e.R7$(3),e.Y8G("matMenuTriggerFor",i),e.R7$(13),e.Y8G("ngForOf",e.bMT(21,10,n.palettes$)),e.R7$(2),e.Y8G("appFlagApplication",n.application.Studio),e.R7$(),e.Y8G("appFlagApplication",n.application.Loft),e.R7$(3),e.Y8G("ngIf",e.bMT(27,12,n.currentRecipe$)),e.R7$(2),e.Y8G("ngIf",e.bMT(29,14,n.checkedNodesCount$)>0)}},dependencies:[E.Sq,E.bT,$.kk,$.fb,$.Cp,Qe.q,L.Q,mt,st,Mn.Y,Y.R,ws,Fs,Ps,Rs,vi,Ns,Rh,E.Jj],changeDetection:0}),gn([(0,a.l6)(_.S.getActiveTool),bn("design:type",u.c)],jt.prototype,"activeTool$",void 0),gn([(0,a.l6)(ve.z.getCheckedNodesCount),bn("design:type",u.c)],jt.prototype,"checkedNodesCount$",void 0),gn([(0,a.l6)(G.i.getCurrentRecipe),bn("design:type",u.c)],jt.prototype,"currentRecipe$",void 0),gn([(0,a.l6)(G.i.getPalettes),bn("design:type",u.c)],jt.prototype,"palettes$",void 0),gn([(0,a.l6)(I.N.getSelectedChapterId),bn("design:type",u.c)],jt.prototype,"selectedChapterId$",void 0),gn([(0,a.l6)(I.N.getSelectedChapter),bn("design:type",u.c)],jt.prototype,"selectedChapter$",void 0);var Bs=v(71441),Si=v(62751),Ds=v(91003),Gs=v(15185),ya=v(93455);function $h(s,t){1&s&&e.nrm(0,"app-spinner",9)}function Oh(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.openPositions())}),e.EFF(1," Open Positions "),e.k0s()}}var _n=function(s){return s.Starting="starting",s.Additional="additional",s}(_n||{});let $s=(()=>{var s;class t{constructor(i,o,r){this.store=i,this.snackbar=o,this.positionsService=r,this.mode=_n.Starting,this.buttonSize="md",this.openPositionsOption=!1,this.additionalPositionCaptured=new e.bkB,this.savingThumbnail=(0,e.vPA)(!1)}get tooltipText(){return this.mode===_n.Starting?"Click to capture your starting position. When viewers enter the chapter, this is what they'll see.":""}handleCaptureClick(i,o){var r=this;return(0,ct.A)(function*(){let l,p;const T=[];i&&(l=r.captureCamera(),T.push("position")),o&&(p=yield r.captureThumbnail(),T.push("thumbnail")),r.mode===_n.Additional&&r.additionalPositionCaptured.emit({camera:l,thumbnail:p}),r.snackbar.open(`Successfully captured chapter ${r.mode} ${T.join(" and ")}.`)})()}openPositions(){this.store.dispatch(new oe.pL(Q.s.Positions)),this.store.dispatch(new w.yF(F.x.Positions))}captureThumbnail(){var i=this;return(0,ct.A)(function*(){if(i.mode!==_n.Starting){i.savingThumbnail.set(!0);const o=yield i.positionsService.captureAdditionalPositionThumbnail(),r=new ya.V;return r.urls=o,i.savingThumbnail.set(!1),r}i.positionsService.captureStartingPositionThumbnail(i.chapter.id)})()}captureCamera(){if(this.mode!==_n.Starting)return{...this.positionsService.getCamera(),action:Si.L.FlyTo};this.positionsService.captureStartingPositionCamera(this.chapter.id)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(a.il),e.rXU(Le.UG),e.rXU(Ds.c))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-capture-position"]],inputs:{mode:"mode",chapter:"chapter",buttonSize:"buttonSize",openPositionsOption:"openPositionsOption"},outputs:{additionalPositionCaptured:"additionalPositionCaptured"},decls:15,vars:8,consts:[["captureMenu","matMenu"],["render","block",1,"w-full"],["app-button","","buttonTheme","dark","buttonType","outline","matTooltipPosition","below","data-test","captureThumbnail",1,"grow",3,"click","buttonSize","matTooltip","disabled"],[1,"flex","items-center","justify-center"],["render","block","size","small","class","mr-2 theme-dark",4,"ngIf"],["app-button","","buttonTheme","dark","buttonType","outline","buttonShape","square",3,"buttonSize","matMenuTriggerFor","disabled"],["icon","caret-down"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["render","block","size","small",1,"mr-2","theme-dark"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"app-button-group",1)(1,"button",2),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleCaptureClick(!0,!0))}),e.j41(2,"div",3),e.DNE(3,$h,1,0,"app-spinner",4),e.j41(4,"span"),e.EFF(5,"Capture"),e.k0s()()(),e.j41(6,"button",5),e.nrm(7,"app-icon",6),e.k0s()(),e.j41(8,"mat-menu",null,0)(10,"button",7),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleCaptureClick(!0,!1))}),e.EFF(11,"Capture Position Only"),e.k0s(),e.j41(12,"button",7),e.bIt("click",function(){return e.eBV(r),e.Njj(o.handleCaptureClick(!1,!0))}),e.EFF(13,"Capture Thumbnail Only"),e.k0s(),e.DNE(14,Oh,2,0,"button",8),e.k0s()}if(2&i){const r=e.sdS(9);e.R7$(),e.Y8G("buttonSize",o.buttonSize)("matTooltip",o.tooltipText)("disabled",o.savingThumbnail()),e.R7$(2),e.Y8G("ngIf",o.savingThumbnail()),e.R7$(3),e.Y8G("buttonSize",o.buttonSize)("matMenuTriggerFor",r)("disabled",o.savingThumbnail()),e.R7$(8),e.Y8G("ngIf",o.openPositionsOption)}},dependencies:[L.Q,un,E.bT,Y.R,$.kk,$.fb,$.Cp,Ce.oV,an.tI],changeDetection:0}),t})();var Ti;const Vh=["position"];function Lh(s,t){1&s&&(e.j41(0,"div",11),e.EFF(1," Use the 3D controls to adjust your viewing angle as desired, and click "),e.j41(2,"span",12),e.EFF(3,"Add New Position"),e.k0s(),e.EFF(4," below to save. "),e.k0s())}function Yh(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",13,0)(2,"app-panel",14),e.bIt("opened",function(o){const r=e.eBV(n).index,l=e.XpG();return e.Njj(l.handleOpened(o,r))}),e.qex(3,15),e.j41(4,"div",16),e.nrm(5,"app-thumbnail-view",17),e.k0s(),e.bVm(),e.j41(6,"span",18)(7,"button",19),e.nrm(8,"app-icon",20),e.k0s(),e.j41(9,"mat-menu",null,1)(11,"button",21),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.copyPosition(o))}),e.EFF(12,"Copy Position"),e.k0s(),e.j41(13,"button",22),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.pastePosition(o))}),e.EFF(14," Paste Position "),e.k0s(),e.nrm(15,"mat-divider"),e.j41(16,"button",21),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.removePosition(o))}),e.EFF(17,"Remove"),e.k0s()()(),e.j41(18,"app-form-field",23),e.nrm(19,"input",24,2)(21,"app-character-counter",25),e.k0s(),e.j41(22,"app-capture-position",26),e.bIt("additionalPositionCaptured",function(o){const r=e.eBV(n).index,l=e.XpG();return e.Njj(l.handleAdditionalPositionCaptured(o,r))}),e.k0s()()()}if(2&s){const n=t.$implicit,i=t.index,o=e.sdS(10),r=e.sdS(20),l=e.XpG();e.Y8G("formGroup",n),e.R7$(2),e.Y8G("label",n.value.title)("open",i===l.openedIndex()),e.R7$(3),e.Y8G("thumbnail",n.value.thumbnail),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.Y8G("disabled",!l.additionalPositionClipboard()),e.R7$(6),e.Y8G("maxLength",60),e.R7$(2),e.Y8G("field",r)}}function zh(s,t){1&s&&e.nrm(0,"app-spinner",27)}class Os{get positionsBlockPositions(){return this.controlContainer.control.get("positions")}constructor(t,n,i,o,r){this.controlContainer=t,this.formBuilder=n,this.positionsService=i,this.snackbar=o,this.store=r,this.openedIndex=(0,e.vPA)(-1),this.savingThumbnail=(0,e.vPA)(!1),this.additionalPositionClipboard=(0,e.vPA)(this.positionsService.additionalPositionClipboard),this.ngUnsubscribe=new b.B}ngOnInit(){this.selectedChapterId$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.openedIndex.set(-1)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}trackPositionsControls(t,n){return n.value.thumbnail.urls.large}handleImageDrop(t){const{previousIndex:n,currentIndex:i}=t,o=this.positionsBlockPositions.at(n);this.positionsBlockPositions.removeAt(n,{emitEvent:!1}),this.positionsBlockPositions.insert(i,o)}handleOpened(t,n){if(this.openedIndex.set(t?n:-1),t){const i=this.positionsBlockPositions.at(n).value;this.store.dispatch(new Et.Ih(i.camera.location,i.camera.action===Si.L.FlyTo,void 0,i.camera.rotationCenter))}}handleAdditionalPositionCaptured(t,n){const{camera:i,thumbnail:o}=t,r=this.positionsBlockPositions.at(n);if(i&&r.patchValue({camera:i},{emitEvent:!o}),o){const{urls:l}=o;r.get("thumbnail").patchValue({urls:l},{emitEvent:!0})}}copyPosition(t){const n=this.positionsBlockPositions.at(t).value;this.positionsService.copyAdditionalPosition(n),this.additionalPositionClipboard.set(this.positionsService.additionalPositionClipboard),this.snackbar.open("Copied additional position.")}pastePosition(t){this.additionalPositionClipboard()&&(this.positionsBlockPositions.at(t).patchValue({...this.additionalPositionClipboard()}),this.positionsService.additionalPositionClipboard=null,this.additionalPositionClipboard.set(null),this.snackbar.open("Additional position successfully pasted."))}removePosition(t){this.positionsBlockPositions.removeAt(t)}addPosition(){var t=this;return(0,ct.A)(function*(){const n=yield t.createNewPosition();t.positionsBlockPositions.push(t.formBuilder.group({title:[n.title,c.k0.maxLength(60)],thumbnail:t.formBuilder.group({urls:n.thumbnail.urls}),camera:n.camera})),setTimeout(()=>{t.positions.last.nativeElement.scrollIntoView(),t.handleOpened(!0,t.positionsBlockPositions.length-1)},0)})()}createNewPosition(){var t=this;return(0,ct.A)(function*(){t.savingThumbnail.set(!0);const n=yield t.positionsService.captureAdditionalPositionThumbnail();t.savingThumbnail.set(!1);const i=new ya.V;i.urls=n;const o=t.positionsService.getCamera(),r=new Bs.q,l=`Position ${t.positionsBlockPositions.length+1}`;return r.camera={...o,action:Si.L.FlyTo},r.title=l,r.thumbnail=i,r})()}}(Ti=Os).\u0275fac=function(t){return new(t||Ti)(e.rXU(c.ZU),e.rXU(c.ze),e.rXU(Ds.c),e.rXU(Le.UG),e.rXU(a.il))},Ti.\u0275cmp=e.VBU({type:Ti,selectors:[["app-edit-positions-block"]],viewQuery:function(t,n){if(1&t&&e.GBs(Vh,5),2&t){let i;e.mGM(i=e.lsd())&&(n.positions=i)}},decls:10,vars:6,consts:[["position",""],["labelMenu","matMenu"],["title",""],[3,"formGroup"],["class","text-xs ml-3 my-3",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","positions",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block",3,"formGroup",4,"ngFor","ngForOf","ngForTrackBy"],[1,"edit-positions-block__add"],["app-button","","buttonType","flat",1,"w-full",3,"click","disabled"],[1,"flex","items-center","justify-center"],["render","block","size","small","class","mr-2 theme-dark",4,"ngIf"],[1,"text-xs","ml-3","my-3"],[1,"font-bold"],["cdkDrag","",1,"edit-block",3,"formGroup"],["toggleType","arrow",3,"opened","label","open"],["panel-prefix",""],[1,"edit-block__thumbnail"],[3,"thumbnail"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],["label","Title"],["type","text","formControlName","title","placeholder","Enter a response",1,"input",3,"maxLength"],[3,"field"],["buttonSize","md","mode","additional",1,"flex","w-full","mt-4",3,"additionalPositionCaptured"],["render","block","size","small",1,"mr-2","theme-dark"]],template:function(t,n){1&t&&(e.qex(0,3),e.DNE(1,Lh,5,0,"div",4),e.j41(2,"div",5),e.bIt("cdkDropListDropped",function(o){return n.handleImageDrop(o)}),e.DNE(3,Yh,23,8,"div",6),e.k0s(),e.j41(4,"div",7)(5,"button",8),e.bIt("click",function(){return n.addPosition()}),e.j41(6,"div",9),e.DNE(7,zh,1,0,"app-spinner",10),e.j41(8,"span"),e.EFF(9,"Add New Position"),e.k0s()()()(),e.bVm()),2&t&&(e.Y8G("formGroup",n.controlContainer.control),e.R7$(),e.Y8G("ngIf",0===n.positionsBlockPositions.controls.length),e.R7$(2),e.Y8G("ngForOf",n.positionsBlockPositions.controls)("ngForTrackBy",n.trackPositionsControls),e.R7$(2),e.Y8G("disabled",n.savingThumbnail()),e.R7$(2),e.Y8G("ngIf",n.savingThumbnail()))},dependencies:[E.Sq,E.bT,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,ee.K,Ft.P,Y.R,te.O7,te.T1,L.Q,$.kk,$.fb,$.Cp,Qe.q,an.tI,me.g,Gs.J,$s],styles:[".edit-block__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-right:12px}.edit-positions-block__add[_ngcontent-%COMP%]{padding:8px 0 8px 12px;background:#131c2a;position:sticky;bottom:0;z-index:1000}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(I.N.getSelectedChapterId),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Os.prototype,"selectedChapterId$",void 0);var xi,As=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Us=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Xh(s,t){1&s&&(e.qex(0),e.EFF(1," to This Chapter"),e.bVm())}function Qh(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"button",22),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.pasteStartingPosition(!0))}),e.EFF(2," Paste Starting Position to All Chapters "),e.k0s(),e.bVm()}if(2&s){const n=e.XpG();e.R7$(),e.Y8G("disabled",!n.startingPositionClipboard())}}function qh(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"button",22),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.copyAdditionalPositions())}),e.EFF(2," Copy This Chapter's Additional Positions "),e.k0s(),e.j41(3,"button",22),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.pasteAdditionalPositions())}),e.EFF(4," Paste Additional Positions To This Chapter "),e.k0s(),e.j41(5,"button",22),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.pasteAdditionalPositions(!0))}),e.EFF(6," Paste Additional Positions To All Chapters "),e.k0s(),e.nrm(7,"mat-divider"),e.bVm()}if(2&s){const n=e.XpG();e.R7$(),e.Y8G("disabled",!n.hasAdditionalPositions),e.R7$(2),e.Y8G("disabled",!n.additionalPositionsClipboard()),e.R7$(2),e.Y8G("disabled",!n.additionalPositionsClipboard())}}class Ei{constructor(t,n,i,o,r,l){this.store=t,this.actions=n,this.positionsService=i,this.contentBlocksService=o,this.formBuilder=r,this.snackbar=l,this.interactive=!1,this.startingPositionClipboard=(0,e.vPA)(this.positionsService.startingPositionClipboard),this.additionalPositionsClipboard=(0,e.vPA)(this.positionsService.additionalPositionsClipboard),this.isLoft=we.c.application===Me.c.Loft,this.ngUnsubscribe=new b.B}get positionsBlock(){return this.additionalPositionsForm.get("positionsBlock")}get positions(){return this.positionsBlock.get("positions")}get hasAdditionalPositions(){return this.positions.length>0}ngOnInit(){this.initForms(),this.initChapterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleOpened(t){if(t){const n=this.store.selectSnapshot(I.N.getSelectedChapter);this.store.dispatch(new Et.Ih(n.camera.location,n.camera.action===Si.L.FlyTo,void 0,n.camera.rotationCenter))}}copyStartingPosition(){const t=this.store.selectSnapshot(I.N.getSelectedChapterId),n=this.positionsService.copyStartingPosition(t);n&&this.startingPositionClipboard.set(this.positionsService.startingPositionClipboard),this.snackbar.open(n?"Copied starting position.":"Unable to copy starting position. Missing camera or thumbnail.")}pasteStartingPosition(t=!1){const n=this.positionsService.pasteStartingPosition(t);n>0&&(this.startingPositionClipboard.set(null),this.syncStartingPositionForm(),this.snackbar.open(1===n?"Starting position successfully pasted.":`Starting position successfully pasted to ${n} chapters.`))}copyAdditionalPositions(){this.positionsService.copyAdditionalPositions(this.positions.value),this.additionalPositionsClipboard.set(this.positionsService.additionalPositionsClipboard),this.snackbar.open("Copied additional positions.")}pasteAdditionalPositions(t=!1){const n=this.positionsService.pasteAdditionalPositions(t);n>0&&(this.additionalPositionsClipboard.set(null),this.syncAdditionalPositionsForm(),this.snackbar.open(1===n?"Additional positions successfully pasted.":`Additional positions successfully pasted to ${n} chapters.`))}removeAdditionalPositions(){const t=new Bs.z;this.additionalPositionsForm.setControl("positionsBlock",this.newPositionsBlockFormGroup(t))}initForms(){this.startingPositionForm=this.formBuilder.group({title:[""]}),this.startingPositionForm.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.syncStartingPositionState(t.title)}),this.additionalPositionsForm=this.formBuilder.group({positionsBlock:this.formBuilder.group({type:[Ke.m.Positions],positions:new c.Bm([])})}),this.additionalPositionsForm.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.syncAdditionalPositionsState(t.positionsBlock)})}initChapterListeners(){this.selectedChapterId$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(I.N.getSelectedChapter);this.otherContentBlocks=this.contentBlocksService.filterContentBlocksByType(t.contentBlocks,[],[Ke.m.Positions]),this.syncStartingPositionForm(),this.syncAdditionalPositionsForm()}),this.actions.pipe((0,a.rM)(so.a.Undo,so.a.Redo),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.syncAdditionalPositionsForm()}),this.selectedChapter$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.interactive=t.readyState.model})}syncStartingPositionForm(){const t=this.store.selectSnapshot(I.N.getSelectedChapter).camera.title;this.startingPositionForm.patchValue({title:t},{emitEvent:!1})}syncStartingPositionState(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId);this.store.dispatch(new V.pN(n,t))}syncAdditionalPositionsForm(){const t=this.store.selectSnapshot(I.N.getSelectedChapter),n=this.contentBlocksService.findContentBlockByType(t.contentBlocks,Ke.m.Positions)||new Bs.z;this.additionalPositionsForm.setControl("positionsBlock",this.newPositionsBlockFormGroup(n),{emitEvent:!1}),this.additionalPositionsForm.patchValue({positionsBlock:n},{emitEvent:!1})}syncAdditionalPositionsState(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId),i=[...this.otherContentBlocks,...this.contentBlocksService.filterEmptyBlocks([t])];this.store.dispatch(new V.jo(n,i,!0))}newPositionsBlockFormGroup(t){return this.formBuilder.group({type:t.type,positions:this.formBuilder.array(t.positions.map(n=>this.formBuilder.group({title:[n.title,c.k0.maxLength(60)],thumbnail:this.formBuilder.group({urls:n.thumbnail.urls}),camera:n.camera})))})}}(xi=Ei).\u0275fac=function(t){return new(t||xi)(e.rXU(a.il),e.rXU(a.En),e.rXU(Ds.c),e.rXU(Go.V),e.rXU(c.ok),e.rXU(Le.UG))},xi.\u0275cmp=e.VBU({type:xi,selectors:[["app-edit-positions-context"]],decls:45,vars:25,consts:[["title",""],["startingPositionMenu","matMenu"],["additionalPositionsMenu","matMenu"],[1,"edit-positions",3,"loading"],["column-label",""],["column-header","",1,"edit-positions__starting-position"],[1,"edit-positions__head"],[1,"edit-positions__title"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["toggleType","arrow",3,"opened","label","open","formGroup"],["panel-prefix",""],[1,"edit-positions__starting-position-thumbnail"],[3,"thumbnail"],["label","Title"],["type","text","formControlName","title","placeholder","Enter a response",1,"input",3,"maxLength"],[3,"field"],["buttonSize","md","mode","starting",1,"edit-positions__starting-position-capture",3,"chapter"],["column-group-body",""],[1,"edit-positions__additional-positions"],[3,"formGroup"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],[4,"ngIf"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column",3)(1,"div",4),e.EFF(2,"Positions"),e.k0s(),e.j41(3,"div",5)(4,"div",6)(5,"div",7),e.EFF(6,"Starting Position"),e.k0s(),e.j41(7,"button",8),e.nrm(8,"app-icon",9),e.k0s()(),e.j41(9,"app-panel",10),e.nI1(10,"async"),e.bIt("opened",function(r){return e.eBV(i),e.Njj(n.handleOpened(r))}),e.qex(11,11),e.j41(12,"div",12),e.nrm(13,"app-thumbnail-view",13),e.nI1(14,"async"),e.nI1(15,"async"),e.k0s(),e.bVm(),e.j41(16,"app-form-field",14),e.nrm(17,"input",15,0)(19,"app-character-counter",16),e.k0s(),e.nrm(20,"app-capture-position",17),e.nI1(21,"async"),e.k0s()(),e.j41(22,"app-column-group"),e.qex(23,18),e.j41(24,"div",19)(25,"div",6)(26,"div",7),e.EFF(27,"Additional Positions"),e.k0s(),e.j41(28,"button",8),e.nrm(29,"app-icon",9),e.k0s()(),e.j41(30,"form",20),e.nrm(31,"app-edit-positions-block",20),e.k0s()(),e.bVm(),e.k0s()(),e.j41(32,"mat-menu",null,1)(34,"button",21),e.bIt("click",function(){return e.eBV(i),e.Njj(n.copyStartingPosition())}),e.EFF(35,"Copy Starting Position"),e.k0s(),e.j41(36,"button",22),e.bIt("click",function(){return e.eBV(i),e.Njj(n.pasteStartingPosition())}),e.EFF(37," Paste Starting Position "),e.DNE(38,Xh,2,0,"ng-container",23),e.k0s(),e.DNE(39,Qh,3,1,"ng-container",23),e.k0s(),e.j41(40,"mat-menu",null,2),e.DNE(42,qh,8,3,"ng-container",23),e.j41(43,"button",22),e.bIt("click",function(){return e.eBV(i),e.Njj(n.removeAdditionalPositions())}),e.EFF(44," Remove This Chapter's Additional Positions "),e.k0s()()}if(2&t){let i,o;const r=e.sdS(18),l=e.sdS(33),p=e.sdS(41);e.Y8G("loading",!n.interactive),e.R7$(7),e.Y8G("matMenuTriggerFor",l),e.R7$(2),e.Y8G("label",null==(i=e.bMT(10,17,n.selectedChapter$))?null:i.camera.title)("open",!0)("formGroup",n.startingPositionForm),e.R7$(4),e.Y8G("thumbnail",null==(o=e.bMT(14,19,n.thumbnails$))?null:o.get(null==(o=e.bMT(15,21,n.selectedChapter$))?null:o.id)),e.R7$(4),e.Y8G("maxLength",60),e.R7$(2),e.Y8G("field",r),e.R7$(),e.Y8G("chapter",e.bMT(21,23,n.selectedChapter$)),e.R7$(8),e.Y8G("matMenuTriggerFor",p),e.R7$(2),e.Y8G("formGroup",n.additionalPositionsForm),e.R7$(),e.Y8G("formGroup",n.positionsBlock),e.R7$(5),e.Y8G("disabled",!n.startingPositionClipboard()),e.R7$(2),e.Y8G("ngIf",n.isLoft),e.R7$(),e.Y8G("ngIf",n.isLoft),e.R7$(3),e.Y8G("ngIf",n.isLoft),e.R7$(),e.Y8G("disabled",!n.hasAdditionalPositions)}},dependencies:[E.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,$.kk,$.fb,$.Cp,Qe.q,L.Q,mt,st,ee.K,Ft.P,Y.R,me.g,Gs.J,$s,Os,E.Jj],styles:[".edit-positions__starting-position[_ngcontent-%COMP%]{border-top:1px solid #283853;padding-right:12px;display:flex;flex-direction:column;overflow-y:scroll}.edit-positions__starting-position-thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-right:12px}.edit-positions__starting-position-capture[_ngcontent-%COMP%]{display:flex;width:100%;margin-top:16px}.edit-positions__additional-positions[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-positions__head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:4px 0 4px 16px}.edit-positions__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}"],changeDetection:0}),As([(0,a.l6)(I.N.getSelectedChapterId),Us("design:type",u.c)],Ei.prototype,"selectedChapterId$",void 0),As([(0,a.l6)(I.N.getSelectedChapter),Us("design:type",u.c)],Ei.prototype,"selectedChapter$",void 0),As([(0,a.l6)(ro.K.getRegisteredThumbnails),Us("design:type",u.c)],Ei.prototype,"thumbnails$",void 0);var Hh=v(35892),Wt=v(43753),ka=(v(24484),v(53719));const Wh=s=>({"input--success":s});function Jh(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"mat-radio-group",9),e.nrm(3,"mat-radio-button",10),e.k0s(),e.nrm(4,"input",11),e.j41(5,"button",12),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleDeleteOption(o))}),e.nrm(6,"app-icon",13),e.k0s()()()}if(2&s){const n=t.$implicit,i=t.index,o=e.XpG();e.R7$(),e.Y8G("formGroupName",i),e.R7$(),e.Y8G("formControl",o.correctOptionControl)("name",o.optionGroupName),e.R7$(),e.Y8G("value",n.get("value").value),e.R7$(),e.Y8G("ngClass",e.eq3(6,Wh,n.get("value").value==o.correctOptionControl.value)),e.R7$(),e.BMQ("aria-label","Delete Question")}}function Kh(s,t){1&s&&(e.j41(0,"div",14)(1,"mat-error"),e.EFF(2," Please select an answer. "),e.k0s()())}let Zh=(()=>{var s;class t extends qe.n{get optionsControl(){return this.form.get("options")}get correctOptionControl(){return this.form.get("correctAnswer")}constructor(i,o,r,l){super(),this.formBuilder=i,this.changeRef=o,this.store=r,this.actions=l,this.optionGroupName="",this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({correctAnswer:["",c.k0.required],options:this.formBuilder.array([])}),this.optionGroupName=Ze.u.getUuid()}ngOnInit(){this.initFormListeners(),this.initNodeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.writeValue(i)}),this.optionsControl.valueChanges.pipe((0,j.p)(()=>!(0,R.isNil)(this.form.value.correctAnswer)),(0,W.B)(125),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{i.some(o=>o.value===this.form.value.correctAnswer)||(this.form.patchValue({correctAnswer:i[i.length-1].value}),this.changeRef.markForCheck())})}initNodeListeners(){this.actions.pipe((0,a.xi)(oe.zE),(0,j.p)(()=>this.store.selectSnapshot(_.S.getActiveTool)===Q.s.Quiz&&this.question.id===this.store.selectSnapshot(fe.j.getActiveQuestionId)),(0,j.p)(i=>{const{node:o,event:r}=i;return!(0,R.isNil)(o)&&!r.srcEvent.shiftKey}),(0,Te.T)(i=>(0,R.trim)((0,R.get)(i,"node.label",""))),(0,j.p)(i=>""!==i),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.createOption(i),this.changeRef.markForCheck()})}handleAddOptionClick(i){this.createOption(),i.preventDefault()}handleDeleteOption(i){this.optionsControl.removeAt(i)}handleDrop(i){const{previousIndex:o,currentIndex:r}=i,{options:l}=this.form.value,p=(0,Dt.W)(l,o,r);this.optionsControl.clear(),p.forEach(T=>{this.optionsControl.push(this.formBuilder.group(T))}),this.form.patchValue({options:p})}createOption(i){const o=(0,fn.tI)(i);this.optionsControl.push(this.formBuilder.group(o))}setFormValues(i){const{options:o}=i;this.optionsControl.length!==o.length&&(this.optionsControl.clear(),o.forEach(r=>{this.optionsControl.push(this.formBuilder.group(r))})),this.form.patchValue(i),this.changeRef.markForCheck()}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ze),e.rXU(e.gRc),e.rXU(a.il),e.rXU(a.En))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-quiz-multiple-choice"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:8,vars:3,consts:[["label","Answers",3,"formGroup"],["formArrayName","options","cdkDropList","",3,"cdkDropListDropped"],["class","mb-2","data-test","questionAnswer","cdkDrag","",4,"ngFor","ngForOf"],[1,"flex","flex-row","items-center"],[3,"click"],[1,"text-xs","text-gray-400"],["class","mt-1",4,"ngIf"],["data-test","questionAnswer","cdkDrag","",1,"mb-2"],[1,"flex","flex-row","items-center",3,"formGroupName"],["data-test","questionAnswerCorrect",3,"formControl","name"],[3,"value"],["type","text","formControlName","label","placeholder","Enter a response","data-test","questionAnswerLabel",1,"input",3,"ngClass"],["app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Question",3,"click"],["icon","times","size","lg"],[1,"mt-1"]],template:function(i,o){1&i&&(e.j41(0,"app-form-field",0)(1,"div",1),e.bIt("cdkDropListDropped",function(l){return o.handleDrop(l)}),e.DNE(2,Jh,7,8,"div",2),e.j41(3,"div",3)(4,"mat-radio-button",4),e.bIt("click",function(l){return o.handleAddOptionClick(l)}),e.j41(5,"span",5),e.EFF(6,"Add Option"),e.k0s()()()(),e.DNE(7,Kh,3,0,"div",6),e.k0s()),2&i&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.optionsControl.controls),e.R7$(5),e.Y8G("ngIf",o.optionsControl.controls.length>0&&!o.correctOptionControl.valid))},dependencies:[E.YU,E.Sq,E.bT,c.me,c.BC,c.cb,c.l_,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,Ye.VT,Ye._g,ka.TL,L.Q,ee.K,Y.R],changeDetection:0}),t})();var Cn,vn,wi,ef=v(39358);function of(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",10)(1,"div",5),e.EFF(2),e.k0s(),e.j41(3,"button",11),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleDeleteSelectionClick(o.id))}),e.nrm(4,"app-icon",12),e.k0s()()}if(2&s){const n=t.$implicit;e.R7$(),e.BMQ("data-id",n.id),e.R7$(),e.JRh(n.label),e.R7$(),e.BMQ("aria-label","Delete Selection")}}class Vs extends qe.n{constructor(t,n,i,o,r,l){super(),this.store=t,this.actions=n,this.formBuilder=i,this.changeRef=o,this.graphService=r,this.viewService=l,this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({showAnswerList:[!1],selectType:"all",correctAnswer:this.formBuilder.array([])})}ngOnInit(){this.initFormListeners(),this.initNodeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.writeValue(t);const n=t.correctAnswer,i=this.store.selectSnapshot(_.S.getViewGraph);this.nodes=this.graphService.getNodes(i,n),this.changeRef.markForCheck()})}initNodeListeners(){this.activeQuestion$.pipe((0,on.M)(()=>{this.viewService.clearSelectedNodes()}),(0,j.p)(()=>this.question.id===this.store.selectSnapshot(fe.j.getActiveQuestionId)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{setTimeout(()=>{this.selectNodes(this.value.correctAnswer,!0)})}),this.actions.pipe((0,a.xi)(oe.zE),(0,j.p)(()=>this.store.selectSnapshot(_.S.getActiveTool)===Q.s.Quiz&&this.question.id===this.store.selectSnapshot(fe.j.getActiveQuestionId)),(0,j.p)(t=>{const{node:n,event:i}=t;return!(0,R.isNil)(n)&&!i.srcEvent.shiftKey}),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.hit?t.hit.objectId:"";if(n){const o=this.store.selectSnapshot(ve.z.getNodes)[n].checked;this.selectNodes([n],!o)}this.changeRef.markForCheck()})}handleDeleteSelectionClick(t){this.selectNodes([t],!1)}setFormValues(t){this.form.setControl("correctAnswer",this.formBuilder.array(t.correctAnswer)),this.form.patchValue(t),this.changeRef.markForCheck()}selectNodes(t,n){this.store.dispatch(new re.q9(n,t));const{showAnswerList:i,selectType:o,correctAnswer:r}=this.form.value;let l=[...r];l=n?[...l,...t.filter(p=>!l.includes(p))]:[...l.filter(p=>!t.includes(p))],this.setFormValues({showAnswerList:i,selectType:o,correctAnswer:l})}}function af(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7),e.EFF(3),e.k0s(),e.j41(4,"div",8),e.nrm(5,"app-icon",9),e.k0s()(),e.qex(6,10),e.nrm(7,"input",11),e.bVm(),e.j41(8,"button",12),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleDeleteSelectionClick(o))}),e.nrm(9,"app-icon",13),e.k0s()()}if(2&s){const n=t.index;e.Y8G("formGroupName",n),e.R7$(3),e.JRh(n+1),e.R7$(5),e.BMQ("aria-label","Delete Selection")}}function lf(s,t){1&s&&e.nrm(0,"mat-error")}(Cn=Vs).\u0275fac=function(t){return new(t||Cn)(e.rXU(a.il),e.rXU(a.En),e.rXU(c.ze),e.rXU(e.gRc),e.rXU(mo.w),e.rXU(ef.z))},Cn.\u0275cmp=e.VBU({type:Cn,selectors:[["app-edit-quiz-select-anatomy"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>Cn),multi:!0}]),e.Vt3],decls:16,vars:4,consts:[[3,"formGroup"],["label","ANSWERS (Select the anatomy in 3D)",3,"uppercase","isCompact"],[1,"edit-quiz-select-anatomy__group"],["class","flex flex-row items-center justify-between","data-test","questionAnswer",4,"ngFor","ngForOf"],["formControlName","showAnswerList"],[1,"text-xs"],["label","CORRECT ANSWER"],["formControlName","selectType"],["value","all",1,"mb-2"],["value","any","data-test","questionSelectAny"],["data-test","questionAnswer",1,"flex","flex-row","items-center","justify-between"],["data-test","questionAnswerRemoveButton","app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Selection",3,"click"],["icon","times","size","lg"]],template:function(t,n){1&t&&(e.qex(0,0),e.nrm(1,"app-form-field",1),e.j41(2,"div",2),e.DNE(3,of,5,3,"div",3),e.k0s(),e.j41(4,"app-form-field")(5,"mat-checkbox",4)(6,"span",5),e.EFF(7,"Show answer list in the question text"),e.k0s()()(),e.j41(8,"app-form-field",6)(9,"mat-radio-group",7)(10,"mat-radio-button",8)(11,"span",5),e.EFF(12,"Must select all answers listed"),e.k0s()(),e.j41(13,"mat-radio-button",9)(14,"span",5),e.EFF(15,"Can select any of the answers listed"),e.k0s()()()(),e.bVm()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("uppercase",!1)("isCompact",!0),e.R7$(2),e.Y8G("ngForOf",n.nodes))},dependencies:[E.Sq,c.BC,c.cb,c.j4,c.JD,De.So,Ye.VT,Ye._g,L.Q,ee.K,Y.R],styles:[".edit-quiz-select-anatomy__group[_ngcontent-%COMP%]{margin-bottom:24px;display:flex;flex-direction:column;row-gap:4px}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(fe.j.getActiveQuestionId),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Vs.prototype,"activeQuestion$",void 0);class Ls extends qe.n{get optionsControl(){return this.form.get("options")}constructor(t,n,i,o,r,l){super(),this.store=t,this.actions=n,this.formBuilder=i,this.changeRef=o,this.graphService=r,this.cameraService=l,this.ngUnsubscribe=new b.B,this.form=this.formBuilder.group({correctAnswer:this.formBuilder.array([]),options:this.formBuilder.array([],this.getLabelValidators())})}ngOnInit(){this.initFormListeners(),this.initNodeListeners(),this.initLabelListeners()}ngOnDestroy(){this.store.dispatch(new oe.Gv(!0)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.options,i=this.store.selectSnapshot(fe.j.getActiveQuestionLabels),r={correctAnswer:n.map(l=>l.value),options:n.map(l=>{const{value:p,label:T,model:B}=l,A=i.find(ge=>ge.value===p);return{value:p,label:{...A?A.label:B,...T}}})};this.writeValue(r),this.changeRef.markForCheck()})}initNodeListeners(){this.actions.pipe((0,a.xi)(oe.zE),(0,j.p)(()=>this.store.selectSnapshot(_.S.getActiveTool)===Q.s.Quiz&&this.question.id===this.store.selectSnapshot(fe.j.getActiveQuestionId)),(0,j.p)(t=>{const{node:n,event:i}=t;return!(0,R.isNil)(n)&&!i.srcEvent.shiftKey}),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=t.hit;if(n&&n.objectId){const i=n.objectId,o=this.store.selectSnapshot(I.N.getSelectedChapterId),r=this.store.selectSnapshot(_.S.getViewGraph),[l]=this.graphService.getNodes(r,[i]),p=this.cameraService.getDirection(n),T=(0,fn.Aw)(o,l,n,p),B=(0,fn.br)(T);this.addOption(B)}this.changeRef.markForCheck()})}initLabelListeners(){this.activeQuestion$.pipe((0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=(0,R.isNil)(t);this.store.dispatch(new oe.Gv(n))})}handleDeleteSelectionClick(t){this.handleDeleteOption(t)}setFormValues(t){const n=t.options;this.optionsControl.length!==n.length&&this.setFormOptions(n),this.form.patchValue(t),this.changeRef.markForCheck()}handleDeleteOption(t){this.optionsControl.removeAt(t)}handleDrop(t){const{previousIndex:n,currentIndex:i}=t,o=this.form.value.options,r=(0,Dt.W)(o,n,i);this.setFormOptions(o),this.form.patchValue({options:r})}setFormOptions(t){this.optionsControl.clear(),t.forEach(n=>{this.addOption(n)})}addOption(t){this.optionsControl.push(this.formBuilder.group({value:t.value,label:this.formBuilder.group({title:[t.label.title]}),model:t.label}))}getLabelValidators(){return t=>{const i=t.value.map(r=>r.value),o=(0,R.uniq)(i).length<i.length;return o?{hasDuplicates:o}:null}}}function df(s,t){if(1&s&&e.nrm(0,"app-edit-quiz-multiple-choice",29),2&s){const n=e.XpG();e.Y8G("question",n.question)}}function mf(s,t){if(1&s&&e.nrm(0,"app-edit-quiz-select-anatomy",29),2&s){const n=e.XpG();e.Y8G("question",n.question)}}function uf(s,t){if(1&s&&e.nrm(0,"app-edit-quiz-label-anatomy",29),2&s){const n=e.XpG();e.Y8G("question",n.question)}}function hf(s,t){1&s&&(e.j41(0,"div",17)(1,"app-form-field",30),e.nrm(2,"app-rich-text-edit",31,1),e.k0s()()),2&s&&(e.R7$(2),e.Y8G("inline",!0)("compact",!0)("resizeable",!0)("rows",6))}function ff(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",32)(1,"button",33),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handlePreviewCameraClick())}),e.EFF(2," Preview "),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleRemoveCameraClick())}),e.EFF(4," Remove "),e.k0s()()}}(vn=Ls).\u0275fac=function(t){return new(t||vn)(e.rXU(a.il),e.rXU(a.En),e.rXU(c.ze),e.rXU(e.gRc),e.rXU(mo.w),e.rXU(yo.j))},vn.\u0275cmp=e.VBU({type:vn,selectors:[["app-edit-quiz-label-anatomy"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>vn),multi:!0}]),e.Vt3],decls:5,vars:4,consts:[["cdkDropList","",1,"label",3,"cdkDropListDropped","formGroup"],["label","ANSWERS (Select the anatomy to be labeled)","formArrayName","options",3,"uppercase"],["class","flex flex-row items-center justify-between mb-2","cdkDrag","",3,"formGroupName",4,"ngFor","ngForOf"],[1,"mt-1"],[4,"ngIf"],["cdkDrag","",1,"flex","flex-row","items-center","justify-between","mb-2",3,"formGroupName"],["cdkDragHandle","","data-test","questionAnswerNumber",1,"label__pin"],[1,"label__label"],[1,"label__drag"],["icon","grip-lines"],["formGroupName","label"],["type","text","formControlName","title","data-test","questionAnswer",1,"input"],["data-test","questionAnswerRemoveButton","app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Selection",3,"click"],["icon","times","size","lg"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.bIt("cdkDropListDropped",function(o){return n.handleDrop(o)}),e.j41(1,"app-form-field",1),e.DNE(2,af,10,3,"div",2),e.j41(3,"div",3),e.DNE(4,lf,1,0,"mat-error",4),e.k0s()()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("uppercase",!1),e.R7$(),e.Y8G("ngForOf",n.optionsControl.controls),e.R7$(2),e.Y8G("ngIf",!n.optionsControl.valid))},dependencies:[E.Sq,E.bT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,te.Fb,ka.TL,L.Q,ee.K,Y.R],styles:[".label__pin[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center}.label__pin[_ngcontent-%COMP%]:hover{cursor:move}.label__pin[_ngcontent-%COMP%]:hover   .label__label[_ngcontent-%COMP%]{display:none}.label__pin[_ngcontent-%COMP%]:hover   .label__drag[_ngcontent-%COMP%]{display:block}.label__label[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;color:#101823;font-size:10px;width:24px;height:24px;background-image:url(/assets/images/labels/circle.svg);background-repeat:no-repeat;background-position:center;background-size:auto}.label__drag[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(fe.j.getActiveQuestionId),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Ls.prototype,"activeQuestion$",void 0);class Eo{get question(){return this._question}set question(t){(0,R.isEqual)(t,this.question)||(this._question=t,this.setFormValues(t),this.textLabel=this.question.type===Wt.Q5.Instructions?"Text":"Question")}get quizCamera(){return(0,R.get)(this.question,"sceneConfig.camera")}constructor(t,n,i,o){this.formBuilder=t,this.store=n,this.cameraService=i,this.changeDetectorRef=o,this.questionTypesMap=Wt.of,this.questionDescriptionsMap=Wt.sb,this.questionTypes=Wt.Q5,this.defaultNextButtonNext=fn.qH,this.open=!1,this.opened=new e.bkB,this.textLabel=" ",this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initQuestionChangeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({questionPrompt:this.formBuilder.group({type:"markdown",markdown:""}),data:[],explanation:this.formBuilder.group({type:"markdown",markdown:""}),nextLabel:"",showChapterLabels:!1,camera:[]})}initFormListeners(){this.form.valueChanges.pipe((0,W.B)(125),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n={...this.question,...this.createQuestionFromValues(t)};this.store.dispatch(new Fe.B.SetQuestion(n))})}initQuestionChangeListeners(){this.questions$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=this.getQuestionIndex(this.question.id);this.questionNum=i+1,this.changeDetectorRef.markForCheck()})}handleOpened(t){this.opened.emit({panel:this.panel,opened:t})}handleRemoveQuestionClick(){this.store.dispatch(new Fe.B.RemoveQuestions([this.question.id]))}handleCaptureCameraClick(){const t=this.cameraService.getCamera();this.form.patchValue({camera:t})}handlePreviewCameraClick(){const t=this.quizCamera;t&&this.store.dispatch(new Et.Ih(t.location,!0,1))}handleRemoveCameraClick(){this.form.patchValue({camera:void 0})}handlePreviewQuestion(){const t=this.getQuestionIndex(this.question.id);this.store.dispatch(new w.lN(!0,t))}setFormValues(t){const{questionPrompt:n,explanation:i,data:o,sceneConfig:r,nextLabel:l,showChapterLabels:p}=t,T=(0,R.get)(r,"camera.location");this.form.patchValue({questionPrompt:n[0],data:o,explanation:i[0],camera:T,nextLabel:l,showChapterLabels:p},{emitEvent:!1,onlySelf:!0})}createQuestionFromValues(t){const{questionPrompt:n,explanation:i,data:o,camera:r,nextLabel:l,showChapterLabels:p}=t,T={};return r&&(T.camera={action:Si.L.FlyTo,location:r}),{questionPrompt:[n],data:o,explanation:[i],sceneConfig:T,nextLabel:l,showChapterLabels:p}}getQuestionIndex(t){const n=this.store.selectSnapshot(I.N.getStoryChapters).map(i=>i.id);return this.store.selectSnapshot(fe.j.getQuestionIndex(n,t))}}(wi=Eo).\u0275fac=function(t){return new(t||wi)(e.rXU(c.ze),e.rXU(a.il),e.rXU(yo.j),e.rXU(e.gRc))},wi.\u0275cmp=e.VBU({type:wi,selectors:[["app-quiz-question-form"]],viewQuery:function(t,n){if(1&t&&e.GBs(me.g,7),2&t){let i;e.mGM(i=e.lsd())&&(n.panel=i.first)}},inputs:{label:"label",question:"question",open:"open"},outputs:{opened:"opened"},decls:42,vars:19,consts:[["questionMenu","matMenu"],["questionPrompt",""],["toggleType","arrow","data-test","questionPanel",3,"opened","label","open"],["panel-prefix",""],["data-test","questionNumText",1,"question__pin"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["tabSize","small","tabTheme","dark"],["label","Content"],[1,"mt-5"],["label","Type","matTooltipPosition","left",3,"matTooltip"],[1,"text-xs"],["formGroupName","questionPrompt",3,"label"],["data-test","questionPrompt","formControlName","markdown",3,"inline","compact","resizeable","rows"],[1,"mt-2"],[3,"ngSwitch"],["formControlName","data",3,"question",4,"ngSwitchCase"],["class","mt-2",4,"ngIf"],["label","Advanced"],[1,"mt-4"],["label","Custom Starting Position","formGroupName","camera"],["buttonType","outline","app-button","","data-test","questionMarkPosition",1,"w-full",3,"click"],["class","flex flex-row justify-between mt-3",4,"ngIf"],["label","Next Button Text"],["type","text","formControlName","nextLabel","data-test","questionNextText",1,"input",3,"placeholder"],["formControlName","showChapterLabels","data-test","questionShowChapterLabels"],["formControlName","data",3,"question"],["label","Answer Explanation","formGroupName","explanation"],["formControlName","markdown","data-test","questionExplanation",3,"inline","compact","resizeable","rows"],[1,"flex","flex-row","justify-between","mt-3"],["buttonType","outline","app-button","","data-test","questionPreviewPosition",1,"w-1/2","mr-1",3,"click"],["buttonType","outline","app-button","","data-test","questionRemovePosition",1,"w-1/2","ml-1",3,"click"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-panel",2),e.bIt("opened",function(r){return e.eBV(i),e.Njj(n.handleOpened(r))}),e.qex(1,3),e.j41(2,"div",4),e.EFF(3),e.k0s(),e.bVm(),e.j41(4,"div",5)(5,"button",6),e.nrm(6,"app-icon",7),e.k0s(),e.j41(7,"mat-menu",null,0)(9,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handlePreviewQuestion())}),e.EFF(10,"Preview Question"),e.k0s(),e.nrm(11,"mat-divider"),e.j41(12,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveQuestionClick())}),e.EFF(13,"Remove"),e.k0s()()(),e.j41(14,"div",9)(15,"app-tabs",10)(16,"app-tab",11)(17,"div",12)(18,"app-form-field",13)(19,"span",14),e.EFF(20),e.k0s()(),e.j41(21,"app-form-field",15),e.nrm(22,"app-rich-text-edit",16,1),e.k0s()(),e.j41(24,"div",17),e.qex(25,18),e.DNE(26,df,1,1,"app-edit-quiz-multiple-choice",19)(27,mf,1,1,"app-edit-quiz-select-anatomy",19)(28,uf,1,1,"app-edit-quiz-label-anatomy",19),e.bVm(),e.k0s(),e.DNE(29,hf,4,4,"div",20),e.k0s(),e.j41(30,"app-tab",21)(31,"div",22)(32,"app-form-field",23)(33,"button",24),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleCaptureCameraClick())}),e.EFF(34," Mark Position "),e.k0s(),e.DNE(35,ff,5,0,"div",25),e.k0s(),e.j41(36,"app-form-field",26),e.nrm(37,"input",27),e.k0s(),e.j41(38,"app-form-field")(39,"mat-checkbox",28)(40,"span",14),e.EFF(41,"Show chapter's labels"),e.k0s()()()()()()()()}if(2&t){const i=e.sdS(8);e.Y8G("label",n.label)("open",n.open),e.R7$(3),e.SpI(" ",n.questionNum," "),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(9),e.Y8G("formGroup",n.form),e.R7$(4),e.Y8G("matTooltip",n.questionDescriptionsMap[n.question.type]),e.R7$(2),e.JRh(n.questionTypesMap[n.question.type]),e.R7$(),e.Y8G("label",n.textLabel),e.R7$(),e.Y8G("inline",!0)("compact",!0)("resizeable",!0)("rows",6),e.R7$(3),e.Y8G("ngSwitch",n.question.type),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.LabelAnatomy),e.R7$(),e.Y8G("ngIf",n.question.type!==n.questionTypes.Instructions),e.R7$(6),e.Y8G("ngIf",n.quizCamera),e.R7$(2),e.Y8G("placeholder",n.defaultNextButtonNext)}},dependencies:[E.bT,E.ux,E.e1,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,De.So,$.kk,$.fb,$.Cp,Ce.oV,Qe.q,L.Q,ee.K,Y.R,Pt.j,Rt.O,me.g,At,Zh,Vs,Ls],styles:[".question__pin[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;color:#101823;font-size:10px;width:24px;height:24px;position:relative;left:-8px;top:4px;background-image:url(/assets/images/labels/circle.svg);background-repeat:no-repeat;background-position:center;background-size:auto}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(fe.j.getAllQuestions),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Eo.prototype,"questions$",void 0);const Ys={[Ct._.All]:{label:"Enable View and Quiz",shortLabel:"View and Quiz",description:"Enable both View mode and Quiz mode.",dataTest:"enableViewAndQuiz"},[Ct._.Quiz]:{label:"Show Quiz Only",shortLabel:"Quiz Only",description:"Enable Quiz mode only, and disable View mode.",dataTest:"enableQuiz"},[Ct._.Content]:{label:"Disable Quiz",shortLabel:"Disabled",description:"Enable View mode only, and disable Quiz mode.",dataTest:"disableQuiz"}};var Fi,zs=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Xs=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function gf(s,t){if(1&s&&(e.j41(0,"mat-radio-button",16),e.EFF(1),e.k0s()),2&s){const n=t.$implicit,i=e.XpG();e.Y8G("value",n),e.BMQ("title",null==i.bookmarkViewModesMetadata[n]?null:i.bookmarkViewModesMetadata[n].description)("data-test",null==i.bookmarkViewModesMetadata[n]?null:i.bookmarkViewModesMetadata[n].dataTest),e.R7$(),e.JRh(null==i.bookmarkViewModesMetadata[n]?null:i.bookmarkViewModesMetadata[n].label)}}class Pi{constructor(t,n,i){this.formBuilder=t,this.store=n,this.dialogRef=i,this.bookmarkViewModesMetadata=Ys,this.bookmarkViewModes=[Ct._.All,Ct._.Quiz,Ct._.Content],this.ngUnsubscribe=new b.B;const o=this.store.selectSnapshot(fe.j.getQuizSettings),r=this.store.selectSnapshot(Ee.J.getSelectedBookmarkViewMode);this.form=this.formBuilder.group({bookmarkViewMode:this.formBuilder.nonNullable.control(r),quizSettings:this.formBuilder.nonNullable.group(o)})}ngOnInit(){this.initFormListeners(),this.initSettingsListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.controls.quizSettings.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setQuizSettings(t)}),this.form.controls.bookmarkViewMode.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setBookmarkViewMode(t)})}initSettingsListeners(){this.quizSettings$.pipe((0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.form.controls.quizSettings.patchValue(t,{emitEvent:!1})}),this.selectedBookmarkViewMode$.pipe((0,M.F)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.form.controls.bookmarkViewMode.patchValue(t,{emitEvent:!1})}),this.allQuestions$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{t.length>0?this.form.enable():this.form.disable()})}handleDoneClick(){this.dialogRef.close()}setQuizSettings(t){this.store.dispatch(new Fe.B.SetQuizSettings(t))}setBookmarkViewMode(t){this.store.dispatch(new Xe.pE(t))}}(Fi=Pi).\u0275fac=function(t){return new(t||Fi)(e.rXU(c.ok),e.rXU(a.il),e.rXU(Z.CP))},Fi.\u0275cmp=e.VBU({type:Fi,selectors:[["app-quiz-settings-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],["label","Access"],["formControlName","bookmarkViewMode",1,"flex","flex-col"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","quizSettings"],["label","Validation"],["listType","flat"],["formControlName","showSummary"],["formControlName","showExplanation"],["label","UI Elements"],["formControlName","showProgress"],["formControlName","showSubmit"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","buttonType","primary",3,"click"],[3,"value"]],template:function(t,n){1&t&&(e.j41(0,"h1",0),e.EFF(1,"Quiz Settings"),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"app-form-field",3)(5,"mat-radio-group",4),e.DNE(6,gf,2,4,"mat-radio-button",5),e.k0s()(),e.qex(7,6),e.j41(8,"app-form-field",7)(9,"app-list",8)(10,"app-list-item")(11,"mat-checkbox",9),e.EFF(12,"Show summary page"),e.k0s()(),e.j41(13,"app-list-item")(14,"mat-checkbox",10),e.EFF(15,"Show answers and explanations"),e.k0s()()()(),e.j41(16,"app-form-field",11)(17,"app-list",8)(18,"app-list-item")(19,"mat-checkbox",12),e.EFF(20,"Progress indicator"),e.k0s()(),e.j41(21,"app-list-item")(22,"mat-checkbox",13),e.EFF(23,"Submit Button"),e.k0s()()()(),e.bVm(),e.k0s()(),e.j41(24,"div",14)(25,"button",15),e.bIt("click",function(){return n.handleDoneClick()}),e.EFF(26," Done "),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("formGroup",n.form),e.R7$(3),e.Y8G("ngForOf",n.bookmarkViewModes))},dependencies:[E.Sq,De.So,Ye.VT,Ye._g,Z.BI,Z.E7,Z.Yi,c.BC,c.cb,c.j4,c.JD,c.$R,L.Q,ee.K,Ji.s,Ki.P],styles:[".dialog[_ngcontent-%COMP%]{font-size:12px!important}.dialog__close[_ngcontent-%COMP%]{position:absolute;right:24px;top:24px}"],changeDetection:0}),zs([(0,a.l6)(fe.j.getAllQuestions),Xs("design:type",u.c)],Pi.prototype,"allQuestions$",void 0),zs([(0,a.l6)(fe.j.getQuizSettings),Xs("design:type",u.c)],Pi.prototype,"quizSettings$",void 0),zs([(0,a.l6)(Ee.J.getSelectedBookmarkViewMode),Xs("design:type",u.c)],Pi.prototype,"selectedBookmarkViewMode$",void 0);let bf=(()=>{var s;class t{transform(i,o){if((0,R.isNil)(i)||(0,R.isNil)(o))return i;const r=`${i}`,l=r.substring(0,o);return l.length<r.length?l+"...":l}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=e.EJ8({name:"ellipsis",type:s,pure:!0}),t})();var Ri,yn=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},kn=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const _f=["questionItemElements"];function Cf(s,t){if(1&s&&e.nrm(0,"app-status",23),2&s){const n=e.XpG();e.Y8G("color",n.quizStatusActive?"green":"red")}}function vf(s,t){if(1&s&&(e.j41(0,"span",24),e.EFF(1),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.JRh(n.quizStatusLabel)}}function yf(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",25,2)(2,"app-quiz-question-form",26),e.nI1(3,"ellipsis"),e.nI1(4,"async"),e.bIt("opened",function(o){const r=e.eBV(n).$implicit,l=e.XpG();return e.Njj(l.handleOpened(r,o))}),e.k0s(),e.j41(5,"div",27),e.nrm(6,"app-icon",28),e.k0s()()}if(2&s){const n=t.$implicit,i=e.XpG();e.R7$(2),e.FS9("label",e.i5U(3,3,i.getQuestionText(n),80)),e.Y8G("question",n)("open",e.bMT(4,6,i.activeQuestionId$)===n.id)}}function kf(s,t){1&s&&(e.j41(0,"div",29),e.EFF(1," There are no questions in this chapter. "),e.k0s())}function Sf(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.addQuestion(o))}),e.EFF(1),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG();e.Y8G("matTooltip",i.questionDescriptionsMap[n]),e.R7$(),e.SpI(" ",i.questionTypesMap[n]," ")}}class It{constructor(t,n,i,o,r,l){this.store=t,this.actions=n,this.changeRef=i,this.dialogService=o,this.dialog=r,this.contentBlocksService=l,this.questionTypes=Object.keys(Wt.of),this.questionTypesMap=Wt.of,this.questionDescriptionsMap=Wt.sb,this.statusColor=rs,this.bookmarkViewModesMetadata=Ys,this.selectedChapterQuestions=[],this.selectedChapterHasQuestions=!1,this.quizStatusLabel="",this.quizStatusActive=!1,this.quizHasQuestions=!1,this.ngUnsubscribe=new b.B}ngOnInit(){this.initChapterQuestionListeners(),this.initPanelListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterQuestionListeners(){(0,m.z)([this.chapters$,this.selectedChapterId$,this.allQuestions$,this.quizEnabled$,this.bookmarkViewMode$]).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n,i,o,r])=>{this.selectedChapterQuestions=this.store.selectSnapshot(fe.j.getQuizQuestionsByChapter(n)),this.selectedChapterHasQuestions=this.selectedChapterQuestions.length>0,this.quizHasQuestions=i.length>0,this.quizStatusLabel=Ys[r]?.shortLabel,this.quizStatusActive=this.quizHasQuestions&&o&&!(r===Ct._.Content),this.changeRef.markForCheck()}),(0,Hh.x)(this.selectedChapterId$,this.actions.pipe((0,a.rM)(Fe.B.SetQuestions))).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Fe.B.SetActiveQuestion(void 0))})}initPanelListeners(){this.actions.pipe((0,a.rM)(Fe.B.AddQuestion),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.selectedChapterQuestions.length-1;this.store.dispatch(new Fe.B.SetActiveQuestion(this.selectedChapterQuestions[t].id));const i=this.questionForms.toArray()[t];i&&this.setActivePanel(i.panel)}),this.activeQuestionId$.pipe((0,j.p)(t=>!!t),(0,M.F)(),(0,at.c)(0),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.selectedChapterQuestions.findIndex(o=>o.id===t),i=this.questionItemElements.toArray()[n];i&&i.nativeElement.scrollIntoView({behavior:"smooth"})})}handleOpened(t,n){n.opened&&this.setActivePanel(n.panel),this.store.dispatch(new Fe.B.SetActiveQuestion(n.opened?t.id:void 0))}handleQuizSettingsClick(){return this.dialog.open(Pi,{id:Lt.t.QuizSettingsDialog,width:"320px"})}handleRemoveChapterQuizClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove Chapter Questions",bodyText:"Would you like to remove all the questions in this chapter?"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId),i=this.store.selectSnapshot(fe.j.getAllQuestions).filter(o=>o.chapterId===n).map(o=>o.id);this.store.dispatch(new Fe.B.RemoveQuestions(i))}})}handleRemoveQuizClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Questions",bodyText:"Would you like to remove all the questions in this quiz?"}}).afterClosed().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t){const n=this.store.selectSnapshot(fe.j.getAllQuestions).map(i=>i.id);this.store.dispatch(new Fe.B.RemoveQuestions(n))}})}getQuestionText(t){const{questionPrompt:n}=t;return this.contentBlocksService.extractContentBlockText(n,"\n")}addQuestion(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId),i={...(0,fn.UB)(t),chapterId:n};this.store.dispatch(new Fe.B.AddQuestion(i))}setActivePanel(t){this.questionForms.toArray().filter(n=>n.panel!==t).forEach(n=>{n.panel.open=!1}),this.changeRef.markForCheck()}trackByKey(t,n){return n.id}handleDrop(t){const n=this.store.selectSnapshot(I.N.getSelectedChapterId),i=this.store.selectSnapshot(fe.j.getQuizQuestionsByChapter(n));(0,te.HD)(i,t.previousIndex,t.currentIndex);let o=this.store.selectSnapshot(fe.j.getAllQuestions).filter(r=>!i.some(l=>l.id===r.id));o=[...o,...i],this.store.dispatch(new Fe.B.SetQuestions(o))}}(Ri=It).\u0275fac=function(t){return new(t||Ri)(e.rXU(a.il),e.rXU(a.En),e.rXU(e.gRc),e.rXU(Ve.o),e.rXU(Z.bZ),e.rXU(Go.V))},Ri.\u0275cmp=e.VBU({type:Ri,selectors:[["app-edit-quiz-context"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Eo,5),e.GBs(_f,5)),2&t){let i;e.mGM(i=e.lsd())&&(n.questionForms=i),e.mGM(i=e.lsd())&&(n.questionItemElements=i)}},decls:29,vars:9,consts:[["quizActionsMenu","matMenu"],["addQuestionMenu","matMenu"],["questionItemElements",""],[3,"loading"],["column-label",""],[1,"flex","items-center"],["data-test","quizStatus","class","ml-3 mr-2",3,"color",4,"ngIf"],["class","uppercase text-2xs",4,"ngIf"],["column-actions",""],["app-button","","data-test","quizSettingsButton","matTooltip","Quiz Settings",3,"click"],["icon","cog"],["app-button","","data-test","questionActionsTrigger","matTooltip","Quiz Bulk Actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","","data-test","questionRemoveChapterQuestions",3,"click"],["mat-menu-item","","data-test","questionRemoveAllQuestions",3,"click"],["label","Quiz"],["column-group-body",""],["cdkDropList","",1,"pl-2",3,"cdkDropListDropped"],["class","questions__item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],["class","questions__no-chapter-questions",4,"ngIf"],[1,"questions__add"],["app-button","","buttonType","flat",1,"w-full",3,"matMenuTriggerFor"],["mat-menu-item","","matTooltipPosition","left",3,"matTooltip","click",4,"ngFor","ngForOf"],["data-test","quizStatus",1,"ml-3","mr-2",3,"color"],[1,"uppercase","text-2xs"],["cdkDrag","",1,"questions__item"],[3,"opened","question","label","open"],["cdkDragHandle","",1,"questions__handle"],["icon","grip-lines"],[1,"questions__no-chapter-questions"],["mat-menu-item","","matTooltipPosition","left",3,"click","matTooltip"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column",3)(1,"div",4)(2,"div",5)(3,"span"),e.EFF(4,"Quiz"),e.k0s(),e.DNE(5,Cf,1,1,"app-status",6)(6,vf,2,1,"span",7),e.k0s()(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleQuizSettingsClick())}),e.nrm(9,"app-icon",10),e.k0s(),e.j41(10,"button",11),e.nrm(11,"app-icon",12),e.k0s(),e.j41(12,"mat-menu",null,0)(14,"button",13),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveChapterQuizClick())}),e.EFF(15," Remove this chapter's quiz questions "),e.k0s(),e.j41(16,"button",14),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRemoveQuizClick())}),e.EFF(17," Remove quiz "),e.k0s()()(),e.j41(18,"app-column-group",15),e.qex(19,16),e.j41(20,"div",17),e.bIt("cdkDropListDropped",function(r){return e.eBV(i),e.Njj(n.handleDrop(r))}),e.DNE(21,yf,7,8,"div",18)(22,kf,2,0,"div",19),e.j41(23,"div",20)(24,"button",21),e.EFF(25," Add a Question "),e.k0s()(),e.j41(26,"mat-menu",null,1),e.DNE(28,Sf,2,2,"button",22),e.k0s()(),e.bVm(),e.k0s()()}if(2&t){const i=e.sdS(13),o=e.sdS(27);e.Y8G("loading",!1),e.R7$(5),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(4),e.Y8G("matMenuTriggerFor",i),e.R7$(11),e.Y8G("ngForOf",n.selectedChapterQuestions)("ngForTrackBy",n.trackByKey),e.R7$(),e.Y8G("ngIf",!n.selectedChapterHasQuestions),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(4),e.Y8G("ngForOf",n.questionTypes)}},dependencies:[E.Sq,E.bT,te.O7,te.T1,te.Fb,$.kk,$.fb,$.Cp,Ce.oV,L.Q,mt,st,Y.R,ea,Eo,E.Jj,bf],styles:[".questions__item[_ngcontent-%COMP%]{position:relative}.questions__item[_ngcontent-%COMP%]:hover   .questions__handle[_ngcontent-%COMP%]{opacity:1}.questions__handle[_ngcontent-%COMP%]{border:4px solid transparent;display:flex;align-items:center;justify-content:center;background:#131c2a;width:36px;height:36px;cursor:move;color:#96a8c0;position:absolute;left:4px;top:12px;z-index:10;opacity:0}.questions__no-chapter-questions[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#61779e;margin-top:16px;font-size:.75rem;line-height:1rem}.questions__add[_ngcontent-%COMP%]{position:sticky;bottom:0;padding:12px 0 12px 8px;background:#131c2a;z-index:1000}"],changeDetection:0}),yn([(0,a.l6)(I.N.getStoryChapters),kn("design:type",u.c)],It.prototype,"chapters$",void 0),yn([(0,a.l6)(I.N.getSelectedChapterId),kn("design:type",u.c)],It.prototype,"selectedChapterId$",void 0),yn([(0,a.l6)(fe.j.getAllQuestions),kn("design:type",u.c)],It.prototype,"allQuestions$",void 0),yn([(0,a.l6)(fe.j.getActiveQuestionId),kn("design:type",u.c)],It.prototype,"activeQuestionId$",void 0),yn([(0,a.l6)(fe.j.getQuizEnabled),kn("design:type",u.c)],It.prototype,"quizEnabled$",void 0),yn([(0,a.l6)(Ee.J.getSelectedBookmarkViewMode),kn("design:type",u.c)],It.prototype,"bookmarkViewMode$",void 0);var Tf=v(77428);let xf=(()=>{var s;class t{get count(){return this._count}set count(i){this._count=i}constructor(){this._count=0}ngOnInit(){}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-reload-countdown"]],inputs:{count:"count"},decls:6,vars:1,consts:[["data-test","reloadCountdown",1,"reload-countdown"],["total","90",3,"value"],[1,"text-base","mt-2"],[1,"text-xs"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.nrm(1,"app-progress",1),e.j41(2,"div",2),e.EFF(3,"Duplicating states on the server."),e.k0s(),e.j41(4,"div",3),e.EFF(5," This page will automatically reload in 90 seconds. You may reload it sooner at your own risk, however it's possible not all states will have completed duplicating. "),e.k0s()()),2&i&&(e.R7$(),e.Y8G("value",o.count))},dependencies:[Tf.X],styles:["[_nghost-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;background:#00000080;color:#fff;z-index:10000;inset:0}.reload-countdown[_ngcontent-%COMP%]{width:400px;height:400px}"],changeDetection:0}),t})();var Mi,Ef=v(82542),wf=v(90917),Qs=v(43631),qs=v(65478),Ff=v(7806),Pf=v(60724),Sa=(v(57238),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r}),Ta=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Hs=s=>({hidden:s});class wo{constructor(t,n,i){this.dialog=t,this.dialogService=n,this.editService=i,this.selected=!1}handleDuplicateClick(){this.duplicateChapter()}handleRemoveClick(){this.removeChapter()}handleContentClick(){this.openChapterContentDialog(this.chapter.id)}duplicateChapter(){this.editService.duplicateChapter(this.chapter)}removeChapter(){this.dialogService.openConfirmDialog({data:{titleText:"Remove chapter",bodyText:"This cannot be undone.",confirmText:"Remove",confirmColor:"warn"}}).afterClosed().subscribe(n=>{n&&this.editService.removeChapter(this.chapter)})}openChapterContentDialog(t){this.dialog.open(gt,{width:"60vw",height:"auto",data:{chapterId:t}})}}function Rf(s,t){1&s&&(e.j41(0,"span",11),e.EFF(1,"No title"),e.k0s())}function Mf(s,t){if(1&s&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&s){const n=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,n.shortDescription)),e.npT)}}function jf(s,t){1&s&&(e.j41(0,"div",13)(1,"span",11),e.EFF(2,"No description"),e.k0s()())}(Mi=wo).\u0275fac=function(t){return new(t||Mi)(e.rXU(Z.bZ),e.rXU(Ve.o),e.rXU(Is))},Mi.\u0275cmp=e.VBU({type:Mi,selectors:[["app-chapter-actions"]],inputs:{chapter:"chapter",selected:"selected"},decls:10,vars:14,consts:[[1,"flex","gap-2"],["buttonSize","2xs","mode","starting",3,"ngClass","chapter","openPositionsOption"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","matTooltipPosition","below","data-test","editInfo",3,"click","ngClass"],[3,"ngClass"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","buttonShape","square","matTooltipPosition","below","matTooltip","Duplicate This Chapter","data-test","duplicateChapter",3,"click"],["size","sm","icon","clone"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","buttonShape","square","matTooltipPosition","below","matTooltip","Remove Chapter",3,"click","disabled"],["size","sm","icon","trash-alt"]],template:function(t,n){if(1&t&&(e.j41(0,"div",0),e.nrm(1,"app-capture-position",1),e.j41(2,"button",2),e.bIt("click",function(){return n.handleContentClick()}),e.EFF(3," Edit Info "),e.k0s(),e.j41(4,"app-button-group",3)(5,"button",4),e.bIt("click",function(){return n.handleDuplicateClick()}),e.nrm(6,"app-icon",5),e.k0s(),e.j41(7,"button",6),e.nI1(8,"async"),e.bIt("click",function(){return n.handleRemoveClick()}),e.nrm(9,"app-icon",7),e.k0s()()()),2&t){let i;e.R7$(),e.Y8G("ngClass",e.eq3(8,Hs,!n.selected))("chapter",n.chapter)("openPositionsOption",!0),e.R7$(),e.Y8G("ngClass",e.eq3(10,Hs,!n.selected)),e.R7$(2),e.Y8G("ngClass",e.eq3(12,Hs,!n.selected)),e.R7$(3),e.Y8G("disabled",1===(null==(i=e.bMT(8,6,n.chapters$))?null:i.length))}},dependencies:[E.YU,Ce.oV,L.Q,un,Y.R,$s,E.Jj],changeDetection:0}),Sa([(0,a.l6)(I.N.getStoryChapters),Ta("design:type",u.c)],wo.prototype,"chapters$",void 0),Sa([(0,a.l6)(ro.K.getRegisteredThumbnails),Ta("design:type",u.c)],wo.prototype,"thumbnails$",void 0);let xa=(()=>{var s;class t{constructor(){this.canRemove=!0,this.compact=!1,this.duplicate=new e.bkB,this.remove=new e.bkB}get chapter(){return this._chapter}set chapter(i){this._chapter=i}get shortDescription(){const o=this.chapter?.description||"";return o.length<=48?o:o.replace("<br>","").substr(0,45)+"..."}handleDuplicateClick(){this.duplicate.emit(this.chapter)}handleRemoveClick(){this.remove.emit(this.chapter)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-chapter-card"]],inputs:{chapter:"chapter",selected:"selected",canRemove:"canRemove",compact:"compact",thumbnail:"thumbnail"},outputs:{duplicate:"duplicate",remove:"remove"},decls:12,vars:14,consts:[["data-test","chapterCard",1,"chapter-card"],[1,"chapter-card__content"],[1,"chapter-card__image",3,"matTooltip","matTooltipPosition","matTooltipDisabled"],[3,"thumbnail"],[1,"chapter-card__body"],[1,"chapter-card__title"],["class","italic text-gray-400",4,"ngIf"],["class","chapter-card__description html",3,"innerHTML",4,"ngIf"],["class","chapter-card__description",4,"ngIf"],[1,"chapter-card__actions"],[3,"selected","chapter"],[1,"italic","text-gray-400"],[1,"chapter-card__description","html",3,"innerHTML"],[1,"chapter-card__description"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"app-thumbnail-view",3),e.k0s(),e.j41(4,"div",4)(5,"div",5),e.EFF(6),e.DNE(7,Rf,2,0,"span",6),e.k0s(),e.DNE(8,Mf,3,5,"div",7)(9,jf,3,0,"div",8),e.k0s()(),e.j41(10,"div",9),e.nrm(11,"app-chapter-actions",10),e.k0s()()),2&i&&(e.AVh("chapter-card--selected",o.selected)("chapter-card--compact",o.compact),e.R7$(2),e.Y8G("matTooltip",o.chapter.displayName)("matTooltipPosition","right")("matTooltipDisabled",!o.compact),e.R7$(),e.Y8G("thumbnail",o.thumbnail),e.R7$(3),e.SpI(" ",o.chapter.displayName," "),e.R7$(),e.Y8G("ngIf",!o.chapter.displayName),e.R7$(),e.Y8G("ngIf",o.shortDescription),e.R7$(),e.Y8G("ngIf",!o.shortDescription),e.R7$(2),e.Y8G("selected",o.selected)("chapter",o.chapter))},dependencies:[E.bT,Ce.oV,Gs.J,wo,E.Jj,io.i0],styles:[".chapter-card[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:8px;transition:background-color .12s}.chapter-card[_ngcontent-%COMP%]:active{cursor:grabbing}.chapter-card[_ngcontent-%COMP%]:hover, .chapter-card--selected[_ngcontent-%COMP%]:hover{background-color:#283853b3;cursor:pointer}.chapter-card[_ngcontent-%COMP%]:hover   .chapter-card__title[_ngcontent-%COMP%], .chapter-card--selected[_ngcontent-%COMP%]:hover   .chapter-card__title[_ngcontent-%COMP%]{color:#fff}.chapter-card--loading[_ngcontent-%COMP%]{background:#1c2a3fcc;display:flex;margin:-4px;position:absolute;inset:0;justify-content:center;align-items:center}.chapter-card--selected[_ngcontent-%COMP%]{background:#1c2a3f}.chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__title[_ngcontent-%COMP%], .chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__description[_ngcontent-%COMP%]{color:#fff}.chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__image[_ngcontent-%COMP%]{border-color:#2d72dc}.chapter-card__content[_ngcontent-%COMP%]{display:flex}.chapter-card__image[_ngcontent-%COMP%]{border-radius:4px;border:2px solid transparent;flex:0 0 90px;height:90px;position:relative}.chapter-card__body[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;padding:0 0 0 12px;overflow:hidden}.chapter-card__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:700;word-break:break-word;color:#d7e0ea;white-space:initial}.chapter-card__description[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;color:#d7e0ea}.chapter-card__actions[_ngcontent-%COMP%]{margin-top:8px;text-align:right}.chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__content[_ngcontent-%COMP%]{justify-content:center}.chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__body[_ngcontent-%COMP%], .chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__actions[_ngcontent-%COMP%], .chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__add[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),t})();var ji,Ws=v(97948),Ii=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Ni=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};class Jt{constructor(t,n,i,o){this.store=t,this.storageService=n,this.dialogRef=i,this.changeDetectorRef=o,this.application=we.c.application,this.actionMode=Or.g.Import,this.contentType=bt.c.Module,this.ngUnsubscribe=new b.B}ngOnInit(){this.initGallery(),this.observeSearchConfig()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initGallery(){const t=this.getDefaultSearchConfig(),n=this.store.selectSnapshot(cn.Y.getSearchOptions)||new Ar.n("",$r.Ir);this.store.dispatch(new _t.w.SetCardActions({enabled:!1})),this.store.dispatch(new _t.w.SetBulkActions({enabled:!1,items:[]})),this.store.dispatch(new _t.w.SetSearchConfig(t)),this.store.dispatch(new _t.w.SetSearchOptions(n))}observeSearchConfig(){this.searchConfig$.pipe((0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.contentType=t.type===Ws.n.Category?bt.c.Module:bt.c.Bookmark,t.type===Ws.n.Loft&&this.saveSearchConfig(t),this.changeDetectorRef.markForCheck()})}handleSelect(t){this.store.dispatch(new _t.w.SelectBookmark(t)),this.dialogRef.close(t)}getDefaultSearchConfig(){if(we.c.application===Me.c.Studio)return new lo.pf("all");{const t=this.storageService.getLocalJSON(Ge.UT.RecentSearchConfig);if(t?.type===Ws.n.Loft){const{primary:n,secondary:i}=t;return new lo.qS(n,i)}return new lo.qS("production","maleAdult")}}saveSearchConfig({type:t,primary:n,secondary:i}){this.storageService.setLocalItem(Ge.UT.RecentSearchConfig,{type:t,primary:n,secondary:i})}}(ji=Jt).\u0275fac=function(t){return new(t||ji)(e.rXU(a.il),e.rXU(Ge.n$),e.rXU(Z.CP),e.rXU(e.gRc))},ji.\u0275cmp=e.VBU({type:ji,selectors:[["app-import-model-dialog"]],decls:5,vars:5,consts:[[1,"import"],[1,"import__header"],[1,"import__body"],["selectLabel","Import",3,"selectBookmark","actionMode","actionsEnabled","application","contentType","showSourcePicker"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2,"Import Chapters"),e.k0s(),e.j41(3,"div",2)(4,"app-gallery-container",3),e.bIt("selectBookmark",function(o){return n.handleSelect(o)}),e.k0s()()()),2&t&&(e.R7$(4),e.Y8G("actionMode",n.actionMode)("actionsEnabled",!1)("application",n.application)("contentType",n.contentType)("showSourcePicker",!0))},dependencies:[Ur.j],styles:["[_nghost-%COMP%]{display:block;position:relative;padding:24px;width:100%;height:100%}.import[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.import__header[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;border-bottom:solid 1px rgba(0,0,0,.12);padding:8px 20px;display:flex;align-items:center}.import__body[_ngcontent-%COMP%]{flex:1 0 auto;position:relative}"],changeDetection:0}),Ii([(0,a.l6)(cn.Y.getViewMode),Ni("design:type",u.c)],Jt.prototype,"viewMode$",void 0),Ii([(0,a.l6)(cn.Y.getLoading),Ni("design:type",u.c)],Jt.prototype,"loading$",void 0),Ii([(0,a.l6)(cn.Y.getFilteredResults),Ni("design:type",u.c)],Jt.prototype,"results$",void 0),Ii([(0,a.l6)(cn.Y.getSearchConfig),Ni("design:type",u.c)],Jt.prototype,"searchConfig$",void 0),Ii([(0,a.l6)(Ne.k.isPremiumUser),Ni("design:type",u.c)],Jt.prototype,"isPremiumUser$",void 0);var Bi,If=v(93253),Fo=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Po=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Nf=["chapterBrowser"];function Bf(s,t){1&s&&(e.j41(0,"div",9),e.nrm(1,"app-spinner",10),e.k0s())}function Df(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",11)(1,"app-chapter-card",12),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.handleClickChapter(o))})("remove",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleRemove(o))})("duplicate",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleDuplicate(o))}),e.k0s()()}if(2&s){let n,i;const o=t.$implicit,r=e.XpG();e.R7$(),e.Y8G("id","chapter-card__"+o.id)("chapter",o)("thumbnail",null==(n=e.bMT(2,6,r.thumbnails$))?null:n.get(o.id))("selected",(null==(i=e.bMT(3,8,r.selectedChapter$))?null:i.id)===o.id)("canRemove",e.bMT(4,10,r.chapters$).length>1)("compact",r.compact)}}class Kt{constructor(t,n,i){this.store=t,this.editService=n,this.dialog=i,this.compact=!1,this.ngUnsubscribe=new b.B,this.currentChapterId=""}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.selectedChapter$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.currentChapterId=t.id,setTimeout(()=>{this.scrollChapterIntoView(t)})})}handleDrop(t){this.store.dispatch(new V.Oj(t.previousIndex,t.currentIndex))}handleClickChapter(t){t.id!==this.currentChapterId&&this.store.dispatch(new V.yz(t))}handleImportChapters(){this.dialog.open(Jt,{id:Lt.t.ImportDialog,maxWidth:"90vw",width:"90vw",height:"90vh"}).afterClosed().pipe((0,j.p)(n=>null!=n)).subscribe(n=>{const i=this.store.selectSnapshot(Ne.k.getUserLanguage);this.store.dispatch(new _e.fn(n.id,n.type,i))})}handleNextClick(){this.store.dispatch(new V.tg)}handlePreviousClick(){this.store.dispatch(new V.F0)}handleDuplicate(t){this.duplicateChapter(t)}handleDuplicateSelected(){const t=this.store.selectSnapshot(I.N.getSelectedChapter);this.duplicateChapter(t)}handleRemove(t){this.removeChapter(t)}duplicateChapter(t){this.editService.duplicateChapter(t)}removeChapter(t){this.dialog.open(If.w,{data:{titleText:"Remove chapter",bodyText:"This cannot be undone.",confirmText:"Remove",confirmColor:"warn"}}).afterClosed().subscribe(n=>{n&&this.editService.removeChapter(t)})}trackChapter(t,n){return n.id}scrollChapterIntoView(t){const n=document.getElementById(`chapter-card__${t.id}`);(0,ha.uK)()&&n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}}(Bi=Kt).\u0275fac=function(t){return new(t||Bi)(e.rXU(a.il),e.rXU(Is),e.rXU(Z.bZ))},Bi.\u0275cmp=e.VBU({type:Bi,selectors:[["app-chapter-browser"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Nf,7),e.GBs(xa,5)),2&t){let i;e.mGM(i=e.lsd())&&(n.chapterBrowserElement=i.first),e.mGM(i=e.lsd())&&(n.chapterCards=i)}},inputs:{compact:"compact"},decls:16,vars:13,consts:[["chapterBrowser",""],["importMenu","matMenu"],["data-test","chapterBrowser","cdkDropList","","cdkDropListOrientation","vertical",1,"chapter-browser",3,"cdkDropListDropped"],["data-test","chapterSpinner","class","chapter-browser__scrim",4,"ngIf"],["class","chapter-browser__item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"chapter-browser__add"],["app-button","","buttonType","flat","data-test","addChapter",1,"w-full",3,"matMenuTriggerFor"],["mat-menu-item","",2,"min-width","240px",3,"click"],["mat-menu-item","","data-test","importChapter",3,"click"],["data-test","chapterSpinner",1,"chapter-browser__scrim"],["size","huge"],["cdkDrag","",1,"chapter-browser__item"],[3,"click","remove","duplicate","id","chapter","thumbnail","selected","canRemove","compact"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",2,0),e.bIt("cdkDropListDropped",function(r){return e.eBV(i),e.Njj(n.handleDrop(r))}),e.DNE(2,Bf,2,0,"div",3),e.nI1(3,"async"),e.DNE(4,Df,5,12,"div",4),e.nI1(5,"async"),e.j41(6,"div",5)(7,"button",6),e.EFF(8," Add Chapter "),e.k0s()()(),e.j41(9,"mat-menu",null,1)(11,"button",7),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleDuplicateSelected())}),e.EFF(12),e.nI1(13,"async"),e.k0s(),e.j41(14,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleImportChapters())}),e.EFF(15," Import Chapters... "),e.k0s()()}if(2&t){let i;const o=e.sdS(10);e.AVh("chapter-browser--compact",n.compact),e.R7$(2),e.Y8G("ngIf",!e.bMT(3,7,n.allChaptersLoaded$)),e.R7$(2),e.Y8G("ngForOf",e.bMT(5,9,n.chapters$))("ngForTrackBy",n.trackChapter),e.R7$(3),e.Y8G("matMenuTriggerFor",o),e.R7$(5),e.SpI(' Duplicate "',(null==(i=e.bMT(13,11,n.selectedChapter$))?null:i.displayName)||"Chapter",'" ')}},dependencies:[E.Sq,E.bT,te.O7,te.T1,$.kk,$.fb,$.Cp,L.Q,an.tI,xa,E.Jj],styles:[".chapter-browser[_ngcontent-%COMP%]{display:flex;flex-direction:column;-webkit-user-select:none;user-select:none;position:relative}.chapter-browser__scrim[_ngcontent-%COMP%]{background:#10182380;display:flex;justify-content:center;align-items:center;position:absolute;z-index:9;inset:0}.chapter-browser__item[_ngcontent-%COMP%]{flex:0 0 100%;display:block;padding:8px 0}.chapter-browser__item[_ngcontent-%COMP%]:last-child{border-bottom:0}.chapter-browser__item.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px 4px 0 0;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.chapter-browser__item.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.chapter-browser__add[_ngcontent-%COMP%]{bottom:0;position:sticky;background:#131c2a;padding:12px 0;z-index:1000}.chapter-browser__new[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;border-radius:4px;color:#374a68;min-height:60px;width:100%;border:1px dashed #374a68;display:flex;justify-content:center;align-items:center;text-align:center;margin:8px 0;padding:12px;transition:border-color .06s,color}.chapter-browser__new[_ngcontent-%COMP%]:hover{border-color:#fff;color:#fff;cursor:pointer}.chapter-browser[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.2}.chapter-browser[_ngcontent-%COMP%]   .cdk-drop-list-dragging[_ngcontent-%COMP%]   .chapter-browser__item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.chapter-browser--compact[_ngcontent-%COMP%]   .chapter-browser__add[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),Fo([(0,a.l6)(I.N.getStoryChapters),Po("design:type",u.c)],Kt.prototype,"chapters$",void 0),Fo([(0,a.l6)(I.N.getSelectedChapter),Po("design:type",u.c)],Kt.prototype,"selectedChapter$",void 0),Fo([(0,a.l6)(ro.K.getRegisteredThumbnails),Po("design:type",u.c)],Kt.prototype,"thumbnails$",void 0),Fo([(0,a.l6)(I.N.getAllChaptersModelsReady),Po("design:type",u.c)],Kt.prototype,"allChaptersLoaded$",void 0);var Di,Ea=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},wa=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Gf(s,t){if(1&s&&(e.j41(0,"button",29)(1,"span"),e.EFF(2,"Select"),e.k0s(),e.nrm(3,"app-icon",30),e.k0s()),2&s){e.XpG();const n=e.sdS(5);e.Y8G("matMenuTriggerFor",n)}}function $f(s,t){1&s&&e.EFF(0," structure ")}function Of(s,t){1&s&&e.EFF(0," structures ")}function Af(s,t){if(1&s&&(e.j41(0,"button",31),e.EFF(1),e.nI1(2,"async"),e.nI1(3,"number"),e.DNE(4,$f,1,0),e.nI1(5,"async"),e.nI1(6,"async"),e.DNE(7,Of,1,0),e.EFF(8," selected "),e.nrm(9,"app-icon",32),e.k0s()),2&s){const n=e.XpG(),i=e.sdS(14);e.Y8G("matMenuTriggerFor",i),e.R7$(),e.SpI(" ",e.bMT(3,5,e.bMT(2,3,n.checkedNodesCount$))," "),e.R7$(3),e.vxM(4,1===e.bMT(5,7,n.checkedNodesCount$)?4:e.bMT(6,9,n.checkedNodesCount$)>1?7:-1)}}function Uf(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"button",34),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleSelectAvailable(!1))}),e.EFF(2," Select Available "),e.k0s(),e.j41(3,"button",35),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleSelectUnavailable(!1))}),e.EFF(4," Select Unavailable "),e.k0s(),e.bVm()}}function Vf(s,t){if(1&s&&(e.qex(0),e.DNE(1,Uf,5,0,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,n.perChapterTreeEnabled$))}}function Lf(s,t){if(1&s&&(e.qex(0),e.j41(1,"button",36),e.EFF(2," Available / Unavailable "),e.k0s(),e.bVm()),2&s){e.XpG(2);const n=e.sdS(65);e.R7$(),e.Y8G("matMenuTriggerFor",n)}}function Yf(s,t){if(1&s&&(e.qex(0),e.DNE(1,Lf,3,1,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,n.perChapterTreeEnabled$))}}function zf(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"button",34),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleSelectAvailable(!0))}),e.EFF(2," Select Available "),e.k0s(),e.j41(3,"button",35),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.handleSelectUnavailable(!0))}),e.EFF(4," Select Unavailable "),e.k0s(),e.bVm()}}function Xf(s,t){if(1&s&&(e.qex(0),e.DNE(1,zf,5,0,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,n.perChapterTreeEnabled$))}}class Ro{constructor(t,n){this.store=t,this.graphService=n,this.application=Me.c,this.leaves=[]}handleClearSelection(){this.store.dispatch(new re.q9(!1))}handleBulkShow(){this.store.dispatch(new re.yr(!0,this.store.selectSnapshot(ve.z.getCheckedNodeIds)))}handleBulkHide(){const t=this.store.selectSnapshot(ve.z.getNodes),n=Object.values(t).reduce((i,o)=>(i[o.objectId]=!o.checked&&o.shown,i),{});this.store.dispatch(new re.yr(!1,[],n))}handleHideInverse(){const t=this.store.selectSnapshot(ve.z.getNodes),n=Object.values(t).reduce((i,o)=>(i[o.objectId]=!!o.checked&&o.shown,i),{});this.store.dispatch(new re.yr(!1,[],n))}handleSelectAll(){this.store.dispatch(new re.q9(!0))}handleSelectInverse(){this.selectNodesByFilter(({checked:t})=>!t)}handleSelectShown(t){this.selectNodesByFilter(({shown:n,checked:i})=>!(t&&!i)&&n)}handleSelectHidden(t){this.selectNodesByFilter(({shown:n,checked:i})=>!(t&&!i||n))}handleSelectAvailable(t){this.selectNodesByFilter(({available:n,checked:i})=>!(t&&!i)&&n)}handleSelectUnavailable(t){this.selectNodesByFilter(({available:n,checked:i})=>!(t&&!i||n))}handleBulkPickable(t){const n=this.store.selectSnapshot(ve.z.getNodes),i=Object.values(n).reduce((o,r)=>(o[r.objectId]=r.checked?t:r.pickable,o),{});this.store.dispatch(new re.Ke(!1,[],i))}handleInverseUnpickable(){const t=this.store.selectSnapshot(ve.z.getNodes),n=Object.values(t).reduce((i,o)=>(i[o.objectId]=!!o.checked&&o.pickable,i),{});this.store.dispatch(new re.Ke(!1,[],n))}handleBulkAvailable(t){const n=this.store.selectSnapshot(ve.z.getNodes),i=Object.values(n).reduce((o,r)=>(o[r.objectId]=r.checked?t:r.available,o),{});this.store.dispatch(new re.Ws(!1,[],i))}handleFadeSelected(){const t=this.store.selectSnapshot(ve.z.getCheckedNodeIds);this.store.dispatch(new re.Jp(qt.EC,t))}handleFadeInverse(){const t=this.store.selectSnapshot(ve.z.getCheckedNodeIds),n=this.store.selectSnapshot(_.S.getViewGraph),i=this.graphService.getInverseSelection(n,t);this.store.dispatch(new re.Jp(qt.EC,i))}selectNodesByFilter(t){const n=this.store.selectSnapshot(ve.z.getNodes),i=Object.entries(n).reduce((o,[r,l])=>(o[r]=t(l),o),{});this.store.dispatch(new re.q9(!1,[],i))}}(Di=Ro).\u0275fac=function(t){return new(t||Di)(e.rXU(a.il),e.rXU(mo.w))},Di.\u0275cmp=e.VBU({type:Di,selectors:[["app-checked-nodes"]],decls:70,vars:16,consts:[["selectMenu","matMenu"],["checkAllMenu","matMenu"],["selectActions","matMenu"],["showHideActions","matMenu"],["fadeActions","matMenu"],["pickableActions","matMenu"],["availableActions","matMenu"],["app-button","","buttonSize","xs","data-test","selectStructuresMenu",3,"matMenuTriggerFor",4,"ngIf"],["app-button","","buttonSize","xs","data-test","selectedNodesMenu",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","","data-test","selectAllStructures",3,"click"],["mat-menu-item","","data-test","selectShownStructures",3,"click"],["mat-menu-item","","data-test","selectHiddenStructures",3,"click"],[4,"appFlagApplication","appFlagApplicationMode"],["mat-menu-item","","data-test","selectActionsMenu",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","showHideMenu",3,"matMenuTriggerFor"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","pickableMenu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","selectEverythingElse",3,"click"],["mat-menu-item","","data-test","showSelected",3,"click"],["mat-menu-item","","data-test","hideSelected",3,"click"],["mat-menu-item","","data-test","hideEverythingElse",3,"click"],["mat-menu-item","","data-test","fadeThis",3,"click"],["mat-menu-item","","data-test","fadeEverythingElse",3,"click"],["mat-menu-item","","data-test","makePickable",3,"click"],["mat-menu-item","","data-test","makeUnpickable",3,"click"],["mat-menu-item","","data-test","makeEverythingElseUnpickable",3,"click"],["mat-menu-item","","data-test","makeAvailable",3,"click"],["mat-menu-item","","data-test","makeUnavailable",3,"click"],["app-button","","buttonSize","xs","data-test","selectStructuresMenu",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"],["app-button","","buttonSize","xs","data-test","selectedNodesMenu",3,"matMenuTriggerFor"],["icon","caret-down",1,"inline-block","pl-1"],[4,"ngIf"],["mat-menu-item","","data-test","selectAvailableStructures",3,"click"],["mat-menu-item","","data-test","selectUnavailableStructures",3,"click"],["mat-menu-item","","data-test","availableMenu",3,"matMenuTriggerFor"]],template:function(t,n){if(1&t){const i=e.RV6();e.DNE(0,Gf,4,1,"button",7),e.nI1(1,"async"),e.DNE(2,Af,10,11,"button",8),e.nI1(3,"async"),e.j41(4,"mat-menu",null,0)(6,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectAll())}),e.EFF(7," Select All "),e.k0s(),e.j41(8,"button",10),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectShown(!1))}),e.EFF(9," Select Visible (Shown) "),e.k0s(),e.j41(10,"button",11),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectHidden(!1))}),e.EFF(11," Select Hidden "),e.k0s(),e.DNE(12,Vf,3,3,"ng-container",12),e.k0s(),e.j41(13,"mat-menu",null,1)(15,"button",13),e.EFF(16," Select "),e.k0s(),e.nrm(17,"mat-divider"),e.j41(18,"button",14),e.EFF(19," Show / Hide "),e.k0s(),e.j41(20,"button",15),e.EFF(21," Fade "),e.k0s(),e.j41(22,"button",16),e.EFF(23," Selectable / Unselectable "),e.k0s(),e.DNE(24,Yf,3,3,"ng-container",12),e.nrm(25,"mat-divider"),e.j41(26,"button",17),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleClearSelection())}),e.EFF(27,"Clear Selection"),e.k0s()(),e.j41(28,"mat-menu",null,2)(30,"button",18),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectInverse())}),e.EFF(31," Select Everything Else "),e.k0s(),e.j41(32,"button",10),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectShown(!0))}),e.EFF(33," Select Visible (Shown) "),e.k0s(),e.j41(34,"button",11),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectHidden(!0))}),e.EFF(35," Select Hidden "),e.k0s(),e.DNE(36,Xf,3,3,"ng-container",12),e.nrm(37,"mat-divider"),e.j41(38,"button",17),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleClearSelection())}),e.EFF(39,"Clear Selection"),e.k0s()(),e.j41(40,"mat-menu",null,3)(42,"button",19),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkShow())}),e.EFF(43,"Show Selected"),e.k0s(),e.j41(44,"button",20),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkHide())}),e.EFF(45,"Hide Selected"),e.k0s(),e.nrm(46,"mat-divider"),e.j41(47,"button",21),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleHideInverse())}),e.EFF(48," Hide Everything Else "),e.k0s()(),e.j41(49,"mat-menu",null,4)(51,"button",22),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleFadeSelected())}),e.EFF(52,"Fade Selected"),e.k0s(),e.j41(53,"button",23),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleFadeInverse())}),e.EFF(54," Fade Everything Else "),e.k0s()(),e.j41(55,"mat-menu",null,5)(57,"button",24),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkPickable(!0))}),e.EFF(58," Make Selectable "),e.k0s(),e.j41(59,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkPickable(!1))}),e.EFF(60," Make Unselectable "),e.k0s(),e.nrm(61,"mat-divider"),e.j41(62,"button",26),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleInverseUnpickable())}),e.EFF(63," Make Everything Else Unselectable "),e.k0s()(),e.j41(64,"mat-menu",null,6)(66,"button",27),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkAvailable(!0))}),e.EFF(67," Make Available "),e.k0s(),e.j41(68,"button",28),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleBulkAvailable(!1))}),e.EFF(69," Make Unavailable "),e.k0s()()}if(2&t){const i=e.sdS(29),o=e.sdS(41),r=e.sdS(50),l=e.sdS(56);e.Y8G("ngIf",0===e.bMT(1,12,n.checkedNodesCount$)),e.R7$(2),e.Y8G("ngIf",e.bMT(3,14,n.checkedNodesCount$)),e.R7$(10),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include"),e.R7$(3),e.Y8G("matMenuTriggerFor",i),e.R7$(3),e.Y8G("matMenuTriggerFor",o),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(2),e.Y8G("matMenuTriggerFor",l),e.R7$(2),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include"),e.R7$(12),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include")}},dependencies:[E.bT,$.kk,$.fb,$.Cp,Qe.q,L.Q,Mn.Y,Y.R,E.Jj,E.QX],changeDetection:0}),Ea([(0,a.l6)(Qs._.getPerChapterTreeEnabled),wa("design:type",u.c)],Ro.prototype,"perChapterTreeEnabled$",void 0),Ea([(0,a.l6)(ve.z.getCheckedNodesCount),wa("design:type",u.c)],Ro.prototype,"checkedNodesCount$",void 0);var Gi,ht=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},ft=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const Qf=["columnBody"],qf=["columnGroupBody"],Hf=["searchInput"];function Wf(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",28)(1,"button",29),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleToggleAvailableNodesShown(!0))}),e.EFF(3," Entire Tree "),e.k0s(),e.j41(4,"button",29),e.nI1(5,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleToggleAvailableNodesShown(!1))}),e.EFF(6," Chapter Tree "),e.k0s()()}if(2&s){const n=e.XpG();e.R7$(),e.Y8G("buttonType",!0===e.bMT(2,2,n.showUnavailableNodes$)?"blue-fill":"default"),e.R7$(3),e.Y8G("buttonType",!1===e.bMT(5,4,n.showUnavailableNodes$)?"blue-fill":"default")}}function Jf(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.clearQuery())}),e.EFF(1," Clear "),e.k0s()}}function Kf(s,t){if(1&s&&(e.j41(0,"button",31),e.nrm(1,"app-icon",32),e.k0s()),2&s){e.XpG();const n=e.sdS(31);e.Y8G("matMenuTriggerFor",n)}}function Zf(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",33),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.setLayerOrderMode(!1))}),e.nrm(1,"app-icon",34),e.k0s()}}function eg(s,t){if(1&s&&(e.j41(0,"div",35),e.nrm(1,"app-tree",36),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.Y8G("theme",n.themeEnum.Dark)("graph",e.bMT(2,4,n.treeGraph$))("layerOrderMode",e.bMT(3,6,n.layerOrderMode$))("showTreeNodeIds",e.bMT(4,8,n.showTreeNodeIds$))}}function tg(s,t){if(1&s&&(e.j41(0,"div"),e.nrm(1,"app-tree-nested-node",39),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()),2&s){const n=t.$implicit,i=e.XpG(2);e.R7$(),e.Y8G("theme",i.themeEnum.Dark)("node",n)("graph",e.bMT(2,6,i.treeGraph$))("nested",!1)("layerOrderMode",e.bMT(3,8,i.layerOrderMode$))("showTreeNodeIds",e.bMT(4,10,i.showTreeNodeIds$))}}function ng(s,t){if(1&s&&(e.j41(0,"cdk-virtual-scroll-viewport",37),e.DNE(1,tg,5,12,"div",38),e.k0s()),2&s){const n=e.XpG();e.xc7("height",n.searchHeight,"px"),e.Y8G("itemSize",48),e.R7$(),e.Y8G("cdkVirtualForOf",n.searchResults)("cdkVirtualForTrackBy",n.trackTreeNode)}}class tt{get selectedColumnGroup(){return this._selectedColumnGroup}set selectedColumnGroup(t){this._selectedColumnGroup=t}constructor(t,n,i,o){this.store=t,this.renderer=n,this.changeDetector=i,this.engineEventsService=o,this.application=Me.c,this.themeEnum=Ef.P,this.isLoft=we.c.application===Me.c.Loft,this._selectedColumnGroup="chapters",this.loadingLabel="",this.interactive=!1,this.searchHeight=0,this.searchControl=new c.MJ(""),this.searchResults=[],this.copies=[],this.ngUnsubscribe=new b.B}ngOnInit(){const t=this.store.selectSnapshot(I.N.getSelectedChapter);t&&t.readyState.model&&(this.interactive=!0),this.searchQuery$=this.searchControl.valueChanges.pipe((0,P.Z)(this.searchControl.value)),this.searchQuery$.pipe((0,An.E)(this.treeGraph$),(0,S.Q)(this.ngUnsubscribe)).subscribe(([n,i])=>{this.searchResults=this.search(i,n),this.getSearchHeight().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(o=>{this.searchHeight=o,this.changeDetector.markForCheck()})}),this.engineEventsService.getEvent(dt.X.AssetsLoadProgress).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(({chapterProgress:n})=>{const i=this.store.selectSnapshot(I.N.getChaptersLoaded);let o="";i.count>1&&(o=`Loading Chapter ${i.modelChapters.length+1} of ${i.count}: `),o+=`${Math.round(100*n)}%`,this.loadingLabel=o,this.changeDetector.markForCheck()}),this.currentChapter$.pipe((0,j.p)(n=>null!=n),(0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{this.interactive=n.readyState.model}),(0,m.z)([this.store.select(ve.z.getCheckedNodesCount),this.store.select(_.S.getLabelEditNode)]).pipe((0,j.p)(([n,i])=>n>0||!(0,R.isNil)(i)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.selectedColumnGroup="anatomy",this.changeDetector.markForCheck()}),this.leftColumnCollapsed$.pipe((0,j.p)(n=>n),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.selectedColumnGroup="chapters",this.changeDetector.markForCheck()})}ngAfterViewInit(){this.renderer.listen("window","resize",t=>{this.getSearchHeight().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{this.searchHeight=n,this.changeDetector.markForCheck()})})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleKeyup(t){"Escape"===t.key&&(this.clearQuery(),this.searchInput.nativeElement.blur())}toggleCollapseNavigationClick(){const t=this.store.selectSnapshot(X.getLeftColumnCollapsed);this.store.dispatch(new w.HZ(!t))}handleToggleIds(){this.store.dispatch(new w.m3)}handleToggleRootNodes(){const t=this.store.selectSnapshot(X.getShowRootNodes);this.store.dispatch(new w.N6(!t))}handleToggleAvailableNodesShown(t){this.store.dispatch(new Jr.Z(t))}handleCollapseStructures(){this.store.dispatch(new oe.v$)}getSearchHeight(){return new u.c(t=>{const n=(0,R.get)(this.columnGroupBody,"nativeElement.parentElement.offsetHeight");null!=n&&(t.next(n),t.complete())})}clearQuery(){this.searchControl.setValue("")}search(t,n){return(0,wf.i)(t,n,[{field:"label",dir:"asc"},{field:"depth",dir:"asc"}])}trackTreeNode(t,n){return n.id}setLayerOrderMode(t){this.store.dispatch(new w.zA(t))}autoSortLayers(){this.store.dispatch(new oe.RZ),this.setLayerOrderMode(!0)}resetLayers(){this.store.dispatch(new oe.PF),this.setLayerOrderMode(!0)}}var $i;(Gi=tt).\u0275fac=function(t){return new(t||Gi)(e.rXU(a.il),e.rXU(e.sFG),e.rXU(e.gRc),e.rXU(mn.y))},Gi.\u0275cmp=e.VBU({type:Gi,selectors:[["app-navigation-context"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Qf,5),e.GBs(qf,7),e.GBs(Hf,7)),2&t){let i;e.mGM(i=e.lsd())&&(n.columnBody=i.first),e.mGM(i=e.lsd())&&(n.columnGroupBody=i.first),e.mGM(i=e.lsd())&&(n.searchInput=i.first)}},decls:55,vars:35,consts:[["searchInput",""],["treeActions","matMenu"],["layerOrderActions","matMenu"],["columnGroupBody",""],[1,"navigation-context",3,"selectedColumnGroupChange","loadingLabel","loading","showHeader","selectedColumnGroup"],["column-group-actions",""],["app-button","","buttonSize","sm","buttonShape","square","data-test","editColumnToggle",3,"click","matTooltip"],["size","lg",3,"icon"],["label","Chapters"],["column-group-body",""],[1,"pt-2","pl-2"],["label","Anatomy"],["column-group-header",""],[1,"navigation-context__anatomy-header"],["class","mt-2 mb-4 navigation-context__anatomy-toggle",4,"ngIf"],[1,"navigation-context__search"],["type","text","placeholder","Search...",1,"input","navigation-context__input",3,"keyup","formControl"],["app-button","","buttonType","text","class","navigation-context__clear",3,"click",4,"ngIf"],[1,"navigation-context__anatomy-subheader"],[1,"navigation-context__selected"],["app-button","","buttonSize","xs","matTooltip","Collapse Open Tree Structures",3,"click"],["icon","minus","size","xs"],["app-button","","buttonSize","xs","class","ml-1",3,"matMenuTriggerFor",4,"ngIf"],["class","ml-1","app-button","","buttonSize","xs","matTooltip","Exit Layer Order Manager",3,"click",4,"ngIf"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["class","px-2 pt-2",4,"ngIf"],["style","margin-right: -12px",3,"itemSize","height",4,"ngIf"],[1,"mt-2","mb-4","navigation-context__anatomy-toggle"],["app-button","","buttonSize","sm",1,"flex-auto",3,"click","buttonType"],["app-button","","buttonType","text",1,"navigation-context__clear",3,"click"],["app-button","","buttonSize","xs",1,"ml-1",3,"matMenuTriggerFor"],["icon","ellipsis-v","size","xs"],["app-button","","buttonSize","xs","matTooltip","Exit Layer Order Manager",1,"ml-1",3,"click"],["icon","times"],[1,"px-2","pt-2"],[3,"theme","graph","layerOrderMode","showTreeNodeIds"],[2,"margin-right","-12px",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[2,"height","48px",3,"theme","node","graph","nested","layerOrderMode","showTreeNodeIds"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column",4),e.nI1(1,"async"),e.mxI("selectedColumnGroupChange",function(r){return e.eBV(i),e.DH7(n.selectedColumnGroup,r)||(n.selectedColumnGroup=r),e.Njj(r)}),e.j41(2,"div",5)(3,"button",6),e.nI1(4,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.toggleCollapseNavigationClick())}),e.nrm(5,"app-icon",7),e.nI1(6,"async"),e.k0s()(),e.j41(7,"app-column-group",8),e.qex(8,9),e.j41(9,"div",10),e.nrm(10,"app-chapter-browser"),e.k0s(),e.bVm(),e.k0s(),e.j41(11,"app-column-group",11),e.qex(12,12),e.j41(13,"div",13),e.DNE(14,Wf,7,6,"div",14),e.nI1(15,"async"),e.j41(16,"div",15)(17,"input",16,0),e.bIt("keyup",function(r){return e.eBV(i),e.Njj(n.handleKeyup(r))}),e.k0s(),e.DNE(19,Jf,2,0,"button",17),e.nI1(20,"async"),e.k0s(),e.j41(21,"div",18),e.nrm(22,"app-checked-nodes",19),e.j41(23,"div")(24,"button",20),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleCollapseStructures())}),e.nrm(25,"app-icon",21),e.k0s(),e.DNE(26,Kf,2,1,"button",22),e.nI1(27,"async"),e.DNE(28,Zf,2,0,"button",23),e.nI1(29,"async"),e.k0s()(),e.j41(30,"mat-menu",null,1)(32,"button",24),e.EFF(33,"Layer Order"),e.k0s(),e.nrm(34,"mat-divider"),e.j41(35,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleToggleIds())}),e.EFF(36,"Toggle IDs"),e.k0s(),e.j41(37,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleToggleRootNodes())}),e.EFF(38),e.nI1(39,"async"),e.k0s()(),e.j41(40,"mat-menu",null,2)(42,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.setLayerOrderMode(!0))}),e.EFF(43,"Manage Layer Order"),e.k0s(),e.nrm(44,"mat-divider"),e.j41(45,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.autoSortLayers())}),e.EFF(46,"Auto Sort Layer Order"),e.k0s(),e.j41(47,"button",25),e.bIt("click",function(){return e.eBV(i),e.Njj(n.resetLayers())}),e.EFF(48,"Reset Layer Order"),e.k0s()()(),e.bVm(),e.j41(49,"div",9,3),e.DNE(51,eg,5,10,"div",26),e.nI1(52,"async"),e.DNE(53,ng,2,5,"cdk-virtual-scroll-viewport",27),e.nI1(54,"async"),e.k0s()()()}if(2&t){const i=e.sdS(41);e.Y8G("loadingLabel",n.loadingLabel)("loading",!e.bMT(1,15,n.allChaptersReady$))("showHeader",!1),e.R50("selectedColumnGroup",n.selectedColumnGroup),e.R7$(3),e.Y8G("matTooltip",e.bMT(4,17,n.leftColumnCollapsed$)?"Expand":"Collapse"),e.R7$(2),e.Y8G("icon",e.bMT(6,19,n.leftColumnCollapsed$)?"right-to-line":"left-to-line"),e.R7$(9),e.Y8G("ngIf",n.isLoft&&e.bMT(15,21,n.perChapterTreeEnabled$)),e.R7$(3),e.Y8G("formControl",n.searchControl),e.R7$(2),e.Y8G("ngIf",e.bMT(20,23,n.searchQuery$).length>0),e.R7$(7),e.Y8G("ngIf",n.isLoft&&!e.bMT(27,25,n.layerOrderMode$)),e.R7$(2),e.Y8G("ngIf",n.isLoft&&e.bMT(29,27,n.layerOrderMode$)),e.R7$(4),e.Y8G("matMenuTriggerFor",i),e.R7$(6),e.SpI(" ",e.bMT(39,29,n.showRootNodes$)?"Hide":"Show"," Root Nodes "),e.R7$(13),e.Y8G("ngIf",0===e.bMT(52,31,n.searchQuery$).length),e.R7$(2),e.Y8G("ngIf",e.bMT(54,33,n.searchQuery$).length>0&&n.searchHeight)}},dependencies:[E.bT,c.me,c.BC,c.l_,$.kk,$.fb,$.Cp,Ce.oV,Qe.q,qs.yg,qs.E$,qs.d6,L.Q,mt,st,Y.R,Ff.g,Pf.r,Kt,Ro,E.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.navigation-context__anatomy-toggle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:4px;background-color:#101823;padding:4px;border-radius:4px}.navigation-context__anatomy-subheader[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.navigation-context__loading[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:center}.navigation-context__search[_ngcontent-%COMP%]{position:relative;margin-bottom:8px}.navigation-context__input[_ngcontent-%COMP%]{padding-right:56px;width:100%}.navigation-context__clear[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.navigation-context__selected[_ngcontent-%COMP%]{display:flex}.navigation-context__actions[_ngcontent-%COMP%]{border-radius:4px;color:#d7e0ea;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center}.navigation-context__actions[_ngcontent-%COMP%]:hover{background-color:#1c2a3f;color:#fff;cursor:pointer}.navigation-context--selected[_ngcontent-%COMP%]   .navigation-context__actions[_ngcontent-%COMP%]:hover{background-color:#2d72dc}"],changeDetection:0}),ht([(0,a.l6)(Qs._.getPerChapterTreeEnabled),ft("design:type",u.c)],tt.prototype,"perChapterTreeEnabled$",void 0),ht([(0,a.l6)(_.S.getTreeGraph),ft("design:type",u.c)],tt.prototype,"treeGraph$",void 0),ht([(0,a.l6)(I.N.getSelectedChapter),ft("design:type",u.c)],tt.prototype,"currentChapter$",void 0),ht([(0,a.l6)(I.N.getChaptersLoaded),ft("design:type",u.c)],tt.prototype,"chaptersLoaded$",void 0),ht([(0,a.l6)(I.N.getAllChaptersModelsReady),ft("design:type",u.c)],tt.prototype,"allChaptersReady$",void 0),ht([(0,a.l6)(X.getLayerOrderMode),ft("design:type",u.c)],tt.prototype,"layerOrderMode$",void 0),ht([(0,a.l6)(X.getShowRootNodes),ft("design:type",u.c)],tt.prototype,"showRootNodes$",void 0),ht([(0,a.l6)(Qs._.getShowUnavailableNodes),ft("design:type",u.c)],tt.prototype,"showUnavailableNodes$",void 0),ht([(0,a.l6)(X.getLeftColumnCollapsed),ft("design:type",u.c)],tt.prototype,"leftColumnCollapsed$",void 0),ht([(0,a.l6)(X.getShowTreeNodeIds),ft("design:type",u.c)],tt.prototype,"showTreeNodeIds$",void 0);class Js{constructor(t){this.store=t}toggleCollapseNavigationClick(){const t=this.store.selectSnapshot(X.getLeftColumnCollapsed);this.store.dispatch(new w.HZ(!t))}}($i=Js).\u0275fac=function(t){return new(t||$i)(e.rXU(a.il))},$i.\u0275cmp=e.VBU({type:$i,selectors:[["app-navigation-context-compact"]],decls:11,vars:9,consts:[[3,"showHeader"],[3,"compact"],["column-group-header",""],[1,"flex","justify-end"],["app-button","","buttonSize","xs","buttonShape","square","data-test","editColumnToggle",3,"click","matTooltip"],["size","lg",3,"icon"],["column-group-body",""],[1,"px-3"]],template:function(t,n){1&t&&(e.j41(0,"app-column",0)(1,"app-column-group",1),e.qex(2,2),e.j41(3,"div",3)(4,"button",4),e.nI1(5,"async"),e.bIt("click",function(){return n.toggleCollapseNavigationClick()}),e.nrm(6,"app-icon",5),e.nI1(7,"async"),e.k0s()(),e.bVm(),e.j41(8,"div",6)(9,"div",7),e.nrm(10,"app-chapter-browser",1),e.k0s()()()()),2&t&&(e.Y8G("showHeader",!1),e.R7$(),e.Y8G("compact",!1),e.R7$(3),e.Y8G("matTooltip",e.bMT(5,5,n.leftColumnCollapsed$)?"Expand":"Collapse"),e.R7$(2),e.Y8G("icon",e.bMT(7,7,n.leftColumnCollapsed$)?"right-to-line":"left-to-line"),e.R7$(4),e.Y8G("compact",!0))},dependencies:[Ce.oV,L.Q,mt,st,Y.R,Kt,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(X.getLeftColumnCollapsed),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Js.prototype,"leftColumnCollapsed$",void 0);var Ks=v(2094);const He=300;var Oi;const ag=["currentTime"];class Zs{constructor(t,n,i){this.changeDetection=t,this.engineService=n,this.animationService=i,this.ngUnsubscribe=new b.B,this.currentTimeFocused=!1}ngOnInit(){this.selectedChapterId$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.setCurrentTime(this.animationService.getTime()),this.changeDetection.markForCheck()}),(0,f.h)(this.engineService.getEvent(dt.X.TimelinePlaying),this.engineService.getEvent(dt.X.TimelineScrubbed)).pipe((0,Ks.c)(20),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setCurrentTime(t.time)}),this.engineService.getEvent(dt.X.TimelineTimeFrameUpdated).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.changeDetection.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFocus(){this.currentTimeFocused=!0,this.currentTimeInput.nativeElement.value=""}handleBlur(){this.currentTimeFocused=!1,this.animationService.pause();const t=this.animationService.parseFormattedTime(this.currentTimeInput.nativeElement.value||this.currentTime);this.animationService.scrub(t)}setChapterTimeFrame(){this.duration=this.animationService.formatTime(this.animationService.getChapterDuration())}setCurrentTime(t){this.currentTime=this.animationService.formatTime(t),this.currentTimeFocused||(this.currentTimeInput.nativeElement.value=this.currentTime)}}(Oi=Zs).\u0275fac=function(t){return new(t||Oi)(e.rXU(e.gRc),e.rXU(mn.y),e.rXU(wt.O))},Oi.\u0275cmp=e.VBU({type:Oi,selectors:[["app-engine-current-time"]],viewQuery:function(t,n){if(1&t&&e.GBs(ag,7),2&t){let i;e.mGM(i=e.lsd())&&(n.currentTimeInput=i.first)}},decls:5,vars:1,consts:[["currentTime",""],[1,"engine-current-time"],["type","text",1,"input","engine-current-time__current-time",3,"focus","blur"],[1,"text-xs","ml-2"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",1)(1,"input",2,0),e.bIt("focus",function(){return e.eBV(i),e.Njj(n.handleFocus())})("blur",function(){return e.eBV(i),e.Njj(n.handleBlur())}),e.k0s(),e.j41(3,"span",3),e.EFF(4),e.k0s()()}2&t&&(e.R7$(4),e.SpI("/ ",n.duration,""))},styles:[".engine-current-time[_ngcontent-%COMP%]{display:flex;align-items:center;color:#d7e0ea}.engine-current-time__current-time[type=text][_ngcontent-%COMP%]{width:100px;color:inherit}"],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(I.N.getSelectedChapterId),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],Zs.prototype,"selectedChapterId$",void 0);let lg=(()=>{var s;class t{constructor(i){this.animationService=i}ngOnInit(){}handleClick(){this.animationService.scrubFrame(this.direction)}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(wt.O))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-engine-frame-control"]],inputs:{direction:"direction"},decls:2,vars:1,consts:[["app-button","","buttonShape","square","type","button",3,"click"],["size","lg",3,"icon"]],template:function(i,o){1&i&&(e.j41(0,"button",0),e.bIt("click",function(){return o.handleClick()}),e.nrm(1,"app-icon",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("icon","next"===o.direction?"step-forward":"step-backward"))},dependencies:[L.Q,Y.R],changeDetection:0}),t})();var Ai,Fa=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Pa=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const cg=(s,t)=>({"timeline-map--selected":s,"timeline-map--overlapping":t}),pg=(s,t)=>({"width.px":s,"left.px":t});function dg(s,t){1&s&&(e.j41(0,"div",9),e.nrm(1,"app-icon",10),e.k0s())}function mg(s,t){1&s&&(e.j41(0,"div",11),e.nrm(1,"app-icon",12),e.k0s())}function ug(s,t){1&s&&(e.j41(0,"div",13),e.nrm(1,"app-icon",14),e.k0s())}class Mo{constructor(t,n){this.animationService=t,this.changeDetectorRef=n,this.ngUnsubscribe=new b.B}ngOnInit(){this.hasAnimations="dummy"!==this.timelineMap.name&&"dummy"!==this.timelineMap.data.timeline,this.stateTimeRange=this.buildStateTimeRange(),this.looping=!this.timelineMap.data.fit&&"loop"===this.timelineMap.data.onEnd,this.initListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngOnChanges(){const t=this.timelineMap.end-this.timelineMap.start;this.left=this.timelineMap.start*He*this.scale,this.width=t*He*this.scale}initListeners(){this.selectedTimelineMapIds$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.selected=t.has(this.timelineMap.id),this.changeDetectorRef.markForCheck()}),this.overlappingTimelineMapIds$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.overlapping=t.has(this.timelineMap.id),this.changeDetectorRef.markForCheck()})}buildStateTimeRange(){const n=this.timelineMap.data.end;return`${this.animationService.formatTime(this.timelineMap.data.start)} - ${this.animationService.formatTime(n)}`}}(Ai=Mo).\u0275fac=function(t){return new(t||Ai)(e.rXU(wt.O),e.rXU(e.gRc))},Ai.\u0275cmp=e.VBU({type:Ai,selectors:[["app-timeline-map"]],inputs:{scale:"scale",timelineMap:"timelineMap"},features:[e.OA$],decls:11,vars:13,consts:[[1,"timeline-map",3,"ngClass","ngStyle"],[1,"timeline-map__top"],[1,"timeline-map__name","text-2xs"],[1,"timeline-map__middle"],[1,"timeline-map__state-time-range","text-2xs"],[1,"timeline-map__bottom"],["class","timeline-map__no-animations mr-2",4,"ngIf"],["class","timeline-map__fit mr-2",4,"ngIf"],["class","timeline-map__loop",4,"ngIf"],[1,"timeline-map__no-animations","mr-2"],["icon","exclamation-circle","size","xs","matTooltip","This state has no animations"],[1,"timeline-map__fit","mr-2"],["icon","arrows-alt-h","size","xs"],[1,"timeline-map__loop"],["icon","repeat-alt","size","xs"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3),e.k0s()(),e.j41(4,"div",3)(5,"div",4),e.EFF(6),e.k0s()(),e.j41(7,"div",5),e.DNE(8,dg,2,0,"div",6)(9,mg,2,0,"div",7)(10,ug,2,0,"div",8),e.k0s()()),2&t&&(e.Y8G("ngClass",e.l_i(7,cg,n.selected,n.overlapping))("ngStyle",e.l_i(10,pg,n.width,n.left)),e.R7$(3),e.JRh(n.timelineMap.name),e.R7$(3),e.JRh(n.stateTimeRange),e.R7$(2),e.Y8G("ngIf",!n.hasAnimations),e.R7$(),e.Y8G("ngIf",n.timelineMap.data.fit),e.R7$(),e.Y8G("ngIf",n.looping))},dependencies:[E.YU,E.bT,E.B3,Ce.oV,Y.R],styles:[".timeline-map[_ngcontent-%COMP%]{position:absolute;height:100%;background-color:#283853;border:2px solid transparent;border-right:1px solid #131c2a;cursor:pointer;display:flex;flex-direction:column;justify-content:space-evenly;min-width:0;padding:0 4px;-webkit-user-select:none;user-select:none}.timeline-map__top[_ngcontent-%COMP%], .timeline-map__middle[_ngcontent-%COMP%], .timeline-map__bottom[_ngcontent-%COMP%]{display:flex;min-height:33%;flex:0 0 33%;align-items:center}.timeline-map__name[_ngcontent-%COMP%], .timeline-map__state-time-range[_ngcontent-%COMP%]{color:#d7e0ea;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.timeline-map__bottom[_ngcontent-%COMP%]{overflow:hidden}.timeline-map__fit[_ngcontent-%COMP%]{color:#ff0}.timeline-map__loop[_ngcontent-%COMP%]{color:#0ff}.timeline-map--selected[_ngcontent-%COMP%]{border:2px solid #2d72dc;z-index:1}.timeline-map--overlapping[_ngcontent-%COMP%]{background-color:#a81914}"],changeDetection:0}),Fa([(0,a.l6)(ke.getSelectedTimelineMapIds),Pa("design:type",u.c)],Mo.prototype,"selectedTimelineMapIds$",void 0),Fa([(0,a.l6)(ke.getOverlappingTimelineMapIds),Pa("design:type",u.c)],Mo.prototype,"overlappingTimelineMapIds$",void 0);var Ui,Sn=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Tn=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const hg=["leafTimelinesWindow"],fg=["rulerWindow"],gg=["tracksWindow"],bg=["timelineRuler"],_g=["currentTimeHead"],Cg=["currentTimeLine"],vg=["hoverTimeHead"],yg=["hoverTimeLine"],kg=["hoverTimeLabel"],Zt=s=>({"width.px":s}),er=s=>({"left.px":s}),Sg=s=>({"edit-timeline__hover-time-head--show":s}),Tg=s=>({"height.px":s}),xg=s=>({"edit-timeline__hover-time-line--show":s}),Eg=s=>({"edit-timeline__seconds-mark":s});function wg(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",42),e.bIt("mouseenter",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.handleRulerMarkMouseEnter(o))}),e.j41(1,"div",43),e.bIt("click",function(){const o=e.eBV(n).index,r=e.XpG();return e.Njj(r.scrubToRulerMark(o))}),e.EFF(2),e.k0s()()}if(2&s){const n=t.$implicit;e.Y8G("ngStyle",e.eq3(3,er,n.left))("ngClass",e.eq3(5,Eg,n.seconds)),e.R7$(2),e.SpI(" ",n.label," ")}}function Fg(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",44),e.bIt("click",function(o){const r=e.eBV(n).index,l=e.XpG();return e.Njj(l.handleTimelineClick(o,r))}),e.j41(1,"div",45),e.EFF(2),e.k0s(),e.j41(3,"button",46),e.nrm(4,"app-icon",47),e.k0s(),e.j41(5,"mat-menu",null,9)(7,"button",48),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.addTimelineClip(o))}),e.EFF(8,"Add Clip"),e.k0s(),e.j41(9,"button",49),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG();return e.Njj(r.pasteTimelineMaps(o))}),e.EFF(10),e.k0s()()()}if(2&s){const n=t.$implicit,i=e.sdS(6),o=e.XpG();e.R7$(2),e.SpI(" ",n," "),e.R7$(),e.Y8G("matMenuTriggerFor",i),e.R7$(6),e.Y8G("disabled",!o.hasCopiedTimelineMaps),e.R7$(),e.SpI(" ",o.pasteClipsText," ")}}function Pg(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-timeline-map",52),e.bIt("click",function(o){const r=e.eBV(n).$implicit,l=e.XpG(2);return e.Njj(l.handleTimelineMapClick(o,r))}),e.k0s()}if(2&s){const n=t.$implicit,i=e.XpG(2);e.Y8G("scale",i.scale)("timelineMap",n)}}function Rg(s,t){if(1&s&&(e.j41(0,"div",50),e.DNE(1,Pg,1,2,"app-timeline-map",51),e.k0s()),2&s){const n=t.$implicit;e.R7$(),e.Y8G("ngForOf",n)}}class Nt{constructor(t,n,i,o,r){this.store=t,this.animationService=n,this.engineService=i,this.renderer=o,this.changeDetectorRef=r,this.storyAnimationNames$=new ns.t([]),this.showHoverTimeIndicator=!1,this.ngUnsubscribe=new b.B}ngOnInit(){this.setStoryAnimationNames(),this.setScrollbarWidth(),this.setLeafTimelinesWindowWidth(),this.initListeners(),this.initEngineEventListeners(),this.initBrowserEventListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.scale$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setScale(t),this.setCurrentTimeIndicator(this.animationService.getTime()),this.buildRulerMarks(),this.checkOverflowX(),this.changeDetectorRef.markForCheck()}),this.selectedTimelineMapIds$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.selectedTimelineMapIds=t,this.changeDetectorRef.markForCheck()}),this.copiedTimelineMaps$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.copiedTimelineMaps=t,this.setHasCopiedTimelineMaps(),this.changeDetectorRef.markForCheck()}),(0,m.z)([this.storyAnimationNames$,this.selectedChapterTimelineMap$]).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{this.buildChapterLeafTimelinesMaps(t,n),this.checkTimelineMapOverlaps(),this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()}),this.selectedChapterId$.pipe((0,j.p)(t=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.setCurrentTimeIndicator(this.animationService.getTime()),this.store.dispatch(new ue.SetSelectedTimelineMapIds([])),this.changeDetectorRef.markForCheck()}),this.loadChaptersRemaining$.pipe((0,j.p)(t=>0===t.length),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setStoryAnimationNames(),this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()})}initEngineEventListeners(){(0,f.h)(this.engineService.getEvent(dt.X.TimelinePlaying),this.engineService.getEvent(dt.X.TimelineScrubbed)).pipe((0,Ks.c)(20),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setCurrentTimeIndicator(t.time)}),this.engineService.getEvent(dt.X.TimelineTimeFrameUpdated).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()})}initBrowserEventListeners(){(0,d.R)(window,"resize").pipe((0,W.B)(50),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkOverflowX(),this.changeDetectorRef.markForCheck()}),(0,d.R)(this.tracksWindow.nativeElement,"scroll").pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleTracksScroll()),(0,d.R)(this.leafTimelinesWindow.nativeElement,"scroll").pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleLeafTimelinesScroll())}checkOverflowX(){this.overflowX=this.tracksContainerWidth>this.tracksWindow.nativeElement.clientWidth}handleCTIMouseDown(t){t.preventDefault();const n=(0,d.R)(window,"mousemove"),i=(0,d.R)(window,"mouseup").pipe((0,xt.$)()),o=this.tracksWindow.nativeElement.getBoundingClientRect();this.scrubbing=!0,i.subscribe(()=>{this.scrubbing=!1,this.autoScrolling=!1}),n.pipe((0,Ks.c)(20),(0,S.Q)(i)).subscribe(r=>{const l=r.clientX;if(this.overflowX&&(l>o.right||l<o.left?(this.autoScrollOffset=l>o.right?l-o.right:l-o.left,this.autoScrolling||(this.autoScrolling=!0,this.autoScroll())):this.autoScrolling=!1),!this.autoScrolling){const p=this.timelineRuler.nativeElement.getBoundingClientRect();this.scrubToTime((l-p.left)/(He*this.scale))}})}autoScroll(){const t=this.tracksWindow.nativeElement.getBoundingClientRect(),n=()=>{const i=this.tracksWindow.nativeElement.scrollLeft;let o;o=this.autoScrollOffset<0?(i-20)/(He*this.scale):(t.width+i-20)/(He*this.scale),this.scrubToTime(o+this.autoScrollOffset/(He*this.scale));const T=(this.autoScrollOffset>0?1:-1)*Math.sqrt(Math.abs(this.autoScrollOffset));this.setTracksScrollLeft(i+T),this.autoScrolling&&requestAnimationFrame(n)};requestAnimationFrame(n)}handleTracksScroll(){this.ignoreScrollEvent?this.ignoreScrollEvent=!1:this.setLeafTimelinesScrollTop(this.tracksWindow.nativeElement.scrollTop),this.setRulerScrollLeft(this.tracksWindow.nativeElement.scrollLeft)}handleLeafTimelinesScroll(){this.ignoreScrollEvent?this.ignoreScrollEvent=!1:this.setTracksScrollTop(this.leafTimelinesWindow.nativeElement.scrollTop)}setRulerScrollLeft(t){this.rulerWindow.nativeElement.scrollLeft=t}setTracksScrollLeft(t){this.tracksWindow.nativeElement.scrollLeft=t}setTracksScrollTop(t){this.ignoreScrollEvent=!0,this.tracksWindow.nativeElement.scrollTop=t}setLeafTimelinesScrollTop(t){this.ignoreScrollEvent=!0,this.leafTimelinesWindow.nativeElement.scrollTop=t}handleRulerMarkMouseEnter(t){if(!this.scrubbing){this.showHoverTimeIndicator=!0;let n=t/this.rulerMarksPerSecond;n=this.animationService.getNearestFrameTime(n),this.setHoverTimeIndicator(n)}}handleRulerMouseEnter(t){if(!this.scrubbing){this.showHoverTimeIndicator=!0;let n=t.offsetX/(He*this.scale);n=this.animationService.getNearestFrameTime(n),this.setHoverTimeIndicator(n)}}handleRulerMouseMove(t){if(!this.scrubbing&&t.currentTarget===t.target){let n=t.offsetX/(He*this.scale);n=this.animationService.getNearestFrameTime(n),this.setHoverTimeIndicator(n)}}handleRulerMouseLeave(){this.showHoverTimeIndicator=!1}handleTimelineMapClick(t,n){t.shiftKey?this.selectedTimelineMapIds.has(n.id)?this.store.dispatch(new ue.RemoveFromSelectedTimelineMapIds([n.id])):this.store.dispatch(new ue.AddToSelectedTimelineMapIds([n.id])):this.store.dispatch(new ue.SetSelectedTimelineMapIds([n.id]))}handleTimelineClick(t,n){const o=this.chapterTimelinesMaps[n].map(r=>r.id);t.shiftKey?o.every(l=>this.selectedTimelineMapIds.has(l))?this.store.dispatch(new ue.RemoveFromSelectedTimelineMapIds(o)):this.store.dispatch(new ue.AddToSelectedTimelineMapIds(o)):this.store.dispatch(new ue.SetSelectedTimelineMapIds(o))}buildChapterLeafTimelinesMaps(t,n){this.chapterTimelinesMaps=t.map(i=>n.filter(r=>r.data.timeline===i))}checkTimelineMapOverlaps(){const t=new Set;this.chapterTimelinesMaps.forEach(n=>{for(let i=0;i<n.length-1;i++){const o=n[i];for(let r=i+1;r<n.length;r++){const l=n[r];(o.start<l.start?o.end>l.start:o.start<l.end)&&t.add(o.id).add(l.id)}}}),this.store.dispatch(new ue.SetOverlappingTimelineMapIds(Array.from(t)))}pasteTimelineMaps(t){const n=this.copiedTimelineMaps.map(o=>{const r=(0,R.cloneDeep)(o);return r.id=Ze.u.getUuid(),r.data.timeline=t,r});this.animationService.updateTimelineClips(n),this.store.dispatch(new V.lc(n));const i=n.map(o=>o.id);this.store.dispatch(new ue.SetSelectedTimelineMapIds(i))}setHasCopiedTimelineMaps(){const t=this.copiedTimelineMaps.length;this.hasCopiedTimelineMaps=t>0,this.pasteClipsText=this.hasCopiedTimelineMaps?1===t?"Paste Clip":`Paste ${t} Clips`:"Paste Clips"}addTimelineClip(t){let i;const o=this.store.selectSnapshot(I.N.getSelectedChapter).timelineMap.filter(r=>r.data.timeline===t).sort((r,l)=>r.end-l.end).pop();if(null!=o){const r=o.end-o.start;i=(0,R.cloneDeep)(o),i.id=Ze.u.getUuid(),i.start=o.end,i.end=i.start+r}else i={id:Ze.u.getUuid(),start:0,end:this.manifestsMaxTimes?.[t]??1,name:"",data:{timeline:t,start:0,end:this.manifestsMaxTimes?.[t]??1,fit:!1,onEnd:"freeze"}};this.animationService.updateTimelineClips([i]),this.store.dispatch(new V.lc([i])),this.store.dispatch(new ue.SetSelectedTimelineMapIds([i.id]))}setStoryAnimationNames(){this.storyAnimationNames$.next(this.animationService.getStoryAnimationNames())}setChapterTimeFrame(){this.chapterDuration=this.animationService.getChapterDuration(),this.setTracksWidths(),this.buildRulerMarks(),this.checkOverflowX()}setScale(t){this.scale=t,this.rulerMarksPerSecond=.1===this.scale?1:.25===this.scale?2:3,this.setTracksWidths()}buildRulerMarks(){const t=Math.floor(this.chapterDuration*this.rulerMarksPerSecond)+1;this.rulerMarks=[];const n=o=>o/this.rulerMarksPerSecond+"s",i=o=>o%this.rulerMarksPerSecond*(this.animationService.fps/this.rulerMarksPerSecond)+"f";for(let o=0;o<t;o++){const r=o%this.rulerMarksPerSecond==0,l=r?n(o):i(o);this.rulerMarks.push({left:o*(He/this.rulerMarksPerSecond)*this.scale,label:l,seconds:r})}}setCurrentTimeIndicator(t){const i=`translate3d(${t*He*this.scale}px, 0px, 0px)`;this.renderer.setStyle(this.currentTimeHead.nativeElement,"transform",i),this.renderer.setStyle(this.currentTimeLine.nativeElement,"transform",i)}setHoverTimeIndicator(t){const i=`translate3d(${t*He*this.scale}px, 0px, 0px)`;this.renderer.setStyle(this.hoverTimeHead.nativeElement,"transform",i),this.renderer.setStyle(this.hoverTimeLine.nativeElement,"transform",i),this.renderer.setStyle(this.hoverTimeLabel.nativeElement,"transform",`translate3d(0px, ${this.tracksWindow.nativeElement.scrollTop}px, 0px)`),this.hoverTimeFormatted=this.animationService.formatTime(t),this.hoverTimeFrames=`${this.animationService.secondsToFrames(t)}f`,this.hoverTimeSeconds=Math.round(1e4*t)/1e4+"s"}setTracksWidths(){this.chapterWidth=this.chapterDuration*He*this.scale,this.tracksContainerWidth=this.chapterWidth+40}scrubToRulerMark(t){const n=t/this.rulerMarksPerSecond;this.animationService.pause(),this.scrubToTime(n)}scrubToRulerPosition(t){let n=t.offsetX/(He*this.scale);n=this.animationService.getNearestFrameTime(n),this.animationService.pause(),this.scrubToTime(n)}setLeafTimelinesWindowWidth(){this.renderer.setStyle(this.leafTimelinesWindow.nativeElement,"width",`calc(100% + ${this.scrollBarWidth}px)`)}setScrollbarWidth(){const t=this.tracksWindow.nativeElement;this.scrollBarWidth=t.offsetWidth-t.clientWidth}scrubToTime(t){this.animationService.scrub(t)}}(Ui=Nt).\u0275fac=function(t){return new(t||Ui)(e.rXU(a.il),e.rXU(wt.O),e.rXU(mn.y),e.rXU(e.sFG),e.rXU(e.gRc))},Ui.\u0275cmp=e.VBU({type:Ui,selectors:[["app-edit-timeline"]],viewQuery:function(t,n){if(1&t&&(e.GBs(hg,7),e.GBs(fg,7),e.GBs(gg,7),e.GBs(bg,7),e.GBs(_g,7),e.GBs(Cg,7),e.GBs(vg,7),e.GBs(yg,7),e.GBs(kg,7)),2&t){let i;e.mGM(i=e.lsd())&&(n.leafTimelinesWindow=i.first),e.mGM(i=e.lsd())&&(n.rulerWindow=i.first),e.mGM(i=e.lsd())&&(n.tracksWindow=i.first),e.mGM(i=e.lsd())&&(n.timelineRuler=i.first),e.mGM(i=e.lsd())&&(n.currentTimeHead=i.first),e.mGM(i=e.lsd())&&(n.currentTimeLine=i.first),e.mGM(i=e.lsd())&&(n.hoverTimeHead=i.first),e.mGM(i=e.lsd())&&(n.hoverTimeLine=i.first),e.mGM(i=e.lsd())&&(n.hoverTimeLabel=i.first)}},inputs:{manifestsMaxTimes:"manifestsMaxTimes"},decls:49,vars:44,consts:[["rulerWindow",""],["timelineRuler",""],["currentTimeHead",""],["hoverTimeHead",""],["leafTimelinesWindow",""],["tracksWindow",""],["currentTimeLine",""],["hoverTimeLine",""],["hoverTimeLabel",""],["leafTimelineActionsMenu","matMenu"],[1,"edit-timeline"],[1,"edit-timeline__header-left"],[1,"edit-timeline__frame-controls"],["direction","previous",1,"ml-2"],["direction","next",1,"mr-2"],[1,"edit-timeline__header"],[1,"edit-timeline__ruler-window"],[1,"edit-timeline__ruler-container",3,"ngStyle"],[1,"edit-timeline__ruler",3,"mouseenter","mousemove","mouseleave","click","ngStyle"],["appEventFence","","class","edit-timeline__ruler-mark",3,"ngStyle","ngClass","mouseenter",4,"ngFor","ngForOf"],[1,"edit-timeline__indicator-heads",3,"ngStyle"],[1,"edit-timeline__total-time-head",3,"ngStyle"],[1,"edit-timeline__current-time-head",3,"mousedown"],["icon","grip-lines-vertical"],[1,"edit-timeline__hover-time-head",3,"ngClass"],[1,"edit-timeline__header-gutter",3,"ngStyle"],[1,"edit-timeline__body-left"],[1,"edit-timeline__leaf-timelines-window"],[1,"edit-timeline__leaf-timelines-container"],[1,"edit-timeline__leaf-timelines"],["class","edit-timeline__leaf-timeline",3,"click",4,"ngFor","ngForOf"],[1,"edit-timeline__body-left-gutter",3,"ngStyle"],[1,"edit-timeline__body"],[1,"edit-timeline__tracks-window"],[1,"edit-timeline__tracks-container",3,"ngStyle"],[1,"edit-timeline__tracks",3,"ngStyle"],["class","edit-timeline__track",4,"ngFor","ngForOf"],[1,"edit-timeline__indicator-lines",3,"ngStyle"],[1,"edit-timeline__total-time-line",3,"ngStyle"],[1,"edit-timeline__current-time-line"],[1,"edit-timeline__hover-time-line",3,"ngClass"],[1,"edit-timeline__hover-time-line-label"],["appEventFence","",1,"edit-timeline__ruler-mark",3,"mouseenter","ngStyle","ngClass"],[1,"edit-timeline__ruler-mark-label","text-xs",3,"click"],[1,"edit-timeline__leaf-timeline",3,"click"],[1,"edit-timeline__leaf-timeline-label","text-xs"],["app-button","","appEventFence","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],[1,"edit-timeline__track"],[3,"scale","timelineMap","click",4,"ngFor","ngForOf"],[3,"click","scale","timelineMap"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",10)(1,"div",11)(2,"div",12),e.nrm(3,"app-engine-frame-control",13)(4,"app-engine-frame-control",14)(5,"app-engine-current-time"),e.k0s()(),e.j41(6,"div",15)(7,"div",16,0)(9,"div",17)(10,"div",18,1),e.bIt("mouseenter",function(r){return e.eBV(i),e.Njj(n.handleRulerMouseEnter(r))})("mousemove",function(r){return e.eBV(i),e.Njj(n.handleRulerMouseMove(r))})("mouseleave",function(){return e.eBV(i),e.Njj(n.handleRulerMouseLeave())})("click",function(r){return e.eBV(i),e.Njj(n.scrubToRulerPosition(r))}),e.DNE(12,wg,3,7,"div",19),e.k0s(),e.j41(13,"div",20),e.nrm(14,"div",21),e.j41(15,"div",22,2),e.bIt("mousedown",function(r){return e.eBV(i),e.Njj(n.handleCTIMouseDown(r))}),e.nrm(17,"app-icon",23),e.k0s(),e.nrm(18,"div",24,3),e.k0s()()(),e.nrm(20,"div",25),e.k0s(),e.j41(21,"div",26)(22,"div",27,4)(24,"div",28)(25,"div",29),e.DNE(26,Fg,11,4,"div",30),e.nI1(27,"async"),e.k0s()()(),e.nrm(28,"div",31),e.k0s(),e.j41(29,"div",32)(30,"div",33,5)(32,"div",34)(33,"div",35),e.DNE(34,Rg,2,1,"div",36),e.k0s(),e.j41(35,"div",37),e.nrm(36,"div",38)(37,"div",39,6),e.j41(39,"div",40,7)(41,"div",41,8)(43,"div"),e.EFF(44),e.k0s(),e.j41(45,"div"),e.EFF(46),e.k0s(),e.j41(47,"div"),e.EFF(48),e.k0s()()()()()()()()}2&t&&(e.R7$(9),e.Y8G("ngStyle",e.eq3(20,Zt,n.tracksContainerWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(22,Zt,n.chapterWidth)),e.R7$(2),e.Y8G("ngForOf",n.rulerMarks),e.R7$(),e.Y8G("ngStyle",e.eq3(24,Zt,n.chapterWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(26,er,n.chapterWidth)),e.R7$(4),e.Y8G("ngClass",e.eq3(28,Sg,n.showHoverTimeIndicator)),e.R7$(2),e.Y8G("ngStyle",e.eq3(30,Zt,n.scrollBarWidth)),e.R7$(6),e.Y8G("ngForOf",e.bMT(27,18,n.storyAnimationNames$)),e.R7$(2),e.Y8G("ngStyle",e.eq3(32,Tg,n.scrollBarWidth)),e.R7$(4),e.Y8G("ngStyle",e.eq3(34,Zt,n.tracksContainerWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(36,Zt,n.chapterWidth)),e.R7$(),e.Y8G("ngForOf",n.chapterTimelinesMaps),e.R7$(),e.Y8G("ngStyle",e.eq3(38,Zt,n.chapterWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(40,er,n.chapterWidth)),e.R7$(3),e.Y8G("ngClass",e.eq3(42,xg,n.showHoverTimeIndicator)),e.R7$(5),e.JRh(n.hoverTimeFormatted),e.R7$(2),e.JRh(n.hoverTimeFrames),e.R7$(2),e.JRh(n.hoverTimeSeconds))},dependencies:[E.YU,E.Sq,E.B3,Zs,lg,$.kk,$.fb,$.Cp,L.Q,Gn.L,Y.R,Mo,E.Jj],styles:['.edit-timeline[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;height:12px}.edit-timeline[_ngcontent-%COMP%]{display:grid;width:100%;background-color:#101823;grid-template-areas:"header-left header" "body-left body";grid-template-columns:320px 1fr;grid-template-rows:56px 1fr}.edit-timeline__header-left[_ngcontent-%COMP%]{grid-area:header-left;border-bottom:1px solid #283853;border-right:1px solid #283853}.edit-timeline__header[_ngcontent-%COMP%]{grid-area:header;display:flex}.edit-timeline__header-gutter[_ngcontent-%COMP%]{flex-shrink:0;border-left:1px solid #283853;border-bottom:1px solid #283853}.edit-timeline__body-left[_ngcontent-%COMP%]{grid-area:body-left;display:flex;flex-direction:column;border-right:1px solid #283853;overflow:hidden}.edit-timeline__body-left-gutter[_ngcontent-%COMP%]{flex-shrink:0;border-top:1px solid #283853}.edit-timeline__body[_ngcontent-%COMP%]{grid-area:body;overflow:hidden}.edit-timeline__frame-controls[_ngcontent-%COMP%]{display:flex;height:100%;align-items:center}.edit-timeline__ruler-window[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow:hidden}.edit-timeline__ruler-container[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;justify-content:center}.edit-timeline__ruler[_ngcontent-%COMP%]{position:relative;height:100%}.edit-timeline__ruler-mark[_ngcontent-%COMP%]{position:absolute;height:100%}.edit-timeline__ruler-mark[_ngcontent-%COMP%]:before{content:" ";bottom:0;position:absolute;height:22px;border-left:1px solid #283853}.edit-timeline__ruler-mark-label[_ngcontent-%COMP%]{color:#61779e;position:absolute;bottom:22px;cursor:pointer}.edit-timeline__ruler-mark-label[_ngcontent-%COMP%]:hover{color:#d7e0ea}.edit-timeline__seconds-mark[_ngcontent-%COMP%]:before{height:26px}.edit-timeline__seconds-mark[_ngcontent-%COMP%]   .edit-timeline__ruler-mark-label[_ngcontent-%COMP%]{color:#96a8c0;bottom:26px}.edit-timeline__seconds-mark[_ngcontent-%COMP%]   .edit-timeline__ruler-mark-label[_ngcontent-%COMP%]:hover{color:#d7e0ea}.edit-timeline__indicator-heads[_ngcontent-%COMP%]{position:absolute;pointer-events:none;height:100%;top:0}.edit-timeline__leaf-timelines-window[_ngcontent-%COMP%]{width:100%;height:100%;overflow-y:scroll;position:relative}.edit-timeline__leaf-timelines-container[_ngcontent-%COMP%]{width:100%;min-height:100%;display:flex;position:absolute}.edit-timeline__leaf-timelines[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;background-color:#131c2a}.edit-timeline__leaf-timeline[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 8px;height:48px;border-bottom:1px solid #283853;cursor:pointer}.edit-timeline__leaf-timeline-label[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px;word-break:break-all;-webkit-user-select:none;user-select:none;color:#d7e0ea}.edit-timeline__leaf-timeline-label[_ngcontent-%COMP%]:hover{color:#fff}.edit-timeline__tracks-window[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:scroll;background-color:#101823;scrollbar-color:#283853 transparent}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar:vertical{border-left:1px solid #283853}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar:horizontal{border-top:1px solid #283853}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:transparent}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#374a68;border-radius:6px}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-corner{background-color:transparent;border-top:1px solid #283853;border-left:1px solid #283853}.edit-timeline__tracks-container[_ngcontent-%COMP%]{position:absolute;min-height:100%;display:flex;justify-content:center}.edit-timeline__tracks[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;z-index:0}.edit-timeline__track[_ngcontent-%COMP%]{display:flex;position:relative;height:48px;background-color:#131c2a;border-bottom:1px solid #101823}.edit-timeline__indicator-lines[_ngcontent-%COMP%]{position:absolute;height:100%;top:0;pointer-events:none;z-index:1}.edit-timeline__current-time-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;left:0;height:50px;width:16px;margin-left:-8px;background-color:#2d72dc;cursor:pointer;color:#61779e;pointer-events:all}.edit-timeline__current-time-head[_ngcontent-%COMP%]:after{content:" ";position:absolute;bottom:-16px;border:8px solid transparent;border-top-color:#2d72dc}.edit-timeline__current-time-line[_ngcontent-%COMP%]{position:absolute;left:0;margin-left:-1px;height:100%;border-right:2px solid #2d72dc}.edit-timeline__total-time-head[_ngcontent-%COMP%]{position:absolute;height:50%;bottom:0;border-right:2px solid #283853}.edit-timeline__total-time-head[_ngcontent-%COMP%]:before{content:" ";position:absolute;height:12px;width:12px;margin-left:-5px;background-color:#283853}.edit-timeline__total-time-head[_ngcontent-%COMP%]:after{content:" ";position:absolute;top:12px;margin-left:-5px;border:6px solid transparent;border-top-color:#283853}.edit-timeline__total-time-line[_ngcontent-%COMP%]{position:absolute;height:100%;border-right:2px solid #283853}.edit-timeline__hover-time-head[_ngcontent-%COMP%]{position:absolute;display:none;height:100%;border-right:1px solid #2d72dc}.edit-timeline__hover-time-head--show[_ngcontent-%COMP%]{display:flex}.edit-timeline__hover-time-line[_ngcontent-%COMP%]{position:absolute;display:none;justify-content:center;height:100%;border-right:1px solid #2d72dc}.edit-timeline__hover-time-line--show[_ngcontent-%COMP%]{display:flex}.edit-timeline__hover-time-line-label[_ngcontent-%COMP%]{position:absolute;top:4px;color:#fff;background:#101823cc;border-radius:4px;font-size:10px;padding:0 8px}.edit-timeline__hover-time-line-label[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:4px 0}'],changeDetection:0}),Sn([(0,a.l6)(ke.getScale),Tn("design:type",u.c)],Nt.prototype,"scale$",void 0),Sn([(0,a.l6)(ke.getSelectedTimelineMapIds),Tn("design:type",u.c)],Nt.prototype,"selectedTimelineMapIds$",void 0),Sn([(0,a.l6)(ke.getCopiedTimelineMaps),Tn("design:type",u.c)],Nt.prototype,"copiedTimelineMaps$",void 0),Sn([(0,a.l6)(x.t.getLoadChaptersRemaining),Tn("design:type",u.c)],Nt.prototype,"loadChaptersRemaining$",void 0),Sn([(0,a.l6)(I.N.getSelectedChapterId),Tn("design:type",u.c)],Nt.prototype,"selectedChapterId$",void 0),Sn([(0,a.l6)(I.N.getSelectedChapterTimelineMap),Tn("design:type",u.c)],Nt.prototype,"selectedChapterTimelineMap$",void 0);var Vi,Ra=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},Ma=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};function Mg(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"button",8),e.nrm(4,"app-icon",9),e.k0s(),e.j41(5,"mat-menu",null,1)(7,"button",10),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.copyTimelineMaps())}),e.EFF(8,"Copy"),e.k0s(),e.j41(9,"button",10),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.duplicateTimelineMap())}),e.EFF(10,"Duplicate"),e.k0s(),e.j41(11,"button",10),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.deleteTimelineMaps())}),e.EFF(12,"Remove"),e.k0s()(),e.bVm()}if(2&s){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.JRh(i.selectedTimelineMapsLabel),e.R7$(),e.Y8G("matMenuTriggerFor",n)}}function jg(s,t){1&s&&(e.j41(0,"div",12)(1,"app-form-field",27)(2,"mat-radio-group",28)(3,"mat-radio-button",29),e.EFF(4,"Freeze "),e.k0s(),e.j41(5,"mat-radio-button",30),e.EFF(6,"Loop "),e.k0s()()()())}function Ig(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"form",11)(2,"div",12)(3,"app-form-field",13)(4,"input",14,2),e.bIt("keyup.enter",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEnter(o))}),e.k0s(),e.nrm(6,"app-character-counter",15),e.k0s()(),e.j41(7,"div",12)(8,"app-form-field",16)(9,"input",17),e.bIt("keyup.enter",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEnter(o))}),e.k0s()(),e.j41(10,"app-form-field",18)(11,"input",19),e.bIt("keyup.enter",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEnter(o))}),e.k0s()()(),e.j41(12,"div",12)(13,"app-form-field",20)(14,"input",21),e.bIt("keyup.enter",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEnter(o))}),e.k0s()(),e.j41(15,"app-form-field",22)(16,"input",23),e.bIt("keyup.enter",function(o){e.eBV(n);const r=e.XpG();return e.Njj(r.handleEnter(o))}),e.k0s()()(),e.j41(17,"div",12)(18,"mat-checkbox",24)(19,"span",25),e.EFF(20,"Fit clip to timeline."),e.k0s()()(),e.DNE(21,jg,7,0,"div",26),e.k0s(),e.bVm()}if(2&s){const n=e.sdS(5),i=e.XpG();e.R7$(),e.Y8G("formGroup",i.form),e.R7$(5),e.Y8G("field",n),e.R7$(12),e.Y8G("indeterminate",i.indeterminateFit),e.R7$(3),e.Y8G("ngIf",i.fitIsFalse)}}function Ng(s,t){1&s&&(e.j41(0,"p",31),e.EFF(1,"Click on a clip in the timeline panel to edit it."),e.k0s())}const Bg=/(^[+-/*]=)(.+$)/;class jo{constructor(t,n,i,o){this.store=t,this.formBuilder=n,this.animationService=i,this.changeDetectorRef=o,this.ngUnsubscribe=new b.B}ngOnInit(){this.form=this.formBuilder.group({name:[null,c.k0.maxLength(100)],start:[null,{updateOn:"blur"}],end:[null,{updateOn:"blur"}],dataStart:[null,{updateOn:"blur"}],dataEnd:[null,{updateOn:"blur"}],fit:[null,{updateOn:"change"}],onEnd:[null,{updateOn:"change"}]}),this.form.valueChanges.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleFormChanges(t)}),this.selectedChapterTimelineMap$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.chapterTimelineMaps=t}),this.selectedTimelineMapIds$.pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.selectedTimelineMapIds=Array.from(t),this.buildAggregateTimelineMap(),this.setFormValues(),this.setHasSelectedTimelineMaps(),this.setSelectedTimelineMapsLabel(),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}getSelectedTimelineMaps(){return this.selectedTimelineMapIds.map(t=>this.chapterTimelineMaps.find(n=>t===n.id))}getTimelineMap(t){return this.chapterTimelineMaps.find(n=>t===n.id)}buildAggregateTimelineMap(){const t=[],n=[],i=[],o=[],r=[],l=[],p=[],T=(Oe,en,En)=>Oe===En[0],B=(Oe,en)=>Oe&&en.length>0?en[0]:null;this.getSelectedTimelineMaps().forEach(Oe=>{t.push(Oe.name),n.push(Oe.start),i.push(Oe.end),o.push(Oe.data.start),r.push(Oe.data.end),l.push(Oe.data.fit),p.push(Oe.data.onEnd)});const H=t.every(T),ge=n.every(T),Se=i.every(T),We=o.every(T),nt=r.every(T),rt=l.every(T),Xi=p.every(T);this.aggregateTimelineMap={name:B(H,t),start:B(ge,n),end:B(Se,i),dataStart:B(We,o),dataEnd:B(nt,r),fit:B(rt,l),onEnd:B(Xi,p)}}setFormValues(){let t=this.aggregateTimelineMap.start,n=this.aggregateTimelineMap.end,i=this.aggregateTimelineMap.dataStart,o=this.aggregateTimelineMap.dataEnd;"number"==typeof t&&(t=this.animationService.formatTime(t)),"number"==typeof n&&(n=this.animationService.formatTime(n)),"number"==typeof i&&(i=this.animationService.formatTime(i)),"number"==typeof o&&(o=this.animationService.formatTime(o)),this.form.setValue({name:this.aggregateTimelineMap.name,start:t,end:n,dataStart:i,dataEnd:o,fit:this.aggregateTimelineMap.fit,onEnd:this.aggregateTimelineMap.onEnd},{emitEvent:!1}),this.indeterminateFit=null===this.aggregateTimelineMap.fit,this.fitIsFalse=!1===this.aggregateTimelineMap.fit}parseTimeInput(t){const n=t.match(Bg);if(n){const i=n[1],o=this.animationService.parseFormattedTime(n[2]);return new Function("value",`return value ${i} ${o}`)}return this.animationService.parseFormattedTime(t)}handleFormChanges(t){const n=Object.entries(t).filter(([o,r])=>"name"===o?null!==r:null!==r&&""!==r),i=Object.fromEntries(n);["start","end","dataStart","dataEnd"].forEach(o=>{i.hasOwnProperty(o)&&(i[o]=this.parseTimeInput(i[o]))}),this.updateTimelineMaps(this.buildUpdates(i)),this.buildAggregateTimelineMap(),this.setFormValues()}handleEnter(t){const n=t.target,i=n.value,o=n.getAttribute("formcontrolname");this.form.get(o).patchValue(i)}buildUpdates(t){const n=Array.from(this.store.selectSnapshot(ke.getSelectedTimelineMapIds)),i=(o,r)=>{let l="function"==typeof r?r(o):r;return l<0&&(l=o),l};return n.map(o=>{const r=this.getTimelineMap(o),l={...r.data};return Object.entries(t).forEach(([p,T])=>{switch(p){case"start":case"end":r[p]=i(r[p],T);break;case"dataStart":l.start=i(r.data.start,T);break;case"dataEnd":l.end=i(r.data.end,T);break;case"fit":l.fit=T;break;case"onEnd":l.onEnd=T;break;default:r[p]=T}}),r.data=l,r})}copyTimelineMaps(){const n=Array.from(this.selectedTimelineMapIds).map(i=>{const o=this.getTimelineMap(i);return(0,R.cloneDeep)(o)});this.store.dispatch(new ue.SetCopiedTimelineMaps(n))}duplicateTimelineMap(){const t=[],n=this.getSelectionOffset();this.selectedTimelineMapIds.forEach(o=>{const r=this.getTimelineMap(o),l=(0,R.cloneDeep)(r);l.id=Ze.u.getUuid();const p=l.end-l.start;l.start=l.start+n,l.end=l.start+p,t.push(l)}),this.animationService.updateTimelineClips(t),this.store.dispatch(new V.lc(t));const i=t.map(o=>o.id);this.store.dispatch(new ue.SetSelectedTimelineMapIds(i))}updateTimelineMaps(t){this.animationService.updateTimelineClips(t),this.store.dispatch(new V.is(t))}deleteTimelineMaps(){const t=Array.from(this.store.selectSnapshot(ke.getSelectedTimelineMapIds));this.animationService.deleteTimelineClips(t),this.store.dispatch(new V.Bc(t)),this.store.dispatch(new ue.SetSelectedTimelineMapIds([]))}setSelectedTimelineMapsLabel(){this.selectedTimelineMapsLabel=`${this.selectedTimelineMapIds.length} ${this.selectedTimelineMapIds.length>1?"clips":"clip"} selected`}setHasSelectedTimelineMaps(){this.hasSelectedTimelineMaps=this.selectedTimelineMapIds.length>0}getSelectionOffset(){const t=this.getSelectedTimelineMaps(),n=t.map(T=>T.data.timeline),i={},o=this.store.selectSnapshot(I.N.getSelectedChapter);t.forEach(T=>{const B=T.id;if(!Object.hasOwnProperty.call(i,"leafTimelineId")){let A=0;o.timelineMap.filter(H=>n.includes(H.data.timeline)).forEach(H=>{H.end>A&&(A=H.end)}),i[B]=A}});const r=Object.values(i),l=Math.max(...r);let p=1/0;return t.forEach(T=>{T.start<p&&(p=T.start)}),l-p}}(Vi=jo).\u0275fac=function(t){return new(t||Vi)(e.rXU(a.il),e.rXU(c.ze),e.rXU(wt.O),e.rXU(e.gRc))},Vi.\u0275cmp=e.VBU({type:Vi,selectors:[["app-edit-timeline-maps"]],decls:7,vars:3,consts:[["noSelectedTimelineMaps",""],["timelineMapsActionsMenu","matMenu"],["name",""],[1,"edit-timeline-maps"],[1,"edit-timeline-maps__header"],[4,"ngIf"],[1,"edit-timeline-maps__body"],[4,"ngIf","ngIfElse"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["autocomplete","off",1,"edit-timeline-maps__form",3,"formGroup"],[1,"edit-timeline-maps__form-row"],["label","Name",1,"grow"],["type","text","maxlength","100","formControlName","name","autocomplete","timelinemap-name",1,"input","w-full",3,"keyup.enter"],[3,"field"],["label","In Point",1,"mr-2"],["type","text","formControlName","start",1,"input","w-full",3,"keyup.enter"],["label","Out Point",1,"ml-2"],["type","text","formControlName","end",1,"input","w-full",3,"keyup.enter"],["label","State Start",1,"mr-2"],["type","text","formControlName","dataStart",1,"input","w-full",3,"keyup.enter"],["label","State End",1,"ml-2"],["type","text","formControlName","dataEnd",1,"input","w-full",3,"keyup.enter"],["formControlName","fit",1,"pb-4",3,"indeterminate"],[1,"text-xs"],["class","edit-timeline-maps__form-row",4,"ngIf"],["label","On End",1,"grow"],["formControlName","onEnd",1,"flex"],["value","freeze",1,"grow","text-xs"],["value","loop",1,"grow","text-xs"],[1,"text-xs","pt-2"]],template:function(t,n){if(1&t&&(e.j41(0,"div",3)(1,"div",4),e.DNE(2,Mg,13,2,"ng-container",5),e.k0s(),e.j41(3,"div",6),e.DNE(4,Ig,22,4,"ng-container",7)(5,Ng,2,0,"ng-template",null,0,e.C5r),e.k0s()()),2&t){const i=e.sdS(6);e.R7$(2),e.Y8G("ngIf",n.hasSelectedTimelineMaps),e.R7$(2),e.Y8G("ngIf",n.hasSelectedTimelineMaps)("ngIfElse",i)}},dependencies:[E.bT,c.qT,c.me,c.BC,c.cb,c.tU,c.j4,c.JD,De.So,Ye.VT,Ye._g,$.kk,$.fb,$.Cp,L.Q,ee.K,Ft.P,Y.R],styles:[".edit-timeline-maps[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.edit-timeline-maps__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;height:56px;flex-shrink:0;border-bottom:1px solid #283853;padding:0 16px}.edit-timeline-maps__body[_ngcontent-%COMP%]{flex-grow:1;padding:16px 16px 0}.edit-timeline-maps__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-timeline-maps__form-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),Ra([(0,a.l6)(I.N.getSelectedChapterTimelineMap),Ma("design:type",u.c)],jo.prototype,"selectedChapterTimelineMap$",void 0),Ra([(0,a.l6)(ke.getSelectedTimelineMapIds),Ma("design:type",u.c)],jo.prototype,"selectedTimelineMapIds$",void 0);var Dg=v(30582),Io=function(s){return s.Pixels="pixels",s.Inches="inches",s}(Io||{}),Li=v(9592);class ja{constructor(t={width:700,height:550},n=Li.H.PNG,i=Io.Pixels,o=1,r=!1){this.dimensions=t,this.imageType=n,this.imageSizeType=i,this.labelScale=o,this.labelsDisabled=r}}var Gg=v(56583),xn=v(94528),No=v(42482),$g=v(37737);function Og(s,t){if(1&s&&(e.j41(0,"option",4),e.EFF(1),e.k0s()),2&s){const n=t.$implicit,i=e.XpG();e.Y8G("value",n.title),e.R7$(),e.SpI(" ",i.formatScreenSizeText(n)," ")}}function Ag(s,t){if(1&s&&(e.j41(0,"fieldset",5)(1,"legend",6),e.EFF(2,"Image Dimensions Pixels"),e.k0s(),e.j41(3,"app-form-field",7),e.nrm(4,"input",8),e.j41(5,"div",9),e.EFF(6),e.k0s()(),e.j41(7,"span",10),e.EFF(8,"X"),e.k0s(),e.j41(9,"app-form-field",7),e.nrm(10,"input",11),e.j41(11,"div",9),e.EFF(12),e.k0s()()()),2&s){const n=e.XpG();e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",n.minSnapshotPixels.width)("max",n.maxSnapshotPixels.width),e.BMQ("aria-label","Width"),e.R7$(2),e.SpI("Max width ",n.maxSnapshotPixels.width,"px"),e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",n.minSnapshotPixels.height)("max",n.maxSnapshotPixels.height),e.BMQ("aria-label","Height"),e.R7$(2),e.SpI("Max height ",n.maxSnapshotPixels.height,"px")}}const nr={width:300,height:300},ir={width:5120,height:2880};let Ug=(()=>{var s;class t extends qe.n{get currentWidth(){return this._currentWidth}set currentWidth(i){this._currentWidth=Math.round(i),this.screens=this.getScreens(),this.changeRef.markForCheck()}get currentHeight(){return this._currentHeight}set currentHeight(i){this._currentHeight=Math.round(i),this.screens=this.getScreens(),this.changeRef.markForCheck()}get selectedScreenTitle(){return this.formGroup.value.title}constructor(i,o){super(),this.formBuilder=i,this.changeRef=o,this.minSnapshotPixels=nr,this.maxSnapshotPixels=ir,this.snapshotSizes=[...be.aC],this.currentSnapTitle="Canvas Size",this.customSnapTitle="Custom",this.screens=[],this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){const{width:o,height:r}=i,p=this.getScreens().find(({dimensions:H})=>H.width===o&&H.height===r),T=this.formGroup.value.title;this.formGroup.patchValue({title:T===this.customSnapTitle?T:p?.title||this.customSnapTitle,width:o,height:r},{emitEvent:!1}),this.changeRef.markForCheck()}formatScreenSizeText(i){const{title:o,dimensions:r}=i,{width:l,height:p}=r;return o===this.customSnapTitle?o:this.formatScreenText(o,l,p)}formatScreenText(i,o,r){return`${i} (${o} x ${r} px)`}getScreens(){const{width:i,height:o}=this.formGroup.value;return[{...be.w2,title:this.currentSnapTitle,dimensions:{width:this.currentWidth,height:this.currentHeight}},...be.aC,{...be.w2,title:this.customSnapTitle,dimensions:{width:i,height:o}}]}initForm(){const i=this.currentSnapTitle,{width:o,height:r}=be.w2.dimensions;this.formGroup=this.formBuilder.nonNullable.group({title:new c.MJ(i),width:new c.MJ(o,[c.k0.required,c.k0.min(nr.width),c.k0.max(ir.width)]),height:new c.MJ(r,[c.k0.required,c.k0.min(nr.height),c.k0.max(ir.height)])})}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(250),(0,j.p)(()=>this.formGroup.valid),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const{title:o,width:r,height:l}=i;if(o===this.currentSnapTitle)this.value={width:this.currentWidth,height:this.currentHeight};else if(o===this.customSnapTitle)this.value={width:r,height:l};else{const p=this.snapshotSizes.find(T=>T.title===o);if(p){const{dimensions:T}=p;this.value={...T}}}})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ok),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-dimensions-pixels"]],inputs:{currentWidth:"currentWidth",currentHeight:"currentHeight"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:5,vars:3,consts:[[3,"formGroup"],["formControlName","title",1,"input"],[3,"value",4,"ngFor","ngForOf"],["class","flex flex-row justify-between items-baseline mt-2 pb-4",4,"ngIf"],[3,"value"],[1,"flex","flex-row","justify-between","items-baseline","mt-2","pb-4"],[1,"sr-only"],["theme","dark","display","block",1,"w-1/2",3,"isCompact"],["type","number","formControlName","width","appAutoFocus","",1,"publish__input","input","w-full",3,"min","max"],["form-field-help","",1,"text-2xs"],[1,"px-3","text-sm"],["type","number","formControlName","height",1,"publish__input","input","w-full",3,"min","max"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"app-form-field")(2,"select",1),e.DNE(3,Og,2,2,"option",2),e.k0s()(),e.DNE(4,Ag,13,10,"fieldset",3),e.k0s()),2&i&&(e.Y8G("formGroup",o.formGroup),e.R7$(3),e.Y8G("ngForOf",o.screens),e.R7$(),e.Y8G("ngIf",o.selectedScreenTitle===o.customSnapTitle))},dependencies:[E.Sq,E.bT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.VZ,c.zX,c.j4,c.JD,$g.B,ee.K],changeDetection:0}),t})(),Vg=(()=>{var s;class t extends qe.n{constructor(i,o){super(),this.formBuilder=i,this.changeRef=o,this.snapshotPPI=be.Un,this.minSnapshotInches=be.P2,this.maxSnapshotInches=be.t6,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){const{width:o,height:r}=i;this.formGroup.patchValue({width:o,height:r},{emitEvent:!1}),this.changeRef.markForCheck()}initForm(){this.formGroup=this.formBuilder.nonNullable.group({title:new c.MJ(""),width:new c.MJ(0,[c.k0.required,c.k0.min(this.minSnapshotInches.width),c.k0.max(this.maxSnapshotInches.width)]),height:new c.MJ(0,[c.k0.required,c.k0.min(0),c.k0.max(1e3)])})}initFormListeners(){this.formGroup.valueChanges.pipe((0,W.B)(100),(0,j.p)(()=>this.formGroup.valid),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const{width:o,height:r}=i;this.value={width:o,height:r}})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(c.ok),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-dimensions-inches"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:16,vars:14,consts:[[3,"formGroup"],[1,"flex","flex-row","justify-between","items-baseline"],[1,"sr-only"],["theme","dark","display","block",1,"w-1/2",3,"isCompact"],["type","number","formControlName","width","step",".01",1,"publish__input","input","w-full",3,"min","max"],["form-field-help","",1,"text-2xs"],[1,"px-3","text-sm"],["type","number","formControlName","height","step",".01",1,"publish__input","input","w-full",3,"min","max"],[1,"mt-2","pb-4","text-xs","text-gray-400"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"fieldset",1)(2,"legend",2),e.EFF(3,"Image Dimensions Inches"),e.k0s(),e.j41(4,"app-form-field",3),e.nrm(5,"input",4),e.j41(6,"div",5),e.EFF(7),e.k0s()(),e.j41(8,"span",6),e.EFF(9,"X"),e.k0s(),e.j41(10,"app-form-field",3),e.nrm(11,"input",7),e.j41(12,"div",5),e.EFF(13),e.k0s()()(),e.j41(14,"p",8),e.EFF(15),e.k0s()()),2&i&&(e.Y8G("formGroup",o.formGroup),e.R7$(4),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",o.minSnapshotInches.width)("max",o.maxSnapshotInches.width),e.BMQ("aria-label","Width"),e.R7$(2),e.Lme(" Width ",o.minSnapshotInches.width,'" to ',o.maxSnapshotInches.width,'" '),e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",o.minSnapshotInches.height)("max",o.maxSnapshotInches.height),e.BMQ("aria-label","Height"),e.R7$(2),e.Lme(" Height ",o.minSnapshotInches.height,'" to ',o.maxSnapshotInches.height,'" '),e.R7$(2),e.SpI("Images are published at ",o.snapshotPPI," dpi"))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.VZ,c.zX,c.j4,c.JD,ee.K],changeDetection:0}),t})();var Yi;function zg(s,t){if(1&s&&(e.nrm(0,"app-edit-image-dimensions-pixels",29),e.nI1(1,"async"),e.nI1(2,"async")),2&s){let n,i;const o=e.XpG();e.Y8G("currentWidth",null==(n=e.bMT(1,2,o.enginePosition$))?null:n.viewportWidth)("currentHeight",null==(i=e.bMT(2,4,o.enginePosition$))?null:i.viewportHeight)}}function Xg(s,t){1&s&&e.nrm(0,"app-edit-image-dimensions-inches",30)}function Qg(s,t){1&s&&(e.j41(0,"app-form-field",31),e.nrm(1,"app-slider",32),e.k0s()),2&s&&(e.R7$(),e.Y8G("label","Label scale"))}class or{get imageSizeType(){return this.formSnapshot.value.imageSizeType}get labelsDisabled(){return this.formSnapshot.value.labelsDisabled}constructor(t,n,i,o,r,l,p,T,B){this.store=t,this.actions=n,this.storageService=i,this.snapshotService=o,this.clipboardService=r,this.dialogService=l,this.formBuilder=p,this.snackBar=T,this.changeDetectorRef=B,this.imageSizeTypeEnum=Io,this.imageTypeEnum=Li.H,this.widgetSnapshotSettings=new b.B,this.ngUnsubscribe=new b.B,this.initForm()}ngOnInit(){this.initialLabelScale=this.store.selectSnapshot(Ue.y.getLabelScale),this.initialLabelsShown=this.store.selectSnapshot(Ue.y.getLabels).reduce((n,{id:i,shown:o})=>(n[i]=o,n),{}),this.initialCanvasSize=this.store.selectSnapshot(X.getCanvasSize);const t=this.readSnapshotOptions();this.syncSnapshotOptionsToScene(t),this.initSnapshotActionListeners(),this.initFormListeners()}ngOnDestroy(){this.store.dispatch(new ye.tH(this.initialLabelScale));const t=this.store.selectSnapshot(Ue.y.getLabels),n=[],i=[];Object.entries(this.initialLabelsShown).forEach(([o,r])=>{const l=t.find(p=>p.id===o);r?n.push(l):i.push(l)}),this.store.dispatch(new ye.D3(n,!0)),this.store.dispatch(new ye.D3(i,!1)),this.store.dispatch(new w.IW(this.initialCanvasSize)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleResetDefaultsClick(){const t=this.getSnapshotFormFromOptions(new ja);this.formSnapshot.reset(t)}downloadClick(){const{imageType:t}=this.formSnapshot.value;this.takeSnapshot().pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(n=>{this.downloadSnapshot(n,t)})}copyEmbedClick(){const t=this.store.selectSnapshot(Ee.J.getSelectedBookmark),{imageType:n}=this.formSnapshot.value,i=Li.G[n];this.takeSnapshot().pipe((0,Ae.Z)(o=>No.X.blobToBase64(o)),(0,xt.$)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(o=>{const r=new Gg.$;this.store.dispatch(new xn.yX(t,o,i,r))})}copyLinkClick(){const{imageType:t}=this.formSnapshot.value,n=Li.G[t];this.takeSnapshot().pipe((0,Ae.Z)(i=>No.X.blobToBase64(i)),(0,xt.$)(),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new xn.Iz(i,n))})}initForm(){const t=this.readSnapshotOptions(),n=this.getSnapshotFormFromOptions(t),{pixelDimensions:i,inchesDimensions:o,imageType:r,imageSizeType:l,labelScale:p,labelsDisabled:T}=n;this.formSnapshot=this.formBuilder.nonNullable.group({pixelDimensions:this.formBuilder.control(i),inchesDimensions:this.formBuilder.control(o),imageSizeType:new c.MJ(l,[c.k0.required]),imageType:new c.MJ(r,[c.k0.required]),labelsDisabled:new c.MJ(T),labelScale:new c.MJ(p,[c.k0.required])})}initFormListeners(){const t=this.formSnapshot.controls.pixelDimensions,n=this.formSnapshot.controls.inchesDimensions;this.formSnapshot.valueChanges.pipe((0,W.B)(100),(0,M.F)((i,o)=>(0,R.isEqual)(i,o)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=this.getSnapshotOptionsFromForm(i);this.syncSnapshotOptionsToScene(o),this.writeSnapshotOptions(o),this.changeDetectorRef.markForCheck()}),n.valueChanges.pipe((0,W.B)(500),(0,j.p)(()=>n.valid),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const r=this.pixelsToInchesDimensions(t.value);if(!(0,R.isEqual)(i,r)){const l=this.inchesToPixelsDimensions(i);t.patchValue({...l},{emitEvent:!1})}}),t.valueChanges.pipe((0,W.B)(500),(0,j.p)(()=>t.valid),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{const r=this.inchesToPixelsDimensions(n.value);if(!(0,R.isEqual)(i,r)){const l=this.pixelsToInchesDimensions(i);n.patchValue({...l},{emitEvent:!1})}})}initSnapshotActionListeners(){this.actions.pipe((0,a.xi)(xn.F0),(0,Ae.Z)(t=>this.copyToClipboard(t.embed,"embed")),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackBar.open(t?"Successfully copied image embed code to clipboard.":"Unable to copy image embed code to clipboard.")}),this.actions.pipe((0,a.xi)(xn.SJ),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Unable to generate embed code.")}),this.actions.pipe((0,a.xi)(xn.DU),(0,Ae.Z)(t=>this.copyToClipboard(t.imageURL,"url")),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackBar.open(t?"Successfully copied image URL to clipboard.":"Unable to copy image URL to clipboard.")}),this.actions.pipe((0,a.xi)(xn.YJ),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Unable to generate image URL.")}),this.actions.pipe((0,a.xi)(Xe.x$),(0,W.B)(100),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.getSnapshotOptionsFromForm(this.formSnapshot.value);this.syncSnapshotOptionsToScene(t)})}copyToClipboard(t,n){return this.clipboardService.copyToClipboard(t,n).pipe((0,Ae.Z)(i=>(0,y.of)(i)))}takeSnapshot(){const t=this.store.selectSnapshot(_.S.getEnginePosition),n=this.getSnapshotOptionsFromForm(this.formSnapshot.value),{imageType:i,dimensions:o,labelsDisabled:r}=n,{width:l,height:p}=o,T=!r,B=this.store.selectSnapshot(I.N.getSelectedChapterBackground),A=(0,ts.F$)(i,B),H=B.colors.slice(0,3),ge=se.T.isLight(H),Se=this.store.selectSnapshot(Hr.X.getViewLogoConfig),We=(0,Wr.g)(Se,"full",ge?"color":"white");let nt=!0;!we.c.production&&"true"===localStorage.getItem("disableCopyright")&&(nt=!1);const rt={...ts._,crop:"original",imageType:i,imageQuality:1,copyrightEnabled:nt,copyrightImagePath:We.logo_url};return this.snapshotService.takeSnapshot(l,p,A,[],T,rt,t.scale)}downloadSnapshot(t,n){const i=this.store.selectSnapshot(x.t.getStory)?.displayName,o=this.store.selectSnapshot(I.N.getSelectedChapter)?.displayName,l=No.X.createModelFileName(i,o,Li.G[n]);return No.X.exportImage(t,n,l)}inchesToPixelsDimensions(t){const{width:n,height:i}=t;return{width:(0,be.jN)(n),height:(0,be.jN)(i)}}pixelsToInchesDimensions(t){const{width:n,height:i}=t;return{width:(0,be.Fg)(n),height:(0,be.Fg)(i)}}getSnapshotFormFromOptions(t){const{dimensions:n,imageType:i,imageSizeType:o,labelsDisabled:r,labelScale:l}=t,{width:p,height:T}=n;return{pixelDimensions:{width:p,height:T},inchesDimensions:{width:(0,be.Fg)(p),height:(0,be.Fg)(T)},imageSizeType:o,imageType:i,labelsDisabled:r,labelScale:l}}getSnapshotOptionsFromForm(t){const{inchesDimensions:n,pixelDimensions:i,imageSizeType:o,imageType:r,labelsDisabled:l,labelScale:p}=t;return{dimensions:o===Io.Inches?this.inchesToPixelsDimensions(n):i,imageType:r,imageSizeType:o,labelScale:p,labelsDisabled:l}}syncSnapshotOptionsToScene(t){const{dimensions:n,labelsDisabled:i,labelScale:o}=t,{width:r,height:l}=n;this.store.dispatch(new ye.eH(!i)),this.store.dispatch(new ye.tH(o));const p=this.store.selectSnapshot(_.S.getEnginePosition),T=p.viewportWidth===r&&p.viewportHeight===l?le:new q("Custom",r,l);this.store.dispatch(new w.IW(T))}getStorageKey(){return this.store.selectSnapshot(Ne.k.getUserProfile).eid}writeSnapshotOptions(t){const n=this.storageService.getLocalJSON(Ge.UT.SnapshotOptions),i=this.getStorageKey();this.storageService.setLocalItem(Ge.UT.SnapshotOptions,{...n??{},[i]:t})}readSnapshotOptions(){const t=this.getStorageKey(),i=this.storageService.getLocalJSON(Ge.UT.SnapshotOptions)?.[t];return{...new ja,...i??{}}}}(Yi=or).\u0275fac=function(t){return new(t||Yi)(e.rXU(a.il),e.rXU(a.En),e.rXU(Ge.n$),e.rXU(Dg.M),e.rXU(ba.W),e.rXU(Ve.o),e.rXU(c.ok),e.rXU(Le.UG),e.rXU(e.gRc))},Yi.\u0275cmp=e.VBU({type:Yi,selectors:[["app-edit-image-form"]],decls:45,vars:13,consts:[["actionsMenu","matMenu"],["downloadMenu","matMenu"],["column-label",""],["column-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["column-group-body",""],[3,"showHeader"],["label","Image Size"],["formControlName","imageSizeType",1,"flex","flex-row","w-full","text-xs"],[1,"flex-auto",3,"value"],[1,"flex-auto","ml-10",3,"value"],[3,"ngSwitch"],["formControlName","pixelDimensions",3,"currentWidth","currentHeight",4,"ngSwitchCase"],["formControlName","inchesDimensions",4,"ngSwitchCase"],["label","Format"],["formControlName","imageType",1,"input"],["matTooltip","Highest quality, best for print and offline use.",3,"value"],["matTooltip","Smallest file size, best for most uses.",3,"value"],["label","Label Visibility"],["formControlName","labelsDisabled",1,"text-xs"],["label","Label Size",4,"ngIf"],[1,"mt-2"],[1,"w-full"],["app-button","","buttonType","flat","buttonSize","sm",1,"grow",3,"click"],["app-button","","buttonType","flat","buttonSize","sm",2,"flex","0 0 40px",3,"matMenuTriggerFor"],["icon","caret-down"],["formControlName","pixelDimensions",3,"currentWidth","currentHeight"],["formControlName","inchesDimensions"],["label","Label Size"],["theme","dark","formControlName","labelScale","min","1","max","5","step","0.1","digitSize","3",1,"grow",3,"label"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"app-column")(1,"h2",2),e.EFF(2,"Image"),e.k0s(),e.j41(3,"div",3)(4,"button",4),e.nrm(5,"app-icon",5),e.k0s(),e.j41(6,"mat-menu",null,0)(8,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleResetDefaultsClick())}),e.EFF(9,"Reset Defaults"),e.k0s()()(),e.j41(10,"app-column-group",7),e.qex(11,8),e.j41(12,"app-panel",9)(13,"app-form-field",10)(14,"mat-radio-group",11)(15,"mat-radio-button",12),e.EFF(16,"Pixels"),e.k0s(),e.j41(17,"mat-radio-button",13),e.EFF(18,"Inches"),e.k0s()()(),e.qex(19,14)(20),e.DNE(21,zg,3,6,"app-edit-image-dimensions-pixels",15)(22,Xg,1,0,"app-edit-image-dimensions-inches",16),e.bVm()(),e.j41(23,"app-form-field",17)(24,"select",18)(25,"option",19),e.EFF(26," PNG "),e.k0s(),e.j41(27,"option",20),e.EFF(28," JPG "),e.k0s()()(),e.j41(29,"app-form-field",21)(30,"mat-checkbox",22),e.EFF(31,"Hide all labels"),e.k0s()(),e.DNE(32,Qg,2,1,"app-form-field",23),e.j41(33,"div",24)(34,"app-button-group",25)(35,"button",26),e.bIt("click",function(){return e.eBV(i),e.Njj(n.downloadClick())}),e.EFF(36," Download "),e.k0s(),e.j41(37,"button",27),e.nrm(38,"app-icon",28),e.k0s()(),e.j41(39,"mat-menu",null,1)(41,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.copyEmbedClick())}),e.EFF(42,"Copy Embed"),e.k0s(),e.j41(43,"button",6),e.bIt("click",function(){return e.eBV(i),e.Njj(n.copyLinkClick())}),e.EFF(44,"Copy Link"),e.k0s()()()(),e.bVm(),e.k0s()()}if(2&t){const i=e.sdS(7),o=e.sdS(40);e.R7$(4),e.Y8G("matMenuTriggerFor",i),e.R7$(6),e.Y8G("formGroup",n.formSnapshot),e.R7$(2),e.Y8G("showHeader",!1),e.R7$(2),e.BMQ("aria-label","Image Size"),e.R7$(),e.Y8G("value",n.imageSizeTypeEnum.Pixels),e.R7$(2),e.Y8G("value",n.imageSizeTypeEnum.Inches),e.R7$(2),e.Y8G("ngSwitch",n.imageSizeType),e.R7$(2),e.Y8G("ngSwitchCase",n.imageSizeTypeEnum.Pixels),e.R7$(),e.Y8G("ngSwitchCase",n.imageSizeTypeEnum.Inches),e.R7$(3),e.Y8G("value",n.imageTypeEnum.PNG),e.R7$(2),e.Y8G("value",n.imageTypeEnum.JPEG),e.R7$(5),e.Y8G("ngIf",!n.labelsDisabled),e.R7$(5),e.Y8G("matMenuTriggerFor",o)}},dependencies:[E.bT,E.ux,E.e1,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,De.So,Ye.VT,Ye._g,$.kk,$.fb,$.Cp,Ce.oV,L.Q,un,mt,st,ee.K,Y.R,$e,me.g,Ug,Vg,E.Jj],changeDetection:0}),function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)}([(0,a.l6)(_.S.getEnginePosition),function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,u.c)],or.prototype,"enginePosition$",void 0);var qg=v(11583);let Hg=(()=>{var s;class t{constructor(){}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-upgrade"]],decls:21,vars:1,consts:[[1,"edit-image-upgrade"],["column-label","",1,"w-full","flex","flex-row","items-center","justify-between"],["icon","lock","label","School & Business Plans"],[3,"compact"],["column-group-body",""],[1,"edit-image-upgrade__body"],["src","assets/images/2d_image_workflow.gif",1,"edit-image-upgrade__banner"],[1,"font-bold"],["app-button","","buttonType","primary","href","https://support.biodigital.com/hc/en-us/articles/360023856054-Publish-a-2D-image-of-a-model","target","_blank",1,"text-link","w-full","mt-4"]],template:function(i,o){1&i&&(e.j41(0,"app-column",0)(1,"h2",1)(2,"span"),e.EFF(3,"Image"),e.k0s(),e.nrm(4,"app-tag",2),e.k0s(),e.j41(5,"app-column-group",3),e.qex(6,4),e.j41(7,"app-panel")(8,"div",5),e.nrm(9,"img",6),e.j41(10,"p"),e.EFF(11," Create, customize, and download high-quality images of your 3D models for digital or print solutions. "),e.k0s(),e.j41(12,"p"),e.EFF(13," Downloading images is only available with a "),e.j41(14,"span",7),e.EFF(15,"School or Business plan"),e.k0s(),e.EFF(16,". "),e.k0s(),e.j41(17,"p"),e.EFF(18,"Unlock this feature by upgrading your account."),e.k0s(),e.j41(19,"a",8),e.EFF(20,"Learn More"),e.k0s()()(),e.bVm(),e.k0s()()),2&i&&(e.R7$(5),e.Y8G("compact",!1))},dependencies:[L.Q,mt,st,qg.e,me.g],styles:[".edit-image-upgrade__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:flex;flex-direction:column;align-items:stretch;gap:16px;padding:0 4px}.edit-image-upgrade__banner[_ngcontent-%COMP%]{display:block;width:100%;height:auto;border:1px solid #283853;border-radius:4px}"],changeDetection:0}),t})();function Wg(s,t){1&s&&e.nrm(0,"app-edit-image-form")}function Jg(s,t){1&s&&e.nrm(0,"app-edit-image-upgrade")}let Kg=(()=>{var s;class t{constructor(i,o){this.store=i,this.changeRef=o,this.ngUnsubscribe=new b.B}ngOnInit(){this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){(0,m.z)([this.store.select(Ne.k.getUserRole),this.store.select(Ne.k.isPremiumUser),this.store.select(jn.q.hasOrganization),this.store.select(jn.q.getOrganizationAddOns)]).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(([i,o,r,l])=>{this.publishImageEnabled=(0,Dn.KZ)(i,o,r,l),this.changeRef.markForCheck()})}}return(s=t).\u0275fac=function(i){return new(i||s)(e.rXU(a.il),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-context"]],decls:3,vars:2,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]],template:function(i,o){1&i&&(e.qex(0,0),e.DNE(1,Wg,1,0,"app-edit-image-form",1)(2,Jg,1,0,"app-edit-image-upgrade",2),e.bVm()),2&i&&(e.Y8G("ngSwitch",o.publishImageEnabled),e.R7$(),e.Y8G("ngSwitchCase",!0))},dependencies:[E.ux,E.e1,E.fG,or,Hg],changeDetection:0}),t})(),Zg=(()=>{var s;class t{transform(i,o){return no.l.normalize(`${i||""}`)}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=e.EJ8({name:"textNormalize",type:s,pure:!0}),t})();var zi,ne=function(s,t,n,i){var l,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,t,n,i);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(r=(o<3?l(r):o>3?l(t,n,r):l(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},ie=function(s,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,t)};const eb=["engineContainer"],tb=["dimensionsTool"],nb=["backgroundTool"],ib=["engineWatermarkEl"],ob=(s,t,n)=>({"edit--show-timeline-editor":s,"edit--loading":t,"edit--left-collapsed":n}),sb=s=>({"edit__breadcrumb--hide":s}),rb=(s,t,n)=>({ready:s,show:t,manifests:n});function ab(s,t){1&s&&e.nrm(0,"a",68)}function lb(s,t){1&s&&e.nrm(0,"a",69)}function cb(s,t){1&s&&(e.j41(0,"span",75),e.EFF(1,"Upgrade Now"),e.k0s())}function pb(s,t){1&s&&e.nrm(0,"app-spinner",77)}function db(s,t){if(1&s&&(e.qex(0),e.DNE(1,pb,1,0,"app-spinner",76),e.nI1(2,"async"),e.j41(3,"span"),e.EFF(4,"Save"),e.k0s(),e.bVm()),2&s){const n=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,n.saving$))}}function mb(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-button-group")(1,"button",70),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleSaveBookmark())}),e.j41(3,"div",71),e.DNE(4,cb,2,0,"span",72)(5,db,5,3,"ng-container",24),e.k0s()(),e.j41(6,"button",73),e.nI1(7,"async"),e.nrm(8,"app-icon",74),e.k0s()()}if(2&s){const n=e.XpG(),i=e.sdS(104);e.R7$(),e.Y8G("disabled",e.bMT(2,5,n.saving$)),e.R7$(2),e.Y8G("ngSwitch",n.atBookmarkLimit),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(2),e.Y8G("matMenuTriggerFor",i)("disabled",e.bMT(7,7,n.saving$))}}function ub(s,t){if(1&s){const n=e.RV6();e.j41(0,"app-button-group")(1,"button",78),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.saveModule())}),e.EFF(3," Save "),e.k0s(),e.j41(4,"button",79),e.nI1(5,"async"),e.nrm(6,"app-icon",74),e.k0s()()}if(2&s){const n=e.XpG(),i=e.sdS(118);e.R7$(),e.Y8G("disabled",e.bMT(2,3,n.saving$)),e.R7$(3),e.Y8G("matMenuTriggerFor",i)("disabled",e.bMT(5,5,n.saving$))}}function hb(s,t){1&s&&e.nrm(0,"app-edit-exit")}function fb(s,t){1&s&&e.nrm(0,"app-navigation-context-compact")}function gb(s,t){1&s&&e.nrm(0,"app-navigation-context")}function bb(s,t){if(1&s&&e.nrm(0,"app-status",80),2&s){const n=e.XpG();e.Y8G("color",n.quizStatusActive?"green":"red")}}function _b(s,t){if(1&s){const n=e.RV6();e.j41(0,"div",27)(1,"button",81),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleToggleStats())}),e.nrm(3,"app-icon",82),e.k0s()()}if(2&s){const n=e.XpG();e.R7$(),e.Y8G("matTooltip",e.bMT(2,1,n.statsEnabled$)?"Hide Stats Tool":"Show Stats Tool")}}function Cb(s,t){1&s&&e.nrm(0,"img",83,5)}function vb(s,t){1&s&&e.nrm(0,"app-edit-document-context")}function yb(s,t){1&s&&e.nrm(0,"app-edit-label-context")}function kb(s,t){1&s&&e.nrm(0,"app-edit-paint-context")}function Sb(s,t){1&s&&e.nrm(0,"app-edit-quiz-context")}function Tb(s,t){1&s&&e.nrm(0,"app-edit-image-context")}function xb(s,t){1&s&&e.nrm(0,"app-edit-positions-context")}function Eb(s,t){1&s&&e.nrm(0,"app-edit-chapter-pagination")}function wb(s,t){1&s&&(e.j41(0,"div",84),e.nrm(1,"app-engine-scrubber",85),e.k0s())}function Fb(s,t){if(1&s&&(e.j41(0,"button",90),e.EFF(1),e.nI1(2,"async"),e.nrm(3,"app-icon",91),e.k0s()),2&s){e.XpG();const n=e.sdS(4),i=e.XpG();e.Y8G("matMenuTriggerFor",n),e.R7$(),e.SpI(" ",i.formatTimelineScale(e.bMT(2,2,i.timelineScale$))," ")}}function Pb(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.setTimelineScale(o))}),e.j41(1,"div"),e.EFF(2),e.k0s()()}if(2&s){const n=t.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(i.formatTimelineScale(n))}}function Rb(s,t){1&s&&e.nrm(0,"app-spinner",94)}function Mb(s,t){if(1&s&&e.nrm(0,"app-icon",29),2&s){const n=e.XpG().ngIf;e.Y8G("icon",n.show?"compress-alt":"expand-alt")}}function jb(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",92),e.bIt("click",function(){e.eBV(n);const o=e.XpG(2);return e.Njj(o.toggleTimelineEditor())}),e.DNE(1,Rb,1,0,"app-spinner",93)(2,Mb,1,1,"ng-template",null,7,e.C5r),e.k0s()}if(2&s){const n=t.ngIf,i=e.sdS(3);e.Y8G("matTooltip",n.ready||n.manifests?n.show?"Close Timeline Editor":"Open Timeline Editor":"Loading Timeline Editor")("disabled",!n.ready&&!n.manifests),e.R7$(),e.Y8G("ngIf",!n.ready&&!n.manifests)("ngIfElse",i)}}function Ib(s,t){if(1&s&&(e.j41(0,"div",86),e.DNE(1,Fb,4,4,"button",87),e.nI1(2,"async"),e.j41(3,"mat-menu",null,6),e.DNE(5,Pb,3,1,"button",88),e.k0s(),e.DNE(6,jb,4,4,"button",89),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&s){const n=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,3,n.showTimelineEditor$)),e.R7$(4),e.Y8G("ngForOf",n.timelineScales),e.R7$(),e.Y8G("ngIf",e.sMw(11,rb,e.bMT(7,5,n.allChaptersReady$),e.bMT(8,7,n.showTimelineEditor$),e.bMT(9,9,n.manifestsMaxTimes$)))}}function Nb(s,t){if(1&s&&(e.nrm(0,"app-edit-timeline",95),e.nI1(1,"async")),2&s){const n=e.XpG();e.Y8G("manifestsMaxTimes",e.bMT(1,1,n.manifestsMaxTimes$))}}function Bb(s,t){1&s&&e.nrm(0,"app-edit-timeline-maps",96)}function Db(s,t){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"button",61),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.exportQuizKey())}),e.EFF(2,"Export Quiz Key"),e.k0s(),e.bVm()}}function Gb(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",97),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.publishBookmark())}),e.EFF(2," Publish "),e.k0s()}if(2&s){const n=e.XpG();e.Y8G("disabled",n.atBookmarkLimit||e.bMT(1,1,n.saving$))}}function $b(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",98),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.upgrade())}),e.EFF(1," Upgrade Now "),e.k0s()}}function Ob(s,t){if(1&s){const n=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.exportQuizKey())}),e.EFF(1," Export Quiz Key "),e.k0s()}}function Ab(s,t){if(1&s&&e.nrm(0,"app-edit-reload-countdown",99),2&s){const n=e.XpG();e.Y8G("count",n.reloadCount)}}class J{constructor(t,n,i,o,r,l,p,T,B,A,H,ge,Se,We,nt,rt,Xi,Oe,en,En,Bo,Do,Qi,Ga,sr){this.actions=t,this.activatedRoute=n,this.router=i,this.nodeService=o,this.animationService=r,this.bookmarkService=l,this.modulesService=p,this.bookmarkActionsService=T,this.vendorAnalyticsService=B,this.dialog=A,this.dialogService=H,this.storageService=ge,this.userAccessService=Se,this.location=We,this.snackBar=nt,this.store=rt,this.storyService=Xi,this.sceneService=Oe,this.popupService=en,this.cleanupService=En,this.imageService=Bo,this.engineRendererService=Do,this.snackbar=Qi,this.renderer=Ga,this.changeDetectorRef=sr,this.layoutThemeEnum=h.Z,this.editViewEnum=F.x,this.toolEnum=Q.s,this.environmentApplication=Me.c,this.toolIcons=Fc,this.exportType=we.c.exportType,this.canvasSizeTooltip="Emulate canvas size",this.reloadCount=0,this.showReloadBlocker=!1,this.isStoryDirty=!1,this.timelineScales=Jc,this.ngUnsubscribe=new b.B,this.application=Me.c,this.isAnimated=!1,this.atBookmarkLimit=!1,this.quizHasQuestions=!1,this.quizStatusActive=!1}ngOnInit(){const{id:t}=this.activatedRoute.snapshot.queryParams;this.id=this.sanitizeRouteId(t),this.type=this.storyService.getStoryType(this.id),this.store.dispatch(new rr.G.SetTheme(h.Z.Dark)),this.store.dispatch(new oe.pL(Q.s.Select)),this.store.dispatch(new w.tV),this.store.dispatch(new oe.t5(!0)),this.store.dispatch(new oe.Gv(!0)),this.store.dispatch(new oe.Ti(!0)),this.store.dispatch(new Et.pU(!0)),this.store.dispatch(new ye.Tz(!1)),this.store.dispatch(new _e.yi(this.id,this.type)),this.store.dispatch(new Xe.Xt(this.id,this.type)),this.store.dispatch(new ye.Ds({tag:!0,pin:!0})),this.store.dispatch(new oe.kE(!1)),this.store.dispatch(new oe.jM(!1)),we.c.application===Me.c.Loft&&(this.store.dispatch(new Mc.h.Reset),this.allChaptersReady$.pipe((0,P.Z)(!1),(0,M.F)(),(0,j.p)(n=>n),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new _e.V_)}),this.store.dispatch(new Jr.Z(!0))),this.resizeEngineContainer(),this.initListeners(),this.initAuthChecks(),this.initKeyboardListeners(),this.initDirtyCheck(),this.initVendorAnalyticsEvents(),this.prepareThumbnails(this.id),this.initViewGraphListeners(),this.initContentViews(),this.initPaints(),this.initStoryRecipes(),this.initNodePaintListener(),this.initQuizStateListener(),this.initEngineWatermarkListeners()}ngAfterViewInit(){setTimeout(()=>this.resizeEngineContainer(),0)}ngOnDestroy(){this.store.dispatch(new rr.G.SetTheme(h.Z.Light)),this.store.dispatch(new oe.t5(!1)),this.store.dispatch(new ye.Tz(!1)),this.unbindKeyboardListeners(),this.cleanupService.resetScene(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}canDeactivate(){if(this.store.selectSnapshot(Ne.k.getUserProfile)&&this.isStoryDirty&&!this.atBookmarkLimit){const n=this.store.selectSnapshot(Ee.J.getSelectedBookmark),i=this.store.selectSnapshot(x.t.getStory).displayName,o=this.getBookmarkSaveType(n);return this.confirmSaveDialog(!0).pipe((0,it.q)(r=>{if(typeof r>"u")return(0,y.of)(!1);if(!r)return(0,y.of)(!0);switch(we.c.application){case Me.c.Studio:return("save"===o?this.saveBookmark(n,!0):this.saveNewBookmarkDialog("Save As",i)).pipe((0,Te.T)(()=>!0));case Me.c.Loft:this.openSaveModuleDialog(this.id).afterClosed().pipe((0,Te.T)(()=>!0))}}),(0,S.Q)(this.ngUnsubscribe))}return(0,y.of)(!0)}resizeEngineContainer(){const{offsetLeft:t,offsetTop:n,offsetWidth:i,offsetHeight:o}=this.engineContainer.nativeElement;let[r,l,p,T]=[t,n,i,o];const B=this.store.selectSnapshot(X.getCanvasSettings);let A=!1;const H=this.store.selectSnapshot(X.getCanvasSize);(-1!==H.width||-1!==H.height)&&([p,T]=[H.width,H.height],B.emulateDrawer&&H.width<960&&(A=!0,T-=64),B.emulateColumn&&H.width>=960&&(A=!0,p-=320),l=n+(o-T)/2,r=t+(i-p)/2);const We=Math.min(i/p,o/T,1);this.canvasSizeTooltip=A?`Canvas Size: ${p}px x ${T}px with ${p>=960?Dr.G.Column:Dr.G.Drawer}`:`Canvas Size: ${p}px x ${T}px`;const nt=new Oa.j(i,o,r,l,p,T,Aa.g.Shown,We);this.store.dispatch(new oe.Sh(nt))}initListeners(){this.windowResize$=(0,d.R)(window,"resize"),(0,m.z)([this.engineReady$,this.incoming$]).pipe((0,j.p)(([t,n])=>t&&!!n.id),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.loadStory()}),(0,f.h)(this.showTimelineEditor$,this.windowResize$,this.canvasSize$,this.leftColumnCollapsed$).pipe((0,at.c)(10),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.resizeEngineContainer()}),this.record$.subscribe(t=>{this.record=t}),this.selectedChapterId$.pipe((0,j.p)(t=>!!t),(0,Te.T)(()=>this.store.selectSnapshot(I.N.getSelectedChapter)),(0,j.p)(t=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleChapterChanging(t)}),this.engineChapterId$.pipe((0,j.p)(t=>!!t),(0,Te.T)(()=>this.store.selectSnapshot(I.N.getSelectedChapter)),(0,j.p)(t=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleChapterChanged(t)}),this.actions.pipe((0,a.rM)(V.Oj),(0,Te.T)(()=>this.store.selectSnapshot(I.N.getSelectedChapter)),(0,j.p)(t=>!(0,R.isNil)(t?.camera?.location)),(0,S.Q)(this.ngUnsubscribe)).subscribe(({camera:t})=>{const{location:n,rotationCenter:i}=t;this.store.dispatch(new Et.Ih(n,!1,void 0,i))}),this.selectedLabel$.pipe((0,M.F)((t,n)=>t?.id===n?.id),(0,j.p)(t=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new oe.pL(Q.s.Label)),this.store.dispatch(new w.yF(F.x.Label))}),this.actions.pipe((0,a.xi)(oe.zE),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleNodeClick(t.node,t.event)}),this.actions.pipe((0,a.xi)(Xe.x$),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleSaveBookmarkSuccess(t)),this.actions.pipe((0,a.xi)(Xe.Ur),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleSaveBookmarkFailure(t)),this.actions.pipe((0,a.xi)(Vt.NZ),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleSaveModuleSuccess(t)),this.actions.pipe((0,a.xi)(V.PA),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{setTimeout(()=>{this.snackbar.open(`Duplicated chapter "${t.chapter.displayName}"`)})}),this.actions.pipe((0,a.xi)(V.YA),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackbar.open(`"${t.chapter.displayName}" chapter has been removed`)}),this.actions.pipe((0,a.xi)(_e.S9),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new _e.yi(null,null)),this.router.navigate(["/404"],{queryParams:{errorType:"content",errorUrl:this.router.url},skipLocationChange:!0})}),this.actions.pipe((0,a.xi)(_e.yw),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackbar.open(`Successfully imported ${t.story.displayName}.`)}),this.actions.pipe((0,a.xi)(oe.RZ,oe.PF),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackbar.open("Successfully updated model layers.")}),this.actions.pipe((0,a.xi)(w.lN),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.preview("modal",t.quizLocked,t.quizQuestion)}),this.actions.pipe((0,a.xi)(V.lc,V.Bc),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(I.N.getSelectedChapter);this.isAnimated=this.animationService.isChapterAnimated(t)}),this.chapterReadyState$.pipe((0,j.p)(t=>!(0,R.isNil)(t)&&!0===t.animation),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(I.N.getSelectedChapter);(0,R.get)(t,"ui.play.autoplay",!1)&&(this.animationService.scrub(.1),this.animationService.scrub(0))})}initAuthChecks(){this.selectedBookmark$.pipe((0,j.p)(t=>"module"===this.type),(0,j.p)(t=>null!=t),(0,he.s)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(Ne.k.getUserRole);this.type===bt.c.Bookmark&&!Dn.dE(n,t)&&this.openBookmarkAccessDialog()}),this.selectedBookmark$.pipe((0,j.p)(t=>!!t),(0,j.p)(t=>!this.isBookmarkEditable(t)),(0,Bt.n)(()=>this.bookmarkActionsService.checkBookmarkLimit()),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleBookmarkLimit(t)})}initContentViews(){(0,m.z)([this.store.select(Ne.k.isPremiumUser),this.store.select(I.N.getSelectedChapterModelReady),this.store.select(Ne.k.getContentViews)]).pipe((0,j.p)(([t,n,i])=>!t&&n&&!i.limit_reached),(0,he.s)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Pr.e0(this.id,this.type))})}initStoryRecipes(){this.story$.pipe((0,j.p)(t=>null!=t),(0,S.Q)(this.ngUnsubscribe),(0,W.B)(0),(0,he.s)(1)).subscribe(t=>{this.store.dispatch(new D.yE),t.chapters.forEach(n=>{const i=[];(0,R.isNil)(n.synchronization)||Object.values(n.synchronization).forEach(o=>{(0,ln.Jl)(o)&&i.push(o)}),this.store.dispatch(new D.b8(n.id,i)),(we.c.application===Me.c.Studio&&this.type)===bt.c.Module&&this.store.dispatch(new _e.Pv(void 0))})})}initPaints(){const t=this.storageService.getLocalJSON(Ge.UT.RecentRecipes);this.store.dispatch(new D.Nf(t));const n=this.storageService.getLocalJSON(Ge.UT.PaintPalettes);this.store.dispatch(new D.T2(n))}initNodePaintListener(){this.actions.pipe((0,a.rM)(re.Jp),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(G.i.getCurrentRecipeForEngine);(0,ln.Jl)(t)&&this.store.dispatch(new D.Df(t));const n=this.store.selectSnapshot(ve.z.getNodes),i=this.buildChapterRecipes(n),o=this.store.selectSnapshot(I.N.getSelectedChapterId);this.store.dispatch(new D.b8(o,i)),this.changeDetectorRef.markForCheck()})}initQuizStateListener(){(0,m.z)([this.allQuestions$,this.quizEnabled$,this.bookmarkViewMode$]).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(([t,n,i])=>{this.quizHasQuestions=t.length>0,this.quizStatusActive=this.quizHasQuestions&&n&&!(i===Ct._.Content),this.changeDetectorRef.markForCheck()}),(0,m.z)([this.actions.pipe((0,a.rM)(_e.t1)),this.store.select(Ee.J.getSelectedBookmarkViewMode)]).pipe((0,j.p)(([,t])=>!(0,R.isNil)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(([,t])=>{const n=this.store.selectSnapshot(fe.j.getQuizSettings);this.store.dispatch(new Fe.B.SetQuizSettings({...n,enabled:t!==Ct._.Content}))})}buildChapterRecipes(t){const n=Object.values(t).reduce((i,o)=>{if((0,ln.Jl)(o.paint)){const r=(0,pt.Sf)(o.paint);i.push(r)}return i},[]);return(0,ln.c7)(n).sort(ln.UD)}initDirtyCheck(){this.actions.pipe((0,a.xi)(_e.Z0,Xe.x$,Vt.NZ,Pr.cO),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.isStoryDirty=!1}),this.actions.pipe((0,a.xi)(re.Jp,re.Ke,re.yr,ye.Sh,ye.vx,ye.lb,ye.yi,V.PA,V.YA,_e.yw,_e.Nu,Xe.e_,_e.fK,V.qi,V.EN,V.Ej,V.Nw,V.sN,V.rT,V.Oj,V.O,V.sC,V.VU,Gr.V9,V.tn,Fe.B.AddQuestion,Fe.B.ReorderQuestions,Fe.B.RemoveQuestions,Fe.B.SetQuestion),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{this.isStoryDirty=!0})}initVendorAnalyticsEvents(){this.store.select(I.N.getSelectedChapterModelReady).pipe((0,j.p)(t=>t),(0,he.s)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(x.t.getStoryId),n=this.store.selectSnapshot(x.t.getStory);this.vendorAnalyticsService.trackOncePerPage("View - Loaded",{id:t,chapters:n.chapters.length,tour:n.tags.includes("tour"),animated:n.tags.includes("animated"),quiz:this.store.selectSnapshot(fe.j.hasQuiz),edit:!0})})}initViewGraphListeners(){this.store.select(X.getShowRootNodes).pipe((0,lt.i)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.store.selectSnapshot(I.N.getSelectedChapter),i=this.sceneService.createViewGraph({includeRoot:t,availableObjects:n.availableObjects});this.store.dispatch(new oe.LL(i))})}initEngineWatermarkListeners(){(0,m.z)([this.activeTool$,this.logoConfig$,this.background$,this.enginePosition$]).pipe((0,j.p)(([,t])=>!(0,R.isNil)(t)),(0,M.F)((t,n)=>(0,R.isEqual)(t,n)),(0,W.B)(0),(0,S.Q)(this.ngUnsubscribe)).subscribe(([,t,n])=>{const i=this.engineWatermarkEl?.nativeElement;if(!i)return;const o=this.engineRendererService.getCanvas(),l=(0,Wr.g)(t,"full",(0,co.T4)(n)?"color":"white").logo_url;this.renderer.setAttribute(i,"src",l);const{innerHeight:p}=window,{left:T,bottom:B}=o.getBoundingClientRect(),{x:A,y:H}=ts._.copyrightOffset,Se=T+A;this.renderer.setStyle(i,"bottom",p-B-H+"px"),this.renderer.setStyle(i,"left",`${Se}px`)})}handleBookmarkLimit(t){const{limit_reached:o}=t;this.atBookmarkLimit=o;const r=this.store.selectSnapshot(Ne.k.getUserProfile),l=this.store.selectSnapshot(Ee.J.getSelectedBookmark);if(r&&l){const p=r.premium_account_valid,T=this.isBookmarkEditable(l);o&&!T&&!p&&this.userAccessService.openBookmarkSaveLimit()}}initKeyboardListeners(){je.bind("1",()=>this.handleSelectTool(Q.s.Select)),je.bind("2",()=>this.handleSelectTool(Q.s.Hide)),je.bind("3",()=>this.handleSelectTool(Q.s.Paint)),je.bind("4",()=>this.handleSelectTool(Q.s.Label)),je.bind("5",()=>this.handleSelectTool(Q.s.Positions)),je.bind("6",()=>this.handleSelectTool(Q.s.Quiz)),je.bind("7",()=>this.handleSelectTool(Q.s.Image)),je.bind("shift+3",()=>this.handleSelectTool(Q.s.Eyedropper)),je.bind("meta+,",t=>{t.preventDefault();const n=this.store.selectSnapshot(X.getLeftColumnCollapsed);this.store.dispatch(new w.HZ(!n))}),je.bind("meta+z",t=>{t.preventDefault(),this.undo()}),je.bind(["meta+y","meta+shift+z"],t=>{t.preventDefault(),this.redo()}),je.bind([".","pagedown"],()=>this.nextChapter()),je.bind([",","pageup"],()=>this.previousChapter()),je.bind(["del","backspace"],()=>this.handleDelete()),je.bind("meta+a",t=>{t.preventDefault(),this.handleSelectAll()}),je.bind(["H","I","F","P"],t=>{t.preventDefault();const n=this.store.selectSnapshot(ve.z.getCheckedNodeIds);if(n.length>0)switch(t.key){case"H":this.store.dispatch(new re.yr(!1,n));break;case"I":this.nodeService.hideInverse(n);break;case"F":this.nodeService.fade(n);break;case"P":this.nodeService.applyCurrentRecipe(n)}})}unbindKeyboardListeners(){je.reset()}handleStoryTitleClick(){this.openContentDialog()}handleChapterTitleClick(){const t=this.store.selectSnapshot(I.N.getSelectedChapterId);this.openContentDialog(t)}handleChapterChanging(t){this.isAnimated=this.animationService.isChapterAnimated(t)}handleChapterChanged(t){const n=this.store.selectSnapshot(X.getShowRootNodes),i=this.sceneService.createViewGraph({includeRoot:n,availableObjects:t.availableObjects});this.store.dispatch(new oe.LL(i)),this.store.dispatch(new re.IA(t.id));const{camera:o,transparencyMode:r}=t;this.store.dispatch(new oe._h(r)),(0,R.isNil)(o)||this.handleCameraAction(o)}handleCameraAction(t){const{action:n,location:i,rotationCenter:o}=t;this.store.dispatch(new Et.Ih(i,"flyTo"===n,void 0,o))}handleSelectTool(t){switch(t!==Q.s.Background&&t!==Q.s.Dimensions&&this.store.dispatch(new oe.pL(t)),t){case Q.s.Paint:case Q.s.Eyedropper:this.store.dispatch(new w.yF(F.x.Paint));break;case Q.s.Label:this.store.dispatch(new w.yF(F.x.Label));break;case Q.s.Positions:this.store.dispatch(new w.yF(F.x.Positions));break;case Q.s.Quiz:this.store.dispatch(new w.yF(F.x.Quiz));break;case Q.s.Image:this.store.dispatch(new w.yF(F.x.Image));break;case Q.s.Background:this.popupService.open({origin:this.backgroundTool.nativeElement,content:On}).afterClosed$.pipe((0,he.s)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe();break;case Q.s.Dimensions:this.popupService.open({origin:this.dimensionsTool.nativeElement,content:po}).afterClosed$.pipe((0,he.s)(1),(0,S.Q)(this.ngUnsubscribe)).subscribe();break;default:this.store.dispatch(new w.yF(F.x.Chapter))}}handleUndoClick(){this.undo()}handleRedoClick(){this.redo()}handleToggleStats(){const t=this.store.selectSnapshot(_.S.getStatsEnabled);this.store.dispatch(new oe.BM(!t,!1))}handleDelete(){const t=this.store.selectSnapshot(Ue.y.getSelectedLabel),n=this.store.selectSnapshot(ve.z.getCheckedNodeIds);t?this.store.dispatch(new ye.vx(t)):n.length&&this.store.dispatch(new re.yr(!1,n))}handleSelectAll(){this.store.dispatch(new re.q9(!0))}loadStory(){const{id:t,type:n}=this.store.selectSnapshot(x.t.getIncomingStoryInfo),i=this.store.selectSnapshot(Ne.k.getUserLanguage);this.store.dispatch(new _e.Ye(t,n,i))}handleNodeClick(t,n){const i=this.store.selectSnapshot(_.S.getActiveTool);if(t||n.srcEvent.shiftKey)if(n.srcEvent.shiftKey){if(!t)return;const r=this.store.selectSnapshot(ve.z.getNodes)[t.id].checked;this.store.dispatch(new re.q9(!r,[t.id])),this.store.dispatch(new re.hg(t.id))}else{const o=!this.store.selectSnapshot(ve.z.getNodes)[t.id].checked;switch(i){case Q.s.Hide:this.store.dispatch(new re.yr(!1,[t.id]));break;case Q.s.Select:this.store.dispatch(new re.q9(!1)),o&&(this.store.dispatch(new re.q9(!0,[t.id])),this.store.dispatch(new re.hg(t.id))),this.store.dispatch(new oe._o(t))}}else this.store.dispatch(new re.q9(!1))}toggleTimelineEditor(){const t=!this.store.selectSnapshot(X.getShowTimelineEditor);this.store.dispatch(new w.ud(t))}setTimelineScale(t){this.store.dispatch(new ue.SetScale(t))}formatTimelineScale(t){return 100*t+"%"}handleSaveBookmark(){if(this.atBookmarkLimit)this.upgrade();else{const t=this.store.selectSnapshot(Ee.J.getSelectedBookmark);switch(this.getBookmarkSaveType(t)){case"save":this.saveBookmark(t).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(k.l);break;case"saveAs":this.saveBookmarkAs()}}}saveModule(){this.openSaveModuleDialog(this.id)}saveBookmarkAs(){this.bookmarkActionsService.checkBookmarkLimit().pipe((0,Ae.Z)(t=>{if(t.limit_reached)return this.userAccessService.openBookmarkSaveLimit();{const n="Save As",i=this.store.selectSnapshot(x.t.getStory).displayName;return this.saveNewBookmarkDialog(n,i)}}),(0,S.Q)(this.ngUnsubscribe)).subscribe(k.l)}publishBookmark(){if(this.atBookmarkLimit)return;const t=this.store.selectSnapshot(Ee.J.getSelectedBookmark),n=this.getBookmarkSaveType(t);if("save"===n&&t)this.isStoryDirty?this.confirmSaveDialog().pipe((0,it.q)(i=>i?this.saveBookmark(t,!0):(0,y.of)(t)),(0,S.Q)(this.ngUnsubscribe)).subscribe(i=>{this.openPublishDialog(i)}):this.openPublishDialog(t);else if("saveAs"===n){const i="Save As",o=this.store.selectSnapshot(x.t.getStory).displayName;this.saveNewBookmarkDialog(i,o,"You must save your changes to publish your model.").pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(l=>{l&&this.openPublishDialog(l)})}}isBookmarkEditable(t){if(t){const n=this.store.selectSnapshot(Ne.k.getUserRole),i=Dn.dE(n,t);return t.type===bt.c.Bookmark&&i}return!1}getBookmarkSaveType(t){return t&&this.isBookmarkEditable(t)?"save":"saveAs"}handleSaveBookmarkSuccess(t){const{bookmark:n,story:i}=t,{id:o,title:r,type:l}=n;if(this.store.dispatch(new Xe.sN(n)),this.location.replaceState("edit",`?id=${o}`),this.snackBar.open(`${r} saved to your library.`),i){const T=this.store.selectSnapshot(I.N.getSelectedChapterIndex);this.store.dispatch(new _e.Ck(o,i,l,T,"save"===t.method))}}handleSaveModuleSuccess(t){this.id=this.sanitizeRouteId(t.id);const n=this.store.selectSnapshot(I.N.getSelectedChapterIndex);if(t.statesDuplicated){this.reloadCount=0,this.showReloadBlocker=!0;const o=setInterval(()=>{this.reloadCount++,this.changeDetectorRef.markForCheck()},1e3);setTimeout(()=>{clearInterval(o),this.showReloadBlocker=!1,this.changeDetectorRef.markForCheck(),window.location.reload()},9e4)}else this.store.dispatch(new _e.Ck(t.id,t.story,bt.c.Module,n,!0))}handleSaveBookmarkFailure(t){this.snackBar.open(`Unable to save "${t.bookmarkEntry.title}". Please try again.`)}openContentDialog(t=""){this.dialog.open(gt,{width:"90vw",maxWidth:"1280px",height:"90vh",data:{chapterId:t}})}preview(t,n=!1,i){if(this.bookmarkActionsService.isPremiumRestrictedAction(lp.t9.Publish)){const H=this.store.selectSnapshot(Ne.k.getProfile);return void this.userAccessService.openPublishPaywall(H)}(0,R.isNil)(i)||(n=!0);const o=this.store.selectSnapshot(I.N.getStoryChapters),r=(0,Br.S)(o,!1),l=this.store.selectSnapshot(x.t.getStory),p=this.bookmarkService.createBookmarkStory(l.displayName,r),T=this.store.selectSnapshot(Ee.J.getSelectedBookmark),B=this.store.selectSnapshot(Ne.k.getUserLanguage),A=this.store.selectSnapshot(jn.q.getSelectedOrganizationProductAccountId);this.storageService.setDatabaseItem(Ge.AJ.PreviewStory,p.story).then(()=>this.storageService.setDatabaseItem(Ge.AJ.PreviewBookmark,T)).then(()=>{switch(t){case"modal":this.dialog.open(ap,{panelClass:"bd-preview-dialog-panel",data:{quizLocked:n,questionNumber:i,lang:B,productAccountId:A}});break;case"tab":window.open(`/view?id=preview&lang=${B}`)}})}undo(){this.store.dispatch(new so.a.Undo(this.store.selectSnapshot(I.N.getSelectedChapterId)))}redo(){this.store.dispatch(new so.a.Redo(this.store.selectSnapshot(I.N.getSelectedChapterId)))}upgrade(){this.dialogService.openUpgradeDialog()}openInSceneEditor(){window.open(`https://scene-editor.biodigital.com/apps/editor/?m=${this.id}.json`)}openInViewer(){window.open(`https://human-qa.biodigital.com/viewer/?id=${this.id}&ui-label-list=true`)}sanitizeRouteId(t){return t=t.replace(/\.json$/,""),this.location.replaceState("edit",`?id=${t}`),t}nextChapter(){this.store.selectSnapshot(I.N.getAllChaptersModelsReady)&&this.store.dispatch(new V.tg)}previousChapter(){this.store.selectSnapshot(I.N.getAllChaptersModelsReady)&&this.store.dispatch(new V.F0)}prepareThumbnails(t){this.allChaptersReady$.pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(n=>n),(0,Te.T)(()=>this.store.selectSnapshot(x.t.getStory)),(0,he.s)(1)).subscribe(n=>{this.imageService.generateFreshChapterImages(n.chapters,t,we.c.application===Me.c.Studio&&this.type===bt.c.Module).pipe((0,S.Q)(this.ngUnsubscribe)).subscribe(o=>{const r=this.store.selectSnapshot(ro.K.getRegisteredThumbnails);o.forEach(l=>{r.set(l.chapterId,l)}),this.store.dispatch(new Gr.W2(r))})})}exportWrittenContent(){const t=this.storyService.exportWrittenContent(this.store.selectSnapshot(x.t.getStory),this.store.selectSnapshot(I.N.getStoryChapters),this.store.selectSnapshot(Ue.y.getLabels)),n=`${this.store.selectSnapshot(x.t.getStory).displayName||"story"}.txt`,i=new Blob([t],{type:"text/plain;charset=utf-8"});(0,Qo.saveAs)(i,n)}exportQuizKey(){const t=this.storyService.exportQuizKey(this.store.selectSnapshot(fe.j.getAllQuestions)),n=`${this.store.selectSnapshot(x.t.getStory).displayName||"story"}.md`,i=new Blob([t],{type:"text/plain;charset=utf-8"});(0,Qo.saveAs)(i,n)}mergeModule(){let t=null,n=(0,y.of)(!0);this.isStoryDirty&&(n=this.confirmModuleMergeSaveDialog().pipe((0,S.Q)(this.ngUnsubscribe),(0,j.p)(i=>i),(0,Ae.Z)(()=>this.openSaveModuleDialog(this.id).afterClosed()),(0,j.p)(i=>i))),n.pipe((0,S.Q)(this.ngUnsubscribe),(0,Ae.Z)(()=>this.openMergeModuleDialog().afterClosed()),(0,j.p)(i=>null!=i),(0,on.M)(i=>{t=i.id}),(0,Ae.Z)(()=>this.modulesService.mergeModule(this.id,t)),(0,Ae.Z)(i=>i.success?(0,y.of)(i):this.resolveMergeConflict(this.id,t))).subscribe(i=>{this.snackBar.open(`${this.id} was successfully merged with ${t}`),this.store.dispatch(new _e.Nu(i.merged))})}resolveMergeConflict(t,n){return this.openMergeConflictDialog(t,n).afterClosed().pipe((0,j.p)(i=>null!=i),(0,Ae.Z)(i=>this.modulesService.mergeModule(t,n,i)),(0,j.p)(i=>i.success))}openMergeModuleDialog(){return this.dialog.open(Zc,{id:Lt.t.MergeModuleDialog,maxWidth:"90vw",width:"90vw",height:"90vh"})}openMergeConflictDialog(t,n){return this.dialog.open(ep,{id:Lt.t.MergeConflictDialog,data:{loft:t,bridge:n}})}confirmModuleMergeSaveDialog(){return this.dialogService.openConfirmDialog({data:{titleText:"Unsaved Changes",bodyText:"You must save before merging files. Continue to save changes.",confirmText:"Continue",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed()}confirmSaveDialog(t){return this.dialogService.openConfirmDialog({data:{titleText:"Save Changes",bodyText:"Would you like to save your changes to your model?",confirmText:"Save",cancelText:"Don't Save",miscText:t?"Cancel":"",confirmColor:"warn"}}).afterClosed()}saveBookmark(t,n=!1){n&&this.snackBar.open(`Saving "${t.title}"...`);const i=this.isBookmarkEditable(t);return this.store.dispatch(new Xe.iy({isOwner:i,id:t.id,title:t.title,viewMode:t.viewMode},!0)).pipe((0,it.q)(()=>this.actions.pipe((0,a.xi)(Xe.x$,Xe.Ur),(0,xt.$)())),(0,Te.T)(o=>o instanceof Xe.x$?this.store.selectSnapshot(Ee.J.getSelectedBookmark):t))}saveNewBookmarkDialog(t,n,i){this.dialog.closeAll();const o=this.store.selectSnapshot(Ee.J.getSelectedBookmarkViewMode);return this.dialog.open(qo.f,{id:Lt.t.SaveBookmarkDialog,data:{mode:qo.V.SaveStory,title:t,bookmarkTitle:n,viewMode:o,message:i}}).afterClosed()}openPublishDialog(t){this.bookmarkActionsService.publish(t)}openSaveModuleDialog(t,n){this.dialog.closeAll();const i={id:Lt.t.SaveModuleDialog,width:"480px",data:{id:t},...n};return this.dialog.open(Bn,i)}openBookmarkAccessDialog(){const t=this.store.selectSnapshot(Ee.J.getSelectedBookmark);if(t){const n={id:Lt.t.BookmarkAccessDialog,width:"480px",data:{model:t}};return this.dialog.closeAll(),this.dialog.open(qo.f,n)}}}(zi=J).\u0275fac=function(t){return new(t||zi)(e.rXU(a.En),e.rXU(C.nX),e.rXU(C.Ix),e.rXU(Kr.w),e.rXU(wt.O),e.rXU(Ua.x),e.rXU(jr.F),e.rXU(tp.h),e.rXU(Hc.e),e.rXU(Z.bZ),e.rXU(Ve.o),e.rXU(Ge.n$),e.rXU(zo.p),e.rXU(E.aZ),e.rXU(Le.UG),e.rXU(a.il),e.rXU(Pc.J),e.rXU(cp.w),e.rXU(kp.O),e.rXU(Rc.M),e.rXU(Wc.M),e.rXU(Sp.z),e.rXU(Le.UG),e.rXU(e.sFG),e.rXU(e.gRc))},zi.\u0275cmp=e.VBU({type:zi,selectors:[["app-edit"]],viewQuery:function(t,n){if(1&t&&(e.GBs(eb,7),e.GBs(tb,7,e.aKT),e.GBs(nb,7,e.aKT),e.GBs(ib,5,e.aKT)),2&t){let i;e.mGM(i=e.lsd())&&(n.engineContainer=i.first),e.mGM(i=e.lsd())&&(n.dimensionsTool=i.first),e.mGM(i=e.lsd())&&(n.backgroundTool=i.first),e.mGM(i=e.lsd())&&(n.engineWatermarkEl=i.first)}},decls:131,vars:130,consts:[["dimensionsTool",""],["backgroundTool",""],["engineContainer",""],["fileMenuBookmarks","matMenu"],["fileMenuModules","matMenu"],["engineWatermarkEl",""],["timelineScale","matMenu"],["timelineButtons",""],[1,"edit","edit--dark","theme-dark",3,"ngClass"],[1,"edit__header-left"],["routerLink","/","class","edit__logo",4,"appFlagApplication"],["routerLink","/results/modules","class","edit__logo",4,"appFlagApplication"],["data-test","openContentManagerButton",1,"edit__title",3,"click","title"],[1,"edit__title-text"],[1,"edit__title-icon"],["icon","pencil"],[1,"edit__header-right"],["buttonSize","sm","buttonShape","square"],["app-button","","buttonType","outline","buttonSize","sm","compact","true","data-test","previewTrigger",3,"click","disabled"],[4,"appFlagExternal"],[4,"appFlagInternal"],[4,"appFlagApplication"],[1,"edit__scene-left",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"edit__header-bar"],[1,"flex","flex-row"],[1,"edit__toolbar-group"],["app-button","","buttonSize","sm","buttonShape","square","data-test","selectTool",3,"click","buttonType","matTooltip"],[3,"icon"],["app-button","","buttonSize","sm","buttonShape","square","data-test","hideTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","paintTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","labelTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","positionsTool",3,"click","buttonType","matTooltip"],[1,"relative"],["class","absolute pointer-events-none","style","z-index: 2",3,"color",4,"ngIf"],["app-button","","buttonSize","sm","buttonShape","square","data-test","quizTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","imageTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","dimensionsTool",3,"click","buttonType","disabled","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","backgroundTool",3,"click","buttonType","matTooltip"],[1,"flex","items-center","justify-center"],[3,"color","size"],["class","edit__toolbar-group",4,"appFlagApplication"],[1,"edit__toolbar-group","edit__toolbar-group--compact"],["app-button","","buttonSize","sm","buttonShape","square","data-test","undo","matTooltip","Undo",3,"click","disabled"],["icon","undo",3,"custom"],["app-button","","buttonSize","sm","buttonShape","square","matTooltip","Redo","data-test","redo",3,"click","disabled"],["icon","redo",3,"custom"],[1,"edit__scene"],[1,"edit__camera-bar"],["class","edit__watermark",4,"ngIf"],[1,"edit__scene-right",3,"ngSwitch"],[1,"edit__footer-left"],[4,"ngIf"],[1,"edit__footer-bar"],[1,"edit__breadcrumb",3,"ngClass"],["class","pointer-events-none edit__animation",4,"ngIf"],["class","edit__timeline-options",4,"appFlagApplication"],[1,"edit__timeline-bar"],["class","edit__timeline",3,"manifestsMaxTimes",4,"ngIf"],["class","edit__timeline-map",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","publishBookmark",3,"disabled","click",4,"appFlagExternal"],["mat-menu-item","","data-test","upgradeSubscriptionButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","saveBookmark",3,"click","disabled"],["mat-menu-item","","data-test","saveBookmarkAs",3,"click","disabled"],["mat-menu-item","",3,"click",4,"ngIf"],[3,"count",4,"ngIf"],["routerLink","/",1,"edit__logo"],["routerLink","/results/modules",1,"edit__logo"],["app-button","","data-test","saveBookmark","buttonType","primary","buttonSize","sm",3,"click","disabled"],[1,"flex","items-center","justify-center",3,"ngSwitch"],["class","text-nowrap",4,"ngSwitchCase"],["app-button","","buttonType","primary","buttonSize","sm","buttonShape","square","data-test","saveBookmarkMenu",2,"flex","0 0 40px",3,"matMenuTriggerFor","disabled"],["icon","caret-down"],[1,"text-nowrap"],["render","block","size","small","class","mr-1 theme-dark",4,"ngIf"],["render","block","size","small",1,"mr-1","theme-dark"],["app-button","","data-test","saveModuleTrigger","buttonType","primary","buttonSize","sm","compact","true",1,"grow",3,"click","disabled"],["app-button","","buttonType","primary","buttonSize","sm","buttonShape","square",3,"matMenuTriggerFor","disabled"],[1,"absolute","pointer-events-none",2,"z-index","2",3,"color"],["app-button","","buttonSize","sm","buttonShape","square","data-test","enableStatsTool",3,"click","matTooltip"],["icon","memory"],[1,"edit__watermark"],[1,"pointer-events-none","edit__animation"],[1,"pointer-events-auto",2,"width","400px"],[1,"edit__timeline-options"],["app-button","","matTooltip","Zoom options",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["app-button","",3,"matTooltip","disabled","click",4,"ngIf"],["app-button","","matTooltip","Zoom options",3,"matMenuTriggerFor"],["icon","angle-down"],["app-button","",3,"click","matTooltip","disabled"],["size","medium",4,"ngIf","ngIfElse"],["size","medium"],[1,"edit__timeline",3,"manifestsMaxTimes"],[1,"edit__timeline-map"],["mat-menu-item","","data-test","publishBookmark",3,"click","disabled"],["mat-menu-item","","data-test","upgradeSubscriptionButton",3,"click"],[3,"count"]],template:function(t,n){if(1&t){const i=e.RV6();e.j41(0,"div",8),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div",9),e.DNE(5,ab,1,0,"a",10)(6,lb,1,0,"a",11),e.j41(7,"div",12),e.nI1(8,"async"),e.nI1(9,"textNormalize"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleStoryTitleClick())}),e.j41(10,"span",13),e.EFF(11),e.nI1(12,"async"),e.nI1(13,"textNormalize"),e.k0s(),e.j41(14,"div",14),e.nrm(15,"app-icon",15),e.k0s()()(),e.j41(16,"div",16),e.nrm(17,"app-help-menu",17),e.j41(18,"button",18),e.nI1(19,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.preview("modal"))}),e.EFF(20," Preview "),e.k0s(),e.DNE(21,mb,9,9,"app-button-group",19)(22,ub,7,7,"app-button-group",20)(23,hb,1,0,"app-edit-exit",21),e.k0s(),e.j41(24,"div",22),e.nI1(25,"async"),e.DNE(26,fb,1,0,"app-navigation-context-compact",23)(27,gb,1,0,"app-navigation-context",24),e.k0s(),e.j41(28,"div",25)(29,"div",26)(30,"div",27)(31,"button",28),e.nI1(32,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Select))}),e.nrm(33,"app-icon",29),e.k0s(),e.j41(34,"button",30),e.nI1(35,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Hide))}),e.nrm(36,"app-icon",29),e.k0s(),e.j41(37,"button",31),e.nI1(38,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Paint))}),e.nrm(39,"app-icon",29),e.k0s(),e.j41(40,"button",32),e.nI1(41,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Label))}),e.nrm(42,"app-icon",29),e.k0s()(),e.j41(43,"div",27)(44,"button",33),e.nI1(45,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Positions))}),e.nrm(46,"app-icon",29),e.k0s(),e.j41(47,"div",34),e.DNE(48,bb,1,1,"app-status",35),e.j41(49,"button",36),e.nI1(50,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Quiz))}),e.nrm(51,"app-icon",29),e.k0s()(),e.j41(52,"button",37),e.nI1(53,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Image))}),e.nrm(54,"app-icon",29),e.k0s()(),e.j41(55,"div",27)(56,"button",38,0),e.nI1(58,"async"),e.nI1(59,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Dimensions))}),e.nrm(60,"app-icon",29),e.k0s(),e.j41(61,"button",39,1),e.nI1(63,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSelectTool(n.toolEnum.Background))}),e.j41(64,"div",40),e.nrm(65,"app-swatch-item",41),e.nI1(66,"async"),e.k0s()()(),e.DNE(67,_b,4,3,"div",42),e.k0s(),e.j41(68,"div",43)(69,"button",44),e.nI1(70,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleUndoClick())}),e.nrm(71,"app-icon",45),e.k0s(),e.j41(72,"button",46),e.nI1(73,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleRedoClick())}),e.nrm(74,"app-icon",47),e.k0s()()(),e.j41(75,"div",48,2),e.nrm(77,"app-engine")(78,"app-engine-camera-bar",49),e.DNE(79,Cb,2,0,"img",50),e.nI1(80,"async"),e.k0s(),e.j41(81,"div",51),e.nI1(82,"async"),e.DNE(83,vb,1,0,"app-edit-document-context",23)(84,yb,1,0,"app-edit-label-context",23)(85,kb,1,0,"app-edit-paint-context",23)(86,Sb,1,0,"app-edit-quiz-context",23)(87,Tb,1,0,"app-edit-image-context",23)(88,xb,1,0,"app-edit-positions-context",23),e.k0s(),e.j41(89,"div",52),e.DNE(90,Eb,1,0,"app-edit-chapter-pagination",53),e.nI1(91,"async"),e.k0s(),e.j41(92,"div",54)(93,"div",55),e.nI1(94,"async"),e.nrm(95,"app-engine-breadcrumb"),e.k0s(),e.DNE(96,wb,2,0,"div",56)(97,Ib,10,15,"div",57),e.k0s(),e.j41(98,"div",58),e.DNE(99,Nb,2,3,"app-edit-timeline",59),e.nI1(100,"async"),e.DNE(101,Bb,1,0,"app-edit-timeline-maps",60),e.nI1(102,"async"),e.k0s()(),e.j41(103,"mat-menu",null,3)(105,"button",61),e.bIt("click",function(){return e.eBV(i),e.Njj(n.exportWrittenContent())}),e.EFF(106,"Export Text"),e.k0s(),e.DNE(107,Db,3,0,"ng-container",53),e.nI1(108,"async"),e.nrm(109,"mat-divider"),e.DNE(110,Gb,3,3,"button",62)(111,$b,2,0,"button",63),e.nrm(112,"mat-divider"),e.j41(113,"button",64),e.bIt("click",function(){return e.eBV(i),e.Njj(n.handleSaveBookmark())}),e.EFF(114," Save "),e.k0s(),e.j41(115,"button",65),e.bIt("click",function(){return e.eBV(i),e.Njj(n.saveBookmarkAs())}),e.EFF(116," Save as ... "),e.k0s()(),e.j41(117,"mat-menu",null,4)(119,"button",61),e.bIt("click",function(){return e.eBV(i),e.Njj(n.openInSceneEditor())}),e.EFF(120,"Open in Scene Editor..."),e.k0s(),e.j41(121,"button",61),e.bIt("click",function(){return e.eBV(i),e.Njj(n.openInViewer())}),e.EFF(122,"Open in QA Viewer..."),e.k0s(),e.nrm(123,"mat-divider"),e.j41(124,"button",61),e.bIt("click",function(){return e.eBV(i),e.Njj(n.exportWrittenContent())}),e.EFF(125,"Export Text"),e.k0s(),e.DNE(126,Ob,2,0,"button",66),e.nI1(127,"async"),e.j41(128,"button",61),e.bIt("click",function(){return e.eBV(i),e.Njj(n.mergeModule())}),e.EFF(129,"Merge Module"),e.k0s()(),e.DNE(130,Ab,1,1,"app-edit-reload-countdown",67)}if(2&t){let i,o;e.Y8G("ngClass",e.sMw(124,ob,e.bMT(1,64,n.showTimelineEditor$),!e.bMT(2,66,n.allChaptersReady$),e.bMT(3,68,n.leftColumnCollapsed$))),e.R7$(5),e.Y8G("appFlagApplication",n.environmentApplication.Studio),e.R7$(),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(),e.Y8G("title",e.bMT(9,72,null==(i=e.bMT(8,70,n.selectedBookmark$))?null:i.title)),e.R7$(4),e.JRh(e.bMT(13,76,null==(o=e.bMT(12,74,n.selectedBookmark$))?null:o.title)),e.R7$(7),e.Y8G("disabled",n.atBookmarkLimit||e.bMT(19,78,n.saving$)),e.R7$(5),e.Y8G("appFlagApplication",n.application.Studio),e.R7$(),e.Y8G("ngSwitch",e.bMT(25,80,n.leftColumnCollapsed$)),e.R7$(2),e.Y8G("ngSwitchCase",!0),e.R7$(5),e.Y8G("buttonType",e.bMT(32,82,n.activeTool$)===n.toolEnum.Select?"info":"default")("matTooltip",n.toolEnum.Select),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Select]),e.R7$(),e.Y8G("buttonType",e.bMT(35,84,n.activeTool$)===n.toolEnum.Hide?"info":"default")("matTooltip",n.toolEnum.Hide),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Hide]),e.R7$(),e.Y8G("buttonType",e.bMT(38,86,n.activeTool$)===n.toolEnum.Paint?"info":"default")("matTooltip",n.toolEnum.Paint),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Paint]),e.R7$(),e.Y8G("buttonType",e.bMT(41,88,n.activeTool$)===n.toolEnum.Label?"info":"default")("matTooltip",n.toolEnum.Label),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Label]),e.R7$(2),e.Y8G("buttonType",e.bMT(45,90,n.activeTool$)===n.toolEnum.Positions?"info":"default")("matTooltip",n.toolEnum.Positions),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Positions]),e.R7$(2),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(),e.Y8G("buttonType",e.bMT(50,92,n.activeTool$)===n.toolEnum.Quiz?"info":"default")("matTooltip",n.toolEnum.Quiz),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Quiz]),e.R7$(),e.Y8G("buttonType",e.bMT(53,94,n.activeTool$)===n.toolEnum.Image?"info":"default")("matTooltip",n.toolEnum.Image),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Image]),e.R7$(2),e.Y8G("buttonType",e.bMT(58,96,n.activeTool$)===n.toolEnum.Dimensions?"info":"default")("disabled",e.bMT(59,98,n.activeTool$)===n.toolEnum.Image)("matTooltip",n.canvasSizeTooltip),e.R7$(4),e.Y8G("icon",n.toolIcons[n.toolEnum.Dimensions]),e.R7$(),e.Y8G("buttonType",e.bMT(63,100,n.activeTool$)===n.toolEnum.Background?"info":"default")("matTooltip",n.toolEnum.Background),e.R7$(4),e.Y8G("color",e.bMT(66,102,n.background$))("size","small"),e.R7$(2),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(2),e.Y8G("disabled",!e.bMT(70,104,n.canUndo$)),e.R7$(2),e.Y8G("custom",!0),e.R7$(),e.Y8G("disabled",!e.bMT(73,106,n.canRedo$)),e.R7$(2),e.Y8G("custom",!0),e.R7$(5),e.Y8G("ngIf",e.bMT(80,108,n.activeTool$)===n.toolEnum.Image),e.R7$(2),e.Y8G("ngSwitch",e.bMT(82,110,n.view$)),e.R7$(2),e.Y8G("ngSwitchCase",n.editViewEnum.Chapter),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Label),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Paint),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Quiz),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Image),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Positions),e.R7$(2),e.Y8G("ngIf",e.bMT(91,112,n.allChaptersReady$)),e.R7$(3),e.Y8G("ngClass",e.eq3(128,sb,!e.bMT(94,114,n.hoveredNode$))),e.R7$(3),e.Y8G("ngIf",n.isAnimated),e.R7$(),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(2),e.Y8G("ngIf",e.bMT(100,116,n.showTimelineEditor$)),e.R7$(2),e.Y8G("ngIf",e.bMT(102,118,n.showTimelineEditor$)),e.R7$(6),e.Y8G("ngIf",e.bMT(108,120,n.questionTotal$)>0),e.R7$(4),e.Y8G("ngIf",n.atBookmarkLimit),e.R7$(2),e.Y8G("disabled",n.atBookmarkLimit),e.R7$(2),e.Y8G("disabled",n.atBookmarkLimit),e.R7$(11),e.Y8G("ngIf",e.bMT(127,122,n.questionTotal$)>0),e.R7$(4),e.Y8G("ngIf",n.showReloadBlocker)}},dependencies:[E.YU,E.Sq,E.bT,E.ux,E.e1,E.fG,C.Wk,Tp._,xp.k,Ln,ss,$.kk,$.fb,$.Cp,Ce.oV,Qe.q,L.Q,un,Mn.Y,ur,hr.n,Op.E,Y.R,an.tI,zr,ea,hn,mi,gu,St,jt,Ei,It,xf,tt,Js,Nt,jo,Kg,E.Jj,Zg],styles:['@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.edit[_ngcontent-%COMP%]{min-width:1140px;min-height:632px;width:100vw;height:100vh;overflow-y:hidden;overflow-x:auto;position:relative;background:#131c2a;color:#fff;display:grid;grid-template-areas:"header-left header-left header-right" "scene-left header-bar scene-right" "scene-left scene scene-right" "footer-left footer-bar footer-right" "edit-timeline edit-timeline edit-timeline";grid-template-columns:320px auto 280px;grid-template-rows:48px 48px 1fr 56px 0}.edit--left-collapsed[_ngcontent-%COMP%]{grid-template-columns:144px auto auto 280px;grid-template-areas:"header-left header-left header-left header-right" "scene-left header-bar header-bar scene-right" "scene-left scene scene scene-right" "footer-left footer-bar footer-bar footer-right" "edit-timeline edit-timeline edit-timeline edit-timeline"}.edit--show-timeline-editor[_ngcontent-%COMP%]{grid-template-rows:48px 48px 1fr 56px 388px}.edit--show-timeline-editor[_ngcontent-%COMP%]   .edit__timeline-bar[_ngcontent-%COMP%]{display:flex}.edit--loading[_ngcontent-%COMP%]   .edit__timeline-bar[_ngcontent-%COMP%]{opacity:.2;pointer-events:none}.edit__logo[_ngcontent-%COMP%]{background:#131c2a url(/assets/images/logo-white.svg) center center no-repeat;background-size:32px;border-right:1px solid #1c2a3f;border-bottom:1px solid #283853;grid-area:logo;width:48px;height:48px;transition:background-color .25s}.edit__logo[_ngcontent-%COMP%]:hover{background-color:#de3535}.edit__title[_ngcontent-%COMP%]{align-items:center;cursor:pointer;color:#d7e0ea;height:100%;padding-left:12px;letter-spacing:1px;font-weight:300;min-width:272px;max-width:calc(100vw - 308px);display:flex;justify-content:space-between;font-size:1rem;line-height:1.5rem}.edit__title[_ngcontent-%COMP%]:hover{color:#fff}.edit__title[_ngcontent-%COMP%]:hover   .edit__title-icon[_ngcontent-%COMP%]{visibility:visible;color:#fff}.edit__title-text[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding-right:12px}.edit__title-icon[_ngcontent-%COMP%]{visibility:hidden;color:#d7e0ea;font-size:12px}.edit__watermark[_ngcontent-%COMP%]{position:fixed;z-index:10}.edit__camera-bar[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;z-index:10}.edit__header-left[_ngcontent-%COMP%]{background:#131c2a;border-bottom:1px solid #283853;display:flex;align-items:center;justify-content:flex-start;grid-area:header-left}.edit__header-center[_ngcontent-%COMP%]{background:#131c2a;border-bottom:1px solid #283853;grid-area:header-center}.edit__header-bar[_ngcontent-%COMP%]{background:#131c2a;border-left:1px solid #283853;border-right:1px solid #283853;display:flex;flex-direction:row;justify-content:space-between;grid-area:header-bar}.edit__header-right[_ngcontent-%COMP%]{background:#131c2a;align-items:center;justify-content:flex-end;grid-area:header-right;border-bottom:1px solid #283853;display:flex;gap:8px;margin-right:12px}.edit__pagination[_ngcontent-%COMP%]{grid-area:pagination;display:flex;border-left:1px solid #1c2a3f;padding-left:8px}.edit__scene-left[_ngcontent-%COMP%]{background:#131c2a;grid-area:scene-left;min-height:0;overflow-y:hidden}.edit__scene[_ngcontent-%COMP%]{box-shadow:0 0 0 4px #fff;margin:4px;background:#f9fafd;grid-area:scene;position:relative}.edit__scene-right[_ngcontent-%COMP%]{background:#131c2a;grid-area:scene-right;min-height:0;overflow-y:auto}.edit__footer-left[_ngcontent-%COMP%]{background-color:#131c2a;grid-area:footer-left;z-index:20}.edit__footer-right[_ngcontent-%COMP%]{background-color:#131c2a;display:flex;align-items:center;padding:0 8px;justify-content:space-between;grid-area:footer-right;z-index:20}.edit__footer-bar[_ngcontent-%COMP%]{background-color:#131c2a;border-top:1px solid #283853;grid-area:footer-bar;position:relative;display:flex;align-items:center;overflow-x:auto;white-space:nowrap;z-index:20}.edit__timeline-bar[_ngcontent-%COMP%]{background-color:#131c2a;border-top:1px solid #283853;grid-area:edit-timeline;display:none;z-index:20}.edit__timeline[_ngcontent-%COMP%]{display:flex;flex-grow:1}.edit__timeline-map[_ngcontent-%COMP%]{width:280px;flex-shrink:0;border-left:1px solid #283853}.edit__page-actions[_ngcontent-%COMP%]{display:flex;flex:1 1 33%;padding-right:12px;justify-content:flex-end}.edit__page-actions--hidden[_ngcontent-%COMP%]{display:none}.edit__breadcrumb[_ngcontent-%COMP%]{background:#131c2a;padding:8px 0 0;position:absolute;width:100%;height:100%;z-index:2}.edit__breadcrumb[_ngcontent-%COMP%]:after, .edit__breadcrumb[_ngcontent-%COMP%]:before{content:" ";background-color:#131c2a;bottom:0;box-shadow:0 0 16px 4px #131c2a;position:absolute;right:0;top:0;width:4px}.edit__breadcrumb--hide[_ngcontent-%COMP%]{display:none}.edit__progress[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;z-index:3}.edit__animation[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;width:100%;z-index:1}.edit__toolbar-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;padding:0 16px}.edit__toolbar-group[_ngcontent-%COMP%]:not(:last-child){border-right:1px solid #283853}.edit__toolbar-group[_ngcontent-%COMP%]:first-child{margin-left:0;border-left:0}.edit__toolbar-group--compact[_ngcontent-%COMP%]{gap:4px;padding:0 8px}.edit__timeline-options[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:flex-end;width:100%;z-index:0}'],changeDetection:0}),ne([(0,a.l6)(g.W.getTheme),ie("design:type",u.c)],J.prototype,"theme$",void 0),ne([(0,a.l6)(X.getView),ie("design:type",u.c)],J.prototype,"view$",void 0),ne([(0,a.l6)(_.S.getActiveTool),ie("design:type",u.c)],J.prototype,"activeTool$",void 0),ne([(0,a.l6)(X.getLeftColumnCollapsed),ie("design:type",u.c)],J.prototype,"leftColumnCollapsed$",void 0),ne([(0,a.l6)(X.getShowTimelineEditor),ie("design:type",u.c)],J.prototype,"showTimelineEditor$",void 0),ne([(0,a.l6)(X.getRecord),ie("design:type",u.c)],J.prototype,"record$",void 0),ne([(0,a.l6)(X.getCanvasSize),ie("design:type",u.c)],J.prototype,"canvasSize$",void 0),ne([(0,a.l6)(Rr.o.canUndo),ie("design:type",u.c)],J.prototype,"canUndo$",void 0),ne([(0,a.l6)(Rr.o.canRedo),ie("design:type",u.c)],J.prototype,"canRedo$",void 0),ne([(0,a.l6)(_.S.getReady),ie("design:type",u.c)],J.prototype,"engineReady$",void 0),ne([(0,a.l6)(_.S.getChapter),ie("design:type",u.c)],J.prototype,"engineChapterId$",void 0),ne([(0,a.l6)(ve.z.getNodes),ie("design:type",u.c)],J.prototype,"nodes$",void 0),ne([(0,a.l6)(_.S.getHoveredNode),ie("design:type",u.c)],J.prototype,"hoveredNode$",void 0),ne([(0,a.l6)(_.S.getViewGraph),ie("design:type",u.c)],J.prototype,"viewGraph$",void 0),ne([(0,a.l6)(_.S.getAnimationPlaying),ie("design:type",u.c)],J.prototype,"animationPlaying$",void 0),ne([(0,a.l6)(jc.N.getStoryLoadProgress),ie("design:type",u.c)],J.prototype,"loadProgress$",void 0),ne([(0,a.l6)(ar.x.getStoredCamera("__copy")),ie("design:type",u.c)],J.prototype,"cameraCopy$",void 0),ne([(0,a.l6)(x.t.getStory),ie("design:type",u.c)],J.prototype,"story$",void 0),ne([(0,a.l6)(x.t.getIncomingStoryInfo),ie("design:type",u.c)],J.prototype,"incoming$",void 0),ne([(0,a.l6)(Ue.y.getLabels),ie("design:type",u.c)],J.prototype,"labels$",void 0),ne([(0,a.l6)(Ue.y.getSelectedLabel),ie("design:type",u.c)],J.prototype,"selectedLabel$",void 0),ne([(0,a.l6)(I.N.getChaptersLoaded),ie("design:type",u.c)],J.prototype,"chaptersLoaded$",void 0),ne([(0,a.l6)(I.N.getAllChaptersModelsReady),ie("design:type",u.c)],J.prototype,"allChaptersReady$",void 0),ne([(0,a.l6)(I.N.getSelectedChapterId),ie("design:type",u.c)],J.prototype,"selectedChapterId$",void 0),ne([(0,a.l6)(Ee.J.getSelectedBookmark),ie("design:type",u.c)],J.prototype,"selectedBookmark$",void 0),ne([(0,a.l6)(Ee.J.getSelectedBookmarkViewMode),ie("design:type",u.c)],J.prototype,"selectedBookmarkViewMode$",void 0),ne([(0,a.l6)(I.N.getSelectedChapterReadyState),ie("design:type",u.c)],J.prototype,"chapterReadyState$",void 0),ne([(0,a.l6)(Ee.J.getSaving),ie("design:type",u.c)],J.prototype,"saving$",void 0),ne([(0,a.l6)(fe.j.getQuestionTotal),ie("design:type",u.c)],J.prototype,"questionTotal$",void 0),ne([(0,a.l6)(Ne.k.getUserProfile),ie("design:type",u.c)],J.prototype,"userProfile$",void 0),ne([(0,a.l6)(ke.getScale),ie("design:type",u.c)],J.prototype,"timelineScale$",void 0),ne([(0,a.l6)(x.t.getAnimationManifests),ie("design:type",u.c)],J.prototype,"manifestsMaxTimes$",void 0),ne([(0,a.l6)(I.N.getSelectedChapterBackground),ie("design:type",u.c)],J.prototype,"background$",void 0),ne([(0,a.l6)(fe.j.getAllQuestions),ie("design:type",u.c)],J.prototype,"allQuestions$",void 0),ne([(0,a.l6)(fe.j.getQuizEnabled),ie("design:type",u.c)],J.prototype,"quizEnabled$",void 0),ne([(0,a.l6)(Ee.J.getSelectedBookmarkViewMode),ie("design:type",u.c)],J.prototype,"bookmarkViewMode$",void 0),ne([(0,a.l6)(_.S.getEnginePosition),ie("design:type",u.c)],J.prototype,"enginePosition$",void 0),ne([(0,a.l6)(Hr.X.getViewLogoConfig),ie("design:type",u.c)],J.prototype,"logoConfig$",void 0),ne([(0,a.l6)(_.S.getStatsEnabled),ie("design:type",u.c)],J.prototype,"statsEnabled$",void 0);var Ub=v(20736),Vb=v(85446),Lb=v(63665);let Ia=(()=>{var s;class t{constructor(){}canDeactivate(i){return!!i.canDeactivate&&i.canDeactivate()}}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),t})();var Yb=v(22083),zb=v(70737),Xb=v(30234);let Qb=(()=>{var s;class t{constructor(i,o,r,l){this.store=i,this.router=o,this.snackbar=r,this.userAccessService=l}canActivate(){return this.store.select(Ne.k.getUserRole).pipe((0,j.p)(o=>!(0,R.isNil)(o)),(0,he.s)(1),(0,at.c)(0),(0,Te.T)(o=>this.canEdit(o)))}canEdit(i){if(!Dn._m(i,zb.y.EditBookmarks))return this.snackbar.open("You do not have access to edit this bookmark."),this.router.navigate(["/results/bookmarks"]),!1;const r=this.store.selectSnapshot(jn.q.getOrganizationAddOns);if(!Dn.dl(r)){const l=`${location.pathname}${location.search}`,p=/^\/edit/;return this.userAccessService.openExternalAccountEditGate(Xb.a.WoltersKluwer).pipe((0,he.s)(1)).subscribe(()=>{p.test(l)&&this.router.navigate(["/results/modules"])}),!1}return!0}}return(s=t).\u0275fac=function(i){return new(i||s)(e.KVO(a.il),e.KVO(C.Ix),e.KVO(Le.UG),e.KVO(zo.p))},s.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),t})();const qb=[{path:"",component:Ub.m,canActivate:[Vb.q,Lb.Y,Qb],data:{siteHeaderType:Yb.D.Hide,fixedHeight:!0,title:we.c.application},children:[{path:"new",pathMatch:"full",component:J,canDeactivate:[Ia]},{component:J,path:"**",canDeactivate:[Ia]}]}];let Na=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[C.iI.forChild(qb),C.iI]}),t})();var Hb=v(16515),Wb=v(10381),Jb=v(45367),Kb=v(36569),Zb=v(28107),e_=v(40430),t_=v(27800),n_=v(42887),i_=v(59162),o_=v(24184),s_=v(39685),r_=v(27878),Ba=v(13403),a_=v(42617),Da=v(8377);let l_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD,Ut.G,dn.G,c.X1,Da.l]}),t})();var c_=v(66598);let p_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD,Ut.G,dn.G,c.X1,Pn.YG,oo.D,c_.S,te.ad]}),t})(),d_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD,c.X1,oo.D,Tr.o,Ba.j,te.ad,Xo,xr.C,Ut.G,dn.G]}),t})(),m_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD,Ut.G,dn.G,c.X1,Da.l]}),t})(),u_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[E.MD]}),t})();var h_=v(18824);let f_=(()=>{var s;class t{}return(s=t).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[a.rK.forFeature([X,G.i,ke]),p_,E.MD,Pn.YG,Jb.P,Na,c.X1,c.YN,Hb.x,Ut.G,dn.G,Wb.k,Kb.q,Zb.R,e_.i,n_.x,i_.M,t_.I,u_,Xo,io.y2.forChild(),o_.C,s_.y,Ba.j,r_.wR,a_.c,l_,m_,d_,h_.j,wr,Na]}),t})()},91163:function(qi,wn,v){var E;"classList"in document.createElement("_")||function(C){"use strict";if("Element"in C){var e="classList",h="prototype",a=C.Element[h],g=Object,b=String[h].trim||function(){return this.replace(/^\s+|\s+$/g,"")},y=Array[h].indexOf||function(w){for(var N=0,G=this.length;G>N;N++)if(N in this&&this[N]===w)return N;return-1},d=function(w,N){this.name=w,this.code=DOMException[w],this.message=N},m=function(w,N){if(""===N)throw new d("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(N))throw new d("INVALID_CHARACTER_ERR","String contains an invalid character");return y.call(w,N)},f=function(w){for(var N=b.call(w.getAttribute("class")||""),G=N?N.split(/\s+/):[],D=0,q=G.length;q>D;D++)this.push(G[D]);this._updateClassName=function(){w.setAttribute("class",this.toString())}},k=f[h]=[],u=function(){return new f(this)};if(d[h]=Error[h],k.item=function(w){return this[w]||null},k.contains=function(w){return-1!==m(this,w+="")},k.add=function(){var w,N=arguments,G=0,D=N.length,q=!1;do{-1===m(this,w=N[G]+"")&&(this.push(w),q=!0)}while(++G<D);q&&this._updateClassName()},k.remove=function(){var w,N,G=arguments,D=0,q=G.length,le=!1;do{for(N=m(this,w=G[D]+"");-1!==N;)this.splice(N,1),le=!0,N=m(this,w)}while(++D<q);le&&this._updateClassName()},k.toggle=function(w,N){var G=this.contains(w+=""),D=G?!0!==N&&"remove":!1!==N&&"add";return D&&this[D](w),!0===N||!1===N?N:!G},k.toString=function(){return this.join(" ")},g.defineProperty){var F={get:u,enumerable:!0,configurable:!0};try{g.defineProperty(a,e,F)}catch(w){-2146823252===w.number&&(F.enumerable=!1,g.defineProperty(a,e,F))}}else g[h].__defineGetter__&&a.__defineGetter__(e,u)}}(self),function(C){"use strict";if(C.URL=C.URL||C.webkitURL,C.Blob&&C.URL)try{return void new Blob}catch{}var e=C.BlobBuilder||C.WebKitBlobBuilder||C.MozBlobBuilder||function(a){var g=function(z){return Object.prototype.toString.call(z).match(/^\[object\s(.*)\]$/)[1]},b=function(){this.data=[]},y=function(z,ce,K){this.data=z,this.size=z.length,this.type=ce,this.encoding=K},d=b.prototype,m=y.prototype,f=a.FileReaderSync,k=function(z){this.code=this[this.name=z]},u="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),F=u.length,w=a.URL||a.webkitURL||a,N=w.createObjectURL,G=w.revokeObjectURL,D=w,q=a.btoa,le=a.atob,Re=a.ArrayBuffer,Je=a.Uint8Array,nn=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(y.fake=m.fake=!0;F--;)k.prototype[u[F]]=F+1;return w.createObjectURL||(D=a.URL=function(z){var ce,K=document.createElementNS("http://www.w3.org/1999/xhtml","a");return K.href=z,"origin"in K||("data:"===K.protocol.toLowerCase()?K.origin=null:(ce=z.match(nn),K.origin=ce&&ce[1])),K}),D.createObjectURL=function(z){var ce,K=z.type;return null===K&&(K="application/octet-stream"),z instanceof y?(ce="data:"+K,"base64"===z.encoding?ce+";base64,"+z.data:"URI"===z.encoding?ce+","+decodeURIComponent(z.data):q?ce+";base64,"+q(z.data):ce+","+encodeURIComponent(z.data)):N?N.call(w,z):void 0},D.revokeObjectURL=function(z){"data:"!==z.substring(0,5)&&G&&G.call(w,z)},d.append=function(z){var ce=this.data;if(Je&&(z instanceof Re||z instanceof Je)){for(var K="",U=new Je(z),Tt=0,X=U.length;X>Tt;Tt++)K+=String.fromCharCode(U[Tt]);ce.push(K)}else if("Blob"===g(z)||"File"===g(z)){if(!f)throw new k("NOT_READABLE_ERR");var _=new f;ce.push(_.readAsBinaryString(z))}else z instanceof y?"base64"===z.encoding&&le?ce.push(le(z.data)):"URI"===z.encoding?ce.push(decodeURIComponent(z.data)):"raw"===z.encoding&&ce.push(z.data):("string"!=typeof z&&(z+=""),ce.push(unescape(encodeURIComponent(z))))},d.getBlob=function(z){return arguments.length||(z=null),new y(this.data.join(""),z,"raw")},d.toString=function(){return"[object BlobBuilder]"},m.slice=function(z,ce,K){var U=arguments.length;return 3>U&&(K=null),new y(this.data.slice(z,U>1?ce:this.data.length),K,this.encoding)},m.toString=function(){return"[object Blob]"},m.close=function(){this.size=0,delete this.data},b}(C);C.Blob=function(a,g){var b=g&&g.type||"",y=new e;if(a)for(var d=0,m=a.length;m>d;d++)Uint8Array&&a[d]instanceof Uint8Array?y.append(a[d].buffer):y.append(a[d]);var f=y.getBlob(b);return!f.slice&&f.webkitSlice&&(f.slice=f.webkitSlice),f},C.Blob.prototype=(Object.getPrototypeOf||function(a){return a.__proto__})(new C.Blob)}(typeof self<"u"&&self||typeof window<"u"&&window||this.content||this),function(C,e){"use strict";typeof process<"u"&&process&&process.versions&&process.versions.electron?void 0!==(E=function(){return e}.call(wn,v,wn,qi))&&(qi.exports=E):qi.exports=e}(0,function(){"use strict";function C(e,h){return this.init(e,h)}return C.extensions={},function(e){function h(d,m){var f,k=Array.prototype.slice.call(arguments,2);m=m||{};for(var u=0;u<k.length;u++){var F=k[u];if(F)for(f in F)F.hasOwnProperty(f)&&typeof F[f]<"u"&&(d||!1===m.hasOwnProperty(f))&&(m[f]=F[f])}return m}var a=!1;try{var g=document.createElement("div"),b=document.createTextNode(" ");g.appendChild(b),a=g.contains(b)}catch{}var y={isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),isEdge:null!==/Edge\/\d+/.exec(navigator.userAgent),isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:e.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(d){return!!(y.isMac&&d.metaKey||!y.isMac&&d.ctrlKey)},isKey:function(d,m){var f=y.getKeyCode(d);return!1===Array.isArray(m)?f===m:-1!==m.indexOf(f)},getKeyCode:function(d){var m=d.which;return null===m&&(m=null!==d.charCode?d.charCode:d.keyCode),m},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var d=[!0].concat(Array.prototype.slice.call(arguments));return h.apply(this,d)},defaults:function(){var d=[!1].concat(Array.prototype.slice.call(arguments));return h.apply(this,d)},createLink:function(d,m,f,k){var u=d.createElement("a");return y.moveTextRangeIntoElement(m[0],m[m.length-1],u),u.setAttribute("href",f),k&&("_blank"===k&&u.setAttribute("rel","noopener noreferrer"),u.setAttribute("target",k)),u},findOrCreateMatchingTextNodes:function(d,m,f){for(var k=d.createTreeWalker(m,NodeFilter.SHOW_ALL,null,!1),u=[],F=0,w=!1,N=null,G=null;null!==(N=k.nextNode());)if(!(N.nodeType>3))if(3===N.nodeType){if(!w&&f.start<F+N.nodeValue.length&&(w=!0,G=y.splitStartNodeIfNeeded(N,f.start,F)),w&&y.splitEndNodeIfNeeded(N,G,f.end,F),w&&F===f.end)break;if(w&&F>f.end+1)throw new Error("PerformLinking overshot the target!");w&&u.push(G||N),F+=N.nodeValue.length,null!==G&&(F+=G.nodeValue.length,k.nextNode()),G=null}else"img"===N.tagName.toLowerCase()&&(!w&&f.start<=F&&(w=!0),w&&u.push(N));return u},splitStartNodeIfNeeded:function(d,m,f){return m!==f?d.splitText(m-f):null},splitEndNodeIfNeeded:function(d,m,f,k){var u,F;F=f-k-(m?d.nodeValue.length:0),(u=k+d.nodeValue.length+(m?m.nodeValue.length:0)-1)>=f&&k!==u&&0!==F&&(m||d).splitText(F)},splitByBlockElements:function(d){if(3!==d.nodeType&&1!==d.nodeType)return[];var m=[],f=C.util.blockContainerElementNames.join(",");if(3===d.nodeType||0===d.querySelectorAll(f).length)return[d];for(var k=0;k<d.childNodes.length;k++){var u=d.childNodes[k];3===u.nodeType?m.push(u):1===u.nodeType&&(0===u.querySelectorAll(f).length?m.push(u):m=m.concat(C.util.splitByBlockElements(u)))}return m},findAdjacentTextNodeWithContent:function(d,m,f){var k,u=!1,F=f.createNodeIterator(d,NodeFilter.SHOW_TEXT,null,!1);for(k=F.nextNode();k;){if(k===m)u=!0;else if(u&&3===k.nodeType&&k.nodeValue&&k.nodeValue.trim().length>0)break;k=F.nextNode()}return k},findPreviousSibling:function(d){if(!d||y.isMediumEditorElement(d))return!1;for(var m=d.previousSibling;!m&&!y.isMediumEditorElement(d.parentNode);)m=(d=d.parentNode).previousSibling;return m},isDescendant:function(d,m,f){if(!d||!m)return!1;if(d===m)return!!f;if(1!==d.nodeType)return!1;if(a||3!==m.nodeType)return d.contains(m);for(var k=m.parentNode;null!==k;){if(k===d)return!0;k=k.parentNode}return!1},isElement:function(d){return!(!d||1!==d.nodeType)},throttle:function(d,m){var f,k,u,w=null,N=0,G=function(){N=Date.now(),w=null,u=d.apply(f,k),w||(f=k=null)};return m||0===m||(m=50),function(){var D=Date.now(),q=m-(D-N);return f=this,k=arguments,0>=q||q>m?(w&&(clearTimeout(w),w=null),N=D,u=d.apply(f,k),w||(f=k=null)):w||(w=setTimeout(G,q)),u}},traverseUp:function(d,m){if(!d)return!1;do{if(1===d.nodeType){if(m(d))return d;if(y.isMediumEditorElement(d))return!1}d=d.parentNode}while(d);return!1},htmlEntities:function(d){return String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(d,m){var f,k,u,F,N,G,D=!1,q=["insertHTML",!1,m];if(!C.util.isEdge&&d.queryCommandSupported("insertHTML"))try{return d.execCommand.apply(d,q)}catch{}if((f=d.getSelection()).rangeCount){if(k=f.getRangeAt(0),y.isMediumEditorElement(G=k.commonAncestorContainer)&&!G.firstChild)k.selectNode(G.appendChild(d.createTextNode("")));else if(3===G.nodeType&&0===k.startOffset&&k.endOffset===G.nodeValue.length||3!==G.nodeType&&G.innerHTML===k.toString()){for(;!y.isMediumEditorElement(G)&&G.parentNode&&1===G.parentNode.childNodes.length&&!y.isMediumEditorElement(G.parentNode);)G=G.parentNode;k.selectNode(G)}for(k.deleteContents(),(u=d.createElement("div")).innerHTML=m,F=d.createDocumentFragment();u.firstChild;)N=F.appendChild(u.firstChild);k.insertNode(F),N&&((k=k.cloneRange()).setStartAfter(N),k.collapse(!0),C.selection.selectRange(d,k)),D=!0}return d.execCommand.callListeners&&d.execCommand.callListeners(q,D),D},execFormatBlock:function(d,m){var k=y.getTopBlockContainer(C.selection.getSelectionStart(d));if("blockquote"===m){if(k&&Array.prototype.slice.call(k.childNodes).some(function(u){return y.isBlockContainer(u)}))return d.execCommand("outdent",!1,null);if(y.isIE)return d.execCommand("indent",!1,m)}if(k&&m===k.nodeName.toLowerCase()&&(m="p"),y.isIE&&(m="<"+m+">"),k&&"blockquote"===k.nodeName.toLowerCase()){if(y.isIE&&"<p>"===m)return d.execCommand("outdent",!1,m);if((y.isFF||y.isEdge)&&"p"===m)return Array.prototype.slice.call(k.childNodes).some(function(u){return!y.isBlockContainer(u)})&&d.execCommand("formatBlock",!1,m),d.execCommand("outdent",!1,m)}return d.execCommand("formatBlock",!1,m)},setTargetBlank:function(d,m){var f,k=m||!1;if("a"===d.nodeName.toLowerCase())d.target="_blank",d.rel="noopener noreferrer";else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)!1!==k&&k!==d[f].attributes.href.value||(d[f].target="_blank",d[f].rel="noopener noreferrer")},removeTargetBlank:function(d,m){var f;if("a"===d.nodeName.toLowerCase())d.removeAttribute("target"),d.removeAttribute("rel");else for(d=d.getElementsByTagName("a"),f=0;f<d.length;f+=1)m===d[f].attributes.href.value&&(d[f].removeAttribute("target"),d[f].removeAttribute("rel"))},addClassToAnchors:function(d,m){var f,k,u=m.split(" ");if("a"===d.nodeName.toLowerCase())for(k=0;k<u.length;k+=1)d.classList.add(u[k]);else{var F=d.getElementsByTagName("a");if(0===F.length){var w=y.getClosestTag(d,"a");d=w?[w]:[]}else d=F;for(f=0;f<d.length;f+=1)for(k=0;k<u.length;k+=1)d[f].classList.add(u[k])}},isListItem:function(d){if(!d)return!1;if("li"===d.nodeName.toLowerCase())return!0;for(var m=d.parentNode,f=m.nodeName.toLowerCase();"li"===f||!y.isBlockContainer(m)&&"div"!==f;){if("li"===f)return!0;if(!(m=m.parentNode))return!1;f=m.nodeName.toLowerCase()}return!1},cleanListDOM:function(d,m){if("li"===m.nodeName.toLowerCase()){var f=m.parentElement;"p"===f.parentElement.nodeName.toLowerCase()&&(y.unwrap(f.parentElement,d),C.selection.moveCursor(d,m.firstChild,m.firstChild.textContent.length))}},splitOffDOMTree:function(d,m,f){for(var k=m,u=null,F=!f;k!==d;){var w,N=k.parentNode,G=N.cloneNode(!1),D=F?k:N.firstChild;for(u&&(F?G.appendChild(u):w=u),u=G;D;){var q=D.nextSibling;D===k?(D.hasChildNodes()?D=D.cloneNode(!1):D.parentNode.removeChild(D),D.textContent&&u.appendChild(D),D=F?q:null):(D.parentNode.removeChild(D),(D.hasChildNodes()||D.textContent)&&u.appendChild(D),D=q)}w&&u.appendChild(w),k=N}return u},moveTextRangeIntoElement:function(d,m,f){if(!d||!m)return!1;var k=y.findCommonRoot(d,m);if(!k)return!1;if(m===d){var u=d.parentNode,F=d.nextSibling;return u.removeChild(d),f.appendChild(d),F?u.insertBefore(f,F):u.appendChild(f),f.hasChildNodes()}for(var w,N,G,D=[],q=0;q<k.childNodes.length;q++)if(G=k.childNodes[q],w){if(y.isDescendant(G,m,!0)){N=G;break}D.push(G)}else y.isDescendant(G,d,!0)&&(w=G);var le=N.nextSibling,Re=k.ownerDocument.createDocumentFragment();return w===d?(w.parentNode.removeChild(w),Re.appendChild(w)):Re.appendChild(y.splitOffDOMTree(w,d)),D.forEach(function(Je){Je.parentNode.removeChild(Je),Re.appendChild(Je)}),N===m?(N.parentNode.removeChild(N),Re.appendChild(N)):Re.appendChild(y.splitOffDOMTree(N,m,!0)),f.appendChild(Re),N.parentNode===k?k.insertBefore(f,N):le?k.insertBefore(f,le):k.appendChild(f),f.hasChildNodes()},depthOfNode:function(d){for(var m=0,f=d;null!==f.parentNode;)f=f.parentNode,m++;return m},findCommonRoot:function(d,m){for(var f=y.depthOfNode(d),k=y.depthOfNode(m),u=d,F=m;f!==k;)f>k?(u=u.parentNode,f-=1):(F=F.parentNode,k-=1);for(;u!==F;)u=u.parentNode,F=F.parentNode;return u},isElementAtBeginningOfBlock:function(d){for(var f;!y.isBlockContainer(d)&&!y.isMediumEditorElement(d);){for(f=d;f=f.previousSibling;)if((3===f.nodeType?f.nodeValue:f.textContent).length>0)return!1;d=d.parentNode}return!0},isMediumEditorElement:function(d){return d&&d.getAttribute&&!!d.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(d){return y.traverseUp(d,function(m){return y.isMediumEditorElement(m)})},isBlockContainer:function(d){return d&&3!==d.nodeType&&-1!==y.blockContainerElementNames.indexOf(d.nodeName.toLowerCase())},getClosestBlockContainer:function(d){return y.traverseUp(d,function(m){return y.isBlockContainer(m)||y.isMediumEditorElement(m)})},getTopBlockContainer:function(d){var m=!!y.isBlockContainer(d)&&d;return y.traverseUp(d,function(f){return y.isBlockContainer(f)&&(m=f),!(m||!y.isMediumEditorElement(f)||(m=f,0))}),m},getFirstSelectableLeafNode:function(d){for(;d&&d.firstChild;)d=d.firstChild;if("table"===(d=y.traverseUp(d,function(f){return-1===y.emptyElementNames.indexOf(f.nodeName.toLowerCase())})).nodeName.toLowerCase()){var m=d.querySelector("th, td");m&&(d=m)}return d},getFirstTextNode:function(d){return y.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),y._getFirstTextNode(d)},_getFirstTextNode:function(d){if(3===d.nodeType)return d;for(var m=0;m<d.childNodes.length;m++){var f=y._getFirstTextNode(d.childNodes[m]);if(null!==f)return f}return null},ensureUrlHasProtocol:function(d){return-1===d.indexOf("://")?"http://"+d:d},warn:function(){void 0!==e.console&&"function"==typeof e.console.warn&&e.console.warn.apply(e.console,arguments)},deprecated:function(d,m,f){var k=d+" is deprecated, please use "+m+" instead.";f&&(k+=" Will be removed in "+f),y.warn(k)},deprecatedMethod:function(d,m,f,k){y.deprecated(d,m,k),"function"==typeof this[m]&&this[m].apply(this,f)},cleanupAttrs:function(d,m){m.forEach(function(f){d.removeAttribute(f)})},cleanupTags:function(d,m){-1!==m.indexOf(d.nodeName.toLowerCase())&&d.parentNode.removeChild(d)},unwrapTags:function(d,m){-1!==m.indexOf(d.nodeName.toLowerCase())&&C.util.unwrap(d,document)},getClosestTag:function(d,m){return y.traverseUp(d,function(f){return f.nodeName.toLowerCase()===m.toLowerCase()})},unwrap:function(d,m){for(var f=m.createDocumentFragment(),k=Array.prototype.slice.call(d.childNodes),u=0;u<k.length;u++)f.appendChild(k[u]);f.childNodes.length?d.parentNode.replaceChild(f,d):d.parentNode.removeChild(d)},guid:function(){function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}};C.util=y}(window),(e=function(h){C.util.extend(this,h)}).extend=function(h){var a,g=this;a=h&&h.hasOwnProperty("constructor")?h.constructor:function(){return g.apply(this,arguments)},C.util.extend(a,g);var b=function(){this.constructor=a};return b.prototype=g.prototype,a.prototype=new b,h&&C.util.extend(a.prototype,h),a},e.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(h){return this.base.options[h]}},["execAction","on","off","subscribe","trigger"].forEach(function(h){e.prototype[h]=function(){return this.base[h].apply(this.base,arguments)}}),C.Extension=e,function(){function e(a){return C.util.isBlockContainer(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var h={findMatchingSelectionParent:function(a,g){var b,d=g.getSelection();return 0!==d.rangeCount&&(b=d.getRangeAt(0),C.util.traverseUp(b.commonAncestorContainer,a))},getSelectionElement:function(a){return this.findMatchingSelectionParent(function(g){return C.util.isMediumEditorElement(g)},a)},exportSelection:function(a,g){if(!a)return null;var b=null,y=g.getSelection();if(y.rangeCount>0){var d,m=y.getRangeAt(0),f=m.cloneRange();f.selectNodeContents(a),f.setEnd(m.startContainer,m.startOffset),b={start:d=f.toString().length,end:d+m.toString().length},this.doesRangeStartWithImages(m,g)&&(b.startsWithImage=!0);var k=this.getTrailingImageCount(a,b,m.endContainer,m.endOffset);if(k&&(b.trailingImageCount=k),0!==d){var u=this.getIndexRelativeToAdjacentEmptyBlocks(g,a,m.startContainer,m.startOffset);-1!==u&&(b.emptyBlocksIndex=u)}}return b},importSelection:function(a,g,b,y){if(a&&g){var d=b.createRange();d.setStart(g,0),d.collapse(!0);var m,f=g,k=[],u=0,F=!1,w=!1,N=0,G=!1,D=!1,q=null;for((y||a.startsWithImage||typeof a.emptyBlocksIndex<"u")&&(D=!0);!G&&f;)if(f.nodeType>3)f=k.pop();else{if(3!==f.nodeType||w){if(a.trailingImageCount&&w&&("img"===f.nodeName.toLowerCase()&&N++,N===a.trailingImageCount)){for(var le=0;f.parentNode.childNodes[le]!==f;)le++;d.setEnd(f.parentNode,le+1),G=!0}if(!G&&1===f.nodeType)for(var Re=f.childNodes.length-1;Re>=0;)k.push(f.childNodes[Re]),Re-=1}else m=u+f.length,!F&&a.start>=u&&a.start<=m&&(D||a.start<m?(d.setStart(f,a.start-u),F=!0):q=f),F&&a.end>=u&&a.end<=m&&(a.trailingImageCount?w=!0:(d.setEnd(f,a.end-u),G=!0)),u=m;G||(f=k.pop())}!F&&q&&(d.setStart(q,q.length),d.setEnd(q,q.length)),typeof a.emptyBlocksIndex<"u"&&(d=this.importSelectionMoveCursorPastBlocks(b,g,a.emptyBlocksIndex,d)),y&&(d=this.importSelectionMoveCursorPastAnchor(a,d)),this.selectRange(b,d)}},importSelectionMoveCursorPastAnchor:function(a,g){if(a.start===a.end&&3===g.startContainer.nodeType&&g.startOffset===g.startContainer.nodeValue.length&&C.util.traverseUp(g.startContainer,function(k){return"a"===k.nodeName.toLowerCase()})){for(var y=g.startContainer,d=g.startContainer.parentNode;null!==d&&"a"!==d.nodeName.toLowerCase();)d.childNodes[d.childNodes.length-1]!==y?d=null:(y=d,d=d.parentNode);if(null!==d&&"a"===d.nodeName.toLowerCase()){for(var m=null,f=0;null===m&&f<d.parentNode.childNodes.length;f++)d.parentNode.childNodes[f]===d&&(m=f);g.setStart(d.parentNode,m+1),g.collapse(!0)}}return g},importSelectionMoveCursorPastBlocks:function(a,g,b,y){var d,m,f=a.createTreeWalker(g,NodeFilter.SHOW_ELEMENT,e,!1),k=y.startContainer,u=0;for(b=b||1,d=3===k.nodeType&&C.util.isBlockContainer(k.previousSibling)?k.previousSibling:C.util.getClosestBlockContainer(k);f.nextNode();)if(m){if(m=f.currentNode,++u===b||m.textContent.length>0)break}else d===f.currentNode&&(m=f.currentNode);return m||(m=d),y.setStart(C.util.getFirstSelectableLeafNode(m),0),y},getIndexRelativeToAdjacentEmptyBlocks:function(a,g,b,y){if(b.textContent.length>0&&y>0)return-1;var d=b;if(3!==d.nodeType&&(d=b.childNodes[y]),d){if(!C.util.isElementAtBeginningOfBlock(d))return-1;var m=C.util.findPreviousSibling(d);if(!m||m.nodeValue)return-1}for(var f=C.util.getClosestBlockContainer(b),k=a.createTreeWalker(g,NodeFilter.SHOW_ELEMENT,e,!1),u=0;k.nextNode();){var F=""===k.currentNode.textContent;if((F||u>0)&&(u+=1),k.currentNode===f)return u;F||(u=0)}return u},doesRangeStartWithImages:function(a,g){if(0!==a.startOffset||1!==a.startContainer.nodeType)return!1;if("img"===a.startContainer.nodeName.toLowerCase())return!0;var b=a.startContainer.querySelector("img");if(!b)return!1;for(var y=g.createTreeWalker(a.startContainer,NodeFilter.SHOW_ALL,null,!1);y.nextNode();){var d=y.currentNode;if(d===b)break;if(d.nodeValue)return!1}return!0},getTrailingImageCount:function(a,g,b,y){if(0===y||1!==b.nodeType||"img"!==b.nodeName.toLowerCase()&&!b.querySelector("img"))return 0;for(var d=b.childNodes[y-1];d.hasChildNodes();)d=d.lastChild;for(var m,f=a,k=[],u=0,F=!1,w=!1,N=!1,G=0;!N&&f;)if(f.nodeType>3)f=k.pop();else{if(3!==f.nodeType||w){if("img"===f.nodeName.toLowerCase()&&G++,f===d)N=!0;else if(1===f.nodeType)for(var D=f.childNodes.length-1;D>=0;)k.push(f.childNodes[D]),D-=1}else G=0,m=u+f.length,!F&&g.start>=u&&g.start<=m&&(F=!0),F&&g.end>=u&&g.end<=m&&(w=!0),u=m;N||(f=k.pop())}return G},selectionContainsContent:function(a){var g=a.getSelection();if(!g||g.isCollapsed||!g.rangeCount)return!1;if(""!==g.toString().trim())return!0;var b=this.getSelectedParentElement(g.getRangeAt(0));return!(!b||!("img"===b.nodeName.toLowerCase()||1===b.nodeType&&b.querySelector("img")))},selectionInContentEditableFalse:function(a){var g,b=this.findMatchingSelectionParent(function(y){var d=y&&y.getAttribute("contenteditable");return"true"===d&&(g=!0),"#text"!==y.nodeName&&"false"===d},a);return!g&&b},getSelectionHtml:function(a){var g,b,y,d="",m=a.getSelection();if(m.rangeCount){for(y=a.createElement("div"),g=0,b=m.rangeCount;b>g;g+=1)y.appendChild(m.getRangeAt(g).cloneContents());d=y.innerHTML}return d},getCaretOffsets:function(a,g){var b,y;return g||(g=window.getSelection().getRangeAt(0)),b=g.cloneRange(),y=g.cloneRange(),b.selectNodeContents(a),b.setEnd(g.endContainer,g.endOffset),y.selectNodeContents(a),y.setStart(g.endContainer,g.endOffset),{left:b.toString().length,right:y.toString().length}},rangeSelectsSingleNode:function(a){var g=a.startContainer;return g===a.endContainer&&g.hasChildNodes()&&a.endOffset===a.startOffset+1},getSelectedParentElement:function(a){return a?this.rangeSelectsSingleNode(a)&&3!==a.startContainer.childNodes[a.startOffset].nodeType?a.startContainer.childNodes[a.startOffset]:3===a.startContainer.nodeType?a.startContainer.parentNode:a.startContainer:null},getSelectedElements:function(a){var g,b,y,d=a.getSelection();if(!d.rangeCount||d.isCollapsed||!d.getRangeAt(0).commonAncestorContainer)return[];if(3===(g=d.getRangeAt(0)).commonAncestorContainer.nodeType){for(b=[],y=g.commonAncestorContainer;y.parentNode&&1===y.parentNode.childNodes.length;)b.push(y.parentNode),y=y.parentNode;return b}return[].filter.call(g.commonAncestorContainer.getElementsByTagName("*"),function(m){return"function"!=typeof d.containsNode||d.containsNode(m,!0)})},selectNode:function(a,g){var b=g.createRange();b.selectNodeContents(a),this.selectRange(g,b)},select:function(a,g,b,y,d){var m=a.createRange();return m.setStart(g,b),y?m.setEnd(y,d):m.collapse(!0),this.selectRange(a,m),m},clearSelection:function(a,g){g?a.getSelection().collapseToStart():a.getSelection().collapseToEnd()},moveCursor:function(a,g,b){this.select(a,g,b)},getSelectionRange:function(a){var g=a.getSelection();return 0===g.rangeCount?null:g.getRangeAt(0)},selectRange:function(a,g){var b=a.getSelection();b.removeAllRanges(),b.addRange(g)},getSelectionStart:function(a){var g=a.getSelection().anchorNode;return g&&3===g.nodeType?g.parentNode:g}};C.selection=h}(),function(){function e(a,g){return!!a&&a.some(function(b){if("function"!=typeof b.getInteractionElements)return!1;var y=b.getInteractionElements();return!!y&&(Array.isArray(y)||(y=[y]),y.some(function(d){return C.util.isDescendant(d,g,!0)}))})}var h=function(a){this.base=a,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};h.prototype={InputEventOnContenteditableSupported:!C.util.isIE&&!C.util.isEdge,attachDOMEvent:function(a,g,b,y){var d=this.base.options.contentWindow,m=this.base.options.ownerDocument;a=C.util.isElement(a)||[d,m].indexOf(a)>-1?[a]:a,Array.prototype.forEach.call(a,function(f){f.addEventListener(g,b,y),this.events.push([f,g,b,y])}.bind(this))},detachDOMEvent:function(a,g,b,y){var d,m,f=this.base.options.contentWindow,k=this.base.options.ownerDocument;a&&(a=C.util.isElement(a)||[f,k].indexOf(a)>-1?[a]:a,Array.prototype.forEach.call(a,function(u){-1!==(d=this.indexOfListener(u,g,b,y))&&(m=this.events.splice(d,1)[0])[0].removeEventListener(m[1],m[2],m[3])}.bind(this)))},indexOfListener:function(a,g,b,y){var d,m,f;for(d=0,m=this.events.length;m>d;d+=1)if((f=this.events[d])[0]===a&&f[1]===g&&f[2]===b&&f[3]===y)return d;return-1},detachAllDOMEvents:function(){for(var a=this.events.pop();a;)a[0].removeEventListener(a[1],a[2],a[3]),a=this.events.pop()},detachAllEventsFromElement:function(a){for(var g=this.events.filter(function(m){return m&&m[0].getAttribute&&m[0].getAttribute("medium-editor-index")===a.getAttribute("medium-editor-index")}),b=0,y=g.length;y>b;b++){var d=g[b];this.detachDOMEvent(d[0],d[1],d[2],d[3])}},attachAllEventsToElement:function(a){this.listeners.editableInput&&(this.contentCache[a.getAttribute("medium-editor-index")]=a.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(g){this.attachDOMEvent(a,g.name,g.handler.bind(this))},this)},enableCustomEvent:function(a){void 0!==this.disabledEvents[a]&&delete this.disabledEvents[a]},disableCustomEvent:function(a){this.disabledEvents[a]=!0},attachCustomEvent:function(a,g){this.setupListener(a),this.customEvents[a]||(this.customEvents[a]=[]),this.customEvents[a].push(g)},detachCustomEvent:function(a,g){var b=this.indexOfCustomListener(a,g);-1!==b&&this.customEvents[a].splice(b,1)},indexOfCustomListener:function(a,g){return this.customEvents[a]&&this.customEvents[a].length?this.customEvents[a].indexOf(g):-1},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(a,g,b){this.customEvents[a]&&!this.disabledEvents[a]&&this.customEvents[a].forEach(function(y){y(g,b)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(a){a.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=function(a){this.handleDocumentExecCommand(a)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var a=this.options.ownerDocument;if(this.execCommandListener&&a.execCommand.listeners){var g=a.execCommand.listeners.indexOf(this.execCommandListener);-1!==g&&a.execCommand.listeners.splice(g,1),a.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var a=this.options.ownerDocument;if(!a.execCommand.listeners){var g=function(y,d){a.execCommand.listeners&&a.execCommand.listeners.forEach(function(m){m({command:y[0],value:y[2],args:y,result:d})})},b=function(){var y=a.execCommand.orig.apply(this,arguments);if(!a.execCommand.listeners)return y;var d=Array.prototype.slice.call(arguments);return g(d,y),y};b.orig=a.execCommand,b.listeners=[],b.callListeners=g,a.execCommand=b}},unwrapExecCommand:function(){var a=this.options.ownerDocument;a.execCommand.orig&&(a.execCommand=a.execCommand.orig)},setupListener:function(a){if(!this.listeners[a]){switch(a){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(g){this.contentCache[g.getAttribute("medium-editor-index")]=g.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":case"editableKeydownEnter":case"editableKeydownTab":case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[a]=!0}},attachToEachElement:function(a,g){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(b){this.attachDOMEvent(b,a,g.bind(this))},this),this.eventsCache.push({name:a,handler:g})},cleanupElement:function(a){var g=a.getAttribute("medium-editor-index");g&&(this.detachAllEventsFromElement(a),this.contentCache&&delete this.contentCache[g])},focusElement:function(a){a.focus(),this.updateFocus(a,{target:a,type:"focus"})},updateFocus:function(a,g){var b,y=this.base.getFocusedElement();y&&"click"===g.type&&this.lastMousedownTarget&&(C.util.isDescendant(y,this.lastMousedownTarget,!0)||e(this.base.extensions,this.lastMousedownTarget))&&(b=y),b||this.base.elements.some(function(m){return!b&&C.util.isDescendant(m,a,!0)&&(b=m),!!b},this);var d=!C.util.isDescendant(y,a,!0)&&!e(this.base.extensions,a);b!==y&&(y&&d&&(y.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",g,y)),b&&(b.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",g,b))),d&&this.triggerCustomEvent("externalInteraction",g)},updateInput:function(a,g){if(this.contentCache){var b=a.getAttribute("medium-editor-index"),y=a.innerHTML;y!==this.contentCache[b]&&this.triggerCustomEvent("editableInput",g,a),this.contentCache[b]=y}},handleDocumentSelectionChange:function(a){if(a.currentTarget&&a.currentTarget.activeElement){var g,b=a.currentTarget.activeElement;this.base.elements.some(function(y){return!!C.util.isDescendant(y,b,!0)&&(g=y,!0)},this),g&&this.updateInput(g,{target:b,currentTarget:g})}},handleDocumentExecCommand:function(){var a=this.base.getFocusedElement();a&&this.updateInput(a,{target:a,currentTarget:a})},handleBodyClick:function(a){this.updateFocus(a.target,a)},handleBodyFocus:function(a){this.updateFocus(a.target,a)},handleBodyMousedown:function(a){this.lastMousedownTarget=a.target},handleInput:function(a){this.updateInput(a.currentTarget,a)},handleClick:function(a){this.triggerCustomEvent("editableClick",a,a.currentTarget)},handleBlur:function(a){this.triggerCustomEvent("editableBlur",a,a.currentTarget)},handleKeypress:function(a){if(this.triggerCustomEvent("editableKeypress",a,a.currentTarget),this.keypressUpdateInput){var g={target:a.target,currentTarget:a.currentTarget};setTimeout(function(){this.updateInput(g.currentTarget,g)}.bind(this),0)}},handleKeyup:function(a){this.triggerCustomEvent("editableKeyup",a,a.currentTarget)},handleMouseover:function(a){this.triggerCustomEvent("editableMouseover",a,a.currentTarget)},handleDragging:function(a){this.triggerCustomEvent("editableDrag",a,a.currentTarget)},handleDrop:function(a){this.triggerCustomEvent("editableDrop",a,a.currentTarget)},handlePaste:function(a){this.triggerCustomEvent("editablePaste",a,a.currentTarget)},handleKeydown:function(a){return this.triggerCustomEvent("editableKeydown",a,a.currentTarget),C.util.isKey(a,C.util.keyCode.SPACE)?this.triggerCustomEvent("editableKeydownSpace",a,a.currentTarget):C.util.isKey(a,C.util.keyCode.ENTER)||a.ctrlKey&&C.util.isKey(a,C.util.keyCode.M)?this.triggerCustomEvent("editableKeydownEnter",a,a.currentTarget):C.util.isKey(a,C.util.keyCode.TAB)?this.triggerCustomEvent("editableKeydownTab",a,a.currentTarget):C.util.isKey(a,[C.util.keyCode.DELETE,C.util.keyCode.BACKSPACE])?this.triggerCustomEvent("editableKeydownDelete",a,a.currentTarget):void 0}},C.Events=h}(),function(){var e=C.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(h){e.isBuiltInButton(h)?C.Extension.call(this,this.defaults[h]):C.Extension.call(this,h)},init:function(){C.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return"function"==typeof this.action?this.action(this.base.options):this.action},getAria:function(){return"function"==typeof this.aria?this.aria(this.base.options):this.aria},getTagNames:function(){return"function"==typeof this.tagNames?this.tagNames(this.base.options):this.tagNames},createButton:function(){var h=this.document.createElement("button"),a=this.contentDefault,g=this.getAria(),b=this.getEditorOption("buttonLabels");return h.classList.add("medium-editor-action"),h.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(y){h.classList.add(y)}),h.setAttribute("data-action",this.getAction()),g&&(h.setAttribute("title",g),h.setAttribute("aria-label",g)),this.attrs&&Object.keys(this.attrs).forEach(function(y){h.setAttribute(y,this.attrs[y])},this),"fontawesome"===b&&this.contentFA&&(a=this.contentFA),h.innerHTML=a,h},handleClick:function(h){h.preventDefault(),h.stopPropagation();var a=this.getAction();a&&this.execAction(a)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var h=null;return this.useQueryState&&(h=this.base.queryCommandState(this.getAction())),h},isAlreadyApplied:function(h){var a,g,b=!1,y=this.getTagNames();return!1===this.knownState||!0===this.knownState?this.knownState:(y&&y.length>0&&(b=-1!==y.indexOf(h.nodeName.toLowerCase())),!b&&this.style&&(a=this.style.value.split("|"),g=this.window.getComputedStyle(h,null).getPropertyValue(this.style.prop),a.forEach(function(d){this.knownState||((b=-1!==g.indexOf(d))||"text-decoration"!==this.style.prop)&&(this.knownState=b)},this)),b)}});e.isBuiltInButton=function(h){return"string"==typeof h&&C.extensions.button.prototype.defaults.hasOwnProperty(h)},C.extensions.button=e}(),C.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}},function(){var e=C.extensions.button.extend({init:function(){C.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return!!this.hasForm&&this.getForm().classList.contains(this.activeClass)},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var h=this.base.getExtensionByName("toolbar");h&&h.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var h=this.base.getExtensionByName("toolbar");h&&h.hideToolbarDefaultActions()},setToolbarPosition:function(){var h=this.base.getExtensionByName("toolbar");h&&h.setToolbarPosition()}});C.extensions.form=e}(),function(){var e=C.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){C.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(h){h.preventDefault(),h.stopPropagation();var a=C.selection.getSelectionRange(this.document);return"a"===a.startContainer.nodeName.toLowerCase()||"a"===a.endContainer.nodeName.toLowerCase()||C.util.getClosestTag(C.selection.getSelectedParentElement(a),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(h){C.util.isKey(h,C.util.keyCode.K)&&C.util.isMetaCtrlKey(h)&&!h.shiftKey&&this.handleClick(h)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var h=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return h.push('<a href="#" class="medium-editor-toolbar-save">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),h.push('<a href="#" class="medium-editor-toolbar-close">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&h.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&h.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),h.join("")},isDisplayed:function(){return C.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){C.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(h){var a=this.getInput(),g=this.getAnchorTargetCheckbox(),b=this.getAnchorButtonCheckbox();if("string"==typeof(h=h||{value:""})&&(h={value:h}),this.base.saveSelection(),this.hideToolbarDefaultActions(),C.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),a.value=h.value,a.focus(),g&&(g.checked="_blank"===h.target),b){var y=h.buttonClass?h.buttonClass.split(" "):[];b.checked=-1!==y.indexOf(this.customClassOption)}},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},getFormOpts:function(){var h=this.getAnchorTargetCheckbox(),a=this.getAnchorButtonCheckbox(),g={value:this.getInput().value.trim()};return this.linkValidation&&(g.value=this.checkLinkFormat(g.value)),g.target="_self",h&&h.checked&&(g.target="_blank"),a&&a.checked&&(g.buttonClass=this.customClassOption),g},doFormSave:function(){var h=this.getFormOpts();this.completeFormSave(h)},completeFormSave:function(h){this.base.restoreSelection(),this.execAction(this.action,h),this.base.checkSelection()},ensureEncodedUri:function(h){return h===decodeURI(h)?encodeURI(h):h},ensureEncodedUriComponent:function(h){return h===decodeURIComponent(h)?encodeURIComponent(h):h},ensureEncodedParam:function(h){var a=h.split("="),b=a[1];return a[0]+(void 0===b?"":"="+this.ensureEncodedUriComponent(b))},ensureEncodedQuery:function(h){return h.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(h){var g=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i.test(h),b="",d=h.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),m=d[1],f=d[2],k=d[3];if(/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/.test(h))return"tel:"+h;if(!g){var u=m.split("/")[0];(u.match(/.+(\.|:).+/)||"localhost"===u)&&(b="http://")}return b+this.ensureEncodedUri(m)+(void 0===f?"":"?"+this.ensureEncodedQuery(f))+(void 0===k?"":"#"+k)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(h){var a=h.querySelector(".medium-editor-toolbar-close"),g=h.querySelector(".medium-editor-toolbar-save"),b=h.querySelector(".medium-editor-toolbar-input");this.on(h,"click",this.handleFormClick.bind(this)),this.on(b,"keyup",this.handleTextboxKeyup.bind(this)),this.on(a,"click",this.handleCloseClick.bind(this)),this.on(g,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var a=this.document.createElement("div");return a.className="medium-editor-toolbar-form",a.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),a.innerHTML=this.getTemplate(),this.attachFormEvents(a),a},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(h){return h.keyCode===C.util.keyCode.ENTER?(h.preventDefault(),void this.doFormSave()):void(h.keyCode===C.util.keyCode.ESCAPE&&(h.preventDefault(),this.doFormCancel()))},handleFormClick:function(h){h.stopPropagation()},handleSaveClick:function(h){h.preventDefault(),this.doFormSave()},handleCloseClick:function(h){h.preventDefault(),this.doFormCancel()}});C.extensions.anchor=e}(),function(){var e=C.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var h=this.document.createElement("div");return h.id="medium-editor-anchor-preview-"+this.getEditorId(),h.className="medium-editor-anchor-preview",h.innerHTML=this.getTemplate(),this.on(h,"click",this.handleClick.bind(this)),h},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(h){return!(!this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&!h.getAttribute("data-disable-preview"))||(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=h.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=h.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=h,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(h){var a,g,b,y,d,m=this.window.innerWidth,f=this.anchorPreview.offsetHeight,k=(h=h||this.activeAnchor).getBoundingClientRect(),u=this.diffLeft,F=this.diffTop,w=this.getEditorOption("elementsContainer"),N=["absolute","fixed"].indexOf(window.getComputedStyle(w).getPropertyValue("position"))>-1,G={};a=this.anchorPreview.offsetWidth/2;var D=this.base.getExtensionByName("toolbar");D&&(u=D.diffLeft,F=D.diffTop),g=u-a,N?(y=w.getBoundingClientRect(),["top","left"].forEach(function(q){G[q]=k[q]-y[q]}),G.width=k.width,G.height=k.height,k=G,m=y.width,d=w.scrollTop):d=this.window.pageYOffset,b=k.left+k.width/2,d+=f+k.top+k.height-F-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(d)+"px",this.anchorPreview.style.right="initial",a>b?(this.anchorPreview.style.left=g+a+"px",this.anchorPreview.style.right="initial"):a>m-b?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=g+b+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(h){var a=this.base.getExtensionByName("anchor"),g=this.activeAnchor;a&&g&&(h.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(g){var b={value:g.attributes.href.value,target:g.getAttribute("target"),buttonClass:g.getAttribute("class")};a.showForm(b),g=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(h){var a=C.util.getClosestTag(h.target,"a");if(!1!==a){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(a.outerHTML)||/href=["']#\S+["']/.test(a.outerHTML)))return!0;var g=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&g&&g.isDisplayed&&g.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==a&&this.detachPreviewHandlers(),this.anchorToPreview=a,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))}},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(h){h.relatedTarget&&/anchor-preview/.test(h.relatedTarget.className)||(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;(new Date).getTime()-this.lastOver>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});C.extensions.anchorPreview=e}(),function(){function e(m){return!C.util.getClosestTag(m,"a")}var h,a,g,b,y;h=[" ","\t","\n","\r","\xa0","\u2000","\u2001","\u2002","\u2003","\u2028","\u2029"],g="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+(a="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw")+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?\xab\xbb\u201c\u201d\u2018\u2019])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+a+"))",b=new RegExp("^("+a+")$","i"),y=new RegExp(g,"gi");var d=C.Extension.extend({init:function(){C.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var m=0,f=0;f<this.window._mediumEditors.length;f++){var k=this.window._mediumEditors[f];null!==k&&void 0!==k.getExtensionByName("autoLink")&&m++}return 1===m},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(m,f){this.performLinking(f)},onKeypress:function(m){this.disableEventHandling||C.util.isKey(m,[C.util.keyCode.SPACE,C.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var f=this.base.exportSelection();this.performLinking(m.target)&&this.base.importSelection(f,!0)}catch(k){window.console&&window.console.error("Failed to perform linking",k),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(m){var f=C.util.splitByBlockElements(m),k=!1;0===f.length&&(f=[m]);for(var u=0;u<f.length;u++)k=this.removeObsoleteAutoLinkSpans(f[u])||k,k=this.performLinkingWithinElement(f[u])||k;return this.base.events.updateInput(m,{target:m,currentTarget:m}),k},removeObsoleteAutoLinkSpans:function(m){if(!m||3===m.nodeType)return!1;for(var f=m.querySelectorAll('span[data-auto-link="true"]'),k=!1,u=0;u<f.length;u++){var F=f[u].textContent;if(-1===F.indexOf("://")&&(F=C.util.ensureUrlHasProtocol(F)),f[u].getAttribute("data-href")!==F&&e(f[u])){k=!0;var w=F.replace(/\s+$/,"");if(f[u].getAttribute("data-href")===w){var G=C.util.splitOffDOMTree(f[u],this.splitTextBeforeEnd(f[u],F.length-w.length));f[u].parentNode.insertBefore(G,f[u].nextSibling)}else C.util.unwrap(f[u],this.document)}}return k},splitTextBeforeEnd:function(m,f){for(var k=this.document.createTreeWalker(m,NodeFilter.SHOW_TEXT,null,!1),u=!0;u;)u=null!==k.lastChild();for(var F,w,N;f>0&&null!==N;)(w=(F=k.currentNode).nodeValue).length>f?(N=F.splitText(w.length-f),f=0):(N=k.previousNode(),f-=w.length);return N},performLinkingWithinElement:function(m){for(var f=this.findLinkableText(m),u=0;u<f.length;u++){var F=C.util.findOrCreateMatchingTextNodes(this.document,m,f[u]);this.shouldNotLink(F)||this.createAutoLink(F,f[u].href)}return!1},shouldNotLink:function(m){for(var f=!1,k=0;k<m.length&&!1===f;k++)f=!!C.util.traverseUp(m[k],function(u){return"a"===u.nodeName.toLowerCase()||u.getAttribute&&"true"===u.getAttribute("data-auto-link")});return f},findLinkableText:function(m){for(var f=m.textContent,k=null,u=[];null!==(k=y.exec(f));){var w=k.index+k[0].length;!(0!==k.index&&-1===h.indexOf(f[k.index-1])||w!==f.length&&-1===h.indexOf(f[w]))&&(-1!==k[0].indexOf("/")||b.test(k[0].split(".").pop().split("?").shift()))&&u.push({href:k[0],start:k.index,end:w})}return u},createAutoLink:function(m,f){f=C.util.ensureUrlHasProtocol(f);var k=C.util.createLink(this.document,m,f,this.getEditorOption("targetBlank")?"_blank":null),u=this.document.createElement("span");for(u.setAttribute("data-auto-link","true"),u.setAttribute("data-href",f),k.insertBefore(u,k.firstChild);k.childNodes.length>1;)u.appendChild(k.childNodes[1])}});C.extensions.autoLink=d}(),function(){function e(g){var b=C.util.getContainerEditorElement(g);Array.prototype.slice.call(b.parentElement.querySelectorAll("."+h)).forEach(function(d){d.classList.remove(h)})}var h="medium-editor-dragover",a=C.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){C.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(g){g.preventDefault(),g.dataTransfer.dropEffect="copy";var b=g.target.classList?g.target:g.target.parentElement;e(b),"dragover"===g.type&&b.classList.add(h)},handleDrop:function(g){g.preventDefault(),g.stopPropagation(),this.base.selectElement(g.target);var b=this.base.exportSelection();b.start=b.end,this.base.importSelection(b),g.dataTransfer.files&&Array.prototype.slice.call(g.dataTransfer.files).forEach(function(y){this.isAllowedFile(y)&&y.type.match("image")&&this.insertImageFile(y)},this),e(g.target)},isAllowedFile:function(g){return this.allowedTypes.some(function(b){return!!g.type.match(b)})},insertImageFile:function(g){if("function"==typeof FileReader){var b=new FileReader;b.readAsDataURL(g),b.addEventListener("load",function(y){var d=this.document.createElement("img");d.src=y.target.result,C.util.insertHTMLCommand(this.document,d.outerHTML)}.bind(this))}}});C.extensions.fileDragging=a}(),function(){var e=C.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){C.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(h){var a=h.key.charCodeAt(0);this.keys[a]||(this.keys[a]=[]),this.keys[a].push(h)},this)},handleKeydown:function(h){var a=C.util.getKeyCode(h);if(this.keys[a]){var g=C.util.isMetaCtrlKey(h),b=!!h.shiftKey,y=!!h.altKey;this.keys[a].forEach(function(d){d.meta!==g||d.shift!==b||d.alt!==y&&void 0!==d.alt||(h.preventDefault(),h.stopPropagation(),"function"==typeof d.command?d.command.apply(this):!1!==d.command&&this.execAction(d.command))},this)}}});C.extensions.keyboardCommands=e}(),function(){var e=C.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){C.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(h){if(h.preventDefault(),h.stopPropagation(),!this.isDisplayed()){var a=this.document.queryCommandValue("fontName")+"";this.showForm(a)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(h){var a=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),a.value=h||"",a.focus()},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var h,a=this.document,g=a.createElement("div"),b=a.createElement("select"),y=a.createElement("a"),d=a.createElement("a");g.className="medium-editor-toolbar-form",g.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(g,"click",this.handleFormClick.bind(this));for(var m=0;m<this.fonts.length;m++)(h=a.createElement("option")).innerHTML=this.fonts[m],h.value=this.fonts[m],b.appendChild(h);return b.className="medium-editor-toolbar-select",g.appendChild(b),this.on(b,"change",this.handleFontChange.bind(this)),d.setAttribute("href","#"),d.className="medium-editor-toobar-save",d.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",g.appendChild(d),this.on(d,"click",this.handleSaveClick.bind(this),!0),y.setAttribute("href","#"),y.className="medium-editor-toobar-close",y.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",g.appendChild(y),this.on(y,"click",this.handleCloseClick.bind(this)),g},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){C.selection.getSelectedElements(this.document).forEach(function(h){"font"===h.nodeName.toLowerCase()&&h.hasAttribute("face")&&h.removeAttribute("face")})},handleFontChange:function(){var h=this.getSelect().value;""===h?this.clearFontName():this.execAction("fontName",{value:h})},handleFormClick:function(h){h.stopPropagation()},handleSaveClick:function(h){h.preventDefault(),this.doFormSave()},handleCloseClick:function(h){h.preventDefault(),this.doFormCancel()}});C.extensions.fontName=e}(),function(){var e=C.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){C.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(h){if(h.preventDefault(),h.stopPropagation(),!this.isDisplayed()){var a=this.document.queryCommandValue("fontSize")+"";this.showForm(a)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(h){var a=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),a.value=h||"",a.focus()},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var h=this.document,a=h.createElement("div"),g=h.createElement("input"),b=h.createElement("a"),y=h.createElement("a");return a.className="medium-editor-toolbar-form",a.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(a,"click",this.handleFormClick.bind(this)),g.setAttribute("type","range"),g.setAttribute("min","1"),g.setAttribute("max","7"),g.className="medium-editor-toolbar-input",a.appendChild(g),this.on(g,"change",this.handleSliderChange.bind(this)),y.setAttribute("href","#"),y.className="medium-editor-toobar-save",y.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",a.appendChild(y),this.on(y,"click",this.handleSaveClick.bind(this),!0),b.setAttribute("href","#"),b.className="medium-editor-toobar-close",b.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",a.appendChild(b),this.on(b,"click",this.handleCloseClick.bind(this)),a},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){C.selection.getSelectedElements(this.document).forEach(function(h){"font"===h.nodeName.toLowerCase()&&h.hasAttribute("size")&&h.removeAttribute("size")})},handleSliderChange:function(){var h=this.getInput().value;"4"===h?this.clearFontSize():this.execAction("fontSize",{value:h})},handleFormClick:function(h){h.stopPropagation()},handleSaveClick:function(h){h.preventDefault(),this.doFormSave()},handleCloseClick:function(h){h.preventDefault(),this.doFormCancel()}});C.extensions.fontSize=e}(),function(){function h(m,f,k){var u=m.clipboardData||f.clipboardData||k.dataTransfer,F={};if(!u)return F;if(u.getData){var w=u.getData("Text");w&&w.length>0&&(F["text/plain"]=w)}if(u.types)for(var N=0;N<u.types.length;N++){var G=u.types[N];F[G]=u.getData(G)}return F}var a="%ME_PASTEBIN%",g=null,b=null,y=function(m){m.stopPropagation()},d=C.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){C.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(m){this.on(m,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(m,f){this.on(f,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(m,f){if(!m.defaultPrevented){var k=h(m,this.window,this.document),u=k["text/html"],F=k["text/plain"];this.window.clipboardData&&void 0===m.clipboardData&&!u&&(u=F),(u||F)&&(m.preventDefault(),this.doPaste(u,F,f))}},doPaste:function(m,f,k){var u,F,w="";if(this.cleanPastedHTML&&m)return this.cleanPaste(m);if(f){if(this.getEditorOption("disableReturn")||k&&k.getAttribute("data-disable-return"))w=C.util.htmlEntities(f);else if((u=f.split(/[\r\n]+/g)).length>1)for(F=0;F<u.length;F+=1)""!==u[F]&&(w+="<p>"+C.util.htmlEntities(u[F])+"</p>");else w=C.util.htmlEntities(u[0]);C.util.insertHTMLCommand(this.document,w)}},handlePasteBinPaste:function(m){if(!m.defaultPrevented){var f=h(m,this.window,this.document),k=f["text/html"],u=f["text/plain"],F=b;return!this.cleanPastedHTML||k?(m.preventDefault(),this.removePasteBin(),this.doPaste(k,u,F),void this.trigger("editablePaste",{currentTarget:F,target:F},F)):void setTimeout(function(){this.cleanPastedHTML&&(k=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(k,u,F),this.trigger("editablePaste",{currentTarget:F,target:F},F)}.bind(this),0)}this.removePasteBin()},handleKeydown:function(m,f){C.util.isKey(m,C.util.keyCode.V)&&C.util.isMetaCtrlKey(m)&&(m.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(f))},createPasteBin:function(m){var f,k=C.selection.getSelectionRange(this.document),u=this.window.pageYOffset;b=m,k&&(u+=(f=k.getClientRects()).length?f[0].top:void 0!==k.startContainer.getBoundingClientRect?k.startContainer.getBoundingClientRect().top:k.getBoundingClientRect().top),g=k;var F=this.document.createElement("div");F.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),F.setAttribute("style","border: 1px red solid; position: absolute; top: "+u+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),F.setAttribute("contentEditable",!0),F.innerHTML=a,this.document.body.appendChild(F),this.on(F,"focus",y),this.on(F,"focusin",y),this.on(F,"focusout",y),F.focus(),C.selection.selectNode(F,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(F,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==g&&(C.selection.selectRange(this.document,g),g=null),null!==b&&(b=null);var m=this.getPasteBin();m&&m&&(this.off(m,"focus",y),this.off(m,"focusin",y),this.off(m,"focusout",y),this.off(m,"paste",this.boundHandlePaste),m.parentElement.removeChild(m))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var m=this.getPasteBin();if(!m||m.firstChild&&"mcepastebin"===m.firstChild.id)return!1;var f=m.innerHTML;return!(!f||f===a)&&f},cleanPaste:function(m){var f,k,u,F,w=/<p|<br|<div/.test(m),N=[].concat(this.preCleanReplacements||[],function e(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d)(((?!&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d).)*)(?:&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}(),this.cleanReplacements||[]);for(f=0;f<N.length;f+=1)m=m.replace(N[f][0],N[f][1]);if(!w)return this.pasteHTML(m);for((u=this.document.createElement("div")).innerHTML="<p>"+m.split("<br><br>").join("</p><p>")+"</p>",k=u.querySelectorAll("a,p,div,br"),f=0;f<k.length;f+=1)switch(F=k[f],F.innerHTML=F.innerHTML.replace(/\n/gi," "),F.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(F);break;case"br":this.filterLineBreak(F)}this.pasteHTML(u.innerHTML)},pasteHTML:function(m,f){f=C.util.defaults({},f,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var k,u,F,w,N=this.document.createDocumentFragment();for(N.appendChild(this.document.createElement("body")),(w=N.querySelector("body")).innerHTML=m,this.cleanupSpans(w),k=w.querySelectorAll("*"),F=0;F<k.length;F+=1)"a"===(u=k[F]).nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&C.util.setTargetBlank(u),C.util.cleanupAttrs(u,f.cleanAttrs),C.util.cleanupTags(u,f.cleanTags),C.util.unwrapTags(u,f.unwrapTags);C.util.insertHTMLCommand(this.document,w.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(m){return m&&("p"===m.nodeName.toLowerCase()||"div"===m.nodeName.toLowerCase())},filterCommonBlocks:function(m){/^\s*$/.test(m.textContent)&&m.parentNode&&m.parentNode.removeChild(m)},filterLineBreak:function(m){this.isCommonBlock(m.previousElementSibling)?this.removeWithParent(m):!this.isCommonBlock(m.parentNode)||m.parentNode.firstChild!==m&&m.parentNode.lastChild!==m?m.parentNode&&1===m.parentNode.childElementCount&&""===m.parentNode.textContent&&this.removeWithParent(m):this.removeWithParent(m)},removeWithParent:function(m){m&&m.parentNode&&(m.parentNode.parentNode&&1===m.parentNode.childElementCount?m.parentNode.parentNode.removeChild(m.parentNode):m.parentNode.removeChild(m))},cleanupSpans:function(m){var f,k,u,F=m.querySelectorAll(".replace-with"),w=function(N){return N&&"#text"!==N.nodeName&&"false"===N.getAttribute("contenteditable")};for(f=0;f<F.length;f+=1)(u=this.document.createElement((k=F[f]).classList.contains("bold")?"b":"i")).innerHTML=k.classList.contains("bold")&&k.classList.contains("italic")?"<i>"+k.innerHTML+"</i>":k.innerHTML,k.parentNode.replaceChild(u,k);for(F=m.querySelectorAll("span"),f=0;f<F.length;f+=1){if(C.util.traverseUp(k=F[f],w))return!1;C.util.unwrap(k,this.document)}}});C.extensions.paste=d}(),function(){var e=C.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){C.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(h,a){this.initElement(a)},initElement:function(h){h.getAttribute("data-placeholder")||h.setAttribute("data-placeholder",this.text),this.updatePlaceholder(h)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(h,a){this.cleanupElement(a)},cleanupElement:function(h){h.getAttribute("data-placeholder")===this.text&&h.removeAttribute("data-placeholder")},showPlaceholder:function(h){h&&(C.util.isFF&&0===h.childNodes.length?(h.classList.add("medium-editor-placeholder-relative"),h.classList.remove("medium-editor-placeholder")):(h.classList.add("medium-editor-placeholder"),h.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(h){h&&(h.classList.remove("medium-editor-placeholder"),h.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(h,a){return h.querySelector("img, blockquote, ul, ol, table")||""!==h.textContent.replace(/^\s+|\s+$/g,"")?this.hidePlaceholder(h):void(a||this.showPlaceholder(h))},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(h,a){var g=this.hideOnClick&&a===this.base.getFocusedElement();this.updatePlaceholder(a,g)},handleFocus:function(h,a){this.hidePlaceholder(a)},handleBlur:function(h,a){this.updatePlaceholder(a)}});C.extensions.placeholder=e}(),function(){var e=C.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){C.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(h,a){return this.base.extensions.forEach(function(g){return g!==this?h.apply(a||this,arguments):void 0},this)},createToolbar:function(){var h=this.document.createElement("div");return h.id="medium-editor-toolbar-"+this.getEditorId(),h.className="medium-editor-toolbar",h.className+=this.static?" static-toolbar":this.relativeContainer?" medium-editor-relative-toolbar":" medium-editor-stalker-toolbar",h.appendChild(this.createToolbarButtons()),this.forEachExtension(function(a){a.hasForm&&h.appendChild(a.getForm())}),this.attachEventHandlers(),h},createToolbarButtons:function(){var h,a,g,b,y,d,m=this.document.createElement("ul");return m.id="medium-editor-toolbar-actions"+this.getEditorId(),m.className="medium-editor-toolbar-actions",m.style.display="block",this.buttons.forEach(function(f){"string"==typeof f?(y=f,d=null):(y=f.name,d=f),(b=this.base.addBuiltInExtension(y,d))&&"function"==typeof b.getButton&&(a=b.getButton(this.base),h=this.document.createElement("li"),C.util.isElement(a)?h.appendChild(a):h.innerHTML=a,m.appendChild(h))},this),(g=m.querySelectorAll("button")).length>0&&(g[0].classList.add(this.firstButtonClass),g[g.length-1].classList.add(this.lastButtonClass)),m},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=C.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(h){return!(h&&h.target&&C.util.isDescendant(this.getToolbarElement(),h.target))&&void this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return"block"===this.getToolbarActionsElement().style.display},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(h){h.hasForm&&h.isDisplayed()&&h.hideForm()})},multipleBlockElementsSelected:function(){var a=new RegExp("<("+C.util.blockContainerElementNames.join("|")+")[^>]*>","g"),b=C.selection.getSelectionHtml(this.document).replace(/<[^\/>][^>]*><\/[^>]+>/gim,"").match(a);return!!b&&b.length>1},modifySelection:function(){var a=this.window.getSelection().getRangeAt(0);if(this.standardizeSelectionStart&&a.startContainer.nodeValue&&a.startOffset===a.startContainer.nodeValue.length){var g=C.util.findAdjacentTextNodeWithContent(C.selection.getSelectionElement(this.window),a.startContainer,this.document);if(g){for(var b=0;0===g.nodeValue.substr(b,1).trim().length;)b+=1;a=C.selection.select(this.document,g,b,a.endContainer,a.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||C.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var h=C.selection.getSelectionElement(this.window);return!h||-1===this.getEditorElements().indexOf(h)||h.getAttribute("data-disable-toolbar")?this.hideToolbar():this.updateOnEmptySelection&&this.static?this.showAndUpdateToolbar():!C.selection.selectionContainsContent(this.document)||!1===this.allowMultiParagraphSelection&&this.multipleBlockElementsSelected()?this.hideToolbar():void this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(h){"function"==typeof h.isActive&&"function"==typeof h.setInactive&&h.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var h,a=[],g=null,b=C.selection.getSelectionRange(this.document),y=function(d){"function"==typeof d.checkState?d.checkState(h):"function"==typeof d.isActive&&"function"==typeof d.isAlreadyApplied&&"function"==typeof d.setActive&&!d.isActive()&&d.isAlreadyApplied(h)&&d.setActive()};if(b&&(this.forEachExtension(function(d){return"function"==typeof d.queryCommandState&&null!==(g=d.queryCommandState())?void(g&&"function"==typeof d.setActive&&d.setActive()):void a.push(d)}),h=C.selection.getSelectedParentElement(b),this.getEditorElements().some(function(d){return C.util.isDescendant(d,h,!0)})))for(;h&&(a.forEach(y),!C.util.isMediumEditorElement(h));)h=h.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var h=this.base.getFocusedElement(),a=this.window.getSelection();return h?void(!this.static&&a.isCollapsed||(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(h):this.positionToolbar(a)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))):this},positionStaticToolbar:function(h){this.getToolbarElement().style.left="0";var a,g=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,b=this.window.innerWidth,y=this.getToolbarElement(),d=h.getBoundingClientRect(),m=d.top+g,f=d.left+d.width/2,k=y.offsetHeight,u=y.offsetWidth,F=u/2;switch(this.sticky?g>m+h.offsetHeight-k-this.stickyTopOffset?(y.style.top=m+h.offsetHeight-k+"px",y.classList.remove("medium-editor-sticky-toolbar")):g>m-k-this.stickyTopOffset?(y.classList.add("medium-editor-sticky-toolbar"),y.style.top=this.stickyTopOffset+"px"):(y.classList.remove("medium-editor-sticky-toolbar"),y.style.top=m-k+"px"):y.style.top=m-k+"px",this.align){case"left":a=d.left;break;case"right":a=d.right-u;break;case"center":a=f-F}0>a?a=0:a+u>b&&(a=b-Math.ceil(u)-1),y.style.left=a+"px"},positionToolbar:function(h){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var a=h.getRangeAt(0),g=a.getBoundingClientRect();(!g||0===g.height&&0===g.width&&a.startContainer===a.endContainer)&&(g=1===a.startContainer.nodeType&&a.startContainer.querySelector("img")?a.startContainer.querySelector("img").getBoundingClientRect():a.startContainer.getBoundingClientRect());var b,y,d=this.window.innerWidth,m=this.getToolbarElement(),f=m.offsetHeight,u=m.offsetWidth/2,w=this.diffLeft-u,N=this.getEditorOption("elementsContainer"),G=["absolute","fixed"].indexOf(window.getComputedStyle(N).getPropertyValue("position"))>-1,D={},q={};G?(y=N.getBoundingClientRect(),["top","left"].forEach(function(le){q[le]=g[le]-y[le]}),q.width=g.width,q.height=g.height,g=q,d=y.width,D.top=N.scrollTop):D.top=this.window.pageYOffset,b=g.left+g.width/2,D.top+=g.top-f,g.top<50?(m.classList.add("medium-toolbar-arrow-over"),m.classList.remove("medium-toolbar-arrow-under"),D.top+=50+g.height-this.diffTop):(m.classList.add("medium-toolbar-arrow-under"),m.classList.remove("medium-toolbar-arrow-over"),D.top+=this.diffTop),u>b?(D.left=w+u,D.right="initial"):u>d-b?(D.left="auto",D.right=0):(D.left=w+b,D.right="initial"),["top","left","right"].forEach(function(le){m.style[le]=D[le]+(isNaN(D[le])?"":"px")})}});C.extensions.toolbar=e}(),function(){var e=C.Extension.extend({init:function(){C.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(h){var a="medium-editor-dragover";h.preventDefault(),h.dataTransfer.dropEffect="copy","dragover"===h.type?h.target.classList.add(a):"dragleave"===h.type&&h.target.classList.remove(a)},handleDrop:function(h){h.preventDefault(),h.stopPropagation(),h.dataTransfer.files&&Array.prototype.slice.call(h.dataTransfer.files,0).some(function(b){var y,d;b.type.match("image")&&((y=new FileReader).readAsDataURL(b),C.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+(d="medium-img-"+ +new Date)+'" />'),y.onload=function(){var m=this.document.getElementById(d);m&&(m.removeAttribute("id"),m.removeAttribute("class"),m.src=y.result)}.bind(this))}.bind(this)),h.target.classList.remove("medium-editor-dragover")}});C.extensions.imageDragging=e}(),function(){function e(_){var x=C.selection.getSelectionStart(this.options.ownerDocument),P=x.textContent,M=C.selection.getCaretOffsets(x);(void 0===P[M.left-1]||""===P[M.left-1].trim()||void 0!==P[M.left]&&""===P[M.left].trim())&&_.preventDefault()}function h(_,x){if(this.options.disableReturn||x.getAttribute("data-disable-return"))_.preventDefault();else if(this.options.disableDoubleReturn||x.getAttribute("data-disable-double-return")){var P=C.selection.getSelectionStart(this.options.ownerDocument);(P&&""===P.textContent.trim()&&"li"!==P.nodeName.toLowerCase()||P.previousElementSibling&&"br"!==P.previousElementSibling.nodeName.toLowerCase()&&""===P.previousElementSibling.textContent.trim())&&_.preventDefault()}}function a(_){var x=C.selection.getSelectionStart(this.options.ownerDocument);"pre"===(x&&x.nodeName.toLowerCase())&&(_.preventDefault(),C.util.insertHTMLCommand(this.options.ownerDocument,"    ")),C.util.isListItem(x)&&(_.preventDefault(),this.options.ownerDocument.execCommand(_.shiftKey?"outdent":"indent",!1,null))}function g(_){var x,P=C.selection.getSelectionStart(this.options.ownerDocument),M=P.nodeName.toLowerCase(),j=/^(\s+|<br\/?>)?$/i,S=/h\d/i;C.util.isKey(_,[C.util.keyCode.BACKSPACE,C.util.keyCode.ENTER])&&P.previousElementSibling&&S.test(M)&&0===C.selection.getCaretOffsets(P).left?C.util.isKey(_,C.util.keyCode.BACKSPACE)&&j.test(P.previousElementSibling.innerHTML)?(P.previousElementSibling.parentNode.removeChild(P.previousElementSibling),_.preventDefault()):!this.options.disableDoubleReturn&&C.util.isKey(_,C.util.keyCode.ENTER)&&((x=this.options.ownerDocument.createElement("p")).innerHTML="<br>",P.previousElementSibling.parentNode.insertBefore(x,P),_.preventDefault()):C.util.isKey(_,C.util.keyCode.DELETE)&&P.nextElementSibling&&P.previousElementSibling&&!S.test(M)&&j.test(P.innerHTML)&&S.test(P.nextElementSibling.nodeName.toLowerCase())?(C.selection.moveCursor(this.options.ownerDocument,P.nextElementSibling),P.previousElementSibling.parentNode.removeChild(P),_.preventDefault()):C.util.isKey(_,C.util.keyCode.BACKSPACE)&&"li"===M&&j.test(P.innerHTML)&&!P.previousElementSibling&&!P.parentElement.previousElementSibling&&P.nextElementSibling&&"li"===P.nextElementSibling.nodeName.toLowerCase()?((x=this.options.ownerDocument.createElement("p")).innerHTML="<br>",P.parentElement.parentElement.insertBefore(x,P.parentElement),C.selection.moveCursor(this.options.ownerDocument,x),P.parentElement.removeChild(P),_.preventDefault()):C.util.isKey(_,C.util.keyCode.BACKSPACE)&&!1!==C.util.getClosestTag(P,"blockquote")&&0===C.selection.getCaretOffsets(P).left?(_.preventDefault(),C.util.execFormatBlock(this.options.ownerDocument,"p")):C.util.isKey(_,C.util.keyCode.ENTER)&&!1!==C.util.getClosestTag(P,"blockquote")&&0===C.selection.getCaretOffsets(P).right?((x=this.options.ownerDocument.createElement("p")).innerHTML="<br>",P.parentElement.insertBefore(x,P.nextSibling),C.selection.moveCursor(this.options.ownerDocument,x),_.preventDefault()):C.util.isKey(_,C.util.keyCode.BACKSPACE)&&C.util.isMediumEditorElement(P.parentElement)&&!P.previousElementSibling&&P.nextElementSibling&&j.test(P.innerHTML)&&(_.preventDefault(),C.selection.moveCursor(this.options.ownerDocument,P.nextSibling),P.parentElement.removeChild(P))}function b(_){var P=C.selection.getSelectionStart(this.options.ownerDocument);P&&(C.util.isMediumEditorElement(P)&&0===P.children.length&&!C.util.isBlockContainer(P)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),!C.util.isKey(_,C.util.keyCode.ENTER)||C.util.isListItem(P)||C.util.isBlockContainer(P)||("a"===P.nodeName.toLowerCase()?this.options.ownerDocument.execCommand("unlink",!1,null):_.shiftKey||_.ctrlKey||this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function y(_,x){var P=x.parentNode.querySelector('textarea[medium-editor-textarea-id="'+x.getAttribute("medium-editor-textarea-id")+'"]');P&&(P.value=x.innerHTML.trim())}function d(_){_._mediumEditors||(_._mediumEditors=[null]),this.id||(this.id=_._mediumEditors.length),_._mediumEditors[this.id]=this}function m(_){_._mediumEditors&&_._mediumEditors[this.id]&&(_._mediumEditors[this.id]=null)}function f(_,x,P){var M=[];if(_||(_=[]),"string"==typeof _&&(_=x.querySelectorAll(_)),C.util.isElement(_)&&(_=[_]),P)for(var j=0;j<_.length;j++){var S=_[j];!C.util.isElement(S)||S.getAttribute("data-medium-editor-element")||S.getAttribute("medium-editor-textarea-id")||M.push(S)}else M=Array.prototype.slice.apply(_);return M}function k(_){var x=_.parentNode.querySelector('textarea[medium-editor-textarea-id="'+_.getAttribute("medium-editor-textarea-id")+'"]');x&&(x.classList.remove("medium-editor-hidden"),x.removeAttribute("medium-editor-textarea-id")),_.parentNode&&_.parentNode.removeChild(_)}function F(_,x,P){return _=function u(_,x){return Object.keys(x).forEach(function(P){void 0===_[P]&&(_[P]=x[P])}),_}(_,{window:P.options.contentWindow,document:P.options.ownerDocument,base:P}),"function"==typeof _.init&&_.init(),_.name||(_.name=x),_}function w(){return!this.elements.every(function(_){return!!_.getAttribute("data-disable-toolbar")})&&!1!==this.options.toolbar}function N(){return!!w.call(this)&&!1!==this.options.anchorPreview}function G(){return!1!==this.options.placeholder}function D(){return!1!==this.options.autoLink}function q(){return!1!==this.options.imageDragging}function le(){return!1!==this.options.keyboardCommands}function Re(){return!this.options.extensions.imageDragging}function Je(_){for(var x=this.options.ownerDocument.createElement("div"),P=Date.now(),M="medium-editor-"+P,j=_.attributes;this.options.ownerDocument.getElementById(M);)P++,M="medium-editor-"+P;x.className=_.className,x.id=M,x.innerHTML=_.value,_.setAttribute("medium-editor-textarea-id",M);for(var S=0,it=j.length;it>S;S++)x.hasAttribute(j[S].nodeName)||x.setAttribute(j[S].nodeName,j[S].value);return _.form&&this.on(_.form,"reset",function(Te){Te.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(M))}.bind(this)),_.classList.add("medium-editor-hidden"),_.parentNode.insertBefore(x,_),x}function nn(_,x){if(!_.getAttribute("data-medium-editor-element")){"textarea"===_.nodeName.toLowerCase()&&(_=Je.call(this,_),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=y.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),this.options.disableEditing||_.getAttribute("data-disable-editing")||(_.setAttribute("contentEditable",!0),_.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(_.getAttribute("data-disable-return")||_.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=h.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),this.options.disableReturn||_.getAttribute("data-disable-return")||this.on(_,"keyup",b.bind(this));var P=C.util.guid();_.setAttribute("data-medium-editor-element",!0),_.classList.add("medium-editor-element"),_.setAttribute("role","textbox"),_.setAttribute("aria-multiline",!0),_.setAttribute("data-medium-editor-editor-index",x),_.setAttribute("medium-editor-index",P),X[P]=_.innerHTML,this.events.attachAllEventsToElement(_)}return _}function z(){this.subscribe("editableKeydownTab",a.bind(this)),this.subscribe("editableKeydownDelete",g.bind(this)),this.subscribe("editableKeydownEnter",g.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",e.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=h.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function ce(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(j){"toolbar"!==j&&this.options.extensions[j]&&this.extensions.push(F(this.options.extensions[j],j,this))},this),Re.call(this)){var _=this.options.fileDragging;_||(_={},q.call(this)||(_.allowedTypes=[])),this.addBuiltInExtension("fileDragging",_)}var x={paste:!0,"anchor-preview":N.call(this),autoLink:D.call(this),keyboardCommands:le.call(this),placeholder:G.call(this)};Object.keys(x).forEach(function(j){x[j]&&this.addBuiltInExtension(j)},this);var P=this.options.extensions.toolbar;if(!P&&w.call(this)){var M=C.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});P=new C.extensions.toolbar(M)}P&&this.extensions.push(F(P,"toolbar",this))}function K(_,x){return x&&[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]].forEach(function(M){x.hasOwnProperty(M[0])&&void 0!==x[M[0]]&&C.util.deprecated(M[0],M[1],"v6.0.0")}),C.util.defaults({},x,_)}function U(_,x){var P;if(P=/^append-(.+)$/gi.exec(_))return C.util.execFormatBlock(this.options.ownerDocument,P[1]);if("fontSize"===_)return x.size&&C.util.deprecated(".size option for fontSize command",".value","6.0.0"),this.options.ownerDocument.execCommand("fontSize",!1,x.value||x.size);if("fontName"===_)return x.name&&C.util.deprecated(".name option for fontName command",".value","6.0.0"),this.options.ownerDocument.execCommand("fontName",!1,x.value||x.name);if("createLink"===_)return this.createLink(x);if("image"===_){var it=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,it)}if("html"===_){var Te=this.options.contentWindow.getSelection().toString().trim();return C.util.insertHTMLCommand(this.options.ownerDocument,Te)}if(/justify([A-Za-z]*)$/g.exec(_)){var at=this.options.ownerDocument.execCommand(_,!1,null),he=C.selection.getSelectedParentElement(C.selection.getSelectionRange(this.options.ownerDocument));return he&&Tt.call(this,C.util.getTopBlockContainer(he)),at}return this.options.ownerDocument.execCommand(_,!1,x&&x.value)}function Tt(_){if(_){var x,P=Array.prototype.slice.call(_.childNodes).filter(function(M){var j="div"===M.nodeName.toLowerCase();return j&&!x&&(x=M.style.textAlign),j});P.length&&(this.saveSelection(),P.forEach(function(M){if(M.style.textAlign===x){var j=M.lastChild;if(j){C.util.unwrap(M,this.options.ownerDocument);var S=this.options.ownerDocument.createElement("BR");j.parentNode.insertBefore(S,j.nextSibling)}}},this),_.style.textAlign=x,this.restoreSelection())}}var X={};C.prototype={init:function(_,x){return this.options=K.call(this,this.defaults,x),this.origElements=_,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(d.call(this,this.options.contentWindow),this.events=new C.Events(this),this.elements=[],this.addElements(this.origElements),0!==this.elements.length&&(this.isActive=!0,ce.call(this),z.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(_){"function"==typeof _.destroy&&_.destroy()},this),this.events.destroy(),this.elements.forEach(function(_){this.options.spellcheck&&(_.innerHTML=_.innerHTML),_.removeAttribute("contentEditable"),_.removeAttribute("spellcheck"),_.removeAttribute("data-medium-editor-element"),_.classList.remove("medium-editor-element"),_.removeAttribute("role"),_.removeAttribute("aria-multiline"),_.removeAttribute("medium-editor-index"),_.removeAttribute("data-medium-editor-editor-index"),_.getAttribute("medium-editor-textarea-id")&&k(_)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,m.call(this,this.options.contentWindow))},on:function(_,x,P,M){return this.events.attachDOMEvent(_,x,P,M),this},off:function(_,x,P,M){return this.events.detachDOMEvent(_,x,P,M),this},subscribe:function(_,x){return this.events.attachCustomEvent(_,x),this},unsubscribe:function(_,x){return this.events.detachCustomEvent(_,x),this},trigger:function(_,x,P){return this.events.triggerCustomEvent(_,x,P),this},delay:function(_){var x=this;return setTimeout(function(){x.isActive&&_()},this.options.delay)},serialize:function(){var _,P={},M=this.elements.length;for(_=0;M>_;_+=1)P[""!==this.elements[_].id?this.elements[_].id:"element-"+_]={value:this.elements[_].innerHTML.trim()};return P},getExtensionByName:function(_){var x;return this.extensions&&this.extensions.length&&this.extensions.some(function(P){return P.name===_&&(x=P,!0)}),x},addBuiltInExtension:function(_,x){var P,M=this.getExtensionByName(_);if(M)return M;switch(_){case"anchor":P=C.util.extend({},this.options.anchor,x),M=new C.extensions.anchor(P);break;case"anchor-preview":M=new C.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":M=new C.extensions.autoLink;break;case"fileDragging":M=new C.extensions.fileDragging(x);break;case"fontname":M=new C.extensions.fontName(this.options.fontName);break;case"fontsize":M=new C.extensions.fontSize(x);break;case"keyboardCommands":M=new C.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":M=new C.extensions.paste(this.options.paste);break;case"placeholder":M=new C.extensions.placeholder(this.options.placeholder);break;default:C.extensions.button.isBuiltInButton(_)&&(x?(P=C.util.defaults({},x,C.extensions.button.prototype.defaults[_]),M=new C.extensions.button(P)):M=new C.extensions.button(_))}return M&&this.extensions.push(F(M,_,this)),M},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var _=this.getExtensionByName("toolbar");return _&&_.checkState(),this},queryCommandState:function(_){var x,M=null;(x=/^full-(.+)$/gi.exec(_))&&(_=x[1]);try{M=this.options.ownerDocument.queryCommandState(_)}catch{M=null}return M},execAction:function(_,x){var P,M;return(P=/^full-(.+)$/gi.exec(_))?(this.saveSelection(),this.selectAllContents(),M=U.call(this,P[1],x),this.restoreSelection()):M=U.call(this,_,x),"insertunorderedlist"!==_&&"insertorderedlist"!==_||C.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),M},getSelectedParentElement:function(_){return void 0===_&&(_=this.options.contentWindow.getSelection().getRangeAt(0)),C.selection.getSelectedParentElement(_)},selectAllContents:function(){var _=C.selection.getSelectionElement(this.options.contentWindow);if(_){for(;1===_.children.length;)_=_.children[0];this.selectElement(_)}},selectElement:function(_){C.selection.selectNode(_,this.options.ownerDocument);var x=C.selection.getSelectionElement(this.options.contentWindow);x&&this.events.focusElement(x)},getFocusedElement:function(){var _;return this.elements.some(function(x){return!_&&x.getAttribute("data-medium-focused")&&(_=x),!!_},this),_},exportSelection:function(){var _=C.selection.getSelectionElement(this.options.contentWindow),x=this.elements.indexOf(_),P=null;return x>=0&&(P=C.selection.exportSelection(_,this.options.ownerDocument)),null!==P&&0!==x&&(P.editableElementIndex=x),P},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(_,x){_&&C.selection.importSelection(_,this.elements[_.editableElementIndex||0],this.options.ownerDocument,x)},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(_){var x,P=C.selection.getSelectionElement(this.options.contentWindow),M={};if(-1!==this.elements.indexOf(P)){try{if(this.events.disableCustomEvent("editableInput"),_.url&&C.util.deprecated(".url option for createLink",".value","6.0.0"),(x=_.url||_.value)&&x.trim().length>0){var j=this.options.contentWindow.getSelection();if(j){var S,it,Te,at,he=j.getRangeAt(0),Bt=he.commonAncestorContainer;if(3===he.endContainer.nodeType&&3!==he.startContainer.nodeType&&0===he.startOffset&&he.startContainer.firstChild===he.endContainer&&(Bt=he.endContainer),it=C.util.getClosestBlockContainer(he.startContainer),Te=C.util.getClosestBlockContainer(he.endContainer),3!==Bt.nodeType&&0!==Bt.textContent.length&&it===Te){var W=it||P,lt=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),S=this.exportSelection(),lt.appendChild(W.cloneNode(!0)),P===W?C.selection.select(this.options.ownerDocument,W.firstChild,0,W.lastChild,3===W.lastChild.nodeType?W.lastChild.nodeValue.length:W.lastChild.childNodes.length):C.selection.select(this.options.ownerDocument,W,0,W,W.childNodes.length);var Ae=this.exportSelection();0===(at=C.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,lt,{start:S.start-Ae.start,end:S.end-Ae.start,editableElementIndex:S.editableElementIndex})).length&&((lt=this.options.ownerDocument.createDocumentFragment()).appendChild(Bt.cloneNode(!0)),at=[lt.firstChild.firstChild,lt.firstChild.lastChild]),C.util.createLink(this.options.ownerDocument,at,x.trim());var on=(lt.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;C.util.insertHTMLCommand(this.options.ownerDocument,lt.firstChild.innerHTML.replace(/^\s+/,"")),S.start-=on,S.end-=on,this.importSelection(S)}else this.options.ownerDocument.execCommand("createLink",!1,x);this.options.targetBlank||"_blank"===_.target?C.util.setTargetBlank(C.selection.getSelectionStart(this.options.ownerDocument),x):C.util.removeTargetBlank(C.selection.getSelectionStart(this.options.ownerDocument),x),_.buttonClass&&C.util.addClassToAnchors(C.selection.getSelectionStart(this.options.ownerDocument),_.buttonClass)}}if(this.options.targetBlank||"_blank"===_.target||_.buttonClass){(M=this.options.ownerDocument.createEvent("HTMLEvents")).initEvent("input",!0,!0,this.options.contentWindow);for(var xt=0,_e=this.elements.length;_e>xt;xt+=1)this.elements[xt].dispatchEvent(M)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",M,P)}},cleanPaste:function(_){this.getExtensionByName("paste").cleanPaste(_)},pasteHTML:function(_,x){this.getExtensionByName("paste").pasteHTML(_,x)},setContent:function(_,x){if(this.elements[x=x||0]){var P=this.elements[x];P.innerHTML=_,this.checkContentChanged(P)}},getContent:function(_){return this.elements[_=_||0]?this.elements[_].innerHTML.trim():null},checkContentChanged:function(_){_=_||C.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(_,{target:_,currentTarget:_})},resetContent:function(_){if(_){var x=this.elements.indexOf(_);-1!==x&&this.setContent(X[_.getAttribute("medium-editor-index")],x)}else this.elements.forEach(function(P,M){this.setContent(X[P.getAttribute("medium-editor-index")],M)},this)},addElements:function(_){var x=f(_,this.options.ownerDocument,!0);return 0!==x.length&&void x.forEach(function(P){P=nn.call(this,P,this.id),this.elements.push(P),this.trigger("addElement",{target:P,currentTarget:P},P)},this)},removeElements:function(_){var P=f(_,this.options.ownerDocument).map(function(M){return M.getAttribute("medium-editor-textarea-id")&&M.parentNode?M.parentNode.querySelector('div[medium-editor-textarea-id="'+M.getAttribute("medium-editor-textarea-id")+'"]'):M});this.elements=this.elements.filter(function(M){return-1===P.indexOf(M)||(this.events.cleanupElement(M),M.getAttribute("medium-editor-textarea-id")&&k(M),this.trigger("removeElement",{target:M,currentTarget:M},M),!1)},this)}},C.getEditorFromElement=function(_){var x=_.getAttribute("data-medium-editor-editor-index"),P=_&&_.ownerDocument&&(_.ownerDocument.defaultView||_.ownerDocument.parentWindow);return P&&P._mediumEditors&&P._mediumEditors[x]?P._mediumEditors[x]:null}}(),C.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0},C.parseVersionString=function(e){var h=e.split("-"),a=h[0].split("."),g=h.length>1?h[1]:"";return{major:parseInt(a[0],10),minor:parseInt(a[1],10),revision:parseInt(a[2],10),preRelease:g,toString:function(){return[a[0],a[1],a[2]].join(".")+(g?"-"+g:"")}}},C.version=C.parseVersionString.call(this,"5.23.3"),C;var e}())}}]);