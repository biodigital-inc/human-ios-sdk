(self.webpackChunkhuman_studio_next=self.webpackChunkhuman_studio_next||[]).push([[792],{46842:(Se,J,_)=>{"use strict";_.d(J,{U:()=>$});var O,c=_(65763),e=_(54438),l=function(j,h,W,B){var P,H=arguments.length,V=H<3?h:null===B?B=Object.getOwnPropertyDescriptor(h,W):B;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(j,h,W,B);else for(var p=j.length-1;p>=0;p--)(P=j[p])&&(V=(H<3?P(V):H>3?P(h,W,V):P(h,W))||V);return H>3&&V&&Object.defineProperty(h,W,V),V},X=function(j,h){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(j,h)};const U={prefersReducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches};let $=((O=class{static getPrefersReducedMotion(h){return h.prefersReducedMotion}}).\u0275fac=function(h){return new(h||O)},O.\u0275prov=e.jDH({token:O,factory:O.\u0275fac}),O);l([(0,c.MD)(),X("design:type",Function),X("design:paramtypes",[Object]),X("design:returntype",void 0)],$,"getPrefersReducedMotion",null),$=l([(0,c.Uw)({name:"accessibility",defaults:U})],$)},27153:(Se,J,_)=>{"use strict";_.d(J,{E:()=>h,fQ:()=>X,n3:()=>l}),_(71217);var e=_(30234);const l={[e.a.WoltersKluwer]:"Wolters Kluwer",[e.a.Zspace]:"zSpace"},X={[e.a.WoltersKluwer]:"https://tools.ovid.com/support/index_inner.html",[e.a.Zspace]:"https://support.zspace.com/s/contactsupport"};function h(p){return!p?.organizations[0]?.external_account?.is_external_account&&function j(p){return!0===p?.premium_account_valid||"group"===p?.premium_account_type}(p)}},20342:(Se,J,_)=>{"use strict";_.d(J,{O:()=>l,g:()=>X});const O=`https://www.biodigital.com?utm_source=${_(24418).c.native?"human_mobile":"human_web"}&utm_medium=PLG&utm_campaign=poweredby&ref=poweredby`,l={default:"./assets/images/powered-by-biodigital-color.svg",human_app:{default:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:O}},viewer:{viewer_logo_setting:null,full_dark:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:O},full_light:{logo_url:"./assets/images/powered-by-biodigital-white.svg",logo_linkout_url:O},square_dark:{logo_url:"./assets/images/logo-color.svg",logo_linkout_url:O},square_light:{logo_url:"./assets/images/logo-white.svg",logo_linkout_url:O}}};function X(U,$,j){const{full_dark:h,full_light:W,square_dark:B,square_light:H}=U.viewer;switch($){case"full":return"color"===j?h:W;case"small":return"color"===j?B:H}}},71217:(Se,J,_)=>{"use strict";_.d(J,{P:()=>c});var c=function(e){return e.User="user",e.Organization="organization",e}(c||{})},13976:(Se,J,_)=>{"use strict";_.d(J,{V:()=>O});var c=_(65776),e=_(54438);let O=(()=>{var l;class X{isTickerBlock($){return $.type===c.m.Ticker}isEmptyBlock($){switch($.type){case c.m.Markdown:return 0===$.markdown.length;case c.m.Images:case c.m.Ticker:return 0===$.images.length;case c.m.Videos:return 0===$.videos.length;case c.m.Positions:return 0===$.positions.length}}filterEmptyBlocks($){return $.filter(j=>!this.isEmptyBlock(j))}filterContentBlocksByType($,j=[],h=[]){return $.filter(W=>!j.length||j.includes(W.type)).filter(W=>!h.length||!h.includes(W.type))}findContentBlockByType($,j){return this.filterContentBlocksByType($,[j])[0]}extractContentBlockText($,j=""){return $?$.filter(h=>h.type===c.m.Markdown).map(h=>h.markdown).join(j):""}hasContentBlockText($){return""!==this.extractContentBlockText($)}}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),X})()},65776:(Se,J,_)=>{"use strict";_.d(J,{m:()=>c});var c=function(e){return e.Markdown="markdown",e.Images="images",e.Ticker="ticker",e.Videos="videos",e.Positions="positions",e}(c||{})},11153:(Se,J,_)=>{"use strict";_.d(J,{hw:()=>O,v9:()=>c,vf:()=>e});let c=(()=>{class X{constructor($){this.logoConfig=$}}return X.type="[AppConfig] Set View Logos",X})(),e=(()=>{class X{constructor($){this.logoConfig=$}}return X.type="[AppConfig] Set Header Logos",X})(),O=(()=>{class X{constructor(){}}return X.type="[AppConfig] Reset",X})()},98020:(Se,J,_)=>{"use strict";_.d(J,{X:()=>W});var c=_(65763);class e{}var U,O=_(20342),l=_(11153),X=_(54438),$=function(B,H,V,P){var F,p=arguments.length,w=p<3?H:null===P?P=Object.getOwnPropertyDescriptor(H,V):P;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(B,H,V,P);else for(var R=B.length-1;R>=0;R--)(F=B[R])&&(w=(p<3?F(w):p>3?F(H,V,w):F(H,V))||w);return p>3&&w&&Object.defineProperty(H,V,w),w},j=function(B,H){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(B,H)};const h={viewLogoConfig:O.O,headerLogoConfig:O.O};let W=((U=class{static getViewLogoConfig(H){return H.viewLogoConfig}static getHeaderLogoConfig(H){return H.headerLogoConfig}setLogos(H,{logoConfig:V}){H.patchState({viewLogoConfig:V})}setAppHeaderLogos(H,{logoConfig:V}){H.patchState({headerLogoConfig:V})}resetAppConfig(H){H.setState({...h})}}).\u0275fac=function(H){return new(H||U)},U.\u0275prov=X.jDH({token:U,factory:U.\u0275fac}),U);$([(0,c.rc)(l.v9),j("design:type",Function),j("design:paramtypes",[Object,l.v9]),j("design:returntype",void 0)],W.prototype,"setLogos",null),$([(0,c.rc)(l.vf),j("design:type",Function),j("design:paramtypes",[Object,l.v9]),j("design:returntype",void 0)],W.prototype,"setAppHeaderLogos",null),$([(0,c.rc)(l.hw),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",void 0)],W.prototype,"resetAppConfig",null),$([(0,c.MD)(),j("design:type",Function),j("design:paramtypes",[e]),j("design:returntype",void 0)],W,"getViewLogoConfig",null),$([(0,c.MD)(),j("design:type",Function),j("design:paramtypes",[e]),j("design:returntype",void 0)],W,"getHeaderLogoConfig",null),W=$([(0,c.Uw)({name:"appConfig",defaults:{...h}})],W)},4845:(Se,J,_)=>{"use strict";_.d(J,{f_:()=>W,g8:()=>j,ht:()=>h});var c=_(54438),e=_(77015),l=_(26655),X=_(90908),U=_(24418);const $={accessToken:U.c.rollbarToken,captureUncaught:!1,captureUnhandledRejections:!1,autoInstrument:{log:!1},payload:{environment:U.c.deploy.toLowerCase(),application:U.c.application,engineVersion:l.A,webGLEnabled:(0,X.MN)()}},j=new c.nKC("rollbar");function h(){return new e($)}function W(){return new B}class B{error(V){console.error(V)}}},65294:(Se,J,_)=>{"use strict";_.d(J,{F:()=>c});var c=function(e){return e.AnnotationsCreated="annotations.created",e.AnnotationsDestroyed="annotations.destroyed",e.AnnotationsHidden="annotations.hidden",e.AnnotationsShown="annotations.shown",e.QuizEntered="quiz.entered",e.QuizExited="quiz.exited",e.QuizQuestionLoaded="quiz.questionLoaded",e.QuizAnswerSelected="quiz.answerSelected",e.QuizAnswerSubmitted="quiz.answerSubmitted",e.QuizCompleted="quiz.completed",e.LabelsCreated="labels.created",e.LabelsUpdated="labels.updated",e.LabelsMoved="labels.moved",e.LabelsDestroyed="labels.destroyed",e.LabelsChapterInfo="labels.chapterInfo",e.LabelsShown="labels.shown",e.LabelsHidden="labels.hidden",e.LabelsEnabled="labels.enabled",e.LabelsDisabled="labels.disabled",e.LabelsEntered="labels.entered",e.LabelsLeft="labels.left",e.LabelsPicked="labels.picked",e.HotspotsDisplayUpdated="hotspots.displayUpdated",e.HotspotsEntered="hotspots.entered",e.HotspotsLeft="hotspots.left",e.HotspotsPicked="hotspots.picked",e.HotspotsPositionUpdated="hotspots.positionUpdated",e.NativeDeleteData="native.deleteData",e.NativeUpgrade="native.upgrade",e.NativeRestore="native.restore",e.NativeShare="native.share",e.NativeGoogleSignUp="native.googleSignUp",e.NativeDebugMessage="native.debugMessage",e.NativeSetSdkOffline="native.setSdkOffline",e.NativeSetBaseDirectory="native.setBaseDirectory",e.WhiteboardDrawingStarted="whiteboard.drawingStarted",e.WhiteboardDrawingFinished="whiteboard.drawingFinished",e.WhiteboardModeUpdated="whiteboard.modeUpdated",e.UIUpdated="ui.updated",e.UIWindowUpdated="ui.windowUpdated",e}(c||{})},83621:(Se,J,_)=>{"use strict";_.d(J,{S:()=>O});var c=_(26982),e=_(54438);let O=(()=>{var l;class X extends c.U{}return(l=X).\u0275fac=(()=>{let U;return function(j){return(U||(U=e.xGo(l)))(j||l)}})(),l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),X})()},26982:(Se,J,_)=>{"use strict";_.d(J,{U:()=>e});var c=_(85052);class e{constructor(){this._subjects={}}getEvent(l){return(this._subjects[l]=this._subjects[l]??new c.B).asObservable()}fireEvent(l,X){const U=this._subjects[l];U&&U.next(X)}}},10352:(Se,J,_)=>{"use strict";_.d(J,{RK:()=>c});const c={colors:[245,245,245,1,245,245,245,1],gradientType:"radial",colorStops:[0,100]}},1102:(Se,J,_)=>{"use strict";_.d(J,{H:()=>j,ql:()=>W,Sf:()=>h});class c{constructor(w={center:[0,0,0],edge:[1,1,1],centerBias:1,edgeBias:0,power:1}){const{edge:F,center:R,centerBias:N,edgeBias:M,power:u}=w;this.edge=F,this.center=R,this.centerBias=N,this.edgeBias=M,this.power=u}static toEngine(w){const{center:F,edge:R,centerBias:N,edgeBias:M,power:u}=w;return[[...F],[...R],N,M,u]}}var e=_(1367),O=_(49204);function l(p,w){switch(!0){case void 0===p[w]:return;case!1===p[w]:return!1;case"number"==typeof p[w]:return 100*p[w];default:return new e.R({center:p[w][0],edge:p[w][1],centerBias:p[w][2],edgeBias:p[w][3],power:p[w][4]})}}function U(p){return!(0,O.isNil)(p)&&Object.prototype.hasOwnProperty.call(p,"edge")&&Object.prototype.hasOwnProperty.call(p,"edgeBias")&&Object.prototype.hasOwnProperty.call(p,"center")&&Object.prototype.hasOwnProperty.call(p,"centerBias")&&Object.prototype.hasOwnProperty.call(p,"power")}function j(p){return{tintColor:(()=>{switch(!0){case void 0===p.tintColor:return;case!1===p.tintColor:return!1;case Array.isArray(p.tintColor):return 3===p.tintColor.length?[...p.tintColor]:new c({center:p.tintColor[0],edge:p.tintColor[1],centerBias:p.tintColor[2],edgeBias:p.tintColor[3],power:p.tintColor[4]})}})(),saturation:l(p,"saturation"),brightness:l(p,"brightness"),contrast:l(p,"contrast"),opacity:l(p,"opacity")}}function h(p){let w=!1!==p.tintColor&&void 0,F=!1!==p.saturation&&void 0,R=!1!==p.brightness&&void 0,N=!1!==p.contrast&&void 0,M=!1!==p.opacity&&void 0;return Array.isArray(p.tintColor)?w=[...p.tintColor]:U(p.tintColor)&&(w=c.toEngine(p.tintColor)),"number"==typeof p.saturation?F=p.saturation/100:U(p.saturation)&&(F=e.R.toEngine(p.saturation)),"number"==typeof p.brightness?R=p.brightness/100:U(p.brightness)&&(R=e.R.toEngine(p.brightness)),"number"==typeof p.contrast?N=p.contrast/100:U(p.contrast)&&(N=e.R.toEngine(p.contrast)),"number"==typeof p.opacity?M=p.opacity/100:U(p.opacity)&&(M=e.R.toEngine(p.opacity)),{tintColor:w,saturation:F,brightness:R,contrast:N,opacity:M}}function W(p,w){const F=Object.assign({},p);for(const[R,N]of Object.entries(w))typeof N<"u"&&(F[R]=N);return F}},58398:(Se,J,_)=>{"use strict";_.d(J,{Jl:()=>X,UD:()=>U,c7:()=>j,n4:()=>l});var c=_(49204);function l(h,W){return!(!h||!W)&&JSON.stringify(h,Object.keys(h).sort())===JSON.stringify(W,Object.keys(W).sort())}function X(h){return!(0,c.isNil)(h)&&(!(0,c.isNil)(h.brightness)&&!1!==h.brightness||!(0,c.isNil)(h.contrast)&&!1!==h.contrast||!(0,c.isNil)(h.opacity)&&!1!==h.opacity||!(0,c.isNil)(h.saturation)&&!1!==h.saturation||!(0,c.isNil)(h.tintColor)&&!1!==h.tintColor)}function U(h,W){try{const B=$(h),H=$(W),V=!1===h.opacity?1:h.opacity,P=!1===W.opacity?1:W.opacity;return B===H?V===P?h.saturation===W.saturation?h.brightness===W.brightness?h.contrast>W.contrast?B+4:B-4:h.brightness>W.brightness?B+3:B-3:h.saturation>W.saturation?B+2:B-2:V>P?B+1:B-1:B-H}catch{return 0}}function $(h){if(!h.tintColor)return-10;const W=h.tintColor[0],B=h.tintColor[1],H=h.tintColor[2],V=Math.max(W,B,H),p=V-Math.min(W,B,H);let w=0;return w=V===W?(B-H)/p:V===B?2+(H-W)/p:4+(W-B)/p,w*=60,w<0&&(w+=360),w}function j(h){const W=new Map;return h.filter(H=>{const V=JSON.stringify(H,Object.keys(H));return!W.has(V)&&(W.set(V,!0),!0)})}},1367:(Se,J,_)=>{"use strict";_.d(J,{R:()=>c});class c{constructor(O={center:0,edge:1,centerBias:1,edgeBias:0,power:1}){const{edge:l,center:X,centerBias:U,edgeBias:$,power:j}=O;this.edge=l,this.center=X,this.centerBias=U,this.edgeBias=$,this.power=j}static toEngine(O){const{center:l,edge:X,centerBias:U,edgeBias:$,power:j}=O;return[l,X,U,$,j]}static isFresnelObject(O){let l=!1;return O&&(l="center,centerBias,edge,edgeBias,power"==Object.keys(O).sort().toString()),l}}},21164:(Se,J,_)=>{"use strict";_.d(J,{p:()=>A});var c=_(23881),e=_(49204),O=_(8358),l=_(44867),U=_(287);var B=_(65763),H=_(13409),V=_(1102),P=_(29284),p=_(12921),w=_(87710),F=_(65650),R=_(60286),N=_(63508),M=_(92333),u=_(56343),g=_(54438);const C={play:{count:1}};let A=(()=>{var Y;class Z{constructor(y,b,S){this.store=y,this.labelService=b,this.paintService=S}getMinimumGraphSync(y,b,S){const v=this.paintService.getColorRecipes(),D=Object.keys((0,c.ow)(v)),ne=function X(Y,Z,Q){const y={},b={};return(0,l.Wy)(Y,v=>{b[v]=(0,l.jX)(Y,v)?{...(0,l._D)(Y,v,Q),...Z[v]||{}}:{...b[Y.predecessors[v]],...Z[v]||{}},(0,l.xe)(Y,v)&&(y[v]=b[v])}),y}(y,b,D),m=function E(Y){return Y.reduce((Z,Q)=>(Z[Q]=u.t.MajorityWins,Z),{available:u.t.MajorityWins,shown:u.t.MajorityWins,selected:u.t.MajorityWins,pickable:u.t.MajorityWins})}(v),ce=function W(Y,Z,Q){const y=Object.keys(Z),b=Object.keys(Q),S=(0,U.sO)(Q,y),v=(0,U.FV)(b,Y),D=(0,e.range)(v,-1).reduce((ce,I)=>{const x=(0,U.AY)(Y,Object.keys(ce.remainingVoters),I),K=(0,U.kK)(Y,ce.remainingVoters,x,Z),ie=function j(Y){return Y.reduce((Z,Q)=>{const S=Object.keys(Q).map(v=>function $(Y,Z,Q,y){const b=y.reduce((S,v)=>(S[v]={[Y]:!Q},S),{});return b[Z]={[Y]:Q},b}(v,Q[v].id,Q[v].result,Q[v].dissenters)).reduce((v,D)=>(0,e.merge)(v,D),{});return Object.keys(S).forEach(v=>{Z[v]=S[v]}),Z},{})}(K.results);return Object.keys(ie).forEach(k=>{ce.syncGraph[k]=ie[k]}),ce.remainingVoters=K.remainingVoters,ce},{syncGraph:{},remainingVoters:S}).syncGraph;return function h(Y,Z,Q,y){const b=Z.reduce((S,v)=>{const ne=Y[v],m=Y[y.predecessors[v]];for(const ce of Q)ne[ce]===m[ce]&&S.push({successorId:v,prop:ce});return S},[]);for(const S of b)delete Y[S.successorId][S.prop],0===Object.keys(Y[S.successorId]).length&&delete Y[S.successorId];return Y}(D,Object.keys(D).filter(ce=>!Y.roots[ce]&&!!Y.successors[ce]),y,Y)}(y,m,ne);Object.entries(b).forEach(([x,K])=>{const ie=(0,e.omit)(K,D);(0,e.isEmpty)(ie)||(ce[x]={...ce[x]||{},...ie})});const I=new c.YR;return Object.entries(ce).forEach(([x,K])=>{I[this.switchNamespace(x,S)]=K},this),I}convertGraphSync(y){const b={},S={},v={},D={},ne={};return Object.entries(y).forEach(([m,ce])=>{Object.entries(ce).forEach(([I,x])=>{"available"===I?b[m]=x:"shown"===I?S[m]=x:"selected"===I?v[m]=x:"pickable"===I?D[m]=!x:ne[m]={...ne[m]||{},[I]:x}},this)},this),{availableObjects:b,showObjects:S,selectObjects:v,pickThroughObjects:D,synchronization:ne}}switchNamespace(y,b){return b[y]||y}serializeHotspots(y,b){let S=[...y.hotspots],v={};return b.filter(ne=>ne.chapterId===y.id).forEach(ne=>{const m=this.labelService.serializeLabel(ne,S.length);S=[...S,...m.hotspots],v={...v,...m.data}}),{customData:v,hotspots:S}}calcMinimumPaintState(y,b){function S(v,D=!0){const m=(y.successors[v]||[]).reduce((ce,I)=>({...ce,...S(I,!(0,e.isEqual)(b[v],b[I]))}),{});return D?{[v]:b[v],...m}:m}return Object.keys(y.roots).reduce((v,D)=>({...v,...S(D)}),{})}serializeVisibilityLayers(y,b){const v={...y};return Array.isArray(y?.layers)&&(v.layers=y.layers.map(D=>({...D,objectIds:D.objectIds.filter(ne=>Object.prototype.hasOwnProperty.call(b.nodes,ne))})).filter(D=>D.objectIds.length>0)),v}serializeCamera(y){return{[y.action]:{...y.location,title:y.title===M.y?void 0:y.title},cameraRotationCenter:y.rotationCenter}}duplicateTimelineMap(y){return y?y.map(b=>{const S=(0,e.cloneDeep)(b);return delete S.id,S}):[]}duplicateQuizQuestions(y){return this.store.selectSnapshot(w.j.getQuizQuestionsByChapter(y)).map(b=>{const S=(0,e.cloneDeep)(b);return delete S.chapterId,S})}serializeChapter(y,b,S,v,D){const ne=this.serializeHotspots(b,v),m=this.store.selectSnapshot(p.B.particleSystemsForChapter(b.id)),I={...(0,e.pickBy)(b.customData,(z,ae)=>!ae.startsWith("errand")),...ne.customData,particleSystems:m.map(z=>z.id)},x=D[b.id],K=this.store.selectSnapshot(F.K.getRegisteredThumbnails),ie=K.get(x)?.urls||K.get(b.id)?.urls||null,k={id:x,createdFrom:b.createdFrom,displayName:b.displayName,description:b.description,...this.serializeCamera(b.camera),background:b.background??{},hotspots:ne.hotspots,clippingPlanes:{clips:b.clippingPlanes.clips,boundary:b.clippingPlanes.boundary},ui:(0,e.isEmpty)(b.ui)?C:b.ui,media:b.media,timelineMap:this.duplicateTimelineMap(b.timelineMap),customData:I,transparencyMode:b.transparencyMode||null,fallbackTransparency:b.fallbackTransparency,properties:b.properties,transitions:b.transitions,legend:b.legend||[],visibilityLayers:this.serializeVisibilityLayers(b.sliderLayers.src,y),contentBlocks:b.contentBlocks||[],thumbnails:{default:"",...ie},quizQuestions:this.duplicateQuizQuestions(b.id),synchronization:void 0};if((0,N.Mi)(b))k.lightLibraryId=b.lightLibraryId;else if((0,N.Uv)(b)){const z=k;z.lights=b.lights,z.environment=b.environment}const de=this.store.selectSnapshot(H.z.getAllNodeState)[b.id],oe=Object.entries(de).reduce((z,[ae,me])=>{const Ne=me.shownSetByTween?(0,P.BK)(y,ae,b.showObjects)||(0,P._x)(y,ae,b.showObjects):me.shown;return z.boolState[ae]={shown:Ne,pickable:me.pickable,available:me.available},z.paintState[ae]=(0,V.Sf)(me.paint),z},{boolState:{},paintState:{}}),ye=this.getMinimumGraphSync(y,oe.boolState,S);return Object.entries(this.convertGraphSync(ye)).forEach(([z,ae])=>{k[z]=ae}),k.synchronization=this.calcMinimumPaintState(y,oe.paintState),k}}return(Y=Z).\u0275fac=function(y){return new(y||Y)(g.KVO(B.il),g.KVO(O.x),g.KVO(R.s))},Y.\u0275prov=g.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),Z})()},41862:(Se,J,_)=>{"use strict";_.d(J,{tV:()=>$,yF:()=>c});let c=(()=>{class V{constructor(p){this.view=p}}return V.type="[Edit] Set view",V})(),$=(()=>{class V{constructor(){}}return V.type="[Edit] Reset",V})()},81881:(Se,J,_)=>{"use strict";_.d(J,{Df:()=>X,GG:()=>e,Hr:()=>O,Nf:()=>U,T2:()=>H,WD:()=>c,b8:()=>j,hd:()=>h,ut:()=>B,wx:()=>P,yE:()=>$,yG:()=>W,yJ:()=>V,yk:()=>l});let c=(()=>{class w{constructor(R){this.colorRecipe=R}}return w.type="[Edit Paint] Set Color Recipe",w})(),e=(()=>{class w{constructor(R){this.brushMode=R}}return w.type="[Edit Paint] Set Paint Brush Mode",w})(),O=(()=>{class w{constructor(){}}return w.type="[Edit Paint] Clear Current Recipe",w})(),l=(()=>{class w{constructor(){}}return w.type="[Edit Paint] Reset Paint",w})(),X=(()=>{class w{constructor(R){this.recipe=R}}return w.type="[Edit Paint] Add Recent Recipe",w})(),U=(()=>{class w{constructor(R){this.recipes=R}}return w.type="[Edit Paint] Set Recent Recipes",w})(),$=(()=>{class w{constructor(){}}return w.type="[Edit Paint] Reset Story Recipes",w})(),j=(()=>{class w{constructor(R,N){this.chapterId=R,this.recipes=N}}return w.type="[Edit Paint] Set Story Recipes For Chapter",w})(),h=(()=>{class w{constructor(R){this.palette=R}}return w.type="[Edit Paint] Add Palette",w})(),W=(()=>{class w{constructor(R){this.paletteId=R}}return w.type="[Edit Paint] Remove Palette",w})(),B=(()=>{class w{constructor(R){this.palette=R}}return w.type="[Edit Paint] Update Palette",w})(),H=(()=>{class w{constructor(R){this.palettes=R}}return w.type="[Edit Paint] Set Palettes",w})(),V=(()=>{class w{constructor(R,N){this.recipe=R,this.paletteId=N}}return w.type="[Edit Paint] Add Recipe to Palette",w})(),P=(()=>{class w{constructor(R,N){this.paletteId=R,this.open=N}}return w.type="[Edit Paint] Toggle Palette",w})()},12347:(Se,J,_)=>{"use strict";_.d(J,{O:()=>V});var c=_(28407),e=_(49204),O=_(72849),l=_(11724),X=_(515),U=_(65763),$=_(33013),j=_(85586),h=_(47610),W=_(55494),H=_(54438);let V=(()=>{var P;class p{constructor(F,R){this.engineService=F,this.store=R,this.fps=30}setChapter(F,R=!1){var N=this;return(0,c.A)(function*(){const{story:M}=N.engineService.engine,{chapters:u,activeChapter:g}=M;if(F&&(F!==g?.id||R)){const C=u.findIndex(A=>A.id===F);return M.activateChapter(C).then(A=>(N.initPlayer(A),A.id))}return F})()}initPlayer(F){this.destroyPlayer();const{animationSystem:R}=F;this._animationPlayer=new l.BioDigitalAnimationPlayer(R),this.engineService.engine.renderer.on("animate",()=>{this.engineService.fireEvent(X.X.TimelineAnimatingStart),this._animationPlayer.update(),this.engineService.fireEvent(X.X.TimelineAnimatingEnd)}),this._animationPlayer.on("timeupdate",()=>{this.engineService.fireEvent(X.X.TimelinePlaying,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("play",()=>{this.engineService.fireEvent(X.X.TimelinePlayed,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("pause",()=>{this.engineService.fireEvent(X.X.TimelinePaused,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("ended",()=>{this.engineService.fireEvent(X.X.TimelineCompleted)}),this._animationPlayer.on("ratechange",({playBackRate:y})=>{const b=this.engineService.engine?.story;b&&(b.playBackRate=y)});const N=this.store.selectSnapshot(W.S.getPlaybackSpeed);this.setPlaybackRate(N);const M=[];F.timelineMap.forEach((y,b)=>{const S={id:b,...y};S.name=S.name??"",M.push(S)}),this.store.dispatch(new $.bg(M)),F.timelineMap.on("change",()=>{this.engineService.fireEvent(X.X.TimelineTimeFrameUpdated)}),this.store.dispatch(new $.M5(F.id,{model:!0,animation:!0}));const u=this.store.selectSnapshot(W.S.getChapter),g=this.store.selectSnapshot(j.N.getStoryChapters),E=g.findIndex(y=>y.id===u),C=g.findIndex(y=>y.id===F.id),Z=-1===(this.store.selectSnapshot(j.N.getChapter(F.id))?.ui?.play?.count??0);this.setAnimationLoop(Z),E!==C&&this.engineService.fireEvent(X.X.TimelineChapterTransition,{oldChapterIndex:E,newChapterIndex:C,time:0}),this.store.dispatch(new h.u3(F.id))}destroyPlayer(){this._animationPlayer?.pause(),this._animationPlayer?.destroy(),this._animationPlayer=null}isChapterAnimated(F){return!!F?.timelineMap&&function B(P){return P.some(p=>"dummy"!==p?.data?.timeline&&"dummy"!==p?.name)}(F.timelineMap)}isChapterLooped(F){return!0===(0,e.get)(F,"loop")||-1===(0,e.get)(F,"ui.play.count")}restart(){if((0,e.isNil)(this._animationPlayer))return;const F=this.isPlaying();F&&this.pause(),this._animationPlayer.currentTime=0,F&&this.play()}play(){this._animationPlayer?.play(),this.playParticles()}pause(){this._animationPlayer?.pause(),this.pauseParticles()}unpause(){this._animationPlayer&&(this.hasChapterFinished()&&this.scrub(0),this.play())}scrub(F){this._animationPlayer&&(this._animationPlayer.currentTime=(0,e.clamp)(F,0,this._animationPlayer.duration),this.engineService.fireEvent(X.X.TimelineScrubbed,{time:this._animationPlayer.currentTime}))}scrubRelative(F,R){this._animationPlayer&&(R&&this.isPlaying()?(this.pause(),this.scrub(this.getTime()+F),setTimeout(()=>this.unpause())):this.scrub(this.getTime()+F))}scrubFrame(F){const R="next"===F?1:-1,N=this.getTime(),u=this.secondsToFrames(N)+R,g=this.framesToSeconds(u);this.scrub(g)}secondsToFrames(F){return Math.round(F*this.fps)}framesToSeconds(F){return F/this.fps}getNearestFrameTime(F){return this.framesToSeconds(this.secondsToFrames(F))}formatTime(F){const R=C=>{const A=F<0?Math.ceil:Math.floor;return Math.abs(A(C)).toString().padStart(2,"0")},M=R(F/60),u=R(F%60),g=(C=>Math.abs(this.secondsToFrames(C%1)).toString().padStart(2,"0"))(F%1);return`${F<0?"-":""}${M}:${u}:${g}`}parseFormattedTime(F){const R=/^-/,N=R.test(F)?-1:1;-1===N&&(F=F.replace(R,""));const M=F.split(":").reverse();let u=parseInt(M[0],10),g=parseInt(M[1],10),E=parseInt(M[2],10);return isNaN(u)&&(u=0),isNaN(g)&&(g=0),isNaN(E)&&(E=0),(60*E+g+this.framesToSeconds(u))*N}updateTimelineClips(F){const R=this.engineService.engine.story.activeChapter;F.forEach(N=>{R.timelineMap.set(N.id,N)})}deleteTimelineClips(F){const R=this.engineService.engine.story.activeChapter;F.forEach(N=>{R.timelineMap.delete(N)})}setPlaybackRate(F){this._animationPlayer.playBackRate=F}getStoryAnimationNames(){const F=this.store.selectSnapshot(j.N.getStoryChapters),R=[];return F.forEach(N=>{N.timelineMap.forEach(M=>{const u=M.data.timeline;R.includes(u)||R.push(u)})}),R}getChapterTimeFrame(F){return{firstTime:0,lastTime:this.getChapterDuration(F)}}getChapterDuration(F){return(0,e.isNil)(F)?(0,e.isNil)(this._animationPlayer)?0:this._animationPlayer.duration:this.engineService.engine.story.chapters.find(u=>u.id===F)?.animationSystem?.duration??0}getTime(){return(0,e.isNil)(this._animationPlayer)?0:this._animationPlayer.currentTime}isPlaying(){return!(0,e.isNil)(this._animationPlayer)&&!this._animationPlayer.paused}hasChapterFinished(){return!(0,e.isNil)(this._animationPlayer)&&this._animationPlayer.currentTime===this._animationPlayer.duration}setAnimationLoop(F){if(!this._animationPlayer)throw new Error("Animation player is not initialized");this._animationPlayer.loop=F}mapChapterGlobalTime(F,R){let N=R;if((0,e.isNil)(N))return 0;const M=this.store.selectSnapshot(j.N.getStoryChapters),u=M.findIndex(g=>g.id===F);for(let g=0;g<u;g++){let C=0;M[g].timelineMap.forEach(A=>{A.end>C&&(C=A.end)}),N-=C}return N}mapGlobalTimeToChapterId(F){let R=0;const N=this.store.selectSnapshot(j.N.getStoryChapters);let M;for(let u=0;u<N.length;u++){const g=N[u],E=this.getChapterDuration(g.id);if(F>=R&&F<R+E){M=g.id;break}R+=E}return F===R&&!M&&(M=N[N.length-1].id),M}getGlobalTime(){const F=this.store.selectSnapshot(j.N.getSelectedChapterIndex),R=this.store.selectSnapshot(j.N.getStoryChapters);let N=this._animationPlayer.currentTime;for(let M=0;M<F;M++){let g=0;R[M].timelineMap.forEach(E=>{E.end>g&&(g=E.end)}),N+=g}return N}playParticles(){this.engineService.engine?.story?.activeChapter?.start()}pauseParticles(){this.engineService.engine?.story?.activeChapter?.stop()}}return(P=p).\u0275fac=function(F){return new(F||P)(H.KVO(O.y),H.KVO(U.il))},P.\u0275prov=H.jDH({token:P,factory:P.\u0275fac,providedIn:"root"}),p})()},3266:(Se,J,_)=>{"use strict";_.d(J,{j:()=>Y});var c=_(13491),e=_(85052),O=_(66017),l=_(15913),X=_(2353),U=_(38472),$=_(72849),j=_(11724),h=_(515),W=_(35650),B=_(46889),H=_(49204);const p={backOff:0,stopFOV:55,dist:2.5};function w(Z,Q,y,b=p){const S={...p,...b},v=S.dist,D=S.stopFOV,ne=1-(0,H.clamp)(S.backOff,0,1),m=(0,B.E8)(Z,Q);return Math.abs(m/(1+.8*ne)/Math.tan(D/2))/y*v}function F(Z,Q,y){const b=c.n.toArray(Z.look),S=c.n.toArray(Z.eye),v=U.create();U.subtract(v,S,b);const D=U.create();U.normalize(D,v);const ne=Math.abs(U.length(D)),{min:m,max:ce}=(0,X.n)(Q),I=w(m,ce,ne,y),x=(0,B.A1)(m,ce);U.scale(v,D,I);const K=U.add(U.create(),x,v);return{eye:c.n.fromArray(K),look:c.n.fromArray(x),up:c.n.fromArray([0,1,0])}}class R{constructor(Q,y){this.tempVec=U.create(),this.eyeVec=U.create(),this.lookVec=U.create(),this.cameraService=Q;const{targetCamera:b,targetBoundary:S}=y,v=Q.getCamera();if(this.initialLook=c.n.toArray(v.look),this.initialEye=c.n.toArray(v.eye),this.initialUp=c.n.toArray(v.up),S){U.subtract(this.tempVec,this.initialEye,this.initialLook);const ce=U.create();U.normalize(ce,this.tempVec);const I=Math.abs(U.length(ce)),{min:x,max:K}=(0,X.n)(S),ie=w(x,K,I,y);U.scale(this.tempVec,ce,ie),this.targetLook=(0,B.A1)(x,K),this.targetEye=U.add(U.create(),this.targetLook,this.tempVec),this.targetUp=U.fromValues(0,1,0)}b&&(this.targetLook=c.n.toArray(b.look),this.targetEye=c.n.toArray(b.eye),this.targetUp=c.n.toArray(b.up)),U.subtract(this.tempVec,this.targetLook,this.initialLook);const D=Math.abs(U.length(this.tempVec));U.subtract(this.tempVec,this.targetEye,this.initialEye);const ne=Math.abs(U.length(this.tempVec));this.animationDuration=y.animationDuration?1e3*y.animationDuration:1e3*((D>ne?D:ne)/(200*(y.velocity||1))+1),this.onComplete=y.onComplete}update(Q){if(void 0===this.startTime&&(this.startTime=Q,this.endTime=this.startTime+this.animationDuration),this.animationDone||Q>this.endTime)return this.animationDone||this.cameraService.setCamera({eye:c.n.fromArray(this.targetEye),look:c.n.fromArray(this.targetLook),up:c.n.fromArray(this.targetUp)}),this.animationDone=!0,void this.onComplete(this);const b=(0,B.vT)((Q-this.startTime)/this.animationDuration,0,1);(0,B.dL)(b,0,1,this.initialLook,this.targetLook,this.lookVec),(0,B.dL)(b,0,1,this.initialEye,this.targetEye,this.eyeVec),(0,B.dL)(b,0,1,this.initialUp,this.targetUp),this.cameraService.setCamera({eye:c.n.fromArray(this.eyeVec),look:c.n.fromArray(this.lookVec),up:c.n.fromArray(this.targetUp)})}stop(){}}var N=_(54438),M=_(81642);const E=180/Math.PI,C=1/j.BIODIGITAL_SCENE_SCALE,A=j.BIODIGITAL_SCENE_SCALE;let Y=(()=>{var Z;class Q{get cameraController(){const b=this.engineService.engine?.story?.cameraController;if(!b)throw new Error("Story not instantiated, cannot get camera controller");return b}constructor(b,S,v){this.engineService=b,this.numberService=S,this.sceneService=v,this.rotation={vx:0,vy:0},this.pan={x:0,y:0,z:0},this.zoom=0,this.animationCallbacks=[],this.initCameraEvents()}tickCamera(b){this.animation&&this.animation.update(performance.now())}getCamera(){const{up:b,target:S,position:v}=this.cameraController,D=j.vec3Pool.get(),ne=j.vec3Pool.get();U.scale(D,v,C),U.scale(ne,S,C);const m={eye:c.n.fromArray(D),look:c.n.fromArray(ne),up:c.n.fromArray(b)};return j.vec3Pool.release(D),j.vec3Pool.release(ne),m}setCamera(b,S=!1){const{cameraController:v}=this,{eye:D,look:ne,up:m}=b;let ce,I,x;D&&(ce=j.vec3Pool.get(),U.scale(ce,c.n.toArray(D),A)),ne&&(I=j.vec3Pool.get(),U.scale(I,c.n.toArray(ne),A)),m&&(x=c.n.toArray(m)),v.setCamera(ce??v.position,I??v.target,x),ce&&j.vec3Pool.release(ce),I&&j.vec3Pool.release(I),ne&&!S&&this.setCameraRotationCenter(ne)}getLookDirection(){const{target:b,position:S}=this.cameraController,v=U.create();return U.sub(v,b,S),U.normalize(v,v),v}getLookDistance(){return this.cameraController.distance*C}getCameraZoom(){return this.cameraController.zoom}captureCamera(){return{lookAt:this.getCamera(),zoom:this.getCameraZoom()}}getDirection(b){const{position:S}=this.cameraController,v=U.create();return U.sub(v,S,b.worldPos),U.normalize(v,v),[v[0],v[1],v[2]]}rotateCameraStatic(b,S){this.cameraController.orbit(b/E,S/E)}panCameraStatic(b,S,v){this.cameraController.pan(b*A,S*A,v*A)}setRelativeZoom(b){this.cameraController.dolly(b)}setAbsoluteZoom(b){this.cameraController.zoom=b}getCameraRotationCenter(){const b=j.vec3Pool.get();U.scale(b,this.cameraController.center,C);const S=c.n.fromArray(b);return j.vec3Pool.release(b),S}setCameraRotationCenter(b){const S=j.vec3Pool.get(),v=Array.isArray(b)?b:c.n.toArray(b);U.scale(S,v,A),U.copy(this.cameraController.center,S),j.vec3Pool.release(S)}setCameraRotation(b,S){this.rotation.vx=S,this.rotation.vy=-b}setCameraPan(b,S){this.pan.x=b,this.pan.y=S}setCameraZoom(b){this.zoom=.03*b}setCameraZoomWithVelocity(b){this.setCameraZoom(b),requestAnimationFrame(()=>{b*=.85,Math.abs(b)>1&&this.setCameraZoomWithVelocity(b)})}tickCameraRotation(){return this.rotation.vx=this.checkEpsilon(this.rotation.vx),this.rotation.vy=this.checkEpsilon(this.rotation.vy),this.rotation}tickCameraPan(){return this.pan.x=this.checkEpsilon(this.pan.x),this.pan.y=this.checkEpsilon(this.pan.y),this.pan.z=this.checkEpsilon(this.pan.z),this.pan}tickCameraZoom(){return this.zoom=this.checkEpsilon(this.zoom),this.zoom}areCamerasEqual(b,S){return this.compareXYZ(b.eye,S.eye)&&this.compareXYZ(b.look,S.look)&&this.compareXYZ(b.up,S.up)}compareXYZ(b,S){return b.x===S.x&&b.y===S.y&&b.z===S.z}roundCamera(b,S){const{eye:v,look:D,up:ne}=b;return{eye:this.numberService.roundModel(v,S),look:this.numberService.roundModel(D,S),up:this.numberService.roundModel(ne,S)}}flyToObject(b,S){return new Promise(v=>{const D=this.sceneService.getObjectBoundary([b]);(0,X.L)(D)?(this.animationCallbacks.push(v),this.animation=new R(this,{targetBoundary:D,animationDuration:S,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())):v(void 0)})}flyToCamera(b,S){return new Promise(v=>{this.animationCallbacks.push(v),this.animation=new R(this,{targetCamera:b,animationDuration:S,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())})}jumpToObject(b){const S=this.sceneService.getObjectBoundary([b]);if((0,X.L)(S)){const D=F(this.getCamera(),S);return this.jumpToCamera(D)}return new Promise(v=>v(void 0))}jumpToCamera(b){return new Promise(S=>{this.finishAnimation(),this.setCamera(b),S(void 0)})}getCameraAfterFlyTo(b){return F(this.getCamera(),b)}checkEpsilon(b){return Math.abs(b)<.001?0:b}initCameraEvents(){const b=new e.B,S=b.asObservable();S.subscribe(ne=>{this.engineService.fireEvent(h.X.CameraUpdated,ne)});const D=this.engineService.getEvent(h.X.Tick).pipe((0,O.S)(2));S.pipe((0,l.s)(()=>D)).subscribe(ne=>{this.engineService.fireEvent(h.X.CameraRested,ne)}),this.engineService.engineCreated$.subscribe(ne=>{ne.camera.on("updateWorldMatrix",m=>{if(!ne?.story)return;const x={...this.getCamera(),dist:this.getLookDistance()};b.next(x)})})}finishAnimation(){for(this.animation&&(this.animation.stop(),this.animation=null);this.animationCallbacks.length>0;)this.animationCallbacks.pop()()}}return(Z=Q).\u0275fac=function(b){return new(b||Z)(N.KVO($.y),N.KVO(M.D),N.KVO(W.w))},Z.\u0275prov=N.jDH({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Q})()},26655:(Se,J,_)=>{"use strict";_.d(J,{A:()=>O,m:()=>l});const O=_(11724).VERSION,l="2.0.1"},46799:(Se,J,_)=>{"use strict";_.d(J,{z:()=>W});var c=_(65133),e=_(38472),O=_(11724);const l={stats:{textures:{baseColor:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},alpha:{"1024x1024":1,memory:1e6,"512x512":1},normals:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},emit:{"1024x1024":1,memory:1e6,"512x512":1,"256x256":1},roughness:{"512x512":1,memory:1e6,"1024x1024":1}}}};var X=_(72849),U=_(515),$=_(54438);const j=c.create(),h=c.create();let W=(()=>{var B;class H{get canvas(){if(!this.engineService.engine)throw new Error("Engine not defined, cannot use canvas");return this.engineService.engine.renderer.canvas}constructor(P){this.engineService=P}forceRenderFrame(){this.engineService.engine.renderer.render()}getCanvas(){return this.canvas}getScene(){return l}getViewMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.worldMatrixInverse)}getProjMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.projectionMatrix)}pick(P,p,w=!0){const F=this.engineService.engine,R=F.story?.anatomySceneGraph,N=F.rayCastCamera(P,p,{filter:M=>R?.findAnatomyObject(M)?.pickable});if(N){const M=this.generateHitModel(R,P,p,N,w);return this.engineService.fireEvent(U.X.PickPicked,M),M}return{canvasPos:{x:P,y:p}}}setTransparencyMode(P){this.engineService.engine.renderer.transparencyMode=P}scaleAndNormalizeMatrix(P){return c.copy(h,P),h[12]*=O.BIODIGITAL_SCENE_SCALE,h[13]*=O.BIODIGITAL_SCENE_SCALE,h[14]*=O.BIODIGITAL_SCENE_SCALE,h}generateHitModel(P,p,w,F,R){const{triIndex:N,intersection:M,object:u}=F,g=P.findAnatomyObject(u),{objectId:E,renderables:C}=g,A=C.findIndex(y=>y.meshNode===u),Y=C[A]?.meshNode,Q={canvasPos:{x:p,y:w},objectId:E,renderableIndex:A,triIndex:N};if(R){const y=this.getBarycentricCoordinate(Y,M,N),b=this.getTriangleNormal(Y,N);return e.scale(M,M,1/O.BIODIGITAL_SCENE_SCALE),{...Q,barycentric:y,worldPos:M,normal:b}}return Q}getBarycentricCoordinate(P,p,w){const F=e.create(),R=O.vec3Pool.get(),N=O.vec3Pool.get(),M=O.vec3Pool.get(),u=O.vec3Pool.get();return c.invert(j,P.worldMatrix),e.transformMat4(R,p,j),(0,O.getTrianglePositions)(P,w,N,M,u),(0,O.barycentricCoord)(F,R,N,M,u),e.transformMat4(N,N,P.worldMatrix),e.transformMat4(M,M,P.worldMatrix),e.transformMat4(u,u,P.worldMatrix),O.vec3Pool.release(R),O.vec3Pool.release(N),O.vec3Pool.release(M),O.vec3Pool.release(u),F}getTriangleNormal(P,p){const w=e.create(),F=O.vec3Pool.get(),R=O.vec3Pool.get(),N=O.vec3Pool.get();return(0,O.getTrianglePositions)(P,p,F,R,N),e.transformMat4(F,F,P.worldMatrix),e.transformMat4(R,R,P.worldMatrix),e.transformMat4(N,N,P.worldMatrix),(0,O.triangleNormal)(w,F,R,N),O.vec3Pool.release(F),O.vec3Pool.release(R),O.vec3Pool.release(N),w}}return(B=H).\u0275fac=function(P){return new(P||B)($.KVO(X.y))},B.\u0275prov=$.jDH({token:B,factory:B.\u0275fac,providedIn:"root"}),H})()},72849:(Se,J,_)=>{"use strict";_.d(J,{y:()=>le});var c=_(28407),e=_(29160),O=_(85052),l=_(14264),X=_(11756),U=_(40215),$=_(37925),j=_(515),h=_(24418),W=_(17215),B=_(85884),H=_(41775),V=_(11724),P=_(49204);const p={[V.FogModeNumericEnum.Linear]:"linear",[V.FogModeNumericEnum.Exponential]:"exp",[V.FogModeNumericEnum.ExponentialSquared]:"exp2"};_(77015);var F=_(4845),R=_(70432),N=_(93163);const M=(de,oe)=>(0,V.joinPath)(de,"assets",oe),g=5,E=new N.A({concurrency:900});function A(){return(A=(0,c.A)(function*(de,oe,ye){const z=yield fetch(de,{signal:oe});return z.ok?ye(z):null})).apply(this,arguments)}function Y(de,oe,ye,z){return Z.apply(this,arguments)}function Z(){return Z=(0,c.A)(function*(de,oe,ye,z){const ae=M(oe,ye);return E.add(()=>(0,R.A)(()=>function C(de,oe,ye){return A.apply(this,arguments)}(ae,de,z),{retries:g}))}),Z.apply(this,arguments)}function Q(de,oe,ye){return Y(de,oe,ye,function(){var z=(0,c.A)(function*(ae){return ae.json()});return function(ae){return z.apply(this,arguments)}}())}function y(de,oe,ye){return Y(de,oe,ye,function(){var z=(0,c.A)(function*(ae){return ae.arrayBuffer()});return function(ae){return z.apply(this,arguments)}}())}function S(){return(S=(0,c.A)(function*(de){return(yield fetch(de)).json()})).apply(this,arguments)}function D(){return(D=(0,c.A)(function*(de,oe){return E.add(()=>(0,R.A)(()=>fetch("/assets/"+de,oe),{retries:g}))})).apply(this,arguments)}const ne={material:Q,morph:y,geometry:y,transform:Q};class m{fetch(oe,ye){return(0,c.A)(function*(){const z=E.add(()=>(0,R.A)(()=>fetch(oe),{retries:g}));return void 0!==z?z:null})()}constructor(oe,ye,z={}){let ae=new V.BioDigitalWebSocketServer(ye,z);const me=typeof AbortController>"u"?null:new V.MultiKeyMap;function Qe(){return Qe=(0,c.A)(function*(St,De,lt,tt){const je=lt.split("/"),Ae=(0,V.joinPath)(St,"content/states",je[0],De,je[1],tt);return E.add(()=>(0,R.A)(()=>function b(de){return S.apply(this,arguments)}(Ae),{retries:g}))}),Qe.apply(this,arguments)}this.getAsset=function(){var St=(0,c.A)(function*(De,lt){const tt=ne[De];if(!tt)throw new Error("BioDigitalHybridServer: Unsupported type '$type'");let je=null;me&&(je=new AbortController,me.set(De,lt,je));let Ae=yield tt(je?.signal,oe,lt);return null===Ae&&(Ae=yield function Ne(){return ae||(ae=new V.BioDigitalWebSocketServer(ye,z)),ae}().getAsset(De,lt),function v(de,oe){D.apply(this,arguments)}(lt,{method:"PUT",body:"morph"===De||"geometry"===De?Ae:JSON.stringify(Ae)})),me&&me?.delete(De,lt),Ae});return function(De,lt){return St.apply(this,arguments)}}(),this.getAssetLibrary=function Pe(St,De,lt,tt){return Qe.apply(this,arguments)},this.destroy=()=>{me&&(me.forEach(St=>St.abort()),me.clear()),ae&&ae.destroy()}}}var ce=_(54438),I=_(26982);let x=(()=>{var de;class oe extends I.U{}return(de=oe).\u0275fac=(()=>{let ye;return function(ae){return(ye||(ye=ce.xGo(de)))(ae||de)}})(),de.\u0275prov=ce.jDH({token:de,factory:de.\u0275fac,providedIn:"root"}),oe})();var K=_(21626);let le=(()=>{var de;class oe{get engine(){return this._engine}get server(){return this._server}get serverBaseDirectory(){return typeof localBaseDirectory>"u"?"/":localBaseDirectory}constructor(z,ae,me,Ne,Pe){this.errorService=z,this.storageService=ae,this.engineEventService=me,this.http=Ne,this.rollbar=Pe,this.events={},this.errorLogged=!1,this._engineCreated=new e.t(void 0),this._engineDestroyed=new O.B,this.registerEngineWorkers(),this.events=Object.values(j.X).reduce((Qe,St)=>(Qe[St]=this.engineEventService.getEvent(St),Qe),{}),this.engineCreated$=this._engineCreated.asObservable().pipe((0,l.p)(Qe=>!(0,P.isNil)(Qe))),this.engineDestroyed$=this._engineDestroyed.asObservable(),this.engineCreated$.pipe((0,X.Z)(Qe=>this.getGPUCapabilities(Qe))).subscribe(Qe=>{this.gpuCapabilities=Qe}),this.initEngineErrorHandling()}getEvent(z){return this.events[z]}fireEvent(z,ae){this.engineEventService.fireEvent(z,ae)}initEngine(z){return this.createServerInstance(),this.createEngineInstance(z),this.fireEvent(j.X.Loaded),this.engine}destroyEngine(){this._engine&&(this._engineCreated.next(void 0),this._engineDestroyed.next(),this._engine.destroy(),this._engine=null),this._server&&(this._server.destroy(),this._server=null)}setStory(z){this.engine.setStory(z),h.c.offline&&(this._server.moduleId=z.moduleId,typeof requiresFileExtensions<"u"&&(this._server.requiresFileExtensions=requiresFileExtensions)),this.engine.story.chapters.forEach(ae=>{ae.on("progress",()=>{const{id:me,loadProgress:Ne}=ae;this.fireEvent(j.X.AssetsLoadProgress,{chapterId:me,chapterProgress:Ne})})})}getWEBGLInfo(){return this.gpuCapabilities?.webgl?.params}setProperties(z){const{story:ae,renderer:me}=this.engine,Ne=ae?.activeChapter,Pe=ae?.cameraController;(0,P.isNil)(Ne)||(this.setFogProperties(me,Ne,z),this.setCameraProperties(me,Ne,Pe,z))}setFogProperties(z,ae,me){Object.entries(me).forEach(([Pe,Qe])=>{if(Pe.startsWith("fog.")&&((0,P.has)(z.environment,Pe)&&(0,P.set)(ae.properties,Pe,Qe),(0,P.has)(z.environment,Pe)))switch(Pe){case"fog.density":z.environment.fog.density=Qe/V.BIODIGITAL_SCENE_SCALE;break;case"fog.mode":z.environment.fog.mode=p[Qe];break;case"fog.start":z.environment.fog.start=Qe*V.BIODIGITAL_SCENE_SCALE;break;case"fog.end":z.environment.fog.end=Qe*V.BIODIGITAL_SCENE_SCALE;break;default:(0,P.set)(z.environment,Pe,Qe)}}),!1===me["fog.enabled"]&&(z.environment.fog.mode="")}setCameraProperties(z,ae,me,Ne){Object.entries(Ne).forEach(([St,De])=>{if(St.startsWith("camera."))switch(St){case"camera.optics.near":ae.properties.camera.optics.near=De;break;case"camera.optics.far":ae.properties.camera.optics.far=De;break;case"camera.optics.fov":ae.properties.camera.optics.fov=De;break;case"camera.zoomLimits":ae.properties.camera.zoomLimits=De}});const{optics:Pe,zoomLimits:Qe}=ae.properties.camera;z.camera.fov=Pe.fov*Math.PI/180,z.camera.far=Pe.far*V.BIODIGITAL_SCENE_SCALE,z.camera.near=Pe.near*V.BIODIGITAL_SCENE_SCALE,z.camera.dirtyProjection(),me.minDistance=Qe.min*V.BIODIGITAL_SCENE_SCALE,me.maxDistance=Qe.max*V.BIODIGITAL_SCENE_SCALE}getGPUCapabilities(z){var ae=this;return(0,c.A)(function*(){return ae.gpuCapabilities=ae.gpuCapabilities??(yield z.renderer.getGPUCapabilities()),ae.gpuCapabilities})()}initAnalytics(z,ae,me,Ne){var Pe=this;return(0,c.A)(function*(){Pe.gpuAnalytic={version:4,app_producttype:z,app_productkey:ae,gpu_data:{},acct_cred_type:me,acct_cred_id:Ne,offline_event:h.c.offline?1:0};const Qe=yield(0,U._)(Pe.engineCreated$),St=yield Pe.getGPUCapabilities(Qe);if(Pe.gpuAnalytic={...Pe.gpuAnalytic,gpu_data:{...St}},!Pe.storageService.getSessionItem(W.d0.GPUAnalyticsStored)){const lt=h.c.offline?{...Pe.gpuAnalytic,event_timestamp:(new Date).toISOString().substring(0,19)}:Pe.gpuAnalytic;h.c.offline?fetch("https://human.biodigital.com/ws/product/analytic/gpu-event",{method:"POST",body:JSON.stringify(lt),headers:new Headers({"Content-Type":"application/json; charset=utf-8"}),mode:"no-cors"}).then(()=>{Pe.storageService.setSessionItem(W.d0.GPUAnalyticsStored,Date.now())}):Pe.http.post("/ws/product/analytic/gpu-event",lt,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(()=>{Pe.storageService.setSessionItem(W.d0.GPUAnalyticsStored,Date.now())})}})()}createServerInstance(){if(this._server)throw new Error("Websocket server already exists");this._server=h.c.offline?new V.BioDigitalFileServer(this.serverBaseDirectory):h.c.native?new m(this.serverBaseDirectory,h.c.assetDomain,{timeout:6e5,socketProtocol:"wss"}):new V.BioDigitalWebSocketServer(h.c.assetDomain,{timeout:6e5})}createEngineInstance(z){if(this._engine)throw new Error("Engine is already instantiated");try{const ae=typeof localBaseDirectory>"u"?"/":localBaseDirectory;this._engine=new V.BioDigitalEngine(this._server,{...z,baseUrl:ae}),this.initEngineTickEvent(this._engine),this.initTweenVisibilityEvent(this._engine),this._engineCreated.next(this._engine)}catch(ae){const me=ae??new Error("There was an error creating the engine");this.fireEvent(j.X.HumanError,me)}}initEngineErrorHandling(){this.getEvent(j.X.HumanError).pipe((0,l.p)(z=>!(0,P.isNil)(z))).subscribe(z=>{this.handleFatalEngineErrors(z)})}initEngineTickEvent(z){const ae=me=>{this.fireEvent(j.X.Tick,me)};z.renderer.on("animate",ae),z.on("destroy",()=>{z.renderer.off("animate",ae)})}initTweenVisibilityEvent(z){let ae={shown:{},shownSetByTween:{},variant:{}},me=!1;this.getEvent(j.X.TimelineAnimatingStart).pipe((0,$.Q)(this._engineDestroyed)).subscribe(()=>{me=!0,ae={shown:{},shownSetByTween:{},variant:{}}}),this.getEvent(j.X.TimelinePlaying).pipe((0,$.Q)(this._engineDestroyed)).subscribe(()=>{const{shownSetByTween:Ne,variant:Pe}=ae;Object.keys(Ne).length>0&&this.fireEvent(j.X.TweenVisibilityUpdate,Ne),Object.keys(Pe).length>0&&this.fireEvent(j.X.VariantsUpdate,Pe),me=!1,ae={shown:{},shownSetByTween:{},variant:{}}}),z.on("changestory",()=>{const Ne=Qe=>{const St=Qe?.property,De=Qe?.object,lt=De?.objectId;if(St in ae&&(ae[St][lt]=De[St],"shown"===St&&me)){const{shown:je}=De;ae.shownSetByTween[lt]=je}},{anatomyObjects:Pe}=z.story.anatomySceneGraph;Pe.forEach(Qe=>{Qe.on("change",Ne)})}),z.on("changechapter",()=>{const{anatomyObjects:Ne}=z.story.anatomySceneGraph,Pe={shown:{},shownSetByTween:{},variant:{}};Ne.forEach(St=>function k(de,oe){for(const ye in de)ye in oe&&(de[ye][oe.objectId]=oe[ye])}(Pe,St));const{variant:Qe}=Pe;this.fireEvent(j.X.VariantsUpdate,Qe)})}registerEngineWorkers(){new Worker(_.tu(new URL(_.p+_.u(401),_.b))),(0,V.registerWorker)("geometry",()=>new Worker(_.tu(new URL(_.p+_.u(762),_.b)))),(0,V.registerWorker)("texture",()=>new Worker(_.tu(new URL(_.p+_.u(235),_.b)))),(0,V.registerWorker)("simulation",()=>new Worker(_.tu(new URL(_.p+_.u(513),_.b))))}handleFatalEngineErrors(z){const{message:ae,name:me,stack:Ne}=z,Pe={name:me,message:ae,stack:Ne},Qe={...this.gpuAnalytic,error_category:me,error_message:JSON.stringify({message:ae,stack:Ne})};h.c.offline&&(Qe.event_timestamp=(new Date).toISOString().substring(0,19)),this.errorLogged||(this.rollbar.error(z),this.http.post("/ws/product/error/gpu-event",Qe,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(),this.errorLogged=!0),this.errorService.redirectToErrorPage(B.Y.Engine,void 0,Pe)}}return(de=oe).\u0275fac=function(z){return new(z||de)(ce.KVO(H.I),ce.KVO(W.n$),ce.KVO(x),ce.KVO(K.Qq),ce.KVO(F.g8))},de.\u0275prov=ce.jDH({token:de,factory:de.\u0275fac,providedIn:"root"}),oe})()},62943:(Se,J,_)=>{"use strict";_.d(J,{T4:()=>j,iu:()=>l,tH:()=>X,ty:()=>$});var c=_(11789);function l(h){if(!Object.keys(h).length)return null;const W=[...h.colors];W.forEach((P,p)=>{W[p]=(p+1)%4&&P<=1?Math.round(255*P):P});const B=/radial|linear/.test(h.gradientType)?h.gradientType:"radial",H=h.colorStops,V=Array.isArray(H)&&2===H.length?[H[0],H[1]]:[0,100];return{colors:W,gradientType:B,colorStops:V}}function X(h){const W=h.colors,B=`rgba(${W[0]},${W[1]}, ${W[2]}, ${W[3]}) ${h.colorStops[0]}%`,H=`rgba(${W[4]},${W[5]}, ${W[6]}, ${W[7]}) ${h.colorStops[1]}%`;return"radial"===h.gradientType?`radial-gradient(circle, ${B}, ${H})`:`linear-gradient(180deg, ${B}, ${H})`}function $(h){if(!h||!h.colors)return!1;const W=h.colors,B=W[3];return W.length<=4?0===B:0===B&&0===W[7]}function j(h){const W=h?.colors;if(Array.isArray(W)){const B=W.slice(0,3);return c.T.isLight(B)}return!1}},2353:(Se,J,_)=>{"use strict";_.d(J,{L:()=>l,n:()=>O});var c=_(49204);function O(X){const{xmin:U,ymin:$,zmin:j,xmax:h,ymax:W,zmax:B}=X;return{min:[U,$,j],max:[h,W,B]}}function l(X){if((0,c.isNil)(X))return!1;{const U=Object.values(X);return 6===U.length&&U.every($=>Number.isFinite($))}}},57021:(Se,J,_)=>{"use strict";_.d(J,{x:()=>c});class c{constructor(O=0,l=0,X=0,U=0,$=0,j=!1){this.zoom=O,this.panX=l,this.panY=X,this.rotateX=U,this.rotateY=$,this.applyFriction=j}}},73987:(Se,J,_)=>{"use strict";_.d(J,{h:()=>c});var c=function(e){return e[e.Tiny=0]="Tiny",e[e.Small=1]="Small",e[e.Standard=2]="Standard",e}(c||{})},515:(Se,J,_)=>{"use strict";_.d(J,{X:()=>c});var c=function(e){return e.Started="started",e.Loaded="loaded",e.Tick="tick",e.HumanReady="human.ready",e.HumanStarted="started",e.Error="error",e.HumanError="human.error",e.CanvasResized="canvas.resized",e.HumanCanvasResized="human.canvasResized",e.LogDebug="_log.debug",e.LogError="_log.error",e.LogInfo="_log.info",e.LogWarn="_log.warn",e.SceneLoaded="scene.loaded",e.HumanProgress="human.progress",e.AssetsLoadFinish="assets.load.finish",e.AssetsLoadProgress="assets.load.progress",e.AssetsLoadStart="assets.load.start",e.CameraRested="camera.rested",e.CameraUpdated="camera.updated",e.ModuleInteractive="module.interactive",e.ModulesActivateFinish="modules.activate.finish",e.ModulesCreateFinish="modules.create.finish",e.ModulesDestroyFinish="modules.destroy.finish",e.ModulesFetchStart="modules.fetch.start",e.PickPicked="pick.picked",e.SceneMarkersUpdated="scene.markers.updated",e.SceneObjectRenderable="scene.objectRenderable",e.SceneObjectsSelected="scene.objectsSelected",e.SceneObjectsShown="scene.objectsShown",e.ScenePicked="scene.picked",e.SceneRestored="scene.restored",e.SceneXrayEnabled="scene.xrayEnabled",e.SceneXrayDisabled="scene.xrayDisabled",e.SceneReady="scene.ready",e.TimelineChapterTransition="timeline.chapterTransition",e.TimelinePlaying="timeline.playing",e.TimelineScrubbed="timeline.scrubbed",e.TimelinePlayed="timeline.played",e.TimelinePaused="timeline.paused",e.TimelineCompleted="timeline.completed",e.TimelineTimeFrameUpdated="timeline.timeFrame.updated",e.TimelineAnimatingStart="timeline.animating.start",e.TimelineAnimatingEnd="timeline.animating.end",e.GraphAssetAttachFinish="graph.assetAttach.finish",e.TweenVisibilityUpdate="TweenVisibilityUpdate",e.VariantsUpdate="VariantsUpdate",e}(c||{})},24911:(Se,J,_)=>{"use strict";_.d(J,{j:()=>c});class c{constructor(O,l,X,U,$,j,h,W){this.viewportWidth=O,this.viewportHeight=l,this.left=X,this.top=U,this.width=$,this.height=j,this.visibility=h,this.scale=W}}},4664:(Se,J,_)=>{"use strict";_.d(J,{g:()=>c});var c=function(e){return e[e.Hidden=-1]="Hidden",e[e.Shown=1]="Shown",e}(c||{})},20458:(Se,J,_)=>{"use strict";_.d(J,{EC:()=>H,NR:()=>e,Rn:()=>l});var c=_(1367);const e={label:"Original",tintColor:!1,saturation:!1,contrast:!1,brightness:!1,opacity:!1},l={tintColor:[1,0,0],saturation:!1,contrast:!1,brightness:!1,opacity:!1},H={label:"Fade",tintColor:[0,0,0],contrast:!1,brightness:55,saturation:-100,opacity:new c.R({edge:1,center:0,edgeBias:0,centerBias:1,power:1})}},13878:(Se,J,_)=>{"use strict";_.d(J,{M:()=>c});var c=function(e){return e.Capture="capture",e.DoNotCaptureShowMessage="do_not_capture_show_message",e.DoNotCapture="do_not_capture",e}(c||{})},1308:(Se,J,_)=>{"use strict";_.d(J,{F$:()=>$,_:()=>U});var c=_(20342),e=_(10352),O=_(9592),l=_(62943);const U={imageType:O.H.JPEG,crop:"original",copyrightEnabled:!1,copyrightImagePath:c.O.viewer.full_dark.logo_url,copyrightPosition:{x:"left",y:"bottom"},copyrightOffset:{x:12,y:-12},imageQuality:1};function $(j,h){return j===O.H.PNG?h||e.RK:h&&!(0,l.ty)(h)?h:e.RK}},47555:(Se,J,_)=>{"use strict";_.d(J,{s:()=>c});var c=function(e){return e.Select="Select",e.Hide="Hide",e.Paint="Paint",e.Eyedropper="Eyedropper",e.Label="Label",e.Isolate="Isolate",e.Fade="Fade",e.Positions="Positions",e.Quiz="Quiz",e.Image="Image",e.Dimensions="Dimensions",e.Background="Background",e}(c||{})},22959:(Se,J,_)=>{"use strict";_.d(J,{w:()=>D});var c=_(65763),e=_(78109),O=_(75069),l=_(3266),X=_(20458),U=_(35650),$=_(81025),h=_(7431),W=_(3829),B=_(55494),H=_(61295),V=_(13409),P=_(12865);class p{}var Y,y,w=_(81881),F=function(ne){return ne[ne.Modify=0]="Modify",ne[ne.Replace=1]="Replace",ne}(F||{}),R=_(58398),N=_(17215),M=_(49204),u=_(1102),g=_(85586),E=_(59676),C=_(59429),A=_(54438),Z=function(ne,m,ce,I){var ie,x=arguments.length,K=x<3?m:null===I?I=Object.getOwnPropertyDescriptor(m,ce):I;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)K=Reflect.decorate(ne,m,ce,I);else for(var k=ne.length-1;k>=0;k--)(ie=ne[k])&&(K=(x<3?ie(K):x>3?ie(m,ce,K):ie(m,ce))||K);return x>3&&K&&Object.defineProperty(m,ce,K),K},Q=function(ne,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ne,m)};const b={currentRecipe:X.Rn,brushMode:F.Replace,storyRecipes:{},recentRecipes:[],uniqueStoryRecipes:[],palettes:[]};let S=(y=Y=class{static getCurrentRecipe(m){return m.currentRecipe}static getCurrentRecipeForEngine(m){return(0,u.Sf)(m.currentRecipe)}static getPaintBrushMode(m){return m.brushMode}static getRecentRecipes(m){return m.recentRecipes}static getStoryRecipes(m){return m.storyRecipes}static getUniqueStoryRecipes(m){return m.uniqueStoryRecipes}static getPalettes(m){return m.palettes}static getCurrentChapterRecipes(m,ce){return m.storyRecipes[ce.selectedChapter]}static getChapterRecipes(m){return(0,c.Mz)([y],ce=>ce.storyRecipes[m])}setCurrentRecipe(m,{colorRecipe:ce}){m.patchState({currentRecipe:ce})}setBrushMode(m,ce){m.patchState({brushMode:ce.brushMode})}clearCurrentRecipe(m,ce){m.patchState({currentRecipe:null})}resetPaint(m,ce){m.setState(b)}addRecentRecipe(m,ce){let I=m.getState().recentRecipes;I.some(K=>(0,R.n4)(K,ce.recipe))||(I.splice(0,0,ce.recipe),I.length>14&&(I=I.slice(0,14)),this.storageService.setLocalItem(N.UT.RecentRecipes,I),m.patchState({recentRecipes:[...I]}))}setRecentRecipes(m,ce){const I=(0,M.isNil)(ce.recipes)?[]:[...ce.recipes];m.patchState({recentRecipes:I}),this.storageService.setLocalItem(N.UT.RecentRecipes,I)}setStoryRecipesForChapter(m,ce){const I=(0,R.c7)(ce.recipes),x=m.getState().storyRecipes;x[ce.chapterId]=[...I],m.patchState({storyRecipes:x});const K=Object.values(x).reduce((k,le)=>[...k,...le],[]),ie=(0,R.c7)(K).sort(R.UD);m.patchState({uniqueStoryRecipes:ie})}resetStoryRecipes(m,ce){m.patchState({storyRecipes:{}})}addPalette(m,ce){ce.palette.id=C.u.idWithPrefix("palette");const I=[...m.getState().palettes,ce.palette];m.dispatch(new w.T2(I))}updatePalette(m,ce){const I=m.getState().palettes,x=I.findIndex(K=>K.id===ce.palette.id);x>=0&&(I[x]={...ce.palette}),m.dispatch(new w.T2(I))}removePalette(m,ce){const I=[...m.getState().palettes.filter(x=>x.id!==ce.paletteId)];m.dispatch(new w.T2(I))}setPalettes(m,ce){const I=(0,M.cloneDeep)(ce.palettes?[...ce.palettes]:[]);m.patchState({palettes:I}),localStorage.setItem(N.UT.PaintPalettes,JSON.stringify(I))}addRecipeToPalette(m,ce){const I=m.getState().palettes,x=I.findIndex(K=>K.id===ce.paletteId);x>=0&&I[x].recipes.push(ce.recipe),m.dispatch(new w.T2(I))}togglePalette(m,ce){const I=m.getState().palettes,x=I.findIndex(K=>K.id===ce.paletteId);x>=0&&(I[x].open=(0,M.isNil)(ce.open)?!I[x].open:ce.open,m.dispatch(new w.T2(I)))}ngxsOnInit(m){}constructor(m){this.storageService=m}},Y.\u0275fac=function(m){return new(m||Y)(A.KVO(N.n$))},Y.\u0275prov=A.jDH({token:Y,factory:Y.\u0275fac}),Y);Z([(0,c.rc)(w.WD),Q("design:type",Function),Q("design:paramtypes",[Object,w.WD]),Q("design:returntype",void 0)],S.prototype,"setCurrentRecipe",null),Z([(0,c.rc)(w.GG),Q("design:type",Function),Q("design:paramtypes",[Object,w.GG]),Q("design:returntype",void 0)],S.prototype,"setBrushMode",null),Z([(0,c.rc)(w.Hr),Q("design:type",Function),Q("design:paramtypes",[Object,w.Hr]),Q("design:returntype",void 0)],S.prototype,"clearCurrentRecipe",null),Z([(0,c.rc)(w.yk),Q("design:type",Function),Q("design:paramtypes",[Object,w.yk]),Q("design:returntype",void 0)],S.prototype,"resetPaint",null),Z([(0,c.rc)(w.Df),Q("design:type",Function),Q("design:paramtypes",[Object,w.Df]),Q("design:returntype",void 0)],S.prototype,"addRecentRecipe",null),Z([(0,c.rc)(w.Nf),Q("design:type",Function),Q("design:paramtypes",[Object,w.Nf]),Q("design:returntype",void 0)],S.prototype,"setRecentRecipes",null),Z([(0,c.rc)(w.b8),Q("design:type",Function),Q("design:paramtypes",[Object,w.b8]),Q("design:returntype",void 0)],S.prototype,"setStoryRecipesForChapter",null),Z([(0,c.rc)(w.yE),Q("design:type",Function),Q("design:paramtypes",[Object,w.yE]),Q("design:returntype",void 0)],S.prototype,"resetStoryRecipes",null),Z([(0,c.rc)(w.hd),Q("design:type",Function),Q("design:paramtypes",[Object,w.hd]),Q("design:returntype",void 0)],S.prototype,"addPalette",null),Z([(0,c.rc)(w.ut),Q("design:type",Function),Q("design:paramtypes",[Object,w.ut]),Q("design:returntype",void 0)],S.prototype,"updatePalette",null),Z([(0,c.rc)(w.yG),Q("design:type",Function),Q("design:paramtypes",[Object,w.yG]),Q("design:returntype",void 0)],S.prototype,"removePalette",null),Z([(0,c.rc)(w.T2),Q("design:type",Function),Q("design:paramtypes",[Object,w.T2]),Q("design:returntype",void 0)],S.prototype,"setPalettes",null),Z([(0,c.rc)(w.yJ),Q("design:type",Function),Q("design:paramtypes",[Object,w.yJ]),Q("design:returntype",void 0)],S.prototype,"addRecipeToPalette",null),Z([(0,c.rc)(w.wx),Q("design:type",Function),Q("design:paramtypes",[Object,w.wx]),Q("design:returntype",void 0)],S.prototype,"togglePalette",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getCurrentRecipe",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getCurrentRecipeForEngine",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getPaintBrushMode",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getRecentRecipes",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getStoryRecipes",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getUniqueStoryRecipes",null),Z([(0,c.MD)(),Q("design:type",Function),Q("design:paramtypes",[p]),Q("design:returntype",void 0)],S,"getPalettes",null),Z([(0,c.MD)([g.N]),Q("design:type",Function),Q("design:paramtypes",[p,E.G]),Q("design:returntype",void 0)],S,"getCurrentChapterRecipes",null),S=y=Z([(0,c.Uw)({name:"editPaint",defaults:b}),Q("design:paramtypes",[N.n$])],S);var v=_(18617);let D=(()=>{var ne;class m{constructor(I,x,K,ie,k){this.store=I,this.graphService=x,this.cameraService=K,this.sceneService=ie,this.liveAnnouncer=k}applyCurrentRecipe(I){const x=this.store.selectSnapshot(S.getCurrentRecipe);if(!x)return;Object.entries(x).forEach(([ie,k])=>{typeof k>"u"&&(x[ie]=!1)}),this.store.dispatch(new H.Jp(x,I));const K=I.reduce((ie,k)=>(ie[k]=!1,ie),{});this.sceneService.setNodesProperty(K,"selected")}fadeInverse(I){const x=this.store.selectSnapshot(B.S.getViewGraph),K=this.graphService.getInverseSelection(x,I),ie=this.graphService.getNodes(x,K);this.store.dispatch(new H.Jp(X.EC,ie.map(k=>k.id))).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}fade(I){this.store.dispatch(new H.Jp(X.EC,I)).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}hideInverse(I){const x=this.store.selectSnapshot(B.S.getViewGraph),K=this.graphService.getAllLeafDescendants(x,I),ie=this.graphService.getInverseSelection(x,I),k={};K.forEach(me=>{k[me]=!0}),ie.forEach(me=>{k[me]=!1});const le=new H.yr(void 0,void 0,k),de=(0,P.r)(this.store.selectSnapshot(V.z),le,this.sceneService);this.store.dispatch(new H.NP(de.patches));const oe=this.sceneService.getObjectBoundary(I),ye=this.cameraService.getCameraAfterFlyTo(oe),z=new h.Yp(ye),ae=function j(ne,m){const[ce,I,x]=$.vI(ne,K=>{K.cameraFlyTo=m.camera});return{nextState:ce,patches:I,inversePatches:x}}(this.store.selectSnapshot(W.x),z);this.store.dispatch(new h.sQ(ae.patches)).subscribe(()=>{this.liveAnnouncer.announce("Isolate complete")}),this.store.dispatch(new H.hg),this.store.dispatch(new H.q9(!1)),this.store.dispatch(new O.a.SavePatches([{forward:de.patches,inverse:de.inversePatches,patchAction:H.NP},{forward:ae.patches,inverse:ae.inversePatches,patchAction:h.sQ}]))}}return(ne=m).\u0275fac=function(I){return new(I||ne)(A.KVO(c.il),A.KVO(e.w),A.KVO(l.j),A.KVO(U.w),A.KVO(v.Ai))},ne.\u0275prov=A.jDH({token:ne,factory:ne.\u0275fac,providedIn:"root"}),m})()},60286:(Se,J,_)=>{"use strict";_.d(J,{s:()=>U});var c=_(78109),e=_(1102),O=_(35650),X=_(54438);let U=(()=>{var $;class j{constructor(W,B){this.graphService=W,this.sceneService=B,this.highlightDisabled=!1}colorObject(W,B){const H=this.sceneService.getObjectById(W);if(this.sceneService.isLeaf(H)){const V=H.modifiers;Object.keys(B).forEach(P=>{const p=B[P];if(!1===p)V.delete(P);else if(Array.isArray(p)&&5===p.length){const[w,F,R,N,M]=p;V.set(P,{applyTo:P,fresnel:{center:w,edge:F,centerBias:R,edgeBias:N,power:M}})}else V.set(P,{applyTo:P,value:p})})}}getColor(W){return function l($,j){const h=$.getObjectById(j);if($.isLeaf(h)){const B={};return h.modifiers.forEach(H=>{B[H.applyTo]=H.fresnel??H.value}),B}return null}(this.sceneService,W)}uncolorObject(W){const B=this.sceneService.getObjectById(W);this.sceneService.isLeaf(B)&&B.modifiers.clear()}unpaint(W,B){this.graphService.getLeafDescendants(W,B.id).forEach(H=>{const V=this.sceneService.getObjectById(H);this.sceneService.isLeaf(V)&&V.modifiers.clear()})}paint(W,B,H){const V=(0,e.Sf)(H);this.graphService.getLeafDescendants(W,B).forEach(P=>{this.colorObject(P,V)})}highlight(W,B,H){(!1===this.highlightDisabled||!1===H)&&this.graphService.getLeafDescendants(W,B).forEach(V=>{const P=this.sceneService.getObjectById(V);this.sceneService.isLeaf(P)&&(P.selected=H)})}paintAll(W,B,H){B.forEach(V=>this.paint(W,V,H))}unpaintAll(W,B){B.forEach(H=>{this.unpaint(W,H)})}highlightAll(W,B,H){B.forEach(V=>this.highlight(W,V,H))}disableHighlight(){this.highlightDisabled=!0}enableHighlight(){this.highlightDisabled=!1}setHighlightColor(W){}getColorRecipes(){return[]}}return($=j).\u0275fac=function(W){return new(W||$)(X.KVO(c.w),X.KVO(O.w))},$.\u0275prov=X.jDH({token:$,factory:$.\u0275fac,providedIn:"root"}),j})()},5188:(Se,J,_)=>{"use strict";_.d(J,{j:()=>O});var c=_(72849),e=_(54438);let O=(()=>{var l;class X{constructor($){this.engineService=$}setPostProcessingFeatures($){const{renderer:j,story:h}=this.engineService.engine;h?.activeChapter&&(h.activeChapter.postProcess.length=0,h.activeChapter.postProcess.push(...$)),j.setPostProcessingPipeline($)}}return(l=X).\u0275fac=function($){return new($||l)(e.KVO(c.y))},l.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),X})()},35650:(Se,J,_)=>{"use strict";_.d(J,{w:()=>F});var c=_(2353),e=_(38472),O=_(44867),l=_(23881),X=_(78109),U=_(72849),$=_(11724),h=_(46889),W=_(49204),H=_(56343),V=_(54438);const P=1/$.BIODIGITAL_SCENE_SCALE,p=new $.AABB,w={shown:H.t.TrueWins,renderable:H.t.FalseWins,pickable:H.t.TrueWins};let F=(()=>{var R;class N{constructor(u,g){this.engineService=u,this.graphService=g}getObjects(){const u={};return this.getAnatomySceneGraph()?.anatomyObjects.forEach((E,C)=>u[C]=E),u}getObjectById(u){return this.getAnatomySceneGraph()?.anatomyObjects?.get(u)}getObjectsById(u){const E=this.getAnatomySceneGraph()?.anatomyObjects;return u.reduce((C,A)=>{const Y=E?.get(A);return Y&&(C[Y.objectId]=Y),C},{})}isObjectLoaded(u){return!0===this.getObjectById(u)?.loaded}isObjectCulledByClip(u,g){if(0===g.length)return!1;const E=g.map(C=>C.plane);return u.renderables.some(C=>(0,$.boxIntersectsPlaneBounds)(E,C.meshNode.worldBounds))}getRootObjects(){return this.getAnatomySceneGraph()?.anatomyRoots??[]}getSceneBoundary(){const{rootNode:u}=this.engineService.engine;return this.getSceneNodeBoundaryModel([u],p)}getObjectBoundary(u){const g=u.map(E=>this.getObjectById(E).sceneNode);return this.getSceneNodeBoundaryModel(g,p)}getObjectBoundaryCenter(u){const g=this.getObjectBoundary([u]),{min:E,max:C}=(0,c.n)(g);return(0,h.A1)(E,C)}setShownObjects(u){const{replace:g,showObjects:E}=u,C=this.getRootObjects();this.setObjectsShown(C,E,!g&&void 0)}getLeavesByObject(u){const g=u.children??[];return 0===g.length?[u]:g.map(E=>this.getLeavesByObject(E)).flat()}getLeaves(u){if(u){const g=this.getObjectById(u);return g?this.getLeavesByObject(g):[]}return this.getRootObjects().map(E=>this.getLeavesByObject(E)).flat()}getLeafIds(u){return this.getLeaves(u).map(g=>g.objectId)}getEnabledLeafIds(){return this.getLeaves().filter(u=>!0===u?.shown).map(u=>u.objectId)}isLeaf(u){return 0===u.children.length}transformObject(u,g){const E=this.getObjectById(u)?.sceneNode;E?(0,$.applyTransform)(E,g):console.error(`Scene node not found: '${u}'`)}setNodesVisible(u,g=!1){const E={replace:g,showObjects:{...u}};this.setShownObjects(E)}setNodesProperty(u,g){Object.keys(u).forEach(E=>{const C=this.getObjectById(E);(this.isLeaf(C)?[E]:this.getLeafIds(E)).forEach(Y=>{this.getObjectById(Y)[g]=u[E]})})}setObjectLayer(u,g,E){u.get(g).layer=E}setObjectVariant(u,g,E){u.get(g).variant=E}getObjectLayerValues(u){const g={},E=this.getSceneBoundary();return u.forEach(C=>{const A=this.getObjectById(C),Y=this.getObjectBoundary([C]),Z=Math.min(Y.xmin-E.xmin,E.xmax-Y.xmax),Q=2*Math.min(Y.ymin-E.ymin,E.ymax-Y.ymax),y=Math.min(Y.zmin-E.zmin,E.zmax-Y.zmax),b=A.layer;g[b]=g[b]??[],g[b].push({nodeId:C,value:Math.min(Z,Q,y)})}),g}getWorldPosition(u,g,E,C=0){const Y=this.getObjectById(u)?.renderables[C]?.meshNode;if((0,W.isNil)(Y))return;const Z=Y.worldMatrix,Q=e.create(),y=$.vec3Pool.get(),b=$.vec3Pool.get(),S=$.vec3Pool.get();return(0,$.getTrianglePositions)(Y,g,y,b,S),(0,$.cartesianCoord)(Q,E,y,b,S),e.transformMat4(Q,Q,Z),e.scale(Q,Q,1/$.BIODIGITAL_SCENE_SCALE),$.vec3Pool.release(y),$.vec3Pool.release(b),$.vec3Pool.release(S),Q}getSceneGraph(u){const{anatomyObjects:g}=this.getAnatomySceneGraph(),E={...(0,l.ow)(),shown:A=>!0===g.get(A)?.shown,pickable:A=>!0===g.get(A)?.pickable,label:A=>g.get(A)?.displayName??"",layer:A=>g.get(A)?.layer??0},C=(0,O.fm)(u,E);return this.graphService.synchronize(C,w),C}createViewGraph({availableObjects:u,showObjects:g,includeRoot:E=!1,viewGraphMetadata:C}){const A=this.getRootObjects(),Y=g?(0,O.TJ)(A,g):A,Z=Y.reduce((y,b)=>{const S=!E&&b.objectId.includes("-root");return y[b.objectId]=!S,S&&b.children.forEach(v=>{y[v.objectId]=!0}),y},{}),Q=this.getSceneGraph((0,O.TJ)(Y,Z));return this.graphService.resetDepth(Q),(0,W.isEmpty)(u)||this.computeObjectAvailable(Q,u),(0,W.isEmpty)(C)||this.computeNodesMetadata(Q,C),Q}computeObjectAvailable(u,g){const{anatomyObjects:E}=this.getAnatomySceneGraph(),C=Y=>E.get(Y).parent?.objectId,A=Y=>{const Z=E.get(Y);return Z?Z.children.map(Q=>Q.objectId):[]};Object.entries(u.nodes).forEach(([Y,Z])=>{Z.boolState.available=(0,O.If)(Y,g,C,A)})}computeNodesMetadata(u,g){(0,O.u7)(u,g)}getViewNode(u,g){return this.graphService.nodeExists(u,g)?(0,O.dV)(u,g):null}setObjectsShown(u,g,E){u.forEach(C=>{const Y=g[C.objectId]??E;"boolean"==typeof Y&&C.shown!==Y&&(C.shown=Y),this.setObjectsShown(C.children,g,E)})}getSceneNodeBoundaryModel(u,g){const{min:E,max:C}=this.getSceneNodeBounds(u,g);return e.scale(E,E,P),e.scale(C,C,P),{xmin:E[0],ymin:E[1],zmin:E[2],xmax:C[0],ymax:C[1],zmax:C[2]}}getSceneNodeBounds(u,g){return g.clear(),u.forEach(E=>{(0,$.traverseSceneNodes)(E,C=>{C instanceof $.MeshNode&&g.expand(C.worldBounds)})}),g}getChapterIndex(u){return this.engineService.engine.story?.chapters?.findIndex(C=>C.id===u)}getChapter(u){const g=this.engineService.engine?.story,E=g?.chapters,C=g?.activeChapterIndex;return E?.[u??C]}getAnatomySceneGraph(){return this.engineService.engine?.story?.anatomySceneGraph}}return(R=N).\u0275fac=function(u){return new(u||R)(V.KVO(U.y),V.KVO(X.w))},R.\u0275prov=V.jDH({token:R,factory:R.\u0275fac,providedIn:"root"}),N})()},30582:(Se,J,_)=>{"use strict";_.d(J,{M:()=>F});var c=_(28407),e=_(21472),O=_(15877),l=_(35892),X=_(2573),U=_(65763),$=_(36110),j=_(65533),h=_(11756),W=_(28577),B=_(8358),H=_(42482),V=_(5188),P=_(46799),p=_(3266),w=_(54438);let F=(()=>{var R;class N{constructor(u,g,E,C,A){this.labelsService=u,this.postProcessingService=g,this.engineRendererService=E,this.cameraService=C,this.store=A}localResize(u,g){const E=this.engineRendererService.getCanvas(),C=E.parentNode,A=C.clientWidth,Y=C.clientHeight;return E.width=u,E.height=g,C.style.width=`${u}px`,C.style.height=`${g}px`,[A,Y]}canvasToImage(u,g="original",E){var C=this;return(0,c.A)(function*(){const{width:A,height:Y}=u,Z=u.getContext("2d"),Q=C.labelsService.getLabelContainer().nativeElement,y=u.width/u.height,b=C.engineRendererService.getCanvas();let{width:S,height:v}=b,D=.5*(b.width-S),ne=0;switch(g){case"square":v>S?v=S:S=v,D=.5*(b.width-S),ne=.5*(b.height-v);break;case"original":S=y*v}return C.engineRendererService.forceRenderFrame(),Z.drawImage(b,D,ne,S,v,0,0,A,Y),E&&Q?new Promise(requestAnimationFrame).then((0,c.A)(function*(){const m=yield H.X.elementToCanvas(Q,!0);return Z.drawImage(m,D,ne,S,v,0,0,A,Y),u})):u})()}canvasToImageWithResize(u,g){var E=this;return(0,c.A)(function*(){const{width:C,height:A}=u,Y=E.engineRendererService.getCanvas(),Z=u.getContext("2d"),Q=E.labelsService.getLabelContainer().nativeElement,[y,b]=E.localResize(C,A);return E.engineRendererService.forceRenderFrame(),Z.drawImage(Y,0,0,C,A),g&&Q?new Promise(requestAnimationFrame).then((0,c.A)(function*(){const S=yield H.X.elementToCanvas(Q,!0);return Z.drawImage(S,0,0,C,A),E.localResize(y,b),u})):(E.localResize(y,b),u)})()}drawRadialGradient(u,g){const E=g.colors,[A,Y]=g.colorStops.map(S=>((S,v,D)=>{const[ne,m]=[Math.pow(v/2,2),Math.pow(D/2,2)];return S/100*Math.pow(ne+m,.5)})(S,u.width,u.height)),Z=u.getContext("2d"),[Q,y]=[u.width/2,u.height/2],b=Z.createRadialGradient(Q,y,A,Q,y,Y);b.addColorStop(g.colorStops[0]/100,`rgba(${E.slice(0,4).join(",")})`),b.addColorStop(g.colorStops[1]/100,`rgba(${E.slice(4,8).join(",")})`),Z.fillStyle=b,Z.fillRect(0,0,u.width,u.height)}drawLinearGradient(u,g){const E=g.colors,C=u.getContext("2d"),[A,Y]=[u.width/2,u.height/2],Z=C.createLinearGradient(A,Y,A,u.height);Z.addColorStop(g.colorStops[0]/100,`rgba(${E.slice(0,4).join(",")})`),Z.addColorStop(g.colorStops[1]/100,`rgba(${E.slice(4,8).join(",")})`),C.fillStyle=Z,C.fillRect(0,0,u.width,u.height)}takeSnapshot(u,g,E,C,A,Y,Z=1){const{imageType:Q,imageQuality:y,copyrightEnabled:b,crop:S}=Y,v=document.createElement("canvas");v.width=u,v.height=g,"radial"===E.gradientType?this.drawRadialGradient(v,E):"linear"===E.gradientType&&this.drawLinearGradient(v,E);const D=this.engineRendererService.getCanvas(),m=[],ce=1!==Z||v.height>D.height||v.width>D.width?this.canvasToImageWithResize(v,A):this.canvasToImage(v,S,A),I=(0,e.H)(ce);m.push(I);const x=[...C];return m.push(...x.map(K=>(K instanceof HTMLCanvasElement?(0,O.of)(K):(0,e.H)(H.X.elementToCanvas(K,!0))).pipe((0,$.T)(k=>H.X.fitCanvas(k,u,g))))),this.engineRendererService.forceRenderFrame(),(0,l.x)(m).pipe((0,j.p)(),(0,$.T)(K=>H.X.combineCanvasElements(K)),(0,h.Z)(K=>b?this.writeLogoToCanvas(K,Y):(0,O.of)(K)),(0,h.Z)(K=>H.X.canvasToBlob(K,Q,y)))}writeLogoToCanvas(u,g){return this.getLogoImage(g.copyrightImagePath).pipe((0,$.T)(E=>{let{width:C,height:A}=E;const{width:Y,height:Z}=u;if(.1*Y>C){const S=A/C;C=.1*Y,A=S*C}const{xOffset:Q,yOffset:y}=this.getLogoPosition(Y,Z,C,A,g);return u.getContext("2d").drawImage(E,Q,y,C,A),u}),(0,W.W)(()=>(0,O.of)(u)))}getLogoImage(u){return new X.c(g=>{const E=new Image;E.onload=()=>{g.next(E),g.complete()},E.onerror=()=>g.error(),E.src=u})}getLogoPosition(u,g,E,C,A){const{copyrightPosition:Y,copyrightOffset:Z}=A;let Q,y;switch(Y.x){case"right":Q=u-E;break;case"center":Q=u/2-E/2;break;default:Q=0}switch(Y.y){case"bottom":y=g-C;break;case"center":y=g/2-C/2;break;default:y=0}return{xOffset:Q+Z.x,yOffset:y+Z.y}}}return(R=N).\u0275fac=function(u){return new(u||R)(w.KVO(B.x),w.KVO(V.j),w.KVO(P.z),w.KVO(p.j),w.KVO(U.il))},R.\u0275prov=w.jDH({token:R,factory:R.\u0275fac,providedIn:"root"}),N})()},7431:(Se,J,_)=>{"use strict";_.d(J,{F5:()=>h,Ih:()=>O,Nz:()=>l,P4:()=>U,Qn:()=>X,RG:()=>W,RJ:()=>p,Xz:()=>F,Yi:()=>B,Yp:()=>N,bB:()=>H,bJ:()=>c,d_:()=>e,j4:()=>V,nW:()=>$,pU:()=>R,pg:()=>j,qG:()=>P,sQ:()=>M,vq:()=>w});let c=(()=>{class g{constructor(C){this.id=C}}return g.type="[Engine Camera] Clear Camera",g})(),e=(()=>{class g{constructor(C,A){this.id=C,this.camera=A}}return g.type="[Engine Camera] Store Camera",g})(),O=(()=>{class g{constructor(C,A=!0,Y,Z){this.camera=C,this.animate=A,this.animationDuration=Y,this.rotationCenter=Z}}return g.type="[Engine Camera] Set Camera",g})(),l=(()=>{class g{constructor(){}}return g.type="[Engine Camera] Set Camera Success",g})(),X=(()=>{class g{constructor(C){this.enabled=C}}return g.type="[Engine Camera] Set Chapter Camera Enabled",g})(),U=(()=>{class g{constructor(C){this.cameraMotion=C}}return g.type="[Engine Camera] Move Camera",g})(),$=(()=>{class g{constructor(){}}return g.type="[Engine Camera] Reset Camera",g})(),j=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Zoom Camera",g})(),h=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Zoom Camera Static",g})(),W=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Pan Camera X",g})(),B=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Pan Camera Y",g})(),H=(()=>{class g{constructor(C,A,Y){this.x=C,this.y=A,this.z=Y}}return g.type="[Engine Camera] Pan Camera Static",g})(),V=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Rotate Camera X",g})(),P=(()=>{class g{constructor(C){this.value=C}}return g.type="[Engine Camera] Rotate Camera Y",g})(),p=(()=>{class g{constructor(C,A){this.x=C,this.y=A}}return g.type="[Engine Camera] Rotate Camera Static",g})(),w=(()=>{class g{constructor(C){this.mode=C}}return g.type="[Engine Camera] Set Camera Mode",g})(),F=(()=>{class g{constructor(C){this.zoomed=C}}return g.type="[Engine Camera] Set Zoomed",g})(),R=(()=>{class g{constructor(C){this.lock=C}}return g.type="[Engine Camera] Lock camera",g})(),N=(()=>{class g{constructor(C){this.camera=C}}return g.type="[Engine Camera] Set Camera Fly To",g})(),M=(()=>{class g{constructor(C){this.patches=C}}return g.type="[Engine Camera] Patch Camera State",g})()},3829:(Se,J,_)=>{"use strict";_.d(J,{x:()=>R});var c=_(28407),e=_(65763);class O{}var V,w,l=_(7431),X=_(3266),U=_(57021),$=_(85586),j=_(81025),h=_(18617),W=_(72849),B=_(49204),H=_(54438),P=function(N,M,u,g){var A,E=arguments.length,C=E<3?M:null===g?g=Object.getOwnPropertyDescriptor(M,u):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(N,M,u,g);else for(var Y=N.length-1;Y>=0;Y--)(A=N[Y])&&(C=(E<3?A(C):E>3?A(M,u,C):A(M,u))||C);return E>3&&C&&Object.defineProperty(M,u,C),C},p=function(N,M){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(N,M)};const F={storedCameras:{},cameraMotion:new U.x,panMode:"rotate",zoomed:!1,lockCamera:!1,cameraFlyTo:void 0,chapterCameraEnabled:!0};let R=(w=V=class{static getStoredCamera(M){return(0,e.Mz)([w],u=>u.storedCameras[M]||null)}static getCameraMotion(M){return M.cameraMotion}static getPanMode(M){return M.panMode}static getZoomed(M){return M.zoomed}static getLockCamera(M){return M.lockCamera}static getChapterCameraEnabled(M){return M.chapterCameraEnabled}storeCamera(M,u){const g=u.camera||this.cameraService.getCamera(),E=M.getState().storedCameras;E[u.id]={...g},M.patchState({storedCameras:{...E}})}clearCamera(M,u){const g=M.getState().storedCameras;delete g[u.id],M.patchState({storedCameras:{...g}})}setCameraFlyTo(M,u){M.patchState(j.jM(M.getState(),g=>{g.cameraFlyTo=u.camera}))}applyCameraPatch(M,u){const g=j.$i(M.getState(),u.patches);M.patchState(g);const E=void 0===g.cameraFlyTo?this.store.selectSnapshot($.N.getChapterCamera):g.cameraFlyTo;M.dispatch(new l.Ih(E,!0,1))}moveCamera(M,u){M.patchState({cameraMotion:{...u.cameraMotion}})}resetCamera(M,u){var g=this;return(0,c.A)(function*(){const E=g.store.selectSnapshot($.N.getSelectedChapter);return((0,B.isNil)(g.engineService.engine?.story?.activeChapter)?Promise.resolve():g.cameraService.flyToCamera(E.camera.location)).then(()=>{M.patchState({cameraMotion:new U.x})})})()}zoomCamera(M,u){const{cameraMotion:g}=M.getState();g.zoom=u.value,M.patchState({cameraMotion:{...g}})}panCameraX(M,u){const{cameraMotion:g}=M.getState();g.panX=u.value,M.patchState({cameraMotion:{...g}})}panCameraY(M,u){const{cameraMotion:g}=M.getState();g.panY=u.value,M.patchState({cameraMotion:{...g}})}rotateCameraX(M,u){const{cameraMotion:g}=M.getState();M.patchState({cameraMotion:{...g,rotateX:u.value}})}rotateCameraY(M,u){const{cameraMotion:g}=M.getState();g.rotateY=u.value,M.patchState({cameraMotion:{...g}})}SetCameraMode(M,u){M.patchState({panMode:u.mode}),this.liveAnnouncer.announce(`Switched to ${u.mode} mode`)}setZoomed(M,u){M.patchState({zoomed:u.zoomed})}lockCamera(M,u){M.patchState({lockCamera:u.lock})}setChapterCameraEnabled(M,u){M.patchState({chapterCameraEnabled:u.enabled})}constructor(M,u,g,E){this.cameraService=M,this.liveAnnouncer=u,this.store=g,this.engineService=E}},V.\u0275fac=function(M){return new(M||V)(H.KVO(X.j),H.KVO(h.Ai),H.KVO(e.il),H.KVO(W.y))},V.\u0275prov=H.jDH({token:V,factory:V.\u0275fac}),V);P([(0,e.rc)(l.d_),p("design:type",Function),p("design:paramtypes",[Object,l.d_]),p("design:returntype",void 0)],R.prototype,"storeCamera",null),P([(0,e.rc)(l.bJ),p("design:type",Function),p("design:paramtypes",[Object,l.bJ]),p("design:returntype",void 0)],R.prototype,"clearCamera",null),P([(0,e.rc)(l.Yp),p("design:type",Function),p("design:paramtypes",[Object,l.Yp]),p("design:returntype",void 0)],R.prototype,"setCameraFlyTo",null),P([(0,e.rc)(l.sQ),p("design:type",Function),p("design:paramtypes",[Object,l.sQ]),p("design:returntype",void 0)],R.prototype,"applyCameraPatch",null),P([(0,e.rc)(l.P4),p("design:type",Function),p("design:paramtypes",[Object,l.P4]),p("design:returntype",void 0)],R.prototype,"moveCamera",null),P([(0,e.rc)(l.nW),p("design:type",Function),p("design:paramtypes",[Object,l.nW]),p("design:returntype",Promise)],R.prototype,"resetCamera",null),P([(0,e.rc)(l.pg),p("design:type",Function),p("design:paramtypes",[Object,l.pg]),p("design:returntype",void 0)],R.prototype,"zoomCamera",null),P([(0,e.rc)(l.RG),p("design:type",Function),p("design:paramtypes",[Object,l.RG]),p("design:returntype",void 0)],R.prototype,"panCameraX",null),P([(0,e.rc)(l.Yi),p("design:type",Function),p("design:paramtypes",[Object,l.Yi]),p("design:returntype",void 0)],R.prototype,"panCameraY",null),P([(0,e.rc)(l.j4),p("design:type",Function),p("design:paramtypes",[Object,l.j4]),p("design:returntype",void 0)],R.prototype,"rotateCameraX",null),P([(0,e.rc)(l.qG),p("design:type",Function),p("design:paramtypes",[Object,l.qG]),p("design:returntype",void 0)],R.prototype,"rotateCameraY",null),P([(0,e.rc)(l.vq),p("design:type",Function),p("design:paramtypes",[Object,l.vq]),p("design:returntype",void 0)],R.prototype,"SetCameraMode",null),P([(0,e.rc)(l.Xz),p("design:type",Function),p("design:paramtypes",[Object,l.Xz]),p("design:returntype",void 0)],R.prototype,"setZoomed",null),P([(0,e.rc)(l.pU),p("design:type",Function),p("design:paramtypes",[Object,l.pU]),p("design:returntype",void 0)],R.prototype,"lockCamera",null),P([(0,e.rc)(l.Qn),p("design:type",Function),p("design:paramtypes",[Object,l.Qn]),p("design:returntype",void 0)],R.prototype,"setChapterCameraEnabled",null),P([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[O]),p("design:returntype",void 0)],R,"getCameraMotion",null),P([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[O]),p("design:returntype",void 0)],R,"getPanMode",null),P([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[O]),p("design:returntype",void 0)],R,"getZoomed",null),P([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[O]),p("design:returntype",void 0)],R,"getLockCamera",null),P([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[O]),p("design:returntype",void 0)],R,"getChapterCameraEnabled",null),R=w=P([(0,e.Uw)({name:"engineCamera",defaults:F}),p("design:paramtypes",[X.j,h.Ai,e.il,W.y])],R)},20339:(Se,J,_)=>{"use strict";_.d(J,{Z:()=>c});let c=(()=>{class O{constructor(X){this.showUnavailableNodes=X}}return O.type="[Engine Config] Set Show Unavailable Nodes",O})()},43631:(Se,J,_)=>{"use strict";_.d(J,{_:()=>j});var c=_(65763);class e{}var X,O=_(20339),l=_(54438),U=function(h,W,B,H){var p,V=arguments.length,P=V<3?W:null===H?H=Object.getOwnPropertyDescriptor(W,B):H;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)P=Reflect.decorate(h,W,B,H);else for(var w=h.length-1;w>=0;w--)(p=h[w])&&(P=(V<3?p(P):V>3?p(W,B,P):p(W,B))||P);return V>3&&P&&Object.defineProperty(W,B,P),P},$=function(h,W){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,W)};let j=((X=class{static getPerChapterTreeEnabled(W){return W.perChapterTreeEnabled}static getShowUnavailableNodes(W){return W.showUnavailableNodes}setShowUnavailableNodes(W,{showUnavailableNodes:B}){W.patchState({showUnavailableNodes:B})}}).\u0275fac=function(W){return new(W||X)},X.\u0275prov=l.jDH({token:X,factory:X.\u0275fac}),X);U([(0,c.rc)(O.Z),$("design:type",Function),$("design:paramtypes",[Object,O.Z]),$("design:returntype",void 0)],j.prototype,"setShowUnavailableNodes",null),U([(0,c.MD)(),$("design:type",Function),$("design:paramtypes",[e]),$("design:returntype",void 0)],j,"getPerChapterTreeEnabled",null),U([(0,c.MD)(),$("design:type",Function),$("design:paramtypes",[e]),$("design:returntype",void 0)],j,"getShowUnavailableNodes",null),j=U([(0,c.Uw)({name:"engineConfig",defaults:{showUnavailableNodes:!1,perChapterTreeEnabled:!0}})],j)},47610:(Se,J,_)=>{"use strict";_.d(J,{$V:()=>g,$h:()=>ce,A0:()=>M,A6:()=>y,AU:()=>O,BM:()=>je,DZ:()=>me,E7:()=>lt,GT:()=>u,Gv:()=>Z,In:()=>h,JK:()=>U,K6:()=>D,LL:()=>B,P6:()=>A,PF:()=>x,Pk:()=>Ae,RR:()=>De,RV:()=>Pe,RZ:()=>I,Rc:()=>E,Sh:()=>K,Tf:()=>c,Ti:()=>Y,Vs:()=>v,W6:()=>N,YI:()=>de,_h:()=>oe,_o:()=>ye,_y:()=>P,bo:()=>Qe,dB:()=>$,dE:()=>b,fZ:()=>R,hk:()=>X,iQ:()=>e,jM:()=>S,kE:()=>ne,lQ:()=>ie,pL:()=>Q,q:()=>H,qL:()=>St,ro:()=>Ne,t5:()=>l,u3:()=>p,uM:()=>le,v$:()=>ae,vA:()=>tt,w8:()=>V,z:()=>z,zE:()=>w,zW:()=>j,zw:()=>m});let c=(()=>{class he{constructor(){}}return he.type="[Engine] Load",he})(),e=(()=>{class he{constructor(We){this.result=We}}return he.type="[Engine] Load Success",he})(),O=(()=>{class he{constructor(We){this.ready=We}}return he.type="[Engine] Set Ready",he})(),l=(()=>{class he{constructor(We){this.display=We}}return he.type="[Engine] Set Display of 3D Scene",he})(),X=(()=>{class he{constructor(We){this.scrollMode=We}}return he.type="[Engine] Set Zoom via scroll Allowed",he})(),U=(()=>{class he{constructor(We){this.shown=We}}return he.type="[Engine] Set Scroll Alert Shwon",he})(),$=(()=>{class he{constructor(We){this.visible=We}}return he.type="[Engine] Set Visibility of 3D Scene",he})(),j=(()=>{class he{constructor(We,ut){this.color=We,this.duration=ut}}return he.type="[Engine] Fade",he})(),h=(()=>{class he{constructor(){}}return he.type="[Engine] Fade Complete",he})(),B=(()=>{class he{constructor(We){this.graph=We}}return he.type="[Engine] Set Graph",he})(),H=(()=>{class he{constructor(){}}return he.type="[Engine] Get Graph Metadata",he})(),V=(()=>{class he{constructor(){}}return he.type="[Engine] Clear Graph",he})(),P=(()=>{class he{constructor(We){this.enabled=We}}return he.type="[Engine] Set Xray Mode",he})(),p=(()=>{class he{constructor(We){this.chapterId=We}}return he.type="[Engine] Set Engine Chapter",he})(),w=(()=>{class he{constructor(We,ut,Ct){this.node=We,this.event=ut,this.hit=Ct}}return he.type="[Engine] Click Node",he})(),R=(()=>{class he{constructor(We,ut){this.node=We,this.hit=ut}}return he.type="[Engine] Set Contextmenu",he})(),N=(()=>{class he{constructor(We,ut=!0,Ct){this.objectId=We,this.animate=ut,this.animationDuration=Ct}}return he.type="[Engine] Fly To Object",he})(),M=(()=>{class he{constructor(We,ut){this.leafVisibilityState=We,this.nodes=ut}}return he.type="[Engine] Synchronize Visible Nodes On Tree",he})(),u=(()=>{class he{constructor(We){this.leafRenderableState=We}}return he.type="[Engine] Synchronize Renderable State of Nodes On Tree",he})(),g=(()=>{class he{constructor(We,ut){this.leafPickableState=We,this.nodes=ut}}return he.type="[Engine] Synchronize Pickable State of Nodes On Tree",he})(),E=(()=>{class he{constructor(We,ut){this.leafAvailableState=We,this.nodes=ut}}return he.type="[Engine] Synchronize Available State of Nodes On Tree",he})(),A=(()=>{class he{constructor(We){this.show=We}}return he.type="[Engine] Toggle Camera Bar",he})(),Y=(()=>{class he{constructor(We){this.show=We}}return he.type="[Engine] Toggle Progress Bar",he})(),Z=(()=>{class he{constructor(We){this.show=We}}return he.type="[Engine] Toggle Labels",he})(),Q=(()=>{class he{constructor(We){this.tool=We}}return he.type="[Engine] Set active tool",he})(),y=(()=>{class he{constructor(){}}return he.type="[Engine] Play chapter animation",he})(),b=(()=>{class he{constructor(We=!0){this.play=We}}return he.type="[Engine] Play animation",he})(),S=(()=>{class he{constructor(We){this.playing=We}}return he.type="[Engine] Set animation playing",he})(),v=(()=>{class he{constructor(We){this.speed=We}}return he.type="[Engine] Set playback speed",he})(),D=(()=>{class he{constructor(){}}return he.type="[Engine] Play chapter from start",he})(),ne=(()=>{class he{constructor(We){this.enable=We}}return he.type="[Engine] Set autoplay",he})(),m=(()=>{class he{constructor(We,ut){this.nodes=We,this.layer=ut}}return he.type="[Engine] Set object layer order",he})(),ce=(()=>{class he{constructor(We,ut){this.nodeId=We,this.displayName=ut}}return he.type="[Engine] Set object display name",he})(),I=(()=>{class he{constructor(){}}return he.type="[Engine] Auto Sort object layer orders",he})(),x=(()=>{class he{constructor(){}}return he.type="[Engine] Reset object layer orders",he})(),K=(()=>{class he{constructor(We){this.position=We}}return he.type="[Engine] Set Engine Position",he})(),ie=(()=>{class he{constructor(){}}return he.type="[Engine] Reset Engine Position",he})(),le=(()=>{class he{constructor(We){this.effects=We}}return he.type="[Engine] Set Post Processing Effects",he})(),de=(()=>{class he{constructor(We){this.properties=We}}return he.type="[Engine] Set Properties",he})(),oe=(()=>{class he{constructor(We){this.mode=We}}return he.type="[Engine] Set Transparency Mode",he})(),ye=(()=>{class he{constructor(We){this.node=We}}return he.type="[Engine] Expand ViewTree Node",he})(),z=(()=>{class he{constructor(We){this.node=We}}return he.type="[Engine] Collapse ViewTree Node",he})(),ae=(()=>{class he{constructor(){}}return he.type="[Engine] Collapse All ViewTree Nodes",he})(),me=(()=>{class he{constructor(We,ut){this.node=We,this.hit=ut}}return he.type="[Engine] Hover Node",he})(),Ne=(()=>{class he{constructor(We){this.node=We}}return he.type="[Engine] Set Label Edit Node",he})(),Pe=(()=>{class he{constructor(We,ut){this.node=We,this.info=ut}}return he.type="[Engine] Set Node Info",he})(),Qe=(()=>{class he{constructor(We,ut,Ct){this.node=We,this.fallback=ut,this.lang=Ct}}return he.type="[Engine] Query Node Info",he})(),St=(()=>{class he{constructor(We,ut){this.node=We,this.info=ut}}return he.type="[Engine] Query Node Info Success",he})(),De=(()=>{class he{constructor(We){this.node=We}}return he.type="[Engine Nodes] Query Node Info Failure",he})(),lt=(()=>{class he{constructor(We){this.enabled=We}}return he.type="[Engine] Set Watermark Enabled",he})(),tt=(()=>{class he{constructor(We){this.context=We}}return he.type="[Engine] Set Engine WebGL Context",he})(),je=(()=>{class he{constructor(We,ut){this.enabled=We,this.showAdvancedTools=ut}}return he.type="[Engine] Set Engine Stats Enabled",he})(),Ae=(()=>{class he{constructor(We){this.pickState=We}}return he.type="[Engine] Set Pick State",he})()},55494:(Se,J,_)=>{"use strict";_.d(J,{S:()=>oe});var c=_(65763);class e{}var O=_(47610),l=_(78109),X=_(72849),U=_(23881),$=_(24911),j=_(4664),h=_(3829),W=_(47555),B=_(13878),H=_(14264),V=_(17365),P=_(15152),p=_(79435),w=_(44867),F=_(12347),R=_(5188),N=_(46799),M=_(35650),u=_(73987),g=_(56343),E=_(43631),C=_(28407);const A={};var Y=function(ye){return ye.Binary="application/octet-stream",ye.JSON="application/json;charset=UTF-8",ye}(Y||{});const Z="assetCache";class Q{addToCache(z,ae){return(0,C.A)(function*(){const me=ae instanceof ArrayBuffer?ae:JSON.stringify(ae),Ne=me instanceof ArrayBuffer?Y.Binary:Y.JSON,Pe=me instanceof ArrayBuffer?me.byteLength:me.length,Qe=new Response(me,{headers:{...A,"Content-Type":Ne,"Content-Length":`${Pe}`}});return(yield caches.open(Z)).put(z,Qe)})()}removeFromCache(z){return(0,C.A)(function*(){return(yield caches.open(Z)).delete(z)})()}getFromCache(z){return(0,C.A)(function*(){const me=yield(yield caches.open(Z)).match(z),Ne=me?.headers?.get("Content-Type");if(Ne)return"application/octet-stream"===Ne?me.arrayBuffer():me.json()})()}closeCache(){return(0,C.A)(function*(){})()}}var y=_(29160);const b="/assets/latin/l2bi.json";function S(ye){return{titlesToLatin:ne(ye)}}function D(){return(D=(0,C.A)(function*(){return yield(yield fetch(b)).json()})).apply(this,arguments)}function ne(ye){return Object.entries(ye).reduce((z,[ae,me])=>(me.forEach(Ne=>{z[Ne]=ae}),z),{})}var m=_(49204),ce=_(54438);let I=(()=>{var ye;class z{constructor(){this.graphMetadata=new y.t(void 0)}getGraphMetadata(){return(0,m.isNil)(this.graphMetadata.value)&&this.fetchGraphMetadata().then(me=>{this.graphMetadata.next(me)}),this.graphMetadata.asObservable()}destroy(){this.cacheDatabase?.closeCache(),this.cacheDatabase=null}fetchGraphMetadata(){var me=this;return(0,C.A)(function*(){me.destroy(),me.cacheDatabase=new Q;const Ne=yield me.cacheDatabase.getFromCache(b);if(Ne){const Pe=S(Ne);return me.graphMetadata.next(Pe),Pe}{const Pe=yield function v(){return D.apply(this,arguments)}();me.cacheDatabase.addToCache(b,Pe);const Qe=S(Pe);return me.graphMetadata.next(Qe),Qe}})()}}return(ye=z).\u0275fac=function(me){return new(me||ye)},ye.\u0275prov=ce.jDH({token:ye,factory:ye.\u0275fac,providedIn:"root"}),z})();var K,le,x=_(90917),ie=function(ye,z,ae,me){var Qe,Ne=arguments.length,Pe=Ne<3?z:null===me?me=Object.getOwnPropertyDescriptor(z,ae):me;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Pe=Reflect.decorate(ye,z,ae,me);else for(var St=ye.length-1;St>=0;St--)(Qe=ye[St])&&(Pe=(Ne<3?Qe(Pe):Ne>3?Qe(z,ae,Pe):Qe(z,ae))||Pe);return Ne>3&&Pe&&Object.defineProperty(z,ae,Pe),Pe},k=function(ye,z){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ye,z)};const de=new $.j(0,0,0,0,0,0,j.g.Hidden,1);let oe=(le=K=class{static getEngine(z){return z.engine}static getReady(z){return z.ready}static getDisplay(z){return z.display}static getScrollMode(z){return z.scrollMode}static getVisible(z){return z.visible}static getViewGraph(z){return z.viewGraph}static getViewGraphMetadata(z){return z.viewGraphMetadata}static getTreeGraph(z,ae){return ae?z:(0,w.vU)(z)}static getViewGraphNode(z){return ae=>z.viewGraph.nodes[ae]}static getEnginePosition(z){return z.enginePosition}static getCanvasHeightBreakpoint(z){return z?.height<375?u.h.Tiny:z?.height<480?u.h.Small:u.h.Standard}static getChapter(z){return z.chapter}static getActiveTool(z){return z.activeTool}static getShowCameraBar(z){return z.showCameraBar}static getShowProgressBar(z){return z.showProgressBar}static getShowLabels(z){return z.showLabels}static getAnimationPlaying(z){return z.animationPlaying}static getAutoplay(z){return z.autoplay}static getXrayModeEnabled(z){return z.xrayModeEnabled}static getHoveredNode(z){return z.hoveredNode}static getLabelEditNode(z){return z.labelEditNode}static getQuerying(z){return z.queryingAnatomy}static getContextMenu(z){return z.contextMenu}static getPlaybackSpeed(z){return z.playbackSpeed}static getWatermarkEnabled(z){return z.watermarkEnabled}static getWebGLContextName(z){return z.webGLContextName}static getStatsEnabled(z){return z.stats.enabled}static getShowAdvancedStatsTools(z){return z.stats.showAdvancedTools}static getClickPickEnabled(z){return z.pickState.clickEnabled}static getHoverPickEnabled(z){return z.pickState.hoverEnabled}static getViewGraphRank(z){return z.viewGraphRank}load(z,ae){z.dispatch(new O.iQ("engine"))}loadSuccess({patchState:z},ae){z({engine:ae.result})}setReady(z,ae){z.patchState({ready:ae.ready})}setDisplay(z,ae){z.patchState({display:ae.display})}setZoomViaScrollAllowed(z,ae){z.patchState({scrollMode:ae.scrollMode})}setVisible(z,ae){z.patchState({visible:ae.visible})}setEnginePosition(z,ae){z.patchState({enginePosition:{...ae.position,right:ae.position.left+ae.position.width,bottom:ae.position.top+ae.position.height}})}resetEnginePosition(z,ae){z.patchState({enginePosition:de})}setChapter(z,ae){z.patchState({chapter:ae.chapterId})}setActiveTool(z,ae){z.patchState({activeTool:ae.tool})}setGraph(z,{graph:ae}){const me=(0,x.D$)(Object.values(ae.nodes),[{field:"shown",dir:"asc"},{field:"label",dir:"asc"}]).reduce((Ne,Pe,Qe)=>(Ne[Pe.id]=Qe,Ne),{});z.patchState({viewGraph:{...ae},viewGraphRank:{initiallyShownRank:me}})}getGraphMetadata(z){const{viewGraphMetadata:ae}=z.getState();(0,m.isEmpty)(ae)&&this.nodeSearchService.getGraphMetadata().pipe((0,H.p)(me=>!(0,m.isEmpty)(me)),(0,V.s)(1)).subscribe(me=>{const{viewGraph:Ne}=z.getState();z.patchState({viewGraphMetadata:me,viewGraph:{...(0,w.u7)(Ne,me)}})})}clearGraph(z){z.patchState({viewGraph:(0,U.q3)(),viewGraphRank:{initiallyShownRank:{}}})}setXrayMode(z,ae){z.patchState({xrayModeEnabled:ae.enabled})}toggleProgressBar(z,ae){z.patchState({showProgressBar:ae.show})}toggleCameraBar(z,ae){z.patchState({showCameraBar:ae.show})}toggleLabels(z,ae){const me=null!=ae.show?ae.show:!z.getState().showLabels;z.patchState({showLabels:me})}synchronizeVisibleNodes(z,ae){const me=z.getState().viewGraph,Ne=this.stateMapToNodeIds(me,ae.leafVisibilityState),Pe={};Ne.forEach(Qe=>{const De=this.sceneService.getLeafIds(Qe).reduce((lt,tt)=>lt||ae.nodes[tt].shown,!1);Pe[Qe]={shown:De}}),this.graphService.synchronize({...me},{shown:g.t.TrueWins},Pe),z.patchState({viewGraph:{...me}})}synchronizeRenderableNodes(z,ae){const me=z.getState().viewGraph,Ne=this.stateMapToNodeIds(me,ae.leafRenderableState),Pe={};Ne.forEach(Qe=>{Pe[Qe]={renderable:!0}}),this.graphService.synchronize(me,{renderable:g.t.FalseWins},Pe)}synchronizePickableNodes(z,ae){const me=z.getState().viewGraph,Ne=this.stateMapToNodeIds(me,ae.leafPickableState),Pe={};Ne.forEach(Qe=>{const De=this.sceneService.getLeafIds(Qe).reduce((lt,tt)=>lt||this.sceneService.getObjectById(tt).pickable,!1);Pe[Qe]={pickable:De}}),this.graphService.synchronize(me,{pickable:g.t.TrueWins},Pe),z.patchState({viewGraph:{...me}})}synchronizeAvailableNodes(z,ae){const me=z.getState().viewGraph,Ne=this.stateMapToNodeIds(me,ae.leafAvailableState),Pe={};Ne.forEach(Qe=>{const De=this.sceneService.getLeafIds(Qe).reduce((lt,tt)=>lt||ae.nodes[tt].available,!1);Pe[Qe]={available:De}}),this.graphService.synchronize(me,{available:g.t.TrueWins},Pe),z.patchState({viewGraph:{...me}})}playChapterAnimation(z,ae){this.animationService.restart(),z.getState().animationPlaying||this.animationService.pause()}toggleAnimation(z,ae){ae.play?this.animationService.unpause():this.animationService.pause()}setAnimationPlaying(z,ae){z.patchState({animationPlaying:ae.playing})}setPlaybackSpeed(z,ae){z.patchState({playbackSpeed:ae.speed})}setAutoplay(z,ae){z.patchState({autoplay:ae.enable})}setObjectLayerOrder(z,ae){const me=z.getState().viewGraph,Ne=isNaN(ae.layer)?0:ae.layer,{anatomyObjects:Pe}=this.sceneService.getAnatomySceneGraph();let Qe=[];ae.nodes.forEach(St=>{const De=this.graphService.getDescendants(me,St.id,!0);Qe=Qe.concat(De)}),Qe.forEach(St=>{this.sceneService.setObjectLayer(Pe,St,Ne),this.graphService.setState(me,St,{layer:Ne})}),z.patchState({viewGraph:{...me}})}setObjectDisplayName(z,ae){const{nodeId:me,displayName:Ne}=ae,Pe=z.getState().viewGraph,Qe=Pe.nodes[me],St=this.sceneService.getObjectById(me);St&&(St.displayName=Ne),Qe&&(Qe.label=Ne,z.patchState({viewGraph:{...Pe}}))}autoSortObjectLayers(z,ae){const me=z.getState().viewGraph;let Pe=0;const Qe=this.sceneService.getEnabledLeafIds(),St=this.sceneService.getObjectLayerValues(Qe),{anatomyObjects:De}=this.sceneService.getAnatomySceneGraph();Object.keys(St).map(lt=>parseInt(lt,10)).sort((lt,tt)=>lt-tt).forEach(lt=>{St[lt].sort((tt,je)=>je.value-tt.value).forEach(tt=>{const je=20*Pe;this.sceneService.setObjectLayer(De,tt.nodeId,je),this.graphService.setState(me,tt.nodeId,{layer:je}),Pe++})}),z.patchState({viewGraph:{...me}})}resetObjectLayers(z,ae){const me=z.getState().viewGraph,Ne=this.sceneService.getEnabledLeafIds(),{anatomyObjects:Pe}=this.sceneService.getAnatomySceneGraph();Ne.forEach(Qe=>{this.sceneService.setObjectLayer(Pe,Qe,0),this.graphService.setState(me,Qe,{layer:0})}),z.patchState({viewGraph:{...me}})}setPostProcessingEffects(z,{effects:ae}){this.postProcessingService.setPostProcessingFeatures(ae)}setProperties(z,{properties:ae}){this.engineService.setProperties({...ae})}setTransparencyMode(z,{mode:ae}){this.engineRendererService.setTransparencyMode(ae)}expandNode(z,ae){const me=this.store.selectSnapshot(le.getViewGraph);(0,w.DS)(me,ae.node.id,!0).forEach(Pe=>{me.nodes[Pe].boolState.expanded=!0}),z.patchState({viewGraph:{...me}})}collapseNode(z,ae){const me=this.store.selectSnapshot(le.getViewGraph);me.nodes[ae.node.id].boolState.expanded=!1,z.patchState({viewGraph:{...me}})}collapseAllViewTreeNodes(z,ae){const me=this.store.selectSnapshot(le.getViewGraph);Object.values(me.nodes).forEach(Ne=>{Ne.boolState.expanded=!1}),z.patchState({viewGraph:{...me}})}hoverNode(z,ae){z.patchState({hoveredNode:ae.node})}setLabelEditNode(z,ae){z.patchState({labelEditNode:ae.node})}queryNodeInfo(z,{node:ae,fallback:me,lang:Ne}){z.patchState({queryingAnatomy:!0}),this.contentInfoService.queryNodeInfo(ae.label,me,Ne).pipe((0,P.j)(()=>z.patchState({queryingAnatomy:!1}))).subscribe(Pe=>z.dispatch(new O.qL(ae,Pe)),()=>z.dispatch(new O.RR(ae)))}queryNodeInfoSuccess(z,{node:ae,info:me}){z.dispatch(new O.RV(ae,me))}setNodeInfo(z,{node:ae,info:me}){const Ne=this.store.selectSnapshot(le.getViewGraph),Pe=Ne.nodes[ae.id];Pe&&me&&(Pe.description=me.description,Pe.info=me,z.patchState({viewGraph:{...Ne}}))}setContextMenu(z,{node:ae,hit:me}){z.patchState({contextMenu:{node:ae,hit:me}})}setWatermarkEnabled(z,{enabled:ae}){z.patchState({watermarkEnabled:ae})}setWebGLContext(z,ae){z.patchState({webGLContextName:ae.context})}setEngineStatsEnabled(z,{enabled:ae,showAdvancedTools:me}){z.patchState({stats:{enabled:ae,showAdvancedTools:me}})}setHoverPick(z,ae){z.patchState({pickState:{...z.getState().pickState,...ae.pickState}})}stateMapToNodeIds(z,ae){const me=Object.keys(ae).map(Ne=>this.sceneService.getViewNode(z,Ne)).filter(Ne=>!!Ne).map(Ne=>Ne.id);return new Set(me)}constructor(z,ae,me,Ne,Pe,Qe,St,De,lt){this.store=z,this.graphService=ae,this.engineService=me,this.contentInfoService=Ne,this.animationService=Pe,this.postProcessingService=Qe,this.engineRendererService=St,this.sceneService=De,this.nodeSearchService=lt}},K.\u0275fac=function(z){return new(z||K)(ce.KVO(c.il),ce.KVO(l.w),ce.KVO(X.y),ce.KVO(p.T),ce.KVO(F.O),ce.KVO(R.j),ce.KVO(N.z),ce.KVO(M.w),ce.KVO(I))},K.\u0275prov=ce.jDH({token:K,factory:K.\u0275fac}),K);ie([(0,c.rc)(O.Tf),k("design:type",Function),k("design:paramtypes",[Object,O.Tf]),k("design:returntype",void 0)],oe.prototype,"load",null),ie([(0,c.rc)(O.iQ),k("design:type",Function),k("design:paramtypes",[Object,O.iQ]),k("design:returntype",void 0)],oe.prototype,"loadSuccess",null),ie([(0,c.rc)(O.AU),k("design:type",Function),k("design:paramtypes",[Object,O.AU]),k("design:returntype",void 0)],oe.prototype,"setReady",null),ie([(0,c.rc)(O.t5),k("design:type",Function),k("design:paramtypes",[Object,O.t5]),k("design:returntype",void 0)],oe.prototype,"setDisplay",null),ie([(0,c.rc)(O.hk),k("design:type",Function),k("design:paramtypes",[Object,O.hk]),k("design:returntype",void 0)],oe.prototype,"setZoomViaScrollAllowed",null),ie([(0,c.rc)(O.dB),k("design:type",Function),k("design:paramtypes",[Object,O.dB]),k("design:returntype",void 0)],oe.prototype,"setVisible",null),ie([(0,c.rc)(O.Sh),k("design:type",Function),k("design:paramtypes",[Object,O.Sh]),k("design:returntype",void 0)],oe.prototype,"setEnginePosition",null),ie([(0,c.rc)(O.lQ),k("design:type",Function),k("design:paramtypes",[Object,O.lQ]),k("design:returntype",void 0)],oe.prototype,"resetEnginePosition",null),ie([(0,c.rc)(O.u3),k("design:type",Function),k("design:paramtypes",[Object,O.u3]),k("design:returntype",void 0)],oe.prototype,"setChapter",null),ie([(0,c.rc)(O.pL),k("design:type",Function),k("design:paramtypes",[Object,O.pL]),k("design:returntype",void 0)],oe.prototype,"setActiveTool",null),ie([(0,c.rc)(O.LL),k("design:type",Function),k("design:paramtypes",[Object,O.LL]),k("design:returntype",void 0)],oe.prototype,"setGraph",null),ie([(0,c.rc)(O.q),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",void 0)],oe.prototype,"getGraphMetadata",null),ie([(0,c.rc)(O.w8),k("design:type",Function),k("design:paramtypes",[Object]),k("design:returntype",void 0)],oe.prototype,"clearGraph",null),ie([(0,c.rc)(O._y),k("design:type",Function),k("design:paramtypes",[Object,O._y]),k("design:returntype",void 0)],oe.prototype,"setXrayMode",null),ie([(0,c.rc)(O.Ti),k("design:type",Function),k("design:paramtypes",[Object,O.Ti]),k("design:returntype",void 0)],oe.prototype,"toggleProgressBar",null),ie([(0,c.rc)(O.P6),k("design:type",Function),k("design:paramtypes",[Object,O.P6]),k("design:returntype",void 0)],oe.prototype,"toggleCameraBar",null),ie([(0,c.rc)(O.Gv),k("design:type",Function),k("design:paramtypes",[Object,O.Gv]),k("design:returntype",void 0)],oe.prototype,"toggleLabels",null),ie([(0,c.rc)(O.A0),k("design:type",Function),k("design:paramtypes",[Object,O.A0]),k("design:returntype",void 0)],oe.prototype,"synchronizeVisibleNodes",null),ie([(0,c.rc)(O.GT),k("design:type",Function),k("design:paramtypes",[Object,O.GT]),k("design:returntype",void 0)],oe.prototype,"synchronizeRenderableNodes",null),ie([(0,c.rc)(O.$V),k("design:type",Function),k("design:paramtypes",[Object,O.$V]),k("design:returntype",void 0)],oe.prototype,"synchronizePickableNodes",null),ie([(0,c.rc)(O.Rc),k("design:type",Function),k("design:paramtypes",[Object,O.Rc]),k("design:returntype",void 0)],oe.prototype,"synchronizeAvailableNodes",null),ie([(0,c.rc)(O.A6),k("design:type",Function),k("design:paramtypes",[Object,O.A6]),k("design:returntype",void 0)],oe.prototype,"playChapterAnimation",null),ie([(0,c.rc)(O.dE),k("design:type",Function),k("design:paramtypes",[Object,O.dE]),k("design:returntype",void 0)],oe.prototype,"toggleAnimation",null),ie([(0,c.rc)(O.jM),k("design:type",Function),k("design:paramtypes",[Object,O.jM]),k("design:returntype",void 0)],oe.prototype,"setAnimationPlaying",null),ie([(0,c.rc)(O.Vs),k("design:type",Function),k("design:paramtypes",[Object,O.Vs]),k("design:returntype",void 0)],oe.prototype,"setPlaybackSpeed",null),ie([(0,c.rc)(O.kE),k("design:type",Function),k("design:paramtypes",[Object,O.kE]),k("design:returntype",void 0)],oe.prototype,"setAutoplay",null),ie([(0,c.rc)(O.zw),k("design:type",Function),k("design:paramtypes",[Object,O.zw]),k("design:returntype",void 0)],oe.prototype,"setObjectLayerOrder",null),ie([(0,c.rc)(O.$h),k("design:type",Function),k("design:paramtypes",[Object,O.$h]),k("design:returntype",void 0)],oe.prototype,"setObjectDisplayName",null),ie([(0,c.rc)(O.RZ),k("design:type",Function),k("design:paramtypes",[Object,O.RZ]),k("design:returntype",void 0)],oe.prototype,"autoSortObjectLayers",null),ie([(0,c.rc)(O.PF),k("design:type",Function),k("design:paramtypes",[Object,O.PF]),k("design:returntype",void 0)],oe.prototype,"resetObjectLayers",null),ie([(0,c.rc)(O.uM),k("design:type",Function),k("design:paramtypes",[Object,O.uM]),k("design:returntype",void 0)],oe.prototype,"setPostProcessingEffects",null),ie([(0,c.rc)(O.YI),k("design:type",Function),k("design:paramtypes",[Object,O.YI]),k("design:returntype",void 0)],oe.prototype,"setProperties",null),ie([(0,c.rc)(O._h),k("design:type",Function),k("design:paramtypes",[Object,O._h]),k("design:returntype",void 0)],oe.prototype,"setTransparencyMode",null),ie([(0,c.rc)(O._o),k("design:type",Function),k("design:paramtypes",[Object,O._o]),k("design:returntype",void 0)],oe.prototype,"expandNode",null),ie([(0,c.rc)(O.z),k("design:type",Function),k("design:paramtypes",[Object,O.z]),k("design:returntype",void 0)],oe.prototype,"collapseNode",null),ie([(0,c.rc)(O.v$),k("design:type",Function),k("design:paramtypes",[Object,O.v$]),k("design:returntype",void 0)],oe.prototype,"collapseAllViewTreeNodes",null),ie([(0,c.rc)(O.DZ),k("design:type",Function),k("design:paramtypes",[Object,O.DZ]),k("design:returntype",void 0)],oe.prototype,"hoverNode",null),ie([(0,c.rc)(O.ro),k("design:type",Function),k("design:paramtypes",[Object,O.ro]),k("design:returntype",void 0)],oe.prototype,"setLabelEditNode",null),ie([(0,c.rc)(O.bo),k("design:type",Function),k("design:paramtypes",[Object,O.bo]),k("design:returntype",void 0)],oe.prototype,"queryNodeInfo",null),ie([(0,c.rc)(O.qL),k("design:type",Function),k("design:paramtypes",[Object,O.qL]),k("design:returntype",void 0)],oe.prototype,"queryNodeInfoSuccess",null),ie([(0,c.rc)(O.RV),k("design:type",Function),k("design:paramtypes",[Object,O.RV]),k("design:returntype",void 0)],oe.prototype,"setNodeInfo",null),ie([(0,c.rc)(O.fZ),k("design:type",Function),k("design:paramtypes",[Object,O.fZ]),k("design:returntype",void 0)],oe.prototype,"setContextMenu",null),ie([(0,c.rc)(O.E7),k("design:type",Function),k("design:paramtypes",[Object,O.E7]),k("design:returntype",void 0)],oe.prototype,"setWatermarkEnabled",null),ie([(0,c.rc)(O.vA),k("design:type",Function),k("design:paramtypes",[Object,O.vA]),k("design:returntype",void 0)],oe.prototype,"setWebGLContext",null),ie([(0,c.rc)(O.BM),k("design:type",Function),k("design:paramtypes",[Object,O.BM]),k("design:returntype",void 0)],oe.prototype,"setEngineStatsEnabled",null),ie([(0,c.rc)(O.Pk),k("design:type",Function),k("design:paramtypes",[Object,O.Pk]),k("design:returntype",void 0)],oe.prototype,"setHoverPick",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getEngine",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getReady",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getDisplay",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getScrollMode",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getVisible",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getViewGraph",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getViewGraphMetadata",null),ie([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([oe.getViewGraph,E._.getShowUnavailableNodes]),k("design:type",Function),k("design:paramtypes",[Object,Boolean]),k("design:returntype",Object)],oe,"getTreeGraph",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getViewGraphNode",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getEnginePosition",null),ie([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([oe.getEnginePosition]),k("design:type",Function),k("design:paramtypes",[$.j]),k("design:returntype",Number)],oe,"getCanvasHeightBreakpoint",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getChapter",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getActiveTool",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getShowCameraBar",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getShowProgressBar",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getShowLabels",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getAnimationPlaying",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getAutoplay",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getXrayModeEnabled",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getHoveredNode",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getLabelEditNode",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getQuerying",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getContextMenu",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getPlaybackSpeed",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getWatermarkEnabled",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getWebGLContextName",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getStatsEnabled",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getShowAdvancedStatsTools",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getClickPickEnabled",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getHoverPickEnabled",null),ie([(0,c.MD)(),k("design:type",Function),k("design:paramtypes",[e]),k("design:returntype",void 0)],oe,"getViewGraphRank",null),oe=le=ie([(0,c.Uw)({name:"engine",defaults:{loading:!1,ready:!1,viewGraph:(0,U.q3)(),viewGraphMetadata:void 0,viewGraphRank:{initiallyShownRank:{}},hoveredNode:void 0,labelEditNode:void 0,queryingAnatomy:!1,engine:"",chapter:"",showProgressBar:!0,showCameraBar:!0,showLabels:!0,activeTool:W.s.Select,animationPlaying:!1,autoplay:!0,display:!0,visible:!0,scrollMode:B.M.Capture,playbackSpeed:1,xrayModeEnabled:!1,contextMenu:{node:null,hit:null},watermarkEnabled:!1,stats:{enabled:!1,showAdvancedTools:!1},webGLContextName:void 0,pickState:{clickEnabled:!0,hoverEnabled:!0},xrRequesting:!1},children:[h.x]}),k("design:paramtypes",[c.il,l.w,X.y,p.T,F.O,R.j,N.z,M.w,I])],oe)},29284:(Se,J,_)=>{"use strict";_.d(J,{BK:()=>$,_x:()=>U,iE:()=>V});var c=_(20458),e=_(1102),O=_(44867),l=_(49204);function U(P,p,w){const F=(0,O.IA)(P,p);if(0===F.length)return!1;for(const R of F)if(!0===w[R])return!0;return F.some(R=>U(P,R,w))}function $(P,p,w){switch(w[p]){case!0:return!0;case!1:return!1;case void 0:{const F=(0,O.ir)(P,p);return!!F&&$(P,F,w)}}}function j(P,p,w){if((0,l.isNil)(w))return!0;switch(w[p]){case!0:return!1;case!1:return!0;case void 0:{const F=(0,O.ir)(P,p);return!F||j(P,F,w)}}}function H(P,p,w){if(w&&w[p]&&function B(P){return"tintColor"in P||"opacity"in P||"brightness"in P||"saturation"in P||"contrast"in P}(w[p]))return(0,e.H)(w[p]);const F=(0,O.ir)(P,p);return F?H(P,F,w):c.NR}function V(P,p,w,F,R){function N(u){const g=function W(P,p,w){return(0,O.If)(p,w,F=>(0,O.ir)(P,F),F=>(0,O.IA)(P,F))}(P,u,w),E=function h(P,p,w){return $(P,p,w)||U(P,p,w)}(P,u,p),C=j(P,u,F);return{objectId:u,checked:!1,selected:!1,paint:H(P,u,R),pickable:C,shown:E,shownSetByTween:!1,available:g,variant:0}}return Object.keys(P.nodes).reduce((u,g)=>(u[g]=N(g),u),{})}},61295:(Se,J,_)=>{"use strict";_.d(J,{IA:()=>l,Jp:()=>B,K8:()=>e,Ke:()=>W,LV:()=>U,NP:()=>O,Ws:()=>H,Yn:()=>c,ZF:()=>V,_n:()=>P,hg:()=>j,q9:()=>h,rg:()=>X,yr:()=>$});let c=(()=>{class w{constructor(){}}return w.type="[Engine Nodes] Reset",w})(),e=(()=>{class w{constructor(R){this.nodeState=R}}return w.type="[Engine Nodes] init nodes",w})(),O=(()=>{class w{constructor(R){this.patches=R}}return w.type="[Engine Nodes] patch nodes",w})(),l=(()=>{class w{constructor(R){this.activeChapterId=R}}return w.type="[Engine Nodes] set active chapter",w})(),X=(()=>{class w{constructor(R,N){this.originalChapterId=R,this.copyChapterId=N}}return w.type="[Engine Nodes] Duplicate node state",w})(),U=(()=>{class w{constructor(R,N){this.show=R,this.objectIds=N}}return w.type="[Engine Nodes] update tween nodes shown",w})(),$=(()=>{class w{constructor(R,N,M,u=!0,g=!1,E=!1){this.show=R,this.objectIds=N,this.patch=M,this.record=u,this.setByTween=g,this.includeUnavailable=E}}return w.type="[Engine Nodes] update nodes shown",w})(),j=(()=>{class w{constructor(R){this.objectId=R}}return w.type="[Engine Nodes] update nodes selected",w})(),h=(()=>{class w{constructor(R,N,M){this.checked=R,this.objectIds=N,this.patch=M}}return w.type="[Engine Nodes] update nodes checked",w})(),W=(()=>{class w{constructor(R,N,M){this.pickable=R,this.objectIds=N,this.patch=M}}return w.type="[Engine Nodes] update nodes pickable",w})(),B=(()=>{class w{constructor(R,N,M,u=!0){this.recipe=R,this.objectIds=N,this.patch=M,this.record=u}}return w.type="[Engine Nodes] update nodes paint",w})(),H=(()=>{class w{constructor(R,N,M){this.available=R,this.objectIds=N,this.patch=M}}return w.type="[Engine Nodes] update nodes available",w})(),V=(()=>{class w{constructor(R,N){this.objectIds=R,this.sourceChapterId=N}}return w.type="[Engine Nodes] copy nodes paint",w})(),P=(()=>{class w{constructor(R,N=!0){this.objectVariants=R,this.record=N}}return w.type="[Engine Nodes] update node variants",w})()},13409:(Se,J,_)=>{"use strict";_.d(J,{z:()=>F});var c=_(65763);class e{}var V,O=_(61295),l=_(75069),X=_(10467),U=_(12865),$=_(1102),j=_(81025),h=_(35650),W=_(43631),B=_(44867),H=_(54438),P=function(R,N,M,u){var C,g=arguments.length,E=g<3?N:null===u?u=Object.getOwnPropertyDescriptor(N,M):u;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)E=Reflect.decorate(R,N,M,u);else for(var A=R.length-1;A>=0;A--)(C=R[A])&&(E=(g<3?C(E):g>3?C(N,M,E):C(N,M))||E);return g>3&&E&&Object.defineProperty(N,M,E),E},p=function(R,N){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(R,N)};let F=((V=class{static getAllNodeState(N){return N.nodeState}static getActiveChapter(N){return N.activeChapterId}static getPatches(N){return N.patches}static getNodes(N,M){return N?.[M]??{}}static getAvailableNodes(N,M){return M?N:(0,B.bd)(N)}static getNodePaint(N){return M=>N.nodeState[N.activeChapterId][M].paint}static getNodeIds(N){return Object.keys(N)}static getCheckedNodeIds(N){return N.map(M=>M.objectId)}static getCheckedNodesCount(N){return N.length}static getCheckedNodes(N){return Object.values(N).filter(M=>M.checked)}static getSelectedNode(N){return Object.values(N).find(M=>M.selected)}reset(N,M){N.patchState(j.jM(N.getState(),u=>{u.activeChapterId=void 0,u.nodeState=void 0,u.patches=[],u.patchesForChapter={}}))}applyPatch(N,M){const u=j.$i(N.getState(),M.patches),g=j.jM(u,E=>{E.patchesForChapter[E.activeChapterId].push(...M.patches),E.patches=M.patches});N.patchState(g)}initNodeState(N,M){N.patchState({nodeState:M.nodeState})}setActiveChapter(N,M){const u=N.getState(),g=j.jM(u,E=>{E.activeChapterId=M.activeChapterId,E.patchesForChapter[M.activeChapterId]=E.patchesForChapter[M.activeChapterId]||[],E.patches=E.patchesForChapter[M.activeChapterId]});N.patchState(g)}duplicateNodeState(N,M){const u=N.getState(),g=j.jM(u,E=>{E.nodeState[M.copyChapterId]=E.nodeState[M.originalChapterId],E.patchesForChapter[M.copyChapterId]=E.patchesForChapter[M.originalChapterId].map(A=>(A.path[1]=M.copyChapterId,A))});N.patchState(g)}updateTweenNodesShown(N,M){const u=N.getState(),{finalState:g}=(0,U.r)(u,{...M,record:!1,setByTween:!0,includeUnavailable:!0},this.sceneService),{nodeState:E}=g;N.patchState({nodeState:E})}updateNodesShown(N,M){const u=N.getState(),{finalState:g,patches:E,inversePatches:C}=(0,U.r)(u,M,this.sceneService);N.patchState(g),M.record&&N.dispatch(new l.a.SavePatches([{forward:E,inverse:C,patchAction:O.NP}]))}updateNodesSelected(N,M){const u=N.getState();if(!u)return;const g=j.jM(u,E=>{const C=E.nodeState?.[E.activeChapterId]??{},A=Object.keys(C);void 0===M.objectId?A.forEach(Y=>C[Y].selected=!1):(A.forEach(Y=>C[Y].selected=!1),C[M.objectId].selected=!0)});N.patchState(g)}updateNodesChecked(N,M){const u=N.getState(),[g,E,C]=j.vI(u,Y=>{const Z=Y.nodeState?.[Y.activeChapterId]??{};void 0===M.patch?(M.objectIds||Object.keys(Z)).forEach(y=>{Z[y].checked=M.checked,M.objectIds&&(0,X.I7)(this.sceneService,y,Z,"checked",M.checked)}):Object.entries(M.patch).forEach(([Q,y])=>Z[Q].checked=y)}),A=j.jM(g,Y=>{Y.patches=E});N.patchState(A)}updateNodesPickable(N,M){const u=N.getState(),[g,E,C]=j.vI(u,Y=>{const Z=Y.nodeState?.[Y.activeChapterId]??{};M.patch?Object.entries(M.patch).forEach(([Q,y])=>Z[Q].pickable=y):(M.objectIds||Object.keys(Z)).forEach(y=>{Z[y].pickable=M.pickable,M.objectIds&&(0,X.I7)(this.sceneService,y,Z,"pickable",M.pickable)})}),A=j.jM(g,Y=>{Y.patches=E,Y.patchesForChapter[Y.activeChapterId].push(...E)});N.patchState(A),N.dispatch(new l.a.SavePatches([{forward:E,inverse:C,patchAction:O.NP}]))}updateNodesPaint(N,M){const u=N.getState(),[g,E,C]=j.vI(u,Y=>{const Z=Y.nodeState?.[Y.activeChapterId]??{},Q=M.objectIds||Object.keys(Z);M.patch?Object.entries(M.patch).forEach(([y,b])=>{const S=(0,$.ql)(Z[y].paint,b);Z[y].paint=S}):Q.forEach(y=>{const b=(0,$.ql)(Z[y].paint,M.recipe);Z[y].paint=b,M.objectIds&&(0,X.I7)(this.sceneService,y,Z,"paint",b)})}),A=j.jM(g,Y=>{Y.patches=E,Y.patchesForChapter[Y.activeChapterId].push(...E)});N.patchState(A),M.record&&N.dispatch(new l.a.SavePatches([{forward:E,inverse:C,patchAction:O.NP}]))}updateNodesAvailable(N,M){const u=N.getState(),[g,E,C]=j.vI(u,Y=>{const Z=Y.nodeState?.[Y.activeChapterId]??{};if(M.patch)Object.entries(M.patch).forEach(([Q,y])=>{Z[Q].available=y,Z[Q].pickable=y});else{const{available:Q,objectIds:y}=M;(y??Object.keys(Z)).forEach(S=>{Z[S].available=Q,Z[S].pickable=Q,y&&((0,X.I7)(this.sceneService,S,Z,"available",Q),(0,X.I7)(this.sceneService,S,Z,"pickable",Q))})}}),A=j.jM(g,Y=>{Y.patches=E,Y.patchesForChapter[Y.activeChapterId].push(...E)});N.patchState(A),N.dispatch(new l.a.SavePatches([{forward:E,inverse:C,patchAction:O.NP}]))}updateNodeVariants(N,{objectVariants:M,record:u}){const g=N.getState(),[E,C,A]=j.vI(g,Z=>{const Q=Z.nodeState?.[Z.activeChapterId]??{};Object.entries(M).forEach(([y,b])=>{Q[y].variant=b})}),Y=j.jM(E,Z=>{Z.patches=C,Z.patchesForChapter[Z.activeChapterId].push(...C)});N.patchState(Y),u&&N.dispatch(new l.a.SavePatches([{forward:C,inverse:A,patchAction:O.NP}]))}copyNodesPaint(N,{sourceChapterId:M,objectIds:u}){const g=N.getState(),[E,C,A]=j.vI(g,Z=>{(0,X.hW)(this.sceneService,Z.nodeState?.[M]??{},Z.nodeState?.[Z.activeChapterId]??{},u,"paint")}),Y=j.jM(E,Z=>{Z.patches=C,Z.patchesForChapter[Z.activeChapterId].push(...C)});N.patchState(Y),N.dispatch(new l.a.SavePatches([{forward:C,inverse:A,patchAction:O.NP}]))}constructor(N){this.sceneService=N}}).\u0275fac=function(N){return new(N||V)(H.KVO(h.w))},V.\u0275prov=H.jDH({token:V,factory:V.\u0275fac}),V);P([(0,c.rc)(O.Yn),p("design:type",Function),p("design:paramtypes",[Object,O.Yn]),p("design:returntype",void 0)],F.prototype,"reset",null),P([(0,c.rc)(O.NP),p("design:type",Function),p("design:paramtypes",[Object,O.NP]),p("design:returntype",void 0)],F.prototype,"applyPatch",null),P([(0,c.rc)(O.K8),p("design:type",Function),p("design:paramtypes",[Object,O.K8]),p("design:returntype",void 0)],F.prototype,"initNodeState",null),P([(0,c.rc)(O.IA),p("design:type",Function),p("design:paramtypes",[Object,O.IA]),p("design:returntype",void 0)],F.prototype,"setActiveChapter",null),P([(0,c.rc)(O.rg),p("design:type",Function),p("design:paramtypes",[Object,O.rg]),p("design:returntype",void 0)],F.prototype,"duplicateNodeState",null),P([(0,c.rc)(O.LV),p("design:type",Function),p("design:paramtypes",[Object,O.LV]),p("design:returntype",void 0)],F.prototype,"updateTweenNodesShown",null),P([(0,c.rc)(O.yr),p("design:type",Function),p("design:paramtypes",[Object,O.yr]),p("design:returntype",void 0)],F.prototype,"updateNodesShown",null),P([(0,c.rc)(O.hg),p("design:type",Function),p("design:paramtypes",[Object,O.hg]),p("design:returntype",void 0)],F.prototype,"updateNodesSelected",null),P([(0,c.rc)(O.q9),p("design:type",Function),p("design:paramtypes",[Object,O.q9]),p("design:returntype",void 0)],F.prototype,"updateNodesChecked",null),P([(0,c.rc)(O.Ke),p("design:type",Function),p("design:paramtypes",[Object,O.Ke]),p("design:returntype",void 0)],F.prototype,"updateNodesPickable",null),P([(0,c.rc)(O.Jp),p("design:type",Function),p("design:paramtypes",[Object,O.Jp]),p("design:returntype",void 0)],F.prototype,"updateNodesPaint",null),P([(0,c.rc)(O.Ws),p("design:type",Function),p("design:paramtypes",[Object,O.Ws]),p("design:returntype",void 0)],F.prototype,"updateNodesAvailable",null),P([(0,c.rc)(O._n),p("design:type",Function),p("design:paramtypes",[Object,O._n]),p("design:returntype",void 0)],F.prototype,"updateNodeVariants",null),P([(0,c.rc)(O.ZF),p("design:type",Function),p("design:paramtypes",[Object,O.ZF]),p("design:returntype",void 0)],F.prototype,"copyNodesPaint",null),P([(0,c.MD)(),p("design:type",Function),p("design:paramtypes",[e]),p("design:returntype",void 0)],F,"getAllNodeState",null),P([(0,c.MD)(),p("design:type",Function),p("design:paramtypes",[e]),p("design:returntype",void 0)],F,"getActiveChapter",null),P([(0,c.MD)(),p("design:type",Function),p("design:paramtypes",[e]),p("design:returntype",void 0)],F,"getPatches",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getAllNodeState,F.getActiveChapter]),p("design:type",Function),p("design:paramtypes",[Object,String]),p("design:returntype",void 0)],F,"getNodes",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getNodes,W._.getShowUnavailableNodes]),p("design:type",Function),p("design:paramtypes",[Object,Boolean]),p("design:returntype",Object)],F,"getAvailableNodes",null),P([(0,c.MD)(),p("design:type",Function),p("design:paramtypes",[e]),p("design:returntype",void 0)],F,"getNodePaint",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getNodes]),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],F,"getNodeIds",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getCheckedNodes]),p("design:type",Function),p("design:paramtypes",[Array]),p("design:returntype",void 0)],F,"getCheckedNodeIds",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getCheckedNodes]),p("design:type",Function),p("design:paramtypes",[Array]),p("design:returntype",void 0)],F,"getCheckedNodesCount",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getAvailableNodes]),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],F,"getCheckedNodes",null),P([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([F.getAvailableNodes]),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],F,"getSelectedNode",null),F=P([(0,c.Uw)({name:"engineNodes",defaults:{activeChapterId:void 0,nodeState:void 0,patches:[],patchesForChapter:{}}}),p("design:paramtypes",[h.w])],F)},12865:(Se,J,_)=>{"use strict";_.d(J,{r:()=>l});var c=_(10467),e=_(81025),O=_(44867);function l(X,U,$){if(!X.activeChapterId||!X.nodeState)return;const{objectIds:j,patch:h,setByTween:W,show:B,includeUnavailable:H}=U,[V,P,p]=e.vI(X,F=>{const R=F.nodeState[F.activeChapterId],N=H?R:(0,O.bd)(R);h?Object.entries(h).forEach(([M,u])=>{M in N&&(N[M].shown=u)}):(j??Object.keys(N)).forEach(u=>{u in N&&(N[u].shown=B,N[u].shownSetByTween=W,j&&((0,c.I7)($,u,N,"shown",B),!0===W&&(0,c.I7)($,u,N,"shownSetByTween",W)))})});return{finalState:e.jM(V,F=>{F.patches=P,F.patchesForChapter[F.activeChapterId].push(...P)}),patches:P,inversePatches:p}}},10467:(Se,J,_)=>{"use strict";_.d(J,{I7:()=>l,hW:()=>X});var c=_(49204);function O($,j){const h=j.children;return 0===h.length?[]:(0,c.flattenDeep)(h.map(W=>[W.objectId,...O($,$.getObjectById(W.objectId))]))}function l($,j,h,W,B){const H=$.getObjectById(j);O($,H).forEach(P=>{P in h&&(h[P][W]=B)})}function X($,j,h,W,B){W.forEach(H=>{const V=$.getObjectById(H),P=O($,V);U(j,h,H,B),P.forEach(p=>{U(j,h,p,B)})})}function U($,j,h,W){j[h][W]=(0,c.cloneDeep)($[h][W])}},35939:(Se,J,_)=>{"use strict";var c,e;_.d(J,{u:()=>c}),(e=c||(c={})).SetParticleState=(()=>{class g{constructor(C,A,Y){this.particleSystems=C,this.assignedParticles=A,this.tweenParticleLookup=Y}}return g.type="[Engine Particles] Set Particle State",g})(),e.NewParticleSystem=(()=>{class g{constructor(C,A){this.particleSystem=C,this.chapterId=A}}return g.type="[Engine Particles] New Particle System",g})(),e.DuplicateParticleSystem=(()=>{class g{constructor(C,A){this.id=C,this.targetChapterId=A}}return g.type="[Engine Particles] Duplicate Particle System",g})(),e.DuplicateParticleSystemSuccess=(()=>{class g{constructor(C,A){this.id=C,this.targetChapterId=A}}return g.type="[Engine Particles] Duplicate Particle System Success",g})(),e.UpdateParticleSystem=(()=>{class g{constructor(C,A){this.id=C,this.particleSystem=A}}return g.type="[Engine Particles] Update Particle System",g})(),e.SetParticleSystemsVisible=(()=>{class g{constructor(C,A){this.visible=C,this.chapterId=A}}return g.type="[Engine Particles] Set Particle Systems Visible",g})(),e.SetParticleSystemVisible=(()=>{class g{constructor(C,A,Y){this.id=C,this.visible=A,this.chapterId=Y}}return g.type="[Engine Particles] Set Particle System Visible",g})(),e.AssignParticle=(()=>{class g{constructor(C,A){this.id=C,this.chapterId=A}}return g.type="[Engine Particles] Assign Particle",g})(),e.UnassignParticle=(()=>{class g{constructor(C,A){this.id=C,this.chapterId=A}}return g.type="[Engine Particles] Unassign Particle",g})(),e.DeleteParticleSystem=(()=>{class g{constructor(C){this.id=C}}return g.type="[Engine Partiles] Delete Particle System",g})(),e.SelectParticleSystem=(()=>{class g{constructor(C){this.id=C}}return g.type="[Engine Partiles] Select Particle System",g})(),e.SelectParticleConstraint=(()=>{class g{constructor(C){this.index=C}}return g.type="[Engine Partiles] Select Particle Constraint",g})(),e.SelectParticleCreator=(()=>{class g{constructor(C){this.index=C}}return g.type="[Engine Partiles] Select Particle Creator",g})(),e.SelectParticleUpdater=(()=>{class g{constructor(C){this.index=C}}return g.type="[Engine Partiles] Select Particle Updater",g})(),e.UpdateTweenParticleLookupChapters=(()=>{class g{constructor(C){this.chapterMap=C}}return g.type="[Engine Particles] Update Lookup Chapters",g})(),e.SetLookupForChapter=(()=>{class g{constructor(C,A){this.chapterId=C,this.lookup=A}}return g.type="[Engine Particles] Set Lookup for chapter",g})(),e.DeleteChapterLookup=(()=>{class g{constructor(C){this.chapterId=C}}return g.type="[Engine Particles] Delete chapter lookup",g})(),e.ApplyPatch=(()=>{class g{constructor(C){this.patches=C}}return g.type="[Engine Particles] Apply Patch",g})()},12921:(Se,J,_)=>{"use strict";_.d(J,{B:()=>B});var $,W,c=_(65763),e=_(35939),O=_(11113),l=_(86544),X=_(81025),U=_(54438),j=function(H,V,P,p){var R,w=arguments.length,F=w<3?V:null===p?p=Object.getOwnPropertyDescriptor(V,P):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)F=Reflect.decorate(H,V,P,p);else for(var N=H.length-1;N>=0;N--)(R=H[N])&&(F=(w<3?R(F):w>3?R(V,P,F):R(V,P))||F);return w>3&&F&&Object.defineProperty(V,P,F),F},h=function(H,V){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(H,V)};let B=($=class{static particleSystemIdExists(V){return(0,c.Mz)([W],P=>void 0!==P.particleSystems[V])}static particleSystemsForChapter(V){return(0,c.Mz)([W],P=>(P.assignedParticles[V]||[]).map(w=>P.particleSystems[w]))}static getVisibleParticleSystemsForChapter(V){return(0,c.Mz)([W],P=>{const w=P.visibleParticleSystems[V]||{};return(P.assignedParticles[V]||[]).filter(F=>!1!==w[F])})}static getTweenParticleLookup(V){return V.tweenParticleLookup}static getParticleSystems(V){return V.particleSystems}static getVisisbleParticleSystems(V){return V.visibleParticleSystems}static getParticleSystemsList(V){return Object.values(V.particleSystems)}static getAssignedParticleSystems(V){return V.assignedParticles}static getSelectedParticleSystemId(V){return V.particleSelection.selectedParticle}static getSelectedParticleSystem(V){const{particleSystems:P,particleSelection:p}=V;return P[p.selectedParticle]}static getSelectedParticleConstraintIndex(V){return V.particleSelection.selectedConstraint}static getSelectedParticleConstraint(V){const P=W.getSelectedParticleSystem(V);return P?P.constraints[V.particleSelection.selectedConstraint]:null}static getSelectedParticleCreatorIndex(V){return V.particleSelection.selectedCreator}static getSelectedParticleCreator(V){const P=W.getSelectedParticleSystem(V);return P?P.creators[V.particleSelection.selectedCreator]:null}static getSelectedParticleUpdaterIndex(V){return V.particleSelection.selectedUpdater}static getSelectedParticleUpdater(V){const P=W.getSelectedParticleSystem(V);return P?P.updaters[V.particleSelection.selectedUpdater]:null}applyPatch(V,P){const p=X.$i(V.getState(),P.patches);V.patchState(p)}setParticleState(V,P){V.patchState(X.jM(V.getState(),p=>{p.particleSystems=P.particleSystems.reduce((w,F)=>(w[F.id]=F,w),{}),p.assignedParticles=P.assignedParticles,p.tweenParticleLookup=P.tweenParticleLookup,p.visibleParticleSystems={}}))}setParticlesVisible(V,{visible:P,chapterId:p}){V.patchState(X.jM(V.getState(),w=>{const R=(w.assignedParticles[p]||[]).reduce((N,M)=>(N[M]=P,N),{});w.visibleParticleSystems={...w.visibleParticleSystems,[p]:R}}))}setParticleVisible(V,{id:P,visible:p,chapterId:w}){V.patchState(X.jM(V.getState(),F=>{F.visibleParticleSystems[w]={...F.visibleParticleSystems[w]||{},[P]:p}}))}newParticleSystem(V,P){const{particleSystem:p,chapterId:w}=P,F=p.id,[R,N,M]=X.vI(V.getState(),u=>{u.particleSystems[F]=p,u.assignedParticles[w]=[...u.assignedParticles[w]||[],F]});V.patchState(R)}duplicateParticleSystem(V,P){const{id:p,targetChapterId:w}=P,F=l.R.generateParticleId(p);V.patchState(X.jM(V.getState(),R=>{R.particleSystems[F]=JSON.parse(JSON.stringify(R.particleSystems[p])),R.particleSystems[F].id=F,R.assignedParticles[w].push(F);const N=l.R.getParticleIdRoot(p);R.tweenParticleLookup[w]&&R.tweenParticleLookup[w][N]&&(R.tweenParticleLookup=O.e.addEntryForChapter(w,{[N]:F},R.tweenParticleLookup))})),V.dispatch(new e.u.DuplicateParticleSystemSuccess(F,w))}updateParticleSystem(V,P){const p=X.jM(V.getState(),w=>{w.particleSystems[P.id]=P.particleSystem});V.patchState({...p,particleSystems:{...p.particleSystems}})}deleteChapterLookup(V,P){V.patchState(X.jM(V.getState(),p=>{delete p.tweenParticleLookup[P.chapterId]}))}setLookupForChapter(V,P){V.patchState(X.jM(V.getState(),p=>{p.tweenParticleLookup[P.chapterId]=P.lookup}))}assignParticle(V,P){V.patchState(X.jM(V.getState(),p=>{const w=p.assignedParticles[P.chapterId]||[],F=l.R.getParticleIdRoot(P.id);p.assignedParticles[P.chapterId]=w.concat(P.id),p.tweenParticleLookup=O.e.addEntryForChapter(P.chapterId,{[F]:P.id},p.tweenParticleLookup),p.particleSystems={...p.particleSystems}}))}unassignParticle(V,P){V.patchState(X.jM(V.getState(),p=>{const w=p.assignedParticles[P.chapterId]||[],F=l.R.getParticleIdRoot(P.id);p.assignedParticles[P.chapterId]=w.filter(R=>R!==P.id),p.tweenParticleLookup[P.chapterId]&&delete p.tweenParticleLookup[P.chapterId][F],p.particleSystems={...p.particleSystems}}))}deleteParticleSystem(V,P){V.patchState(X.jM(V.getState(),p=>{delete p.particleSystems[P.id],Object.keys(p.assignedParticles).forEach(w=>{p.assignedParticles[w]=p.assignedParticles[w].filter(F=>F!==P.id)}),Object.keys(p.tweenParticleLookup).forEach(w=>{delete p.tweenParticleLookup[w][l.R.getParticleIdRoot(P.id)]})}))}selectParticleSystem(V,P){V.patchState(X.jM(V.getState(),p=>{p.particleSelection={selectedParticle:P.id}}))}selectParticleConstraint(V,P){const w=V.getState().particleSelection;V.patchState(X.jM(V.getState(),F=>{F.particleSelection={...w,selectedConstraint:P.index}}))}selectParticleCreator(V,P){const w=V.getState().particleSelection;V.patchState(X.jM(V.getState(),F=>{F.particleSelection={...w,selectedCreator:P.index}}))}selectParticleUpdater(V,P){const w=V.getState().particleSelection;V.patchState(X.jM(V.getState(),F=>{F.particleSelection={...w,selectedUpdater:P.index}}))}updateTweenParticleLookupChapters(V,P){V.patchState(X.jM(V.getState(),p=>{p.tweenParticleLookup=O.e.updateChapterIds(p.tweenParticleLookup,P.chapterMap)}))}constructor(){}},W=$,$.\u0275fac=function(V){return new(V||$)},$.\u0275prov=U.jDH({token:$,factory:$.\u0275fac}),$);j([(0,c.rc)(e.u.ApplyPatch),h("design:type",Function),h("design:paramtypes",[Object,e.u.ApplyPatch]),h("design:returntype",void 0)],B.prototype,"applyPatch",null),j([(0,c.rc)(e.u.SetParticleState),h("design:type",Function),h("design:paramtypes",[Object,e.u.SetParticleState]),h("design:returntype",void 0)],B.prototype,"setParticleState",null),j([(0,c.rc)(e.u.SetParticleSystemsVisible),h("design:type",Function),h("design:paramtypes",[Object,e.u.SetParticleSystemsVisible]),h("design:returntype",void 0)],B.prototype,"setParticlesVisible",null),j([(0,c.rc)(e.u.SetParticleSystemVisible),h("design:type",Function),h("design:paramtypes",[Object,e.u.SetParticleSystemVisible]),h("design:returntype",void 0)],B.prototype,"setParticleVisible",null),j([(0,c.rc)(e.u.NewParticleSystem),h("design:type",Function),h("design:paramtypes",[Object,e.u.NewParticleSystem]),h("design:returntype",void 0)],B.prototype,"newParticleSystem",null),j([(0,c.rc)(e.u.DuplicateParticleSystem),h("design:type",Function),h("design:paramtypes",[Object,e.u.DuplicateParticleSystem]),h("design:returntype",void 0)],B.prototype,"duplicateParticleSystem",null),j([(0,c.rc)(e.u.UpdateParticleSystem),h("design:type",Function),h("design:paramtypes",[Object,e.u.UpdateParticleSystem]),h("design:returntype",void 0)],B.prototype,"updateParticleSystem",null),j([(0,c.rc)(e.u.DeleteChapterLookup),h("design:type",Function),h("design:paramtypes",[Object,e.u.DeleteChapterLookup]),h("design:returntype",void 0)],B.prototype,"deleteChapterLookup",null),j([(0,c.rc)(e.u.SetLookupForChapter),h("design:type",Function),h("design:paramtypes",[Object,e.u.SetLookupForChapter]),h("design:returntype",void 0)],B.prototype,"setLookupForChapter",null),j([(0,c.rc)(e.u.AssignParticle),h("design:type",Function),h("design:paramtypes",[Object,e.u.AssignParticle]),h("design:returntype",void 0)],B.prototype,"assignParticle",null),j([(0,c.rc)(e.u.UnassignParticle),h("design:type",Function),h("design:paramtypes",[Object,e.u.UnassignParticle]),h("design:returntype",void 0)],B.prototype,"unassignParticle",null),j([(0,c.rc)(e.u.DeleteParticleSystem),h("design:type",Function),h("design:paramtypes",[Object,e.u.DeleteParticleSystem]),h("design:returntype",void 0)],B.prototype,"deleteParticleSystem",null),j([(0,c.rc)(e.u.SelectParticleSystem),h("design:type",Function),h("design:paramtypes",[Object,e.u.SelectParticleSystem]),h("design:returntype",void 0)],B.prototype,"selectParticleSystem",null),j([(0,c.rc)(e.u.SelectParticleConstraint),h("design:type",Function),h("design:paramtypes",[Object,e.u.SelectParticleConstraint]),h("design:returntype",void 0)],B.prototype,"selectParticleConstraint",null),j([(0,c.rc)(e.u.SelectParticleCreator),h("design:type",Function),h("design:paramtypes",[Object,e.u.SelectParticleCreator]),h("design:returntype",void 0)],B.prototype,"selectParticleCreator",null),j([(0,c.rc)(e.u.SelectParticleUpdater),h("design:type",Function),h("design:paramtypes",[Object,e.u.SelectParticleUpdater]),h("design:returntype",void 0)],B.prototype,"selectParticleUpdater",null),j([(0,c.rc)(e.u.UpdateTweenParticleLookupChapters),h("design:type",Function),h("design:paramtypes",[Object,e.u.UpdateTweenParticleLookupChapters]),h("design:returntype",void 0)],B.prototype,"updateTweenParticleLookupChapters",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getTweenParticleLookup",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getParticleSystems",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getVisisbleParticleSystems",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getParticleSystemsList",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getAssignedParticleSystems",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleSystemId",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleSystem",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleConstraintIndex",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleConstraint",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleCreatorIndex",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleCreator",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleUpdaterIndex",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],B,"getSelectedParticleUpdater",null),B=W=j([(0,c.Uw)({name:"engineParticles",defaults:{particleSelection:{},particleSystems:{},visibleParticleSystems:{},assignedParticles:{},tweenParticleLookup:{}}}),h("design:paramtypes",[])],B)},11040:(Se,J,_)=>{"use strict";_.d(J,{DC:()=>B,IB:()=>U,NS:()=>j,U1:()=>h,WF:()=>O,kF:()=>H,q:()=>l});var c=_(24418),e=_(27180);const O={ja:"ja-JP","pt-PT":"pt-BR"},l={title:"English",lang:"en",country:"us",id:"en-US",direction:"ltr",applications:[e.c.All]},U=[l,{title:"Espa\xf1ol",lang:"es",country:"es",id:"es-ES",direction:"ltr",applications:[e.c.All]},{title:"\u4e2d\u6587(\u7b80\u4f53)",lang:"zh",country:"cn",id:"zh-CN",direction:"ltr",applications:[e.c.All]},{title:"Fran\xe7ais",lang:"fr",country:"fr",id:"fr-FR",direction:"ltr",applications:[e.c.All]},{title:"Deutsch",lang:"de",country:"de",id:"de-DE",direction:"ltr",applications:[e.c.All]},{title:"Italiano",lang:"it",country:"it",id:"it-IT",direction:"ltr",applications:[e.c.All]},{title:"\u65e5\u672c\u8a9e",lang:"ja",country:"ja",id:"ja",direction:"ltr",applications:[e.c.All]},{title:"Portugu\xeas",lang:"pt",country:"pt",id:"pt-PT",direction:"ltr",applications:[e.c.All]},{title:"\u05e2\u05b4\u05d1\u05e8\u05b4\u05d9\u05ea",lang:"he",country:"il",id:"he-IL",direction:"rtl",applications:[e.c.Viewer]}].filter(V=>V.applications.includes(e.c.All)||V.applications.includes(c.c.application));function j(V){return U.find(P=>P.id===V)}function h(V){return U.find(P=>P.lang===V)}function B(){return h(new URLSearchParams(window.location.search).get("lang"))??l}function H(){return(c.c.application===e.c.Viewer?B():function W(){let V="";try{V=localStorage.getItem("locale")}catch{}return j(V)||l}()).id}},45189:(Se,J,_)=>{"use strict";_.d(J,{G:()=>Z});var c=_(45887),e=_(64109),O=_(82765),l=_(86600),X=_(88834),U=_(5951),$=_(82798),j=_(59115),h=_(55911),W=_(65571),B=_(34006),H=_(14823),V=_(95416),P=_(71997),p=_(90882),w=_(67575),N=(_(28931),_(65478)),M=_(81391),u=_(47987),g=_(76939),E=_(30450),C=_(54438);const A={disabled:!0,animation:{enterDuration:0,exitDuration:0}},Y={...(0,H.zi)(),touchGestures:"off",disableTooltipInteractivity:!0};let Z=(()=>{var Q;class y{}return(Q=y).\u0275fac=function(S){return new(S||Q)},Q.\u0275mod=C.$C({type:Q}),Q.\u0275inj=C.G2t({providers:[{provide:V.x6,useValue:{duration:3e3}},{provide:l.$E,useValue:A},{provide:H.sM,useValue:Y}],imports:[M.ad,c.N0,O.g7,O.g7,X.Hl,U.Wk,$.Ve,j.Cn,h.s5,W.Vg,B.hM,H.uc,V._T,P.w,p.vg,N.E9,u.z_,g.jc,E.mV,M.ad,c.N0,e.Dc,O.g7,O.g7,X.Hl,U.Wk,$.Ve,j.Cn,h.s5,W.Vg,B.hM,H.uc,V._T,P.w,p.vg,N.E9,u.z_,g.jc,E.mV,w.PO]}),y})()},30234:(Se,J,_)=>{"use strict";_.d(J,{O:()=>e,a:()=>c});var c=function(O){return O.WoltersKluwer="wolters_kluwer",O.Zspace="zspace",O}(c||{}),e=function(O){return O.None="none",O.Subscription="subcription",O.Device="device",O}(e||{})},76774:(Se,J,_)=>{"use strict";_.d(J,{Br:()=>R,En:()=>h,Ie:()=>u,MH:()=>M,z9:()=>P});var c=_(49204),U=(_(59429),_(24151),_(69568),_(43753));function h(E){const C=E.map(A=>(A.quizQuestions||[]).map(Z=>({...Z,chapterId:Z.chapterId||A.id})));return[].concat(...C)}function P(E,C,A){return{...E,id:C,chapterId:A,data:p(E.type,E.data,A)}}function p(E,C,A){return E===U.Q5.LabelAnatomy?function w(E,C){return{...E,options:E.options.map(A=>({...A,label:{...A.label,chapterId:C}}))}}(C,A):(0,c.cloneDeep)(C)}function F(E){return"string"==typeof E.data.correctAnswer?[E.data.correctAnswer]:E.data.correctAnswer}function R(E,C){const A=F(E);switch(E.type){case U.Q5.LabelAnatomy:return(0,c.isEqual)(A,C);case U.Q5.MultipleChoice:return(0,c.isEqual)(A.sort(),C.sort());case U.Q5.SelectAnatomy:if(void 0===E.data.selectType||"all"===E.data.selectType)return(0,c.isEqual)(A.sort(),C.sort());if("any"===E.data.selectType)return 0===(0,c.difference)(C,A).length&&C.length>0}}function M(E,C){const A=E.filter(ne=>ne.type!==U.Q5.Instructions),Y=E.reduce((ne,m)=>(ne[m.id]=function N(E,C){const A=E.find(Y=>Y.questionId===C);return A?A.answer:void 0}(C,m.id),ne),{}),Z=E.reduce((ne,m)=>(ne[m.id]=F(m),ne),{}),Q=A.filter(ne=>{const m=Y[ne.id];return R(ne,typeof m>"u"?[]:"string"==typeof m?[m]:m)}),y=E.length,b=A.length,S=Q.length,v=y-S;return{score:y>0?Math.round(S/b*100):0,total:y,scorableTotal:b,correctTotal:S,incorrectTotal:v,questionAnswers:Y,correctQuestionAnswers:Z}}function u(E){switch((0,c.get)(E,"type","")){case U.Q5.MultipleChoice:const A=(0,c.get)(E,"data.correctAnswer","");return A&&""!==A;case U.Q5.SelectAnatomy:case U.Q5.LabelAnatomy:return(0,c.get)(E,"data.correctAnswer",[]).length>0;default:return!0}}_(65776)},24552:(Se,J,_)=>{"use strict";_.d(J,{h:()=>c});var c=function(e){return e[e.Question=0]="Question",e[e.Explanation=1]="Explanation",e[e.Review=2]="Review",e}(c||{})},43753:(Se,J,_)=>{"use strict";_.d(J,{Q5:()=>c,of:()=>e});var c=function(l){return l.MultipleChoice="multiple-choice",l.SelectAnatomy="select-anatomy",l.LabelAnatomy="label-anatomy",l.Instructions="text-only",l}(c||{});const e={[c.MultipleChoice]:"Multiple Choice",[c.SelectAnatomy]:"Select Anatomy in 3D",[c.LabelAnatomy]:"Label Anatomy",[c.Instructions]:"Instructions"}},76016:(Se,J,_)=>{"use strict";var c,e;_.d(J,{B:()=>c}),(e=c||(c={})).SetQuizState=(()=>{class C{constructor(Y){this.quizState=Y}}return C.type="[Quiz] Set Quiz State",C})(),e.ResetQuizState=(()=>{class C{constructor(){}}return C.type="[Quiz] Reset Quiz State",C})(),e.SetQuizSettings=(()=>{class C{constructor(Y){this.quizSettings=Y}}return C.type="[Quiz] Set Quiz Settings",C})(),e.SetQuizActive=(()=>{class C{constructor(Y){this.active=Y}}return C.type="[Quiz] Set Quiz Active",C})(),e.SetQuizLocked=(()=>{class C{constructor(Y){this.locked=Y}}return C.type="[Quiz] Set Quiz Locked",C})(),e.SetEnableQuizRetake=(()=>{class C{constructor(Y){this.enable=Y}}return C.type="[Quiz] Set Enable Quiz Retake",C})(),e.SetQuizQuestionsMode=(()=>{class C{constructor(Y){this.mode=Y}}return C.type="[Quiz] Set Quiz Questions Mode",C})(),e.ReorderQuestions=(()=>{class C{constructor(Y){this.chapterIds=Y}}return C.type="[Quiz] Reoder Quiz Questions",C})(),e.AddQuestion=(()=>{class C{constructor(Y){this.question=Y}}return C.type="[Quiz] Add Quiz Question",C})(),e.SetQuestions=(()=>{class C{constructor(Y){this.questions=Y}}return C.type="[Quiz] Set Quiz Questions",C})(),e.RemoveQuestions=(()=>{class C{constructor(Y){this.questionIds=Y}}return C.type="[Quiz] Remove Quiz Questions",C})(),e.SetQuestion=(()=>{class C{constructor(Y){this.question=Y}}return C.type="[Quiz] Set Quiz Question",C})(),e.SubmitQuestionAnswer=(()=>{class C{constructor(Y){this.submission=Y}}return C.type="[Quiz] Submit Question Answer",C})(),e.NextQuestion=(()=>{class C{constructor(){}}return C.type="[Quiz] Advance Question",C})(),e.PreviousQuestion=(()=>{class C{constructor(){}}return C.type="[Quiz] Previous Question",C})(),e.ClearSubmissions=(()=>{class C{constructor(){}}return C.type="[Quiz] Clear Submissions",C})(),e.SetActiveQuestion=(()=>{class C{constructor(Y){this.questionId=Y}}return C.type="[Quiz] Set Active Question",C})(),e.SetQuizPickMode=(()=>{class C{constructor(Y){this.pickMode=Y}}return C.type="[Quiz] Set Pick Mode",C})(),e.SetActiveSubmission=(()=>{class C{constructor(Y){this.submission=Y}}return C.type="[Quiz] Set Active QuestionAnswer",C})(),e.SetQuizLifecycle=(()=>{class C{constructor(Y){this.lifecycle=Y}}return C.type="[Quiz] Set Quiz Lifecycle",C})()},87710:(Se,J,_)=>{"use strict";_.d(J,{W:()=>B,j:()=>R});var $,W,c=_(65763),e=_(76016),O=_(76774),l=_(43753),X=_(24552),U=_(54438),j=function(N,M,u,g){var A,E=arguments.length,C=E<3?M:null===g?g=Object.getOwnPropertyDescriptor(M,u):g;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(N,M,u,g);else for(var Y=N.length-1;Y>=0;Y--)(A=N[Y])&&(C=(E<3?A(C):E>3?A(M,u,C):A(M,u))||C);return E>3&&C&&Object.defineProperty(M,u,C),C},h=function(N,M){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(N,M)},B=function(N){return N[N.Learning=0]="Learning",N[N.Assessment=1]="Assessment",N}(B||{});const V={quizModeActive:!1,quizModeLocked:!1,quizQuestionsMode:"all",enableQuizRetake:!0,launchMode:B.Learning,questions:[],activeQuestionId:void 0,activeSubmission:void 0,questionSubmissions:[],quizSettings:{enabled:!0,showSummary:!0,showExplanation:!0,showSubmit:!0,showProgress:!0},pickMode:"single",lifecycle:X.h.Question};function P(N,M){return N.filter(u=>u.chapterId===M)}function w(N,M){const u=M.map(E=>P(N,E));return[].concat(...u)}function F(N){const M=function p(N){return[...new Set(N.map(M=>M.chapterId))]}(N);return w(N,M)}let R=(W=$=class{static getQuizQuestionsByChapter(M){return(0,c.Mz)([W],u=>P(u.questions,M))}static getLifecycle(M){return M.lifecycle}static getQuizSettings(M){return M.quizSettings}static getQuizModeActive(M){return M.quizModeActive}static getQuizModeLocked(M){return M.quizModeLocked}static getEnableQuizRetake(M){return M.enableQuizRetake}static getQuizReviewEnabled(M){const{quizModeLocked:u,quizQuestionsMode:g,questions:E,quizSettings:C}=M;return!(u&&!C.showSummary||u&&"restricted"===g&&1===E.length)}static globalSceneConfig(M){return M.sceneConfig}static hasQuiz(M){return M.questions.length>0}static getQuizEnabled(M){return!1!==M.quizSettings.enabled}static getAllQuestions(M){return M.questions}static getAllSubmissions(M){return M.questionSubmissions}static getActiveSubmitted(M){const{questionSubmissions:u,activeQuestionId:g}=M;return u.find(E=>E.questionId===g)}static getActiveSubmission(M){return M.activeSubmission}static getActiveQuestion(M){return M.questions.find(u=>u.id===M.activeQuestionId)}static getActiveQuestionId(M){return M.activeQuestionId}static getActiveQuestionLabels(M){const u=M.questions.find(g=>g.id===M.activeQuestionId);return u&&u.type===l.Q5.LabelAnatomy?u.data.options:[]}static getActiveQuestionIndex(M){return M.questions.findIndex(u=>u.id===M.activeQuestionId)}static getQuestionIndex(M,u){return(0,c.Mz)([W],g=>w(g.questions,M).findIndex(E=>E.id===u))}static getQuestionTotal(M){return M.questions.length}static getCorrectAnswerTotal(M){const{questionSubmissions:u,questions:g}=M;return u.filter(C=>{const A=g.find(Y=>Y.id===C.questionId);return(0,O.Br)(A,C.answer)}).length}static getQuestionsRemaining(M){const{questions:u,questionSubmissions:g}=M;return u.length-g.length}static hasQuestionRemaining(M){const{questions:u,questionSubmissions:g}=M;return g.length<u.length}static getPickMode(M){return M.pickMode}resetQuizState(M,u){M.setState({...V})}setQuizState(M,{quizState:u}){M.setState({...V,...u})}setQuizSettings(M,{quizSettings:u}){M.patchState({quizSettings:u})}setQuizActive(M,u){M.patchState({quizModeActive:u.active,activeQuestionId:!1===u.active?void 0:M.getState().activeQuestionId})}setQuizLocked(M,u){M.patchState({quizModeLocked:u.locked})}setEnableQuizRetake(M,u){M.patchState({enableQuizRetake:u.enable})}setQuizQuestionsMode(M,u){M.patchState({quizQuestionsMode:u.mode})}reorderQuestions(M,{chapterIds:u}){M.patchState({questions:w(M.getState().questions,u)})}addQuestion(M,u){const g=[...M.getState().questions,u.question];M.patchState({questions:F(g)})}setQuestions(M,{questions:u}){M.patchState({questions:F(u)})}setQuestion(M,u){const g=M.getState().questions.map(E=>E.id===u.question.id?u.question:E);M.patchState({questions:g})}removeQuestions(M,u){const g=M.getState(),E=null!=u.questionIds?u.questionIds:g.questions.map(A=>A.id),C=g.questions.filter(A=>!E.includes(A.id));M.patchState({questions:F(C)})}submitQuestionAnswer(M,u){const g=[...M.getState().questionSubmissions],E=g.findIndex(A=>A.questionId===u.submission.questionId);E>-1?g[E]=u.submission:g.push(u.submission),M.patchState({questionSubmissions:g})}nextQuestion(M){const{questions:u,activeQuestionId:g}=M.getState(),E=M.getState().questions.findIndex(A=>A.id===g),C=u[E+1]?.id||void 0;void 0!==C&&M.patchState({activeQuestionId:C})}previousQuestion(M){const{questions:u,activeQuestionId:g}=M.getState(),E=M.getState().questions.findIndex(A=>A.id===g),C=u[E-1]?.id||void 0;void 0!==C&&M.patchState({activeQuestionId:C})}clearSubmissions(M){M.patchState({questionSubmissions:[]})}setActiveQuestion(M,u){M.patchState({activeQuestionId:u.questionId})}setQuizPickMode(M,{pickMode:u}){M.patchState({pickMode:u})}setActiveSubmission(M,{submission:u}){M.patchState({activeSubmission:u})}setQuizLifecycle(M,u){M.patchState({lifecycle:u.lifecycle})}},$.\u0275fac=function(M){return new(M||$)},$.\u0275prov=U.jDH({token:$,factory:$.\u0275fac}),$);j([(0,c.rc)(e.B.ResetQuizState),h("design:type",Function),h("design:paramtypes",[Object,e.B.ResetQuizState]),h("design:returntype",void 0)],R.prototype,"resetQuizState",null),j([(0,c.rc)(e.B.SetQuizState),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizState]),h("design:returntype",void 0)],R.prototype,"setQuizState",null),j([(0,c.rc)(e.B.SetQuizSettings),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizSettings]),h("design:returntype",void 0)],R.prototype,"setQuizSettings",null),j([(0,c.rc)(e.B.SetQuizActive),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizActive]),h("design:returntype",void 0)],R.prototype,"setQuizActive",null),j([(0,c.rc)(e.B.SetQuizLocked),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizLocked]),h("design:returntype",void 0)],R.prototype,"setQuizLocked",null),j([(0,c.rc)(e.B.SetEnableQuizRetake),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetEnableQuizRetake]),h("design:returntype",void 0)],R.prototype,"setEnableQuizRetake",null),j([(0,c.rc)(e.B.SetQuizQuestionsMode),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizQuestionsMode]),h("design:returntype",void 0)],R.prototype,"setQuizQuestionsMode",null),j([(0,c.rc)(e.B.ReorderQuestions),h("design:type",Function),h("design:paramtypes",[Object,e.B.ReorderQuestions]),h("design:returntype",void 0)],R.prototype,"reorderQuestions",null),j([(0,c.rc)(e.B.AddQuestion),h("design:type",Function),h("design:paramtypes",[Object,e.B.AddQuestion]),h("design:returntype",void 0)],R.prototype,"addQuestion",null),j([(0,c.rc)(e.B.SetQuestions),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuestions]),h("design:returntype",void 0)],R.prototype,"setQuestions",null),j([(0,c.rc)(e.B.SetQuestion),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuestion]),h("design:returntype",void 0)],R.prototype,"setQuestion",null),j([(0,c.rc)(e.B.RemoveQuestions),h("design:type",Function),h("design:paramtypes",[Object,e.B.RemoveQuestions]),h("design:returntype",void 0)],R.prototype,"removeQuestions",null),j([(0,c.rc)(e.B.SubmitQuestionAnswer),h("design:type",Function),h("design:paramtypes",[Object,e.B.SubmitQuestionAnswer]),h("design:returntype",void 0)],R.prototype,"submitQuestionAnswer",null),j([(0,c.rc)(e.B.NextQuestion),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R.prototype,"nextQuestion",null),j([(0,c.rc)(e.B.PreviousQuestion),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R.prototype,"previousQuestion",null),j([(0,c.rc)(e.B.ClearSubmissions),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R.prototype,"clearSubmissions",null),j([(0,c.rc)(e.B.SetActiveQuestion),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetActiveQuestion]),h("design:returntype",void 0)],R.prototype,"setActiveQuestion",null),j([(0,c.rc)(e.B.SetQuizPickMode),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizPickMode]),h("design:returntype",void 0)],R.prototype,"setQuizPickMode",null),j([(0,c.rc)(e.B.SetActiveSubmission),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetActiveSubmission]),h("design:returntype",void 0)],R.prototype,"setActiveSubmission",null),j([(0,c.rc)(e.B.SetQuizLifecycle),h("design:type",Function),h("design:paramtypes",[Object,e.B.SetQuizLifecycle]),h("design:returntype",void 0)],R.prototype,"setQuizLifecycle",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getLifecycle",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Object)],R,"getQuizSettings",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getQuizModeActive",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getQuizModeLocked",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getEnableQuizRetake",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Boolean)],R,"getQuizReviewEnabled",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"globalSceneConfig",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"hasQuiz",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getQuizEnabled",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getAllQuestions",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getAllSubmissions",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getActiveSubmitted",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getActiveSubmission",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getActiveQuestion",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getActiveQuestionId",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Array)],R,"getActiveQuestionLabels",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getActiveQuestionIndex",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getQuestionTotal",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getCorrectAnswerTotal",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getQuestionsRemaining",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"hasQuestionRemaining",null),j([(0,c.MD)(),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],R,"getPickMode",null),R=W=j([(0,c.Uw)({name:"quiz",defaults:V})],R)},65881:(Se,J,_)=>{"use strict";_.d(J,{G:()=>O,S:()=>e});var c=_(59429);function e(l,X){return l.reduce((U,$)=>(U[$.id]=!0===X?O():$.id,U),{})}function O(){return c.u.idWithPrefix("chapter")}},4951:(Se,J,_)=>{"use strict";_.d(J,{W:()=>j});var c=_(2573),e=_(15877),O=_(24418),l=_(92811),X=_(65294),U=_(54438),$=_(83621);let j=(()=>{var h;class W{constructor(H){this.applicationEventService=H}getClipboardAPISupport(){return"clipboard"in navigator}getClipboardAPI(){return navigator.clipboard}nativeShareLink(H){(!0===O.c.native||O.c.platform===l.N.SDK)&&this.applicationEventService.fireEvent(X.F.NativeShare,{type:"shareLinkModel",value:JSON.stringify(H)})}copyToClipboard(H,V){if(!0===O.c.native||O.c.platform===l.N.SDK)return new c.c(P=>{this.applicationEventService.fireEvent(X.F.NativeShare,{type:V,value:H}),P.next(!0),P.complete()});if(this.getClipboardAPISupport()){const P=this.getClipboardAPI();return new c.c(p=>{P.writeText(H).then(()=>{p.next(!0),p.complete()}).catch(w=>{p.next(!1),p.complete()})})}return(0,e.of)(!1)}copyInputFieldValue(H){H.select();let V=!1;try{V=document.execCommand("copy")}catch{V=!1}return V}}return(h=W).\u0275fac=function(H){return new(H||h)(U.KVO($.S))},h.\u0275prov=U.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),W})()},90908:(Se,J,_)=>{"use strict";function c(){const X=document.createElement("canvas"),U=X.getContext("webgl")||X.getContext("experimental-webgl"),$=U instanceof WebGLRenderingContext;return $&&U.getExtension("WEBGL_lose_context")?.loseContext(),$}function e(){return window.matchMedia("(hover: hover)").matches}function O(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function l(){return"scrollBehavior"in document.documentElement.style}_.d(J,{MN:()=>c,ZO:()=>e,uK:()=>l,yd:()=>O})},21007:(Se,J,_)=>{"use strict";_.d(J,{Q:()=>B});var c=_(54438),e=_(82542);const O=["app-button",""],l=["*"],U={[e.P.Light]:{default:"text-gray-800 hover:bg-gray-900/10",flat:"text-gray-700 bg-gray-200 hover:text-black",outline:"border border-solid border-gray-300 text-gray-800 hover:bg-gray-900/10 text-gray-900",primary:"bg-red-700 text-white hover:bg-red-600",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-900 hover:text-gray-800"},[e.P.Dark]:{default:"text-gray-200 hover:bg-gray-800",flat:"bg-gray-700 hover:bg-gray-600",outline:"border border-solid border-gray-600 text-gray-200 hover:bg-white/10 hover:text-white",primary:"bg-red-700 text-white hover:bg-red-600",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-500"}},$={default:"rounded px-4",rounded:"rounded-3xl px-4",circle:"rounded-full",square:"rounded"},j={"2xs":"h-5",xs:"h-6",sm:"h-8",md:"h-9",lg:"h-11",xl:"h-12"},h={"2xs":"w-5",xs:"w-6",sm:"w-8",md:"w-9",lg:"w-11",xl:"w-12"},W={"2xs":"text-2xs",xs:"text-2xs",sm:"text-xs",md:"text-xs",lg:"text-sm",xl:"text-sm"};let B=(()=>{var H;class V{constructor(){this.buttonSize=(0,c.hFB)("md"),this.buttonType=(0,c.hFB)("default"),this.buttonTheme=(0,c.hFB)(e.P.Dark),this.buttonShape=(0,c.hFB)("default"),this.buttonAlign=(0,c.hFB)("center"),this.uppercase=(0,c.hFB)(!0),this.disabled=(0,c.hFB)(!1),this.classes=(0,c.EWP)(()=>{const p=[];switch(p.push("flex items-center justify-center font-sans transition-colors"),p.push(this.disabled()?"opacity-50":"cursor-pointer"),this.uppercase()&&p.push("uppercase"),p.push("left"===this.buttonAlign()?"text-left":"text-center"),p.push(U[this.buttonTheme()][this.buttonType()]),p.push(j[this.buttonSize()]),p.push(W[this.buttonSize()]),p.push($[this.buttonShape()]),this.buttonShape()){case"circle":case"square":p.push(h[this.buttonSize()])}return p.join(" ")})}get hostDisabled(){return this.disabled()}get hostButtonType(){return this.buttonType()}}return(H=V).\u0275fac=function(p){return new(p||H)},H.\u0275cmp=c.VBU({type:H,selectors:[["button","app-button",""],["a","app-button",""]],hostVars:2,hostBindings:function(p,w){2&p&&(c.Mr5("disabled",w.hostDisabled),c.BMQ("data-button-type",w.hostButtonType))},inputs:{buttonSize:[c.Mj6.SignalBased,"buttonSize"],buttonType:[c.Mj6.SignalBased,"buttonType"],buttonTheme:[c.Mj6.SignalBased,"buttonTheme"],buttonShape:[c.Mj6.SignalBased,"buttonShape"],buttonAlign:[c.Mj6.SignalBased,"buttonAlign"],uppercase:[c.Mj6.SignalBased,"uppercase"],disabled:[c.Mj6.SignalBased,"disabled"]},attrs:O,ngContentSelectors:l,decls:2,vars:2,template:function(p,w){1&p&&(c.NAR(),c.j41(0,"span"),c.SdG(1),c.k0s()),2&p&&c.HbH(w.classes())},styles:["a[app-button],button[app-button]{border-color:transparent;background:none;border-width:0;padding:0;border-radius:4px;outline:0 none}a[app-button]:focus,button[app-button]:focus{--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-opacity: 1;--tw-ring-color: rgb(45 114 220 / var(--tw-ring-opacity))}a[app-button][buttonshape=circle],a[app-button][ng-reflect-button-shape=circle],button[app-button][buttonshape=circle],button[app-button][ng-reflect-button-shape=circle]{border-radius:.25rem;border-radius:9999px}a[app-button]:not([disabled]):hover,button[app-button]:not([disabled]):hover{cursor:pointer}\n"],encapsulation:2,changeDetection:0}),V})()},11818:(Se,J,_)=>{"use strict";_.d(J,{C:()=>X});var c=_(60177),e=_(72026),O=_(45189),l=_(54438);let X=(()=>{var U;class ${}return(U=$).\u0275fac=function(h){return new(h||U)},U.\u0275mod=l.$C({type:U}),U.\u0275inj=l.G2t({imports:[c.MD,e.o,O.G]}),$})()},32996:(Se,J,_)=>{"use strict";_.d(J,{z:()=>l});var c=_(60177),e=_(59162),O=_(54438);let l=(()=>{var X;class U{}return(X=U).\u0275fac=function(j){return new(j||X)},X.\u0275mod=O.$C({type:X}),X.\u0275inj=O.G2t({imports:[c.MD,e.M]}),U})()},26779:(Se,J,_)=>{"use strict";_.d(J,{R:()=>O});var c=_(54438),e=_(60177);let O=(()=>{var l;class X{get iconClass(){let j=`${this.custom?"fak":"fas"} fa-${this.icon}`;return this.size&&(j+=` fa-${this.size}`),j}constructor(){this.custom=!1}ngOnInit(){}}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275cmp=c.VBU({type:l,selectors:[["app-icon"]],inputs:{icon:"icon",size:"size",custom:"custom"},decls:1,vars:1,consts:[[3,"ngClass"]],template:function($,j){1&$&&c.nrm(0,"i",0),2&$&&c.Y8G("ngClass",j.iconClass)},dependencies:[e.YU],styles:["[_nghost-%COMP%]{display:inline-block}"],changeDetection:0}),X})()},72026:(Se,J,_)=>{"use strict";_.d(J,{o:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},78696:(Se,J,_)=>{"use strict";_.d(J,{H:()=>U});var c=_(60177),e=_(89417),O=_(45189),l=_(72026),X=_(54438);let U=(()=>{var $;class j{}return($=j).\u0275fac=function(W){return new(W||$)},$.\u0275mod=X.$C({type:$}),$.\u0275inj=X.G2t({imports:[O.G,e.YN,c.MD,l.o]}),j})()},3272:(Se,J,_)=>{"use strict";_.d(J,{D:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},81488:(Se,J,_)=>{"use strict";_.d(J,{f:()=>l});var c=_(60177),e=_(72026),O=_(54438);let l=(()=>{var X;class U{}return(X=U).\u0275fac=function(j){return new(j||X)},X.\u0275mod=O.$C({type:X}),X.\u0275inj=O.G2t({imports:[c.MD,e.o]}),U})()},44120:(Se,J,_)=>{"use strict";_.d(J,{D:()=>St});var c=_(54438),e=_(65763),O=_(47610),l=_(13409),X=_(27180),U=_(61295),$=_(4951),j=_(59115),h=_(1102),W=_(58398),B=_(81881),H=_(47555),V=_(41862),P=function(De){return De.Chapter="chapter",De.Label="label",De.Paint="paint",De.Positions="positions",De.Quiz="quiz",De.Image="image",De}(P||{}),p=_(22959),w=_(43631),F=_(85586),R=_(44867),N=_(60177),M=_(89511),u=_(11818),g=_(72026),E=_(71997),C=_(89079),A=_(95416),Y=_(18617),Z=_(59369),Q=_(21007),y=_(26779);const b=["nodeActionsTrigger"],S=(De,lt)=>lt.id;function v(De,lt){if(1&De&&(c.qex(0),c.j41(1,"button",62),c.pXf(2,22),c.k0s(),c.nrm(3,"mat-divider"),c.bVm()),2&De){c.XpG();const tt=c.sdS(30);c.R7$(),c.Y8G("matMenuTriggerFor",tt)}}function D(De,lt){1&De&&(c.qex(0),c.pXf(1,23),c.bVm())}function ne(De,lt){1&De&&(c.qex(0),c.pXf(1,24),c.bVm())}function m(De,lt){if(1&De&&(c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",63),c.pXf(3,25),c.k0s(),c.bVm()),2&De){c.XpG();const tt=c.sdS(49);c.R7$(2),c.Y8G("matMenuTriggerFor",tt)}}function ce(De,lt){if(1&De&&(c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",64),c.pXf(3,26),c.k0s(),c.bVm()),2&De){c.XpG(2);const tt=c.sdS(56);c.R7$(2),c.Y8G("matMenuTriggerFor",tt)}}function I(De,lt){if(1&De&&c.DNE(0,ce,4,1,"ng-container",47),2&De){const tt=c.XpG();c.Y8G("appFlagApplication",tt.application.Loft)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit")}}function x(De,lt){1&De&&c.nrm(0,"mat-divider")}function K(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",65),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.editNodeLabel(Ae.node()))}),c.pXf(1,27),c.k0s()}}function ie(De,lt){if(1&De){const tt=c.RV6();c.qex(0),c.j41(1,"button",61),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.copy(Ae.node().label))}),c.pXf(2,28),c.k0s(),c.bVm()}}function k(De,lt){if(1&De&&(c.j41(0,"button",67),c.pXf(1,30),c.k0s()),2&De){c.XpG(2);const tt=c.sdS(69);c.Y8G("matMenuTriggerFor",tt)}}function le(De,lt){if(1&De&&(c.qex(0),c.j41(1,"button",66),c.pXf(2,29),c.k0s(),c.DNE(3,k,2,1,"button",67),c.bVm()),2&De){const tt=c.XpG(),je=c.sdS(60);c.R7$(),c.Y8G("matMenuTriggerFor",je),c.R7$(2),c.vxM(3,tt.node().boolState.available?3:-1)}}function de(De,lt){if(1&De){const tt=c.RV6();c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",68),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.samplePaint(Ae.node()))}),c.pXf(3,31),c.k0s(),c.bVm()}}function oe(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",69),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.toggleVisible(Ae.node(),!1))}),c.pXf(1,32),c.k0s()}}function ye(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",70),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.toggleVisible(Ae.node(),!0))}),c.pXf(1,33),c.k0s()}}function z(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",71),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.togglePickable(Ae.node(),!1))}),c.pXf(1,34),c.k0s()}}function ae(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",72),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.togglePickable(Ae.node(),!0))}),c.pXf(1,35),c.k0s()}}function me(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",73),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.toggleAvailable(Ae.node(),!1))}),c.pXf(1,36),c.k0s()}}function Ne(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",74),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG();return c.Njj(Ae.toggleAvailable(Ae.node(),!0))}),c.pXf(1,37),c.k0s()}}function Pe(De,lt){if(1&De){const tt=c.RV6();c.j41(0,"button",59),c.bIt("click",function(){c.eBV(tt);const Ae=c.XpG().$implicit,ge=c.XpG();return c.Njj(ge.copyChapterPaint(ge.node(),Ae.id))}),c.pXf(1,38),c.k0s()}if(2&De){const tt=c.XpG().$index;c.R7$(),c.uP7(tt+1),c.nnv(1)}}function Qe(De,lt){if(1&De&&c.DNE(0,Pe,2,1,"button",75),2&De){const tt=lt.$implicit,je=c.XpG();c.vxM(0,tt.id!==je.selectedChapterId()?0:-1)}}let St=(()=>{var De;class lt{constructor(je,Ae,ge,he,qe,We){this.store=je,this.clipboardService=Ae,this.snackbar=ge,this.liveAnnouncer=he,this.nodeService=qe,this.changeDetectorRef=We,this.application=X.c,this.perChapterTreeEnabled=(0,C.ot)(this.store.select(w._.getPerChapterTreeEnabled)),this.chapters=(0,C.ot)(this.store.select(F.N.getStoryChapters)),this.selectedChapterId=(0,C.ot)(this.store.select(F.N.getSelectedChapterId)),this.node=(0,c.hFB)(),this.theme=(0,c.hFB)("dark"),this.shortId=(0,c.EWP)(()=>{const ut=this.node();return(0,R.KJ)(ut.id)}),this.eventCategory=(0,c.hFB)(""),this.nodeActionsClosed=(0,c.CGW)(),this.nodeActionsTrigger=(0,c.ebz)("nodeActionsTrigger")}isNodeChecked(je){return this.store.selectSnapshot(l.z.getNodes)[je].checked}isNodeShown(je){return this.store.selectSnapshot(l.z.getNodes)[je].shown}checkNode(je,Ae){const ge=void 0===Ae?!this.isNodeChecked(je.id):Ae;this.store.dispatch(new U.q9(ge,[je.id]))}checkInverse(je){this.store.dispatch(new U.q9(!0)),this.store.dispatch(new U.q9(!1,[je.id]))}setCheckedNodes(je,Ae){this.store.dispatch(new U.q9(!1));const ge=void 0===Ae?!this.isNodeChecked(je.id):Ae;this.store.dispatch(new U.q9(ge,[je.id]))}flyToNode(je){this.store.dispatch(new O.W6(je.id)).subscribe(()=>{this.liveAnnouncer.announce("Fly to complete")})}hideNode(je){this.store.dispatch(new U.yr(!1,[je.id]))}showNode(je){this.store.dispatch(new U.yr(!0,[je.id])),this.changeDetectorRef.markForCheck()}toggleVisible(je,Ae){const ge=void 0===Ae?this.isNodeShown(je.id):Ae;this.store.dispatch(new U.yr(ge,[je.id])),this.changeDetectorRef.markForCheck()}togglePickable(je,Ae){this.store.dispatch(new U.Ke(Ae,[je.id])),this.changeDetectorRef.markForCheck()}makeEverythingElseUnpickale(je){this.store.dispatch(new U.Ke(!1)),this.store.dispatch(new U.Ke(!0,[je.id]))}toggleAvailable(je,Ae){this.store.dispatch(new U.Ws(Ae,[je.id])),this.changeDetectorRef.markForCheck()}hideInverse(je){this.nodeService.hideInverse([je.id])}fadeNode(je){this.nodeService.fade([je.id])}fadeInverseNodes(je){this.nodeService.fadeInverse([je.id])}editNodeLabel(je){this.store.dispatch(new O._o(je)),this.store.dispatch(new O.ro(je))}copy(je){this.clipboardService.copyToClipboard(je,"text").subscribe(()=>{this.snackbar.open(`Copied ${je} to clipboard.`)})}onMenuClosed(){this.nodeActionsClosed.emit()}samplePaint(je){const Ae=this.store.selectSnapshot(l.z.getNodePaint)(je.id),ge=(0,h.Sf)(Ae);(0,W.Jl)(ge)?this.store.dispatch(new B.WD(Ae)):this.store.dispatch(new B.Hr),this.store.dispatch(new O.pL(H.s.Paint)),this.store.dispatch(new V.yF(P.Paint))}copyChapterPaint(je,Ae){this.store.dispatch(new U.ZF([je.id],Ae))}}return(De=lt).\u0275fac=function(je){return new(je||De)(c.rXU(e.il),c.rXU($.W),c.rXU(A.UG),c.rXU(Y.Ai),c.rXU(p.w),c.rXU(c.gRc))},De.\u0275cmp=c.VBU({type:De,selectors:[["app-node-actions"]],viewQuery:function(je,Ae){1&je&&c.wEZ(Ae.nodeActionsTrigger,b,5),2&je&&c.NyB()},inputs:{node:[c.Mj6.SignalBased,"node"],theme:[c.Mj6.SignalBased,"theme"],eventCategory:[c.Mj6.SignalBased,"eventCategory"]},outputs:{nodeActionsClosed:"nodeActionsClosed"},standalone:!0,features:[c.aNF],decls:72,vars:31,consts:()=>{let tt,je,Ae,ge,he,qe,We,ut,Ct,bn,Ss,u_,ea,ta,na,ia,oa,sa,ra,ac,bs,ir,or,To,sr,aa,ys,la,ca,rr;return tt=$localize`:8973bc8c23a3f7c42aa9bd447386a3b0d26b74bc278590554940342755:menu`,je=$localize`:0a1d519b102495c607707a8de3e121d9777eb8f57459515625406813591: Isolate `,Ae=$localize`:3f42464a5a50bfc4200a744e960b2193b395d8336476624779946658339: Fade `,ge=$localize`:23054cc1a12bc2f02ce35c53dda0a85a599c42b91462430833776684733: Fly To `,he=$localize`:54cc524c29eb42615ed3660dbda137e40d9dd5027873649950229208086: Select This `,qe=$localize`:0fffdd57d53d51daf33ea3051cfee157555f7a052795853712015890159: Select Everything Else `,We=$localize`:0ef9e3fa378a368d7def26850536752a3de491cf5280042464648975457: Fade This `,ut=$localize`:b8640b44be68c687650962b406f6363a3b8758d76392506384252263496: Fade Everything Else `,Ct=$localize`:59e0b28333dd6b25a8fccbe60b09a1e3be64c3eb4950300091124319961:Hide Everything Else`,bn=$localize`:3cea94df167f2ab21fb6fbca0ac24da30254ab374608376353419364284: Make Everything Else Unselectable `,Ss=$localize`:70b9aca63f75c39c1c4a5a05b2ba3023a77a2b089128837186595333201: Copy Short ID `,u_=$localize`:f9220e31a995fb0f115662c3b630782b55a205069004635034659549721: Copy Full ID `,ea=$localize`:0a3f724079cb80043738d1f0784a7563106faddc2488186665405139057: Copy Display Name `,ta=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,na=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,ia=$localize`:2aba1e87039819aca3b70faa9aa848c12bf139ca8461842260159597706:Show`,oa=$localize`:864421378feb1d521cd7a7174c792db76b43a2187629795719386983652: Selectable / Unselectable `,sa=$localize`:f8552086e072958cbd175fce6ca62724c5f313bb4966413469492836967: Available / Unavailable `,ra=$localize`:9ca20604245c07d56b1413d9e67a151a3ab2022d55699984583421362: Edit Display Name `,ac=$localize`:db693767fd3d7ba3a7c6d19faf21fbacf09226512283300174173662646: Copy Display Name `,bs=$localize`:353d39004ad14e085967669d05448251baab93a72821938014126744982: Copy `,ir=$localize`:9190906690c1c5cd2136c84fb81d0c85751dbc814172863901001023616: Paint `,or=$localize`:28fc8508c6148c461ec04013970b2ed628bfc06e6750409730286190445: Sample Paint `,To=$localize`:f05cec857f16c24d8db89c50f3059742cbbfbbda5339110957660716850: Hide This `,sr=$localize`:552d734ad4619a8965231cc491c0e85a7bb155c73401892363421578792: Show This `,aa=$localize`:968164c8722359889c83d149a11a5397358416601582264599495505864: Make Unselectable `,ys=$localize`:e7a08e6fec5a48b10e609eb63886bbd92fbdbacf2477567055965309744: Make Selectable `,la=$localize`:99751ab6a5c4c71f400d25371daa6fa7d8d74abb2837486388916680829: Make Unavailable `,ca=$localize`:7df51bb35892872f649fbbe6c8ae82dae9edcd123656836653049520580: Make Available `,rr=$localize`:a8db3e589abd66249c1c5671c8587cc8b6714ffc6619637855472690038: Apply Chapter ${"\ufffd0\ufffd"}:INTERPOLATION: Paint `,[["nodeActionsTrigger","matMenuTrigger"],["nodeActions","matMenu"],["selectActions","matMenu"],["fadeActions","matMenu"],["showHideActions","matMenu"],["pickableActions","matMenu"],["availableActions","matMenu"],["copyActions","matMenu"],["paintActions","matMenu"],tt,je,Ae,ge,he,qe,We,ut,Ct,bn,Ss,u_,ea,ta,na,ia,oa,sa,ra,ac,bs,ir,or,To,sr,aa,ys,la,ca,rr,["app-button","","data-test","nodeActionsTrigger","buttonSize","xs","buttonShape","square",3,"menuClosed","buttonTheme","matMenuTriggerFor"],["icon","ellipsis-v","aria-hidden","true"],[1,"sr-only"],[3,"overlapTrigger"],[4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsHideShow",3,"click"],["mat-menu-item","","data-test","nodeActionsIsolate",3,"click"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationPage"],["mat-menu-item","","data-test","nodeActionsFlyTo",3,"click"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click",4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsSelectThis",3,"click"],["mat-menu-item","","data-test","nodeActionsSelectEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable"],["mat-menu-item","","data-test","nodeActionsEverythingElseUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable"],["mat-menu-item","","data-test","nodeActionsCopyShortID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyFullID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyDisplayName",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPickableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsAvailableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPaintTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsSamplePaint",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable",3,"click"],["mat-menu-item","","data-test","nodeActionsAvailable",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyShortID"]]},template:function(je,Ae){if(1&je){const ge=c.RV6();c.qex(0),c.j41(1,"button",39,0),c.bIt("menuClosed",function(){return c.eBV(ge),c.Njj(Ae.onMenuClosed())}),c.nrm(3,"app-icon",40),c.j41(4,"span",41),c.EFF(5),c.qex(6),c.pXf(7,9),c.bVm(),c.k0s()(),c.j41(8,"mat-menu",42,1),c.DNE(10,v,4,1,"ng-container",43),c.j41(11,"button",44),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.toggleVisible(Ae.node(),!Ae.node().boolState.shown))}),c.DNE(12,D,2,0,"ng-container")(13,ne,2,0),c.k0s(),c.j41(14,"button",45),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.hideInverse(Ae.node()))}),c.pXf(15,10),c.k0s(),c.nrm(16,"mat-divider"),c.j41(17,"button",46),c.pXf(18,11),c.k0s(),c.DNE(19,m,4,1,"ng-container",47)(20,I,1,3,"ng-container"),c.nrm(21,"mat-divider"),c.j41(22,"button",48),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.flyToNode(Ae.node()))}),c.pXf(23,12),c.k0s(),c.DNE(24,x,1,0,"mat-divider",43)(25,K,2,0,"button",49)(26,ie,3,0,"ng-container",43)(27,le,4,2,"ng-container",43)(28,de,4,0,"ng-container",43),c.k0s(),c.j41(29,"mat-menu",null,2)(31,"button",50),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.checkNode(Ae.node(),!0))}),c.pXf(32,13),c.k0s(),c.j41(33,"button",51),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.checkInverse(Ae.node()))}),c.pXf(34,14),c.k0s()(),c.j41(35,"mat-menu",null,3)(37,"button",52),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.fadeNode(Ae.node()))}),c.pXf(38,15),c.k0s(),c.j41(39,"button",53),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.fadeInverseNodes(Ae.node()))}),c.pXf(40,16),c.k0s()(),c.j41(41,"mat-menu",null,4),c.DNE(43,oe,2,0,"button",54)(44,ye,2,0),c.nrm(45,"mat-divider"),c.j41(46,"button",55),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.hideInverse(Ae.node()))}),c.pXf(47,17),c.k0s()(),c.j41(48,"mat-menu",null,5),c.DNE(50,z,2,0,"button",56)(51,ae,2,0),c.nrm(52,"mat-divider"),c.j41(53,"button",57),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.makeEverythingElseUnpickale(Ae.node()))}),c.pXf(54,18),c.k0s()(),c.j41(55,"mat-menu",null,6),c.DNE(57,me,2,0,"button",58)(58,Ne,2,0),c.k0s(),c.j41(59,"mat-menu",null,7)(61,"button",59),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.copy(Ae.shortId()))}),c.pXf(62,19),c.k0s(),c.j41(63,"button",60),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.copy(Ae.node().id))}),c.pXf(64,20),c.k0s(),c.nrm(65,"mat-divider"),c.j41(66,"button",61),c.bIt("click",function(){return c.eBV(ge),c.Njj(Ae.copy(Ae.node().label))}),c.pXf(67,21),c.k0s()(),c.j41(68,"mat-menu",null,8),c.Z7z(70,Qe,1,1,null,null,S),c.k0s(),c.bVm()}if(2&je){const ge=c.sdS(9),he=c.sdS(36);c.R7$(),c.Y8G("buttonTheme",Ae.theme())("matMenuTriggerFor",ge),c.R7$(4),c.SpI("",Ae.node().label," "),c.R7$(3),c.Y8G("overlapTrigger",!0),c.R7$(2),c.Y8G("appFlagApplication",Ae.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(2),c.vxM(12,Ae.node().boolState.shown?12:13),c.R7$(5),c.Y8G("matMenuTriggerFor",he),c.R7$(2),c.Y8G("appFlagApplication",Ae.application.All)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit"),c.R7$(),c.vxM(20,Ae.perChapterTreeEnabled()?20:-1),c.R7$(4),c.Y8G("appFlagApplication",Ae.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",Ae.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",Ae.application.Studio)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",Ae.application.Loft)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",Ae.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(15),c.vxM(43,Ae.node().boolState.shown?43:44),c.R7$(7),c.vxM(50,Ae.node().boolState.pickable?50:51),c.R7$(7),c.vxM(57,Ae.node().boolState.available?57:58),c.R7$(13),c.Dyx(Ae.chapters())}},dependencies:[N.MD,j.Cn,j.kk,j.fb,j.Cp,E.w,E.q,M.h,Z.Y,u.C,Q.Q,g.o,y.R],changeDetection:0}),lt})()},82192:(Se,J,_)=>{"use strict";_.d(J,{G:()=>j});var c=_(60177),e=_(44120),O=_(45189),l=_(72026),X=_(11818),U=_(89511),$=_(54438);let j=(()=>{var h;class W{}return(h=W).\u0275fac=function(H){return new(H||h)},h.\u0275mod=$.$C({type:h}),h.\u0275inj=$.G2t({imports:[c.MD,U.h,O.G,X.C,l.o,e.D]}),W})()},46374:(Se,J,_)=>{"use strict";_.d(J,{b:()=>U});var c=_(60177),e=_(11818),O=_(45189),l=_(72026),X=_(54438);let U=(()=>{var $;class j{}return($=j).\u0275fac=function(W){return new(W||$)},$.\u0275mod=X.$C({type:$}),$.\u0275inj=X.G2t({imports:[c.MD,e.C,O.G,l.o]}),j})()},59162:(Se,J,_)=>{"use strict";_.d(J,{M:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},87424:(Se,J,_)=>{"use strict";_.d(J,{j:()=>X});var c=_(54438),e=_(60177);const O=["*"];function l(U,$){1&U&&(c.j41(0,"div"),c.SdG(1),c.k0s())}let X=(()=>{var U;class ${get isActive(){return this._isActive}set isActive(h){this._isActive=h,this.changeDetector.markForCheck()}constructor(h){this.changeDetector=h,this.hide=!1,this._isActive=!1}ngOnInit(){}}return(U=$).\u0275fac=function(h){return new(h||U)(c.rXU(c.gRc))},U.\u0275cmp=c.VBU({type:U,selectors:[["app-tab"]],inputs:{label:"label",hide:"hide"},ngContentSelectors:O,decls:1,vars:1,consts:[[4,"ngIf"]],template:function(h,W){1&h&&(c.NAR(),c.DNE(0,l,2,0,"div",0)),2&h&&c.Y8G("ngIf",W.isActive)},dependencies:[e.bT],changeDetection:0}),$})()},59464:(Se,J,_)=>{"use strict";_.d(J,{j:()=>l});var c=_(60177),e=_(45189),O=_(54438);let l=(()=>{var X;class U{}return(X=U).\u0275fac=function(j){return new(j||X)},X.\u0275mod=O.$C({type:X}),X.\u0275inj=O.G2t({imports:[c.MD,e.G]}),U})()},57018:(Se,J,_)=>{"use strict";_.d(J,{O:()=>F});var c=_(54438),e=_(87424),O=_(29160),l=_(85052),X=_(37925),U=_(1670),$=_(14264),j=_(60177),h=_(71997);const W=["tabButton"],B=["*"],H=(R,N,M,u)=>({"tabs--small":R,"tabs--medium":N,"tabs--scrollable":M,"tabs--padded":u}),V=(R,N,M,u,g,E)=>({"tabs__label--dark":R,"tabs__label--light":N,"tabs__label--dark-active":M,"tabs__label--light-active":u,"tabs__label--blue":g,"tabs__label--red":E});function P(R,N){if(1&R){const M=c.RV6();c.j41(0,"button",7,1),c.bIt("click",function(){const g=c.eBV(M).$implicit,E=c.XpG();return c.Njj(E.handleTabSelect(g))}),c.EFF(2),c.k0s()}if(2&R){const M=N.$implicit,u=c.XpG();c.Y8G("ngClass",c.l4e(4,V,"dark"===u.tabTheme,"light"===u.tabTheme,"dark"===u.tabTheme&&u.isTabActive(M),"light"===u.tabTheme&&u.isTabActive(M),"blue"===u.tabColor,"red"===u.tabColor)),c.BMQ("aria-selected",u.isTabActive(M))("tabIndex",u.isTabActive(M)?0:-1),c.R7$(2),c.SpI(" ",M.label," ")}}function p(R,N){1&R&&c.nrm(0,"mat-divider")}let F=(()=>{var R;class N{get activeTab(){return this._activeTab.value}set activeTab(u){null!=u&&("string"==typeof u&&(u=u.toUpperCase()),this._activeTab.next(u))}get tabItems(){return this._tabItems}set tabItems(u){this._tabItems=u}constructor(u){this.changeDetector=u,this.display="normal",this.tabTheme="dark",this.activeTabChange=new c.bkB,this._activeTab=new O.t(0),this.tabSize="small",this.tabAlign="default",this.tabColor="blue",this.tabUnderline=!1,this.tabPadded=!1,this.scrollable=!1,this.ngUnsubscribe=new l.B}ngAfterContentInit(){this._tabs.changes.pipe((0,X.Q)(this.ngUnsubscribe)).subscribe(u=>{this.mapTabs(),this.changeDetector.markForCheck()}),this.mapTabs(),this._activeTab.pipe((0,X.Q)(this.ngUnsubscribe)).subscribe(u=>{this.showTab(u)}),this._activeTab.pipe((0,U.J)(),(0,$.p)(([u,g])=>u!==g),(0,X.Q)(this.ngUnsubscribe)).subscribe(([u,g])=>{this.activeTabChange.next(g)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTabSelect(u){this._activeTab.next(u.index)}mapTabs(){this.tabItems=this._tabs.map((u,g)=>({index:g,label:u.label||`Item ${g}`,tab:u}))}showTab(u){this._tabs.forEach((g,E)=>{switch(typeof u){case"number":g.isActive=u===E;break;case"string":g.isActive=u.toString().toUpperCase()===g.label.toUpperCase()}}),this.changeDetector.markForCheck()}isTabActive(u){return("string"==typeof this._activeTab.value?u.label.toUpperCase():u.index)===this._activeTab.value}shiftTab(u){const E=(this.tabItems.find(C=>this.isTabActive(C)).index+u+this.tabItems.length)%this.tabItems.length;this._activeTab.next(E),this._buttonRefs.toArray()[E].nativeElement.focus()}}return(R=N).\u0275fac=function(u){return new(u||R)(c.rXU(c.gRc))},R.\u0275cmp=c.VBU({type:R,selectors:[["app-tabs"]],contentQueries:function(u,g,E){if(1&u&&c.wni(E,e.j,4),2&u){let C;c.mGM(C=c.lsd())&&(g._tabs=C)}},viewQuery:function(u,g){if(1&u&&c.GBs(W,5),2&u){let E;c.mGM(E=c.lsd())&&(g._buttonRefs=E)}},inputs:{display:"display",tabTheme:"tabTheme",activeTab:"activeTab",tabSize:"tabSize",tabAlign:"tabAlign",tabColor:"tabColor",tabUnderline:"tabUnderline",tabPadded:"tabPadded",scrollable:"scrollable"},outputs:{activeTabChange:"activeTabChange"},ngContentSelectors:B,decls:7,vars:10,consts:[["tabElements",""],["tabButton",""],[1,"tabs",3,"ngClass"],["role","tablist",1,"tabs__labels",3,"keyup.arrowright","keyup.arrowleft"],["class","tabs__label","role","tab","type","button","data-test","tabButton",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"tabs__content"],["role","tab","type","button","data-test","tabButton",1,"tabs__label",3,"click","ngClass"]],template:function(u,g){if(1&u){const E=c.RV6();c.NAR(),c.j41(0,"div",2)(1,"div",3,0),c.bIt("keyup.arrowright",function(){return c.eBV(E),c.Njj(g.shiftTab(1))})("keyup.arrowleft",function(){return c.eBV(E),c.Njj(g.shiftTab(-1))}),c.DNE(3,P,3,11,"button",4)(4,p,1,0,"mat-divider",5),c.k0s(),c.j41(5,"div",6),c.SdG(6),c.k0s()()}2&u&&(c.Y8G("ngClass",c.ziG(5,H,"small"===g.tabSize,"medium"===g.tabSize,g.scrollable,g.tabPadded)),c.R7$(),c.AVh("tabs__labels--center","center"===g.tabAlign),c.R7$(2),c.Y8G("ngForOf",g.tabItems),c.R7$(),c.Y8G("ngIf",g.tabUnderline))},dependencies:[j.YU,j.Sq,j.bT,h.q],styles:['.tabs__labels[_ngcontent-%COMP%]{margin-bottom:8px}.tabs__labels--center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.tabs__label[_ngcontent-%COMP%]{padding:2px 4px 4px;margin-right:8px;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:500;-webkit-user-select:none;user-select:none;position:relative;background:none;border:none}.tabs__label[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid;margin-top:4px;width:0;transition:.25s ease;position:absolute;bottom:0;left:0}.tabs__label[_ngcontent-%COMP%]:hover{cursor:pointer}.tabs__label--blue[_ngcontent-%COMP%]:after{border-color:#2d72dc}.tabs__label--red[_ngcontent-%COMP%]:after{border-color:#de3535}.tabs__label--dark[_ngcontent-%COMP%]{color:#96a8c0}.tabs__label--dark[_ngcontent-%COMP%]:hover, .tabs__label--dark-active[_ngcontent-%COMP%]{color:#fff}.tabs__label--dark-active[_ngcontent-%COMP%]:after{width:100%}.tabs__label--light[_ngcontent-%COMP%]{color:#374a68}.tabs__label--light[_ngcontent-%COMP%]:hover, .tabs__label--light-active[_ngcontent-%COMP%]{color:#283853}.tabs__label--light-active[_ngcontent-%COMP%]:after{width:100%}.tabs--medium[_ngcontent-%COMP%]   .tabs__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tabs--scrollable[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:100%}.tabs--scrollable[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{overflow:auto;flex:1 1 auto}.tabs--padded[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{padding:20px 4px}'],changeDetection:0}),N})()},64026:(Se,J,_)=>{"use strict";_.d(J,{m:()=>l});var c=_(60177),e=_(11818),O=_(54438);let l=(()=>{var X;class U{}return(X=U).\u0275fac=function(j){return new(j||X)},X.\u0275mod=O.$C({type:X}),X.\u0275inj=O.G2t({imports:[c.MD,e.C]}),U})()},18824:(Se,J,_)=>{"use strict";_.d(J,{j:()=>X});var c=_(60177),e=_(11818),O=_(72026),l=_(54438);let X=(()=>{var U;class ${}return(U=$).\u0275fac=function(h){return new(h||U)},U.\u0275mod=l.$C({type:U}),U.\u0275inj=l.G2t({imports:[c.MD,e.C,O.o]}),$})()},5584:(Se,J,_)=>{"use strict";_.d(J,{d:()=>l});var c=_(60177),e=_(72026),O=_(54438);let l=(()=>{var X;class U{}return(X=U).\u0275fac=function(j){return new(j||X)},X.\u0275mod=O.$C({type:X}),X.\u0275inj=O.G2t({imports:[c.MD,e.o]}),U})()},12854:(Se,J,_)=>{"use strict";_.d(J,{X:()=>P});var c=_(54438),e=_(78109),O=_(65763),l=_(44867),X=_(47610),U=_(82542),$=_(60177),j=_(60724);const h=(p,w)=>w.id,W=p=>({"tree-group--light":p});function B(p,w){if(1&p){const F=c.RV6();c.j41(0,"div",5),c.bIt("click",function(){c.eBV(F);const N=c.XpG(2).$implicit,M=c.XpG();return c.Njj(M.handleExpandClick(N,!0))}),c.k0s()}if(2&p){const F=c.XpG(2).$implicit;c.Y8G("title",F.label)}}function H(p,w){if(1&p&&(c.j41(0,"div",2),c.DNE(1,B,1,1,"div",3),c.nrm(2,"app-tree-group",4),c.k0s()),2&p){const F=c.XpG().$implicit,R=c.XpG();c.R7$(),c.vxM(1,R.hasChildren(F)?1:-1),c.R7$(),c.Y8G("graph",R.graph())("graphNode",F)("theme",R.theme())("layerOrderMode",R.layerOrderMode())("showTreeNodeIds",R.showTreeNodeIds())("showLatinLabel",R.showLatinLabel())}}function V(p,w){if(1&p&&(c.j41(0,"div",0),c.nrm(1,"app-tree-nested-node",1),c.DNE(2,H,3,7,"div",2),c.k0s()),2&p){const F=w.$implicit,R=c.XpG();c.Y8G("ngClass",c.eq3(8,W,R.theme()===R.themeEnum.Light)),c.R7$(),c.Y8G("graph",R.graph())("node",F)("theme",R.theme())("layerOrderMode",R.layerOrderMode())("showTreeNodeIds",R.showTreeNodeIds())("showLatinLabel",R.showLatinLabel()),c.R7$(),c.vxM(2,F.boolState.expanded?2:-1)}}let P=(()=>{var p;class w{constructor(R,N){this.graphService=R,this.store=N,this.themeEnum=U.P,this.graph=c.hFB.required(),this.layerOrderMode=c.hFB.required(),this.showTreeNodeIds=c.hFB.required(),this.showLatinLabel=c.hFB.required(),this.graphNode=(0,c.hFB)(),this.theme=(0,c.hFB)(U.P.Dark),this.nodes=(0,c.EWP)(()=>{const M=this.graphNode(),u=this.graph(),g=M?(0,l.IA)(u,M.id):(0,l.ug)(u);return this.graphService.getNodes(u,g)})}hasChildren(R){const N=this.graph();return(0,l.IA)(N,R.id).length>0}handleExpandClick(R,N){this.store.dispatch(N?new X.z(R):new X._o(R))}}return(p=w).\u0275fac=function(R){return new(R||p)(c.rXU(e.w),c.rXU(O.il))},p.\u0275cmp=c.VBU({type:p,selectors:[["app-tree-group"]],inputs:{graph:[c.Mj6.SignalBased,"graph"],layerOrderMode:[c.Mj6.SignalBased,"layerOrderMode"],showTreeNodeIds:[c.Mj6.SignalBased,"showTreeNodeIds"],showLatinLabel:[c.Mj6.SignalBased,"showLatinLabel"],graphNode:[c.Mj6.SignalBased,"graphNode"],theme:[c.Mj6.SignalBased,"theme"]},standalone:!0,features:[c.aNF],decls:2,vars:0,consts:[[1,"tree-group",3,"ngClass"],[3,"graph","node","theme","layerOrderMode","showTreeNodeIds","showLatinLabel"],[1,"tree-group__children"],[1,"tree-group__collapse",3,"title"],[3,"graph","graphNode","theme","layerOrderMode","showTreeNodeIds","showLatinLabel"],[1,"tree-group__collapse",3,"click","title"]],template:function(R,N){1&R&&c.Z7z(0,V,3,10,"div",0,h),2&R&&c.Dyx(N.nodes())},dependencies:[p,$.MD,$.YU,j.r],styles:['.tree-group[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:after{background:#eaeff5}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover{background:transparent}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#d7e0ea}.tree-group__children[_ngcontent-%COMP%]{padding-inline-start:20px;position:relative}.tree-group__collapse[_ngcontent-%COMP%]{position:absolute;inset-inline-start:0;top:0;bottom:0;width:20px;z-index:1}.tree-group__collapse[_ngcontent-%COMP%]:after{content:" ";display:block;position:absolute;width:1px;inset-inline-start:10px;top:0;bottom:0;background:#1c2a3f}.tree-group__collapse[_ngcontent-%COMP%]:hover{cursor:pointer}.tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#283853}'],changeDetection:0}),w})()},60724:(Se,J,_)=>{"use strict";_.d(J,{r:()=>ne});var c=_(54438),e=_(89079),O=_(65763),l=_(47610),X=_(13409),U=_(24418),$=_(44867),j=_(61295),h=_(55494),W=_(82542),B=_(35650),H=_(43631),V=_(60177),P=_(89511),p=_(11818),w=_(72026),F=_(82192),R=_(38645),N=_(37737),M=_(25780),u=_(49989),g=_(21007),E=_(26779),C=_(44120);const A=(m,ce,I,x)=>({"tree-node--light":m,"tree-node--hidden":ce,"tree-node--selected":I,"tree-node--unpickable":x}),Y=m=>({"tree-node__label--padded":m});function Z(m,ce){if(1&m){const I=c.RV6();c.j41(0,"button",14),c.bIt("click",function(){c.eBV(I);const K=c.XpG();return c.Njj(K.handleExpandClick(K.node()))}),c.nrm(1,"app-icon",15),c.k0s()}if(2&m){const I=c.XpG();c.Y8G("buttonTheme",I.theme()),c.BMQ("aria-label",I.getExpandedLabel(I.node()))("aria-expanded",I.node().boolState.expanded),c.R7$(),c.AVh("rotate-45",I.node().boolState.expanded)}}function Q(m,ce){if(1&m&&(c.j41(0,"div",18),c.EFF(1),c.k0s()),2&m){const I=c.XpG(2);c.R7$(),c.SpI(" ",I.shortId()," ")}}function y(m,ce){1&m&&c.nrm(0,"app-icon",20)}function b(m,ce){if(1&m&&(c.j41(0,"div",22),c.EFF(1),c.k0s()),2&m){const I=c.XpG(2);c.R7$(),c.SpI(" ",I.node().latinLabel," ")}}function S(m,ce){if(1&m){const I=c.RV6();c.j41(0,"div",16),c.bIt("dblclick",function(){c.eBV(I);const K=c.XpG();return c.Njj(K.setEditLabelMode(!0))}),c.j41(1,"div",17),c.DNE(2,Q,2,1,"div",18),c.j41(3,"div",19),c.DNE(4,y,1,0,"app-icon",20),c.j41(5,"span",21),c.pXf(6,2),c.k0s(),c.EFF(7),c.k0s(),c.DNE(8,b,2,1,"div",22),c.k0s()()}if(2&m){const I=c.XpG();c.Y8G("ngClass",c.eq3(6,Y,!I.hasChildren()&&I.nested())),c.BMQ("aria-current",I.checked()),c.R7$(2),c.vxM(2,I.showTreeNodeIds()?2:-1),c.R7$(2),c.vxM(4,I.perChapterTreeEnabled()&&!1===I.node().boolState.available?4:-1),c.R7$(3),c.SpI(" ",I.node().label," "),c.R7$(),c.vxM(8,I.showLatinLabel()&&I.node().latinLabel?8:-1)}}function v(m,ce){if(1&m){const I=c.RV6();c.j41(0,"input",23),c.bIt("blur",function(K){c.eBV(I);const ie=c.XpG();return c.Njj(ie.handleObjectLabel(K))})("keyup",function(K){c.eBV(I);const ie=c.XpG();return c.Njj(ie.handleObjectLabel(K))}),c.k0s()}if(2&m){const I=c.XpG();c.Y8G("value",I.node().label)}}function D(m,ce){if(1&m){const I=c.RV6();c.j41(0,"input",24),c.bIt("change",function(K){c.eBV(I);const ie=c.XpG();return c.Njj(ie.handleLayerOrder(K,ie.node()))}),c.k0s()}if(2&m){const I=c.XpG();c.Y8G("value",I.node().numState.layer)}}let ne=(()=>{var m;class ce{constructor(x,K,ie){this.store=x,this.sceneService=K,this.router=ie,this.themeEnum=W.P,this.isLoft="module"===U.c.exportType,this.nodes=(0,e.ot)(this.store.select(X.z.getNodes)),this.labelEditNode=(0,e.ot)(this.store.select(h.S.getLabelEditNode)),this.perChapterTreeEnabled=(0,e.ot)(this.store.select(H._.getPerChapterTreeEnabled)),this.graph=c.hFB.required(),this.node=c.hFB.required(),this.layerOrderMode=(0,c.hFB)(),this.showTreeNodeIds=(0,c.hFB)(),this.showLatinLabel=(0,c.hFB)(),this.nested=(0,c.hFB)(!0),this.theme=(0,c.hFB)(W.P.Dark),this.hasChildren=(0,c.EWP)(()=>{const k=this.node(),le=this.graph();return this.nodeHasChildren(le,k?.id)}),this.checked=(0,c.EWP)(()=>{const k=this.node(),le=this.nodes();return this.isNodeChecked(le,k.id)}),this.editLabelMode=(0,c.EWP)(()=>{const k=this.node(),le=this.labelEditNode();return k.id===le?.id}),this.sanitizedID=(0,c.EWP)(()=>{const k=this.node();return(0,$.Nk)(k.id)}),this.shortId=(0,c.EWP)(()=>{const k=this.node();return(0,$.KJ)(k.id).replace(/_/g," ")})}ngOnInit(){this.isEditMode=this.router.url.indexOf("/edit")>=0}isNodeChecked(x,K){return x[K].checked}nodeHasChildren(x,K){return!(!x||!K)&&(0,$.IA)(x,K).length>0}getExpandedLabel(x){const{boolState:K,label:ie}=x;return K.expanded?$localize`Collapse`+` ${ie}`:$localize`Expand`+` ${ie}`}handleExpandClick(x){this.toggleExpanded(x,x.boolState.expanded)}toggleVisibleClick(x){this.toggleVisible(x,x.boolState.shown)}handleNodeClick(x,K){x.shiftKey?this.checkNode(K):(this.setCheckedNodes(K),this.isFlyToNodeEnabled(K)&&this.store.dispatch(new l.W6(K.id)),this.toggleExpanded(K,!K.boolState.expanded))}toggleVisible(x,K){this.store.dispatch(new j.yr(!K,[x.id]))}toggleExpanded(x,K){this.store.dispatch(K?new l.z(x):new l._o(x))}handleLayerOrder(x,K){const k=parseInt(x.target.value,10);this.setLayerOrder(K,k)}checkNode(x){const K=this.nodes(),ie=!this.isNodeChecked(K,x.id);this.store.dispatch(new j.q9(ie,[x.id]))}setCheckedNodes(x){const K=this.nodes();this.store.dispatch(new j.q9(!1));const ie=!this.isNodeChecked(K,x.id);this.store.dispatch(new j.q9(ie,[x.id]))}setLayerOrder(x,K){this.store.dispatch(new l.zw([x],K))}handleObjectLabel(x){const K=x.target;x instanceof KeyboardEvent?("enter"===x.key.toLowerCase()&&(this.setLabel(K.value),this.setEditLabelMode(!1)),"escape"===x.key.toLowerCase()&&this.setEditLabelMode(!1)):x instanceof FocusEvent&&"blur"===x.type&&(this.setLabel(K.value),this.setEditLabelMode(!1))}setLabel(x){const K=this.node();this.store.dispatch(new l.$h(K.id,x))}setEditLabelMode(x){if(this.isEditMode){const K=this.node();this.store.dispatch(new l.ro(x?K:null))}}isFlyToNodeEnabled(x){return!this.isEditMode&&(x.boolState.shown||this.sceneService.isObjectLoaded(x.id))}}return(m=ce).\u0275fac=function(x){return new(x||m)(c.rXU(O.il),c.rXU(B.w),c.rXU(R.Ix))},m.\u0275cmp=c.VBU({type:m,selectors:[["app-tree-nested-node"]],inputs:{graph:[c.Mj6.SignalBased,"graph"],node:[c.Mj6.SignalBased,"node"],layerOrderMode:[c.Mj6.SignalBased,"layerOrderMode"],showTreeNodeIds:[c.Mj6.SignalBased,"showTreeNodeIds"],showLatinLabel:[c.Mj6.SignalBased,"showLatinLabel"],nested:[c.Mj6.SignalBased,"nested"],theme:[c.Mj6.SignalBased,"theme"]},standalone:!0,features:[c.aNF],decls:17,vars:16,consts:()=>{let I,x,K;return I=$localize`:6e998fc06a19659c22cca43efa1b35515761cbb25633144232269377096:hide`,x=$localize`:f67337c708d49ce56772539ee443bac996a24f8e1504349909398224884:show`,K=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,[I,x,K,["data-test","treeNode",1,"tree-node",3,"keyup.enter","click","ngClass"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"buttonTheme"],["tabindex","0","role","button",1,"tree-node__label",3,"ngClass"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"value"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"value"],["app-button","","buttonSize","xs","buttonShape","square","data-test","treeNodeVisible","appEventFence","",1,"tree-node__visible",3,"click","buttonTheme"],["icon","eye","data-test","treeNodeVisibleTrue","size","xs",1,"text-sm","tree-node__eye"],[1,"sr-only","tree-node__eye"],["icon","eye-slash","data-test","treeNodeVisibleFalse","size","xs",1,"text-sm","tree-node__eye-slash"],[1,"sr-only","tree-node__eye-slash"],["eventCategory","Search Node","appEventFence","",3,"theme","node"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"click","buttonTheme"],["appLogicalDir","","icon","caret-right",1,"inline-block","text-sm"],["tabindex","0","role","button",1,"tree-node__label",3,"dblclick","ngClass"],[1,"flex","flex-col"],["data-test","treeNodeId",1,"uppercase","text-2xs",2,"opacity","0.7"],["data-test","treeNodeLabel",1,"flex","items-center"],["icon","ban","data-test","treeNodeUnavailable","size","xs",1,"mr-1","text-xs","tree-node__unavailable"],[1,"sr-only"],[1,"tree-node__latin-label"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"blur","keyup","value"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"change","value"]]},template:function(x,K){1&x&&(c.j41(0,"div",3),c.bIt("keyup.enter",function(k){return K.handleNodeClick(k,K.node())})("click",function(k){return K.handleNodeClick(k,K.node())}),c.DNE(1,Z,2,5,"button",4)(2,S,9,8,"div",5)(3,v,1,1,"input",6)(4,D,1,1,"input",7),c.j41(5,"button",8),c.bIt("click",function(){return K.toggleVisibleClick(K.node())}),c.nrm(6,"app-icon",9),c.j41(7,"span",10),c.qex(8),c.pXf(9,0),c.bVm(),c.EFF(10),c.k0s(),c.nrm(11,"app-icon",11),c.j41(12,"span",12),c.qex(13),c.pXf(14,1),c.bVm(),c.EFF(15),c.k0s()(),c.nrm(16,"app-node-actions",13),c.k0s()),2&x&&(c.Y8G("ngClass",c.ziG(11,A,K.theme()===K.themeEnum.Light,!K.node().boolState.shown,K.checked(),!K.node().boolState.pickable)),c.BMQ("data-id",K.sanitizedID()),c.R7$(),c.vxM(1,K.nested()&&K.hasChildren()?1:-1),c.R7$(),c.vxM(2,K.editLabelMode()?-1:2),c.R7$(),c.vxM(3,K.editLabelMode()?3:-1),c.R7$(),c.vxM(4,K.layerOrderMode()?4:-1),c.R7$(),c.Y8G("buttonTheme",K.theme()),c.R7$(5),c.SpI(" ",K.node().label,""),c.R7$(5),c.SpI(" ",K.node().label,""),c.R7$(),c.Y8G("theme",K.theme())("node",K.node()))},dependencies:[V.MD,V.YU,P.h,N.B,M.L,u.e,p.C,g.Q,w.o,E.R,F.G,C.D],styles:[":host{display:block}.tree-node{border-radius:4px;padding:4px;margin-bottom:4px;display:flex;align-items:center;height:100%;-webkit-user-select:none;user-select:none;min-width:200px;transition:background-color .12s}.tree-node--light{padding-right:12px}.tree-node--light:focus{outline:#2d72dc solid 2px!important;outline-offset:-2px;border-radius:4px}.tree-node--light .tree-node__label{color:#101823;font-size:.75rem;line-height:1rem}.tree-node--light .tree-node__latin-label{color:#374a68;font-size:.625rem;line-height:.75rem;text-transform:lowercase;font-style:italic}.tree-node--light.tree-node--selected{background:transparent;border-left-color:transparent}.tree-node--light.tree-node--selected .tree-node__label{color:#101823!important}.tree-node--light.tree-node--selected .tree-node__expand,.tree-node--light.tree-node--selected .tree-node__visible{color:#101823}.tree-node--light.tree-node--unpickable{border:none}.tree-node--light.tree-node--hidden .tree-node__label,.tree-node--light.tree-node--hidden .tree-node__latin-label{color:#61779e}.tree-node--light .tree-node__expand,.tree-node--light .tree-node__visible{background-color:transparent;color:#96a8c0;border-radius:4px}.tree-node--selected{background-color:#2d72dc}.tree-node--selected .tree-node__label{color:#fff}.tree-node--unpickable{border:1px dashed #61779e}.tree-node--hidden .tree-node__expand,.tree-node--hidden .tree-node__visible,.tree-node--hidden .tree-node__label{color:#96a8c0}.tree-node--hidden .tree-node__visible{visibility:visible}.tree-node.tree-node--hidden.tree-node--selected .tree-node__expand,.tree-node.tree-node--hidden.tree-node--selected .tree-node__visible,.tree-node.tree-node--hidden.tree-node--selected .tree-node__label{color:#fff}.tree-node__label{font-size:.75rem;line-height:1rem;font-weight:400;line-height:1.3em;color:#d7e0ea;padding:8px 4px 8px 12px;display:flex;align-items:center;flex:1 1 100%;min-height:28px}.tree-node__label--padded{padding-left:36px}.tree-node__expand i{transition:transform .12s}.tree-node__expand--open app-icon{transform:rotate(45deg)}.tree-node .tree-node__expand+.tree-node__label{margin-left:-8px}.tree-node__expand,.tree-node__visible{border-radius:4px;color:#d7e0ea;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center;border:none}.tree-node__layer-order{font-size:10px;flex:0 0 56px;min-height:28px;height:28px;padding:4px;margin:2px;text-align:center}.tree-node .tree-node__unavailable{color:#de5959}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}@media (hover: hover){.tree-node__visible{visibility:hidden}.tree-node:hover,.tree-node:focus-within{cursor:pointer}.tree-node:hover .tree-node__visible,.tree-node:focus-within .tree-node__visible{visibility:visible}.tree-node:hover .tree-node__label,.tree-node:focus-within .tree-node__label{color:#fff}.tree-node--light:hover,.tree-node--light:focus-within{background-color:#1018230d}.tree-node--light:hover .tree-node__label,.tree-node--light:focus-within .tree-node__label{color:#101823}.tree-node--light:hover .tree-node__latin-label,.tree-node--light:focus-within .tree-node__latin-label{color:#374a68}.tree-node--light.tree-node--selected{background-color:#1018230d}.tree-node--light.tree-node--selected:hover{background-color:#1018231a}.tree-node--light.tree-node--selected .tree-node__label{color:#101823}.tree-node--light.tree-node--selected .tree-node__expand:hover,.tree-node--light.tree-node--selected .tree-node__visible:hover,.tree-node--light .tree-node__expand:hover,.tree-node--light .tree-node__visible:hover{background-color:transparent;color:inherit}.tree-node__expand:hover,.tree-node__visible:hover{background-color:#1c2a3f;color:#fff;cursor:pointer}.tree-node--selected .tree-node__expand:hover,.tree-node--selected .tree-node__visible:hover{background-color:#2d72dc}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:hover:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}}\n"],encapsulation:2,changeDetection:0}),ce})()},30356:(Se,J,_)=>{"use strict";_.d(J,{k:()=>M});var c=_(54438),e=_(89079),O=_(87996),l=_(14264),X=_(17365),U=_(90917),$=_(82542),j=_(18272),h=_(65763),W=_(47610),B=_(60177),H=_(7806),V=_(60724),P=_(65478),p=_(18617);function w(u,g){1&u&&(c.j41(0,"div",3),c.pXf(1,0),c.k0s())}function F(u,g){if(1&u&&c.nrm(0,"app-tree",4),2&u){const E=c.XpG();c.Y8G("theme",E.theme())("graph",E.searchGraph())("layerOrderMode",E.layerOrderMode())("showTreeNodeIds",E.showTreeNodeIds())("showLatinLabel",E.showLatinLabel())}}function R(u,g){if(1&u&&(c.j41(0,"div"),c.nrm(1,"app-tree-nested-node",8),c.k0s()),2&u){const E=g.$implicit,C=c.XpG(2);c.R7$(),c.Y8G("theme",C.theme())("nested",!1)("node",E)("graph",C.viewGraph())("layerOrderMode",C.layerOrderMode())("showTreeNodeIds",C.showTreeNodeIds())("showLatinLabel",C.showLatinLabel())}}function N(u,g){if(1&u&&(c.j41(0,"cdk-virtual-scroll-viewport",5)(1,"div",6),c.DNE(2,R,2,7,"div",7),c.k0s()()),2&u){const E=c.XpG();c.Y8G("itemSize",64),c.R7$(2),c.Y8G("cdkVirtualForOf",E.searchResults())("cdkVirtualForTrackBy",E.trackTreeNode)}}let M=(()=>{var u;class g{constructor(C,A){this.store=C,this.liveAnnouncer=A,this.treeSearchDisplayMode=j.q,this.selectedChapter=c.hFB.required(),this.theme=(0,c.hFB)($.P.Dark),this.query=(0,c.hFB)(),this.displayMode=(0,c.hFB)(j.q.List),this.viewGraph=(0,c.hFB)(),this.viewGraphMetadata=(0,c.hFB)(),this.viewGraphRank=c.hFB.required(),this.layerOrderMode=(0,c.hFB)(),this.showTreeNodeIds=(0,c.hFB)(),this.showLatinLabel=(0,c.hFB)(),this.searchResults=(0,c.EWP)(()=>{const Y=this.query().trim(),Z=this.viewGraph(),Q=this.displayMode(),y=this.viewGraphRank();if(Q===j.q.Tree)return(0,U.i)(Z,Y,[{field:"label",dir:"asc"}]);{const b=(0,U.Z6)(Object.values(Z.nodes),Y);return(0,U.XS)(b,y.initiallyShownRank)}}),this.searchGraph=(0,c.EWP)(()=>{const Y=this.viewGraph(),Z=this.searchResults();return(0,U.YL)(Y,Z)}),(0,e.br)(this.query).pipe((0,O.B)(600),(0,e.pQ)()).subscribe(()=>{const Y=this.searchResults().length;this.liveAnnouncer.announce(`${Y} structures found`)}),(0,e.br)(this.displayMode).pipe((0,l.p)(Y=>Y===j.q.List),(0,X.s)(1),(0,e.pQ)()).subscribe(()=>{this.store.dispatch(new W.q)})}trackTreeNode(C,A){return A.id}}return(u=g).\u0275fac=function(C){return new(C||u)(c.rXU(h.il),c.rXU(p.Ai))},u.\u0275cmp=c.VBU({type:u,selectors:[["app-tree-search"]],inputs:{selectedChapter:[c.Mj6.SignalBased,"selectedChapter"],theme:[c.Mj6.SignalBased,"theme"],query:[c.Mj6.SignalBased,"query"],displayMode:[c.Mj6.SignalBased,"displayMode"],viewGraph:[c.Mj6.SignalBased,"viewGraph"],viewGraphMetadata:[c.Mj6.SignalBased,"viewGraphMetadata"],viewGraphRank:[c.Mj6.SignalBased,"viewGraphRank"],layerOrderMode:[c.Mj6.SignalBased,"layerOrderMode"],showTreeNodeIds:[c.Mj6.SignalBased,"showTreeNodeIds"],showLatinLabel:[c.Mj6.SignalBased,"showLatinLabel"]},standalone:!0,features:[c.aNF],decls:4,vars:2,consts:()=>{let E;return E=$localize`:e4e28b371f8453e22779db590cb0fe67f2a080e87839102902838664367:No results`,[E,[1,"tree-search"],["class","tree-search__empty",4,"ngIf"],[1,"tree-search__empty"],[1,"tree-search__tree",3,"theme","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"],[3,"itemSize"],[1,"flex","flex-col","flex-auto","gap-1"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"",3,"theme","nested","node","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"]]},template:function(C,A){if(1&C&&(c.j41(0,"div",1),c.DNE(1,w,2,0,"div",2)(2,F,1,5)(3,N,3,3),c.k0s()),2&C){let Y;c.R7$(),c.Y8G("ngIf",0===A.searchResults().length),c.R7$(),c.vxM(2,(Y=A.displayMode())===A.treeSearchDisplayMode.Tree?2:Y===A.treeSearchDisplayMode.List?3:-1)}},dependencies:[B.MD,B.bT,H.g,V.r,P.E9,P.yg,P.E$,P.d6],styles:[".tree-search{display:flex;flex-direction:column;flex:1 1 auto;height:100%}.tree-search__tree{flex-grow:1;width:100%;overflow-y:auto;contain:strict}.tree-search__empty{font-size:.875rem;line-height:1.25rem;padding:12px;font-style:italic;margin-top:12px}.tree-search cdk-virtual-scroll-viewport{flex:1 1 auto}\n"],encapsulation:2,changeDetection:0}),g})()},90917:(Se,J,_)=>{"use strict";_.d(J,{D$:()=>W,XS:()=>B,YL:()=>$,Z6:()=>h,i:()=>j});var c=_(44867),e=_(23881),O=_(49204),X=_(78851);function U(p,w,F){(0,c.iu)(p,w);const R=(0,c.ir)(F,w.id);if(R){const N=p.successors[R]||[];N.push(w.id);const M=F.successors[R];return p.successors[R]=(0,O.uniq)(N).sort((u,g)=>M.indexOf(u)-M.indexOf(g)),p.predecessors[w.id]=R,U(p,(0,c.dV)(F,R),F)}return(0,c.Sg)(p,w),p}function $(p,w){if(0===w.length)return(0,e.q3)();const F=w.reduce((N,M)=>U(N,M,p),(0,e.q3)()),R=Object.keys(p.roots);return F.roots=R.reduce((N,M)=>(M in F.roots&&(N[M]=F.roots[M]),N),{}),F}function j(p,w,F=[]){if((0,O.isEmpty)(p))return[];const N=h(Object.values(p.nodes),w);return F.length>0?W(N,F):N}function h(p,w){return w=(0,X.TF)(w.toLowerCase()),p.filter(F=>{const{label:R,latinLabel:N}=F;if(0===w.length)return!0;const M=(0,X.TF)(R.toLowerCase()??""),u=N?.toLowerCase()??"";return M.includes(w)||u.includes(w)})}function W(p,w){return p.sort((F,R)=>{for(let N=0;N<w.length;N++){const{field:M,dir:u}=w[N];if("label"===M){const g=H(F.label,R.label,"asc"===u);if(0!==g)return g}if("depth"===M){const g=V(F.depth,R.depth,"asc"===u);if(0!==g)return g}if("shown"===M){const g=P(F.boolState.shown,R.boolState.shown,"asc"===u);if(0!==g)return g}}return 0})}function B(p,w){return p.sort((F,R)=>w[F.id]-w[R.id])}function H(p,w,F){return F?p.localeCompare(w):w.localeCompare(p)}function V(p,w,F){const R=Math.sign(p-w);return F?R:-R}function P(p,w,F){const R=Math.sign(Number(w)-Number(p));return F?R:-R}},90556:(Se,J,_)=>{"use strict";_.d(J,{f:()=>H});var c=_(60177),e=_(45189),O=_(12854),l=_(60724),X=_(7806),U=_(30356),$=_(89511),j=_(72026),h=_(82192),W=_(11818),B=_(54438);let H=(()=>{var V;class P{}return(V=P).\u0275fac=function(w){return new(w||V)},V.\u0275mod=B.$C({type:V}),V.\u0275inj=B.G2t({imports:[c.MD,j.o,e.G,W.C,h.G,$.h,X.g,O.X,l.r,U.k]}),P})()},7806:(Se,J,_)=>{"use strict";_.d(J,{g:()=>p});var c=_(54438),e=_(65763),O=_(14264),l=_(87996),X=_(13409),U=_(82542),$=_(49204),h=_(46842),W=_(44867),B=_(90908),H=_(89079),V=_(60177),P=_(12854);let p=(()=>{var w;class F{constructor(N){this.store=N,this.graph=c.hFB.required(),this.layerOrderMode=c.hFB.required(),this.showTreeNodeIds=c.hFB.required(),this.showLatinLabel=(0,c.hFB)(),this.theme=(0,c.hFB)(U.P.Dark),this.initNodeScrollListener()}initNodeScrollListener(){this.store.select(X.z.getCheckedNodes).pipe((0,O.p)(N=>1===N.length),(0,l.B)(0),(0,H.pQ)()).subscribe(([N])=>{this.scrollNodeIntoView(N.objectId)})}scrollNodeIntoView(N){const M=(0,W.Nk)(N),u=document.querySelector(`[data-id="${M}"]`);if(!(0,$.isNil)(u)&&(0,B.uK)()){const g=this.store.selectSnapshot(h.U.getPrefersReducedMotion)?"instant":"smooth";u.scrollIntoView({behavior:g,block:"nearest"})}}}return(w=F).\u0275fac=function(N){return new(N||w)(c.rXU(e.il))},w.\u0275cmp=c.VBU({type:w,selectors:[["app-tree"]],inputs:{graph:[c.Mj6.SignalBased,"graph"],layerOrderMode:[c.Mj6.SignalBased,"layerOrderMode"],showTreeNodeIds:[c.Mj6.SignalBased,"showTreeNodeIds"],showLatinLabel:[c.Mj6.SignalBased,"showLatinLabel"],theme:[c.Mj6.SignalBased,"theme"]},standalone:!0,features:[c.aNF],decls:1,vars:5,consts:[[3,"theme","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"]],template:function(N,M){1&N&&c.nrm(0,"app-tree-group",0),2&N&&c.Y8G("theme",M.theme())("graph",M.graph())("layerOrderMode",M.layerOrderMode())("showTreeNodeIds",M.showTreeNodeIds())("showLatinLabel",M.showLatinLabel())},dependencies:[V.MD,P.X],changeDetection:0}),F})()},64218:(Se,J,_)=>{"use strict";_.d(J,{H:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},79435:(Se,J,_)=>{"use strict";_.d(J,{T:()=>W});var c=_(15877),e=_(45326),O=_(36110),l=_(28577),X=_(39705),U=_(24418),$=_(79083),j=_(54438),h=_(21626);let W=(()=>{var B;class H{constructor(P){this.http=P,this.nodeInfoCache=new Map}queryNodeInfo(P,p,w="en",F=!0){if(U.c.offline)return(0,c.of)(void 0);const N=`/search/descriptions?name=${P}&plan=${p===$.H.Wikipedia?"wiki":p}&ol=${w}`,M=N;if(F&&this.nodeInfoCache.has(M)){const u=this.nodeInfoCache.get(M);return(0,c.of)(u)}return this.http.get(N).pipe((0,O.T)(u=>({label:P,latinLabel:u.latin_term,description:u.description,source:u.source,sourceLink:u.url})),(0,l.W)(u=>404===u.status?(0,c.of)(void 0):(0,e.$)(u)),(0,X.M)(u=>this.nodeInfoCache.set(M,u)))}}return(B=H).\u0275fac=function(P){return new(P||B)(j.KVO(h.Qq))},B.\u0275prov=j.jDH({token:B,factory:B.\u0275fac,providedIn:"root"}),H})()},37737:(Se,J,_)=>{"use strict";_.d(J,{B:()=>O});var c=_(90908),e=_(54438);let O=(()=>{var l;class X{constructor($){this.el=$}ngAfterContentInit(){(0,c.ZO)()&&setTimeout(()=>{this.el.nativeElement.focus()},0)}}return(l=X).\u0275fac=function($){return new($||l)(e.rXU(e.aKT))},l.\u0275dir=e.FsC({type:l,selectors:[["input","appAutoFocus",""]]}),X})()},89511:(Se,J,_)=>{"use strict";_.d(J,{h:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},25780:(Se,J,_)=>{"use strict";_.d(J,{L:()=>e});var c=_(54438);let e=(()=>{var O;class l{onClick(U){return U.stopPropagation(),U.stopImmediatePropagation(),U.target instanceof HTMLInputElement&&"checkbox"===U.target.type}onEnterUp(U){return U.stopPropagation(),U.stopImmediatePropagation(),!1}onPointerdown(U){U.stopPropagation(),U.stopImmediatePropagation()}onMouseDown(U){U.stopPropagation(),U.stopImmediatePropagation()}onMousUp(U){return U.stopPropagation(),U.stopImmediatePropagation(),!1}}return(O=l).\u0275fac=function(U){return new(U||O)},O.\u0275dir=c.FsC({type:O,selectors:[["","appEventFence",""]],hostBindings:function(U,$){1&U&&c.bIt("click",function(h){return $.onClick(h,h.target)})("keyup.enter",function(h){return $.onEnterUp(h,h.target)})("pointerdown",function(h){return $.onPointerdown(h,h.target)})("mousedown",function(h){return $.onMouseDown(h,h.target)})("mouseup",function(h){return $.onMousUp(h,h.target)})}}),l})()},59369:(Se,J,_)=>{"use strict";_.d(J,{Y:()=>X});var c=_(24418),e=_(90699),O=_(54438),l=_(38645);let X=(()=>{var U;class ${constructor(h,W,B){this.templateRef=h,this.viewContainer=W,this.router=B,this._appFlagApplicationMode="include"}get appFlagApplication(){return this._appFlagApplication}set appFlagApplication(h){this._appFlagApplication=h}get appFlagApplicationMode(){return this._appFlagApplicationMode}set appFlagApplicationMode(h){this._appFlagApplicationMode=h}get appFlagApplicationPage(){return this._appFlagApplicationPage}set appFlagApplicationPage(h){this._appFlagApplicationPage=h}get appFlagApplicationPlatform(){return this._appFlagApplicationPlatform}set appFlagApplicationPlatform(h){this._appFlagApplicationPlatform=h}get appFlagApplicationNative(){return this._appFlagApplicationNative}set appFlagApplicationNative(h){this._appFlagApplicationNative=h}ngOnInit(){this.update()}update(){let h=!1,W=!1,B=!1,H=!1,V=!1;if(""===this.appFlagApplication?W=!0:Array.isArray(this.appFlagApplication)?W=this.appFlagApplication.some(p=>p===c.c.application):"string"==typeof this.appFlagApplication&&(W=this.appFlagApplication===c.c.application),null==this.appFlagApplicationPage)B=!0;else{const p=this.router.url;Array.isArray(this.appFlagApplicationPage)?B=this.appFlagApplicationPage.some(w=>p.indexOf(w)>=0):"string"==typeof this.appFlagApplicationPage&&(B=p.indexOf(this.appFlagApplicationPage)>=0)}if(null==this.appFlagApplicationPlatform)H=!0;else{const p=c.c.platform;Array.isArray(this.appFlagApplicationPlatform)?H=this.appFlagApplicationPlatform.some(w=>p.indexOf(w)>=0):"string"==typeof this.appFlagApplicationPlatform&&(H=p.indexOf(this.appFlagApplicationPlatform)>=0)}null==this.appFlagApplicationNative?V=!0:(V=c.c.native,(Array.isArray(this.appFlagApplicationNative)?this.appFlagApplicationNative:[this.appFlagApplicationNative]).includes(e.I.iOS)&&(V=c.c.native&&void 0!==window.webkit)),h=W&&B&&H&&V,h&&"include"===this.appFlagApplicationMode||!h&&"exclude"===this.appFlagApplicationMode?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}}return(U=$).\u0275fac=function(h){return new(h||U)(O.rXU(O.C4Q),O.rXU(O.c1b),O.rXU(l.Ix))},U.\u0275dir=O.FsC({type:U,selectors:[["","appFlagApplication",""]],inputs:{appFlagApplication:"appFlagApplication",appFlagApplicationMode:"appFlagApplicationMode",appFlagApplicationPage:"appFlagApplicationPage",appFlagApplicationPlatform:"appFlagApplicationPlatform",appFlagApplicationNative:"appFlagApplicationNative"}}),$})()},49989:(Se,J,_)=>{"use strict";_.d(J,{e:()=>O});var c=_(54438),e=_(11040);let O=(()=>{var l;class X{constructor($,j){this.localeId=$,this.el=j}ngOnInit(){"rtl"===(0,e.NS)(this.localeId).direction&&(this.el.nativeElement.style.scale="-1 1")}}return(l=X).\u0275fac=function($){return new($||l)(c.rXU(c.xe9),c.rXU(c.aKT))},l.\u0275dir=c.FsC({type:l,selectors:[["","appLogicalDir",""]]}),X})()},41775:(Se,J,_)=>{"use strict";_.d(J,{I:()=>X});var c=_(24418),e=_(27180),O=_(54438),l=_(38645);let X=(()=>{var U;class ${constructor(h){this.router=h}redirectToErrorPage(h,W,B){(this.router.url||"").match("/error")||this.router.navigateByUrl(c.c.application===e.c.Viewer?"/error":"/view/error",{skipLocationChange:!0,state:{errorType:h,errorCode:W,error:B,errorUrl:this.router.url}})}}return(U=$).\u0275fac=function(h){return new(h||U)(O.KVO(l.Ix))},U.\u0275prov=O.jDH({token:U,factory:U.\u0275fac,providedIn:"root"}),$})()},85884:(Se,J,_)=>{"use strict";_.d(J,{Y:()=>c});var c=function(e){return e.Content="content",e.Engine="engine",e}(c||{})},11789:(Se,J,_)=>{"use strict";var c;_.d(J,{T:()=>c}),function(e){const l=/(\s*[\d\.]+\s*,){2,15}\s*[\d\.]+\s*/g;function U(g){for(let E=0;E<3;E++)if(parseFloat(`${g[E]}`)>1)return!0;return!1}function j(g){const E=document.createElement("div");E.style.backgroundColor=g,document.documentElement.appendChild(E);const C=window.getComputedStyle(E).backgroundColor.replace(/\s/g,"");return window.document.documentElement.removeChild(E),C}function h(g){const E=g.slice(0,4);3===E.length&&E.push(1);for(let C=0;C<4;C++)E[C]=parseFloat(`${E[C]}`),E[C]<0&&(E[C]=0),E[C]>255&&(E[C]=255);return E[3]>1&&(E[3]=1),E}function W(g){let E;if(Array.isArray(g))E=h(g);else if("string"==typeof g){let C=g.match(l);C?E=h(C[0].split(",")):(C=j(g).match(l),C&&(E=h(C[0].split(","))))}return E}function B(g){const E=W(g);if(!E)throw new TypeError("Invalid color input.");const C=V(E);return{1:U(E)?C:E,255:U(E)?E:C}}function V(g){const E=U(g),C=[];for(let A=0;A<3;A++){let Y=E?g[A]/255:255*g[A];Y=E?Math.round(100*Y)/100:Math.round(Y),C.push(Y)}return 4===g.length&&C.push(g[3]),C}function P(g,E=!1){g=g.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(y,b,S,v)=>[b,b,S,S,v,v].join("")).replace(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,(y,b,S,v)=>[b,S,v,"ff"].join(""));const C=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(g),A=parseInt(C[1],16),Y=parseInt(C[2],16),Z=parseInt(C[3],16),Q=parseInt(C[4],16)/255;if(E){const y=N([A,Y,Z]);return[y[0],y[1],y[2],Q]}return[A,Y,Z,Q]}function F(g){const[E,C,A]=g;return Math.sqrt(E*E*.299+C*C*.587+A*A*.114)}function N(g){return g.map(C=>C/255)}function M(g){return g.map(C=>Math.round(255*C))}function u(g){return`#${g.map(C=>{const A=C.toString(16);return A.length%2?`0${A}`:A}).join("")}`}e.is255=U,e.isLight=function $(g,E){return E||(E=[...g]),(F(g)+F(E))/2>140.25},e.getComputedColor=j,e.convertChannels=h,e.convert=W,e.getColor=B,e.getColors=function H(g){let E=[];if("string"==typeof g){const C=g.match(l);C&&(g=C.join(",")),g=g.split(",")}if(Array.isArray(g))if(Array.isArray(g[0])&&Array.isArray(g[1]))E=g;else if(g.length<=2)E=1===g.length?g.concat(g):g;else{const A=Math.floor(g.length/2);E=g.length>4?[g.slice(0,A),g.slice(A)]:[g,g]}return E.map(C=>B(C))},e.scaleColor=V,e.hexToRgba=P,e.hexToRgb=function p(g,E=!1){const C=P(g,E);return[C[0],C[1],C[2]]},e.rgbToHex=function w(g,E=!1){return u(E?M(g):g)},e.rgbToHSP=F,e.rgbaToHex=function R(g,E=!1){const C=g[0],A=g[1],Y=g[2],Z=255*g[3];return u(E?[...M([C,A,Y]),Z]:[C,A,Y,Z])},e.rgbToDecimal=N,e.rgbFromDecimal=M}(c||(c={}))},3287:(Se,J,_)=>{"use strict";_.d(J,{H:()=>O});var c=_(2573),e=_(74902);function O(l,X,U=!0){const $=new e.F,j=[];return U&&j.push(X.map(h=>h.label)),l.forEach(h=>{const W=X.map(B=>h[B.field]);j.push(W)}),new c.c(h=>{const W=$.unparse(j,{quotes:!0,header:!1});h.next(W),h.complete()})}},42482:(Se,J,_)=>{"use strict";_.d(J,{X:()=>h});var h,c=_(28407),e=_(15877),O=_(2573),l=_(37678),U=_(67092),$=_(68947),j=_(7662);!function(W){function p(){return(p=(0,c.A)(function*(u,g=!1){return(0,j.mo)(u,{pixelRatio:1,skipFonts:!0,...g?{backgroundColor:"transparent"}:{}})})).apply(this,arguments)}W.exportImage=function B(u,g,E,C){const A="string"==typeof u?W.base64ToBlob(u,g):u;return C?(0,U.r)(A,C).then(function(Y){(0,l.saveAs)(Y,E)}):(0,l.saveAs)(A,E),(0,e.of)(!0)},W.canvasToBlob=function H(u,g,E){return new O.c(C=>{u.toBlob(A=>{C.next(A),C.complete()},g,E)})},W.fitCanvas=function V(u,g,E){const C=document.createElement("canvas");C.width=g,C.height=E;const A=C.getContext("2d"),y=Math.max(.5*(u.width-C.width/C.height*u.height),0);return A.drawImage(u,y,0,C.width,C.height),C},W.elementToCanvas=function P(u){return p.apply(this,arguments)},W.combineCanvasElements=function w(u){const g=Math.max(0,...u.map(Y=>Y.width)),E=Math.max(0,...u.map(Y=>Y.height)),C=document.createElement("canvas");C.width=g,C.height=E;const A=C.getContext("2d");return u.forEach(Y=>{A.drawImage(Y,0,0)}),C},W.base64ToBlob=function F(u,g){const E=atob(u.split(",")[1]),C=new ArrayBuffer(E.length),A=new Uint8Array(C);for(let Y=0;Y<E.length;Y++)A[Y]=E.charCodeAt(Y);return new Blob([C],{type:g})},W.blobToBase64=function R(u){return new O.c(g=>{const E=new FileReader;E.addEventListener("load",()=>{g.next(E.result),g.complete()}),E.readAsDataURL(u)})},W.blobToCanvas=function N(u,g,E){return new O.c(C=>{const A=document.createElement("canvas");A.width=g,A.height=E;const Y=A.getContext("2d"),Z=new Image,Q=URL.createObjectURL(u);Z.addEventListener("load",()=>{Y.drawImage(Z,0,0),URL.revokeObjectURL(Q),C.next(A),C.complete()}),Z.src=Q})},W.createModelFileName=function M(u,g,E,C){let A=u||g||"";return u&&g&&u!==g&&(A=`${u}_${g}`),`${$.l.normalize(A).replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}${C?`_${C}`:""}.${E.replace(".","")}`}}(h||(h={}))},46889:(Se,J,_)=>{"use strict";_.d(J,{A1:()=>O,E8:()=>e,dL:()=>l,vT:()=>X});var c=_(38472);function e(U,$){const j=c.create();return c.sub(j,$,U),c.length(j)}function O(U,$){const j=c.create();return c.add(j,$,U),c.scale(j,j,.5),j}function l(U,$,j,h,W,B){const H=(U-$)/(j-$);return(B=B??c.create())[0]=h[0]+H*(W[0]-h[0]),B[1]=h[1]+H*(W[1]-h[1]),B[2]=h[2]+H*(W[2]-h[2]),B}function X(U,$,j){const h=U*U;return $+j*(-1*h*h+h*U*4+-6*h+4*U)}},68947:(Se,J,_)=>{"use strict";_.d(J,{l:()=>l});var l,c=_(28407),e=_(49204);!function(X){function H(){return(H=(0,c.A)(function*(p,w,F,R=!1){return V(p,yield w.parse(F),R)})).apply(this,arguments)}function V(p,w,F=!1){const R=p.createElement("div");return p.setProperty(R,"innerHTML",w),F&&R.querySelectorAll("p").forEach(M=>{p.setProperty(M,"textContent",M.textContent+" ")}),(0,e.trim)(R.textContent)}X.normalize=function U(p){return`${p||""}`.replace(/&#(\d+);/g,(F,R)=>String.fromCharCode(R)).replace(/(&.+;)/gi,(F,R)=>String.fromCharCode(F.charCodeAt(0)))},X.prettyPrint=function $(p){return`${p||""}`.trim().replace(/([A-Z])/g," $1").replace(/^./,F=>F.toUpperCase()).trim()},X.parseEmails=function j(p){return p.split(/[,\r\n]/).map(w=>w.trim()).filter(w=>!!w)},X.validateEmail=function h(p){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(p)},X.toTitleCase=function W(p){return p.replace(/\w\S*/g,w=>w.charAt(0).toUpperCase()+w.substring(1).toLowerCase())},X.getPlainTextFromMarkdown=function B(p,w,F){return H.apply(this,arguments)},X.getPlainTextFromHTML=V,X.splitTextByCharacterCount=function P(p,w){for(var F=[];p.length>w;){var R=p.substring(0,w).lastIndexOf(" ");F.push(p.substring(0,R=R<=0?w:R));var N=p.indexOf(" ",R)+1;(N<R||N>R+w)&&(N=R),p=p.substring(N)}return F.push(p),F}}(l||(l={}))},9592:(Se,J,_)=>{"use strict";_.d(J,{H:()=>c});var c=function(O){return O.JPEG="image/jpeg",O.PNG="image/png",O}(c||{})},82542:(Se,J,_)=>{"use strict";_.d(J,{P:()=>c});var c=function(e){return e.Dark="dark",e.Light="light",e}(c||{})},18272:(Se,J,_)=>{"use strict";_.d(J,{q:()=>c});var c=function(e){return e[e.List=0]="List",e[e.Tree=1]="Tree",e}(c||{})},13491:(Se,J,_)=>{"use strict";_.d(J,{n:()=>c});class c{static toArray(O){return[O.x,O.y,O.z]}static fromArray(O){return{x:O[0],y:O[1],z:O[2]}}}},81642:(Se,J,_)=>{"use strict";_.d(J,{D:()=>e});var c=_(54438);let e=(()=>{var O;class l{constructor(){}roundModel(U,$){const j={...U};return Object.keys(U).filter(h=>"number"==typeof U[h]).forEach(h=>{j[h]=this.roundNumber(U[h],$)}),j}roundNumber(U,$){return Math.round(U*Math.pow(10,$))/Math.pow(10,$)}}return(O=l).\u0275fac=function(U){return new(U||O)},O.\u0275prov=c.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}),l})()},86544:(Se,J,_)=>{"use strict";_.d(J,{R:()=>O});var O,c=_(59429);!function(l){function X($){return $.split("-")[0].replace(/_particle$/,"")}l.getParticleIdRoot=X,l.generateParticleId=function U($,j=c.u.getUuid){return`${X($)}-${j()}`}}(O||(O={}))},6049:(Se,J,_)=>{"use strict";_.d(J,{Y:()=>O});var c=_(60177),e=_(54438);let O=(()=>{var l;class X{}return(l=X).\u0275fac=function($){return new($||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[c.MD]}),X})()},35056:(Se,J,_)=>{"use strict";_.d(J,{G:()=>I});var c=_(60177),e=_(11562),O=_(78696),l=_(45189),X=_(89417),U=_(54438);let $=(()=>{var x;class K{}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[c.MD,X.YN]}),K})();class j{}var h=_(49204),W=_(27153);let H=(()=>{var x;class K{constructor(k){if(!k.accountUrl)throw new Error("Missing accountUrl. Please set in app config via ZendeskWidgetProvider");this.window=function B(){return window}();let le=this.window;le.zEmbed||function(de,oe){var ye,z,ae,Ne,Pe=[],Qe=document.createElement("iframe");le.zEmbed=function(){Pe.push(arguments)},le.zE=le.zE||le.zEmbed,Qe.src="javascript:false",Qe.title="",Qe.style.cssText="display: none",(ae=(ae=document.getElementsByTagName("script"))[ae.length-1]).parentNode.insertBefore(Qe,ae),Ne=Qe.contentWindow.document;try{z=Ne}catch{ye=document.domain,Qe.src='javascript:var d=document.open();d.domain="'+ye+'";void(0);',z=Ne}z.open()._l=function(){var St=this.createElement("script");ye&&(this.domain=ye),St.id="js-iframe-async",St.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost=k.accountUrl,this.zEQueue=Pe,this.body.appendChild(St)},z.write('<body onload="document._l();">'),z.close()}(),this.window.zE(()=>{k.beforePageLoad(this.window.zE)})}setLocale(k){this.window.zE(()=>{this.window.zE.setLocale(k)})}identify(k){this.window.zE(()=>{(0,h.isNil)(k)?this.window.zE("webWidget","clear"):this.window.zE.identify({name:this.getUserFullName(k),email:k.email})})}hide(){this.window.zE(()=>{this.window.zE.hide()})}show(){this.window.zE(()=>{this.window.zE.show()})}activate(k){this.window.zE(()=>{this.window.zE.activate(k)})}showWidget(k="help"){this.hide(),this.setSettings({webWidget:{helpCenter:{suppress:"contact"===k}}}),this.activate({hideOnClose:!0})}setHelpCenterSuggestions(k){this.window.zE(()=>{this.window.zE.setHelpCenterSuggestions(k)})}setSettings(k){this.window.zE(()=>{this.window.zE("webWidget","updateSettings",k)})}updateFromProfile(k){const le=[];if(null!=k){const{premium_account:oe,premium_account_type:ye,developer_account:z,subscription:ae}=k;oe?(le.push(`premium_account_${ye}`),ae&&le.push(`subscription_${ae.subscription_provider}`)):le.push("free_account"),z&&le.push("developer_account")}const de=(0,W.E)(k);this.setSettings({webWidget:{position:{horizontal:"right",vertical:"bottom"},offset:{horizontal:"0px",vertical:"0px"},contactForm:{suppress:!de,tags:le,fields:[{id:"name",prefill:{"*":this.getUserFullName(k)}}]}}})}getUserFullName(k){if(k){const{first_name:le,last_name:de}=k;return`${le} ${de}`}return""}}return(x=K).\u0275fac=function(k){return new(k||x)(U.KVO(j))},x.\u0275prov=U.jDH({token:x,factory:x.\u0275fac,providedIn:"root"}),K})(),V=(()=>{var x;class K{static forRoot(k){return{ngModule:K,providers:[{provide:k,useClass:k},{provide:H,useClass:H,deps:[k]}]}}}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[c.MD]}),K})();class P extends j{constructor(){super(...arguments),this.accountUrl="biodigital.zendesk.com"}beforePageLoad(K){K.setLocale("en"),K.hide()}}let p=(()=>{var x;class K{}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[V.forRoot(P)]}),K})();var w=_(11818),F=_(90556),R=_(3272),N=_(89511),M=_(59162),u=_(6049),g=_(46374),E=_(59464),C=_(32996),A=_(72026),Y=_(82192),Z=_(35286),Q=_(81488),y=_(38645);let b=(()=>{var x;class K{}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[c.MD,A.o]}),K})(),S=(()=>{var x;class K{}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[c.MD,O.H,A.o]}),K})();var v=_(18824),D=_(9529),ne=_(5584),m=_(64218),ce=_(64026);let I=(()=>{var x;class K{}return(x=K).\u0275fac=function(k){return new(k||x)},x.\u0275mod=U.$C({type:x}),x.\u0275inj=U.G2t({imports:[y.iI,w.C,e.YG,C.z,c.MD,N.h,A.o,R.D,O.H,l.G,Q.f,Y.G,g.b,u.Y,M.M,X.X1,$,E.j,b,F.f,p,v.j,D.bU,ne.d,m.H,Z.y2.forChild(),ce.m,w.C,C.z,N.h,R.D,A.o,O.H,Q.f,Y.G,u.Y,g.b,S,M.M,$,E.j,b,F.f,ne.d,m.H,ce.m]}),K})()},17215:(Se,J,_)=>{"use strict";_.d(J,{AJ:()=>$,UT:()=>X,d0:()=>U,n$:()=>W});var c=_(28407),e=_(9989);class O extends e.Ay{constructor(){super("HumanDatabase"),this.version(2).stores({keyValue:",value",analytics:"message"}),this.open(),this.keyValue=this.table("keyValue"),this.analytics=this.table("analytics")}}var l=_(54438),X=function(B){return B.WidgetOptions="widgetOptions",B.SnapshotOptions="snapshotOptions",B.Locale="locale",B.GroupRestriction="GroupRestriction",B.UserAppId="userAppId",B.RememberMeEmail="rememberMeEmail",B.LabelConversionSeen="labelConversionSeen",B.DefaultGroupEdit="defaultGroupEdit",B.DefaultCollectionId="defaultCollectionId",B.GettingStartedTutorial="gettingStartedTutorial",B.SystemMessage="systemMessage",B.ExploreRedesignMessage="exploreRedesignMessage",B.Iphone12Warning="iphone12Warning",B.RecentRecipes="recentRecipes",B.TeamTrialExpirationSeen="teamTrialExpiredSeen",B.ProExpirationSeen="proExpirationSeen",B.PaintPalettes="paintPalettes",B.RecentSearchConfig="recentSearchConfig",B.CameraDebug="cameraDebug",B.TeamWelcomeTourSeen="teamWelcomeTourSeen",B.UserJoinPromptSeen="userJoinPromptSeen",B.UserJoinNotificationInteracted="userJoinNotificationInteracted",B.ZSpaceDevice="zSpaceDevice",B.EnableAdvancedStats="enableAdvancedStats",B.XREnabled="xrEnabled",B}(X||{}),U=function(B){return B.UserMessagesSeen="userMessagesSeen",B.PreviewSize="previewSize",B.GPUAnalyticsStored="gpuAnalyticsStored",B}(U||{}),$=function(B){return B.PreviewStory="previewStory",B.PreviewBookmark="previewBookmark",B}($||{});class h{constructor(){this._data={}}get keys(){return Object.keys(this._data)}get length(){return this.keys.length}clear(){this._data={}}getItem(H){return this._data[H]}key(H){return this.keys[H]}removeItem(H){delete this._data[H]}setItem(H,V){this._data[H]=V}}let W=(()=>{var B;class H{constructor(){this._localStorage=this.getStorage("localStorage"),this._sessionStorage=this.getStorage("sessionStorage"),this._indexedStorage=new O}getLocalItem(P){return this._localStorage.getItem(`${P}`)}getLocalJSON(P){const p=this.getLocalItem(P);return p?JSON.parse(p):null}setLocalItem(P,p){const w="object"==typeof p?JSON.stringify(p):`${p}`;try{return this._localStorage.setItem(`${P}`,w),!0}catch{return!1}}removeLocalItem(P){this._localStorage.removeItem(`${P}`)}getSessionItem(P){const p=this._sessionStorage.getItem(`${P}`);return p?JSON.parse(p):null}setSessionItem(P,p){const w=JSON.stringify(p);try{return this._sessionStorage.setItem(`${P}`,w),!0}catch{return!1}}removeSessionItem(P){this._sessionStorage.removeItem(`${P}`)}setDatabaseItem(P,p){return this._indexedStorage.keyValue.put(p,P)}setDatabaseAnalyticItem(P){var p=this;(0,c.A)(function*(){yield p._indexedStorage.analytics.put(P)})()}getDatabaseOfflineAnalytics(P){var p=this;(0,c.A)(function*(){const w=yield p._indexedStorage.analytics.toArray();p._indexedStorage.analytics.clear(),P(w)})()}getDatabaseOfflineAnalyticsCount(P){var p=this;(0,c.A)(function*(){const w=yield p._indexedStorage.analytics.toArray();P(w.length)})()}getDatabaseItem(P){return this._indexedStorage.keyValue.get(P)}clearStorage(){this.clearLocalStorage(),this.clearSessionStorage()}clearLocalStorage(){this._localStorage.clear()}clearSessionStorage(){this._sessionStorage.clear()}getStorage(P){try{return window[P]||new h}catch{return new h}}}return(B=H).\u0275fac=function(P){return new(P||B)},B.\u0275prov=l.jDH({token:B,factory:B.\u0275fac,providedIn:"root"}),H})()},97415:(Se,J,_)=>{"use strict";_.d(J,{I:()=>c});const c={small:{width:256,height:256},medium:{width:512,height:512},large:{width:1024,height:1024}}},93455:(Se,J,_)=>{"use strict";_.d(J,{V:()=>O});var e,c=_(81025);class O{constructor(){this[e]=!0}}e=c.lE},11113:(Se,J,_)=>{"use strict";var c,e;_.d(J,{e:()=>c}),(e=c||(c={})).updateChapterIds=function O($,j){return Object.keys($).reduce((B,H)=>(B[j[H]]=$[H],B),{})},e.duplicateChapter=function l($,j,h){return{...h,[j]:h[$]}},e.deleteChapter=function X($,j){const h={...j};return delete h[$],h},e.addEntryForChapter=function U($,j,h){return h[$]={...h[$],...j},h}},59429:(Se,J,_)=>{"use strict";var c;_.d(J,{u:()=>c}),function(e){function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(X){const U=16*Math.random()|0;return("x"===X?U:3&U|8).toString(16)})}e.getUuid=O,e.idWithPrefix=function l(X){return X?`${X}-${O()}`:O()}}(c||(c={}))},4959:(Se,J,_)=>{"use strict";_.d(J,{j:()=>A});var c=_(21164),e=_(62943),O=_(8358),l=_(49204),X=_(76872),U=_(92677),$=_(65881);const j={enabled:!1,clips:{left:{clipId:0,enabled:!1,fade:!1,fadeDistance:0,progress:0},right:{clipId:1,enabled:!1,fade:!1,fadeDistance:0,progress:0},back:{clipId:5,enabled:!1,fade:!1,fadeDistance:0,progress:0},front:{clipId:4,enabled:!1,fade:!1,fadeDistance:0,progress:0},top:{clipId:3,enabled:!1,fade:!1,fadeDistance:0,progress:0},bottom:{clipId:2,enabled:!1,fade:!1,fadeDistance:0,progress:0}}},W={0:"left",1:"right",2:"bottom",3:"top",4:"front",5:"back"};var B=_(29284),H=_(23881),V=_(44867),P=_(13491),p=_(35650),w=_(60286),F=_(62751),R=_(11724),N=_(63508),M=_(92333),u=_(76774),g=_(17766),E=_(13976),C=_(54438);let A=(()=>{var Y;class Z{constructor(y,b,S,v,D){this.serializeChapterService=y,this.labelService=b,this.paintService=S,this.sceneService=v,this.contentBlocksService=D}processChapterForEngine(y){const b=(0,$.S)([y],!1),D=this.sceneService.getRootObjects(),ne=(0,H.ow)(this.paintService.getColorRecipes()),m=(0,V.fm)(D,ne);return{...this.serializeChapterService.serializeChapter(m,y,{},[],b),sliderLayers:y.sliderLayers}}copyChapter(y,b){const S=(0,l.cloneDeep)(y);return S.id=b,S.readyState={model:!0,animation:!1},S}getChapter(y,b,S,v,D){const ne=v.id||(0,$.G)();let m;(0,l.isNil)(v.background)||(m=(0,e.iu)(v.background));const ce=v.transparencyMode||R.TransparencyModeEnum.Alpha,I=this.deserializeCamera(v);let x=!1;const K=v.timelineMap;let ie;K.forEach(ut=>{"dummy"!==ut.name&&"dummy"!==ut.data.timeline&&(x=!0)});const k=v.animation?.loop??b.animation?.loop??!1;if(v.ui&&!(0,l.isEmpty)(v.ui))ie=v.ui;else{let ut=0;x&&k?ut=-1:x&&!k&&(ut=1),ie={play:{count:ut}}}const le=X.D.Annotation,de=[...v.annotations||[]].map(ut=>this.labelService.deserializeAnnotation(ut,v,le)),oe=[],z=this.groupHotspots([...v.hotspots||[]].filter(ut=>{const Ct=this.labelService.filterHotspot(b,v,ut);return Ct?ut.theme||(ut.theme=S===g.c.Module?U.T.studioNext:U.T.classicHotspot):oe.push(ut),Ct})).map(ut=>this.labelService.deserializeHotspots(b,v,D,...ut)),ae=v.labels?.length>0?v.labels:[...de,...z],me=oe,Ne=(0,l.isEmpty)(v.clippingPlanes)?j:this.sanitizeClippingPlanes(v.clippingPlanes),Pe=this.deserializeContentBlocks(v.contentBlocks),Qe=v.legend??[],De=(v.quizQuestions??[]).map(ut=>(0,u.z9)(ut,ut.id,v.id)),lt=v.media??{};Object.values(lt).forEach(ut=>{ut&&(0,l.isEmpty)(ut.lang)&&(ut.lang="en")});const je=v.thumbnails,Ae=y.map(ut=>ut.objectId),{availableObjects:ge,showObjects:he}=v,qe=(0,l.isEmpty)(ge)?(0,V.K$)(Ae,he,ge):ge;return{...v,id:ne,background:m,camera:I,timelineMap:K,loop:k,ui:ie,labels:ae,hotspots:me,clippingPlanes:Ne,contentBlocks:Pe,legend:Qe,quizQuestions:De,media:lt,readyState:{model:!1,animation:!1},thumbnails:je,transparencyMode:ce,sliderLayers:{src:{},currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]},availableObjects:qe}}deserializeContentBlocks(y=[]){return y.map(b=>(this.contentBlocksService.isTickerBlock(b)&&(b.enable=b.enable??!0),b))}deserializeCamera(y){const b=y.jumpTo?F.L.JumpTo:F.L.FlyTo,{eye:S,look:v,up:D,title:ne}=y[b],m={action:b,location:{eye:S,look:v,up:D},title:ne??M.y};return y.cameraRotationCenter&&(m.rotationCenter=y.cameraRotationCenter),y.camera&&Array.isArray(y.camera.rotationCenter)&&(m.rotationCenter=P.n.fromArray(y.camera.rotationCenter)),m}getChapterTweenStates(y){const b=y.timelineMap.filter(S=>"dummy"!==S.data.timeline).map(S=>S.data.timeline);return Array.from(new Set(b))}getChapterLightLibraries(y){return(0,N.Uv)(y)?(y.lights?.libraries??[]).filter(S=>"default"!==S):[]}getChapterReflectionLibraries(y){if((0,N.Uv)(y)){const S=y.environment&&y.environment.reflectionMap||[],v=ne=>ne.split(".")[0],D=(y.environment&&y.environment.lightMap||[]).map(v).concat(S.map(v));return Array.from(new Set(D))}return[]}hasVisibilityLayers(y){return Array.isArray(y)&&y.length>0}buildVisibilityLayers(y){const b=y.visibilityLayers,S=y.showObjects,v={src:b,currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]};if(b&&this.hasVisibilityLayers(b.layers)){const D=b.initIndex||0,ne=this.unpackLayers(b.layers),m=this.buildShownObjectsSet(S),ce=this.buildCurrentLayers(ne,m),I=this.buildLayerGrouping(ce);v.src={layers:b.layers,initIndex:D},v.currentLayers={layers:ce,index:D,position:0},v.sourceLayerGroups=(0,l.cloneDeep)(I),v.currentLayerGroups=(0,l.cloneDeep)(I)}return v}buildShownObjectsSet(y){const b=this.sceneService.getSceneGraph(this.sceneService.getRootObjects()),S=Object.keys(b.nodes).filter(v=>(0,B.BK)(b,v,y)||(0,B._x)(b,v,y));return new Set(S)}unpackLayers(y){const b=[];return y.forEach(S=>{let v=[];S.objectIds.forEach(ne=>{const m=this.sceneService.getObjectById(ne);if(m){const ce=this.sceneService.getLeaves(m.objectId);v=v.concat(ce.map(I=>I.objectId))}}),b.push({name:S.name,objectIds:v})}),b}buildCurrentLayers(y,b){const S=[];return y.forEach((v,D)=>{let ne=!1;v.objectIds.forEach(m=>{b.has(m)&&(ne?S[S.length-1].objectIds.push(m):(S.push({name:y[D].name,objectIds:[m]}),ne=!0))})}),S}buildLayerGrouping(y){return y.reduce((b,S,v)=>{const{name:D}=S;let ne=b.find(m=>m.name===D);return ne||(ne={name:D,position:0,layers:[]},b.push(ne)),ne.layers.push(S),ne.position=ne.layers.length,b},[])}sanitizeClippingPlanes(y){const b=Object.values(y.clips).some(v=>v.progress>0),S=(0,l.mapKeys)(y.clips,(v,D)=>W[D]||D);return{...y,clips:S,enabled:b}}groupHotspots(y){const b={},S=D=>D.primitiveIndex?D.primitiveIndex.toFixed(0):D.pos?D.pos.map(ne=>ne.toFixed(3)).join(":"):Math.random().toFixed(3),v=D=>RegExp("^circle-(plus|minus)").test(D)?"pair":"single";return y.forEach(D=>{const ne=[v(D.type),D.objectId,S(D)].join("|");ne in b?b[ne].push(D):b[ne]=[D]}),Object.values(b)}}return(Y=Z).\u0275fac=function(y){return new(y||Y)(C.KVO(c.p),C.KVO(O.x),C.KVO(w.s),C.KVO(p.w),C.KVO(E.V))},Y.\u0275prov=C.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"}),Z})()},8358:(Se,J,_)=>{"use strict";_.d(J,{x:()=>u});var c=_(69568),e=_(59429),O=_(24151),l=_(76872),X=_(92677),U=_(16124),$=_(49746),j=_(95370),h=_(40470),W=_(20714),B=_(38157),H=_(1300),V=_(79817),P=_(49204),w=_(12347),F=_(35650),R=_(54438);const N={flyToCamera:"flyTo",flyToChapter:"flyTo"};let u=(()=>{var g;class E{constructor(A,Y){this.animationService=A,this.sceneService=Y,this.convertActionToErrand=(Z,Q,y)=>{const b=new RegExp("^flyTo(Async)?"),S=new RegExp("^flyToObject(Async)?"),v=new RegExp("^flyTo[w.:]+currentChapter.[flyTo|jumpTo]"),D=y.split(":").slice(0,2),ne=Z;let m=D[1];/currentChapter/.test(m)&&(m=m.replace("currentChapter",`chapters[${Q}]`));let ce=null;return S.test(D[0])?ce=new $.F((0,P.get)(ne,m)):b.test(D[0])?ce=new j.v((0,P.get)(ne,m)):v.test(D[0])&&(ce=new H.T),ce},this.convertErrandToAction=(Z,Q)=>{const y=e.u.idWithPrefix("errand").replace(/-/g,"_"),b={};let S="";const v=function M(g){return N[g]||g}(Q.type);return Q.type===B.X.flyToChapter||(S=`${v}Async:currentChapter.customData.${y}`,b[y]=Q.value),{action:S,data:b}}}filterHotspot(A,Y,Z){const Q=new RegExp("^(flyTo|flyToObject|hideHotspot|showHotspot|resetHotspots)"),y=this.getHotspotAction(A,Z),b=y.filter(S=>Q.test(S));return y.length===b.length}deserializeAnnotation(A,Y,Z){const Q=new c.e(A.title||"");return Q.id=A.annotationId||e.u.idWithPrefix("label"),Q.chapterId=Y.id,Q.expandTag=!0,Q.showDescription=!0,Q.collapseDescription=!1,Q.pinGlow=!1,Q.hideWire=!1,Q.hideTag=!1,Z===l.D.Annotation?(Q.theme=l.D.Annotation,Q.pinType=O.O.Default,Q.flyTo=!1,Q.states=[]):(Q.theme=l.D.StudioNext,Q.pinType=O.O.PlusMinus,Q.flyTo=!0,Q.states=[new U.B,new U.B],Q.states[0].errands=[new H.T],Q.states[1].errands=[new $.F(A.objectId)]),Q.occludable=!1!==A.occludable,Q.renderableIndex=A.renderableIndex||0,A.objectId&&Object.prototype.hasOwnProperty.call(A,"barycentric")?(Q.objectId=A.objectId,Q.primitiveIndex=A.primitiveIndex,Q.barycentric=A.barycentric):Object.prototype.hasOwnProperty.call(A,"pos")&&(Object.prototype.hasOwnProperty.call(A,"objectId")&&(Q.objectId=A.objectId),Q.pos=A.pos),A.dir&&Array.isArray(A.dir)?Q.dir=A.dir:A.dir&&A.dir instanceof Object&&(Q.dir=Object.values(A.dir)),Q.description=A.description||"",Q.offset=A.labelOffset||[40,40],Q.shown=!1!==A.shown,Q.labelShown=!1!==A.labelShown,Q}deserializeHotspots(A,Y,Z,...Q){const[y,b]=Q,S=new c.e(y.title||"");switch(S.id=e.u.idWithPrefix("hotspot"),S.objectId=y.objectId,S.chapterId=Y.id,S.description=y.description||"",S.pinType=/plus|minus/.test(y.className)?O.O.PlusMinus:/sequential/.test(y.className)?O.O.Sequential:/none/.test(y.className)?O.O.None:O.O.Default,/alphabetical/.test(y.className)?S.sequentialType=V.C.Alphabetical:/numerical/.test(y.className)&&(S.sequentialType=V.C.Numerical),S.pinGlow=/pulse/.test(y.className),S.occludable=!0,S.shown=y.shown,S.offset=y.labelOffset?y.labelOffset:[22,-17],(/left/.test(y.className)&&S.offset[0]>0||/right/.test(y.className)&&S.offset[0]<0)&&(S.offset[0]*=-1),Object.prototype.hasOwnProperty.call(y,"barycentric")?(S.renderableIndex=y.renderableIndex||0,S.barycentric=y.barycentric,S.primitiveIndex=y.primitiveIndex):S.pos=y.pos,S.dir=y.dir,y.theme=y.theme?y.theme:X.T.classicHotspot,y.theme){case X.T.classicAnnotation:S.theme=l.D.Annotation,S.showDescription=!0,S.collapseDescription=/collapsible/g.test(y.className),S.expandTag=y.expandTag??!0,S.hideTag=y.hideTag??!1,S.hideWire=!/leader-line/.test(y.className);break;case X.T.classicHotspot:S.theme=l.D.Classic,S.showDescription=/label/.test(y.className),S.expandTag=/label/.test(y.className),S.hideTag=!S.expandTag,S.collapseDescription=!1,S.hideWire=!/leader-line/.test(y.className);break;case X.T.studioNext:S.theme=l.D.StudioNext,S.showDescription=this.hasContent(y),S.collapseDescription=/collapsible/g.test(y.className),S.hideTag=y.hideTag??!1,S.expandTag=y.expandTag??!0,S.hideWire=!/leader-line/.test(y.className)}S.flyTo=!1,S.flyToTarget=null,S.states=[];const v=this.filterHotspotActions(this.getHotspotAction(A,y)),D=b?this.filterHotspotActions(this.getHotspotAction(A,b)):[],ne=new U.B,m=new U.B;v.length&&(ne.errands=v.map(I=>this.convertActionToErrand(A,Z,I))),D.length&&(m.errands=D.map(I=>this.convertActionToErrand(A,Z,I))),S.states=[m,ne],ne.errands.length>0&&(S.flyTo=!0,S.flyToTarget=ne.errands[0].type,ne.errands[0].type===B.X.flyToCamera&&(S.cameraPosition=ne.errands[0].value));const ce=y.contentBlocks;return ce&&(S.contentBlocks=JSON.parse(JSON.stringify(ce))),S}makeDefaultStudioLabel(A){const Y=A?{...A}:new c.e("");return Y.pinType=O.O.PlusMinus,Y.theme=l.D.StudioNext,Y.expandTag=!0,Y.showDescription=!0,Y.collapseDescription=!1,Y.pinGlow=!1,Y.hideWire=!1,Y.hideTag=!1,Y.occludable=!0,Y.flyTo=!0,Y.description="",Y.shown=!0,Y.states=[new U.B,new U.B],Y}makeAnnotationLabel(A){const Y=A?{...A}:new c.e("");return Y.pinType=O.O.Default,Y.theme=l.D.Annotation,Y.expandTag=!0,Y.showDescription=!0,Y.collapseDescription=!1,Y.pinGlow=!1,Y.hideWire=!1,Y.hideTag=!1,Y.states=[],Y}serializeLabel(A,Y){const Z={symbol:void 0,className:void 0,dir:void 0,objectId:void 0,shown:void 0,type:void 0},Q=(0,h.uK)(A),y=["circle","draggable"];if(Z.shown=!0,A.objectId&&(Z.objectId=Q.objectId),A.objectId&&A.primitiveIndex&&A.barycentric)Z.renderableIndex=A.renderableIndex||0,Z.primitiveIndex=A.primitiveIndex,Z.barycentric=A.barycentric;else{if(!A.objectId)return{data:{},hotspots:[]};Z.pos=Q.pos}switch((Array.isArray(A.dir)||ArrayBuffer.isView(A.dir))&&(Z.dir=Array.prototype.slice.call(A.dir)),Z.labelOffset=A.offset,A.theme){case l.D.Annotation:Z.theme=X.T.classicAnnotation;break;case l.D.Classic:Z.theme=X.T.classicHotspot;break;default:Z.theme=X.T.studioNext}Z.hideTag=Q.hideTag,Z.expandTag=Q.expandTag,""!==Q.title||""!==Q.description?(Z.title=Q.title,Z.description=Q.description,Z.type=W.H.CircleLabel):Z.type=W.H.Circle,A.pinGlow&&y.push("pulse"),A.pinType===O.O.PlusMinus&&y.push("plus"),A.pinType===O.O.Sequential&&(y.push("sequential"),y.push(A.sequentialType===V.C.Alphabetical?"alphabetical":"numerical")),A.pinType===O.O.None&&y.push("none"),A.hideWire||y.push("leader-line"),A.hideTag||y.push("label"),A.collapseDescription&&y.push("collapsible collapsed"),Z.className=y.join(" ");let b={};Z.actions=[];const S=[Z],v=A.states.length;A.states.forEach((ne,m)=>{if(m===v-1)S[0].actions.push("resetHotspots"),ne.errands.forEach(ce=>{const I=this.convertErrandToAction(A,ce);S[0].actions.push(I.action),b={...b,...I.data}});else{const ce=(0,P.cloneDeep)(Z);ce.actions=[],ce.className=ce.className.replace("plus","minus"),ne.errands.forEach(I=>{const x=this.convertErrandToAction(A,I);ce.actions.push(x.action),b={...b,...x.data}}),S.push(ce)}}),2===S.length&&(S[0].actions.push(`hideHotspots:currentChapter.hotspots[${Y}]`),S[0].actions.push(`showHotspots:currentChapter.hotspots[${Y+1}]`),S[1].actions.push(`hideHotspots:currentChapter.hotspots[${Y+1}]`),S[1].actions.push(`showHotspots:currentChapter.hotspots[${Y}]`),S[0].shown=!0,S[1].shown=!1),2===S.length&&A.collapseDescription&&(S[1].className+=S[1].className.replace("collapsed","")),S.forEach(ne=>{Z.labelOffset[0]<0?ne.className=ne.className.replace("right","")+" left":Z.labelOffset[0]>0&&(ne.className=ne.className.replace("left","")+" right")});const D=A.contentBlocks;return D&&(Z.contentBlocks=JSON.parse(JSON.stringify(D))),{data:b,hotspots:S}}setLabelContainer(A){this._labelContainer=A}getLabelContainer(){return this._labelContainer}hasContent(A){const{description:Y,contentBlocks:Z}=A;return!!Y||!(0,P.isNil)(Z)&&Z.length>0}getHotspotAction(A,Y){const Z=Y.actionSrc?(0,P.get)(A,Y.actionSrc):Y.actions?Y.actions:[];return Array.isArray(Z)?Z:[]}filterHotspotActions(A){const Y=new RegExp("^(flyTo|flyToObject)");return A.filter(Z=>Y.test(Z))}}return(g=E).\u0275fac=function(A){return new(A||g)(R.KVO(w.O),R.KVO(F.w))},g.\u0275prov=R.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),E})()},62751:(Se,J,_)=>{"use strict";_.d(J,{L:()=>c});var c=function(e){return e.JumpTo="jumpTo",e.FlyTo="flyTo",e}(c||{})},92333:(Se,J,_)=>{"use strict";_.d(J,{y:()=>e}),_(62751);const e=$localize`Starting Position`},17766:(Se,J,_)=>{"use strict";_.d(J,{c:()=>c});var c=function(e){return e.Bookmark="bookmark",e.Module="module",e.Internal="internal",e}(c||{})},38157:(Se,J,_)=>{"use strict";_.d(J,{X:()=>c});var c=function(e){return e.flyToChapter="flyToChapter",e.flyToObject="flyToObject",e.flyToCamera="flyToCamera",e}(c||{})},95370:(Se,J,_)=>{"use strict";_.d(J,{v:()=>e});var c=_(38157);class e{constructor(l){this.type=c.X.flyToCamera,this.value=l}}},1300:(Se,J,_)=>{"use strict";_.d(J,{T:()=>e});var c=_(38157);class e{constructor(){this.type=c.X.flyToChapter,this.value=null}}},49746:(Se,J,_)=>{"use strict";_.d(J,{F:()=>e});var c=_(38157);class e{constructor(l){this.type=c.X.flyToObject,this.value=l}}},92677:(Se,J,_)=>{"use strict";_.d(J,{T:()=>c});var c=function(e){return e.classicAnnotation="classic-annotation",e.classicHotspot="classic-hotspot",e.studioNext="studio-light",e}(c||{})},20714:(Se,J,_)=>{"use strict";_.d(J,{H:()=>c});var c=function(e){return e.Circle="circle",e.CirclePlus="circle-plus",e.CircleMinus="circle-minus",e.Label="label",e.CircleLabel="circle-label",e}(c||{})},15375:(Se,J,_)=>{"use strict";_.d(J,{Q:()=>c});var c=function(e){return e.Toggle="toggle",e.None="none",e}(c||{})},24151:(Se,J,_)=>{"use strict";_.d(J,{O:()=>c});var c=function(e){return e.Default="default",e.Plus="plus",e.Minus="minus",e.PlusMinus="plusMinus",e.Sequential="sequential",e.None="None",e}(c||{})},79817:(Se,J,_)=>{"use strict";_.d(J,{C:()=>c});var c=function(e){return e.Alphabetical="alphabetical",e.Numerical="numerical",e}(c||{})},16124:(Se,J,_)=>{"use strict";_.d(J,{B:()=>c});class c{constructor(){this.title=null,this.description=null,this.errands=[]}}},76872:(Se,J,_)=>{"use strict";_.d(J,{D:()=>c});var c=function(e){return e.Annotation="annotation",e.Classic="classic",e.StudioNext="studioNext",e.Context="context",e}(c||{})},69568:(Se,J,_)=>{"use strict";_.d(J,{e:()=>l});var c=_(24151),e=_(76872),O=_(79817);class l{constructor($){this.pinType=c.O.PlusMinus,this.sequentialType=O.C.Alphabetical,this.theme=e.D.StudioNext,this.expandTag=!0,this.showDescription=!0,this.collapseDescription=!1,this.pinGlow=!1,this.hideWire=!1,this.hideTag=!1,this.title=$}}},57238:(Se,J,_)=>{"use strict";_.d(J,{R:()=>e});var c=_(93455);class e extends c.V{}},33013:(Se,J,_)=>{"use strict";_.d(J,{$V:()=>m,Aq:()=>X,Bc:()=>ie,EN:()=>Y,Eh:()=>ce,Ej:()=>C,Eo:()=>l,F0:()=>O,FN:()=>S,Lx:()=>V,M5:()=>w,Nw:()=>g,O:()=>H,Oj:()=>p,PA:()=>y,R:()=>M,VU:()=>h,WZ:()=>ne,Wd:()=>Z,X_:()=>u,YA:()=>b,bg:()=>le,eV:()=>F,is:()=>K,jo:()=>I,jy:()=>P,lM:()=>j,lc:()=>x,pN:()=>W,pb:()=>Q,qi:()=>A,rT:()=>R,sC:()=>B,sN:()=>N,tg:()=>e,tn:()=>v,wg:()=>$,yr:()=>c,yz:()=>U,zh:()=>k});let c=(()=>{class oe{constructor(z){this.patches=z}}return oe.type="[Story Chapter] Apply Patch",oe})(),e=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] Next Chapter",oe})(),O=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] Previous Chapter",oe})(),l=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] First Chapter",oe})(),X=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] Last Chapter",oe})(),U=(()=>{class oe{constructor(z){this.chapter=z}}return oe.type="[Story Chapter] Select Chapter",oe})(),$=(()=>{class oe{constructor(z){this.chapterId=z}}return oe.type="[Story Chapter] Select Chapter by chapter id",oe})(),j=(()=>{class oe{constructor(z){this.chapters=z}}return oe.type="[Story Chapter] Set Chapters",oe})(),h=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.cameraAction=ae}}return oe.type="[Story Chapter] Set Chapter Camera Action",oe})(),W=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.title=ae}}return oe.type="[Story Chapter] Set Chapter Camera Title",oe})(),B=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.ui=ae}}return oe.type="[Story Chapter] Set Chapter UI",oe})(),H=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.description=ae,this.displayName=me}}return oe.type="[Story Chapter] Set Chapter Info",oe})(),V=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.legend=ae}}return oe.type="[Story Chapter] Set Chapter Legend",oe})(),P=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.legend=ae}}return oe.type="[Story Chapter] Add To Chapter Legend",oe})(),p=(()=>{class oe{constructor(z,ae){this.previousIndex=z,this.currentIndex=ae}}return oe.type="[Story Chapter] Reorder Chapters",oe})(),w=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.readyState=ae}}return oe.type="[Story Chapter] Set Readystate",oe})(),F=(()=>{class oe{constructor(z){this.chapterId=z}}return oe.type="[Story Chapter] Build Chapter Visibility Layers",oe})(),R=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.effects=ae,this.properties=me}}return oe.type="[Story Chapter] Set Chapter PostProcessing",oe})(),N=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.transition=ae,this.key=me}}return oe.type="[Story Chapter] Set Chapter Transitions",oe})(),M=(()=>{class oe{constructor(z,ae){this.chapterIds=z,this.properties=ae}}return oe.type="[Story Chapter] Set Chapter Properties",oe})(),u=(()=>{class oe{constructor(z,ae){this.chapterIds=z,this.properties=ae}}return oe.type="[Story Chapter] Remove Chapter Properties",oe})(),g=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.transparencyMode=ae}}return oe.type="[Story Chapter] Set Chapter Transparency Mode",oe})(),C=(()=>{class oe{constructor(z,ae,me,Ne){this.chapterId=z,this.clips=ae,this.enabled=me,this.record=Ne}}return oe.type="[Story Chapter] Set Chapter Clipping Planes",oe})(),A=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.background=ae}}return oe.type="[Story Chapter] Set Chapter Background",oe})(),Y=(()=>{class oe{constructor(z){this.background=z}}return oe.type="[Story Chapter] Set All Chapters Background",oe})(),Z=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] Reset Selected Chapter Background",oe})(),Q=(()=>{class oe{constructor(z){this.background=z}}return oe.type="[Story Chapter] Set Selected Chapter Background",oe})(),y=(()=>{class oe{constructor(z,ae,me){this.story=z,this.chapter=ae,this.chapterId=me}}return oe.type="[Story Chapter] Duplicate An Existing Chapter",oe})(),b=(()=>{class oe{constructor(z){this.chapter=z}}return oe.type="[Story Chapter] Remove Chapter",oe})(),S=(()=>{class oe{constructor(){}}return oe.type="[Story Chapter] Reset",oe})(),v=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.camera=ae,this.rotationCenter=me}}return oe.type="[Story Chapters] Record Camera",oe})(),ne=(()=>{class oe{constructor(z,ae,me,Ne){this.chapterId=z,this.index=ae,this.position=me,this.record=Ne}}return oe.type="[Story Chapters] Set the current visibility layers index and position",oe})(),m=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.targetGroups=ae,this.record=me}}return oe.type="[Story Chapters] Set the current group layers position",oe})(),ce=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.media=ae}}return oe.type="[Story Chapters] Set the media object",oe})(),I=(()=>{class oe{constructor(z,ae,me){this.chapterId=z,this.contentBlocks=ae,this.record=me}}return oe.type="[Story Chapters] Set the content blocks",oe})(),x=(()=>{class oe{constructor(z){this.timelineMaps=z}}return oe.type="[Story Chapters] Add to timelineMap array",oe})(),K=(()=>{class oe{constructor(z){this.updates=z}}return oe.type="[Story Chapters] Update timelineMap array",oe})(),ie=(()=>{class oe{constructor(z){this.timelineMapIds=z}}return oe.type="[Story Chapters] Remove from timelineMap array",oe})(),k=(()=>{class oe{constructor(z,ae){this.chapterId=z,this.lightLibId=ae}}return oe.type="[Story Chapters] Set the lights",oe})(),le=(()=>{class oe{constructor(z){this.timelineMaps=z}}return oe.type="[Story Chapters] set chapter timeline with data from the engine",oe})()},59676:(Se,J,_)=>{"use strict";_.d(J,{G:()=>c});class c{}},85586:(Se,J,_)=>{"use strict";_.d(J,{N:()=>m});var c=_(28407),e=_(65763),O=_(59676),l=_(33013),X=_(4959),U=_(93915),$=_(47610),j=_(49204),h=_(10352),W=_(97415),B=_(12347),H=_(75069),V=_(81391),P=_(61295),p=_(76016),w=_(9592),F=_(65776),R=_(82323),N=_(65650),M=_(11724),u=_(57238),g=_(81025),E=_(35650),C=_(72849),A=_(63508),Y=_(54438);let Z=(()=>{var ce;class I{constructor(K,ie){this.engineService=K,this.store=ie}getGeometries(){return{}}getGeometryCompressionSupported(){return!0}getLoadedAssets(){return{}}getLights(){return{}}getMaterials(){return{}}getTextureCompressionSupported(){return!0}getMorphs(){return{}}getAssetLibrary(K,ie,k){const{server:le,serverBaseDirectory:de}=this.engineService;return le.getAssetLibrary(de,K,ie,k)}getAssetNamespaces(){const K={},ie=this.getLoadedAssets();return Object.keys(ie).map(k=>k.split("/")[0]).forEach(k=>{K[k]=!0}),Object.keys(K)}enableLightLib(K){const k=this.getLights()[K];if(Array.isArray(k)){const le={};k.forEach(de=>{le[de]=!0}),console.warn("Enabling of lights in real-time not yet implemented.")}}setBranchLights(K,ie){const k=this.store.selectSnapshot(m.getSelectedChapter);(0,A.Uv)(k)&&k.lights.libraries[0]!==ie&&(k.lights.libraries[0]=ie,this.enableLightLib(ie))}loadLightLib(K){var ie=this;return(0,c.A)(function*(){return ie.getAssetLibrary("lights",K,"outline").then(k=>({type:"physicalImageLight"in k?"physical":"legacy",libId:K,asset:k}))})()}getLightingLibs(K){var ie=this;return(0,c.A)(function*(){return Promise.all(K.map(k=>ie.loadLightLib(k)))})()}}return(ce=I).\u0275fac=function(K){return new(K||ce)(Y.KVO(C.y),Y.KVO(e.il))},ce.\u0275prov=Y.jDH({token:ce,factory:ce.\u0275fac,providedIn:"root"}),I})();var b,D,Q=_(16606),y=_(68947),S=function(ce,I,x,K){var le,ie=arguments.length,k=ie<3?I:null===K?K=Object.getOwnPropertyDescriptor(I,x):K;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)k=Reflect.decorate(ce,I,x,K);else for(var de=ce.length-1;de>=0;de--)(le=ce[de])&&(k=(ie<3?le(k):ie>3?le(I,x,k):le(I,x))||k);return ie>3&&k&&Object.defineProperty(I,x,k),k},v=function(ce,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ce,I)};const ne={loading:!1,chapters:[],chaptersViewed:[],selectedChapter:null,isChapterAnimated:!1,thumbnails:new Map,patches:[],inversePatches:[]};let m=(b=class{static getStoryChapters(I){return I.chapters}static getChaptersViewed(I){return I.chaptersViewed}static getChapter(I){return(0,e.Mz)([D],x=>x.chapters.find(K=>K.id===I))}static getSelectedChapterId(I){return I.selectedChapter}static getSelectedChapter(I){return I.chapters.find(x=>x.id===I.selectedChapter)||null}static getSelectedChapterTitle(I){const x=I.chapters.find(K=>K.id===I.selectedChapter)||null;return y.l.normalize(x?.displayName)}static getNextChapter(I){const x=(0,M.clamp)(D.getSelectedChapterIndex(I)+1,0,I.chapters.length-1);return I.chapters[x]}static getPreviousChapter(I){const x=(0,M.clamp)(D.getSelectedChapterIndex(I)-1,0,I.chapters.length-1);return I.chapters[x]}static getSelectedChapterIndex(I){return I.chapters.findIndex(x=>x.id===I.selectedChapter)}static getChapterCount(I){return I.chapters.length}static getChapterPagination(I){const x=I.chapters.findIndex(K=>K.id===I.selectedChapter);return{count:I.chapters.length,index:x,label:`${x+1} ${$localize`of`} ${I.chapters.length}`}}static getChapterCompletionPercent(I){return(I.chapters.findIndex(K=>K.id===I.selectedChapter)+1)/I.chapters.length*100}static getRegisteredThumbnails(I){return I.thumbnails}static getIsChapterAnimated(I){return I.isChapterAnimated}static getSelectedChapterReadyState(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.readyState??{model:!1,animation:!1,audio:!1}}static getChaptersLoaded(I){return{count:I.chapters.length,modelChapters:I.chapters.filter(x=>x.readyState.model),animationChapters:I.chapters.filter(x=>x.readyState.animation)}}static getAllChaptersModelsReady(I){return I.chapters.length>0&&I.chapters.every(x=>x.readyState.model)}static getSelectedChapterModelReady(I){const x=D.getSelectedChapterReadyState(I);return!(0,j.isNil)(x)&&x.model}static getAllChaptersAnimationsReady(I){return I.chapters.length>0&&I.chapters.every(x=>x.readyState.animation)}static getSelectedChapterAnimationReady(I){const x=D.getSelectedChapterReadyState(I);return!(0,j.isNil)(x)&&x.animation}static getSelectedChapterBackground(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.background??h.RK}static getAllChaptersBackground(I){return I.chapters.map(x=>x?.background)}static getSelectedChapterAllAudio(I){const x=I.chapters.find(K=>K.id===I.selectedChapter);return x&&x.media?Object.values(x.media).filter(ie=>"audio"===ie.streamType):[]}static getSelectedChapterLegend(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.legend??[]}static getSelectedChapterClippingPlanes(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.clippingPlanes}static getChapterCamera(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.camera?.location}static findChapter(I,x){return I.find(K=>K.id===x)}static getAllChaptersCurrentLayers(I){return I.chapters.map(x=>x?.sliderLayers?.currentLayers?.layers??[])}static getSelectedChapterSrcLayers(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.src?.layers??[]}static getSelectedChapterSourceLayerGroups(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.sourceLayerGroups??[]}static getSelectedChapterLayerGroups(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.currentLayerGroups??[]}static getSelectedChapterCurrentLayers(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.currentLayers?.layers??[]}static getSelectedChapterCurrentLayersIndex(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.currentLayers?.index}static getSelectedChapterCurrentLayersPosition(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.sliderLayers?.currentLayers?.position}static getSelectedChapterContentBlocks(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.contentBlocks??[]}static getSelectedChapterTimelineMap(I){const{chapters:x,selectedChapter:K}=I;return D.findChapter(x,K)?.timelineMap??[]}static isLastChapter(I){return D.getSelectedChapterIndex(I)+1===I.chapters.length}setChapters(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters=x.chapters}))}SetChapterCameraAction(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).camera.action=x.cameraAction}))}setChapterCameraTitle(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).camera.title=x.title}))}setChapterUI(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).ui=x.ui}))}setChapterInfo(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===x.chapterId);ie.description=x.description,ie.displayName=x.displayName}))}setChapterLegend(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).legend=x.legend}))}addToChapterLegend(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).legend.push(x.legend)}))}ReorderChapters(I,x){var K=this;return(0,c.A)(function*(){return K.storyService.moveChapterInEngine(x.previousIndex,x.currentIndex).then(ie=>{if(ie){const le=I.getState().chapters.find(de=>de.id===ie);I.dispatch(new l.yz(le)),I.dispatch(new P.IA(ie))}I.patchState(g.jM(I.getState(),le=>{(0,V.HD)(le.chapters,x.previousIndex,x.currentIndex)}));const k=I.getState().chapters.map(le=>le.id);I.dispatch(new p.B.ReorderQuestions(k))})})()}SetChapterReadyState(I,x){const K=g.jM(I.getState(),ie=>{if(x.chapterId){const k=ie.chapters.find(le=>le.id===x.chapterId);k&&(k.readyState={...k.readyState,...x.readyState})}});I.patchState(K)}BuildChapterVisibilityLayers(I,x){const K=g.jM(I.getState(),ie=>{if(x.chapterId){const k=ie.chapters.findIndex(de=>de.id===x.chapterId),le=ie.chapters[k];le.sliderLayers=this.chapterService.buildVisibilityLayers(le)}});I.patchState(K)}SetChapterPostProcessing(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(de=>de.id===x.chapterId),le=ie.properties||{};ie.customData={...ie.customData?ie.customData:{},postprocess:x.effects},ie.properties={...le,...x.properties}}))}SetChapterTransitions(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===x.chapterId);ie.transitions=ie.transitions||{},ie.transitions[x.key]=x.transition}))}setChapterProperties(I,x){const K=x.chapterIds,ie=x.properties;I.patchState(g.jM(I.getState(),k=>{k.chapters.filter(le=>K.includes(le.id)).forEach(le=>{le.properties={...le.properties??{},...ie}})}))}removeChapterProperties(I,x){const K=x.chapterIds,ie=x.properties;I.patchState(g.jM(I.getState(),k=>{k.chapters.filter(le=>K.includes(le.id)).forEach(le=>{le?.properties&&ie.forEach(de=>{delete le.properties[de]})})}))}SetChapterTransparencyMode(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).transparencyMode=x.transparencyMode}))}applyChapterPatch(I,x){const K=g.$i(I.getState(),x.patches);I.patchState(g.jM(K,ie=>{ie.patches=[],ie.inversePatches=[]}))}setChapterClippingPlane(I,x){const[K,ie,k]=g.vI(I.getState(),de=>{const oe=de.chapters.find(ye=>ye.id===x.chapterId);oe.clippingPlanes.clips=x.clips,oe.clippingPlanes.enabled=x.enabled,oe.clippingPlanes.boundary=oe.clippingPlanes.boundary??this.sceneService.getSceneBoundary()}),le=g.jM(K,de=>{de.patches.push(...ie),de.inversePatches.push(...k)});x.record&&I.dispatch(new H.a.SavePatches([{forward:le.patches,inverse:[...le.inversePatches].reverse(),patchAction:l.yr}])),I.patchState(x.record?g.jM(le,de=>{de.patches=[],de.inversePatches=[]}):le)}setChapterBackground(I,x){x.background&&I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).background=x.background}))}setAllChaptersBackground(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.forEach(ie=>{ie.background=x.background})}))}resetSelectedChapterBackground(I,x){const{selectedChapter:K}=I.getState();this.store.dispatch(new l.qi(K,h.RK))}setSelectedChapterBackground(I,{background:x}){const K=I.getState().selectedChapter;this.store.dispatch(new l.qi(K,x))}selectChapter(I,x){if(!x.chapter)return;this.store.dispatch([new P.q9(!1),new P.hg]);const K=this.animationService.isChapterAnimated(x.chapter);this.store.dispatch(new $.dB(!!x.chapter));const ie=g.jM(I.getState(),k=>{k.chaptersViewed.some(le=>x.chapter.id===le)||k.chaptersViewed.push(x.chapter.id),k.selectedChapter=x.chapter?x.chapter.id:null,k.isChapterAnimated=K});I.patchState(ie)}selectChapterById(I,{chapterId:x}){this.store.dispatch(new $.dB(!0)),I.patchState({selectedChapter:x})}duplicateChapter(I,x){const K=x.chapter,ie=this.chapterService.copyChapter(K,x.chapterId),k=this.store.selectSnapshot(D.getSelectedChapterBackground),le=this.store.selectSnapshot(N.K.getRegisteredThumbnails),de=le.get(K.id);if((0,j.isNil)(de))if(K.thumbnails){const z=new u.R;z.chapterId=ie.id,z.snapshot=K.thumbnails.default,le.set(ie.id,z)}else I.dispatch(new R.V9(ie.id,k,w.H.JPEG,92,W.I.medium,"square"));else le.set(ie.id,de);const ye=I.getState().chapters.findIndex(z=>z.id==K.id)+1;I.patchState(g.jM(I.getState(),z=>{z.chapters.splice(ye,0,ie)})),this.storyService.addChapterToEngine(ie,ye).then(()=>{}).catch(z=>{console.error(`Error importing chapter "${ie.id}":`,z)})}nextChapter(I,x){const K=this.store.selectSnapshot(D.getNextChapter);I.dispatch(new l.yz(K))}previousChapter(I,x){const K=this.store.selectSnapshot(D.getPreviousChapter);I.dispatch(new l.yz(K))}lastChapter(I,x){const K=I.getState().chapters;I.dispatch(new l.yz(K[K.length-1]))}firstChapter(I,x){const K=I.getState().chapters;I.dispatch(new l.yz(K[0]))}removeChapter(I,x){const{chapters:K,selectedChapter:ie}=I.getState();if(1===K.length)return;const k=K.findIndex(le=>le.id===x.chapter.id);if(this.storyService.removeChapterFromEngine(k),I.patchState(g.jM(I.getState(),le=>{le.chapters.splice(k,1)})),x.chapter.id===ie){const le=I.getState().chapters,de=Math.min(k,le.length-1);I.dispatch(new l.yz(le[de]))}I.dispatch(new U.u1(x.chapter,!1))}resetStoryChaptersState(I,x){I.setState(ne)}RecordCamera(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===x.chapterId);ie.camera.location=x.camera,x.rotationCenter&&(ie.camera.rotationCenter=x.rotationCenter)}))}setChapterCurrentLayersIndexPosition(I,x){const[K,ie,k]=g.vI(I.getState(),de=>{const ye=de.chapters.find(z=>z.id===x.chapterId).sliderLayers.currentLayers;ye.index=x.index,ye.position=x.position}),le=g.jM(K,de=>{de.patches.push(...ie),de.inversePatches.push(...k)});I.patchState(le),x.record&&I.dispatch(new H.a.SavePatches([{forward:le.patches,inverse:le.inversePatches,patchAction:l.yr}]))}setChapterCurrentGroupLayersPosition(I,x){const[K,ie,k]=g.vI(I.getState(),de=>{const oe=de.chapters.find(ye=>ye.id===x.chapterId);oe&&(oe.sliderLayers.currentLayerGroups=oe.sliderLayers.currentLayerGroups.map(ye=>{const z=x.targetGroups.find(ae=>ae.name===ye.name);return{...ye,position:z?.position??ye.position}}))}),le=g.jM(K,de=>{de.patches.push(...ie),de.inversePatches.push(...k)});I.patchState(le),x.record&&I.dispatch(new H.a.SavePatches([{forward:le.patches,inverse:le.inversePatches,patchAction:l.yr}]))}setChapterMedia(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===x.chapterId).media=x.media}))}setChapterContentBlocks(I,x){x.contentBlocks=[...x.contentBlocks.filter(de=>de.type===F.m.Ticker),...x.contentBlocks.filter(de=>de.type!==F.m.Ticker)];const[K,ie,k]=g.vI(I.getState(),de=>{de.chapters.find(ye=>ye.id===x.chapterId).contentBlocks=x.contentBlocks}),le=g.jM(K,de=>{de.patches.push(...ie),de.inversePatches.push(...k)});I.patchState(le),x.record&&I.dispatch(new H.a.SavePatches([{forward:le.patches,inverse:le.inversePatches,patchAction:l.yr}]))}setChapterTimelineMap(I,x){I.patchState(g.jM(I.getState(),K=>{K.chapters.find(k=>k.id===K.selectedChapter).timelineMap=x.timelineMaps}))}addChapterTimelineMap(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===K.selectedChapter);x.timelineMaps.forEach(k=>{ie.timelineMap.push(k)})}))}updateChapterTimelineMap(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===K.selectedChapter);x.updates.forEach(k=>{const le=ie.timelineMap.findIndex(de=>de.id===k.id);ie.timelineMap.splice(le,1),ie.timelineMap.push(k)})}))}removeFromChapterTimelineMap(I,x){I.patchState(g.jM(I.getState(),K=>{const ie=K.chapters.find(k=>k.id===K.selectedChapter);x.timelineMapIds.forEach(k=>{const le=ie.timelineMap.findIndex(de=>de.id===k);ie.timelineMap.splice(le,1)})}))}SetChapterLights(I,{chapterId:x,lightLibId:K}){I.patchState(g.jM(I.getState(),ie=>{const k=ie.chapters.find(le=>le.id===x);(0,A.Mi)(k)?k.lightLibraryId=K:(0,A.Uv)(k)&&(k.lights.libraries=[K],this.assetService.setBranchLights(x,K))}))}constructor(I,x,K,ie,k,le){this.store=I,this.chapterService=x,this.animationService=K,this.assetService=ie,this.sceneService=k,this.storyService=le}},D=b,b.\u0275fac=function(I){return new(I||b)(Y.KVO(e.il),Y.KVO(X.j),Y.KVO(B.O),Y.KVO(Z),Y.KVO(E.w),Y.KVO(Q.J))},b.\u0275prov=Y.jDH({token:b,factory:b.\u0275fac}),b);S([(0,e.rc)(l.lM),v("design:type",Function),v("design:paramtypes",[Object,l.lM]),v("design:returntype",void 0)],m.prototype,"setChapters",null),S([(0,e.rc)(l.VU),v("design:type",Function),v("design:paramtypes",[Object,l.VU]),v("design:returntype",void 0)],m.prototype,"SetChapterCameraAction",null),S([(0,e.rc)(l.pN),v("design:type",Function),v("design:paramtypes",[Object,l.pN]),v("design:returntype",void 0)],m.prototype,"setChapterCameraTitle",null),S([(0,e.rc)(l.sC),v("design:type",Function),v("design:paramtypes",[Object,l.sC]),v("design:returntype",void 0)],m.prototype,"setChapterUI",null),S([(0,e.rc)(l.O),v("design:type",Function),v("design:paramtypes",[Object,l.O]),v("design:returntype",void 0)],m.prototype,"setChapterInfo",null),S([(0,e.rc)(l.Lx),v("design:type",Function),v("design:paramtypes",[Object,l.Lx]),v("design:returntype",void 0)],m.prototype,"setChapterLegend",null),S([(0,e.rc)(l.jy),v("design:type",Function),v("design:paramtypes",[Object,l.jy]),v("design:returntype",void 0)],m.prototype,"addToChapterLegend",null),S([(0,e.rc)(l.Oj),v("design:type",Function),v("design:paramtypes",[Object,l.Oj]),v("design:returntype",Promise)],m.prototype,"ReorderChapters",null),S([(0,e.rc)(l.M5),v("design:type",Function),v("design:paramtypes",[Object,l.M5]),v("design:returntype",void 0)],m.prototype,"SetChapterReadyState",null),S([(0,e.rc)(l.eV),v("design:type",Function),v("design:paramtypes",[Object,l.eV]),v("design:returntype",void 0)],m.prototype,"BuildChapterVisibilityLayers",null),S([(0,e.rc)(l.rT),v("design:type",Function),v("design:paramtypes",[Object,l.rT]),v("design:returntype",void 0)],m.prototype,"SetChapterPostProcessing",null),S([(0,e.rc)(l.sN),v("design:type",Function),v("design:paramtypes",[Object,l.sN]),v("design:returntype",void 0)],m.prototype,"SetChapterTransitions",null),S([(0,e.rc)(l.R),v("design:type",Function),v("design:paramtypes",[Object,l.R]),v("design:returntype",void 0)],m.prototype,"setChapterProperties",null),S([(0,e.rc)(l.X_),v("design:type",Function),v("design:paramtypes",[Object,l.X_]),v("design:returntype",void 0)],m.prototype,"removeChapterProperties",null),S([(0,e.rc)(l.Nw),v("design:type",Function),v("design:paramtypes",[Object,l.Nw]),v("design:returntype",void 0)],m.prototype,"SetChapterTransparencyMode",null),S([(0,e.rc)(l.yr),v("design:type",Function),v("design:paramtypes",[Object,l.yr]),v("design:returntype",void 0)],m.prototype,"applyChapterPatch",null),S([(0,e.rc)(l.Ej),v("design:type",Function),v("design:paramtypes",[Object,l.Ej]),v("design:returntype",void 0)],m.prototype,"setChapterClippingPlane",null),S([(0,e.rc)(l.qi),v("design:type",Function),v("design:paramtypes",[Object,l.qi]),v("design:returntype",void 0)],m.prototype,"setChapterBackground",null),S([(0,e.rc)(l.EN),v("design:type",Function),v("design:paramtypes",[Object,l.EN]),v("design:returntype",void 0)],m.prototype,"setAllChaptersBackground",null),S([(0,e.rc)(l.Wd),v("design:type",Function),v("design:paramtypes",[Object,l.Wd]),v("design:returntype",void 0)],m.prototype,"resetSelectedChapterBackground",null),S([(0,e.rc)(l.pb),v("design:type",Function),v("design:paramtypes",[Object,Object]),v("design:returntype",void 0)],m.prototype,"setSelectedChapterBackground",null),S([(0,e.rc)(l.yz),v("design:type",Function),v("design:paramtypes",[Object,l.yz]),v("design:returntype",void 0)],m.prototype,"selectChapter",null),S([(0,e.rc)(l.wg),v("design:type",Function),v("design:paramtypes",[Object,Object]),v("design:returntype",void 0)],m.prototype,"selectChapterById",null),S([(0,e.rc)(l.PA),v("design:type",Function),v("design:paramtypes",[Object,l.PA]),v("design:returntype",void 0)],m.prototype,"duplicateChapter",null),S([(0,e.rc)(l.tg),v("design:type",Function),v("design:paramtypes",[Object,l.tg]),v("design:returntype",void 0)],m.prototype,"nextChapter",null),S([(0,e.rc)(l.F0),v("design:type",Function),v("design:paramtypes",[Object,l.F0]),v("design:returntype",void 0)],m.prototype,"previousChapter",null),S([(0,e.rc)(l.Aq),v("design:type",Function),v("design:paramtypes",[Object,l.Aq]),v("design:returntype",void 0)],m.prototype,"lastChapter",null),S([(0,e.rc)(l.Eo),v("design:type",Function),v("design:paramtypes",[Object,l.Aq]),v("design:returntype",void 0)],m.prototype,"firstChapter",null),S([(0,e.rc)(l.YA),v("design:type",Function),v("design:paramtypes",[Object,l.YA]),v("design:returntype",void 0)],m.prototype,"removeChapter",null),S([(0,e.rc)(l.FN),v("design:type",Function),v("design:paramtypes",[Object,l.FN]),v("design:returntype",void 0)],m.prototype,"resetStoryChaptersState",null),S([(0,e.rc)(l.tn),v("design:type",Function),v("design:paramtypes",[Object,l.tn]),v("design:returntype",void 0)],m.prototype,"RecordCamera",null),S([(0,e.rc)(l.WZ),v("design:type",Function),v("design:paramtypes",[Object,l.WZ]),v("design:returntype",void 0)],m.prototype,"setChapterCurrentLayersIndexPosition",null),S([(0,e.rc)(l.$V),v("design:type",Function),v("design:paramtypes",[Object,l.$V]),v("design:returntype",void 0)],m.prototype,"setChapterCurrentGroupLayersPosition",null),S([(0,e.rc)(l.Eh),v("design:type",Function),v("design:paramtypes",[Object,l.Eh]),v("design:returntype",void 0)],m.prototype,"setChapterMedia",null),S([(0,e.rc)(l.jo),v("design:type",Function),v("design:paramtypes",[Object,l.jo]),v("design:returntype",void 0)],m.prototype,"setChapterContentBlocks",null),S([(0,e.rc)(l.bg),v("design:type",Function),v("design:paramtypes",[Object,l.lc]),v("design:returntype",void 0)],m.prototype,"setChapterTimelineMap",null),S([(0,e.rc)(l.lc),v("design:type",Function),v("design:paramtypes",[Object,l.lc]),v("design:returntype",void 0)],m.prototype,"addChapterTimelineMap",null),S([(0,e.rc)(l.is),v("design:type",Function),v("design:paramtypes",[Object,l.is]),v("design:returntype",void 0)],m.prototype,"updateChapterTimelineMap",null),S([(0,e.rc)(l.Bc),v("design:type",Function),v("design:paramtypes",[Object,l.Bc]),v("design:returntype",void 0)],m.prototype,"removeFromChapterTimelineMap",null),S([(0,e.rc)(l.zh),v("design:type",Function),v("design:paramtypes",[Object,l.zh]),v("design:returntype",void 0)],m.prototype,"SetChapterLights",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getStoryChapters",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChaptersViewed",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterId",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapter",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterTitle",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getNextChapter",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getPreviousChapter",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterIndex",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChapterCount",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChapterPagination",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChapterCompletionPercent",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getRegisteredThumbnails",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getIsChapterAnimated",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterReadyState",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChaptersLoaded",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getAllChaptersModelsReady",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterModelReady",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getAllChaptersAnimationsReady",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterAnimationReady",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterBackground",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getAllChaptersBackground",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterAllAudio",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterLegend",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getSelectedChapterClippingPlanes",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"getChapterCamera",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getAllChaptersCurrentLayers",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterSrcLayers",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterSourceLayerGroups",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterLayerGroups",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterCurrentLayers",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Number)],m,"getSelectedChapterCurrentLayersIndex",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Number)],m,"getSelectedChapterCurrentLayersPosition",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterContentBlocks",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",Array)],m,"getSelectedChapterTimelineMap",null),S([(0,e.MD)(),v("design:type",Function),v("design:paramtypes",[O.G]),v("design:returntype",void 0)],m,"isLastChapter",null),m=D=S([(0,e.Uw)({name:"storyChapters",defaults:ne}),v("design:paramtypes",[e.il,X.j,B.O,Z,E.w,Q.J])],m)},93915:(Se,J,_)=>{"use strict";_.d(J,{$K:()=>p,$y:()=>P,D3:()=>F,Ds:()=>M,HP:()=>B,S3:()=>j,Sh:()=>X,TR:()=>V,Tz:()=>w,eH:()=>R,gJ:()=>l,h5:()=>U,lb:()=>W,sW:()=>e,tH:()=>H,u1:()=>h,vf:()=>N,vx:()=>$,yi:()=>O});var c=_(15375);let e=(()=>{class g{constructor(C){this.patches=C}}return g.type="[Story Labels] Patch Labels",g})(),O=(()=>{class g{constructor(C,A){this.labelId=C,this.offset=A}}return g.type="[Story Labels] Set label Offset",g})(),l=(()=>{class g{constructor(C){this.labels=C}}return g.type="[Story Labels] Set Labels",g})(),X=(()=>{class g{constructor(C,A=!1){this.label=C,this.record=A}}return g.type="[Story Labels] Add Label",g})(),U=(()=>{class g{constructor(C){this.label=C}}return g.type="[Story Labels] Set Contexdt Label",g})(),$=(()=>{class g{constructor(C){this.label=C}}return g.type="[Story Labels] Remove Label",g})(),j=(()=>{class g{constructor(){}}return g.type="[Story Labels] Remove Context Label",g})(),h=(()=>{class g{constructor(C,A=!1){this.chapter=C,this.record=A}}return g.type="[Story Labels] Remove All Chapter Labels",g})(),W=(()=>{class g{constructor(C,A=!1){this.label=C,this.record=A}}return g.type="[Story Labels] Set Label",g})(),B=(()=>{class g{constructor(C,A){this.id=C,this.states=A}}return g.type="[Story Labels] Set Label States",g})(),H=(()=>{class g{constructor(C){this.scale=C}}return g.type="[Story Labels] Set Label Scale",g})(),V=(()=>{class g{constructor(C){this.label=C}}return g.type="[Story Labels] Select Label",g})(),P=(()=>{class g{constructor(){}}return g.type="[Story Labels] Reset",g})(),p=(()=>{class g{constructor(C,A){this.labels=C,this.fields=A}}return g.type="[Story Labels] Convert",g})(),w=(()=>{class g{constructor(C,A=!0,Y=!0,Z=!0){this.enable=C,this.enableInfo=A,this.enableActions=Y,this.enableAudio=Z}}return g.type="[Story Labels] Enable Context Label",g})(),F=(()=>{class g{constructor(C,A){this.labels=C,this.shown=A}}return g.type="[Story Labels] Set Labels Shown",g})(),R=(()=>{class g{constructor(C){this.show=C}}return g.type="[Story Labels] Set All Labels Shown",g})(),N=(()=>{class g{constructor(C,A=c.Q.None){this.collapsed=C,this.collapsedMode=A}}return g.type="[Story Labels] Set Labels Collapsed",g})(),M=(()=>{class g{constructor(C){this.draggable=C}}return g.type="[Story Labels] Set Draggable",g})()},26657:(Se,J,_)=>{"use strict";_.d(J,{Z:()=>e,o:()=>c});class c{}class e{}},82323:(Se,J,_)=>{"use strict";_.d(J,{V9:()=>X,W2:()=>O,WX:()=>U,cf:()=>l});var c=_(10352),e=_(9592);let O=(()=>{class j{constructor(W){this.thumbnails=W}}return j.type="[Story Chapters] Register thumbnail URLs from story",j})(),l=(()=>{class j{constructor(W,B){this.chapterId=W,this.thumbnail=B}}return j.type="[Story Chapters] Set chapter thumbnail",j})(),X=(()=>{class j{constructor(W,B=c.RK,H=e.H.JPEG,V=.92,P,p="original",w,F,R=[]){this.chapterId=W,this.background=B,this.imageType=H,this.imageQuality=V,this.dimensions=P,this.crop=p,this.includeLabels=w,this.includeCopyright=F,this.layers=R}}return j.type="[Story Chapters] Take picture",j})(),U=(()=>{class j{constructor(W,B,H){this.chapterId=W,this.blob=B,this.dimensions=H}}return j.type="[Story Chapters] Take picture success",j})()},65650:(Se,J,_)=>{"use strict";_.d(J,{K:()=>F});var V,c=_(65763),O=_(82323),l=_(1308),X=_(11789),U=_(97415),$=_(57238),j=_(30582),h=_(81025),W=_(20342),B=_(98020),H=_(54438),P=function(R,N,M,u){var C,g=arguments.length,E=g<3?N:null===u?u=Object.getOwnPropertyDescriptor(N,M):u;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)E=Reflect.decorate(R,N,M,u);else for(var A=R.length-1;A>=0;A--)(C=R[A])&&(E=(g<3?C(E):g>3?C(N,M,E):C(N,M))||E);return g>3&&E&&Object.defineProperty(N,M,E),E},p=function(R,N){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(R,N)};const w={thumbnails:new Map};let F=((V=class{static getRegisteredThumbnails(N){return N.thumbnails}registerChapterThumbnails(N,M){N.patchState(h.jM(N.getState(),u=>{u.thumbnails=new Map(M.thumbnails)}))}setChapterThumbnail(N,M){N.patchState(h.jM(N.getState(),u=>{u.thumbnails.set(M.chapterId,M.thumbnail)}))}takeChapterPicture(N,M){const{background:u,chapterId:g,includeLabels:E,includeCopyright:C,dimensions:A,imageType:Y,imageQuality:Z,crop:Q,layers:y}=M,b=A||U.I.large,{width:S,height:v}=b,D=(0,l.F$)(Y,u),ne=u.colors.slice(0,3),m=X.T.isLight(ne),ce=this.store.selectSnapshot(B.X.getViewLogoConfig),I=(0,W.g)(ce,"full",m?"color":"white"),x={...l._,crop:Q,imageType:Y,imageQuality:Z,copyrightEnabled:C,copyrightImagePath:I.logo_url};this.snapshotService.takeSnapshot(S,v,D,y,E,x).subscribe(K=>{N.dispatch(new O.WX(g,K,b))})}takeChapterPictureSuccess(N,M){N.patchState(h.jM(N.getState(),u=>{const g=u.thumbnails.get(M.chapterId)||new $.R;g.snapshot=URL.createObjectURL(M.blob),u.thumbnails.set(M.chapterId,g)}))}constructor(N,M){this.snapshotService=N,this.store=M}}).\u0275fac=function(N){return new(N||V)(H.KVO(j.M),H.KVO(c.il))},V.\u0275prov=H.jDH({token:V,factory:V.\u0275fac}),V);P([(0,c.rc)(O.W2),p("design:type",Function),p("design:paramtypes",[Object,O.W2]),p("design:returntype",void 0)],F.prototype,"registerChapterThumbnails",null),P([(0,c.rc)(O.cf),p("design:type",Function),p("design:paramtypes",[Object,O.cf]),p("design:returntype",void 0)],F.prototype,"setChapterThumbnail",null),P([(0,c.rc)(O.V9),p("design:type",Function),p("design:paramtypes",[Object,O.V9]),p("design:returntype",void 0)],F.prototype,"takeChapterPicture",null),P([(0,c.rc)(O.WX),p("design:type",Function),p("design:paramtypes",[Object,O.WX]),p("design:returntype",void 0)],F.prototype,"takeChapterPictureSuccess",null),P([(0,c.MD)(),p("design:type",Function),p("design:paramtypes",[class e{}]),p("design:returntype",void 0)],F,"getRegisteredThumbnails",null),F=P([(0,c.Uw)({name:"storyThumbnails",defaults:w}),p("design:paramtypes",[j.M,c.il])],F)},16606:(Se,J,_)=>{"use strict";_.d(J,{J:()=>Y});var c=_(28407),e=_(15877),O=_(46104),l=_(38399),X=_(36110),U=_(28577),$=_(26657),j=_(4959),h=_(17766),W=_(72849),B=_(11789),H=_(24418),V=_(13976),P=_(43753),p=_(12347),w=_(65763),F=_(85586),R=_(33013),N=_(65881),M=_(49204),g=_(63745),E=_(54438),C=_(21626);function A(Z,Q,y){return Q===h.c.Bookmark?`/search/bookmarks/tr/${y}/${Z}`:`/tr/${y}/${Z}.json`}let Y=(()=>{var Z;class Q{constructor(b,S,v,D,ne,m){this.http=b,this.animationService=S,this.engineService=v,this.chapterService=D,this.contentBlocksService=ne,this.store=m}getLoadChapter(b,S){const v=new $.Z;return v.activate=!1,v.chapterId=S.id,v.readyState={model:!0,animation:!0},v}getStory(b,S,v="en"){const D=S===h.c.Bookmark?this.getBookmark(b):this.getContent(b);if("en"===v)return D;{let ne;return D.pipe((0,l.q)(m=>(ne=m,this.getStoryTranslation(b,S,v)))).pipe((0,X.T)(m=>this.translateStory(ne,m)),(0,U.W)(()=>D))}}getContentRoot(){return!0===H.c.offline?typeof localBaseDirectory>"u"?"":localBaseDirectory:"/"}getContent(b){return this.http.get(this.getContentRoot()+`content/modules/${b}.json`).pipe((0,X.T)(S=>this.normalizeStory(S)))}getBookmark(b){return this.http.get("/search/bookmarks/data",{params:{be:b}}).pipe((0,X.T)(S=>this.normalizeStory(S.bookmark)))}addContentRecord(b,S){S.createdFrom||(S.createdFrom=[]),S.createdFrom.unshift({id:(0,g.u2)(b),timestamp:Date.now()})}checkStoryIdChange(b,S){return(0,g.u2)(b)!==(0,g.u2)(S)}getMorphManifest(b){return this.http.get(`/content/states/${b}/animations/morphs/manifest`).pipe((0,X.T)(S=>[b,S]))}getLargestKeyFromManifest(b){const S=Object.values(b.morphs).map(v=>v.keys[v.keys.length-1]);return Math.max(...S)}findMorphEndTimes(b){const S=new Set;if(b.forEach(v=>{v.renderables.filter(({morphId:D})=>!(0,M.isNil)(D)).forEach(({morphId:D})=>{S.add(D.split("/")[0])})}),0===S.size)return(0,e.of)({});{const v=Array.from(S).map(D=>this.getMorphManifest(D));return(0,O.p)(v).pipe((0,X.T)(D=>D.reduce((ne,[m,ce])=>(ne[m]=this.getLargestKeyFromManifest(ce),ne),{})))}}getTweenEndTimes(){const S={};return this.engineService.engine.story.chapters.forEach(v=>{const{tweens:D}=v;Object.keys(D).forEach(ne=>{const m=Object.values(D[ne].tweens),ce=Math.max(...m.map(x=>x.keys).flat()),I=ne.split("/")[0];ce>(S[I]??0)&&(S[I]=ce)})}),S}getStoryChapters(b,S,v){return S.chapters.map((D,ne)=>this.chapterService.getChapter(b,S,v,D,ne))}getStoryLoadChapters(b){return b.chapters.map(v=>this.getLoadChapter(b,v))}loadChapter(b){var S=this;return(0,c.A)(function*(){const v=S.engineService.engine.story.chapters,D=S.store.selectSnapshot(F.N.getStoryChapters),ne=S.store.selectSnapshot(F.N.getSelectedChapterIndex),m=D.findIndex(I=>I.id===b.chapterId),ce=v[m];return ce.load().then(()=>m===ne?S.animationService.setChapter(b.chapterId):ce.id)})()}addChapterToEngine(b,S){var v=this;return(0,c.A)(function*(){const ne=v.chapterService.processChapterForEngine(b),m=v.engineService.engine.story.createChapter(ne,S);return v.engineService.engine.story.chapters[m].load().then(()=>{v.store.dispatch(new R.yz(b))})})()}removeChapterFromEngine(b){this.engineService.engine.story.chapters.splice(b,1)}moveChapterInEngine(b,S){var v=this;return(0,c.A)(function*(){const D=v.engineService.engine?.story?.activeChapter?.id,ne=v.engineService.engine?.story?.chapters.splice(b,1).pop();if(v.engineService.engine.story.chapters.splice(S,0,ne),ne.id===D)return v.animationService.setChapter(ne.id,!0).then(()=>ne.id)})()}getStoryTranslation(b,S,v){const D=A(b,S,v);return this.http.get(D)}getStoryLang(b,S,v){if("en"===v)return(0,e.of)("en");const D=A(b,S,v);return this.http.head(D).pipe((0,X.T)(()=>!0),(0,U.W)(()=>(0,e.of)(!1)),(0,X.T)(ne=>ne?v:"en"))}getStoryType(b){return b.indexOf("/")>=0?h.c.Module:h.c.Bookmark}translateStory(b,S){const D=b.chapters||[],ne=b.sceneGraph||[],m=S.objects||{},ce=S.chapters||[];return b.displayName=S.displayName||b.displayName,b.description=S.description||b.description,ne.forEach(I=>{(I.objects||[]).forEach(K=>{this.translateObject(K,m)})}),D.forEach((I,x)=>{const K=ce[x];if(K){this.translateMetaInfo(I,K);const k=K.annotations||[];(I.annotations||[]).forEach((me,Ne)=>{const Pe=k[Ne];Pe&&this.translateMetaInfo(me,Pe)});const de=K.hotspots||[];(I.hotspots||[]).forEach((me,Ne)=>{const Pe=de[Ne];Pe&&this.translateMetaInfo(me,Pe)});const ye=K.quizQuestions||[];(I.quizQuestions||[]).forEach((me,Ne)=>{const Pe=ye[Ne];Pe&&this.translateQuizQuestion(me,Pe)});const z=I?.contentBlocks,ae=K?.contentBlocks;Array.isArray(z)&&Array.isArray(ae)&&z.forEach((me,Ne)=>{const Pe=ae[Ne];Pe&&this.translateContentBlock(me,Pe)})}}),b}translateQuizQuestion(b,S){if(S.nextLabel&&(b.nextLabel=S.nextLabel),["questionPrompt","explanation"].forEach(v=>{const ne=S[v]||[];(b[v]||[]).forEach((m,ce)=>{const I=ne[ce];I&&(m.markdown=I.markdown)})}),b.data&&S.data){const D=S.data.options||[];(b.data.options||[]).forEach((ne,m)=>{const ce=D[m];ce&&(b.type===P.Q5.LabelAnatomy?this.translateMetaInfo(ne.label,ce.label):ne.label=ce.label)})}}translateMetaInfo(b,S){const{title:v,description:D}=S;b.hasOwnProperty("displayName")&&(b.displayName=v),b.hasOwnProperty("title")&&(b.title=v),b.hasOwnProperty("description")&&(b.description=D)}translateObject(b,S){const D=S[b.objectId];D&&(b.displayName=D);const ne=b.objects;ne&&ne.forEach(m=>{this.translateObject(m,S)})}translateContentBlock(b,S){(0,M.merge)(b,S)}exportWrittenContent(b,S,v){const D=[];return D.push(`\n${b.displayName}\n    `),S.forEach((ne,m)=>{D.push(`\n---\n\n# Chapter ${m+1}: ${ne.displayName||"-No Title-"}\n\n${ne.description||"-No Description-"}\n      `),ne.legend.length&&(D.push("\n## Legend\n"),ne.legend.forEach(I=>{D.push(`\n* ${I.label} (${B.T.rgbToHex(I.colors,!0)})\n`)}));const ce=v.filter(I=>I.chapterId===ne.id);ce.length&&(D.push("\n## Labels\n"),ce.forEach(I=>{D.push(`\n* ${I.title}\n`),I.description&&D.push(`\n  > ${I.description}\n`)}))}),D.join("")}exportQuizKey(b){const S=[];return b.forEach((v,D)=>{switch(S.push(`\n# QUESTION ${D+1} (${P.of[v.type]})\n\n## PROMPT\n${this.contentBlocksService.extractContentBlockText(v.questionPrompt)}\n      `),v.type){case P.Q5.MultipleChoice:v.data.options.forEach((ne,m)=>{S.push(`\n## ANSWER ${m+1} ${v.data.correctAnswer===ne.value?"- CORRECT":""}\n${ne.label}\n            `)});break;case P.Q5.SelectAnatomy:S.push("\n## ANSWERS\n          "),v.data.correctAnswer.forEach((ne,m)=>{S.push(`\n${ne}\n            `)});break;case P.Q5.LabelAnatomy:v.data.options.forEach((ne,m)=>{S.push(`\n## ANSWER ${m+1}\n${ne.label.title}\n            `)})}this.contentBlocksService.extractContentBlockText(v.explanation).length&&S.push(`\n  \n## EXPLANATION\n${this.contentBlocksService.extractContentBlockText(v.explanation)}\n        `),S.push("\n\n\n      ")}),S.join("")}normalizeStory(b){return b.chapters.forEach(S=>{S.id||(S.id=(0,N.G)())}),b}}return(Z=Q).\u0275fac=function(b){return new(b||Z)(E.KVO(C.Qq),E.KVO(p.O),E.KVO(W.y),E.KVO(j.j),E.KVO(V.V),E.KVO(w.il))},Z.\u0275prov=E.jDH({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Q})()},63508:(Se,J,_)=>{"use strict";_.d(J,{Mi:()=>l,Uv:()=>O});var c=_(49204);function O($){return!!("lights"in $&&Array.isArray($?.lights.libraries)||"environment"in $&&!(0,c.isEmpty)($?.environment))}function l($){return"lightLibraryId"in $}},75069:(Se,J,_)=>{"use strict";var c,e;_.d(J,{a:()=>c}),(e=c||(c={})).Reset=(()=>{class h{constructor(){}}return h.type="[Undo] Reset",h})(),e.Undo=(()=>{class h{constructor(B){this.chapterId=B}}return h.type="[Undo] Undo",h})(),e.UndoAll=(()=>{class h{constructor(B){this.chapterId=B}}return h.type="[Undo] Undo All",h})(),e.Redo=(()=>{class h{constructor(B){this.chapterId=B}}return h.type="[Undo] Redo",h})(),e.SavePatches=(()=>{class h{constructor(B){this.patches=B}}return h.type="[Undo] Store Patches",h})()},79083:(Se,J,_)=>{"use strict";_.d(J,{H:()=>c});var c=function(e){return e.BioDigital="biodigital",e.Wikipedia="wikipedia",e.NCIT="ncit",e}(c||{})},63745:(Se,J,_)=>{"use strict";_.d(J,{N9:()=>R,lm:()=>$,mF:()=>X,u2:()=>U});var c=_(11789);const l=["ui-bd.class","ui-play-pause","ui-camera-mode","ui-center","ui-cross-section","ui-dissect","ui-fs","ui-tools-display","ui-tree","ui-zoom","ui-zoom-in","ui-zoom-out","ui-pan","ui-share","ui-keys","ui-slider","o","background.color-stops","background.gradient-type","dd","dn","image-display","imageDisplay","imageSrc","pre","referrer"];function X(N){const{id:M,s:u,m:g,be:E,b:C}=N;let A="";if(M)A=M;else if(E)A=E;else if(C){const Y=parseInt(C,10);A=Number.isNaN(Y)?"":function j(N){const u=(A,Y)=>[Math.floor(A/Y),A%Y],g=[];let C,E=N;for(;E>0;)[E,C]=u(E,62),g.unshift("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[C]);return g.join("")}(Y)}else g&&(A=function h(N,M="male"){return N.includes("/")?N:`production/${M}Adult/${N}`}(g,"female"===u?"female":"male"));return U(A)}function U(N){return N.replace(/\.json$/,"")}function $(N){return X(N).includes("/")?"module":"bookmark"}const W={type:N=>$(N),id:N=>X(N),background:N=>N.bgstd||N["background.colors"]||N.background};function V(N){if(3===N.length){const{0:M,1:u,2:g}=N;return{x:M,y:u,z:g}}return null}const w={camera:function P(N){const M=N.split(",").map(g=>parseFloat(g));if(M.length%3!=0||M.some(g=>Number.isNaN(g)))return null;{const g=M.slice(0,3),E=M.slice(3,6),C=M.slice(6,9);return{eye:V(g),look:V(E),up:V(C)}}},background:function p(N){const M=c.T.getColors(N);return M?{colors:[...M[0][255],...M[1][255]],gradientType:"radial",colorStops:[0,100]}:null}};function F(N){const M=u=>{if(u){const g=u.toLowerCase();if("true"===g)return!0;if("false"===g)return!1;if(!isNaN(Number(g)))return Number(g)}return u};return Object.keys(N).reduce((u,g)=>{const C=(w[g]||M)(N[g]);return"load-rotate"===g&&isNaN(Number(C))||(u[g]=C),u},{})}function R(N){const M=function B(N){const M=Object.keys(N),u=M.filter(g=>l.includes(g));if(u.length>0){const g=[`The following URL parameters have been deprecated: "${u.join('", "')}"`,"Please contact support@biodigital.com for more information."];console.warn(g.join("\n"))}return M.reduce((g,E)=>(l.includes(E)&&delete g[E],g),N)}(N),u=function H(N){return Object.keys(W).filter(M=>typeof N[M]>"u").reduce((M,u)=>{const E=(0,W[u])(N);return typeof E<"u"&&(M[u]=E),M},N)}(M);return F(u)}},24418:(Se,J,_)=>{"use strict";_.d(J,{c:()=>X});var c=_(27180),e=_(17766),O=_(12215),l=_(92811);const X={production:!0,assetDomain:"assets-human.biodigital.com",supportEmail:"support@biodigital.com",googleAuthKey:"66261904577-061oin26uo7sor0vrqc8dnn105irq82n.apps.googleusercontent.com",googleAnalyticsId:"UA-1141985-29",linkedinId:"2641938",pendoId:"3a783681-e53b-4ebd-69c0-788bbae48f13",rollbarToken:"eccc0d971b014ed6abaf2d3172d2c709",hubspotId:"23868815",recaptchaV3Key:"6LdvZvcUAAAAAM0Z1St9WQXwvSYd__hMUY2WZ6um",recaptchaV2Key:"6LdtyhsUAAAAAF-hCYS1co8ZhnAEnzHlNhRMHSxE",application:c.c.Viewer,deploy:O.Z.Production,platform:l.N.SDK,exportType:e.c.Bookmark,offline:!1,native:!0,minPasswordLength:8}},27180:(Se,J,_)=>{"use strict";_.d(J,{c:()=>c});var c=function(e){return e.Loft="Loft",e.Studio="Studio",e.Viewer="Viewer",e.All="",e}(c||{})},12215:(Se,J,_)=>{"use strict";_.d(J,{Z:()=>c});var c=function(e){return e.Local="Local",e.QA="QA",e.Staging="Staging",e.Production="Production",e}(c||{})},92811:(Se,J,_)=>{"use strict";_.d(J,{N:()=>c});var c=function(e){return e.Web="web",e.SDK="sdk",e}(c||{})},90699:(Se,J,_)=>{"use strict";_.d(J,{I:()=>c});var c=function(e){return e.All="all",e.iOS="ios",e.Android="android",e}(c||{})},287:(Se,J,_)=>{"use strict";_.d(J,{AY:()=>W,FV:()=>h,Nq:()=>V,dU:()=>$,kK:()=>P,sO:()=>j});var c=_(44867),e=_(56343);const U={trueWins:p=>({result:p.votesFor.length>0,dissenters:[...p.votesAgainst]}),falseWins:p=>({result:p.votesAgainst.length>0,dissenters:[...p.votesFor]}),majorityWins:p=>{const w=p.votesFor.length>p.votesAgainst.length;return{result:w,dissenters:w?[...p.votesAgainst]:[...p.votesFor]}}};function $(p,w){return p.reduce((F,R)=>(F[R]=w[R]||!1,F),{})}function j(p,w){return Object.keys(p).reduce((R,N)=>(R[N]=$(w,p[N]),R),{})}function h(p,w){const R=p.map(M=>(0,c.dV)(w,M).depth);return Math.max(0,...R)-1}function W(p,w,F){return(0,c.y$)(p,w).filter(N=>N&&(0,c.dV)(p,N).depth===F)}function V(p,w,F){return Object.keys(w).reduce((N,M)=>{const u=w[M],g=F[M]||e.t.MajorityWins,{result:E,dissenters:C}=U[g](u);return N[M]={id:p,result:E,dissenters:C,voters:[...u.votesFor,...u.votesAgainst]},N},{})}function P(p,w,F,R){const N=Object.keys(R);return{results:F.reduce((u,g)=>{const E=(0,c.IA)(p,g),C=E.map(Z=>({[Z]:w[Z]||$(N,(0,c._D)(p,Z,N))}));E.forEach(Z=>{delete w[Z]});const Y=V(g,function B(p,w){return p.reduce((F,R)=>{const N=function H(p,w){return p.reduce((F,R)=>{const N=Object.keys(R)[0];return R[N][w]?F.votesFor.push(N):F.votesAgainst.push(N),F},{votesFor:[],votesAgainst:[]})}(w,R);return F[R]=N,F},{})}(N,C),R);return w[g]=Object.entries(Y).reduce((Z,[Q,y])=>(Z[Q]=y.result,Z),{}),u.push(Y),u},[]),remainingVoters:w}}},44867:(Se,J,_)=>{"use strict";_.d(J,{DS:()=>U,IA:()=>B,If:()=>E,K$:()=>C,KJ:()=>b,Nk:()=>y,Sg:()=>l,TJ:()=>M,Wy:()=>R,_D:()=>H,bd:()=>Y,dV:()=>j,fm:()=>N,ir:()=>h,iu:()=>$,jX:()=>P,u7:()=>Z,ug:()=>p,vU:()=>A,xe:()=>V,y$:()=>W});var c=_(23881),e=_(49204);function l(S,v){$(S,v);const D=j(S,v.id);S.roots[D.id]=D}function U(S,v,D=!1,ne="ascending"){const m=D?[v]:[];let ce=S.predecessors[v];for(;ce;)m.push(ce),ce=S.predecessors[ce];return"descending"===ne&&m.reverse(),m}function $(S,v){S.nodes[v.id]||(S.nodes[v.id]=v)}function j(S,v){return S.nodes[v]??null}function h(S,v){return S.predecessors[v]??null}function W(S,v){const D=new Set;return v.forEach(ne=>{const m=h(S,ne);m&&D.add(m)}),Array.from(D)}function B(S,v){return[...S.successors[v]||[]]}function H(S,v,D){const ne={},m=j(S,v);return Object.entries(m.boolState).forEach(([ce,I])=>{D&&D.includes(ce)&&(ne[ce]=I)}),Object.entries(m.numState).forEach(([ce,I])=>{D&&D.includes(ce)&&(ne[ce]=I)}),ne}function V(S,v){return!!S.nodes[v]&&void 0===S.successors[v]}function P(S,v){return S.roots.hasOwnProperty(v)||!1}function p(S){return Object.keys(S.roots)}function F(S,v,D,ne,m){const ce=(0,c.vm)(D.objectId);ce.depth=m,function w(S,v,D){Object.entries(D).forEach(([ne,m])=>{const ce=m(v.objectId);"boolean"==typeof ce?S.boolState[ne]=ce:"number"==typeof ce?S.numState[ne]=ce:S[ne]=ce})}(ce,D,ne),S.nodes[ce.id]=ce,v?(S.successors[v]=[...S.successors[v]||[],ce.id],S.predecessors[ce.id]=v):S.roots[ce.id]=ce,m+=1,D.children.forEach(x=>{F(S,ce.id,x,ne,m)})}function R(S,v,D){D?(v(D),B(S,D).forEach(ne=>{(0,e.isNil)(ne)||R(S,v,ne)})):p(S).forEach(ne=>{v(ne),R(S,v,ne)})}function N(S,v){const ne=(0,c.q3)();return S.forEach(m=>{F(ne,null,m,v,0)}),ne}function M(S,v,D){const ne=[];for(const m of S){const ce=v[m.objectId],I=void 0===ce?D:ce,x=M(m.children||[],v,I);if(I){const K={...m};K.children=x,ne.push(K)}else x.forEach(K=>ne.push(K))}return ne}function u(S,v,D,ne){const m=v?.[S];if("boolean"==typeof m)return m;{const ce=D(S);return ce?.length>0?u(ce,v,D,ne):ne}}function g(S,v,D,ne){const m=D(S);return 0===m.length?ne:m.some(I=>!0===v?.[I])||m.some(I=>g(I,v,D,ne))}function E(S,v,D,ne){const m=g(S,v,ne,void 0);return!(!1===u(S,v,D,void 0)&&(!1===m||void 0===m))}function C(S,v,D){return S.reduce((ne,m)=>(ne[m]=ne[m]??!1,ne),{...v,...D})}function A(S,v=!0){const{roots:D,successors:ne,predecessors:m,nodes:ce}=S,I=(0,c.q3)();for(const x in ce){const K=ce[x];if(K.boolState.available===v){I.nodes[x]=K;const k=m[x];k&&(I.predecessors[x]=k);const le=ne[x];le&&(I.successors[x]=le);const de=D[x];de&&(I.roots[x]=de)}}return I}function Y(S){const v={};for(const D in S){const ne=S[D];ne.available&&(v[D]=ne)}return v}function Z(S,v){const D=v?.titlesToLatin??{};return Object.values(S.nodes).forEach(ne=>{const m=function Q(S,v){const{id:D,label:ne}=v,m=S[ne];if(m)return m;const I=S[b(D)];return I||void 0}(D,ne);m&&(ne.latinLabel=m)}),S}function y(S){const v=new RegExp(/\|:/,"gi");return S.replace(v,"_")}function b(S){const v=S.split("-");return 2===v.length?v[1]:v[0]}},78109:(Se,J,_)=>{"use strict";_.d(J,{w:()=>X});var c=_(287),e=_(44867);class O{}var l=_(54438);let X=(()=>{var U;class ${serializeNode(h,W,B={},H=(V=>!0)){const V={};return V.id=W.id,Object.entries(W.boolState).forEach(([P,p])=>{B.hasOwnProperty(P)&&(V[P]=p)}),Object.entries(W.numState).forEach(([P,p])=>{B.hasOwnProperty(P)&&(V[P]=p)}),h.successors[W.id]&&(V.children=[],h.successors[W.id].forEach(P=>{H(P)&&V.children.push(this.serializeNode(h,h.nodes[P],B,H))},this)),V}getAllSiblingsFromList(h,W,B){const H=[];let V;for(V=0;V<W.length;V++)this.getSiblings(h,W[V],B).forEach(P=>{H.includes(P)||H.push(P)});return H}getElectionResults(h,W,B,H){class V extends O{constructor(N,M){super(),Object.entries(N).forEach(([u,g])=>{this[u]={votesFor:[],votesAgainst:[]},Object.entries(M).forEach(([E,C])=>{C[u]?this[u].votesFor.push(E):this[u].votesAgainst.push(E)},this)},this)}}let P,p;const w=Object.keys(H),F=[];return B.forEach(R=>{p={},(0,e.IA)(h,R).forEach(u=>{p[u]=W[u]||(0,c.dU)(w,(0,e._D)(h,u,w)),delete W[u]},this),P=new V(H,p);const N=(0,c.Nq)(R,P,H);F.push(N);const M={};Object.entries(N).forEach(([u,g])=>{M[u]=g.result}),W[R]=M},this),F}updateGraphStateRecord(h,W,B,H,V=!0){B.forEach(P=>{const p=P[H[0]].id,w=(0,e._D)(h,p,H),F={};let R=!1;H.forEach(N=>{(V||P[N].result!==w[N])&&(F[N]=P[N].result,R=!0)}),R&&(W[p]=F)},this)}nodeExists(h,W){return!!h.nodes[W]}getLeaves(h){const W=[];return Object.entries(h.nodes).forEach(([B,H])=>{h.successors[B]||W.push(B)}),W}getDescendants(h,W,B=!1){const H=[];return function P(p){(0,e.IA)(h,p).forEach(w=>{H.push(w),P(w)})}(W),B&&H.push(W),H}getLeafDescendants(h,W,B=!1){const H=this.getDescendants(h,W,B).filter(V=>(0,e.xe)(h,V));return((0,e.xe)(h,W)||B)&&H.push(W),H}getAllLeafDescendants(h,W){const B=[];W.forEach(V=>{(0,e.xe)(h,V)?B.push(V):B.push(...this.getLeafDescendants(h,V,!1))});const H=new Set(B.sort());return Array.from(H)}getInverseSelection(h,W){const B=this.getAllLeafDescendants(h,W);return this.getLeaves(h).filter(H=>B.indexOf(H)<0)}getSiblings(h,W,B=!1){const H=h.predecessors[W];let V=[];if(V=H?(0,e.IA)(h,H):(0,e.ug)(h),!B){const P=V.indexOf(W);P>=0&&V.splice(P,1)}return V}getNodes(h,W){const B=[];return W.forEach(H=>{h.nodes[H]&&B.push(h.nodes[H])}),B}setState(h,W,B){const H=(0,e.dV)(h,W),V={};return Object.entries(B).forEach(([P,p])=>{"boolean"==typeof p&&H.boolState[P]!==p?(H.boolState[P]=p,V[P]=p):"number"==typeof p&&H.numState[P]!==p&&(H.numState[P]=p,V[P]=p)}),V}synchronize(h,W,B){const H=this.calculateGraphStateMap(h,W,B);return Object.entries(H).forEach(([V,P])=>{this.setState(h,V,P)},this),H}calculateGraphStateMap(h,W,B,H=!B){let V=[];const P={};let p=[];const w={},F=Object.keys(W);let R=0;for(B?Object.entries(B).forEach(([N,M])=>{P[N]=(0,c.dU)(F,B[N]),w[N]={...P[N]},R=Math.max(R,(0,e.dV)(h,N).depth)},this):this.getLeaves(h).forEach(N=>{P[N]=(0,c.dU)(F,(0,e.dV)(h,N).boolState),w[N]={...P[N]},R=Math.max(R,(0,e.dV)(h,N).depth)},this),R-=1,V=(0,c.AY)(h,Object.keys(P),R);R>=0;)p=this.getElectionResults(h,P,V,W),this.updateGraphStateRecord(h,w,p,F,H),R-=1,V=(0,c.AY)(h,Object.keys(P),R);return w}filterGraphAccessors(h,W){const H=this.getNodes(h,W).sort((p,w)=>p.depth-w.depth),V=new Map;return H.filter(p=>!V.has(p.id)&&(this.getDescendants(h,p.id,!0).forEach(w=>V.set(w,!0)),!0)).map(p=>p.id)}resetDepth(h){(0,e.Wy)(h,B=>{let H=0;h.predecessors[B]&&(H=(0,e.dV)(h,h.predecessors[B]).depth+1),(0,e.dV)(h,B).depth=H})}deleteNode(h,W,B=!0){if(!this.nodeExists(h,W))return;delete h.nodes[W];const H=h.predecessors[W];H&&(delete h.predecessors[W],h.successors[H]&&(h.successors[H]=h.successors[H].filter(P=>P!==W)));const V=h.successors[W];V&&(delete h.successors[W],B&&V.forEach(P=>{this.deleteNode(h,P)},this)),h.roots[W]&&delete h.roots[W]}resetAsLeaf(h,W){let B=[];return h.nodes[W]&&!(0,e.xe)(h,W)&&(B=this.getDescendants(h,W),delete h.successors[W],B.forEach(H=>{delete h.nodes[H],delete h.successors[H],delete h.predecessors[H]})),B}}return(U=$).\u0275fac=function(h){return new(h||U)},U.\u0275prov=l.jDH({token:U,factory:U.\u0275fac,providedIn:"root"}),$})()},56343:(Se,J,_)=>{"use strict";_.d(J,{t:()=>c});var c=function(e){return e.MajorityWins="majorityWins",e.TrueWins="trueWins",e.FalseWins="falseWins",e}(c||{})},23881:(Se,J,_)=>{"use strict";function c(U){return{id:U,depth:0,boolState:{},numState:{}}}function e(){return{nodes:{},successors:{},predecessors:{},roots:{}}}_.d(J,{YR:()=>l,ow:()=>X,q3:()=>e,vm:()=>c});class l{}function X(U=[]){return{available:()=>!0,shown:()=>!1,selected:()=>!1,pickable:()=>!0,renderable:()=>!1,expanded:()=>!1,...U.reduce(($,j)=>($[j]=()=>!1,$),{})}}},66323:(Se,J,_)=>{"use strict";var c=_(345),e=_(54438),O=_(728),l=_(65763);class U{}let $=(()=>{class t{constructor(i,s,r){this.hostingURL=i,this.embedded=s,this.widgetConfig=r}}return t.type="[Widget] Setup Widget",t})(),j=(()=>{class t{}return t.type="[Widget] Reset",t})(),h=(()=>{class t{constructor(i){this.enabled=i}}return t.type="[Widget] Set Input Enabled",t})(),W=(()=>{class t{constructor(i){this.config=i}}return t.type="[Widget] Set API Config",t})(),B=(()=>{class t{constructor(i){this.productAccountId=i}}return t.type="[Widget] Get Widget Product Settings",t})(),H=(()=>{class t{constructor(i){this.widgetSettings=i}}return t.type="[Widget] Set Widget Product Settings",t})();var V=function(n){return n[n.User=0]="User",n[n.Developer=1]="Developer",n}(V||{}),P=function(n){return n.Widget="widget",n.WidgetAPI="widgetapi",n}(P||{}),p=_(40470),w=_(21626);let F=(()=>{var n;class t{constructor(i){this.http=i}getWidgetSettings(i){return this.http.get(`/ws/product/account/settings?product_acctid=${i}`)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();class R{}class M{}var E,u=_(72849),g=_(26655),C=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},A=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const Y={userType:V.User,authenticating:!1,authenticated:!1,widgetUrlConfig:{id:"",type:""},widgetApiConfig:null,parentUrl:{full:"",domain:""},embedded:!1,engineVersion:"",engineAPIVersion:"",inputEnabled:!0,widgetSettings:void 0};let Z=((E=class{static getWidgetState(t){return t}static getUserType(t){return t.userType}static getWidgetAuthenticating(t){return t.authenticating}static getWidgetAuthenticated(t){return t.authenticated}static getInputEnabled(t){return t.inputEnabled}static getEmbedded(t){return t.embedded}static getBypassAnalytics(t){return t.widgetUrlConfig["bypass-analytics"]}static getParentURL(t){return t.parentUrl.full}static getWidgetUrlConfig(t){return t.widgetUrlConfig}static getWidgetApiUIConfig(t){return t.widgetApiConfig}static getWidgetSettings(t){return t.widgetSettings}setupWidget(t,{hostingURL:o,embedded:i,widgetConfig:s}){const r=o.match(/:\/\/(.[^/]+)/);t.patchState({userType:s.uaid?V.User:V.Developer,embedded:i,widgetUrlConfig:s,parentUrl:{full:o,domain:r&&r[1]?r[1]:o}})}getWidgetProductSettings(t,{productAccountId:o}){this.widgetConfigService.getWidgetSettings(o).subscribe(({settings:i})=>{t.dispatch(new H(i))})}setWidgetProductSettings(t,{widgetSettings:o}){t.patchState({widgetSettings:o})}resetWidget(t){t.setState(Y)}buildAppActivityData(t){const{engineVersion:o,engineAPIVersion:i,widgetUrlConfig:s}=t,r={engine_version:o,api_version:i};return Object.entries(s).filter(([a])=>"dk"!==a).forEach(([a,d])=>{r[`url_param_${a}`]=d}),(0,p.bj)(R,r)}setInputEnabled(t,o){t.patchState({inputEnabled:o.enabled})}setWidgetApiConfig(t,o){t.patchState({widgetApiConfig:o.config})}buildUserAnalytic(t,o,i){const{widgetUrlConfig:s,parentUrl:r}=t,a=s.uaid,d=r.domain,f={...this.buildAppActivityData(t),parent_analytic_identifier:a,referer_domain:d,[`${o}_source`]:i};return(0,p.bj)(M,{analytic_platform:P.Widget,analytic_type:o,analytic_data:f})}ngxsOnInit(t){t.patchState({engineVersion:g.A,engineAPIVersion:g.m})}constructor(t,o){this.widgetConfigService=t,this.engineService=o}}).\u0275fac=function(t){return new(t||E)(e.KVO(F),e.KVO(u.y))},E.\u0275prov=e.jDH({token:E,factory:E.\u0275fac}),E);C([(0,l.rc)($),A("design:type",Function),A("design:paramtypes",[Object,$]),A("design:returntype",void 0)],Z.prototype,"setupWidget",null),C([(0,l.rc)(B),A("design:type",Function),A("design:paramtypes",[Object,B]),A("design:returntype",void 0)],Z.prototype,"getWidgetProductSettings",null),C([(0,l.rc)(H),A("design:type",Function),A("design:paramtypes",[Object,H]),A("design:returntype",void 0)],Z.prototype,"setWidgetProductSettings",null),C([(0,l.rc)(j),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],Z.prototype,"resetWidget",null),C([(0,l.rc)(h),A("design:type",Function),A("design:paramtypes",[Object,h]),A("design:returntype",void 0)],Z.prototype,"setInputEnabled",null),C([(0,l.rc)(W),A("design:type",Function),A("design:paramtypes",[Object,W]),A("design:returntype",void 0)],Z.prototype,"setWidgetApiConfig",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getWidgetState",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getUserType",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getWidgetAuthenticating",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getWidgetAuthenticated",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getInputEnabled",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getEmbedded",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getBypassAnalytics",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getParentURL",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getWidgetUrlConfig",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",void 0)],Z,"getWidgetApiUIConfig",null),C([(0,l.MD)(),A("design:type",Function),A("design:paramtypes",[U]),A("design:returntype",Array)],Z,"getWidgetSettings",null),Z=C([(0,l.Uw)({name:"widget",defaults:Y}),A("design:paramtypes",[F,u.y])],Z);var D,n,Q=_(85052),y=_(2573),b=_(37925),S=_(14264),v=function(n){return n[n.Basics=0]="Basics",n[n.All=1]="All",n[n.Shortcuts=2]="Shortcuts",n}(v||{});(n=D||(D={})).SetAutoplay=(()=>{class be{constructor($e){this.autoplay=$e}}return be.type="[View] Set Autoplay",be})(),n.SetContentMode=(()=>{class be{constructor($e){this.column=$e}}return be.type="[View] Set Content Mode",be})(),n.SetCanHover=(()=>{class be{constructor($e){this.canHover=$e}}return be.type="[View] Set Can Hover",be})(),n.SetCanTouch=(()=>{class be{constructor($e){this.canTouch=$e}}return be.type="[View] Set Can Touch",be})(),n.SetCanFullscreen=(()=>{class be{constructor($e){this.canFullscreen=$e}}return be.type="[View] Set Can Fullscreen",be})(),n.SetInputEnabled=(()=>{class be{constructor($e){this.enabled=$e}}return be.type="[View] Set Input Enabled",be})(),n.SetSearchDisplayMode=(()=>{class be{constructor($e){this.mode=$e}}return be.type="[View] Set Search Display Mode",be})(),n.TogglePresentation=(()=>{class be{constructor($e){this.active=$e}}return be.type="[View] Toggle Presentation",be})(),n.SetInteractType=(()=>{class be{constructor($e){this.interactType=$e}}return be.type="[View] Set Interact Type",be})(),n.SetForceAudio=(()=>{class be{constructor($e){this.forceAudio=$e}}return be.type="[View] Set Force Audio",be})(),n.SetOnDemand=(()=>{class be{constructor($e){this.onDemand=$e}}return be.type="[View] Set On Demand",be})(),n.SetLayout=(()=>{class be{constructor($e){this.layout=$e}}return be.type="[View] Set Layout",be})(),n.ToggleHelpTab=(()=>{class be{constructor($e=v.Basics){this.tab=$e}}return be.type="[View] Toggle Help Tab",be})(),n.SetInputMode=(()=>{class be{constructor($e){this.inputMode=$e}}return be.type="[View] Set Input Mode",be})(),n.SetTutorial=(()=>{class be{constructor($e){this.tutorial=$e}}return be.type="[View] Set Tutorial",be})(),n.SetIsMobileWeb=(()=>{class be{constructor($e){this.isMobileWeb=$e}}return be.type="[View] Set Is Mobile Web",be})(),n.StartTutorial=(()=>{class be{constructor($e){this.intro=$e}}return be.type="[View] Start Tutorial",be})(),n.TutorialSeen=(()=>{class be{constructor($e){this.seen=$e}}return be.type="[View] Tutorial Seen",be})(),n.TutorialNext=(()=>{class be{constructor(){}}return be.type="[View] Tutorial Next",be})(),n.TutorialPrevious=(()=>{class be{constructor(){}}return be.type="[View] Tutorial Previous",be})(),n.ToggleNodeInfo=(()=>{class be{constructor($e){this.show=$e}}return be.type="[View] Toggle Node Info",be})(),n.TogglePanel=(()=>{class be{constructor($e,nr){this.panel=$e,this.show=nr}}return be.type="[View] Toggle Panel",be})(),n.SetViewLanguage=(()=>{class be{constructor($e){this.lang=$e}}return be.type="[View] Set View Language",be})(),n.SetNodeInfoConfig=(()=>{class be{constructor($e){this.fallback=$e}}return be.type="[View] Set Node Info Config",be})(),n.SetMultiPickModeEnabled=(()=>{class be{constructor($e){this.enabled=$e}}return be.type="[View] Set multi pick mode enabled",be})(),n.SetLabelBreakpoint=(()=>{class be{constructor($e){this.labelsBreakpoint=$e}}return be.type="[View] Set Label Breakpoint",be})(),n.SetPlaythrough=(()=>{class be{constructor($e){this.playthrough=$e}}return be.type="[View] Set Playthrough",be})(),n.SetPlaythroughEnabled=(()=>{class be{constructor($e){this.enabled=$e}}return be.type="[View] Set Playthrough Enabled",be})(),n.SetStartingColumn=(()=>{class be{constructor($e){this.column=$e}}return be.type="[View] Set Starting Column",be})(),n.SetPreferredColumn=(()=>{class be{constructor($e){this.column=$e}}return be.type="[View] Set Preferred Column",be})(),n.SetStartingTool=(()=>{class be{constructor($e){this.tool=$e}}return be.type="[View] Set Starting Tool",be})(),n.SetFadeout=(()=>{class be{constructor($e){this.fadeout=$e}}return be.type="[View] Set Fadeout",be})(),n.SetPreventFadeoutEvent=(()=>{class be{constructor($e,nr){this.event=$e,this.value=nr}}return be.type="[View] Set Prevent Fadeout Event",be})(),n.SetUsePrintImage=(()=>{class be{constructor($e){this.usePrintImage=$e}}return be.type="[View] Set Use Print Image",be})(),n.SetWindows=(()=>{class be{constructor($e){this.windows=$e}}return be.type="[View] Set Windows",be})(),n.OpenWindow=(()=>{class be{constructor($e){this.window=$e}}return be.type="[View] Open Window",be})(),n.CloseWindow=(()=>{class be{constructor($e){this.window=$e}}return be.type="[View] Close Window",be})(),n.ToggleWindow=(()=>{class be{constructor($e,nr){this.window=$e,this.show=nr}}return be.type="[View] Toggle Window",be})(),n.ToggleMenu=(()=>{class be{constructor($e){this.open=$e}}return be.type="[View] Toggle Menu",be})(),n.SetWhiteboardEnabled=(()=>{class be{constructor($e){this.enabled=$e}}return be.type="[View] Whiteboard Enabled",be})(),n.SetWhiteboardLocked=(()=>{class be{constructor($e){this.locked=$e}}return be.type="[View] Whiteboard locked",be})(),n.SetWhiteboardBrushSize=(()=>{class be{constructor($e){this.brushSize=$e}}return be.type="[View] Whiteboard Brush Size",be})(),n.SetWhiteboardBrushColor=(()=>{class be{constructor($e){this.brushColor=$e}}return be.type="[View] Whiteboard Brush Color",be})(),n.SetWhiteboardTextSize=(()=>{class be{constructor($e){this.size=$e}}return be.type="[View] Whiteboard Text Size",be})(),n.SetWhiteboardEraserSize=(()=>{class be{constructor($e){this.eraserSize=$e}}return be.type="[View] Whiteboard Eraser Size",be})(),n.SetWhiteboardAnnotateMode=(()=>{class be{constructor($e){this.mode=$e}}return be.type="[View] Whiteboard Annotate Mode",be})(),n.SetWhiteboardHasPaint=(()=>{class be{constructor($e){this.hasPaint=$e}}return be.type="[View] Whiteboard Has Paint",be})(),n.SetWhiteboardHasText=(()=>{class be{constructor($e){this.hasText=$e}}return be.type="[View] Whiteboard Has Text",be})(),n.ShowScrim=(()=>{class be{constructor($e,nr){this.showSpinner=$e,this.label=nr}}return be.type="[View] Show Scrim",be})(),n.HideScrim=(()=>{class be{constructor(){}}return be.type="[View] Hide Scrim",be})(),n.SetChapterCallToActionSeen=(()=>{class be{constructor($e){this.chapterCallToActionSeen=$e}}return be.type="[View] Set Chapter Call To Action Seen",be})(),n.ResetViewState=(()=>{class be{constructor(){}}return be.type="[View] Reset View State",be})(),n.SetFocusedElement=(()=>{class be{constructor($e){this.focusedElement=$e}}return be.type="[View] Set Focused Element",be})();var ne=_(38645),m=_(49204),ce=_(87145),I=_(24418);function x(n,t=!1){return(t?function ie(n){return n.filter(t=>Object.values(t).some(o=>!(0,m.isNil)(o.value)&&""!==o.value))}(n):n).reduce((i,s)=>({...i,...s}),{})}class k{}var le=_(36110),de=_(16938);class oe{}var ye=_(17766);class me{constructor(){this.type=ye.c.Bookmark,this.favorite=!1,this.unavailable=!1}}!function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,de.Z)(()=>oe),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],me.prototype,"group_access",void 0);var Ne=function(n){return n.All="",n.Quiz="mode-quiz",n.Content="mode-content",n}(Ne||{});function Pe(n){const{id:t,type:o}=n;if("module"===o&&(n.id=function Qe(n){return n.replace("Condition.content.","").replace(".json","").split(".").join("/")}(t)),n.tour=n.tags.includes("tour"),n.animated=n.tags.includes("animated"),n.quiz=n.tags.includes("quiz"),n.lowDefinition=n.tags.includes("low definition"),!n.viewMode){const i=Object.values(Ne).find(s=>n.tags.includes(s));n.viewMode=i??Ne.All}return n}var St=function(n){return n.IdAsc="+collection_id",n.IdDesc="-collection_id",n.NameAsc="+collection_name",n.NameDesc="-collection_name",n.UpdateDateAsc="+collection_updatedate",n.UpdateDateDesc="-collection_updatedate",n.CreateDateAsc="+collection_createdate",n.CreateDateDesc="-collection_createdate",n.CustomAsc="+custom_sort_order",n.CustomDesc="-custom_sort_order",n}(St||{});function De(n){return"?"+Object.entries(n).filter(([t,o])=>!(0,m.isNil)(o)).map(([t,o])=>`${t}=${encodeURIComponent(o)}`).join("&")}var lt=_(36860),tt=function(n){return n.Web="web",n.Android="mobile_android",n.iOS="mobile_ios",n}(tt||{});let je=(()=>{var n;class t{constructor(i){this.platform=i}get productKey(){return I.c.productKey}get productType(){if(I.c.native){if(this.platform.ANDROID)return tt.Android;if(this.platform.IOS)return tt.iOS}return tt.Web}get productHeader(){return{"Bd-Product-Ua":`BD/Product/${this.productType}/${this.productKey}`}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(lt.OD))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();const Ae="/ws/organization/collection",ge="/ws/organization/join/domains";let he=(()=>{var n;class t{constructor(i,s){this.http=i,this.productService=s}createOrganization(i){return this.http.post("/ws/organization/create",i)}updateOrganization(i){return this.http.post("/ws/organization/update",i)}deleteOrganization(i){return this.http.request("delete","/ws/organization/delete",{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i}})}getCollections(i){i.sort_order||(i.sort_order=[St.CustomAsc,St.NameDesc]);const s=De(i);return this.http.get(`${Ae}${s}`).pipe((0,le.T)(r=>(0,p.bj)(k,r).map(a=>this.normalizeCollectionModel(a))))}getCollectionContent(i,s,r="",a="en"){const d=r.toLocaleLowerCase().split(" ");return this.getCollections({group_id:i,collection_id:s,include_content:1,ol:a}).pipe((0,le.T)(f=>f[0].collection_content.map(L=>(0,p.bj)(me,L)).filter(L=>{let ee=!0;return d.length&&L.title&&d.forEach(re=>{ee=ee&&L.title.toLocaleLowerCase().indexOf(re)>=0}),ee=ee&&!0!==L.unavailable,ee})))}addCollection(i,s){return this.http.post(Ae,{group_id:i,collection_name:s})}removeCollection(i){return this.http.request("DELETE",Ae,{body:{group_id:i.group_id,collection_id:i.collection_id}})}renameCollection(i,s){return this.http.post(Ae,{group_id:i.group_id,collection_id:i.collection_id,collection_name:s})}reorderCollections(i,s){return this.http.post(`${Ae}/sort-order`,{group_id:i,collection_id_sort_list:s.map(r=>r.collection_id)})}updateCollectionContent(i,s,r){return this.http.post(`${Ae}/content`,{group_id:i,add_content:s,remove_content:r})}getOrganizationAttribute(i,s,r){return i.find(a=>a.type===s&&a.name===r)}getPublicProfile(i){return this.http.get("/ws/organization/public/profile",{params:{...i}}).pipe((0,le.T)(s=>s))}normalizeCollectionModel(i){return i.collection_content&&i.collection_content.forEach(s=>{Pe(s)}),i}isNewJoinDomain(i){return(0,m.isNil)(i.join_domain_id)}checkJoinDomains(i){return this.http.post("/ws/organization/join/domain/check",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:i}).pipe((0,le.T)(r=>{const a=r.email_domains_checked;return i.map(d=>a[d].is_blacklisted)}))}getJoinDomains(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new w.Nl({fromObject:{...s}});return this.http.get(ge,{params:r})}postJoinDomains(i){return this.http.post(ge,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:i})}deleteJoinDomains(i){return this.http.request("delete",ge,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_domain_ids:i}})}generateGroupCode(i){return this.http.post("/ws/organization/generate/groupcode",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(je))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})(),qe=(()=>{var n;class t{constructor(i,s,r,a){this.config=i,this.router=s,this.route=r,this.organizationsService=a,this.appended=!1,this.initialized=!1,this.sessionEvents={},this.pageEvents={},this.queuedEvents=[],this.initRouteListener()}appendScripts(){!this.config.enabled||this.appended||(this.appendPendo(),this.appendHubspot(),this.appended=!0)}initialize(i,s){this.config.enabled&&(pendo.initialize({visitor:i,account:s}),this.flushQueuedEvents(),this.initialized=!0)}identify(i,s){this.config.enabled&&(pendo.identify({visitor:i,account:s}),this.hubspotIdentify({...i,account:s}))}createVisitorData(i){const s={},r=x(i.account_settings),a=(0,m.get)(i,"organizations[0].user_role.role_display_name",null);if((0,m.has)(i,"id")&&(s.id=this.getPrefixedId(i.id.toString())),(0,m.has)(i,"email")&&(s.email=i.email),(0,m.has)(i,"first_name")&&(0,m.has)(i,"last_name")&&(s.full_name=`${i.first_name} ${i.last_name}`),(0,m.has)(i,"registration_date")&&(s.registration_date=i.registration_date),(0,m.has)(i,"premium_account")&&(s.premium=i.premium_account),(0,m.has)(i,"user_is_developer")&&(s.developer=i.user_is_developer),(0,m.has)(i,"subscription")&&(s.subscriptionType=i.subscription?i.subscription.subscription_type:null),(0,m.has)(i,"is_third_party")&&(s.thirdParty=i.is_third_party),(0,m.has)(r,"account_purpose")&&(s.purpose=r.account_purpose?r.account_purpose.value:null),(0,m.has)(r,"account_role")&&(s.role=r.account_role?r.account_role.value:null),(0,m.has)(r,"account_field")&&(s.field=r.account_field?r.account_field.value:null),(0,m.has)(r,"email_marketing_optin")){const d=(0,m.get)(r,"email_marketing_optin.value",!1);s.emailMarketing=!!d}return a&&(s.teamRole=a),s}createAccountData(i){const s=(0,m.get)(i,"group_attributes",null);return{id:this.getPrefixedId((0,m.get)(i,"id",null)),name:(0,m.get)(i,"name",null),subscriptionType:(0,m.get)(i,"subscription.type",null),subscriptionEndDate:(0,m.get)(i,"subscription.paid_through_date",null),usersCount:(0,m.get)(i,"users_count",null),purpose:this.getGroupAttributeValue(s,"account_purpose"),field:this.getGroupAttributeValue(s,"account_field"),companyWebsite:this.getGroupAttributeValue(s,"account_company_website"),companySize:this.getGroupAttributeValue(s,"account_company_size"),externalAccountProvider:(0,m.get)(i,"external_account.external_account_provider",null)}}updateVisitorData(i){if(!this.config.enabled)return;const s=this.createVisitorData(i);pendo.updateOptions({visitor:s}),this.hubspotIdentify(s,!0)}updateAccountData(i){if(!this.config.enabled)return;const s=this.createAccountData(i);pendo.updateOptions({account:s})}flushQueuedEvents(){this.queuedEvents.forEach(i=>{this.track(i.trackType,i.metadata)})}track(i,s){this.config.enabled&&(this.initialized?pendo.track(i,s):this.queuedEvents.push({trackType:i,metadata:s}))}trackOncePerSession(i,s){this.sessionEvents[i]||this.config.enabled&&(this.track(i,s),this.sessionEvents[i]=!0)}trackOncePerPage(i,s){this.pageEvents[i]||this.config.enabled&&(this.track(i,s),this.pageEvents[i]=!0)}trackSignIn(i){this.trackSignInSignUp("Sign In - Success",i)}trackSignUp(i){this.trackSignInSignUp("Sign Up - Success",i)}trackSignInSignUp(i,s){const r=this.route.snapshot.queryParams;this.track(i,{type:s,referrer:document.referrer,refParam:r.ref||null,groupInvite:(0,m.has)(r,"group_invite"),groupCode:(0,m.has)(r,"group")&&(0,m.has)(r,"code")})}initRouteListener(){this.router.events.pipe((0,S.p)(i=>i instanceof ne.wF),(0,ce.i)(1)).subscribe(i=>{this.pageEvents={},this.hubspotTrackPageView(i.urlAfterRedirects)})}getPrefixedId(i){return i&&`${(0,m.get)(this.config,`idPrefixes[${I.c.deploy}]`,"")}${i}`}getGroupAttributeValue(i,s){if(!i)return null;const r=this.organizationsService.getOrganizationAttribute(i,"account_settings",s);return r?r.value:null}appendPendo(){const i=`\n      (function(apiKey){\n        (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];\n        v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){\n            o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);\n            y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';\n            z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');\n      })('${this.config.pendoId}');\n    `,s=document.createElement("script");s.textContent=i,document.body.appendChild(s)}appendHubspot(){_hsq=window._hsq=window._hsq||[];const i=`${location.pathname}${location.search}${location.hash}`;_hsq.push(["setPath",i]);const s=document.createElement("script");s.async=!0,s.defer=!0,s.src=`//js.hs-scripts.com/${this.config.hubspotId}.js`,document.body.appendChild(s)}hubspotIdentify(i,s=!1){window._hsq?.push(["identify",i]);const r=s?"Visitor Updated":"Visitor Identified";window._hsq?.push(["trackCustomBehavioralEvent",{name:r}])}hubspotTrackPageView(i){window._hsq?.push(["setPath",i]),window._hsq?.push(["trackPageView"])}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO("vendorAnalyticsConfig"),e.KVO(ne.Ix),e.KVO(ne.nX),e.KVO(he))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();_(26579),_(75067);var Ct=_(28407),bn=_(11040);let Ss=(()=>{class t{constructor(i,s,r=bn.q.lang,a=!1){this.id=i,this.type=s,this.lang=r,this.preview=a}}return t.type="[Story] Load Current Story",t})(),ea=(()=>{class t{constructor(i){this.story=i}}return t.type="[Story] Replace the Story",t})(),ta=(()=>{class t{constructor(i){this.id=i}}return t.type="[Story] Set the Story ID",t})(),na=(()=>{class t{constructor(i){this.displayName=i}}return t.type="[Story] Set Story Text",t})(),ia=(()=>{class t{constructor(i){this.tags=i}}return t.type="[Story] Set Story Tags",t})(),oa=(()=>{class t{constructor(i){this.playthroughSettings=i}}return t.type="[Story] Set Story Playthrough",t})(),sa=(()=>{class t{constructor(i){this.sourceInfo=i}}return t.type="[Story] Set Story Source Info",t})(),ra=(()=>{class t{constructor(i){this.lightLibs=i}}return t.type="[Story] Set Story Light Libs",t})(),ac=(()=>{class t{}return t.type="[Story] Load Manifests",t})(),bs=(()=>{class t{constructor(i,s,r){this.id=i,this.type=s,this.reset=r}}return t.type="[Story] Set Incoming Story Id",t})(),ir=(()=>{class t{constructor(){}}return t.type="[Story] Load Story Chunk",t})(),or=(()=>{class t{constructor(i){this.chapterId=i}}return t.type="[Story] Reorder Load Chunks",t})(),To=(()=>{class t{constructor(i){this.chapter=i}}return t.type="[Story] Load Story Chunk Success",t})(),sr=(()=>{class t{constructor(i,s,r,a,d=!0){this.id=i,this.story=s,this.type=r,this.chapterIdx=a,this.replaceActiveStory=d}}return t.type="[Story] Build Story In Engine From Story Model",t})(),aa=(()=>{class t{constructor(i,s,r){this.story=i,this.id=s,this.type=r}}return t.type="[Story] Build Story Success",t})(),ys=(()=>{class t{constructor(i,s,r,a){this.story=i,this.id=s,this.type=r,this.lang=a}}return t.type="[Story] Load Success",t})(),la=(()=>{class t{constructor(i,s){this.id=i,this.type=s}}return t.type="[Story] Load Fail",t})(),ca=(()=>{class t{constructor(i,s,r=bn.q.lang){this.id=i,this.type=s,this.lang=r}}return t.type="[Story] Import",t})(),rr=(()=>{class t{constructor(i,s,r){this.story=i,this.id=s,this.type=r}}return t.type="[Story] Import Success",t})(),on=(()=>{class t{constructor(){}}return t.type="[Story] Clear",t})(),Iv=(()=>{class t{constructor(){}}return t.type="[Story] Synchronize Chapters",t})(),zg=(()=>{class t{constructor(){}}return t.type="[Story] Human Ready (Web)",t})(),g_=(()=>{class t{constructor(){}}return t.type="[Story] Human Ready (SDK)",t})(),wv=(()=>{class t{constructor(i){this.story=i}}return t.type="[Story] Merge Bridge Module Success",t})();var Xe=_(55494),Ii=_(26657),da=_(16606),fe=_(85586),He=_(93915),vi=_(59429),h_=_(44867);function Rv(n,t){const o=re=>void 0!==re.objectId,[i,s]=(0,m.partition)(n,o),[r,a]=(0,m.partition)(t,o),d=function Av(n,t){return t.reduce((o,i)=>{for(const s of n)(0,m.isEqual)(s,i)||o.push(i);return o},n)}(s,a),{sceneGraph:f,graphsMerged:T,objectIdsUniqueToNew:L,objectIdsUniqueToOriginal:ee}=function Nv(n,t){const o=n.reduce((r,a)=>(r[a.objectId]=a,r),{}),i=t.reduce((r,a)=>{if(void 0===r.nodes[a.objectId])return r.nodes[a.objectId]=a,r;if(!(0,m.isEqual)(a,r.nodes[a.objectId])){const d=function Pv(n,t){const o={},i={};return{root:function s(a,d){if(a.objectId!==d.objectId)return o[d.objectId]=!0,[a,d];if(void 0===a.objects&&d.objects){for(const L of d.objects)o[L.objectId]=!0;return[{...d}]}if(a.objects&&void 0===d.objects){for(const L of a.objects)i[L.objectId]=!0;return[{...a}]}if(void 0===a.objects&&void 0===d.objects)return[{...a}];const f=[];for(const L of a.objects){const ee=d.objects.find(re=>re.objectId===L.objectId);ee?f.push(s(L,ee)):(i[L.objectId]=!0,f.push(L))}for(const L of d.objects)a.objects.find(re=>re.objectId===L.objectId)||(o[L.objectId]=!0,f.push(L));const T={...a};return T.objects=(0,m.flatten)(f),[T]}(n,t),objectIdsUniqueToNew:o,objectIdsUniqueToOriginal:i}}(r.nodes[a.objectId],a);r.nodes[a.objectId]=d.root[0],r.graphsMerged.push(a.objectId),r.objectIdsUniqueToNew[a.objectId]=d.objectIdsUniqueToNew,r.objectIdsUniqueToOriginal[a.objectId]=d.objectIdsUniqueToOriginal}return r},{nodes:o,graphsMerged:[],objectIdsUniqueToNew:{},objectIdsUniqueToOriginal:{}});return{sceneGraph:Object.keys(i.nodes).reduce((r,a)=>(r.push(i.nodes[a]),r),[]),graphsMerged:i.graphsMerged,objectIdsUniqueToNew:i.objectIdsUniqueToNew,objectIdsUniqueToOriginal:i.objectIdsUniqueToOriginal}}(i,r);return{sceneGraph:[...d,...f],graphsMerged:T,objectIdsUniqueToNew:L,objectIdsUniqueToOriginal:ee}}function Wg(n,t,o){const i=function Dv(n,t,o){const i={};for(const s of n){const r=Object.keys(t[s]);for(const a of r)i[a]=o}return i}(t,o,!1);return n.map(s=>({...s,availableObjects:{...s.availableObjects,...i},showObjects:{...s.showObjects,...i},selectObjects:{...s.selectObjects,...i},pickThroughObjects:{...s.pickThroughObjects,...i}}))}function lc(n){return n.split("/").length>1?ye.c.Module:ye.c.Bookmark}var Xg=_(63508);function Hg(n,t){return n.map(o=>{if((0,Xg.Mi)(o)||(0,Xg.Uv)(o)&&!(0,m.isEmpty)(o.lights))return o;const i={libraries:[...t],lights:[]};return{...o,lights:i}})}var Qg=_(86544);function Yg(n){return n.reduce((t,o)=>(t[o.id]=o,t),{})}function Kg(n){return n.reduce((t,o)=>{const i=o.id,s=o.customData?.particleSystems??[];return s.length>0&&(t[i]=function Vv(n){return n.reduce((t,o)=>(t[Qg.R.getParticleIdRoot(o)]=o,t),{})}(s)),t},{})}function Jg(n,t){return n.map(o=>{const i=o.customData?.particleSystems??[];return i.length&&(o.customData.particleSystems=i.map(s=>t[s]?.id??s)),o})}var cc=_(63745),Wn=_(27180);function qg(n){if((0,m.isEmpty)(n))return;const{audit:t,reviewed:o,collaborated:i,references:s}=n,r=s?.filter(d=>d.label.trim().length>0)??[],a={};return r.length>0&&(a.references=r),I.c.application!==Wn.c.Loft||(o?.enabled&&(a.reviewed=o),i?.enabled&&(a.collaborated=i)),t?.enabled&&(a.audit=t),(0,m.isEmpty)(a)?void 0:a}function Gv(n,t,o,i,s=ye.c.Bookmark,r=vi.u.idWithPrefix){const{sceneGraph:a,graphsMerged:d,objectIdsUniqueToNew:f,objectIdsUniqueToOriginal:T}=Rv(n.sceneGraph,o.sceneGraph),L=function jv(n,t){const o=(a,d)=>(0,m.uniq)([...a,...d]);return{lights:o(n.lights,t.lights),tweens:o(n.tweens,t.tweens),reflections:o(n.reflections,t.reflections)}}(n.assetLibraries,o.assetLibraries),ee=function Uv(n,t,o,i){t=t||{};const s=(r,a)=>a.includes("/")?a:`${function Lv(n){return lc(n)===ye.c.Bookmark?n:n.split("/").pop()}(r)}/${a}`;return{...(0,m.mapKeys)(n=n||{},(r,a)=>s(o,a)),...(0,m.mapKeys)(t,(r,a)=>s(i,a))}}(n.reflections,o.reflections,t,i),re=Hg(n.chapters,n.assetLibraries.lights),ve=Hg(o.chapters,o.assetLibraries.lights),Fe=function xv(n,t,o,i,s){const r=n.customData?.particleSystems??[],a=t.customData?.particleSystems??[],d=Yg(r),f=Yg(a);Object.entries(f).forEach(([Oe,Ee])=>{const Re=d[Oe];(0,m.isNil)(Re)||(f[Oe]=(0,m.isEqual)(Re,Ee)?Re:{...(0,m.cloneDeep)(Ee),id:Qg.R.generateParticleId(Oe,s)})});const T=Array.from(new Set([...Object.values(d),...Object.values(f)])),L=Jg(o,d),ee=Jg(i,f),re={...Kg(L),...Kg(ee)};return{mergedParticles:T,currentChapters:L,importedChapters:ee,tweenParticleLookup:(0,m.pickBy)(re,Oe=>!(0,m.isEmpty)(Oe))}}(n,o,Wg(re,d,f),Wg(ve,d,T).map(_n=>{const ft=_n.createdFrom??[];return ft.unshift({id:(0,cc.u2)(i),timestamp:Date.now()}),{..._n,id:r("chapter"),createdFrom:ft}}),r),it=function kv(n,t){const o=n.map(i=>i.objectId);return t.map(i=>{const s=i.showObjects??{},r=i.availableObjects??{};return{...i,availableObjects:(0,h_.K$)(o,s,r)}})}(a,[...Fe.currentChapters,...Fe.importedChapters]),pt={...n.customData,particleSystems:Fe.mergedParticles},Mt="module"===s?n.tags:[],$t=function Fv(n,t){const o=[...n?.references??[],...t?.references??[]];if(o.length>0)return{references:o,audit:{enabled:!0===n?.audit?.enabled&&!0===t?.audit?.enabled}}}(n.sourceInfo,o.sourceInfo);return{...n,assetLibraries:L,chapters:it,sceneGraph:a,customData:pt,tags:Mt,reflections:ee,stateId:(0,m.uniq)([...n.stateId,...o.stateId]),tweenParticleLookup:Fe.tweenParticleLookup,sourceInfo:$t}}var Zi=_(32914);function Zg(n){return function Bv(n){return new y.c(t=>{const o=new Image;o.onload=()=>{const i=function $v(n){const t=document.createElement("canvas"),o=t.getContext("2d");return t.width=n.naturalWidth,t.height=n.naturalHeight,o.drawImage(n,0,0),t}(o);t.next(i),t.complete()},o.onerror=()=>{const i=document.createElement("canvas");t.next(i),t.complete()},o.src=n})}(n).pipe((0,S.p)(t=>!(0,m.isNil)(t)),(0,Zi.n)(t=>new y.c(o=>{t.toBlob(i=>{o.next(i),o.complete()},"image/jpeg",100)})))}var Vo,dc=_(57238);!function(n){function i(a,d){const f=new dc.R;if(a.thumbnails)f.legacy=!1,f.storyId=d,f.chapterId=a.id,f.urls={...a.thumbnails};else{const L=`/thumbs/${ye.c.Bookmark===lc(d)?"bookmarks":"modules"}/${d.replace(".json","")}`;f.legacy=!0,f.storyId=d,f.chapterId=a.id,f.urls={small:`${L}/small/chapters/${a.id}.jpg`,large:`${L}/large/chapters/${a.id}.jpg`}}return f}n.generateLegacyThumbnail=function t(a,d){const L=`/thumbs/${ye.c.Bookmark===lc(a)?"bookmarks":"modules"}/${a.replace(".json","")}`;return{small:`${L}/small/chapters/${d}.jpg`,large:`${L}/large/chapters/${d}.jpg`}},n.generateThumbnails=function o(a){return a.reduce((d,{originalChapterId:f,newChapterId:T,originalStoryId:L})=>{const ee=ye.c.Bookmark===lc(L),re=new dc.R;re.storyId=L,re.chapterId=f;const Oe=`/thumbs/${ee?"bookmarks":"modules"}/${L.replace(".json","")}`;return re.urls={small:`${Oe}/small/chapters/${f}.jpg`,large:`${Oe}/large/chapters/${f}.jpg`},d.set(T,re),d},new Map)},n.getChapterThumbnail=i,n.getChapterThumbnails=function s(a,d){return d.reduce((f,T)=>{const L=i(T,a);return f.set(T.id,L),f},new Map)},n.makeFreshThumbnail=function r(a,d,f){return Zg(f).pipe((0,S.p)(T=>!(0,m.isNil)(T)),(0,le.T)(T=>{const L=new dc.R;return L.snapshot=URL.createObjectURL(T),L.chapterId=d,L.storyId=a,L}))}}(Vo||(Vo={}));var Xn,zv=_(21164),Wv=_(23881),zi=_(12347);!function(n){function t(r,a){const d=Object.entries(a);return d.sort((f,T)=>f[0].length===T[0].length?0:f[0].length<T[0].length?1:-1),d.reduce((f,[T,L])=>{if(f.startsWith(T)){const ee=new RegExp(`^${T}`);f=f.replace(ee,L)}return f},r||"")}n.renamespaceValue=t,n.renamespaceKeys=function o(r,a){return Object.entries(r).reduce((d,[f,T])=>(d[t(f,a)]=T,d),{})},n.renamespaceAssetLibrary=function i(r,a,d){if(!d)return r;const f=r.tweens.map(L=>t(L,a)),T=r.reflections.map(L=>t(L,a));return{...r,tweens:f,reflections:T}},n.renamespaceReflections=function s(r,a,d){return d?(0,m.mapValues)(r,f=>t(f,a)):r}}(Xn||(Xn={}));var xo=_(38157),Xt=function(n){return n.DirectionalVelocity="DirectionalVelocity",n.Lifetime="Lifetime",n.PointPosition="PointPosition",n.RandomVelocity="RandomVelocity",n.SpherePosition="SpherePosition",n.CylinderPosition="CylinderPosition",n.CubePosition="CubePosition",n.RandomRotation="RandomRotation",n.RandomRotationSpeed="RandomRotationSpeed",n.RandomScale="RandomScale",n.SpriteAnimationDuration="SpriteAnimationDuration",n}(Xt||{}),ln=function(n){return n.AgeColorBlend="AgeColorBlend",n.BrownianMotion="BrownianMotion",n.UniformForce="UniformForce",n.RadialForce="RadialForce",n.Friction="Friction",n.Gravity="Gravity",n.Path="Path",n.AxisForce="AxisForce",n.SpriteAnimation="SpriteAnimation",n}(ln||{}),jn=function(n){return n.LifetimeKill="LifetimeKill",n.LifetimeStop="LifetimeStop",n.PathKill="PathKill",n.PathStop="PathStop",n.PathRadius="PathRadius",n.ShapeBounce="ShapeBounce",n.ShapeKill="ShapeKill",n.ShapeStop="ShapeStop",n}(jn||{}),m_=function(n){return n.Sphere="Sphere",n.Plane="Plane",n.Cube="Cube",n.Cylinder="Cylinder",n}(m_||{}),f_=function(n){return n.In="in",n.Out="out",n}(f_||{});const Hv=["objectId","displayName","geometryId","morphId","materialId","transformId"],Qv=["geometryId","materialId","morphId"];function eh(n,t){return{availableObjects:(0,m.mapKeys)(n.availableObjects,(d,f)=>Xn.renamespaceValue(f,t)),showObjects:(0,m.mapKeys)(n.showObjects,(d,f)=>Xn.renamespaceValue(f,t)),selectObjects:(0,m.mapKeys)(n.selectObjects,(d,f)=>Xn.renamespaceValue(f,t)),pickThroughObjects:(0,m.mapKeys)(n.pickThroughObjects,(d,f)=>Xn.renamespaceValue(f,t)),synchronization:(0,m.mapKeys)(n.synchronization,(d,f)=>Xn.renamespaceValue(f,t))}}function Yv(n,t){const o=i=>i.map(s=>s.type===xo.X.flyToChapter||s.type===xo.X.flyToObject?{...s,value:Xn.renamespaceValue(s.value,t)}:s);return(n||[]).map(i=>({...i,objectId:Xn.renamespaceValue(i.objectId,t),states:i.states.map(s=>({...s,errands:o(s.errands)}))}))}function Kv(n,t){return(n||[]).map(o=>(o.data.timeline=t[o.data.timeline]||o.data.timeline,o))}function Jv(n,t){return(n||[]).map(o=>(o.objectId&&(o.objectId=Xn.renamespaceValue(o.objectId,t)),o))}function qv(n,t){return n?{xray:(0,m.mapKeys)(n.xray,(o,i)=>Xn.renamespaceValue(i,t)),highlight:(0,m.mapKeys)(n.highlight,(o,i)=>Xn.renamespaceValue(i,t))}:{}}function Zv(n,t){const i={...n};return Array.isArray(n?.layers)&&(i.layers=n.layers.map(s=>({...s,objectIds:s.objectIds.map(r=>Xn.renamespaceValue(r,t))}))),i}function th(n,t){return n.forEach(o=>{Hv.forEach(i=>{const s=o[i];s&&"string"==typeof s&&(o[i]=Xn.renamespaceValue(s,t))}),o.renderables?.forEach(i=>{Qv.forEach(s=>{const r=i[s];r&&"string"==typeof r&&(i[s]=Xn.renamespaceValue(r,t))})}),o.objects&&th(o.objects,t)}),n}function n0(n,t){function o(r=[]){return r.map(a=>({...a,src:Xn.renamespaceValue(a.src,t)}))}let s=[];return n&&Array.isArray(n.particleSystems)&&(s=n.particleSystems.map(function i(r){return function Xv(n){return"material"in n&&!("workflow"in n.material)}(r)?{...r,textures:o(r.textures)}:{...r}})),s}function i0(n,t){const o=function t0(n,t){return"string"==typeof n?[t[n]||n]:n.map(o=>t[o]||o)}(n.stateId,t),i=n.assetLibraries.tweens.map(T=>Xn.renamespaceValue(T,t)),s=n.assetLibraries.reflections.map(T=>Xn.renamespaceValue(T,t)),r=(0,m.mapValues)(n.reflections,(T,L)=>Xn.renamespaceValue(T,t)),a=function e0(n,t){return n.map(o=>({...o,...eh(o,t),colorRecipeObjects:qv(o.colorRecipeObjects,t),timelineMap:Kv(o.timelineMap,t),labels:Yv(o.labels,t),hotspots:Jv(o.hotspots,t),visibilityLayers:Zv(o.visibilityLayers,t)}))}(n.chapters,t),d=th(n.sceneGraph,t),f={...n.customData,particleSystems:n0(n.customData,t)};return{...n,stateId:o,...eh(n,t),assetLibraries:{...n.assetLibraries,tweens:i,reflections:s},reflections:r,chapters:a,sceneGraph:d,customData:f}}const _c="context-label";class wi{}var o0=_(59676),_a=_(15375),di=_(75069),Ui=_(24151),ar=_(79817),Nn=_(81025),Rn=_(38472),Kt=_(11724),gt=_(515),ji=_(35650);let pa=(()=>{var n;class t{constructor(i,s){this.engineService=i,this.sceneService=s,this.markers=new Map,this.initMarkerEvents()}getMarkerWorldPosition(i){if((0,m.isNil)(i))return;const s=Rn.clone(i.marker3D.position);return Rn.scale(s,s,1/Kt.BIODIGITAL_SCENE_SCALE),s}getMarkerById(i){return this.markers.get(i)}createMarker(i){const{id:s,objectId:r,primitiveIndex:a,renderableIndex:d,barycentric:f,pos:T}=i,{engine:L}=this.engineService,{activeChapter:ee,chapters:re}=L.story,ve=re.find(it=>it.id===i.chapterId)??ee,Oe=a>=0?"primitive":"object";if(!r)return console.warn("An object id is required for creating a marker.",{id:s}),null;const Ee=this.sceneService.getObjectById(r);if((0,m.isNil)(Ee))return console.warn("A valid object id is required for creating a marker.",{id:s,objectId:r}),null;let Re=T?Rn.clone(T):void 0;"object"===Oe&&(0,m.isNil)(Re)&&(Re=this.sceneService.getObjectBoundaryCenter(r)),(0,m.isNil)(Re)||Rn.scale(Re,Re,Kt.BIODIGITAL_SCENE_SCALE);const Ke=new Kt.BioDigitalScreenMarker(L,ve,{object:Ee,trackingMode:Oe,renderableIndex:d||0,primitiveIndex:a,barycenter:f||[1/3,1/3,1/3],worldPosition:Re,variantIndex:Ee.variant},s);return this.markers.set(s,Ke),Ke.update(),Ke}deleteMarker(i){this.markers.get(i)?.destroy(),this.markers.delete(i)}deleteMarkers(){this.markers.forEach(i=>i.destroy()),this.markers.clear()}initMarkerEvents(){this.engineService.engineCreated$.subscribe(i=>{i.renderer.on("update",()=>{this.updateMarkers()})})}updateMarkers(){0!==this.markers.size&&(this.markers.forEach(i=>i.update()),this.engineService.fireEvent(gt.X.SceneMarkersUpdated,this.markers))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(u.y),e.KVO(ji.w))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Fo,lr,en=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ge=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const nh={enableContextLabel:{enable:!0,enableInfo:!0,enableActions:!0,enableAudio:!0},loading:!1,labelsCollapsed:!1,labelsCollapsedMode:_a.Q.None,labelScale:null,labels:[],contextLabel:null,selectedLabel:null,draggable:{pin:!0,tag:!0}};let Ze=(Fo=class{static getLabels(t){return t.labels}static getLabelsCollapsed(t){return t.labelsCollapsed}static getLabelsCollapsedMode(t){return t.labelsCollapsedMode}static getSelectedLabelId(t){return t.selectedLabel}static getSelectedLabel(t){return t.labels.find(o=>o.id===t.selectedLabel)||null}static getContextLabel(t){return t.contextLabel}static getChapterLabels(t,o){return t.labels.filter(i=>i.chapterId===o.selectedChapter)}static getChapterSequentialLabels(t){return(0,l.Mz)([lr,fe.N],(o,i)=>o.labels.filter(s=>s.chapterId===i.selectedChapter&&s.pinType===Ui.O.Sequential&&s.sequentialType===t))}static getLabelSequence(t){return(0,l.Mz)([lr,lr.getChapterSequentialLabels(ar.C.Alphabetical),lr.getChapterSequentialLabels(ar.C.Numerical)],(o,i,s)=>{if(t.pinType!==Ui.O.Sequential)return null;switch(t.sequentialType){case ar.C.Alphabetical:{const r=i.findIndex(a=>a.id===t.id);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(r)}case ar.C.Numerical:return s.findIndex(r=>r.id===t.id)+1}})}static getEnableContextLabel(t){return t.enableContextLabel.enable}static getEnableContextLabelInfo(t){return t.enableContextLabel.enableInfo}static getEnableContextLabelActions(t){return t.enableContextLabel.enableActions}static getEnableContextLabelAudio(t){return t.enableContextLabel.enableAudio}static getLabelsDraggable(t){return t.draggable}static getLabelScale(t){return t.labelScale}PatchLabels(t,o){const i=Nn.$i(t.getState(),o.patches);t.patchState(i)}setLabelOffset(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{const d=a.labels.find(f=>f.id===o.labelId);d&&(d.offset=o.offset)});t.patchState(i),this.savePatches(s,r)}setLabels(t,o){t.patchState(Nn.jM(t.getState(),i=>{i.labels=o.labels}))}setLabel(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{a.labels=a.labels.map(d=>d.id===o.label.id?o.label:d)});t.patchState(i),o.record&&this.savePatches(s,r)}setLabelStates(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{a.labels.find(f=>f.id===o.id).states=o.states});t.patchState(i),this.savePatches(s,r)}setLabelScale(t,o){t.patchState({labelScale:o.scale})}addLabel(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{const d=o.label.id||vi.u.idWithPrefix("label"),f={...o.label,id:d};a.labels.push(f)});t.patchState(i),o.record&&this.savePatches(s,r)}addContextLabel(t,o){const i=Nn.jM(t.getState(),s=>{s.contextLabel={...o.label,id:_c}});t.patchState(i)}removeLabel(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{a.labels=a.labels.filter(d=>d.id!==o.label.id)});t.patchState(i),this.markerService.deleteMarker(o.label.id),this.savePatches(s,r)}removeContextLabel(t,o){const i=Nn.jM(t.getState(),s=>{s.contextLabel=void 0});this.markerService.deleteMarker(_c),t.patchState(i)}removeAllChapterLabels(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{const[d,f]=(0,m.partition)(a.labels,T=>T.chapterId!==o.chapter.id);f.forEach(T=>this.markerService.deleteMarker(T.id)),a.labels=d});t.patchState(i),o.record&&this.savePatches(s,r)}selectLabel(t,o){t.patchState({selectedLabel:o.label?o.label.id:null})}resetLabels(t,o){const i=t.getState();this.markerService.deleteMarker(_c),i.labels.forEach(s=>{this.markerService.deleteMarker(s.id)}),t.setState(Nn.jM(t.getState(),s=>{}))}convertLabels(t,o){const[i,s,r]=Nn.vI(t.getState(),a=>{o.labels.forEach(d=>{const f=a.labels.findIndex(T=>T.id===d.id);a.labels[f]={...a.labels[f],...o.fields}})});t.setState({...i}),this.savePatches(s,r)}enableContextLabel(t,o){t.patchState({enableContextLabel:{...o}})}setLabelsShown(t,{labels:o,shown:i}){const s=t.getState().labels.map(r=>{const a=o.some(d=>d.id===r.id);return{...r,shown:a?i:r.shown}});t.patchState({labels:[...s]})}setAllLabelsShown(t,{show:o}){const i=t.getState().labels;t.dispatch(new He.D3(i,o))}setLabelsCollapsed(t,{collapsed:o,collapsedMode:i}){t.patchState({labelsCollapsed:o,labelsCollapsedMode:i})}setLabelsDraggable(t,o){t.patchState({draggable:{...o.draggable}})}savePatches(t,o){this.store.dispatch(new di.a.SavePatches([{forward:t,inverse:o,patchAction:He.sW}]))}constructor(t,o){this.store=t,this.markerService=o}},lr=Fo,Fo.\u0275fac=function(t){return new(t||Fo)(e.KVO(l.il),e.KVO(pa))},Fo.\u0275prov=e.jDH({token:Fo,factory:Fo.\u0275fac}),Fo);en([(0,l.rc)(He.sW),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.sW]),Ge("design:returntype",void 0)],Ze.prototype,"PatchLabels",null),en([(0,l.rc)(He.yi),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.yi]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelOffset",null),en([(0,l.rc)(He.gJ),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.gJ]),Ge("design:returntype",void 0)],Ze.prototype,"setLabels",null),en([(0,l.rc)(He.lb),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.lb]),Ge("design:returntype",void 0)],Ze.prototype,"setLabel",null),en([(0,l.rc)(He.HP),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.HP]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelStates",null),en([(0,l.rc)(He.tH),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.tH]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelScale",null),en([(0,l.rc)(He.Sh),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.Sh]),Ge("design:returntype",void 0)],Ze.prototype,"addLabel",null),en([(0,l.rc)(He.h5),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.h5]),Ge("design:returntype",void 0)],Ze.prototype,"addContextLabel",null),en([(0,l.rc)(He.vx),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.vx]),Ge("design:returntype",void 0)],Ze.prototype,"removeLabel",null),en([(0,l.rc)(He.S3),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.S3]),Ge("design:returntype",void 0)],Ze.prototype,"removeContextLabel",null),en([(0,l.rc)(He.u1),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.u1]),Ge("design:returntype",void 0)],Ze.prototype,"removeAllChapterLabels",null),en([(0,l.rc)(He.TR),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.TR]),Ge("design:returntype",void 0)],Ze.prototype,"selectLabel",null),en([(0,l.rc)(He.$y),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.$y]),Ge("design:returntype",void 0)],Ze.prototype,"resetLabels",null),en([(0,l.rc)(He.$K),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.$K]),Ge("design:returntype",void 0)],Ze.prototype,"convertLabels",null),en([(0,l.rc)(He.Tz),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.Tz]),Ge("design:returntype",void 0)],Ze.prototype,"enableContextLabel",null),en([(0,l.rc)(He.D3),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.D3]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelsShown",null),en([(0,l.rc)(He.eH),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.eH]),Ge("design:returntype",void 0)],Ze.prototype,"setAllLabelsShown",null),en([(0,l.rc)(He.vf),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.vf]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelsCollapsed",null),en([(0,l.rc)(He.Ds),Ge("design:type",Function),Ge("design:paramtypes",[Object,He.Ds]),Ge("design:returntype",void 0)],Ze.prototype,"setLabelsDraggable",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getLabels",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getLabelsCollapsed",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getLabelsCollapsedMode",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getSelectedLabelId",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getSelectedLabel",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getContextLabel",null),en([(0,l.MD)([fe.N]),Ge("design:type",Function),Ge("design:paramtypes",[wi,o0.G]),Ge("design:returntype",void 0)],Ze,"getChapterLabels",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getEnableContextLabel",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getEnableContextLabelInfo",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getEnableContextLabelActions",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getEnableContextLabelAudio",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getLabelsDraggable",null),en([(0,l.MD)(),Ge("design:type",Function),Ge("design:paramtypes",[wi]),Ge("design:returntype",void 0)],Ze,"getLabelScale",null),Ze=lr=en([(0,l.Uw)({name:"labels",defaults:nh}),Ge("design:paramtypes",[l.il,pa])],Ze);var Go=_(12921),Ue=_(87710),ih=_(4959),Mn=_(13409),ua=_(60286);let oh=(()=>{var n;class t{constructor(i){this.engineService=i}createEngineClippingPlanes(i){return(0,Kt.makeClippingPlanes)(i)}setClippingPlanes(i){const{story:s}=this.engineService.engine,{activeChapter:r}=s;if((0,m.isNil)(r))return;const a=this.createEngineClippingPlanes(i);r.clippingPlanes.length=0,r.clippingPlanes.push(...a)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(u.y))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();const S_=1e-4;function pc(n,t){const o={};return Math.abs(n[0]-t)>=S_&&(o.x=n[0]),Math.abs(n[1]-t)>=S_&&(o.y=n[1]),Math.abs(n[2]-t)>=S_&&(o.z=n[2]),o.x||o.y||o.z?o:null}function sh(n,t){if(t[n.objectId])return null;let o={objectId:n.objectId,displayName:n.displayName,layer:n.layer};return n.transformId?o.transformId=n.transformId:o=function s0(n,t){const o=Kt.vec3Pool.get();Rn.scale(o,n.sceneNode.rotation,180/Math.PI);const i={translate:pc(n.sceneNode.position,0),rotate:pc(o,0),scale:pc(n.sceneNode.scale,1),pivot:pc(n.sceneNode.origin,0)};return Kt.vec3Pool.release(o),(0,m.isNull)(i.translate)||(t.translate=i.translate),(0,m.isNull)(i.rotate)||(t.rotate=i.rotate),(0,m.isNull)(i.scale)||(t.scale=i.scale),(0,m.isNull)(i.pivot)||(t.pivot=i.pivot),t.transformId&&(console.error("There should not be a transform"),delete t.transformId),t}(n,o),o=function r0(n,t){const i=rh(n.renderables??[]);return 1===i.length?(0,m.merge)(t,i[0]):i.length>1&&(t.renderables=i),t}(n,o),n.children&&n.children.length&&(o.objects=[]),n.children.forEach(i=>{const s=sh(i,t);null!==s&&o.objects.push(s)},this),n.variants?.length>1&&(o.variants=n.variants.map(i=>rh(i))),o}function rh(n){return n.map(t=>{const{geometryId:o,morphId:i,materialId:s,layer:r}=t;return{geometryId:o,morphId:i,materialId:s,layer:r}})}let b_=(()=>{var n;class t{constructor(i,s,r,a,d,f,T,L){this.store=i,this.engineService=s,this.chapterSerializer=r,this.animationService=a,this.chapterService=d,this.paintService=f,this.clippingPlanesService=T,this.sceneService=L}serializeUI(i){const s={...i.ui};return i.chapters.length>1&&(s.scrubber=!1,s.playPause=!1,s.tour={chapters:!0}),s}serializeAnimation(i){return this.animationService.isChapterAnimated(i)?{play:{startTime:i.timelineMap[0].start,loop:!1!==i.loop,numChapters:1}}:{}}getClippedObjects(){const i=this.store.selectSnapshot(fe.N.getSelectedChapterClippingPlanes),s=this.clippingPlanesService.createEngineClippingPlanes(i);return 0===s.length?{}:this.sceneService.getLeafIds().reduce((r,a)=>{const d=this.sceneService.getObjectById(a);return this.sceneService.isObjectCulledByClip(d,s)&&(r[a]=!0),r},{})}generateTrimObjectMap(i){const s={};if(i.graph.unavailable){const a=this.store.selectSnapshot(Mn.z.getAllNodeState);Object.values(a).forEach(d=>{Object.entries(d).forEach(([f,T])=>{!1!==s[f]&&(s[f]=!T.available)})})}if(i.graph.hidden){const a=this.store.selectSnapshot(Mn.z.getAllNodeState);Object.values(a).forEach(d=>{Object.entries(d).forEach(([f,T])=>{!1!==s[f]&&(s[f]=!(T.shown||T.shownSetByTween))})})}const r=i.graph.clipped?this.getClippedObjects():{};return{...s,...r}}trimObjects(i,s){if(s[i.objectId])return null;const r=[];return i.children.forEach(a=>{const d=this.trimObjects(a,s);(0,m.isNil)(d)||r.push(d)}),i.children=r,i}serialize(i,s,r=!1,a,d,f){const T=(0,m.cloneDeep)(a),L=this.generateTrimObjectMap(s),ee=this.sceneService.getRootObjects();T.sceneGraph=function a0(n,t){const o=[];return Object.entries(n).forEach(([i,s])=>{const r=sh(s,t);null!==r&&o.push(r)},this),o}(ee,L);const re=[];Object.values(ee).forEach(ft=>{const ze=this.trimObjects(ft,L);null!==ze&&re.push(ze)},this);const ve=(0,Wv.ow)(this.paintService.getColorRecipes()),Oe=(0,h_.fm)(re,ve),Ee=this.store.selectSnapshot(Ze.getLabels);T.chapters=d.map(ft=>this.chapterSerializer.serializeChapter(Oe,ft,i,Ee,f)),T.ui=this.serializeUI(T),T.animation=this.serializeAnimation(d[0]),T.customData={...T.customData,particleSystems:this.store.selectSnapshot(Go.B.getParticleSystemsList)},T.sourceInfo=qg(T.sourceInfo);const Re=this.store.selectSnapshot(Ue.j.getAllQuestions),Fe=this.store.selectSnapshot(Ue.j.getQuizSettings);Fe&&Re.length>0?T.quizSettings=Fe:delete T.quizSettings,T.playthroughSettings=a.playthroughSettings,T.tweenParticleLookup=this.store.selectSnapshot(Go.B.getTweenParticleLookup);const Ke=d.reduce((ft,ze)=>ft.concat(this.chapterService.getChapterLightLibraries(ze)),[]),it=Array.from(new Set(Ke));T.assetLibraries.lights.forEach(ft=>{it.includes(ft)||it.push(ft)}),T.assetLibraries.lights=it;const pt=this.getReflectionLibraries(T.reflections),Mt=d.reduce((ft,ze)=>ft.concat(this.chapterService.getChapterReflectionLibraries(ze)),[]);T.assetLibraries.reflections=Array.from(new Set(pt.concat(Mt)));const $t=[...Object.values(T.assetLibraries)].flat(),_n=this.getSceneGraphStateIds(T.sceneGraph);return T.stateId=Array.from(new Set($t.map(this.getStateId).concat(_n))),(0,m.isEmpty)(a.variantSchemas)?delete T.variantSchemas:T.variantSchemas=a.variantSchemas,{story:r?i0(T,i):T}}getReflectionLibraries(i){return i=i||{},Object.values(i).map(r=>{const a=r.split(".");return[a[0],a[1]].join("/")})}getSceneGraphStateIds(i){return i.map(s=>s.objectId.split("-")[0])}getStateId(i){return i.split("/")[0]}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(u.y),e.KVO(zv.p),e.KVO(zi.O),e.KVO(ih.j),e.KVO(ua.s),e.KVO(oh),e.KVO(ji.w))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();class ah{constructor(){this.graph={unavailable:!1,hidden:!1,clipped:!1}}}var $o,uc,Lt=_(61295),l0=_(29284),y_=_(65881),pn=_(35939),Bt=_(76016),v_=_(21472),si=_(46104),zt=_(17215),eo=_(76774),to=_(65650),En=_(33013),no=_(82323),Jt=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ve=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const lh={loading:!1,incoming:{id:void 0,type:void 0},storyId:void 0,storyType:void 0,storyLang:void 0,loadingChapter:null,loadChapters:[],loadChaptersRemaining:[],thumbnailLookup:[],manifestsMaxTimes:void 0};let rt=(uc=$o=class{static getStory(t){return t.story}static getStoryId(t){return t.storyId}static getStoryType(t){return t.storyType}static getLoadingChapter(t){return t.loadingChapter}static getLoadChapters(t){return t.loadChapters}static getLoadChaptersRemaining(t){return t.loadChaptersRemaining}static getStoryInfo(t){return{id:t.storyId,type:t.storyType}}static getIncomingStoryInfo(t){return t.incoming}static getStoryTags(t){return t?.story?.tags??[]}static getStoryLanguage(t){return t.storyLang??bn.q.lang}static getAnimationManifests(t){return t.manifestsMaxTimes}static getStorySourceInfo(t){return t.story?.sourceInfo}static getVariantSchemas(t){return t.story?.variantSchemas??{}}static getVariantSchema(t){return(0,l.Mz)([uc.getVariantSchemas],o=>o[t])}setStoryText(t,o){const i=t.getState().story;i&&t.patchState({story:{...i,displayName:o.displayName}})}setStoryTags(t,{tags:o}){const i=t.getState().story;i&&t.patchState({story:{...i,tags:o}})}setStoryPlaythrough(t,{playthroughSettings:o}){const i=t.getState().story;i&&t.patchState({story:{...i,playthroughSettings:o}})}setStorySourceInfo(t,{sourceInfo:o}){const i=t.getState().story;i&&t.patchState({story:{...i,sourceInfo:o}})}loadManifests(t){t.patchState({manifestsMaxTimes:void 0});const o=this.storyService.getTweenEndTimes(),i=Object.values(this.sceneService.getObjects());this.storyService.findMorphEndTimes(i).subscribe(s=>{t.patchState({manifestsMaxTimes:{...s,...o}})})}setStoryLightLibs(t,o){const i=t.getState().story;i&&t.patchState({story:{...i,assetLibraries:{...i.assetLibraries,lights:o.lightLibs}}})}setStory(t,o){t.patchState({story:o.story})}SetStoryId(t,o){t.patchState({storyId:o.id})}setIncomingStory(t,o){const i=t.getState(),{id:s,type:r,reset:a}=o;(s!==i.storyId||a)&&t.patchState({incoming:{id:s,type:r}})}loadStory(t,o){const i=o.preview?(0,v_.H)(this.storageService.getDatabaseItem(zt.AJ.PreviewStory)):this.storyService.getStory(o.id,o.type,o.lang),s=this.storyService.getStoryLang(o.id,o.type,o.lang);(0,si.p)([i,s]).subscribe(([r,a])=>{t.dispatch(new ys(r,o.id,o.type,a))},()=>{!0===this.reload?(this.reload=!1,this.loadStory(t,o)):t.dispatch(new la(o.id,o.type))})}loadStorySuccess(t,{story:o,id:i,type:s,lang:r}){t.patchState({story:o,storyId:i,storyType:s,storyLang:r}),t.dispatch(new sr(i,o,s))}buildStoryWorkflow(t,o,i,s,r=0,a=new Map,d=!0){if((0,m.isNil)(this.engineService.engine))return;d&&(i.moduleId=o,this.engineService.setStory(i),t.patchState({storyId:o,story:i})),this.engineService.engine.start();const f=this.sceneService.getRootObjects(),T=this.storyService.getStoryChapters(f,i,s);let L=[];T.forEach(Ke=>{L=[...L,...Ke.labels]});const ee=this.storyService.getStoryLoadChapters(i);t.patchState({loadChapters:ee,loadChaptersRemaining:ee,incoming:{id:void 0,type:void 0}});const re=this.sceneService.getSceneGraph(f),ve=T.reduce((Ke,it)=>(Ke[it.id]=(0,l0.iE)(re,it.showObjects,it.availableObjects,it.pickThroughObjects,it.synchronization),Ke),{});T.forEach(Ke=>{((0,m.isNil)(Ke.createdFrom)||0===Ke.createdFrom.length)&&(Ke.createdFrom=[{id:o,timestamp:Date.now()}])}),t.dispatch(new Lt.K8(ve)),t.dispatch(new Lt.IA(T[r].id)),t.dispatch(new En.lM(T)),t.dispatch(new no.W2(a)),t.dispatch(new He.gJ(L)),t.dispatch(new En.yz(T[r]));const Oe=i.tweenParticleLookup??{},Ee=i.customData?.particleSystems??[],Re=T.reduce((Ke,it)=>(Ke[it.id]=it.customData?.particleSystems??[],Ke),{});t.dispatch(new pn.u.SetParticleState(Ee,Re,Oe)),t.dispatch(new Bt.B.ResetQuizState),i.quizSettings&&t.dispatch(new Bt.B.SetQuizSettings(i.quizSettings));const Fe=(0,eo.En)(T);t.dispatch(new Bt.B.SetQuestions(Fe)),t.dispatch(new g_),t.dispatch(new D.SetChapterCallToActionSeen(!1)),t.dispatch(new aa(i,o,s)),t.dispatch(new ir)}importStorySuccess(t,o){const i=t.getState(),s=i.storyType,r=i.storyId,d=new ah,T=this.store.selectSnapshot(uc.getStory),L=this.store.selectSnapshot(fe.N.getStoryChapters),ee=(0,y_.S)(L,!1),re=this.serializeModuleService.serialize({},d,!1,T,L,ee).story,ve=Gv(re,r,o.story,o.id,I.c.exportType),Oe=ve.chapters.slice(re.chapters.length).reduce((Re,Fe,Ke)=>(Re[o.story.chapters[Ke].id]=Fe.id,Re),{}),Ee=o.story.chapters.reduce((Re,Fe)=>{const Ke=Fe.thumbnails?Fe.thumbnails.large:Vo.generateLegacyThumbnail(o.id,Fe.id).large,it=Vo.makeFreshThumbnail(r,Oe[Fe.id],Ke);return Re.push(it),Re},[]);(0,si.p)(Ee).subscribe(Re=>{const Fe=this.store.selectSnapshot(to.K.getRegisteredThumbnails);Re.forEach(Ke=>{Fe.set(Ke.chapterId,Ke)}),this.buildStoryWorkflow(t,r,ve,s,ve.chapters.length-1,Fe)})}buildStory(t,o){const i=Vo.getChapterThumbnails(o.id,o.story.chapters);this.buildStoryWorkflow(t,o.id,o.story,o.type,o.chapterIdx||0,i,o.replaceActiveStory)}loadChapter(t){const o=t.getState().loadChaptersRemaining[0];if(!o)return;t.patchState({loadingChapter:o});let i=!1;this.storyService.loadChapter(o).then(()=>{}).catch(s=>{(0,m.isNil)(this.engineService.engine?.story)?i=!0:console.error(s)}).finally(()=>{i?console.warn(`Loading of chapter ${o.chapterId} cancelled.`):t.dispatch([new To(o),new ir])})}reorderLoadChapters(t,o){const{loadChaptersRemaining:i}=t.getState(),[s,r]=(0,m.partition)(i,a=>a.chapterId===o.chapterId);t.patchState({loadChaptersRemaining:[...s,...r]})}loadChapterSuccess(t,o){const i=t.getState().loadChaptersRemaining.filter(s=>s.chapterId!==o.chapter.chapterId);t.patchState({loadingChapter:null,loadChaptersRemaining:i}),t.dispatch(new En.M5(o.chapter.chapterId,{model:!0,animation:!1,...o.chapter.readyState})),t.dispatch(new En.eV(o.chapter.chapterId))}synchronizeChapters(t){const o=this.store.selectSnapshot(fe.N.getStoryChapters),{story:i}=t.getState();t.patchState({story:{...i,chapters:[...o]}})}importStory(t,o){this.storyService.getStory(o.id,o.type,o.lang).subscribe(i=>{t.dispatch(new rr(i,o.id,o.type))})}resetStory(t){t.setState(lh)}mergeBridgeModuleSuccess(t,{story:o}){const i=t.getState(),s=this.store.selectSnapshot(fe.N.getSelectedChapterIndex),r=Vo.getChapterThumbnails(i.storyId,o.chapters);this.buildStoryWorkflow(t,i.storyId,o,ye.c.Module,s,r)}constructor(t,o,i,s,r,a){this.store=t,this.storyService=o,this.serializeModuleService=i,this.storageService=s,this.sceneService=r,this.engineService=a,this.reload=I.c.native}},$o.\u0275fac=function(t){return new(t||$o)(e.KVO(l.il),e.KVO(da.J),e.KVO(b_),e.KVO(zt.n$),e.KVO(ji.w),e.KVO(u.y))},$o.\u0275prov=e.jDH({token:$o,factory:$o.\u0275fac}),$o);Jt([(0,l.rc)(na),Ve("design:type",Function),Ve("design:paramtypes",[Object,na]),Ve("design:returntype",void 0)],rt.prototype,"setStoryText",null),Jt([(0,l.rc)(ia),Ve("design:type",Function),Ve("design:paramtypes",[Object,ia]),Ve("design:returntype",void 0)],rt.prototype,"setStoryTags",null),Jt([(0,l.rc)(oa),Ve("design:type",Function),Ve("design:paramtypes",[Object,oa]),Ve("design:returntype",void 0)],rt.prototype,"setStoryPlaythrough",null),Jt([(0,l.rc)(sa),Ve("design:type",Function),Ve("design:paramtypes",[Object,sa]),Ve("design:returntype",void 0)],rt.prototype,"setStorySourceInfo",null),Jt([(0,l.rc)(ac),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype",void 0)],rt.prototype,"loadManifests",null),Jt([(0,l.rc)(ra),Ve("design:type",Function),Ve("design:paramtypes",[Object,ra]),Ve("design:returntype",void 0)],rt.prototype,"setStoryLightLibs",null),Jt([(0,l.rc)(ea),Ve("design:type",Function),Ve("design:paramtypes",[Object,ea]),Ve("design:returntype",void 0)],rt.prototype,"setStory",null),Jt([(0,l.rc)(ta),Ve("design:type",Function),Ve("design:paramtypes",[Object,ta]),Ve("design:returntype",void 0)],rt.prototype,"SetStoryId",null),Jt([(0,l.rc)(bs),Ve("design:type",Function),Ve("design:paramtypes",[Object,bs]),Ve("design:returntype",void 0)],rt.prototype,"setIncomingStory",null),Jt([(0,l.rc)(Ss),Ve("design:type",Function),Ve("design:paramtypes",[Object,Ss]),Ve("design:returntype",void 0)],rt.prototype,"loadStory",null),Jt([(0,l.rc)(ys),Ve("design:type",Function),Ve("design:paramtypes",[Object,ys]),Ve("design:returntype",void 0)],rt.prototype,"loadStorySuccess",null),Jt([(0,l.rc)(rr),Ve("design:type",Function),Ve("design:paramtypes",[Object,rr]),Ve("design:returntype",void 0)],rt.prototype,"importStorySuccess",null),Jt([(0,l.rc)(sr),Ve("design:type",Function),Ve("design:paramtypes",[Object,sr]),Ve("design:returntype",void 0)],rt.prototype,"buildStory",null),Jt([(0,l.rc)(ir),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype",void 0)],rt.prototype,"loadChapter",null),Jt([(0,l.rc)(or),Ve("design:type",Function),Ve("design:paramtypes",[Object,or]),Ve("design:returntype",void 0)],rt.prototype,"reorderLoadChapters",null),Jt([(0,l.rc)(To),Ve("design:type",Function),Ve("design:paramtypes",[Object,To]),Ve("design:returntype",void 0)],rt.prototype,"loadChapterSuccess",null),Jt([(0,l.rc)(Iv),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype",void 0)],rt.prototype,"synchronizeChapters",null),Jt([(0,l.rc)(ca),Ve("design:type",Function),Ve("design:paramtypes",[Object,ca]),Ve("design:returntype",void 0)],rt.prototype,"importStory",null),Jt([(0,l.rc)(on),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype",void 0)],rt.prototype,"resetStory",null),Jt([(0,l.rc)(wv),Ve("design:type",Function),Ve("design:paramtypes",[Object,Object]),Ve("design:returntype",void 0)],rt.prototype,"mergeBridgeModuleSuccess",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStory",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStoryId",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStoryType",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getLoadingChapter",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getLoadChapters",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getLoadChaptersRemaining",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStoryInfo",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getIncomingStoryInfo",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStoryTags",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStoryLanguage",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getAnimationManifests",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",void 0)],rt,"getStorySourceInfo",null),Jt([(0,l.MD)(),Ve("design:type",Function),Ve("design:paramtypes",[Ii.o]),Ve("design:returntype",Object)],rt,"getVariantSchemas",null),rt=uc=Jt([(0,l.Uw)({name:"story",defaults:lh}),Ve("design:paramtypes",[l.il,da.J,b_,zt.n$,ji.w,u.y])],rt);var io,Ht=_(82656),tn=_(17365),qt=_(47555),st=_(47610),yn=_(35426),Wi=_(76718),ga=_(35160);!function(n){function o(T){r()&&(T||(T=document.body),T.requestFullscreen?T.requestFullscreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen())}function i(){r()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function s(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}function r(){return!!s()||(console.warn("Fullscreen is not enabled"),!1)}function a(){return document.fullscreenElement||document.webkitFullscreenElement}function d(){return!(0,m.isNil)(a())}n.toggleFullscreen=function t(T){const L=a();(0,m.isNil)(L)?o(T):i()},n.requestFullscreen=o,n.exitFullscreen=i,n.canFullscreen=s,n.checkFullscreenSupport=r,n.getFullscreenElement=a,n.isFullscreen=d,n.onFullscreenChange=function f(){const T=["mozfullscreenchange","webkitfullscreenchange","fullscreenchange"].map(L=>(0,yn.R)(document.body,L));return(0,Wi.h)(...T).pipe((0,le.T)(()=>d()),(0,ga.Z)(d()))}}(io||(io={}));var Bo=function(n){return n.None="none",n.Play="play",n.Button="button",n.Hand="hand",n.Summary="summary",n}(Bo||{}),fn=function(n){return n[n.OnDemand=0]="OnDemand",n[n.Interact=1]="Interact",n[n.Loader=2]="Loader",n[n.Tutorial=3]="Tutorial",n[n.Whiteboard=4]="Whiteboard",n[n.Help=5]="Help",n}(fn||{}),oo=function(n){return n.Text="text",n.Paint="paint",n.Erase="erase",n}(oo||{});const ch=[4,8,12,16,24,32],E_=n=>n.slice(0).reverse().map(t=>({label:`${t}`,size:t})),dh=E_(ch),_h=E_([8,12,16,20,24,32]),ph=E_(ch),C_={color:"#000000"},uh={color:"#ffffff"},d0=dh[4],_0=C_,p0=_h[3],u0=ph[4],g0=C_,h0=uh;var zo,hc,vs=function(n){return n.Mouse="mouse",n.Touch="touch",n}(vs||{}),gc=function(n){return n[n.Default=0]="Default",n.DrawerOnly="drawer",n.ColumnOnly="column",n}(gc||{}),m0=_(79083),Xi=_(18272),Ft=function(n){return n.NodeInfo="nodeInfo",n.LabelInfo="labelInfo",n.ChapterInfo="chapterInfo",n.Quiz="Quiz",n.Search="Search",n.VisibilityLayers="VisibilityLayers",n}(Ft||{}),xe=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},te=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class Pt{}const gh={autoplay:!1,contentMode:Ft.ChapterInfo,lang:"en",canFullscreen:!1,canHover:!1,canTouch:!1,drawerCoversContent:!1,fadeout:3e3,preventFadeoutEvents:{mouseenter:!1,focusin:!1,overlay:!1},forceAudio:!1,fullscreenActive:!1,help:{tab:v.Basics},inputEnabled:!0,inputMode:vs.Mouse,interactType:Bo.Play,isMobileWeb:!1,onDemand:!1,layout:gc.Default,labelsBreakpoint:480,menuOpen:!1,multiPickModeEnabled:!1,openWindows:[fn.Loader],openPanels:new Set,playthroughSettings:{enabled:!1,countdown:3e3,countdownDelay:2e3,forceAudio:!0,loop:!1,minimum:1e4},presentationActive:!1,searchDisplayMode:Xi.q.List,startingColumn:"info",preferredColumn:null,startingTool:null,nodeInfo:{show:!1,fallback:m0.H.Wikipedia},tutorial:{pageSize:0,pageIndex:-1},tutorialSeen:!0,usePrintImage:!1,whiteboard:{enabled:!1,locked:!1,hasPaint:!1,hasText:!1,brushSize:d0.size,brushColor:_0.color,textSize:p0.size,eraserSize:u0.size,annotateMode:oo.Paint},scrim:{show:!1,label:""},chapterCallToActionSeen:!1};let _e=(hc=zo=class{static getAutoplay(t){return t.autoplay}static getContentMode(t){return t.contentMode}static getLabelsBreakpoint(t){return t.labelsBreakpoint}static getInputEnabled(t){return t.inputEnabled}static getIsMobileWeb(t){return t.isMobileWeb}static getFullscreenActive(t){return t.fullscreenActive}static getPresentationActive(t){return t.presentationActive}static getDrawerCoversContent(t){return t.drawerCoversContent}static getShowNodeInfo(t){return t.nodeInfo.show}static getNodeInfoFallback(t){return t.nodeInfo.fallback}static getOpenPanels(t){return t.openPanels}static isOpenPanel(t){return(0,l.Mz)([hc],o=>o.openPanels.has(t))}static getViewLanguage(t){return t.lang}static getInteractType(t){return t.interactType}static getForceAudio(t){return t.forceAudio}static getOnDemand(t){return t.onDemand}static getFadeout(t){return t.fadeout}static getFadeoutPaused(t){return t.preventFadeoutEvents.mouseenter||t.preventFadeoutEvents.focusin||t.preventFadeoutEvents.overlay}static getPlaythroughSettings(t){return t.playthroughSettings}static getPlaythroughEnabled(t){return t.playthroughSettings.enabled}static getPreferredColumn(t){return t.preferredColumn}static getStartingColumn(t){return t.startingColumn}static getFocusedElement(t){return t.focusedElement}static getStartingTool(t){return t.startingTool}static getLayout(t){return t.layout}static getInputMode(t){return t.inputMode}static getShowHelpTab(t){return t.help.tab}static getTutorial(t){return t.tutorial}static getTutorialSeen(t){return t.tutorialSeen}static getWhiteboardEnabled(t){return t.whiteboard.enabled}static isWhiteboardLocked(t){return t.whiteboard.locked}static getWhiteboardBrushSize(t){return t.whiteboard.brushSize}static getWhiteboardTextSize(t){return t.whiteboard.textSize}static getWhiteboardEraserSize(t){return t.whiteboard.eraserSize}static getWhiteboardAnnotateMode(t){return t.whiteboard.annotateMode}static getWhiteboardBrushColor(t){return t.whiteboard.brushColor}static getWhiteboardHasPaint(t){return t.whiteboard.hasPaint}static getWhiteboardHasText(t){return t.whiteboard.hasText}static getCanTouch(t){return t.canTouch}static getCanHover(t){return t.canHover}static getMultiPickModeEnabled(t){return t.multiPickModeEnabled}static getSearchDisplayMode(t){return t.searchDisplayMode}static getUsePrintImage(t){return t.usePrintImage}static getOpenWindow(t){return t.openWindows.length>0?t.openWindows.sort()[0]:null}static getMenuOpen(t){return t.menuOpen}static getScrim(t){return t.scrim}static getChapterCallToActionSeen(t){return t.chapterCallToActionSeen}static shouldWindowOpen(t){return(0,l.Mz)([hc],o=>o.openWindows.indexOf(t)>=0)}setAutoplay(t,o){t.patchState({autoplay:o.autoplay})}setContentMode(t,o){t.patchState({contentMode:o.column})}setInputEnabled(t,o){t.patchState({inputEnabled:o.enabled})}setCanHover(t,o){t.patchState({canHover:o.canHover})}setCanTouch(t,o){t.patchState({canTouch:o.canTouch})}setCanFullscreen(t,o){t.patchState({canFullscreen:o.canFullscreen})}setSearchDisplayMode(t,o){t.patchState({searchDisplayMode:o.mode})}setViewLanguage(t,{lang:o}){t.patchState({lang:o})}toggleNodeInfo(t,{show:o}){t.patchState({nodeInfo:{...t.getState().nodeInfo,show:o}})}setNodeInfoConfig(t,{fallback:o}){t.patchState({nodeInfo:{...t.getState().nodeInfo,fallback:o}})}togglePanel(t,o){const i=t.getState().openPanels;((0,m.isNil)(o.show)?!i.has(o.panel):o.show)?i.add(o.panel):i.delete(o.panel),t.patchState({openPanels:i})}togglePresentation(t,o){t.patchState({presentationActive:o.active})}toggleHelp(t,o){t.patchState({help:{tab:o.tab}})}setFadeout(t,o){t.patchState({fadeout:o.fadeout})}addPreventFadeoutElement(t,o){const i=t.getState().preventFadeoutEvents;i[o.event]=o.value,t.patchState({preventFadeoutEvents:{...i}})}setPlaythrough(t,o){const i=t.getState().playthroughSettings;(0,m.mergeWith)(i,o.playthrough,(s,r)=>{if(!(0,m.isNil)(r))return r}),t.patchState({playthroughSettings:i})}setPlaythroughEnabled(t,o){let i=t.getState().playthroughSettings;i={...i,enabled:o.enabled},t.patchState({playthroughSettings:i})}setStartingColumn(t,o){t.patchState({startingColumn:o.column})}setPreferredColumn(t,o){t.patchState({preferredColumn:o.column})}setStartingTool(t,o){t.patchState({startingTool:o.tool})}setLoaderType(t,o){t.patchState({interactType:o.interactType})}setForceAudio(t,o){t.patchState({forceAudio:o.forceAudio})}setOnDemand(t,o){t.patchState({onDemand:o.onDemand})}setInputMode(t,{inputMode:o}){t.patchState({inputMode:o})}SetLayout(t,o){t.patchState({layout:o.layout})}setTutorial(t,o){const i=t.getState().tutorial;t.patchState({tutorial:{...i,...o.tutorial}})}startTutorial(t,o){t.patchState({tutorial:{...t.getState().tutorial,pageIndex:o.intro?-1:0}}),t.dispatch(new D.TutorialSeen(!0))}tutorialSeen(t,o){this.storageService.setLocalItem(zt.UT.GettingStartedTutorial,o.seen),t.patchState({tutorialSeen:o.seen})}tutorialPrevious(t,o){const i=t.getState().tutorial,s=Math.max(i.pageIndex-1,0);t.dispatch(new D.SetTutorial({...i,pageIndex:s}))}tutorialNext(t,o){const i=t.getState().tutorial,s=Math.min(i.pageIndex+1,i.pageSize-1);t.dispatch(new D.SetTutorial({...i,pageIndex:s}))}setWhiteboardEnabled(t,{enabled:o}){t.patchState({whiteboard:{...t.getState().whiteboard,enabled:o}})}setWhiteboardLocked(t,{locked:o}){t.patchState({whiteboard:{...t.getState().whiteboard,locked:o}})}setWhiteboardBrushSize(t,{brushSize:o}){t.patchState({whiteboard:{...t.getState().whiteboard,brushSize:o}})}setWhiteboardTextSize(t,{size:o}){t.patchState({whiteboard:{...t.getState().whiteboard,textSize:o}})}setWhiteboardEraserSize(t,{eraserSize:o}){t.patchState({whiteboard:{...t.getState().whiteboard,eraserSize:o}})}setWhiteboardAnnotateMode(t,{mode:o}){t.patchState({whiteboard:{...t.getState().whiteboard,annotateMode:o}})}setWhiteboardBrushColor(t,{brushColor:o}){t.patchState({whiteboard:{...t.getState().whiteboard,brushColor:o}})}setWhiteboardHasPaint(t,{hasPaint:o}){t.patchState({whiteboard:{...t.getState().whiteboard,hasPaint:o}})}setWhiteboardHasText(t,{hasText:o}){t.patchState({whiteboard:{...t.getState().whiteboard,hasText:o}})}setMultiPickModeEnabled(t,o){t.patchState({multiPickModeEnabled:o.enabled})}setLabelBreakpoint(t,o){t.patchState({labelsBreakpoint:o.labelsBreakpoint})}setUsePrintImage(t,o){t.patchState({usePrintImage:o.usePrintImage})}setWindows(t,o){t.patchState({openWindows:o.windows})}setIsMobileWeb(t,o){t.patchState({isMobileWeb:o.isMobileWeb})}openWindow(t,o){const i=t.getState().openWindows;i.indexOf(o.window)<0&&t.patchState({openWindows:[o.window,...i]})}closeWindow(t,o){let i=t.getState().openWindows;null!=o.window?i=i.filter(s=>s!==o.window):i.shift(),t.patchState({openWindows:[...i]})}toggleWindow(t,o){const i=t.getState().openWindows.indexOf(o.window)>=0;t.dispatch((null!=o.show?o.show:!i)?new D.OpenWindow(o.window):new D.CloseWindow(o.window))}toggleMenu(t,o){t.patchState({menuOpen:o.open})}showScrim(t,o){t.patchState({scrim:{show:!0,label:o.label}})}hideScrim(t,o){t.patchState({scrim:{show:!1,label:""}})}setChapterCallToActionSeen(t,o){t.patchState({chapterCallToActionSeen:o.chapterCallToActionSeen})}ResetViewState(t,o){t.setState({...gh})}setFocusedElement(t,o){t.patchState({focusedElement:o.focusedElement})}constructor(t){this.storageService=t}ngxsOnInit(t){io.onFullscreenChange().subscribe(o=>{t.patchState({fullscreenActive:o})}),t.patchState({tutorialSeen:this.storageService.getLocalJSON(zt.UT.GettingStartedTutorial)||!1})}},zo.\u0275fac=function(t){return new(t||zo)(e.KVO(zt.n$))},zo.\u0275prov=e.jDH({token:zo,factory:zo.\u0275fac}),zo);xe([(0,l.rc)(D.SetAutoplay),te("design:type",Function),te("design:paramtypes",[Object,D.SetAutoplay]),te("design:returntype",void 0)],_e.prototype,"setAutoplay",null),xe([(0,l.rc)(D.SetContentMode),te("design:type",Function),te("design:paramtypes",[Object,D.SetContentMode]),te("design:returntype",void 0)],_e.prototype,"setContentMode",null),xe([(0,l.rc)(D.SetInputEnabled),te("design:type",Function),te("design:paramtypes",[Object,D.SetInputEnabled]),te("design:returntype",void 0)],_e.prototype,"setInputEnabled",null),xe([(0,l.rc)(D.SetCanHover),te("design:type",Function),te("design:paramtypes",[Object,D.SetCanHover]),te("design:returntype",void 0)],_e.prototype,"setCanHover",null),xe([(0,l.rc)(D.SetCanTouch),te("design:type",Function),te("design:paramtypes",[Object,D.SetCanTouch]),te("design:returntype",void 0)],_e.prototype,"setCanTouch",null),xe([(0,l.rc)(D.SetCanFullscreen),te("design:type",Function),te("design:paramtypes",[Object,D.SetCanFullscreen]),te("design:returntype",void 0)],_e.prototype,"setCanFullscreen",null),xe([(0,l.rc)(D.SetSearchDisplayMode),te("design:type",Function),te("design:paramtypes",[Object,D.SetSearchDisplayMode]),te("design:returntype",void 0)],_e.prototype,"setSearchDisplayMode",null),xe([(0,l.rc)(D.SetViewLanguage),te("design:type",Function),te("design:paramtypes",[Object,D.SetViewLanguage]),te("design:returntype",void 0)],_e.prototype,"setViewLanguage",null),xe([(0,l.rc)(D.ToggleNodeInfo),te("design:type",Function),te("design:paramtypes",[Object,D.ToggleNodeInfo]),te("design:returntype",void 0)],_e.prototype,"toggleNodeInfo",null),xe([(0,l.rc)(D.SetNodeInfoConfig),te("design:type",Function),te("design:paramtypes",[Object,D.SetNodeInfoConfig]),te("design:returntype",void 0)],_e.prototype,"setNodeInfoConfig",null),xe([(0,l.rc)(D.TogglePanel),te("design:type",Function),te("design:paramtypes",[Object,D.TogglePanel]),te("design:returntype",void 0)],_e.prototype,"togglePanel",null),xe([(0,l.rc)(D.TogglePresentation),te("design:type",Function),te("design:paramtypes",[Object,D.TogglePresentation]),te("design:returntype",void 0)],_e.prototype,"togglePresentation",null),xe([(0,l.rc)(D.ToggleHelpTab),te("design:type",Function),te("design:paramtypes",[Object,D.ToggleHelpTab]),te("design:returntype",void 0)],_e.prototype,"toggleHelp",null),xe([(0,l.rc)(D.SetFadeout),te("design:type",Function),te("design:paramtypes",[Object,D.SetFadeout]),te("design:returntype",void 0)],_e.prototype,"setFadeout",null),xe([(0,l.rc)(D.SetPreventFadeoutEvent),te("design:type",Function),te("design:paramtypes",[Object,D.SetPreventFadeoutEvent]),te("design:returntype",void 0)],_e.prototype,"addPreventFadeoutElement",null),xe([(0,l.rc)(D.SetPlaythrough),te("design:type",Function),te("design:paramtypes",[Object,D.SetPlaythrough]),te("design:returntype",void 0)],_e.prototype,"setPlaythrough",null),xe([(0,l.rc)(D.SetPlaythroughEnabled),te("design:type",Function),te("design:paramtypes",[Object,D.SetPlaythroughEnabled]),te("design:returntype",void 0)],_e.prototype,"setPlaythroughEnabled",null),xe([(0,l.rc)(D.SetStartingColumn),te("design:type",Function),te("design:paramtypes",[Object,D.SetStartingColumn]),te("design:returntype",void 0)],_e.prototype,"setStartingColumn",null),xe([(0,l.rc)(D.SetPreferredColumn),te("design:type",Function),te("design:paramtypes",[Object,D.SetPreferredColumn]),te("design:returntype",void 0)],_e.prototype,"setPreferredColumn",null),xe([(0,l.rc)(D.SetStartingTool),te("design:type",Function),te("design:paramtypes",[Object,D.SetStartingTool]),te("design:returntype",void 0)],_e.prototype,"setStartingTool",null),xe([(0,l.rc)(D.SetInteractType),te("design:type",Function),te("design:paramtypes",[Object,D.SetInteractType]),te("design:returntype",void 0)],_e.prototype,"setLoaderType",null),xe([(0,l.rc)(D.SetForceAudio),te("design:type",Function),te("design:paramtypes",[Object,D.SetForceAudio]),te("design:returntype",void 0)],_e.prototype,"setForceAudio",null),xe([(0,l.rc)(D.SetOnDemand),te("design:type",Function),te("design:paramtypes",[Object,D.SetOnDemand]),te("design:returntype",void 0)],_e.prototype,"setOnDemand",null),xe([(0,l.rc)(D.SetInputMode),te("design:type",Function),te("design:paramtypes",[Object,D.SetInputMode]),te("design:returntype",void 0)],_e.prototype,"setInputMode",null),xe([(0,l.rc)(D.SetLayout),te("design:type",Function),te("design:paramtypes",[Object,D.SetLayout]),te("design:returntype",void 0)],_e.prototype,"SetLayout",null),xe([(0,l.rc)(D.SetTutorial),te("design:type",Function),te("design:paramtypes",[Object,D.SetTutorial]),te("design:returntype",void 0)],_e.prototype,"setTutorial",null),xe([(0,l.rc)(D.StartTutorial),te("design:type",Function),te("design:paramtypes",[Object,D.StartTutorial]),te("design:returntype",void 0)],_e.prototype,"startTutorial",null),xe([(0,l.rc)(D.TutorialSeen),te("design:type",Function),te("design:paramtypes",[Object,D.TutorialSeen]),te("design:returntype",void 0)],_e.prototype,"tutorialSeen",null),xe([(0,l.rc)(D.TutorialPrevious),te("design:type",Function),te("design:paramtypes",[Object,D.TutorialPrevious]),te("design:returntype",void 0)],_e.prototype,"tutorialPrevious",null),xe([(0,l.rc)(D.TutorialNext),te("design:type",Function),te("design:paramtypes",[Object,D.TutorialNext]),te("design:returntype",void 0)],_e.prototype,"tutorialNext",null),xe([(0,l.rc)(D.SetWhiteboardEnabled),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardEnabled]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardEnabled",null),xe([(0,l.rc)(D.SetWhiteboardLocked),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardLocked]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardLocked",null),xe([(0,l.rc)(D.SetWhiteboardBrushSize),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardBrushSize]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardBrushSize",null),xe([(0,l.rc)(D.SetWhiteboardTextSize),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardTextSize]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardTextSize",null),xe([(0,l.rc)(D.SetWhiteboardEraserSize),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardEraserSize]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardEraserSize",null),xe([(0,l.rc)(D.SetWhiteboardAnnotateMode),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardAnnotateMode]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardAnnotateMode",null),xe([(0,l.rc)(D.SetWhiteboardBrushColor),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardBrushColor]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardBrushColor",null),xe([(0,l.rc)(D.SetWhiteboardHasPaint),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardHasPaint]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardHasPaint",null),xe([(0,l.rc)(D.SetWhiteboardHasText),te("design:type",Function),te("design:paramtypes",[Object,D.SetWhiteboardHasText]),te("design:returntype",void 0)],_e.prototype,"setWhiteboardHasText",null),xe([(0,l.rc)(D.SetMultiPickModeEnabled),te("design:type",Function),te("design:paramtypes",[Object,D.SetMultiPickModeEnabled]),te("design:returntype",void 0)],_e.prototype,"setMultiPickModeEnabled",null),xe([(0,l.rc)(D.SetLabelBreakpoint),te("design:type",Function),te("design:paramtypes",[Object,D.SetLabelBreakpoint]),te("design:returntype",void 0)],_e.prototype,"setLabelBreakpoint",null),xe([(0,l.rc)(D.SetUsePrintImage),te("design:type",Function),te("design:paramtypes",[Object,D.SetUsePrintImage]),te("design:returntype",void 0)],_e.prototype,"setUsePrintImage",null),xe([(0,l.rc)(D.SetWindows),te("design:type",Function),te("design:paramtypes",[Object,D.SetWindows]),te("design:returntype",void 0)],_e.prototype,"setWindows",null),xe([(0,l.rc)(D.SetIsMobileWeb),te("design:type",Function),te("design:paramtypes",[Object,D.SetIsMobileWeb]),te("design:returntype",void 0)],_e.prototype,"setIsMobileWeb",null),xe([(0,l.rc)(D.OpenWindow),te("design:type",Function),te("design:paramtypes",[Object,D.OpenWindow]),te("design:returntype",void 0)],_e.prototype,"openWindow",null),xe([(0,l.rc)(D.CloseWindow),te("design:type",Function),te("design:paramtypes",[Object,D.CloseWindow]),te("design:returntype",void 0)],_e.prototype,"closeWindow",null),xe([(0,l.rc)(D.ToggleWindow),te("design:type",Function),te("design:paramtypes",[Object,D.ToggleWindow]),te("design:returntype",void 0)],_e.prototype,"toggleWindow",null),xe([(0,l.rc)(D.ToggleMenu),te("design:type",Function),te("design:paramtypes",[Object,D.ToggleMenu]),te("design:returntype",void 0)],_e.prototype,"toggleMenu",null),xe([(0,l.rc)(D.ShowScrim),te("design:type",Function),te("design:paramtypes",[Object,D.ShowScrim]),te("design:returntype",void 0)],_e.prototype,"showScrim",null),xe([(0,l.rc)(D.HideScrim),te("design:type",Function),te("design:paramtypes",[Object,D.HideScrim]),te("design:returntype",void 0)],_e.prototype,"hideScrim",null),xe([(0,l.rc)(D.SetChapterCallToActionSeen),te("design:type",Function),te("design:paramtypes",[Object,D.SetChapterCallToActionSeen]),te("design:returntype",void 0)],_e.prototype,"setChapterCallToActionSeen",null),xe([(0,l.rc)(D.ResetViewState),te("design:type",Function),te("design:paramtypes",[Object,D.ResetViewState]),te("design:returntype",void 0)],_e.prototype,"ResetViewState",null),xe([(0,l.rc)(D.SetFocusedElement),te("design:type",Function),te("design:paramtypes",[Object,D.SetFocusedElement]),te("design:returntype",void 0)],_e.prototype,"setFocusedElement",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getAutoplay",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getContentMode",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getLabelsBreakpoint",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getInputEnabled",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getIsMobileWeb",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getFullscreenActive",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getPresentationActive",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getDrawerCoversContent",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getShowNodeInfo",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getNodeInfoFallback",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getOpenPanels",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getViewLanguage",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getInteractType",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getForceAudio",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getOnDemand",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getFadeout",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getFadeoutPaused",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getPlaythroughSettings",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getPlaythroughEnabled",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getPreferredColumn",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getStartingColumn",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getFocusedElement",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getStartingTool",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getLayout",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getInputMode",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getShowHelpTab",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getTutorial",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getTutorialSeen",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardEnabled",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"isWhiteboardLocked",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardBrushSize",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardTextSize",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardEraserSize",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardAnnotateMode",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardBrushColor",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardHasPaint",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getWhiteboardHasText",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getCanTouch",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getCanHover",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getMultiPickModeEnabled",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getSearchDisplayMode",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getUsePrintImage",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getOpenWindow",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getMenuOpen",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getScrim",null),xe([(0,l.MD)(),te("design:type",Function),te("design:paramtypes",[Pt]),te("design:returntype",void 0)],_e,"getChapterCallToActionSeen",null),_e=hc=xe([(0,l.Uw)({name:"view",defaults:gh}),te("design:paramtypes",[zt.n$])],_e);var at=function(n){return n.Hide="hide",n.Show="show",n.Collapse="collapse",n}(at||{}),Es=_(20458),jt=_(7431);let S0=(()=>{var n;class t{constructor(i){this.store=i}chapterHasTransition(i,s){const a=(0,m.get)(i,s?"transitions.pre":"transitions.post");return!!a&&(s?a.onPrevious:a.onNext)}searchChapterTransitions(i,s,r){let a=[...r],d=a.findIndex(ee=>ee.id===i),f=a.findIndex(ee=>ee.id===s);const T=f<d;if(T&&(a=a.reverse(),d=a.findIndex(ee=>ee.id===i),f=a.findIndex(ee=>ee.id===s)),d<0||f<0||d===f)return null;const L=a.slice(d,f).find(ee=>this.chapterHasTransition(ee,T));return L?T?L.transitions.pre:L.transitions.post:null}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Wo,T_=_(62751);!function(n){n.SetHorizontalBreakpoint=(()=>{class s{constructor(a){this.breakpoint=a}}return s.type="[View] Set Horizontal Breakpoint",s})(),n.SetVerticalBreakpoint=(()=>{class s{constructor(a){this.breakpoint=a}}return s.type="[View] Set Vertical Breakpoint",s})()}(Wo||(Wo={}));var Cs,Vn=function(n){return n[n.XSmall=0]="XSmall",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n[n.Large=3]="Large",n[n.XLarge=4]="XLarge",n}(Vn||{}),mc=function(n){return n[n.Tiny=0]="Tiny",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n}(mc||{}),hh=_(99327),xn=_(21082),Ts=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Hn=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class fc{}let In=((Cs=class{static getHorizontalBreakpoint(t){return t.horizontalBreakpoint}static getHorizontalBreakpointLabel(t){return["(max-width: 374px)","(max-width: 599px)","(max-width: 959px)","(max-width: 1439px)","(min-width: 1440px)"][t.horizontalBreakpoint]}static getVerticalBreakpoint(t){return t.verticalBreakpoint}static getVerticalBreakpointLabel(t){return["(max-height: 479px)","(min-height: 480px)","(min-height: 375px)"][t.verticalBreakpoint]}setBreakpoint(t,o){t.patchState({horizontalBreakpoint:o.breakpoint})}setVerticalBreakpoint(t,o){t.patchState({verticalBreakpoint:o.breakpoint})}constructor(t,o){this.breakpointObserver=t,this.store=o}ngxsOnInit(t){this.initHorizontalBreakpointObserver(t),this.initVerticalBreakpointObserver(t)}initHorizontalBreakpointObserver(t){const o=this.breakpointObserver.observe(["(max-width: 374px)"]),i=this.breakpointObserver.observe(["(max-width: 599px)"]),s=this.breakpointObserver.observe(["(max-width: 959px)"]),r=this.breakpointObserver.observe(["(max-width: 1439px)"]),a=this.breakpointObserver.observe(["(min-width: 1440px)"]);(0,Ht.z)([o,i,s,r,a]).pipe((0,le.T)(([d,f,T,L,ee])=>d.matches?Vn.XSmall:f.matches?Vn.Small:T.matches?Vn.Medium:L.matches?Vn.Large:ee.matches?Vn.XLarge:null),(0,xn.F)(),(0,S.p)(d=>null!=d)).subscribe(d=>{t.dispatch(new Wo.SetHorizontalBreakpoint(d))})}initVerticalBreakpointObserver(t){const o=this.breakpointObserver.observe(["(max-height: 374px)"]),i=this.breakpointObserver.observe(["(max-height: 479px)"]),s=this.breakpointObserver.observe(["(min-height: 480px)"]);(0,Ht.z)([o,i,s]).pipe((0,le.T)(([r,a,d])=>r.matches?mc.Tiny:a.matches?mc.Small:d.matches?mc.Medium:null),(0,xn.F)(),(0,S.p)(r=>null!=r)).subscribe(r=>{t.dispatch(new Wo.SetVerticalBreakpoint(r))})}}).\u0275fac=function(t){return new(t||Cs)(e.KVO(hh.QP),e.KVO(l.il))},Cs.\u0275prov=e.jDH({token:Cs,factory:Cs.\u0275fac}),Cs);Ts([(0,l.rc)(Wo.SetHorizontalBreakpoint),Hn("design:type",Function),Hn("design:paramtypes",[Object,Wo.SetHorizontalBreakpoint]),Hn("design:returntype",void 0)],In.prototype,"setBreakpoint",null),Ts([(0,l.rc)(Wo.SetVerticalBreakpoint),Hn("design:type",Function),Hn("design:paramtypes",[Object,Wo.SetVerticalBreakpoint]),Hn("design:returntype",void 0)],In.prototype,"setVerticalBreakpoint",null),Ts([(0,l.MD)(),Hn("design:type",Function),Hn("design:paramtypes",[fc]),Hn("design:returntype",void 0)],In,"getHorizontalBreakpoint",null),Ts([(0,l.MD)(),Hn("design:type",Function),Hn("design:paramtypes",[fc]),Hn("design:returntype",void 0)],In,"getHorizontalBreakpointLabel",null),Ts([(0,l.MD)(),Hn("design:type",Function),Hn("design:paramtypes",[fc]),Hn("design:returntype",void 0)],In,"getVerticalBreakpoint",null),Ts([(0,l.MD)(),Hn("design:type",Function),Hn("design:paramtypes",[fc]),Hn("design:returntype",void 0)],In,"getVerticalBreakpointLabel",null),In=Ts([(0,l.Uw)({name:"breakpoint",defaults:{horizontalBreakpoint:null,verticalBreakpoint:null}}),Hn("design:paramtypes",[hh.QP,l.il])],In);var G=function(n){return n.AnatomyLabels="anatomyLabels",n.Audio="audio",n.Camera="camera",n.Column="column",n.ColumnToggle="columnToggle",n.ContextActions="contextActions",n.ContextMenu="contextMenu",n.Description="description",n.Drawer="drawer",n.DrawerToggle="drawerToggle",n.DrawerExpanded="drawerExpanded",n.Fullscreen="fullscreen",n.Help="help",n.LabelList="labelList",n.Labels="labels",n.VisibilityLayers="visibilityLayers",n.VisibilityLayersMode="visibilityLayersMode",n.SkinLayers="skinLayers",n.Layout="layout",n.Legend="legend",n.Loader="loader",n.Logo="logo",n.Media="media",n.ToolbarOverflow="toolbarOverflow",n.NodeInfo="nodeInfo",n.NodeAudio="nodeAudio",n.Pagination="pagination",n.Playthrough="playthrough",n.QuizPrompt="quizPrompt",n.Search="search",n.TitleOnly="titleOnly",n.ToggleLabels="toggleLabels",n.Toolbar="toolbar",n.Tools="tools",n.Tutorial="tutorial",n.Undo="undo",n.Whiteboard="whiteboard",n}(G||{}),Oo=function(n){return n.None="none",n.Circle="circle",n.Bar="bar",n}(Oo||{});const O_=I.c.application===Wn.c.Viewer?Oo.Bar:Oo.Circle;var Qn=function(n){return n.Drawer="drawer",n.Column="column",n}(Qn||{});let M_=(()=>{class t{constructor(i,s,r){this.storyLoadProgress=i,this.chapterId=s,this.chapterProgress=r}}return t.type="[Engine Progress] Set Progress",t})(),Sc=(()=>{class t{constructor(){}}return t.type="[Engine Progress] Reset Progress",t})();var Os,ha=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Pi=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const mh={storyLoadProgress:0,chapterLoadProgress:{}};let Ei=((Os=class{constructor(){}static getStoryLoadProgress(t){return t.storyLoadProgress}static getChaptersLoadProgress(t){return t.chapterLoadProgress}setProgress(t,o){const{storyLoadProgress:i,chapterId:s,chapterProgress:r}=o;t.patchState({storyLoadProgress:i,chapterLoadProgress:{...t.getState().chapterLoadProgress,[s]:r}})}resetProgress(t,o){t.setState({...mh})}}).\u0275fac=function(t){return new(t||Os)},Os.\u0275prov=e.jDH({token:Os,factory:Os.\u0275fac}),Os);ha([(0,l.rc)(M_),Pi("design:type",Function),Pi("design:paramtypes",[Object,M_]),Pi("design:returntype",void 0)],Ei.prototype,"setProgress",null),ha([(0,l.rc)(Sc),Pi("design:type",Function),Pi("design:paramtypes",[Object,Sc]),Pi("design:returntype",void 0)],Ei.prototype,"resetProgress",null),ha([(0,l.MD)(),Pi("design:type",Function),Pi("design:paramtypes",[Object]),Pi("design:returntype",void 0)],Ei,"getStoryLoadProgress",null),ha([(0,l.MD)(),Pi("design:type",Function),Pi("design:paramtypes",[Object]),Pi("design:returntype",void 0)],Ei,"getChaptersLoadProgress",null),Ei=ha([(0,l.Uw)({name:"engineProgress",defaults:mh}),Pi("design:paramtypes",[])],Ei);var Dn,Hi=function(n){return n.None="none",n.Small="small",n.Full="full",n}(Hi||{}),cr=function(n){return n.Single="single",n.Group="group",n}(cr||{});class nn{constructor(t=at.Hide,o=!0){this.status=t,this.enable=o}}class fh extends nn{constructor(t){super(),this.userStatusPreference=t}}!function(n){n.ToggleVisible=(()=>{class r{constructor(d){this.settings=d}}return r.type="[ViewUI] Toggle Visible",r})(),n.SetUI=(()=>{class r{constructor(d){this.ui=d}}return r.type="[ViewUI] Set UI",r})(),n.SetInitialUI=(()=>{class r{constructor(d){this.ui=d}}return r.type="[ViewUI] Set Initial UI",r})()}(Dn||(Dn={}));var Xo,bc,Ms=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Jn=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const I_={[G.Audio]:new nn,[G.AnatomyLabels]:new nn,[G.Camera]:new nn,[G.Column]:new fh(null),[G.ColumnToggle]:new nn,[G.ContextActions]:new nn,[G.ContextMenu]:new nn(at.Show,!0),[G.Description]:new nn,[G.Drawer]:new class v0 extends fh{constructor(){super(...arguments),this.isExpandedInitially=!1}}(null),[G.DrawerToggle]:new nn,[G.Fullscreen]:new nn,[G.Help]:new nn,[G.Labels]:new class O0 extends nn{constructor(t=!0){super(),this.shown=t}},[G.LabelList]:new nn(at.Show,!1),[G.Legend]:new nn,[G.Loader]:new class T0 extends nn{constructor(t=O_){super(),this.template=t}},[G.Logo]:new class E0 extends nn{constructor(t=!0){super(),this.isHyperLink=t}},[G.Media]:new class C0 extends nn{constructor(t=Hi.Full,o=at.Hide){super(o),this.template=t,this.status=o}},[G.NodeInfo]:new nn(at.Hide,!1),[G.NodeAudio]:new nn,[G.Playthrough]:new nn(at.Hide,!1),[G.Pagination]:new nn,[G.QuizPrompt]:new nn,[G.Search]:new nn,[G.TitleOnly]:new nn,[G.ToggleLabels]:new nn,[G.Toolbar]:new nn,[G.ToolbarOverflow]:new nn(at.Show,!1),[G.Tools]:new nn,[G.Tutorial]:new nn(at.Hide,!1),[G.Undo]:new nn,[G.VisibilityLayers]:new class M0 extends nn{constructor(t=cr.Single){super(),this.layersMode=t}},[G.SkinLayers]:new nn(at.Show,!0),[G.Whiteboard]:new nn};class w_{}const I0={visible:{[G.Audio]:!1,[G.AnatomyLabels]:!1,[G.Camera]:!1,[G.Column]:!1,[G.ColumnToggle]:!1,[G.ContextActions]:!1,[G.Description]:!1,[G.Drawer]:!1,[G.DrawerToggle]:!1,[G.Fullscreen]:!1,[G.Help]:!1,[G.Labels]:!1,[G.LabelList]:!1,[G.Legend]:!1,[G.Logo]:!1,[G.Media]:!1,[G.ToolbarOverflow]:!1,[G.NodeInfo]:!1,[G.NodeAudio]:!1,[G.Pagination]:!1,[G.Playthrough]:!1,[G.QuizPrompt]:!1,[G.Search]:!1,[G.ToggleLabels]:!1,[G.TitleOnly]:!1,[G.Toolbar]:!1,[G.Tools]:!1,[G.Tutorial]:!1,[G.Undo]:!1,[G.VisibilityLayers]:!1,[G.SkinLayers]:!1,[G.Whiteboard]:!1},ui:I_,initialUI:I_};let Be=(bc=Xo=class{static getVisible(t){return(0,l.Mz)([bc],o=>o.visible[t])}static getUIEntry(t){return(0,l.Mz)([bc],o=>o.ui[t])}static getSearchStatus(t){return t.ui.search.status}static getUI(t){return t.ui}static getInitialUI(t){return t.initialUI}toggleVisible(t,o){const i=t.getState().visible;Object.entries(o.settings).forEach(([s,r])=>{i[s]=r}),t.patchState({visible:i})}setUI(t,o){const i=t.getState().ui;t.patchState({ui:{...i,...o.ui}})}setInitialUI(t,o){const i=t.getState().ui;t.patchState({initialUI:{...i,...o.ui}})}},Xo.\u0275fac=function(t){return new(t||Xo)},Xo.\u0275prov=e.jDH({token:Xo,factory:Xo.\u0275fac}),Xo);Ms([(0,l.rc)(Dn.ToggleVisible),Jn("design:type",Function),Jn("design:paramtypes",[Object,Dn.ToggleVisible]),Jn("design:returntype",void 0)],Be.prototype,"toggleVisible",null),Ms([(0,l.rc)(Dn.SetUI),Jn("design:type",Function),Jn("design:paramtypes",[Object,Dn.SetUI]),Jn("design:returntype",void 0)],Be.prototype,"setUI",null),Ms([(0,l.rc)(Dn.SetUI),Jn("design:type",Function),Jn("design:paramtypes",[Object,Dn.SetUI]),Jn("design:returntype",void 0)],Be.prototype,"setInitialUI",null),Ms([(0,l.MD)(),Jn("design:type",Function),Jn("design:paramtypes",[w_]),Jn("design:returntype",void 0)],Be,"getSearchStatus",null),Ms([(0,l.MD)(),Jn("design:type",Function),Jn("design:paramtypes",[w_]),Jn("design:returntype",void 0)],Be,"getUI",null),Ms([(0,l.MD)(),Jn("design:type",Function),Jn("design:paramtypes",[w_]),Jn("design:returntype",void 0)],Be,"getInitialUI",null),Be=bc=Ms([(0,l.Uw)({name:"viewUI",defaults:I0})],Be);var w0=_(97953);class P0{get currentPlayer(){return this.players[this.index]}constructor(t){this.players=t,this.index=0,this.isPlaying=!1,this.eventSubject=new Q.B,this.ngUnsubscribe=new Q.B,this.loadState="unloaded",this.totalDuration=0,this.init()}state(){return this.loadState}duration(){return this.totalDuration}play(){this.currentPlayer&&this.currentPlayer.play()}pause(){this.currentPlayer&&this.currentPlayer.pause()}stop(){this.currentPlayer&&this.currentPlayer.stop(),this.index=0}seek(t){if(this.currentPlayer)return this.currentPlayer.seek(t)}rate(t){if(this.currentPlayer)return this.currentPlayer.rate(t)}mute(t){if(this.currentPlayer){if((0,m.isNil)(t))return this.currentPlayer.mute();this.currentPlayer.mute(t)}}playing(){return!!this.currentPlayer&&this.currentPlayer.playing()}on(t,o){this.eventSubject.asObservable().pipe((0,S.p)(i=>i===t),(0,b.Q)(this.ngUnsubscribe)).subscribe(o)}load(){this.players.forEach(t=>t.load())}unload(){this.players.forEach(t=>t.unload()),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){const t=this.players.length;let o=0;this.players.forEach((i,s)=>{i.on("load",()=>{this.totalDuration+=i.duration(),o++,o>=t&&(this.eventSubject.next("load"),this.loadState="loaded")}),i.on("play",()=>{"unloaded"===this.loadState&&(this.loadState="loading"),this.isPlaying||this.eventSubject.next("play"),this.isPlaying=!0,this.index=s}),i.on("pause",()=>{this.isPlaying=!1,this.eventSubject.next("pause")}),i.on("end",()=>{if(this.isPlaying){const a=this.players[s+1];a?a.play():(this.isPlaying=!1,this.index=0,this.eventSubject.next("end"))}}),i.on("stop",()=>{this.isPlaying=!1,this.eventSubject.next("stop")}),i.on("loaderror",()=>{this.eventSubject.next("loaderror")}),i.on("playerror",()=>{this.eventSubject.next("playerror")})})}}var Ai=_(28577),Rt=_(15877);Math.pow(1024,2),Math.pow(1024,2),Math.pow(1024,3);const Sh={".svg":["image/svg+xml"],".jpg":["image/jpeg"],".jpeg":["image/jpeg"],".png":["image/png"],".aac":["audio/aac"],".m4a":["audio/mp4","audio/x-m4a"],".mp3":["audio/mpeg"],".webm":["video/webm"],".mpg":["video/mpeg"],".mp2":["video/mpeg"],".mpeg":["video/mpeg"],".mpe":["video/mpeg"],".mpv":["video/x-mpv"],".ogg":["video/ogg"],".mp4":["video/mp4"],".m4p":["video/mp4","video/x-m4p"],".m4v":["video/mp4","video/x-m4v"],".avi":["video/x-msvideo"],".wmv":["video/x-ms-wmv"],".mov":["video/quicktime"],".qt":["video/quicktime"],".flv":["video/x-flv"],".swf":["application/x-shockwave-flash"],".mpd":["application/dash+xml"],".m3u8":["application/x-mpegURL"]};var ro=_(68947);const L0=0,bh={eng:"en",spa:"es",cmn:"zh",fra:"fr",deu:"de",ita:"it",jpn:"ja",por:"pt"},U0=Object.keys(bh);function yh(n){return P_.apply(this,arguments)}function P_(){return P_=(0,Ct.A)(function*(n){return _.e(17).then(_.bind(_,16017)).then(t=>function j0(n,t){const o=n.franc(t,{minLength:L0,only:U0}),i=bh[o];return bn.IB.find(r=>r.lang===i)?.id}(t,n))}),P_.apply(this,arguments)}const V0="mp3",Eh={voiceId:"Amy",voiceLocaleId:"en-GB",supportedLocaleIds:["en-US"],engine:"neural"},x0=[Eh,{voiceId:"Mia",voiceLocaleId:"es-MX",supportedLocaleIds:["es-ES"],engine:"neural"},{voiceId:"Zhiyu",voiceLocaleId:"cmn-CN",supportedLocaleIds:["zh-CN"],engine:"neural"},{voiceId:"Lea",voiceLocaleId:"fr-FR",supportedLocaleIds:[],engine:"neural"},{voiceId:"Vicki",voiceLocaleId:"de-DE",supportedLocaleIds:[],engine:"neural"},{voiceId:"Bianca",voiceLocaleId:"it-IT",supportedLocaleIds:[],engine:"neural"},{voiceId:"Takumi",voiceLocaleId:"ja-JP",supportedLocaleIds:["ja"],engine:"neural"},{voiceId:"Camila",voiceLocaleId:"pt-BR",supportedLocaleIds:["pt-PT"],engine:"neural"}];function Ch(n,t){return(n.length>3e3?ro.l.splitTextByCharacterCount(n,3e3):[n]).map(s=>function F0(n,t){const s=function G0(n){return x0.find(t=>{const{voiceLocaleId:o,supportedLocaleIds:i}=t;return o===n||i.includes(n)})}(t)??Eh,{voiceId:r,engine:a,voiceLocaleId:d}=s;return`/ws/polly/synthesize?text=${encodeURIComponent(n)}&voice_id=${r}&format=${V0}&lang=${d}&engine=${a}&version=2`}(s,t))}var _i,qn=function(n){return n.File="file",n.TTS="tts",n.None="none",n}(qn||{});!function(n){n.SetAudioMuted=(()=>{class r{constructor(d){this.mute=d}}return r.type="[Media] Set Audio Muted",r})(),n.SetAutoplayAudio=(()=>{class r{constructor(d){this.autoplay=d}}return r.type="[Media] Set Autoplay Audio",r})(),n.ResetAudio=(()=>{class r{constructor(){}}return r.type="[Media] Reset Audio",r})()}(_i||(_i={}));var pi=_(35286);const Th="/media/audio",z0=new RegExp(`^${Th}/(.*)/.*$`),W0=["aac","m4a","mp3","ogg"],Oh={aac:"audio/aac",m4a:"audio/mp4",mp3:"audio/mpeg",ogg:"audio/ogg"};Howler.autoUnlock=!1;let Ci=(()=>{var n;class t{constructor(i,s,r,a,d){this.http=s,this.markdownService=r,this.animationService=a,this.store=d,this.audioPromises=new Map,this.audioPlayers=new Map,this.audioEventSubject=new Q.B,this.videoPlayers=new Map,this.videoEventSubject=new Q.B,this.videoSources=new Map,this.renderer=i.createRenderer(null,null)}addAudioPlayer(i,s,r,a={}){var d=this;return(0,Ct.A)(function*(){d.removeAudioPlayer(i);const f=s.then(ee=>d.createAudioPlayer(ee,r,a));d.audioPromises.set(i,f);const T=yield f,L=()=>{T.playing()&&(d.audioEventSubject.next({event:"playing",id:i,data:{time:T.seek()}}),requestAnimationFrame(L))};return T.on("load",()=>{d.audioEventSubject.next({event:"load",id:i})}),T.on("play",()=>{d.audioEventSubject.next({event:"play",id:i}),L()}),T.on("pause",()=>{d.audioEventSubject.next({event:"pause",id:i})}),T.on("stop",()=>{d.audioEventSubject.next({event:"stop",id:i})}),T.on("seek",()=>{d.audioEventSubject.next({event:"seek",id:i,data:{time:T.seek()}})}),T.on("end",()=>{d.audioEventSubject.next({event:"end",id:i})}),T.on("playerror",()=>{d.audioEventSubject.next({event:"playerror",id:i})}),d.audioPlayers.set(i,T),T})()}createAudioPlayer(i,s,r){var a=this;return(0,Ct.A)(function*(){if(s){const d=yield a.createAudioDataUrl(i);return a.createSinglePlayer(d,r)}return i.length>1?a.createSinglePlayer(i[0],r):a.createMultiPlayer(i,r)})()}createSinglePlayer(i,s){return new w0.Howl({...s,src:i,format:W0})}createMultiPlayer(i,s){const r=i.map(a=>this.createSinglePlayer(a,s));return new P0(r)}removeAudioPlayer(i){var s=this;return(0,Ct.A)(function*(){const r=s.audioPromises.get(i);if(s.audioPromises.delete(i),s.audioPlayers.delete(i),r)return r.then(a=>a.unload())})()}getAudioPlayer(i){var s=this;return(0,Ct.A)(function*(){return s.audioPromises.get(i)})()}hasAudioPlayer(i){return this.audioPromises.has(i)}removeAllAudioPlayers(){this.audioPromises.forEach((i,s)=>this.removeAudioPlayer(s))}createAudioUploadEvent(i){return{type:"uploadFile",url:"/ws/media/audio/upload",method:"POST",file:i}}getAudioEvents(){return this.audioEventSubject.asObservable()}getAudioClips(i){return Object.values(i).filter(s=>"audio"===s.streamType)}createAudioClip(i,s,r){const a=this.getAudioUUID(s),{firstTime:d,lastTime:f}=this.animationService.getChapterTimeFrame();return[a,{clipId:a,streamType:"audio",fullUrl:s,time1:d,time2:f,lang:r}]}createAudioDataUrl(i){return(0,Ct.A)(function*(){const s=i.map(r=>fetch(r).then(a=>a.blob()));return Promise.all(s).then(r=>{const a=i[0].split(".").pop();return URL.createObjectURL(new Blob(r,{type:Oh[a]||Oh.mp3}))})})()}getDuration(i){return(0,Ct.A)(function*(){return"loaded"===i.state()?i.duration():new Promise(s=>{i.on("load",()=>{s(i.duration())})})})()}getTTSSources(i,s=bn.q.id){var r=this;return(0,Ct.A)(function*(){const a=yield ro.l.getPlainTextFromMarkdown(r.renderer,r.markdownService,i||"",!0);return Ch(a,(yield yh(a))||s)})()}getAudioUUID(i){return i.match(z0)[1]}getAudioSrc(i){return i.match(Th)?i:`/content/states/${i}`}muteAudio(){this.audioPlayers.forEach(i=>{i.mute(!0)})}unmuteAudio(i){const s=this.audioPlayers.get(i);s&&(s.mute(!1),this.store.dispatch(new _i.SetAudioMuted(!1)))}stopAllAudio(){this.stopAudio()}stopAllOtherAudio(i){this.stopAudio(i)}stopAudio(i){this.audioPlayers.forEach((s,r)=>{(!i||r!==i)&&s.stop()})}playAudio(i,s){this.getAudioPlayer(i).then(r=>{r&&((0,m.isNil)(s)||(r.mute(s),this.store.dispatch(new _i.SetAudioMuted(s))),r.play())})}playChapterAudio(i){this.stopAllAudio(),this.playAudio(i,!1),this.store.dispatch(new _i.SetAutoplayAudio(!0)),this.store.dispatch(new _i.SetAudioMuted(!1))}getPlayingAudio(){const i=[];return this.audioPlayers.forEach(s=>{s.playing()&&i.push(s)}),i}getChapterAudioPlayer(i,s,r=!1){var a=this;return(0,Ct.A)(function*(){return a.getChapterAudioPlaybackType(i,s,r)!==qn.None?a.hasAudioPlayer(i.id)?yield a.getAudioPlayer(i.id):yield a.createChapterAudioPlayer(i,s,r):null})()}createChapterAudioPlayer(i,s,r=!1){var a=this;return(0,Ct.A)(function*(){const d=a.getChapterAudioPlaybackType(i,s,r),f=a.buildChapterAudioSources(i,d,s);return d===qn.None?null:yield a.addAudioPlayer(i.id,f,!0,{preload:!0,mute:!0})})()}buildChapterAudioSources(i,s,r){var a=this;return(0,Ct.A)(function*(){const f=a.getChapterAudioInLanguage(i,r)?.fullUrl??"",T=i?.description,L=bn.IB.find(ee=>ee.lang===r);switch(s){case qn.File:return f?[a.getAudioSrc(f)]:[];case qn.TTS:return a.getTTSSources(T,L?.id);default:return[]}})()}getChapterAudioList(i){return i.media?Object.values(i.media).filter(r=>"audio"===r.streamType):[]}getChapterAudioInLanguage(i,s){return this.getChapterAudioList(i).find(a=>a.lang===s)}getChapterAudioPlaybackType(i,s,r=!1){let a=i?.ui?.config?.audio??qn.File;const d=!(0,m.isNil)(this.getChapterAudioList(i).find(T=>T.lang===s));r&&!d&&a!==qn.TTS&&(a=qn.TTS);const f=(0,m.trim)(i?.description??"").length>0;switch(a){case qn.File:return d?qn.File:qn.None;case qn.TTS:return f?qn.TTS:qn.None;default:return qn.None}}chapterHasAudio(i,s){return this.getChapterAudioPlaybackType(i,s)!==qn.None}getVideoPlayer(i){return this.videoPlayers.get(i)}createVideoPlayer(i,s){return(0,Ct.A)(function*(){return(0,(yield _.e(78).then(_.bind(_,37078))).default)(i,s)})()}getVideoEvents(){return this.videoEventSubject.asObservable()}addVideoPlayer(i,s){var r=this;return(0,Ct.A)(function*(){const a=yield r.createVideoPlayer(i,s),d=a.id();return a.on("play",()=>{r.videoEventSubject.next({event:"play",id:d})}),a.on("pause",()=>{r.videoEventSubject.next({event:"pause",id:d})}),a.on("seeking",()=>{r.videoEventSubject.next({event:"seeking",id:d})}),a.on("ended",()=>{r.videoEventSubject.next({event:"ended",id:d})}),a.on("error",()=>{r.videoEventSubject.next({event:"error",id:d})}),r.videoPlayers.set(d,a),d})()}removeVideoPlayer(i){const s=this.getVideoPlayer(i);s&&(s.dispose(),this.videoPlayers.delete(i))}getVideoUrls(i){return this.http.post("/ws/mc/video/upload/authorize",{filename:i})}checkVideoStatus(i){return this.videoSources.has(i)?new y.c(s=>{s.next(this.videoSources.get(i)),s.complete()}):this.http.get(i).pipe((0,le.T)(s=>{const r=s.listing.map(a=>({src:a,type:this.getFileMIMEType(a)}));return this.videoSources.set(i,r),r}),(0,Ai.W)(()=>(0,Rt.of)(!1)))}getFileMIMEType(i){const s=i.split(".").pop(),r=Sh[`.${s}`];return r?r[0]:""}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(e._9s),e.KVO(w.Qq),e.KVO(pi.Rl),e.KVO(zi.O),e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();class Vi{}let Mh=(()=>{class t{constructor(i,s){this.query=i,this.lang=s}}return t.type="[Bookmarks] Load",t})(),Ih=(()=>{class t{constructor(i,s,r){this.organizationId=i,this.query=s,this.lang=r}}return t.type="[Bookmarks] Load Organization Bookmarks",t})(),wh=(()=>{class t{constructor(i,s,r,a){this.organizationId=i,this.collectionId=s,this.query=r,this.lang=a}}return t.type="[Bookmarks] Load Collection Bookmarks",t})(),A_=(()=>{class t{constructor(i,s,r=!1){this.id=i,this.type=s,this.preview=r}}return t.type="[Bookmarks] Select Bookmark",t})(),N_=(()=>{class t{constructor(i){this.bookmark=i}}return t.type="[Bookmarks] Select Bookmark Success",t})(),ma=(()=>{class t{constructor(i){this.result=i}}return t.type="[Bookmarks] Load Success",t})(),Ph=(()=>{class t{constructor(i){this.bookmarkId=i}}return t.type="[Bookmarks] Delete Bookmark",t})(),R_=(()=>{class t{constructor(i){this.bookmarkId=i}}return t.type="[Bookmarks] Bookmark Delete Success",t})(),X0=(()=>{class t{constructor(i,s){this.bookmarkId=i,this.error=s}}return t.type="[Bookmarks] Bookmark Delete Fail",t})(),Ah=(()=>{class t{constructor(i,s,r=!0){this.bookmarkEntry=i,this.inplace=s,this.includeIndex=r}}return t.type="[Bookmarks] Save Bookmark",t})(),yc=(()=>{class t{constructor(i,s,r){this.bookmark=i,this.story=s,this.method=r}}return t.type="[Bookmarks] Bookmark Saved",t})(),D_=(()=>{class t{constructor(i,s){this.bookmarkEntry=i,this.error=s}}return t.type="[Bookmarks] Bookmark Save Failed",t})(),Nh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Cancel Save Bookmark",t})(),k_=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Reset",t})(),Rh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Clear Bookmarks",t})(),Dh=(()=>{class t{constructor(i){this.sort=i}}return t.type="[Bookmarks] Sort",t})(),kh=(()=>{class t{constructor(i,s){this.id=i,this.checked=s}}return t.type="[Bookmarks] Check Bookmark",t})(),Lh=(()=>{class t{constructor(i){this.ids=i}}return t.type="[Bookmarks] Set Checked Bookmarks",t})(),Uh=(()=>{class t{constructor(i,s,r,a,d,f,T,L,ee){this.bookmarks=i,this.organizationId=s,this.collections=r,this.widgetURL=a,this.userLanguage=d,this.userApp=f,this.widgetOptions=T,this.offlineEnabled=L,this.productAccountId=ee}}return t.type="[Bookmarks] Export Bookmarks",t})(),H0=(()=>{class t{constructor(i){this.bookmarks=i}}return t.type="[Bookmarks] Export Bookmarks Success",t})(),Q0=(()=>{class t{constructor(i){this.bookmarks=i}}return t.type="[Bookmarks] Export Bookmarks Error",t})(),L_=(()=>{class t{constructor(i,s=[],r=new Map){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return t.type="[Bookmarks] Update Bookmark Collections",t})(),jh=(()=>{class t{constructor(i,s,r){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return t.type="[Bookmarks] Update Bookmark Collections Success",t})(),Vh=(()=>{class t{constructor(i,s,r){this.bookmark=i,this.addCollections=s,this.removeCollections=r}}return t.type="[Bookmarks] Update Bookmark Collections Error",t})(),Y0=(()=>{class t{constructor(i,s){this.bookmark=i,this.collections=s}}return t.type="[Bookmarks] Add Bookmark Collections Success",t})(),K0=(()=>{class t{constructor(i,s){this.bookmark=i,this.collections=s}}return t.type="[Bookmarks] Add Bookmark Collections Error",t})(),U_=(()=>{class t{constructor(i,s){this.bookmark=i,this.collections=s}}return t.type="[Bookmarks] Remove Bookmark Collections Success",t})(),J0=(()=>{class t{constructor(i,s){this.bookmark=i,this.collections=s}}return t.type="[Bookmarks] Remove Bookmark Collections Error",t})(),xh=(()=>{class t{constructor(i,s,r,a=bn.q.lang,d,f){this.id=i,this.title=s,this.type=r,this.lang=a,this.groupAccess=d,this.collections=f}}return t.type="[Bookmarks] Copy Bookmark",t})(),q0=(()=>{class t{constructor(i){this.newBookmark=i}}return t.type="[Bookmarks] Copy Bookmark Success",t})(),Z0=(()=>{class t{constructor(i,s){this.id=i,this.error=s}}return t.type="[Bookmarks] Copy Bookmark Failure",t})(),Fh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Cancel Copy Bookmark",t})(),Gh=(()=>{class t{constructor(i){this.title=i}}return t.type="[Bookmarks] Set Bookmark Text",t})(),$h=(()=>{class t{constructor(i){this.viewMode=i}}return t.type="[Bookmarks] Set Bookmark View Mode",t})(),Bh=(()=>{class t{constructor(i){this.category=i}}return t.type="[Bookmarks] Set Selected Category",t})(),fa=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Get Bookmark Jobs",t})(),j_=(()=>{class t{constructor(i){this.bookmarkJobs=i}}return t.type="[Bookmarks] Set Bookmark Jobs",t})(),V_=(()=>{class t{constructor(i){this.bookmarkJobs=i}}return t.type="[Bookmarks] Get Bookmark Jobs Success",t})(),e1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Bookmarks] Get Bookmark Jobs Failure",t})(),zh=(()=>{class t{constructor(i,s){this.jobId=i,this.jobType=s}}return t.type="[Bookmarks] Cancel Bookmark Job",t})(),t1=(()=>{class t{constructor(i,s){this.jobId=i,this.jobType=s}}return t.type="[Bookmarks] Cancel Bookmark Job Success",t})(),n1=(()=>{class t{constructor(i,s,r){this.jobId=i,this.jobType=s,this.error=r}}return t.type="[Bookmarks] Cancel Bookmark Job Fail",t})(),Wh=(()=>{class t{constructor(i){this.copyBookmarkModels=i}}return t.type="[Bookmarks] Bulk Copy Bookmarks",t})(),i1=(()=>{class t{constructor(i,s){this.copyBookmarkModels=i,this.jobId=s}}return t.type="[Bookmarks] Bulk Copy Bookmarks Processing",t})(),Xh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Bulk Copy Bookmarks Error",t})(),Hh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Bulk Copy Bookmarks Complete",t})(),o1=(()=>{class t{constructor(i,s){this.copyBookmarkModels=i,this.error=s}}return t.type="[Bookmarks] Bulk Copy Bookmarks Failure",t})(),Qh=(()=>{class t{constructor(i){this.bookmarkIds=i}}return t.type="[Bookmarks] Bulk Delete Bookmark",t})(),s1=(()=>{class t{constructor(i,s){this.deleteBookmarkIds=i,this.jobId=s}}return t.type="[Bookmarks] Bookmark Bulk Delete Processing",t})(),Yh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Bookmark Bulk Delete Complete",t})(),r1=(()=>{class t{constructor(i,s){this.bookmarkIds=i,this.error=s}}return t.type="[Bookmarks] Bookmark Bulk Delete Fail",t})(),Kh=(()=>{class t{constructor(){}}return t.type="[Bookmarks] Bulk Delete Bookmarks Error",t})(),Jh=(()=>{class t{constructor(i,s){this.groupId=i,this.updates=s}}return t.type="[Bookmarks] Bulk Update Bookmark Collections",t})(),a1=(()=>{class t{constructor(i){this.updates=i}}return t.type="[Bookmarks] Bulk Update Bookmark Collections Success",t})(),l1=(()=>{class t{constructor(i,s){this.updates=i,this.error=s}}return t.type="[Bookmarks] Bulk Update Bookmark Collections Error",t})();var bt=_(15152),Cn=_(11756),Is=_(39705),vc=_(64346),dr=_(19833),Ec=_(38399),qh=_(45326);class c1{}var _r=function(n){return n.UserGeneratedTour="user_generated_tour",n.Animated="animated",n.Quiz="quiz",n.ModeQuiz="mode_quiz",n.ModeContent="mode_content",n}(_r||{}),Ho=function(n){return n.Private="private",n.Group="enterprise",n.Public="public",n}(Ho||{});let x_=(()=>{class t{constructor(){}}return t.type="[Auth] Is Logged In",t})(),Cc=(()=>{class t{constructor(i){this.sessionType=i}}return t.type="[Auth] Is Logged In Success",t})(),Tc=(()=>{class t{constructor(i){this.sessionType=i}}return t.type="[Auth] Is Logged In Failure",t})(),Zh=(()=>{class t{constructor(i,s){this.login=i,this.verification=s}}return t.type="[Auth] Login With Biodigital",t})(),em=(()=>{class t{constructor(){}}return t.type="[Auth] Initialize Google Auth",t})(),d1=(()=>{class t{constructor(i){this.credential=i}}return t.type="[Auth] Authenticate With Google",t})(),_1=(()=>{class t{constructor(){}}return t.type="[Auth] Prompt With Google",t})(),F_=(()=>{class t{constructor(i){this.promptResult=i}}return t.type="[Auth] Prompt With Google Success",t})(),tm=(()=>{class t{constructor(i){this.login=i}}return t.type="[Auth] Login With Google",t})(),nm=(()=>{class t{constructor(i){this.login=i}}return t.type="[Auth] Login With Group",t})(),Sa=(()=>{class t{constructor(i,s){this.loginType=i,this.response=s}}return t.type="[Auth] Login Success",t})(),ba=(()=>{class t{constructor(i,s,r){this.loginType=i,this.error=s,this.login=r}}return t.type="[Auth] Login Failure",t})(),im=(()=>{class t{constructor(){}}return t.type="[Auth] Logout",t})(),G_=(()=>{class t{constructor(){}}return t.type="[Auth] Logout Success",t})(),p1=(()=>{class t{constructor(){}}return t.type="[Auth] Logout Failure",t})(),om=(()=>{class t{constructor(){}}return t.type="[Auth] Get Environment Settings",t})(),$_=(()=>{class t{constructor(i){this.environmentSettings=i}}return t.type="[Auth] Get Environment Settings Success",t})(),u1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Get Environment Settings Failure",t})(),B_=(()=>{class t{constructor(){}}return t.type="[Auth] Get Group User Profile",t})(),z_=(()=>{class t{constructor(i){this.groupUserProfile=i}}return t.type="[Auth] Get Group User Profile Success",t})(),g1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Get Group User Profile Failure",t})(),W_=(()=>{class t{constructor(i=!1){this.hardCheck=i}}return t.type="[Auth] Get User Profile",t})(),X_=(()=>{class t{constructor(i){this.userProfile=i}}return t.type="[Auth] Get User Profile Success",t})(),h1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Get User Profile Failure",t})(),H_=(()=>{class t{constructor(i){this.userProfile=i}}return t.type="[Auth] Update User Profile",t})(),sm=(()=>{class t{constructor(i){this.userProfile=i}}return t.type="[Auth] Update User Profile Success",t})(),m1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Update User Profile Failure",t})(),rm=(()=>{class t{constructor(){}}return t.type="[Auth] Delete User Profile",t})(),f1=(()=>{class t{constructor(i){this.userEmail=i}}return t.type="[Auth] Delete User Profile Success",t})(),S1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Delete User Profile Failure",t})(),am=(()=>{class t{constructor(i){this.email=i}}return t.type="[Auth] Check Profile",t})(),Q_=(()=>{class t{constructor(i){this.profile=i}}return t.type="[Auth] Check Profile Success",t})(),b1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Check Profile Failure",t})(),Oc=(()=>{class t{constructor(){}}return t.type="[Auth] Get User Roles",t})(),lm=(()=>{class t{constructor(i){this.email=i}}return t.type="[Auth] Reset Password",t})(),y1=(()=>{class t{constructor(i){this.email=i}}return t.type="[Auth] Reset Password Success",t})(),v1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Reset Password Failure",t})(),cm=(()=>{class t{constructor(i){this.email=i}}return t.type="[Auth] Transfer Facebook Account",t})(),E1=(()=>{class t{constructor(i){this.email=i}}return t.type="[Auth] Transfer Facebook Account Success",t})(),dm=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Transfer Facebook Account Failure",t})(),_m=(()=>{class t{constructor(i,s,r){this.currentPassword=i,this.newPassword=s,this.confirmNewPassword=r}}return t.type="[Auth] Update Password",t})(),C1=(()=>{class t{constructor(){}}return t.type="[Auth] Update Password Success",t})(),T1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Update Password Failure",t})(),Mc=(()=>{class t{constructor(){}}return t.type="[Auth] Check Session",t})(),pm=(()=>{class t{constructor(i,s){this.value=i,this.verification=s}}return t.type="[Auth] Sign Up",t})(),Y_=(()=>{class t{constructor(i){this.response=i}}return t.type="[Auth] Sign Up Success",t})(),K_=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Sign Up Failure",t})(),J_=(()=>{class t{constructor(i,s){this.locale=i,this.reload=s}}return t.type="[Auth] Set User Locale",t})(),q_=(()=>{class t{constructor(i){this.locale=i}}return t.type="[Auth] Set User Locale Success",t})(),pr=(()=>{class t{constructor(){}}return t.type="[Auth] Check Locale",t})(),Z_=(()=>{class t{constructor(){}}return t.type="[Auth] Get User Apps",t})(),ep=(()=>{class t{constructor(i){this.apps=i}}return t.type="[Auth] Set User Apps",t})(),Ic=(()=>{class t{constructor(){}}return t.type="[Auth] Check Selected App",t})(),wc=(()=>{class t{constructor(i){this.appId=i}}return t.type="[Auth] Set Selected User App",t})(),um=(()=>{class t{constructor(i){this.message=i}}return t.type="[Auth] Send User Message",t})(),O1=(()=>{class t{constructor(i){this.message=i}}return t.type="[Auth] Send User Message Success",t})(),M1=(()=>{class t{constructor(i){this.err=i}}return t.type="[Auth] Send User Message Fail",t})(),gm=(()=>{class t{constructor(i,s){this.type=i,this.mode=s}}return t.type="[Auth] Get User Message",t})(),I1=(()=>{class t{constructor(i){this.message=i}}return t.type="[Auth] Get User Message Success",t})(),w1=(()=>{class t{constructor(i){this.type=i}}return t.type="[Auth] Get User Message Fail",t})(),hm=(()=>{class t{constructor(i){this.messageSeenId=i}}return t.type="[Auth] Set Message Viewed",t})(),P1=(()=>{class t{constructor(){}}return t.type="[Auth] Set Message Viewed Success",t})(),A1=(()=>{class t{constructor(){}}return t.type="[Auth] Set Message Viewed Fail",t})(),ur=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Verify Fail",t})(),tp=(()=>{class t{constructor(){}}return t.type="[Auth] Reset",t})(),mm=(()=>{class t{constructor(i,s){this.email=i,this.token=s}}return t.type="[Auth] Request Verification Code",t})(),N1=(()=>{class t{constructor(i){this.response=i}}return t.type="[Auth] Request Verification Code Success",t})(),R1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Request Verification Code Fail",t})(),fm=(()=>{class t{constructor(i,s,r){this.email=i,this.token=s,this.code=r}}return t.type="[Auth] Verify Profile",t})(),Sm=(()=>{class t{constructor(i){this.response=i}}return t.type="[Auth] Verify Profile Success",t})(),np=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Verify Profile Fail",t})(),bm=(()=>{class t{constructor(i,s){this.contentId=i,this.contentType=s}}return t.type="[Auth] Set Content Viewed",t})(),D1=(()=>{class t{constructor(){}}return t.type="[Auth] Set Content Viewed Success",t})(),ip=(()=>{class t{constructor(){}}return t.type="[Auth] Check Content Viewed",t})(),k1=(()=>{class t{constructor(i){this.contentViews=i}}return t.type="[Auth] Check Content Viewed Success",t})(),ym=(()=>{class t{constructor(i){this.isDeveloperReferral=i}}return t.type="[Auth] Set Developer Referral",t})(),L1=(()=>{class t{}return t.type="[Auth] Get User Notices",t})(),U1=(()=>{class t{constructor(i){this.userNotices=i}}return t.type="[Auth] Get User Notices Success",t})(),j1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Get User Notices Fail",t})(),vm=(()=>{class t{constructor(i){this.noticeId=i}}return t.type="[Auth] Mark User Notice As Seen",t})(),V1=(()=>{class t{constructor(i){this.noticeId=i}}return t.type="[Auth] Mark User Notice As Seen Success",t})(),x1=(()=>{class t{constructor(i){this.error=i}}return t.type="[Auth] Mark User Notice As Seen Fail",t})();class Em{}class op{}!function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,de.Z)(()=>Em),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],op.prototype,"organizations",void 0);class sp{static fromJSON(t){const o=new sp;return o.isUser=t.is_user,o.email=t.user_email,o.firstName=t.user_first_name,o.lastName=t.user_last_name,o.name=`${t.user_first_name} ${t.user_last_name}`,o.isDeveloper=t.user_is_developer,o.isDeveloperActive=t.user_is_developer_active,o.isDeveloperVerified=t.user_is_developer_verified,o.isThirdParty=t.user_is_third_party,o.thirdPartyProvider=t.user_third_party_provider,o.isTeamMember=t.user_is_team_member,o}}class rp{static fromJSON(t){const o=new rp;return o.google=t.google_api_key,o}}class Pc{constructor(){this.version=5,this.groupInviteMode=0,this.groupCodeMode=0}}class B1 extends Pc{static toJSON(t){return{version:t.version,app_producttype:t.app_producttype,app_productkey:t.app_productkey,email:t.email,password:t.password,first_name:t.firstName,last_name:t.lastName,group_invite_mode:t.groupInviteMode,group_invite_key:t.groupInviteKey,group_code_mode:t.groupCodeMode,group_code:t.groupCode,group_ovid_mode:t.groupOvidMode,group_ovid_osptok:t.groupOvidOsptok,platform:t.platform,return_to:t.returnTo,brand_id:t.brandId,locale_id:t.localeId,timestamp:t.timestamp,site_verify_response:t.site_verify_response}}}class z1 extends Pc{constructor(t){super(),this.token=t}static toJSON(t){return{id_token:t.token,version:t.version,app_producttype:t.app_producttype,app_productkey:t.app_productkey,group_invite_mode:t.groupInviteMode,group_invite_key:t.groupInviteKey,group_code_mode:t.groupCodeMode,group_code:t.groupCode,group_ovid_mode:t.groupOvidMode,group_ovid_osptok:t.groupOvidOsptok,platform:t.platform,return_to:t.returnTo,brand_id:t.brandId,locale_id:t.localeId,timestamp:t.timestamp,site_verify_response:t.site_verify_response}}}class W1 extends Pc{constructor(t,o,i){super(),this.email=t,this.password=o,this.rememberMe=i}static toJSON(t){return{id_token:t.token,version:t.version,app_producttype:t.app_producttype,app_productkey:t.app_productkey,group_invite_mode:t.groupInviteMode,group_invite_key:t.groupInviteKey,group_code_mode:t.groupCodeMode,group_code:t.groupCode,group_ovid_mode:t.groupOvidMode,group_ovid_osptok:t.groupOvidOsptok,email:t.email,password:t.password,email_remember_me:t.rememberMe,platform:t.platform,return_to:t.returnTo,brand_id:t.brandId,locale_id:t.localeId,timestamp:t.timestamp,site_verify_response:t.site_verify_response}}}var Cm=_(29242),Tm=function(n){return n.Zendesk="zendesk",n}(Tm||{});class ap{}var un=function(n){return n.AssignRole="assignRole",n.RemoveUser="removeUser",n.TransferContent="transferContent",n.CreateCollection="createCollection",n.DeleteCollection="deleteCollection",n.EditTeamAccount="editTeamAccount",n.EditTeamBookmarks="editTeamBookmarks",n.EditAllTeamBookmarks="editAllTeamBookmarks",n.AddTeamBookmarks="addTeamBookmarks",n.RemoveTeamBookmarks="removeTeamBookmarks",n.EditBookmarks="editBookmarks",n.PublishBookmarks="publishBookmarks",n.SavePrivateBookmarks="savePrivateBookmarks",n.CopyUrl="copyURL",n.ViewBookmarks="viewBookmarks",n.InviteUsers="inviteUsers",n.ViewUsers="viewUsers",n.ExportCSV="exportCSV",n.DuplicateTeamBookmarks="duplicateTeamBookmarks",n.BulkManageTeamBookmarks="bulkManageTeamBookmarks",n.ManageJoinRequests="manageJoinRequests",n}(un||{}),xi=function(n){return n.Admin="admin",n.Creator="creator",n.Viewer="viewer",n}(xi||{});const Om=[un.ViewBookmarks,un.CopyUrl,un.SavePrivateBookmarks,un.ExportCSV],lp=[...Om,un.ViewUsers,un.InviteUsers,un.PublishBookmarks,un.EditBookmarks,un.EditTeamBookmarks,un.RemoveTeamBookmarks,un.AddTeamBookmarks,un.DuplicateTeamBookmarks,un.BulkManageTeamBookmarks],X1=[...lp,un.EditTeamAccount,un.EditAllTeamBookmarks,un.CreateCollection,un.TransferContent,un.RemoveUser,un.AssignRole,un.ManageJoinRequests],Ac=[xi.Viewer,xi.Creator,xi.Admin],ya={role_id:void 0,role_name:xi.Creator,role_display_name:"",role_description:"",permissions:[...lp]},H1={permissions:[un.ViewBookmarks,un.SavePrivateBookmarks,un.PublishBookmarks,un.EditBookmarks]},Q1={[xi.Viewer]:Om,[xi.Creator]:lp,[xi.Admin]:X1},Y1={[xi.Viewer]:"Can view team content and edit personal content",[xi.Creator]:"Can edit and view team content",[xi.Admin]:"Can manage team settings and edit all content"};function K1(n){return Q1[n]||[]}function va(n){const t=n?.role_name??ya.role_name,o=n?.role_description??Y1[t],i=n?.permissions;return{...n,role_description:o,permissions:(0,m.isNil)(i)?K1(t):i}}class J1{}class q1{}class Z1{}var gr=function(n){return n.DomainAlert="join_group_through_domain_alert",n.WelcomeTour="welcome_tour_alert",n.CompleteProfileAlert="complete_profile_alert",n}(gr||{});let cp=(()=>{var n;class t{constructor(i,s){this.http=i,this.storageService=s}getUserMessage(i,s="",r=!0){const a=this.getCachedMessage(i);return r&&a?(0,Rt.of)(a):this.http.get(`/ws/user/message?version=2&type=${i}&mode=${s}`).pipe((0,le.T)(d=>{const{message_seen_id:f,show_alert:T}=d;let L;switch(i){case gr.DomainAlert:L=(0,p.bj)(Em,d.join_organization);break;case gr.WelcomeTour:L=`${d.tour_version}`;break;case gr.CompleteProfileAlert:const{is_new_user:ee,is_team_user:re}=d||{};L=(0,p.bj)(Z1,{is_new_user:ee,is_team_user:re})}return{messageSeenId:f,messageType:i,showUserAlert:T,messageData:L}}),(0,Is.M)(d=>{d.showUserAlert||this.addCachedMessage(d)}))}setUserMessageViewed(i){return this.http.post("/ws/user/message",{version:2,message_seen_id:i})}sendMessage(i){return this.http.post("/ws/user/message",i)}getCachedMessage(i){return this.getCachedMessages().find(r=>r.messageType===i)}getCachedMessages(){return this.storageService.getSessionItem(zt.d0.UserMessagesSeen)||[]}addCachedMessage(i){if(!this.getCachedMessage(i.messageType)){const s=this.getCachedMessages();this.storageService.setSessionItem(zt.d0.UserMessagesSeen,[...s,i])}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(zt.n$))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var ri=_(12215);class eE extends Pc{constructor(t,o,i,s){super(),this.app_producttype=t,this.app_productkey=o,this.groupOvidMode=i,this.groupOvidOsptok=s}static toJSON(t){return{version:t.version,app_producttype:t.app_producttype,app_productkey:t.app_productkey,group_ovid_mode:t.groupOvidMode,group_ovid_osptok:t.groupOvidOsptok,ignore_ovid_exp:I.c.application===Wn.c.Studio&&I.c.deploy!==ri.Z.Production&&!1===I.c.native?1:0}}}const tE=["harvard.edu","liberty.edu"];let hr=(()=>{var n;class t{constructor(i,s,r,a,d){this.http=i,this.reCaptchaV3Service=s,this.userMessageService=r,this.productService=a,this.RECAPTCHA_V3_SITE_KEY=d}loginWithBiodigital(i){return this.http.post("/ws/user/sign/in",W1.toJSON(i),{headers:this.productService.productHeader})}loginWithGoogle(i){return this.http.post("/ws/user/sign/in/google",z1.toJSON(i),{headers:this.productService.productHeader})}loginWithGroup(i){return this.http.post("/ws/organization/sign/in",eE.toJSON(i),{headers:this.productService.productHeader})}logout(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/user/sign/out")}logoutGroup(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/organization/sign/out",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}checkProfile(i){return this.http.post("/ws/user/profile/check",{version:5,email:i,app_producttype:this.productService.productType,app_productkey:this.productService.productKey},{headers:this.productService.productHeader}).pipe((0,le.T)(d=>sp.fromJSON(d)))}getUserProfile(i){return this.http.get("/ws/user/profile",{params:{version:2,subscription_hard_check:i?1:0}}).pipe((0,le.T)(a=>{const d=(0,p.bj)(op,a);return d.organizations.forEach(f=>{const T=(0,m.get)(f,"user_role",ya);f.user_role=va(T)}),d}))}getUserRoles(){return this.http.get("/ws/organization/user/roles").pipe((0,le.T)(i=>i.user_roles.map(s=>va((0,p.bj)(ap,s)))))}getGroupUserProfile(){return this.http.get("/ws/organization/profile",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}updaterUserProfile(i){return this.http.post("/ws/user/profile?version=2",i)}deleteUserProfile(){return this.http.post("/ws/user/profile/delete",{}).pipe((0,le.T)(i=>i.deleted_user_email))}getEnvironmentSettings(){return this.http.get("/ws/environment/settings?version=2").pipe((0,le.T)(i=>rp.fromJSON(i)))}getUserApps(){return this.http.get("/ws/developer/apps/profile").pipe((0,le.T)(i=>i&&i.apps?JSON.parse(i.apps):[]))}getGroupConfigFromRoute(i){const r=i.queryParams.code||"",a=i.queryParams.group_invite||"",d=i.queryParams.osptok||"";return{group:i.queryParams.group||"",groupCode:r,groupCodeMode:r?1:0,groupInviteMode:a?1:0,groupInviteKey:a,groupOvidMode:d?1:0,groupOvidOsptok:d}}getPlatformConfigFromRoute(i){const{zendesk_signin:s,return_to:r,brand_id:a,locale_id:d,timestamp:f}=i.queryParams;if("1"===s)return{platform:Tm.Zendesk,returnTo:r,brandId:a,localeId:d,timestamp:f}}isLoggedIn(){return this.http.get("/ws/product/account/is/signed-in",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}getProfileRestrictions(i){let s=!1,r=!1,a="";return i.organizations.forEach(d=>{s||r||(a=d.name,s=d.user_is_subscribed&&d.email_domain_restriction&&!d.user_has_email_domain_access,r=d.user_is_subscribed&&d.ip_address_restriction&&!d.user_has_domain_access)}),{organizationName:a,email:s,ip:r}}resetPassword(i){return this.http.post("/ws/user/password/forgot",{email:i})}deactivateFacebook(i){return this.http.post("/ws/user/sign/in/facebook/deactivate",i)}updatePassword(i,s,r){return this.http.post("/ws/user/password/change",{current_password:i,new_password:s,confirm_new_password:r})}signUp(i){return this.http.post("/ws/user/sign/up",B1.toJSON(i),{headers:this.productService.productHeader})}verifyToken(i,s){return this.http.post("/ws/recaptcha/siteverify",{recaptcha_reponse_token:i,recaptcha_version:s})}verifyReCaptcha(i,s){return s&&grecaptcha.reset(this.RECAPTCHA_V3_SITE_KEY),this.reCaptchaV3Service.execute(i).pipe((0,Cn.Z)(r=>this.verifyToken(r,"v3")),(0,le.T)(r=>({isHuman:r.action===i&&r.score>.2,verification:r})))}isReCaptchaWhiteListed(i){return tE.some(s=>new RegExp(`${s}$`,"i").test(i))}verifyIsHuman(i,s,r=!1){return this.isReCaptchaWhiteListed(s)?(0,Rt.of)({isHuman:!0}):this.verifyReCaptcha(i,r)}isValidGoogleDomain(){return new Set(["human-qa.biodigital.com","human-staging.biodigital.com","human.biodigital.com","loft.biodigital.com","loft-qa.biodigital.com","qa.biodigital.com","localhost:4200","localhost:4201"]).has(window.location.host)}requestVerificationCode(i){const s={...i,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/request",s).pipe((0,le.T)(r=>(0,p.bj)(J1,r)))}verifyProfile(i){const s={...i,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/confirm",s).pipe((0,le.T)(r=>(0,p.bj)(q1,r)))}checkProfileIncomplete(){return this.userMessageService.getUserMessage(gr.CompleteProfileAlert,"v2",!1).pipe((0,Ai.W)(()=>(0,Rt.of)({messageType:gr.CompleteProfileAlert,messageData:{},showUserAlert:!1})))}getUserNotices(){const s=new w.Nl({fromObject:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}});return this.http.get("ws/user/notices",{params:s})}markUserNoticeAsSeen(i){return this.http.post("ws/user/notices/seen",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,notice_id:i})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(Cm.ob),e.KVO(cp),e.KVO(je),e.KVO(Cm.gq))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})(),Nc=(()=>{class t{constructor(i){this.organizations=i}}return t.type="[Organizations] Set Organizations",t})(),Mm=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Organizations] Select Organization",t})(),Im=(()=>{class t{constructor(i){this.collection=i}}return t.type="[Organizations] Select Collection",t})(),dp=(()=>{class t{constructor(i){this.organizationId=i}}return t.type="[Organizations] Get Collections",t})(),_p=(()=>{class t{constructor(i){this.collections=i}}return t.type="[Organizations] Get Collections Success",t})(),wm=(()=>{class t{constructor(i,s){this.organizationId=i,this.collectionName=s}}return t.type="[Organizations] Add Collection",t})(),pp=(()=>{class t{constructor(i,s){this.organizationId=i,this.collectionName=s}}return t.type="[Organizations] Add Collection Success",t})(),up=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Add Collection Error",t})(),Pm=(()=>{class t{constructor(i){this.collection=i}}return t.type="[Organizations] Remove Collection",t})(),gp=(()=>{class t{constructor(i){this.collection=i}}return t.type="[Organizations] Remove Collection Success",t})(),hp=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Remove Collection Error",t})(),Am=(()=>{class t{constructor(i){this.collection=i}}return t.type="[Organizations] Set Collection Rename Mode",t})(),Nm=(()=>{class t{constructor(i,s){this.collection=i,this.collectionName=s}}return t.type="[Organizations] Rename Collection",t})(),mp=(()=>{class t{constructor(i,s){this.collection=i,this.collectionName=s}}return t.type="[Organizations] Rename Collection Success",t})(),fp=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Rename Collection Error",t})(),Rm=(()=>{class t{constructor(i,s){this.organizationId=i,this.collections=s}}return t.type="[Organizations] Reorder Collections",t})(),Sp=(()=>{class t{constructor(i,s){this.organizationId=i,this.collections=s}}return t.type="[Organizations] Reorder Collections Success",t})(),nE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Reorder Collections Error",t})(),bp=(()=>{class t{constructor(){}}return t.type="[Organizations] Reset",t})(),Dm=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Organizations] Create Organization",t})(),km=(()=>{class t{constructor(){}}return t.type="[Organizations] Create Organization Success",t})(),yp=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Create Organization Fail",t})(),Lm=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Organizations] Update Organization",t})(),iE=(()=>{class t{constructor(){}}return t.type="[Organizations] Update Organization Success",t})(),oE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Update Organization Fail",t})(),Um=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Organizations] Delete Organization",t})(),sE=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Organizations] Delete Organization Success",t})(),rE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Delete Organization Fail",t})(),jm=(()=>{class t{constructor(i){this.request=i}}return t.type="[Organizations] Get Organization Profile",t})(),vp=(()=>{class t{constructor(i){this.organizationProfile=i}}return t.type="[Organizations] Get Organization Profile Success",t})(),aE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Get Organization Profile Fail",t})(),Vm=(()=>{class t{constructor(){}}return t.type="[Organizations] Clear Organization Profile",t})(),xm=(()=>{class t{constructor(i){this.params=i}}return t.type="[Organizations] Get Join Domains",t})(),Ep=(()=>{class t{constructor(i){this.joinDomains=i}}return t.type="[Organizations] Get Join Domains Success",t})(),Fm=(()=>{class t{constructor(i){this.emailDomains=i}}return t.type="[Organizations] Post Join Domains",t})(),lE=(()=>{class t{constructor(i){this.emailDomains=i}}return t.type="[Organizations] Post Join Domains Success",t})(),cE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Post Join Domains Fail",t})(),Gm=(()=>{class t{constructor(i){this.joinDomainIds=i}}return t.type="[Organizations] Delete Join Domains",t})(),dE=(()=>{class t{constructor(i){this.joinDomainIds=i}}return t.type="[Organizations] Delete Join Domains Success",t})(),_E=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Delete Join Domains Fail",t})(),$m=(()=>{class t{constructor(i){this.groupId=i}}return t.type="[Organizations] Generate Group Code",t})(),Cp=(()=>{class t{constructor(i){this.groupCode=i}}return t.type="[Organizations] Generate Group Code Success",t})(),pE=(()=>{class t{constructor(i){this.error=i}}return t.type="[Organizations] Generate Group Code Fail",t})();var uE=_(35801);const gE={"en-US":!0,"en-GB":!0,"es-ES":!0,"es-MX":!0,"fr-FR":!0,"it-IT":!0,"pt-PT":!0,"pt-BR":!0,"de-DE":!1,"zh-CN":!1,"cmn-CN":!1,ja:!1,"ja-JP":!1,"he-IL":!1};function zm(n,t){return()=>{if(t===bn.q.id)return(0,Rt.of)({});const o=bn.WF[t]??t;return function Bm(n,t){const o=bn.WF[t]??t;return gE[o]??1?n.get(`assets/locales/${o}.json`).pipe((0,Ai.W)(()=>(0,Rt.of)(void 0))):(0,Rt.of)(void 0)}(n,t).pipe((0,Zi.n)(i=>{const s=i?.translations;return(0,m.isNil)(s)?console.warn(`Translations not found for locale: ${o}`):(0,uE.Zi)(s),(0,Rt.of)(i)}))}}var wn,hE=_(41862);!function(n){n.SetTheme=(()=>{class L{constructor(re){this.theme=re}}return L.type="[Layout] Set Theme",L})(),n.SetSidenav=(()=>{class L{constructor(re){this.sidenav=re}}return L.type="[Layout] Set Sidenav",L})(),n.ToggleSidenav=(()=>{class L{constructor(re){this.open=re}}return L.type="[Layout] Toggle Sidenav",L})(),n.SetHeader=(()=>{class L{constructor(re){this.siteHeaderType=re}}return L.type="[Layout] Set Header",L})(),n.SetFooter=(()=>{class L{constructor(re){this.siteFooterType=re}}return L.type="[Layout] Set Footer",L})(),n.SetHeaderHeight=(()=>{class L{constructor(re){this.height=re}}return L.type="[Layout] Set Header Height",L})(),n.SetFooterHeight=(()=>{class L{constructor(re){this.height=re}}return L.type="[Layout] Set Footer Height",L})(),n.ResetLayout=(()=>{class L{constructor(){}}return L.type="[Layout] Reset",L})()}(wn||(wn={}));class mE{constructor(t,o,i){this.category=t,this.message=o,this.log=i}}let Wm=(()=>{var n;class t{constructor(i){this.http=i,this.log={}}logError(i,s=!1){const r=`${i.category}${i.message}`;return s&&this.log[r]?(0,Rt.of)():(this.log[r]=!0,this.http.post("/ws/human-error",i))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var At;!function(n){n.SetSearchMode=(()=>{class Je{constructor(kt){this.searchMode=kt}}return Je.type="[Gallery] Set Search Mode",Je})(),n.SetViewMode=(()=>{class Je{constructor(kt){this.viewMode=kt}}return Je.type="[Gallery] Set View Mode",Je})(),n.ShowFilters=(()=>{class Je{constructor(kt,Li=!1){this.show=kt,this.triggerDrawer=Li}}return Je.type="[Gallery] Show Filters",Je})(),n.GetStudioOptions=(()=>{class Je{constructor(kt){this.organizationId=kt}}return Je.type="[Gallery] Get Studio Options",Je})(),n.GetStudioOptionsSuccess=(()=>{class Je{constructor(kt){this.options=kt}}return Je.type="[Gallery] Get Studio Options Success",Je})(),n.SearchLoft=(()=>{class Je{constructor(kt){this.config=kt}}return Je.type="[Gallery] Search Loft",Je})(),n.SearchLoftSuccess=(()=>{class Je{constructor(kt){this.bookmarks=kt}}return Je.type="[Gallery] Search Loft Success",Je})(),n.SetSearchConfig=(()=>{class Je{constructor(kt,Li){this.config=kt,this.options=Li}}return Je.type="[Gallery] Set Search Config",Je})(),n.SetSearchOptions=(()=>{class Je{constructor(kt){this.options=kt}}return Je.type="[Gallery] Set Search Options",Je})(),n.SetActiveTags=(()=>{class Je{constructor(kt){this.activeTags=kt}}return Je.type="[Gallery] Set Active Tags",Je})(),n.SearchCategory=(()=>{class Je{constructor(kt){this.categoryId=kt}}return Je.type="[Gallery] Search Category",Je})(),n.SearchStudio=(()=>{class Je{constructor(){}}return Je.type="[Gallery] Search Studio",Je})(),n.SearchStudioSuccess=(()=>{class Je{constructor(kt){this.bookmarks=kt}}return Je.type="[Gallery] Search Studio Success",Je})(),n.SearchSuccess=(()=>{class Je{constructor(kt){this.bookmarks=kt}}return Je.type="[Gallery] Search Success",Je})(),n.SelectBookmark=(()=>{class Je{constructor(kt){this.result=kt}}return Je.type="[Gallery] Select Bookmark",Je})(),n.SetSidenav=(()=>{class Je{constructor(kt){this.sidenav=kt}}return Je.type="[Gallery] Set Sidenav",Je})(),n.SetBulkActions=(()=>{class Je{constructor(kt){this.bulkActions=kt}}return Je.type="[Gallery] Set Bulk Actions",Je})(),n.SetCardActions=(()=>{class Je{constructor(kt){this.cardActions=kt}}return Je.type="[Gallery] Set Card Actions",Je})(),n.ClearResults=(()=>{class Je{constructor(){}}return Je.type="[Gallery] Clear Results",Je})(),n.CheckItem=(()=>{class Je{constructor(kt,Li){this.id=kt,this.checked=Li}}return Je.type="[Gallery] Check Item",Je})(),n.CheckAll=(()=>{class Je{constructor(){}}return Je.type="[Gallery] Check All",Je})(),n.UncheckAll=(()=>{class Je{constructor(){}}return Je.type="[Gallery] Uncheck All",Je})(),n.SetCheckedItems=(()=>{class Je{constructor(kt){this.ids=kt}}return Je.type="[Gallery] Set Checked Items",Je})(),n.Reset=(()=>{class Je{constructor(){}}return Je.type="[Gallery] Reset",Je})()}(At||(At={}));var Xm=function(n){return n.Web="web",n.Mobile="mobilesdk",n}(Xm||{});let SE=(()=>{class t{}return t.type="[Subscription] Reset Subscription State",t})();const bE={"Sign in":"3971305","Sign up":"3971297"};let Hm=(()=>{var n;class t{constructor(i){this.config=i,this.initialized=!1}initialize(){if(!this.config.enabled||this.initialized)return;const i=`\n      _linkedin_partner_id = "${this.config.linkedinId}"; \n      window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || []; \n      window._linkedin_data_partner_ids.push(_linkedin_partner_id);\n      (function(){var s = document.getElementsByTagName("script")[0]; var b = document.createElement("script"); b.type = "text/javascript";b.async = true; b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js"; s.parentNode.insertBefore(b, s);})();\n    `,s=document.createElement("script");s.textContent=i,document.body.appendChild(s),this.initialized=!0}track(i){const s=bE[i];if(s){const r=document.createElement("img");r.height=1,r.width=1,r.style.display="none",r.alt="",r.src=`https://px.ads.linkedin.com/collect/?pid=${this.config.linkedinId}&conversionId=${s}&fmt=gif`,document.body.appendChild(r)}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO("linkedinConfig"))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Ea=function(n){return n.Free="free",n.Premium="premium",n.Team="team",n}(Ea||{});let Tp=(()=>{var n;class t{constructor(i,s){this.http=i,this.productService=s}trackContentPublish(i,s){return this.http.post("/ws/user/analytics/content/inapp/publish",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:s,content_id:i})}trackContentView(i,s){return this.http.post("/ws/user/analytics/content/inapp/view",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:s,content_id:i})}checkContentView(){return this.http.get("/ws/user/content/inapp/view/check")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(je))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var ao=function(n){return n.Private="Private",n.TeamView="Team - View Only",n.TeamEdit="Team - View & Edit",n}(ao||{});function Fi(n,t){return(0,m.get)(n,"permissions",[]).includes(t)}function Op(n){return mr(n)&&!0===n.group_access[0].visible}function Ym(n){return mr(n)&&!0===n.group_access[0].member_edit}function Mp(n){return!(0,m.isNil)(n.module_accessor_level)}function mr(n){return Array.isArray(n.group_access)&&n.group_access.length>0}var Ip=_(71217);function Km(n,t){return{type:n,data:t}}var Jm=_(27153),Ti=_(30234);const wp=Jm.fQ[Ti.a.WoltersKluwer],wE={};function Qo(n,t){const o=function AE(n){return n instanceof Error?"":n?.error?.error?.error_id??""}(n),i=n instanceof Error?n.message:n?.error?.error?.message,s=function PE(n,t){switch(n){case"OPPH01.00126":case"SUH01.00040":return"This invite code is invalid or has expired. Please reach out to your administrator for a new code.";case"OPPH01.00122":case"SUH01.00122":case"SIH01.00122":case"FSH01.00122":case"GSH01.00122":return`We were unable to find an account associated with your institution. \n      Please contact your administrator [here](${wp}) and provide this error ID: ${n}.`;case"OPPH01.00123":case"SUH01.00123":case"SIH01.00123":case"FSH01.00123":case"GSH01.00123":return`There are multiple team accounts associated with your institution. \n      Please contact your administrator [here](${wp}) and provide this error ID: ${n}.`;case"OPPH01.00124":case"OPPH01.00125":case"OPPH01.00110":case"OPPH01.00111":case"OPPH01.00112":case"SUH01.00124":case"SUH01.00110":case"SUH01.00111":case"SUH01.00112":case"SIH01.00124":case"SIH01.00110":case"SIH01.00111":case"SIH01.00112":case"FSH01.00124":case"FSH01.00125":case"FSH01.00110":case"FSH01.00111":case"FSH01.00112":case"GSH01.00124":case"GSH01.00110":case"GSH01.00111":case"GSH01.00112":return`There was an issue with retrieving information from your institution. \n      Please try again or contact your administrator [here](${wp}) and provide this error ID: ${n}.`;case"OSIH01.00111":case"OSIH01.00112":return"We were unable to load this page due to an invalid Ovid token";default:return wE[n]||""}}(o);return s||(i?i.replace(/^\[(.+)\]$/,"$1").replace(/^\'(.+)\'$/,"$1"):"")}var Pp=_(11153);class lo extends Error{constructor(){super("reCAPTCHA error. Please complete the form to continue.")}}var Yo,Ca,Ye=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},se=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const Rc=I.c.application===Wn.c.Studio,qm={signed_in:!1},Ap={loading:!1,requestingCode:!1,profileStatus:"ready",auth2:null,googleCredential:null,googlePromptResult:null,loggedIn:qm,userLocale:null,userRoles:[],contentViews:{limit_reached:!1,inapp_view_limit:0,inapp_view_count:0},developerReferral:!1};let ke=(Yo=class{static getLoggedIn(t){return!0===t.loggedIn?.signed_in}static getLoggedInState(t){return t.loggedIn}static getEnvironmentSettings(t){return t.environmentSettings}static getProfile(t){const{userProfile:o,groupUserProfile:i}=t;return(0,m.isNil)(o)?(0,m.isNil)(i)?void 0:Km(Ip.P.Organization,i):Km(Ip.P.User,o)}static getUserProfile(t){return t.userProfile}static getGroupUserProfile(t){return t.groupUserProfile}static getUserRole(t){return(0,m.isNil)(t.userProfile)?(0,m.isNil)(t.groupUserProfile)?void 0:H1:t.userProfile?.organizations[0]?.user_role??ya}static getUserRoles(t){return t.userRoles}static getSystemDefaultRole(t){return(t.userRoles??[]).find(s=>s.role_name===ya.role_name)??ya}static getUserType(t){if(!(0,m.isNil)(t.userProfile)){const{premium_account:o,premium_account_type:i}=t.userProfile;if(o)return"group"===i?Ea.Team:Ea.Premium}return Ea.Free}static getUserSessionType(t){return t.loggedIn?.session_type}static canInviteUsers(t){if(!(0,m.isNil)(t.userProfile)){const o=Ca.getUserType(t);return Fi(Ca.getUserRole(t),un.InviteUsers)&&o===Ea.Team}return!1}static getUserAccountSettings(t){return t?.userProfile?.account_settings??[]}static getAuth2(t){return t.auth2}static getGooglePromptResult(t){return t.googlePromptResult}static getProfileCheck(t){return t.profileCheck}static getLoading(t){return t.loading}static getVerifyingProfile(t){return"verifying"===t.profileStatus}static getProfileUpdating(t){return"updating"===t.profileStatus}static getProfileDeleting(t){return"deleting"===t.profileStatus}static getUserLocale(t){return t.userLocale}static getUserLanguage(t){return t.userLocale?.lang||bn.q.lang}static getUserApps(t){return t?.userApps??[]}static getSelectedUserApp(t){return(t.userApps||[]).find(i=>i.id===t.selectedAppId)}static getUserFullName(t){return(0,m.isNil)(t.userProfile)?null:(0,m.trim)([t.userProfile.first_name??"",t.userProfile.last_name??""].join(" "))}static getUserEmail(t){return(0,m.isNil)(t.userProfile)?null:t.userProfile.email}static isPrivateUser(t){return!(0,m.isNil)(t.userProfile)&&0===(t?.userProfile?.organizations??[]).length}static isPremiumUser(t){return!0===t?.userProfile?.premium_account_valid}static isAdmin(t){const o=this.getUserRole(t);return!!o&&o.role_name===xi.Admin}static isDeveloperReferral(t){return t.developerReferral}static getContentViews(t){return t.contentViews}static getContentViewsReached(t){return!Ca.isPremiumUser(t)&&t.contentViews.limit_reached}static hasActiveDeveloperAccount(t){return!(0,m.isNil)(t.userProfile)&&t.userProfile.developer_account&&(t.userProfile.developer_account_active||t.userProfile.developer_account_verified)&&t.userProfile.developer_has_apps}static getUserNotices(t){return t.userNotices}static canStartFreeTrial(t){return t.userProfile?.premium_account_eligibility.group_free_trial??!1}initializeGoogleAuth(t){const o=navigator.userAgent.indexOf("Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:")>=0&&navigator.userAgent.indexOf("0) Gecko/20100101 Firefox")>=0,i={client_id:I.c.googleAuthKey,itp_support:!1};o?(i.ux_mode="redirect",i.login_uri="https://"+window.location.host+"/ws/google/to/auth"):(i.ux_mode="popup",i.callback=s=>{t.patchState({googleCredential:s.credential}),t.dispatch(new d1(s.credential))}),google.accounts.id.initialize(i)}promptWithGoogle(t){google.accounts.id.prompt(o=>{const i={dismissedReason:o.getDismissedReason(),momentType:o.getMomentType(),notDisplayedReason:o.getNotDisplayedReason(),skippedReason:o.getSkippedReason()};t.dispatch(new F_(i))})}promptWithGoogleSuccess(t,o){t.patchState({googlePromptResult:o.promptResult})}isLoggedIn(t,o){t.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{const{signed_in:s,session_type:r}=i;t.dispatch(s?new Cc(r):new Tc(r))})}isLoggedInSuccess(t,o){t.patchState({loggedIn:{signed_in:!0,session_type:o.sessionType}})}isLoggedInFailure(t,o){t.patchState({loggedIn:qm})}login(t,o){const{login:i,verification:s}=o,{email:r}=i;t.patchState({loading:!0}),(s?.isHuman?(0,Rt.of)(s):this.authService.verifyIsHuman("studio_login",r)).pipe((0,Cn.Z)(({isHuman:d,verification:f})=>{if(!d)throw new lo;return this.authService.loginWithBiodigital({...i,...f?{site_verify_response:f}:null})}),(0,bt.j)(()=>t.patchState({loading:!1}))).subscribe({next:d=>{t.dispatch(new Sa("biodigital",d))},error:d=>{d instanceof lo&&t.dispatch(new ur(d)),this.logFailure("LOGIN_FAILURE",d),t.dispatch(new ba("biodigital",d,i))}})}loginWithGoogle(t,o){t.patchState({loading:!0}),this.authService.loginWithGoogle(o.login).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new Sa("google",i))},i=>{(1===o.login.groupCodeMode||1===o.login.groupInviteMode)&&this.logFailure("GOOGLE_SIGNUP_FAILURE",i),t.dispatch(new ba("google",i,o.login))})}loginWithGroup(t,o){t.patchState({loading:!0}),this.authService.loginWithGroup(o.login).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new Sa("group",i))},i=>{t.dispatch(new ba("group",i,o.login))})}loginSuccess(t,o){Rc&&(this.linkedinInsights.track("Sign in"),"google"===o.loginType&&"signup"===o.response.authentication_type?this.vendorAnalyticsService.trackSignUp(o.loginType):this.vendorAnalyticsService.trackSignIn(o.loginType)),t.dispatch(new x_),t.dispatch(new pr)}loginFailure(t,o){Rc&&this.vendorAnalyticsService.track("Sign In - Failure",{type:o.loginType,error:Qo(o.error)||"There was an error logging in.",statusCode:o.error?.status})}logout(t,o){t.patchState({loading:!0}),("organization"===t.getState().loggedIn?.session_type?this.authService.logoutGroup():this.authService.logout()).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(()=>t.dispatch(new G_),()=>t.dispatch(new p1))}logoutSuccess(t,o){t.setState(Ap),t.dispatch(new tp),t.dispatch(new SE),t.dispatch(new k_),t.dispatch(new hE.tV),t.dispatch(new st.lQ),t.dispatch(new He.$y),t.dispatch(new wn.ResetLayout),t.dispatch(new bp),t.dispatch(new on),t.dispatch(new En.FN),t.dispatch(new At.Reset),t.dispatch(new Pp.hw),this.storageService.clearSessionStorage()}checkProfile(t,o){return t.patchState({loading:!0}),this.authService.checkProfile(o.email).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new Q_(i))},i=>{t.dispatch(new b1(i))})}checkProfileSuccess(t,o){t.patchState({profileCheck:o.profile})}getGroupUserProfileAction(t,o){return t.patchState({loading:!0}),this.authService.getGroupUserProfile().pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new z_(i))},i=>{t.dispatch(new g1(i))})}getGroupUserProfileSuccess(t,{groupUserProfile:o}){t.patchState({userProfile:null,groupUserProfile:o}),t.dispatch(new Nc(o.organizations)),t.dispatch(new pr)}getUserProfile(t,{hardCheck:o}){return t.patchState({loading:!0}),this.authService.getUserProfile(o).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new X_(i))},i=>{t.dispatch(new h1(i))})}getUserProfileSuccess(t,o){t.patchState({userProfile:o.userProfile,groupUserProfile:null}),t.dispatch(new Nc(o.userProfile.organizations)),t.dispatch(new Z_),t.dispatch(new pr)}updateUserProfile(t,{userProfile:o}){t.patchState({profileStatus:"updating"}),this.authService.updaterUserProfile(o).pipe((0,bt.j)(()=>t.patchState({profileStatus:"ready"}))).subscribe(()=>{t.dispatch(new sm(o))},i=>{t.dispatch(new m1(i))})}updateUserProfileSuccess(t,{userProfile:o}){this.vendorAnalyticsService.updateVisitorData(o)}deleteUserProfile(t,o){t.patchState({profileStatus:"deleting"}),this.authService.deleteUserProfile().pipe((0,bt.j)(()=>t.patchState({profileStatus:"ready"}))).subscribe(i=>{t.dispatch(new f1(i))},i=>{t.dispatch(new S1(i))})}getUserRoles(t,o){this.authService.getUserRoles().subscribe(i=>{t.patchState({userRoles:i})})}getUserApps(t,o){this.authService.getUserApps().subscribe(i=>{t.dispatch(new ep(i)),t.dispatch(new Ic)},i=>{})}setUserApps(t,{apps:o}){t.patchState({userApps:o})}setSelectedUserApp(t,{appId:o}){t.patchState({selectedAppId:o}),null!==o?this.storageService.setLocalItem(zt.UT.UserAppId,o):this.storageService.removeLocalItem(zt.UT.UserAppId)}checkSelectedUserApp(t,o){const i=t.getState().userApps,s=this.storageService.getLocalItem(zt.UT.UserAppId);if(s){const r=parseInt(s,10);t.dispatch(new wc(r))}else if(i&&i.length){const r=i.find(a=>a.app_platform.some(d=>d.type===Xm.Web));t.dispatch(new wc(r?r.id:void 0))}}checkSession(t,o){t.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{const{signed_in:s,session_type:r}=i;s?(t.dispatch(new Cc(r)),"organization"===r?t.dispatch(new B_):(t.dispatch(new W_),t.dispatch(new Oc))):t.dispatch(new Tc(r))})}getEnvironmentSettings(t,o){return t.patchState({loading:!0}),this.authService.getEnvironmentSettings().pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new $_(i))},i=>{t.dispatch(new u1(i))})}GetEnvironmentSettingsSuccess(t,o){t.patchState({environmentSettings:o.environmentSettings})}resetPassword(t,o){t.patchState({loading:!0}),this.authService.resetPassword(o.email).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(()=>{t.dispatch(new y1(o.email))},i=>{t.dispatch(new v1(i))})}transferFacebookAccount(t,o){t.patchState({loading:!0}),this.authService.verifyIsHuman("deactivate_facebook",o.email).pipe((0,Cn.Z)(({isHuman:i,verification:s})=>{if(!i)throw new lo;return this.authService.deactivateFacebook({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...s?{site_verify_response:s}:null,user_email:o.email})}),(0,bt.j)(()=>t.patchState({loading:!1}))).subscribe({next:i=>{t.dispatch(i.conversion_complete&&i.reset_password_email_sent?new E1(o.email):new dm(new Error("Facebook deactivation failed")))},error:i=>{i instanceof lo&&t.dispatch(new ur(i)),t.dispatch(new dm(i))}})}updatePassword(t,o){const{currentPassword:i,newPassword:s,confirmNewPassword:r}=o;this.authService.updatePassword(i,s,r).subscribe(()=>{t.dispatch(new C1)},a=>{t.dispatch(new T1(a))})}signUp(t,o){const{value:i,verification:s}=o,{email:r}=i;t.patchState({loading:!0}),(s?.isHuman?(0,Rt.of)(s):this.authService.verifyIsHuman("studio_signup",r)).pipe((0,Cn.Z)(({isHuman:d,verification:f})=>{if(!d)throw new lo;return this.authService.signUp({...i,...f?{site_verify_response:f}:null})}),(0,bt.j)(()=>t.patchState({loading:!1}))).subscribe({next:d=>{t.dispatch(new Y_(d))},error:d=>{d instanceof lo&&t.dispatch(new ur(d)),t.dispatch(new K_(d))}})}signUpSuccess(t,o){Rc&&this.vendorAnalyticsService.trackSignUp("biodigital")}signUpFailure(t,o){Rc&&this.vendorAnalyticsService.track("Sign Up - Failure",{error:Qo(o?.error)||"There was an error signing up.",statusCode:o.error?.status}),this.logFailure("BIODIGITAL_SIGNUP_FAILURE",o)}setUserLocale(t,{locale:o,reload:i}){this.storageService.setLocalItem(zt.UT.Locale,o.id),i?window.location.reload():(t.patchState({userLocale:o}),t.dispatch(new q_(o)))}setUserLocaleSuccess(t,{locale:o}){zm(this.httpClient,o.id)().subscribe(()=>{})}checkLocale(t,o){const i=(0,bn.kF)(),s=bn.IB.find(r=>r.id===i)||bn.q;t.dispatch(new J_(s))}sendUserMessage(t,{message:o}){this.userMessageService.sendMessage(o).subscribe(()=>{t.dispatch(new O1(o))},i=>{t.dispatch(new M1(i))})}getUserMessage(t,{type:o,mode:i}){this.userMessageService.getUserMessage(o,i).subscribe(s=>{t.dispatch(new I1(s))},()=>{t.dispatch(new w1(o))})}setUserMessageViewed(t,{messageSeenId:o}){this.userMessageService.setUserMessageViewed(o).subscribe(()=>t.dispatch(new P1),()=>t.dispatch(new A1))}resetAuth(t,o){t.setState(Ap)}requestVerificationCode(t,{email:o,token:i}){t.patchState({requestingCode:!0}),this.authService.requestVerificationCode({user_email:o,verification_jwt:i}).pipe((0,bt.j)(()=>t.patchState({requestingCode:!1}))).subscribe(s=>{t.dispatch(new N1(s))},s=>{t.dispatch(new R1(s))})}verifyProfile(t,{email:o,token:i,code:s}){const r=s.toUpperCase();t.patchState({profileStatus:"verifying"}),this.authService.verifyProfile({user_email:o,verification_code:r,verification_jwt:i}).pipe((0,bt.j)(()=>t.patchState({profileStatus:"ready"}))).subscribe(a=>{t.dispatch(new Sm(a)),t.dispatch(new Mc)},a=>{t.dispatch(new np(a))})}verifyProfileSuccess(t){this.vendorAnalyticsService.track("Email Verify - Success",{platform:this.productService.productType})}verifyProfileFail(t,o){this.vendorAnalyticsService.track("Email Verify - Failure",{error:Qo(o?.error)||"There was an error with email verification.",statusCode:o.error?.status})}setContentView(t,{contentId:o,contentType:i}){this.contentViewService.trackContentView(o,i).subscribe(()=>{t.dispatch(new D1),t.dispatch(new ip)})}checkContentViews(t,o){this.contentViewService.checkContentView().subscribe(i=>{t.patchState({contentViews:i}),t.dispatch(new k1(i))})}setDeveloperReferral(t,o){t.patchState({developerReferral:o.isDeveloperReferral})}logFailure(t,o){const i=o?.message||"",s=Qo(o)||"";this.errorLoggingService.logError(new mE(t,i,s)).subscribe()}getUserNotices(t){this.authService.getUserNotices().subscribe({next:o=>{const i=o.notices;t.patchState({userNotices:i}),t.dispatch(new U1(i))},error:o=>t.dispatch(new j1(o))})}markUserNoticeAsSeen(t,{noticeId:o}){this.authService.markUserNoticeAsSeen(o).subscribe({next:()=>{const i=t.getState().userNotices;if(i){const s=i.findIndex(r=>r.notice_id===o);i.splice(s,1),t.patchState({userNotices:[...i]}),t.dispatch(new V1(o))}},error:i=>t.dispatch(new x1(i))})}constructor(t,o,i,s,r,a,d,f,T){this.authService=t,this.userMessageService=o,this.storageService=i,this.errorLoggingService=s,this.linkedinInsights=r,this.vendorAnalyticsService=a,this.contentViewService=d,this.productService=f,this.httpClient=T}ngxsOnInit(t){t.dispatch(new Mc),t.dispatch(new pr),t.dispatch(new Ic),t.dispatch(new em)}},Ca=Yo,Yo.\u0275fac=function(t){return new(t||Yo)(e.KVO(hr),e.KVO(cp),e.KVO(zt.n$),e.KVO(Wm),e.KVO(Hm),e.KVO(qe),e.KVO(Tp),e.KVO(je),e.KVO(w.Qq))},Yo.\u0275prov=e.jDH({token:Yo,factory:Yo.\u0275fac}),Yo);Ye([(0,l.rc)(em),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke.prototype,"initializeGoogleAuth",null),Ye([(0,l.rc)(_1),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke.prototype,"promptWithGoogle",null),Ye([(0,l.rc)(F_),se("design:type",Function),se("design:paramtypes",[Object,F_]),se("design:returntype",void 0)],ke.prototype,"promptWithGoogleSuccess",null),Ye([(0,l.rc)(x_),se("design:type",Function),se("design:paramtypes",[Object,x_]),se("design:returntype",void 0)],ke.prototype,"isLoggedIn",null),Ye([(0,l.rc)(Cc),se("design:type",Function),se("design:paramtypes",[Object,Cc]),se("design:returntype",void 0)],ke.prototype,"isLoggedInSuccess",null),Ye([(0,l.rc)(Tc),se("design:type",Function),se("design:paramtypes",[Object,Tc]),se("design:returntype",void 0)],ke.prototype,"isLoggedInFailure",null),Ye([(0,l.rc)(Zh),se("design:type",Function),se("design:paramtypes",[Object,Zh]),se("design:returntype",void 0)],ke.prototype,"login",null),Ye([(0,l.rc)(tm),se("design:type",Function),se("design:paramtypes",[Object,tm]),se("design:returntype",void 0)],ke.prototype,"loginWithGoogle",null),Ye([(0,l.rc)(nm),se("design:type",Function),se("design:paramtypes",[Object,nm]),se("design:returntype",void 0)],ke.prototype,"loginWithGroup",null),Ye([(0,l.rc)(Sa),se("design:type",Function),se("design:paramtypes",[Object,Sa]),se("design:returntype",void 0)],ke.prototype,"loginSuccess",null),Ye([(0,l.rc)(ba),se("design:type",Function),se("design:paramtypes",[Object,ba]),se("design:returntype",void 0)],ke.prototype,"loginFailure",null),Ye([(0,l.rc)(im),se("design:type",Function),se("design:paramtypes",[Object,im]),se("design:returntype",void 0)],ke.prototype,"logout",null),Ye([(0,l.rc)(G_),se("design:type",Function),se("design:paramtypes",[Object,G_]),se("design:returntype",void 0)],ke.prototype,"logoutSuccess",null),Ye([(0,l.rc)(am),se("design:type",Function),se("design:paramtypes",[Object,am]),se("design:returntype",void 0)],ke.prototype,"checkProfile",null),Ye([(0,l.rc)(Q_),se("design:type",Function),se("design:paramtypes",[Object,Q_]),se("design:returntype",void 0)],ke.prototype,"checkProfileSuccess",null),Ye([(0,l.rc)(B_),se("design:type",Function),se("design:paramtypes",[Object,B_]),se("design:returntype",void 0)],ke.prototype,"getGroupUserProfileAction",null),Ye([(0,l.rc)(z_),se("design:type",Function),se("design:paramtypes",[Object,z_]),se("design:returntype",void 0)],ke.prototype,"getGroupUserProfileSuccess",null),Ye([(0,l.rc)(W_),se("design:type",Function),se("design:paramtypes",[Object,W_]),se("design:returntype",void 0)],ke.prototype,"getUserProfile",null),Ye([(0,l.rc)(X_),se("design:type",Function),se("design:paramtypes",[Object,X_]),se("design:returntype",void 0)],ke.prototype,"getUserProfileSuccess",null),Ye([(0,l.rc)(H_),se("design:type",Function),se("design:paramtypes",[Object,H_]),se("design:returntype",void 0)],ke.prototype,"updateUserProfile",null),Ye([(0,l.rc)(sm),se("design:type",Function),se("design:paramtypes",[Object,H_]),se("design:returntype",void 0)],ke.prototype,"updateUserProfileSuccess",null),Ye([(0,l.rc)(rm),se("design:type",Function),se("design:paramtypes",[Object,rm]),se("design:returntype",void 0)],ke.prototype,"deleteUserProfile",null),Ye([(0,l.rc)(Oc),se("design:type",Function),se("design:paramtypes",[Object,Oc]),se("design:returntype",void 0)],ke.prototype,"getUserRoles",null),Ye([(0,l.rc)(Z_),se("design:type",Function),se("design:paramtypes",[Object,Z_]),se("design:returntype",void 0)],ke.prototype,"getUserApps",null),Ye([(0,l.rc)(ep),se("design:type",Function),se("design:paramtypes",[Object,ep]),se("design:returntype",void 0)],ke.prototype,"setUserApps",null),Ye([(0,l.rc)(wc),se("design:type",Function),se("design:paramtypes",[Object,wc]),se("design:returntype",void 0)],ke.prototype,"setSelectedUserApp",null),Ye([(0,l.rc)(Ic),se("design:type",Function),se("design:paramtypes",[Object,Ic]),se("design:returntype",void 0)],ke.prototype,"checkSelectedUserApp",null),Ye([(0,l.rc)(Mc),se("design:type",Function),se("design:paramtypes",[Object,Mc]),se("design:returntype",void 0)],ke.prototype,"checkSession",null),Ye([(0,l.rc)(om),se("design:type",Function),se("design:paramtypes",[Object,om]),se("design:returntype",void 0)],ke.prototype,"getEnvironmentSettings",null),Ye([(0,l.rc)($_),se("design:type",Function),se("design:paramtypes",[Object,$_]),se("design:returntype",void 0)],ke.prototype,"GetEnvironmentSettingsSuccess",null),Ye([(0,l.rc)(lm),se("design:type",Function),se("design:paramtypes",[Object,lm]),se("design:returntype",void 0)],ke.prototype,"resetPassword",null),Ye([(0,l.rc)(cm),se("design:type",Function),se("design:paramtypes",[Object,cm]),se("design:returntype",void 0)],ke.prototype,"transferFacebookAccount",null),Ye([(0,l.rc)(_m),se("design:type",Function),se("design:paramtypes",[Object,_m]),se("design:returntype",void 0)],ke.prototype,"updatePassword",null),Ye([(0,l.rc)(pm),se("design:type",Function),se("design:paramtypes",[Object,pm]),se("design:returntype",void 0)],ke.prototype,"signUp",null),Ye([(0,l.rc)(Y_),se("design:type",Function),se("design:paramtypes",[Object,Y_]),se("design:returntype",void 0)],ke.prototype,"signUpSuccess",null),Ye([(0,l.rc)(K_),se("design:type",Function),se("design:paramtypes",[Object,K_]),se("design:returntype",void 0)],ke.prototype,"signUpFailure",null),Ye([(0,l.rc)(J_),se("design:type",Function),se("design:paramtypes",[Object,J_]),se("design:returntype",void 0)],ke.prototype,"setUserLocale",null),Ye([(0,l.rc)(q_),se("design:type",Function),se("design:paramtypes",[Object,q_]),se("design:returntype",void 0)],ke.prototype,"setUserLocaleSuccess",null),Ye([(0,l.rc)(pr),se("design:type",Function),se("design:paramtypes",[Object,pr]),se("design:returntype",void 0)],ke.prototype,"checkLocale",null),Ye([(0,l.rc)(um),se("design:type",Function),se("design:paramtypes",[Object,um]),se("design:returntype",void 0)],ke.prototype,"sendUserMessage",null),Ye([(0,l.rc)(gm),se("design:type",Function),se("design:paramtypes",[Object,gm]),se("design:returntype",void 0)],ke.prototype,"getUserMessage",null),Ye([(0,l.rc)(hm),se("design:type",Function),se("design:paramtypes",[Object,hm]),se("design:returntype",void 0)],ke.prototype,"setUserMessageViewed",null),Ye([(0,l.rc)(tp),se("design:type",Function),se("design:paramtypes",[Object,tp]),se("design:returntype",void 0)],ke.prototype,"resetAuth",null),Ye([(0,l.rc)(mm),se("design:type",Function),se("design:paramtypes",[Object,mm]),se("design:returntype",void 0)],ke.prototype,"requestVerificationCode",null),Ye([(0,l.rc)(fm),se("design:type",Function),se("design:paramtypes",[Object,fm]),se("design:returntype",void 0)],ke.prototype,"verifyProfile",null),Ye([(0,l.rc)(Sm),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke.prototype,"verifyProfileSuccess",null),Ye([(0,l.rc)(np),se("design:type",Function),se("design:paramtypes",[Object,np]),se("design:returntype",void 0)],ke.prototype,"verifyProfileFail",null),Ye([(0,l.rc)(bm),se("design:type",Function),se("design:paramtypes",[Object,bm]),se("design:returntype",void 0)],ke.prototype,"setContentView",null),Ye([(0,l.rc)(ip),se("design:type",Function),se("design:paramtypes",[Object,ip]),se("design:returntype",void 0)],ke.prototype,"checkContentViews",null),Ye([(0,l.rc)(ym),se("design:type",Function),se("design:paramtypes",[Object,ym]),se("design:returntype",void 0)],ke.prototype,"setDeveloperReferral",null),Ye([(0,l.rc)(L1),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke.prototype,"getUserNotices",null),Ye([(0,l.rc)(vm),se("design:type",Function),se("design:paramtypes",[Object,vm]),se("design:returntype",void 0)],ke.prototype,"markUserNoticeAsSeen",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getLoggedIn",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Object)],ke,"getLoggedInState",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getEnvironmentSettings",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Object)],ke,"getProfile",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",op)],ke,"getUserProfile",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",class NE{})],ke,"getGroupUserProfile",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",ap)],ke,"getUserRole",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Array)],ke,"getUserRoles",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",ap)],ke,"getSystemDefaultRole",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",String)],ke,"getUserType",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserSessionType",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Boolean)],ke,"canInviteUsers",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Array)],ke,"getUserAccountSettings",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Object)],ke,"getAuth2",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",Object)],ke,"getGooglePromptResult",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getProfileCheck",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getLoading",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getVerifyingProfile",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getProfileUpdating",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getProfileDeleting",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserLocale",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",String)],ke,"getUserLanguage",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserApps",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getSelectedUserApp",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserFullName",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserEmail",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"isPrivateUser",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"isPremiumUser",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"isAdmin",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"isDeveloperReferral",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getContentViews",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getContentViewsReached",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"hasActiveDeveloperAccount",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"getUserNotices",null),Ye([(0,l.MD)(),se("design:type",Function),se("design:paramtypes",[Object]),se("design:returntype",void 0)],ke,"canStartFreeTrial",null),ke=Ca=Ye([(0,l.Uw)({name:"auth",defaults:Ap}),se("design:paramtypes",[hr,cp,zt.n$,Wm,Hm,qe,Tp,je,w.Qq])],ke);class Wt{}var Ta=function(n){return n.Enabled="enabled",n.Disabled="disabled",n.Locked="locked",n}(Ta||{});class Np{constructor(){this.background={colors:null},this.uiAnnotations=!1,this.uiAudio=!0,this.uiMedia=Hi.Full,this.uiInfo=!0,this.uiFullscreen=!0,this.uiScrubber=!1,this.uiHelp=!0,this.uiBd="",this.loadRotate=null,this.initial={button:!1,handHint:!1,play:!1,summary:!1},this.disableScroll={alert:!1,overlay:!1},this.uiQuiz={mode:Ta.Enabled,number:void 0},this.autoLoad=!0,this.playthrough=!1,this.uiTour=!1,this.uiNav=!0,this.uiSearch=!0,this.uiTools=!0,this.uiUndo=!0,this.uiLabelList=!0,this.uiChapterList=!1,this.all=!1,this.collapseLabel=null,this.uiMenu=!0,this.uiAnatomyDescriptions=!0,this.uiAnatomyPronunciations=!0,this.uiTutorial=!1,this.uiLegend=!0,this.uiLoader=O_,this.uiWhiteboard=!0,this.uiVisibilityLayers=!0,this.uiSkinLayers=!0,this.uiAnatomyLabels=!0}}var co=_(3266),Zm=_(37678),Oa=function(n){return n.Responsive="responsive",n.Fixed="fixed",n}(Oa||{});const ef={title:"Desktop",type:"desktop",dimensions:{width:700,height:550},orientation:"vertical"};function Dc(n,t=300,o=2){return parseFloat((n/t).toFixed(o))}Dc(300),Dc(300),Dc(5120),Dc(2880);var kE=_(3287),q=_(60177),Dp=_(98020);const kp=new e.nKC(""),rf=new e.nKC(""),af=I.c.deploy===ri.Z.Production?"https://human.biodigital.com":window.location.origin,LE=I.c.deploy===ri.Z.Local?"https://localhost:4202":`${af}/viewer`;let UE=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({providers:[{provide:kp,useValue:af},{provide:rf,useValue:LE}],imports:[l.rK.forFeature([Dp.X]),q.MD]}),t})();var lf=_(81642),_o=_(95416),Ma=function(n){return n.Single="share.widget.link",n.Bulk="share.widget.export",n}(Ma||{});const cf={headers:new w.Lr({"Content-Type":"application/json; charset=utf-8"})},fr=new Np,Lp={id:"embedded-human",dimensions:ef.dimensions,fullScreen:!0};let Sr=(()=>{var n;class t{constructor(i,s,r,a,d,f,T,L){this.http=i,this.cameraService=s,this.numberService=r,this.orgnanizationService=a,this.contentViewService=d,this.matSnackbar=f,this.APP_BASE_URL=T,this.VIEWER_BASE_URL=L}exportBookmarks(i,s,r,a,d,f,T,L,ee=!1,re=""){this.matSnackbar.open(`Exporting ${i.length} models to CSV...`);const ve=[{label:"Title",field:"title"},{label:"ID",field:"id"},{label:"Collection",field:"collection"},{label:"URL",field:"url"},{label:"iFrame",field:"iFrame"},{label:"Author",field:"author"},{label:"Thumbnail URL",field:"thumbnail_url"},{label:"Created Date",field:"create_date_time"},{label:"Updated Date",field:"update_date_time"}];ee&&ve.push({label:"Offline Package URL",field:"offline_url"});const Oe=L?(0,Rt.of)(null):this.getUAID(Ma.Bulk),Ee=ee?this.getDownloadURLs(i):(0,Rt.of)([]),Re=new Map,Fe=r.length?(0,si.p)(r.map(Ke=>this.orgnanizationService.getCollectionContent(s,Ke.collection_id,"",T).pipe((0,le.T)(it=>{it.forEach(pt=>{Re.set(pt.id,Ke)})})))):(0,Rt.of)(!0);return(0,si.p)([Oe,Ee,Fe]).pipe((0,le.T)(([Ke,it])=>i.map((pt,Mt)=>{const{id:$t,title:_n,author:ft,thumbnail_url:ze,create_date_time:Je,update_date_time:dt}=pt,kt=Re.get(pt.id)?.collection_name??"",Li=this.getWidgetURL(pt,a,d,null,Ke,T,L,re),Yr=this.getWidgetEmbed(Li,f),Kr=this.buildThumbnailURL(ze),Jr=it[Mt]||"";return{title:_n,id:$t,collection:kt,url:Li,iFrame:Yr,author:ft,thumbnail_url:Kr,create_date_time:(0,q.Yq)(new Date(Je),"shortDate","en"),update_date_time:(0,q.Yq)(new Date(dt),"shortDate","en"),offline_url:Jr}})),(0,Zi.n)(Ke=>(0,kE.H)(Ke,ve)),(0,Zi.n)(Ke=>{const pt=`BioDigital-Widgets-${(new Date).toISOString().split("T")[0]}-export.csv`,Mt=new Blob([Ke],{type:"text/csv;charset=utf-8"});return(0,Zm.saveAs)(Mt,pt),(0,Rt.of)(!0)}))}generateWidgetURL(i,s,r,a,d,f,T,L){const ee=T||!d?(0,Rt.of)(null):this.getUAID(d);return(0,si.p)([ee,this.contentViewService.trackContentPublish(i.id,i.type)]).pipe((0,le.T)(([re])=>this.getWidgetURL(i,s,r,a,re,f,T,L)))}getWidgetURL(i,s,r,a,d,f="en",T,L){r=r||fr;const ee="bookmark"===i.type,re={};re[ee?"id":"m"]=`${ee?i.id:i.module_name}`;const Ee={...re,...this.getParamsForUIOptions(r||fr),...this.getParamsForLoadingExperience(r||fr),...this.getParamsForScrollMode(r||fr),...this.getParamsForLoadRotate(r||fr),...this.getParamsForLabelScale(r||fr)},Re=(0,m.get)(r,"background.colors");if(Array.isArray(Re)&&Re.length>=3){const Ke=Re.slice(0,4).map(it=>this.numberService.roundNumber(it,3));Ee["background.colors"]=`${Ke}`}if(a){const{eye:Ke,look:it,up:pt}=this.cameraService.roundCamera(a,3);Ee.camera=`${[Ke.x,Ke.y,Ke.z,it.x,it.y,it.z,pt.x,pt.y,pt.z]}`}T?Ee.dk=T.app_apikey:d&&(Ee.uaid=d),f&&"en"!==f&&(Ee.lang=f),L&&(Ee.paid=L);const Fe=this.isCustomWidget(i.embed_url_path)?i.embed_url_path:s;return this.buildWidgetURL(Fe,Ee)}generateWidgetEmbed(i,s,r,a,d,f,T,L,ee){return this.generateWidgetURL(i,s,r,d,f,T,L,ee).pipe((0,le.T)(re=>this.getWidgetEmbed(re,a)))}getWidgetEmbed(i,s){const{width:r,height:a,type:d}=s||Lp.dimensions;let f="";return f=d===Oa.Responsive?`style="aspect-ratio: ${r} / ${a}; width: 100%"`:`width="${r}" height="${a}"`,`<iframe id="${Lp.id}" frameBorder="0" ${f} allowFullScreen="${Lp.fullScreen}" loading="lazy" src="${i}"></iframe>`}getImageEmbed(i,s,r){const a=`BioDigital Human: ${i}`.replace(/"/g,"&quot;");return`<a href="${s}" target="_blank"><img src="${r}" alt="${a}" title="${a}" /></a>`}getUAID(i){return this.http.post("/ws/user/analytics",{analytic_type:`${i}`,analytic_platform:"app"},cf).pipe((0,le.T)(r=>r.id))}getDownloadURLs(i){const s=i.filter(r=>!r.favorite&&!r.unavailable).map(r=>({type:r.type,id:"module"===r.type?r.module_name:r.id}));return this.http.post("/ws/download/reserve",{content:s},{headers:{"Content-Type":"application/json"}}).pipe((0,le.T)(r=>{const a=r.tokens;return i.map(d=>{const f=d.type,T="module"===d.type?d.module_name:d.id,L=a.find(ee=>ee.type===f&&ee.id===T);return L&&L.token?this.buildDownloadURL(L.token):""})}),(0,Ai.W)(()=>(0,Rt.of)(i.map(()=>""))))}extendWidgetOptions(i,s){const r=this.expandWidgetOptions(s);return this.deepExtendWidgetOptions(i,r),i}getWidgetConfig(i){const s={};return Object.keys(i).forEach(a=>{const d=i[a];if(null!==d){const f=this.getConfigName(a);s[f]=d}}),s}getConfigName(i){const r=this.camelToDashCase(i).replace(/^ui-/g,"");return this.dashCaseToCamelCase(r)}getParamsForLoadingExperience(i){const s={};return i.autoLoad||(s["auto-load"]=!1),i.initial.button?s["initial.button"]=!0:i.initial.handHint?s["initial.hand"]=!0:i.initial.play?s["initial.play"]=!0:i.initial.summary?s["initial.summary"]=!0:s["initial.none"]=!0,i.playthrough&&(s.playthrough=!0),s}getParamsForScrollMode(i){return i.disableScroll.alert?{"disable-scroll.alert":!0}:i.disableScroll.overlay?{"disable-scroll":!0}:{"disable-scroll":!1}}getParamsForLoadRotate(i){return"number"==typeof i.loadRotate?{"load-rotate":i.loadRotate}:{}}getParamsForLabelScale(i){return{}}getParamsForUIOptions(i){return{"ui-anatomy-descriptions":i.uiAnatomyDescriptions,"ui-anatomy-pronunciations":i.uiAnatomyPronunciations,"ui-anatomy-labels":i.uiAnatomyLabels,"ui-audio":i.uiAudio,"ui-chapter-list":i.uiChapterList,"ui-fullscreen":i.uiFullscreen,"ui-help":i.uiHelp,"ui-info":i.uiInfo,"ui-label-list":i.uiLabelList,"ui-layers":i.uiVisibilityLayers,"ui-skin-layers":i.uiSkinLayers,"ui-loader":i.uiLoader,"ui-media-controls":i.uiMedia,"ui-menu":i.uiMenu,"ui-nav":i.uiNav,"ui-search":i.uiSearch,"ui-tools":i.uiTools,"ui-tutorial":i.uiTutorial,"ui-undo":i.uiUndo,"ui-whiteboard":i.uiWhiteboard,...this.getParamsForUIQuiz(i)}}getParamsForUIQuiz(i){const s={},r=(0,m.get)(i,"uiQuiz.mode"),a=(0,m.get)(i,"uiQuiz.number");return r===Ta.Disabled&&(s["ui-quiz"]=!1),r===Ta.Locked&&(s["ui-quiz-locked"]=!0),(0,m.isNil)(a)||(s["ui-quiz-start"]=a,s["ui-quiz-end"]=a),s}camelToDashCase(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}dashCaseToCamelCase(i){return i.replace(/-([a-z])/g,s=>s[1].toUpperCase())}isCustomWidget(i){return/widgets\/([^\/]+)\//.test(i)}saveUserImage(i,s="jpeg"){return this.http.post("/ws/user/image/v1-0",{image_src:i,image_type:s},cf).pipe((0,le.T)(r=>r.url))}buildWidgetURL(i,s){const r=Object.entries(s).map(([d,f])=>`${d}=${f}`).join("&");let a=i.replace(/^\/|\/$/g,"");return!1===s["auto-load"]&&"viewer"===a&&(a="tiny-viewer"),I.c.deploy===ri.Z.Local?`${this.VIEWER_BASE_URL}/?${r}`:`${this.APP_BASE_URL}/${a}/?${r}`}buildThumbnailURL(i){return`${this.APP_BASE_URL}${i}`}buildDownloadURL(i){return`${this.APP_BASE_URL}/download?t=${i}`}deepExtendWidgetOptions(i,s){Object.entries(i).forEach(([r,a])=>{const d=typeof a;[r,this.camelToDashCase(r),this.getConfigName(r)].forEach(T=>{if(s.hasOwnProperty(T)&&null!==s[T]){const L=s[T];null===a?i[r]=L:d===typeof L&&("object"===d?this.deepExtendWidgetOptions(a,L):i[r]=L)}})})}expandWidgetOptions(i){const s={};return Object.entries(i).forEach(([r,a])=>{const d=r.split(".");if(d.length>1){const f=d[0],T=d.slice(1).join(".");(null===s[f]||"object"!=typeof s[f])&&(s[f]={}),s[f][T]=a}else s[r]=i[r]}),s}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(co.j),e.KVO(lf.D),e.KVO(he),e.KVO(Tp),e.KVO(_o.UG),e.KVO(kp),e.KVO(rf))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})(),Up=(()=>{class t{constructor(i){this.widgetURL=i}}return t.type="[Publish] Set Widget URL",t})(),df=(()=>{class t{constructor(i){this.dimensions=i}}return t.type="[Publish] Set Dimensions",t})(),_f=(()=>{class t{constructor(i,s,r,a){this.model=i,this.widgetOptions=s,this.camera=r,this.dimensions=a}}return t.type="[Publish] Get iFrame",t})(),jp=(()=>{class t{constructor(i){this.embed=i}}return t.type="[Publish] Get iFrame Success",t})(),jE=(()=>{class t{constructor(){}}return t.type="[Publish] Get iFrame Fail",t})(),pf=(()=>{class t{constructor(i,s,r){this.model=i,this.widgetOptions=s,this.camera=r}}return t.type="[Publish] Get URL",t})(),Vp=(()=>{class t{constructor(i,s){this.model=i,this.url=s}}return t.type="[Publish] Get URL Success",t})(),xp=(()=>{class t{constructor(i){this.model=i}}return t.type="[Publish] Get URL Fail",t})(),uf=(()=>{class t{constructor(i){this.publishing=i}}return t.type="[Publish] Set Publishing",t})(),gf=(()=>{class t{constructor(){}}return t.type="[Publish] Reset Publishing",t})(),hf=(()=>{class t{constructor(i,s="jpeg"){this.imageData=i,this.imageType=s}}return t.type="[Publish] Save Publish Image",t})(),Fp=(()=>{class t{constructor(i){this.imageURL=i}}return t.type="[Publish] Save Publish Image Success",t})(),VE=(()=>{class t{constructor(){}}return t.type="[Publish] Save Publish Image Fail",t})(),mf=(()=>{class t{constructor(i,s,r,a,d){this.model=i,this.imageData=s,this.fileType=r,this.widgetOptions=a,this.camera=d}}return t.type="[Publish] Get Publish Image Code",t})(),xE=(()=>{class t{constructor(i){this.embed=i}}return t.type="[Publish] Get Publish Image Code Success",t})(),FE=(()=>{class t{constructor(){}}return t.type="[Publish] Get Publish Image Code Fail",t})();var ws,ot=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ue=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const ff={joinDomains:[],loading:!1,creating:!1,updating:!1,deleting:!1,loadingJoinDomains:!1,addingJoinDomains:!1,removingJoinDomains:!1,generatingGroupCode:!1,loadingCollections:!1,addingCollection:!1,reorderingCollections:!1,removingCollection:!1,updatingCollection:!1,collectionRenaming:null};let et=(ws=class{static getOrganizations(t){return t.organizations}static getOrganization(t){return t.organization}static getOrganizationLogo(t){return t.organization?.group_logos?.human_app?.default?.logo_url??""}static getSelectedOrganization(t){return t.selectedOrganization}static getSelectedOrganizationProductAccountId(t){return(0,m.get)(t,"organization.product_acctid")}static getOrganizationProfile(t){return t.organizationProfile}static getOrganizationGroupAttributes(t){return(0,m.get)(t,"organization.group_attributes",[])}static getOrganizationAccountSettings(t){return function GE(n,t){return n.filter(o=>o.type===t).map(o=>{const{name:i,value:s}=o;return{[i]:{value:s}}})}(this.getOrganizationGroupAttributes(t),"account_settings")}static getDefaultUserRole(t,o){const s=this.getOrganizationGroupAttributes(t).find(r=>"default_user_role"===r.name);return(0,m.get)(s,"value",ke.getSystemDefaultRole(o))}static getOrganizationGroupCode(t){return(0,m.get)(t,"organization.group_code","")}static getCollections(t){return t.collections}static getSelectedCollection(t){return t.selectedCollection}static getReorderingCollections(t){return t.reorderingCollections}static getAddingCollection(t){return t.addingCollection}static getRemovingCollection(t){return t.removingCollection}static getUpdatingCollection(t){return t.updatingCollection}static getCollectionRenaming(t){return t.collectionRenaming}static getGeneratingGroupCode(t){return t.generatingGroupCode}static getWidgetURL(t){return t.widgetURL}static getWidgetOptions(t){return t.widgetOptions}static getAppFeatures(t){return t.appFeatures}static getCreating(t){return t.creating}static getUpdating(t){return t.updating}static getDeleting(t){return t.deleting}static getLoading(t){return t.loading}static getCollectionsLoading(t){return t.loadingCollections}static getLoadingJoinDomains(t){return t.loadingJoinDomains}static getAddingJoinDomains(t){return t.addingJoinDomains}static getRemovingJoinDomains(t){return t.removingJoinDomains}static hasOrganization(t){return!(0,m.isNil)(t.organization)}static isTrial(t){return(0,m.get)(t,"organization.subscription.free_trial",!1)}static isSubscriptionExpired(t){return!0===(0,m.get)(t,"organization.subscription.expired",!1)}static getSubscriptionEndDate(t){const o=(0,m.get)(t,"organization.subscription.paid_through_date_time");return(0,m.isNil)(o)?void 0:new Date(o)}static getExternalAccount({organization:t}){return t?.external_account}static isValidPaidSubscription(t){return this.hasOrganization(t)&&!this.isTrial(t)&&!this.isSubscriptionExpired(t)}static getJoinDomains(t){return t.joinDomains}static isZSpaceAccount(t){return this.getExternalAccount(t).external_account_provider===Ti.a.Zspace}static getOrganizationAddOns(t){return t?.organization?.subscription?.addons}selectOrganization(t,o){const i=o.organization;t.patchState({selectedOrganization:i,selectedCollection:null}),i&&t.dispatch(new dp(i.id))}setOrganizations(t,o){const i=o.organizations||[],s=i[0];let r,a=null,d={...t.getState().appFeatures};if(s&&s.group_attributes){const f=s.group_attributes,T=this.organizationsService.getOrganizationAttribute(f,"widget_settings","widget_custom_url_path");T&&T.value&&(r=T.value);const L=this.organizationsService.getOrganizationAttribute(f,"widget_settings","widget_url_params");L&&L.value&&(a=this.publishService.extendWidgetOptions(new Np,L.value));const ee=this.organizationsService.getOrganizationAttribute(f,"app_settings","web_app_features");ee&&(d={...d,...ee.value})}t.patchState({organization:s,organizations:i,widgetURL:r,widgetOptions:a,appFeatures:d}),t.dispatch(new Up(r)),s&&this.vendorAnalyticsService.updateAccountData(s)}getCollections(t,o){t.patchState({loadingCollections:!0}),this.organizationsService.getCollections({group_id:o.organizationId}).pipe((0,bt.j)(()=>t.patchState({loadingCollections:!1}))).subscribe(i=>{t.dispatch(new _p(i))})}getCollectionsSuccess(t,o){t.patchState({collections:o.collections})}selectCollection(t,o){const{organization:i,selectedOrganization:s}=t.getState();t.patchState({selectedOrganization:s||i,selectedCollection:o.collection})}addCollection(t,o){t.patchState({addingCollection:!0}),this.organizationsService.addCollection(o.organizationId,o.collectionName).pipe((0,bt.j)(()=>{t.patchState({addingCollection:!1})})).subscribe(()=>{t.dispatch(new pp(o.organizationId,o.collectionName))},i=>{t.dispatch(new up(i))})}addCollectionSuccess(t,o){this.vendorAnalyticsService.track("Add Collection - Success",{platform:this.productService.productType})}addCollectionError(t,o){this.vendorAnalyticsService.track("Add Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection creation."})}removeCollection(t,o){t.patchState({removingCollection:!0}),this.organizationsService.removeCollection(o.collection).pipe((0,bt.j)(()=>{t.patchState({removingCollection:!1})})).subscribe(()=>{t.dispatch(new gp(o.collection))},i=>{t.dispatch(new hp(i))})}removeCollectionSuccess(t,o){this.vendorAnalyticsService.track("Remove Collection - Success",{platform:this.productService.productType})}removeCollectionError(t,o){this.vendorAnalyticsService.track("Remove Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection removal."})}setCollectionRenameMode(t,o){t.patchState({collectionRenaming:o.collection})}renameCollection(t,o){t.patchState({updatingCollection:!0}),this.organizationsService.renameCollection(o.collection,o.collectionName).pipe((0,bt.j)(()=>{t.patchState({updatingCollection:!1})})).subscribe(()=>{t.dispatch(new mp(o.collection,o.collectionName))},i=>{t.dispatch(new fp(i))})}renameCollectionSuccess(t,o){this.vendorAnalyticsService.track("Rename Collection - Success",{platform:this.productService.productType})}renameCollectionError(t,o){this.vendorAnalyticsService.track("Rename Collection - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with collection renaming."})}reorderCollections(t,o){t.patchState({reorderingCollections:!0}),this.organizationsService.reorderCollections(o.organizationId,o.collections).pipe((0,bt.j)(()=>{t.patchState({reorderingCollections:!1})})).subscribe(()=>{t.dispatch(new Sp(o.organizationId,o.collections))},i=>{t.dispatch(new nE(i))})}reorderCollectionsSuccess(t,o){t.patchState({collections:[...o.collections]})}resetOrganizations(t,o){t.setState(ff)}createOrganization(t,{organization:o}){t.patchState({creating:!0}),this.organizationsService.createOrganization(o).pipe((0,bt.j)(()=>t.patchState({creating:!1}))).subscribe(()=>t.dispatch(new km),i=>t.dispatch(new yp(i)))}createOrganizationSuccess(t){this.vendorAnalyticsService.track("Team Creation - Success",{platform:this.productService.productType})}createOrganizationFail(t,o){this.vendorAnalyticsService.track("Team Creation - Failure",{error:(0,m.get)(o,"error.error.error.message")||"There was an error with team creation."})}updateOrganization(t,{organization:o}){t.patchState({updating:!0}),this.organizationsService.updateOrganization(o).pipe((0,bt.j)(()=>t.patchState({updating:!1}))).subscribe(()=>t.dispatch(new iE),i=>t.dispatch(new oE(i)))}deleteOrganization(t,{organization:o}){t.patchState({deleting:!0}),this.organizationsService.deleteOrganization(o.id).pipe((0,bt.j)(()=>t.patchState({deleting:!1}))).subscribe({next:()=>t.dispatch(new sE(o)),error:i=>t.dispatch(new rE(i))})}getOrganizationProfile(t,{request:o}){t.patchState({loading:!0}),this.organizationsService.getPublicProfile(o).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>t.dispatch(new vp(i)),i=>t.dispatch(new aE(i)))}getOrganizationProfileSuccess(t,{organizationProfile:o}){t.patchState({organizationProfile:o})}clearOrganizationProfile(t,o){t.patchState({organizationProfile:void 0})}getJoinDomains(t,o){t.patchState({loadingJoinDomains:!0}),this.organizationsService.getJoinDomains(o.params).pipe((0,bt.j)(()=>t.patchState({loadingJoinDomains:!1}))).subscribe(i=>{t.dispatch(new Ep(i.email_domains))})}getJoinDomainsSuccess(t,{joinDomains:o}){t.patchState({joinDomains:o})}postJoinDomains(t,o){t.patchState({addingJoinDomains:!0}),this.organizationsService.postJoinDomains(o.emailDomains).pipe((0,bt.j)(()=>t.patchState({addingJoinDomains:!1}))).subscribe({next:()=>{t.dispatch(new lE(o.emailDomains))},error:i=>{t.dispatch(new cE(i))}})}deleteJoinDomains(t,o){t.patchState({removingJoinDomains:!0}),this.organizationsService.deleteJoinDomains(o.joinDomainIds).pipe((0,bt.j)(()=>t.patchState({removingJoinDomains:!1}))).subscribe({next:()=>{t.dispatch(new dE(o.joinDomainIds))},error:i=>{t.dispatch(new _E(i))}})}generateGroupCode(t,o){t.patchState({generatingGroupCode:!0}),this.organizationsService.generateGroupCode(o.groupId).pipe((0,bt.j)(()=>t.patchState({generatingGroupCode:!1}))).subscribe({next:i=>t.dispatch(new Cp(i.group_code)),error:i=>t.dispatch(new pE(i))})}generateGroupCodeSuccess(t,o){const i={...t.getState().organization,group_code:o.groupCode};t.patchState({organization:i})}constructor(t,o,i,s){this.organizationsService=t,this.publishService=o,this.vendorAnalyticsService=i,this.productService=s}},ws.\u0275fac=function(t){return new(t||ws)(e.KVO(he),e.KVO(Sr),e.KVO(qe),e.KVO(je))},ws.\u0275prov=e.jDH({token:ws,factory:ws.\u0275fac}),ws);ot([(0,l.rc)(Mm),ue("design:type",Function),ue("design:paramtypes",[Object,Mm]),ue("design:returntype",void 0)],et.prototype,"selectOrganization",null),ot([(0,l.rc)(Nc),ue("design:type",Function),ue("design:paramtypes",[Object,Nc]),ue("design:returntype",void 0)],et.prototype,"setOrganizations",null),ot([(0,l.rc)(dp),ue("design:type",Function),ue("design:paramtypes",[Object,dp]),ue("design:returntype",void 0)],et.prototype,"getCollections",null),ot([(0,l.rc)(_p),ue("design:type",Function),ue("design:paramtypes",[Object,_p]),ue("design:returntype",void 0)],et.prototype,"getCollectionsSuccess",null),ot([(0,l.rc)(Im),ue("design:type",Function),ue("design:paramtypes",[Object,Im]),ue("design:returntype",void 0)],et.prototype,"selectCollection",null),ot([(0,l.rc)(wm),ue("design:type",Function),ue("design:paramtypes",[Object,wm]),ue("design:returntype",void 0)],et.prototype,"addCollection",null),ot([(0,l.rc)(pp),ue("design:type",Function),ue("design:paramtypes",[Object,pp]),ue("design:returntype",void 0)],et.prototype,"addCollectionSuccess",null),ot([(0,l.rc)(up),ue("design:type",Function),ue("design:paramtypes",[Object,up]),ue("design:returntype",void 0)],et.prototype,"addCollectionError",null),ot([(0,l.rc)(Pm),ue("design:type",Function),ue("design:paramtypes",[Object,Pm]),ue("design:returntype",void 0)],et.prototype,"removeCollection",null),ot([(0,l.rc)(gp),ue("design:type",Function),ue("design:paramtypes",[Object,gp]),ue("design:returntype",void 0)],et.prototype,"removeCollectionSuccess",null),ot([(0,l.rc)(hp),ue("design:type",Function),ue("design:paramtypes",[Object,hp]),ue("design:returntype",void 0)],et.prototype,"removeCollectionError",null),ot([(0,l.rc)(Am),ue("design:type",Function),ue("design:paramtypes",[Object,Am]),ue("design:returntype",void 0)],et.prototype,"setCollectionRenameMode",null),ot([(0,l.rc)(Nm),ue("design:type",Function),ue("design:paramtypes",[Object,Nm]),ue("design:returntype",void 0)],et.prototype,"renameCollection",null),ot([(0,l.rc)(mp),ue("design:type",Function),ue("design:paramtypes",[Object,mp]),ue("design:returntype",void 0)],et.prototype,"renameCollectionSuccess",null),ot([(0,l.rc)(fp),ue("design:type",Function),ue("design:paramtypes",[Object,fp]),ue("design:returntype",void 0)],et.prototype,"renameCollectionError",null),ot([(0,l.rc)(Rm),ue("design:type",Function),ue("design:paramtypes",[Object,Rm]),ue("design:returntype",void 0)],et.prototype,"reorderCollections",null),ot([(0,l.rc)(Sp),ue("design:type",Function),ue("design:paramtypes",[Object,Sp]),ue("design:returntype",void 0)],et.prototype,"reorderCollectionsSuccess",null),ot([(0,l.rc)(bp),ue("design:type",Function),ue("design:paramtypes",[Object,bp]),ue("design:returntype",void 0)],et.prototype,"resetOrganizations",null),ot([(0,l.rc)(Dm),ue("design:type",Function),ue("design:paramtypes",[Object,Dm]),ue("design:returntype",void 0)],et.prototype,"createOrganization",null),ot([(0,l.rc)(km),ue("design:type",Function),ue("design:paramtypes",[Object]),ue("design:returntype",void 0)],et.prototype,"createOrganizationSuccess",null),ot([(0,l.rc)(yp),ue("design:type",Function),ue("design:paramtypes",[Object,yp]),ue("design:returntype",void 0)],et.prototype,"createOrganizationFail",null),ot([(0,l.rc)(Lm),ue("design:type",Function),ue("design:paramtypes",[Object,Lm]),ue("design:returntype",void 0)],et.prototype,"updateOrganization",null),ot([(0,l.rc)(Um),ue("design:type",Function),ue("design:paramtypes",[Object,Um]),ue("design:returntype",void 0)],et.prototype,"deleteOrganization",null),ot([(0,l.rc)(jm),ue("design:type",Function),ue("design:paramtypes",[Object,jm]),ue("design:returntype",void 0)],et.prototype,"getOrganizationProfile",null),ot([(0,l.rc)(vp),ue("design:type",Function),ue("design:paramtypes",[Object,vp]),ue("design:returntype",void 0)],et.prototype,"getOrganizationProfileSuccess",null),ot([(0,l.rc)(Vm),ue("design:type",Function),ue("design:paramtypes",[Object,Vm]),ue("design:returntype",void 0)],et.prototype,"clearOrganizationProfile",null),ot([(0,l.rc)(xm),ue("design:type",Function),ue("design:paramtypes",[Object,xm]),ue("design:returntype",void 0)],et.prototype,"getJoinDomains",null),ot([(0,l.rc)(Ep),ue("design:type",Function),ue("design:paramtypes",[Object,Ep]),ue("design:returntype",void 0)],et.prototype,"getJoinDomainsSuccess",null),ot([(0,l.rc)(Fm),ue("design:type",Function),ue("design:paramtypes",[Object,Fm]),ue("design:returntype",void 0)],et.prototype,"postJoinDomains",null),ot([(0,l.rc)(Gm),ue("design:type",Function),ue("design:paramtypes",[Object,Gm]),ue("design:returntype",void 0)],et.prototype,"deleteJoinDomains",null),ot([(0,l.rc)($m),ue("design:type",Function),ue("design:paramtypes",[Object,$m]),ue("design:returntype",void 0)],et.prototype,"generateGroupCode",null),ot([(0,l.rc)(Cp),ue("design:type",Function),ue("design:paramtypes",[Object,Cp]),ue("design:returntype",void 0)],et.prototype,"generateGroupCodeSuccess",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getOrganizations",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getOrganization",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",String)],et,"getOrganizationLogo",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getSelectedOrganization",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",String)],et,"getSelectedOrganizationProductAccountId",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getOrganizationProfile",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getOrganizationGroupAttributes",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",Array)],et,"getOrganizationAccountSettings",null),ot([(0,l.MD)([ke]),ue("design:type",Function),ue("design:paramtypes",[Wt,Object]),ue("design:returntype",void 0)],et,"getDefaultUserRole",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getOrganizationGroupCode",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getCollections",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getSelectedCollection",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getReorderingCollections",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getAddingCollection",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getRemovingCollection",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getUpdatingCollection",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getCollectionRenaming",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getGeneratingGroupCode",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getWidgetURL",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getWidgetOptions",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getAppFeatures",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getCreating",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getUpdating",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getDeleting",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getLoading",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getCollectionsLoading",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getLoadingJoinDomains",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getAddingJoinDomains",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getRemovingJoinDomains",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"hasOrganization",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"isTrial",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"isSubscriptionExpired",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getSubscriptionEndDate",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",Object)],et,"getExternalAccount",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"isValidPaidSubscription",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"getJoinDomains",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",void 0)],et,"isZSpaceAccount",null),ot([(0,l.MD)(),ue("design:type",Function),ue("design:paramtypes",[Wt]),ue("design:returntype",Object)],et,"getOrganizationAddOns",null),et=ot([(0,l.Uw)({name:"organizations",defaults:ff}),ue("design:paramtypes",[he,Sr,qe,je])],et);const Ia={title:"Tags",tags:["Animated","Tour","Quiz","featured","new",Ti.a.Zspace]},Gp={title:"Gender",tags:["male","female"]},$p={title:"Pregnancy",tags:["First Trimester","Second Trimester","Third Trimester"]},br={title:"Regions",tags:["Head and Neck","Thorax","Abdomen","Back","Upper Limb","Pelvis","Lower Limb"]},yf={title:"Type (Deprecated)",tags:["Anatomy","Disease","Pharmacology","Physiology","Procedure"]},Tn={title:"Type",tags:["Healthy Anatomy and Physiology","Conditions","Procedures and Treatments"]},kc={title:"Level of Detail",tags:["Gross Anatomy","Tissue","Cellular","Molecular"]},Cf={title:"Downloaded",tags:["Downloaded"]},Tf={title:"Permissions",tags:["My Models","View & Edit","View Only"]},BE=[{title:"Status",tags:["Live","obsolete"]},{title:"Platform",tags:["web platform","ios platform","android platform"]},Ia,Gp,Tn,yf,kc,{title:"Anatomy Categories",tags:["complete anatomy","system","regional","Bony Landmarks","Cross Section","Cross Section and Micro Anatomy","Guided Anatomy","Micro Anatomy","Origins and Insertions"]},{title:"Clinical Specialty",tags:["Allergy and Immunology","Cardiology","Dentistry","Dermatology","Endocrinology","Gastroenterology and Hepatology","Gynecology","Hematology","Infectious Disease","Nephrology","Neurology and Psychiatry","Obstetrics","Oncology","Ophthalmology","Orthopedics","Otolaryngology","Pediatrics","Physical Therapy","Primary Care","Pulmonology and Respiratory","Rheumatology","Urology"]},Cf,Tf,br,$p],zE=[{title:"zSpace Models",id:Ti.a.Zspace,type:"Category",icon:"zspace"}],yr={main:[{title:"All Models",id:"all",type:"Category",icon:"all-models",tabTags:Tn,translations:{es:{title:"Todas las Categor\xedas"},zh:{title:"\u6240\u6709\u7c7b\u522b"},fr:{title:"Toutes les cat\xe9gories"},de:{title:"Alle Kategorien"},it:{title:"Tutte le categorie"},ja:{title:"\u3059\u3079\u3066\u306e\u30ab\u30c6\u30b4\u30ea"},pt:{title:"Todas as categorias"}}}],categories:[{title:"Anatomy by Regions",id:"regional",type:"Category",icon:"anatomy-by-regions",tabTags:br,translations:{es:{title:"Anatom\xeda regional"},zh:{title:"\u5c40\u90e8\u89e3\u5256"},fr:{title:"Anatomie r\xe9gionale"},de:{title:"Regionale Anatomie"},it:{title:"Anatomia regionale"},ja:{title:"\u5404\u90e8\u4f4d\u306e\u69cb\u9020"},pt:{title:"Anatomia Regional"}}},{title:"Anatomy by Systems",id:"system",type:"Category",icon:"anatomy-by-systems",tabTags:Gp,translations:{es:{title:"Anatom\xeda sistem\xe1tica"},zh:{title:"\u7cfb\u7edf\u89e3\u5256"},fr:{title:"Anatomie du syst\xe8me"},de:{title:"Systematische Anatomie"},it:{title:"Anatomia sistemica"},ja:{title:"\u5404\u5668\u5b98\u7cfb\u306e\u69cb\u9020"},pt:{title:"Anatomia do Sistema"}}},{title:"Complete Anatomy",id:"complete anatomy",type:"Category",icon:"complete-anatomy",translations:{de:{title:"Vollst\xe4ndige Anatomie"},es:{title:"Anatom\xeda completa"},fr:{title:"Anatomie compl\xe8te"},it:{title:"Anatomia completa"},ja:{title:"\u4eba\u4f53\u306e\u5168\u4f53\u69cb\u9020"},pt:{title:"Anatomia Completa"},zh:{title:"\u5b8c\u6574\u89e3\u5256"}}},{title:"Bony Landmarks",id:"Bony Landmarks",type:"Category",icon:"bony-landmarks",translations:{de:{title:"Kn\xf6cherne Orientierungspunkte"},es:{title:"Puntos de referencia \xf3seos"},fr:{title:"Rep\xe8res osseux"},it:{title:"Punti di repere ossei"},ja:{title:"\u9aa8\u306e\u30e9\u30f3\u30c9\u30de\u30fc\u30af"},pt:{title:"Marcos \xd3sseos"},zh:{title:"\u9aa8\u6027\u6807\u5fd7"}}},{title:"Cross Sections & Micro Anatomy",id:"Cross Section and Micro Anatomy",type:"Category",icon:"cross-sections-and-micro-anatomy",translations:{de:{title:"Querschnitte und mikroskopische Anatomie"},es:{title:"Cortes transversales y microanatom\xeda"},fr:{title:"Coupes transversales et micro anatomie"},it:{title:"Sezioni trasversali & anatomia microscopica"},ja:{title:"\u65ad\u9762\u56f3\u30fb\u30de\u30a4\u30af\u30ed\u89e3\u5256\u5b66"},pt:{title:"Sec\xe7\xf5es Transversais e Microanatomia"},zh:{title:"\u6a2a\u65ad\u9762&\u663e\u5fae\u89e3\u5256"}}},{title:"Origins & Insertions",id:"Origins and Insertions",type:"Category",icon:"origins-and-insertions",translations:{de:{title:"Urspr\xfcnge und Ans\xe4tze"},es:{title:"Or\xedgenes e inserciones"},fr:{title:"Origines et insertions"},it:{title:"Origini & inserzioni"},ja:{title:"\u8d77\u59cb\u30fb\u505c\u6b62"},pt:{title:"Origens e Inser\xe7\xf5es"},zh:{title:"\u8d77\u6e90\u4e0e\u63d2\u5165"}}},{title:"Anatomy Quizzes",id:"quiz",type:"Category",icon:"quizzes-and-assessments",tabTags:br,translations:{de:{title:"Anatomie Quizfragen"},es:{title:"Pruebas de anatom\xeda"},fr:{title:"Quizz d'anatomie"},it:{title:"Domande di anatomia"},ja:{title:"\u89e3\u5256\u5b66\u30af\u30a4\u30ba"},pt:{title:"Question\xe1rios de Anatomia"},zh:{title:"\u89e3\u5256\u5b66\u6d4b\u9a8c"}}}],specialties:[{title:"Allergy & Immunology",id:"Allergy and Immunology",type:"Category",icon:"allergy-and-immunology",tabTags:Tn,translations:{de:{title:"Allergie und Immunologie"},es:{title:"Alergia e inmunolog\xeda"},fr:{title:"Allergie et immunologie"},it:{title:"Allergologia & immunologia"},ja:{title:"\u30a2\u30ec\u30eb\u30ae\u30fc\u3068\u514d\u75ab\u5b66"},pt:{title:"Alergia e Imunologia"},zh:{title:"\u8fc7\u654f\u4e0e\u514d\u75ab\u5b66"}}},{title:"Cardiology",id:"Cardiology",type:"Category",icon:"cardiology",tabTags:Tn,translations:{de:{title:"Kardiologie"},es:{title:"Cardiolog\xeda"},fr:{title:"Cardiologie"},it:{title:"Cardiologia"},ja:{title:"\u5fc3\u81d3\u75c5\u5b66"},pt:{title:"Cardiologia"},zh:{title:"\u5fc3\u810f\u79d1"}}},{title:"Dentistry",id:"Dentistry",type:"Category",icon:"dentistry",tabTags:Tn,translations:{de:{title:"Zahnmedizin"},es:{title:"Odontolog\xeda"},fr:{title:"Dentisterie"},it:{title:"Odontoiatria"},ja:{title:"\u6b6f\u5b66"},pt:{title:"Odontologia"},zh:{title:"\u7259\u79d1"}}},{title:"Dermatology",id:"Dermatology",type:"Category",icon:"dermatology",tabTags:Tn,translations:{de:{title:"Dermatologie"},es:{title:"Dermatolog\xeda"},fr:{title:"Dermatologie"},it:{title:"Dermatologia"},ja:{title:"\u76ae\u819a\u5b66"},pt:{title:"Dermatologia"},zh:{title:"\u76ae\u80a4\u79d1"}}},{title:"Endocrinology",id:"Endocrinology",type:"Category",icon:"endocrinology",tabTags:Tn,translations:{de:{title:"Endokrinologie"},es:{title:"Endocrinolog\xeda"},fr:{title:"Endocrinologie"},it:{title:"Endocrinologia"},ja:{title:"\u5185\u5206\u6ccc\u5b66"},pt:{title:"Endocrinologia"},zh:{title:"\u5185\u5206\u6ccc\u79d1"}}},{title:"Gastroenterology",id:"Gastroenterology and Hepatology",type:"Category",icon:"gastroenterology",tabTags:Tn,translations:{de:{title:"Gastroenterologie"},es:{title:"Gastroenterolog\xeda"},fr:{title:"Gastroent\xe9rologie"},it:{title:"Gastroenterologia"},ja:{title:"\u80c3\u8178\u5b66"},pt:{title:"Gastroenterologia"},zh:{title:"\u80c3\u80a0\u75c5\u5b66"}}},{title:"Gynecology",id:"Gynecology",type:"Category",icon:"gynecology",tabTags:Tn,translations:{de:{title:"Gyn\xe4kologie"},es:{title:"Ginecolog\xeda"},fr:{title:"Gyn\xe9cologie"},it:{title:"Ginecologia"},ja:{title:"\u5a66\u4eba\u79d1\u5b66"},pt:{title:"Ginecologia"},zh:{title:"\u5987\u79d1"}}},{title:"Hematology",id:"Hematology",type:"Category",icon:"hematology",tabTags:Tn,translations:{de:{title:"H\xe4matologie"},es:{title:"Hematolog\xeda"},fr:{title:"H\xe9matologie"},it:{title:"Ematologia"},ja:{title:"\u8840\u6db2\u5b66"},pt:{title:"Hematologia"},zh:{title:"\u8840\u6db2\u79d1"}}},{title:"Infectious Disease",id:"Infectious Disease",type:"Category",icon:"infectious-disease",tabTags:Tn,translations:{de:{title:"Infektionskrankheit"},es:{title:"Enfermedades infecciosas"},fr:{title:"Maladies infectieuses"},it:{title:"Malattie infettive"},ja:{title:"\u611f\u67d3\u75c7"},pt:{title:"Doen\xe7a Infecciosa"},zh:{title:"\u4f20\u67d3\u75c5"}}},{title:"Nephrology",id:"Nephrology",type:"Category",icon:"nephrology",tabTags:Tn,translations:{de:{title:"Nephrologie"},es:{title:"Nefrolog\xeda"},fr:{title:"N\xe9phrologie"},it:{title:"Nefrologia"},ja:{title:"\u814e\u81d3\u5b66"},pt:{title:"Nefrologia"},zh:{title:"\u80be\u79d1"}}},{title:"Neurology & Psychiatry",id:"Neurology and Psychiatry",type:"Category",icon:"neurology-and-psychiatry",tabTags:Tn,translations:{de:{title:"Neurologie und Psychiatrie"},es:{title:"Neurolog\xeda y psiquiatr\xeda"},fr:{title:"Neurologie et psychiatrie"},it:{title:"Neurologia & psichiatria"},ja:{title:"\u795e\u7d4c\u5b66\u30fb\u7cbe\u795e\u533b\u5b66"},pt:{title:"Neurologia e Psiquiatria"},zh:{title:"\u795e\u7ecf\u79d1&\u7cbe\u795e\u79d1"}}},{title:"Obstetrics",id:"Obstetrics",type:"Category",icon:"obstetrics",tabTags:$p,translations:{de:{title:"Geburtshilfe"},es:{title:"Obstetricia "},fr:{title:"Obst\xe9trique"},it:{title:"Ostetricia"},ja:{title:"\u7523\u79d1\u5b66"},pt:{title:"Obstetr\xedcia"},zh:{title:"\u4ea7\u79d1"}}},{title:"Oncology",id:"Oncology",type:"Category",icon:"oncology",tabTags:Tn,translations:{de:{title:"Onkologie"},es:{title:"Oncolog\xeda"},fr:{title:"Oncologie"},it:{title:"Oncologia"},ja:{title:"\u816b\u760d\u5b66"},pt:{title:"Oncologia"},zh:{title:"\u80bf\u7624\u79d1"}}},{title:"Ophthalmology",id:"Ophthalmology",type:"Category",icon:"ophtalmology",tabTags:Tn,translations:{de:{title:"Ophthalmologie"},es:{title:"Oftalmolog\xeda"},fr:{title:"Ophtalmologie"},it:{title:"Oftalmologia"},ja:{title:"\u773c\u79d1\u5b66"},pt:{title:"Oftalmologia"},zh:{title:"\u773c\u79d1"}}},{title:"Orthopedics",id:"Orthopedics",type:"Category",icon:"orthopedics",tabTags:Tn,translations:{de:{title:"Orthop\xe4die"},es:{title:"Ortopedia"},fr:{title:"Orthop\xe9die"},it:{title:"Ortopedia"},ja:{title:"\u6574\u5f62\u5916\u79d1\u5b66"},pt:{title:"Ortopedia"},zh:{title:"\u9aa8\u79d1"}}},{title:"Otolaryngology",id:"Otolaryngology",type:"Category",icon:"otolarygngology",tabTags:Tn,translations:{de:{title:"Otolaryngologie"},es:{title:"Otorrinolaringolog\xeda"},fr:{title:"Otorhinolaryngologie"},it:{title:"Otorinolaringoiatria"},ja:{title:"\u8033\u9f3b\u79d1\u5b66"},pt:{title:"Otorrinolaringologia"},zh:{title:"\u8033\u9f3b\u5589\u79d1"}}},{title:"Pediatrics",id:"Pediatrics",type:"Category",icon:"pediatrics",tabTags:Tn,translations:{de:{title:"P\xe4diatrie"},es:{title:"Pediatr\xeda"},fr:{title:"P\xe9diatrie"},it:{title:"Pediatria"},ja:{title:"\u5c0f\u5150\u79d1\u5b66"},pt:{title:"Pediatria"},zh:{title:"\u513f\u79d1"}}},{title:"Physical Therapy",id:"Physical Therapy",type:"Category",icon:"physical-therapy",tabTags:Tn,translations:{de:{title:"Physiotherapie"},es:{title:"Fisioterapia"},fr:{title:"Kin\xe9sith\xe9rapie"},it:{title:"Fisioterapia"},ja:{title:"\u7406\u5b66\u7642\u6cd5"},pt:{title:"Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597"}}},{title:"Primary Care",id:"Primary Care",type:"Category",icon:"primary-care",tabTags:Tn,translations:{de:{title:"Prim\xe4rversorgung"},es:{title:"Atenci\xf3n primaria"},fr:{title:"Soins de sant\xe9 primaires"},it:{title:"Assistenza sanitaria di base"},ja:{title:"\u30d7\u30e9\u30a4\u30de\u30ea\u30fc\u30b1\u30a2"},pt:{title:"Aten\xe7\xe3o Prim\xe1ria"},zh:{title:"\u521d\u7ea7\u536b\u751f\u4fdd\u5065"}}},{title:"Pulmonology",id:"Pulmonology and Respiratory",type:"Category",icon:"pulmonology",tabTags:Tn,translations:{de:{title:"Pulmonologie"},es:{title:"Neumolog\xeda"},fr:{title:"Pneumologie"},it:{title:"Pneumologia"},ja:{title:"\u547c\u5438\u5668\u5b66"},pt:{title:"Pneumologia"},zh:{title:"\u80ba\u75c5\u79d1"}}},{title:"Rheumatology",id:"Rheumatology",type:"Category",icon:"rheumatology",tabTags:Tn,translations:{de:{title:"Rheumatologie"},es:{title:"Reumatolog\xeda"},fr:{title:"Rhumatologie"},it:{title:"Reumatologia"},ja:{title:"\u30ea\u30a6\u30de\u30c1\u5b66"},pt:{title:"Reumatologia"},zh:{title:"\u98ce\u6e7f\u79d1"}}},{title:"Urology",id:"Urology",type:"Category",icon:"urology",tabTags:Tn,translations:{de:{title:"Urologie"},es:{title:"Urolog\xeda"},fr:{title:"Urologie"},it:{title:"Urologia"},ja:{title:"\u6ccc\u5c3f\u5668\u79d1\u5b66"},pt:{title:"Urologia"},zh:{title:"\u6ccc\u5c3f\u5916\u79d1"}}}],community:[{title:"Community Bookmarks",id:"public",type:"Community",icon:"community-bookmarks",translations:{de:{title:"Community-Lesezeichen"},es:{title:"Destacados por la comunidad"},fr:{title:"Signets communautaires"},it:{title:"Segnalibri della community"},ja:{title:"\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u306e\u30d6\u30c3\u30af\u30de\u30fc\u30af"},pt:{title:"Favoritos da comunidade"},zh:{title:"\u793e\u533a\u4e66\u7b7e"}}}],"expert collections":[{id:"Anatomy for Physical Therapy Students",featured:!0,type:"Category",title:"Anatomy for Physical Therapy Students",subtitle:"Created with Kirsten C Moisio PT, PhD",metadata:"Professor of Physical Therapy",image:"/assets/images/expert-collections/physical-therapy.png",featuredIcon:"/assets/images/logos/northwestern-medicine-logo.svg",outerColor:"#28167E",innerColor:"#5B49B6",translations:{de:{title:"Anatomie f\xfcr Studierende der Physiotherapie",subtitle:"Erstellt mit Kirsten C Moisio PT, PhD",metadata:"Professor f\xfcr Physikalische Therapie"},es:{title:"Anatom\xeda para estudiantes de fisioterapia",subtitle:"Creado con Kirsten C Moisio PT, PhD",metadata:"Profesor de Fisioterapia"},fr:{title:"Anatomie pour \xe9tudiants en physioth\xe9rapie",subtitle:"Cr\xe9\xe9 avec Kirsten C Moisio PT, PhD",metadata:"Professeur de kin\xe9sith\xe9rapie"},it:{title:"Anatomia per studenti di terapia fisica",subtitle:"Creato con Kirsten C Moisio PT, PhD",metadata:"Professore di terapia fisica"},ja:{title:"\u7406\u5b66\u7642\u6cd5\u5b66\u751f\u306e\u305f\u3081\u306e\u89e3\u5256\u5b66",subtitle:"Kirsten C Moisio PT, PhD\u3068\u5171\u540c\u3067\u4f5c\u6210",metadata:"\u7406\u5b66\u7642\u6cd5\u5b66\u6559\u6388"},pt:{title:"Anatomia para estudantes de fisioterapia",subtitle:"Criado com Kirsten C Moisio PT, PhD",metadata:"Professor de Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597\u5b66\u751f\u7684\u89e3\u5256\u5b66",subtitle:"\u7531 Kirsten C Moisio PT \u535a\u58eb\u521b\u4f5c",metadata:"\u7269\u7406\u7597\u6cd5\u6559\u6388"}}},{id:"Anatomy for Medical Students",featured:!0,type:"Category",tabTags:br,title:"Anatomy for Medical Students",subtitle:"Created with Jonathan J Wisco, PhD",metadata:"Associate Professor of Anatomy & Neurobiology",image:"/assets/images/expert-collections/medical.png",featuredIcon:"/assets/images/logos/bu-logo.svg",outerColor:"#242629",innerColor:"#585D64",translations:{de:{title:"Anatomie f\xfcr Medizinstudenten",subtitle:"Erstellt mit Jonathan J Wisco, PhD",metadata:"Assoziierter Professor f\xfcr Anatomie und Neurobiologie"},es:{title:"Anatom\xeda para estudiantes de medicina",subtitle:"Creado con Jonathan J Wisco, PhD",metadata:"Profesor asociado de anatom\xeda y neurobiolog\xeda"},fr:{title:"Anatomie pour les \xe9tudiants en m\xe9decine",subtitle:"Cr\xe9\xe9 avec Jonathan J Wisco, PhD",metadata:"Professeur associ\xe9 d'anatomie et de neurobiologie"},it:{title:"Anatomia per studenti di medicina",subtitle:"Creato con Jonathan J Wisco, PhD",metadata:"Professore associato di Anatomia e Neurobiologia"},ja:{title:"\u533b\u5b66\u751f\u306e\u305f\u3081\u306e\u89e3\u5256\u5b66",subtitle:"\u30b8\u30e7\u30ca\u30b5\u30f3\u30fbJ\u30fb\u30a6\u30a3\u30b9\u30b3\u535a\u58eb\u3068\u5171\u540c\u3067\u4f5c\u6210",metadata:"\u89e3\u5256\u5b66\u304a\u3088\u3073\u795e\u7d4c\u751f\u7269\u5b66\u306e\u51c6\u6559\u6388"},pt:{title:"Anatomia para estudantes de medicina",subtitle:"Criado com Jonathan J Wisco, PhD",metadata:"Professor Associado de Anatomia e Neurobiologia"},zh:{title:"\u533b\u5b66\u751f\u89e3\u5256\u5b66",subtitle:"\u7531 Jonathan J Wisco \u535a\u58eb\u521b\u4f5c",metadata:"\u89e3\u5256\u5b66\u548c\u795e\u7ecf\u751f\u7269\u5b66\u526f\u6559\u6388"}}}]};function Bp(n){return[...Gi(yr.main,n),...Gi(yr.categories,n),...Gi(zE,n),...Gi(yr.specialties,n),...Gi(yr.community,n),...Gi(yr["expert collections"],n)]}function Gi(n,t){return n.map(o=>function Of(n,t){const o=(0,m.cloneDeep)(n);return t&&(o.title=(0,m.get)(o,`translations.${t}.title`,o.title),o.subtitle&&(o.subtitle=(0,m.get)(o,`translations.${t}.subtitle`,o.subtitle)),o.metadata&&(o.metadata=(0,m.get)(o,`translations.${t}.metadata`,o.metadata))),o}(o,t))}const vr=1e4,zp="/ws/user/bookmark/v4",wa={headers:new w.Lr({"Content-Type":"application/json; charset=utf-8"})};let Pa=(()=>{var n;class t{constructor(i,s,r,a,d,f){this.store=i,this.http=s,this.serializeModuleService=r,this.storyService=a,this.productService=d,this.storageService=f}getBookmarkData(i){return this.http.get(`/search/bookmarks/data?be=${i}`).pipe((0,vc.l)(s=>s.pipe((0,dr.c)(1e3),(0,tn.s)(3))),(0,le.T)(s=>((s=s.bookmark).moduleId=s.customData?s.customData.moduleId:s.modules.activeModules[0],(0,p.bj)(c1,s))))}getBookmarkModel(i){return this.http.get(`/ws/search/bookmarks?eid=${i}`).pipe((0,vc.l)(s=>s.pipe((0,dr.c)(1e3),(0,tn.s)(3))),(0,le.T)(s=>(0,p.bj)(me,s.bookmark_info)),(0,le.T)(s=>Pe(s)))}getUserBookmarks(i,s="",r=vr,a,d){const f={q:s,page_size:`${r}`,ol:a};return(0,m.isNil)(d)||(f.is_owner=""+(d?1:0)),this.http.get(`/ws/search/bookmarks/${i}`,{params:f}).pipe((0,vc.l)(T=>T.pipe((0,dr.c)(1e3),(0,tn.s)(3))),(0,le.T)(T=>T.map(L=>(0,p.bj)(me,L)).map(L=>Pe(L))))}getUserConditions(i,s="",r,a,d=vr){let f="";switch(i){case Ho.Private:f="user";break;case Ho.Group:f="group"}return this.http.get(`/ws/search/conditions/private?q=${s}&page_size=${d}&ol=${r}`).pipe((0,le.T)(T=>T.filter(L=>L.module_accessor_level===f&&(!a||L.module_accessor_id===a))),(0,le.T)(T=>(0,p.bj)(me,T)),(0,le.T)(T=>T.map(L=>Pe(L))))}getPrivateBookmarks(i="",s,r=vr){return this.getUserBookmarks(Ho.Private,i,r,s,!0)}getPrivateConditions(i="",s){return this.getUserConditions(Ho.Private,i,s)}getOrganizationBookmarks(i,s="",r=vr,a){return this.getUserBookmarks(Ho.Private,s,r,a).pipe((0,le.T)(d=>d.filter(f=>f.tags.includes("enterprise")).filter(f=>f.group_access.some(T=>T.group_id===i))))}getOrganizationConditions(i,s="",r){return this.getUserConditions(Ho.Group,s,r,i)}getOrganizationContent(i,s="",r){return(0,si.p)([this.getOrganizationBookmarks(i,s,vr,r),this.getOrganizationConditions(i,s,r)]).pipe((0,le.T)(([a,d])=>[...a,...d]))}getPrivateContent(i="",s){return(0,si.p)([this.getPrivateBookmarks(i,s),this.getPrivateConditions(i,s)]).pipe((0,le.T)(([r,a])=>[...r,...a]))}createBookmarkStory(i,s){return this.serializeModuleService.serialize({},new ah,!1,{...this.store.selectSnapshot(rt.getStory),displayName:i},this.store.selectSnapshot(fe.N.getStoryChapters),s)}getPublicBookmarks(i="",s){return this.getUserBookmarks(Ho.Public,i,vr,s)}saveBookmark(i){const s=this.getNormalizedBookmarkEntry(i);let r;return r=this.http.post(i.id?`${zp}/update`:`${zp}/save`,s,wa),r.pipe((0,Ec.q)(a=>this.getBookmarkModel(a.id)))}bulkCopyBookmarks(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/bookmark/bulk/copy",{version:1,app_producttype:s,app_productkey:r,source_content:i},wa)}getBookmarkJobs(i={}){const{productType:s,productKey:r}=this.productService;return this.http.get("/ws/user/jobs",{params:{version:1,app_producttype:s,app_productkey:r,...i}}).pipe((0,le.T)(a=>a?.jobs??[]))}cancelBookmarkJob(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/jobs/cancel",{version:1,app_producttype:s,app_productkey:r,job_id:i},wa)}deleteBookmark(i){return this.http.delete(`${zp}/delete`,{params:{eid:i,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}).pipe((0,Ai.W)(a=>{const d=Qo(a);return(0,qh.$)(()=>d)}))}bulkDeleteBookmarks(i){const{productType:s,productKey:r}=this.productService;return this.http.post("/ws/user/bookmark/bulk/delete",{version:1,app_producttype:s,app_productkey:r,eids:i},wa)}atMaxFreeBookmarkCount(){return this.http.get("/ws/user/content/limit/check?version=2").pipe((0,Ai.W)(i=>(0,Rt.of)({limit_reached:!1})))}filterByTags(i,s,r=!1){return i.filter(a=>r?s.every(d=>a.tags.includes(d)):s.some(d=>a.tags.includes(d)))}getTags(i){if(i){const s=[],a=function vE(n,t){const o=Fi(n,un.EditBookmarks);return!!o&&(t.type===ye.c.Module?o:!(!0!==t.is_owner)||!!mr(t)&&function Qm(n,t){if(Fi(n,un.EditAllTeamBookmarks))return!0;const i=Fi(n,un.EditTeamBookmarks),s=mr(t)&&t.group_access[0].member_edit;return i&&s}(n,t))}(this.store.selectSnapshot(ke.getUserRole),i),d=i.type===ye.c.Bookmark&&!a;return this.isZSpaceModel(i)&&s.push(Jm.n3[Ti.a.Zspace]),d&&s.push("View Only"),i.animated&&s.push("Animated"),i.tour&&s.push("Tour"),i.quiz&&s.push("Quiz"),s}return[]}getCategories(i,s="en",r){const a=null!=r?(0,m.flatten)(r.map(f=>function WE(n,t){return Gi(yr[n],t)}(f,s))):Bp(s),d=[];return i.type===ye.c.Module?(i.tags.forEach(f=>{const T=a.find(L=>L.id===f);T&&d.push(T)}),d):null}isZSpaceModel(i){return!!(0,m.isArray)(i.tags)&&i.tags.includes(Ti.a.Zspace)}getZSpaceRestriction(){return I.c.application===Wn.c.Loft?Ti.O.None:!this.store.selectSnapshot(et.hasOrganization)||this.store.selectSnapshot(et.isSubscriptionExpired)?Ti.O.Subscription:"true"!==this.storageService.getLocalItem(zt.UT.ZSpaceDevice)?Ti.O.Device:Ti.O.None}getShowcase(i,s,r="en"){const a=[];if(!(0,m.isNil)(i)&&i.type===Ip.P.User){const d=this.getUserShowcase(r);a.push(d)}if(!(0,m.isNil)(s)){const d=this.getOrganizationShowcase(s,r);a.push(d)}return a.length?(0,si.p)(a):(0,Rt.of)([])}getUserShowcase(i="en"){return this.getPrivateBookmarks("",i,10).pipe((0,le.T)(s=>this.createPrivateShowcase(s)))}getOrganizationShowcase(i,s="en"){return this.getOrganizationBookmarks(i.id,"",10,s).pipe((0,le.T)(r=>this.createOrganizationShowcase(r,i)))}createMockBookmark(i){return{author:"",author_first_name:"",author_last_name:"",cost:0,create_date_time:new Date,description:"",id:"",is_owner:!0,last_editor:"",last_editor_first_name:"",last_editor_last_name:"",tags:[],thumbnail_url:"",title:"",update_date_time:new Date,type:ye.c.Bookmark,...i?{animated:!0,tour:!0}:{}}}createMockBookmarks(i=5){return[...Array(i).keys()].map(s=>this.createMockBookmark(s%2==0))}createPrivateShowcase(i){return{title:"Pick up where you left off",description:"",url:"/results/bookmarks?type=Private",bookmarks:i}}createOrganizationShowcase(i,s){return{title:`Recently added to ${s.name}`,description:"Recently added models to your Team library.",url:`/results/bookmarks?organizationId=${s.id}&type=Organization`,bookmarks:i}}translateBookmark(i,s,r,a){const d=r===ye.c.Module||r===ye.c.Internal?s.replace(".json",""):s;return(0,si.p)([this.storyService.getStory(i,ye.c.Bookmark),this.storyService.getStoryTranslation(d,r,a)]).pipe((0,le.T)(([f,T])=>this.storyService.translateStory(f,T)),(0,Ec.q)(f=>this.saveBookmark({isOwner:!0,title:f.displayName.substr(0,60),id:i,index:f})),(0,le.T)(f=>f.id),(0,Ai.W)(f=>404===f.status?(0,Rt.of)(i):(0,qh.$)(f)))}getNormalizedBookmarkEntry(i){let s,r,a,d;if(i.isOwner){if(s=i.add_group_access?this.getGroupAccess(i.add_group_access):[],i.remove_group_access&&i.remove_group_access.forEach(f=>{const T=this.getNormalizeGroupAccess({group_id:f.group_id,remove:!0});s.push(T)}),r=this.getNormalizedBool(i.public_access),i.index){a={},i.index.chapters&&(a[_r.UserGeneratedTour]=this.getNormalizedBool(i.index.chapters.length>1));const f=(i.index.tags||[]).includes("animated");a[_r.Animated]=this.getNormalizedBool(f),a[_r.ModeQuiz]=this.getNormalizedBool(i.viewMode===Ne.Quiz),a[_r.ModeContent]=this.getNormalizedBool(i.viewMode===Ne.Content),a[_r.Quiz]=this.getNormalizedBool(i.index?.quizSettings?.enabled??!1)}d=this.getNormalizedBool(i.is_content_copy)}return{eid:i.id,name:i.title,description:i.description,index:i.index,group_access:s,public_access:r,flags:a,is_content_copy:d,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}getGroupAccess(i){return i.map(s=>this.getNormalizeGroupAccess(s))}getNormalizeGroupAccess(i){const{group_id:s,group_name:r,member_edit:a,visible:d,remove:f}=i;return{group_id:s,group_name:r,member_edit:this.getNormalizedBool(a),visibility:this.getNormalizedBool(d),remove:this.getNormalizedBool(f)}}getNormalizedBool(i){return!0===i?"1":!1===i?"0":""}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(w.Qq),e.KVO(b_),e.KVO(da.J),e.KVO(je),e.KVO(zt.n$))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();const Mf={label:"Relevance",fields:[],ascending:!0},Lc={label:"Most Recent",fields:["collection_content_createdate","update_date_time","create_date_time"],ascending:!1},Aa={label:"Title (A-Z)",fields:["title"],ascending:!0},Uc={label:"Title (Z-A)",fields:["title"],ascending:!1},If={label:"Author (A-Z)",fields:["author"],ascending:!0},wf={label:"Author (Z-A)",fields:["author"],ascending:!1};var Pn=function(n){return n.Organization="Organization",n.Collection="Collection",n.Private="Private",n.Category="Category",n.Community="Community",n.Internal="Internal",n.Loft="Loft",n}(Pn||{});const XE=`/results/modules?categoryId=${Ti.a.Zspace}&type=Category`;class HE{constructor(t,o=[],i=""){this.categoryId=t,this.tags=o,this.query=i,this.type=Pn.Category}}class QE{constructor(t="",o=[]){this.query=t,this.tags=o,this.categoryId="public",this.type=Pn.Community}}const YE=["live"];let jc=(()=>{var n;class t{constructor(i){this.http=i}searchInternal(i="",s=""){return this.http.get(`/ws/search/internal?k=${i}&dir=${s}`).pipe((0,le.T)(r=>this.resultsToBookmarks(r)))}getAnatomyCategory(i,s,r=[],a=!1,d="en"){return this.search(i,[s,...r],a,d)}getConditionModel(i){if(I.c.offline)return(0,Rt.of)(null);const s=this.toDatabaseContentId(i);return this.http.get(`/search/conditions?q=${s}`).pipe((0,vc.l)(r=>r.pipe((0,dr.c)(1e3),(0,tn.s)(3))),(0,le.T)(r=>this.resultsToBookmarks(r)),(0,le.T)(r=>r[0]))}getShowcase(i){return this.http.get(`/ws/product/app/settings/homepage-showcase?ol=${i}`).pipe((0,le.T)(s=>(s.forEach(r=>(r.bookmarks=this.resultsToBookmarks(r.bookmarks),r)),s)))}getZSpaceShowcase(){return this.getAnatomyCategory("",Ti.a.Zspace,[],!0).pipe((0,le.T)(i=>({title:"zSpace Models",description:" ",url:XE,bookmarks:i})))}createMockShowcase(i){return{title:" ",description:" ",url:"",bookmarks:[...i],loading:!0}}createMockShowcases(i,s){return[...Array(i).keys()].map(()=>this.createMockShowcase(s))}search(i="",s,r,a){const d=i.split(/[ ]+/).join("+"),f=YE.concat(s).filter(T=>""!==T&&null!=T).map(T=>`"${T}"`).join("+");return this.http.get(`/search/ai?k=${d}&t=${f}&zspace=${r}&il=${a}&ol=${a}&odns=true`).pipe((0,le.T)(T=>this.resultsToBookmarks(T)))}resultsToBookmarks(i){return i.forEach(s=>{s=Pe(s)}),(0,p.bj)(me,i)}getStoryCategory(i){if(!i.tags)return null;const s=Bp().map(r=>r.id.toLocaleLowerCase());return i.tags.find(r=>s.includes(r.toLocaleLowerCase()))}toAppContentId(i){return i.replace("Condition.content.","").replace(".json","").split(".").join("/")}toDatabaseContentId(i){return i.match("Condition.content")?i:`Condition.content.${i.replace(".json","").split("/").join(".")}.json`}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();function Pf(n,t,o){const i=t.map(s=>n[s]).filter(s=>!(0,m.isNil)(s));return o?i.sort().shift():i.sort().pop()}function Wp(n,t,o){if(0===t.length)return n;const i=new Intl.Collator("en-US",{sensitivity:"base"});return n.sort((s,r)=>{const a=Pf(s,t,o)||"",d=Pf(r,t,o)||"";return(o?1:-1)*i.compare(a.toString(),d.toString())})}function Af(n,t,o){return 0===n.sortBy.fields.length&&""===t.query&&t.type===Pn.Category&&"regional"===t.categoryId?[...o.filter(s=>!s.tags.includes("Guided Anatomy")),...o.filter(s=>s.tags.includes("Guided Anatomy"))]:[...o]}class KE{}let Vc=(()=>{var n;class t{constructor(i){this.http=i}generateFreshChapterImages(i,s,r=!1){const a=[];return i.forEach(d=>{const f=Vo.getChapterThumbnail(d,s);(f.legacy||r)&&a.push(Vo.makeFreshThumbnail(f.storyId,f.chapterId,f.urls.large))}),a.length?(0,si.p)(a):(0,Rt.of)([])}saveChapterThumbnails(i,s,r){return i.reduce((d,f)=>{const ee=s.get(r[f.id]),re=(0,m.get)(ee,"snapshot");return re&&d.push(this.saveNewChapterImage(f.id,re)),d},[])}saveNewChapterImage(i,s){return new y.c(r=>{Zg(s).pipe((0,Zi.n)(a=>this.saveImageBlob(a)),(0,le.T)(a=>({chapterId:i,...a}))).subscribe(a=>{r.next(a),r.complete()},()=>{r.next(null),r.complete()})})}getIndexThumbnail(i,s="large"){return`${typeof localBaseDirectory>"u"?"":localBaseDirectory}thumbs/modules/${i}/${s}/index.jpg`}saveImageBlob(i){const r=new File([i],"image.jpg",{type:"image/jpeg"}),a=new FormData;return a.append("file",r),this.http.post("/ws/media/images/upload",a)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Ps,JE=_(11113),Xp=_(40215),Tt=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ce=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function Nf(n,t,o,i,s,r){return r?(0,v_.H)(o.getDatabaseItem(zt.AJ.PreviewBookmark)):s===ye.c.Bookmark?n.getBookmarkModel(i):t.getConditionModel(i)}const Rf={loading:!0,exporting:!1,copying:!1,saving:!1,bookmarks:[],selectedBookmark:null,sort:Lc,checkedBookmarks:[],selectedCategory:null,bookmarkJobs:[]};let _t=((Ps=class{static getBookmarks(t){const{bookmarks:o,sort:i}=t,{ascending:s,fields:r}=i;return Wp(o,r,s)}static getCheckedBookmarks(t){return t.checkedBookmarks}static getSelectedBookmark(t){return t.selectedBookmark}static getSelectedBookmarkViewMode(t){return t.selectedBookmark.viewMode||Ne.All}static getLoading(t){return t.loading}static getExporting(t){return t.exporting}static getSaving(t){return t.saving}static getCopying(t){return t.copying}static getSort(t){return t.sort}static getSelectedCategory(t){return t.selectedCategory}static getBookmarkJobs(t){return t.bookmarkJobs}static getActiveBookmarkJob(t){const o=["aborted","complete","error"];return t.bookmarkJobs.find(i=>!o.includes(i.job_status))}loadBookmarks(t,o){t.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),(0,si.p)(this.bookmarksService.getPrivateBookmarks(o.query,o.lang),this.bookmarksService.getPrivateConditions(o.query,o.lang)).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(([i,s])=>{t.dispatch(new ma([...i,...s]))})}loadOrganizationBookmarks(t,{organizationId:o,query:i,lang:s}){t.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.bookmarksService.getOrganizationContent(o,i,s).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(r=>{t.dispatch(new ma(r))})}loadCollectionBookmarks(t,o){t.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.organizationsService.getCollectionContent(o.organizationId,o.collectionId,o.query,o.lang).pipe((0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(i=>{t.dispatch(new ma(i))})}loadSuccess({patchState:t},o){t({bookmarks:o.result})}selectBookmark(t,o){const{id:i,type:s,preview:r}=o;Nf(this.bookmarksService,this.exploreService,this.storageService,i,s,r).subscribe(d=>{t.dispatch(new N_(d))})}selectBookmarkSuccess(t,o){let{bookmark:i}=o;i&&(i=Pe(i)),t.patchState({selectedBookmark:i})}saveBookmark(t,o){var i=this;return(0,Ct.A)(function*(){let s;t.patchState({saving:!0});const r=o.bookmarkEntry,a=r.id?"update":"save",d=i.store.selectSnapshot(fe.N.getStoryChapters),f=!1===o.inplace,T=(0,y_.S)(d,f);f&&(yield(0,Xp._)(i.store.dispatch(new pn.u.UpdateTweenParticleLookupChapters(T)))),o.includeIndex&&(s=i.bookmarksService.createBookmarkStory(r.title,T),"save"===a&&i.storyService.addContentRecord(i.store.selectSnapshot(rt.getStoryId),s.story),r.index=s.story);let L=(0,Rt.of)([]);if(o.includeIndex){const ee=i.store.selectSnapshot(to.K.getRegisteredThumbnails),re=i.imagesService.saveChapterThumbnails(r.index.chapters,ee,(0,m.invert)(T));re.length&&(L=(0,si.p)(re))}L.pipe((0,Cn.Z)(ee=>{const re=i.store.selectSnapshot(to.K.getRegisteredThumbnails);return ee.forEach(ve=>{const Oe=new dc.R;Oe.storyId=r.id,Oe.chapterId=ve.chapterId,Oe.urls={small:ve.uris.small,large:ve.uris.large},re.set(ve.chapterId,Oe);const Ee=r.index.chapters.findIndex(Re=>Re.id===ve.chapterId);Ee>=0&&(r.index.chapters[Ee].thumbnails={...ve.uris})}),t.dispatch(new no.W2(re)),i.bookmarksService.saveBookmark(r)}),(0,bt.j)(()=>t.patchState({saving:!1}))).subscribe({next:ee=>{const re=Array.isArray(r.addCollections)&&r.addCollections.length>0,ve=r.removeCollections&&Array.from(r.removeCollections.keys()).length>0;re||ve?(i.actions.pipe((0,l.xi)(jh,Vh),(0,tn.s)(1)).subscribe(()=>{t.dispatch(new yc(ee,r.index,a))}),t.dispatch(new L_(ee,r.addCollections,r.removeCollections))):t.dispatch(new yc(ee,r.index,a))},error:ee=>{t.dispatch(new D_(r,ee))}}),i.vendorAnalyticsService.track("Bookmark Save - Start")})()}saveBookmarkSuccess(t,o){const i=o.bookmark,s=t.getState().bookmarks,r=s.findIndex(a=>a.id===i.id);-1!==r&&(s[r]=i,t.patchState({bookmarks:[...s]})),"save"===o.method&&t.patchState({selectedBookmark:o.bookmark}),this.vendorAnalyticsService.track("Bookmark Save - Success",{id:i.id,chapters:o.story.chapters.length,tour:i.tour,animated:i.animated,quiz:i.quiz,edit:this.router.url.startsWith("/edit")})}saveBookmarkFail(t,o){const i=o.bookmarkEntry?.id||"",s=i.includes("/")?ye.c.Module:ye.c.Bookmark,r=Qo(o.error),a=o.error?.status;this.vendorAnalyticsService.track("Bookmark Save - Failure",{contentId:i,contentType:s,error:r,statusCode:a,application:I.c.application})}deleteBookmark(t,o){const i=o.bookmarkId;this.bookmarksService.deleteBookmark(i).subscribe(()=>{t.dispatch(new R_(i))},s=>{t.dispatch(new X0(i,s))})}deleteBookmarkSuccess(t,o){const i=t.getState().bookmarks.filter(s=>s.id!==o.bookmarkId);t.patchState({bookmarks:[...i]}),this.snackbar.open("Successfully deleted 3D model")}bulkDeleteBookmark(t,{bookmarkIds:o}){this.vendorAnalyticsService.track("Bulk Delete - Start"),this.bookmarksService.bulkDeleteBookmarks(o).subscribe({next:i=>{t.dispatch(new s1(o,i.job_id)),t.dispatch(new fa)},error:i=>{this.vendorAnalyticsService.track("Bulk Delete - Error"),t.dispatch(new r1(o,i))}})}bulkDeleteBookmarkComplete(t,o){this.vendorAnalyticsService.track("Bulk Delete - Complete")}bulkDeleteBookmarksError(t,o){this.vendorAnalyticsService.track("Bulk Delete - Error")}sortBookmarks(t,o){const i=t.getState().bookmarks;t.patchState({sort:o.sort,bookmarks:[...i]})}clearBookmarks(t,o){t.patchState({bookmarks:[],checkedBookmarks:[]})}resetBookmarks(t,o){t.setState(Rf)}checkBookmark(t,o){let i=t.getState().checkedBookmarks;const s=i.some(r=>r===o.id);o.checked&&!s?i=[...i,o.id]:o.checked||(i=i.filter(r=>r!==o.id)),t.patchState({checkedBookmarks:i})}setCheckedBookmarks(t,o){t.patchState({checkedBookmarks:o.ids})}exportBookmarks(t,o){const{bookmarks:i,organizationId:s,collections:r,widgetURL:a,widgetOptions:d,offlineEnabled:f,productAccountId:T}=o,L=d||new Np;t.patchState({exporting:!0}),this.publishService.exportBookmarks(i,s,r,a,L,null,o.userLanguage,o.userApp,f,T).pipe((0,bt.j)(()=>{t.patchState({exporting:!1})})).subscribe(ee=>{t.dispatch(ee?new H0(i):new Q0(i))})}postUpdateBookmarkCollections(t,o){const i=new Map,s=new Map;o.forEach(({bookmark:d,addCollections:f,removeCollections:T})=>{f.forEach(L=>{const ee=L.collection_id,re={content_type:d.type,content_id:d.id},ve=i.get(ee)??[];ve.push(re),i.set(ee,ve)}),T.forEach((L,ee)=>{const re=ee.collection_id,ve=s.get(re)??[];ve.push(L),s.set(re,ve)})});const r=Array.from(i).map(([d,f])=>({collection_id:d,content_list:f})),a=Array.from(s).map(([d,f])=>({collection_id:d,collection_content_id_list:f}));return this.organizationsService.updateCollectionContent(t,r,a)}bulkUpdateBookmarkCollections(t,{groupId:o,updates:i}){this.vendorAnalyticsService.track("Bulk Move/Remove - Start"),this.postUpdateBookmarkCollections(o,i).subscribe({next:()=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Success"),t.dispatch(new a1(i))},error:s=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Error"),t.dispatch(new l1(i,s))}})}updateBookmarkCollections(t,o){const i=o.addCollections,s=i.map(f=>({collection_id:f.collection_id,content_list:[{content_type:o.bookmark.type,content_id:o.bookmark.id}]})),r=Array.from(o.removeCollections.keys()),a=r.map(f=>({collection_id:f.collection_id,collection_content_id_list:[o.removeCollections.get(f)]})),d=i.concat(r)[0].group_id;this.organizationsService.updateCollectionContent(d,s,a).subscribe(()=>{i.length>0&&t.dispatch(new Y0(o.bookmark,i)),r.length>0&&t.dispatch(new U_(o.bookmark,r)),t.dispatch(new jh(o.bookmark,i,r))},()=>{i.length>0&&t.dispatch(new K0(o.bookmark,i)),r.length>0&&t.dispatch(new J0(o.bookmark,r)),t.dispatch(new Vh(o.bookmark,i,r))})}removeBookmarkCollectionSuccess(t,o){const{bookmarks:i,selectedCategory:s}=t.getState();if("collection"===s){const r=o.bookmark.id,a=i.filter(d=>d.id!==r);t.patchState({bookmarks:[...a]})}}copyBookmark(t,o){this.vendorAnalyticsService.track("Bookmark Copy - Start");const{groupAccess:i,collections:s}=o;let r,a,d,f,T;t.patchState({copying:!0,saving:!0});const L=Nf(this.bookmarksService,this.exploreService,this.storageService,o.id,o.type,!1),ee=this.storyService.getStory(o.id,o.type,o.lang);(0,si.p)([L,ee]).pipe((0,le.T)(([re,ve])=>{a=(0,m.cloneDeep)(ve),d=(0,m.cloneDeep)(ve),this.storyService.addContentRecord(o.id,d),f=(0,y_.S)(a.chapters,!0),d.chapters.forEach(Oe=>{Oe.id=f[Oe.id]}),o.type?delete d.sourceInfo:d.sourceInfo=qg(d.sourceInfo),d.tweenParticleLookup&&(d.tweenParticleLookup=JE.e.updateChapterIds(d.tweenParticleLookup,f)),T=re.viewMode}),(0,Zi.n)(()=>this.imagesService.generateFreshChapterImages(a.chapters,o.id)),(0,Zi.n)(re=>{const ve=re.map(Oe=>this.imagesService.saveNewChapterImage(Oe.chapterId,Oe.snapshot));return ve.length?(0,si.p)(ve):(0,Rt.of)([])}),(0,le.T)(re=>{re.forEach(ve=>{ve.chapterId=f[ve.chapterId]}),d.chapters.forEach(ve=>{const Oe=re.find(Ee=>Ee.chapterId===ve.id);Oe&&(ve.thumbnails={...Oe.uris})})}),(0,Zi.n)(()=>{const re=new KE;return re.title=o.title,re.isOwner=!0,re.index=d,re.viewMode=T,re.is_content_copy=!0,i&&(re.add_group_access=[i]),this.bookmarksService.saveBookmark(re)}),(0,Is.M)(re=>{r=re}),(0,Zi.n)(()=>{if(i&&s&&s.length>0){const re=s[0].group_id,ve=s.map(Oe=>({collection_id:Oe.collection_id,content_list:[{content_type:r.type,content_id:r.id}]}));return this.organizationsService.updateCollectionContent(re,ve,[])}return(0,Rt.of)(!0)}),(0,bt.j)(()=>{t.patchState({copying:!1,saving:!1})})).subscribe(()=>{this.vendorAnalyticsService.track("Bookmark Copy - Success",{id:r.id,chapters:d.chapters.length,tour:r.tour,animated:r.animated,quiz:r.quiz,edit:this.router.url.startsWith("/edit")}),t.dispatch(new q0(r))},re=>{this.vendorAnalyticsService.track("Bookmark Copy - Failure"),t.dispatch(new Z0(o.id,re))})}copyBookmarks(t,{copyBookmarkModels:o}){this.vendorAnalyticsService.track("Bulk Add - Start"),t.patchState({copying:!0}),this.bookmarksService.bulkCopyBookmarks(o).pipe((0,bt.j)(()=>{t.patchState({copying:!1})})).subscribe({next:i=>{t.dispatch(new i1(o,i.job_id)),t.dispatch(new fa)},error:i=>{this.vendorAnalyticsService.track("Bulk Add - Error"),t.dispatch(new o1(o,i))}})}bulkCopyBookmarksComplete(t,o){this.vendorAnalyticsService.track("Bulk Add - Success")}BulkCopyBookmarksError(t,o){this.vendorAnalyticsService.track("Bulk Add - Error")}getBookmarkJobs(t,o){this.bookmarksService.getBookmarkJobs().subscribe({next:i=>{t.dispatch(new V_(i))},error:i=>{t.dispatch(new e1(i))}})}setBookmarkJobs(t,{bookmarkJobs:o}){t.patchState({bookmarkJobs:o})}getBookmarkJobsSuccess(t,{bookmarkJobs:o}){t.dispatch(new j_(o))}cancelBookmarkJob(t,{jobId:o,jobType:i}){this.vendorAnalyticsService.track(("bookmark_copy"===i?"Bulk Add":"Bulk Delete")+" - Stopped"),this.bookmarksService.cancelBookmarkJob(o).subscribe({next:()=>{t.dispatch(new t1(o,i)),t.dispatch(new fa)},error:s=>{t.dispatch(new n1(o,i,s))}})}setBookmarkText(t,o){const i=t.getState().selectedBookmark;t.patchState({selectedBookmark:{...i,title:o.title}})}setBookmarkViewMode(t,o){const i=t.getState().selectedBookmark;t.patchState({selectedBookmark:{...i,viewMode:o.viewMode}})}setSelectedCategory(t,{category:o}){t.patchState({selectedCategory:o||null})}cancelSaveBookmark(t,o){t.patchState({saving:!1})}cancelCopyBookmark(t,o){t.patchState({copying:!1})}constructor(t,o,i,s,r,a,d,f,T,L,ee,re){this.store=t,this.actions=o,this.bookmarksService=i,this.imagesService=s,this.storyService=r,this.exploreService=a,this.publishService=d,this.organizationsService=f,this.snackbar=T,this.vendorAnalyticsService=L,this.storageService=ee,this.router=re}}).\u0275fac=function(t){return new(t||Ps)(e.KVO(l.il),e.KVO(l.En),e.KVO(Pa),e.KVO(Vc),e.KVO(da.J),e.KVO(jc),e.KVO(Sr),e.KVO(he),e.KVO(_o.UG),e.KVO(qe),e.KVO(zt.n$),e.KVO(ne.Ix))},Ps.\u0275prov=e.jDH({token:Ps,factory:Ps.\u0275fac}),Ps);Tt([(0,l.rc)(Mh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Mh]),Ce("design:returntype",void 0)],_t.prototype,"loadBookmarks",null),Tt([(0,l.rc)(Ih),Ce("design:type",Function),Ce("design:paramtypes",[Object,Ih]),Ce("design:returntype",void 0)],_t.prototype,"loadOrganizationBookmarks",null),Tt([(0,l.rc)(wh),Ce("design:type",Function),Ce("design:paramtypes",[Object,wh]),Ce("design:returntype",void 0)],_t.prototype,"loadCollectionBookmarks",null),Tt([(0,l.rc)(ma),Ce("design:type",Function),Ce("design:paramtypes",[Object,ma]),Ce("design:returntype",void 0)],_t.prototype,"loadSuccess",null),Tt([(0,l.rc)(A_),Ce("design:type",Function),Ce("design:paramtypes",[Object,A_]),Ce("design:returntype",void 0)],_t.prototype,"selectBookmark",null),Tt([(0,l.rc)(N_),Ce("design:type",Function),Ce("design:paramtypes",[Object,N_]),Ce("design:returntype",void 0)],_t.prototype,"selectBookmarkSuccess",null),Tt([(0,l.rc)(Ah),Ce("design:type",Function),Ce("design:paramtypes",[Object,Ah]),Ce("design:returntype",Promise)],_t.prototype,"saveBookmark",null),Tt([(0,l.rc)(yc),Ce("design:type",Function),Ce("design:paramtypes",[Object,yc]),Ce("design:returntype",void 0)],_t.prototype,"saveBookmarkSuccess",null),Tt([(0,l.rc)(D_),Ce("design:type",Function),Ce("design:paramtypes",[Object,D_]),Ce("design:returntype",void 0)],_t.prototype,"saveBookmarkFail",null),Tt([(0,l.rc)(Ph),Ce("design:type",Function),Ce("design:paramtypes",[Object,Ph]),Ce("design:returntype",void 0)],_t.prototype,"deleteBookmark",null),Tt([(0,l.rc)(R_),Ce("design:type",Function),Ce("design:paramtypes",[Object,R_]),Ce("design:returntype",void 0)],_t.prototype,"deleteBookmarkSuccess",null),Tt([(0,l.rc)(Qh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Qh]),Ce("design:returntype",void 0)],_t.prototype,"bulkDeleteBookmark",null),Tt([(0,l.rc)(Yh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Yh]),Ce("design:returntype",void 0)],_t.prototype,"bulkDeleteBookmarkComplete",null),Tt([(0,l.rc)(Kh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Kh]),Ce("design:returntype",void 0)],_t.prototype,"bulkDeleteBookmarksError",null),Tt([(0,l.rc)(Dh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Dh]),Ce("design:returntype",void 0)],_t.prototype,"sortBookmarks",null),Tt([(0,l.rc)(Rh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Rh]),Ce("design:returntype",void 0)],_t.prototype,"clearBookmarks",null),Tt([(0,l.rc)(k_),Ce("design:type",Function),Ce("design:paramtypes",[Object,k_]),Ce("design:returntype",void 0)],_t.prototype,"resetBookmarks",null),Tt([(0,l.rc)(kh),Ce("design:type",Function),Ce("design:paramtypes",[Object,kh]),Ce("design:returntype",void 0)],_t.prototype,"checkBookmark",null),Tt([(0,l.rc)(Lh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Lh]),Ce("design:returntype",void 0)],_t.prototype,"setCheckedBookmarks",null),Tt([(0,l.rc)(Uh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Uh]),Ce("design:returntype",void 0)],_t.prototype,"exportBookmarks",null),Tt([(0,l.rc)(Jh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Jh]),Ce("design:returntype",void 0)],_t.prototype,"bulkUpdateBookmarkCollections",null),Tt([(0,l.rc)(L_),Ce("design:type",Function),Ce("design:paramtypes",[Object,L_]),Ce("design:returntype",void 0)],_t.prototype,"updateBookmarkCollections",null),Tt([(0,l.rc)(U_),Ce("design:type",Function),Ce("design:paramtypes",[Object,U_]),Ce("design:returntype",void 0)],_t.prototype,"removeBookmarkCollectionSuccess",null),Tt([(0,l.rc)(xh),Ce("design:type",Function),Ce("design:paramtypes",[Object,xh]),Ce("design:returntype",void 0)],_t.prototype,"copyBookmark",null),Tt([(0,l.rc)(Wh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Wh]),Ce("design:returntype",void 0)],_t.prototype,"copyBookmarks",null),Tt([(0,l.rc)(Hh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Hh]),Ce("design:returntype",void 0)],_t.prototype,"bulkCopyBookmarksComplete",null),Tt([(0,l.rc)(Xh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Xh]),Ce("design:returntype",void 0)],_t.prototype,"BulkCopyBookmarksError",null),Tt([(0,l.rc)(fa),Ce("design:type",Function),Ce("design:paramtypes",[Object,fa]),Ce("design:returntype",void 0)],_t.prototype,"getBookmarkJobs",null),Tt([(0,l.rc)(j_),Ce("design:type",Function),Ce("design:paramtypes",[Object,j_]),Ce("design:returntype",void 0)],_t.prototype,"setBookmarkJobs",null),Tt([(0,l.rc)(V_),Ce("design:type",Function),Ce("design:paramtypes",[Object,V_]),Ce("design:returntype",void 0)],_t.prototype,"getBookmarkJobsSuccess",null),Tt([(0,l.rc)(zh),Ce("design:type",Function),Ce("design:paramtypes",[Object,zh]),Ce("design:returntype",void 0)],_t.prototype,"cancelBookmarkJob",null),Tt([(0,l.rc)(Gh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Gh]),Ce("design:returntype",void 0)],_t.prototype,"setBookmarkText",null),Tt([(0,l.rc)($h),Ce("design:type",Function),Ce("design:paramtypes",[Object,$h]),Ce("design:returntype",void 0)],_t.prototype,"setBookmarkViewMode",null),Tt([(0,l.rc)(Bh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Bh]),Ce("design:returntype",void 0)],_t.prototype,"setSelectedCategory",null),Tt([(0,l.rc)(Nh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Nh]),Ce("design:returntype",void 0)],_t.prototype,"cancelSaveBookmark",null),Tt([(0,l.rc)(Fh),Ce("design:type",Function),Ce("design:paramtypes",[Object,Fh]),Ce("design:returntype",void 0)],_t.prototype,"cancelCopyBookmark",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getBookmarks",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getCheckedBookmarks",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getSelectedBookmark",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getSelectedBookmarkViewMode",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getLoading",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getExporting",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getSaving",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getCopying",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getSort",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getSelectedCategory",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getBookmarkJobs",null),Tt([(0,l.MD)(),Ce("design:type",Function),Ce("design:paramtypes",[Vi]),Ce("design:returntype",void 0)],_t,"getActiveBookmarkJob",null),_t=Tt([(0,l.Uw)({name:"bookmarks",defaults:Rf}),Ce("design:paramtypes",[l.il,l.En,Pa,Vc,da.J,jc,Sr,he,_o.UG,qe,zt.n$,ne.Ix])],_t);class Er{}var As,Df=function(n){return n.Light="theme-light",n.Dark="theme-dark",n}(Df||{}),Ko=function(n){return n[n.Application=0]="Application",n[n.Search=1]="Search",n[n.View=2]="View",n[n.Hide=3]="Hide",n[n.Share=4]="Share",n[n.Logo=5]="Logo",n}(Ko||{}),kf=function(n){return n[n.Mobile=0]="Mobile",n[n.None=1]="None",n}(kf||{}),mi=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Vt=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const Lf={theme:Df.Light,sidenav:{enabled:!0,open:!1},siteHeader:Ko.Application,siteFooter:kf.None,siteHeaderHeight:56,siteFooterHeight:56};let gn=((As=class{static getTheme(t){return t.theme}static getSidenav(t){return t.sidenav}static getSiteHeader(t){return t.siteHeader}static getSiteHeaderHeight(t){return t.siteHeaderHeight}static getSiteFooter(t){return t.siteFooter}static getSiteFooterHeight(t){return t.siteFooterHeight}setTheme({patchState:t},{theme:o}){t({theme:o})}setHeader(t,o){t.patchState({siteHeader:o.siteHeaderType})}setFooter(t,o){t.patchState({siteFooter:o.siteFooterType})}setHeaderHeight(t,o){t.patchState({siteHeaderHeight:o.height})}setFooterHeight(t,o){t.patchState({siteFooterHeight:o.height})}setSidenav(t,o){t.patchState({sidenav:{...o.sidenav}})}toggleSidenav(t,o){const i=t.getState().sidenav;t.patchState({sidenav:{...i,open:o.open}})}resetLayout(t,o){t.setState(Lf)}}).\u0275fac=function(t){return new(t||As)},As.\u0275prov=e.jDH({token:As,factory:As.\u0275fac}),As);function Hp(n,t,o=!0){return.01*(window.innerHeight-(o&&n!==Ko.Hide?t:0))}function xc(n){return n===Ko.Logo||I.c.application!==Wn.c.Viewer}mi([(0,l.rc)(wn.SetTheme),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetTheme]),Vt("design:returntype",void 0)],gn.prototype,"setTheme",null),mi([(0,l.rc)(wn.SetHeader),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetHeader]),Vt("design:returntype",void 0)],gn.prototype,"setHeader",null),mi([(0,l.rc)(wn.SetFooter),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetFooter]),Vt("design:returntype",void 0)],gn.prototype,"setFooter",null),mi([(0,l.rc)(wn.SetHeaderHeight),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetHeaderHeight]),Vt("design:returntype",void 0)],gn.prototype,"setHeaderHeight",null),mi([(0,l.rc)(wn.SetFooterHeight),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetFooterHeight]),Vt("design:returntype",void 0)],gn.prototype,"setFooterHeight",null),mi([(0,l.rc)(wn.SetSidenav),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.SetSidenav]),Vt("design:returntype",void 0)],gn.prototype,"setSidenav",null),mi([(0,l.rc)(wn.ToggleSidenav),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.ToggleSidenav]),Vt("design:returntype",void 0)],gn.prototype,"toggleSidenav",null),mi([(0,l.rc)(wn.ResetLayout),Vt("design:type",Function),Vt("design:paramtypes",[Object,wn.ResetLayout]),Vt("design:returntype",void 0)],gn.prototype,"resetLayout",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getTheme",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getSidenav",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getSiteHeader",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getSiteHeaderHeight",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getSiteFooter",null),mi([(0,l.MD)(),Vt("design:type",Function),Vt("design:paramtypes",[Er]),Vt("design:returntype",void 0)],gn,"getSiteFooterHeight",null),gn=mi([(0,l.Uw)({name:"layout",defaults:Lf})],gn);var Mo=_(73987);let Fc=(()=>{var n;class t{constructor(i,s,r,a){this.store=i,this.chapterService=s,this.animationService=r,this.mediaService=a,this.ui=null,this.horizontalBreakpoint=null}getBase(){return{ui:this.store.selectSnapshot(Be.getUI),layout:this.store.selectSnapshot(_e.getLayout),horizontalBreakpoint:this.store.selectSnapshot(In.getHorizontalBreakpoint),canvasHeightBreakpoint:this.store.selectSnapshot(Xe.S.getCanvasHeightBreakpoint),quizActive:this.store.selectSnapshot(Ue.j.getQuizModeActive),hideUI:this.isUIHidden()}}isUIHidden(){const i=this.store.selectSnapshot(_e.getOpenWindow),s=this.store.selectSnapshot(fe.N.getSelectedChapterIndex),r=this.store.selectSnapshot(Be.getUI),a=i===fn.Loader&&s<=0&&r.loader.template===Oo.Circle,d=this.store.selectSnapshot(Ei.getStoryLoadProgress);return a||0===d||i===fn.OnDemand||i===fn.Interact||i===fn.Tutorial||i===fn.Whiteboard}isDrawerVisible(){const{layout:i,quizActive:s,hideUI:r}=this.getBase();if(r||this.getViewLayout(i)!==Qn.Drawer)return!1;if(s)return!0;const a=this.store.selectSnapshot(_e.getContentMode);return!(a===Ft.ChapterInfo&&"full"!==this.getVisibleContent(Ft.ChapterInfo)||a===Ft.Quiz&&"full"!==this.getVisibleContent(Ft.Quiz)||a===Ft.LabelInfo&&"none"===this.getVisibleContent(Ft.LabelInfo))&&this.isUIVisible(G.Drawer)}isDrawerToggleVisible(){const{ui:i,layout:s,quizActive:r}=this.getBase(),a=this.getVisibleContent(Ft.ChapterInfo);return this.getViewLayout(s)===Qn.Drawer&&"full"===a&&!1!==i.drawer.enable&&!r&&this.isUIVisible(G.DrawerToggle)}isColumnVisible(){const{layout:i,ui:s}=this.getBase();if(s.column.status===at.Collapse||this.getViewLayout(i)!==Qn.Column)return!1;const r=this.store.selectSnapshot(_e.getContentMode);return!(r===Ft.ChapterInfo&&"full"!==this.getVisibleContent(Ft.ChapterInfo)||r===Ft.Quiz&&"full"!==this.getVisibleContent(Ft.Quiz))&&this.isUIVisible(G.Column)}isColumnToggleVisible(){const{hideUI:i,layout:s,ui:r}=this.getBase();if(i||this.getViewLayout(s)!==Qn.Column)return!1;const a=this.store.selectSnapshot(_e.getContentMode);return!(a===Ft.ChapterInfo&&"full"!==this.getVisibleContent(Ft.ChapterInfo)||a===Ft.Quiz&&"full"!==this.getVisibleContent(Ft.Quiz))&&r.column.enable}isTitleOnlyVisible(){const{hideUI:i,ui:s,layout:r}=this.getBase();if(i)return!1;const a=this.getViewLayout(r),d=this.getVisibleContent(Ft.ChapterInfo),f=this.isPaginationVisible();let T=!0;return!(this.store.selectSnapshot(Ue.j.getQuizModeActive)||a===Qn.Column&&(!1===s.column.enable&&!1===f||!1===s.column.enable&&"titleOnly"===d&&!1===f||s.column.enable&&"full"===d&&s.column.status!==at.Collapse))&&(a===Qn.Drawer&&(T=s.drawer.enable||f),T)}isToggleLabelsVisible(){return 0!==this.store.selectSnapshot(Ze.getChapterLabels).length&&this.isUIVisible(G.ToggleLabels)}isToolsVisible(){return this.isUIVisible(G.Tools)}isToolbarVisible(){return this.isUIVisible(G.Toolbar)}isFullScreenVisible(){return!this.store.selectSnapshot(_e.getIsMobileWeb)&&this.isUIVisible(G.Fullscreen)}isLogoVisible(){const{ui:i}=this.getBase();if(this.store.selectSnapshot(_e.getOpenWindow)===fn.OnDemand)return!1;const s=this.store.selectSnapshot(_e.getIsMobileWeb),r=this.store.selectSnapshot(Be.getUIEntry(G.Media));return!(this.isMediaVisible()&&"show"===r.status&&!s)&&i.logo.enable}isCameraVisible(){return this.isUIVisible(G.Camera)}isPaginationVisible(){return!(this.store.selectSnapshot(fe.N.getChapterCount)<=1||this.store.selectSnapshot(Ue.j.getQuizModeActive))&&this.isUIVisible(G.Pagination)}isMediaVisible(){const{hideUI:i,ui:s}=this.getBase(),r=s.media.enable,a=this.store.selectSnapshot(fe.N.getSelectedChapter);return!(this.store.selectSnapshot(Xe.S.getCanvasHeightBreakpoint)===Mo.h.Tiny||i||!r||!a?.id||!this.animationService.isChapterAnimated(a))&&this.isUIVisible(G.Media)}isPlaythroughVisible(){const i=this.store.selectSnapshot(fe.N.getChapterCount)>1;return!(this.store.selectSnapshot(_t.getSelectedBookmarkViewMode)===Ne.Quiz||!i)&&this.isUIVisible(G.Playthrough)}isToolbarOverflowVisible(){const{canvasHeightBreakpoint:i}=this.getBase(),s=this.isUIVisible(G.Help),r=this.isToggleLabelsVisible(),a=this.store.selectSnapshot(Ue.j.hasQuiz),d=this.store.selectSnapshot(Ue.j.getQuizEnabled),f=this.isUIVisible(G.QuizPrompt),T=this.store.selectSnapshot(Ue.j.getQuizModeLocked),L=this.store.selectSnapshot(_t.getSelectedBookmarkViewMode),ee=this.store.selectSnapshot(_e.getIsMobileWeb);if(i>Mo.h.Tiny&&(s||r||a&&f&&d&&!1===T&&L!==Ne.Content&&ee))return!0;const ve=this.isUIVisible(G.Tools),Oe=this.isUIVisible(G.VisibilityLayers),Ee=this.isUIVisible(G.Search),Re=this.isUIVisible(G.Whiteboard);return!!(i<=Mo.h.Tiny&&(ve||Oe||Ee||Re))||this.isUIVisible(G.ToolbarOverflow)}isNodeInfoColumnVisible(){const{hideUI:i,ui:s,horizontalBreakpoint:r}=this.getBase();return!i&&(!!(r>=Vn.Large&&this.isUIVisible(G.NodeInfo))||(r<Vn.Large?!s.drawer.enable&&this.isUIVisible(G.NodeInfo):void 0))}isNodeInfoVisible(i){const{hideUI:s,horizontalBreakpoint:r}=this.getBase();return!s&&(r>=Vn.Large&&i===Qn.Column||r<Vn.Large&&i===Qn.Drawer)&&this.isUIVisible(G.NodeInfo)}isAudioVisible(){const{hideUI:i,ui:s}=this.getBase(),r=this.store.selectSnapshot(_e.getViewLanguage),a=this.store.selectSnapshot(fe.N.getSelectedChapter),d=this.store.selectSnapshot(_e.getForceAudio);return!(0,m.isNil)(a)&&this.mediaService.getChapterAudioPlaybackType(a,r,d)!==qn.None&&!i&&s[G.Audio].status!==at.Hide&&(s[G.Audio].enable||d)}isQuizPromptVisible(){const{hideUI:i}=this.getBase();return!i&&this.isUIVisible(G.QuizPrompt)}isSearchVisible(){return this.store.selectSnapshot(Xe.S.getCanvasHeightBreakpoint)!==Mo.h.Tiny&&this.isUIVisible(G.Search)}isUndoVisible(){const{hideUI:i,ui:s}=this.getBase();return!i&&s.undo.enable}isSkinLayersVisible(){const i=this.store.selectSnapshot(rt.getVariantSchema("skin"));return!(0,m.isEmpty)(i)&&this.store.selectSnapshot(Xe.S.getCanvasHeightBreakpoint)!==Mo.h.Tiny&&this.isUIVisible(G.SkinLayers)}isVisibilityLayersVisible(){const i=this.store.selectSnapshot(fe.N.getSelectedChapterSrcLayers),s=this.isSkinLayersVisible();return!(!this.chapterService.hasVisibilityLayers(i)&&!s||this.store.selectSnapshot(Xe.S.getCanvasHeightBreakpoint)===Mo.h.Tiny)&&(this.isUIVisible(G.VisibilityLayers)||this.isSkinLayersVisible())}isWhiteboardVisible(){return this.isUIVisible(G.Whiteboard)}isVisible(i){switch(i){case G.Audio:return this.isAudioVisible();case G.Camera:return this.isCameraVisible();case G.Column:return this.isColumnVisible();case G.ColumnToggle:return this.isColumnToggleVisible();case G.Drawer:return this.isDrawerVisible();case G.DrawerToggle:return this.isDrawerToggleVisible();case G.Fullscreen:return this.isFullScreenVisible();case G.Logo:return this.isLogoVisible();case G.Media:return this.isMediaVisible();case G.ToolbarOverflow:return this.isToolbarOverflowVisible();case G.QuizPrompt:return this.isQuizPromptVisible();case G.Pagination:return this.isPaginationVisible();case G.Playthrough:return this.isPlaythroughVisible();case G.Search:return this.isSearchVisible();case G.TitleOnly:return this.isTitleOnlyVisible();case G.ToggleLabels:return this.isToggleLabelsVisible();case G.Tools:return this.isToolsVisible();case G.Toolbar:return this.isToolbarVisible();case G.Undo:return this.isUndoVisible();case G.VisibilityLayers:return this.isVisibilityLayersVisible();case G.SkinLayers:return this.isSkinLayersVisible();case G.Whiteboard:return this.isWhiteboardVisible();default:return this.isUIVisible(i)}}isUIVisible(i){const{hideUI:s,ui:r}=this.getBase();return r[i]?!s&&r[i].enable&&r[i].status!==at.Hide:(console.warn("Attempting to check visibility of a non-existent element: ${element}"),!1)}isUIEnabled(i){const{ui:s}=this.getBase();return s[i].enable}getChapterVisibility(){const{ui:i}=this.getBase(),s=this.store.selectSnapshot(Ze.getChapterLabels),r=this.store.selectSnapshot(fe.N.getSelectedChapter),a=r?.displayName,d=null!=a&&(0,m.trim)(a).length>0,f=(0,m.get)(r,"contentBlocks",[]).length>0,T=i.labelList.enable&&s.length>0,L=r?.description,ee=null!=L&&(0,m.trim)(L).length>0,re=(0,m.get)(r,"legend",[]);return T||ee||i.legend.enable&&re.length>0||f?"full":d?"titleOnly":"none"}getQuizVisibility(){return this.store.selectSnapshot(Ue.j.getQuizModeActive)?"full":"none"}getLabelInfoVisibility(){const i=this.store.selectSnapshot(Ze.getSelectedLabel);if((0,m.isNil)(i))return"none";const s=i?.title,r=null!=s&&(0,m.trim)(s).length>0;return(0,m.trim)(i.description).length>0||i.contentBlocks?.length>0?"full":r?"titleOnly":"none"}getVisibleContent(i){switch(i){case Ft.ChapterInfo:return this.getChapterVisibility();case Ft.LabelInfo:return this.getLabelInfoVisibility();case Ft.Quiz:return this.getQuizVisibility()}}getViewLayout(i){const{innerHeight:s,innerWidth:r}=window,a=r/s>=1?"landscape":"portrait",{horizontalBreakpoint:d}=this.getBase(),f=this.store.selectSnapshot(gn.getSiteHeader),T=this.store.selectSnapshot(gn.getSiteHeaderHeight),ee=384+(xc(f)?T:0);switch(i){case gc.ColumnOnly:return Qn.Column;case gc.DrawerOnly:return Qn.Drawer;default:return"portrait"===a?Qn.Drawer:d>=Vn.Large||s<=ee&&r>=708?Qn.Column:Qn.Drawer}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(ih.j),e.KVO(zi.O),e.KVO(Ci))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Cr=_(13878),vn=_(43753);class Tr{}const sn=(n,t)=>(0,m.isNil)(n)?t:n;function Yt(...n){return!!n.some(t=>!0===t)||!n.some(t=>!1===t)&&void 0}function Qp(n,t,o){const i=Yp(o,Object.values(Hi));return(0,m.isNil)(i)?!1===n?Hi.None:null!=t?t?Hi.Full:Hi.Small:null:i}function Gc(n){return Yp(n,Object.values(Oo))}function $c(n,t){return!0===t?cr.Group:Yp(n,Object.values(cr))}function Yp(n,t){return t.includes(n)?n:null}function Uf(n){const t={all:void 0,anatomyLabels:n.anatomyLabels.enable,audio:n.audio.enable,cameraMode:n.camera.enable,center:n.camera.enable,contextActions:n.contextActions.enable,contextMenu:n.contextMenu.enable,fadeout:void 0,fullscreen:n.fullscreen.enable,help:n.help.enable,info:n.column.enable||n.drawer.enable,infoExpand:n.drawer.isExpandedInitially,labels:n.labels.enable,legend:n.legend.enable,loader:Gc(n.loader.template),nav:n.camera.enable,objectTree:n.search.enable,playPause:n.media.enable,"scrubber.chapters":n.media.enable,scrubber:n.media.enable,"tools-display":n.tools.enable,tools:n.tools.enable,"tour.chapters":n.pagination.enable,tour:n.pagination.enable,visibilityLayers:n.visibilityLayers.enable,visibilityLayersMode:n.visibilityLayers.layersMode,skinLayers:n.skinLayers.enable,whiteboard:n.whiteboard.enable,zoomIn:n.camera.enable,zoomOut:n.camera.enable,share:!1,dissect:!1,xray:!1,annotations:!1,crossSection:!1,isolate:!1};return(0,m.pickBy)(t,o=>!(0,m.isNil)(o))}function jf(n){const t=null!=n["ui-all"]?Vf(n["ui-all"]):new Tr;return Ns({[G.Layout]:n["ui-layout"],[G.Loader]:Gc(n["ui-loader"]),[G.NodeInfo]:n["ui-anatomy-descriptions"],[G.NodeAudio]:n["ui-anatomy-pronunciations"],[G.Tools]:n["ui-tools"],[G.Media]:Qp(null,Yt(n["ui-scrubber"],n["ui-scrubber.chapters"],n["ui-scrubber.tour"]),n["ui-media-controls"]),[G.Audio]:n["ui-audio"],[G.Fullscreen]:n["ui-fullscreen"],[G.Help]:n["ui-help"],[G.Camera]:n["ui-nav"],[G.Toolbar]:Yt(n["ui-toolbar"],n["ui-menu"]),[G.Pagination]:n["ui-tour"],[G.Search]:Yt(n["ui-search"],n["ui-object-tree"]),[G.Column]:Yt(n["ui-info"],n["ui-panel"]),[G.Drawer]:Yt(n["ui-info"],n["ui-panel"]),[G.Description]:Yt(n["ui-info"]),[G.TitleOnly]:Yt(n["ui-info"]),[G.Logo]:Yt(n["ui-bd"],n["ui-logo"]),logoIsHyperLink:Yt(n["ui-bd.link"],n["ui-logo.islink"]),[G.Labels]:n["ui-labels"],[G.LabelList]:n["ui-label-list"],all:n["ui-all"],drawerExpanded:n["ui-info-expand"],fadeout:n["ui-fadeout"],startingColumn:n["ui-starting-column"],startingTool:n["ui-starting-tool"],[G.AnatomyLabels]:Yt(n["ui-anatomy-labels"]),[G.Tutorial]:Yt(n["ui-tutorial"]),[G.Legend]:Yt(n["ui-legend"]),[G.Undo]:Yt(n["ui-undo"],n["ui-reset"]),[G.Whiteboard]:Yt(n["ui-whiteboard"]),[G.VisibilityLayers]:Yt(n["ui-visibility-layers"],n["ui-layers"]),[G.VisibilityLayersMode]:$c(n["ui-visibility-layers-mode"],n["ui-skin-layers"]),[G.SkinLayers]:Yt(n["ui-skin-layers"]),[G.ContextActions]:Yt(n["ui-context-actions"]),[G.ContextMenu]:Yt(n["ui-context-menu"]),[G.ToggleLabels]:void 0,[G.QuizPrompt]:n["ui-quiz"],[G.Playthrough]:Yt(n.playthrough,n.autoplay)},t)}function Vf(n){return{all:n,drawerExpanded:null,logoIsHyperLink:null,fadeout:null,startingColumn:null,[G.AnatomyLabels]:null,[G.Audio]:n,[G.Camera]:n,[G.Column]:n,[G.ContextActions]:n,[G.ContextMenu]:null,[G.Drawer]:n,[G.Fullscreen]:n,[G.Help]:n,[G.LabelList]:n,[G.Labels]:null,[G.Legend]:!0,[G.Loader]:n?O_:Oo.None,[G.Logo]:!0,[G.Media]:n?Hi.Full:Hi.None,[G.NodeAudio]:n,[G.NodeInfo]:n,[G.Pagination]:n,[G.QuizPrompt]:n,[G.Search]:n,[G.TitleOnly]:n,[G.ToggleLabels]:!0,[G.Toolbar]:n,[G.Tools]:n,[G.Tutorial]:null,[G.Undo]:n,[G.VisibilityLayers]:n,[G.VisibilityLayersMode]:null,[G.SkinLayers]:n,[G.Whiteboard]:n}}function Ns(n,t){return null==t?n:(0,m.uniq)([...Object.keys(n),...Object.keys(t)]).reduce((i,s)=>(i[s]=null==n[s]?t[s]:n[s],i),new Tr)}function xf(n,t){const o=JSON.parse(JSON.stringify(n)),i={...I_};return o.loader.enable=sn(t[G.Loader]!==Oo.None,i.loader.enable),null!=t[G.Loader]&&(o.loader.template=t[G.Loader]),o.anatomyLabels.enable=sn(t[G.AnatomyLabels],i.anatomyLabels.enable),o.audio.enable=sn(t[G.Audio],i.audio.enable),o.camera.enable=sn(t[G.Camera],i.camera.enable),o.column.enable=sn(t[G.Column],i.column.enable),o.contextActions.enable=sn(t[G.ContextActions],i.contextActions.enable),o.contextMenu.enable=sn(t[G.ContextMenu],i.contextMenu.enable),o.description.enable=sn(t[G.Description],i.description.enable),o.drawer.enable=sn(t[G.Drawer],i.drawer.enable),o.drawer.isExpandedInitially=sn(t[G.DrawerExpanded],i.drawer.isExpandedInitially),o.fullscreen.enable=sn(t[G.Fullscreen],i.fullscreen.enable),o.help.enable=sn(t[G.Help],i.help.enable),o.labelList.enable=sn(t[G.LabelList],i.labelList.enable),o.labels.enable=sn(t[G.Labels],i.labels.enable),o.logo.enable=sn(t[G.Logo],i.logo.enable),o.logo.isHyperLink=sn(t.logoIsHyperLink,i.logo.isHyperLink),o.media.enable=sn(t[G.Media]!==Hi.None,i.media.enable),o.media.template=t[G.Media],o.nodeAudio.enable=sn(t[G.NodeAudio],i.nodeAudio.enable),o.nodeInfo.enable=sn(t[G.NodeInfo],i.nodeInfo.enable),o.pagination.enable=sn(t[G.Pagination],i.pagination.enable),o.playthrough.enable=sn(t[G.Playthrough],i.playthrough.enable),o.quizPrompt.enable=sn(t[G.QuizPrompt],i.quizPrompt.enable),o.search.enable=sn(t[G.Search],i.search.enable),o.titleOnly.enable=sn(t[G.TitleOnly],i.titleOnly.enable),o.toggleLabels.enable=sn(t[G.ToggleLabels],i.toggleLabels.enable),o.toolbar.enable=sn(t[G.Toolbar],i.toolbar.enable),o.tools.enable=sn(t[G.Tools],i.tools.enable),o.tutorial.enable=sn(t[G.Tutorial],i.tutorial.enable),o.undo.enable=sn(t[G.Undo],i.undo.enable),o.visibilityLayers.enable=sn(t[G.VisibilityLayers],i.visibilityLayers.enable),o.visibilityLayers.layersMode=$c(t[G.VisibilityLayersMode]??i.visibilityLayers.layersMode,t[G.SkinLayers]),o.skinLayers.enable=sn(t[G.SkinLayers],i.skinLayers.enable),o.whiteboard.enable=sn(t[G.Whiteboard],i.whiteboard.enable),o}var Dt=_(34006),yt=_(26779),Ff=_(87424),Gf=_(57018);let aC=(()=>{var n;class t{transform(i){return i.split(" ").map(r=>`<kbd>${r}</kbd>`).join("")}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=e.EJ8({name:"kbd",type:n,pure:!0}),t})();function lC(n,t){if(1&n&&(e.j41(0,"label",10),e.EFF(1),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.JRh(o.pronunciation)}}function cC(n,t){if(1&n&&(e.j41(0,"span"),e.nrm(1,"kbd",8),e.nI1(2,"kbd"),e.DNE(3,lC,2,1,"label",9),e.k0s()),2&n){const o=t.$implicit;e.R7$(),e.Y8G("innerHTML",e.bMT(2,3,o.shortcut),e.npT),e.BMQ("aria-hidden",o.hasOwnProperty("pronunciation")),e.R7$(2),e.Y8G("ngIf",o.hasOwnProperty("pronunciation"))}}function dC(n,t){if(1&n&&(e.j41(0,"tr")(1,"th",6),e.EFF(2),e.k0s(),e.j41(3,"td",7),e.DNE(4,cC,4,5,"span",5),e.k0s()()),2&n){const o=t.$implicit;e.R7$(2),e.JRh(o.label),e.R7$(2),e.Y8G("ngForOf",o.keys)}}function _C(n,t){if(1&n&&(e.j41(0,"div",2)(1,"h2",3),e.EFF(2),e.k0s(),e.j41(3,"table",4),e.DNE(4,dC,5,2,"tr",5),e.k0s()()),2&n){const o=t.$implicit;e.R7$(2),e.JRh(o.label),e.R7$(2),e.Y8G("ngForOf",o.shortcuts)}}var Io=function(n){return n.Left="\u2190",n.Right="\u2192",n.Up="\u2191",n.Down="\u2193",n.Command="\u2318",n}(Io||{});let pC=(()=>{var n;class t{constructor(){this.shortcutGroups=[{label:$localize`Navigation`,shortcuts:[{keys:[{shortcut:",",pronunciation:"Comma."},{shortcut:"Pg-Up",pronunciation:"page-up"}],label:$localize`Previous chapter`},{keys:[{shortcut:".",pronunciation:"Period."},{shortcut:"Pg-Down",pronunciation:"Page-down."}],label:$localize`Next chapter`},{keys:[{shortcut:"/",pronunciation:"Forward slash."}],label:$localize`Open Search`},{keys:[{shortcut:"Ctrl + Enter"}],label:$localize`Enter Fullscreen`},{keys:[{shortcut:"Ctrl/Cmd + ,",pronunciation:"Control or command plus comma."}],label:$localize`Toggle Description`},{keys:[{shortcut:"Shift + /"}],label:$localize`Open Help`}]},{label:$localize`Tools`,shortcuts:[{keys:[{shortcut:"1"}],label:$localize`Use "Select" tool`},{keys:[{shortcut:"2"}],label:$localize`Use "Hide" tool`},{keys:[{shortcut:"3"}],label:$localize`Use "Fade" tool`},{keys:[{shortcut:"del",pronunciation:"Delete."},{shortcut:"backspace"}],label:$localize`Hide selected structure`},{keys:[{shortcut:"Shift + R"}],label:$localize`Reset chapter`},{keys:[{shortcut:"P"}],label:$localize`Toggle between pan and rotate mode`},{keys:[{shortcut:"Ctrl/Cmd + Z",pronunciation:"Control or command plus z."}],label:$localize`Undo`},{keys:[{shortcut:"Ctrl/Cmd + Shift + Z",pronunciation:"Control or command plus shift pluz z."},{shortcut:"Ctrl/Cmd + Y",pronunciation:"Control or command plus y."}],label:$localize`Redo`}]},{label:$localize`Pan`,shortcuts:[{keys:[{shortcut:"W"}],label:$localize`Pan up`},{keys:[{shortcut:"S"}],label:$localize`Pan down`},{keys:[{shortcut:"A"}],label:$localize`Pan left`},{keys:[{shortcut:"D"}],label:$localize`Pan right`},{keys:[{shortcut:"Shift + W"}],label:$localize`Slow pan up`},{keys:[{shortcut:"Shift + S"}],label:$localize`Slow pan down`},{keys:[{shortcut:"Shift + A"}],label:$localize`Slow pan left`},{keys:[{shortcut:"Shift + D"}],label:$localize`Slow pan right`}]},{label:$localize`Rotate`,shortcuts:[{keys:[{shortcut:Io.Up}],label:$localize`Rotate up`},{keys:[{shortcut:Io.Down}],label:$localize`Rotate down`},{keys:[{shortcut:Io.Left}],label:$localize`Rotate left`},{keys:[{shortcut:Io.Right}],label:$localize`Rotate right`},{keys:[{shortcut:`Shift + ${Io.Up}`}],label:$localize`Slow rotate up`},{keys:[{shortcut:`Shift + ${Io.Down}`}],label:$localize`Slow rotate down`},{keys:[{shortcut:`Shift + ${Io.Left}`}],label:$localize`Slow rotate left`},{keys:[{shortcut:`Shift + ${Io.Right}`}],label:$localize`Slow rotate right`}]},{label:$localize`Zoom`,shortcuts:[{keys:[{shortcut:"E"},{shortcut:"=",pronunciation:"Equals."}],label:$localize`Zoom in`},{keys:[{shortcut:"C"},{shortcut:"-",pronunciation:"Hyphen."}],label:$localize`Zoom out`},{keys:[{shortcut:"Shift + E"},{shortcut:"Shift + =",pronunciation:"Shift plus equals."}],label:$localize`Slow zoom in`},{keys:[{shortcut:"Shift + C"},{shortcut:"Shift + -",pronunciation:"Shift plus hyphen."}],label:$localize`Slow zoom out`}]},{label:$localize`Modify Selected Objects`,shortcuts:[{keys:[{shortcut:"Shift + H"}],label:$localize`Hide selected objects`},{keys:[{shortcut:"Shift + F"}],label:$localize`Fade selected objects`},{keys:[{shortcut:"Shift + I"}],label:$localize`Isolate selected objects`}]},{label:$localize`Media Controls`,shortcuts:[{keys:[{shortcut:"J"}],label:$localize`Rewind 1 second`},{keys:[{shortcut:"L"}],label:$localize`Fast forward 1 second`},{keys:[{shortcut:"K"},{shortcut:"space"}],label:$localize`Play / pause`}]}]}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-shortcuts"]],decls:2,vars:1,consts:[[1,"view-shortcuts"],["class","view-shortcuts__group",4,"ngFor","ngForOf"],[1,"view-shortcuts__group"],[1,"view-shortcuts__label","font-bold"],[1,"view-shortcuts__table"],[4,"ngFor","ngForOf"],["scope","row",1,"view-shortcuts__cell-header"],[1,"view-shortcuts__cell","view-shortcuts__cell--key"],[1,"view-shortcuts__key",3,"innerHTML"],["class","sr-only",4,"ngIf"],[1,"sr-only"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,_C,5,2,"div",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",s.shortcutGroups))},dependencies:[q.Sq,q.bT,aC],styles:[".view-shortcuts{display:flex;flex-direction:column}.view-shortcuts__group{width:100%;padding-bottom:32px;margin-top:32px}.view-shortcuts__label{padding:8px 0 12px}.view-shortcuts__table{width:100%}.view-shortcuts__cell{padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__cell-header{text-align:start;padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__key{border-radius:4px;display:inline-flex;padding:4px;margin-right:4px;background:#000;color:#fff;justify-content:center;align-items:center;font-family:monospace;font-size:16px}.view-shortcuts__key>kbd{margin-inline-end:8px}.view-shortcuts__key>kbd:last-child{margin-inline-end:0}\n"],encapsulation:2,changeDetection:0}),t})();var Na;const hC=["viewHelp"];class Kp{constructor(t,o,i,s){this.dialogRef=t,this.renderer=o,this.store=i,this.data=s,this.helpTypeEnum=v,this.activeTab=v.Basics,this.ngUnsubscribe=new Q.B,this.activeTab=s.tab}ngOnInit(){this.initWindowSizeObserver()}ngAfterViewInit(){this.updateViewHeight()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWindowSizeObserver(){this.renderer.listen("window","resize",()=>{this.updateViewHeight()})}updateViewHeight(){const i=Hp(this.store.selectSnapshot(gn.getSiteHeader),this.store.selectSnapshot(gn.getSiteHeaderHeight),!1);this.viewHelp.nativeElement.style.setProperty("--vh",`${i}px`)}handleCloseClick(){this.dialogRef.close()}}(Na=Kp).\u0275fac=function(t){return new(t||Na)(e.rXU(Dt.CP),e.rXU(e.sFG),e.rXU(l.il),e.rXU(Dt.Vh))},Na.\u0275cmp=e.VBU({type:Na,selectors:[["app-help-dialog"]],viewQuery:function(t,o){if(1&t&&e.GBs(hC,7),2&t){let i;e.mGM(i=e.lsd())&&(o.viewHelp=i.first)}},decls:147,vars:1,consts:()=>{let n,t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n,ft,ze,Je,dt,kt,Li,Yr,Kr,Jr,qr,Zr,rc,Yd,Kd,Jd,qd,Zd,e_,t_,n_,i_,o_,s_,r_,a_,l_,c_,d_,__,p_;return n=$localize`:fe6f57177418d5e7beb3165189f76d610996162d7676085147402388734:Navigation Basics`,t=$localize`:429597f3d7d1d78213dcf7dd66eebfde0d86678e6253898756323650322:A heart with an arrow wrapped around it, which symbolises objects being rotated withing the 3D viewport.`,o=$localize`:e18d3340208bca7ddf2d94f70d0a660dbd42385d5773019152243041254:A heart with left and right arrows pointing away from it, which symbolises objects being panned within the 3D viewport`,i=$localize`:d39dadf537d9b0839ce21a28536327f9f5a686c74934730967388350918:A heart with a magnifying glass over it, which symbolises zooming into and out from an object within the 3D viewport.`,s=$localize`:304ad8b02639512724d4bd74a4e0948235755937354592426013976576:A heart with a smaller region colored in blue and a popup window specifying that the Right Ventricle is selected.`,r=$localize`:6cfe97f88f0ed2276b3712e9f9f3afa30a5202816061724875357600922:All Controls`,a=$localize`:18a94681247b809ceced9eb0f694ae4c0d312da46414411281097606478:A mouse with the left button being held in.`,d=$localize`:1170cfcc8c84af3864f78a0492ec1fd7802843688257874423928835005:A mouse with the right button being held in.`,f=$localize`:7af3be3703c527b268af7bdf41dbea65aa79a6ec9056964158501440909:A mouse with the left button being clicked.`,T=$localize`:2060ac29b56620ac4dee9e60c192070663dbe8ae1011682562656049028:A mouse with the left button being double clicked.`,L=$localize`:3151632192d235a3f169dca7cc9ef84780febe866187030666890085624:A mouse with the left button being held in for a long duration.`,ee=$localize`:966f12391c5738cf46c32d1cb6a5f5a8340486424740543999988156181:The arrow keys.`,re=$localize`:6ba68416157f6fe2131511ecdd079903b2eeefb78470097694829285611:The W, A, S and D keys.`,ve=$localize`:0ac7f1fedebf3949fc40233a13c6eb4e0e0406644819033955395086119:The plus and minus keys grouped together or the E and C keys grouped together.`,Oe=$localize`:2b78dffe01cdcaf46976e26b031c327066fff0fa6264224730837738660:The shift key.`,Ee=$localize`:a302d6da0d4e760ae27cb11470852686dc8472914683038358223678995:A finger clicking the trackpad once.`,Re=$localize`:ed595e7bcf6f65d4bfcb7302f8436fdc171e87a12262651993298779843:A finger clicking the trackpad twice.`,Fe=$localize`:23c69f01719b0c53dea3a4f38b7b6b20b1a68f354216705101587735156:A finger pressing for a long duration on the trackpad.`,Ke=$localize`:58f7f1cfc7494c3ad8af6f045a100569af8e763d3981109811663390815:Two fingers pressing the trackpad while moving vertically.`,it=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,pt=$localize`:85b79c9064aed1ead31ace985f31aa1363f6bdaf7911416166208830577:Help`,Mt=$localize`:0ce04cf84ced2fc10b64d8d01c93254302fae7208819530610784848299:Close help modal`,$t=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,_n=$localize`:b2ba3edf1e4f930372c8c0648a80cd8540824bb27927106883889636493:Click and drag or use one finger to change the viewing angle.`,ft=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,ze=$localize`:5f2421818b14ff6b2b6760f657072c9d1edf54c0875857706935138088:Hold the shift key and drag or use two fingers to move the model's position.`,Je=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,dt=$localize`:943378a26adbb00b393fc72f7d8751a3d154419f2968417613352515367:Scroll up and down or pinch with two fingers to zoom in or out.`,kt=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,Li=$localize`:1e2bffd4aecf789df7c101eec013ece36ac4d1b13307141625837320493:Click or tap an anatomic structure or label to learn more.`,Yr=$localize`:06525f75da53823cbe1725093bc86cd88ade8597728862926652618704:Mouse`,Kr=$localize`:c3cee0bf85850fda5c38ee3e4d1bff10de4ce5c57193182677599035399:Hold left button to rotate`,Jr=$localize`:23c0d0956b66d711cfe7df58ef6a7b4d07075b004504766784431323465:Hold right button to pan`,qr=$localize`:430665e380a10950da6951cf7f4002d0cc8dd1575037804585803260848:Single-click left button to select a structure`,Zr=$localize`:45cebd73bba4b4553ff774400b20119e5a9d97ff2243293724382272862:Double-click left button to auto-focus on a structure`,rc=$localize`:7e25565e229d4feddc9c05e1738729a9aac57a287760284646478975781:Long-click to fly to a structure`,Yd=$localize`:50b412747cc527764294a1b903ec5c1d62844a111724029931462476938:Rotate with arrows`,Kd=$localize`:07614e55f8def77bf252040fc41cc9453e0fa34d8399776404178179481:Pan up (W), left (A), down (S), right(D)`,Jd=$localize`:064d015bd99ad65866112d59a58eb66cd4ed3dcf2527063424056268537:Zoom out (-, C) and zoom in (+, E)`,qd=$localize`:6b1e5719efa1db70ea28a09765b11b1488dc3dcb3479840639285374289:Hold with any previous key to slow down motion`,Zd=$localize`:3b12deb58592fad9559bee11b1c81a314f6c0dfd5453789791073353804:Trackpad`,e_=$localize`:03e5f4b8f37c3498d675cce895d5cbbe14f001dd8732399774338102812:Single-tap to auto-focus a structure`,t_=$localize`:fa6d739684a57595169beedef230af0de5e835f8893674047997882971:Double-tap to select a structure`,n_=$localize`:38d81be3a0506d3d76acab0eb9ba6d756e643b9e6955199594650294227:Long-press to fly to a structure`,i_=$localize`:bbc241c56a687bd4b728277bbbfc5714fe71564d8600401187735507174:Scroll up and down to zoom`,o_=$localize`:2d2c5215cbb8cb0c926c8d132668eb16275558b08973369245527156970:In-App`,s_=$localize`:74d17ea41b9374ceefcf8f7c763a1176cd96dbae491840984763060870: The plus symbol, which represents zooming in in the camera control menu. `,r_=$localize`:e28ee80cd3a124e109793180dfd1f8d8067dcc6b6500061599200357251:Zoom in`,a_=$localize`:402a1f359e7c008f0aef6b084fafaf2f49ce56d3399413764515891152: The minus symbol, which represents zooming out in the camera control menu. `,l_=$localize`:a3dfc58748f790fa096cf3c5fc331f90846e1772944767796496567082:Zoom out`,c_=$localize`:c4f9fc3dd4d06c87f09dc68e8e0a3b38ae4948ff7289327967342552784: The map pin symbol, which resets the camera in the camera control menu. `,d_=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,__=$localize`:5108bd6e5963ccd847b1a768fd214262ccfbc81d8038524584906192988: Arrows pointing in four directions, which represents panning in the camera control menu. `,p_=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,[["viewHelp",""],pt,Mt,$t,_n,ft,ze,Je,dt,kt,Li,Yr,Kr,Jr,qr,Zr,rc,Yd,Kd,Jd,qd,Zd,e_,t_,n_,i_,o_,s_,r_,a_,l_,c_,d_,__,p_,["role","dialog","aria-labelledby","helpTitle",1,"view-help"],["id","helpTitle",1,"view-help__header"],["type","button",1,"view-help__close",3,"click"],["icon","times","aria-hidden","true"],[1,"sr-only"],[1,"view-help__inner"],["tabSize","medium","tabAlign","center","cdkFocusInitial","",3,"activeTab"],["label",n,"id","helpBasics","aria-controls","basicsPanel"],["role","tabpanel","aria-labelledby","helpBasics","tabindex","0","id","basicsPanel"],[1,"view-help__group"],[1,"view-help__item"],[1,"view-help__image"],["src","assets/images/widget/help-rotate.svg","alt",t],[1,"view-help__label"],["src","assets/images/widget/help-pan.svg","alt",o],["src","assets/images/widget/help-zoom.svg","alt",i],["src","assets/images/widget/help-learn.svg","alt",s],["label",r,"id","helpAll","aria-controls","allPanel"],["role","tabpanel","aria-labelledby","helpAll","tabindex","0","id","allPanel"],[1,"view-help__section-header"],["src","assets/images/widget/help-mouse-hold-left.svg","alt",a],["src","assets/images/widget/help-mouse-hold-right.svg","alt",d],["src","assets/images/widget/help-mouse-single-click-left.svg","alt",f],["src","assets/images/widget/help-mouse-double-click-left.svg","alt",T],["src","assets/images/widget/help-mouse-long-press-left.svg","alt",L],["src","assets/images/widget/help-keyboard-rotate.svg","alt",ee],["src","assets/images/widget/help-keyboard-pan.svg","alt",re],["src","assets/images/widget/help-keyboard-zoom.svg","alt",ve],["src","assets/images/widget/help-keyboard-slow-motion.svg","alt",Oe],["src","assets/images/widget/help-trackpad-single-tap.svg","alt",Ee],["src","assets/images/widget/help-trackpad-double-tap.svg","alt",Re],["src","assets/images/widget/help-trackpad-long-press.svg","alt",Fe],["src","assets/images/widget/help-trackpad-scroll.svg","alt",Ke],["icon","plus","aria-hidden","true",1,"view-help__icon"],["icon","minus","aria-hidden","true",1,"view-help__icon"],["icon","location","aria-hidden","true",1,"view-help__icon"],["icon","arrows","aria-hidden","true",1,"view-help__icon"],["label",it,"id","helpShortcuts","aria-controls","shortcutsPanel"],["role","tabpanel","aria-labelledby","helpShortcuts","tabindex","0","id","shortcutsPanel"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",35,0)(2,"h2",36),e.pXf(3,1),e.k0s(),e.j41(4,"button",37),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleCloseClick())}),e.nrm(5,"app-icon",38),e.j41(6,"span",39),e.pXf(7,2),e.k0s()(),e.j41(8,"div",40)(9,"app-tabs",41)(10,"app-tab",42)(11,"div",43)(12,"ul",44)(13,"li",45)(14,"div",46),e.nrm(15,"img",47),e.k0s(),e.j41(16,"div",48),e.pXf(17,3),e.k0s(),e.qex(18),e.pXf(19,4),e.bVm(),e.k0s(),e.j41(20,"li",45)(21,"div",46),e.nrm(22,"img",49),e.k0s(),e.j41(23,"div",48),e.pXf(24,5),e.k0s(),e.qex(25),e.pXf(26,6),e.bVm(),e.k0s(),e.j41(27,"li",45)(28,"div",46),e.nrm(29,"img",50),e.k0s(),e.j41(30,"div",48),e.pXf(31,7),e.k0s(),e.qex(32),e.pXf(33,8),e.bVm(),e.k0s(),e.j41(34,"li",45)(35,"div",46),e.nrm(36,"img",51),e.k0s(),e.j41(37,"div",48),e.pXf(38,9),e.k0s(),e.qex(39),e.pXf(40,10),e.bVm(),e.k0s()()()(),e.j41(41,"app-tab",52)(42,"div",53)(43,"h3",54),e.pXf(44,11),e.k0s(),e.j41(45,"ul",44)(46,"li",45)(47,"div",46),e.nrm(48,"img",55),e.k0s(),e.qex(49),e.pXf(50,12),e.bVm(),e.k0s(),e.j41(51,"li",45)(52,"div",46),e.nrm(53,"img",56),e.k0s(),e.qex(54),e.pXf(55,13),e.bVm(),e.k0s(),e.j41(56,"li",45)(57,"div",46),e.nrm(58,"img",57),e.k0s(),e.qex(59),e.pXf(60,14),e.bVm(),e.k0s(),e.j41(61,"li",45)(62,"div",46),e.nrm(63,"img",58),e.k0s(),e.qex(64),e.pXf(65,15),e.bVm(),e.k0s(),e.j41(66,"li",45)(67,"div",46),e.nrm(68,"img",59),e.k0s(),e.qex(69),e.pXf(70,16),e.bVm(),e.k0s()(),e.j41(71,"h3",54),e.EFF(72,"Keyboard"),e.k0s(),e.j41(73,"ul",44)(74,"li",45)(75,"div",46),e.nrm(76,"img",60),e.k0s(),e.qex(77),e.pXf(78,17),e.bVm(),e.k0s(),e.j41(79,"li",45)(80,"div",46),e.nrm(81,"img",61),e.k0s(),e.qex(82),e.pXf(83,18),e.bVm(),e.k0s(),e.j41(84,"li",45)(85,"div",46),e.nrm(86,"img",62),e.k0s(),e.qex(87),e.pXf(88,19),e.bVm(),e.k0s(),e.j41(89,"li",45)(90,"div",46),e.nrm(91,"img",63),e.k0s(),e.qex(92),e.pXf(93,20),e.bVm(),e.k0s()(),e.j41(94,"h3",54),e.pXf(95,21),e.k0s(),e.j41(96,"ul",44)(97,"li",45)(98,"div",46),e.nrm(99,"img",64),e.k0s(),e.qex(100),e.pXf(101,22),e.bVm(),e.k0s(),e.j41(102,"li",45)(103,"div",46),e.nrm(104,"img",65),e.k0s(),e.qex(105),e.pXf(106,23),e.bVm(),e.k0s(),e.j41(107,"li",45)(108,"div",46),e.nrm(109,"img",66),e.k0s(),e.qex(110),e.pXf(111,24),e.bVm(),e.k0s(),e.j41(112,"li",45)(113,"div",46),e.nrm(114,"img",67),e.k0s(),e.qex(115),e.pXf(116,25),e.bVm(),e.k0s()(),e.j41(117,"h3",54),e.pXf(118,26),e.k0s(),e.j41(119,"ul",44)(120,"li",45),e.nrm(121,"app-icon",68),e.j41(122,"span",39),e.pXf(123,27),e.k0s(),e.qex(124),e.pXf(125,28),e.bVm(),e.k0s(),e.j41(126,"li",45),e.nrm(127,"app-icon",69),e.j41(128,"span",39),e.pXf(129,29),e.k0s(),e.qex(130),e.pXf(131,30),e.bVm(),e.k0s(),e.j41(132,"li",45),e.nrm(133,"app-icon",70),e.j41(134,"span",39),e.pXf(135,31),e.k0s(),e.qex(136),e.pXf(137,32),e.bVm(),e.k0s(),e.j41(138,"li",45),e.nrm(139,"app-icon",71),e.j41(140,"span",39),e.pXf(141,33),e.k0s(),e.qex(142),e.pXf(143,34),e.bVm(),e.k0s()()()(),e.j41(144,"app-tab",72)(145,"div",73),e.nrm(146,"app-view-shortcuts"),e.k0s()()()()()}2&t&&(e.R7$(9),e.Y8G("activeTab",o.activeTab))},dependencies:[yt.R,Ff.j,Gf.O,pC],styles:[".view-help{background-color:#101823e6;color:#fff;display:flex;align-items:center;flex-direction:column;position:fixed;top:0;left:0;right:0;z-index:10000;height:100vh;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:auto}.view-help__inner{width:100%;max-width:1140px;height:99vh;height:calc(var(--vh, 1vh) * 99);padding:32px;position:relative}.view-help__close{color:#fff;width:40px;height:40px;display:flex;align-items:center;justify-content:center;position:fixed;right:8px;top:8px;z-index:10;border:none;background:none}.view-help__header{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__section-header{font-size:.75rem;line-height:1rem;border-bottom:1px solid rgba(255,255,255,.3);font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__label{font-size:.875rem;line-height:1.25rem;font-weight:600;margin-bottom:12px}.view-help__group{display:flex;justify-content:space-around;flex-wrap:wrap}.view-help__item{font-size:.75rem;line-height:1rem;display:flex;flex-flow:column;text-align:center;padding:20px;flex:0 1 180px}.view-help__image{justify-content:center;margin-bottom:16px;width:160px;height:100px}.view-help__icon{font-size:24px;margin-bottom:16px}\n"],encapsulation:2,changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(_e.getCanTouch),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Kp.prototype,"canTouch$",void 0);var Rs,fi=_(3829),Bc=function(n){return n.DiscoveredChapterNav="Discovered Chapter Nav",n}(Bc||{}),Or=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Si=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class $f{}const Bf={audioMuted:!0,autoplayAudio:!1};let Ni=((Rs=class{static getAudioMuted(t){return t.audioMuted}static getAutoplayAudio(t){return t.autoplayAudio}setAudioMuted(t,o){const i=Nn.jM(t.getState(),s=>{s.audioMuted=o.mute});t.setState(i)}setAutoplayAudio(t,o){const i=Nn.jM(t.getState(),s=>{s.autoplayAudio=o.autoplay});t.setState(i)}resetAudio(t,o){t.setState(Bf)}}).\u0275fac=function(t){return new(t||Rs)},Rs.\u0275prov=e.jDH({token:Rs,factory:Rs.\u0275fac}),Rs);Or([(0,l.rc)(_i.SetAudioMuted),Si("design:type",Function),Si("design:paramtypes",[Object,_i.SetAudioMuted]),Si("design:returntype",void 0)],Ni.prototype,"setAudioMuted",null),Or([(0,l.rc)(_i.SetAutoplayAudio),Si("design:type",Function),Si("design:paramtypes",[Object,_i.SetAutoplayAudio]),Si("design:returntype",void 0)],Ni.prototype,"setAutoplayAudio",null),Or([(0,l.rc)(_i.ResetAudio),Si("design:type",Function),Si("design:paramtypes",[Object,_i.ResetAudio]),Si("design:returntype",void 0)],Ni.prototype,"resetAudio",null),Or([(0,l.MD)(),Si("design:type",Function),Si("design:paramtypes",[$f]),Si("design:returntype",void 0)],Ni,"getAudioMuted",null),Or([(0,l.MD)(),Si("design:type",Function),Si("design:paramtypes",[$f]),Si("design:returntype",void 0)],Ni,"getAutoplayAudio",null),Ni=Or([(0,l.Uw)({name:"media",defaults:Bf})],Ni);var Jo=_(46842),Qi=_(18617),Ra=_(47987);let hn=(()=>{var n;class t{constructor(i,s,r,a,d,f,T,L,ee,re){this.dialog=i,this.store=s,this.location=r,this.transitionService=a,this.mediaService=d,this.sceneService=f,this.viewUIService=T,this.vendorAnalyticsService=L,this.liveAnnouncer=ee,this.overlayContainer=re,this.materialOverlayOut$=new Q.B}initStory(i,s,r){const a="preview"===i;this.store.dispatch(new A_(i,s,a)),this.store.dispatch(new bs(i,s,!0));const d=this.store.select(Xe.S.getReady),f=this.store.select(rt.getIncomingStoryInfo);(0,Ht.z)([d,f]).pipe((0,S.p)(([T,L])=>T&&!!L.id),(0,tn.s)(1)).subscribe(()=>{this.store.dispatch(new En.yz),this.store.dispatch(new Ss(i,s,r,a))})}nextChapter(i){const s=this.store.selectSnapshot(fe.N.getSelectedChapterIndex),r=this.store.selectSnapshot(fe.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Bc.DiscoveredChapterNav,{source:i,breakpoint:this.store.selectSnapshot(In.getHorizontalBreakpointLabel)});const a=r[s+1];a&&this.selectChapter(a)}previousChapter(i){const s=this.store.selectSnapshot(fe.N.getSelectedChapterIndex),r=this.store.selectSnapshot(fe.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Bc.DiscoveredChapterNav,{source:i,breakpoint:this.store.selectSnapshot(In.getHorizontalBreakpointLabel)});const a=r[s-1];a&&this.selectChapter(a)}firstChapter(i){const s=this.store.selectSnapshot(fe.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(i,{source:i,breakpoint:this.store.selectSnapshot(In.getHorizontalBreakpointLabel)});const r=s[0];r&&this.selectChapter(r)}selectChapter(i){var s=this;return(0,Ct.A)(function*(){if(!s.store.selectSnapshot(Ue.j.getQuizModeActive)){const d=s.store.selectSnapshot(fe.N.getSelectedChapterId),f=i.id,T=s.store.selectSnapshot(fe.N.getStoryChapters);let L=null;s.store.selectSnapshot(Jo.U.getPrefersReducedMotion)||(L=s.transitionService.searchChapterTransitions(d,f,T)),s.vendorAnalyticsService.trackOncePerSession(Bc.DiscoveredChapterNav,{source:"Chapter List",breakpoint:s.store.selectSnapshot(In.getHorizontalBreakpointLabel)}),L&&(yield s.chapterTransition(L)),s.store.dispatch([new or(i.id),new En.yz(i)])}const a=document.getElementById("chapter-title");a&&setTimeout(()=>a.querySelector("button").focus(),200)})()}chapterTransition(i){return new Promise(s=>{i.camera&&this.store.dispatch(new jt.Ih(i.camera,!0,i.duration)),i.fadeColor&&this.store.dispatch(new st.zW(i.fadeColor,i.duration)),setTimeout(()=>{s(!0)},1e3*i.duration)})}hideSelectedStructures(){const i=this.store.selectSnapshot(Mn.z.getCheckedNodeIds);this.store.dispatch(new Lt.yr(!1,i))}selectTool(i){this.store.selectSnapshot(Ue.j.getQuizModeActive)&&i===qt.s.Select&&(i=qt.s.Quiz),this.store.dispatch(new st.pL(i))}toggleAutoplay(i){i=i??!this.store.selectSnapshot(_e.getAutoplay),this.store.dispatch(new D.SetAutoplay(i))}toggleAnimation(){const i=this.store.selectSnapshot(Xe.S.getAnimationPlaying);this.store.dispatch(new st.dE(!i))}toggleMedia(i){const s=this.store.selectSnapshot(Be.getUI);s.media.status=(i=i??s.media.status!==at.Show)?at.Show:at.Collapse,this.store.dispatch(new Dn.SetUI(s))}toggleDrawer(i,s=!1){const r=this.store.selectSnapshot(Be.getUI);null==i&&(i=r.drawer.status==at.Hide?at.Show:at.Hide),r.drawer.status=i,s&&(r.drawer.userStatusPreference=r.drawer.status),this.store.dispatch(new Dn.SetUI(r))}toggleColumn(i){const s=this.store.selectSnapshot(Be.getUI);null==i&&(i=s.column.status!==at.Show),s.column.status=i?at.Show:at.Collapse,s.column.userStatusPreference=s.column.status,this.store.dispatch(new Dn.SetUI(s))}togglePresentation(){this.store.selectSnapshot(_e.getPresentationActive)?this.stopPresentation():this.startPresentation()}startPresentation(){this.store.dispatch(new D.TogglePresentation(!0))}stopPresentation(){this.store.dispatch(new D.TogglePresentation(!1))}toggleHelp(i=v.Basics){0===this.dialog.openDialogs.length&&this.dialog.open(Kp,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{tab:i}})}toggleInteract(i){this.store.dispatch(new D.ToggleWindow(fn.Interact,i))}toggleOnDemand(i){this.store.dispatch(new D.SetOnDemand(i)),this.store.dispatch(new D.ToggleWindow(fn.OnDemand,i))}togglePlaythrough(i,s){this.store.dispatch(new D.SetPlaythroughEnabled(i)),(0,m.isNil)(s)||this.store.dispatch(new D.SetForceAudio(s))}toggleTutorial(i){this.store.dispatch(new D.ToggleWindow(fn.Tutorial,i)),i&&this.store.dispatch(new D.StartTutorial(!0))}toggleWhiteboard(i){this.store.dispatch(new D.ToggleWindow(fn.Whiteboard,i)),i&&this.store.dispatch(new D.SetWhiteboardEnabled(!0))}showLabels(i){const s=this.store.selectSnapshot(Be.getUI);i=(0,m.isNil)(i)?!s.labels.shown:i,s.labels.shown=i,this.store.dispatch(new Dn.SetUI(s))}toggleLabels(i){this.store.dispatch(new st.Gv(i))}togglePan(){const i="pan"===this.store.selectSnapshot(fi.x.getPanMode)?"rotate":"pan";this.store.dispatch(new jt.vq(i))}toggleSearch(i=Xi.q.List,s){const r=this.store.selectSnapshot(Be.getUI);r.search.status=(s=s??r.search.status!==at.Show)?at.Show:at.Collapse,s&&(r.visibilityLayers.status=at.Collapse,r.nodeInfo.status=at.Hide),this.store.dispatch(new D.SetSearchDisplayMode(i)),this.store.dispatch(new Dn.SetUI(r))}toggleLayers(i){const s=this.store.selectSnapshot(_e.getLayout);this.viewUIService.getViewLayout(s)===Qn.Drawer?this.toggleLayersDrawer(i):this.toggleLayersColumn(i)}toggleLayersColumn(i){const s=this.store.selectSnapshot(Be.getUI);s.visibilityLayers.status=(i=i??s.visibilityLayers.status!==at.Show)?at.Show:at.Collapse,i&&(s.search.status=at.Collapse,s.nodeInfo.status=at.Hide),this.store.dispatch(new Dn.SetUI(s))}toggleLayersDrawer(i){const s=this.store.selectSnapshot(Be.getVisible(G.Drawer)),r=(i=i??!s)?at.Show:at.Hide;this.setContentMode(Ft.VisibilityLayers),this.toggleDrawer(r)}toggleNodeInfo(i){this.setContentMode(i?Ft.NodeInfo:null)}toggleLabelInfo(i){const s=this.store.selectSnapshot(Be.getVisible(G.Drawer)),r=this.store.selectSnapshot(_e.getContentMode);i=(0,m.isNull)(i)?!s:i;const a=this.store.selectSnapshot(Ze.getSelectedLabel),d=this.store.selectSnapshot(Be.getVisible(G.LabelList)),f=s&&d;if(i&&a)this.toggleDrawer(f&&r===Ft.ChapterInfo||a?.description||a.contentBlocks?.length>0?at.Show:at.Collapse),f||this.setContentMode(Ft.LabelInfo);else{if(f&&r===Ft.ChapterInfo)return;this.toggleDrawer(at.Hide)}}playChapterAudio(i=!1){const s=this.store.selectSnapshot(_e.getViewLanguage),r=this.store.selectSnapshot(fe.N.getSelectedChapter);this.mediaService.stopAllAudio(),this.mediaService.getChapterAudioPlayer(r,s,i).then(a=>{if((this.store.selectSnapshot(Ni.getAutoplayAudio)||i)&&this.store.selectSnapshot(fe.N.getSelectedChapterId)===r.id){const T=this.store.selectSnapshot(Ni.getAudioMuted);this.mediaService.playAudio(r.id,T)}})}setContentMode(i){i||(i=Ft.ChapterInfo),this.store.dispatch(new D.SetContentMode(i))}delegateNodeClick(i,s){if(this.clearSelectedLabel(),i||s.srcEvent.shiftKey)if(s.srcEvent.shiftKey||this.store.selectSnapshot(_e.getMultiPickModeEnabled))this.checkNode(i);else switch(this.store.selectSnapshot(Xe.S.getActiveTool)){case qt.s.Hide:this.hideNode(i);break;case qt.s.Select:this.selectNode(i);break;case qt.s.Isolate:this.isolateNode(i);break;case qt.s.Fade:this.fadeNode(i)}else this.clearSelectedNodes()}clearSelectedLabel(){this.store.dispatch(new He.TR)}clearSelectedNodes(){this.store.dispatch(new Lt.hg),this.store.dispatch(new Lt.q9(!1))}clearFadedNodes(){const i=this.store.selectSnapshot(fe.N.getSelectedChapterId);this.store.dispatch(new di.a.UndoAll(i))}checkNode(i,s){void 0!==i&&(null==s&&(s=this.store.selectSnapshot(Mn.z.getNodes)[i.id].checked),this.store.dispatch(new Lt.q9(!s,[i.id])),this.store.dispatch(new Lt.hg(i.id)))}fadeNode(i){this.store.dispatch(new Lt.Jp(Es.EC,[i.id]))}isolateNode(i){this.store.dispatch(new Lt.yr(!1)),this.store.dispatch(new Lt.yr(!0,[i.id]))}selectNode(i){const s=!this.store.selectSnapshot(Mn.z.getNodes)[i.id].checked;this.store.dispatch(new Lt.q9(!1)),s&&(this.store.dispatch(new Lt.q9(!0,[i.id])),this.store.dispatch(new Lt.hg(i.id))),this.store.dispatch(new st._o(i));const r=this.store.selectSnapshot(_e.getNodeInfoFallback),a=this.store.selectSnapshot(_e.getViewLanguage);this.store.dispatch(new st.bo(i,r,a))}hideNode(i){this.store.dispatch(new Lt.yr(!1,[i.id])),this.store.dispatch(new Lt.q9(!1))}selectLabel(i,s=!1){const{objectId:r,states:a}=i;this.store.dispatch(new He.TR(i)),s&&r&&0===a.length&&this.store.dispatch(new st.W6(r,!0))}applyChapterCamera(i){this.store.selectSnapshot(fi.x.getChapterCameraEnabled)&&this.store.dispatch(new jt.Ih(i.camera.location,i.camera.action===T_.L.FlyTo,void 0,i.camera.rotationCenter))}applyChapterScenegraph(i){const s=this.sceneService.createViewGraph({availableObjects:i.availableObjects,viewGraphMetadata:this.store.selectSnapshot(Xe.S.getViewGraphMetadata)});this.store.dispatch(new st.LL(s)),this.store.dispatch(new Lt.IA(i.id))}playChapterFromStart(){this.store.dispatch(new st.K6)}resetCamera(){const s=this.store.selectSnapshot(fe.N.getSelectedChapter)?.camera?.location;(0,m.isNil)(s)||this.store.dispatch(new jt.Ih(s))}resetChapter(){this.resetCamera();const i=this.store.selectSnapshot(fe.N.getSelectedChapterId);this.store.dispatch(new di.a.UndoAll(i)).subscribe(()=>{this.liveAnnouncer.announce("reset complete")}),this.store.dispatch(new Lt.q9(!1)),this.store.dispatch(new He.S3)}resetUI(){const i=this.store.selectSnapshot(Be.getUI);this.viewUIService.isUIHidden()?Object.keys(i).forEach(s=>{i[s].status=at.Hide}):(this.store.selectSnapshot(Ue.j.getQuizModeActive)||(i.drawer.status=i.drawer.isExpandedInitially?at.Show:at.Hide),Object.keys(i).forEach(r=>{i[r].userStatusPreference?i[r].status=i[r].userStatusPreference:r!==G.Drawer&&(i[r].status=at.Show)}),i.search.status=at.Collapse,i.visibilityLayers.status=at.Collapse,i.nodeInfo.status=at.Hide,i.media.status=at.Collapse,i.quizPrompt.status=this.store.selectSnapshot(Ue.j.hasQuiz)?at.Show:at.Hide),this.store.dispatch(new Dn.SetUI(i))}resetContentMode(){const s=this.store.selectSnapshot(Ue.j.getQuizModeActive)?Ft.Quiz:Ft.ChapterInfo;this.store.dispatch(new D.SetContentMode(s))}undo(){this.store.dispatch(new di.a.Undo(this.store.selectSnapshot(fe.N.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("undo complete")})}redo(){this.store.dispatch(new di.a.Redo(this.store.selectSnapshot(fe.N.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("redo complete")})}toggleTools(i){const s=this.store.selectSnapshot(Be.getUI);s.tools.status=(i=i??s.tools.status!==at.Show)?at.Show:at.Collapse,this.store.dispatch(new Dn.SetUI(s))}closeToolbar(){const i=this.store.selectSnapshot(Be.getUI);i.media.status=at.Hide,i.tools.status=at.Hide,i.visibilityLayers.status=at.Hide,this.selectTool(qt.s.Select),this.store.dispatch(new Dn.SetUI(i))}normalizeQueryParams(i){const s={...i};return{id:(0,cc.mF)(s),type:(0,cc.lm)(s),lang:i.lang}}sanitizeRouteId(i){return i=i.replace(/\.json$/,""),this.location.replaceState("view",`?id=${i}`),i}openInNewTab(){const i=window.document.location.href;window.open(i)}getComputedTransform(i){const a=getComputedStyle(i).transform.replace("matrix3d","").replace("matrix","").replace("(","").replace(")","").split(",").map(T=>T.trim()).map(T=>parseInt(T,10)),d=16===a.length?a[12]:a[4],f=16===a.length?a[13]:a[5];return Number.isNaN(d)||Number.isNaN(f)?null:{x:d,y:f}}setUI(i){let s=new Tr;s=Ns(s,i.quizUIConfig),s=Ns(s,i.apiUIConfig),s=Ns(s,i.urlUIConfig),s=Ns(s,i.chapterUIConfig),s=Ns(s,i.baseUIConfig),this.store.selectSnapshot(Jo.U.getPrefersReducedMotion)&&(s.media=Hi.Full);const a=xf(this.store.selectSnapshot(Be.getUI),s);this.store.dispatch(new Dn.SetUI(a))}setViewLanguage(i="en"){this.store.dispatch(new D.SetViewLanguage(i))}setViewLogos(i){this.store.dispatch(new Pp.v9(i))}setHeaderLogos(i){this.store.dispatch(new Pp.vf(i))}setAnatomyDescriptionFallback(i){this.store.dispatch(new D.SetNodeInfoConfig(i))}observeMaterialOverlay(){this.materialOverlayObserver=new MutationObserver(()=>{this.materialOverlayOut$.next(this.isMaterialOverlayOut())}),this.materialOverlayObserver.observe(this.overlayContainer.getContainerElement(),{childList:!0})}unobserveMaterialOverlay(){this.materialOverlayObserver&&this.materialOverlayObserver.disconnect(),this.materialOverlayOut$.complete()}isMaterialOverlayOut(){return this.overlayContainer.getContainerElement().childElementCount>0}isMaterialMenuOut(){return null!==this.overlayContainer.getContainerElement().querySelector("[role=menu]")}elementHasFocus(i){return!(!i||!i.contains(document.activeElement))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(Dt.bZ),e.KVO(l.il),e.KVO(q.aZ),e.KVO(S0),e.KVO(Ci),e.KVO(ji.w),e.KVO(Fc),e.KVO(qe),e.KVO(Qi.Ai),e.KVO(Ra.Sf))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})(),mC=(()=>{var n;class t{constructor(i){this.viewService=i}initialize(){window.BDGlobalActions={toggleTutorial:i=>this.viewService.toggleTutorial(i)}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(hn))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Da,zc=function(n){return n.APIKey="apikey",n.UserAnalyticId="uaid",n.ProductKey="productkey",n.UserId="userid",n}(zc||{});class Jp{constructor(t,o,i,s,r,a){this.store=t,this.router=o,this.vendorAnalyticsService=i,this.globalActionsService=s,this.engineService=r,this.productService=a,this.title="Biodigital Human",this.ngUnsubscribe=new Q.B}ngOnInit(){this.initVendorAnalytics(),this.initPageAnalytics(),this.initInputObserver(),this.initGPUAnalytics(),this.initStats(),this.globalActionsService.initialize()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initVendorAnalytics(){this.vendorAnalyticsService.appendScripts(),this.vendorAnalyticsService.initialize({},{})}initInputObserver(){this.inputEnabled$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.store.dispatch(new D.SetInputEnabled(t))})}initPageAnalytics(){this.router.events.pipe((0,S.p)(t=>t instanceof ne.wF),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{})}initGPUAnalytics(){const{dk:t,uaid:o,"app-productkey":i}=this.store.selectSnapshot(Z.getWidgetUrlConfig);let a,d;t?(a=zc.APIKey,d=t):o?(a=zc.UserAnalyticId,d=o):i&&(a=zc.ProductKey,d=i),this.engineService.initAnalytics(this.productService.productType,i||this.productService.productKey,a,d)}initStats(){const t=new URLSearchParams(window.location.search),o="true"===t.get("ui-stats");this.store.dispatch(new st.BM(o,!0));const i=t.get("engine-context");("webgl"===i||"webgl2"===i)&&this.store.dispatch(new st.vA(i))}}(Da=Jp).\u0275fac=function(t){return new(t||Da)(e.rXU(l.il),e.rXU(ne.Ix),e.rXU(qe),e.rXU(mC),e.rXU(u.y),e.rXU(je))},Da.\u0275cmp=e.VBU({type:Da,selectors:[["app-root"]],decls:1,vars:0,template:function(t,o){1&t&&e.nrm(0,"router-outlet")},dependencies:[ne.n3],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Z.getInputEnabled),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Jp.prototype,"inputEnabled$",void 0);var ui=_(29160),bC=_(81027),yC=_(24911),qp=_(4664),Fn=_(87996),wo=_(9065),Ds=_(1670),Wc=function(n){return n[n.Content=0]="Content",n[n.Label=1]="Label",n[n.Tools=2]="Tools",n[n.Search=3]="Search",n[n.Help=4]="Help",n[n.NodeInfo=5]="NodeInfo",n[n.LabelInfo=6]="LabelInfo",n}(Wc||{}),Zn=_(73828),vC=_(38465),zf=function(n){return n[n.Main=0]="Main",n[n.Media=1]="Media",n[n.Tools=2]="Tools",n[n.Whiteboard=3]="Whiteboard",n[n.VisibilityLayers=4]="VisibilityLayers",n[n.Empty=5]="Empty",n}(zf||{}),ks=_(62943),Wf=_(90699),nt=_(65294),Po=_(24552),po=_(83621);let Mr=(()=>{var n;class t{constructor(i,s,r){this.store=i,this.viewService=s,this.applicationEventService=r}startQuiz(){this.viewService.toggleColumn(!0),this.viewService.toggleLabels(!1),this.viewService.toggleLayers(!1),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new jt.nW),this.viewService.setContentMode(Ft.Quiz),this.store.dispatch(new Bt.B.SetQuizActive(!0));const i=this.store.selectSnapshot(Ue.j.getAllQuestions)[0].id;this.store.dispatch(new Bt.B.SetActiveQuestion(i))}resetQuiz(){this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new jt.nW),this.store.dispatch(new Bt.B.SetQuizActive(!1)),this.store.dispatch(new Bt.B.SetActiveSubmission(void 0)),this.store.dispatch(new Bt.B.ClearSubmissions),this.store.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Question))}exitQuiz(){this.resetQuiz(),this.viewService.setContentMode(Ft.ChapterInfo),this.viewService.toggleLabels(!0),this.viewService.toggleDrawer(at.Hide),setTimeout(()=>{this.store.dispatch(new jt.Ih(this.store.selectSnapshot(fe.N.getChapterCamera),!1))})}submitQuestion(i,s){const r=this.store.selectSnapshot(Ue.j.getAllQuestions).find(T=>T.id===i),{launchMode:a,quizSettings:d}=this.store.selectSnapshot(Ue.j);this.store.dispatch(new Bt.B.SubmitQuestionAnswer({questionId:r.id,answer:s})),this.store.dispatch(new Bt.B.SetActiveSubmission({questionId:r.id,answer:s})),this.applicationEventService.fireEvent(nt.F.QuizAnswerSubmitted,{questionId:r.id,answer:s}),a===Ue.W.Learning&&r.type!==vn.Q5.Instructions&&!1!==d.showExplanation?this.store.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Explanation)):this.nextQuestion()}nextQuestion(){this.store.dispatch(new Bt.B.SetActiveSubmission(void 0)),this.store.selectSnapshot(Ue.j.hasQuestionRemaining)?(this.store.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Question)),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Bt.B.NextQuestion)):(this.store.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Review)),this.applicationEventService.fireEvent(nt.F.QuizCompleted,!0))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(hn),e.KVO(po.S))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();function EC(n){return new y.c(t=>{const o=new ResizeObserver(i=>{t.next(i)});return o.observe(n),function(){o.unobserve(n)}})}var ka=_(92811);let Hf=(()=>{var n;class t{constructor(i,s,r){this.mediaService=i,this.animationService=s,this.store=r,this.countdownStatus=new ui.t("inactive"),this.countdownChanged=new Q.B,this.countdownComplete=new Q.B,this.audioObserver=new y.c,this.audioSubject=new ui.t({current:0,duration:0,complete:!1}),this.animationSubject=new ui.t({current:0,duration:0,complete:!1}),this.readingSubject=new ui.t({current:0,duration:0,complete:!1}),this.minimumSubject=new ui.t({current:0,duration:0,complete:!1})}startChapterTimers(i,s=!1){var r=this;return(0,Ct.A)(function*(){const d={current:0,duration:0,complete:!1},f=r.store.selectSnapshot(_e.getViewLanguage),T=r.store.selectSnapshot(Jo.U.getPrefersReducedMotion);if(r.clearChapterTimers(),r.clearCountdown(),(s||r.mediaService.chapterHasAudio(i,f))&&(r.audioRef=yield r.mediaService.getChapterAudioPlayer(i,f,s)),r.audioRef){const ee=yield r.mediaService.getDuration(r.audioRef);r.audioSubject.next({current:0,duration:ee,complete:!1}),r.audioRef.on("end",()=>{r.audioSubject.next({...r.audioSubject.value,complete:!0})}),r.audioRef.on("stop",()=>{r.audioSubject.next({...r.audioSubject.value,complete:!1})}),r.audioRef.on("play",()=>{r.audioSubject.next({current:r.audioRef?.seek(),duration:ee,complete:!1})})}else r.audioSubject.next({current:0,duration:0,complete:!0});r.animationSubject.next({current:r.animationService.getTime(),duration:r.animationService.getChapterDuration(),complete:!1}),r.readingSubject.next({current:0,duration:r.calculateChapterReadingTime(i),complete:!1});const{minimum:L}=r.store.selectSnapshot(_e.getPlaythroughSettings);r.minimumSubject.next({current:0,duration:L,complete:!1}),r.interval=setInterval(()=>{r.audioSubject.next(r.audioRef?{...r.audioSubject.value,current:r.audioRef?.seek()}:{...d,complete:!0}),!r.animationService.isChapterAnimated(i)||T?r.animationSubject.next({...d,complete:!0}):r.animationService.isChapterLooped(i)?r.animationSubject.next({...r.animationSubject.value,current:r.animationSubject.value.current+.05,complete:r.animationSubject.value.current>=r.animationSubject.value.duration}):r.animationSubject.next({...r.animationSubject.value,current:r.animationService.getTime(),complete:r.animationService.hasChapterFinished()}),r.readingSubject.next({...r.readingSubject.value,current:r.readingSubject.value.current+50,complete:r.readingSubject.value.current>=r.readingSubject.value.duration}),r.minimumSubject.next({...r.minimumSubject.value,current:r.minimumSubject.value.current+50,complete:r.minimumSubject.value.current>=r.minimumSubject.value.duration})},50)})()}clearChapterTimers(){clearInterval(this.interval),this.audioRef=null;const i={current:0,duration:0,complete:!1};this.animationSubject.next({...i}),this.audioSubject.next({...i}),this.readingSubject.next({...i}),this.minimumSubject.next({...i})}calculateMaximumRemainingTime(){return[{...this.audioSubject.getValue(),type:"audio"},{...this.animationSubject.getValue(),type:"animation"},{...this.readingSubject.getValue(),type:"reading"},{...this.minimumSubject.getValue(),type:"minimum"}].reduce((i,s)=>(s.complete||(("audio"===s.type||"animation"===s.type)&&(s={...s,current:1e3*s.current,duration:1e3*s.duration}),s.duration-s.current>i.duration-i.current&&(i={...s})),i),{complete:!0,current:0,duration:0})}calculateChapterReadingTime(i){return 1e3*Math.floor((i.description??"").split(" ").length/200*60)}preloadAudio(i,s=!1){var r=this;return(0,Ct.A)(function*(){const a=r.store.selectSnapshot(_e.getViewLanguage);for(const d of i)yield r.mediaService.getChapterAudioPlayer(d,a,s)})()}startCountdown(){this.clearCountdown(),this.countdownStatus.next("active");let{countdown:i}=this.store.selectSnapshot(_e.getPlaythroughSettings);this.countdownInterval=setInterval(()=>{i-=50,this.countdownChanged.next(i),i<=0&&(this.countdownComplete.next(),this.clearCountdown())},50)}delayCountdown(){const{countdownDelay:i}=this.store.selectSnapshot(_e.getPlaythroughSettings);this.countdownInterval&&(this.clearCountdown(),clearTimeout(this.countdownDelay),this.countdownStatus.next("delay"),this.countdownDelay=setTimeout(()=>{this.startCountdown()},i))}clearCountdown(){const{countdown:i}=this.store.selectSnapshot(_e.getPlaythroughSettings);clearInterval(this.countdownInterval),clearTimeout(this.countdownDelay),this.countdownChanged.next(i),this.countdownStatus.next("inactive")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(Ci),e.KVO(zi.O),e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Qf=_(82529);const TC=["viewButton"],OC=["app-view-button",""],MC=["*"];var Xc=function(n){return n.Rounded="rounded",n.Square="square",n.Narrow="narrow",n.Squat="squat",n}(Xc||{}),Ao=function(n){return n.Default="default",n.Fill="fill",n.Small="small",n.XSmall="xsmall",n.XXSmall="2xsmall",n}(Ao||{});const IC={transparent:{background:"transparent",color:"inherit",border:"transparent",borderWidth:"0"},"transparent-fill":{background:"transparent",color:"#374A68",border:"transparent"},"blue-fill":{background:"#2d72dc",color:"#ffffff",border:"transparent",focusBorder:"#1C2A3F"},"red-fill":{background:"#f44336",color:"#ffffff",border:"transparent"},"dark-gray-fill":{background:"#283853",color:"#ffffff",border:"transparent",disabledColor:"#374a68"},"light-gray-fill":{background:"#eaeff5",color:"#374a68",border:"transparent",disabledColor:"#d7e0ea"},"white-outline":{background:"transparent",color:"#ffffff",border:"#ffffff",borderWidth:"1px"},white:{background:"transparent",color:"#ffffff",border:"transparent"},"light-gray-outline":{background:"transparent",color:"#000000",border:"#d7e0ea",borderWidth:"1px"}};let rn=(()=>{var n;class t{constructor(i,s){this.tabindex=i,this.hostElement=s,this.selected=!1,this.thin=!1,this.short=!1,this.buttonSize=Ao.Default,this.buttonShape=Xc.Square,this.addFocusStyle=!1,this.buttonTheme="transparent-fill",this.hasFocus=!1}ngOnInit(){this.styleButton()}ngOnChanges(){this.styleButton()}get attrAriaDisabled(){return this.disabled}onFocus(){this.hasFocus=!0,this.styleButton()}onBlur(){this.hasFocus=!1,this.styleButton()}styleButton(){const i=this.viewButton.nativeElement.style,s=IC[this.buttonTheme??"transparent-fill"];switch(i.setProperty("border-color",s.border||"transparent"),i.setProperty("border-width",s.borderWidth||"2px"),i.setProperty("background-color",s.background),i.setProperty("color",s.color),(this.hasFocus||this.addFocusStyle)&&i.setProperty("border-color",s.focusBorder||"#2d72dc"),this.buttonShape){case Xc.Rounded:i.setProperty("border-radius","4px");break;case Xc.Square:i.setProperty("border-radius","0")}switch(this.buttonSize){case Ao.XXSmall:i.setProperty("min-height","28px"),i.setProperty("min-width","28px");break;case Ao.XSmall:i.setProperty("min-height","32px"),i.setProperty("min-width","32px");break;case Ao.Small:i.setProperty("min-height","40px"),i.setProperty("min-width","40px");break;case Ao.Fill:i.setProperty("min-height","100%"),i.setProperty("min-width","100%");break;default:i.setProperty("min-height","48px"),i.setProperty("min-width","48px")}this.thin&&i.setProperty("min-width","28px"),this.short&&i.setProperty("min-height","28px"),this.disabled&&i.setProperty("color",s.disabledColor||"#d7e0ea")}focus(){this.hostElement.nativeElement.focus()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.kS0("tabindex"),e.rXU(e.aKT))},n.\u0275cmp=e.VBU({type:n,selectors:[["button","app-view-button",""]],viewQuery:function(i,s){if(1&i&&e.GBs(TC,7),2&i){let r;e.mGM(r=e.lsd())&&(s.viewButton=r.first)}},hostVars:2,hostBindings:function(i,s){1&i&&e.bIt("focus",function(){return s.onFocus()})("blur",function(){return s.onBlur()}),2&i&&(e.Mr5("disabled",s.disabled),e.BMQ("aria-disabled",s.attrAriaDisabled))},inputs:{disabled:"disabled",selected:"selected",thin:"thin",short:"short",buttonSize:"buttonSize",buttonShape:"buttonShape",addFocusStyle:"addFocusStyle",buttonTheme:"buttonTheme"},features:[e.OA$],attrs:OC,ngContentSelectors:MC,decls:4,vars:0,consts:[["viewButton",""],[1,"view-button"],[1,"view-button__content"]],template:function(i,s){1&i&&(e.NAR(),e.j41(0,"div",1,0)(2,"span",2),e.SdG(3),e.k0s()())},styles:['button[app-view-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all;position:relative;font-size:14px}button[app-view-button]::-moz-focus-inner{border:0}button[app-view-button]:not(:disabled):hover{cursor:pointer}button[app-view-button]:hover:not(:disabled):after{content:" ";pointer-events:none;position:absolute;inset:0;background-color:#0000000d}button[app-view-button]:disabled .view-button{color:#61779e}.view-button{--background-color: transparent;--color: $gray-20;--border-color: transparent;--border-radius: 0;--border-width: 2px;--min-width: 48px;--min-height: 48px;background:var(--background-color);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);color:var(--color);display:flex;align-items:center;justify-content:center;-webkit-user-select:none;user-select:none;pointer-events:none;min-width:var(--min-width);min-height:var(--min-height);height:100%;width:100%;transition:background-color .15s ease-out,border-color .15s ease-out,color .15s ease-out}.view-button--focus{--border-color: #2d72dc !important}.view-button__content{width:100%;transition:all .15s ease-out}\n'],encapsulation:2,changeDetection:0}),t})();var La;function AC(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleAction("takeQuiz"))}),e.pXf(1,2),e.k0s()}}class Zp{constructor(t){this.dialogRef=t}ngOnInit(){}handleAction(t){this.dialogRef.close(t)}}(La=Zp).\u0275fac=function(t){return new(t||La)(e.rXU(Qf.ce))},La.\u0275cmp=e.VBU({type:La,selectors:[["app-view-playthrough-modal"]],decls:10,vars:3,consts:()=>{let n,t,o;return n=$localize`:1cbfa5d1bd6e6c717ce755355bc69d490bacec684369858959634679447:${"\ufffd#4\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#4\ufffd"}:CLOSE_TAG_APP_ICON: Explore on Your Own `,t=$localize`:1a4ef7deae63552688d7b8d2aa530d0ed9addf038508351863775798459:${"\ufffd#9\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#9\ufffd"}:CLOSE_TAG_APP_ICON: Play Again `,o=$localize`:3453239ade2e7a669baf13d6322db6a7dcc276882019708727875402043: Take Quiz `,[n,t,o,[1,"view-playthrough-modal"],[1,"view-playthrough-modal__buttons"],["app-view-button","","buttonTheme","blue-fill","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","arrow-pointer","aria-hidden","true"],["app-view-button","","class","view-playthrough-modal__button","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",3,"click",4,"ngIf"],["app-view-button","","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","rotate-left","aria-hidden","true"]]},template:function(t,o){1&t&&(e.j41(0,"div",3)(1,"div",4)(2,"button",5),e.bIt("click",function(){return o.handleAction("explore")}),e.PLo(3,0),e.nrm(4,"app-icon",6),e.YFu(),e.k0s(),e.DNE(5,AC,2,0,"button",7),e.nI1(6,"async"),e.j41(7,"button",8),e.bIt("click",function(){return o.handleAction("playAgain")}),e.PLo(8,1),e.nrm(9,"app-icon",9),e.YFu(),e.k0s()()()),2&t&&(e.R7$(5),e.Y8G("ngIf",e.bMT(6,1,o.hasQuiz$)))},dependencies:[rn,q.bT,yt.R,q.Jj],styles:["[_nghost-%COMP%]{display:flex;background:#1018238c;width:100%;height:100%;justify-content:center;align-items:center;transition:background .3 ease-out}.view-playthrough-modal__button[_ngcontent-%COMP%]{width:280px}.view-playthrough-modal__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ue.j.hasQuiz),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Zp.prototype,"hasQuiz$",void 0);var Ir,Hc=_(90908),Ua=_(94909),ja=_(1102),Va=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},xa=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class No{constructor(t,o,i){this.store=t,this.sceneService=o,this.paintService=i,this.nodeChapterOpacities={}}initObservables(){this.nodesLayerIndex=0,this.objectsLayerIndex=0,this.nodeChapterOpacities={},this.destroyObservables(),this.ngUnsubscribe=new Q.B,(0,Ht.z)([this.selectedChapterId$,this.selectedEngineChapterId$]).pipe((0,S.p)(([t,o])=>t&&(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.updateNodeChapterOpacities(t)}),this.selectedChapterCurrentLayers$.pipe((0,Ua.E)(this.selectedChapterCurrentLayersIndex$),(0,b.Q)(this.ngUnsubscribe)).subscribe(([,t])=>{this.nodesLayerIndex=this.objectsLayerIndex=t}),(0,Ht.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)&&!(0,m.isNil)(o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{this.syncLayersToScene(i,t,o,!0)})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayersToState(t,o,i){this.store.dispatch(new En.WZ(t,o,i,!0))}syncLayersToScene(t,o,i,s){this.updateLayerIndex(o,t,s),this.updateLayerPosition(i,t,s)}fractionToIndex(t,o){const i=this.getThreshold(t),s=Math.floor(o/i);return Math.max(0,Math.min(t.length-2,s))}fractionToPosition(t,o,i){const s=this.getThreshold(t);return Math.max(0,Math.min((o-s*i)/s,1))}indexPositionToFraction(t,o,i){const s=this.getThreshold(t);return o*s+i*s}fractionToPercent(t){return Math.round(100*(1-t))}percentToFraction(t){return 1-t/100}getThreshold(t){return t.length>1?1/(t.length-1):1}getCurrentLayerIndexProp(t){return t?"nodesLayerIndex":"objectsLayerIndex"}updateLayerIndex(t,o,i){const s=this.getCurrentLayerIndexProp(i);t!==this[s]&&(this.restoreLayers(t,this[s],o,i),i&&(this.nodesLayerIndex=t),this.objectsLayerIndex=t)}updateLayerPosition(t,o,i){const s=this.getCurrentLayerIndexProp(i),r=o[this[s]]?.objectIds;r?.length>0&&this.setObjectsOpacity(r,1-t)}restoreLayers(t,o,i,s){const a=(t-o)/Math.abs(t-o);let d=[],f=o;for(;f!==t;)d=d.concat(i[f].objectIds),f+=a;const L=-1===a;this.setObjectsOpacity(d,1===a?0:1),s?this.setNodesShown(d,L):this.setObjectsShown(d,L),-1===a&&(s?this.setNodesShown(i[t].objectIds,!0):this.setObjectsShown(i[t].objectIds,!0))}setObjectsOpacity(t,o){t.forEach(i=>{const s=this.nodeChapterOpacities[i];let r;Array.isArray(s)?(r=s.slice(),r[0]=o*s[0],r[1]=o*s[1]):r=o*s,this.paintService.colorObject(i,{opacity:r})})}updateNodeChapterOpacities(t){const i=this.store.selectSnapshot(Mn.z.getAllNodeState)[t];this.nodeChapterOpacities={},Object.entries(i).forEach(([s,r])=>{if(this.nodeChapterOpacities[s]=1,r.paint&&Object.prototype.hasOwnProperty.call(r.paint,"opacity")){const a=(0,ja.Sf)(r.paint);!1!==a.opacity&&(this.nodeChapterOpacities[s]=a.opacity)}})}setObjectsShown(t,o){const i={};for(let s=0;s<t.length;s++)i[t[s]]=o;this.sceneService.setShownObjects({showObjects:i})}setNodesShown(t,o){this.store.dispatch(new Lt.yr(o,t,void 0,!1))}}(Ir=No).\u0275fac=function(t){return new(t||Ir)(e.KVO(l.il),e.KVO(ji.w),e.KVO(ua.s))},Ir.\u0275prov=e.jDH({token:Ir,factory:Ir.\u0275fac,providedIn:"root"}),Va([(0,l.l6)(fe.N.getSelectedChapterCurrentLayers),xa("design:type",y.c)],No.prototype,"selectedChapterCurrentLayers$",void 0),Va([(0,l.l6)(fe.N.getSelectedChapterCurrentLayersIndex),xa("design:type",y.c)],No.prototype,"selectedChapterCurrentLayersIndex$",void 0),Va([(0,l.l6)(fe.N.getSelectedChapterCurrentLayersPosition),xa("design:type",y.c)],No.prototype,"selectedChapterCurrentLayersPosition$",void 0),Va([(0,l.l6)(fe.N.getSelectedChapterId),xa("design:type",y.c)],No.prototype,"selectedChapterId$",void 0),Va([(0,l.l6)(Xe.S.getChapter),xa("design:type",y.c)],No.prototype,"selectedEngineChapterId$",void 0);var wr,eu=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},tu=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class Ls{constructor(t,o){this.store=t,this.sceneService=o}initObservables(){this.destroyObservables(),this.ngUnsubscribe=new Q.B,this.selectedChapterId$.pipe((0,S.p)(t=>!(0,m.isNil)(t)),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.listenForCurrentLayerGroupsChanges()})}listenForCurrentLayerGroupsChanges(){const t=this.selectedChapterId$.pipe((0,ce.i)(1),(0,tn.s)(1));this.currentLayerGroups$.pipe((0,S.p)(o=>!(0,m.isNil)(o)&&o.length>0),(0,ce.i)(1),(0,b.Q)(t)).subscribe(o=>{const i=this.getObjectVisibilityFromGroups(o);this.store.dispatch(new Lt.yr(!1,[],i,!1))})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayerGroupsToScene(t){const o=this.getObjectVisibilityFromGroups(t);this.sceneService.setShownObjects({showObjects:o})}syncLayerGroupsToState(t,o,i){this.store.dispatch(new En.$V(t,o,i))}computeGroupPositionsByFraction(t,o){const s=t.map(d=>d.layers).flat().length,r=Math.round(s*(0,m.clamp)(o,0,1));let a=s;for(let d=0;d<t.length;d++){const f=t[d];f.position=0;for(let T=f.layers.length,L=T-1,ee=T;L>=0;L--,ee--,a--)a<=r&&0===f.position&&(f.position=ee)}return t}getObjectVisibilityFromGroups(t){const o={};return t.forEach(({layers:i,position:s})=>{const r=i.length-s;i.forEach((a,d)=>{const{objectIds:f}=a,T=r<=d;f.forEach(L=>o[L]=T)})}),o}}(wr=Ls).\u0275fac=function(t){return new(t||wr)(e.KVO(l.il),e.KVO(ji.w))},wr.\u0275prov=e.jDH({token:wr,factory:wr.\u0275fac,providedIn:"root"}),eu([(0,l.l6)(fe.N.getSelectedChapterId),tu("design:type",y.c)],Ls.prototype,"selectedChapterId$",void 0),eu([(0,l.l6)(fe.N.getSelectedChapterLayerGroups),tu("design:type",y.c)],Ls.prototype,"currentLayerGroups$",void 0),eu([(0,l.l6)(Be.getUIEntry(G.VisibilityLayers)),tu("design:type",y.c)],Ls.prototype,"visibilityLayersUI$",void 0);var NC=_(20339),Yf=_(22959),nu=_(59369);let Us=(()=>{var n;class t{onEnter(){this.store.dispatch(new D.SetPreventFadeoutEvent("mouseenter",!0))}onLeave(){this.store.dispatch(new D.SetPreventFadeoutEvent("mouseenter",!1))}onFocusin(){this.store.dispatch(new D.SetPreventFadeoutEvent("focusin",!0))}onFocusout(){this.store.dispatch(new D.SetPreventFadeoutEvent("focusin",!1))}constructor(i){this.store=i}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275dir=e.FsC({type:n,selectors:[["","appPreventFadeout",""]],hostBindings:function(i,s){1&i&&e.bIt("mouseenter",function(){return s.onEnter()})("mouseleave",function(){return s.onLeave()})("focusin",function(){return s.onFocusin()})("focusout",function(){return s.onFocusout()})}}),t})();var $i=_(49989),RC=_(83609),Kf=_(2094),DC=_(57021);function iu(n,t){return n.dispatch(new st._y(!1)),t.fireEvent(gt.X.SceneXrayDisabled),!0}var Yn=_(28931);class kC{constructor(t,o){this.store=t,this.particleSystemsService=o,this.ngUnsubscribe=new Q.B,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const t=this.store.select(Go.B.getParticleSystems),o=this.store.select(Go.B.getVisisbleParticleSystems);(0,Ht.z)([t,o]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const s=this.store.selectSnapshot(fe.N.getSelectedChapterId),r=this.store.selectSnapshot(Go.B.getVisibleParticleSystemsForChapter(s));this.particleSystemsService.setEngineParticles(i,s,r)})}}const ou={type:m_.Cube,direction:f_.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},LC=[jn.ShapeBounce,jn.ShapeKill,jn.ShapeStop],Jf={[jn.LifetimeKill]:{type:jn.LifetimeKill},[jn.LifetimeStop]:{type:jn.LifetimeStop},[jn.PathKill]:{type:jn.PathKill},[jn.PathStop]:{type:jn.PathStop},[jn.PathRadius]:{type:jn.PathRadius},[jn.ShapeBounce]:{type:jn.ShapeBounce,trap:!1,shape:{...ou}},[jn.ShapeKill]:{type:jn.ShapeKill,trap:!1,shape:{...ou}},[jn.ShapeStop]:{type:jn.ShapeStop,trap:!1,shape:{...ou}}},Qc={[Xt.DirectionalVelocity]:{type:Xt.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[Xt.Lifetime]:{type:Xt.Lifetime,average:2.5,variance:1},[Xt.PointPosition]:{type:Xt.PointPosition,position:[0,0,0]},[Xt.RandomVelocity]:{type:Xt.RandomVelocity,forceAverage:5,forceVariance:0},[Xt.SpherePosition]:{type:Xt.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Xt.CylinderPosition]:{type:Xt.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Xt.CubePosition]:{type:Xt.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Xt.RandomRotation]:{type:Xt.RandomRotation,average:0,variance:0},[Xt.RandomRotationSpeed]:{type:Xt.RandomRotationSpeed,average:0,variance:180},[Xt.RandomScale]:{type:Xt.RandomScale,average:1,variance:0},[Xt.SpriteAnimationDuration]:{type:Xt.SpriteAnimationDuration,average:1,variance:0}},su={[ln.AgeColorBlend]:{type:ln.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[ln.BrownianMotion]:{type:ln.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[ln.UniformForce]:{type:ln.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[ln.RadialForce]:{type:ln.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[ln.Friction]:{type:ln.Friction,friction:.1},[ln.Gravity]:{type:ln.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[ln.Path]:{type:ln.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[ln.AxisForce]:{type:ln.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[ln.SpriteAnimation]:{type:ln.SpriteAnimation}},qf={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},constraints:[Jf[jn.LifetimeKill]],creators:[Qc[Xt.PointPosition],Qc[Xt.RandomVelocity],Qc[Xt.Lifetime]],updaters:[su[ln.AgeColorBlend],su[ln.Friction]]};function Zf(){const n=JSON.parse(JSON.stringify(qf)),{constraints:t,creators:o,updaters:i}=n;return{...n,constraints:t.map((s,r)=>({...s,id:vi.u.idWithPrefix("constraint")})),creators:o.map((s,r)=>({...s,id:vi.u.idWithPrefix("creator")})),updaters:i.map((s,r)=>({...s,id:vi.u.idWithPrefix("updater")}))}}function ru(n){return{...Jf[n]}}function au(n){return{...Qc[n]}}function lu(n){return{...su[n]}}function Yc(n){return(0,m.omitBy)(n,m.isNil)}function BC(n,t){return Yc(function FC(n,t){const{id:o,name:i,shape:s,trap:r}=t;return LC.includes(n)?{id:o,name:i,type:n,trap:r,shape:s}:{id:o,name:i,type:n}}(n,t))}function zC(n,t){return Yc(function GC(n,t){const{id:o,name:i,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:d,average:f,variance:T,position:L,scale:ee,rotate:re,translate:ve}=t;switch(n){case Xt.DirectionalVelocity:return{id:o,name:i,type:n,directionAverage:s,forceAverage:r,directionVariance:a,forceVariance:d};case Xt.Lifetime:return{id:o,name:i,type:n,average:f,variance:T};case Xt.PointPosition:return{id:o,name:i,type:n,position:L};case Xt.RandomVelocity:return{id:o,name:i,type:n,forceAverage:r,forceVariance:d};case Xt.SpherePosition:case Xt.CylinderPosition:case Xt.CubePosition:return{id:o,name:i,type:n,scale:ee,rotate:re,translate:ve};case Xt.RandomRotation:case Xt.RandomRotationSpeed:case Xt.RandomScale:case Xt.SpriteAnimationDuration:return{id:o,name:i,type:n,average:f,variance:T};default:return}}(n,t))}function WC(n,t){return Yc(function $C(n,t){const{id:o,name:i,colors:s,position:r,direction:a,friction:d,frequency:f,forceAverage:T,radius:L,forceVariance:ee,nodes:re,shape:ve,directionAverage:Oe,directionVariance:Ee}=t;switch(n){case ln.AgeColorBlend:return{id:o,name:i,type:n,colors:s,shape:ve};case ln.BrownianMotion:return{id:o,name:i,type:n,frequency:f,forceAverage:T,forceVariance:ee,shape:ve};case ln.UniformForce:return{id:o,name:i,type:n,directionAverage:Oe,forceAverage:T,directionVariance:Ee,forceVariance:ee,shape:ve};case ln.RadialForce:return{id:o,name:i,type:n,position:r,forceAverage:T,forceVariance:ee,shape:ve};case ln.Friction:return{id:o,name:i,type:n,friction:d,shape:ve};case ln.Gravity:return{id:o,name:i,type:n,position:r,radius:L,forceAverage:T,forceVariance:ee,shape:ve};case ln.Path:return{id:o,name:i,type:n,nodes:re,shape:ve};case ln.AxisForce:return{id:o,name:i,type:n,position:r,direction:a,forceAverage:T,forceVariance:ee,shape:ve};case ln.SpriteAnimation:return{id:o,name:i,type:n};default:return}}(n,t))}let XC=(()=>{var n;class t{constructor(i,s){this.engineService=i,this.store=s}createParticleSystem(i){const s={...Zf(),id:vi.u.idWithPrefix("system")};this.store.dispatch(new pn.u.NewParticleSystem(s,i))}duplicateParticleSystem(i,s){this.store.dispatch(new pn.u.DuplicateParticleSystem(i,s))}resetParticleSystem(i){const s={...Zf(),id:i};this.store.dispatch(new pn.u.UpdateParticleSystem(i,s))}toggleParticleSystemVisible(i,s){const r=this.isParticleSystemVisible(i,s);this.store.dispatch(new pn.u.SetParticleSystemVisible(i,!r,s))}isParticleSystemVisible(i,s){return this.store.selectSnapshot(Go.B.getVisibleParticleSystemsForChapter(s)).includes(i)}addChapterParticleSystem(i,s){this.store.dispatch(new pn.u.AssignParticle(i,s))}removeChapterParticleSystem(i,s){this.store.dispatch(new pn.u.UnassignParticle(i,s))}removeAllChapterParticleSystem(i){this.store.selectSnapshot(Go.B.particleSystemsForChapter(i)).forEach(r=>{this.removeChapterParticleSystem(r.id,i)})}createNewConstraint(i,s){const{id:r,constraints:a}=i;this.store.dispatch(new pn.u.UpdateParticleSystem(r,{...i,constraints:[...a,{...ru(s),id:vi.u.idWithPrefix("constraint")}]}))}duplicateConstraint(i,s){i.constraints=[...i.constraints,{...BC(s.type,s),id:vi.u.idWithPrefix("constraint")}],this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleConstraint(i.constraints.length-1))}resetConstraint(i,s){const r=i.constraints[s],{id:a,type:d}=r;i.constraints[s]={...ru(d),id:a},this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}resetConstraints(i){i.constraints=i.constraints.map(s=>{const{id:r,type:a}=s;return{...ru(a),id:r}}),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}removeConstraint(i,s){i.constraints.splice(s,1),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleConstraint(-1))}createNewCreator(i,s){const{id:r,creators:a}=i;this.store.dispatch(new pn.u.UpdateParticleSystem(r,{...i,creators:[...a,{...au(s),id:vi.u.idWithPrefix("creator")}]}))}duplicateCreator(i,s){i.creators=[...i.creators,{...zC(s.type,s),id:vi.u.idWithPrefix("creator")}],this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleCreator(i.creators.length-1))}resetCreator(i,s){const r=i.creators[s],{id:a,type:d}=r;i.creators[s]={...au(d),id:a},this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}resetCreators(i){i.creators=i.creators.map(s=>{const{id:r,type:a}=s;return{...au(a),id:r}}),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}removeCreator(i,s){i.creators.splice(s,1),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleConstraint(-1))}createNewUpdater(i,s){const{id:r,updaters:a}=i;this.store.dispatch(new pn.u.UpdateParticleSystem(r,{...i,updaters:[...a,{...lu(s),id:vi.u.idWithPrefix("updater")}]}))}duplicateUpdater(i,s){i.updaters=[...i.updaters,{...WC(s.type,s),id:vi.u.idWithPrefix("updater")}],this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleUpdater(i.updaters.length-1))}resetUpdater(i,s){const r=i.updaters[s],{id:a,type:d}=r;i.updaters[s]={...lu(d),id:a},this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}resetUpdaters(i){i.updaters=i.updaters.map(s=>{const{id:r,type:a}=s;return{...lu(a),id:r}}),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i))}removeUpdater(i,s){i.updaters.splice(s,1),this.store.dispatch(new pn.u.UpdateParticleSystem(i.id,i)),this.store.dispatch(new pn.u.SelectParticleConstraint(-1))}setEngineParticles(i,s,r){const a=this.engineService.engine?.story,d=a?.chapters?.find(f=>f.id===s);(0,m.isNil)(d)||(a.particleSystemDefs.forEach((f,T)=>{(0,m.isNil)(i[T])&&a.particleSystemDefs.delete(T)}),Object.entries(i).forEach(([f,T])=>{const L=a.particleSystemDefs.get(f);((0,m.isNil)(L)||!(0,m.isEqual)(L,T))&&a.particleSystemDefs.set(f,T)}),d.particleSystemIds.forEach(f=>{r.includes(f)||d.particleSystemIds.delete(f)}),r.forEach(f=>{d.particleSystemIds.has(f)||d.particleSystemIds.add(f)}))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(u.y),e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Fa=_(46799);let Kc=(()=>{class t{constructor(i){this.currentVideo=i}}return t.type="[Story Video] Set current video",t})();var js,cu=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Vs=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};let Pr=((js=class{static getCurrentVideo(t){return t.currentVideo}SetCurrentVideo(t,o){t.patchState(Nn.jM(t.getState(),i=>{const s=i.currentVideo;i.currentVideo=o.currentVideo;const r=this.mediaService.getVideoPlayer(s);r&&r.pause()}))}constructor(t){this.mediaService=t}}).\u0275fac=function(t){return new(t||js)(e.KVO(Ci))},js.\u0275prov=e.jDH({token:js,factory:js.\u0275fac}),js);cu([(0,l.rc)(Kc),Vs("design:type",Function),Vs("design:paramtypes",[Object,Kc]),Vs("design:returntype",void 0)],Pr.prototype,"SetCurrentVideo",null),cu([(0,l.MD)(),Vs("design:type",Function),Vs("design:paramtypes",[Object]),Vs("design:returntype",void 0)],Pr,"getCurrentVideo",null),Pr=cu([(0,l.Uw)({name:"storyVideo",defaults:{currentVideo:null}}),Vs("design:paramtypes",[Ci])],Pr);var ai,YC=_(9556);!function(n){n.SetEnabled=(()=>{class d{constructor(T){this.enabled=T}}return d.type="[XR] Set XR Enabled",d})(),n.SetSession=(()=>{class d{constructor(T,L,ee,re){this.active=T,this.session=L,this.sessionMode=ee,this.supportedModes=re}}return d.type="[XR] Set XR Session",d})(),n.SetXRState=(()=>{class d{constructor(T){this.value=T}}return d.type="[XR] Set XR State",d})(),n.EnterXR=(()=>{class d{constructor(T="immersive-vr"){this.sessionMode=T}}return d.type="[XR] Enter XR",d})(),n.ExitXR=(()=>{class d{constructor(T=!1){this.closeTab=T}}return d.type="[XR] Exit XR",d})()}(ai||(ai={}));const KC=[120,120,120,255].map(n=>n/255);let du=(()=>{var n;class t{constructor(i){this.store=i,this.presentingXR=null,this.xrState=new ui.t(void 0)}initXR(i){var s=this;const{renderer:r}=i,a={"immersive-ar":!1,"immersive-vr":!1},d=function(){var f=(0,Ct.A)(function*(){if(s.presentingXR){const T=s.presentingXR,L=yield s.getRefSpace(T.session,i);T===s.presentingXR&&(r.xrRefSpace=L)}});return function(){return f.apply(this,arguments)}}();if(!this._xr){const f=re=>(0,Ct.A)(function*(){const{presenting:ve,session:Oe,sessionMode:Ee,supported:Re}=re;if(Oe&&!r.xrSession){const Fe=yield s.getRefSpace(Oe,i);r.xrRefSpace=Fe,r.xrSession=Oe,Oe.addEventListener("reset",d)}ve?s.presentingXR=re:re===s.presentingXR&&(s.presentingXR=null,r.xrSession=null,r.xrRefSpace=null),ve&&"immersive-vr"===Ee?i.renderer.setXRClearColor(...KC):i.renderer.setXRClearColor(0,0,0,0),s.xrInputCollection&&(s.xrInputCollection.session=Oe),a[Ee]=Re,s.store.dispatch(new ai.SetSession(null!==s.presentingXR,Oe,s.presentingXR?.sessionMode||null,a))}),T=["local-floor","bounded-floor","hand-tracking"];r.extensions.includes("OCULUS_multiview")&&T.push("layers");const L=new Kt.XR("immersive-vr",{optionalFeatures:T}),ee=new Kt.XR("immersive-ar",{requiredFeatures:["local-floor"],optionalFeatures:["dom-overlay"],domOverlay:{root:document.getElementById("viewContainer")}});this._xr={"immersive-vr":L,"immersive-ar":ee},L.on("*",f(L)),ee.on("*",f(ee))}}destroyXR(){this._xr?.["immersive-ar"].destroy(),this._xr?.["immersive-vr"].destroy(),this._xr=null,this.presentingXR=null}enterXR(i="immersive-vr"){if(!this._xr)throw new Error("Cannot enter XR. XR service has been destroyed.");return this._xr[i].enter()}exitXR(){this.presentingXR?.exit()}initInput(i){}getRefSpace(i,s){return(0,Ct.A)(function*(){let r=null;try{r=yield i.requestReferenceSpace("bounded-floor")}catch{r=yield i.requestReferenceSpace("local-floor")}const{bounds:a,story:d}=s,{module:f}=d,T=Rn.distance(a.min,a.max),L=d.module.chapters[d.activeChapterIndex],ee=L.jumpTo||L.flyTo||f.camera,re=Kt.vec3Pool.get(),ve=Kt.vec3Pool.get(),Oe=Kt.vec3Pool.get(),Ee=Kt.vec3Pool.get(),Re=ee?.eye||f.camera?.eye;if(Re){const{x:ze,y:Je,z:dt}=Re;Rn.set(re,ze,Je,dt),Rn.scale(re,re,Kt.BIODIGITAL_SCENE_SCALE)}const Fe=ee?.look||f.camera?.look;if(Fe){const{x:ze,y:Je,z:dt}=Fe;Rn.set(ve,ze,Je,dt),Rn.scale(ve,ve,Kt.BIODIGITAL_SCENE_SCALE)}Rn.subtract(Oe,re,ve),Rn.set(Ee,Oe[0],Oe[1],0);const Ke=[0,0,0,1],it=-Math.atan2(Oe[0],Oe[2]);YC.fromEuler(Ke,0,180*it/Math.PI,0);const pt={x:Ke[0],y:Ke[1],z:Ke[2],w:Ke[3]},Mt=Math.max(.6,.6*T,Rn.length(Ee)),_n={x:0,y:Math.max(1.6-re[1],-a.min[1]),z:-Mt,w:1};Kt.vec3Pool.release(Ee),Kt.vec3Pool.release(Oe),Kt.vec3Pool.release(ve),Kt.vec3Pool.release(re);const ft=new XRRigidTransform(_n,pt);return r.getOffsetReferenceSpace(ft)})()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var xs,Ri=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Qt=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};let Ln=((xs=class{constructor(t,o){this.xrService=t,this.storageService=o}ngxsOnInit(t){t.patchState({enabled:"true"===this.storageService.getLocalItem(zt.UT.XREnabled)})}static getXREnabled(t){return t.enabled}static getXRActive(t){return t.active}static getXROverlayType(t){return t.session?.domOverlayState?.type||""}static getXRSessionMode(t){return t.sessionMode||""}static getXRSupportedModes(t){return t.supportedModes||{"immersive-ar":!1,"immersive-vr":!1}}static getXRError(t){return!0===t.error}static getXRRequesting(t){return t.requesting}setXRState(t,o){t.setState(o.value)}setEnabled(t,o){t.patchState({enabled:o.enabled}),this.storageService.setLocalItem(zt.UT.XREnabled,o.enabled)}enterXR(t,o){t.patchState({requesting:!0}),this.xrService.enterXR(o.sessionMode).then(()=>{console.log("Enter XR Success"),t.patchState({error:!1})}).catch(i=>{console.warn("Enter XR Fail",i),t.patchState({error:!0})}).finally(()=>{t.patchState({requesting:!1})})}exitXR(t,{closeTab:o}){this.xrService.exitXR(),o&&window.close(),console.log("Exit XR Success")}setSession(t,o){t.patchState({active:o.active,session:o.session,sessionMode:o.sessionMode,supportedModes:o.supportedModes,error:!1})}}).\u0275fac=function(t){return new(t||xs)(e.KVO(du),e.KVO(zt.n$))},xs.\u0275prov=e.jDH({token:xs,factory:xs.\u0275fac}),xs);Ri([(0,l.rc)(ai.SetXRState),Qt("design:type",Function),Qt("design:paramtypes",[Object,ai.SetXRState]),Qt("design:returntype",void 0)],Ln.prototype,"setXRState",null),Ri([(0,l.rc)(ai.SetEnabled),Qt("design:type",Function),Qt("design:paramtypes",[Object,ai.SetEnabled]),Qt("design:returntype",void 0)],Ln.prototype,"setEnabled",null),Ri([(0,l.rc)(ai.EnterXR),Qt("design:type",Function),Qt("design:paramtypes",[Object,ai.EnterXR]),Qt("design:returntype",void 0)],Ln.prototype,"enterXR",null),Ri([(0,l.rc)(ai.ExitXR),Qt("design:type",Function),Qt("design:paramtypes",[Object,ai.ExitXR]),Qt("design:returntype",void 0)],Ln.prototype,"exitXR",null),Ri([(0,l.rc)(ai.SetSession),Qt("design:type",Function),Qt("design:paramtypes",[Object,ai.SetSession]),Qt("design:returntype",void 0)],Ln.prototype,"setSession",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXREnabled",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXRActive",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXROverlayType",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXRSessionMode",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXRSupportedModes",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXRError",null),Ri([(0,l.MD)(),Qt("design:type",Function),Qt("design:paramtypes",[Object]),Qt("design:returntype",void 0)],Ln,"getXRRequesting",null),Ln=Ri([(0,l.Uw)({name:"xr",defaults:{enabled:!1,active:!1,requesting:!1,error:!1,session:null,sessionMode:"",supportedModes:{"immersive-ar":!1,"immersive-vr":!1}}}),Qt("design:paramtypes",[du,zt.n$])],Ln);var Jc=_(81391),qc=_(8358),Fs=_(76872),_u=_(49746),pu=_(1300),qo=_(28203),bi=(_(69568),_(21007));function nT(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.playAudio())}),e.nrm(1,"app-icon",10),e.k0s()}}function iT(n,t){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.JRh(o.latinLabel)}}function oT(n,t){if(1&n&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const o=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,o.description)),e.npT)}}let sT=(()=>{var n;class t{constructor(i,s,r){this.dialogRef=i,this.mediaService=s,this.data=r,this.title=r.title,this.audioPlayer=r.audioPlayer,this.latinLabel=r.latinLabel,this.description=r.description}ngOnDestroy(){this.audioPlayer&&(this.audioPlayer=null)}handleCloseClick(){this.dialogRef.close()}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(Ci),e.rXU(Dt.Vh))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-context-label-dialog"]],decls:11,vars:9,consts:[[1,"context-label-dialog","flex","flex-col"],[1,"flex","flex-row","justify-between","items-start"],[1,"flex","flex-row","items-start"],[1,"context-label-dialog__title","mt-2","mr-2",3,"innerHTML"],["class","context-label-dialog__audio","type","button","app-button","","buttonTheme","light","buttonSize","md",3,"click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"context-label-dialog__close",3,"click"],["icon","times","size","lg"],["class","context-label-dialog__latin-label mt-1",4,"ngIf"],["class","context-label-dialog__description mt-6",3,"innerHTML",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","md",1,"context-label-dialog__audio",3,"click"],["icon","volume-up","appLogicalDir",""],[1,"context-label-dialog__latin-label","mt-1"],[1,"context-label-dialog__description","mt-6",3,"innerHTML"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"div",3),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,nT,2,0,"button",4),e.k0s(),e.j41(7,"button",5),e.bIt("click",function(){return s.handleCloseClick()}),e.nrm(8,"app-icon",6),e.k0s()(),e.DNE(9,iT,2,1,"div",7)(10,oT,3,5,"div",8),e.k0s()),2&i&&(e.R7$(3),e.Y8G("innerHTML",e.bMT(5,7,e.bMT(4,5,s.title)),e.npT),e.R7$(3),e.Y8G("ngIf",s.audioPlayer),e.R7$(),e.BMQ("aria-label","Close"),e.R7$(2),e.Y8G("ngIf",s.latinLabel),e.R7$(),e.Y8G("ngIf",s.description))},dependencies:[q.bT,bi.Q,$i.e,yt.R,q.Jj,pi.i0],styles:[".context-label-dialog{height:100%;padding:24px}.context-label-dialog__title{font-weight:700;font-size:20px;word-break:break-word}.context-label-dialog__latin-label{font-style:italic;font-weight:400;font-size:14px;letter-spacing:.02em}.context-label-dialog__description{font-size:14px;line-height:20px;overflow:auto;margin-right:-24px;padding-right:24px}.context-label-dialog__description p{padding-bottom:12px}\n"],encapsulation:2}),t})();var ei=_(59115),uu=_(11789),Zc=_(25780);const rT=(n,t,o,i)=>({"label-pin--light":n,"label-pin--dark":t,"label-pin--none":o,"label-pin--selected":i}),aT=(n,t)=>({"label-pin__text--white":n,"label-pin__text--black":t});function lT(n,t){1&n&&e.nrm(0,"img",9)}function cT(n,t){1&n&&e.nrm(0,"img",9)}function dT(n,t){1&n&&e.nrm(0,"img",10)}function _T(n,t){1&n&&e.nrm(0,"img",11)}function pT(n,t){if(1&n&&(e.qex(0),e.DNE(1,lT,1,0,"img",6)(2,cT,1,0,"img",6)(3,dT,1,0,"img",7)(4,_T,1,0,"img",8),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Default||o.label.pinType===o.labelPinType.None&&o.showOnNone),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Sequential),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Plus||o.label.pinType===o.labelPinType.PlusMinus&&!o.selected),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Minus||o.label.pinType===o.labelPinType.PlusMinus&&o.selected)}}function uT(n,t){1&n&&e.nrm(0,"img",15)}function gT(n,t){1&n&&e.nrm(0,"img",15)}function hT(n,t){1&n&&e.nrm(0,"img",16)}function mT(n,t){1&n&&e.nrm(0,"img",17)}function fT(n,t){if(1&n&&e.DNE(0,uT,1,0,"img",12)(1,gT,1,0,"img",12)(2,hT,1,0,"img",13)(3,mT,1,0,"img",14),2&n){const o=e.XpG();e.Y8G("ngIf",o.label.pinType===o.labelPinType.Default||o.label.pinType===o.labelPinType.None&&o.showOnNone),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Sequential),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Plus||o.label.pinType===o.labelPinType.PlusMinus&&!o.selected),e.R7$(),e.Y8G("ngIf",o.label.pinType===o.labelPinType.Minus||o.label.pinType===o.labelPinType.PlusMinus&&o.selected)}}function ST(n,t){if(1&n&&(e.qex(0),e.j41(1,"div",18),e.EFF(2),e.k0s(),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngClass",e.l_i(2,aT,o.labelTheme===o.labelThemeEnum.StudioNext,o.labelTheme===o.labelThemeEnum.Annotation)),e.R7$(),e.SpI(" ",o.sequence," ")}}let eS=(()=>{var n;class t{constructor(){this.labelPinType=Ui.O,this.labelThemeEnum=Fs.D,this.labelTheme=Fs.D.StudioNext,this.selected=!1,this.showOnNone=!1}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-label-pin"]],inputs:{label:"label",labelTheme:"labelTheme",selected:"selected",sequence:"sequence",showOnNone:"showOnNone"},decls:7,vars:9,consts:[["pin",""],["lightPins",""],[1,"label-pin",3,"ngClass"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"label__glow"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus-dark.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg","class","label-pin__image",4,"ngIf"],["draggable","false","alt","","src","./assets/images/labels/circle.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-plus.svg",1,"label-pin__image"],["draggable","false","alt","","src","./assets/images/labels/circle-minus.svg",1,"label-pin__image"],[1,"label-pin__text",3,"ngClass"]],template:function(i,s){if(1&i&&(e.j41(0,"div",2,0),e.DNE(2,pT,5,4,"ng-container",3)(3,fT,4,4,"ng-template",null,1,e.C5r)(5,ST,3,5,"ng-container",4),e.nrm(6,"div",5),e.k0s()),2&i){const r=e.sdS(4);e.Y8G("ngClass",e.ziG(4,rT,s.labelTheme===s.labelThemeEnum.StudioNext,s.labelTheme===s.labelThemeEnum.Annotation,s.label.pinType===s.labelPinType.None&&!s.showOnNone,s.selected)),e.R7$(2),e.Y8G("ngIf",s.labelTheme===s.labelThemeEnum.Annotation)("ngIfElse",r),e.R7$(3),e.Y8G("ngIf",s.label.pinType===s.labelPinType.Sequential)}},dependencies:[q.YU,q.bT],styles:['.label-pin[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;position:relative;transition:background-color .12s;z-index:10}.label-pin__text[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;top:0;z-index:10;width:100%;height:100%;justify-content:center;align-items:center;font-size:10px!important;color:#101823}.label-pin[_ngcontent-%COMP%]:before{content:" ";background-color:transparent;border:2px solid transparent;border-radius:50%;box-sizing:border-box;display:block;position:absolute;top:0;left:0;z-index:-2;height:100%;width:100%;transition:all .15s ease-out}.label-pin--light.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label-pin--light.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#101823}.label-pin--dark.label-pin[_ngcontent-%COMP%]:before{background-color:#000000bf}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:before{background-color:#2d72dc}.label-pin--dark.label-pin--selected[_ngcontent-%COMP%]:after{background-color:#2d72dc}.label-pin--dark.label-pin[_ngcontent-%COMP%]   .label-pin__text[_ngcontent-%COMP%]{color:#fff}.label-pin--none.label-pin[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),t})();var Ga,tS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},nS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const bT=["labelContainerEl"],yT=["labelEl"],vT=["wire"],ET=["tag"],CT=["pin"],TT=["title"],OT=[[["","label-header",""]],[["","label-actions",""]],[["","label-more",""]],[["","label-body",""]]],IT=(n,t,o,i,s,r,a,d,f)=>({"label--selected":n,"label--glow":t,"label--annotation":o,"label--invert":i,"label--studio":s,"label--context":r,"label--screenshot-mode":a,"label--auto-fit":d,"label--opaque":f}),wT=n=>({"label__wire--collapse":n}),PT=(n,t,o,i)=>({"label__tag--collapse":n,"label__tag--collapsible":t,"label__tag--floating":o,"label__tag--draggable":i}),AT=n=>({"label__body--collapse":n});function NT(n,t){1&n&&(e.j41(0,"div",18),e.nrm(1,"img",19),e.k0s())}function RT(n,t){if(1&n&&(e.j41(0,"div",20),e.SdG(1,3),e.k0s()),2&n){const o=e.XpG();e.Y8G("ngClass",e.eq3(1,AT,o.isCollapsed||o.descriptionCollapsed))}}class Ar{get label(){return this._label}set label(t){const o=(0,m.isEmpty)(t),i=(0,m.isEmpty)(this.label);o&&!i?(this._label=null,this.destroyLabel()):o||(this._label={...t},this.initLabel(this.label))}set selected(t){this._selected=t}get selected(){return this._selected}constructor(t,o,i,s,r,a,d,f,T,L){this.renderer=t,this.labelsService=o,this.engineService=i,this.cameraService=s,this.engineRendererService=r,this.store=a,this.actions=d,this.changeDetection=f,this.markerService=T,this.localeId=L,this.labelPinType=Ui.O,this.labelSequentialType=ar.C,this.labelUpdated=new e.bkB,this.offsetUpdated=new e.bkB,this.pinClicked=new e.bkB,this.tagClicked=new e.bkB,this.displayUpdated=new e.bkB,this.positionUpdated=new e.bkB,this.hoverStart=new e.bkB,this.hoverEnd=new e.bkB,this.labelOffsetUpdated=new e.bkB,this.fit="fixed",this.opaque=!1,this.fixedScale=0,this.isCollapsed=!1,this.tagCollapsed=!1,this.theme="classic",this.pinDraggable=!0,this.tagDraggable=!0,this._selected=!1,this.enginePosition=null,this.isBackgroundDark=!1,this.pinDragging=!1,this.screenshotMode=!1,this.hammerManagers=[],this.displayUpdated$=new Q.B,this.positionUpdated$=new Q.B,this.ngUnsubscribe=new Q.B,this.dir=(0,bn.NS)(this.localeId).direction}ngOnInit(){this.initListeners()}ngAfterViewInit(){this.bindTagEvents(),this.bindPinEvents(),this.bindHoverEvents()}ngOnDestroy(){this.destroyLabel(),this.emitDisplayUpdated({id:this.label.id,inView:!1,shown:!1,objectShown:this.objectShown}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}destroyLabel(){this.hammerManagers.forEach(t=>t.destroy()),this.hammerManagers=[],this.deleteMarker(this.marker)}initListeners(){this.enginePosition$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.enginePosition=t}),this.engineService.getEvent(gt.X.Tick).pipe((0,S.p)(()=>!(0,m.isNil)(this.label)&&!(0,m.isNil)(this.enginePosition)),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setCanvasPos()}),this.displayUpdated$.pipe((0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.displayUpdated.next(t)}),this.positionUpdated$.pipe((0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.positionUpdated.next(t)}),this.background$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=t.colors.slice(0,3),i=t.colors.slice(4,7);this.isBackgroundDark=!uu.T.isLight(o,i),this.changeDetection.markForCheck()}),this.actions.pipe((0,l.xi)(no.V9),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!0,this.changeDetection.detectChanges()}),this.actions.pipe((0,l.rM)(no.WX),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!1,this.changeDetection.markForCheck()})}bindTagEvents(){const t=new Yn.Manager(this.tagRef.nativeElement,{domEvents:!0});t.add(new Yn.Pan({direction:Yn.DIRECTION_ALL,threshold:3})),t.add(new Yn.Tap({event:"tap"})),t.on("pan",o=>{if(!this.tagDraggable)return;o.srcEvent.stopPropagation(),this.cachedTagOffset||(this.cachedTagOffset=this.label.offset);const i=[this.cachedTagOffset[0]+o.deltaX,this.cachedTagOffset[1]+o.deltaY];this.label.offset=i,o.isFinal&&(this.cachedTagOffset=null,this.offsetUpdated.next({labelId:this.label.id,offset:i}))}),t.on("tap",o=>{o.srcEvent.preventDefault(),o.srcEvent.stopPropagation(),this.tagClicked.next(o)}),this.hammerManagers.push(t)}bindPinEvents(){const t=new Yn.Manager(this.pinRef.nativeElement);t.add(new Yn.Pan({direction:Yn.DIRECTION_ALL,threshold:4})),t.add(new Yn.Tap({event:"tap"})),t.on("pan",o=>{if(!this.pinDraggable)return;o.srcEvent.stopPropagation(),this.pinDragging=!0;let{layerX:i,layerY:s}=o.changedPointers[0];if(i-=16,s-=16,this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${i}px, ${s}px)`),o.isFinal){this.pinDragging=!1;const r={...this.label},a=this.engineRendererService.pick(i,s),d="string"==typeof a.objectId;d&&(r.dir=this.cameraService.getDirection(a),r.objectId=a.objectId,r.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],r.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],r.primitiveIndex=a.triIndex),this.labelUpdated.next({label:r,shouldPreserve:d})}}),t.on("tap",o=>{o.srcEvent.preventDefault(),o.srcEvent.stopImmediatePropagation(),this.pinClicked.next(o)}),this.hammerManagers.push(t)}bindHoverEvents(){const t=this.labelRef.nativeElement;this.renderer.listen(t,"mouseenter",()=>{this.hoverStart.next({labelId:this.label.id})}),this.renderer.listen(t,"mouseleave",()=>{this.hoverEnd.next({labelId:this.label.id})})}initLabel(t){this.initMarker(t),this.ensureObjectId(t),this.initObjectSubscription(t)}initMarker(t){this.marker&&this.deleteMarker(this.marker),this.marker=this.markerService.createMarker(t)}checkLabelDisplay(){return{id:this.label.id,shown:this.label.shown,inView:this.isOnCanvas(),objectShown:!0}}ensureObjectId(t){if(!t.objectId&&this.marker){const[o,i]=this.marker.canvasPosition,s=this.engineRendererService.pick(o,i);s.objectId&&(t.objectId=s.objectId,t.states.forEach(r=>{r.errands.forEach(a=>{a.type===xo.X.flyToObject&&(a.value=s.objectId)})}),this.labelUpdated.next({label:t,shouldPreserve:void 0}))}}initObjectSubscription(t){this.object$&&this.object$.unsubscribe(),t.objectId&&(this.object$=this.store.select(Xe.S.getViewGraphNode).pipe((0,le.T)(o=>o(t.objectId)),(0,S.p)(o=>!!o),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.objectShown=o.boolState.shown}))}deleteMarker(t){this.markerService.deleteMarker(t?.id),this.marker=null}setCanvasPos(){if(this.pinDragging||!this.marker)return void((0,m.isNil)(this.marker)&&this.setDisplay(!1));const t=this.isOccluded(),o=this.isOcclusionIgnored(),i=this.isOnCanvas(),s=t&&!o,r=void 0===this.objectShown?i&&!s:i&&this.objectShown&&!s;r!==this.shown&&(this.shown=r,this.setDisplay(r)),this.setElementPosition(),this.setElementScale(),this.setTagPosition(),this.setWirePosition();const[d,f]=this.marker.canvasPosition;this.positionUpdated$.next({positionUpdate:{id:this.label.id,canvasPos:{x:d,y:f},occluded:s},onCanvas:i})}isOcclusionIgnored(){return this.selected||!this.label.occludable}isOccluded(){return this.marker?.occluded}isOnCanvas(){if(!this.marker)return!1;const{offsetWidth:t,offsetHeight:o}=this.labelsService.getLabelContainer().nativeElement,[i,s]=this.marker.canvasPosition;return i>0&&s>0&&i<t&&s<o}setDisplay(t){this.renderer.setStyle(this.labelRef.nativeElement,"visibility",t?"visible":"hidden"),this.emitDisplayUpdated({id:this.label.id,inView:this.isOnCanvas(),shown:t,objectShown:this.objectShown})}setElementPosition(){const[t,o]=this.marker?.canvasPosition??[0,0];this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${t}px, ${o}px)`)}setElementScale(){let t;if(this.fixedScale)t=this.fixedScale;else{const i=this.store.selectSnapshot(Xe.S.getEnginePosition).width;t=i>1440?i/1440:1}const o=32*t-32;this.renderer.setStyle(this.labelRef.nativeElement,"transform-origin","top left"),this.renderer.setStyle(this.labelRef.nativeElement,"transform",`translate(-${o/2}px, -${o/2}px) scale(${t}, ${t})`)}setTagPosition(){const[t,o]=this.label.offset,i=this.tagRef.nativeElement.offsetWidth;let s;switch(s=this.label.pinType===Ui.O.None&&this.label.hideWire||t>0?"left":"right",s){case"left":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+t}px, ${o}px)`);break;case"right":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${16+t-i}px, ${o}px)`)}}setWirePosition(){let[t,o]=this.label.offset;switch(this.label.theme){case Fs.D.Annotation:case Fs.D.Classic:o+=this.titleRef.nativeElement.offsetHeight-16-2}const i=Math.sqrt(t*t+o*o);this.renderer.setStyle(this.wireRef.nativeElement,"width",`${i}px`),this.renderer.setStyle(this.wireRef.nativeElement,"transform",`rotate(${Math.atan2(o,t)}rad)`)}emitDisplayUpdated(t){this.label.id!==_c&&(null==t.inView||null==t.shown||this.displayUpdated$.next(t))}}(Ga=Ar).\u0275fac=function(t){return new(t||Ga)(e.rXU(e.sFG),e.rXU(qc.x),e.rXU(u.y),e.rXU(co.j),e.rXU(Fa.z),e.rXU(l.il),e.rXU(l.En),e.rXU(e.gRc),e.rXU(pa),e.rXU(e.xe9))},Ga.\u0275cmp=e.VBU({type:Ga,selectors:[["app-generic-label"]],viewQuery:function(t,o){if(1&t&&(e.GBs(bT,7),e.GBs(yT,7),e.GBs(vT,7),e.GBs(ET,7),e.GBs(CT,7),e.GBs(TT,7)),2&t){let i;e.mGM(i=e.lsd())&&(o.labelContainerRef=i.first),e.mGM(i=e.lsd())&&(o.labelRef=i.first),e.mGM(i=e.lsd())&&(o.wireRef=i.first),e.mGM(i=e.lsd())&&(o.tagRef=i.first),e.mGM(i=e.lsd())&&(o.pinRef=i.first),e.mGM(i=e.lsd())&&(o.titleRef=i.first)}},hostVars:2,hostBindings:function(t,o){2&t&&e.AVh("selected",o.selected)},inputs:{fit:"fit",opaque:"opaque",fixedScale:"fixedScale",sequence:"sequence",hasContent:"hasContent",label:"label",isCollapsed:"isCollapsed",descriptionCollapsed:"descriptionCollapsed",tagCollapsed:"tagCollapsed",selected:"selected",theme:"theme",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},outputs:{labelUpdated:"labelUpdated",offsetUpdated:"offsetUpdated",pinClicked:"pinClicked",tagClicked:"tagClicked",displayUpdated:"displayUpdated",positionUpdated:"positionUpdated",hoverStart:"hoverStart",hoverEnd:"hoverEnd",labelOffsetUpdated:"labelOffsetUpdated"},ngContentSelectors:["[label-header]","[label-actions]","[label-more]","[label-body]"],decls:21,vars:27,consts:[["labelContainerEl",""],["labelEl",""],["pin",""],["wire",""],["tag",""],["title",""],["data-test","labelContainer",1,"label-container"],["data-test","labelElement",1,"label",3,"ngClass"],[1,"label__pin"],[3,"label","labelTheme","selected","sequence"],[1,"label__glow"],[1,"label__wire",3,"ngClass"],["aria-hidden","true",1,"label__tag",3,"dir","ngClass"],[1,"label__header"],["data-test","labelTitle",1,"label__title"],["class","label__more","appLogicalDir","",4,"ngIf"],["appEventFence","",1,"label__actions"],["class","label__body",3,"ngClass",4,"ngIf"],["appLogicalDir","",1,"label__more"],["src","./assets/images/labels/caret-right.svg"],[1,"label__body",3,"ngClass"]],template:function(t,o){1&t&&(e.NAR(OT),e.j41(0,"div",6,0)(2,"div",7,1)(4,"div",8,2),e.nrm(6,"app-label-pin",9)(7,"div",10),e.k0s(),e.nrm(8,"div",11,3),e.j41(10,"div",12,4)(12,"div",13)(13,"div",14,5),e.SdG(15),e.k0s(),e.DNE(16,NT,2,0,"div",15),e.j41(17,"div",16),e.SdG(18,1),e.k0s()(),e.DNE(19,RT,2,3,"div",17),e.SdG(20,2),e.k0s()()()),2&t&&(e.R7$(2),e.Y8G("ngClass",e.zJS(10,IT,[o.selected,o.label.pinGlow,"annotation"===o.label.theme||"classic"===o.label.theme,o.isBackgroundDark,"studioNext"===o.label.theme,"context"===o.label.theme,o.screenshotMode,"auto"===o.fit,o.opaque])),e.R7$(4),e.Y8G("label",o.label)("labelTheme",o.label.theme)("selected",o.selected)("sequence",o.sequence),e.R7$(2),e.Y8G("ngClass",e.eq3(20,wT,o.isCollapsed||o.tagCollapsed||o.label.hideWire)),e.R7$(2),e.Y8G("dir",o.dir)("ngClass",e.ziG(22,PT,o.isCollapsed||o.tagCollapsed,o.label.collapseDescription,o.label.hideWire,o.tagDraggable)),e.R7$(6),e.Y8G("ngIf",o.hasContent&&o.label.collapseDescription),e.R7$(3),e.Y8G("ngIf",o.hasContent))},dependencies:[q.YU,q.bT,Zc.L,$i.e,qo.ig,eS],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{opacity:1;display:block}}@keyframes _ngcontent-%COMP%_fadeOut{0%{display:block;opacity:1}99%{opacity:0}to{opacity:0;display:none}}@keyframes _ngcontent-%COMP%_glow{0%{box-shadow:0 0 #ffffff80}50%{box-shadow:0 0 8px 2px #ffffff80}to{box-shadow:0 0 #ffffff80}}@keyframes _ngcontent-%COMP%_classic-glow{0%{transform:scale(.5)}10%{transform:scale(.5)}50%{transform:scale(1)}90%{transform:scale(.5)}to{transform:scale(.5)}}[_nghost-%COMP%], .label-container[_ngcontent-%COMP%]{display:block;position:absolute;z-index:10;width:200px;pointer-events:all;pointer-events:none}[_nghost-%COMP%]:hover, .label-container[_ngcontent-%COMP%]:hover{z-index:12}.selected[_nghost-%COMP%]{z-index:11}.label-container[_ngcontent-%COMP%]{left:-16px;top:-16px}.label[_ngcontent-%COMP%]{display:block;overflow:visible;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;height:32px}.label--screenshot-mode[_ngcontent-%COMP%]{text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:before, .label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:after{box-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{box-shadow:none!important;text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:none!important}.label--auto-fit[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:max-content;padding:0!important}.label--auto-fit[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding:0!important}.label__glow[_ngcontent-%COMP%]{display:none;position:absolute;width:32px;height:32px;border-radius:50%;z-index:0;top:0;left:0}.label--selected[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{transform:rotate(45deg)}.label__more[_ngcontent-%COMP%]{color:#374a68;display:none;flex:0 0 16px;height:16px;align-items:center;justify-content:center;transition:transform .15s ease-in-out}.label__pin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%;position:absolute;pointer-events:all;transition:background-color .12s;z-index:10}.label__pin[_ngcontent-%COMP%]:hover{cursor:pointer}.label__pin--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__pin--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__wire[_ngcontent-%COMP%]{position:absolute;top:16px;left:16px;height:0;transform-origin:0 100%;pointer-events:none;z-index:1}.label__wire--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]{display:inline-block;left:16px;top:0;z-index:10;max-width:160px;pointer-events:all}.label__tag[_ngcontent-%COMP%]:hover{cursor:pointer}.label__tag--draggable[_ngcontent-%COMP%]:hover{cursor:grab}.label__tag--draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.label__tag--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important;border-radius:4px}.label__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;line-height:140%;align-self:center}.label__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;padding-top:12px}.label__body--collapse[_ngcontent-%COMP%]{display:none}.label__icon[_ngcontent-%COMP%]{margin:0 -4px 0 4px}.label__actions[_ngcontent-%COMP%]{padding-left:4px}.label--studio.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--studio.label--opaque[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#ffffffd9!important}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#2d72dc}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff;border-color:#2d72dc;box-shadow:0 0 0 1px #2d72dcb3}.label--studio.label.label--selected[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600}.label--studio.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid rgba(16,24,35,.8);box-shadow:0 0 0 1px #f9fafd40}.label--studio.label[_ngcontent-%COMP%]   .label__wire--collapse[_ngcontent-%COMP%]{display:none}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background:#ffffff8c;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:4px 8px;border-radius:4px;max-width:200px}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc}.label--studio.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#101823;flex:1 1 auto}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#374a68;padding-top:4px}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.label--studio.label[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex}.label--annotation.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff40;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite;top:-1px;left:-1px}.label--annotation.label--none[_ngcontent-%COMP%]{display:none}.label--annotation.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:10px;color:#eee}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--floating[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:none}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:focus{outline-offset:4px}.label--annotation.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;min-height:18px;width:100%;padding-bottom:4px;margin-bottom:-2px;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding-top:4px;color:#333}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#eee}.label--context.label[_ngcontent-%COMP%]{pointer-events:none}.label--context.label--glow[_ngcontent-%COMP%]   .label__glow[_ngcontent-%COMP%]{background-color:#ffffff4d;display:block;animation:_ngcontent-%COMP%_classic-glow 4s infinite}.label--context.label[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%], .label--context.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{display:none}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;background:#ffffffb3;border:1px solid rgba(16,24,35,.8);box-shadow:0 0 24px #1018231a;padding:0;border-radius:4px;width:-moz-fit-content;width:fit-content;min-width:200px;max-width:none;min-height:75px;opacity:1;transition:width .25s,opacity .1s}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc;cursor:grab}.label--context.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{padding:4px 8px 0}.label--context.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;color:#101823}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid #eaeff5;color:#101823;overflow-x:hidden;padding-top:8px}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.context-label--large[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:300px}@media (min-width: 960px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:400px}}@media (max-width: 959px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{opacity:0}}"],changeDetection:0}),tS([(0,l.l6)(Xe.S.getEnginePosition),nS("design:type",y.c)],Ar.prototype,"enginePosition$",void 0),tS([(0,l.l6)(fe.N.getSelectedChapterBackground),nS("design:type",y.c)],Ar.prototype,"background$",void 0);var $a,gu=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},hu=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const DT=["labelDescription"];function kT(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.playAudio())}),e.nrm(1,"app-icon",21),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("disabled",o.audioPlayerLoading)}}function LT(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleReadMoreClick())}),e.nrm(1,"app-icon",23),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.AVh("context-label__info--expanded",o.expanded)}}function UT(n,t){if(1&n&&(e.j41(0,"div",17),e.DNE(1,kT,2,1,"button",18)(2,LT,2,2,"button",19),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.enableAudio),e.R7$(),e.Y8G("ngIf",o.enableInfo&&(null==o.node||null==o.node.info?null:o.node.info.description))}}function jT(n,t){if(1&n&&(e.j41(0,"i",24),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.node.info.latinLabel," ")}}function VT(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",25,2),e.nI1(2,"markdown"),e.nI1(3,"async"),e.bIt("pointerdown",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleDescriptionPointerDown(s))})("wheel",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.stopPropagation(s))}),e.k0s()}if(2&n){const o=e.XpG();e.AVh("context-label__description--expanded",o.expanded),e.Y8G("innerHTML",e.bMT(3,5,e.bMT(2,3,o.node.info.description)),e.npT)}}function xT(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",26)(1,"button",27),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.hideNode())}),e.pXf(2,5),e.k0s(),e.j41(3,"button",28),e.qex(4),e.pXf(5,6),e.bVm(),e.nrm(6,"app-icon",29),e.k0s(),e.j41(7,"button",27),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.hideInverseNodes())}),e.pXf(8,7),e.k0s()()}if(2&n){e.XpG();const o=e.sdS(12);e.R7$(3),e.Y8G("matMenuTriggerFor",o)}}const FT=["es-ES","en-US"];class Ba{set label(t){this._label=t,this.largeTitle=this._label.title.length>60,this.removeAudioPlayer(),this.setLabelNode(),this.changeDetectorRef.markForCheck()}get label(){return this._label}get enableAudio(){return FT.includes(this.localeCode)&&this._enableAudio}set enableAudio(t){this._enableAudio=t,this.removeAudioPlayer(),this.changeDetectorRef.markForCheck()}constructor(t,o,i,s,r,a,d,f,T){this.store=t,this.actions=o,this.sceneService=i,this.dialog=s,this.nodeService=r,this.mediaService=a,this.renderer2=d,this.markdownService=f,this.changeDetectorRef=T,this.largeTitle=!1,this.expanded=!1,this.ngUnsubscribe=new Q.B,this.id=vi.u.getUuid()}ngOnInit(){this.initInfoListeners(),this.initBreakpointListeners(),this.initLocale()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.removeAudioPlayer()}setLabelNode(){const t=(0,m.get)(this.label,"objectId");if(t){const o=this.store.selectSnapshot(Xe.S.getViewGraph);this.node=this.sceneService.getViewNode(o,t)}else this.node=null;this.expanded=!1,this.changeDetectorRef.markForCheck()}initInfoListeners(){this.actions.pipe((0,l.rM)(st.RV),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setLabelNode()})}initBreakpointListeners(){this.horizontalBreakpoint$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.expanded&&(t<Vn.Large&&!this.curDialog?this.openContextLabelDialog():t>=Vn.Large&&this.curDialog&&this.curDialog?.close(!0))})}initLocale(){var t=this;return(0,Ct.A)(function*(){t.localeCode=yield t.getLocaleCode(),t.changeDetectorRef.markForCheck()})()}handleReadMoreClick(){this.node&&(this.expanded=!this.expanded,this.expanded&&this.store.selectSnapshot(In.getHorizontalBreakpoint)<Vn.Large&&this.openContextLabelDialog())}stopPropagation(t){t.stopPropagation()}handleDescriptionPointerDown(t){const o=this.labelDescription.nativeElement,i=o.offsetWidth-o.clientWidth;if(i>0){const r=o.getBoundingClientRect().right-i;t.clientX>r&&this.stopPropagation(t)}}playAudio(){var t=this;return(0,Ct.A)(function*(){(0,m.isNil)(t.audioPlayer)&&(yield t.setAudioPlayer(t.localeCode)),t.audioPlayer.stop(),t.audioPlayer.play()})()}setAudioPlayer(t){var o=this;return(0,Ct.A)(function*(){o.removeAudioPlayer(),o.audioPlayerLoading=!0,o.changeDetectorRef.markForCheck(),o.audioPlayer=yield o.mediaService.addAudioPlayer(o.id,o.getAudioSource(t),!1),o.audioPlayerLoading=!1,o.changeDetectorRef.markForCheck()})()}getAudioSource(t){var o=this;return(0,Ct.A)(function*(){return Ch(yield ro.l.getPlainTextFromMarkdown(o.renderer2,o.markdownService,o._label.title,!0),t)})()}getLocaleCode(){var t=this;return(0,Ct.A)(function*(){const o=t.store.selectSnapshot(rt.getStoryInfo);let i=bn.q.id;if(o.type===ye.c.Bookmark){let r=t.store.selectSnapshot(rt.getStory).chapters.map(a=>a.description||"").join(" ").trim();if(!r){const a=t.store.selectSnapshot(Xe.S.getViewGraph);r=Object.values(a.nodes).map(f=>f.label).join(", ").trim()}return yh(r)}{const s=t.store.selectSnapshot(rt.getStoryLanguage);i=(0,bn.U1)(s).id}return i})()}removeAudioPlayer(){this.mediaService.removeAudioPlayer(this.id),this.audioPlayer=null}hideNode(){this.store.dispatch(new Lt.yr(!1,[this.node.id]))}fadeInverseNodes(){this.nodeService.fadeInverse([this.node.id])}fadeNode(){this.nodeService.fade([this.node.id])}hideInverseNodes(){this.nodeService.hideInverse([this.node.id])}openContextLabelDialog(){this.curDialog=this.dialog.open(sT,{width:"calc(100% - 80px)",maxWidth:"100%",height:"calc(100% - 80px)",maxHeight:"100%",data:{title:this.label.title,audioPlayer:this.audioPlayer,latinLabel:this.node.info.latinLabel,description:this.node.info.description}}),this.curDialog.afterClosed().subscribe(t=>{this.curDialog=void 0,t||(this.expanded=!1,this.changeDetectorRef.markForCheck())})}}($a=Ba).\u0275fac=function(t){return new(t||$a)(e.rXU(l.il),e.rXU(l.En),e.rXU(ji.w),e.rXU(Dt.bZ),e.rXU(Yf.w),e.rXU(Ci),e.rXU(e.sFG),e.rXU(pi.Rl),e.rXU(e.gRc))},$a.\u0275cmp=e.VBU({type:$a,selectors:[["app-context-label"]],viewQuery:function(t,o){if(1&t&&e.GBs(DT,5),2&t){let i;e.mGM(i=e.lsd())&&(o.labelDescription=i.first)}},inputs:{label:"label",enableInfo:"enableInfo",enableActions:"enableActions",enableAudio:"enableAudio"},decls:17,vars:17,consts:()=>{let n,t,o,i,s;return n=$localize`:b759baf42e7a90ef5e8c645babba3f7737e6a5265489525302847889282: Fade This `,t=$localize`:1eeab5878ca4b21288c9610b9837d0cf81cc64a06683889227007993247: Fade Everything Else `,o=$localize`:ccf7390cbf933d13bbd3558c3f16040691f3f5c37951634674386802910: Hide `,i=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,s=$localize`:bfe7e779289d630d424893f857357ae741f6acfd8086714388799643845: Isolate `,[["title",""],["fadeActions","matMenu"],["labelDescription",""],n,t,o,i,s,[1,"context-label",3,"fixedScale","label"],["label-header","",1,"context-label__header","html",3,"innerHTML"],["class","context-label__actions","label-actions","",4,"ngIf"],["label-more",""],["class","context-label__latin",4,"ngIf"],["class","context-label__description",3,"context-label__description--expanded","innerHTML","pointerdown","wheel",4,"ngIf"],["class","context-label__node-actions",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["label-actions","",1,"context-label__actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"disabled","click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click","disabled"],["icon","volume-up","appLogicalDir",""],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click"],["icon","info-circle",1,"context-label__info"],[1,"context-label__latin"],[1,"context-label__description",3,"pointerdown","wheel","innerHTML"],[1,"context-label__node-actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"click"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"app-generic-label",8),e.nI1(1,"async"),e.nrm(2,"div",9,0),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,UT,3,2,"div",10),e.qex(7,11),e.DNE(8,jT,2,1,"i",12)(9,VT,4,7,"div",13)(10,xT,9,1,"div",14),e.j41(11,"mat-menu",null,1)(13,"button",15),e.bIt("click",function(){return e.eBV(i),e.Njj(o.fadeNode())}),e.pXf(14,3),e.k0s(),e.j41(15,"button",16),e.bIt("click",function(){return e.eBV(i),e.Njj(o.fadeInverseNodes())}),e.pXf(16,4),e.k0s()(),e.bVm(),e.k0s()}2&t&&(e.AVh("context-label--expanded",o.expanded)("context-label--large",o.largeTitle),e.Y8G("fixedScale",e.bMT(1,11,o.labelScale$))("label",o.label),e.R7$(2),e.Y8G("innerHTML",e.bMT(5,15,e.bMT(4,13,o.label.title)),e.npT),e.R7$(4),e.Y8G("ngIf",o.node),e.R7$(2),e.Y8G("ngIf",o.node&&(null==o.node.info?null:o.node.info.latinLabel)),e.R7$(),e.Y8G("ngIf",o.enableInfo&&(null==o.node||null==o.node.info?null:o.node.info.description)),e.R7$(),e.Y8G("ngIf",o.node))},dependencies:[q.bT,bi.Q,$i.e,yt.R,ei.kk,ei.fb,ei.Cp,Ar,q.Jj,pi.i0],styles:[".context-label[_ngcontent-%COMP%]{z-index:12}.context-label__header[_ngcontent-%COMP%]{word-break:break-word}.context-label__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;min-height:24px}.context-label__info--expanded[_ngcontent-%COMP%]{color:#2d72dc}.context-label__latin[_ngcontent-%COMP%]{display:block;padding:0 8px 4px;font-size:.625rem;line-height:.75rem;font-style:italic}.context-label__description[_ngcontent-%COMP%]{max-height:0;margin:0;overflow:auto;font-size:12px;line-height:18px;transition:max-height .25s,margin .25s}.context-label__node-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid rgba(16,24,35,.5);margin-top:4px;white-space:nowrap}.context-label__node-action[_ngcontent-%COMP%]{border-radius:0;border-inline-end:1px solid rgba(16,24,35,.5);flex:1}.context-label__node-action[_ngcontent-%COMP%]:last-child{border-inline-end:0}@media (min-width: 960px){.context-label__description--expanded[_ngcontent-%COMP%]{margin:8px;max-height:200px}}"],changeDetection:0}),gu([(0,l.l6)(Xe.S.getQuerying),hu("design:type",y.c)],Ba.prototype,"querying$",void 0),gu([(0,l.l6)(Ze.getLabelScale),hu("design:type",y.c)],Ba.prototype,"labelScale$",void 0),gu([(0,l.l6)(In.getHorizontalBreakpoint),hu("design:type",y.c)],Ba.prototype,"horizontalBreakpoint$",void 0);var Xa,za=function(n){return n.Normal="normal",n.Compact="compact",n}(za||{}),uo=_(65776),Wa=_(13976),oS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},sS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const GT=["image"],$T=["imagePre"],BT=["imagePost"],zT=["imageContainer"];function WT(n,t){if(1&n&&(e.nrm(0,"div",10),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const o=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,o.label)),e.npT)}}function XT(n,t){if(1&n&&e.nrm(0,"img",11,2),2&n){const o=e.XpG();e.Y8G("src",o.imageUrl,e.B4B)}}function HT(n,t){if(1&n&&e.nrm(0,"img",12,3),2&n){const o=e.XpG();e.Y8G("src",o.imageUrl,e.B4B)}}class ed{constructor(t,o,i,s){this.renderer=t,this.engineService=o,this.animationService=i,this.store=s,this.ngUnsubscribe=new Q.B,this.loopImage=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,S.p)(t=>!!t.animation),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}initTimelineListener(){(0,Wi.h)(this.engineService.getEvent(gt.X.TimelineScrubbed),this.engineService.getEvent(gt.X.TimelinePlaying)).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.getChapterPercent();this.moveImage(o)})}handleClick(t){const o=this.store.selectSnapshot(Xe.S.getAnimationPlaying);o&&this.animationService.pause(),this.scrub(t),setTimeout(()=>{o&&this.animationService.unpause()})}scrub(t){if(t.currentTarget instanceof HTMLElement){const o=t.currentTarget.getBoundingClientRect(),r=this.timerange.lastTime-this.timerange.firstTime,d=(t.clientX-o.left-o.width/2)*(r/this.getImageWidth());let f=this.animationService.getTime()+d;this.loopImage&&(f<0?f=r+f:f>r&&(f-=r)),f>=0&&f<=r&&this.animationService.scrub(f)}}moveImage(t){const o=this.getImageWidth();this.renderer.setStyle(this.imageContainer.nativeElement,"transform",`translate(${t/100*-o}px, 0)`),this.loopImage&&(this.renderer.setStyle(this.imagePre.nativeElement,"transform",`translate(${-o}px, 0)`),this.renderer.setStyle(this.imagePost.nativeElement,"transform",`translate(${o}px, 0)`))}getImageWidth(){return this.image.nativeElement.getBoundingClientRect().width}getChapterPercent(){if((0,m.isNil)(this.timerange))return 0;const{firstTime:t,lastTime:o}=this.timerange,i=this.animationService.getTime();return Math.max(t,Math.min(i,o))/o*100}}var Ha;(Xa=ed).\u0275fac=function(t){return new(t||Xa)(e.rXU(e.sFG),e.rXU(u.y),e.rXU(zi.O),e.rXU(l.il))},Xa.\u0275cmp=e.VBU({type:Xa,selectors:[["app-ticker-block-item"]],viewQuery:function(t,o){if(1&t&&(e.GBs(GT,7),e.GBs($T,5),e.GBs(BT,5),e.GBs(zT,7)),2&t){let i;e.mGM(i=e.lsd())&&(o.image=i.first),e.mGM(i=e.lsd())&&(o.imagePre=i.first),e.mGM(i=e.lsd())&&(o.imagePost=i.first),e.mGM(i=e.lsd())&&(o.imageContainer=i.first)}},inputs:{label:"label",imageUrl:"imageUrl",loopImage:"loopImage"},decls:8,vars:4,consts:[["imageContainer",""],["image",""],["imagePre",""],["imagePost",""],[1,"ticker-block-item",3,"click"],["class","ticker-block-item__label html",3,"innerHTML",4,"ngIf"],[1,"ticker-block-item__image-container"],["class","ticker-block-item__image ticker-block-item__image--pre",3,"src",4,"ngIf"],["class","ticker-block-item__image ticker-block-item__image--post",3,"src",4,"ngIf"],[1,"ticker-block-item__image",3,"src"],[1,"ticker-block-item__label","html",3,"innerHTML"],[1,"ticker-block-item__image","ticker-block-item__image--pre",3,"src"],[1,"ticker-block-item__image","ticker-block-item__image--post",3,"src"]],template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",4),e.bIt("click",function(r){return e.eBV(i),e.Njj(o.handleClick(r))}),e.DNE(1,WT,3,5,"div",5),e.j41(2,"div",6,0),e.DNE(4,XT,2,1,"img",7)(5,HT,2,1,"img",8),e.nrm(6,"img",9,1),e.k0s()()}2&t&&(e.R7$(),e.Y8G("ngIf",o.label),e.R7$(3),e.Y8G("ngIf",o.loopImage),e.R7$(),e.Y8G("ngIf",o.loopImage),e.R7$(),e.Y8G("src",o.imageUrl,e.B4B))},dependencies:[q.bT,q.Jj,pi.i0],styles:['.ticker-block-item[_ngcontent-%COMP%]{--label-height: 24px;background:#f9fafd;background:linear-gradient(90deg,#f9fafd 20%,#fff0,#fff,#f9fafd 80%);overflow:hidden;padding-left:50%;position:relative;cursor:pointer}.ticker-block-item[_ngcontent-%COMP%]:hover   .ticker-block-item__label[_ngcontent-%COMP%]{background:#ffffffe6}.ticker-block-item[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;left:50%;top:0;height:100%;width:1px;background:red;box-shadow:0 0 0 4px #f003;z-index:10}.ticker-block-item__label[_ngcontent-%COMP%]{position:absolute;height:var(--label-height);left:0;top:0;width:100%;display:flex;align-items:center;font-size:12px;z-index:10;background:#ffffff8c}.ticker-block-item__image-container[_ngcontent-%COMP%]{position:relative;margin-top:var(--label-height);pointer-events:none;-webkit-user-select:none;user-select:none}.ticker-block-item__image[_ngcontent-%COMP%]{display:block;max-width:none}.ticker-block-item__image--pre[_ngcontent-%COMP%], .ticker-block-item__image--post[_ngcontent-%COMP%]{position:absolute;top:0;left:0}'],changeDetection:0}),oS([(0,l.l6)(Xe.S.getAnimationPlaying),sS("design:type",y.c)],ed.prototype,"animationPlaying$",void 0),oS([(0,l.l6)(fe.N.getSelectedChapterReadyState),sS("design:type",y.c)],ed.prototype,"chapterReadyState$",void 0);const KT=["guideline"];function JT(n,t){if(1&n&&e.nrm(0,"app-ticker-block-item",11),2&n){const o=t.$implicit,i=e.XpG(2);e.Y8G("imageUrl",o.urls.default)("label",o.caption)("loopImage",i.tickerBlock.loopImage)}}function qT(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",3)(1,"div",4),e.bIt("mouseenter",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleMouseEnter())})("mouseleave",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleMouseLeave())})("mousemove",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleMouseMove(s))}),e.DNE(2,JT,1,3,"app-ticker-block-item",5),e.nrm(3,"div",6,0),e.k0s(),e.j41(5,"button",7),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handlePlayClick())}),e.j41(6,"span",8),e.EFF(7),e.nI1(8,"async"),e.k0s(),e.nrm(9,"app-icon",9),e.nI1(10,"async"),e.j41(11,"span",10),e.pXf(12,1),e.nI1(13,"async"),e.k0s()()()}if(2&n){const o=e.XpG();e.R7$(2),e.Y8G("ngForOf",o.tickerBlock.images),e.R7$(5),e.JRh(o.getAnimationPlayingTooltip(e.bMT(8,4,o.animationPlaying$))),e.R7$(2),e.Y8G("icon",e.bMT(10,6,o.animationPlaying$)?"pause":"play"),e.R7$(4),e.uP7(e.bMT(13,8,o.animationPlaying$)?"Pause":"Play"),e.nnv(12)}}class mu{constructor(t,o){this.store=t,this.renderer=o,this.ngUnsubscribe=new Q.B}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayClick(){const t=this.store.selectSnapshot(Xe.S.getAnimationPlaying);this.store.dispatch(new st.dE(!t))}getAnimationPlayingTooltip(t){return t?$localize`Pause Animation`:$localize`Play Animation`}handleMouseMove(t){const o=this.guideline.nativeElement,s=o.parentElement.getBoundingClientRect();this.renderer.setStyle(o,"transform",`translate(${t.clientX-s.left}px, 0)`)}handleMouseEnter(){this.renderer.setStyle(this.guideline.nativeElement,"display","block")}handleMouseLeave(){this.renderer.setStyle(this.guideline.nativeElement,"display","none")}}(Ha=mu).\u0275fac=function(t){return new(t||Ha)(e.rXU(l.il),e.rXU(e.sFG))},Ha.\u0275cmp=e.VBU({type:Ha,selectors:[["app-ticker-block"]],viewQuery:function(t,o){if(1&t&&e.GBs(KT,5),2&t){let i;e.mGM(i=e.lsd())&&(o.guideline=i.first)}},inputs:{tickerBlock:"tickerBlock"},decls:1,vars:1,consts:()=>{let n;return n=$localize`:026d242c5f68dd78d7735a118cb96c4d3ed15eb6793165009929591137:${"\ufffd0\ufffd"}:INTERPOLATION: Animation`,[["guideline",""],n,["class","ticker-block",4,"ngIf"],[1,"ticker-block"],[1,"ticker-block__item-container",3,"mouseenter","mouseleave","mousemove"],[3,"imageUrl","label","loopImage",4,"ngFor","ngForOf"],[1,"ticker-block__guideline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"ticker-block__play",3,"click"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"],[1,"ml-2","text-uppercase","text-10"],[3,"imageUrl","label","loopImage"]]},template:function(t,o){1&t&&e.DNE(0,qT,14,10,"div",2),2&t&&e.Y8G("ngIf",o.tickerBlock)},dependencies:[q.Sq,q.bT,rn,yt.R,ed,q.Jj],styles:[".ticker-block__item-container[_ngcontent-%COMP%]{position:relative}.ticker-block__guideline[_ngcontent-%COMP%]{display:none;position:absolute;pointer-events:none;left:0;top:0;height:100%;width:1px;background:red;z-index:10}.ticker-block__play[_ngcontent-%COMP%]{width:100%;margin:12px 0}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Xe.S.getAnimationPlaying),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],mu.prototype,"animationPlaying$",void 0);let Zo=(()=>{var n;class t{constructor(i,s){var r=this;this.domSanitizer=i,this.markdownService=s,this.html=(0,e.hFB)(""),this.markdownText=(0,e.hFB)(""),this.safeHTML=(0,e.vPA)(""),(0,e.QZP)((0,Ct.A)(function*(){const a=r.html(),d=r.markdownText(),f=a||(yield r.markdownService.parse(d))||"",T=r.domSanitizer.bypassSecurityTrustHtml(f);r.safeHTML.set(T)}))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(c.up),e.rXU(pi.Rl))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-html"]],inputs:{html:[e.Mj6.SignalBased,"html"],markdownText:[e.Mj6.SignalBased,"markdownText"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[[1,"html",3,"innerHTML"]],template:function(i,s){1&i&&e.nrm(0,"div",0),2&i&&e.Y8G("innerHTML",s.safeHTML(),e.npT)},encapsulation:2,changeDetection:0}),t})(),ZT=(()=>{var n;class t{constructor(){this.layout=za.Normal}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-markdown-block"]],inputs:{markdownBlock:"markdownBlock",layout:"layout"},decls:2,vars:1,consts:[[1,"markdown-block"],[3,"markdownText"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.nrm(1,"app-html",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("markdownText",s.markdownBlock.markdown))},dependencies:[Zo],encapsulation:2,changeDetection:0}),t})();var On=_(14823);const eO=(n,t,o)=>[n,t,o];function tO(n,t){if(1&n&&(e.j41(0,"div",3),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.label," ")}}var rS=function(n){return n.Small="small",n.Medium="medium",n.Large="large",n.Huge="huge",n}(rS||{}),aS=function(n){return n.Horizontal="horizontal",n.Vertical="vertical",n}(aS||{}),lS=function(n){return n.Inline="inline",n.Block="block",n.Fill="fill",n}(lS||{});let Gs=(()=>{var n;class t{constructor(){this.size=rS.Medium,this.label="",this.direction=aS.Horizontal,this.render=lS.Fill}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-spinner"]],inputs:{size:"size",label:"label",direction:"direction",render:"render"},decls:3,vars:6,consts:[[1,"spinner","spinner--horizontal",3,"ngClass"],[1,"spinner__circle"],["class","spinner__label",4,"ngIf"],[1,"spinner__label"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.nrm(1,"div",1),e.DNE(2,tO,2,1,"div",2),e.k0s()),2&i&&(e.Y8G("ngClass",e.sMw(2,eO,"spinner--"+s.size,"spinner--"+s.render,"spinner--"+s.direction)),e.R7$(2),e.Y8G("ngIf",s.label.length))},dependencies:[q.YU,q.bT],styles:['@keyframes _ngcontent-%COMP%_spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:14px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:16px}.spinner--horizontal[_ngcontent-%COMP%]{flex-direction:row}.spinner--vertical[_ngcontent-%COMP%]{align-items:center;flex-direction:column}.spinner--vertical[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{padding:8px 0 0}.spinner--inline[_ngcontent-%COMP%]{display:inline-flex}.spinner--block[_ngcontent-%COMP%]{display:flex}.spinner--fill[_ngcontent-%COMP%]{display:flex;height:100%}.spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:50%;border:2px solid rgba(16,24,35,.1);position:relative}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{border-color:#fff6}.spinner__circle[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_spinner .4s linear infinite;content:" ";border-radius:50%;border:2px solid transparent;border-top-color:#fff3;border-right-color:#10182333;box-sizing:border-box;position:absolute;display:block;width:14px;height:14px;top:-2px;left:-2px}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{border-top-color:#fff;border-right-color:#fff}.spinner__label[_ngcontent-%COMP%]{padding-left:8px;font-size:14px;text-transform:uppercase}.theme-dark[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#fff3}.theme-light[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#10182399}'],changeDetection:0}),t})();function nO(n,t){1&n&&(e.j41(0,"div",5),e.nrm(1,"app-spinner",6),e.k0s())}let iO=(()=>{var n;class t{constructor(i,s,r){this.dialogRef=i,this.data=s,this.changeRef=r,this.config=s}ngOnInit(){}handleCloseClick(){this.dialogRef.close()}handleImageLoaded(){this.imageLoaded=!0,this.changeRef.markForCheck()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(Dt.Vh),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-image-dialog"]],decls:5,vars:6,consts:[["role","dialog","aria-modal","true",1,"image-dialog",3,"click","keyup.enter"],["class","image-dialog__loading flex flex-col p-8",4,"ngIf"],[1,"image-dialog__image",3,"load","src","title","alt"],["type","button","app-view-button","","buttonColor","gray-dark","buttonShape","rounded","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"image-dialog__close",3,"click"],["icon","times"],[1,"image-dialog__loading","flex","flex-col","p-8"],["size","huge"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.bIt("click",function(){return s.handleCloseClick()})("keyup.enter",function(){return s.handleCloseClick()}),e.DNE(1,nO,2,0,"div",1),e.j41(2,"img",2),e.bIt("load",function(){return s.handleImageLoaded()}),e.k0s(),e.j41(3,"button",3),e.bIt("click",function(){return s.handleCloseClick()}),e.nrm(4,"app-icon",4),e.k0s()()),2&i&&(e.BMQ("aria-label",(s.config.title||s.config.alt||"")+" Image Dialog"),e.R7$(),e.Y8G("ngIf",!s.imageLoaded),e.R7$(),e.Y8G("src",s.config.src,e.B4B)("title",s.config.title||"")("alt",s.config.alt||""),e.BMQ("aria-label",s.config.title||""))},dependencies:[q.bT,On.oV,rn,yt.R,Gs],styles:[".image-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.image-dialog__loading[_ngcontent-%COMP%]{position:absolute}.image-dialog__image[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}.image-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;right:24px}"],changeDetection:0}),t})();var go=function(n){return n.AboutDialog="AboutDialog",n.AddTeamModelDialog="AddTeamModelDialog",n.AssignUserRoleDialog="AssignUserRoleDialog",n.BulkUpdateDialog="BulkUpdateDialog",n.BookmarkAccessDialog="BookmarkAccessDialog",n.ShareUrlDialog="ShareUrlDialog",n.ConfirmDialog="ConfirmDialog",n.ContactDialog="ContactDialog",n.GroupRestrictionDialog="GroupRestrictionDialog",n.ImageDialog="ImageDialog",n.VideoDialog="VideoDialog",n.ImportDialog="ImportDialog",n.JoinDomainDialog="JoinDomainDialog",n.LimitDialog="LimitDialog",n.ManageDialog="ManageDialog",n.PremiumContentDialog="PremiumContentDialog",n.PricingDialog="PricingDialog",n.ProfileDialog="ProfileDialog",n.QuizSettingsDialog="QuizSettingsDialog",n.SaveAsBookmarkDialog="SaveAsBookmarkDialog",n.SaveBookmarkDialog="SaveBookmarkDialog",n.SaveModuleDialog="SaveModuleDialog",n.TransferUserContentDialog="TransferUserContentDialog",n.RemoveUserDialog="RemoveUserDialog",n.MergeModuleDialog="MergeModuleDialog",n.MergeConflictDialog="MergeConflictDialog",n.WelcomeTourDialog="WelcomeTourDialog",n.TrialExpiredDialog="TrialExpiredDialog",n.PremiumAccessDialog="PremiumAccessDialog",n.ConfirmRoleDialog="ConfirmRoleDialog",n.CollectionNameDialog="CollectionNameDialog",n.PublicViewGateDialog="PublicViewGateDialog",n.BookmarkJobsDialog="BookmarkJobsDialog",n.BulkAddModelDialog="BulkAddModelDialog",n.BulkDeleteModelDialog="BulkDeleteModelDialog",n}(go||{});const oO=["imageView"];let sO=(()=>{var n;class t{constructor(i){this.dialog=i,this.fit="normal",this.fullscreenEnabled=!1}handleFullscreen(i){this.dialog.open(iO,{id:go.ImageDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{src:this.fullscreenSrc||this.src,alt:this.alt||""}}),i.stopPropagation()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.bZ))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-image-view"]],viewQuery:function(i,s){if(1&i&&e.GBs(oO,7),2&i){let r;e.mGM(r=e.lsd())&&(s.imageView=r.first)}},inputs:{fit:"fit",fitSize:"fitSize",src:"src",fullscreenSrc:"fullscreenSrc",alt:"alt"},decls:7,vars:8,consts:()=>{let o,i;return o=$localize`:1f332ec66f3bc8d943c248091be7f92772ba280f1359092845802014498:Expand`,i=$localize`:18f469ed5b239831a3f607f35e2faa3ccd9527d63521332303708985940:Click to expand the image`,[["imageView",""],i,["role","button","tabindex","0","matTooltip",o,1,"image-view",3,"click","keyup.enter"],[1,"sr-only"],[1,"image-view__image",3,"src"],["aria-hidden","true",1,"image-view__overlay"],["icon","expand-alt",1,"image-view__icon"]]},template:function(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",2,0),e.bIt("click",function(d){return e.eBV(r),e.Njj(s.handleFullscreen(d))})("keyup.enter",function(d){return e.eBV(r),e.Njj(s.handleFullscreen(d))}),e.j41(2,"span",3),e.pXf(3,1),e.k0s(),e.nrm(4,"img",4),e.j41(5,"div",5),e.nrm(6,"app-icon",6),e.k0s()()}2&i&&(e.AVh("image-view--auto-fit","auto"===s.fit),e.R7$(4),e.xc7("max-width","auto"===s.fit&&s.fitSize?s.fitSize+"px":"100%")("max-height","auto"===s.fit&&s.fitSize?s.fitSize+"px":"100%"),e.Y8G("src",s.src,e.B4B),e.BMQ("alt",s.alt))},dependencies:[yt.R,On.oV],styles:[".image-view[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:inherit;min-height:32px;position:relative;background-color:#f9fafd}.image-view__image[_ngcontent-%COMP%]{width:auto;height:auto}.image-view--auto-fit[_ngcontent-%COMP%]   .image-view__image[_ngcontent-%COMP%]{max-width:100%;height:auto}.image-view__overlay[_ngcontent-%COMP%]{background:#1c2a3f4d;color:#fff;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px;position:absolute;inset:0;opacity:0;transition:opacity .25s}.image-view__icon[_ngcontent-%COMP%]{text-shadow:0 0 2px rgba(0,0,0,.6)}.image-view[_ngcontent-%COMP%]:hover{cursor:pointer}.image-view[_ngcontent-%COMP%]:hover   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}.image-view[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.image-view[_ngcontent-%COMP%]:focus   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),t})();function rO(n,t){if(1&n&&(e.j41(0,"div",6),e.nrm(1,"app-image-view",7),e.k0s()),2&n){const o=e.XpG(2);e.AVh("mb-3",o.currentImage.caption),e.R7$(),e.Y8G("src",o.currentImage.urls.small)("fullscreenSrc",o.currentImage.urls.default)("alt",o.currentImage.alt)("fit",o.fit)("fitSize",o.fitSize)}}function aO(n,t){if(1&n&&e.nrm(0,"app-html",8),2&n){const o=e.XpG(2);e.Y8G("markdownText",o.currentImage.caption)}}function lO(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",9)(1,"button",10),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handlePrevClick())}),e.nrm(2,"app-icon",11),e.k0s(),e.j41(3,"button",12),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleNextClick())}),e.nrm(4,"app-icon",13),e.k0s()()}}function cO(n,t){if(1&n&&(e.j41(0,"div",1)(1,"div",2),e.DNE(2,rO,2,7,"div",3)(3,aO,1,1,"app-html",4)(4,lO,5,0,"div",5),e.k0s()()),2&n){const o=e.XpG();e.AVh("images-block--slideshow",o.images&&o.images.length>1),e.R7$(2),e.Y8G("ngIf",o.currentImage.urls),e.R7$(),e.Y8G("ngIf",o.currentImage.caption),e.R7$(),e.Y8G("ngIf",o.images.length>1)}}let _O=(()=>{var n;class t{get imagesBlock(){return this._imagesBlock}set imagesBlock(i){this._imagesBlock=i;const s=(0,m.get)(i,"images",[]);s.length&&(this.images=s,this.currentImage=this.images[0])}get fit(){return"compact"===this.layout?"auto":"normal"}get fitSize(){return"compact"===this.layout?100:void 0}constructor(){this.layout=za.Normal}ngOnInit(){}handlePrevClick(){let i=this.getCurrentImageIndex();i--,i<0&&(i=this.images.length-1),this.currentImage=this.images[i]}handleNextClick(){let i=this.getCurrentImageIndex();i++,i>=this.images.length&&(i=0),this.currentImage=this.images[i]}getCurrentImageIndex(){return this.images.indexOf(this.currentImage)}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-images-block"]],inputs:{imagesBlock:"imagesBlock",layout:"layout"},decls:1,vars:1,consts:()=>{let o,i,s,r;return o=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,i=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,s=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,r=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,[["class","imagesBlock","data-test","images-block",3,"images-block--slideshow",4,"ngIf"],["data-test","images-block",1,"imagesBlock"],[1,"images-block__content"],["class","images-block__image-container",3,"mb-3",4,"ngIf"],["class","images-block__caption",3,"markdownText",4,"ngIf"],["class","images-block__actions",4,"ngIf"],[1,"images-block__image-container"],[1,"images-block__image-view",3,"src","fullscreenSrc","alt","fit","fitSize"],[1,"images-block__caption",3,"markdownText"],[1,"images-block__actions"],["type","button","app-view-button","","buttonSize","sm","matTooltip",o,"aria-label",i,3,"click"],["icon","chevron-left"],["type","button","app-view-button","","buttonSize","sm","matTooltip",s,"aria-label",r,3,"click"],["icon","chevron-right"]]},template:function(i,s){1&i&&e.DNE(0,cO,5,5,"div",0),2&i&&e.Y8G("ngIf",s.currentImage)},dependencies:[q.bT,rn,yt.R,Zo,sO,On.oV],styles:[".images-block__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.images-block__label{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;color:#374a68;font-weight:600;display:flex;align-items:center;min-height:28px}.images-block__image-container{display:flex;justify-content:center;background-color:#f9fafd}.images-block__image-view{display:flex;height:100%;min-height:32px}.images-block__caption{font-size:12px;margin-top:12px}.images-block__actions{display:flex;justify-content:flex-end;margin-top:14px}.images-block--slideshow .images-block__image-container{height:200px}\n"],encapsulation:2,changeDetection:0}),t})();const pO=["target"];var td=function(n){return n.Basic="basic",n.Full="full",n}(td||{});const uO={[td.Basic]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay"],[td.Full]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","customControlSpacer","pictureInPictureToggle","fullscreenToggle"]};let cS=(()=>{var n;class t{constructor(i){this.mediaService=i}ngOnInit(){var i=this;return(0,Ct.A)(function*(){i.playerId=yield i.mediaService.addVideoPlayer(i.target.nativeElement,{preload:"metadata",sources:i.sources,fluid:!0,controls:!0,responsive:!0,controlBar:{volumePanel:{inline:!1},children:uO[i.mode]},breakpoints:{tiny:200}})})()}ngOnDestroy(){this.playerId&&this.mediaService.removeVideoPlayer(this.playerId)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Ci))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-video-view"]],viewQuery:function(i,s){if(1&i&&e.GBs(pO,7),2&i){let r;e.mGM(r=e.lsd())&&(s.target=r.first)}},inputs:{sources:"sources",mode:"mode"},decls:2,vars:0,consts:[["target",""]],template:function(i,s){1&i&&e.nrm(0,"video-js",null,0)},styles:['@charset "UTF-8";.vjs-modal-dialog .vjs-modal-dialog-content,.video-js .vjs-modal-dialog,.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{text-align:center}@font-face{font-family:VideoJS;src:url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABDkAAsAAAAAG6gAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPgAAAFZRiV3hY21hcAAAAYQAAADaAAADPv749/pnbHlmAAACYAAAC3AAABHQZg6OcWhlYWQAAA3QAAAAKwAAADYZw251aGhlYQAADfwAAAAdAAAAJA+RCLFobXR4AAAOHAAAABMAAACM744AAGxvY2EAAA4wAAAASAAAAEhF6kqubWF4cAAADngAAAAfAAAAIAE0AIFuYW1lAAAOmAAAASUAAAIK1cf1oHBvc3QAAA/AAAABJAAAAdPExYuNeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS7wTiBgZWBgaWQ5RkDA8MvCM0cwxDOeI6BgYmBlZkBKwhIc01hcPjI+FGJHcRdyA4RZgQRADK3CxEAAHic7dFZbsMgAEXRS0ycyZnnOeG7y+qC8pU1dHusIOXxuoxaOlwZYWQB0Aea4quIEN4E9LzKbKjzDeM6H/mua6Lmc/p8yhg0lvdYx15ZG8uOLQOGjMp3EzqmzJizYMmKNRu27Nhz4MiJMxeu3Ljz4Ekqm7T8P52G8PP3lnTOVk++Z6iN6QZzNN1F7ptuN7eGOjDUoaGODHVsuvU8MdTO9Hd5aqgzQ50b6sJQl4a6MtS1oW4MdWuoO0PdG+rBUI+GejLUs6FeDPVqqDdDvRvqw1CfhpqM9At0iFLaAAB4nJ1YDXBTVRZ+5/22TUlJ8we0pHlJm7RJf5O8F2j6EymlSPkpxaL8U2xpa3DKj0CBhc2IW4eWKSokIoLsuMqssM64f+jA4HSdWXXXscBq67IOs3FXZ1ZYWVyRFdo899yXtIBQZ90k7717zz3v3HPPOfd854YCCj9cL9dL0RQFOqCbGJnrHb5EayiKIWN8iA/hWBblo6hUWm8TtCDwE80WMJus/irwyxOdxeB0MDb14VNJHnXYoLLSl6FfCUYO9nYPTA8Epg9090LprfbBbZ2hY0UlJUXHQp3/vtWkS6EBv8+rPMq5u9692f/dNxJNiqwC1xPE9TCUgCsSdQWgE3XQD25lkG4CN2xmTcOXWBOyser6RN6KnGbKSbmQ3+d0OI1m2W8QzLLkI2sykrWAgJJEtA8vGGW/2Q+CmT3n8zS9wZwu2DCvtuZKZN3xkrLh36yCZuUomQSqGpY8t/25VfHVhw8z4ebGBtfLb0ya9PCaDc+8dGTvk2dsh6z7WzvowlXKUSWo9MJ15a3KrEP2loOr2Ojhw6iW6hf2BDdEccQvZGpaAy7YovSwq8kr7HGllxpd71rkS6G0Sf11sl9OvMK1+jwPPODxjUwkOim9CU3ix1wNjXDfmJSEn618Bs6lpWwUpU+8PCqLMY650zjq8VhCIP17NEKTx3eaLL+s5Pi6yJWaWjTHLR1jYzPSV9VF/6Ojdb/1kO3Mk3uhHC0x6gc1BjlKQ+nQFxTYdaJkZ7ySVxLBbhR1dsboNXp1tCYKW2LRaEzpYcIx2BKNxaL0ZaUnSqfFoiNhHKR/GkX6PWUSAaJelQaqZL1EpoHNsajSEyPSoJ9IjhIxTdjHLmwZvhRDOiFTY/YeQnvrVZmiTQtGncECXtFTBZLOVwwMRgoXHAkXzMzPn1nAJJ8jYSbMDaqN2waGLzNhih/bZynUBMpIWSg7VYi7DRx2m8ALkIdRCJwI6ArJx2EI8kaDWeTQKeAFk9fjl/1AvwktjQ1P7NjyMGQyfd4vjipX6M/i52D7Cq80kqlcxEcGXRr/FEcgs0u5uGgB4VWuMFfpdn2Re6Hi3PqzmxWKsz6+ae2Pn9hXXw/fqM859UiGC0oKYYILJBqJrsn1Z1E5qOs9rQCiUQRREjm8yJcbHF5cUJufX1vAHlefw0XgUoboS3ETfQlTxBC4SOtuE8VPRJTBSCQSjZCpk7Gqzu+masaZ2y7Zjehho4F3g82BNDkAHpORG4+OCS+f6JTPmtRn/PH1kch6d04sp7AQb25aQ/pqUyXeQ8vrebG8OYQdXOQ+585u0sdW9rqalzRURiJ+9F4MweRFrKUjl1GUYhH1A27WOHw5cTFSFPMo9EeUIGnQTZHIaJ7AHLaOKsOODaNF9jkBjYG2QEsQ2xjMUAx2bBEbeTBWMHwskBjngq56S/yfgkBnWBa4K9sqKtq2t1UI8S9He5XuBRbawAdatrQEAi30Aks2+LM8WeCbalVZkWNylvJ+dqJnzVb+OHlSoKW8nPCP7Rd+CcZ2DdWAGqJ2CBFOphgywFFCFBNtfAbGtNPBCwxvygHeYMZMY9ZboBqwq/pVrsbgN5tkv152ODlbMfiqwGMBgxa4Exz3QhovRIUp6acqZmQzRq0ypDXS2TPLT02YIkQETnOE445oOGxOmXAqUJNNG7XgupMjPq2ua9asrj5yY/yuKteO1Kx0YNJTufrirLe1mZnat7OL6rnUdCWenpW6I8mAnbsY8KWs1PuSovCW9A/Z25PQ24a7cNOqgmTkLmBMgh4THgc4b9k2IVv1/g/F5nGljwPLfOgHAzJzh45V/4+WenTzmMtR5Z7us2Tys909UHqrPY7KbckoxRvRHhmVc3cJGE97uml0R1S0jdULVl7EvZtDFVBF35N9cEdjpgmAiOlFZ+Dtoh93+D3zzHr8RRNZQhnCNMNbcegOvpEwZoL+06cJQ07h+th3fZ/7PVbVC6ngTAV/KoLFuO6+2KFcU651gEb5ugPSIb1D+Xp8V4+k3sEIGnw5mYe4If4k1lFYr6SCzmM2EQ8iWtmwjnBI9kTwe1TlfAmXh7H02by9fW2gsjKwtv0aaURKil4OdV7rDL1MXIFNrhdxohcZXYTnq47WisrKitaObbf5+yvkLi5J6lCNZZ+B6GC38VNBZBDidSS/+mSvh6s+srgC8pyKMvDtt+de3c9fU76ZPfuM8ud4Kv0fyP/LqfepMT/3oZxSqpZaTa1DaQYLY8TFsHYbWYsPoRhRWfL5eSSQbhUGgGC3YLbVMk6PitTFNGpAsNrC6D1VNBKgBHMejaiuRWEWGgsSDBTJjqWIl8kJLlsaLJ2tXDr6xGfT85bM2Q06a46x2HTgvdnV8z5YDy/27J4zt6x2VtkzjoYpkq36kaBr4eQSg7tyiVweWubXZugtadl58ydapfbORfKsDTuZ0OBgx4cfdjCf5tbWNITnL120fdOi1RV1C3uKGzNdwYLcMvZ3BxoPyTOCD1XvXTp7U10gWCVmTV9b3r2z0SkGWovb2hp9I89O8a2smlyaO8muMU+dRmtzp60IzAoFpjLr1n388boLyf0dRvxhsHZ0qbWqDkwqvvpkj4l0fY6EIXRi5sQSrAvsVYwXRy4qJ2EVtD1AN7a0HWth9ymvL1xc3WTUKK/TAHA/bXDVtVWfOMfuGxGZv4Ln/jVr9jc3j1yMv0tndmyt9Vq88Y9gH1wtLX3KWjot5++jWHgAoZZkQ14wGQ20Fli71UmKJAy4xKMSTGbVdybW7FDDAut9XpD5AzWrYO7zQ8qffqF8+Ynd/clrHcdyxGy3a/3+mfNnzC/cBsveTjnTvXf1o6vzOlZw7WtqtdmPK/Errz/6NNtD72zmNOZfbmYdTGHfoofqI79Oc+R2n1lrnL6pOm0Up7kwxhTW12Amm7WYkXR2qYrF2AmgmbAsxZjwy1xpg/m1Je2vrp8v/nz2xpmlBg4E9hrMU341wVpTOh/OfmGvAnra8q6uctr60ZQHV3Q+WMQJykMj8ZsWn2QBOmmHMB+m5pDIpTFonYigiaKAhGEiAHF7EliVnQkjoLVIMPtJpBKHYd3A8GYH9jJzrWwmHx5Qjp7vDAX0suGRym1vtm/9W1/HyR8vczfMs6Sk8DSv855/5dlX9oQq52hT8syyp2rx5Id17IAyAM3wIjQPMOHzytEB64q6D5zT91yNbnx3V/nqnd017S9Y0605k3izoXLpsxde2n38yoOV9s1LcjwzNjbdX6asnBVaBj/6/DwKwPkpcqbDG7BnsXoSqWnUAmottYF6jMSdVyYZh3zVXCjwTiwwHH6sGuRiEHQGzuRX6whZkp123oy1BWE2mEfJ/tvIRtM4ZM5bDXiMsPMaAKOTyc5uL57rqyyc5y5JE5pm1i2S2iUX0CcaQ6lC6Zog7JqSqZmYlosl2K6pwNA84zRnQW6SaALYZQGW5lhCtU/W34N6o+bKfZ8cf3/Cl/+iTX3wBzpOY4mRkeNf3rptycGSshQWgGbYt5jFc2e0+DglIrwl6DVWQ7BuwaJ3Xk1J4VL5urnLl/Wf+gHU/hZoZdKNym6lG+I34FaNeZKcSpJIo2IeCVvpdsDGfKvzJnAwmeD37Ow65ZWwSowpgwX5T69s/rB55dP5BcpgDKFV8p7q2sn/1uc93bVzT/w6UrCqDTWvfCq/oCD/qZXNoUj8BL5Kp6GU017frfNXkAtiiyf/SOCEeLqnd8R/Ql9GlCRfctS6k5chvIBuQ1zCCjoCHL2DHNHIXxMJ3kQeO8lbsUXONeSfA5EjcG6/E+KdhN4bP04vBhdi883+BFBzQbxFbvZzQeY9LNBZc0FNfn5NwfDn6rCTnTw6R8o+gfpf5hCom33cRuiTlss3KHmZjD+BPN+5gXuA2ziS/Q73mLxUkpbKN/eqwz5uK0X9F3h2d1V4nGNgZGBgAOJd776+iue3+crAzc4AAje5Bfcg0xz9YHEOBiYQBQA8FQlFAHicY2BkYGBnAAGOPgaG//85+hkYGVCBMgBGGwNYAAAAeJxjYGBgYB8EmKOPgQEAQ04BfgAAAAAAAA4AaAB+AMwA4AECAUIBbAGYAcICGAJYArQC4AMwA7AD3gQwBJYE3AUkBWYFigYgBmYGtAbqB1gIEghYCG4IhAi2COh4nGNgZGBgUGYoZWBnAAEmIOYCQgaG/2A+AwAYCQG2AHicXZBNaoNAGIZfE5PQCKFQ2lUps2oXBfOzzAESyDKBQJdGR2NQR3QSSE/QE/QEPUUPUHqsvsrXjTMw83zPvPMNCuAWP3DQDAejdm1GjzwS7pMmwi75XngAD4/CQ/oX4TFe4Qt7uMMbOzjuDc0EmXCP/C7cJ38Iu+RP4QEe8CU8pP8WHmOPX2EPz87TPo202ey2OjlnQSXV/6arOjWFmvszMWtd6CqwOlKHq6ovycLaWMWVydXKFFZnmVFlZU46tP7R2nI5ncbi/dDkfDtFBA2DDXbYkhKc+V0Bqs5Zt9JM1HQGBRTm/EezTmZNKtpcAMs9Yu6AK9caF76zoLWIWcfMGOSkVduvSWechqZsz040Ib2PY3urxBJTzriT95lipz+TN1fmAAAAeJxtkMl2wjAMRfOAhABlKm2h80C3+ajgCKKDY6cegP59TYBzukAL+z1Zsq8ctaJTTKPrsUQLbXQQI0EXKXroY4AbDDHCGBNMcYsZ7nCPB8yxwCOe8IwXvOIN7/jAJ76wxHfUqWX+OzgumWAjJMV17i0Ndlr6irLKO+qftdT7i6y4uFSUvCknay+lFYZIZaQcmfH/xIFdYn98bqhra1aKTM/6lWMnyaYirx1rFUQZFBkb2zJUtoXeJCeg0WnLtHeSFc3OtrnozNwqi0TkSpBMDB1nSde5oJXW23hTS2/T0LilglXX7dmFVxLnq5U0vYATHFk3zX3BOisoQHNDFDeZnqKDy9hRNawN7Vh727hFzcJ5c8TILrKZfH7tIPxAFP0BpLeJPA==) format("woff");font-weight:400;font-style:normal}.vjs-icon-play,.video-js .vjs-play-control .vjs-icon-placeholder,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play:before,.video-js .vjs-play-control .vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{content:"\\f101"}.vjs-icon-play-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play-circle:before{content:"\\f102"}.vjs-icon-pause,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pause:before,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f103"}.vjs-icon-volume-mute,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mute:before,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f104"}.vjs-icon-volume-low,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-low:before,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder:before{content:"\\f105"}.vjs-icon-volume-mid,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mid:before,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder:before{content:"\\f106"}.vjs-icon-volume-high,.video-js .vjs-mute-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-high:before,.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f107"}.vjs-icon-fullscreen-enter,.video-js .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-enter:before,.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f108"}.vjs-icon-fullscreen-exit,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-exit:before,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f109"}.vjs-icon-square{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-square:before{content:"\\f10a"}.vjs-icon-spinner{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-spinner:before{content:"\\f10b"}.vjs-icon-subtitles,.video-js .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-subtitles-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-subtitles:before,.video-js .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-subtitles-button .vjs-icon-placeholder:before{content:"\\f10c"}.vjs-icon-captions,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-captions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-captions:before,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-captions-button .vjs-icon-placeholder:before{content:"\\f10d"}.vjs-icon-chapters,.video-js .vjs-chapters-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-chapters:before,.video-js .vjs-chapters-button .vjs-icon-placeholder:before{content:"\\f10e"}.vjs-icon-share{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-share:before{content:"\\f10f"}.vjs-icon-cog{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cog:before{content:"\\f110"}.vjs-icon-circle,.vjs-seek-to-live-control .vjs-icon-placeholder,.video-js .vjs-volume-level,.video-js .vjs-play-progress{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle:before,.vjs-seek-to-live-control .vjs-icon-placeholder:before,.video-js .vjs-volume-level:before,.video-js .vjs-play-progress:before{content:"\\f111"}.vjs-icon-circle-outline{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-outline:before{content:"\\f112"}.vjs-icon-circle-inner-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-inner-circle:before{content:"\\f113"}.vjs-icon-hd{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-hd:before{content:"\\f114"}.vjs-icon-cancel,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cancel:before,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder:before{content:"\\f115"}.vjs-icon-replay,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-replay:before,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f116"}.vjs-icon-facebook{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-facebook:before{content:"\\f117"}.vjs-icon-gplus{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-gplus:before{content:"\\f118"}.vjs-icon-linkedin{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-linkedin:before{content:"\\f119"}.vjs-icon-twitter{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-twitter:before{content:"\\f11a"}.vjs-icon-tumblr{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-tumblr:before{content:"\\f11b"}.vjs-icon-pinterest{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pinterest:before{content:"\\f11c"}.vjs-icon-audio-description,.video-js .vjs-descriptions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio-description:before,.video-js .vjs-descriptions-button .vjs-icon-placeholder:before{content:"\\f11d"}.vjs-icon-audio,.video-js .vjs-audio-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio:before,.video-js .vjs-audio-button .vjs-icon-placeholder:before{content:"\\f11e"}.vjs-icon-next-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-next-item:before{content:"\\f11f"}.vjs-icon-previous-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-previous-item:before{content:"\\f120"}.vjs-icon-picture-in-picture-enter,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-enter:before,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f121"}.vjs-icon-picture-in-picture-exit,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-exit:before,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f122"}.video-js{display:block;vertical-align:top;box-sizing:border-box;color:#fff;background-color:#000;position:relative;padding:0;font-size:10px;line-height:1;font-weight:400;font-style:normal;font-family:Arial,Helvetica,sans-serif;word-break:initial}.video-js:-moz-full-screen{position:absolute}.video-js:-webkit-full-screen{width:100%!important;height:100%!important}.video-js[tabindex="-1"]{outline:none}.video-js *,.video-js *:before,.video-js *:after{box-sizing:inherit}.video-js ul{font-family:inherit;font-size:inherit;line-height:inherit;list-style-position:outside;margin:0}.video-js.vjs-fluid,.video-js.vjs-16-9,.video-js.vjs-4-3,.video-js.vjs-9-16,.video-js.vjs-1-1{width:100%;max-width:100%}.video-js.vjs-fluid:not(.vjs-audio-only-mode),.video-js.vjs-16-9:not(.vjs-audio-only-mode),.video-js.vjs-4-3:not(.vjs-audio-only-mode),.video-js.vjs-9-16:not(.vjs-audio-only-mode),.video-js.vjs-1-1:not(.vjs-audio-only-mode){height:0}.video-js.vjs-16-9:not(.vjs-audio-only-mode){padding-top:56.25%}.video-js.vjs-4-3:not(.vjs-audio-only-mode){padding-top:75%}.video-js.vjs-9-16:not(.vjs-audio-only-mode){padding-top:177.7777777778%}.video-js.vjs-1-1:not(.vjs-audio-only-mode){padding-top:100%}.video-js.vjs-fill:not(.vjs-audio-only-mode){width:100%;height:100%}.video-js .vjs-tech{position:absolute;top:0;left:0;width:100%;height:100%}.video-js.vjs-audio-only-mode .vjs-tech{display:none}body.vjs-full-window{padding:0;margin:0;height:100%}.vjs-full-window .video-js.vjs-fullscreen{position:fixed;overflow:hidden;z-index:1000;inset:0}.video-js.vjs-fullscreen:not(.vjs-ios-native-fs){width:100%!important;height:100%!important;padding-top:0!important}.video-js.vjs-fullscreen.vjs-user-inactive{cursor:none}.vjs-hidden{display:none!important}.vjs-disabled{opacity:.5;cursor:default}.video-js .vjs-offscreen{height:1px;left:-9999px;position:absolute;top:0;width:1px}.vjs-lock-showing{display:block!important;opacity:1!important;visibility:visible!important}.vjs-no-js{padding:20px;color:#fff;background-color:#000;font-size:18px;font-family:Arial,Helvetica,sans-serif;text-align:center;width:300px;height:150px;margin:0 auto}.vjs-no-js a,.vjs-no-js a:visited{color:#66a8cc}.video-js .vjs-big-play-button{font-size:3em;line-height:1.5em;height:1.63332em;width:3em;display:block;position:absolute;top:10px;left:10px;padding:0;cursor:pointer;opacity:1;border:.06666em solid #fff;background-color:#2b333f;background-color:#2b333fb3;border-radius:.3em;transition:all .4s}.vjs-big-play-centered .vjs-big-play-button{top:50%;left:50%;margin-top:-.81666em;margin-left:-1.5em}.video-js:hover .vjs-big-play-button,.video-js .vjs-big-play-button:focus{border-color:#fff;background-color:#73859f;background-color:#73859f80;transition:all 0s}.vjs-controls-disabled .vjs-big-play-button,.vjs-has-started .vjs-big-play-button,.vjs-using-native-controls .vjs-big-play-button,.vjs-error .vjs-big-play-button{display:none}.vjs-has-started.vjs-paused.vjs-show-big-play-button-on-pause .vjs-big-play-button{display:block}.video-js button{background:none;border:none;color:inherit;display:inline-block;font-size:inherit;line-height:inherit;text-transform:none;text-decoration:none;transition:none;-webkit-appearance:none;appearance:none}.vjs-control .vjs-button{width:100%;height:100%}.video-js .vjs-control.vjs-close-button{cursor:pointer;height:3em;position:absolute;right:0;top:.5em;z-index:2}.video-js .vjs-modal-dialog{background:#000c;background:linear-gradient(180deg,#000c,#fff0);overflow:auto}.video-js .vjs-modal-dialog>*{box-sizing:border-box}.vjs-modal-dialog .vjs-modal-dialog-content{font-size:1.2em;line-height:1.5;padding:20px 24px;z-index:1}.vjs-menu-button{cursor:pointer}.vjs-menu-button.vjs-disabled{cursor:default}.vjs-workinghover .vjs-menu-button.vjs-disabled:hover .vjs-menu{display:none}.vjs-menu .vjs-menu-content{display:block;padding:0;margin:0;font-family:Arial,Helvetica,sans-serif;overflow:auto}.vjs-menu .vjs-menu-content>*{box-sizing:border-box}.vjs-scrubbing .vjs-control.vjs-menu-button:hover .vjs-menu{display:none}.vjs-menu li{list-style:none;margin:0;padding:.2em 0;line-height:1.4em;font-size:1.2em;text-align:center;text-transform:lowercase}.vjs-menu li.vjs-menu-item:focus,.vjs-menu li.vjs-menu-item:hover,.js-focus-visible .vjs-menu li.vjs-menu-item:hover{background-color:#73859f;background-color:#73859f80}.vjs-menu li.vjs-selected,.vjs-menu li.vjs-selected:focus,.vjs-menu li.vjs-selected:hover,.js-focus-visible .vjs-menu li.vjs-selected:hover{background-color:#fff;color:#2b333f}.video-js .vjs-menu *:not(.vjs-selected):focus:not(:focus-visible),.js-focus-visible .vjs-menu *:not(.vjs-selected):focus:not(.focus-visible){background:none}.vjs-menu li.vjs-menu-title{text-align:center;text-transform:uppercase;font-size:1em;line-height:2em;padding:0;margin:0 0 .3em;font-weight:700;cursor:default}.vjs-menu-button-popup .vjs-menu{display:none;position:absolute;bottom:0;width:10em;left:-3em;height:0em;margin-bottom:1.5em;border-top-color:#2b333fb3}.vjs-menu-button-popup .vjs-menu .vjs-menu-content{background-color:#2b333f;background-color:#2b333fb3;position:absolute;width:100%;bottom:1.5em;max-height:15em}.vjs-layout-tiny .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:5em}.vjs-layout-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:10em}.vjs-layout-medium .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:14em}.vjs-layout-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-huge .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:25em}.vjs-workinghover .vjs-menu-button-popup.vjs-hover .vjs-menu,.vjs-menu-button-popup .vjs-menu.vjs-lock-showing{display:block}.video-js .vjs-menu-button-inline{transition:all .4s;overflow:hidden}.video-js .vjs-menu-button-inline:before{width:2.222222222em}.video-js .vjs-menu-button-inline:hover,.video-js .vjs-menu-button-inline:focus,.video-js .vjs-menu-button-inline.vjs-slider-active,.video-js.vjs-no-flex .vjs-menu-button-inline{width:12em}.vjs-menu-button-inline .vjs-menu{opacity:0;height:100%;width:auto;position:absolute;left:4em;top:0;padding:0;margin:0;transition:all .4s}.vjs-menu-button-inline:hover .vjs-menu,.vjs-menu-button-inline:focus .vjs-menu,.vjs-menu-button-inline.vjs-slider-active .vjs-menu{display:block;opacity:1}.vjs-no-flex .vjs-menu-button-inline .vjs-menu{display:block;opacity:1;position:relative;width:auto}.vjs-no-flex .vjs-menu-button-inline:hover .vjs-menu,.vjs-no-flex .vjs-menu-button-inline:focus .vjs-menu,.vjs-no-flex .vjs-menu-button-inline.vjs-slider-active .vjs-menu{width:auto}.vjs-menu-button-inline .vjs-menu-content{width:auto;height:100%;margin:0;overflow:hidden}.video-js .vjs-control-bar{display:none;width:100%;position:absolute;bottom:0;left:0;right:0;height:3em;background-color:#2b333f;background-color:#2b333fb3}.vjs-has-started .vjs-control-bar,.vjs-audio-only-mode .vjs-control-bar{display:flex;visibility:visible;opacity:1;transition:visibility .1s,opacity .1s}.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{visibility:visible;opacity:0;pointer-events:none;transition:visibility 1s,opacity 1s}.vjs-controls-disabled .vjs-control-bar,.vjs-using-native-controls .vjs-control-bar,.vjs-error .vjs-control-bar{display:none!important}.vjs-audio.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar,.vjs-audio-only-mode.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{opacity:1;visibility:visible;pointer-events:auto}.vjs-has-started.vjs-no-flex .vjs-control-bar{display:table}.video-js .vjs-control{position:relative;text-align:center;margin:0;padding:0;height:100%;width:4em;flex:none}.video-js .vjs-control.vjs-visible-text{width:auto;padding-left:1em;padding-right:1em}.vjs-button>.vjs-icon-placeholder:before{font-size:1.8em;line-height:1.67}.vjs-button>.vjs-icon-placeholder{display:block}.video-js .vjs-control:focus:before,.video-js .vjs-control:hover:before,.video-js .vjs-control:focus{text-shadow:0em 0em 1em white}.video-js *:not(.vjs-visible-text)>.vjs-control-text{border:0;clip:rect(0 0 0 0);height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.vjs-no-flex .vjs-control{display:table-cell;vertical-align:middle}.video-js .vjs-custom-control-spacer{display:none}.video-js .vjs-progress-control{cursor:pointer;flex:auto;display:flex;align-items:center;min-width:4em;touch-action:none}.video-js .vjs-progress-control.disabled{cursor:default}.vjs-live .vjs-progress-control{display:none}.vjs-liveui .vjs-progress-control{display:flex;align-items:center}.vjs-no-flex .vjs-progress-control{width:auto}.video-js .vjs-progress-holder{flex:auto;transition:all .2s;height:.3em}.video-js .vjs-progress-control .vjs-progress-holder{margin:0 10px}.video-js .vjs-progress-control:hover .vjs-progress-holder{font-size:1.6666666667em}.video-js .vjs-progress-control:hover .vjs-progress-holder.disabled{font-size:1em}.video-js .vjs-progress-holder .vjs-play-progress,.video-js .vjs-progress-holder .vjs-load-progress,.video-js .vjs-progress-holder .vjs-load-progress div{position:absolute;display:block;height:100%;margin:0;padding:0;width:0}.video-js .vjs-play-progress{background-color:#fff}.video-js .vjs-play-progress:before{font-size:.9em;position:absolute;right:-.5em;top:-.3333333333em;z-index:1}.video-js .vjs-load-progress{background:#73859f80}.video-js .vjs-load-progress div{background:#73859fbf}.video-js .vjs-time-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-progress-holder:focus .vjs-time-tooltip{display:none}.video-js .vjs-progress-control:hover .vjs-time-tooltip,.video-js .vjs-progress-control:hover .vjs-progress-holder:focus .vjs-time-tooltip{display:block;font-size:.6em;visibility:visible}.video-js .vjs-progress-control.disabled:hover .vjs-time-tooltip{font-size:1em}.video-js .vjs-progress-control .vjs-mouse-display{display:none;position:absolute;width:1px;height:100%;background-color:#000;z-index:1}.vjs-no-flex .vjs-progress-control .vjs-mouse-display{z-index:0}.video-js .vjs-progress-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-progress-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-progress-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-time-tooltip{color:#fff;background-color:#000;background-color:#000c}.video-js .vjs-slider{position:relative;cursor:pointer;padding:0;margin:0 .45em;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;background-color:#73859f;background-color:#73859f80}.video-js .vjs-slider.disabled{cursor:default}.video-js .vjs-slider:focus{text-shadow:0em 0em 1em white;box-shadow:0 0 1em #fff}.video-js .vjs-mute-control{cursor:pointer;flex:none}.video-js .vjs-volume-control{cursor:pointer;margin-right:1em;display:flex}.video-js .vjs-volume-control.vjs-volume-horizontal{width:5em}.video-js .vjs-volume-panel .vjs-volume-control{visibility:visible;opacity:0;width:1px;height:1px;margin-left:-1px}.video-js .vjs-volume-panel{transition:width 1s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control,.video-js .vjs-volume-panel:active .vjs-volume-control,.video-js .vjs-volume-panel:focus .vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control:active,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active{visibility:visible;opacity:1;position:relative;transition:visibility .1s,opacity .1s,height .1s,width .1s,left 0s,top 0s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-horizontal,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-horizontal{width:5em;height:3em;margin-right:0}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-vertical,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-vertical{left:-3.5em;transition:left 0s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active{width:10em;transition:width .1s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-mute-toggle-only{width:4em}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:8em;width:3em;left:-3000em;transition:visibility 1s,opacity 1s,height 1s 1s,width 1s 1s,left 1s 1s,top 1s 1s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{transition:visibility 1s,opacity 1s,height 1s 1s,width 1s,left 1s 1s,top 1s 1s}.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{width:5em;height:3em;visibility:visible;opacity:1;position:relative;transition:none}.video-js.vjs-no-flex .vjs-volume-control.vjs-volume-vertical,.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{position:absolute;bottom:3em;left:.5em}.video-js .vjs-volume-panel{display:flex}.video-js .vjs-volume-bar{margin:1.35em .45em}.vjs-volume-bar.vjs-slider-horizontal{width:5em;height:.3em}.vjs-volume-bar.vjs-slider-vertical{width:.3em;height:5em;margin:1.35em auto}.video-js .vjs-volume-level{position:absolute;bottom:0;left:0;background-color:#fff}.video-js .vjs-volume-level:before{position:absolute;font-size:.9em;z-index:1}.vjs-slider-vertical .vjs-volume-level{width:.3em}.vjs-slider-vertical .vjs-volume-level:before{top:-.5em;left:-.3em;z-index:1}.vjs-slider-horizontal .vjs-volume-level{height:.3em}.vjs-slider-horizontal .vjs-volume-level:before{top:-.3em;right:-.5em}.video-js .vjs-volume-panel.vjs-volume-panel-vertical{width:4em}.vjs-volume-bar.vjs-slider-vertical .vjs-volume-level{height:100%}.vjs-volume-bar.vjs-slider-horizontal .vjs-volume-level{width:100%}.video-js .vjs-volume-vertical{width:3em;height:8em;bottom:8em;background-color:#2b333f;background-color:#2b333fb3}.video-js .vjs-volume-horizontal .vjs-menu{left:-2em}.video-js .vjs-volume-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-volume-control:hover .vjs-volume-tooltip,.video-js .vjs-volume-control:hover .vjs-progress-holder:focus .vjs-volume-tooltip{display:block;font-size:1em;visibility:visible}.video-js .vjs-volume-vertical:hover .vjs-volume-tooltip,.video-js .vjs-volume-vertical:hover .vjs-progress-holder:focus .vjs-volume-tooltip{left:1em;top:-12px}.video-js .vjs-volume-control.disabled:hover .vjs-volume-tooltip{font-size:1em}.video-js .vjs-volume-control .vjs-mouse-display{display:none;position:absolute;width:100%;height:1px;background-color:#000;z-index:1}.video-js .vjs-volume-horizontal .vjs-mouse-display{width:1px;height:100%}.vjs-no-flex .vjs-volume-control .vjs-mouse-display{z-index:0}.video-js .vjs-volume-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-volume-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-volume-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-volume-tooltip{color:#fff;background-color:#000;background-color:#000c}.vjs-poster{display:inline-block;vertical-align:middle;background-repeat:no-repeat;background-position:50% 50%;background-size:contain;background-color:#000;cursor:pointer;margin:0;padding:0;position:absolute;inset:0;height:100%}.vjs-has-started .vjs-poster,.vjs-using-native-controls .vjs-poster{display:none}.vjs-audio.vjs-has-started .vjs-poster,.vjs-has-started.vjs-audio-poster-mode .vjs-poster{display:block}.video-js .vjs-live-control{display:flex;align-items:flex-start;flex:auto;font-size:1em;line-height:3em}.vjs-no-flex .vjs-live-control{display:table-cell;width:auto;text-align:left}.video-js:not(.vjs-live) .vjs-live-control,.video-js.vjs-liveui .vjs-live-control{display:none}.video-js .vjs-seek-to-live-control{align-items:center;cursor:pointer;flex:none;display:inline-flex;height:100%;padding-left:.5em;padding-right:.5em;font-size:1em;line-height:3em;width:auto;min-width:4em}.vjs-no-flex .vjs-seek-to-live-control{display:table-cell;width:auto;text-align:left}.video-js.vjs-live:not(.vjs-liveui) .vjs-seek-to-live-control,.video-js:not(.vjs-live) .vjs-seek-to-live-control{display:none}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge{cursor:auto}.vjs-seek-to-live-control .vjs-icon-placeholder{margin-right:.5em;color:#888}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge .vjs-icon-placeholder{color:red}.video-js .vjs-time-control{flex:none;font-size:1em;line-height:3em;min-width:2em;width:auto;padding-left:1em;padding-right:1em}.vjs-live .vjs-time-control,.video-js .vjs-current-time,.vjs-no-flex .vjs-current-time,.video-js .vjs-duration,.vjs-no-flex .vjs-duration{display:none}.vjs-time-divider{display:none;line-height:3em}.vjs-live .vjs-time-divider{display:none}.video-js .vjs-play-control{cursor:pointer}.video-js .vjs-play-control .vjs-icon-placeholder{flex:none}.vjs-text-track-display{position:absolute;inset:0 0 3em;pointer-events:none}.video-js.vjs-controls-disabled .vjs-text-track-display,.video-js.vjs-user-inactive.vjs-playing .vjs-text-track-display{bottom:1em}.video-js .vjs-text-track{font-size:1.4em;text-align:center;margin-bottom:.1em}.vjs-subtitles{color:#fff}.vjs-captions{color:#fc6}.vjs-tt-cue{display:block}video::-webkit-media-text-track-display{transform:translateY(-3em)}.video-js.vjs-controls-disabled video::-webkit-media-text-track-display,.video-js.vjs-user-inactive.vjs-playing video::-webkit-media-text-track-display{transform:translateY(-1.5em)}.video-js .vjs-picture-in-picture-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-picture-in-picture-control{display:none}.video-js .vjs-fullscreen-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-fullscreen-control{display:none}.vjs-playback-rate>.vjs-menu-button,.vjs-playback-rate .vjs-playback-rate-value{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-playback-rate .vjs-playback-rate-value{pointer-events:none;font-size:1.5em;line-height:2;text-align:center}.vjs-playback-rate .vjs-menu{width:4em;left:0}.vjs-error .vjs-error-display .vjs-modal-dialog-content{font-size:1.4em;text-align:center}.vjs-error .vjs-error-display:before{color:#fff;content:"X";font-family:Arial,Helvetica,sans-serif;font-size:4em;left:0;line-height:1;margin-top:-.5em;position:absolute;text-shadow:.05em .05em .1em #000;text-align:center;top:50%;vertical-align:middle;width:100%}.vjs-loading-spinner{display:none;position:absolute;top:50%;left:50%;margin:-25px 0 0 -25px;opacity:.85;text-align:left;border:6px solid rgba(43,51,63,.7);box-sizing:border-box;background-clip:padding-box;width:50px;height:50px;border-radius:25px;visibility:hidden}.vjs-seeking .vjs-loading-spinner,.vjs-waiting .vjs-loading-spinner{display:block;animation:vjs-spinner-show 0s linear .3s forwards}.vjs-loading-spinner:before,.vjs-loading-spinner:after{content:"";position:absolute;margin:-6px;box-sizing:inherit;width:inherit;height:inherit;border-radius:inherit;opacity:1;border:inherit;border-color:transparent;border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:before,.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:after{animation:vjs-spinner-spin 1.1s cubic-bezier(.6,.2,0,.8) infinite,vjs-spinner-fade 1.1s linear infinite}.vjs-seeking .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:before{border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:after{border-top-color:#fff;animation-delay:.44s}@keyframes vjs-spinner-show{to{visibility:visible}}@keyframes vjs-spinner-spin{to{transform:rotate(360deg)}}@keyframes vjs-spinner-fade{0%{border-top-color:#73859f}20%{border-top-color:#73859f}35%{border-top-color:#fff}60%{border-top-color:#73859f}to{border-top-color:#73859f}}.video-js.vjs-audio-only-mode .vjs-captions-button{display:none}.vjs-chapters-button .vjs-menu ul{width:24em}.video-js.vjs-audio-only-mode .vjs-descriptions-button{display:none}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:"\\f10d";font-size:1.5em;line-height:inherit}.video-js.vjs-audio-only-mode .vjs-subs-caps-button{display:none}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:" \\f11d";font-size:1.5em;line-height:inherit}.video-js.vjs-layout-small .vjs-current-time,.video-js.vjs-layout-small .vjs-time-divider,.video-js.vjs-layout-small .vjs-duration,.video-js.vjs-layout-small .vjs-remaining-time,.video-js.vjs-layout-small .vjs-playback-rate,.video-js.vjs-layout-small .vjs-volume-control,.video-js.vjs-layout-x-small .vjs-current-time,.video-js.vjs-layout-x-small .vjs-time-divider,.video-js.vjs-layout-x-small .vjs-duration,.video-js.vjs-layout-x-small .vjs-remaining-time,.video-js.vjs-layout-x-small .vjs-playback-rate,.video-js.vjs-layout-x-small .vjs-volume-control,.video-js.vjs-layout-tiny .vjs-current-time,.video-js.vjs-layout-tiny .vjs-time-divider,.video-js.vjs-layout-tiny .vjs-duration,.video-js.vjs-layout-tiny .vjs-remaining-time,.video-js.vjs-layout-tiny .vjs-playback-rate,.video-js.vjs-layout-tiny .vjs-volume-control{display:none}.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover{width:auto;width:initial}.video-js.vjs-layout-x-small .vjs-progress-control,.video-js.vjs-layout-tiny .vjs-progress-control{display:none}.video-js.vjs-layout-x-small .vjs-custom-control-spacer{flex:auto;display:block}.video-js.vjs-layout-x-small.vjs-no-flex .vjs-custom-control-spacer{width:auto}.vjs-modal-dialog.vjs-text-track-settings{background-color:#2b333f;background-color:#2b333fbf;color:#fff;height:70%}.vjs-text-track-settings .vjs-modal-dialog-content{display:table}.vjs-text-track-settings .vjs-track-settings-colors,.vjs-text-track-settings .vjs-track-settings-font,.vjs-text-track-settings .vjs-track-settings-controls{display:table-cell}.vjs-text-track-settings .vjs-track-settings-controls{text-align:right;vertical-align:bottom}@supports (display: grid){.vjs-text-track-settings .vjs-modal-dialog-content{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;padding:20px 24px 0}.vjs-track-settings-controls .vjs-default-button{margin-bottom:20px}.vjs-text-track-settings .vjs-track-settings-controls{grid-column:1/-1}.vjs-layout-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-x-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-tiny .vjs-text-track-settings .vjs-modal-dialog-content{grid-template-columns:1fr}}.vjs-track-setting>select{margin-right:1em;margin-bottom:.5em}.vjs-text-track-settings fieldset{margin:5px;padding:3px;border:none}.vjs-text-track-settings fieldset span{display:inline-block}.vjs-text-track-settings fieldset span>select{max-width:7.3em}.vjs-text-track-settings legend{color:#fff;margin:0 0 5px}.vjs-text-track-settings .vjs-label{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);display:block;margin:0 0 5px;padding:0;border:0;height:1px;width:1px;overflow:hidden}.vjs-track-settings-controls button:focus,.vjs-track-settings-controls button:active{outline-style:solid;outline-width:medium;background-image:linear-gradient(0deg,#fff 88%,#73859f)}.vjs-track-settings-controls button:hover{color:#2b333fbf}.vjs-track-settings-controls button{background-color:#fff;background-image:linear-gradient(-180deg,#fff 88%,#73859f);color:#2b333f;cursor:pointer;border-radius:2px}.vjs-track-settings-controls .vjs-default-button{margin-right:1em}@media print{.video-js>*:not(.vjs-tech):not(.vjs-poster){visibility:hidden}}.vjs-resize-manager{position:absolute;top:0;left:0;width:100%;height:100%;border:none;z-index:-1000}.js-focus-visible .video-js *:focus:not(.focus-visible){outline:none}.video-js *:focus:not(:focus-visible){outline:none}.video-js.vjs-fluid{width:1280px}.video-js .vjs-time-control{padding:0 4px!important;min-width:auto!important;height:30px!important;font-size:12px;align-items:center}.video-js .vjs-volume-control,.video-js .vjs-time-control{display:flex!important}.video-js :not(.vjs-has-started) .vjs-big-play-button{display:flex}.video-js .vjs-icon-placeholder:before{font-family:"Font Awesome 6 Pro"}.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{font-family:VideoJS}.video-js .vjs-big-play-button{align-items:center;justify-content:center;border:none!important;border-radius:50%!important;background-color:#101823cc!important;top:50%;left:50%;height:60px!important;width:60px!important;margin-left:-30px;margin-top:-30px;font-size:24px;transition:none!important}.video-js .vjs-big-play-button .vjs-icon-placeholder{margin-right:-8%}.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:static;content:"\\f04b";font-family:"Font Awesome 6 Pro";font-weight:900}.video-js .vjs-play-control .vjs-icon-placeholder:before{content:"\\f04b"}.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f04c"}.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f2ea"}.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f6a8"}.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f2e2"}.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f065"}.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f066"}.video-js .vjs-control-bar{flex-wrap:wrap;height:5em}.video-js .vjs-control{height:3em}.video-js .vjs-progress-control{width:100%!important;height:2em!important}.video-js .vjs-custom-control-spacer{display:block;flex:auto}.video-js .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.5em;line-height:2em}.video-js.vjs-layout-tiny .vjs-control-bar{height:4.5em}.video-js.vjs-layout-tiny .vjs-control{height:2.5em;width:2.5em}.video-js.vjs-layout-tiny .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.2em;line-height:2.2em}.video-js.vjs-layout-tiny .vjs-button>.vjs-icon-placeholder:before{font-size:1.6em}.video-js.vjs-layout-tiny .vjs-progress-control{display:flex!important}.video-js.vjs-layout-tiny .vjs-progress-control .vjs-progress-holder{margin:0 8px}.video-js.vjs-layout-tiny .vjs-time-control{display:none!important}.video-js.vjs-layout-tiny .vjs-volume-bar.vjs-slider-vertical{height:4em!important}.video-js.vjs-layout-tiny .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:6em!important;bottom:6em!important;width:2.5em!important}.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-2.5em!important}.video-js.vjs-layout-tiny .vjs-big-play-button{height:48px!important;width:48px!important;margin-left:-24px;margin-top:-24px;font-size:18px}.video-js.vjs-layout-x-small .vjs-progress-control{display:flex!important}.video-js.vjs-layout-x-small .vjs-control{width:3em}.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-3em!important}.vjs-error .vjs-error-display:before{content:"";display:none}\n'],encapsulation:2,changeDetection:0}),t})();function gO(n,t){if(1&n&&e.nrm(0,"app-video-view",10),2&n){const o=e.XpG(),i=o.$implicit,s=o.index,r=e.XpG(2);e.AVh("videos-block__video--next-sibling",s>0),e.Y8G("sources",i.sources)("mode",r.mode)}}function hO(n,t){1&n&&(e.j41(0,"div",15),e.pXf(1,1),e.k0s())}function mO(n,t){if(1&n&&(e.j41(0,"div",11)(1,"div",12)(2,"div",13),e.pXf(3,0),e.k0s(),e.DNE(4,hO,2,0,"div",14),e.k0s()()),2&n){const o=e.XpG().index,i=e.XpG(2);e.AVh("videos-block__video--next-sibling",o>0),e.R7$(4),e.Y8G("ngIf",i.emailMessage)}}function fO(n,t){if(1&n&&e.nrm(0,"app-html",16),2&n){const o=e.XpG().$implicit;e.Y8G("markdownText",o.caption)}}function SO(n,t){if(1&n&&(e.j41(0,"div"),e.qex(1,6),e.DNE(2,gO,1,4,"app-video-view",7)(3,mO,5,3,"div",8),e.bVm(),e.DNE(4,fO,1,1,"app-html",9),e.k0s()),2&n){const o=t.$implicit;e.R7$(),e.Y8G("ngSwitch",o.transcoded),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngIf",o.caption)}}function bO(n,t){if(1&n&&(e.j41(0,"div",3)(1,"div",4),e.DNE(2,SO,5,4,"div",5),e.k0s()()),2&n){const o=e.XpG();e.HbH("videos-block--"+o.layout),e.R7$(2),e.Y8G("ngForOf",o.videos)("ngForTrackBy",o.trackVideo)}}let yO=(()=>{var n;class t{get videosBlock(){return this._videosBlock}set videosBlock(i){this._videosBlock=i,this.videos=(0,m.get)(i,"videos",[]).map(s=>{const r={...s};return this.checkTranscodingStatus(r),r}),this.hasVideos=this.videos.length>0}constructor(i,s){this.mediaService=i,this.changeRef=s,this.layout=za.Normal,this.mode=td.Full,this.emailMessage=!1,this.videos=[],this.hasVideos=!1}checkTranscodingStatus(i){this.mediaService.checkVideoStatus(i.url).pipe((0,tn.s)(1)).subscribe(s=>{s&&"boolean"!=typeof s?(i.sources=s,i.transcoded=!0):i.transcoded=!1,this.changeRef.markForCheck()})}trackVideo(i,s){return s.url}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Ci),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-videos-block"]],inputs:{layout:"layout",mode:"mode",emailMessage:"emailMessage",videosBlock:"videosBlock"},decls:1,vars:1,consts:()=>{let o,i;return o=$localize`:76807dc051a8773b9486978f33c7f05090c566fb2265850775265912967:Processing Video`,i=$localize`:3e4738ac862bbcd7a02a7355fe93de2f32521c544720931509138129579:Check your email for updates.`,[o,i,["class","videos-block","data-test","videoBlock",3,"class",4,"ngIf"],["data-test","videoBlock",1,"videos-block"],[1,"videos-block__content"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],["class","videos-block__video videos-block__video-view",3,"sources","mode","videos-block__video--next-sibling",4,"ngSwitchCase"],["class","videos-block__video videos-block__video-processing",3,"videos-block__video--next-sibling",4,"ngSwitchCase"],["class","videos-block__video-caption",3,"markdownText",4,"ngIf"],[1,"videos-block__video","videos-block__video-view",3,"sources","mode"],[1,"videos-block__video","videos-block__video-processing"],[1,"videos-block__video-processing-content"],[1,"text-xs","font-semibold"],["class","text-2xs mt-1",4,"ngIf"],[1,"text-2xs","mt-1"],[1,"videos-block__video-caption",3,"markdownText"]]},template:function(i,s){1&i&&e.DNE(0,bO,3,4,"div",2),2&i&&e.Y8G("ngIf",s.hasVideos)},dependencies:[q.Sq,q.bT,q.ux,q.e1,Zo,cS],styles:[".videos-block[_ngcontent-%COMP%]{color:#374a68}.videos-block__video[_ngcontent-%COMP%]{display:block}.videos-block__video--next-sibling[_ngcontent-%COMP%]{margin-top:20px}.videos-block__video-processing[_ngcontent-%COMP%]{padding-top:56.25%;position:relative;display:flex;justify-content:center;background-color:#fff;text-align:center;border:1px solid #96a8c0;border-radius:4px;min-width:180px}.videos-block__video-processing-content[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:0 8px}.videos-block__video-caption[_ngcontent-%COMP%]{display:block;font-size:12px;margin-top:12px}.videos-block--compact[_ngcontent-%COMP%]   .videos-block__video-caption[_ngcontent-%COMP%]{font-size:10px;margin-top:4px}"],changeDetection:0}),t})();class vO{constructor(){this.type=uo.m.Positions,this.positions=[]}}_(93455);const EO=["thumbnailView"];let CO=(()=>{var n;class t{get thumbnail(){return this._thumbnail}set thumbnail(i){(0,m.isEqual)(this._thumbnail,i)||(this._thumbnail=i,null!=i?this.setImageStyle():this.clearImageStyle())}constructor(i){this.renderer=i}setImageStyle(){let i=this.thumbnail.snapshot||this.thumbnail.urls.small;const s=(new Date).valueOf();i.startsWith("blob:")||(i=`${i}?cb=${s}&uncached=true`);const r=new Image;r.src=i,r.onload=()=>{this.renderer.setStyle(this.thumbnailView.nativeElement,"background-size","cover"),this.renderer.setStyle(this.thumbnailView.nativeElement,"background-image",`url(${i})`)}}clearImageStyle(){this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-size"),this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-image")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-thumbnail-view"]],viewQuery:function(i,s){if(1&i&&e.GBs(EO,7,e.aKT),2&i){let r;e.mGM(r=e.lsd())&&(s.thumbnailView=r.first)}},inputs:{thumbnail:"thumbnail"},decls:2,vars:0,consts:[["thumbnailView",""],[1,"thumbnail-view"]],template:function(i,s){1&i&&e.nrm(0,"div",1,0)},styles:[".thumbnail-view[_ngcontent-%COMP%]{background-color:#283853;background-image:url(/assets/images/logo-dark-transparent.svg);background-position:center center;background-repeat:no-repeat;background-size:25% 25%;border-radius:4px;height:100%;width:100%}.theme-light[_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%]{background-color:#eaeff5}"],changeDetection:0}),t})();function TO(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",2)(1,"button",3),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.handlePositionClick(s))}),e.j41(2,"div",4),e.nrm(3,"app-thumbnail-view",5),e.k0s(),e.j41(4,"div",6),e.EFF(5),e.k0s()()()}if(2&n){const o=t.$implicit;e.R7$(3),e.Y8G("thumbnail",o.thumbnail),e.R7$(2),e.JRh(o.title)}}let OO=(()=>{var n;class t{constructor(i){this.store=i}handlePositionClick(i){this.store.dispatch(new jt.Ih(i.camera.location,i.camera.action===T_.L.FlyTo,void 0,i.camera.rotationCenter))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-position-block"]],inputs:{positionBlock:"positionBlock"},decls:2,vars:1,consts:[[1,"view-positions"],["class","view-positions__list-item",4,"ngFor","ngForOf"],[1,"view-positions__list-item"],[1,"view-positions__item",3,"click"],[1,"view-positions__thumbnail"],[3,"thumbnail"],[1,"view-positions__title"]],template:function(i,s){1&i&&(e.j41(0,"ul",0),e.DNE(1,TO,6,2,"li",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",s.positionBlock.positions))},dependencies:[q.Sq,CO],styles:[".view-positions__list-item[_ngcontent-%COMP%]{padding-bottom:8px}.view-positions__item[_ngcontent-%COMP%]{background:none;border:0;display:flex;padding:12px 12px 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:start;align-items:center}.view-positions__item[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.view-positions__item[_ngcontent-%COMP%]:hover, .view-positions__item--selected[_ngcontent-%COMP%]:hover{background-color:#131c2a0d}.view-positions__item--selected[_ngcontent-%COMP%]   .view-positions__title[_ngcontent-%COMP%]{font-weight:600}.view-positions__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-inline-end:12px;border:1px solid #eaeff5;border-radius:4px}.view-positions__title[_ngcontent-%COMP%]{color:#131c2a;font-size:.875rem;line-height:1.25rem;word-break:break-word}"],changeDetection:0}),t})();function MO(n,t){if(1&n&&e.nrm(0,"app-ticker-block",9),2&n){const o=e.XpG(2).$implicit;e.Y8G("tickerBlock",o)}}function IO(n,t){if(1&n&&(e.qex(0),e.DNE(1,MO,1,1,"app-ticker-block",8),e.bVm()),2&n){const o=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",o.enable)}}function wO(n,t){if(1&n&&e.nrm(0,"app-markdown-block",10),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.Y8G("markdownBlock",o)("layout",i.layout)}}function PO(n,t){if(1&n&&e.nrm(0,"app-images-block",11),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.Y8G("imagesBlock",o)("layout",i.layout)}}function AO(n,t){if(1&n&&e.nrm(0,"app-videos-block",12),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.Y8G("videosBlock",o)("layout",i.layout)}}function NO(n,t){if(1&n&&e.nrm(0,"app-position-block",13),2&n){const o=e.XpG().$implicit;e.Y8G("positionBlock",o)}}function RO(n,t){if(1&n&&(e.j41(0,"div"),e.qex(1,2),e.DNE(2,IO,2,1,"ng-container",3)(3,wO,1,2,"app-markdown-block",4)(4,PO,1,2,"app-images-block",5)(5,AO,1,2,"app-videos-block",6)(6,NO,1,1,"app-position-block",7),e.bVm(),e.k0s()),2&n){const o=t.$implicit,i=t.index,s=e.XpG(2);e.AVh("mt-6",i>0),e.R7$(),e.Y8G("ngSwitch",o.type),e.R7$(),e.Y8G("ngSwitchCase",s.contentBlockTypes.Ticker),e.R7$(),e.Y8G("ngSwitchCase",s.contentBlockTypes.Markdown),e.R7$(),e.Y8G("ngSwitchCase",s.contentBlockTypes.Images),e.R7$(),e.Y8G("ngSwitchCase",s.contentBlockTypes.Videos),e.R7$(),e.Y8G("ngSwitchCase",s.contentBlockTypes.Positions)}}function DO(n,t){if(1&n&&(e.qex(0),e.DNE(1,RO,7,8,"div",1),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.contentBlocks)("ngForTrackBy",o.trackContentBlock)}}let Nr=(()=>{var n;class t{get contentBlocks(){return this.contentBlocksService.filterContentBlocksByType(this._contentBlocks,this.include,this.exclude)}set contentBlocks(i){this._contentBlocks=i}constructor(i){this.contentBlocksService=i,this.contentBlockTypes=uo.m,this._contentBlocks=[],this.layout=za.Normal,this.include=[],this.exclude=[]}trackContentBlock(i,s){return s.type}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Wa.V))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-content-blocks"]],inputs:{contentBlocks:"contentBlocks",layout:"layout",include:"include",exclude:"exclude"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"mt-6",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"markdownBlock","layout",4,"ngSwitchCase"],[3,"imagesBlock","layout",4,"ngSwitchCase"],[3,"videosBlock","layout",4,"ngSwitchCase"],[3,"positionBlock",4,"ngSwitchCase"],[3,"tickerBlock",4,"ngIf"],[3,"tickerBlock"],[3,"markdownBlock","layout"],[3,"imagesBlock","layout"],[3,"videosBlock","layout"],[3,"positionBlock"]],template:function(i,s){1&i&&e.DNE(0,DO,2,2,"ng-container",0),2&i&&e.Y8G("ngIf",s.contentBlocks.length>0)},dependencies:[q.Sq,q.bT,q.ux,q.e1,mu,ZT,_O,yO,OO],encapsulation:2,changeDetection:0}),t})();var Qa,dS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},_S=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const kO=["body"];function LO(n,t){if(1&n&&(e.nrm(0,"div",6),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const o=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,o.label.description)),e.npT)}}function UO(n,t){if(1&n&&(e.j41(0,"div",7),e.nrm(1,"app-content-blocks",8),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("contentBlocks",o.label.contentBlocks)("layout","compact")}}class nd{get isCollapsed(){if(this.collapsedMode===_a.Q.Toggle){const t=this.store.selectSnapshot(Ze.getSelectedLabelId)===this.label.id;return this.collapsed&&!t}return this.collapsed}get hasContent(){return this.labelsService.hasContent(this.label)}constructor(t,o,i,s){this.changeDetectorRef=t,this.labelsService=o,this.store=i,this.applicationEventService=s,this.emitEvents=!0,this.collapsedMode=_a.Q.None,this.collapsed=!1,this.pinDraggable=!1,this.tagDraggable=!1,this.descriptionCollapsed=!1,this.tagCollapsed=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.selectedLabel$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(o=>this.handleLabelSelected(o)),this.store.select(Ze.getChapterLabels).pipe((0,b.Q)(this.ngUnsubscribe),(0,Fn.B)(100)).subscribe(()=>{this.sequence=this.store.selectSnapshot(Ze.getLabelSequence(this.label)),this.changeDetectorRef.markForCheck()}),this.descriptionCollapsed=this.label.collapseDescription,this.tagCollapsed=this.label.hideTag||!(this.label.title||this.hasContent)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleLabelUpdated(t){const{label:o,shouldPreserve:i}=t;this.store.dispatch(new He.lb(o,i))}handleOffsetUpdated(t){const{labelId:o,offset:i}=t;this.store.dispatch(new He.yi(o,i))}handlePinClicked(t){this.selectLabel()}handleTagClicked(t){this.selectLabel()}selectLabel(){const t=this.store.selectSnapshot(Ze.getSelectedLabel);this.store.dispatch(new He.TR(t&&t.id===this.label.id?null:this.label)),this.emitEvent(nt.F.HotspotsPicked,{id:this.label.id}),this.emitEvent(nt.F.LabelsPicked,{labelId:this.label.id})}emitEvent(t,o){this.emitEvents&&this.applicationEventService.fireEvent(t,o)}handleDisplayUpdated(t){this.setBodyOpacity(t.shown),this.emitEvent(nt.F.HotspotsDisplayUpdated,t)}handlePositionUpdated(t){this.emitEvent(nt.F.HotspotsPositionUpdated,t.positionUpdate),this.emitEvent(nt.F.LabelsMoved,{labelId:t.positionUpdate.id,canvasPosition:[t.positionUpdate.canvasPos.x,t.positionUpdate.canvasPos.y],occluded:t.positionUpdate.occluded||!t.onCanvas})}handleHoverStart(t){this.emitEvent(nt.F.HotspotsEntered,{id:t.labelId}),this.emitEvent(nt.F.LabelsEntered,{labelId:t.labelId})}handleHoverEnd(t){this.emitEvent(nt.F.HotspotsLeft,{id:t.labelId}),this.emitEvent(nt.F.LabelsLeft,{labelId:t.labelId})}handleLabelSelected(t){const o=t&&t.id===this.label.id,i=(0,m.get)(t,"states[1].errands"),s=this.store.selectSnapshot(fi.x.getLockCamera);o&&i&&!s&&i.forEach(a=>{switch(a.type){case xo.X.flyToObject:this.store.dispatch(new st.W6(a.value));break;case xo.X.flyToCamera:this.store.dispatch(new jt.Ih(a.value))}this.store.dispatch(new jt.Xz(!0))}),this.tagCollapsed=!this.label.title&&!this.hasContent||(this.label.expandTag&&this.label.hideTag?!o:this.label.hideTag),this.descriptionCollapsed=this.label.showDescription&&this.label.collapseDescription?!o:this.label.collapseDescription}handleBodyPointerDown(t){const o=this.body.nativeElement,i=o.offsetWidth-o.clientWidth;if(i>0){const r=o.getBoundingClientRect().right-i;t.clientX>r&&t.stopPropagation()}}handleBodyWheel(t){const o=this.body.nativeElement;o.scrollHeight>o.clientHeight&&t.stopPropagation()}setBodyOpacity(t){const o=this.body.nativeElement;t?o.style.removeProperty("opacity"):o.style.opacity="0"}}(Qa=nd).\u0275fac=function(t){return new(t||Qa)(e.rXU(e.gRc),e.rXU(qc.x),e.rXU(l.il),e.rXU(po.S))},Qa.\u0275cmp=e.VBU({type:Qa,selectors:[["app-story-label"]],viewQuery:function(t,o){if(1&t&&e.GBs(kO,7),2&t){let i;e.mGM(i=e.lsd())&&(o.body=i.first)}},inputs:{label:"label",emitEvents:"emitEvents",collapsedMode:"collapsedMode",collapsed:"collapsed",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},decls:10,vars:20,consts:[["body",""],[1,"story-label",3,"labelUpdated","offsetUpdated","tagClicked","pinClicked","keydown.enter","displayUpdated","positionUpdated","hoverStart","hoverEnd","label","selected","fixedScale","sequence","isCollapsed","tagCollapsed","pinDraggable","tagDraggable","descriptionCollapsed","hasContent"],["label-header","",1,"html",3,"innerHTML"],["label-body","",1,"story-label__body","html",3,"pointerdown","wheel"],["data-test","labelDescription",3,"innerHTML",4,"ngIf"],["class","my-1","appEventFence","","style","cursor: auto",4,"ngIf"],["data-test","labelDescription",3,"innerHTML"],["appEventFence","",1,"my-1",2,"cursor","auto"],[3,"contentBlocks","layout"]],template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"app-generic-label",1),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("labelUpdated",function(r){return e.eBV(i),e.Njj(o.handleLabelUpdated(r))})("offsetUpdated",function(r){return e.eBV(i),e.Njj(o.handleOffsetUpdated(r))})("tagClicked",function(r){return e.eBV(i),e.Njj(o.handleTagClicked(r))})("pinClicked",function(r){return e.eBV(i),e.Njj(o.handlePinClicked(r))})("keydown.enter",function(r){return e.eBV(i),e.Njj(o.handleTagClicked(r))})("displayUpdated",function(r){return e.eBV(i),e.Njj(o.handleDisplayUpdated(r))})("positionUpdated",function(r){return e.eBV(i),e.Njj(o.handlePositionUpdated(r))})("hoverStart",function(r){return e.eBV(i),e.Njj(o.handleHoverStart(r))})("hoverEnd",function(r){return e.eBV(i),e.Njj(o.handleHoverEnd(r))}),e.nrm(3,"div",2),e.nI1(4,"markdown"),e.nI1(5,"async"),e.j41(6,"div",3,0),e.bIt("pointerdown",function(r){return e.eBV(i),e.Njj(o.handleBodyPointerDown(r))})("wheel",function(r){return e.eBV(i),e.Njj(o.handleBodyWheel(r))}),e.DNE(8,LO,3,5,"div",4)(9,UO,2,2,"div",5),e.k0s()()}if(2&t){let i;e.Y8G("label",o.label)("selected",(null==(i=e.bMT(1,12,o.selectedLabel$))?null:i.id)===o.label.id)("fixedScale",e.bMT(2,14,o.labelScale$))("sequence",o.sequence)("isCollapsed",o.isCollapsed)("tagCollapsed",o.tagCollapsed)("pinDraggable",o.pinDraggable)("descriptionCollapsed",o.descriptionCollapsed)("hasContent",o.hasContent),e.R7$(3),e.Y8G("innerHTML",e.bMT(5,18,e.bMT(4,16,o.label.title)),e.npT),e.R7$(5),e.Y8G("ngIf",o.label.description),e.R7$(),e.Y8G("ngIf",o.label.contentBlocks)}},dependencies:[q.bT,Zc.L,Nr,Ar,q.Jj,pi.i0],styles:[".story-label__body[_ngcontent-%COMP%]{max-height:120px;overflow-x:hidden;overflow-y:auto;margin-right:-8px;padding-right:8px}"],changeDetection:0}),dS([(0,l.l6)(Ze.getLabelScale),_S("design:type",y.c)],nd.prototype,"labelScale$",void 0),dS([(0,l.l6)(Ze.getSelectedLabel),_S("design:type",y.c)],nd.prototype,"selectedLabel$",void 0);var we=_(89417);let jO=(()=>{var n;class t{get control(){return this.formControl||this.controlContainer.control.get(this.formControlName)}constructor(i){this.controlContainer=i}registerOnTouched(i){this.formControlDirective.valueAccessor.registerOnTouched(i)}registerOnChange(i){this.formControlDirective.valueAccessor.registerOnChange(i)}writeValue(i){this.formControlDirective.valueAccessor.writeValue(i)}setDisabledState(i){this.formControlDirective.valueAccessor.setDisabledState(i)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(we.ZU))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-base-accessor-control"]],viewQuery:function(i,s){if(1&i&&e.GBs(we.l_,7),2&i){let r;e.mGM(r=e.lsd())&&(s.formControlDirective=r.first)}},inputs:{formControl:"formControl",formControlName:"formControlName"},decls:0,vars:0,template:function(i,s){},encapsulation:2}),t})(),VO=(()=>{var n;class t{get value(){return this._value}set value(i){(0,m.isEqual)(this._value,i)||(this._value=i,this.setFormValues(i),this.onChange(i))}constructor(){}onChange(i){}onTouched(){}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}writeValue(i){this.value=i}setDisabledState(i){this.disabled=i}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-abstract-input-control"]],inputs:{value:"value",disabled:"disabled"},decls:0,vars:0,template:function(i,s){},encapsulation:2}),t})();function xO(n,t){if(1&n&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&n){const o=t.$implicit;e.Y8G("value",o.value),e.R7$(),e.SpI(" ",o.label.title," ")}}function FO(n,t){if(1&n&&(e.j41(0,"select",6)(1,"option",7),e.EFF(2,"Select"),e.k0s(),e.DNE(3,xO,2,2,"option",8),e.k0s()),2&n){const o=e.XpG();e.R7$(3),e.Y8G("ngForOf",o.options)}}let pS=(()=>{var n;class t extends VO{get options(){return this._options}set options(i){const s=(0,m.clone)(i);this._options=s.sort((r,a)=>r.label.title.localeCompare(a.label.title)),this.changeRef.markForCheck()}constructor(i,s){super(),this.formBuilder=i,this.changeRef=s,this.outline=!0,this.valueChange=new e.bkB,this.ngUnsubscribe=new Q.B,this.form=this.formBuilder.group({value:[""]}),this.valueControl=this.form.get("value")}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({value:i})=>{this.writeValue(i),this.valueChange.next(i)})}setDisabledState(i){super.setDisabledState(i),i?this.form.disable():this.form.enable(),this.changeRef.markForCheck()}setFormValues(i){this.valueControl.setValue(i),this.changeRef.markForCheck()}getSelectedOption(){const i=this.valueControl.value;return this.options.find(s=>s.value===i)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(we.ze),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-quiz-label-anatomy-select"]],inputs:{options:"options",outline:"outline"},outputs:{valueChange:"valueChange"},features:[e.Jv_([{provide:we.kq,useExisting:(0,e.Rfq)(()=>n),multi:!0}]),e.Vt3],decls:7,vars:5,consts:[[1,"label",3,"formGroup"],[1,"label__select-label","flex","text-xs"],[1,"flex","justify-between","p-2","flex-auto"],[1,"mr-2"],["icon","caret-down","size","lg"],["class","input label__select","placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",4,"ngIf"],["placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",1,"input","label__select"],["value","","data-test","questionAnswerOption"],["class","label__option","data-test","questionAnswerOption",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswerOption",1,"label__option",3,"value"]],template:function(i,s){if(1&i&&(e.j41(0,"div",0)(1,"label",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.nrm(5,"app-icon",4),e.k0s(),e.DNE(6,FO,4,1,"select",5),e.k0s()()),2&i){let r;e.AVh("label--empty",""===s.valueControl.value),e.Y8G("formGroup",s.form),e.R7$(4),e.JRh((null==(r=s.getSelectedOption())||null==r.label?null:r.label.title)||"Select"),e.R7$(2),e.Y8G("ngIf",!s.disabled)}},dependencies:[q.Sq,q.bT,yt.R,we.xH,we.y7,we.wz,we.BC,we.cb,we.j4,we.JD],styles:[".label[_ngcontent-%COMP%]{overflow:hidden}.label__select-label[_ngcontent-%COMP%]{color:#101823;position:relative}.label__select[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;opacity:.01}.label--empty[_ngcontent-%COMP%]   .label__select-label[_ngcontent-%COMP%]{color:#96a8c0}"],changeDetection:0}),t})();var $s;function BO(n,t){1&n&&e.nrm(0,"app-icon",8)}function zO(n,t){1&n&&e.nrm(0,"app-icon",9)}function WO(n,t){if(1&n&&(e.j41(0,"div",10)(1,"em",11),e.EFF(2),e.k0s(),e.EFF(3,". "),e.k0s()),2&n){const o=e.XpG(2);e.R7$(2),e.JRh(o.option.label.title)}}function XO(n,t){if(1&n&&(e.j41(0,"div",10)(1,"p",12),e.EFF(2," You selected "),e.j41(3,"em",11),e.EFF(4),e.k0s(),e.EFF(5,". "),e.k0s(),e.j41(6,"p"),e.EFF(7," This is the "),e.j41(8,"em",11),e.EFF(9),e.k0s(),e.EFF(10,". "),e.k0s()()),2&n){let o;const i=e.XpG(2);e.R7$(4),e.JRh(null==(o=i.getSelectedLabel(i.options,i.control.value))?null:o.title.trim()),e.R7$(5),e.JRh(i.option.label.title.trim())}}function HO(n,t){if(1&n&&(e.j41(0,"div",4),e.DNE(1,BO,1,0,"app-icon",5)(2,zO,1,0,"app-icon",6)(3,WO,4,1,"div",7)(4,XO,11,2,"div",7),e.k0s()),2&n){const o=e.XpG();e.Y8G("ngSwitch",o.correct),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1)}}class fu extends jO{constructor(){super(...arguments),this.sequence=0,this.labelUpdated=new e.bkB}ngOnInit(){}handleLabelUpdated(t){this.labelUpdated.next(t.label)}handleOffsetUpdated(t){this.labelUpdated.next({...this.option.label,offset:t.offset})}getSelectedLabel(t,o){const i=this.options.find(s=>s.value===o);return i?i.label:void 0}}($s=fu).\u0275fac=(()=>{let n;return function(o){return(n||(n=e.xGo($s)))(o||$s)}})(),$s.\u0275cmp=e.VBU({type:$s,selectors:[["app-quiz-label"]],inputs:{sequence:"sequence",collapsed:"collapsed",options:"options",option:"option",correct:"correct",mode:"mode"},outputs:{labelUpdated:"labelUpdated"},features:[e.Jv_([{provide:we.kq,useExisting:(0,e.Rfq)(()=>$s),multi:!0}]),e.Vt3],decls:5,vars:17,consts:[[1,"label","theme-light",3,"labelUpdated","offsetUpdated","label","fit","opaque","fixedScale","pinDraggable","tagDraggable","isCollapsed","descriptionCollapsed","hasContent","sequence"],["label-body","",1,"label__body"],[3,"outline","hidden","options","formControl"],["class","label__summary flex items-start",3,"ngSwitch",4,"ngIf"],[1,"label__summary","flex","items-start",3,"ngSwitch"],["class","label__icon label__icon--correct","style","font-size: 16px","icon","check-circle",4,"ngSwitchCase"],["class","label__icon label__icon--incorrect","style","font-size: 16px","icon","times-circle",4,"ngSwitchCase"],["class","label__text pl-2",4,"ngSwitchCase"],["icon","check-circle",1,"label__icon","label__icon--correct",2,"font-size","16px"],["icon","times-circle",1,"label__icon","label__icon--incorrect",2,"font-size","16px"],[1,"label__text","pl-2"],[1,"font-semibold"],[1,"pb-2"]],template:function(t,o){1&t&&(e.j41(0,"app-generic-label",0),e.nI1(1,"async"),e.bIt("labelUpdated",function(s){return o.handleLabelUpdated(s)})("offsetUpdated",function(s){return o.handleOffsetUpdated(s)}),e.j41(2,"div",1),e.nrm(3,"app-quiz-label-anatomy-select",2),e.DNE(4,HO,5,5,"div",3),e.k0s()()),2&t&&(e.Y8G("label",o.option.label)("fit","summary"===o.mode?"fixed":"auto")("opaque",!0)("fixedScale",e.bMT(1,15,o.labelScale$))("pinDraggable","edit"===o.mode)("tagDraggable",!0)("isCollapsed",o.collapsed)("descriptionCollapsed",!1)("hasContent",!0)("sequence",o.sequence),e.R7$(3),e.Y8G("outline",!1)("hidden","summary"===o.mode)("options",o.options)("formControl",o.control),e.R7$(),e.Y8G("ngIf","summary"===o.mode))},dependencies:[q.bT,q.ux,q.e1,yt.R,we.BC,we.l_,pS,Ar,q.Jj],styles:[".label__body[_ngcontent-%COMP%]{color:#101823;min-width:142px;max-width:200px}.label__icon[_ngcontent-%COMP%]{position:relative;flex-basis:0 0 20px;justify-content:center}.label__icon--correct[_ngcontent-%COMP%]{color:#83e692}.label__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}.label__text[_ngcontent-%COMP%]{flex-wrap:wrap}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ze.getLabelScale),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],fu.prototype,"labelScale$",void 0);var Ya,Rr=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Dr=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function QO(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"app-quiz-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.bIt("labelUpdated",function(s){const r=e.eBV(o).index,a=e.XpG();return e.Njj(a.handleLabelUpdated(s,r))}),e.k0s(),e.bVm()}if(2&n){const o=t.$implicit,i=t.index,s=e.XpG();e.R7$(),e.Y8G("mode",s.mode)("formControl",o)("option",e.bMT(2,7,s.quizLabels$)[i])("options",e.bMT(3,9,s.quizLabels$))("sequence",i+1)("correct",s.isCorrect(e.bMT(4,11,s.quizLabels$)[i],e.bMT(5,13,s.activeSubmitted$),i))("collapsed",e.bMT(6,15,s.labelsCollapsed$))}}class es{constructor(t,o,i,s){this.store=t,this.formBuilder=o,this.changeRef=i,this.router=s,this.ngUnsubscribe=new Q.B,this.mode="edit",this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.initQuizSubmissionListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.quizLabels$.pipe((0,xn.F)((t,o)=>{const i=t.map(r=>r.value),s=o.map(r=>r.value);return(0,m.isEqual)(i,s)}),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(Ue.j.getQuizModeActive);this.buildFormOptions(t,o),this.changeRef.markForCheck()}),(0,Ht.z)([this.quizModeActive$,this.quizLabels$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.setFormEnabled(t),this.changeRef.markForCheck()})}initQuizSubmissionListeners(){this.activeSubmission$.pipe((0,S.p)(t=>!(0,m.isNil)(t)&&!(0,m.isNil)(t.answer)&&Array.isArray(t.answer)),(0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=t.answer;(0,m.isEqual)(this.form.value.options,i)||(this.form.patchValue({options:i},{emitEvent:!1,onlySelf:!0}),this.changeRef.markForCheck())}),this.form.valueChanges.pipe((0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(Ue.j.getActiveQuestionId),i=this.store.selectSnapshot(Ue.j.getActiveSubmitted),s=this.store.selectSnapshot(Ue.j.getActiveSubmission),r=(0,m.isNil)(s)?[]:s.answer,a=t.options;(0,m.isNil)(i)&&((0,m.isEqual)(a,r)||this.store.dispatch(new Bt.B.SetActiveSubmission({questionId:o,answer:a})),this.changeRef.markForCheck())}),(0,Ht.z)([this.quizModeActive$,this.activeSubmitted$]).subscribe(([t,o])=>{this.mode=this.router.url.includes("/edit")?"edit":t&&!(0,m.isNil)(o)?"summary":"view",this.changeRef.markForCheck()})}isCorrect(t,o,i){if(!(0,m.isNil)(o))return o.answer[i]===t.value}handleLabelUpdated(t,o){const i=this.store.selectSnapshot(Ue.j.getActiveQuestion);i.data.options[o].label=t,this.store.dispatch(new Bt.B.SetQuestion(i))}buildFormOptions(t,o){this.optionsArray.clear(),t.forEach(i=>{this.optionsArray.push(this.formBuilder.control(o?"":i.value))})}setFormEnabled(t){t?this.optionsArray.enable():this.optionsArray.disable()}}(Ya=es).\u0275fac=function(t){return new(t||Ya)(e.rXU(l.il),e.rXU(we.ze),e.rXU(e.gRc),e.rXU(ne.Ix))},Ya.\u0275cmp=e.VBU({type:Ya,selectors:[["app-quiz-labels"]],decls:3,vars:2,consts:[["data-test","quizLabelsElement",3,"formGroup"],["formArrayName","options"],[4,"ngFor","ngForOf"],["data-test","appQuizLabel",3,"labelUpdated","mode","formControl","option","options","sequence","correct","collapsed"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,QO,7,17,"ng-container",2),e.k0s()()),2&t&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.optionsArray.controls))},dependencies:[q.Sq,we.BC,we.cb,we.l_,we.j4,we.v8,fu,q.Jj],changeDetection:0}),Rr([(0,l.l6)(Ze.getLabelsCollapsed),Dr("design:type",y.c)],es.prototype,"labelsCollapsed$",void 0),Rr([(0,l.l6)(Ue.j.getActiveQuestionLabels),Dr("design:type",y.c)],es.prototype,"quizLabels$",void 0),Rr([(0,l.l6)(Ue.j.getQuizModeActive),Dr("design:type",y.c)],es.prototype,"quizModeActive$",void 0),Rr([(0,l.l6)(Ue.j.getAllSubmissions),Dr("design:type",y.c)],es.prototype,"allSubmissions$",void 0),Rr([(0,l.l6)(Ue.j.getActiveSubmission),Dr("design:type",y.c)],es.prototype,"activeSubmission$",void 0),Rr([(0,l.l6)(Ue.j.getActiveSubmitted),Dr("design:type",y.c)],es.prototype,"activeSubmitted$",void 0);var Ka,li=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ci=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function YO(n,t){if(1&n&&(e.nrm(0,"app-context-label",5),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async")),2&n){let o,i,s;const r=e.XpG(3);e.Y8G("label",e.bMT(1,4,r.contextLabel$))("enableInfo",e.bMT(2,6,r.enableContextLabelInfo$)&&(null==(o=e.bMT(3,8,r.viewUI$))?null:o.nodeInfo.enable))("enableActions",e.bMT(4,10,r.enableContextLabelActions$)&&(null==(i=e.bMT(5,12,r.viewUI$))?null:i.contextActions.enable))("enableAudio",e.bMT(6,14,r.enableContextLabelAudio$)&&(null==(s=e.bMT(7,16,r.viewUI$))?null:s.nodeAudio.enable))}}function KO(n,t){if(1&n&&(e.qex(0),e.nrm(1,"app-story-label",6),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bVm()),2&n){let o,i;const s=t.$implicit,r=e.XpG(3);e.R7$(),e.AVh("labels__label--hidden",!s.shown),e.Y8G("pinDraggable",null==(o=e.bMT(2,7,r.draggable$))?null:o.pin)("tagDraggable",null==(i=e.bMT(3,9,r.draggable$))?null:i.tag)("label",s)("collapsed",e.bMT(4,11,r.labelsCollapsed$))("collapsedMode",e.bMT(5,13,r.labelsCollapsedMode$))}}function JO(n,t){if(1&n&&(e.qex(0),e.DNE(1,YO,8,18,"app-context-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,KO,6,15,"ng-container",4),e.nI1(5,"async"),e.bVm()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,3,o.enableContextLabel$)&&e.bMT(3,5,o.contextLabel$)),e.R7$(3),e.Y8G("ngForOf",e.bMT(5,7,o.labels$))("ngForTrackBy",o.trackLabel)}}function qO(n,t){1&n&&(e.qex(0),e.nrm(1,"app-quiz-labels"),e.bVm())}function ZO(n,t){if(1&n&&(e.j41(0,"div",1),e.DNE(1,JO,6,9,"ng-container",2)(2,qO,2,0,"ng-container",2),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.showAnatomyLabels),e.R7$(),e.Y8G("ngIf",o.showQuizLabels)}}class Kn{constructor(t,o,i,s,r,a,d,f){this.action$=t,this.cameraService=o,this.changeDetector=i,this.elRef=s,this.labelsService=r,this.router=a,this.store=d,this.applicationEventService=f,this.interactive=!1,this.showAnatomyLabels=!1,this.showQuizLabels=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.bindEngineEvents(),this.bindApplicationEvents(),this.labelsService.setLabelContainer(this.elRef)}ngOnDestroy(){this.labelsService.setLabelContainer(null),this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}bindApplicationEvents(){this.action$.pipe((0,l.xi)(st.zE),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.handleClickNode(o)}),this.action$.pipe((0,l.xi)(st.fZ),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{o.node&&this.store.dispatch(new He.S3)}),this.labels$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.changeDetector.markForCheck()}),this.selectedLabel$.pipe((0,S.p)(o=>null==o),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(fi.x.getZoomed),i=this.store.selectSnapshot(fi.x.getLockCamera);o&&!i&&this.resetCamera()});const t=(0,Ht.z)([this.activeTool$,this.activeQuestion$]).pipe((0,b.Q)(this.ngUnsubscribe),(0,le.T)(([o,i])=>{const s=this.router.url.indexOf("/edit")>=0,r=(0,m.get)(i,"type")===vn.Q5.LabelAnatomy;return s?o===qt.s.Quiz:r}));(0,Ht.z)([this.showLabels$,t,this.activeQuestion$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([o,i,s])=>{const r=(0,m.get)(s,"showChapterLabels");this.showQuizLabels=i,this.showAnatomyLabels=!this.showQuizLabels&&o||r,this.changeDetector.markForCheck()}),this.store.select(fe.N.getSelectedChapterReadyState).pipe((0,S.p)(o=>null!=o),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.interactive=o.model,this.changeDetector.markForCheck()})}bindEngineEvents(){this.action$.pipe((0,l.xi)(st.Gv,He.eH),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(t.show?nt.F.LabelsEnabled:nt.F.LabelsDisabled,null)}),this.action$.pipe((0,l.xi)(He.Sh),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(nt.F.LabelsCreated,t.label)}),this.action$.pipe((0,l.xi)(He.lb),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(nt.F.LabelsUpdated,t.label)}),this.action$.pipe((0,l.xi)(He.D3),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{t.labels.forEach(o=>{this.applicationEventService.fireEvent(t.shown?nt.F.LabelsShown:nt.F.LabelsHidden,{labelId:o.id})})}),this.action$.pipe((0,l.xi)(He.vx),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(nt.F.LabelsDestroyed,t.label)})}handleClickNode(t){const o=this.store.selectSnapshot(Xe.S.getActiveTool);if((0,m.isNil)(t.node))this.store.dispatch(new He.TR(null)),this.store.dispatch(new He.S3);else{const i=this.store.selectSnapshot(Ze.getEnableContextLabel);o===qt.s.Label?this.addLabel(t.hit,t.node):i&&setTimeout(()=>{this.toggleContextLabel(t.hit,t.node)})}}addLabel(t,o){const i=this.cameraService.getDirection(t),s=this.getLabelDefaults(t.objectId),r=s.hideWire?20:32;s.title=o.label,s.offset=[r,0],s.objectId=t.objectId,s.barycentric=[t.barycentric[0],t.barycentric[1],t.barycentric[2]],s.pos=[t.worldPos[0],t.worldPos[1],t.worldPos[2]],s.primitiveIndex=t.triIndex,s.renderableIndex=t.renderableIndex||0,s.dir=i,s.chapterId=this.store.selectSnapshot(fe.N.getSelectedChapter).id,s.occludable=!0,s.shown=!0,this.store.dispatch(new He.Sh(s,!0)),this.store.dispatch(new He.TR(s))}toggleContextLabel(t,o){const i=this.store.selectSnapshot(Mn.z.getCheckedNodeIds);if(!this.store.selectSnapshot(Xe.S.getContextMenu).node&&i.some(r=>r===o.id)){const r=this.cameraService.getDirection(t),a=this.labelsService.makeDefaultStudioLabel();a.theme=Fs.D.Context,a.title=o.label,a.offset=[32,0],a.objectId=t.objectId,a.barycentric=[t.barycentric[0],t.barycentric[1],t.barycentric[2]],a.pos=[t.worldPos[0],t.worldPos[1],t.worldPos[2]],a.primitiveIndex=t.triIndex,a.renderableIndex=t.renderableIndex||0,a.dir=r,a.occludable=!1,a.hideWire=!0,a.pinType=Ui.O.None,this.store.dispatch(new He.h5(a))}else this.store.dispatch(new He.S3)}getLabelDefaults(t){let o=this.store.selectSnapshot(Ze.getSelectedLabel);if(null==o){let i=this.store.selectSnapshot(Ze.getChapterLabels);(!i||0===i.length)&&(i=this.store.selectSnapshot(Ze.getLabels)),i.length&&(o=(0,m.cloneDeep)(i[i.length-1]))}if(null!=o){const i=this.labelsService.makeDefaultStudioLabel();switch(i.hideWire=o.hideWire,i.pinGlow=o.pinGlow,i.pinType=o.pinType,i.theme=o.theme,i.sequentialType=o.sequentialType,i.states[0].errands[0]=new pu.T,(0,m.get)(o,"states[1].errands[0].type")){case xo.X.flyToObject:case xo.X.flyToCamera:i.states[1].errands[0]=new _u.F(t)}return i}{const i=this.labelsService.makeDefaultStudioLabel();return i.states[0].errands[0]=new pu.T,i.states[1].errands[0]=new _u.F(t),i}}trackLabel(t,o){const{id:i,shown:s,theme:r}=o;return`${i}${s}${r}`}resetCamera(){const o=this.store.selectSnapshot(fe.N.getSelectedChapter)?.camera?.location;(0,m.isNil)(o)||this.store.dispatch(new jt.Ih(o))}}function kr(n){return n/1048576}(Ka=Kn).\u0275fac=function(t){return new(t||Ka)(e.rXU(l.En),e.rXU(co.j),e.rXU(e.gRc),e.rXU(e.aKT),e.rXU(qc.x),e.rXU(ne.Ix),e.rXU(l.il),e.rXU(po.S))},Ka.\u0275cmp=e.VBU({type:Ka,selectors:[["app-labels"]],decls:1,vars:1,consts:[["class","labels","data-test","labelsElement","dir","ltr",4,"ngIf"],["data-test","labelsElement","dir","ltr",1,"labels"],[4,"ngIf"],[3,"label","enableInfo","enableActions","enableAudio",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"label","enableInfo","enableActions","enableAudio"],["data-test","appStoryLabel",1,"labels__label",3,"pinDraggable","tagDraggable","label","collapsed","collapsedMode"]],template:function(t,o){1&t&&e.DNE(0,ZO,3,2,"div",0),2&t&&e.Y8G("ngIf",o.interactive)},dependencies:[q.Sq,q.bT,qo.ig,Ba,nd,es,q.Jj],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;position:relative}.labels[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2;pointer-events:none}.labels__label--hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),li([(0,l.l6)(Be.getUI),ci("design:type",y.c)],Kn.prototype,"viewUI$",void 0),li([(0,l.l6)(Ze.getChapterLabels),ci("design:type",y.c)],Kn.prototype,"labels$",void 0),li([(0,l.l6)(Ue.j.getQuizModeActive),ci("design:type",y.c)],Kn.prototype,"quizModeActive$",void 0),li([(0,l.l6)(Xe.S.getActiveTool),ci("design:type",y.c)],Kn.prototype,"activeTool$",void 0),li([(0,l.l6)(Ue.j.getActiveQuestion),ci("design:type",y.c)],Kn.prototype,"activeQuestion$",void 0),li([(0,l.l6)(fe.N.getSelectedChapter),ci("design:type",y.c)],Kn.prototype,"selectedChapter$",void 0),li([(0,l.l6)(Ze.getSelectedLabel),ci("design:type",y.c)],Kn.prototype,"selectedLabel$",void 0),li([(0,l.l6)(Ze.getLabelsCollapsed),ci("design:type",y.c)],Kn.prototype,"labelsCollapsed$",void 0),li([(0,l.l6)(Ze.getLabelsCollapsedMode),ci("design:type",y.c)],Kn.prototype,"labelsCollapsedMode$",void 0),li([(0,l.l6)(Ze.getContextLabel),ci("design:type",y.c)],Kn.prototype,"contextLabel$",void 0),li([(0,l.l6)(Xe.S.getShowLabels),ci("design:type",y.c)],Kn.prototype,"showLabels$",void 0),li([(0,l.l6)(fi.x.getZoomed),ci("design:type",y.c)],Kn.prototype,"zoomed$",void 0),li([(0,l.l6)(Ze.getEnableContextLabel),ci("design:type",y.c)],Kn.prototype,"enableContextLabel$",void 0),li([(0,l.l6)(Ze.getEnableContextLabelInfo),ci("design:type",y.c)],Kn.prototype,"enableContextLabelInfo$",void 0),li([(0,l.l6)(Ze.getEnableContextLabelActions),ci("design:type",y.c)],Kn.prototype,"enableContextLabelActions$",void 0),li([(0,l.l6)(Ze.getEnableContextLabelAudio),ci("design:type",y.c)],Kn.prototype,"enableContextLabelAudio$",void 0),li([(0,l.l6)(Ze.getLabelsDraggable),ci("design:type",y.c)],Kn.prototype,"draggable$",void 0);var uS=_(82542);function gS(n){return n.toLocaleString()}const id={totalVisibleLeafObjects:{title:"Visible Objects",description:"This value represents the number of visible objects in current chapter.",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},geometries:{title:"Geometry + Morphs",description:"",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},materials:{title:"Material Count",description:"This value represents the number of materials downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},textures:{title:"Texture Count",description:"This value represents the number of textures downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},duration:{title:"Time to Load (s)",description:"This value represents the number of seconds it takes for the entire BioDigital scene (Materials + Textures + Vertices + etc) to load when the page is refreshed.",thresholds:{stable:[0,4],warning:[4,10],danger:[10,Number.MAX_SAFE_INTEGER]}},drawCalls:{title:"Draw Call Count",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},drawVertices:{title:"Vertex Count",description:"",thresholds:{stable:[0,25e4],warning:[25e4,5e5],danger:[5e5,Number.MAX_SAFE_INTEGER]}},cpuTime:{title:"CPU Time (ms)",description:"",thresholds:{stable:[0,8],warning:[8,12],danger:[12,Number.MAX_SAFE_INTEGER]}},frameRate:{title:"Frame Rate (fps)",description:"",thresholds:{stable:[58,Number.MAX_SAFE_INTEGER],warning:[45,58],danger:[0,45]}},downloadGeometry:{title:"Geometry Data",description:"",thresholds:{stable:[0,10],warning:[10,25],danger:[25,Number.MAX_SAFE_INTEGER]}},downloadMorph:{title:"Morph Data",description:"",thresholds:{stable:[0,5],warning:[5,10],danger:[10,Number.MAX_SAFE_INTEGER]}},downloadMaterial:{title:"Material Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},downloadTransform:{title:"Transform Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},memoryUsage:{title:"Active Memory Usage",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},chapterPeakMemory:{title:"Chapter Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},scenePeakMemory:{title:"Scene Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}}};function iM(n){return id[n]?.title??""}function oM(n){const o=id[n]?.thresholds,i=[];if(o){const r=Object.entries(o).reduce((a,[d,f])=>(a.push(`${d.toUpperCase()}: ${function tM(n){const[t,o]=n;let i=gS(t);t===Number.MIN_SAFE_INTEGER&&(i="min");let s=gS(o);return o===Number.MAX_SAFE_INTEGER&&(s="max"),`[${i} - ${s}]`}(f)}`),a),[]).join(" ");i.push(r)}return i.join(" ")}function sM(n,t){const o=id[n]?.thresholds;if(o){const{stable:i,warning:s,danger:r}=o;if((0,m.inRange)(t,...i))return"stable";if((0,m.inRange)(t,...s))return"warning";if((0,m.inRange)(t,...r))return"danger"}return"stable"}var od=_(3272),Oi=_(11818),hS=_(82765),yi=_(72026);const rM=["labelEl"],aM=["*",[["","form-field-help",""]]],lM=["*","[form-field-help]"],cM=(n,t,o,i)=>({"field--light":n,"field--dark":t,"field--inline":o,"field--compact":i});function dM(n,t){1&n&&e.eu8(0)}function _M(n,t){if(1&n&&(e.j41(0,"label",4,1),e.DNE(2,dM,1,0,"ng-container",5),e.k0s()),2&n){const o=e.XpG(),i=e.sdS(4);e.BMQ("aria-label",o.label),e.R7$(2),e.Y8G("ngTemplateOutlet",i)}}function pM(n,t){1&n&&e.eu8(0)}function uM(n,t){if(1&n&&(e.j41(0,"div",4),e.DNE(1,pM,1,0,"ng-container",5),e.k0s()),2&n){const o=e.XpG(),i=e.sdS(4);e.BMQ("aria-label",o.label),e.R7$(),e.Y8G("ngTemplateOutlet",i)}}function gM(n,t){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.AVh("uppercase",o.uppercase),e.R7$(),e.SpI(" ",o.label," ")}}function hM(n,t){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.labelHelp," ")}}function mM(n,t){if(1&n&&(e.DNE(0,gM,2,3,"div",6)(1,hM,2,1,"div",7),e.j41(2,"div",8),e.SdG(3),e.j41(4,"div",9),e.SdG(5,1),e.k0s()()),2&n){const o=e.XpG();e.Y8G("ngIf",o.label),e.R7$(),e.Y8G("ngIf",o.labelHelp)}}let mS=(()=>{var n;class t{constructor(){this.display="block",this.theme="dark",this.uppercase=!0,this.isCompact=!1,this.labelElement=!0,this.ngUnsubscribe=new Q.B}ngOnInit(){}ngAfterViewInit(){this.labelEl&&this.initLabel()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLabel(){this.labelEl.nativeElement.querySelectorAll("[contenteditable]").length>0&&(0,yn.R)(this.labelEl.nativeElement,"click").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(r=>{r.preventDefault()})}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-form-field"]],viewQuery:function(i,s){if(1&i&&e.GBs(rM,5),2&i){let r;e.mGM(r=e.lsd())&&(s.labelEl=r.first)}},inputs:{label:"label",labelHelp:"labelHelp",display:"display",theme:"theme",uppercase:"uppercase",isCompact:"isCompact",labelElement:"labelElement"},ngContentSelectors:lM,decls:5,vars:8,consts:[["contentTemplate",""],["labelEl",""],["data-test","formField",1,"field",3,"ngClass"],["class","field__container",4,"ngIf"],[1,"field__container"],[4,"ngTemplateOutlet"],["class","field__label text-2xs","data-test","formFieldLabel",3,"uppercase",4,"ngIf"],["class","text-xs text-gray-400 my-1",4,"ngIf"],[1,"field__input"],[1,"field__help","text-gray-400","text-xs"],["data-test","formFieldLabel",1,"field__label","text-2xs"],[1,"text-xs","text-gray-400","my-1"]],template:function(i,s){1&i&&(e.NAR(aM),e.j41(0,"div",2),e.DNE(1,_M,3,2,"label",3)(2,uM,2,2,"div",3)(3,mM,6,2,"ng-template",null,0,e.C5r),e.k0s()),2&i&&(e.Y8G("ngClass",e.ziG(3,cM,"light"===s.theme,"dark"===s.theme,"inline"===s.display,s.isCompact)),e.R7$(),e.Y8G("ngIf",s.labelElement),e.R7$(),e.Y8G("ngIf",!s.labelElement))},dependencies:[q.YU,q.bT,q.T3],styles:[".field[_ngcontent-%COMP%]{padding-bottom:16px;display:block;width:100%}.field__input[_ngcontent-%COMP%]{margin-top:4px}.field--light[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#374a68}.field--dark[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#96a8c0}.field--inline[_ngcontent-%COMP%]   .field__container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:auto}.field--inline[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{margin-right:8px}.field--inline[_ngcontent-%COMP%]   .field__input[_ngcontent-%COMP%]{margin-top:auto}.field--compact[_ngcontent-%COMP%]{padding-bottom:0}.field__help[_ngcontent-%COMP%]:not(:empty){padding-top:4px}"],changeDetection:0}),t})();var Ja,fS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},SS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const fM=(n,t)=>({"engine-stats--light":n,"engine-stats--dark":t,"engine-stats--advanced":!0});function SM(n,t){if(1&n&&(e.j41(0,"a",1)(1,"span",7),e.EFF(2," Documentation"),e.k0s(),e.nrm(3,"app-icon",8),e.k0s()),2&n){const o=e.XpG(2);e.BMQ("href",o.statsSupportUrl,e.B4B)}}function bM(n,t){if(1&n&&(e.j41(0,"section",3)(1,"table",4)(2,"caption",5),e.EFF(3," Download Size (Total) "),e.k0s(),e.j41(4,"tr")(5,"th",6),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"number"),e.k0s()(),e.j41(10,"tr")(11,"th",6),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.nI1(15,"number"),e.k0s()(),e.j41(16,"tr")(17,"th",6),e.EFF(18),e.k0s(),e.j41(19,"td"),e.EFF(20),e.nI1(21,"number"),e.k0s()(),e.j41(22,"tr")(23,"th",6),e.EFF(24),e.k0s(),e.j41(25,"td"),e.EFF(26),e.nI1(27,"number"),e.k0s()()()()),2&n){const o=e.XpG(2);e.R7$(5),e.Y8G("matTooltip",o.getStatDescription("downloadGeometry")),e.R7$(),e.SpI(" ",o.getStatTitle("downloadGeometry")," "),e.R7$(),e.HbH(o.getStatCSS("downloadGeometry",o.engineStats.downloadGeometry)),e.R7$(),e.SpI(" ",e.i5U(9,20,o.engineStats.downloadGeometry,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("downloadMorph")),e.R7$(),e.SpI(" ",o.getStatTitle("downloadMorph")," "),e.R7$(),e.HbH(o.getStatCSS("downloadMorph",o.engineStats.downloadMorph)),e.R7$(),e.SpI(" ",e.i5U(15,23,o.engineStats.downloadMorph,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("downloadMaterial")),e.R7$(),e.SpI(" ",o.getStatTitle("downloadMaterial")," "),e.R7$(),e.HbH(o.getStatCSS("downloadMaterial",o.engineStats.downloadMaterial)),e.R7$(),e.SpI(" ",e.i5U(21,26,o.engineStats.downloadMaterial,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("downloadTransform")),e.R7$(),e.SpI(" ",o.getStatTitle("downloadTransform")," "),e.R7$(),e.HbH(o.getStatCSS("downloadTransform",o.engineStats.downloadTransform)),e.R7$(),e.SpI(" ",e.i5U(27,29,o.engineStats.downloadTransform,"1.2-2")," MB ")}}function yM(n,t){if(1&n&&(e.j41(0,"section",3)(1,"table",4)(2,"caption",5),e.EFF(3," Memory "),e.k0s(),e.j41(4,"tr")(5,"th",6),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"number"),e.k0s()(),e.j41(10,"tr")(11,"th",6),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.nI1(15,"number"),e.k0s()(),e.j41(16,"tr")(17,"th",6),e.EFF(18),e.k0s(),e.j41(19,"td"),e.EFF(20),e.nI1(21,"number"),e.k0s()()()()),2&n){const o=e.XpG(3);e.R7$(5),e.Y8G("matTooltip",o.getStatDescription("memoryUsage")),e.R7$(),e.SpI(" ",o.getStatTitle("memoryUsage")," "),e.R7$(),e.HbH(o.getStatCSS("memoryUsage",o.currentAppStat.memoryUsage)),e.R7$(),e.SpI(" ",e.i5U(9,15,o.currentAppStat.memoryUsage,"1.0-0")," MB "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("chapterPeakMemory")),e.R7$(),e.SpI(" ",o.getStatTitle("chapterPeakMemory")," "),e.R7$(),e.HbH(o.getStatCSS("chapterPeakMemory",o.currentAppStat.chapterPeakMemory)),e.R7$(),e.SpI(" ",e.i5U(15,18,o.currentAppStat.chapterPeakMemory,"1.0-0")," MB "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("scenePeakMemory")),e.R7$(),e.SpI(" ",o.getStatTitle("scenePeakMemory")," "),e.R7$(),e.HbH(o.getStatCSS("scenePeakMemory",o.currentAppStat.scenePeakMemory)),e.R7$(),e.SpI(" ",e.i5U(21,21,o.currentAppStat.scenePeakMemory,"1.0-0")," MB ")}}function vM(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(o);const s=e.XpG(4);return e.Njj(s.viewReportClick())}),e.EFF(1," View Report "),e.k0s()}if(2&n){const o=e.XpG(4);e.Y8G("buttonTheme",o.theme())}}function EM(n,t){if(1&n){const o=e.RV6();e.j41(0,"section",3)(1,"h2",5),e.EFF(2,"Profiler"),e.k0s(),e.j41(3,"form",9)(4,"div",10)(5,"app-form-field",11)(6,"select",12)(7,"option",13),e.EFF(8,"DOM"),e.k0s(),e.j41(9,"option",14),e.EFF(10,"Markers"),e.k0s(),e.j41(11,"option",15),e.EFF(12,"None"),e.k0s()()(),e.j41(13,"app-form-field",16)(14,"mat-checkbox",17),e.EFF(15," Hover Pick Enabled "),e.k0s()()(),e.j41(16,"div",18)(17,"button",19),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.toggleCaptureClick())}),e.EFF(18),e.k0s(),e.DNE(19,vM,2,1,"button",20),e.k0s()()(),e.j41(20,"section",3)(21,"h2",5),e.EFF(22,"Tools"),e.k0s(),e.j41(23,"div",18)(24,"button",19),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.rayPickClick())}),e.EFF(25," Start Ray Picking "),e.k0s(),e.j41(26,"button",21),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.runSpectorJSClick())}),e.EFF(27," Run SpectorJS "),e.k0s()()()}if(2&n){const o=e.XpG(3);e.R7$(3),e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("isCompact",!0),e.R7$(8),e.Y8G("isCompact",!0),e.R7$(4),e.Y8G("buttonTheme",o.theme())("disabled",o.rayPicking),e.R7$(),e.SpI(" ",o.capturing?"Stop":"Start"," Capture "),e.R7$(),e.vxM(19,!o.capturing&&o.capturedStats.length>0?19:-1),e.R7$(5),e.Y8G("buttonTheme",o.theme())("disabled",o.capturing||o.rayPicking),e.R7$(2),e.Y8G("buttonTheme",o.theme())}}function CM(n,t){if(1&n&&e.DNE(0,yM,22,24,"section",3)(1,EM,28,10),2&n){const o=e.XpG(2);e.vxM(0,null!=o.currentAppStat&&o.currentAppStat.memoryUsage?0:-1),e.R7$(),e.vxM(1,o.showAdvancedTools()?1:-1)}}function TM(n,t){if(1&n&&(e.j41(0,"div",0),e.DNE(1,SM,4,1,"a",1),e.j41(2,"div",2)(3,"section",3)(4,"table",4)(5,"caption",5),e.EFF(6," Per Module "),e.k0s(),e.j41(7,"tr")(8,"th",6),e.EFF(9),e.k0s(),e.j41(10,"td"),e.EFF(11),e.nI1(12,"number"),e.k0s()(),e.j41(13,"tr")(14,"th",6),e.EFF(15),e.k0s(),e.j41(16,"td"),e.EFF(17),e.nI1(18,"number"),e.k0s()(),e.j41(19,"tr")(20,"th",6),e.EFF(21),e.k0s(),e.j41(22,"td"),e.EFF(23),e.nI1(24,"number"),e.k0s()(),e.j41(25,"tr")(26,"th",6),e.EFF(27),e.k0s(),e.j41(28,"td"),e.EFF(29),e.nI1(30,"number"),e.k0s()(),e.j41(31,"tr")(32,"th",6),e.EFF(33),e.k0s(),e.j41(34,"td"),e.EFF(35),e.nI1(36,"number"),e.k0s()()()(),e.j41(37,"section",3)(38,"table",4)(39,"caption",5),e.EFF(40),e.k0s(),e.j41(41,"tr")(42,"th",6),e.EFF(43),e.k0s(),e.j41(44,"td"),e.EFF(45),e.nI1(46,"number"),e.k0s()(),e.j41(47,"tr")(48,"th",6),e.EFF(49),e.k0s(),e.j41(50,"td"),e.EFF(51),e.nI1(52,"number"),e.k0s()(),e.j41(53,"tr")(54,"th",6),e.EFF(55),e.k0s(),e.j41(56,"td"),e.EFF(57),e.nI1(58,"number"),e.k0s()(),e.j41(59,"tr")(60,"th",6),e.EFF(61),e.k0s(),e.j41(62,"td"),e.EFF(63),e.nI1(64,"number"),e.k0s()()()(),e.DNE(65,bM,28,32,"section",3)(66,CM,2,2),e.nI1(67,"async"),e.k0s()()),2&n){const o=e.XpG();e.Y8G("ngClass",e.l_i(79,fM,"light"===o.theme(),"dark"===o.theme())),e.R7$(),e.vxM(1,o.enableAdvancedStats?1:-1),e.R7$(7),e.Y8G("matTooltip",o.getStatDescription("totalVisibleLeafObjects")),e.R7$(),e.SpI(" ",o.getStatTitle("totalVisibleLeafObjects")," "),e.R7$(),e.HbH(o.getStatCSS("totalVisibleLeafObjects",o.engineStats.totalVisibleLeafObjects)),e.R7$(),e.SpI(" ",e.i5U(12,50,o.engineStats.totalVisibleLeafObjects,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("geometries")),e.R7$(),e.SpI(" ",o.getStatTitle("geometries")," "),e.R7$(),e.HbH(o.getStatCSS("geometries",o.engineStats.geometries)),e.R7$(),e.SpI(" ",e.i5U(18,53,o.engineStats.geometries,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("materials")),e.R7$(),e.SpI(" ",o.getStatTitle("materials")," "),e.R7$(),e.HbH(o.getStatCSS("materials",o.engineStats.materials)),e.R7$(),e.SpI(" ",e.i5U(24,56,o.engineStats.materials,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("textures")),e.R7$(),e.SpI(" ",o.getStatTitle("textures")," "),e.R7$(),e.HbH(o.getStatCSS("textures",o.engineStats.textures)),e.R7$(),e.SpI(" ",e.i5U(30,59,o.engineStats.textures,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("duration")),e.R7$(),e.SpI(" ",o.getStatTitle("duration")," "),e.R7$(),e.HbH(o.getStatCSS("duration",null==o.currentAppStat?null:o.currentAppStat.duration)),e.R7$(),e.SpI(" ",e.i5U(36,62,null==o.currentAppStat?null:o.currentAppStat.duration,"1.1-1")," "),e.R7$(5),e.SpI(" Per Frame",o.statsCached?" (cached)":""," "),e.R7$(2),e.Y8G("matTooltip",o.getStatDescription("drawCalls")),e.R7$(),e.SpI(" ",o.getStatTitle("drawCalls")," "),e.R7$(),e.HbH(o.getStatCSS("drawCalls",o.engineStats.drawCalls)),e.R7$(),e.SpI(" ",e.i5U(46,65,o.engineStats.drawCalls,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("drawVertices")),e.R7$(),e.SpI(" ",o.getStatTitle("drawVertices")," "),e.R7$(),e.HbH(o.getStatCSS("drawVertices",o.engineStats.drawVertices)),e.R7$(),e.SpI(" ",e.i5U(52,68,o.engineStats.drawVertices,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("cpuTime")),e.R7$(),e.SpI(" ",o.getStatTitle("cpuTime")," "),e.R7$(),e.HbH(o.getStatCSS("cpuTime",o.engineStats.cpuTime)),e.R7$(),e.SpI(" ",e.i5U(58,71,o.engineStats.cpuTime,"1.3-3")," "),e.R7$(3),e.Y8G("matTooltip",o.getStatDescription("frameRate")),e.R7$(),e.SpI(" ",o.getStatTitle("frameRate")," "),e.R7$(),e.HbH(o.getStatCSS("frameRate",o.engineStats.frameRate)),e.R7$(),e.SpI(" ",e.i5U(64,74,o.engineStats.frameRate,"1.0-0")," "),e.R7$(2),e.vxM(65,o.enableAdvancedStats?65:-1),e.R7$(),e.vxM(66,o.enableAdvancedStats&&e.bMT(67,77,o.chapterReady$)?66:-1)}}const OM=["cpuTime","gpuTime","postProcessTime","frameTime","frameRate"];class qa{get engineStats(){return this.engineStats$.value}constructor(t,o,i,s,r,a,d){this.store=t,this.engineService=o,this.rendererService=i,this.markerService=s,this.storageService=r,this.dialog=a,this.changeRef=d,this.statsSupportUrl="https://www.notion.so/biodigital/Performance-Panel-Help-Doc-WIP-c0e54dfc39f2465383a18e33a97bdb4c",this.getStatTitle=iM,this.getStatDescription=oM,this.enableAdvancedStats=!1,this.theme=(0,e.hFB)(uS.P.Dark),this.showAdvancedTools=(0,e.hFB)(!0),this.capturedStats=[],this.engineStats$=new ui.t(void 0),this.capturing=!1,this.rayPicking=!1,this.initialLabels=[],this.initialSceneMemory=0,this.initialMemoryByChapter={},this.peakMemoryByChapter={},this.chapterLoadStats={},this.ngUnsubscribe=new Q.B,this.initState()}ngOnInit(){this.initFormListeners(),this.initStatsListeners(),this.initMemoryListeners();const t=new URLSearchParams(window.location.search),o="true"===t.get("ui-stats-capture"),i="false"!==t.get("ui-stats-hover"),s=t.get("ui-stats-label")||"dom";this.form.setValue({hoverPickEnabled:i,labelsMode:s}),o&&this.toggleCapture(!0),this.enableAdvancedStats=I.c.application===Wn.c.Loft||I.c.deploy!==ri.Z.Production||"true"===this.storageService.getLocalItem(zt.UT.EnableAdvancedStats),this.changeRef.markForCheck()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}rayPickClick(){confirm("Please note, this may take upto 10+ seconds to run and will lock your browser temporarily. Continue?")&&(this.rayPicking=!0,this.changeRef.markForCheck(),setTimeout(()=>{this.runRayPickSuite().then(t=>{this.rayPicking=!1,this.changeRef.markForCheck();const{startMemoryUsage:o,endMemoryUsage:i,meanRayPickTime:s}=t,r={startMemoryUsage:`${o.toFixed(0)} MB`,endMemoryUsage:`${i.toFixed(0)} MB`,meanRayPickTime:`${s.toFixed(2)} ms`};alert(JSON.stringify(r,null,2))})},1))}runRayPickSuite(){var t=this;return(0,Ct.A)(function*(){return new Promise(o=>{const{offsetWidth:i,offsetHeight:s}=t.rendererService.getCanvas(),r=t.currentAppStat.memoryUsage,a=[];for(let f=0;f<s;f+=5)for(let T=0;T<i;T+=5){const L=performance.now();t.rendererService.pick(T,f,!0);const re=performance.now()-L;a.push(re)}const d=(0,m.mean)(a);a.length=0,setTimeout(()=>{o({startMemoryUsage:r,endMemoryUsage:t.currentAppStat.memoryUsage,meanRayPickTime:d})},1e3)})})()}toggleCaptureClick(){if(!this.capturing&&confirm("Do you want to reload the page to ensure accurate profiling? Otherwise the profiler will start immediately.")){const{hoverPickEnabled:o,labelsMode:i}=this.form.value,s=new URLSearchParams(window.location.search);s.set("ui-stats-capture","true"),s.set("ui-stats-hover",`${o}`),s.set("ui-stats-label",`${i}`);const r=`${location.pathname}?${s.toString()}`;window.location.href=r}else this.toggleCapture(!this.capturing)}toggleCapture(t){this.capturing=t,this.capturing?(this.capturedStats.length=0,this.capturing=!0):(this.capturing=!1,this.viewReport()),this.changeRef.markForCheck()}getStatCSS(t,o){return["engine-stats-row",`engine-stats-row--${sM(t,o)}`]}runSpectorJSClick(){this.runSpectorJS()}runSpectorJS(){var t=this;return(0,Ct.A)(function*(){_.e(492).then(_.t.bind(_,47492,23)).then(({EmbeddedFrontend:o,Spector:i})=>{t.spector||(t.spector=new i,t.spector.onCapture.add(r=>{console.log("specture captured",r,t.spector),console.log({EmbeddedFrontend:o});const a=new o.ResultView;a.display(),a.addCapture(r)}),t.spector.onError.add(r=>{console.warn("specture error",r,t.spector)})),t.spector.captureNextFrame(t.engineService.engine.renderer.canvas,!1)})})()}viewReportClick(){var t=this;return(0,Ct.A)(function*(){t.viewReport()})()}viewReport(){var t=this;return(0,Ct.A)(function*(){const o=t.capturedStats,i=t.store.selectSnapshot(fe.N.getStoryChapters),{StatsDialogComponent:s}=yield _.e(608).then(_.bind(_,36608));t.dialog.open(s,{width:"90vw",panelClass:"bd-publish-dialog-panel",data:{chapters:i,appStats:o,chapterLoadStats:t.chapterLoadStats}}).afterClosed().pipe((0,b.Q)(t.ngUnsubscribe)).subscribe()})()}initState(){const t=performance?.memory?.usedJSHeapSize??0;this.initialSceneMemory=kr(t),this.form=new we.gE({hoverPickEnabled:new we.MJ(!0),labelsMode:new we.MJ("dom")}),this.store.select(Ze.getLabels).pipe((0,S.p)(o=>o?.length>0),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.initialLabels=o;const{labelsMode:i}=this.form.value;this.toggleLabelsMode(i)})}initFormListeners(){this.form.valueChanges.pipe((0,le.T)(t=>t.hoverPickEnabled),(0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.toggleHoverPick(t)}),this.form.valueChanges.pipe((0,le.T)(t=>t.labelsMode),(0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.toggleLabelsMode(t)})}initStatsListeners(){this.engineService.getEvent(gt.X.AssetsLoadProgress).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const{chapterId:o,chapterProgress:i}=t,s=this.chapterLoadStats[o]??{chapterId:o,startTime:performance.now()};1===i&&(s.endTime=performance.now(),s.duration=(s.endTime-s.startTime)/1e3),this.chapterLoadStats[o]=s}),this.engineService.engineCreated$.pipe((0,Cn.Z)(t=>{const o=this.engineService.server;return function eM(n,t){const{renderer:o}=n;return new y.c(i=>{let s=performance.now(),r=s,a=0,d=0,f=0,T=0,L=0,ee=0,re=0,ve=0,Oe=0,Ee=0,Re=0;const Fe=function(){var it=(0,Ct.A)(function*(){d++;const pt=performance.now();a=pt-s,pt>=r+1e3&&(T=1e3*d/(pt-r),r=pt,d=0),s=pt;const Mt=performance?.memory?.usedJSHeapSize??0;f=kr(Mt),ve=kr(t?.dataSize?.material??0),Oe=kr(t?.dataSize?.morph??0),Ee=kr(t?.dataSize?.geometry??0),Re=kr(t?.dataSize?.transform??0),i.next({...o.stats,totalObjects:L,totalLeafObjects:ee,totalVisibleLeafObjects:re,frameRate:T,frameTime:a,memoryUsage:f,downloadMaterial:ve,downloadMorph:Oe,downloadGeometry:Ee,downloadTransform:Re})});return function(){return it.apply(this,arguments)}}(),Ke=()=>{n&&(n.off("destroy",Ke),o.off("end",Fe)),i.next({...o.stats,totalObjects:L,totalLeafObjects:ee,totalVisibleLeafObjects:re,frameRate:T,frameTime:a,memoryUsage:f,downloadMaterial:ve,downloadMorph:Oe,downloadGeometry:Ee,downloadTransform:Re}),i.complete()};o.on("end",Fe),n.on("changestory",()=>{const{anatomyObjects:it}=n.story.anatomySceneGraph;L=it.size;const pt=()=>{ee=0,re=0,it.forEach($t=>{!$t.children?.length&&(ee++,$t.shown&&re++)})},Mt=$t=>{"shown"===$t?.property&&pt()};pt(),it.forEach($t=>{$t.on("change",Mt)})}),n.on("destroy",Ke),i.add(Ke)})}(t,o instanceof Kt.BioDigitalWebSocketServer?o:void 0)}),(0,wo.Z)(100),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.statsCached=!1;const o=this.engineStats,i=Object.entries(t).reduce((s,[r,a])=>{const d=r;if(!OM.includes(d)){const f=o?.[d];!a&&f&&(s[d]=f,this.statsCached=!0)}return s},{...o,...t});this.engineStats$.next(i),this.changeRef.markForCheck()})}initMemoryListeners(){(0,Ht.z)([this.engineStats$,this.chapterId$,this.chapterReady$]).pipe((0,S.p)(([t,,o])=>!(0,m.isNil)(t)&&o),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{const i=this.initialSceneMemory,s=t.memoryUsage,r=s-i;this.initialMemoryByChapter[o]=this.initialMemoryByChapter[o]??s;const f=Math.max(this.peakMemoryByChapter[o]??0,s);this.peakMemoryByChapter[o]=f;const T=Object.values(this.peakMemoryByChapter).reduce((Ee,Re)=>Math.max(Ee,Re),0),L={chapterInitialMemory:this.initialMemoryByChapter[o],chapterPeakMemory:this.peakMemoryByChapter[o],chapterDeltaMemory:r,sceneInitialMemory:i,scenePeakMemory:T},ee=this.chapterLoadStats[o]??{},re=performance.now(),{labelsMode:ve,hoverPickEnabled:Oe}=this.form.value;this.currentAppStat={...t,...ee,...L,timestamp:re,chapterId:o,labelsMode:ve,hoverPickEnabled:Oe},this.capturing&&this.capturedStats.push(this.currentAppStat),this.changeRef.markForCheck()})}toggleLabelsMode(t){switch(this.store.dispatch(new He.gJ([])),this.markerService.deleteMarkers(),t){case"dom":this.store.dispatch(new He.gJ(this.initialLabels));break;case"marker":this.initialLabels.forEach(o=>this.markerService.createMarker(o))}}toggleHoverPick(t){this.store.dispatch(new st.Pk({hoverEnabled:t}))}}(Ja=qa).\u0275fac=function(t){return new(t||Ja)(e.rXU(l.il),e.rXU(u.y),e.rXU(Fa.z),e.rXU(pa),e.rXU(zt.n$),e.rXU(Dt.bZ),e.rXU(e.gRc))},Ja.\u0275cmp=e.VBU({type:Ja,selectors:[["app-engine-stats"]],inputs:{theme:[e.Mj6.SignalBased,"theme"],showAdvancedTools:[e.Mj6.SignalBased,"showAdvancedTools"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[[1,"engine-stats",3,"ngClass"],["target","_blank","rel","noreferrer nofollow",1,"self-end","text-xs","font-semibold","text-link"],[1,"engine-stats__sections"],[1,"engine-stats__section"],[1,"engine-stats__table"],[1,"engine-stats__section-header"],["scope","row","matTooltipPosition","left",3,"matTooltip"],[1,"text-underline"],["icon","arrow-up-right-from-square",1,"ml-1"],[1,"flex","flex-col","text-xs",3,"formGroup"],[1,"flex","flex-row","justify-between"],["label","Labels",1,"my-1",3,"isCompact"],["formControlName","labelsMode",1,"input"],["value","dom",1,"my-1"],["value","marker",1,"my-1"],["value","none",1,"my-1"],["label","Input",1,"my-1","ml-1",3,"isCompact"],["formControlName","hoverPickEnabled"],[1,"my-1","engine-stats__buttons"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme","disabled"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"buttonTheme"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme"]],template:function(t,o){1&t&&e.DNE(0,TM,68,82,"div",0),2&t&&e.vxM(0,o.engineStats?0:-1)},dependencies:[q.MD,q.YU,q.Jj,q.QX,we.X1,we.qT,we.xH,we.y7,we.wz,we.BC,we.cb,we.j4,we.JD,od.D,mS,hS.So,On.oV,Oi.C,bi.Q,yi.o,yt.R],styles:[":root{--engine-stats-color: #374a68;--engine-stats-background-color: #ffffff;--engine-stats-border-color: #eaeff5}.engine-stats{display:flex;flex-direction:column;padding:8px;text-align:left;border-radius:4px;color:var(--engine-stats-color);background-color:var(--engine-stats-background-color);border:1px solid var(--engine-stats-border-color)}.engine-stats__sections{display:flex;flex-direction:column;gap:16px}.engine-stats__section{display:flex;flex-direction:column;font-size:.75rem;line-height:1rem}.engine-stats__section-header{padding-top:.25rem;padding-bottom:.25rem;text-align:left;font-size:.875rem;line-height:1.25rem;font-weight:600}.engine-stats__buttons{display:flex;flex-direction:column;gap:8px}.engine-stats table th{width:60%;border-right:1px solid var(--engine-stats-border-color);font-weight:500;text-align:right}.engine-stats table td{font-weight:600}.engine-stats table th,.engine-stats table td{padding:2px 4px}.engine-stats table tr{border-top:1px solid var(--engine-stats-border-color);border-bottom:1px solid var(--engine-stats-border-color);border-collapse:collapse}.engine-stats-row--warning{background-color:#ffb92e;color:#374a68}.engine-stats-row--danger{background-color:#de3535;color:#d7e0ea}.engine-stats--dark{--engine-stats-color: #d7e0ea;--engine-stats-background-color: #283853;--engine-stats-border-color: #1c2a3f}.engine-stats--advanced{width:260px}\n"],encapsulation:2,changeDetection:0}),fS([(0,l.l6)(Xe.S.getChapter),SS("design:type",y.c)],qa.prototype,"chapterId$",void 0),fS([(0,l.l6)(fe.N.getSelectedChapterModelReady),SS("design:type",y.c)],qa.prototype,"chapterReady$",void 0);const MM=(n,t,o)=>({"progress--small":n,"progress--medium":t,"progress--large":o}),IM=n=>({"progress__bar--complete":n}),wM=n=>({width:n});let PM=(()=>{var n;class t{get value(){return this._value}set value(i){this._value=i,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}constructor(i,s){this.router=i,this.changeDetector=s,this.total=100,this._value=0,this.size="small",this.disableComplete=!1,this.percentWidth=0,this.ngUnsubscribe=new Q.B}ngOnInit(){this.router.events.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{i instanceof ne.Z&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(ne.Ix),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-progress"]],inputs:{total:"total",value:"value",size:"size",disableComplete:"disableComplete"},decls:2,vars:12,consts:[[1,"progress",3,"ngClass"],["role","progressbar","aria-label","content loading progress","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.nrm(1,"div",1),e.k0s()),2&i&&(e.Y8G("ngClass",e.sMw(4,MM,"small"===s.size,"medium"===s.size,"large"===s.size)),e.R7$(),e.Y8G("ngClass",e.eq3(8,IM,!s.disableComplete&&100===s.percentWidth))("ngStyle",e.eq3(10,wM,s.percentWidth+"%")),e.BMQ("aria-valuenow",s.percentWidth))},dependencies:[q.YU,q.B3],styles:["@keyframes _ngcontent-%COMP%_progressSuccess{0%{width:100%!important;background:#38de38}50%{opacity:1;background:#38de38}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;width:100%}.progress__bar[_ngcontent-%COMP%]{background:#de3535;height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressSuccess 2s linear forwards}.progress--small[_ngcontent-%COMP%]{height:4px}.progress--medium[_ngcontent-%COMP%]{height:8px}.progress--large[_ngcontent-%COMP%]{height:12px}"],changeDetection:0}),t})(),AM=(()=>{var n;class t{constructor(i,s){this.store=i,this.changeDetectorRef=s,this.ngUnsubscribe=new Q.B,this.storyLoadProgress=0}ngOnInit(){const i=this.store.select(Ei.getChaptersLoadProgress),s=this.store.select(rt.getLoadingChapter);(0,Ht.z)(i,s).pipe((0,S.p)(()=>{const r=this.store.selectSnapshot(rt.getLoadChapters);return!(0,m.isNil)(r)&&r.length>0}),(0,b.Q)(this.ngUnsubscribe)).subscribe(([r,a])=>{const d=this.store.selectSnapshot(fe.N.getSelectedChapterId),f=!(0,m.isNil)(a)&&a.chapterId===d;this.storyLoadProgress=f?r[d]??0:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-progress"]],decls:1,vars:3,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(i,s){1&i&&e.nrm(0,"app-progress",0),2&i&&(e.Y8G("value",s.storyLoadProgress)("total",1),e.BMQ("data-progress",s.storyLoadProgress))},dependencies:[PM],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0}),t})();var Le=_(49969);function NM(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",1),e.bIt("@show.done",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.onShowDone())}),e.j41(1,"div",2),e.EFF(2,"Use control + scroll to zoom"),e.k0s()()}2&n&&e.Y8G("@show",void 0)}let RM=(()=>{var n;class t{constructor(i,s){this.actions=i,this.changeDetectorRef=s,this.ngUnsubscribe=new Q.B,this.show=!1}ngOnInit(){this.actions.pipe((0,l.xi)(st.JK),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.En),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(i,s){1&i&&e.DNE(0,NM,3,1,"div",0),2&i&&e.Y8G("ngIf",s.show)},dependencies:[q.bT],styles:[".engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:#10182380;font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,Le.hZ)("show",[(0,Le.kY)(":enter",[(0,Le.K2)([(0,Le.iF)({opacity:"*"}),(0,Le.i0)("500ms ease-in-out",(0,Le.iF)({opacity:1})),(0,Le.i0)("500ms 2000ms ease-in-out",(0,Le.iF)({opacity:0}))])])])]},changeDetection:0}),t})();const DM=(n,t)=>({backgroundColor:n,duration:t}),kM=(n,t)=>({value:n,params:t}),LM=(0,Le.lY)([(0,Le.iF)({opacity:"0",backgroundColor:"*"}),(0,Le.K2)([(0,Le.i0)("{{ duration }}ms {{ easing }}",(0,Le.iF)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,Le.i0)("250ms 500ms ease-in",(0,Le.iF)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let UM=(()=>{var n;class t{constructor(i,s,r){this.actions=i,this.changeDetectorRef=s,this.store=r,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,l.xi)(st.zW),(0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.fadeIn(i.color,i.duration)})}handleFadeComplete(){this.store.dispatch(new st.In),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(i,s){this.isVisible=!0,this.color=i,this.duration=1e3*s,this.changeDetectorRef.markForCheck()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.En),e.rXU(e.gRc),e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.bIt("@fade.done",function(){return s.handleFadeComplete()}),e.k0s()),2&i&&e.Y8G("@fade",e.l_i(4,kM,s.isVisible,e.l_i(1,DM,s.color,s.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,Le.hZ)("fade",[(0,Le.kY)("* => true",(0,Le.sM)(LM))])]},changeDetection:0}),t})(),jM=(()=>{var n;class t{constructor(i,s,r,a){this.engineService=i,this.cameraService=s,this.numberService=r,this.changeDetectionRef=a,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(gt.X.CameraUpdated).pipe((0,wo.Z)(50)).subscribe(i=>{const s=this.numberService.roundModel(i.eye,0),{x:r,y:a,z:d}=s,f=Math.floor(100*this.cameraService.getCameraZoom()),T=this.numberService.roundNumber(i.dist,0);this.camera={x:r,y:a,z:d,zoom:f,dist:T},this.changeDetectionRef.markForCheck()})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(u.y),e.rXU(co.j),e.rXU(lf.D),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.EFF(1),e.k0s()),2&i&&(e.R7$(),e.SjE(" X:",null==s.camera?null:s.camera.x," Y:",null==s.camera?null:s.camera.y," Z:",null==s.camera?null:s.camera.z," Dist:",null==s.camera?null:s.camera.dist," Zoom:",null==s.camera?null:s.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0}),t})();var bS=_(44120);let VM=(()=>{var n;class t{constructor(i){this.store=i}ngOnInit(){}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger().openMenu()}onNodeActionsClosed(){this.store.dispatch(new st.fZ(null,null))}getNodeActionsStyles(){return{"left.px":this.hit?this.hit.canvasPos.x:0,"top.px":this.hit?this.hit.canvasPos.y:0}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-contextmenu"]],viewQuery:function(i,s){if(1&i&&e.GBs(bS.D,7),2&i){let r;e.mGM(r=e.lsd())&&(s.nodeActionsComponent=r.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"nodeActionsClosed","ngStyle","node"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"app-node-actions",1),e.bIt("nodeActionsClosed",function(){return s.onNodeActionsClosed()}),e.k0s()()),2&i&&(e.R7$(),e.Y8G("ngStyle",s.getNodeActionsStyles())("node",s.node))},dependencies:[q.B3,bS.D],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]}),t})();var Za,Gn=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},$n=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const xM=["engine"],FM=n=>({"engine--hidden":n});function GM(n,t){1&n&&e.nrm(0,"div",2)}function $M(n,t){if(1&n&&e.nrm(0,"app-engine-contextmenu",3),2&n){const o=e.XpG();e.Y8G("node",o.contextMenuNode)("hit",o.contextMenuHit)}}function BM(n,t){1&n&&e.nrm(0,"div",4)}function zM(n,t){1&n&&e.nrm(0,"app-engine-progress",5)}function WM(n,t){if(1&n&&(e.j41(0,"div",6),e.nrm(1,"app-engine-stats",7),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG(),i=e.sdS(1);e.Y8G("cdkDragBoundary",i),e.R7$(),e.Y8G("theme",o.isBackgroundLight?"light":"dark")("showAdvancedTools",e.bMT(2,3,o.showAdvancedTools$))}}function XM(n,t){1&n&&e.nrm(0,"app-engine-camera-position")}var Bs=function(n){return n[n.Pan=.4]="Pan",n[n.PanSlow=.04]="PanSlow",n[n.Zoom=5]="Zoom",n[n.ZoomSlow=1]="ZoomSlow",n[n.Rotate=.3]="Rotate",n[n.RotateSlow=.03]="RotateSlow",n}(Bs||{}),Ro=function(n){return n[n.Rotate=6]="Rotate",n[n.Pan=1.75]="Pan",n[n.Zoom=2.5]="Zoom",n}(Ro||{}),ti=function(n){return n[n.Zoom=-6]="Zoom",n[n.TrackZoom=.5]="TrackZoom",n[n.Pan=1.25]="Pan",n[n.Rotate=1.5]="Rotate",n[n.Friction=.85]="Friction",n[n.ZoomFriction=.85]="ZoomFriction",n[n.FrictionThreshold=.002]="FrictionThreshold",n}(ti||{}),ts=function(n){return n.Fade="engine--cursor-fade",n.Hide="engine--cursor-hide",n.Label="engine--cursor-label",n.Paint="engine--cursor-paint",n.Eyedropper="engine--cursor-eyedropper",n.Crosshair="engine--cursor-crosshair",n.Default="",n}(ts||{}),yS=function(n){return n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.LeftAndRight=4]="LeftAndRight",n}(yS||{});const vS=1e3/60;class Un{wheel(t){const o=this.store.selectSnapshot(Xe.S.getScrollMode),i=t.ctrlKey;o===Cr.M.DoNotCaptureShowMessage&&!i&&this.store.dispatch(new st.JK(!0)),(o===Cr.M.Capture||i)&&(t.preventDefault(),this.handleWheel(t))}onContextMenu(t){this.contextMenuEnable()&&this.handleContextMenu(t)}onMouseOut(){this.handleMouseOut()}constructor(t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke){this.actions=t,this.activatedRoute=o,this.animationService=i,this.cameraService=s,this.changeDetecton=r,this.engineService=a,this.xrService=d,this.sceneService=f,this.mediaService=T,this.paintService=L,this.renderer=ee,this.storageService=re,this.store=ve,this.applicationEventService=Oe,this.particleSystemsService=Ee,this.engineRendererService=Re,this.clippingPlanesService=Fe,this.liveAnnouncer=Ke,this.VERSION=Kt.VERSION,this.flyCamera=!0,this.visible=!1,this.application=Wn.c,this.cursorClass=ts.Default,this.chapterReady=!1,this.ngUnsubscribe=new Q.B,this.display=!1,this.engineVisible=!0,this.inputEnabled=(0,e.hFB)(!0),this.contextMenuEnable=(0,e.hFB)(!0),this.background=new ui.t(null),this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,I.c.application===Wn.c.Loft&&_.e(361).then(_.t.bind(_,5361,23)).then(pt=>{window.pako=pt}),this.showDebug=I.c.application===Wn.c.Loft||"true"===this.storageService.getLocalItem(zt.UT.CameraDebug),I.c.deploy===ri.Z.Production&&(I.c.application===Wn.c.Studio||I.c.application===Wn.c.Viewer)||console.table({Commit:Kt.COMMIT,Time:new Date(Kt.TIMESTAMP).toLocaleString(),Version:Kt.VERSION})}convertToLeafStateMap(t,o){const i={};return Object.entries(o).forEach(([s,r])=>{i[s]={},i[s][t]=r}),i}ngOnInit(){this.particleStateListener=new kC(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initVideo(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.particleStateListener.destroy(),this.engineService.destroyEngine(),this.animationService.destroyPlayer(),this.xrService.destroyXR(),this.canvas?.remove(),this.canvas=null,this.changeDetecton.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const t=this.store.selectSnapshot(Xe.S.getWebGLContextName),o=this.activatedRoute.snapshot.queryParams.disableTextureCompression,i="true"===o||o?.split(",").reduce((s,r)=>({...s,[r.trim().toLowerCase()]:!0}),{});this.engineService.initEngine({contextName:t,disableTextureCompression:i}),this.canvas=this.engineRendererService.getCanvas(),this.canvas.style.zIndex="1",this.canvas.dataset.test="engineCanvas",this.engineElement.nativeElement.prepend(this.canvas),"true"===localStorage.getItem("xr")&&this.xrService.initXR(this.engineService.engine)}bindEngineEvents(){this.engineService.getEvent(gt.X.Loaded).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new st.AU(!0))}),this.engineService.getEvent(gt.X.TimelineChapterTransition).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(nt.F.LabelsChapterInfo,this.store.selectSnapshot(Ze.getChapterLabels))}),(0,Wi.h)(this.engineService.getEvent(gt.X.TimelinePlayed),this.engineService.getEvent(gt.X.TimelinePaused)).pipe((0,b.Q)(this.ngUnsubscribe),(0,S.p)(()=>null!=this.store.selectSnapshot(fe.N.getSelectedChapterId)),(0,Fn.B)(50),(0,le.T)(()=>this.animationService.isPlaying())).subscribe(t=>{this.store.dispatch(new st.jM(t))}),this.engineService.getEvent(gt.X.Tick).pipe((0,S.p)(()=>this.visible&&!(0,m.isNil)(this.engineService.engine?.story)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.inputEnabled()&&this.handleMouseInputEngineTick(t),this.handleCameraTick(t),this.deltaTime=window.performance.now()}),this.engineService.getEvent(gt.X.TweenVisibilityUpdate).pipe((0,Ua.E)(this.store.select(fe.N.getIsChapterAnimated),this.store.select(fe.N.getSelectedChapterModelReady)),(0,S.p)(([t,o,i])=>o&&i&&Object.keys(t).length>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{const o=[],i=[];Object.entries(t).forEach(([s,r])=>{r?o.push(s):i.push(s)}),o.length>0&&this.store.dispatch(new Lt.LV(!0,o)),i.length>0&&this.store.dispatch(new Lt.LV(!1,i)),this.applyShownPatches(t,!1)}),this.engineService.getEvent(gt.X.VariantsUpdate).pipe((0,S.p)(t=>Object.keys(t).length>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applyVariantPatches(t,!0,!1,!1)}),this.engineService.getEvent(gt.X.SceneObjectRenderable).pipe((0,RC.w)(1e3),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{if(t.length){const o={};t.forEach(i=>{o[i.objectId]={renderable:!0}}),this.store.dispatch(new st.GT(o))}}),this.engineService.getEvent(gt.X.AssetsLoadProgress).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({chapterId:t,chapterProgress:o})=>{const i=this.store.selectSnapshot(rt.getLoadChapters).length,a=1/i,T=o*a+(i-Math.max(this.store.selectSnapshot(rt.getLoadChaptersRemaining).length,1))*a;this.progress=T.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new M_(T,t,o))}),this.engineService.getEvent(gt.X.CameraUpdated).pipe((0,S.p)(()=>!this.cameraAnimating),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(gt.X.CameraRested).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,l.xi)(To),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,S.p)(t=>null!=t),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.enginePosition=t,this.repositionEngine(t)}),this.store.select(Xe.S.getXrayModeEnabled).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(Mn.z.getCheckedNodes),i=this.store.selectSnapshot(Mn.z.getNodes),s=this.store.selectSnapshot(Xe.S.getViewGraph);!1===t?(Object.keys(i||[]).forEach(r=>{this.paintService.paint(s,r,i[r].paint)}),o.forEach(r=>this.paintService.highlight(s,r.objectId,!0))):(this.paintService.paintAll(s,Object.keys(i),Es.EC),this.paintService.paintAll(s,o.map(r=>r.objectId),Es.NR))}),this.actions.pipe((0,l.xi)(st.K6),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.display=t,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.engineVisible=t,this.changeDetecton.markForCheck()}),this.contextMenu$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.contextMenuNode=t.node,this.contextMenuHit=t.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,S.p)(t=>!(0,m.isNil)(t)),(0,Ds.J)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{const i=this.store.selectSnapshot(Xe.S.getChapter);if(this.store.selectSnapshot(fe.N.getSelectedChapterReadyState).model){const a=o.id;if(t.id===a&&i===a)return;this.animationService.setChapter(a).then(()=>{this.store.dispatch(new Lt.IA(a)),iu(this.store,this.engineService),this.store.dispatch(new jt.Yp(void 0))})}}),(0,Ht.z)([this.clippingPlanes$,this.readyState$]).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)&&!0===o?.model),(0,xn.F)(m.isEqual),(0,Fn.B)(0),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.clippingPlanesService.setClippingPlanes(t)}),(0,Ht.z)([this.selectedChapterId$,this.readyState$,this.autoplay$,this.prefersReducedMotion$]).pipe((0,S.p)(([t,o,i,s])=>!((0,m.isNil)(t)||(0,m.isNil)(o)||(0,m.isNil)(i)||(0,m.isNil)(s))),(0,b.Q)(this.ngUnsubscribe)).subscribe(([,t,o,i])=>{const s=(0,m.get)(t,"animation",!1),r=this.store.selectSnapshot(fe.N.getSelectedChapter),a=(0,m.get)(r,"ui.play.autoplay",!0),d=s&&o&&a&&!i;this.store.dispatch(new st.A6),this.store.dispatch(new st.dE(d))})}bindCameraEvents(){this.actions.pipe((0,l.xi)(jt.Ih,st.W6),(0,S.p)(t=>!!(t instanceof jt.Ih?t.camera:t.objectId)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=!this.store.selectSnapshot(Jo.U.getPrefersReducedMotion)&&t.animate;let i;i=t instanceof jt.Ih?o?this.flyToCamera(t.camera,t.animationDuration):this.jumpToCamera(t.camera):o?this.flyToObject(t.objectId,t.animationDuration):this.jumpToObject(t.objectId),i.then(()=>{this.liveAnnouncer.announce("Camera Postion Updated"),this.store.dispatch(new jt.Nz),t instanceof jt.Ih&&t.rotationCenter&&this.cameraService.setCameraRotationCenter(t.rotationCenter)})}),this.actions.pipe((0,l.xi)(jt.bB),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.panCameraStatic(t.x,t.y,t.z)}),this.actions.pipe((0,l.xi)(jt.RJ),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.rotateCameraStatic(t.x,t.y)}),this.actions.pipe((0,l.xi)(jt.F5),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraService.setAbsoluteZoom(t.value)})}bindToolEvents(){this.activeTool$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(Object.values(ts).forEach(o=>{o&&this.renderer.removeClass(this.engineElement.nativeElement,o)}),t){case qt.s.Fade:this.renderer.addClass(this.engineElement.nativeElement,ts.Fade);break;case qt.s.Hide:this.renderer.addClass(this.engineElement.nativeElement,ts.Hide);break;case qt.s.Label:this.renderer.addClass(this.engineElement.nativeElement,ts.Label);break;case qt.s.Paint:this.renderer.addClass(this.engineElement.nativeElement,ts.Paint);break;case qt.s.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,ts.Eyedropper)}})}bindMouseEvents(){this.mouseMove$=(0,yn.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleMousePan(t)}),this.mouseMove$.pipe((0,Ua.E)(this.store.select(Xe.S.getHoverPickEnabled)),(0,Kf.c)(10),(0,S.p)(([,t])=>t),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{this.handleMouseHover(t)}),this.mouseLeave$=(0,yn.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,Kf.c)(10),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(t){return(0,yn.R)(window,t).pipe((0,S.p)(()=>{const o=this.store.selectSnapshot(_e.getFocusedElement),i=(0,m.isEmpty)(document.querySelectorAll(".cdk-overlay-pane"));return!o&&i}))}bindKeyEvents(){const t=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((s,r)=>(s[r]=!1,s),{}),o=new ui.t(t);let i;this.bindWindowKeyEvent("keydown").pipe((0,S.p)(s=>!(s.repeat||s.metaKey||s.ctrlKey)),(0,S.p)(s=>{const a=s.target.nodeName.toLowerCase();return!(["input","textarea","select","option","button"].indexOf(a)>=0)}),(0,b.Q)(this.ngUnsubscribe)).subscribe(s=>{o.next({...o.value,[s.key.toLowerCase()]:!0,shiftKey:s.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,S.p)(s=>!!s.key),(0,b.Q)(this.ngUnsubscribe)).subscribe(s=>{1===Object.values(i).filter(a=>!0===a).length?(this.applyMotion(i,!0),o.next({...o.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1===i.shiftKey})):o.next({...o.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1})}),o.pipe((0,S.p)(()=>this.inputEnabled()),(0,b.Q)(this.ngUnsubscribe)).subscribe(s=>{i=s,!1===s.hasMomentum&&this.applyMotion(s,!1)})}applyMotion(t,o){const i=new DC.x,s=t.shiftKey?Bs.ZoomSlow:Bs.Zoom,r=t.shiftKey?Bs.PanSlow:Bs.Pan,a=t.shiftKey?Bs.RotateSlow:Bs.Rotate;i.zoom+=t.c||t["-"]||t._?s:0,i.zoom-=t.e||t["="]||t["+"]?s:0,i.panX-=t.d?r:0,i.panX+=t.a?r:0,i.panY+=t.w?r:0,i.panY-=t.s?r:0,i.rotateX-=t.arrowright?a:0,i.rotateX+=t.arrowleft?a:0,i.rotateY+=t.arrowup?a:0,i.rotateY-=t.arrowdown?a:0,i.applyFriction=o,this.store.dispatch(new jt.P4(i))}initChangeListener(){this.nodeStatePatches$.pipe((0,S.p)(t=>t.length>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=t.reduce((L,ee)=>{const re=ee.path[ee.path.length-1];return void 0!==L[re]&&L[re].push(ee),L},{available:[],shown:[],checked:[],paint:[],pickable:[],variant:[]}),i=L=>o[L].reduce((ee,re)=>(ee[re.path[2]]=re.value,ee),{}),s=i("available"),r=i("checked"),a=i("shown"),d=i("paint"),f=i("pickable"),T=i("variant");(0,m.isEmpty)(s)||this.applyAvailablePatches(s),(0,m.isEmpty)(a)||this.applyShownPatches(a,!0),(0,m.isEmpty)(r)||this.applyCheckedPatches(r),(0,m.isEmpty)(d)||this.applyPaintPatches(d),(0,m.isEmpty)(f)||this.applyPickablePatches(f),(0,m.isEmpty)(T)||this.applyVariantPatches(T,!1,!0,!0)})}initBackgroundListener(){(0,Ht.z)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",(0,ks.tH)(t)),this.isBackgroundCheckered(t)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",o?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",i?1:0)}),this.background$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.isBackgroundLight=(0,ks.T4)(t),this.changeDetecton.markForCheck()})}initPlaybackSpeedListener(){this.store.select(Xe.S.getPlaybackSpeed).pipe((0,S.p)(()=>this.store.selectSnapshot(fe.N.getSelectedChapterAnimationReady)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.animationService.setPlaybackRate(t)})}repositionEngine(t){const o=this.engineElement.nativeElement,{top:i,left:s,width:r,height:a,visibility:d,scale:f,viewportWidth:T,viewportHeight:L}=t;this.renderer.setStyle(o,"left",`${s}px`),this.renderer.setStyle(o,"top",`${i}px`),this.renderer.setStyle(o,"width",`${r}px`),this.renderer.setStyle(o,"height",`${a}px`),this.renderer.setStyle(o,"transform",`scale(${f})`),this.renderer.setStyle(o,"zIndex",`${d}`),this.renderer.setStyle(o,"visibility",d===qp.g.Shown?"visible":"hidden"),T!==r||L!==a||1!==f?this.renderer.addClass(o,"engine--scaled"):this.renderer.removeClass(o,"engine--scaled");const ee=Math.max(1,Math.floor(1/f));o?.style?.setProperty("--engine-border-width",`${ee}px`),this.visible=d===qp.g.Shown,this.engineService.fireEvent(gt.X.CanvasResized)}bindHumanInteractions(){this.hammerManager=new Yn.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new Yn.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new Yn.Tap({event:"singletap"})),this.hammerManager.add(new Yn.Pan({event:"pan",pointers:0})),this.hammerManager.add(new Yn.Pinch({event:"pinch"})),this.hammerManager.add(new Yn.Press({time:500})),this.hammerManager.on("singletap",i=>{this.store.selectSnapshot(Xe.S.getClickPickEnabled)&&this.handleTap(i)}),this.hammerManager.on("doubletap",i=>{this.handleDoubleTap(i)}),this.hammerManager.on("press",i=>{i.preventDefault(),i.srcEvent.stopImmediatePropagation(),this.handlePress(i)}),this.hammerManager.on("pan",i=>{i.preventDefault(),this.handlePan(i)}),this.hammerManager.on("panend",i=>{this.handlePanEnd(i)}),this.hammerManager.on("pinchend",i=>{this.handlePinchEnd(i)});let t=0,o=0;this.hammerManager.on("pinchstart",i=>{t=i.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",i=>{if(this.pinchTicks>0)return;const s=Math.abs(i.deltaX)>60||Math.abs(i.deltaY)>60,r=i.scale>1.25||i.scale<.75;this.pinchMode?("pan"===this.pinchMode&&r&&!s&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&s&&!r&&(this.pinchMode="pan")):this.pinchMode=r?"pinch":"pan";const a=i.scale-t;t=i.scale;const d=o;o=0===a?0:a>0?1:-1,this.cameraService.setCameraPan(i.velocityX*ti.Pan,i.velocityY*ti.Pan),o+d!==0&&this.cameraService.setRelativeZoom(a*ti.Zoom)})}handleMouseHover(t){if(t.buttons!==yS.None)return;const{offsetX:o,offsetY:i}=t,s=this.pickAtCanvasPosition(o,i,!1);if(s.objectId){const r=this.store.selectSnapshot(Xe.S.getViewGraph),a=this.sceneService.getViewNode(r,s.objectId),d=this.store.selectSnapshot(Xe.S.getHoveredNode);(!d||d.id!==a.id)&&this.store.dispatch(new st.DZ(a,s))}else null!=this.store.selectSnapshot(Xe.S.getHoveredNode)&&this.store.dispatch(new st.DZ(null))}handleMouseLeave(){this.store.dispatch(new st.DZ(null))}handleMousePan(t){if(2===t.buttons||4===t.buttons){let{movementX:o,movementY:i}=t;o/=16,i/=16,this.cameraService.setCameraPan(o,i)}}handleMouseOut(){this.store.dispatch(new st.DZ(null))}handleWheel(t){let o=0;0===t.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(t.deltaY)<10?"trackpad":"wheel"),o="trackpad"===this.scrollType?t.deltaY*ti.TrackZoom:Math.sign(t.deltaY)*Ro.Zoom):(this.scrollType="wheel",o=t.deltaY*Ro.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(o)>40&&(o=40*Math.sign(o)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(o):this.zoomWithVelocity(o)}zoomWithVelocity(t){this.cameraService.setCameraZoom(t),requestAnimationFrame(()=>{t*=.85,Math.abs(t)>1&&this.zoomWithVelocity(t)})}handleContextMenu(t){t.preventDefault();const{offsetX:o,offsetY:i}=t,s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);this.store.dispatch(new st.fZ(r,s))}handlePanEnd(t){const o=this.store.selectSnapshot(fi.x.getCameraMotion);if(this.pinchTicks>0||o.panX===t.velocityX&&o.panY===t.velocityY)return;const i=this.store.selectSnapshot(fi.x.getPanMode);t.srcEvent.shiftKey||"pan"===i?(o.panX=t.velocityX*ti.Pan,o.panY=t.velocityY*ti.Pan):(o.rotateX=t.velocityX*ti.Rotate,o.rotateY=t.velocityY*ti.Rotate),o.applyFriction=!0,this.store.dispatch(new jt.P4(o))}handlePinchEnd(t){const o=this.store.selectSnapshot(fi.x.getCameraMotion);if("pan"===this.pinchMode)o.panX=t.velocityX*ti.Pan,o.panY=t.velocityY*ti.Pan;else{const i=t.velocity>0?1:-1;o.zoom=Math.sqrt(t.velocityX*t.velocityX+t.velocityY*t.velocityY)*-i*ti.Zoom}o.applyFriction=!0,this.store.dispatch(new jt.P4(o)),this.pinchTicks=10}handleTap(t){const{offsetX:o,offsetY:i}=this.getOffset(t),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);this.store.dispatch(new st.zE(r,t,s))}handleDoubleTap(t){const{offsetX:o,offsetY:i}=this.getOffset(t),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);r&&this.store.dispatch(new st.W6(r.id))}handlePress(t){const{offsetX:o,offsetY:i}=this.getOffset(t),s=this.pickAtCanvasPosition(o,i),r=this.getNodeFromHit(s);r&&this.store.dispatch(new st.W6(r.id))}handlePan(t){if(this.pinchTicks>0)return;const o=this.store.selectSnapshot(fi.x.getPanMode),{velocityX:i,velocityY:s}=t;t.srcEvent.shiftKey||"pan"===o?this.cameraService.setCameraPan(i*ti.Pan,s*ti.Pan):this.cameraService.setCameraRotation(i*ti.Rotate,s*ti.Rotate)}handleMouseInputEngineTick(t){const o=this.cameraService.tickCameraRotation(),i=this.cameraService.tickCameraPan(),s=this.cameraService.tickCameraZoom(),r=Math.min(15,(window.performance.now()-this.deltaTime)/vS);if((o.vx||o.vy)&&this.cameraService.rotateCameraStatic(0!==o.vx?r*o.vx*Ro.Rotate:0,0!==o.vy?r*o.vy*Ro.Rotate:0),i.x||i.y){const a=this.cameraService.getLookDistance(),d=Math.max(a/80,.01);this.cameraService.panCameraStatic(r*i.x*d*Ro.Pan,r*i.y*d*Ro.Pan,r*i.z*d*Ro.Pan)}0!==s&&this.cameraService.setRelativeZoom(r*s*Ro.Zoom)}handleCameraTick(t){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const o=this.store.selectSnapshot(fi.x.getCameraMotion);this.cameraService.setCameraPan(o.panX,o.panY),this.cameraService.setCameraRotation(o.rotateX,o.rotateY),this.cameraService.setCameraZoom(o.zoom),this.cameraService.tickCamera(t)}applyCheckedPatches(t){this.engineService.fireEvent(gt.X.SceneObjectsSelected,{selectedObjectsUpdate:t});const o=this.store.selectSnapshot(Xe.S.getViewGraph),i=this.store.selectSnapshot(Xe.S.getXrayModeEnabled);Object.entries(t).forEach(([s,r])=>{i?this.paintService.paint(o,s,!0===r?Es.NR:Es.EC):this.paintService.highlight(o,s,r)})}applyShownPatches(t,o){const i=Object.keys(t),s=this.sceneService.getObjectsById(i),r=i.reduce((T,L)=>(this.sceneService.isLeaf(s[L])&&(T[L]=t[L]),T),{});this.engineService.fireEvent(gt.X.SceneObjectsShown,{enabledObjectsUpdate:r});const a=this.store.selectSnapshot(Mn.z.getNodes),d=Object.values(a).reduce((T,L)=>(T[L.objectId]=L.shown,T),{});o&&this.sceneService.setNodesVisible(d);const f=this.convertToLeafStateMap("shown",d);this.store.dispatch(new st.A0(f,a))}applyPaintPatches(t){Object.entries(t).forEach(([o,i])=>{this.paintService.colorObject(o,(0,ja.Sf)(i))})}applyPickablePatches(t){const o=this.store.selectSnapshot(Mn.z.getNodes),i=Object.values(o).reduce((s,r)=>(s[r.objectId]=r.pickable,s),{});this.sceneService.setNodesProperty(i,"pickable"),this.store.dispatch(new st.$V(this.convertToLeafStateMap("pickable",i),o))}applyAvailablePatches(t){const o=this.store.selectSnapshot(Mn.z.getNodes),i=this.convertToLeafStateMap("available",t);this.store.dispatch(new st.Rc(i,o))}applyVariantPatches(t,o,i,s){if(o&&this.store.dispatch(new Lt._n(t,s)),i){const{anatomyObjects:r}=this.sceneService.getAnatomySceneGraph();Object.entries(t).forEach(([a,d])=>{this.sceneService.setObjectVariant(r,a,d)})}}getFriction(t){if(0===t)return 0;const o=(window.performance.now()-this.deltaTime)/vS;let s=t*Math.max(0,ti.Friction+.1*(1-o));return Math.abs(s)<ti.FrictionThreshold&&(s=0),s}applyFriction(){const t=this.store.selectSnapshot(fi.x.getCameraMotion);!0===t.applyFriction&&(t.rotateX=this.getFriction(t.rotateX),t.rotateY=this.getFriction(t.rotateY),t.panX=this.getFriction(t.panX),t.panY=this.getFriction(t.panY),t.zoom=this.getFriction(t.zoom),0===t.rotateX&&0===t.rotateY&&0===t.panX&&0===t.panY&&0===t.zoom&&(t.applyFriction=!1),this.store.dispatch(new jt.P4(t)))}flyToObject(t,o){return this.cameraService.flyToObject(t,o)}flyToCamera(t,o){return this.cameraService.flyToCamera(t,o)}jumpToObject(t){return this.cameraService.jumpToObject(t)}jumpToCamera(t){return this.cameraService.jumpToCamera(t)}getNodeFromHit(t){let o;if(t.objectId){const i=this.store.selectSnapshot(Xe.S.getViewGraph);o=this.sceneService.getViewNode(i,t.objectId)}return o}pickAtCanvasPosition(t,o,i=!0){const s=this.enginePosition?.scale??1;if(1!==s){const r=1/s,a=Kt.vec3Pool.get();[t,o]=Rn.scale(a,[t,o,0],r),Kt.vec3Pool.release(a)}return this.engineRendererService.pick(t,o,i)}getOffset(t){let o=0,i=0;t.center?(o=t.center.x,i=t.center.y):(o=t.clientX,i=t.clientY);const r=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:o-r.left,offsetY:i-r.top}}isTransparentBackground(t){return!!t&&(0,ks.ty)(this.background.getValue())}isBackgroundCheckered(t){return I.c.application!==Wn.c.Viewer&&this.isTransparentBackground(t)}playChapterFromStart(){this.store.selectSnapshot(fe.N.getSelectedChapterReadyState).animation&&(this.store.dispatch(new st.A6),this.store.dispatch(new st.dE(!0)))}initVideo(){this.mediaService.getVideoEvents().pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const{id:o,event:i}=t;"play"===i&&this.store.dispatch(new Kc(o)),this.store.selectSnapshot(Pr.getCurrentVideo)===o&&("pause"===i||"ended"===i)&&this.store.dispatch(new Kc(null))})}}(Za=Un).\u0275fac=function(t){return new(t||Za)(e.rXU(l.En),e.rXU(ne.nX),e.rXU(zi.O),e.rXU(co.j),e.rXU(e.gRc),e.rXU(u.y),e.rXU(du),e.rXU(ji.w),e.rXU(Ci),e.rXU(ua.s),e.rXU(e.sFG),e.rXU(zt.n$),e.rXU(l.il),e.rXU(po.S),e.rXU(XC),e.rXU(Fa.z),e.rXU(oh),e.rXU(Qi.Ai))},Za.\u0275cmp=e.VBU({type:Za,selectors:[["app-engine"]],viewQuery:function(t,o){if(1&t&&e.GBs(xM,7),2&t){let i;e.mGM(i=e.lsd())&&(o.engineElement=i.first)}},hostBindings:function(t,o){1&t&&e.bIt("wheel",function(s){return o.wheel(s)})("contextmenu",function(s){return o.onContextMenu(s)})("mouseout",function(s){return o.onMouseOut(s)})},inputs:{inputEnabled:[e.Mj6.SignalBased,"inputEnabled"],contextMenuEnable:[e.Mj6.SignalBased,"contextMenuEnable"]},decls:16,vars:24,consts:[["engine",""],["id","container","data-test","engine","role","complementary",1,"engine",3,"ngClass"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"],["cdkDrag","",1,"engine__stats",3,"cdkDragBoundary"],[3,"theme","showAdvancedTools"]],template:function(t,o){if(1&t&&(e.j41(0,"div",1,0),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,GM,1,0,"div",2),e.nI1(5,"async"),e.nrm(6,"app-labels"),e.DNE(7,$M,1,2,"app-engine-contextmenu",3)(8,BM,1,0,"div",4)(9,zM,1,0,"app-engine-progress",5),e.nI1(10,"async"),e.nrm(11,"app-engine-scroll")(12,"app-engine-fade"),e.DNE(13,WM,3,5,"div",6),e.nI1(14,"async"),e.DNE(15,XM,1,0,"app-engine-camera-position"),e.k0s()),2&t){const i=e.sdS(1);e.Y8G("ngClass",e.eq3(22,FM,"screen"===e.bMT(2,12,o.overlayType$))),e.BMQ("data-progress",o.progress)("data-chapter-ready",o.chapterReady)("data-camera-animating",o.cameraAnimating)("data-story-id",e.bMT(3,14,o.storyId$))("data-engine-version",o.VERSION),e.R7$(4),e.vxM(4,e.bMT(5,16,o.watermarkEnabled$)?4:-1),e.R7$(3),e.vxM(7,o.contextMenuNode?7:-1),e.R7$(),e.vxM(8,o.inputEnabled()?-1:8),e.R7$(),e.vxM(9,e.bMT(10,18,o.showProgressBar$)?9:-1),e.R7$(4),e.vxM(13,e.bMT(14,20,o.statsEnabled$)?13:-1),e.R7$(2),e.vxM(15,o.showDebug&&i?15:-1)}},dependencies:[q.YU,Jc.T1,Kn,qa,AM,RM,UM,jM,VM,q.Jj],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--hidden[_ngcontent-%COMP%]{display:none!important}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.svg) 7 20,pointer}.engine--cursor-fade[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-fade.svg) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.svg) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.svg) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea),linear-gradient(45deg,#d7e0ea 25%,transparent 25%,transparent 75%,#d7e0ea 75%,#d7e0ea)}.engine--scaled[_ngcontent-%COMP%]{outline:var(--engine-border-width, 1px) solid #d7e0ea}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}.engine__stats[_ngcontent-%COMP%]{position:absolute;width:-moz-fit-content;width:fit-content;max-height:calc(100vh - 32px);overflow:auto;top:16px;right:16px;z-index:2}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0}),Gn([(0,l.l6)(Xe.S.getEnginePosition),$n("design:type",y.c)],Un.prototype,"enginePosition$",void 0),Gn([(0,l.l6)(Xe.S.getHoveredNode),$n("design:type",y.c)],Un.prototype,"hoveredNode$",void 0),Gn([(0,l.l6)(Mn.z.getPatches),$n("design:type",y.c)],Un.prototype,"nodeStatePatches$",void 0),Gn([(0,l.l6)(Xe.S.getActiveTool),$n("design:type",y.c)],Un.prototype,"activeTool$",void 0),Gn([(0,l.l6)(Xe.S.getDisplay),$n("design:type",y.c)],Un.prototype,"engineDisplay$",void 0),Gn([(0,l.l6)(Xe.S.getVisible),$n("design:type",y.c)],Un.prototype,"engineVisible$",void 0),Gn([(0,l.l6)(Xe.S.getShowProgressBar),$n("design:type",y.c)],Un.prototype,"showProgressBar$",void 0),Gn([(0,l.l6)(Xe.S.getContextMenu),$n("design:type",y.c)],Un.prototype,"contextMenu$",void 0),Gn([(0,l.l6)(Xe.S.getAutoplay),$n("design:type",y.c)],Un.prototype,"autoplay$",void 0),Gn([(0,l.l6)(rt.getStoryId),$n("design:type",y.c)],Un.prototype,"storyId$",void 0),Gn([(0,l.l6)(fe.N.getSelectedChapter),$n("design:type",y.c)],Un.prototype,"selectedChapter$",void 0),Gn([(0,l.l6)(fe.N.getSelectedChapterId),$n("design:type",y.c)],Un.prototype,"selectedChapterId$",void 0),Gn([(0,l.l6)(fe.N.getSelectedChapterReadyState),$n("design:type",y.c)],Un.prototype,"readyState$",void 0),Gn([(0,l.l6)(fe.N.getSelectedChapterClippingPlanes),$n("design:type",y.c)],Un.prototype,"clippingPlanes$",void 0),Gn([(0,l.l6)(fe.N.getSelectedChapterBackground),$n("design:type",y.c)],Un.prototype,"background$",void 0),Gn([(0,l.l6)(Xe.S.getWatermarkEnabled),$n("design:type",y.c)],Un.prototype,"watermarkEnabled$",void 0),Gn([(0,l.l6)(Xe.S.getStatsEnabled),$n("design:type",y.c)],Un.prototype,"statsEnabled$",void 0),Gn([(0,l.l6)(Xe.S.getShowAdvancedStatsTools),$n("design:type",y.c)],Un.prototype,"showAdvancedTools$",void 0),Gn([(0,l.l6)(Ln.getXROverlayType),$n("design:type",y.c)],Un.prototype,"overlayType$",void 0),Gn([(0,l.l6)(Jo.U.getPrefersReducedMotion),$n("design:type",y.c)],Un.prototype,"prefersReducedMotion$",void 0);const QM=(n,t)=>({"pillbox-divider--horizontal":n,"pillbox-divider--vertical":t});let sd=(()=>{var n;class t{constructor(){this.orientation="horizontal"}ngOnInit(){}get justifySelf(){return"vertical"===this.orientation?"stretch":""}get alignSelf(){return"horizontal"===this.orientation?"stretch":""}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-pillbox-divider"]],hostVars:4,hostBindings:function(i,s){2&i&&e.xc7("justify-self",s.justifySelf)("align-self",s.alignSelf)},inputs:{orientation:"orientation"},decls:1,vars:4,consts:[[1,"pillbox-divider",3,"ngClass"]],template:function(i,s){1&i&&e.nrm(0,"div",0),2&i&&e.Y8G("ngClass",e.l_i(1,QM,"horizontal"===s.orientation,"vertical"===s.orientation))},dependencies:[q.YU],styles:["[_nghost-%COMP%]{display:flex}.pillbox-divider[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.pillbox-divider--horizontal[_ngcontent-%COMP%]{height:100%;border-right:1px solid #d7e0ea}.pillbox-divider--vertical[_ngcontent-%COMP%]{width:40px;border-bottom:1px solid #d7e0ea}"],changeDetection:0}),t})();const YM=["*"],KM=(n,t)=>({"pillbox--vertical":n,"pillbox--horizontal":t});function JM(n,t){if(1&n){const o=e.RV6();e.qex(0),e.nrm(1,"app-pillbox-divider"),e.j41(2,"button",2),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.nrm(3,"app-icon",3),e.k0s(),e.bVm()}if(2&n){const o=e.XpG();e.R7$(2),e.Y8G("matTooltip","Close "+o.name),e.BMQ("aria-label","Close "+o.name)}}let Do=(()=>{var n;class t{constructor(){this.canExit=!1,this.padding="normal",this.orientation="horizontal",this.name="",this.exit=new e.bkB}ngOnInit(){}handleExitClick(){this.exit.emit()}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-pillbox"]],inputs:{canExit:"canExit",padding:"padding",orientation:"orientation",name:"name"},outputs:{exit:"exit"},ngContentSelectors:YM,decls:3,vars:5,consts:[[1,"pillbox",3,"ngClass"],[4,"ngIf"],["data-test","closePillboxButton","app-view-button","",3,"click","matTooltip"],["icon","times"]],template:function(i,s){1&i&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.DNE(2,JM,4,2,"ng-container",1),e.k0s()),2&i&&(e.Y8G("ngClass",e.l_i(2,KM,"vertical"===s.orientation,"horizontal"===s.orientation)),e.R7$(2),e.Y8G("ngIf",s.canExit))},dependencies:[q.YU,q.bT,rn,On.oV,yt.R,sd],styles:[":host{display:inline-block}.pillbox{box-shadow:0 1px 4px 1px #0500380a;border:1px solid #d7e0ea;pointer-events:all;background:#fffffff2;border-radius:4px;display:flex;overflow:hidden;transition:all .1s ease-out}.pillbox:empty{border:0;box-shadow:none}.pillbox:hover{background:#fff}.pillbox--vertical{flex-direction:column;align-items:center}.pillbox--horizontal{flex-direction:row}\n"],encapsulation:2,changeDetection:0}),t})();var el,ES=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},CS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function qM(n,t){1&n&&e.nrm(0,"app-icon",16)}function ZM(n,t){1&n&&e.nrm(0,"app-icon",17),2&n&&e.Y8G("custom",!0)}function eI(n,t){1&n&&(e.j41(0,"span",8),e.pXf(1,2),e.k0s())}function tI(n,t){1&n&&(e.j41(0,"span",8),e.pXf(1,3),e.k0s())}function nI(n,t){if(1&n){const o=e.RV6();e.j41(0,"li")(1,"button",18),e.bIt("touchend",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))})("mouseup",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))})("keyup.enter",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))}),e.nrm(2,"app-icon",19),e.k0s()()}}function iI(n,t){if(1&n){const o=e.RV6();e.j41(0,"li")(1,"button",20),e.bIt("touchend",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))})("mouseup",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))})("keyup.enter",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))}),e.nrm(2,"app-icon",21),e.k0s()()}}function oI(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"li")(2,"button",12),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.togglePan())}),e.DNE(4,qM,1,0,"app-icon",13),e.nI1(5,"async"),e.DNE(6,ZM,1,1,"app-icon",14),e.nI1(7,"async"),e.DNE(8,eI,2,0,"span",15),e.nI1(9,"async"),e.DNE(10,tI,2,0,"span",15),e.nI1(11,"async"),e.k0s()(),e.DNE(12,nI,3,0,"li",11),e.nI1(13,"async"),e.DNE(14,iI,3,0,"li",11),e.nI1(15,"async"),e.bVm()}if(2&n){const o=e.XpG();e.R7$(2),e.Y8G("matTooltip",o.cameraModeTooltip),e.BMQ("aria-pressed","pan"===e.bMT(3,8,o.panMode$)),e.R7$(2),e.Y8G("ngIf","pan"===e.bMT(5,10,o.panMode$)),e.R7$(2),e.Y8G("ngIf","rotate"===e.bMT(7,12,o.panMode$)),e.R7$(2),e.Y8G("ngIf","pan"===e.bMT(9,14,o.panMode$)),e.R7$(2),e.Y8G("ngIf","rotate"===e.bMT(11,16,o.panMode$)),e.R7$(2),e.Y8G("ngIf",e.bMT(13,18,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny),e.R7$(2),e.Y8G("ngIf",e.bMT(15,20,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny)}}class rd{get cameraToggleTooltip(){return this.collapsed?$localize`Open 3D Controls`:$localize`Close 3D Controls`}constructor(t,o,i,s,r){this.store=t,this.cameraService=o,this.viewService=i,this.liveAnnouncer=s,this.changeDetectorRef=r,this.collapsed=!0,this.canCollapse=!0,this.viewLayout=G,this.toolEnum=qt.s,this.expandNav=!1,this.breakpointEnum=Vn,this.canvasHeightBreakpoint=Mo.h,this.padding="none",this.ngUnsubscribe=new Q.B,this.initTooltips()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTooltips(){this.panMode$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.cameraModeTooltip="pan"===t?$localize`Change to Rotate Mode`:$localize`Change to Pan Mode`}),this.changeDetectorRef.markForCheck()}setZoomFixed(t){this.cameraService.setCameraZoomWithVelocity("in"===t?-8:8);const i=(100*this.cameraService.getCameraZoom()).toFixed(0);this.liveAnnouncer.announce(`zoomed ${t} to ${i}%`)}returnToChapterCamera(){const t=this.store.selectSnapshot(fe.N.getSelectedChapter);this.store.dispatch(new jt.Ih(t.camera.location)).subscribe(()=>{this.liveAnnouncer.announce("recenter complete")})}resetChapter(){this.returnToChapterCamera();const t=this.store.selectSnapshot(fe.N.getSelectedChapterId);this.store.dispatch(new di.a.UndoAll(t)),this.store.dispatch(new Lt.q9(!1)),this.store.dispatch(new He.S3)}togglePan(){this.viewService.togglePan()}toggleCameraBar(){this.collapsed=!this.collapsed}}(el=rd).\u0275fac=function(t){return new(t||el)(e.rXU(l.il),e.rXU(co.j),e.rXU(hn),e.rXU(Qi.Ai),e.rXU(e.gRc))},el.\u0275cmp=e.VBU({type:el,selectors:[["app-engine-camera-bar"]],inputs:{collapsed:"collapsed",canCollapse:"canCollapse"},decls:13,vars:4,consts:()=>{let n,t,o,i,s,r,a,d,f,T;return n=$localize`:fa8adc0f5e22d9c18b37663b6f2bb1b50424eb1c8617328588319285229:Camera Control Buttons`,t=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,o=$localize`:0c6b2042f7ade77091a6e0b314f5797a51644835918403358406080994:Toggle 3D navigation controls`,i=$localize`:0459da369b661293df2216dab6d5504bc0ae736d4770948314010072135:Clicking this button will reset the camera viewing the 3D model`,s=$localize`:240d93ec4b5179c4fd189688280eaa63b0d6d7836492222661583280:Pan mode active, change to rotate mode`,r=$localize`:e583fc810e521ceb2967fc19734fed46a2540c944140573029148607220:Rotate mode active, change to pan mode`,a=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,d=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,f=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,T=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,[o,i,s,r,["direction","vertical","data-test","cameraBar","direction","vertical","appPreventFadeout",""],["role","group","aria-label",n],["app-view-button","","buttonSize","small","data-test","cameraToggleBar","matTooltipPosition","left",3,"click","short","matTooltip"],["size","sm",3,"icon"],[1,"sr-only"],["app-view-button","","buttonSize","small","matTooltip",t,"matTooltipPosition","left","data-test","cameraReset",3,"click"],["size","lg","icon","location-crosshairs"],[4,"ngIf"],["app-view-button","","buttonSize","small","matTooltipPosition","left","data-test","cameraPan",3,"click","matTooltip"],["size","lg","icon","arrows-up-down-left-right",4,"ngIf"],["size","lg","icon","rotate",3,"custom",4,"ngIf"],["class","sr-only",4,"ngIf"],["size","lg","icon","arrows-up-down-left-right"],["size","lg","icon","rotate",3,"custom"],["app-view-button","","buttonSize","small","data-test","cameraZoomIn","aria-label",a,"matTooltip",d,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","plus"],["app-view-button","","buttonSize","small","data-test","cameraZoomOut","aria-label",f,"matTooltip",T,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","minus"]]},template:function(t,o){1&t&&(e.j41(0,"app-pillbox",4)(1,"ul",5)(2,"li")(3,"button",6),e.bIt("click",function(){return o.toggleCameraBar()}),e.nrm(4,"app-icon",7),e.j41(5,"span",8),e.pXf(6,0),e.k0s()()(),e.j41(7,"li")(8,"button",9),e.bIt("click",function(){return o.returnToChapterCamera()}),e.nrm(9,"app-icon",10),e.j41(10,"span",8),e.pXf(11,1),e.k0s()()(),e.DNE(12,oI,16,22,"ng-container",11),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("short",!0)("matTooltip",o.cameraToggleTooltip),e.R7$(),e.Y8G("icon",o.collapsed?"angle-up":"angle-down"),e.R7$(8),e.Y8G("ngIf",!o.collapsed))},dependencies:[q.bT,Us,On.oV,rn,yt.R,Do,q.Jj],encapsulation:2,data:{animation:[(0,Le.hZ)("expand",[(0,Le.kY)(":enter",[(0,Le.K2)([(0,Le.iF)({height:0}),(0,Le.i0)("150ms ease-in-out",(0,Le.iF)({height:"*"}))])]),(0,Le.kY)(":leave",[(0,Le.K2)([(0,Le.i0)("150ms ease-in-out",(0,Le.iF)({height:"0"}))])])]),(0,Le.hZ)("show",[(0,Le.kY)(":enter",[(0,Le.K2)([(0,Le.iF)({height:"0"}),(0,Le.i0)("125ms ease-in-out",(0,Le.iF)({height:"*"}))])]),(0,Le.kY)(":leave",[(0,Le.K2)([(0,Le.i0)("125ms 125ms ease-in-out",(0,Le.iF)({height:"0"}))])])])]},changeDetection:0}),ES([(0,l.l6)(fi.x.getPanMode),CS("design:type",y.c)],rd.prototype,"panMode$",void 0),ES([(0,l.l6)(Xe.S.getCanvasHeightBreakpoint),CS("design:type",y.c)],rd.prototype,"canvasHeightBreakpoint$",void 0);const sI=["scrubber"],rI=["track"],aI=["bar"],lI=["handle"],cI=(n,t,o,i)=>({"view-slider--immediate":n,"view-slider--show-track":t,"view-slider--x":o,"view-slider--y":i});let TS=(()=>{var n;class t{get percent(){return this._percent}set percent(i){this._percent=i,this.dragging||(this.setScrubberBar(i),this.setScrubberHandle(i))}get dragging(){return this._dragging}set dragging(i){i!=this.dragging&&(i?this.dragStarted.emit(this.percent):this.dragEnded.emit(this.percent)),this._dragging=i,this.draggingChanged.emit(i)}constructor(i,s){this.renderer=i,this.changeDetectorRef=s,this.accessibleLabel="",this.sliderAxis="x",this.showTrack=!1,this._percent=0,this.percentChanged=new e.bkB,this._dragging=!1,this.animate=!0,this.draggingChanged=new e.bkB,this.dragStarted=new e.bkB,this.dragEnded=new e.bkB,this.trackClicked=new e.bkB,this.ngUnsubscribe=new Q.B,this.trackWidth=0,this.dragPosition={x:0,y:0}}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.setScrubberBar(this.percent),this.setScrubberHandle(this.percent)}),this.initDragListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initDragListener(){this.dragInstance.moved.pipe((0,wo.Z)(20),(0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.percent=this.calculateHandlePercent(),this.setScrubberBar(this.percent),this.percentChanged.emit(this.percent)})}handleDragStart(){this.dragging=!0,this.animate=!1}handleDragEnd(){this.dragging=!1,this.animate=!0}handleTrackClick(i){this.animate=!1,this.changeDetectorRef.markForCheck(),setTimeout(()=>{this.percent=this.getClickPercent(i),this.trackClicked.emit(this.percent),this.percentChanged.emit(this.percent),setTimeout(()=>{this.animate=!0})})}handleKeyDown(i){switch(i.key){case"Home":this.increment(-100),i.stopPropagation();break;case"End":this.increment(100),i.stopPropagation();break;case"PageDown":this.increment(-10),i.stopPropagation();break;case"PageUp":this.increment(10),i.stopPropagation();break;case"ArrowLeft":case"ArrowDown":this.increment(-1),i.stopPropagation();break;case"ArrowRight":case"ArrowUp":this.increment(1),i.stopPropagation()}}increment(i){this.percent+=i,this.percent>100&&(this.percent=100),this.percent<0&&(this.percent=0),this.percentChanged.emit(this.percent)}getClickPercent(i){const{height:s,width:r}=this.track.nativeElement.getBoundingClientRect();let a=0;switch(this.sliderAxis){case"x":a=i.offsetX/r*100;break;case"y":a=(s-i.offsetY)/s*100}return a>100&&(a=100),a<0&&(a=0),a}calculateHandlePercent(){const i=this.getTrackWidth(),s=this.scrubber.nativeElement.getBoundingClientRect().left,r=this.handle.nativeElement.getBoundingClientRect().left,a=this.getTrackHeight(),d=this.scrubber.nativeElement.getBoundingClientRect().top,f=this.handle.nativeElement.getBoundingClientRect().top;let T=0;switch(this.sliderAxis){case"x":T=(r-s)/i*100;break;case"y":T=100-(f-d)/a*100}return Math.min(Math.max(T,0),100)}setScrubberBar(i){switch(this.sliderAxis){case"x":this.renderer.setStyle(this.bar.nativeElement,"width",`${i}%`);break;case"y":this.renderer.setStyle(this.bar.nativeElement,"height",`${i}%`)}this.changeDetectorRef.markForCheck()}setScrubberHandle(i){let s,r;switch(this.sliderAxis){case"x":s=this.getTrackWidth(),this.dragPosition={...this.dragPosition,x:s*(i/100)};break;case"y":r=this.getTrackHeight(),this.dragPosition={...this.dragPosition,y:r-r*(i/100)}}this.changeDetectorRef.markForCheck()}getTrackWidth(){const{left:i,right:s}=this.scrubber.nativeElement.getBoundingClientRect();return s-i-this.handle.nativeElement.offsetWidth}getTrackHeight(){const{height:i}=this.scrubber.nativeElement.getBoundingClientRect();return i-this.handle.nativeElement.offsetHeight}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-slider"]],viewQuery:function(i,s){if(1&i&&(e.GBs(sI,7),e.GBs(rI,7),e.GBs(aI,7),e.GBs(lI,7),e.GBs(Jc.T1,5)),2&i){let r;e.mGM(r=e.lsd())&&(s.scrubber=r.first),e.mGM(r=e.lsd())&&(s.track=r.first),e.mGM(r=e.lsd())&&(s.bar=r.first),e.mGM(r=e.lsd())&&(s.handle=r.first),e.mGM(r=e.lsd())&&(s.dragInstance=r.first)}},inputs:{accessibleLabel:"accessibleLabel",sliderAxis:"sliderAxis",showTrack:"showTrack",percent:"percent"},outputs:{percentChanged:"percentChanged",draggingChanged:"draggingChanged",dragStarted:"dragStarted",dragEnded:"dragEnded",trackClicked:"trackClicked"},decls:8,vars:10,consts:[["scrubber",""],["track",""],["bar",""],["handle",""],[1,"view-slider",3,"ngClass"],[1,"view-slider__track",3,"click"],[1,"view-slider__bar"],["cdkDrag","","cdkDragBoundary",".view-slider","role","slider","tabindex","0","aria-valuemin","0","aria-valuemax","100",1,"view-slider__handle",3,"cdkDragStarted","cdkDragEnded","keydown","cdkDragLockAxis","cdkDragFreeDragPosition"]],template:function(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",4,0)(2,"div",5,1),e.bIt("click",function(d){return e.eBV(r),e.Njj(s.handleTrackClick(d))}),e.nrm(4,"div",6,2),e.k0s(),e.j41(6,"div",7,3),e.bIt("cdkDragStarted",function(){return e.eBV(r),e.Njj(s.handleDragStart())})("cdkDragEnded",function(){return e.eBV(r),e.Njj(s.handleDragEnd())})("keydown",function(d){return e.eBV(r),e.Njj(s.handleKeyDown(d))}),e.k0s()()}2&i&&(e.Y8G("ngClass",e.ziG(5,cI,!s.animate,s.showTrack,"x"===s.sliderAxis,"y"===s.sliderAxis)),e.R7$(6),e.Y8G("cdkDragLockAxis",s.sliderAxis)("cdkDragFreeDragPosition",s.dragPosition),e.BMQ("aria-label",s.accessibleLabel)("aria-valuenow",s.percent))},dependencies:[q.YU,Jc.T1],styles:['.view-slider[_ngcontent-%COMP%]{--height: 28px;--width: 100%;--track-height: 4px;--track-width: 100%;--bar-height: 4px;--bar-width: 0;--handle-height: 28px;--handle-width: 32px;--handle-bulb-size: 12px;--track-color: #d7e0ea;--bar-color: #374a68;--handle-color: transparent;--bar-hover-color: #2d72dc;--handle-hover-color: #2d72dc;--track-hover-color: #d7e0ea;--half-width: calc(var(--handle-width) / 2);--half-height: calc(var(--handle-height) / 2);position:relative;display:flex;justify-content:center;align-items:center;height:var(--height);width:var(--width)}.view-slider[_ngcontent-%COMP%]:hover, .view-slider.view-slider--show-track[_ngcontent-%COMP%]{cursor:pointer}.view-slider[_ngcontent-%COMP%]:hover.view-slider--x, .view-slider.view-slider--show-track.view-slider--x[_ngcontent-%COMP%]{--bar-height: 6px;--track-height: 6px}.view-slider[_ngcontent-%COMP%]:hover.view-slider--y, .view-slider.view-slider--show-track.view-slider--y[_ngcontent-%COMP%]{--bar-width: 6px;--track-width: 6px}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__bar[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{background:var(--bar-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{opacity:1}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]:after{background:var(--handle-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__track[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]:after{background:var(--track-hover-color)}.view-slider--x[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{left:var(--half-width);right:var(--half-width)}.view-slider--y[_ngcontent-%COMP%]{--height: 100%;--width: 28px;--track-height: 100%;--track-width: 4px;--bar-height: 0;--bar-width: 4px;--handle-height: 32px;--handle-width: 28px;flex-direction:column-reverse;justify-content:flex-end}.view-slider--y[_ngcontent-%COMP%]:hover{--bar-width: 6px;--track-width: 6px}.view-slider--y[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{left:auto}.view-slider--y[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{flex-direction:column-reverse;top:var(--half-height);bottom:var(--half-height)}.view-slider--immediate[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%], .view-slider--immediate[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{transition:none!important}.view-slider__track[_ngcontent-%COMP%]{display:flex;align-items:center;position:absolute;inset:0}.view-slider__track[_ngcontent-%COMP%]:after{content:" ";background:var(--track-color);height:var(--track-height);width:var(--track-width);transition:all .2s ease-in-out,width 50ms}.view-slider__bar[_ngcontent-%COMP%]{border-radius:2px;position:absolute;background:var(--bar-color);height:var(--bar-height);width:var(--bar-width);z-index:2;left:0;transition:all .2s ease-in-out,width 50ms;pointer-events:none}.view-slider__handle[_ngcontent-%COMP%]{width:var(--handle-width);height:var(--handle-height);margin-left:-calc(var(--handle-width)/2);left:0;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2;opacity:0;transition:transform 50ms linear}.view-slider__handle[_ngcontent-%COMP%]:hover:after{transform:scale(1.3)}.view-slider__handle[_ngcontent-%COMP%]:after{opacity:1;content:"";width:var(--handle-bulb-size);height:var(--handle-bulb-size);border-radius:50%;background:var(--handle-color);transition:opacity .25s,transform ease-out .15s}.view-slider__handle-touch[_ngcontent-%COMP%]:after{opacity:1}'],changeDetection:0}),t})();var tl,nl,il,ad=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ld=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class Lr{constructor(t,o,i,s){this.store=t,this.animationService=o,this.engineService=i,this.changeDetetorRef=s,this.ngUnsubscribe=new Q.B,this.duration=0,this.wasPlaying=!0,this.percent=0,this.accessibleLabel=$localize`media slider`}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePercentChanged(t){this.percent=t,this.scrubToPercent(t)}initChapterListener(){this.chapterReadyState$.pipe((0,S.p)(t=>!(0,m.isNil)(t)&&t.animation),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(this.animationService.getTime())})}initTimelineListener(){this.engineService.getEvent(gt.X.TimelinePlaying).pipe((0,wo.Z)(20),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.tick(t.time)}),this.engineService.getEvent(gt.X.TimelineScrubbed).pipe((0,wo.Z)(20),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.percent=this.getPercent(t.time)})}handleDragStart(){this.wasPlaying=this.store.selectSnapshot(Xe.S.getAnimationPlaying),this.animationService.pause()}handleTrackClick(t){const o=this.store.selectSnapshot(Xe.S.getAnimationPlaying);o&&this.animationService.pause(),this.percent=t,this.scrubToPercent(t),setTimeout(()=>{o&&this.animationService.unpause()})}handleDragEnd(){this.wasPlaying&&this.animationService.play()}tick(t){this.percent=this.getPercent(t),this.changeDetetorRef.markForCheck()}getPercent(t){return this.timerange?.lastTime>0?t/this.timerange.lastTime*100:0}scrubToPercent(t){this.timerange?.lastTime>0&&this.animationService.scrub(t/100*this.timerange.lastTime)}}(tl=Lr).\u0275fac=function(t){return new(t||tl)(e.rXU(l.il),e.rXU(zi.O),e.rXU(u.y),e.rXU(e.gRc))},tl.\u0275cmp=e.VBU({type:tl,selectors:[["app-view-scrubber"]],decls:1,vars:2,consts:[["data-test","viewMediaScrubber",3,"dragStarted","dragEnded","trackClicked","percentChanged","percent","accessibleLabel"]],template:function(t,o){1&t&&(e.j41(0,"app-view-slider",0),e.bIt("dragStarted",function(){return o.handleDragStart()})("dragEnded",function(){return o.handleDragEnd()})("trackClicked",function(s){return o.handleTrackClick(s)})("percentChanged",function(s){return o.handlePercentChanged(s)}),e.k0s()),2&t&&e.Y8G("percent",o.percent)("accessibleLabel",o.accessibleLabel)},dependencies:[TS],encapsulation:2}),ad([(0,l.l6)(fe.N.getSelectedChapterId),ld("design:type",y.c)],Lr.prototype,"selectedChapterId$",void 0),ad([(0,l.l6)(Xe.S.getAnimationPlaying),ld("design:type",y.c)],Lr.prototype,"animationPlaying$",void 0),ad([(0,l.l6)(fe.N.getSelectedChapterReadyState),ld("design:type",y.c)],Lr.prototype,"chapterReadyState$",void 0),ad([(0,l.l6)(_e.getCanTouch),ld("design:type",y.c)],Lr.prototype,"canTouch$",void 0);class bu{constructor(t){this.store=t}setPlaybackSpeed(t){this.store.dispatch(new st.Vs(t))}}(nl=bu).\u0275fac=function(t){return new(t||nl)(e.rXU(l.il))},nl.\u0275cmp=e.VBU({type:nl,selectors:[["app-view-playback-speed"]],decls:18,vars:4,consts:()=>{let n,t,o;return n=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,t=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,o=$localize`:077e90416bdae39a40441d0b94c5a9e8fcad45143080483882937310852:Normal`,[["playbackMenu","matMenu"],t,o,["app-view-button","","buttonSize","small","data-test","viewPlaybackSpeed","matTooltip",n,"matTooltipPosition","above",3,"matMenuTriggerFor"],[1,"px-2"],[1,"sr-only"],[1,"text-xs"],["icon","angle-up","size","xs",1,"ml-2"],["mat-menu-item","",3,"click"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"button",3)(1,"div",4)(2,"span",5),e.pXf(3,1),e.k0s(),e.j41(4,"span",6),e.EFF(5),e.nI1(6,"async"),e.k0s(),e.nrm(7,"app-icon",7),e.k0s()(),e.j41(8,"mat-menu",null,0)(10,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(o.setPlaybackSpeed(1))}),e.pXf(11,2),e.k0s(),e.j41(12,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(o.setPlaybackSpeed(.5))}),e.EFF(13,"0.5"),e.k0s(),e.j41(14,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(o.setPlaybackSpeed(.25))}),e.EFF(15,"0.25"),e.k0s(),e.j41(16,"button",8),e.bIt("click",function(){return e.eBV(i),e.Njj(o.setPlaybackSpeed(.1))}),e.EFF(17,"0.1"),e.k0s()()}if(2&t){const i=e.sdS(9);e.Y8G("matMenuTriggerFor",i),e.R7$(5),e.SpI("",e.bMT(6,2,o.playbackSpeed$),"x ")}},dependencies:[rn,ei.kk,ei.fb,ei.Cp,On.oV,yt.R,q.Jj],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Xe.S.getPlaybackSpeed),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],bu.prototype,"playbackSpeed$",void 0);class cd{constructor(t){this.store=t}handlePlayClick(){const t=this.store.selectSnapshot(Xe.S.getAnimationPlaying);this.store.dispatch(new st.dE(!t))}getAnimationPlayingTooltip(t){return t?$localize`Pause Animation`:$localize`Play Animation`}}(il=cd).\u0275fac=function(t){return new(t||il)(e.rXU(l.il))},il.\u0275cmp=e.VBU({type:il,selectors:[["app-view-play"]],decls:7,vars:9,consts:[["app-view-button","","buttonSize","small","data-test","viewMediaPlay","matTooltipPosition","above",3,"click","matTooltip"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"]],template:function(t,o){1&t&&(e.j41(0,"button",0),e.nI1(1,"async"),e.bIt("click",function(){return o.handlePlayClick()}),e.j41(2,"span",1),e.EFF(3),e.nI1(4,"async"),e.k0s(),e.nrm(5,"app-icon",2),e.nI1(6,"async"),e.k0s()),2&t&&(e.Y8G("matTooltip",o.getAnimationPlayingTooltip(e.bMT(1,3,o.animationPlaying$))),e.R7$(3),e.JRh(o.getAnimationPlayingTooltip(e.bMT(4,5,o.animationPlaying$))),e.R7$(2),e.Y8G("icon",e.bMT(6,7,o.animationPlaying$)?"pause":"play"))},dependencies:[rn,On.oV,yt.R,q.Jj],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Xe.S.getAnimationPlaying),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],cd.prototype,"animationPlaying$",void 0);var ol,Ur=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},jr=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const gI=["mediaPlayButton"];function hI(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handlePlayChapterFromStartClick())}),e.j41(1,"span",7),e.pXf(2,0),e.k0s(),e.nrm(3,"app-icon",8),e.k0s()}}function mI(n,t){1&n&&e.nrm(0,"app-view-scrubber",9)}function fI(n,t){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.timeLabel," ")}}function SI(n,t){1&n&&e.nrm(0,"app-view-playback-speed")}class ns{set autoFocus(t){t&&!this.triedToFocus&&setTimeout(()=>{this.playButton.focus()},0),this.triedToFocus=!0}constructor(t,o,i,s,r){this.animationService=t,this.engineService=o,this.viewService=i,this.store=s,this.changeDetectorRef=r,this.viewLayout=G,this.buttonSize=Ao.Default,this.showScrubber=!0,this.showSpeed=!0,this.triedToFocus=!1,this.ngUnsubscribe=new Q.B,this.timeLabel="0:00 / 0:00",this.viewUI=G}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,S.p)(t=>!(0,m.isNil)(t)&&t.animation),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(0)})}initTimelineListener(){this.engineService.getEvent(gt.X.TimelinePlaying).pipe((0,wo.Z)(500),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.tick(t.time)})}handlePlayClick(){this.viewService.toggleAnimation()}handlePlayChapterFromStartClick(){this.viewService.playChapterFromStart()}setPlaybackSpeed(t){this.store.dispatch(new st.Vs(t))}tick(t){this.timerange&&(this.timeLabel=`${this.getFormattedTime(t)} / ${this.getFormattedTime(this.timerange.lastTime)}`,this.changeDetectorRef.markForCheck())}getFormattedTime(t){return`${Math.floor(Math.floor(t)/60)}:${(0,m.padStart)((Math.floor(t)%60).toString(),2,"0")}`}}var sl;function vI(n,t){1&n&&e.nrm(0,"app-spinner",3)}function EI(n,t){if(1&n&&(e.nrm(0,"app-icon",4),e.nI1(1,"async")),2&n){const o=e.XpG();e.Y8G("icon",e.bMT(1,1,o.muted$)?"volume-slash":"volume")}}(ol=ns).\u0275fac=function(t){return new(t||ol)(e.rXU(zi.O),e.rXU(u.y),e.rXU(hn),e.rXU(l.il),e.rXU(e.gRc))},ol.\u0275cmp=e.VBU({type:ol,selectors:[["app-view-media-bar"]],viewQuery:function(t,o){if(1&t&&e.GBs(gI,5),2&t){let i;e.mGM(i=e.lsd())&&(o.playButton=i.first)}},inputs:{buttonSize:"buttonSize",showScrubber:"showScrubber",showSpeed:"showSpeed",autoFocus:"autoFocus"},decls:10,vars:12,consts:()=>{let n,t;return n=$localize`:623c2eb512dd08c852fcda4f15379224c8c971337851550536336238650:Play Chapter From Start`,t=$localize`:b3e95ffdcd71216e76228de060aaa7fd8662266c162780291567006895:Play Chapter from Start`,[t,["data-test","viewMediaBar",1,"view-media-bar"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",n,"matTooltipPosition","above",3,"click",4,"ngIf"],["class","view-media-bar__scrubber",4,"ngIf"],["class","view-media-bar__time","data-test","viewMediaTime",4,"ngIf"],[4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",n,"matTooltipPosition","above",3,"click"],[1,"sr-only"],["size","lg","icon","step-backward","aria-hidden","true"],[1,"view-media-bar__scrubber"],["data-test","viewMediaTime",1,"view-media-bar__time"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",1),e.nrm(1,"app-view-play"),e.DNE(2,hI,4,0,"button",2),e.nI1(3,"async"),e.DNE(4,mI,1,0,"app-view-scrubber",3),e.nI1(5,"async"),e.DNE(6,fI,2,1,"div",4),e.nI1(7,"async"),e.DNE(8,SI,1,0,"app-view-playback-speed",5),e.nI1(9,"async"),e.k0s()),2&t){let i,s,r,a;e.R7$(2),e.Y8G("ngIf","full"===(null==(i=e.bMT(3,4,o.mediaUI$))?null:i.template)),e.R7$(2),e.Y8G("ngIf","full"===(null==(s=e.bMT(5,6,o.mediaUI$))?null:s.template)&&o.showScrubber),e.R7$(2),e.Y8G("ngIf","full"===(null==(r=e.bMT(7,8,o.mediaUI$))?null:r.template)&&o.showScrubber),e.R7$(2),e.Y8G("ngIf","full"===(null==(a=e.bMT(9,10,o.mediaUI$))?null:a.template)&&o.showSpeed)}},dependencies:[q.bT,rn,On.oV,yt.R,Lr,bu,cd,q.Jj],styles:[".view-media-bar[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;position:relative}.view-media-bar__scrubber[_ngcontent-%COMP%]{flex:1}.view-media-bar__scrubber--disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.view-media-bar__time[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:0 12px;font-size:12px;color:#374a68;height:100%;white-space:nowrap}.view-media-bar__playback[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:600}"],changeDetection:0}),Ur([(0,l.l6)(fe.N.getSelectedChapterId),jr("design:type",y.c)],ns.prototype,"selectedChapterId$",void 0),Ur([(0,l.l6)(fe.N.getSelectedChapterReadyState),jr("design:type",y.c)],ns.prototype,"chapterReadyState$",void 0),Ur([(0,l.l6)(Xe.S.getPlaybackSpeed),jr("design:type",y.c)],ns.prototype,"playbackSpeed$",void 0),Ur([(0,l.l6)(_e.getAutoplay),jr("design:type",y.c)],ns.prototype,"autoplay$",void 0),Ur([(0,l.l6)(Be.getVisible(G.Audio)),jr("design:type",y.c)],ns.prototype,"audioVisible$",void 0),Ur([(0,l.l6)(Be.getUIEntry(G.Media)),jr("design:type",y.c)],ns.prototype,"mediaUI$",void 0);class dd{get text(){return this.store.selectSnapshot(Ni.getAudioMuted)?$localize`Unmute`:$localize`Mute`}constructor(t,o){this.store=t,this.mediaService=o,this.buttonSize="small",this.buttonShape="square",this.buttonTheme="transparent-fill"}handleClick(){const t=this.store.selectSnapshot(fe.N.getSelectedChapter),o=!this.store.selectSnapshot(Ni.getAudioMuted);if(this.store.dispatch(new _i.SetAudioMuted(o)),o)this.mediaService.muteAudio();else if(this.mediaService.getPlayingAudio()?.length)this.mediaService.unmuteAudio(t.id);else{const s=this.store.selectSnapshot(_e.getViewLanguage),r=this.store.selectSnapshot(_e.getForceAudio);this.mediaService.getChapterAudioPlayer(t,s,r).then(()=>{this.mediaService.playChapterAudio(t.id)})}}}(sl=dd).\u0275fac=function(t){return new(t||sl)(e.rXU(l.il),e.rXU(Ci))},sl.\u0275cmp=e.VBU({type:sl,selectors:[["app-view-audio-mute"]],inputs:{disabled:"disabled",buttonSize:"buttonSize",buttonShape:"buttonShape",buttonTheme:"buttonTheme"},decls:5,vars:13,consts:()=>{let n;return n=$localize`:17517742950bb7560a3ca4c8fa23122e16b561163135353579204779711:mute audio`,[["type","button","app-view-button","","aria-label",n,"matTooltipPosition","above","data-test","viewAudioMute",1,"view-audio-mute",3,"click","buttonSize","buttonShape","buttonTheme","matTooltip","disabled"],["spinnerSize","small",4,"ngIf"],["appLogicalDir","","class","view-audio-mute__icon","aria-hidden","true",3,"icon",4,"ngIf"],["spinnerSize","small"],["appLogicalDir","","aria-hidden","true",1,"view-audio-mute__icon",3,"icon"]]},template:function(t,o){1&t&&(e.j41(0,"button",0),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("click",function(){return o.handleClick()}),e.DNE(3,vI,1,0,"app-spinner",1)(4,EI,2,3,"app-icon",2),e.k0s()),2&t&&(e.Y8G("buttonSize",o.buttonSize)("buttonShape",o.buttonShape)("buttonTheme",o.buttonTheme)("matTooltip",o.text)("disabled",o.disabled),e.BMQ("aria-pressed",!1===e.bMT(1,9,o.muted$))("data-test-muted",e.bMT(2,11,o.muted$)),e.R7$(3),e.Y8G("ngIf",o.disabled),e.R7$(),e.Y8G("ngIf",!o.disabled))},dependencies:[q.bT,rn,On.oV,yt.R,Gs,$i.e,q.Jj],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ni.getAudioMuted),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],dd.prototype,"muted$",void 0);var mn=_(89079),zs=_(43881);const CI=(n,t,o)=>({"justify-between":n,"justify-start":t,"gap-2":o}),TI=()=>["outline","outline-blue-600"],OI=()=>[""];function MI(n,t){if(1&n&&e.nrm(0,"div",10),2&n){const o=e.XpG().$implicit;e.HbH(o.imageClass)}}function II(n,t){if(1&n&&(e.j41(0,"span",11),e.EFF(1),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.JRh(o.title)}}function wI(n,t){if(1&n){const o=e.RV6();e.j41(0,"li")(1,"button",7),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.handleThemeSelected(s))}),e.j41(2,"div",8),e.DNE(3,MI,1,2,"div",9)(4,II,2,1),e.k0s()()()}if(2&n){const o=t.$implicit,i=e.XpG();e.R7$(),e.Y8G("matTooltip",o.title)("lang",i.lang()),e.BMQ("aria-label",o.arialLabel)("data-test-skin",o.id),e.R7$(),e.HbH(i.selectedTheme()===o?e.lJ4(7,TI):e.lJ4(8,OI)),e.R7$(),e.vxM(3,o.imageClass?3:4)}}function PI(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",6)(1,"mat-slider",12)(2,"input",13,0),e.bIt("valueChange",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleSliderChange(s,!1,!0))})("input",function(){e.eBV(o);const s=e.sdS(3),r=e.XpG();return e.Njj(r.handleSliderChange(s.value,!0,!1))}),e.k0s()(),e.j41(4,"div",14)(5,"span"),e.pXf(6,1),e.k0s(),e.j41(7,"span"),e.EFF(8),e.k0s()()()}if(2&n){const o=e.sdS(3),i=e.XpG();e.R7$(),e.Y8G("min",0)("max",100)("showTickMarks",!1),e.R7$(),e.Y8G("value",i.opacity()),e.R7$(6),e.SpI("",o.value,"%")}}let _d=(()=>{var n;class t{constructor(i,s,r,a){this.store=i,this.sceneService=s,this.paintService=r,this.vendorAnalyticsService=a,this.skinUIConfig={"integumentary system":{title:$localize`Integumentary System`},off:{id:"off",title:$localize`Off`,arialLabel:$localize`Off`},"dark skin":{id:"dark",title:$localize`Dark Skin`,imageClass:"dark"},"medium skin":{id:"medium",title:$localize`Medium Skin`,imageClass:"medium"},"light skin":{id:"light",title:$localize`Light Skin`,imageClass:"light"},"fair skin":{id:"fair",title:$localize`Fair Skin`,imageClass:"fair"},"transparent skin":{id:"transparent",title:$localize`Transparent Skin`,imageClass:"transparent"}},this.offSkinTheme={id:"off",title:$localize`Off`,arialLabel:$localize`Turn off Skin`,objectVariants:{}},this.lang=e.hFB.required(),this.schema=e.hFB.required(),this.contentId=e.hFB.required(),this.contentType=e.hFB.required(),this.schemaTitle=(0,e.EWP)(()=>{const d=this.schema(),f=d.title.toLowerCase();return this.skinUIConfig[f]?.title??d.title}),this.compact=(0,e.hFB)(!1),this.themes=(0,e.EWP)(()=>{const d=function AI(n,t){return n.map(o=>{const i=o.title.toLowerCase(),s=t[i],r=s?.id??i.replace(/\s/g,""),a=s?.title??o.title,d=s?.arialLabel??$localize`Switch to ${a}`,f=Object.keys(o.objectVariants).some(L=>L.includes("female"))?"female":"male";let T=s?.imageClass?`view-skin__image--${f}--${s.imageClass}`:"";return{...o,id:r,title:a,arialLabel:d,imageClass:T}})}(this.schema().themes,this.skinUIConfig);return[this.offSkinTheme,...d]}),this.selectedThemeIndex=(0,e.EWP)(()=>{const d=this.themes(),f=this.nodes();return d.findIndex((T,L)=>T===this.offSkinTheme?this.allObjectIds().every(re=>!1===f[re]?.shown):Object.entries(T.objectVariants).every(([ee,re])=>f[ee]?.variant===re))}),this.selectedTheme=(0,e.EWP)(()=>this.themes()[this.selectedThemeIndex()]),this.isOffThemeSelected=(0,e.EWP)(()=>this.selectedTheme()===this.offSkinTheme),this.allObjectIds=(0,e.EWP)(()=>{const f=this.themes().reduce((T,L)=>{const ee=Object.keys(L.objectVariants);return T.push(...ee),T},[]);return Array.from(new Set(f))}),this.selectedObjectIds=(0,e.EWP)(()=>Object.keys(this.selectedTheme()?.objectVariants??{})),this.selectedSkinId=(0,e.EWP)(()=>this.selectedObjectIds().find(d=>d.includes("skin"))),this.opacity=(0,e.EWP)(()=>{const d=this.nodes(),f=this.selectedSkinId(),L=d[f]?.paint;return this.getObjectOpacity(L?.opacity)??100}),this.nodes=(0,mn.ot)(this.store.select(Mn.z.getNodes))}toggleVisibility(i){i||this.handleThemeSelected(this.offSkinTheme)}handleThemeSelected(i){if(i===this.offSkinTheme){const f=this.allObjectIds();this.store.dispatch(new Lt.yr(!1,f)),this.store.dispatch(new Lt._n({}))}else{const{objectVariants:f}=i,T=Object.keys(f);this.store.dispatch(new Lt.yr(!0,T)),this.store.dispatch(new Lt._n(f))}const s=ro.l.toTitleCase(i.id),r=this.lang(),a=this.contentId(),d=this.contentType();this.vendorAnalyticsService.track("Skin Type",{skinType:s,contentId:a,contentType:d,lang:r})}handleSliderChange(i,s,r){const a=i/100,d=this.selectedObjectIds();if(s&&d.forEach(f=>{this.setObjectOpacity(f,a)}),r){const f=d.reduce((T,L)=>{const ee=this.paintService.getColor(L);if(ee){const re=(0,ja.H)(ee);T[L]=re}return T},{});this.store.dispatch(new Lt.Jp(void 0,void 0,f))}}setObjectOpacity(i,s){this.sceneService.getLeafIds(i).forEach(a=>{const d=this.paintService.getColor(a)?.opacity||1;let f;Array.isArray(d)?(f=[...d],f[0]=s):"number"==typeof d&&(f=s),this.paintService.colorObject(a,{opacity:f})})}getObjectOpacity(i){if(Array.isArray(i)){const[s]=i;return s}if("number"==typeof i)return i}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(ji.w),e.rXU(ua.s),e.rXU(qe))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-skin-variants"]],inputs:{lang:[e.Mj6.SignalBased,"lang"],schema:[e.Mj6.SignalBased,"schema"],contentId:[e.Mj6.SignalBased,"contentId"],contentType:[e.Mj6.SignalBased,"contentType"],compact:[e.Mj6.SignalBased,"compact"]},standalone:!0,features:[e.aNF],decls:8,vars:7,consts:()=>{let o;return o=$localize`:fd09d25b9e69b686d3fc0154c0b316c7c9f45cec8036200981586016464:Opacity`,[["slider","matSliderThumb"],o,[1,"flex","flex-col","gap-1","gray-400"],[1,"uppercase","text-2xs"],[1,"flex","flex-col","gap-1","p-3","border","border-gray-200","border-solid","rounded"],[1,"flex","flex-row","item-center","text-2xs",3,"ngClass"],[1,"grow"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","transparent","matTooltipPosition","below","data-test","skinToggleButton",1,"rounded-sm","focus:rounded-sm","focus:outline","focus:outline-blue-600",3,"click","matTooltip","lang"],[1,"flex","items-center","justify-center","w-10","h-10","text-black","bg-gray-100","rounded-sm"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm",3,"class"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm"],[1,"break-words","hyphens-auto","text-2xs"],[1,"!w-full","!m-0",3,"min","max","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],[1,"flex","items-center","justify-between","uppercase","text-2xs"]]},template:function(i,s){1&i&&(e.j41(0,"div",2)(1,"div",3),e.EFF(2),e.k0s(),e.j41(3,"div",4)(4,"ul",5),e.Z7z(5,wI,5,9,"li",null,e.fX1),e.k0s(),e.DNE(7,PI,9,5,"div",6),e.k0s()()),2&i&&(e.R7$(2),e.JRh(s.schemaTitle()),e.R7$(2),e.Y8G("ngClass",e.sMw(3,CI,!s.compact(),s.compact(),s.compact())),e.R7$(),e.Dyx(s.themes()),e.R7$(2),e.vxM(7,!1===s.isOffThemeSelected()?7:-1))},dependencies:[q.MD,q.YU,zs.Ez,zs.IV,zs.OU,On.uc,On.oV,Oi.C,rn],styles:[".view-skin__image--male--fair{background-image:url(maleskin_variants_fair.png)}.view-skin__image--male--light{background-image:url(maleskin_variants_light.png)}.view-skin__image--male--medium{background-image:url(maleskin_variants_medium.png)}.view-skin__image--male--dark{background-image:url(maleskin_variants_dark.png)}.view-skin__image--male--transparent{background-image:url(maleskin_variants_transparent.png)}.view-skin__image--female--fair{background-image:url(femaleskin_variants_fair.png)}.view-skin__image--female--light{background-image:url(femaleskin_variants_light.png)}.view-skin__image--female--medium{background-image:url(femaleskin_variants_medium.png)}.view-skin__image--female--dark{background-image:url(femaleskin_variants_dark.png)}.view-skin__image--female--transparent{background-image:url(femaleskin_variants_transparent.png)}\n"],encapsulation:2}),t})();const NI=(n,t)=>t.name;function RI(n,t){if(1&n&&e.nrm(0,"app-view-skin-variants",6,0),2&n){const o=e.XpG();e.Y8G("compact",o.compact())("schema",o.skinVariantsSchema())("lang",o.lang())("contentId",o.storyId())("contentType",o.storyType())}}function DI(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",10)(1,"div",11),e.EFF(2),e.k0s(),e.j41(3,"div",12)(4,"button",13),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG(2);return e.Njj(r.toggleGroupVisibilityClick(s))}),e.j41(5,"div",14),e.nrm(6,"div",15),e.k0s()(),e.j41(7,"div",16)(8,"mat-slider",17)(9,"input",18,1),e.bIt("valueChange",function(s){const r=e.eBV(o).$implicit,a=e.XpG(2);return e.Njj(a.handleSliderChange(r,s,!1,!0))})("input",function(){const s=e.eBV(o).$implicit,r=e.sdS(10),a=e.XpG(2);return e.Njj(a.handleSliderChange(s,r.value,!0,!1))}),e.k0s()()()()()}if(2&n){const o=t.$implicit,i=e.XpG(2);e.AVh("view-visibility-layers__list-item--hidden",!o.visible),e.R7$(2),e.JRh(o.label),e.R7$(2),e.Y8G("buttonTheme","transparent-fill")("matTooltip",o.visible?i.hideLayersTooltip:i.showLayersTooltip),e.BMQ("aria-label",i.getGroupAriaLabel(o.name,o.visible)),e.R7$(2),e.Y8G("className",o.imageClassName),e.R7$(2),e.Y8G("min",0)("max",o.layers.length)("step",1)("showTickMarks",!0),e.R7$(),e.Y8G("value",o.position)}}function kI(n,t){if(1&n&&(e.j41(0,"ul",7),e.Z7z(1,DI,11,12,"li",9,NI),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Dyx(o.viewGroups())}}function LI(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",8)(1,"button",19),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleAllClick(s.viewGroups(),s.allGroupsHidden()))}),e.EFF(2),e.k0s()()}if(2&n){const o=e.XpG();e.R7$(2),e.SpI(" ",o.allGroupsHidden()?o.showAllLayersTooltip:o.hideAllLayersTooltip," ")}}let yu=(()=>{var n;class t{constructor(i,s,r,a){this.store=i,this.viewService=s,this.visibilityLayersService=r,this.elementRef=a,this.defaultSystemToImage={label:$localize`Layer`,icon:"layer"},this.systemToImage={"muscular system":{label:$localize`muscular system`,icon:"muscular-system"},"connective tissue":{label:$localize`connective tissue`,icon:"connective-tissue"},"skeletal system":{label:$localize`skeletal system`,icon:"skeletal-system"},"respiratory system":{label:$localize`respiratory system`,icon:"respiratory-system"},"endocrine system":{label:$localize`endocrine system`,icon:"endocrine-system"},"digestive system":{label:$localize`digestive system`,icon:"digestive-system"},"reproductive system":{label:$localize`reproductive system`,icon:"reproductive-system"},"urinary system":{label:$localize`urinary system`,icon:"urinary-system"},"cardiovascular system":{label:$localize`cardiovascular system`,icon:"cardiovascular-system"},"lymphatic system":{label:$localize`lymphatic system`,icon:"lymphatic-system"},"nervous system":{label:$localize`nervous system`,icon:"nervous-system"},"integumentary system":{label:$localize`integumentary system`,icon:"integumentary-system"}},this.showAllLayersTooltip=$localize`Show All Anatomy Layers`,this.hideAllLayersTooltip=$localize`Hide All Anatomy Layers`,this.showLayersTooltip=$localize`Show Layer`,this.hideLayersTooltip=$localize`Hide Layer`,this.skinLayersComponent=(0,e.ebz)(_d),this.selectedChapterLayerGroups=(0,mn.ot)(this.store.select(fe.N.getSelectedChapterLayerGroups)),this.skinVariantsSchema=(0,mn.ot)(this.store.select(rt.getVariantSchema("skin"))),this.skinLayersUI=(0,mn.ot)(this.store.select(Be.getUIEntry(G.SkinLayers))),this.visibilityLayersUI=(0,mn.ot)(this.store.select(Be.getUIEntry(G.VisibilityLayers))),this.lang=(0,mn.ot)(this.store.select(_e.getViewLanguage)),this.storyId=(0,mn.ot)(this.store.select(rt.getStoryId)),this.storyType=(0,mn.ot)(this.store.select(rt.getStoryType)),this.compact=(0,e.hFB)(!1),this.showSkinLayers=(0,e.EWP)(()=>{const d=this.skinVariantsSchema(),f=this.skinLayersUI();return!(0,m.isNil)(d)&&f.enable}),this.showVisibilityLayers=(0,e.EWP)(()=>{const d=this.viewGroups(),f=this.visibilityLayersUI();return d.length>0&&f.enable}),this.viewGroups=(0,e.EWP)(()=>{const d=this.selectedChapterLayerGroups();return this.createViewLayerGroups(d)}),this.allGroupsHidden=(0,e.EWP)(()=>this.viewGroups().every(f=>!f.visible))}handleKeyPress(){this.viewService.elementHasFocus(this.elementRef.nativeElement)&&!this.viewService.isMaterialMenuOut()&&this.viewService.toggleLayers(!1)}handleSliderChange(i,s,r,a){this.setLayerGroupVisibility([{...i,position:s}],r,a)}toggleGroupVisibilityClick(i){const s=this.visibilityLayersService.computeGroupPositionsByFraction([i],i.visible?0:1);this.setLayerGroupVisibility(s,!0,!0)}handleToggleAllClick(i,s){this.toggleLayers(i,s)}getGroupAriaLabel(i,s){return s?$localize`Hide ${i} Layer`:$localize`Show ${i} Layer`}toggleLayers(i,s){const r=this.visibilityLayersService.computeGroupPositionsByFraction(i,s?1:0);this.setLayerGroupVisibility(r,!0,!0),this.skinLayersComponent()?.toggleVisibility(s)}setLayerGroupVisibility(i,s,r){const a=this.store.selectSnapshot(fe.N.getSelectedChapterId);s&&this.visibilityLayersService.syncLayerGroupsToScene(i),r&&this.visibilityLayersService.syncLayerGroupsToState(a,i,!0)}createViewLayerGroups(i){return i.map((s,r)=>{const{name:a}=s,d=r+1,f=0!==s.position,T=a.toLowerCase(),L=this.systemToImage[T]??this.defaultSystemToImage,ee=L===this.defaultSystemToImage?`${L.label} ${d}`:L.label,ve="view-visibility-layers__image",Ee=[ve,`${ve}--${L.icon}`].join(" ");return{...s,visible:f,label:ee,imageClassName:Ee}})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(hn),e.rXU(Ls),e.rXU(e.aKT))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-visibility-layers"]],viewQuery:function(i,s){1&i&&e.wEZ(s.skinLayersComponent,_d,5),2&i&&e.NyB()},hostBindings:function(i,s){1&i&&e.bIt("keydown.escape",function(){return s.handleKeyPress()},!1,e.EBC)},inputs:{compact:[e.Mj6.SignalBased,"compact"]},standalone:!0,features:[e.aNF],decls:7,vars:6,consts:()=>{let o;return o=$localize`:3acd4e3a84c66d140da3c19c36a4d0d7ce688e6a6086371624662249440: Changing the value of the sliders will modify visibility of different layers of the model `,[["skinLayers",""],["slider","matSliderThumb"],o,["role","dialog","cdkTrapFocus","",1,"view-visibility-layers",3,"cdkTrapFocusAutoCapture"],[1,"sr-only"],[1,"flex","flex-col","flex-auto","gap-4","view-visibility-layers__list-wraper"],[3,"compact","schema","lang","contentId","contentType"],[1,"view-visibility-layers__list"],[1,"view-visibility-layers__toggle"],[1,"view-visibility-layers__list-item",3,"view-visibility-layers__list-item--hidden"],[1,"view-visibility-layers__list-item"],[1,"mb-1","uppercase","text-2xs"],[1,"view-visibility-layers__slider"],["type","button","app-view-button","","buttonSize","small","buttonShape","square","data-test","viewToolsButton",1,"view-visibility-layers__slider-button",3,"click","buttonTheme","matTooltip"],[1,"relative","flex","items-center","justify-center"],["role","img",3,"className"],[1,"pl-1","pr-6","grow"],[2,"width","100% !important",3,"min","max","step","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],["app-view-button","","buttonTheme","light-gray-outline","buttonShape","rounded","buttonSize","small","cdkFocusInitial","",1,"w-full",3,"click"]]},template:function(i,s){1&i&&(e.j41(0,"div",3)(1,"span",4),e.pXf(2,2),e.k0s(),e.j41(3,"div",5),e.DNE(4,RI,2,5,"app-view-skin-variants",6)(5,kI,3,0,"ul",7),e.k0s(),e.DNE(6,LI,3,1,"div",8),e.k0s()),2&i&&(e.AVh("view-visibility-layers--overflow",!s.compact()),e.Y8G("cdkTrapFocusAutoCapture",!s.compact()),e.R7$(4),e.vxM(4,s.showSkinLayers()?4:-1),e.R7$(),e.vxM(5,s.showVisibilityLayers()?5:-1),e.R7$(),e.vxM(6,s.showVisibilityLayers()?6:-1))},dependencies:[Qi.kB,On.uc,On.oV,zs.Ez,zs.IV,zs.OU,Oi.C,rn,_d],styles:[".view-visibility-layers{display:flex;flex-direction:column;position:relative;max-height:100%}.view-visibility-layers__toggle{padding:20px 0}.view-visibility-layers__list{display:flex;flex-direction:column;gap:16px}.view-visibility-layers__list-item{color:#374a68}.view-visibility-layers__list-item--hidden{color:#8196b1}.view-visibility-layers__slider{display:flex;align-items:center;border:1px solid #d7e0ea;border-radius:4px}.view-visibility-layers__slider-button{border-right:1px solid #d7e0ea!important}.view-visibility-layers__image{display:inline-block;width:20px;height:20px;background-repeat:no-repeat;background-position:center center;background-size:contain}.view-visibility-layers__image--muscular-system{background-image:url(muscular-system.svg)}.view-visibility-layers__image--connective-tissue{background-image:url(connective-tissue.svg)}.view-visibility-layers__image--skeletal-system{background-image:url(skeletal-system.svg)}.view-visibility-layers__image--respiratory-system{background-image:url(respiratory-system.svg)}.view-visibility-layers__image--endocrine-system{background-image:url(endocrine-system.svg)}.view-visibility-layers__image--digestive-system{background-image:url(digestive-system.svg)}.view-visibility-layers__image--reproductive-system{background-image:url(reproductive-system.svg)}.view-visibility-layers__image--urinary-system{background-image:url(urinary-system.svg)}.view-visibility-layers__image--cardiovascular-system{background-image:url(cardiovascular-system.svg)}.view-visibility-layers__image--lymphatic-system{background-image:url(lymphatic-system.svg)}.view-visibility-layers__image--nervous-system{background-image:url(nervous-system.svg)}.view-visibility-layers__image--integumentary-system{background-image:url(integumentary-system.svg)}.view-visibility-layers__image--layer{background-image:url(layer.svg)}.view-visibility-layers--overflow .view-visibility-layers__toggle{background-color:#fff;position:sticky!important;bottom:0}@media (hover: none){.view-visibility-layers input[type=range]{pointer-events:none!important}.view-visibility-layers input[type=range]::-webkit-slider-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-moz-range-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-ms-thumb{pointer-events:all!important}}\n"],encapsulation:2,changeDetection:0}),t})(),OS=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-button-loader"]],decls:5,vars:0,consts:()=>{let o,i,s;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["type","button","aria-label",o,"type","button",1,"button-loader"],[1,"button-loader__button"],["src","assets/images/widget/loading_experience/interact-in-3d-arrow.svg","alt",i,1,"button-loader__3d-arrow"],[1,"button-loader__label"]]},template:function(i,s){1&i&&(e.j41(0,"button",1)(1,"div",2),e.nrm(2,"img",3),e.j41(3,"div",4),e.pXf(4,0),e.k0s()()())},styles:[".button-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.button-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@media print{.button-loader[_ngcontent-%COMP%]{display:none}}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__button[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__button[_ngcontent-%COMP%]{background-color:#2d72dc;transform:scale(1.1)}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__3d-arrow[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__3d-arrow[_ngcontent-%COMP%]{transform:scale(1.2)}.button-loader__button[_ngcontent-%COMP%]{display:flex;padding:12px 28px;border-radius:32px;align-items:center;transition:transform .25s,background-color .25s;background-color:#101823cc}.button-loader__3d-arrow[_ngcontent-%COMP%]{transition:transform .25s;margin-inline-end:4px}.button-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;margin-inline-start:4px}"],changeDetection:0}),t})(),MS=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-hand-loader"]],decls:6,vars:0,consts:()=>{let o,i,s;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["type","button","aria-label",o,1,"hand-loader"],[1,"hand-loader__container"],[1,"hand-loader__circle"],["src","assets/images/widget/loading_experience/interact-in-3d-hand.svg","alt",i,1,"hand-loader__3d-hand"],[1,"hand-loader__label"]]},template:function(i,s){1&i&&(e.j41(0,"button",1)(1,"div",2),e.nrm(2,"div",3)(3,"img",4),e.j41(4,"div",5),e.pXf(5,0),e.k0s()()())},styles:[".hand-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.hand-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@keyframes _ngcontent-%COMP%_handKeyframes{0%{transform:scale(1.2)}25%{transform:scale(1)}40%{transform:scale(1)}60%{transform:scale(1.2)}to{transform:scale(1.2)}}@keyframes _ngcontent-%COMP%_circleKeyframes{0%{transform:scale(0)}20%{transform:scale(0);opacity:1}to{transform:scale(1);opacity:0}}.hand-loader[_ngcontent-%COMP%]:focus   .hand-loader__3d-hand[_ngcontent-%COMP%], .hand-loader[_ngcontent-%COMP%]:hover   .hand-loader__3d-hand[_ngcontent-%COMP%]{filter:drop-shadow(0 0 8px #2d72dc)}.hand-loader__container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.hand-loader__circle[_ngcontent-%COMP%]{background-color:#fff;position:absolute;left:50%;margin-left:-40.5px;margin-top:-1.5px;width:70px;height:70px;border-radius:50%;animation:_ngcontent-%COMP%_circleKeyframes 2s infinite}.hand-loader__3d-hand[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_handKeyframes 2s ease-in-out infinite;position:absolute;height:96px;width:86px;left:50%;margin-left:-43px;margin-top:27px;transition:filter .3s ease-out}.hand-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600;color:#fff;text-shadow:0px 1px 5px black;bottom:40px;position:absolute;text-align:center;width:100%}"],changeDetection:0}),t})();const UI=["circle"],jI=["progressCircle"],VI=["progressContainer"];let IS=(()=>{var n;class t{get percent(){return this._percent}set percent(i){null!=i&&(this._percent=i,this.setProgress(this.percent))}constructor(i){this.renderer=i,this.ngUnsubscribe=new Q.B,this._percent=0}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions()}initSizeObserver(){(0,yn.R)(window,"resize").pipe((0,Fn.B)(10),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(i=100){const s=this.getCircumference();return s-i/100*s}setProgress(i=0){i>=100&&(i=100);const s=this.getCircumference(),r=this.getOffset(i);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}updateDimensions(){const i=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*i),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*i),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(i-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${i}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${i}`);const s=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`),setTimeout(()=>{this.renderer.setStyle(this.progressCircleRef.nativeElement,"transition","stroke-dashoffset 300ms")})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-play-loader"]],viewQuery:function(i,s){if(1&i&&(e.GBs(UI,7),e.GBs(jI,7),e.GBs(VI,7)),2&i){let r;e.mGM(r=e.lsd())&&(s.circleRef=r.first),e.mGM(r=e.lsd())&&(s.progressCircleRef=r.first),e.mGM(r=e.lsd())&&(s.progressContainerRef=r.first)}},inputs:{percent:"percent"},decls:10,vars:0,consts:()=>{let o,i;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:4b03875d535c300d85a81c17105d24d85adadbae9093351263643113653:3D`,[["circle",""],["progressContainer",""],["progressCircle",""],i,["type","button","aria-label",o,1,"play-loader"],[1,"play-loader__circle"],[1,"play-loader__ring"],[1,"play-loader__ring-inner"],["icon","play",1,"play-loader__icon"],[1,"play-loader__label"]]},template:function(i,s){1&i&&(e.j41(0,"button",4)(1,"div",5,0),e.qSk(),e.j41(3,"svg",6,1),e.nrm(5,"circle",7,2),e.k0s(),e.joV(),e.nrm(7,"app-icon",8),e.j41(8,"div",9),e.pXf(9,3),e.k0s()()())},dependencies:[yt.R],styles:[".play-loader[_ngcontent-%COMP%]{--buttonSize: 35vw;border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.play-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__circle[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__circle[_ngcontent-%COMP%]{background:#fffc;transform:scale(1.1)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__icon[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__icon[_ngcontent-%COMP%]{color:#2d72dc;transform:scale(1.2)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__label[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__label[_ngcontent-%COMP%]{color:#fff}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__ring[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__ring[_ngcontent-%COMP%]{stroke:#2d72dc}.play-loader__circle[_ngcontent-%COMP%]{width:var(--buttonSize);height:var(--buttonSize);border-radius:50%;background-color:#101823cc;display:flex;align-items:center;justify-content:center;position:relative;transition:background-color .25s,color .25s,transform .25s}.play-loader__icon[_ngcontent-%COMP%]{font-size:calc(var(--buttonSize) / 2);color:#ffffffe6;transition:color .25s,transform .25s;margin-right:-10%}.play-loader__label[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:2;font-weight:600}.play-loader__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;stroke-width:4;stroke:#fff;fill:transparent;transform:rotate(-90deg)}@media (min-width: 600px){.play-loader__circle[_ngcontent-%COMP%]{width:160px;height:160px}.play-loader__icon[_ngcontent-%COMP%]{font-size:80px}}"],changeDetection:0}),t})();class vu{constructor(t,o,i){this.overlay=t,this.content=o,this.data=i,this.afterClosed=new Q.B,this.afterClosed$=this.afterClosed.asObservable(),t.backdropClick().subscribe(()=>this._close("backdropClick",i)),this.entered$=(0,Wi.h)((0,yn.R)(t.overlayElement,"mouseenter"),(0,yn.R)(t.overlayElement,"mouseleave")).pipe((0,le.T)(s=>"mouseenter"===s.type),(0,b.Q)(this.afterClosed$))}close(t){this._close("close",t)}_close(t,o){this.overlay.dispose(),this.afterClosed.next({type:t,data:o}),this.afterClosed.complete()}}var pd=_(76939);function xI(n,t){if(1&n&&e.nrm(0,"div",4),2&n){const o=e.XpG();e.Y8G("innerHTML",o.content,e.npT)}}function FI(n,t){1&n&&e.eu8(0)}function GI(n,t){if(1&n&&(e.qex(0),e.DNE(1,FI,1,0,"ng-container",5),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngTemplateOutlet",o.content)("ngTemplateOutletContext",o.context)}}function $I(n,t){1&n&&e.eu8(0)}function BI(n,t){if(1&n&&(e.qex(0),e.DNE(1,$I,1,0,"ng-container",6),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngComponentOutlet",o.content)}}let zI=(()=>{var n;class t{constructor(i){this.popupRef=i,this.renderMethod="component"}ngOnInit(){this.content=this.popupRef.content,"string"==typeof this.content?this.renderMethod="text":this.content instanceof e.C4Q&&(this.renderMethod="template",this.context={close:this.popupRef.close.bind(this.popupRef)})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(vu))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-popup"]],decls:5,vars:4,consts:[[1,"popup"],[3,"ngSwitch"],[3,"innerHTML",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"innerHTML"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.qex(1,1),e.DNE(2,xI,1,1,"div",2)(3,GI,2,2,"ng-container",3)(4,BI,2,1,"ng-container",3),e.bVm(),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngSwitch",s.renderMethod),e.R7$(),e.Y8G("ngSwitchCase","text"),e.R7$(),e.Y8G("ngSwitchCase","template"),e.R7$(),e.Y8G("ngSwitchCase","component"))},dependencies:[q.OI,q.T3,q.ux,q.e1],styles:["[_nghost-%COMP%]{width:100%;height:100%}.popup[_ngcontent-%COMP%]{background:#fff;border-radius:4px;padding:24px;overflow-y:auto;width:100%;height:100%;overflow-y:scroll;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}"],changeDetection:0}),t})();var ho=function(n){return n.Above="above",n.Below="below",n.Left="left",n.Right="right",n}(ho||{});const WI={[ho.Above]:{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-12},[ho.Below]:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:12},[ho.Left]:{originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-12},[ho.Right]:{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:12}};let wS=(()=>{var n;class t{constructor(i,s){this.overlay=i,this.injector=s}open(i){const{origin:s,content:r,data:a,width:d,height:f,maxHeight:T,maxWidth:L,hasBackdrop:ee,positions:re}=i,ve=this.overlay.create(this.getOverlayConfig({origin:s,width:d,height:f,maxHeight:T,maxWidth:L,hasBackdrop:ee,positions:re})),Oe=new vu(ve,r,a),Ee=this.createInjector(Oe,this.injector);return ve.attach(new pd.A8(zI,null,Ee)),Oe}createInjector(i,s){const r=new WeakMap([[vu,i]]);return new pd.JP(s,r)}getPositionStrategy(i,s){return this.overlay.position().flexibleConnectedTo(i).withPositions(this.getPositions(s))}getOverlayConfig({origin:i,width:s,height:r,maxHeight:a,maxWidth:d,hasBackdrop:f,positions:T}){return new Ra.rR({width:s,height:r,maxHeight:a,maxWidth:d,hasBackdrop:f??!0,backdropClass:"popup-scrim",positionStrategy:this.getOverlayPosition(i,T),scrollStrategy:this.overlay.scrollStrategies.reposition()})}getOverlayPosition(i,s){return s=s||[ho.Above,ho.Below,ho.Left,ho.Right],this.overlay.position().flexibleConnectedTo(i).withPositions(this.getPositions(s)).withPush(!0)}getPositions(i){return i.map(s=>WI[s])}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(Ra.hJ),e.KVO(e.zZn))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();const XI=(n,t,o,i)=>({"badge--blue":n,"badge--green":t,"badge--inline":o,"badge--block":i});function HI(n,t){if(1&n&&(e.j41(0,"div",1),e.nrm(1,"app-icon",3),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("icon",o.icon())}}function QI(n,t){if(1&n&&(e.j41(0,"div",2),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.JRh(o.label())}}let YI=(()=>{var n;class t{constructor(){this.display=(0,e.hFB)("inline"),this.theme=(0,e.hFB)("none"),this.icon=(0,e.hFB)(""),this.label=(0,e.hFB)("")}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-badge"]],inputs:{display:[e.Mj6.SignalBased,"display"],theme:[e.Mj6.SignalBased,"theme"],icon:[e.Mj6.SignalBased,"icon"],label:[e.Mj6.SignalBased,"label"]},standalone:!0,features:[e.aNF],decls:3,vars:8,consts:[[1,"badge","flex","items-center",3,"ngClass"],[1,"badge__check"],[1,"badge__label"],[3,"icon"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,HI,2,1,"div",1)(2,QI,2,1,"div",2),e.k0s()),2&i&&(e.Y8G("ngClass",e.ziG(3,XI,"blue"===s.theme(),"green"===s.theme(),"inline"===s.display(),"block"===s.display())),e.R7$(),e.vxM(1,s.icon()?1:-1),e.R7$(),e.vxM(2,s.label()?2:-1))},dependencies:[q.MD,q.YU,yi.o,yt.R],styles:[".badge{gap:8px;padding:4px 8px 4px 4px;border-radius:12px}.badge__check{display:flex;align-items:center;justify-content:center;border-radius:100%;width:14px;height:14px;font-size:.625rem;line-height:.75rem}.badge__label{font-size:.75rem;line-height:1rem;font-weight:500}.badge--inline{display:inline-flex}.badge--block{display:flex}.badge--blue{background-color:#a6dfff66;color:#1c5ab9}.badge--blue .badge__check{background-color:#2d72dc;color:#fff}.badge--green{background-color:#c1efdf66;color:#095922}.badge--green .badge__check{background-color:#138032;color:#fff}\n"],encapsulation:2,changeDetection:0}),t})();function KI(n,t){if(1&n&&(e.j41(0,"li",4)(1,"div",5),e.EFF(2),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-html",7),e.k0s()()),2&n){const o=t.$implicit,i=t.$index;e.R7$(2),e.SpI("",i+1,"."),e.R7$(2),e.Y8G("markdownText",o.label)}}let JI=(()=>{var n;class t{constructor(){this.references=e.hFB.required()}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-references"]],inputs:{references:[e.Mj6.SignalBased,"references"]},standalone:!0,features:[e.aNF],decls:6,vars:0,consts:()=>{let o;return o=$localize`:0dc2e6fb6d0244d5024e73ede409a45d5b0c8a64449712922219700420:References`,[o,[1,"flex","flex-row","items-center","pb-3","font-bold"],["data-test","view-references",1,"view-references"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-row","gap-1","text-xs"],[1,"text-xs","text-right",2,"flex","0 0 20px"],[1,"flex-auto","w-full"],[1,"!text-gray-900",3,"markdownText"]]},template:function(i,s){1&i&&(e.j41(0,"div",1),e.pXf(1,0),e.k0s(),e.j41(2,"div",2)(3,"ol",3),e.Z7z(4,KI,5,2,"li",4,e.fX1),e.k0s()()),2&i&&(e.R7$(4),e.Dyx(s.references()))},dependencies:[Zo],styles:[".view-references{color:#374a68}\n"],encapsulation:2,changeDetection:0}),t})();const qI=n=>({"p-4 rounded shadow":n}),ZI=(n,t)=>({hidden:n,"pt-6":t}),ew=n=>({"rotate-90":n});function tw(n,t){if(1&n&&(e.j41(0,"span"),e.pXf(1,0),e.k0s()),2&n){const o=e.XpG(3);e.R7$(),e.uP7(o.updateDateText()),e.nnv(1)}}function nw(n,t){1&n&&(e.j41(0,"span"),e.pXf(1,1),e.k0s())}function iw(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.open.set(!s.open()))}),e.j41(1,"div",13)(2,"span",14),e.DNE(3,tw,2,1,"span")(4,nw,2,0),e.k0s(),e.nrm(5,"app-icon",15),e.k0s()()}if(2&n){let o;const i=e.XpG(2);e.R7$(3),e.vxM(3,null!=(o=i.sourceInfo().reviewed)&&o.enabled&&null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDate()?3:4),e.R7$(2),e.Y8G("ngClass",e.eq3(2,ew,i.open()))}}function ow(n,t){1&n&&e.nrm(0,"app-badge",17)}function sw(n,t){if(1&n&&(e.j41(0,"div")(1,"span",20),e.pXf(2,2),e.k0s(),e.j41(3,"time"),e.EFF(4),e.k0s()()),2&n){const o=e.XpG(3);e.R7$(3),e.BMQ("datetime",o.updateDateTime()),e.R7$(),e.JRh(o.updateDateText())}}function rw(n,t){if(1&n&&(e.j41(0,"a",19)(1,"span"),e.pXf(2,3),e.k0s(),e.nrm(3,"app-icon",21),e.k0s()),2&n){const o=e.XpG(3);e.BMQ("href",o.sourceInfo().reviewed.url,e.B4B)}}function aw(n,t){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,4),e.k0s(),e.EFF(3),e.k0s()),2&n){const o=e.XpG(4);e.R7$(3),e.SpI(" ",o.sourceInfo().collaborated.authors," ")}}function lw(n,t){if(1&n&&(e.j41(0,"div",16),e.nrm(1,"app-badge",22),e.DNE(2,aw,4,1,"div"),e.k0s()),2&n){const o=e.XpG(3);e.R7$(2),e.vxM(2,o.sourceInfo().collaborated.authors?2:-1)}}function cw(n,t){if(1&n&&(e.j41(0,"div",10)(1,"div",16),e.DNE(2,ow,1,0,"app-badge",17),e.j41(3,"div",18),e.DNE(4,sw,5,2,"div")(5,rw,4,1,"a",19),e.k0s()(),e.DNE(6,lw,3,1,"div",16),e.k0s()),2&n){let o,i,s,r;const a=e.XpG(2);e.R7$(2),e.vxM(2,null!=(o=a.sourceInfo().reviewed)&&o.enabled?2:-1),e.R7$(2),e.vxM(4,null!=(i=a.sourceInfo().audit)&&i.enabled&&a.updateDate()?4:-1),e.R7$(),e.vxM(5,null!=(s=a.sourceInfo().reviewed)&&s.url?5:-1),e.R7$(),e.vxM(6,null!=(r=a.sourceInfo().collaborated)&&r.enabled?6:-1)}}function dw(n,t){if(1&n&&(e.j41(0,"div",11),e.nrm(1,"app-view-references",23),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("references",o.references())}}function _w(n,t){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,5),e.k0s(),e.EFF(3),e.k0s()),2&n){const o=e.XpG(3);e.R7$(3),e.SpI(" ",o.updateDateText(),"")}}function pw(n,t){if(1&n&&(e.j41(0,"div",10),e.nrm(1,"app-view-references",23),e.DNE(2,_w,4,1,"div"),e.k0s()),2&n){let o;const i=e.XpG(2);e.R7$(),e.Y8G("references",i.references()),e.R7$(),e.vxM(2,null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDateText()?2:-1)}}function uw(n,t){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,6),e.k0s(),e.EFF(3),e.k0s()),2&n){const o=e.XpG(2);e.R7$(3),e.SpI(" ",o.updateDateText(),"")}}function gw(n,t){if(1&n&&(e.j41(0,"div",7),e.DNE(1,iw,6,4,"button",8),e.j41(2,"div",9),e.DNE(3,cw,7,4,"div",10)(4,dw,2,1,"div",11)(5,pw,3,2,"div",10)(6,uw,4,1,"div"),e.k0s()()),2&n){let o;const i=e.XpG();e.Y8G("ngClass",e.eq3(7,qI,i.toggleable()&&i.open())),e.R7$(),e.vxM(1,i.toggleable()?1:-1),e.R7$(),e.Y8G("ngClass",e.l_i(9,ZI,i.toggleable()&&!i.open(),i.toggleable()&&i.open())),e.R7$(),e.vxM(3,i.displaySources()?3:-1),e.R7$(),e.vxM(4,i.displayReferences()&&i.displaySources()?4:-1),e.R7$(),e.vxM(5,i.displayReferences()&&!i.displaySources()?5:-1),e.R7$(),e.vxM(6,!i.displayReferences()&&!i.displaySources()&&null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDateText()?6:-1)}}let ud=(()=>{var n;class t{constructor(i){this.store=i,this.sourceInfo=(0,mn.ot)(this.store.select(rt.getStorySourceInfo)),this.storyType=(0,mn.ot)(this.store.select(rt.getStoryType)),this.selectedBookmark=(0,mn.ot)(this.store.select(_t.getSelectedBookmark)),this.toggleable=(0,e.hFB)(!1),this.open=(0,e.vPA)(!1),this.showSources=(0,e.EWP)(()=>this.storyType()===ye.c.Module),this.updateDate=(0,e.EWP)(()=>this.selectedBookmark()?.update_date_time??this.selectedBookmark()?.create_date_time),this.updateDateTime=(0,e.EWP)(()=>{const s=this.updateDate();return s?new Date(s).toISOString():void 0}),this.updateDateText=(0,e.EWP)(()=>{const s=this.updateDate();return s?new Date(s).toLocaleDateString():void 0}),this.displaySources=(0,e.EWP)(()=>{const s=this.sourceInfo();return this.showSources()&&s?.reviewed?.enabled||s?.collaborated?.enabled}),this.displayReferences=(0,e.EWP)(()=>this.references().length>0),this.references=(0,e.EWP)(()=>this.sourceInfo()?.references??[])}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-source-info"]],inputs:{toggleable:[e.Mj6.SignalBased,"toggleable"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let o,i,s,r,a,d,f,T,L;return o=$localize`:ec2c1d22b6e2207023be0f04e37c533e4e5cc7ec7104746773075604544:Medically reviewed on ${"\ufffd0\ufffd"}:INTERPOLATION:`,i=$localize`:5bbf2bcdb5d3aa2b328ab66786845485b997e0e75233133710285034701:Source Information`,s=$localize`:8130925c3a61817eae8b407d5bbcdaaba8758d15429607993299883476:Medically Reviewed`,r=$localize`:c0036f237054be68e8a0cc165f3b71b2f874cbf163496578423295101:Updated on `,a=$localize`:9a747d50c4db80b1cb473adfd9e5a9c9e034b7d55574571308850658695:Read about our review process.`,d=$localize`:d5b8a08bdd48b443f541a8477c756faa70d686d5214207563889300286:Built in Collaboration`,f=$localize`:525d654f08c7e65835ec2836814a49aa1ba604f34382887906654551268:Created with`,T=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,L=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,[o,i,r,a,f,T,L,[1,"transition-all",3,"ngClass"],["app-view-button","","buttonSize","2xsmall",1,"w-full"],[1,"flex","flex-col","gap-6","[&_a]:break-all","text-xs",3,"ngClass"],[1,"flex","flex-col","gap-6"],["id","view-source-info-references"],["app-view-button","","buttonSize","2xsmall",1,"w-full",3,"click"],[1,"flex","items-center"],[1,"text-xs"],["icon","angle-right",1,"ml-1","transition-transform",3,"ngClass"],[1,"flex","flex-col","gap-2"],["theme","blue","icon","check","label",s],[1,"flex","flex-col","gap-1"],["target","_blank","rel","noreferrer nofollow",1,"hover:underline"],[1,"font-bold"],["icon","arrow-up-right-from-square",1,"ml-1"],["theme","green","icon","check","label",d],[3,"references"]]},template:function(i,s){1&i&&e.DNE(0,gw,7,12,"div",7),2&i&&e.vxM(0,s.sourceInfo()?0:-1)},dependencies:[q.MD,q.YU,Oi.C,rn,yi.o,yt.R,YI,JI],styles:[".view-source-info{color:#131c2a}.view-source-info__toggle{color:#131c2a;font-size:.75rem;line-height:1rem}\n"],encapsulation:2,changeDetection:0}),t})();var PS=_(5951),Eu=_(78109);const hw=[[["app-list-item"]]],mw=["app-list-item"];var AS=function(n){return n.Default="default",n.Commafied="commafied",n.flat="flat",n.inline="inline",n.bulleted="bulleted",n}(AS||{});let fw=(()=>{var n;class t{constructor(){this.listType=AS.Default,this.dense=!1}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-list"]],inputs:{listType:"listType",dense:"dense"},ngContentSelectors:mw,decls:2,vars:3,consts:[[1,"list",3,"ngClass"]],template:function(i,s){1&i&&(e.NAR(hw),e.j41(0,"div",0),e.SdG(1),e.k0s()),2&i&&(e.AVh("list--dense",s.dense),e.Y8G("ngClass","list--"+s.listType))},dependencies:[q.YU],styles:['@charset "UTF-8";.list{display:flex;flex-direction:column}.list--dense{padding:0!important}.list--default app-list-item{display:list-item;margin-left:16px;list-style-type:disc}.list--commafied{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--commafied app-list-item:not(:last-child):after{content:", ";float:right;padding-right:4px}.list--bulleted{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--bulleted app-list-item:not(:last-child):after{content:" \\2022  ";float:right;padding-right:4px;padding-left:4px}.list--flat app-list-item:not(:last-child){margin-bottom:4px}.list--inline{display:inline-flex;align-items:center;display:flex;flex-direction:row;flex-wrap:wrap}.list--inline app-list-item{margin:0 8px 4px 0}.list__item{display:block}\n'],encapsulation:2,changeDetection:0}),t})();const Sw=["*"];let bw=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-list-item"]],ngContentSelectors:Sw,decls:1,vars:0,template:function(i,s){1&i&&(e.NAR(),e.SdG(0))},encapsulation:2,changeDetection:0}),t})();function yw(n,t){if(1&n&&(e.j41(0,"app-list-item")(1,"div",1),e.EFF(2),e.k0s()()),2&n){const o=t.$implicit;e.R7$(),e.BMQ("data-id",o.id),e.R7$(),e.JRh(o.label)}}let NS=(()=>{var n;class t{get objectIds(){return this._objectIds}set objectIds(i){this._objectIds=i;const s=this.store.selectSnapshot(Xe.S.getViewGraph);this.nodes=this.graphService.getNodes(s,i),this.changeRef.markForCheck()}constructor(i,s,r){this.store=i,this.graphService=s,this.changeRef=r}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(Eu.w),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-object-tree"]],inputs:{objectIds:"objectIds"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"text-sm","my-1"]],template:function(i,s){1&i&&(e.j41(0,"app-list"),e.DNE(1,yw,3,2,"app-list-item",0),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",s.nodes))},dependencies:[q.Sq,fw,bw],changeDetection:0}),t})(),RS=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer-number"]],inputs:{number:"number"},decls:3,vars:1,consts:[[1,"number","text-2xs"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div"),e.EFF(2),e.k0s()()),2&i&&(e.R7$(2),e.JRh(s.number))},styles:[".number[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:#131c2a;border:1px solid rgba(55,74,104,.5);border-radius:50%}"],changeDetection:0}),t})();var rl;function Tw(n,t){if(1&n&&(e.j41(0,"div",3)(1,"div",4),e.nrm(2,"app-view-quiz-answer-number",5),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-quiz-label-anatomy-select",7),e.k0s()()),2&n){const o=t.index,i=e.XpG();e.R7$(2),e.Y8G("number",o+1),e.R7$(2),e.Y8G("options",i.options)("formControlName",o)}}class Cu{get options(){return this._options}set options(t){(0,m.isEqual)(t,this._options)||(this._options=t,this.buildFormOptions(t))}constructor(t){this.formBuilder=t,this.valueChange=new e.bkB,this.ngUnsubscribe=new Q.B,this._options=[],this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({options:t})=>{this.valueChange.next(t)})}init(){this.activeSubmission$.pipe((0,S.p)(t=>!(0,m.isNil)(t)&&!(0,m.isNil)(t.answer)),(0,Ds.J)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{const i=function vw(n,t,o){const i=t.findIndex((r,a)=>!(0,m.isEqual)(n[a],r)),s=t[i];return t.map((r,a)=>(0,m.isEqual)(s,r)&&a!==i?o:r)}(t.answer||[],o.answer||[],"");(0,m.isEqual)(o,i)||this.form.patchValue({options:i||[]})}),this.activeSubmission$.pipe((0,S.p)(t=>!(0,m.isNil)(t)&&!(0,m.isNil)(t.answer)&&Array.isArray(t.answer)),(0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const i=t.answer;(0,m.isEqual)(this.form.value.options,i)||this.form.patchValue({options:i},{emitEvent:!1,onlySelf:!0})})}buildFormOptions(t){this.optionsArray.clear(),t.forEach(()=>{this.optionsArray.push(this.formBuilder.control(""))}),this.optionsArray.setValue(t.map(()=>""))}}(rl=Cu).\u0275fac=function(t){return new(t||rl)(e.rXU(we.ze))},rl.\u0275cmp=e.VBU({type:rl,selectors:[["app-view-quiz-label-anatomy"]],inputs:{options:"options"},outputs:{valueChange:"valueChange"},decls:3,vars:2,consts:[[1,"options",3,"formGroup"],["formArrayName","options"],["class","options__item","data-test","questionAnswer",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"options__item"],[1,"mr-2"],[3,"number"],[1,"options__item-select"],[3,"options","formControlName"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,Tw,5,3,"div",2),e.k0s()()),2&t&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.options))},dependencies:[q.Sq,we.BC,we.cb,we.j4,we.JD,we.v8,pS,RS],styles:[".options__item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-bottom:12px}.options__item-select[_ngcontent-%COMP%]{border:1px solid #96a8c0;border-radius:4px;flex:1 1 auto}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ue.j.getActiveSubmission),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Cu.prototype,"activeSubmission$",void 0);var Vr,DS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},kS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function Ow(n,t){if(1&n&&(e.j41(0,"mat-radio-button",8),e.EFF(1),e.k0s()),2&n){const o=t.$implicit;e.Y8G("value",o.value),e.R7$(),e.SpI(" ",o.label," ")}}function Mw(n,t){if(1&n){const o=e.RV6();e.j41(0,"div")(1,"mat-radio-group",6),e.bIt("change",function(s){e.eBV(o);const r=e.XpG(2);return e.Njj(r.handleMultipleChoiceChange(s))}),e.DNE(2,Ow,2,2,"mat-radio-button",7),e.k0s()()}if(2&n){const o=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",o.question.data.options)}}function Iw(n,t){if(1&n&&(e.j41(0,"div",10),e.nrm(1,"app-view-quiz-object-tree",11),e.k0s()),2&n){const o=e.XpG(3);e.R7$(),e.Y8G("objectIds",o.question.data.correctAnswer)}}function ww(n,t){if(1&n&&(e.j41(0,"div"),e.DNE(1,Iw,2,1,"div",9),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.question.data.showAnswerList)}}function Pw(n,t){if(1&n){const o=e.RV6();e.j41(0,"div")(1,"app-view-quiz-label-anatomy",12),e.bIt("valueChange",function(s){e.eBV(o);const r=e.XpG(2);return e.Njj(r.handleLabelAnatomyChanges(s))}),e.k0s()()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("options",o.question.data.options)}}function Aw(n,t){if(1&n&&(e.j41(0,"div",1)(1,"div",2),e.nrm(2,"app-content-blocks",3),e.k0s(),e.j41(3,"div",4),e.DNE(4,Mw,3,1,"div",5)(5,ww,2,1,"div",5)(6,Pw,2,1,"div",5),e.k0s()()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("contentBlocks",o.question.questionPrompt),e.R7$(),e.Y8G("ngSwitch",o.question.type),e.R7$(),e.Y8G("ngSwitchCase",o.QuestionType.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",o.QuestionType.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",o.QuestionType.LabelAnatomy)}}class hd{get question(){return this._question}set question(t){this._question=t,this.initQuestionListeners()}get value(){return this._value}set value(t){this._value=t,this.onChange(t)}constructor(t,o){this.changeRef=t,this.viewService=o,this.disabled=!1,this.QuestionType=vn.Q5,this.ngUnsubscribe=new Q.B}handleMultipleChoiceChange(t){this.writeValue(t.value)}handleLabelAnatomyChanges(t){this.writeValue(t)}initQuestionListeners(){switch(this.question.type){case vn.Q5.SelectAnatomy:this.initSelectAnatomyListeners();break;case vn.Q5.Instructions:this.initInstructions()}}initSelectAnatomyListeners(){this.checkedNodesIds$.pipe((0,xn.F)((t,o)=>(0,m.isEqual)(t,o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.writeValue(t),this.changeRef.markForCheck()})}initInstructions(){setTimeout(()=>{this.writeValue("-"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onChange(t){}onTouched(){}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}writeValue(t){this.value=t}setDisabledState(t){this.disabled=t}}(Vr=hd).\u0275fac=function(t){return new(t||Vr)(e.rXU(e.gRc),e.rXU(hn))},Vr.\u0275cmp=e.VBU({type:Vr,selectors:[["app-view-quiz-question"]],inputs:{question:"question",value:"value"},features:[e.Jv_([{provide:we.kq,useExisting:(0,e.Rfq)(()=>Vr),multi:!0}])],decls:1,vars:1,consts:[["class","view-quiz-question text-sm mb-8","data-test","question",4,"ngIf"],["data-test","question",1,"view-quiz-question","text-sm","mb-8"],["data-test","questionPrompt",1,"view-quiz-question__prompt"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"flex","flex-col",3,"change"],["data-test","questionAnswer","class","view-quiz-question__option",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"view-quiz-question__option",3,"value"],["class","ml-3",4,"ngIf"],[1,"ml-3"],[3,"objectIds"],[3,"valueChange","options"]],template:function(t,o){1&t&&e.DNE(0,Aw,7,5,"div",0),2&t&&e.Y8G("ngIf",o.question)},dependencies:[q.Sq,q.bT,q.ux,q.e1,PS.VT,PS._g,Nr,NS,Cu],styles:[".view-quiz-question__prompt{margin-bottom:8px}.view-quiz-question__option{font-size:.875rem;line-height:1.25rem;padding:12px;white-space:normal!important}.view-quiz-question__option>*{white-space:normal!important}\n"],encapsulation:2,changeDetection:0}),DS([(0,l.l6)(Mn.z.getCheckedNodeIds),kS("design:type",y.c)],hd.prototype,"checkedNodesIds$",void 0),DS([(0,l.l6)(Ue.j.getActiveSubmission),kS("design:type",y.c)],hd.prototype,"activeSubmission$",void 0);const Nw=["*"];function Rw(n,t){1&n&&e.nrm(0,"app-icon",6)}function Dw(n,t){1&n&&e.nrm(0,"app-icon",7)}function kw(n,t){1&n&&(e.j41(0,"span",8),e.nrm(1,"span",9),e.k0s())}let Tu=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer-option"]],inputs:{correct:"correct"},ngContentSelectors:Nw,decls:7,vars:7,consts:[["data-test","answerOptionContainer",1,"option"],[1,"flex","relative",3,"ngSwitch"],["class","option__icon option__icon--correct","style","font-size: 20px","icon","check-circle",4,"ngSwitchCase"],["class","option__icon option__icon--incorrect","style","font-size: 20px","icon","times-circle",4,"ngSwitchCase"],["class","option__icon",4,"ngSwitchDefault"],[1,"pl-2"],["icon","check-circle",1,"option__icon","option__icon--correct",2,"font-size","20px"],["icon","times-circle",1,"option__icon","option__icon--incorrect",2,"font-size","20px"],[1,"option__icon"],[1,"mat-radio-outer-circle"]],template:function(i,s){1&i&&(e.NAR(),e.j41(0,"div",0)(1,"div",1),e.DNE(2,Rw,1,0,"app-icon",2)(3,Dw,1,0,"app-icon",3)(4,kw,2,0,"span",4),e.j41(5,"div",5),e.SdG(6),e.k0s()()()),2&i&&(e.AVh("option--correct",!0===s.correct)("option--incorrect",!1===s.correct),e.R7$(),e.Y8G("ngSwitch",s.correct),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1))},dependencies:[q.ux,q.e1,q.fG,yt.R],styles:[".option[_ngcontent-%COMP%]{padding:12px;border-radius:4px;margin-bottom:8px;color:#131c2a}.option--correct[_ngcontent-%COMP%]{border:1px solid #83e692;background-color:#f0fff0}.option--incorrect[_ngcontent-%COMP%]{border:1px solid #f44336;background-color:#ffe2db}.option__icon[_ngcontent-%COMP%]{position:relative;flex:0 0 20px;justify-content:center}.option__icon--correct[_ngcontent-%COMP%]{color:#83e692}.option__icon--incorrect[_ngcontent-%COMP%]{color:#f44336}"],changeDetection:0}),t})();function Lw(n,t){if(1&n&&(e.j41(0,"div")(1,"app-view-quiz-answer-option",1)(2,"div"),e.EFF(3),e.k0s()()()),2&n){const o=t.$implicit,i=e.XpG();e.R7$(),e.Y8G("correct",i.isOptionAnswerCorrect(i.question,o.value,i.answer)),e.R7$(2),e.SpI(" ",o.label," ")}}let Uw=(()=>{var n;class t{constructor(){}ngOnInit(){}isOptionAnswerCorrect(i,s,r){const a=(0,eo.Br)(i,[s]);return s===r[0]||a?a:void 0}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-multiple-choice-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"correct"]],template:function(i,s){1&i&&e.DNE(0,Lw,4,2,"div",0),2&i&&e.Y8G("ngForOf",s.question.data.options)},dependencies:[q.Sq,Tu],changeDetection:0}),t})();function jw(n,t){1&n&&(e.qex(0),e.pXf(1,1),e.bVm())}function Vw(n,t){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function xw(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",11)(1,"button",12),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleSelectedObjectsClick(s.answer))}),e.pXf(2,3),e.k0s(),e.j41(3,"button",13),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleCorrectObjectsClick(s.question.data.correctAnswer))}),e.EFF(4," Highlight Correct Answer "),e.k0s()()}}let Fw=(()=>{var n;class t{get isCorrect(){return(0,eo.Br)(this.question,this.answer)}constructor(i,s,r){this.graphService=i,this.viewService=s,this.store=r}fadeNonselected(i){const s=this.store.selectSnapshot(Xe.S.getViewGraph),r=this.graphService.getInverseSelection(s,i),a=this.graphService.getNodes(s,r);this.store.dispatch(new Lt.Jp(Es.EC,a.map(d=>d.id)))}handleCorrectObjectsClick(i){this.highlightNodes(i)}handleSelectedObjectsClick(i){this.highlightNodes(i)}highlightNodes(i){const s=i.filter(r=>r&&""!==r);this.resetSelectAndFade(),this.repositionCamera(s),this.fadeNonselected(s)}repositionCamera(i){1===i.length?this.store.dispatch(new st.W6(i[0])):this.viewService.resetCamera()}resetSelectAndFade(){this.viewService.clearSelectedNodes(),this.viewService.clearFadedNodes()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Eu.w),e.rXU(hn),e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-select-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:11,vars:5,consts:()=>{let o,i,s;return o=$localize`:4274205d4ae04ab28b67840a011bbbc3c207f6083164453258197222114:Correct! You selected:`,i=$localize`:86fadbb89f45c1d0fad1eae1936d43d4e59e065a682829795532587629:Incorrect! You selected:`,s=$localize`:a5dfb5defc5b4f7d9d17e3175f3a2832a33801872737293371102556031: Highlight My Answer `,[["selectAnatomyAnswer",""],o,i,s,[3,"correct"],[1,"flex","flex-col"],[1,"font-semibold"],[4,"ngIf"],[1,"mt-2","ml-2"],[3,"objectIds"],["class","flex flex-col gap-2 mt-4",4,"ngIf"],[1,"flex","flex-col","gap-2","mt-4"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightUserAnswers",1,"w-full",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightCorrectAnswers",1,"w-full",3,"click"]]},template:function(i,s){if(1&i&&(e.j41(0,"div")(1,"app-view-quiz-answer-option",4,0)(3,"div",5)(4,"div")(5,"span",6),e.DNE(6,jw,2,0,"ng-container",7)(7,Vw,2,0,"ng-container",7),e.k0s()(),e.j41(8,"div",8),e.nrm(9,"app-view-quiz-object-tree",9),e.k0s()()(),e.DNE(10,xw,5,0,"div",10),e.k0s()),2&i){const r=e.sdS(2);e.R7$(),e.Y8G("correct",s.isCorrect),e.R7$(5),e.Y8G("ngIf",r.correct),e.R7$(),e.Y8G("ngIf",!r.correct),e.R7$(2),e.Y8G("objectIds",s.answer),e.R7$(),e.Y8G("ngIf",!s.summary&&!s.isCorrect)}},dependencies:[q.bT,rn,NS,Tu],changeDetection:0}),t})();function Gw(n,t){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.SpI(" ",o.label.title," ")}}function $w(n,t){if(1&n&&(e.j41(0,"div"),e.pXf(1,2),e.k0s(),e.j41(2,"div",11),e.pXf(3,3),e.k0s()),2&n){const o=e.XpG(),i=o.$implicit,s=o.index,r=e.XpG();e.R7$(),e.uP7(r.getSelectedUserOption(s).label.title.trim()),e.nnv(1),e.R7$(2),e.uP7(i.label.title.trim()),e.nnv(3)}}function Bw(n,t){if(1&n&&(e.j41(0,"div",5)(1,"div",6),e.nrm(2,"app-view-quiz-answer-number",7),e.k0s(),e.j41(3,"div",8)(4,"app-view-quiz-answer-option",9,0),e.DNE(6,Gw,2,1,"div",10)(7,$w,4,2,"ng-template",null,1,e.C5r),e.k0s()()()),2&n){const o=t.index,i=e.sdS(5),s=e.sdS(8),r=e.XpG();e.R7$(2),e.Y8G("number",o+1),e.R7$(2),e.Y8G("correct",r.isOptionAnswerCorrect(o)),e.R7$(2),e.Y8G("ngIf",i.correct)("ngIfElse",s)}}let zw=(()=>{var n;class t{constructor(){}ngOnInit(){}isOptionAnswerCorrect(i){return this.answer[i]===this.question.data.correctAnswer[i]}getSelectedUserOption(i){const s=this.answer[i];return this.question.data.options.find(r=>r.value===s)}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-label-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:()=>{let o,i;return o=$localize`:a72b1c5957d49334a91017e69eb28a64b4794be93931625009645654184:You selected ${"\ufffd0\ufffd"}:INTERPOLATION:.`,i=$localize`:68452fc86b9a1e10579d11cafee518846c2acf747572660995305138875:This is the ${"\ufffd0\ufffd"}:INTERPOLATION:.`,[["answerOption",""],["falseBlock",""],o,i,["class","answers",4,"ngFor","ngForOf"],[1,"answers"],[1,"answers__number"],[3,"number"],[1,"answers__option"],[3,"correct"],[4,"ngIf","ngIfElse"],[1,"mt-1"]]},template:function(i,s){1&i&&e.DNE(0,Bw,9,4,"div",4),2&i&&e.Y8G("ngForOf",s.question.data.options)},dependencies:[q.Sq,q.bT,Tu,RS],styles:[".answers[_ngcontent-%COMP%]{display:flex;flex-direction:row}.answers__number[_ngcontent-%COMP%]{border-top:1px solid transparent;margin-top:12px;margin-inline-end:8px}.answers__option[_ngcontent-%COMP%]{flex:1 1 auto}"],changeDetection:0}),t})();function Ww(n,t){if(1&n&&(e.j41(0,"div",7),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI("",o.questionNumber,".")}}function Xw(n,t){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-multiple-choice-answer",8),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function Hw(n,t){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-select-anatomy-answer",8),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function Qw(n,t){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-label-anatomy-answer",8),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("question",o.question)("answer",o.answer)("summary",o.summary)}}function Yw(n,t){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-content-blocks",3),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("contentBlocks",o.question.explanation)}}let LS=(()=>{var n;class t{constructor(i,s){this.store=i,this.contentBlocksService=s,this.QuestionType=vn.Q5,this.hasExplanation=!1}ngOnInit(){this.store.dispatch(new Bt.B.SetQuizPickMode("none")),this.hasExplanation=this.contentBlocksService.hasContentBlockText(this.question.explanation)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(Wa.V))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer"]],inputs:{question:"question",questionNumber:"questionNumber",answer:"answer",summary:"summary"},decls:10,vars:7,consts:[["data-test","answer",1,"answer"],[1,"answer__prompt"],["class","mr-1",4,"ngIf"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","answer__explanation",4,"ngIf"],[1,"mr-1"],[3,"question","answer","summary"],[1,"answer__explanation"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,Ww,2,1,"div",2),e.j41(3,"div"),e.nrm(4,"app-content-blocks",3),e.k0s()(),e.j41(5,"div",4),e.DNE(6,Xw,2,3,"div",5)(7,Hw,2,3,"div",5)(8,Qw,2,3,"div",5),e.k0s(),e.DNE(9,Yw,2,1,"div",6),e.k0s()),2&i&&(e.R7$(2),e.Y8G("ngIf",s.questionNumber),e.R7$(2),e.Y8G("contentBlocks",s.question.questionPrompt),e.R7$(),e.Y8G("ngSwitch",s.question.type),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.LabelAnatomy),e.R7$(),e.Y8G("ngIf",s.hasExplanation))},dependencies:[q.bT,q.ux,q.e1,Nr,Uw,Fw,zw],styles:[".answer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.answer__prompt[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.answer__explanation[_ngcontent-%COMP%]{padding-top:32px}"],changeDetection:0}),t})();var Kw=_(60391);let Jw=(()=>{var n;class t{constructor(i,s,r){this.http=i,this.markdownService=s,this.store=r}downloadResultsPDF(i="",s="",r="",a,d){return this.http.post("/ws/mc/pdf",this.getPDFHTML(i,s,r,a,d),{responseType:"arraybuffer",headers:new w.Lr({"Content-Type":"text/html; charset=utf-8"})}).pipe((0,le.T)(f=>{const T=new Blob([f],{type:"application/pdf"}),L=window.URL.createObjectURL(T),ee=(r||"Quiz Results").replace(/ /g,"_").replace(/\W/g,"").toLowerCase(),re=document.createElement("a");return re.download=ee,re.href=L,re.click(),!0}),(0,Ai.W)(()=>(0,Rt.of)(!1)))}getPDFHTML(i,s,r,a,d){return`\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <style>\n\n          @media print {\n\n            html {\n              font-family: Arial;\n            }\n\n            body {\n              margin: 0;\n            }\n\n            ol {\n              list-style-position: inside;\n              padding-left: 0;\n            }\n\n            header {\n              position: running(header);\n              width: 100%;\n            }\n\n            header > div {\n              display: flex;\n              justify-content: space-between;\n            }\n\n            @page {\n              size: letter portrait;\n              margin: 1in;\n              \n              @top-center {\n                content: element(header);\n                width: 100%;\n              }\n\n              @bottom-center {\n                content: "Page " counter(page) " of " counter(pages);\n                font-size: 10px;\n              }\n            }\n\n          }\n          \n        </style>\n      </head>\n      <body style="font-size: 12px">\n\n        <header>\n          <div style="margin-bottom: .05in">\n            <div style="font-weight: 900">${i}</div>\n            <div style="text-align: right">\n                <span style="font-weight: 900">Score: </span>\n                <span>${d.correctTotal} out of ${d.scorableTotal}</span>\n            </div>\n          </div>\n\n          <div>\n            <div>${s}</div>\n            <div style="text-align: right">\n              <span style="font-weight: 900">Percentage: </span>\n              <span>${d.score}%</span>\n            </div>\n          </div>\n        </header>\n\n        \x3c!-- PDF CONTENT --\x3e\n\n        <div style="font-weight: 900; margin-bottom: .05in">${r}</div>\n        <div style="font-size: 10px">QUIZ RESULTS</div>\n\n        <br />\n\n        ${this.createPDFResponses(a,d)}\n        \n      </body>\n    </html>\n    `}createPDFResponses(i,s){const r=i.filter(T=>T.type!==vn.Q5.Instructions),a=this.markdownService.renderer.list,d=this.markdownService.renderer.listitem;this.markdownService.renderer.list=T=>T.replace(/,$/,""),this.markdownService.renderer.listitem=T=>` ${T},`;const f=r.map(T=>{const L=this.getNormalizedAnswer(s.questionAnswers[T.id]);return this.createPDFResponse(T,L)}).join("\n      <br />\n      <br />\n    ");return this.markdownService.renderer.list=a,this.markdownService.renderer.listitem=d,`\n      <ol>\n        ${f}\n      </ol>\n    `}getNormalizedAnswer(i){return typeof i>"u"?[]:"string"==typeof i?[i]:i}createPDFResponse(i,s){let r=this.convertContentBlockArray(i.questionPrompt);i.type===vn.Q5.SelectAnatomy&&i.data.showAnswerList&&(r=`${r} ${this.printAnatomyList(i.data.correctAnswer)}.`);const a=(0,eo.Br)(i,s);return`\n      <li style="font-weight: 900">\n        ${r}\n        <div style="font-weight: 400; margin-top: .1in; margin-left: .2in; line-height: .2in;">\n          <img src="${(a?"correct":"incorrect")+".svg"}" />\n          <span style="font-weight: 900; margin-left: .05in; margin-right: .05in">${a?"Correct!":"Incorrect!"}</span>\n          ${this.getResponseText(i,s,a)}\n        </div>\n        <p style="font-weight: 400; font-style: italic; margin-bottom: 0">\n          ${this.convertContentBlockArray(i.explanation)}\n        </p>\n      </li>\n    `}getResponseText(i,s,r){let a="";switch(i.type){case vn.Q5.MultipleChoice:a=`You selected: ${this.getMultipleChoiceLabel(i,s[0])}.`,r||(a=`${a} The correct answer is: ${this.getMultipleChoiceLabel(i,i.data.correctAnswer)}.`);break;case vn.Q5.LabelAnatomy:a=`You labeled the anatomy ${r?"correctly":"incorrectly. The correct answer is"}: ${this.printLabelList(i)}.`;break;case vn.Q5.SelectAnatomy:r||(a=`You selected: ${this.printAnatomyList(s)}.`)}return a}printAnatomyList(i){const s=this.store.selectSnapshot(Xe.S.getViewGraph);return i.map(r=>(0,h_.dV)(s,r)?.label).join(", ")}printLabelList(i){return i.data.correctAnswer.map((s,r)=>`${r+1}. ${i.data.options.find(d=>d.value===s).label.title}`).join(", ")}getMultipleChoiceLabel(i,s){return i.data.options.find(a=>a.value===s)?.label}convertContentBlockArray(i){return i.filter(s=>s.type===uo.m.Markdown).map(s=>{const r=this.markdownService.parse(s.markdown);return this.stripHTML(r)}).join("\n")}stripHTML(i){return(new DOMParser).parseFromString(i,"text/html").body.textContent||""}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(pi.Rl),e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();const qw=["progressCircle"],Zw=["*"],eP=(n,t)=>({"progress--text-small":n,"progress--animate":t});function tP(n,t){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.progress,"% ")}}function nP(n,t){1&n&&(e.j41(0,"div",7),e.SdG(1),e.k0s())}let US=(()=>{var n;class t{get progress(){return this._progress}set progress(i){this._progress=i,this.updateCircle()}get strokeWidth(){return this._strokeWidth}set strokeWidth(i){this._strokeWidth=i}get diameter(){return this._diameter}set diameter(i){this._diameter=i}constructor(i,s){this.renderer=i,this.changeRef=s,this.textSize="default",this._progress=0,this.showPercent=!0,this.strokeColor="#2d72dc",this.fillColor="#ffffff",this.ringColor="#eaeff5",this._strokeWidth=8,this._diameter=120,this.fillOnComplete=!1,this.animate=!0}ngOnInit(){}ngAfterViewInit(){this.updateCircle()}updateCircle(){if(this.progressCircleRef){const s=2*this.progressCircleRef.nativeElement.r.baseVal.value*Math.PI,r=s-this.progress/100*s;this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}this.changeRef.markForCheck()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-progress-circle"]],viewQuery:function(i,s){if(1&i&&e.GBs(qw,7),2&i){let r;e.mGM(r=e.lsd())&&(s.progressCircleRef=r.first)}},inputs:{textSize:"textSize",progress:"progress",showPercent:"showPercent",strokeColor:"strokeColor",fillColor:"fillColor",ringColor:"ringColor",strokeWidth:"strokeWidth",diameter:"diameter",fillOnComplete:"fillOnComplete",animate:"animate"},ngContentSelectors:Zw,decls:9,vars:20,consts:[["progressCircle",""],["data-test","progress",1,"progress",3,"ngClass"],["alt",""],[1,"progress__circle"],["class","progress__label","data-test","progressPercentage",4,"ngIf"],["class","progress__content","data-test","progressContent",4,"ngIf"],["data-test","progressPercentage",1,"progress__label"],["data-test","progressContent",1,"progress__content"]],template:function(i,s){1&i&&(e.NAR(),e.j41(0,"div",1),e.qSk(),e.j41(1,"svg",2)(2,"g"),e.nrm(3,"circle",3),e.k0s(),e.j41(4,"g"),e.nrm(5,"circle",3,0),e.k0s()(),e.DNE(7,tP,2,1,"div",4)(8,nP,2,0,"div",5),e.k0s()),2&i&&(e.Y8G("ngClass",e.l_i(17,eP,"small"===s.textSize,s.animate)),e.R7$(),e.BMQ("width",s.diameter)("height",s.diameter),e.R7$(2),e.BMQ("stroke",s.ringColor)("stroke-width",s.strokeWidth)("fill",s.fillColor)("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),e.R7$(2),e.BMQ("stroke",s.strokeColor)("stroke-width",s.strokeWidth)("fill",100===s.progress&&s.fillOnComplete?s.strokeColor:"transparent")("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),e.R7$(2),e.Y8G("ngIf",s.showPercent),e.R7$(),e.Y8G("ngIf",!s.showPercent))},dependencies:[q.YU,q.bT],styles:[".progress[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.progress--animate[_ngcontent-%COMP%]   .progress__circle[_ngcontent-%COMP%]{transition:stroke-dashoffset .35s,fill .35s}.progress--small[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.progress__ring[_ngcontent-%COMP%]{position:absolute;z-index:1}.progress__circle[_ngcontent-%COMP%]{transform:rotate(-90deg);transform-origin:50% 50%}.progress__label[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;font-weight:600;transform:translate(-50%,-50%);z-index:2;font-size:1.125rem;line-height:1.75rem}.progress__content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:#fff;position:absolute}"],changeDetection:0}),t})();var al,ko=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Lo=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function iP(n,t){if(1&n&&(e.j41(0,"div",10)(1,"div",11),e.nrm(2,"app-progress-circle",12),e.j41(3,"div",13),e.pXf(4,0),e.k0s()()()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("progress",null==o.quizScore?null:o.quizScore.score),e.R7$(2),e.uP7(null==o.quizScore?null:o.quizScore.correctTotal)(null==o.quizScore?null:o.quizScore.scorableTotal),e.nnv(4)}}function oP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleResultsClick())}),e.nrm(1,"app-icon",21),e.qex(2),e.pXf(3,1),e.bVm(),e.k0s()}}function sP(n,t){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function rP(n,t){1&n&&(e.qex(0),e.pXf(1,3),e.bVm())}function aP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleToggleSummaryClick())}),e.DNE(1,sP,2,0,"ng-container",23)(2,rP,2,0,"ng-container",23),e.k0s()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.showExplanation),e.R7$(),e.Y8G("ngIf",!o.showExplanation)}}function lP(n,t){if(1&n&&(e.j41(0,"div",26),e.nrm(1,"app-view-quiz-answer",27),e.k0s()),2&n){const o=t.$implicit,i=t.index,s=e.XpG(3);e.R7$(),e.Y8G("question",o)("questionNumber",i+1)("answer",null==s.quizScore?null:s.quizScore.questionAnswers[o.id])("summary",!0)}}function cP(n,t){if(1&n&&(e.j41(0,"div",24),e.DNE(1,lP,2,4,"div",25),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngForOf",o.questions)}}function dP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",28),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleRestartClick())}),e.pXf(1,4),e.k0s()}}function _P(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleExitClick())}),e.pXf(1,5),e.k0s()}}function pP(n,t){if(1&n&&(e.j41(0,"div",14),e.DNE(1,oP,4,0,"button",15)(2,aP,3,2,"button",16)(3,cP,2,1,"div",17)(4,dP,2,0,"button",18),e.nI1(5,"async"),e.DNE(6,_P,2,0,"button",19),e.nI1(7,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.showSummaryEnabled&&o.showExplanationEnabled),e.R7$(),e.Y8G("ngIf",o.showSummaryEnabled&&o.showExplanationEnabled),e.R7$(),e.Y8G("ngIf",o.showExplanationEnabled&&o.showExplanation),e.R7$(),e.Y8G("ngIf",e.bMT(5,5,o.enableQuizRetake$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(7,7,o.quizLocked$))}}function uP(n,t){1&n&&(e.j41(0,"div",30),e.nrm(1,"app-spinner",31),e.k0s())}class Yi{constructor(t,o,i,s){this.changeRef=t,this.quizService=o,this.quizPDFService=i,this.snackbar=s,this.questions=[],this.showSummaryEnabled=!1,this.showExplanationEnabled=!1,this.showExplanation=!1,this.loadingPDF=!1,this.ngUnsubscribe=new Q.B,this.pdfInputs=new Kw.m(1)}ngOnInit(){this.initReviewListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.pdfInputs.complete()}initReviewListeners(){(0,Ht.z)([this.userFullName$,this.userEmail$,this.story$,this.questions$,this.submissions$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i,s,r])=>{this.questions=s,this.quizScore=(0,eo.MH)(s,r),this.pdfInputs.next([t,o,i,s,this.quizScore]),this.changeRef.markForCheck()}),this.quizSettings$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({showSummary:t,showExplanation:o})=>{this.showSummaryEnabled=!1!==t,this.showExplanationEnabled=!1!==o,this.changeRef.markForCheck()})}handleToggleSummaryClick(){this.showExplanation=!this.showExplanation}handleResultsClick(){this.loadingPDF=!0,this.pdfInputs.pipe((0,tn.s)(1),(0,Cn.Z)(([t,o,i,s,r])=>this.quizPDFService.downloadResultsPDF(t,o,i.displayName.toUpperCase(),s,r)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.loadingPDF=!1,t||this.snackbar.open("Error opening the results PDF."),this.changeRef.markForCheck()})}handleRestartClick(){this.quizService.resetQuiz(),this.quizService.startQuiz()}handleExitClick(){this.quizService.exitQuiz()}}(al=Yi).\u0275fac=function(t){return new(t||al)(e.rXU(e.gRc),e.rXU(Mr),e.rXU(Jw),e.rXU(_o.UG))},al.\u0275cmp=e.VBU({type:al,selectors:[["app-view-quiz-review"]],decls:4,vars:3,consts:()=>{let n,t,o,i,s,r;return n=$localize`:2bba53403aac78f4e44cdb7a38216c93a0a33ab71432800600767014651: You answered ${"\ufffd0\ufffd"}:INTERPOLATION: of ${"\ufffd1\ufffd"}:INTERPOLATION_1: questions correctly. `,t=$localize`:f57ccc4608c3db5d46b9ebd75467a841f5e7599e1835089687895717278:Download Results as PDF`,o=$localize`:1f4dec9e6be75af098a539e0eedf41f86f2c8c386268957596815378507:Hide Summary`,i=$localize`:96b2e76703c8dea4c7c173b97fff2a10f45c59073866918107243977386:Show Summary`,s=$localize`:bf6eb666b88af02c4793aba88435a71da36ba5d25529862952779485373: Take Again `,r=$localize`:19411ab6ff55d914e6f229a14e03ffc1127ffccf4002907482219878023: Exit Quiz `,[n,t,o,i,s,r,["data-test","quizReview",1,"review"],["class","review__container","data-test","quizDownload",4,"ngIf"],["class","flex flex-col gap-2",4,"ngIf"],["class","mt-10 review__loading",4,"ngIf"],["data-test","quizDownload",1,"review__container"],["data-test","quizSummary",1,"text-center"],["strokeWidth","12","diameter","96",3,"progress"],[1,"mt-5","mb-8","text-xs","font-semibold"],[1,"flex","flex-col","gap-2"],["class","w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",3,"click",4,"ngIf"],["class","w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",3,"click",4,"ngIf"],["class","mt-3 review__summary","data-test","quizExplanation",4,"ngIf"],["class","w-full mt-8","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",3,"click",4,"ngIf"],["class","w-full mt-3","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",1,"w-full",3,"click"],["icon","download",1,"mr-1"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",1,"w-full",3,"click"],[4,"ngIf"],["data-test","quizExplanation",1,"mt-3","review__summary"],["class","my-6",4,"ngFor","ngForOf"],[1,"my-6"],[3,"question","questionNumber","answer","summary"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",1,"w-full","mt-8",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",1,"w-full","mt-3",3,"click"],[1,"mt-10","review__loading"],["size","huge","direction","vertical","label","Loading"]]},template:function(t,o){1&t&&(e.j41(0,"div",6),e.DNE(1,iP,5,3,"div",7)(2,pP,8,9,"div",8)(3,uP,2,0,"div",9),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",o.showSummaryEnabled),e.R7$(),e.Y8G("ngIf",!o.loadingPDF),e.R7$(),e.Y8G("ngIf",o.loadingPDF))},dependencies:[q.Sq,q.bT,rn,yt.R,Gs,US,LS,q.Jj],styles:[".review[_ngcontent-%COMP%]{position:relative}.review__summary[_ngcontent-%COMP%]{background-color:#f9fafd;padding:4px 12px}"],changeDetection:0}),ko([(0,l.l6)(Ue.j.getAllQuestions),Lo("design:type",y.c)],Yi.prototype,"questions$",void 0),ko([(0,l.l6)(Ue.j.getAllSubmissions),Lo("design:type",y.c)],Yi.prototype,"submissions$",void 0),ko([(0,l.l6)(Ue.j.getQuizSettings),Lo("design:type",y.c)],Yi.prototype,"quizSettings$",void 0),ko([(0,l.l6)(Ue.j.getQuizModeLocked),Lo("design:type",y.c)],Yi.prototype,"quizLocked$",void 0),ko([(0,l.l6)(Ue.j.getEnableQuizRetake),Lo("design:type",y.c)],Yi.prototype,"enableQuizRetake$",void 0),ko([(0,l.l6)(ke.getUserProfile),Lo("design:type",y.c)],Yi.prototype,"userProfile$",void 0),ko([(0,l.l6)(ke.getUserFullName),Lo("design:type",y.c)],Yi.prototype,"userFullName$",void 0),ko([(0,l.l6)(ke.getUserEmail),Lo("design:type",y.c)],Yi.prototype,"userEmail$",void 0),ko([(0,l.l6)(rt.getStory),Lo("design:type",y.c)],Yi.prototype,"story$",void 0);var ll,Ki=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ji=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const gP=(n,t)=>({"view-quiz--column":n,"view-quiz--drawer":t});function hP(n,t){if(1&n&&(e.nrm(0,"app-view-quiz-question",12),e.nI1(1,"async")),2&n){const o=e.XpG(2);e.Y8G("question",e.bMT(1,1,o.question$))}}function mP(n,t){if(1&n&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&n){let o;const i=e.XpG(3);e.R7$(),e.SpI(" ",(null==(o=e.bMT(2,1,i.question$))?null:o.nextLabel)||i.defaultNextButtonNext," ")}}function fP(n,t){1&n&&(e.j41(0,"div",17),e.pXf(1,0),e.k0s())}function SP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSubmit())}),e.j41(1,"div",14),e.nI1(2,"async"),e.DNE(3,mP,3,3,"div",15)(4,fP,2,0,"div",16),e.k0s()()}if(2&n){let o;const i=e.XpG(2);e.Y8G("disabled",!i.form.valid),e.R7$(),e.Y8G("ngSwitch",null==(o=e.bMT(2,3,i.question$))?null:o.type),e.R7$(2),e.Y8G("ngSwitchCase",i.quizQuestionType.Instructions)}}function bP(n,t){if(1&n&&(e.j41(0,"div",8),e.DNE(1,hP,2,3,"app-view-quiz-question",9),e.nI1(2,"async"),e.j41(3,"div",10),e.DNE(4,SP,5,5,"button",11),e.nI1(5,"async"),e.nI1(6,"async"),e.k0s()()),2&n){let o;const i=e.XpG();e.Y8G("formGroup",i.form),e.R7$(),e.Y8G("ngIf",e.bMT(2,3,i.question$)),e.R7$(3),e.Y8G("ngIf",(null==(o=e.bMT(5,5,i.quizSettings$))?null:o.showSubmit)&&e.bMT(6,7,i.lifecycle$)===i.Lifecycle.Question)}}function yP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.nextQuestion())}),e.j41(1,"div",17),e.EFF(2),e.nI1(3,"async"),e.k0s()()}if(2&n){let o;const i=e.XpG(2);e.R7$(2),e.JRh((null==(o=e.bMT(3,1,i.question$))?null:o.nextLabel)||i.defaultNextButtonNext)}}function vP(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.handleViewSummaryClick())}),e.PLo(1,1),e.nrm(2,"div",17),e.YFu(),e.k0s()}}function EP(n,t){if(1&n&&(e.qex(0),e.DNE(1,vP,3,0,"button",23),e.nI1(2,"async"),e.bVm()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,o.quizReviewEnabled$))}}function CP(n,t){if(1&n&&(e.qex(0),e.j41(1,"div",18),e.nrm(2,"app-view-quiz-answer",19),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s(),e.qex(5,14),e.nI1(6,"async"),e.j41(7,"div",10),e.DNE(8,yP,4,3,"button",20)(9,EP,3,3,"ng-container",21),e.k0s(),e.bVm()()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("question",e.bMT(3,5,o.question$))("answer",e.bMT(4,7,o.submission$).answer)("summary",!1),e.R7$(3),e.Y8G("ngSwitch",e.bMT(6,9,o.hasQuestionsRemaining$)),e.R7$(3),e.Y8G("ngSwitchCase",!0)}}function TP(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-quiz-review"),e.bVm())}function OP(n,t){if(1&n&&(e.j41(0,"div",25),e.qex(1),e.pXf(2,2),e.nI1(3,"async"),e.bVm(),e.qex(4),e.pXf(5,3),e.bVm(),e.k0s()),2&n){let o;const i=e.XpG();e.R7$(3),e.uP7(null==(o=e.bMT(3,1,i.questions$))?null:o.length),e.nnv(2)}}class Mi{constructor(t,o,i,s,r,a){this.store=t,this.actions=o,this.formBuilder=i,this.viewService=s,this.applicationEventService=r,this.viewQuizService=a,this.defaultNextButtonNext=$localize`Next Question`,this.showHeader=!0,this.mode="column",this.Lifecycle=Po.h,this.quizQuestionType=vn.Q5,this.sceneConfigStash={},this.ngUnsubscribe=new Q.B}ngOnInit(){if(!this.store.selectSnapshot(Ue.j.getActiveQuestionId)){const t=this.store.selectSnapshot(Ue.j).questions[0].id;this.store.dispatch(new Bt.B.SetActiveQuestion(t))}this.form=this.formBuilder.group({question:new we.hs("",this.getQuizValidation())}),this.initQuestionObserver(),this.initAnswerObserver(),this.initEngineInteractionObserver(),this.applicationEventService.fireEvent(nt.F.QuizEntered,!0)}ngOnDestroy(){Object.entries(this.sceneConfigStash).forEach(([t,o])=>{this.store.dispatch(new En.qi(t,o.background))}),this.applicationEventService.fireEvent(nt.F.QuizExited,!0),this.viewService.selectTool(qt.s.Select),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}get answer(){const t=this.form.get("question").value;return Array.isArray(t)?t:[t]}initQuestionObserver(){this.question$.pipe((0,b.Q)(this.ngUnsubscribe),(0,S.p)(t=>void 0!==t)).subscribe(t=>{const o=this.store.selectSnapshot(fe.N.getSelectedChapterId);t.chapterId!==o&&this.store.dispatch(new En.wg(t.chapterId)),this.form.reset(),this.setSceneConfig(t),t.type===vn.Q5.Instructions&&this.form.get("question").setValue("-"),this.applicationEventService.fireEvent(nt.F.QuizQuestionLoaded,t)})}initAnswerObserver(){this.form.get("question").valueChanges.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(Ue.j.getActiveQuestion),i=this.store.selectSnapshot(Ue.j.getActiveSubmission);void 0!==o&&(this.store.selectSnapshot(Ue.j.getAllSubmissions).some(s=>s.questionId===o.id)||((!i||!(0,m.isEqual)(i.answer,t))&&this.store.dispatch(new Bt.B.SetActiveSubmission({questionId:o.id,answer:t})),(0,m.isNil)(t)||this.applicationEventService.fireEvent(nt.F.QuizAnswerSelected,{questionId:o.id,answerId:t})))})}initEngineInteractionObserver(){this.viewService.selectTool(qt.s.Quiz),this.actions.pipe((0,l.xi)(st.zE),(0,S.p)(i=>{const{node:s,event:r}=i;return!(0,m.isNil)(s)&&this.store.selectSnapshot(Xe.S.getActiveTool)===qt.s.Quiz&&!r.srcEvent.shiftKey})).pipe((0,S.p)(()=>"none"!==this.store.selectSnapshot(Ue.j.getPickMode)),(0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{"single"===this.store.selectSnapshot(Ue.j.getPickMode)&&this.viewService.clearSelectedNodes();const r=(0,m.get)(i,"hit.objectId");if(r){const d=this.store.selectSnapshot(Mn.z.getCheckedNodeIds).includes(r);this.store.dispatch(new Lt.q9(!d,[r]))}}),this.question$.pipe((0,xn.F)((i,s)=>(0,m.get)(i,"id")===(0,m.get)(s,"id")),(0,S.p)(i=>!(0,m.isNil)(i))).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>this.setQuestionPickMode(i))}setQuestionPickMode(t){const{type:o,data:i}=t;let s;s=o===vn.Q5.SelectAnatomy?i.correctAnswer.length>1&&"any"!==i.selectType?"multi":"single":"none",this.store.dispatch(new Bt.B.SetQuizPickMode(s))}handleSubmit(){const t=this.store.selectSnapshot(Ue.j.getActiveQuestion);(this.form.valid||t.type===vn.Q5.Instructions)&&this.viewQuizService.submitQuestion(t.id,this.answer)}handleViewSummaryClick(){this.viewSummary()}handleExitClick(){this.viewQuizService.exitQuiz()}nextQuestion(){this.viewQuizService.nextQuestion()}viewSummary(){this.store.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Review)),this.applicationEventService.fireEvent(nt.F.QuizCompleted,!0)}setSceneConfig(t){const{camera:o,background:i}=t?.sceneConfig||{},s=this.store.selectSnapshot(fe.N.getChapter(t.chapterId));o&&(this.setStash(t.chapterId,{camera:s.camera.location}),setTimeout(()=>{this.store.dispatch(new jt.Ih(o.location,!0,1))})),i&&(this.setStash(t.chapterId,{background:s.background}),this.store.dispatch(new En.qi(t.chapterId,i)))}setStash(t,o){this.sceneConfigStash[t]={...this.sceneConfigStash[t]||{},...o}}getQuizValidation(){return t=>{const o=t.value,i=Array.isArray(o)?o:[o],s=this.store.selectSnapshot(Ue.j.getActiveQuestion),r=(0,eo.Ie)(s),a=i.some(d=>(0,m.isNil)(d)||""===d);return r&&a?{invalidValues:a}:null}}}(ll=Mi).\u0275fac=function(t){return new(t||ll)(e.rXU(l.il),e.rXU(l.En),e.rXU(we.ze),e.rXU(hn),e.rXU(po.S),e.rXU(Mr))},ll.\u0275cmp=e.VBU({type:ll,selectors:[["app-view-quiz"]],inputs:{showHeader:"showHeader",mode:"mode"},decls:12,vars:22,consts:()=>{let n,t,o,i;return n=$localize`:71c77bb8cecdf11ec3eead24dd1ba506573fa9cd935187492052582731:Submit`,t=$localize`:19c0d80cbbbe6ab7d75dbe7c77ef3017ec5f4d967886851004377486562:${"\ufffd#2\ufffd"}:START_TAG_DIV:See Results${"\ufffd/#2\ufffd"}:CLOSE_TAG_DIV:`,o=$localize`:6649c9f6c298747891fb175dbe382be60e1728c66638623222432926474:{VAR_PLURAL, plural, =1 {Answer} other {Answers}}`,o=e.k04(o,{VAR_PLURAL:"\ufffd0\ufffd"}),i=$localize`:ceb65fed78c2ea1d81ce1514a244608fdc02bfca1766523863374888036:submitted`,[n,t,o,i,["data-test","quiz",1,"view-quiz",3,"ngClass"],["role","form","class","flex flex-col",3,"formGroup",4,"ngIf"],[4,"ngIf"],["class","text-base font-bold text-center",4,"ngIf"],["role","form",1,"flex","flex-col",3,"formGroup"],["formControlName","question",3,"question",4,"ngIf"],[1,"flex","flex-row-reverse"],["app-view-button","","class","view-quiz__button","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",3,"disabled","click",4,"ngIf"],["formControlName","question",3,"question"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",1,"view-quiz__button",3,"click","disabled"],[3,"ngSwitch"],["class","px-4",4,"ngSwitchCase"],["class","px-4",4,"ngSwitchDefault"],[1,"px-4"],[1,"mb-8"],[3,"question","answer","summary"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button","data-test","questionNextButton",3,"click",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionNextButton",1,"view-quiz__button",3,"click"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button",3,"click",4,"ngIf"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded",1,"view-quiz__button",3,"click"],[1,"text-base","font-bold","text-center"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",4),e.DNE(1,bP,7,9,"div",5),e.nI1(2,"async"),e.DNE(3,CP,10,11,"ng-container",6),e.nI1(4,"async"),e.DNE(5,TP,2,0,"ng-container",6),e.nI1(6,"async"),e.nI1(7,"async"),e.DNE(8,OP,6,3,"div",7),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s()),2&t){let i;e.Y8G("ngClass",e.l_i(19,gP,"column"===o.mode,"drawer"===o.mode)),e.R7$(),e.Y8G("ngIf",e.bMT(2,5,o.lifecycle$)===o.Lifecycle.Question),e.R7$(2),e.Y8G("ngIf",e.bMT(4,7,o.lifecycle$)===o.Lifecycle.Explanation),e.R7$(2),e.Y8G("ngIf",e.bMT(6,9,o.lifecycle$)===o.Lifecycle.Review&&e.bMT(7,11,o.quizReviewEnabled$)),e.R7$(3),e.Y8G("ngIf",!(e.bMT(9,13,o.hasQuestionsRemaining$)||e.bMT(10,15,o.quizReviewEnabled$)||null!=(i=e.bMT(11,17,o.quizSettings$))&&i.showExplanation))}},dependencies:[q.YU,q.bT,q.ux,q.e1,q.fG,rn,we.BC,we.cb,we.j4,we.JD,hd,LS,Yi,q.Jj],styles:[".view-quiz[_ngcontent-%COMP%]{color:#374a68}.view-quiz__button[_ngcontent-%COMP%]:disabled{opacity:.5}.view-quiz--column[_ngcontent-%COMP%]   .view-quiz__button[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),Ki([(0,l.l6)(Ue.j.getQuizReviewEnabled),Ji("design:type",y.c)],Mi.prototype,"quizReviewEnabled$",void 0),Ki([(0,l.l6)(Ue.j.getActiveQuestion),Ji("design:type",y.c)],Mi.prototype,"question$",void 0),Ki([(0,l.l6)(Ue.j.getAllQuestions),Ji("design:type",y.c)],Mi.prototype,"questions$",void 0),Ki([(0,l.l6)(Ue.j.getActiveQuestionIndex),Ji("design:type",y.c)],Mi.prototype,"questionIndex$",void 0),Ki([(0,l.l6)(Ue.j.getQuestionTotal),Ji("design:type",y.c)],Mi.prototype,"questionTotal$",void 0),Ki([(0,l.l6)(Ue.j.getCorrectAnswerTotal),Ji("design:type",y.c)],Mi.prototype,"correctAnswerTotal$",void 0),Ki([(0,l.l6)(Ue.j.hasQuestionRemaining),Ji("design:type",y.c)],Mi.prototype,"hasQuestionsRemaining$",void 0),Ki([(0,l.l6)(Ue.j.getQuizSettings),Ji("design:type",y.c)],Mi.prototype,"quizSettings$",void 0),Ki([(0,l.l6)(Ue.j.getLifecycle),Ji("design:type",y.c)],Mi.prototype,"lifecycle$",void 0),Ki([(0,l.l6)(Ue.j.getQuizModeLocked),Ji("design:type",y.c)],Mi.prototype,"quizLocked$",void 0),Ki([(0,l.l6)(Ue.j.getActiveSubmission),Ji("design:type",y.c)],Mi.prototype,"submission$",void 0);const MP=["container"],IP=n=>({"rotate-90":n});function wP(n,t){if(1&n&&(e.j41(0,"span"),e.pXf(1,1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.uP7(o.updateDateText()),e.nnv(1)}}function PP(n,t){1&n&&(e.j41(0,"span"),e.pXf(1,2),e.k0s())}function AP(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",null,0)(2,"button",3),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.toggleDetails())}),e.j41(3,"div",4)(4,"span",5),e.DNE(5,wP,2,1,"span")(6,PP,2,0),e.k0s(),e.nrm(7,"app-icon",6),e.k0s()()()}if(2&n){let o;const i=e.XpG();e.R7$(5),e.vxM(5,null!=(o=i.sourceInfo().reviewed)&&o.enabled&&null!=(o=i.sourceInfo().audit)&&o.enabled&&i.updateDate()?5:6),e.R7$(2),e.Y8G("ngClass",e.eq3(2,IP,i.open()))}}let jS=(()=>{var n;class t{ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}constructor(i,s){this.store=i,this.popupService=s,this.ngUnsubscribe=new Q.B,this.open=(0,e.vPA)(!1),this.sourceInfo=(0,mn.ot)(this.store.select(rt.getStorySourceInfo)),this.selectedBookmark=(0,mn.ot)(this.store.select(_t.getSelectedBookmark)),this.updateDate=(0,e.EWP)(()=>this.selectedBookmark()?.update_date_time??this.selectedBookmark()?.create_date_time),this.updateDateTime=(0,e.EWP)(()=>{const r=this.updateDate();return r?new Date(r).toISOString():void 0}),this.updateDateText=(0,e.EWP)(()=>{const r=this.updateDate();return r?new Date(r).toLocaleDateString():void 0})}toggleDetails(){const i=this.popupService.open({origin:this.container.nativeElement,positions:[ho.Below],width:"272px",maxHeight:"484px",content:ud});this.open.set(!0),i.afterClosed$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.open.set(!1)})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(wS))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-source-info-toggle"]],viewQuery:function(i,s){if(1&i&&e.GBs(MP,5),2&i){let r;e.mGM(r=e.lsd())&&(s.container=r.first)}},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let o,i;return o=$localize`:ec2c1d22b6e2207023be0f04e37c533e4e5cc7ec7104746773075604544:Medically reviewed on ${"\ufffd0\ufffd"}:INTERPOLATION:`,i=$localize`:5bbf2bcdb5d3aa2b328ab66786845485b997e0e75233133710285034701:Source Information`,[["container",""],o,i,["app-view-button","","buttonSize","2xsmall","data-test","viewSourceInfoToggle",1,"w-full","overflow-hidden","rounded",3,"click"],[1,"flex","items-center"],[1,"text-xs"],["icon","angle-right",1,"ml-1","transition-transform",3,"ngClass"]]},template:function(i,s){1&i&&e.DNE(0,AP,8,4,"div"),2&i&&e.vxM(0,s.sourceInfo()?0:-1)},dependencies:[q.MD,q.YU,Oi.C,rn,yi.o,yt.R],changeDetection:0}),t})(),VS=(()=>{var n;class t{constructor(i){this.el=i,this.appScrollListener=(0,e.geq)()}ngOnInit(){this.el.nativeElement.addEventListener("scroll",()=>{this.emitScroll()})}ngOnDestroy(){this.el.nativeElement.removeEventListener("scroll",this.emitScroll)}emitScroll(){this.appScrollListener.set(this.el.nativeElement.scrollTop)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.aKT))},n.\u0275dir=e.FsC({type:n,selectors:[["","appScrollListener",""]],inputs:{appScrollListener:[e.Mj6.SignalBased,"appScrollListener"]},outputs:{appScrollListener:"appScrollListenerChange"}}),t})();var cl,is=_(73845);class md{constructor(t){this.store=t,this.injector=(0,e.WQX)(e.zZn),this.defaultImage=(0,e.hFB)("/assets/images/view-chapter-thumbnail-placeholder.png"),this.chapterId=e.hFB.required(),this.chapterThumb=(0,e.EWP)(()=>{const o=this.thumbnails().get(this.chapterId());return o?o.snapshot||o.urls.small:""}),this.thumbnails=(0,mn.ot)(this.store.select(to.K.getRegisteredThumbnails))}}(cl=md).\u0275fac=function(t){return new(t||cl)(e.rXU(l.il))},cl.\u0275cmp=e.VBU({type:cl,selectors:[["app-chapter-image"]],inputs:{defaultImage:[e.Mj6.SignalBased,"defaultImage"],chapterId:[e.Mj6.SignalBased,"chapterId"]},standalone:!0,features:[e.aNF],decls:1,vars:2,consts:[[1,"w-full","h-full","bg-cover",3,"defaultImage","lazyLoad"]],template:function(t,o){1&t&&e.nrm(0,"div",0),2&t&&e.Y8G("defaultImage",o.defaultImage())("lazyLoad",o.chapterThumb())},dependencies:[is.Un,is.Je],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(to.K.getRegisteredThumbnails),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],md.prototype,"thumbnails$",void 0);var dl,ul,_l=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},pl=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function DP(n,t){if(1&n&&(e.qex(0),e.j41(1,"div",6),e.nrm(2,"app-progress-circle",7),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-progress-circle",8),e.k0s(),e.bVm()),2&n){const o=e.XpG();e.R7$(2),e.Y8G("progress",o.chapterPercent)("showPercent",!1)("animate",!1),e.R7$(2),e.Y8G("progress",o.countdownPercent)("showPercent",!1)("animate",!1)}}class os{constructor(t,o,i,s){this.viewService=t,this.viewPlaythroughService=o,this.store=i,this.changeDetectorRef=s,this.showCount=!0,this.showPlaythrough=!1,this.buttonSize=Ao.Default,this.iconSize="md",this.buttonTheme="transparent-fill",this.interval=null,this.chapterPercent=0,this.countdownPercent=0,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initChapterListener(),this.initPlaythrough()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.stopChapterTimer()}handlePreviousClick(){this.viewService.previousChapter("Pagination")}handleNextClick(){this.viewService.nextChapter("Pagination")}initChapterListener(){this.store.select(fe.N.getSelectedChapterId).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.stopChapterTimer()}),(0,Ht.z)([this.store.select(Xe.S.getChapter),this.store.select(_e.getPlaythroughEnabled)]).pipe((0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{this.chapterPercent=0,o?this.startChapterTimer():this.stopChapterTimer()})}initPlaythrough(){this.viewPlaythroughService.countdownChanged.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const{countdown:o}=this.store.selectSnapshot(_e.getPlaythroughSettings);this.countdownPercent=Math.floor(100-t/o*100),this.changeDetectorRef.markForCheck()})}startChapterTimer(){this.chapterPercent=0,this.countdownPercent=0,this.stopChapterTimer(),this.interval=setInterval(()=>{const t=this.viewPlaythroughService.calculateMaximumRemainingTime();this.chapterPercent=Math.ceil(t.current/t.duration*100),this.chapterPercent>100&&(this.chapterPercent=100),this.changeDetectorRef.markForCheck()},50)}stopChapterTimer(){this.interval&&clearInterval(this.interval),this.interval=null}}(dl=os).\u0275fac=function(t){return new(t||dl)(e.rXU(hn),e.rXU(Hf),e.rXU(l.il),e.rXU(e.gRc))},dl.\u0275cmp=e.VBU({type:dl,selectors:[["app-view-pagination"]],inputs:{showCount:"showCount",showPlaythrough:"showPlaythrough",buttonSize:"buttonSize",iconSize:"iconSize",buttonTheme:"buttonTheme"},decls:10,vars:17,consts:()=>{let n,t;return n=$localize`:3228d65908ec43ba657d860b050c2a3871868cee8424575283863104959:Previous Chapter`,t=$localize`:95f5388846a3beaee5f870eb0996ed47d9c7819a8192680256063110394:Next Chapter`,[[1,"view-pagination"],["data-test","viewPreviousChapter","aria-label",n,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],["icon","arrow-left","appLogicalDir","",3,"size"],["data-test","viewNextChapter","aria-label",t,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],[4,"ngIf"],["icon","arrow-right","appLogicalDir","",3,"size"],[1,"view-pagination__playthrough"],["fillColor","transparent","ringColor","#eaeff5","strokeColor","#96a8c0","diameter","28","strokeWidth","3",3,"progress","showPercent","animate"],["fillColor","transparent","ringColor","transparent","strokeColor","#374a68","diameter","28","strokeWidth","3",3,"progress","showPercent","animate"]]},template:function(t,o){1&t&&(e.j41(0,"nav",0)(1,"button",1),e.nI1(2,"async"),e.bIt("click",function(){return o.handlePreviousClick()}),e.nrm(3,"app-icon",2),e.k0s(),e.j41(4,"button",3),e.nI1(5,"async"),e.nI1(6,"async"),e.bIt("click",function(){return o.handleNextClick()}),e.DNE(7,DP,5,6,"ng-container",4),e.nI1(8,"async"),e.nrm(9,"app-icon",5),e.k0s()()),2&t&&(e.R7$(),e.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",0===e.bMT(2,9,o.chapterIndex$)?"true":null),e.R7$(2),e.Y8G("size",o.iconSize),e.R7$(),e.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",e.bMT(5,11,o.chapterIndex$)===e.bMT(6,13,o.chapterCount$)-1?"true":null),e.R7$(3),e.Y8G("ngIf",e.bMT(8,15,o.playthroughEnabled$)),e.R7$(2),e.Y8G("size",o.iconSize))},dependencies:[rn,q.bT,$i.e,yt.R,US,q.Jj],styles:["@keyframes _ngcontent-%COMP%_disappear{0%{top:0}to{top:100%}}.view-pagination[_ngcontent-%COMP%]{display:flex;position:relative;white-space:nowrap}.view-pagination__count[_ngcontent-%COMP%]{font-size:14px;padding:0 8px}.view-pagination__playthrough[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center}"],changeDetection:0}),_l([(0,l.l6)(fe.N.getSelectedChapterIndex),pl("design:type",y.c)],os.prototype,"chapterIndex$",void 0),_l([(0,l.l6)(fe.N.getNextChapter),pl("design:type",y.c)],os.prototype,"nextChapter$",void 0),_l([(0,l.l6)(fe.N.getPreviousChapter),pl("design:type",y.c)],os.prototype,"previousChapter$",void 0),_l([(0,l.l6)(fe.N.getChapterCount),pl("design:type",y.c)],os.prototype,"chapterCount$",void 0),_l([(0,l.l6)(_e.getPlaythroughEnabled),pl("design:type",y.c)],os.prototype,"playthroughEnabled$",void 0);const jP=n=>({"!border-gray-200":n}),VP=n=>({"!outline-blue-600":n}),xP=(n,t)=>({"!bg-gray-200":n,"!bg-blue-600 !text-white !outline-blue-600":t}),FP=n=>({"!opacity-100":n});function GP(n,t){1&n&&e.nrm(0,"div",11)}function $P(n,t){1&n&&e.nrm(0,"div",12)}function BP(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",5)(1,"button",6),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.handleChapterClick(s))}),e.j41(2,"span",7),e.EFF(3),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.EFF(6),e.k0s(),e.nrm(7,"app-chapter-image",10),e.k0s(),e.DNE(8,GP,1,0,"div",11)(9,$P,1,0,"div",12),e.k0s()()}if(2&n){const o=t.$implicit,i=t.$index,s=t.$index,r=t.$count,a=e.XpG();e.R7$(),e.Y8G("matTooltip",a.getTooltip(i,o)),e.BMQ("aria-current",a.selectedChapterIndex()===i)("data-id",o.id),e.R7$(2),e.JRh(o.displayName),e.R7$(),e.Y8G("ngClass",e.eq3(11,VP,i===a.selectedChapterIndex())),e.R7$(),e.Y8G("ngClass",e.l_i(13,xP,i<a.selectedChapterIndex(),a.selectedChapterIndex()===i)),e.R7$(),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("chapterId",o.id)("ngClass",e.eq3(16,FP,i<=a.selectedChapterIndex())),e.R7$(),e.vxM(8,0!==s?8:-1),e.R7$(),e.vxM(9,s!==r-1?9:-1)}}class Ou{constructor(t,o){this.viewService=t,this.store=o,this.chapters=(0,mn.ot)(this.store.select(fe.N.getStoryChapters)),this.selectedChapterIndex=(0,mn.ot)(this.store.select(fe.N.getSelectedChapterIndex)),this.scrollTop=0,(0,e.QZP)(()=>{this.scrollChapterIntoView(this.selectedChapterIndex())})}getTooltip(t,o){return $localize`${t+1} of ${this.chapters().length}\: ${o.displayName}`}handleChapterClick(t){this.viewService.selectChapter(t)}handleNextChapter(){this.viewService.nextChapter("Pagination")}handlePreviousChapter(){this.viewService.previousChapter("Pagination")}scrollChapterIntoView(t){const o=document.querySelector(`[data-test="viewChapterThumbnail"]:nth-child(${t+1})`);null!=o&&setTimeout(()=>{o.scrollIntoView({block:"nearest"})})}}(ul=Ou).\u0275fac=function(t){return new(t||ul)(e.rXU(hn),e.rXU(l.il))},ul.\u0275cmp=e.VBU({type:ul,selectors:[["app-view-chapter-list"]],decls:7,vars:5,consts:()=>{let n;return n=$localize`:2be2e0ec21a9620412d9a21102e7645fce9d9cc15659091765954160016:List of Chapters`,[["aria-label",n,"data-test","viewChapterList",1,"flex","flex-col","h-full"],[1,"flex","items-center","justify-center","flex-grow-0","py-5","transition-colors","border-b","border-transparent","border-solid","bg-gray-50",3,"ngClass"],[1,"shadow"],["buttonSize","2xsmall",3,"showCount"],[1,"flex-grow","overflow-x-hidden","overflow-y-auto","scroll-smooth",3,"appScrollListenerChange","appScrollListener"],["data-test","viewChapterThumbnail"],["matTooltipPosition","right","data-test","viewChapterListButton",1,"relative","flex","flex-col","items-center","justify-center","w-full","py-2","cursor-pointer","group","min-h-20","focus:outline-none",3,"click","matTooltip"],[1,"sr-only"],[1,"absolute","z-10","transition-all","bg-white","border-2","border-white","border-solid","rounded","w-14","h-14","outline","outline-2","outline-gray-200","group-hover:outline-gray-300","group-focus:outline-blue-600",3,"ngClass"],[1,"absolute","top-0","left-0","z-20","flex","items-center","justify-center","w-6","h-6","font-semibold","text-gray-600","transition-all","-translate-x-[15px]","-translate-y-[15px]","bg-white","border","border-2","border-white","border-solid","rounded","rounded-full","outline","outline-2","-outline-offset-4","outline-gray-200","group-hover:outline-gray-300","group-focus:outline-blue-600","text-2xs",3,"ngClass"],[1,"overflow-hidden","transition-opacity","rounded","opacity-50","group-hover:opacity-100","group-focus:opacity-100",3,"chapterId","ngClass"],[1,"w-[2px]","h-1/2","bg-gray-200","absolute","z-0","left-1/2","-translate-x-1","top-0"],[1,"w-[2px]","h-1/2","bg-gray-200","absolute","z-0","left-1/2","-translate-x-1","bottom-0"]]},template:function(t,o){1&t&&(e.j41(0,"nav",0)(1,"div",1)(2,"app-pillbox",2),e.nrm(3,"app-view-pagination",3),e.k0s()(),e.j41(4,"ol",4),e.mxI("appScrollListenerChange",function(s){return e.DH7(o.scrollTop,s)||(o.scrollTop=s),s}),e.Z7z(5,BP,10,18,"li",5,e.Vm6),e.k0s()()),2&t&&(e.R7$(),e.Y8G("ngClass",e.eq3(3,jP,o.scrollTop>0)),e.R7$(2),e.Y8G("showCount",!1),e.R7$(),e.R50("appScrollListener",o.scrollTop),e.R7$(),e.Dyx(o.chapters()))},dependencies:[q.YU,VS,On.oV,Do,md,os],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(fe.N.getSelectedChapterId),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Ou.prototype,"selectedChapterId$",void 0);var zP=_(1308),WP=_(30582),gl=_(9592),XP=_(97415);let HP=(()=>{var n;class t{constructor(i,s,r,a,d){this.store=i,this.cameraService=s,this.snapshotService=r,this.imagesService=a,this.contentBlocksService=d,this.startingPositionClipboard=null,this.additionalPositionClipboard=null,this.additionalPositionsClipboard=null}getCamera(){const i=this.cameraService.getCamera(),s=i.look,r=this.cameraService.getCameraRotationCenter();let a;return this.cameraService.compareXYZ(s,r)||(a=r),{location:i,rotationCenter:a}}getChapterStartingPosition(i){return{camera:this.store.selectSnapshot(fe.N.getChapter(i)).camera,thumbnail:this.store.selectSnapshot(to.K.getRegisteredThumbnails).get(i)}}startingPositionToAdditionalPosition(i){const{camera:s,thumbnail:r}=this.getChapterStartingPosition(i),{location:a,rotationCenter:d,title:f}=s;return{camera:{location:a,rotationCenter:d,action:T_.L.FlyTo},thumbnail:r,title:f}}copyStartingPosition(i){let s=!1;const{camera:r,thumbnail:a}=this.getChapterStartingPosition(i);return r&&a&&(this.startingPositionClipboard=(0,m.cloneDeep)({camera:r,thumbnail:a}),s=!0),s}pasteStartingPosition(i=!1){let s=0;if(this.startingPositionClipboard){const{camera:r,thumbnail:a}=this.startingPositionClipboard,d=i?this.store.selectSnapshot(fe.N.getStoryChapters):[this.store.selectSnapshot(fe.N.getSelectedChapter)];d.forEach(f=>{this.store.dispatch(new En.tn(f.id,r.location,r.rotationCenter)),this.store.dispatch(new En.pN(f.id,r.title)),this.store.dispatch(new no.cf(f.id,a))}),this.store.dispatch(new jt.Ih(r.location)),s=d.length}return this.clearStartingPosition(),s}clearStartingPosition(){this.startingPositionClipboard=null}copyAdditionalPosition(i){this.additionalPositionClipboard=(0,m.cloneDeep)(i)}clearAdditionalPosition(){this.additionalPositionClipboard=null}copyAdditionalPositions(i){this.additionalPositionsClipboard=(0,m.cloneDeep)(i)}pasteAdditionalPositions(i=!1){let s=0;if(this.additionalPositionsClipboard){const r=i?this.store.selectSnapshot(fe.N.getStoryChapters):[this.store.selectSnapshot(fe.N.getSelectedChapter)];r.forEach(a=>{let d=this.contentBlocksService.findContentBlockByType(a.contentBlocks,uo.m.Positions);d||(d=new vO,a.contentBlocks.push(d)),d.positions.push(...this.additionalPositionsClipboard),this.store.dispatch(new En.jo(a.id,[...a.contentBlocks],!1))}),s=r.length}return this.clearAdditionalPositions(),s}clearAdditionalPositions(){this.additionalPositionsClipboard=null}clearAllClipboards(){this.clearStartingPosition(),this.clearAdditionalPosition(),this.clearAdditionalPositions()}captureStartingPositionCamera(i){const s=this.getCamera();this.store.dispatch(new En.tn(i,s.location,s.rotationCenter))}captureStartingPositionThumbnail(i){const{background:s,imageType:r,imageQuality:a,dimensions:d,crop:f,includeLabels:T,includeCopyright:L,layers:ee}=this.getThumbnailSettings();this.store.dispatch(new no.V9(i,s,r,a,d,f,T,L,ee))}captureAdditionalPositionThumbnail(){var i=this;return(0,Ct.A)(function*(){const{background:s,imageType:r,imageQuality:a,dimensions:d,crop:f,includeLabels:T,includeCopyright:L,layers:ee}=i.getThumbnailSettings(),re={...zP._,crop:f,imageType:r,imageQuality:a,copyrightEnabled:L},ve=yield(0,Xp._)(i.snapshotService.takeSnapshot(d.width,d.height,s,ee,T,re)),Oe=yield(0,Xp._)(i.imagesService.saveImageBlob(ve));return{small:Oe.uris.small,large:Oe.uris.large}})()}getThumbnailSettings(){return{background:this.store.selectSnapshot(fe.N.getSelectedChapterBackground),imageType:gl.H.JPEG,imageQuality:92,dimensions:XP.I.medium,crop:"square",includeLabels:!1,includeCopyright:!1,layers:[]}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(co.j),e.KVO(WP.M),e.KVO(Vc),e.KVO(Wa.V))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();function QP(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"button",5),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handlePlayFromBeginning())}),e.nrm(2,"app-icon",6),e.j41(3,"span",7),e.pXf(4,1),e.k0s()(),e.nrm(5,"app-view-audio-mute",8),e.bVm()}}function YP(n,t){1&n&&(e.j41(0,"button",9)(1,"div",10),e.nrm(2,"app-spinner",11),e.j41(3,"span",7),e.pXf(4,2),e.k0s()()()),2&n&&e.Y8G("disabled",!0)}let KP=(()=>{var n;class t{constructor(i,s,r,a){this.viewService=i,this.mediaService=s,this.store=r,this.changeDetectorRef=a,this.hasAudioPlayer=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initChapterPlayer()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterPlayer(){this.store.select(fe.N.getSelectedChapter).pipe((0,Is.M)(()=>{this.hasAudioPlayer=!1,this.changeDetectorRef.markForCheck()}),(0,Zi.n)(i=>{const s=this.store.selectSnapshot(_e.getViewLanguage),r=this.store.selectSnapshot(_e.getForceAudio);return this.mediaService.getChapterAudioPlayer(i,s,r)}),(0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.hasAudioPlayer=!(0,m.isNil)(i),this.changeDetectorRef.markForCheck()})}handlePlayFromBeginning(){const i=this.store.selectSnapshot(fe.N.getSelectedChapterId);this.mediaService.playChapterAudio(i),this.viewService.playChapterFromStart()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(hn),e.rXU(Ci),e.rXU(l.il),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-audio-bar"]],decls:4,vars:2,consts:()=>{let o,i,s;return o=$localize`:5006279573e513c000899122cbef8e588b25faae2965090484617938475:play from beginning`,i=$localize`:81e8d1fd604d4f4e83ad3300e500ae3b35aa4be71494613406887362546:Play From Beginning`,s=$localize`:65026328a38cc4b6451777987b5dee29a779a10f3235113974618934655:Loading Audio`,[["loading",""],i,s,[1,"view-audio-bar"],[4,"ngIf","ngIfElse"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline","aria-label",o,"data-test","viewPlayFromBeginning",1,"view-audio-bar__play",3,"click"],["icon","rotate-left","aria-hidden","true"],[1,"ml-2","uppercase","text-2xs"],["buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"view-audio-bar__play",3,"disabled"],[1,"flex","justify-center","items-center"],["spinnerSize","small"]]},template:function(i,s){if(1&i&&(e.j41(0,"div",3),e.DNE(1,QP,6,0,"ng-container",4)(2,YP,5,1,"ng-template",null,0,e.C5r),e.k0s()),2&i){const r=e.sdS(3);e.R7$(),e.Y8G("ngIf",s.hasAudioPlayer)("ngIfElse",r)}},dependencies:[q.bT,rn,yt.R,Gs,dd],styles:[".view-audio-bar[_ngcontent-%COMP%]{display:flex;gap:12px}.view-audio-bar__play[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0}),t})();var hl,xS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},FS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function JP(n,t){if(1&n&&(e.j41(0,"section",1),e.nrm(1,"app-html",2),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("markdownText",o.chapterDescription)}}class fd{get isPopulated(){return this._isPopulated}set isPopulated(t){this._isPopulated=t,this.isPopulatedChange.emit(this.isPopulated)}constructor(){this.ngUnsubscribe=new Q.B,this.chapterDescription="",this._isPopulated=!1,this.isPopulatedChange=new e.bkB}ngOnInit(){this.initContentListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initContentListener(){(0,Ht.z)(this.story$,this.chapter$).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)&&!(0,m.isNil)(o)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{this.chapterDescription=(0,m.trim)(o.description),this.isPopulated=""!==this.chapterDescription})}}(hl=fd).\u0275fac=function(t){return new(t||hl)},hl.\u0275cmp=e.VBU({type:hl,selectors:[["app-view-description"]],inputs:{isPopulated:"isPopulated"},outputs:{isPopulatedChange:"isPopulatedChange"},decls:1,vars:1,consts:[["class","view-description",4,"ngIf"],[1,"view-description"],[3,"markdownText"]],template:function(t,o){1&t&&e.DNE(0,JP,2,1,"section",0),2&t&&e.Y8G("ngIf",o.chapterDescription)},dependencies:[q.bT,Zo],styles:[".view-description{font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word}\n"],encapsulation:2,changeDetection:0}),xS([(0,l.l6)(rt.getStory),FS("design:type",y.c)],fd.prototype,"story$",void 0),xS([(0,l.l6)(fe.N.getSelectedChapter),FS("design:type",y.c)],fd.prototype,"chapter$",void 0);var ml,GS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},$S=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const qP=n=>({"view-labels__item--selected":n}),ZP=n=>({"view-labels__content--shown":n});function eA(n,t){if(1&n&&(e.j41(0,"div",11),e.nrm(1,"div",12),e.nI1(2,"markdown"),e.nI1(3,"async"),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.Y8G("innerHTML",e.bMT(3,3,e.bMT(2,1,o.title)),e.npT)}}function tA(n,t){if(1&n&&(e.j41(0,"div",13)(1,"div",14),e.nrm(2,"app-icon",15),e.nI1(3,"async"),e.k0s()()),2&n){let o;const i=e.XpG().$implicit,s=e.XpG();e.R7$(2),e.Y8G("ngClass",(null==(o=e.bMT(3,1,s.selectedLabel$))?null:o.id)===i.id?"rotate-90":"rotate-0")}}function nA(n,t){if(1&n&&(e.j41(0,"div",19),e.nrm(1,"app-content-blocks",20),e.k0s()),2&n){const o=e.XpG(2).$implicit;e.R7$(),e.Y8G("contentBlocks",o.contentBlocks)}}function iA(n,t){if(1&n&&(e.j41(0,"div",16),e.nI1(1,"async"),e.nI1(2,"async"),e.nrm(3,"app-html",17),e.DNE(4,nA,2,1,"div",18),e.k0s()),2&n){let o,i;const s=e.XpG(),r=s.$implicit,a=s.index,d=e.XpG();e.Y8G("ngClass",e.eq3(9,ZP,(null==(o=e.bMT(1,5,d.selectedLabel$))?null:o.id)===r.id)),e.BMQ("aria-hidden",(null==(i=e.bMT(2,7,d.selectedLabel$))?null:i.id)!==r.id)("id","content-"+a),e.R7$(3),e.Y8G("markdownText",r.description),e.R7$(),e.Y8G("ngIf",(null==r.contentBlocks?null:r.contentBlocks.length)>0)}}function oA(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",3)(1,"button",4),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.handleLabelClick(s))}),e.j41(5,"span",5),e.pXf(6,0),e.k0s(),e.j41(7,"div",6),e.nrm(8,"app-label-pin",7),e.nI1(9,"async"),e.k0s(),e.DNE(10,eA,4,5,"div",8)(11,tA,4,3,"div",9),e.k0s(),e.DNE(12,iA,5,11,"div",10),e.k0s()}if(2&n){let o,i,s,r;const a=t.$implicit,d=t.index,f=e.XpG();e.R7$(),e.Y8G("ngClass",e.eq3(20,qP,(null==(o=e.bMT(2,12,f.selectedLabel$))?null:o.id)===a.id)),e.BMQ("aria-current",(null==(i=e.bMT(3,14,f.selectedLabel$))?null:i.id)===a.id)("aria-controls","label-list-content-"+d)("aria-expanded",(null==(s=e.bMT(4,16,f.selectedLabel$))?null:s.id)===a.id)("id","label-list-item-"+d),e.R7$(7),e.Y8G("showOnNone",!0)("selected",(null==(r=e.bMT(9,18,f.selectedLabel$))?null:r.id)===a.id)("label",a)("sequence",f.getLabelSequence(a)),e.R7$(2),e.Y8G("ngIf",a.title),e.R7$(),e.Y8G("ngIf",a.description||(null==a.contentBlocks?null:a.contentBlocks.length)>0),e.R7$(),e.Y8G("ngIf",a.description||(null==a.contentBlocks?null:a.contentBlocks.length)>0)}}class Sd{constructor(t,o){this.viewService=t,this.store=o,this.labelPinType=Ui.O,this.labelSequentialtype=ar.C}ngOnInit(){}getLabelSequence(t){return this.store.selectSnapshot(Ze.getLabelSequence(t))}handleLabelClick(t){const o=this.store.selectSnapshot(Ze.getSelectedLabel);t.id===o?.id?this.viewService.clearSelectedLabel():this.viewService.selectLabel(t,!0)}}function sA(n,t){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.JRh(o.description)}}function rA(n,t){if(1&n&&(e.j41(0,"li",2),e.nrm(1,"div",3),e.j41(2,"div",4)(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,sA,2,1,"div",5),e.k0s()()),2&n){const o=t.$implicit,i=e.XpG();e.R7$(),e.xc7("background-color",i.getComputedColor(o.colors)),e.R7$(3),e.JRh(o.label),e.R7$(),e.Y8G("ngIf",o.description)}}(ml=Sd).\u0275fac=function(t){return new(t||ml)(e.rXU(hn),e.rXU(l.il))},ml.\u0275cmp=e.VBU({type:ml,selectors:[["app-view-labels"]],decls:3,vars:3,consts:()=>{let n;return n=$localize`:e788aaf840ca6aea39b81480b735057823a73b532641792472434523020:Navigate to description for, `,[n,["data-test","viewLabelList",1,"view-labels"],["data-test","viewLabelListItem","class","view-labels__list-item",4,"ngFor","ngForOf"],["data-test","viewLabelListItem",1,"view-labels__list-item"],["data-test","viewLabelListButton",1,"view-labels__item",3,"click","ngClass"],[1,"sr-only"],[1,"view-labels__pin"],[1,"flex",3,"showOnNone","selected","label","sequence"],["class","view-labels__body",4,"ngIf"],["class","view-labels__expand","data-test","viewLabelsToggle",4,"ngIf"],["class","view-labels__content","data-test","viewLabelListContent",3,"ngClass",4,"ngIf"],[1,"view-labels__body"],[1,"view-labels__title","html",3,"innerHTML"],["data-test","viewLabelsToggle",1,"view-labels__expand"],["aria-hidden","true",1,"px-3"],["icon","angle-right",1,"transition-transform",3,"ngClass"],["data-test","viewLabelListContent",1,"view-labels__content",3,"ngClass"],["data-test","viewLabelListHtml",3,"markdownText"],["data-test","viewLabelListBlocks",4,"ngIf"],["data-test","viewLabelListBlocks"],[3,"contentBlocks"]]},template:function(t,o){1&t&&(e.j41(0,"ul",1),e.DNE(1,oA,13,22,"li",2),e.nI1(2,"async"),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,o.labels$)))},dependencies:[q.YU,q.Sq,q.bT,Nr,yt.R,Zo,eS,pi.i0,q.Jj],styles:[".view-labels__list-item{padding-bottom:8px}.view-labels__item{background:none;border:0;display:flex;padding:12px 0 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:left;align-items:center}.view-labels__item:focus{outline:#2d72dc solid 2px!important}.view-labels__item:hover,.view-labels__item--selected:hover{background-color:#131c2a0d}.view-labels__item--selected .view-labels__title{font-weight:600}.view-labels__pin{display:flex;align-items:center;justify-content:center;flex:0 0 18px;height:18px}.view-labels__body{flex:1 1 auto}.view-labels__expand{flex-grow:0;display:flex;justify-content:center;align-items:center;position:relative;font-size:14px}.view-labels__title{color:#131c2a;font-size:.875rem;line-height:1.25rem}.view-labels__label{position:absolute;font-size:10px;top:3px}.view-labels__content{display:none;padding:8px 0 12px 46px;font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word;color:#374a68}.view-labels__content--shown{display:block}\n"],encapsulation:2,changeDetection:0}),GS([(0,l.l6)(Ze.getChapterLabels),$S("design:type",y.c)],Sd.prototype,"labels$",void 0),GS([(0,l.l6)(Ze.getSelectedLabel),$S("design:type",y.c)],Sd.prototype,"selectedLabel$",void 0);let aA=(()=>{var n;class t{constructor(){}ngOnInit(){}getComputedColor(i){return uu.T.rgbToHex(i,!0)}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-legend"]],inputs:{legend:"legend"},decls:2,vars:1,consts:()=>{let o;return o=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,[["aria-label",o,"role","complementary",1,"view-legend"],["class","view-legend__item",4,"ngFor","ngForOf"],[1,"view-legend__item"],[1,"view-legend__color"],[1,"view-legend__content","text-sm"],["class","my-2",4,"ngIf"],[1,"my-2"]]},template:function(i,s){1&i&&(e.j41(0,"ul",0),e.DNE(1,rA,6,4,"li",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",s.legend))},dependencies:[q.Sq,q.bT],styles:['.view-legend{display:flex;flex-direction:column}.view-legend__item{padding:12px 12px 12px 16px;display:flex;gap:12px;flex-direction:row;justify-content:flex-start;align-items:flex-start}.view-legend__content{word-break:break-word;display:flex;flex-direction:column}.view-legend__color{border:2px solid white;outline:1px solid #96a8c0;content:" ";display:block;flex:0 0 18px;width:18px;height:18px;border-radius:50%}.view-legend__color:after{content:" "}\n'],encapsulation:2,changeDetection:0}),t})();var fl;function _A(n,t){if(1&n){const o=e.RV6();e.j41(0,"h2",0)(1,"button",2),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.togglePanel())}),e.j41(2,"div",3)(3,"span",4),e.EFF(4),e.k0s(),e.j41(5,"div",5),e.nrm(6,"app-icon",6),e.k0s()()()()}if(2&n){const o=e.XpG();e.R7$(),e.BMQ("aria-expanded",o.open())("aria-controls",o.panelId()),e.R7$(3),e.JRh(o.label()),e.R7$(2),e.Y8G("ngClass",o.open()?"rotate-90":"rotate-0")}}class Mu{constructor(t){this.store=t,this.panelId=e.hFB.required(),this.label=(0,e.hFB)(""),this.showHeader=(0,e.hFB)(!0),this.open=(0,e.geq)(!1),this.canToggle=(0,e.hFB)(!0)}ngOnInit(){this.canToggle()?this.open.set(this.store.selectSnapshot(_e.isOpenPanel(this.panelId()))):this.open.set(!0)}togglePanel(){const t=!this.open();this.open.set(t),this.panelId()&&this.store.dispatch(new D.TogglePanel(this.panelId(),t))}}(fl=Mu).\u0275fac=function(t){return new(t||fl)(e.rXU(l.il))},fl.\u0275cmp=e.VBU({type:fl,selectors:[["app-view-panel"]],inputs:{panelId:[e.Mj6.SignalBased,"panelId"],label:[e.Mj6.SignalBased,"label"],showHeader:[e.Mj6.SignalBased,"showHeader"],open:[e.Mj6.SignalBased,"open"],canToggle:[e.Mj6.SignalBased,"canToggle"]},outputs:{open:"openChange"},ngContentSelectors:["*"],decls:3,vars:2,consts:[[1,"-ml-1","text-sm","font-semibold"],[1,"transition-all",3,"ngClass"],["app-view-button","","buttonShape","rounded",1,"flex-grow","w-full","rounded","min-h-11",3,"click"],[1,"flex","justify-between","text-gray-900"],[1,"pl-1"],["aria-hidden","true",1,"px-3"],["icon","angle-right",1,"transition-transform",3,"ngClass"]],template:function(t,o){1&t&&(e.NAR(),e.DNE(0,_A,7,4,"h2",0),e.j41(1,"div",1),e.SdG(2),e.k0s()),2&t&&(e.vxM(0,o.showHeader()?0:-1),e.R7$(),e.Y8G("ngClass",o.open()?"pb-6":"h-0 overflow-hidden"))},dependencies:[rn,q.YU,yt.R],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(_e.isOpenPanel("labels")),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Mu.prototype,"labelsOpen",void 0);var Sl,ss=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},rs=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const pA=(n,t,o)=>[n,t,o];function uA(n,t){1&n&&e.nrm(0,"app-view-source-info",1),2&n&&e.Y8G("toggleable",!0)}function gA(n,t){1&n&&e.nrm(0,"app-view-audio-bar",11)}function hA(n,t){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-content-blocks",12),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",e.bMT(2,2,o.contentBlocks$))("include",o.contentBlockTypes.Ticker)}}function mA(n,t){if(1&n&&(e.j41(0,"div",13),e.nrm(1,"app-content-blocks",12),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",e.bMT(2,2,o.contentBlocks$))("include",e.sMw(4,pA,o.contentBlockTypes.Markdown,o.contentBlockTypes.Images,o.contentBlockTypes.Videos))}}function fA(n,t){if(1&n){const o=e.RV6();e.j41(0,"app-view-panel",6),e.DNE(1,gA,1,0,"app-view-audio-bar",7),e.nI1(2,"async"),e.DNE(3,hA,3,4,"div",8),e.nI1(4,"async"),e.j41(5,"app-view-description",9),e.mxI("isPopulatedChange",function(s){e.eBV(o);const r=e.XpG();return e.DH7(r.isPopulated,s)||(r.isPopulated=s),e.Njj(s)}),e.k0s(),e.DNE(6,mA,3,8,"div",10),e.nI1(7,"async"),e.k0s()}if(2&n){let o,i;const s=e.XpG();e.Y8G("showHeader",!1)("canToggle",!1)("hidden",!s.isPopulated),e.R7$(),e.Y8G("ngIf",e.bMT(2,7,s.audioVisible$)),e.R7$(2),e.Y8G("ngIf",(null==(o=e.bMT(4,9,s.contentBlocks$))?null:o.length)>0),e.R7$(2),e.R50("isPopulated",s.isPopulated),e.R7$(),e.Y8G("ngIf",(null==(i=e.bMT(7,11,s.contentBlocks$))?null:i.length)>0)}}function SA(n,t){if(1&n&&(e.j41(0,"app-view-panel",14),e.nrm(1,"app-view-legend",15),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("legend",e.bMT(2,1,o.chapter$).legend)}}function bA(n,t){1&n&&(e.j41(0,"app-view-panel",16),e.nrm(1,"app-view-labels"),e.k0s())}function yA(n,t){if(1&n&&(e.j41(0,"app-view-panel",17),e.nrm(1,"app-content-blocks",18),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("contentBlocks",e.bMT(2,1,o.positionBlocks$))}}class qi{constructor(t,o,i){this.store=t,this.contentBlocksService=o,this.positionsService=i,this.contentTypes=ye.c,this.layout=(0,e.hFB)(),this.ngUnsubscribe=new Q.B,this.isPopulated=!0,this.contentBlockTypes=uo.m}ngOnInit(){this.positionBlocks$=this.contentBlocks$.pipe((0,Cn.Z)(t=>{let o=this.contentBlocksService.filterContentBlocksByType(t,[uo.m.Positions]);return o.length>0&&(o=this.insertStartingPosition(o)),(0,Rt.of)(o)}),(0,b.Q)(this.ngUnsubscribe))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}insertStartingPosition(t){return(t=(0,m.cloneDeep)(t))[0].positions.unshift(this.positionsService.startingPositionToAdditionalPosition(this.store.selectSnapshot(fe.N.getSelectedChapterId))),t}}(Sl=qi).\u0275fac=function(t){return new(t||Sl)(e.rXU(l.il),e.rXU(Wa.V),e.rXU(HP))},Sl.\u0275cmp=e.VBU({type:Sl,selectors:[["app-view-content-mode"]],inputs:{layout:[e.Mj6.SignalBased,"layout"]},decls:13,vars:19,consts:()=>{let n,t,o;return n=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,t=$localize`:2af7efecfae8d7fed3b07f718a623eca1ad8163f546766753072101168:Labels`,o=$localize`:7acfeb6214be6d5b9c6ca7285d689dd1402ca446529261375582544700:Positions`,[["data-test","viewContentMode",1,"view-content-mode"],[1,"block","mb-4",3,"toggleable"],["panelId","description","aria-describedby","view-title",3,"showHeader","canToggle","hidden",4,"ngIf"],["panelId","legend","label",n,4,"ngIf"],["label",t,"panelId","labels",4,"ngIf"],["label",o,"panelId","positions",4,"ngIf"],["panelId","description","aria-describedby","view-title",3,"showHeader","canToggle","hidden"],["class","block mb-4",4,"ngIf"],[4,"ngIf"],[3,"isPopulatedChange","isPopulated"],["class","mt-5",4,"ngIf"],[1,"block","mb-4"],[3,"contentBlocks","include"],[1,"mt-5"],["panelId","legend","label",n],[3,"legend"],["label",t,"panelId","labels"],["label",o,"panelId","positions"],[3,"contentBlocks"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",0),e.DNE(1,uA,1,1,"app-view-source-info",1)(2,fA,8,13,"app-view-panel",2),e.nI1(3,"async"),e.DNE(4,SA,3,3,"app-view-panel",3),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async"),e.DNE(8,bA,2,0,"app-view-panel",4),e.nI1(9,"async"),e.nI1(10,"async"),e.DNE(11,yA,3,3,"app-view-panel",5),e.nI1(12,"async"),e.k0s()),2&t){let i,s;e.R7$(),e.vxM(1,"drawer"===o.layout()?1:-1),e.R7$(),e.Y8G("ngIf",e.bMT(3,5,o.descriptionVisible$)),e.R7$(2),e.Y8G("ngIf",(null==(i=e.bMT(5,7,o.chapter$))?null:i.legend)&&(null==(i=e.bMT(6,9,o.chapter$))?null:i.legend.length)>0&&e.bMT(7,11,o.legendVisible$)),e.R7$(4),e.Y8G("ngIf",(null==(s=e.bMT(9,13,o.labels$))?null:s.length)&&e.bMT(10,15,o.labelListVisible$)),e.R7$(3),e.Y8G("ngIf",e.bMT(12,17,o.positionBlocks$).length>0)}},dependencies:[q.bT,Nr,KP,ud,fd,Sd,aA,Mu,q.Jj],styles:[".view-content-mode[_ngcontent-%COMP%]{padding-bottom:24px}"],changeDetection:0}),ss([(0,l.l6)(fe.N.getStoryChapters),rs("design:type",y.c)],qi.prototype,"chapters$",void 0),ss([(0,l.l6)(fe.N.getSelectedChapter),rs("design:type",y.c)],qi.prototype,"chapter$",void 0),ss([(0,l.l6)(fe.N.getSelectedChapterContentBlocks),rs("design:type",y.c)],qi.prototype,"contentBlocks$",void 0),ss([(0,l.l6)(Ze.getChapterLabels),rs("design:type",y.c)],qi.prototype,"labels$",void 0),ss([(0,l.l6)(Be.getVisible(G.Description)),rs("design:type",y.c)],qi.prototype,"descriptionVisible$",void 0),ss([(0,l.l6)(Be.getVisible(G.LabelList)),rs("design:type",y.c)],qi.prototype,"labelListVisible$",void 0),ss([(0,l.l6)(Be.getVisible(G.Legend)),rs("design:type",y.c)],qi.prototype,"legendVisible$",void 0),ss([(0,l.l6)(Be.getVisible(G.Audio)),rs("design:type",y.c)],qi.prototype,"audioVisible$",void 0);var bl,xr=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Fr=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const vA=(n,t)=>({"view-title--center":n,"view-title--ellipsis":t}),EA=(n,t)=>({"text-md":n,"text-lg":t});function CA(n,t){if(1&n&&e.nrm(0,"h2",4),2&n){const o=e.XpG();e.Y8G("innerHTML",o.htmlMetaTitle,e.npT)}}function TA(n,t){if(1&n&&e.nrm(0,"h2",5),2&n){const o=e.XpG();e.Y8G("innerHTML",o.htmlSubTitle,e.npT)}}class mo{get style(){return this.sanitizer.bypassSecurityTrustStyle(this.useEllipsis?"overflow: hidden; display: flex; width: 100%;":"")}get mainTitle(){return this._mainTitle}set mainTitle(t){this._mainTitle=t,this.handleMarkdownTextUpdate(t,"htmlMainTitle")}get metaTitle(){return this._metaTitle}set metaTitle(t){this._metaTitle=t,this.handleMarkdownTextUpdate(t,"htmlMetaTitle")}get subTitle(){return this._subTitle}set subTitle(t){this._subTitle=t,this.handleMarkdownTextUpdate(t,"htmlSubTitle")}constructor(t,o,i,s,r){this.viewUIService=t,this.changeDetectorRef=o,this.sanitizer=i,this.markdownService=s,this.store=r,this.useEllipsis=!1,this.includePagination=!1,this.size="md",this._mainTitle="",this._metaTitle="",this.showMetaTitle=!0,this._subTitle="",this.showSubTitle=!0,this.align="left",this.viewLayout=G,this.ngUnsubscribe=new Q.B}ngOnInit(){"chapter"===this.dynamicTitle?this.initDynamicChapterListener():"quiz"===this.dynamicTitle&&this.initDynamicQuizListener(),this.initLayoutListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}isEnabled(t){return this.viewUIService.isUIEnabled(t)}initDynamicChapterListener(){(0,Ht.z)([this.story$,this.chapter$,this.pagination$]).pipe((0,S.p)(([t,o])=>null!=o&&null!=t),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{const s=ro.l.normalize(t.displayName),r=o.displayName?ro.l.normalize(o.displayName):$localize`Chapter`+` ${i.index+1}`;I.c.application===Wn.c.Studio&&(this.metaTitle=s!==r?s:""),this.mainTitle=r,this.subTitle=this.includePagination?i?.label:""})}initDynamicQuizListener(){this.activeQuestionIndex$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(Ue.j.getQuizSettings),i=this.store.selectSnapshot(Ue.j.getLifecycle);if(o.showProgress&&i!==Po.h.Review){const s=$localize`Question ${t+1}`,r=$localize` of ${this.store.selectSnapshot(Ue.j.getQuestionTotal)}`;this.mainTitle=`${s}<span class="font-normal">${r}</span>`}else this.mainTitle=$localize`Quiz`})}initLayoutListener(){this.viewUI$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.changeDetectorRef.markForCheck()})}handleMarkdownTextUpdate(t,o){var i=this;return(0,Ct.A)(function*(){const s=yield i.markdownService.parse(t);i[o]=i.sanitizer.bypassSecurityTrustHtml(s||""),i.changeDetectorRef.markForCheck()})()}}(bl=mo).\u0275fac=function(t){return new(t||bl)(e.rXU(Fc),e.rXU(e.gRc),e.rXU(c.up),e.rXU(pi.Rl),e.rXU(l.il))},bl.\u0275cmp=e.VBU({type:bl,selectors:[["app-view-title"]],hostVars:2,hostBindings:function(t,o){2&t&&e.Aen(o.style)},inputs:{useEllipsis:"useEllipsis",includePagination:"includePagination",dynamicTitle:"dynamicTitle",size:"size",mainTitle:"mainTitle",metaTitle:"metaTitle",showMetaTitle:"showMetaTitle",subTitle:"subTitle",showSubTitle:"showSubTitle",align:"align"},decls:4,vars:11,consts:[[1,"view-title",3,"ngClass"],["id","view-title-meta","class","view-title__meta",3,"innerHTML",4,"ngIf"],["id","view-title","tabindex","0",1,"view-title__main",3,"ngClass","innerHTML"],["class","view-title__sub","id","view-title-sub",3,"innerHTML",4,"ngIf"],["id","view-title-meta",1,"view-title__meta",3,"innerHTML"],["id","view-title-sub",1,"view-title__sub",3,"innerHTML"]],template:function(t,o){1&t&&(e.j41(0,"section",0),e.DNE(1,CA,1,1,"h2",1),e.nrm(2,"h1",2),e.DNE(3,TA,1,1,"h2",3),e.k0s()),2&t&&(e.Y8G("ngClass",e.l_i(5,vA,"center"===o.align,o.useEllipsis)),e.R7$(),e.Y8G("ngIf",o.metaTitle.length>0&&o.showMetaTitle),e.R7$(),e.Y8G("ngClass",e.l_i(8,EA,"md"===o.size,"lg"===o.size))("innerHTML",o.htmlMainTitle,e.npT),e.R7$(),e.Y8G("ngIf",o.showSubTitle))},dependencies:[q.YU,q.bT],styles:["[_nghost-%COMP%]{display:flex}.view-title[_ngcontent-%COMP%]{overflow-wrap:break-word;color:#131c2a;border-radius:4px;transition:background-color 125ms;flex:1 1 0;display:flex;flex-direction:column;align-items:flex-start}.view-title--ellipsis[_ngcontent-%COMP%]{width:0}.view-title--ellipsis[_ngcontent-%COMP%]   .view-title__meta[_ngcontent-%COMP%], .view-title--ellipsis[_ngcontent-%COMP%]   .view-title__main[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.view-title--center[_ngcontent-%COMP%]{justify-content:center}.view-title__meta[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;font-weight:400;color:#374a68;overflow-wrap:anywhere;margin-bottom:4px}.view-title__main[_ngcontent-%COMP%]{color:#131c2a;text-align:start;font-weight:600;overflow-wrap:anywhere}.view-title__sub[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;margin-top:4px;color:#374a68;font-weight:400}.view-title[_ngcontent-%COMP%]:hover   .view-title__count[_ngcontent-%COMP%]{display:none}.view-title[_ngcontent-%COMP%]:hover   .view-title__show[_ngcontent-%COMP%]{display:block}.view-title__show[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),xr([(0,l.l6)(rt.getStory),Fr("design:type",y.c)],mo.prototype,"story$",void 0),xr([(0,l.l6)(fe.N.getSelectedChapter),Fr("design:type",y.c)],mo.prototype,"chapter$",void 0),xr([(0,l.l6)(fe.N.getChapterPagination),Fr("design:type",y.c)],mo.prototype,"pagination$",void 0),xr([(0,l.l6)(Be.getUI),Fr("design:type",y.c)],mo.prototype,"viewUI$",void 0),xr([(0,l.l6)(Be.getVisible(G.Pagination)),Fr("design:type",y.c)],mo.prototype,"paginationVisible$",void 0),xr([(0,l.l6)(Ue.j.getActiveQuestionIndex),Fr("design:type",y.c)],mo.prototype,"activeQuestionIndex$",void 0);let BS=(()=>{var n;class t{constructor(i,s){this.store=i,this.el=s,this.appInfoScroll=!0,this.ngUnsubscribe=new Q.B}ngOnInit(){this.store.selectSnapshot(Ue.j.hasQuiz)&&this.handleQuizScrolling(),this.handleChapterScrolling()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterScrolling(){this.store.select(fe.N.getSelectedChapterId).pipe((0,S.p)(()=>this.appInfoScroll),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()})}handleQuizScrolling(){const i=this.store.select(Ue.j.getQuizModeActive),s=this.store.select(Ue.j.getLifecycle);i.pipe((0,S.p)(()=>this.appInfoScroll),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()}),s.pipe((0,S.p)(()=>this.appInfoScroll),(0,b.Q)(this.ngUnsubscribe)).subscribe(r=>{r===Po.h.Explanation?setTimeout(()=>this.scrollToBottom()):this.scrollToTop()})}scrollToTop(){this.el.nativeElement.scrollTo({top:0})}scrollToBottom(){this.el.nativeElement.scrollTo({top:this.el.nativeElement.scrollHeight,behavior:"smooth"})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(e.aKT))},n.\u0275dir=e.FsC({type:n,selectors:[["","appInfoScroll",""]],inputs:{appInfoScroll:"appInfoScroll"}}),t})();const OA=[[["","header",""]],[["","body",""]],[["","aside",""]]],MA=["[header]","[body]","[aside]"],IA=(n,t)=>({"view-column--padded":n,"view-column--show-aside":t}),wA=n=>({"!border-gray-200":n});function PA(n,t){1&n&&(e.j41(0,"div",4),e.SdG(1,2),e.k0s())}let bd="-100%";const AA=(0,Le.lY)([(0,Le.iF)({transform:"translateX({{ translateX }})"}),(0,Le.i0)("150ms ease-in-out",(0,Le.iF)({transform:"*"}))],{params:{translateX:bd}}),NA=(0,Le.lY)([(0,Le.i0)("150ms ease-in-out",(0,Le.iF)({transform:"translateX({{ translateX }})"}))],{params:{translateX:bd}});let zS=(()=>{var n;class t{get show(){return{value:this.floating(),params:{translateX:bd}}}constructor(i,s,r){this.el=i,this.store=s,this.localeId=r,this.animationsDisabled=this.store.selectSnapshot(Jo.U.getPrefersReducedMotion),this.contentMode=(0,mn.ot)(this.store.select(_e.getContentMode)),this.animated=(0,e.hFB)(!1),this.padded=(0,e.hFB)(!0),this.wide=(0,e.hFB)(!1),this.floating=(0,e.hFB)(!1),this.showFooter=(0,e.hFB)(!1),this.showAside=(0,e.hFB)(!1),this.footerLabel=(0,e.hFB)(""),this.viewContentMode=Ft,this.footerExpanded=!1,this.scrollTop=0,"rtl"===(0,bn.NS)(this.localeId).direction&&(bd="100%"),(0,e.QZP)(()=>{this.floating()&&this.el.nativeElement.classList.add("!absolute","z-50","top-0","start-0","bottom-0")}),(0,e.QZP)(()=>{const a=this.wide()?"424px":"320px";this.el.nativeElement.style.setProperty("--column-width",a)})}handleToggleFooter(i){this.footerExpanded=i}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.aKT),e.rXU(l.il),e.rXU(e.xe9))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-column"]],hostVars:2,hostBindings:function(i,s){2&i&&e.zvX("@show",s.show)("@.disabled",s.animationsDisabled)},inputs:{animated:[e.Mj6.SignalBased,"animated"],padded:[e.Mj6.SignalBased,"padded"],wide:[e.Mj6.SignalBased,"wide"],floating:[e.Mj6.SignalBased,"floating"],showFooter:[e.Mj6.SignalBased,"showFooter"],showAside:[e.Mj6.SignalBased,"showAside"],footerLabel:[e.Mj6.SignalBased,"footerLabel"]},ngContentSelectors:MA,decls:6,vars:10,consts:[["data-test","viewColumn",1,"view-column",3,"ngClass"],[1,"border-b","border-transparent","border-solid","view-column__header",3,"ngClass"],[1,"view-column__body",3,"appScrollListenerChange","appScrollListener","appInfoScroll"],["class","view-column__aside",4,"ngIf"],[1,"view-column__aside"]],template:function(i,s){1&i&&(e.NAR(OA),e.j41(0,"div",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.mxI("appScrollListenerChange",function(a){return e.DH7(s.scrollTop,a)||(s.scrollTop=a),a}),e.SdG(4,1),e.k0s(),e.DNE(5,PA,2,0,"div",3),e.k0s()),2&i&&(e.Y8G("ngClass",e.l_i(5,IA,s.padded(),s.showAside())),e.R7$(),e.Y8G("ngClass",e.eq3(8,wA,s.scrollTop>0||s.floating())),e.R7$(2),e.R50("appScrollListener",s.scrollTop),e.Y8G("appInfoScroll",s.contentMode()===s.viewContentMode.ChapterInfo||s.contentMode()===s.viewContentMode.Quiz),e.R7$(2),e.Y8G("ngIf",s.showAside()))},dependencies:[q.YU,q.bT,BS,VS],styles:['[_nghost-%COMP%]{--column-width: 320px;position:relative;width:var(--column-width);max-width:100vw}.view-column[_ngcontent-%COMP%]{background-color:#fff;border-right:1px solid #d7e0ea;height:100%;display:grid;grid-template-areas:"header" "content" "footer";grid-template-columns:auto;grid-template-rows:auto 1fr}.view-column--padded[_ngcontent-%COMP%]   .view-column__header[_ngcontent-%COMP%]{padding:20px 24px 12px}.view-column--padded[_ngcontent-%COMP%]   .view-column__body[_ngcontent-%COMP%]{padding:12px 24px 20px}.view-column--padded[_ngcontent-%COMP%]   .view-column__footer-content[_ngcontent-%COMP%]{padding:4px 24px 24px 12px}.view-column--show-aside[_ngcontent-%COMP%]{grid-template-areas:"aside header" "aside content" "aside footer";grid-template-columns:104px 320px}.view-column__aside[_ngcontent-%COMP%]{background-color:#f9fafd;grid-area:aside;border-right:1px solid #d7e0ea}.view-column__aside[_ngcontent-%COMP%]:empty{display:none}.view-column__header[_ngcontent-%COMP%]{grid-area:header}.view-column__body[_ngcontent-%COMP%]{grid-area:content;overflow:auto}.view-column__footer[_ngcontent-%COMP%]{grid-area:footer;border:1px solid #d7e0ea;display:flex;flex-direction:column}.view-column__footer-toggle[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:16px 12px;color:#131c2a;font-size:.875rem;line-height:1.25rem;font-weight:600;text-transform:uppercase}.view-column__footer-content-wrapper[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:all .5s}.view-column__footer-content-wrapper--expanded[_ngcontent-%COMP%]{overflow:auto;max-height:40vh}'],data:{animation:[(0,Le.hZ)("show",[(0,Le.kY)(":enter",(0,Le.sM)(AA)),(0,Le.kY)(":leave",(0,Le.sM)(NA))])]},changeDetection:0}),t})();var yl,WS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},XS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class yd{constructor(){}ngOnInit(){}}(yl=yd).\u0275fac=function(t){return new(t||yl)},yl.\u0275cmp=e.VBU({type:yl,selectors:[["app-view-column-chapter-header"]],decls:3,vars:3,consts:[["data-test","viewColumnHeader",1,"view-column-chapter-header"],[1,"view-column-chapter-header__title"],["size","lg",3,"dynamicTitle","showMetaTitle","showSubTitle"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-view-title",2),e.k0s()()),2&t&&(e.R7$(2),e.Y8G("dynamicTitle","chapter")("showMetaTitle",!1)("showSubTitle",!1))},dependencies:[mo],styles:[".view-column-chapter-header[_ngcontent-%COMP%]{min-height:32px;display:flex;align-items:center}.view-column-chapter-header__title[_ngcontent-%COMP%]{flex-grow:1;padding-right:12px}.view-column-chapter-header__pagination[_ngcontent-%COMP%]{align-self:flex-start}"],changeDetection:0}),WS([(0,l.l6)(fe.N.getChapterCount),XS("design:type",y.c)],yd.prototype,"chapterCount$",void 0),WS([(0,l.l6)(Be.getVisible(G.Pagination)),XS("design:type",y.c)],yd.prototype,"paginationVisible$",void 0);var vl,HS=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},QS=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const RA=["sourceInformation"];function DA(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-title",9),e.bVm()),2&n&&(e.R7$(),e.Y8G("dynamicTitle","quiz")("showMetaTitle",!1)("showSubTitle",!1))}function kA(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-column-chapter-header")(2,"app-view-source-info-toggle"),e.bVm())}function LA(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-content-mode"),e.bVm())}function UA(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-quiz",10),e.bVm())}class vd{constructor(t,o){this.store=t,this.popupService=o,this.contentMode=(0,mn.ot)(this.store.select(_e.getContentMode)),this.paginationVisible=(0,mn.ot)(this.store.select(Be.getVisible(G.Pagination))),this.viewContentMode=Ft}toggleSourceInformation(){this.popupService.open({origin:this.sourceInformationEl.nativeElement,content:ud}).afterClosed$.subscribe()}}(vl=vd).\u0275fac=function(t){return new(t||vl)(e.rXU(l.il),e.rXU(wS))},vl.\u0275cmp=e.VBU({type:vl,selectors:[["app-view-column-container"]],viewQuery:function(t,o){if(1&t&&e.GBs(RA,5),2&t){let i;e.mGM(i=e.lsd())&&(o.sourceInformationEl=i.first)}},decls:11,vars:8,consts:()=>{let n;return n=$localize`:459baf5634e45a7173e4f0e1920265af97fce630801176277231880295:Chapter Description`,[["data-test","viewColumnContainer","role","region","aria-label",n,3,"padded","showAside"],["aside",""],[1,"block","h-full"],["header",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["body",""],[4,"ngIf"],[3,"dynamicTitle","showMetaTitle","showSubTitle"],["mode","column"]]},template:function(t,o){1&t&&(e.j41(0,"app-view-column",0),e.qex(1,1),e.nrm(2,"app-view-chapter-list",2),e.bVm(),e.qex(3,3)(4,4),e.nI1(5,"async"),e.DNE(6,DA,2,3,"ng-container",5)(7,kA,3,0,"ng-container",6),e.bVm()(),e.qex(8,7),e.DNE(9,LA,2,0,"ng-container",8)(10,UA,2,0,"ng-container",8),e.bVm(),e.k0s()),2&t&&(e.Y8G("padded",o.contentMode()!==o.viewContentMode.Search)("showAside",o.paginationVisible()),e.R7$(4),e.Y8G("ngSwitch",e.bMT(5,6,o.contentMode$)),e.R7$(2),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(3),e.Y8G("ngIf",o.contentMode()===o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngIf",o.contentMode()===o.viewContentMode.Quiz))},dependencies:[q.bT,q.ux,q.e1,q.fG,Mi,jS,Ou,qi,mo,zS,yd,q.Jj],styles:["[_nghost-%COMP%]{position:relative;height:100%}.view-column-container[_ngcontent-%COMP%]{height:100%}.view-column-container--hide-tabs[_ngcontent-%COMP%]   .view-column-container__tabs[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),HS([(0,l.l6)(_e.getContentMode),QS("design:type",y.c)],vd.prototype,"contentMode$",void 0),HS([(0,l.l6)(Be.getVisible(G.Pagination)),QS("design:type",y.c)],vd.prototype,"paginationVisible$",void 0);const jA=(n,t)=>({"rotate-180":n,"rotate-0":t});let VA=(()=>{var n;class t{constructor(i,s,r){this.viewService=i,this.store=s,this.directionality=r,this.chapter=(0,mn.ot)(this.store.select(fe.N.getSelectedChapter)),this.viewUI=(0,mn.ot)(this.store.select(Be.getUI)),this.isOut=(0,e.EWP)(()=>!(0,m.isNil)(this.chapter())&&this.viewUI().column.status!==at.Collapse),this.tooltipText=(0,e.EWP)(()=>this.isOut()?$localize`Close Info Panel`:$localize`Open Info Panel`),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleToggle(){const i=this.store.selectSnapshot(_e.getContentMode);this.viewService.toggleColumn(),this.viewService.toggleSearch(null,!1),i===Ft.NodeInfo&&this.viewService.toggleNodeInfo(!1),i===Ft.LabelInfo&&this.viewService.toggleLabelInfo(!1)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(hn),e.rXU(l.il),e.rXU(qo.dS))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-column-toggle"]],decls:3,vars:8,consts:[["orientation","vertical","appPreventFadeout",""],["app-view-button","","buttonSize","small","data-test","viewColumnToggle",3,"click","matTooltip","matTooltipPosition"],["appLogicalDir","","size","lg","icon","angles-left",1,"rotate--animate",3,"ngClass"]],template:function(i,s){1&i&&(e.j41(0,"app-pillbox",0)(1,"button",1),e.bIt("click",function(){return s.handleToggle()}),e.nrm(2,"app-icon",2),e.k0s()()),2&i&&(e.R7$(),e.Y8G("matTooltip",s.tooltipText())("matTooltipPosition",s.tooltipPosition),e.BMQ("aria-label",s.tooltipText())("aria-expanded",s.isOut()),e.R7$(),e.Y8G("ngClass",e.l_i(5,jA,!s.isOut(),s.isOut())))},dependencies:[rn,q.YU,Us,$i.e,yt.R,On.oV,Do],encapsulation:2,data:{animation:[(0,Le.hZ)("show",[(0,Le.kY)(":enter",[(0,Le.iF)({opacity:0,transform:"translateX(-32px)"}),(0,Le.i0)("300ms ease-in-out",(0,Le.iF)({opacity:1,transform:"*"}))]),(0,Le.kY)(":leave",[(0,Le.i0)("300ms ease-in-out",(0,Le.iF)({transform:"translateX(-32px)",opacity:0}))])])]},changeDetection:0}),t})();var Gr;!function(n){n.slideTransition=(0,Le.lY)([(0,Le.iF)({transform:"translateY({{ from }}%)",opacity:0}),(0,Le.i0)("{{ duration }}ms ease-out",(0,Le.iF)({transform:"translateY({{ to }})",opacity:1}))]),n.fadeIn=(0,Le.lY)([(0,Le.iF)({opacity:0}),(0,Le.i0)("{{ duration }}ms ease-out",(0,Le.iF)({opacity:1}))]),n.fadeOut=(0,Le.lY)([(0,Le.iF)({opacity:"*"}),(0,Le.i0)("{{ duration }}ms ease-in",(0,Le.iF)({opacity:0}))])}(Gr||(Gr={}));const xA=["*"];function FA(n,t){if(1&n&&(e.j41(0,"div",7),e.nrm(1,"app-icon",8),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("icon",o.icon)}}function GA(n,t){if(1&n&&(e.j41(0,"h3",9),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.JRh(o.title)}}function $A(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleDismissClicked())}),e.nrm(1,"app-icon",11),e.k0s()}}function BA(n,t){if(1&n&&(e.j41(0,"div",1)(1,"div",2),e.DNE(2,FA,2,1,"div",3),e.j41(3,"div",4),e.DNE(4,GA,2,1,"h3",5),e.j41(5,"p"),e.SdG(6),e.k0s()()(),e.DNE(7,$A,2,0,"button",6),e.k0s()),2&n){const o=e.XpG();e.AVh("message-toggle--message","message"===o.type)("message-toggle--error","error"===o.type)("message-toggle--danger","danger"===o.type)("message-toggle--notification","notification"===o.type)("message-toggle--warning","warning"===o.type)("message-toggle--rounded","rounded"===o.toggleStyle)("message-toggle--light","light"===o.theme)("message-toggle--dark","dark"===o.theme)("message-toggle--left","left"===o.toggleAlign)("message-toggle--center","center"===o.toggleAlign)("message-toggle--icon-top","top"===o.alignIcon)("message-toggle--icon-center","center"===o.alignIcon)("message-toggle--icon-bottom","bottom"===o.alignIcon),e.Y8G("@show",void 0),e.R7$(2),e.Y8G("ngIf",o.icon),e.R7$(2),e.Y8G("ngIf",o.title),e.R7$(3),e.Y8G("ngIf",o.dismiss)}}let Ed=(()=>{var n;class t{get shown(){return this._shown}set shown(i){this._shown!==i&&(this._shown=i,this.shownSubject.next(i),this.changeRef.markForCheck())}constructor(i){this.changeRef=i,this.type="message",this.theme="light",this.toggleAlign="left",this.alignIcon="top",this.showDelay=0,this.hideDelay=5e3,this.dismiss=!1,this.toggleStyle="rounded",this.handleDismiss=new Q.B,this._shown=!0,this.shownSubject=new Q.B,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initViewShownListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismissClicked(){this.handleDismiss.next()}initViewShownListeners(){this.shownSubject.pipe((0,S.p)(()=>this.hideDelay>0),(0,Fn.B)(this.hideDelay),(0,S.p)(i=>i),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this._shown=!1,this.changeRef.markForCheck()})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-message-toggle"]],inputs:{type:"type",theme:"theme",toggleAlign:"toggleAlign",icon:"icon",alignIcon:"alignIcon",title:"title",showDelay:"showDelay",hideDelay:"hideDelay",dismiss:"dismiss",toggleStyle:"toggleStyle",shown:"shown"},outputs:{handleDismiss:"handleDismiss"},ngContentSelectors:xA,decls:1,vars:1,consts:[["class","message-toggle flex flex-row items-start justify-between",3,"message-toggle--message","message-toggle--error","message-toggle--danger","message-toggle--notification","message-toggle--warning","message-toggle--rounded","message-toggle--light","message-toggle--dark","message-toggle--left","message-toggle--center","message-toggle--icon-top","message-toggle--icon-center","message-toggle--icon-bottom",4,"ngIf"],[1,"message-toggle","flex","flex-row","items-start","justify-between"],[1,"message-toggle__wrapper","flex","flex-row","flex-auto"],["class","message-toggle__icon mr-3",4,"ngIf"],[1,"message-toggle__content"],["class","font-semibold mb-1",4,"ngIf"],["class","message-toggle__icon message-toggle__dismiss",3,"click",4,"ngIf"],[1,"message-toggle__icon","mr-3"],[3,"icon"],[1,"font-semibold","mb-1"],[1,"message-toggle__icon","message-toggle__dismiss",3,"click"],["icon","times"]],template:function(i,s){1&i&&(e.NAR(),e.DNE(0,BA,8,30,"div",0)),2&i&&e.Y8G("ngIf",s.shown)},dependencies:[q.bT,yt.R],styles:[":root{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle{padding:16px;box-sizing:border-box;font-size:13px;line-height:20px;color:var(--message-toggle-color);background-color:var(--message-toggle-background-color)}.message-toggle--rounded{border-radius:4px}.message-toggle__icon{color:#fff;font-size:16px;background:none;border:none;color:var(--message-toggle-icon-color)}.message-toggle__content{padding:0 2px;word-break:break-word}.message-toggle__dismiss{font-size:14px;color:var(--message-toggle-color);cursor:pointer}.message-toggle--left .message-toggle__content{flex:1 1 auto}.message-toggle--center .message-toggle__wrapper{justify-content:center}.message-toggle--icon-top .message-toggle__icon{align-self:flex-start}.message-toggle--icon-center .message-toggle__icon{align-self:center}.message-toggle--icon-bottom .message-toggle__icon{align-self:flex-end}.message-toggle.message-toggle--message{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0fff0;--message-toggle-icon-color: #33cd54}.message-toggle.message-toggle--notification{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #f0f8ff;--message-toggle-icon-color: #2d72dc}.message-toggle.message-toggle--warning{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fffcf0;--message-toggle-icon-color: #ffb92e}.message-toggle.message-toggle--error,.message-toggle.message-toggle--danger{--message-toggle-color: #1c2a3f;--message-toggle-background-color: #fff3f0;--message-toggle-icon-color: #f44336}.message-toggle--dark.message-toggle--message{--message-toggle-background-color: #e3ffe5}.message-toggle--dark.message-toggle--notification{--message-toggle-background-color: #d6ecff}.message-toggle--dark.message-toggle--warning{--message-toggle-background-color: #fff6d1}.message-toggle--dark.message-toggle--error,.message-toggle--dark.message-toggle--danger{--message-toggle-background-color: #ffe2db}\n"],encapsulation:2,data:{animation:[(0,Le.hZ)("show",[(0,Le.kY)(":enter",[(0,Le.sM)(Gr.fadeIn,{params:{duration:300}})]),(0,Le.kY)(":leave",[(0,Le.sM)(Gr.fadeOut,{params:{duration:300}})])])]},changeDetection:0}),t})();var El,Cl;function XA(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",2)(1,"app-message-toggle",3),e.bIt("handleDismiss",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleDismiss())}),e.j41(2,"div"),e.pXf(3,0),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("dismiss",!0))}class Iu{constructor(t){this.changeRef=t,this.shown=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.bookmark$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=(0,m.get)(t,"tags",[]);this.shown=o.includes("complete anatomy"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismiss(){this.shown=!1,this.changeRef.markForCheck()}}(El=Iu).\u0275fac=function(t){return new(t||El)(e.rXU(e.gRc))},El.\u0275cmp=e.VBU({type:El,selectors:[["app-view-content-warning"]],decls:2,vars:3,consts:()=>{let n;return n=$localize`:971372758a4ed342c52bb48b1081e757728573664888031257194232864: This model is not optimized for use on mobile devices. For an optimal experience, please switch to a desktop device or try our Anatomy by Regions. `,[n,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(t,o){1&t&&(e.DNE(0,XA,4,1,"div",1),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,o.bookmark$)&&o.shown)},dependencies:[q.bT,Ed,q.Jj],styles:[".warning{position:fixed;top:0;left:0;right:0;z-index:1001}\n"],encapsulation:2,changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(_t.getSelectedBookmark),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Iu.prototype,"bookmark$",void 0);class wu{constructor(){this.toggle=new e.bkB,this.open=!1,this.fixed=!1,this.compact=!1}handleToggleClick(){this.toggle.emit()}}(Cl=wu).\u0275fac=function(t){return new(t||Cl)},Cl.\u0275cmp=e.VBU({type:Cl,selectors:[["app-view-drawer-header"]],inputs:{open:"open",fixed:"fixed",compact:"compact"},outputs:{toggle:"toggle"},ngContentSelectors:["*"],decls:5,vars:8,consts:[["app-view-button","","buttonSize","fill","data-test","drawerToggleButton",1,"view-drawer-header",3,"click"],[1,"view-drawer-header__content"],["size","md",1,"mx-4",3,"icon"]],template:function(t,o){if(1&t&&(e.NAR(),e.j41(0,"button",0),e.bIt("click",function(){return o.handleToggleClick()}),e.j41(1,"div",1),e.SdG(2),e.nrm(3,"app-icon",2),e.nI1(4,"async"),e.k0s()()),2&t){let i;e.AVh("view-drawer-header--fixed",o.fixed)("view-drawer-header--compact",o.compact),e.BMQ("aria-expanded",o.open),e.R7$(3),e.Y8G("icon","show"===(null==(i=e.bMT(4,6,o.viewUI$))?null:i.drawer.status)?"angle-down":"angle-up")}},dependencies:[rn,yt.R,q.Jj],styles:[".view-drawer-header[_ngcontent-%COMP%]{--header-height: 40px;font-size:16px;width:100%;border-bottom:1px solid #d7e0ea;min-height:var(--header-height)}.view-drawer-header--fixed[_ngcontent-%COMP%]{font-size:14px;height:var(--header-height)}.view-drawer-header--compact[_ngcontent-%COMP%]{--header-height: 24px;min-height:var(--header-height);height:var(--header-height);font-size:12px}.view-drawer-header__content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 16px;margin:0 auto;max-width:520px;min-height:var(--header-height)-4px}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Be.getUI),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],wu.prototype,"viewUI$",void 0);var Tl,gi=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},hi=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const KA=["viewDrawer"],JA=["viewDrawerContent"],qA=(n,t,o)=>({"view-drawer--closed":n,"view-drawer--active":t,"view-drawer--scrollable":o});function ZA(n,t){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-spinner",10),e.nI1(2,"async"),e.k0s()),2&n){let o;const i=e.XpG();e.R7$(),e.Y8G("label",null==(o=e.bMT(2,1,i.scrim$))?null:o.label)}}function e2(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",11),e.bIt("toggle",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.ChapterInfo))}),e.nrm(2,"app-view-title",12),e.k0s(),e.bVm()}if(2&n){const o=e.XpG();e.R7$(),e.Y8G("compact",o.scrolled&&o.scrollThreshold),e.R7$(),e.Y8G("dynamicTitle","chapter")("showMetaTitle",!1)("showSubTitle",!1)("useEllipsis",o.scrolled&&o.scrollThreshold)}}function t2(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.bIt("toggle",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.Quiz))}),e.nrm(2,"app-view-title",14),e.k0s(),e.bVm()}if(2&n){const o=e.XpG();e.R7$(),e.Y8G("fixed",!0)("compact",o.scrolled&&o.scrollThreshold),e.R7$(),e.Y8G("dynamicTitle","quiz")("showMetaTitle",!1)("showSubTitle",!1)}}function n2(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.nI1(2,"async"),e.bIt("toggle",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.LabelInfo))}),e.nrm(3,"app-view-title",15),e.nI1(4,"async"),e.k0s(),e.bVm()}if(2&n){let o,i;const s=e.XpG();e.R7$(),e.Y8G("fixed","collapse"===(null==(o=e.bMT(2,5,s.drawerUI$))?null:o.status))("compact",s.scrolled&&s.scrollThreshold),e.R7$(2),e.Y8G("align","center")("mainTitle",null==(i=e.bMT(4,7,s.selectedLabel$))?null:i.title)("useEllipsis",s.scrolled&&s.scrollThreshold)}}function i2(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.nI1(2,"async"),e.bIt("toggle",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.VisibilityLayers))}),e.nrm(3,"app-view-title",16),e.k0s(),e.bVm()}if(2&n){let o;const i=e.XpG();e.R7$(),e.Y8G("fixed","collapse"===(null==(o=e.bMT(2,3,i.drawerUI$))?null:o.status))("compact",i.scrolled&&i.scrollThreshold),e.R7$(2),e.Y8G("align","left")}}function o2(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-content-mode",17),e.bVm())}function s2(n,t){1&n&&e.nrm(0,"app-view-quiz",20)}function r2(n,t){if(1&n&&(e.j41(0,"div",18),e.DNE(1,s2,1,0,"app-view-quiz",19),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,o.quizModeActive$))}}function a2(n,t){if(1&n&&(e.j41(0,"div",23),e.nrm(1,"app-content-blocks",24),e.nI1(2,"async"),e.k0s()),2&n){let o;const i=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",null==(o=e.bMT(2,2,i.selectedLabel$))?null:o.contentBlocks)("layout","compact")}}function l2(n,t){if(1&n&&(e.qex(0),e.DNE(1,a2,3,4,"div",21),e.nI1(2,"async"),e.nrm(3,"app-html",22),e.nI1(4,"async"),e.bVm()),2&n){let o,i;const s=e.XpG();e.R7$(),e.Y8G("ngIf",null==(o=e.bMT(2,2,s.selectedLabel$))?null:o.contentBlocks),e.R7$(2),e.Y8G("markdownText",null==(i=e.bMT(4,4,s.selectedLabel$))?null:i.description)}}function c2(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-visibility-layers",25),e.bVm()),2&n&&(e.R7$(),e.Y8G("compact",!0))}class ni{constructor(t,o,i){this.changeDetectorRef=t,this.viewService=o,this.store=i,this.viewContentMode=Ft,this.openChanged=new e.bkB,this.ngUnsubscribe=new Q.B,this.viewMode=Wc,this.mode=Wc.Content,this.horizontalBreakpoint=Vn,this.scrolled=!1,this.scrollThreshold=!1}ngOnInit(){this.initQuizObserver(),this.initScrollObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initQuizObserver(){const t=this.selectedChapterReady$.pipe((0,le.T)(o=>o&&o.model),(0,S.p)(o=>o),(0,Fn.B)(300));(0,Ht.z)([t,this.quizModeActive$]).pipe((0,S.p)(([o])=>o),(0,b.Q)(this.ngUnsubscribe)).subscribe(([,o])=>{setTimeout(()=>{o&&(this.viewService.toggleDrawer(at.Show),this.changeDetectorRef.markForCheck())})})}initScrollObserver(){(0,yn.R)(this.viewDrawerContent.nativeElement,"scroll").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentScroll())}updateViewHeight(){const t=this.store.selectSnapshot(gn.getSiteHeader),s=Hp(t,this.store.selectSnapshot(gn.getSiteHeaderHeight),xc(t));this.viewDrawer.nativeElement.style.setProperty("--vh",`${s}px`)}handleToggleClick(t){const o=this.store.selectSnapshot(Be.getUIEntry(G.Drawer));switch(t){case Ft.LabelInfo:this.viewService.clearSelectedLabel();break;case Ft.Quiz:this.viewService.toggleDrawer(o.status===at.Show?at.Collapse:at.Show);break;default:this.viewService.toggleDrawer()}}handleDrawerKeydown(t){("ArrowDown"===t.key||"ArrowUp"===t.key)&&t.stopPropagation()}handleLabelBack(){this.viewService.clearSelectedLabel()}handlePreviousClick(){this.viewService.previousChapter("drawer")}handleNextClick(){this.viewService.nextChapter("drawer")}handleContentScroll(){const t=this.viewDrawerContent.nativeElement.scrollTop;this.scrollThreshold=this.viewDrawerContent.nativeElement.scrollHeight-this.viewDrawerContent.nativeElement.clientHeight>21;const s=t>0;s!==this.scrolled&&(this.scrolled=s,this.changeDetectorRef.markForCheck())}}(Tl=ni).\u0275fac=function(t){return new(t||Tl)(e.rXU(e.gRc),e.rXU(hn),e.rXU(l.il))},Tl.\u0275cmp=e.VBU({type:Tl,selectors:[["app-view-drawer"]],viewQuery:function(t,o){if(1&t&&(e.GBs(KA,5),e.GBs(JA,7)),2&t){let i;e.mGM(i=e.lsd())&&(o.viewDrawer=i.first),e.mGM(i=e.lsd())&&(o.viewDrawerContent=i.first)}},outputs:{openChanged:"openChanged"},decls:22,vars:32,consts:()=>{let n;return n=$localize`:459baf5634e45a7173e4f0e1920265af97fce630801176277231880295:Chapter Description`,[["viewDrawer",""],["viewDrawerContent",""],["data-test","viewPageDrawer",1,"view-drawer",3,"ngClass"],["class","view-drawer__scrim",4,"ngIf"],["role","region","aria-label",n,1,"view-drawer__outer",3,"keydown"],[1,"view-drawer__inner",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"view-drawer__content",3,"appInfoScroll","ngSwitch"],["class","pt-3 pb-8",4,"ngSwitchCase"],[1,"view-drawer__scrim"],["size","large",3,"label"],[3,"toggle","compact"],[3,"dynamicTitle","showMetaTitle","showSubTitle","useEllipsis"],[3,"toggle","fixed","compact"],[3,"dynamicTitle","showMetaTitle","showSubTitle"],[3,"align","mainTitle","useEllipsis"],["mainTitle","Anatomy Layers",3,"align"],["layout","drawer",1,"mt-2"],[1,"pt-3","pb-8"],["mode","drawer",4,"ngIf"],["mode","drawer"],["appEventFence","",4,"ngIf"],[1,"text-sm",3,"markdownText"],["appEventFence",""],[3,"contentBlocks","layout"],[3,"compact"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",2,0),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,ZA,3,3,"div",3),e.nI1(6,"async"),e.j41(7,"div",4),e.bIt("keydown",function(r){return e.eBV(i),e.Njj(o.handleDrawerKeydown(r))}),e.j41(8,"div",5),e.nI1(9,"async"),e.DNE(10,e2,3,5,"ng-container",6)(11,t2,3,5,"ng-container",6)(12,n2,5,9,"ng-container",6)(13,i2,4,5,"ng-container",6),e.j41(14,"div",7,1),e.nI1(16,"async"),e.nI1(17,"async"),e.DNE(18,o2,2,0,"ng-container",6)(19,r2,3,3,"div",8)(20,l2,5,6,"ng-container",6)(21,c2,2,1,"ng-container",6),e.k0s()()()()}if(2&t){let i,s;e.Y8G("ngClass",e.sMw(28,qA,!1===e.bMT(2,14,o.drawerVisible$),e.bMT(3,16,o.drawerVisible$),"show"===(null==(i=e.bMT(4,18,o.drawerUI$))?null:i.status))),e.R7$(5),e.Y8G("ngIf",null==(s=e.bMT(6,20,o.scrim$))?null:s.show),e.R7$(3),e.Y8G("ngSwitch",e.bMT(9,22,o.contentMode$)),e.R7$(2),e.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers),e.R7$(),e.Y8G("appInfoScroll",!0)("ngSwitch",e.bMT(16,24,o.contentMode$)),e.BMQ("tabindex",e.bMT(17,26,o.drawerVisible$)?0:-1),e.R7$(4),e.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers)}},dependencies:[q.YU,q.bT,q.ux,q.e1,Nr,Zc.L,BS,Gs,Zo,Mi,yu,qi,mo,wu,q.Jj],styles:[".view-drawer{height:100%;padding-bottom:4px}.view-drawer--active,.view-drawer--closed{background-color:#fff}.view-drawer--scrollable{min-height:0}.view-drawer--scrollable .view-drawer__content{overflow-y:scroll}.view-drawer__header{position:relative;border-bottom:1px solid #eaeff5}.view-drawer__pagination,.view-drawer__media{display:flex;align-items:center;border-right:1px solid rgba(0,0,0,.1)}.view-drawer__toggle{padding:0 16px;display:flex;align-items:center;justify-content:center;width:100%;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:600}.view-drawer__inner{height:100%;display:flex;flex-direction:column}.view-drawer__outer{outline:none;height:100%}.view-drawer__content{display:flex;flex:1 1 100%;flex-direction:column;width:100%;max-width:520px;margin:0 auto;padding:8px 16px}.view-drawer__scrim{background-color:#fff;position:absolute;display:flex;justify-content:center;align-items:center;z-index:50;inset:0}.view-drawer__pagination-tooltip{position:absolute;z-index:1000;bottom:100%;left:36px}\n"],encapsulation:2,changeDetection:0}),gi([(0,l.l6)(_e.getContentMode),hi("design:type",y.c)],ni.prototype,"contentMode$",void 0),gi([(0,l.l6)(_e.getScrim),hi("design:type",y.c)],ni.prototype,"scrim$",void 0),gi([(0,l.l6)(fe.N.getSelectedChapterTitle),hi("design:type",y.c)],ni.prototype,"selectedChapterTitle$",void 0),gi([(0,l.l6)(fe.N.getChapterPagination),hi("design:type",y.c)],ni.prototype,"pagination$",void 0),gi([(0,l.l6)(fe.N.getSelectedChapterReadyState),hi("design:type",y.c)],ni.prototype,"selectedChapterReady$",void 0),gi([(0,l.l6)(fe.N.getNextChapter),hi("design:type",y.c)],ni.prototype,"nextChapter$",void 0),gi([(0,l.l6)(Ze.getSelectedLabel),hi("design:type",y.c)],ni.prototype,"selectedLabel$",void 0),gi([(0,l.l6)(Ue.j.getQuizModeActive),hi("design:type",y.c)],ni.prototype,"quizModeActive$",void 0),gi([(0,l.l6)(Ue.j.getActiveQuestionIndex),hi("design:type",y.c)],ni.prototype,"activeQuestionIndex$",void 0),gi([(0,l.l6)(Ue.j.getQuestionTotal),hi("design:type",y.c)],ni.prototype,"questionTotal$",void 0),gi([(0,l.l6)(Ue.j.getQuestionsRemaining),hi("design:type",y.c)],ni.prototype,"questionRemaining$",void 0),gi([(0,l.l6)(Ue.j.getQuizSettings),hi("design:type",y.c)],ni.prototype,"quizSettings$",void 0),gi([(0,l.l6)(Ue.j.getQuizModeLocked),hi("design:type",y.c)],ni.prototype,"quizLocked$",void 0),gi([(0,l.l6)(In.getHorizontalBreakpoint),hi("design:type",y.c)],ni.prototype,"horizontalBreakpoint$",void 0),gi([(0,l.l6)(Be.getVisible(G.Drawer)),hi("design:type",y.c)],ni.prototype,"drawerVisible$",void 0),gi([(0,l.l6)(Be.getUIEntry(G.Drawer)),hi("design:type",y.c)],ni.prototype,"drawerUI$",void 0);let d2=(()=>{var n;class t{constructor(i,s,r){this.viewService=i,this.directionality=s,this.store=r,this.viewUI=(0,mn.ot)(this.store.select(Be.getUI)),this.contentMode=(0,mn.ot)(this.store.select(_e.getContentMode)),this.isOut=(0,e.EWP)(()=>this.viewUI().drawer.status===at.Show&&this.contentMode()===Ft.ChapterInfo),this.tooltipText=(0,e.EWP)(()=>this.isOut()?$localize`Close Info Panel`:$localize`Open Info Panel`),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}toggleDrawer(){const i=this.isOut()?at.Hide:at.Show;this.viewService.clearSelectedLabel(),this.viewService.setContentMode(Ft.ChapterInfo),this.viewService.toggleDrawer(i,!0)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(hn),e.rXU(qo.dS),e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-drawer-toggle"]],decls:2,vars:4,consts:[["app-view-button","","buttonSize","small","data-test","viewDrawerToggle",3,"click","matTooltip","matTooltipPosition","buttonTheme"],["size","lg","icon","info",3,"custom"]],template:function(i,s){1&i&&(e.j41(0,"button",0),e.bIt("click",function(){return s.toggleDrawer()}),e.nrm(1,"app-icon",1),e.k0s()),2&i&&(e.Y8G("matTooltip",s.tooltipText())("matTooltipPosition",s.tooltipPosition)("buttonTheme",s.isOut()?"blue-fill":"transparent-fill"),e.R7$(),e.Y8G("custom",!0))},dependencies:[rn,yt.R,On.oV],changeDetection:0}),t})();function _2(n,t){1&n&&e.nrm(0,"app-icon",6)}function p2(n,t){1&n&&e.nrm(0,"app-icon",7)}function u2(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",2),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleFullscreenClick())}),e.j41(1,"span",3),e.EFF(2),e.k0s(),e.DNE(3,_2,1,0,"app-icon",4)(4,p2,1,0,"app-icon",5),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("buttonSize",o.buttonSize)("matTooltip",o.fullscreenToggleTooltip),e.R7$(2),e.JRh(o.fullscreenToggleTooltip),e.R7$(),e.Y8G("ngIf",o.isFullscreen),e.R7$(),e.Y8G("ngIf",!o.isFullscreen)}}function g2(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleNewTabClick())}),e.nrm(1,"app-icon",10),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("buttonSize",o.buttonSize)}}function h2(n,t){if(1&n&&(e.qex(0),e.DNE(1,g2,2,1,"button",8),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",!o.canFullscreen)}}let m2=(()=>{var n;class t{constructor(i,s){this.viewService=i,this.changeDetectorRef=s,this.isFullscreen=!1,this.canFullscreen=!1,this.ngUnsubscribe=new Q.B,this.viewUI=G,this.nativePlatform=Wf.I,this.application=Wn.c,this.buttonSize=Ao.Default}ngOnInit(){this.canFullscreen=io.canFullscreen(),this.initFullscreenListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFullscreenClick(){io.toggleFullscreen()}handleNewTabClick(){this.viewService.openInNewTab()}initFullscreenListener(){io.onFullscreenChange().pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.isFullscreen=i,this.fullscreenToggleTooltip=i?$localize`Exit Fullscreen`:$localize`Enter Fullscreen`,this.changeDetectorRef.markForCheck()})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(hn),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-fullscreen"]],inputs:{buttonSize:"buttonSize"},decls:2,vars:4,consts:()=>{let o;return o=$localize`:0ced11d3928af0572f10cfd084c3f86347d3af606283253681872253092:Open in New Tab`,[["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"buttonSize","matTooltip","click",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"click","buttonSize","matTooltip"],[1,"sr-only"],["size","lg","icon","compress",4,"ngIf"],["size","lg","icon","expand",4,"ngIf"],["size","lg","icon","compress"],["size","lg","icon","expand"],["appPreventFadeout","","app-view-button","","matTooltip",o,"matTooltipPosition","left","data-test","viewNewTab",3,"buttonSize","click",4,"ngIf"],["appPreventFadeout","","app-view-button","","matTooltip",o,"matTooltipPosition","left","data-test","viewNewTab",3,"click","buttonSize"],["icon","arrow-up-right-from-square"]]},template:function(i,s){1&i&&e.DNE(0,u2,5,5,"button",0)(1,h2,2,1,"ng-container",1),2&i&&(e.Y8G("ngIf",s.canFullscreen),e.R7$(),e.Y8G("appFlagApplication",s.application.All)("appFlagApplicationMode","exclude")("appFlagApplicationNative",s.nativePlatform.All))},dependencies:[rn,q.bT,nu.Y,Us,yt.R,On.oV],encapsulation:2,changeDetection:0}),t})();function f2(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",2)(1,"app-message-toggle",3),e.bIt("handleDismiss",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleDismiss())}),e.j41(2,"div"),e.pXf(3,0),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("dismiss",!0))}const Ws=[];let Cd,Td,b2=(()=>{var n;class t{constructor(i,s){this.storageService=i,this.changeRef=s,this.shown=!1,this.sampling=!1}ngOnInit(){this.storageService.getLocalItem(zt.UT.Iphone12Warning)||this.testDevices()}ngOnDestroy(){this.sampling=!1}testDevices(){const i=window.matchMedia("only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"),s=window.matchMedia("only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"),r=window.matchMedia("only screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"),a=i.matches||s.matches||r.matches,d=/iPhone|iPad/.test(navigator.userAgent),f=/OS\s14/.test(navigator.userAgent);a&&d&&f&&this.startFrameSampling()}startFrameSampling(){this.sampling=!0,Cd=0,Td=Date.now();const i=()=>{this.frame()?(this.shown=!0,this.changeRef.markForCheck()):this.sampling&&requestAnimationFrame(i)};requestAnimationFrame(i)}frame(){Cd++;const i=Date.now();if(i>=Td+500){const r=Math.floor(500*Cd/(i-Td)*2);if(Ws.push(r),Ws.length>3&&Ws.shift(),3===Ws.length&&(Ws[0]+Ws[1]+Ws[2])/3<10)return!0;Td=i,Cd=0}}handleDismiss(){this.shown=!1,this.changeRef.markForCheck(),this.storageService.setLocalItem(zt.UT.Iphone12Warning,!0)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(zt.n$),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-iphone12-warning"]],decls:1,vars:1,consts:()=>{let o;return o=$localize`:6aa3f174a7565623c9f89ee56c05a46a791742c96041509682411192729: This model appears to be performing slowly on your device. For an optimal experience, please switch to a different device or try another model. `,[o,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(i,s){1&i&&e.DNE(0,f2,4,1,"div",1),2&i&&e.Y8G("ngIf",s.shown)},dependencies:[q.bT,Ed],styles:[".warning[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1002}"],changeDetection:0}),t})();const y2=["viewLoader"],v2=["*"];let E2=(()=>{var n;class t{constructor(i,s,r,a){this.renderer=i,this.viewService=s,this.mediaService=r,this.store=a,this.ngUnsubscribe=new Q.B}handleClick(){this.renderer.addClass(this.viewLoaderRef.nativeElement,"view-loader--disappear"),this.viewService.toggleInteract(!1),this.store.selectSnapshot(Jo.U.getPrefersReducedMotion)||this.viewService.playChapterFromStart();const i=this.store.selectSnapshot(_e.getViewLanguage),s=this.store.selectSnapshot(fe.N.getSelectedChapter);this.store.selectSnapshot(_e.getPlaythroughEnabled)||this.mediaService.getChapterAudioPlayer(s,i).then(a=>{if(a){const d=this.store.selectSnapshot(fe.N.getSelectedChapterId);this.mediaService.playChapterAudio(d)}})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG),e.rXU(hn),e.rXU(Ci),e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-loader"]],viewQuery:function(i,s){if(1&i&&e.GBs(y2,7),2&i){let r;e.mGM(r=e.lsd())&&(s.viewLoaderRef=r.first)}},ngContentSelectors:v2,decls:4,vars:0,consts:[["viewLoader",""],["role","dialog",1,"view-loader"],["role","button",3,"click"]],template:function(i,s){if(1&i){const r=e.RV6();e.NAR(),e.j41(0,"div",1,0)(2,"div",2),e.bIt("click",function(){return e.eBV(r),e.Njj(s.handleClick())}),e.SdG(3),e.k0s()()}},encapsulation:2,changeDetection:0}),t})();var Ol,YS=_(20342),Au=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Nu=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const C2=["logoLinkRef"],T2=["logoSpanRef"],KS=(n,t,o,i)=>({"view-logo--full-color":n,"view-logo--full-white":t,"view-logo--small-color":o,"view-logo--small-white":i});function O2(n,t){if(1&n&&e.nrm(0,"a",5,0),2&n){const o=e.XpG();e.Y8G("ngClass",e.ziG(1,KS,"color"===o.logoColor&&"full"===o.logoSize,"white"===o.logoColor&&"full"===o.logoSize,"color"===o.logoColor&&"small"===o.logoSize,"white"===o.logoColor&&"small"===o.logoSize))}}function M2(n,t){if(1&n&&e.nrm(0,"span",6,1),2&n){const o=e.XpG();e.Y8G("ngClass",e.ziG(1,KS,"color"===o.logoColor&&"full"===o.logoSize,"white"===o.logoColor&&"full"===o.logoSize,"color"===o.logoColor&&"small"===o.logoSize,"white"===o.logoColor&&"small"===o.logoSize))}}class Ml{get logoSize(){return this.logoSize$.value}set logoSize(t){this.logoSize$.next(t)}get logoColor(){return this.logoColor$.value}set logoColor(t){this.logoColor$.next(t)}constructor(t,o){this.renderer=t,this.changeRef=o,this.logoDisplayMode="text",this.ngUnsubscribe=new Q.B,this.logoSize$=new ui.t("full"),this.logoColor$=new ui.t("color")}ngOnInit(){}ngAfterViewInit(){this.initLogoListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLogoListeners(){(0,Ht.z)([this.logoUI$,this.logoConfig$,this.logoSize$,this.logoColor$]).pipe((0,S.p)(([,t])=>!(0,m.isNil)(t)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i,s])=>{const a="logo_swap"===o.viewer.viewer_logo_setting,d=(0,YS.g)(o,i,s),{logo_url:f,logo_linkout_url:T}=d;this.logoDisplayMode=t?.isHyperLink&&T?"link":"text",this.changeRef.markForCheck(),setTimeout(()=>{"link"===this.logoDisplayMode?this.setHyperlinkLogo(f,T,a):this.setSpanLogo(f,a)})})}setHyperlinkLogo(t,o,i){const s=this.logoLinkRef?.nativeElement;s&&(this.renderer.setStyle(s,"background-image",`url('${t}')`),this.renderer.setAttribute(s,"href",o),i?(this.renderer.setAttribute(s,"rel","noreferrer nofollow"),this.renderer.setAttribute(s,"title",""),this.renderer.setAttribute(s,"aria-label",$localize`link opens in a new tab`)):(this.renderer.removeAttribute(s,"rel"),this.renderer.setAttribute(s,"title",$localize`Powered by BioDigital`),this.renderer.setAttribute(s,"aria-label",$localize`Powered by BioDigital (opens in a new tab)`)))}setSpanLogo(t,o){const i=this.logoSpanRef?.nativeElement;i&&(this.renderer.setStyle(i,"background-image",`url('${t}')`),this.renderer.setAttribute(i,"title",o?"":$localize`Powered by BioDigital`))}}function I2(n,t){if(1&n&&(e.j41(0,"p"),e.EFF(1),e.qex(2),e.pXf(3,0),e.bVm(),e.k0s()),2&n){const o=e.XpG(3);e.R7$(),e.SpI("",o.chapterCount()," ")}}function w2(n,t){1&n&&(e.j41(0,"p"),e.pXf(1,1),e.k0s())}function P2(n,t){if(1&n&&(e.j41(0,"div",7),e.DNE(1,I2,4,1,"p")(2,w2,2,0,"p"),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.vxM(1,o.hasMultiChapter()?1:-1),e.R7$(),e.vxM(2,o.hasSkinVariants()?2:-1)}}function A2(n,t){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function N2(n,t){1&n&&(e.qex(0),e.pXf(1,3),e.bVm())}function R2(n,t){1&n&&(e.qex(0),e.pXf(1,4),e.bVm())}function D2(n,t){if(1&n&&e.DNE(0,N2,2,0,"ng-container")(1,R2,2,0),2&n){const o=e.XpG(2);e.vxM(0,o.hasMultiChapter()?0:1)}}function k2(n,t){if(1&n&&(e.j41(0,"h1",6),e.EFF(1),e.k0s(),e.DNE(2,P2,3,2,"div",7),e.j41(3,"div",8),e.DNE(4,A2,2,0)(5,D2,2,1),e.nrm(6,"app-icon",9),e.k0s()),2&n){let o;const i=e.XpG();e.R7$(),e.SpI(" ",i.story().displayName," "),e.R7$(),e.vxM(2,i.hasMultiChapter()||i.hasSkinVariants()?2:-1),e.R7$(2),e.vxM(4,(o=i.selectedBookmarkViewMode())===i.bookmarkViewMode.Quiz?4:5)}}(Ol=Ml).\u0275fac=function(t){return new(t||Ol)(e.rXU(e.sFG),e.rXU(e.gRc))},Ol.\u0275cmp=e.VBU({type:Ol,selectors:[["app-view-logo"]],viewQuery:function(t,o){if(1&t&&(e.GBs(C2,5),e.GBs(T2,5)),2&t){let i;e.mGM(i=e.lsd())&&(o.logoLinkRef=i.first),e.mGM(i=e.lsd())&&(o.logoSpanRef=i.first)}},inputs:{logoSize:"logoSize",logoColor:"logoColor"},decls:3,vars:3,consts:[["logoLinkRef",""],["logoSpanRef",""],[3,"ngSwitch"],["target","_blank","class","view-logo","data-test","viewLogo",3,"ngClass",4,"ngSwitchCase"],["class","view-logo","data-test","viewLogo",3,"ngClass",4,"ngSwitchCase"],["target","_blank","data-test","viewLogo",1,"view-logo",3,"ngClass"],["data-test","viewLogo",1,"view-logo",3,"ngClass"]],template:function(t,o){1&t&&(e.qex(0,2),e.DNE(1,O2,2,6,"a",3)(2,M2,2,6,"span",4),e.bVm()),2&t&&(e.Y8G("ngSwitch",o.logoDisplayMode),e.R7$(),e.Y8G("ngSwitchCase","link"),e.R7$(),e.Y8G("ngSwitchCase","text"))},dependencies:[q.YU,q.ux,q.e1],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.view-logo[_ngcontent-%COMP%]{pointer-events:all;background-position:center center;background-repeat:no-repeat}.view-logo[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.view-logo--small-color[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-color[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo--small-white[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-white[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo[_ngcontent-%COMP%]:not([hidden]){display:flex}.view-logo[href][_ngcontent-%COMP%]:hover{cursor:pointer}"],changeDetection:0}),Au([(0,l.l6)(fe.N.getSelectedChapterBackground),Nu("design:type",y.c)],Ml.prototype,"background$",void 0),Au([(0,l.l6)(Be.getUIEntry(G.Logo)),Nu("design:type",y.c)],Ml.prototype,"logoUI$",void 0),Au([(0,l.l6)(Dp.X.getViewLogoConfig),Nu("design:type",y.c)],Ml.prototype,"logoConfig$",void 0);let JS=(()=>{var n;class t{constructor(i){this.store=i,this.bookmarkViewMode=Ne,this.story=(0,mn.ot)(this.store.select(rt.getStory)),this.chapterCount=(0,mn.ot)(this.store.select(fe.N.getChapterCount)),this.selectedBookmarkViewMode=(0,mn.ot)(this.store.select(_t.getSelectedBookmarkViewMode)),this.skinVariant=(0,mn.ot)(this.store.select(rt.getVariantSchema("skin"))),this.hasSkinVariants=(0,e.EWP)(()=>!(0,m.isEmpty)(this.skinVariant())),this.hasMultiChapter=(0,e.EWP)(()=>this.chapterCount()>1)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-summary-loader"]],decls:2,vars:1,consts:()=>{let o,i,s,r,a,d;return o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,i=$localize`:d904f74acb72356dd3547977ca3cf29d6da259465096495468612049743:Chapters`,s=$localize`:39967f284caff71af5063e41259bb4968bff203b4142145898284245309:Skin Options Available`,r=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,a=$localize`:2c55dafd02bed135add1986e10e77ae6607285332899734440722419896:Begin Interactive Tour`,d=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[i,s,r,a,d,["type","button","aria-label",o,1,"summary-loader"],[1,"text-2xl","font-bold"],[1,"summary-loader__sub-title"],[1,"summary-loader__cta"],["icon","arrow-right","appLogicalDir","",1,"ml-2"]]},template:function(i,s){1&i&&(e.j41(0,"button",5),e.DNE(1,k2,7,3),e.k0s()),2&i&&(e.R7$(),e.vxM(1,s.story()?1:-1))},dependencies:[$i.e,yt.R],styles:['.button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;align-items:center;background:none;border-color:transparent;border-radius:4px;border-width:0;color:inherit;display:flex;font-family:Inter,sans-serif;justify-content:center;margin:0;outline:0 none;padding:0 16px;position:relative;text-align:center;text-decoration:none;transition:background-color .12s;width:100%}.button[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.button[_ngcontent-%COMP%]:focus   .button--themed[_ngcontent-%COMP%]{outline:#2d72dc solid 2px!important}.button[_ngcontent-%COMP%]:after{content:" ";background-color:#283853;border-radius:4px;display:block;position:absolute;inset:0;opacity:0;z-index:1;transition:opacity .06s}.button[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.7}.button__container[_ngcontent-%COMP%]{position:relative;z-index:2;width:100%}.button--uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.button--expanded[_ngcontent-%COMP%]{display:flex;flex:1}.button--xsmall[_ngcontent-%COMP%]{height:24px;min-width:24px;padding:0 8px;font-size:.625rem;line-height:.75rem}.button--small[_ngcontent-%COMP%]{height:32px;min-width:32px;padding:0 12px;font-size:.75rem;line-height:1rem}.button--medium[_ngcontent-%COMP%]{height:36px;min-width:36px;padding:0 16px;font-size:.75rem;line-height:1rem}.button--large[_ngcontent-%COMP%]{height:48px;min-width:48px;padding:0 16px;font-size:.875rem;line-height:1.25rem}.button--no-border[_ngcontent-%COMP%]{border-radius:0!important}.button--no-border[_ngcontent-%COMP%]:after{border-radius:0!important}.button--left[_ngcontent-%COMP%]{text-align:left}.button--themed[_ngcontent-%COMP%]{color:#374a68}.button--themed[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--themed[_ngcontent-%COMP%]:after{background-color:#d7e0ea}.button--dark[_ngcontent-%COMP%]{color:#d7e0ea}.button--dark[_ngcontent-%COMP%]:hover{color:#fff}.button--dark[_ngcontent-%COMP%]:after{background-color:#283853}.button--dark.button--flat[_ngcontent-%COMP%]{background:#374a68}.button--dark.button--default[_ngcontent-%COMP%]{background:transparent}.button--dark.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #374a68;transition:border-color .12s}.button--dark.button--outline[_ngcontent-%COMP%]:hover{border-color:#96a8c0}.button--dark.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent;display:none}.button--dark.button--text[_ngcontent-%COMP%]{background:transparent;color:#d7e0ea}.button--dark.button--text[_ngcontent-%COMP%]:hover{color:#fff}.button--dark.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--dark.button--selected[_ngcontent-%COMP%]{background-color:#2d72dc;color:#fff}.button--dark.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light[_ngcontent-%COMP%]{color:#283853}.button--light[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--light[_ngcontent-%COMP%]:after{background-color:#96a8c0}.button--light[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.6}.button--light.button--flat[_ngcontent-%COMP%]{background:#d7e0ea;font-weight:500}.button--light.button--flat.button--selected[_ngcontent-%COMP%]{background-color:#96a8c0}.button--light.button--default[_ngcontent-%COMP%]{background:transparent;color:#131c2a}.button--light.button--default[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.2}.button--light.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #96a8c0;color:#283853;transition:border-color .12s}.button--light.button--outline[_ngcontent-%COMP%]:after{display:none}.button--light.button--outline[_ngcontent-%COMP%]:hover{background:#374a680d;border-color:#374a68;color:#1c2a3f}.button--light.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent}.button--light.button--selected[_ngcontent-%COMP%]{background-color:#eaeff5}.button--light.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light.button--text[_ngcontent-%COMP%]{color:#283853}.button--light.button--text[_ngcontent-%COMP%]:hover{color:#1c2a3f}.button--light.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--primary[_ngcontent-%COMP%]{background:#de3535;color:#fff}.button--primary[_ngcontent-%COMP%]:after{background:#f9fafd}.button--primary[_ngcontent-%COMP%]:not([disabled]):hover:after{opacity:.1}.button--info[_ngcontent-%COMP%]{background:#3892dc;color:#fff}.button--info[_ngcontent-%COMP%]:after{background:#f9fafd}.button--info[_ngcontent-%COMP%]:hover:after{opacity:.1}.button--selected[_ngcontent-%COMP%]{background-color:#2d72dc}.button--disabled[_ngcontent-%COMP%]{opacity:.5}.button--circle[_ngcontent-%COMP%]{border-radius:50%}.button--circle.button--xsmall[_ngcontent-%COMP%]{width:24px}.button--circle.button--small[_ngcontent-%COMP%]{width:32px;padding:0 6px}.button--circle.button--medium[_ngcontent-%COMP%]{width:36px;padding:0 8px}.button--circle.button--large[_ngcontent-%COMP%]{width:48px}.button--circle[_ngcontent-%COMP%]:after{border-radius:50%}.button--rounded[_ngcontent-%COMP%]{border-radius:18px}.button--rounded[_ngcontent-%COMP%]:after{border-radius:18px}.summary-loader[_ngcontent-%COMP%]{border-color:transparent;background:none;border-width:0;outline:none;margin:0;pointer-events:all;background:#0006108c;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000;position:absolute;padding:36px;color:#fff;display:flex;justify-content:flex-start;align-items:flex-start;flex-direction:column;gap:8px}.summary-loader[_ngcontent-%COMP%]::-moz-focus-inner{border:0}.summary-loader[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.summary-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#000610b3}.summary-loader[_ngcontent-%COMP%]:hover   .summary-loader__cta[_ngcontent-%COMP%]{background-color:#2d72dc;border-color:#2d72dc}.summary-loader__title[_ngcontent-%COMP%]{font-size:24px;line-height:1.33em;font-weight:700}.summary-loader__sub-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;font-size:16px;line-height:1.25em;letter-spacing:.02em;text-align:left;gap:8px}.summary-loader__sub-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-child){padding-left:8px;border-left:2px solid #ffffff}.summary-loader__cta[_ngcontent-%COMP%]{width:220px;height:48px;border:1px solid #ffffff;border-radius:4px;margin-top:20px;font-weight:600px;font-size:16px;display:flex;justify-content:center;align-items:center;transition:all .25s ease-in-out}'],changeDetection:0}),t})();var Il,wl;function j2(n,t){1&n&&e.nrm(0,"app-play-loader")}function V2(n,t){1&n&&e.nrm(0,"app-button-loader")}function x2(n,t){1&n&&e.nrm(0,"app-hand-loader")}function F2(n,t){1&n&&e.nrm(0,"app-summary-loader")}function G2(n,t){1&n&&e.nrm(0,"div",7)}class Ru{constructor(t,o,i,s){this.changeRef=t,this.viewService=o,this.bookmarksService=i,this.imagesService=s,this.thumbnailURL="",this.interactionType=Bo}ngOnInit(){this.setThumbnailUrl()}handleClick(){this.viewService.toggleOnDemand(!1),this.viewService.toggleInteract(!1)}setThumbnailUrl(){this.contentType===ye.c.Bookmark?this.bookmarksService.getBookmarkModel(this.contentId).subscribe(t=>{this.thumbnailURL=t.thumbnail_url,this.changeRef.markForCheck()}):(this.thumbnailURL=this.imagesService.getIndexThumbnail(this.contentId),this.changeRef.markForCheck())}getPoweredByUrl(){return(typeof localBaseDirectory>"u"?"":localBaseDirectory)+"assets/images/powered-by-biodigital-logo.svg"}}(Il=Ru).\u0275fac=function(t){return new(t||Il)(e.rXU(e.gRc),e.rXU(hn),e.rXU(Pa),e.rXU(Vc))},Il.\u0275cmp=e.VBU({type:Il,selectors:[["app-view-ondemand"]],inputs:{contentId:"contentId",contentType:"contentType"},decls:11,vars:10,consts:[[1,"ondemand",3,"click"],[1,"ondemand__image",3,"lazyLoad"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","ondemand__blank-overlay",4,"ngSwitchCase"],[1,"ondemand__logo"],[3,"src"],[1,"ondemand__blank-overlay"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.bIt("click",function(){return o.handleClick()}),e.nrm(1,"div",1),e.j41(2,"div",2),e.nI1(3,"async"),e.DNE(4,j2,1,0,"app-play-loader",3)(5,V2,1,0,"app-button-loader",3)(6,x2,1,0,"app-hand-loader",3)(7,F2,1,0,"app-summary-loader",3)(8,G2,1,0,"div",4),e.k0s(),e.j41(9,"div",5),e.nrm(10,"img",6),e.k0s()()),2&t&&(e.R7$(),e.Y8G("lazyLoad",o.thumbnailURL),e.R7$(),e.Y8G("ngSwitch",e.bMT(3,8,o.interactType$)),e.R7$(2),e.Y8G("ngSwitchCase",o.interactionType.Play),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Button),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Hand),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Summary),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.None),e.R7$(2),e.Y8G("src",o.getPoweredByUrl(),e.B4B))},dependencies:[q.ux,q.e1,is.Je,OS,MS,IS,JS,q.Jj],styles:[".ondemand__blank-overlay[_ngcontent-%COMP%]{background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.ondemand__blank-overlay[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.ondemand__image[_ngcontent-%COMP%]{position:absolute;inset:0;background-size:cover;background-repeat:no-repeat;background-position:center center;filter:blur(6px);z-index:1000}.ondemand__logo[_ngcontent-%COMP%]{position:absolute;bottom:40px;justify-content:center;width:100%;z-index:20000;display:flex}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(_e.getInteractType),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Ru.prototype,"interactType$",void 0);class Du{beforePrint(t){this.visible=!0,this.changeDetectorRef.markForCheck()}afterPrint(t){this.visible=!1,this.changeDetectorRef.markForCheck()}constructor(t,o){this.store=t,this.changeDetectorRef=o,this.ngUnsubscribe=new Q.B,this.visible=!1}ngOnInit(){this.initImageUrlListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initImageUrlListener(){(0,Ht.z)(this.storyChapters$,this.store.select(to.K.getRegisteredThumbnails)).pipe((0,S.p)(([t,o])=>t.length>0&&o.size>0),(0,le.T)(([t,o])=>o.get(t[0].id).urls.large),(0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.imageUrl=t,this.changeDetectorRef.markForCheck()})}}(wl=Du).\u0275fac=function(t){return new(t||wl)(e.rXU(l.il),e.rXU(e.gRc))},wl.\u0275cmp=e.VBU({type:wl,selectors:[["app-view-print"]],hostBindings:function(t,o){1&t&&e.bIt("beforeprint",function(){return o.beforePrint()},!1,e.tSv)("afterprint",function(){return o.afterPrint()},!1,e.tSv)},decls:3,vars:1,consts:[[1,"view-print"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",1,"view-print__scrim"],[1,"view-print__image",3,"src"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.nrm(1,"img",1)(2,"img",2),e.k0s()),2&t&&(e.R7$(2),e.Y8G("src",o.imageUrl,e.B4B))},styles:[".view-print[_ngcontent-%COMP%]{background-color:#fff;display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10000;justify-content:space-around;margin:auto;margin-top:0!important}@media print{.view-print[_ngcontent-%COMP%]{display:flex}}.view-print__scrim[_ngcontent-%COMP%]{display:block;width:100%;height:100%;position:absolute;z-index:-1;inset:0}.view-print__image[_ngcontent-%COMP%]{display:block;flex:1 1 auto;object-fit:contain;margin:0 auto;z-index:1}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(fe.N.getStoryChapters),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Du.prototype,"storyChapters$",void 0);const z2=["circle"],W2=["progressCircle"],X2=["progressContainer"],H2=n=>({"view-progress--active":n}),Q2=n=>({"view-progress__ring--pulse":n});function Y2(n,t){if(1&n&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI("",o.percent,"%")}}let K2=(()=>{var n;class t{get show(){return this._show}set show(i){setTimeout(()=>{this._show=i,this.changeDetectorRef.markForCheck()})}get percent(){return Math.floor(this._percent.value)}set percent(i){null!=i&&this._percent.next(i)}constructor(i,s){this.renderer=i,this.changeDetectorRef=s,this.ngUnsubscribe=new Q.B,this.label=$localize`Loading...`,this._show=!1,this._percent=new ui.t(0)}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions(),this.initPercentObserver()}initPercentObserver(){this._percent.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.label=this.getLoadingLabel(this.percent),this.renderProgress(0===this.percent?100:this.percent),this.changeDetectorRef.markForCheck()})}initSizeObserver(){(0,yn.R)(window,"resize").pipe((0,Fn.B)(10),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(i=100){const s=this.getCircumference();return s-i/100*s}renderProgress(i){i>=100&&(i=100);const s=this.getCircumference(),r=this.getOffset(i);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${r}`)}getLoadingLabel(i){return 100===i?$localize`Launching...`:$localize`Loading...`}updateDimensions(){const i=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*i),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*i),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(i-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${i}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${i}`);const s=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${s} ${s}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.sFG),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-progress"]],viewQuery:function(i,s){if(1&i&&(e.GBs(z2,7),e.GBs(W2,7),e.GBs(X2,7)),2&i){let r;e.mGM(r=e.lsd())&&(s.circleRef=r.first),e.mGM(r=e.lsd())&&(s.progressCircleRef=r.first),e.mGM(r=e.lsd())&&(s.progressContainerRef=r.first)}},inputs:{show:"show",percent:"percent"},decls:10,vars:10,consts:[["circle",""],["progressContainer",""],["progressCircle",""],["data-test","viewProgress","role","status","aria-live","polite",1,"view-progress",3,"ngClass"],["aria-hidden","true",1,"view-progress__circle"],[1,"view-progress__ring",3,"ngClass"],[1,"view-progress__ring-inner"],["class","view-progress__count",4,"ngIf"],[1,"view-progress__label"],[1,"view-progress__count"]],template:function(i,s){1&i&&(e.j41(0,"div",3)(1,"div",4,0),e.qSk(),e.j41(3,"svg",5,1),e.nrm(5,"circle",6,2),e.k0s(),e.DNE(7,Y2,2,1,"div",7),e.joV(),e.j41(8,"div",8),e.EFF(9),e.k0s()()()),2&i&&(e.Y8G("ngClass",e.eq3(6,H2,s.show)),e.BMQ("aria-busy",s.show),e.R7$(),e.Y8G("@isOpen",s.show?"open":"closed"),e.R7$(2),e.Y8G("ngClass",e.eq3(8,Q2,0===s.percent||100===s.percent)),e.R7$(4),e.Y8G("ngIf",s.percent>0&&s.percent<100),e.R7$(2),e.SpI(" ",s.label," "))},dependencies:[q.YU,q.bT],styles:[".view-progress[_ngcontent-%COMP%]{--circleSize: 35vw;pointer-events:none;position:absolute;display:flex;justify-content:center;align-items:center;inset:0;z-index:1000;transition:background-color .15s}@keyframes _ngcontent-%COMP%_progressPulse{0%{stroke-width:4}50%{stroke-width:1}to{stroke-width:4}}.view-progress--active[_ngcontent-%COMP%]{background-color:#0003}.view-progress__circle[_ngcontent-%COMP%]{transform:scale(0);width:var(--circleSize);height:var(--circleSize);border-radius:50%;background-color:#101823cc;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.view-progress__count[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;color:#fff;font-weight:700}.view-progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;color:#fffc}.view-progress__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;opacity:1;stroke-dashoffset:0;stroke-width:4;stroke:#fffc;fill:transparent;transform:rotate(-90deg)}.view-progress__ring--pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressPulse ease-in-out infinite 2s}@media (min-width: 600px){.view-progress__circle[_ngcontent-%COMP%]{width:160px;height:160px}}"],data:{animation:[(0,Le.hZ)("isOpen",[(0,Le.wk)("open",(0,Le.iF)({transform:"scale(1)"})),(0,Le.wk)("closed",(0,Le.iF)({transform:"scale(0)"})),(0,Le.kY)("closed => open",[(0,Le.i0)("300ms ease-out")]),(0,Le.kY)("open => closed",[(0,Le.i0)("150ms ease-in")])])]},changeDetection:0}),t})();var J2=_(37737);let q2=(()=>{var n;class t{constructor(){}onClick(i,s){s.select()}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275dir=e.FsC({type:n,selectors:[["","appSelectOnFocus",""]],hostBindings:function(i,s){1&i&&e.bIt("click",function(a){return s.onClick(a,a.target)})}}),t})();var Pl,Z2=_(30356),$r=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Br=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const eN=["searchInput"],tN=["tabButton"],qS=n=>({"view-search__action--selected":n});class as{constructor(t,o,i){this.viewService=t,this.store=o,this.elementRef=i,this.application=Wn.c,this.ngUnsubscribe=new Q.B,this.themeEnum=uS.P,this.treeSearchDisplayMode=Xi.q}handleKeyPress(){this.viewService.elementHasFocus(this.elementRef.nativeElement)&&!this.viewService.isMaterialMenuOut()&&this.close()}ngOnInit(){this.initSearchForm()}ngAfterViewInit(){this.initDisplayModeSubscription()}initDisplayModeSubscription(){this.searchDisplayMode$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{setTimeout(()=>{this.searchInput.nativeElement.focus()})})}initSearchForm(){this.searchForm=new we.gE({query:new we.MJ("")});const t=this.searchForm.controls.query;this.searchQuery$=t.valueChanges.pipe((0,ga.Z)(t.value),(0,b.Q)(this.ngUnsubscribe))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}toggleDisplayMode(){let t=this.store.selectSnapshot(_e.getSearchDisplayMode);t=t===Xi.q.List?Xi.q.Tree:Xi.q.List,this.setDisplayMode(t)}setDisplayMode(t){this.store.dispatch(new D.SetSearchDisplayMode(t))}handleTreeButtonClick(){this.setDisplayMode(Xi.q.Tree)}handleListButtonClick(){this.setDisplayMode(Xi.q.List)}getActiveTab(){switch(this.store.selectSnapshot(_e.getSearchDisplayMode)){case Xi.q.List:return"searchTab";case Xi.q.Tree:return"treeTab";default:return null}}shiftFocus(t,o){t.stopPropagation();const i=this._buttonRefs.toArray(),r=(i.findIndex(a=>a.nativeElement==document.activeElement)+o+i.length)%i.length;i[r].nativeElement.focus()}close(){this.searchForm.patchValue({query:""}),this.viewService.toggleSearch(null,!1)}}function ZS(n){if(null==n)return"";const t=new RegExp(/[^a-zA-Z0-9_]/,"gi");return n.replace(t,"_")}(Pl=as).\u0275fac=function(t){return new(t||Pl)(e.rXU(hn),e.rXU(l.il),e.rXU(e.aKT))},Pl.\u0275cmp=e.VBU({type:Pl,selectors:[["app-view-search"]],viewQuery:function(t,o){if(1&t&&(e.GBs(eN,5),e.GBs(tN,5)),2&t){let i;e.mGM(i=e.lsd())&&(o.searchInput=i.first),e.mGM(i=e.lsd())&&(o._buttonRefs=i)}},hostBindings:function(t,o){1&t&&e.bIt("keydown.escape",function(){return o.handleKeyPress()},!1,e.EBC)},decls:31,vars:47,consts:()=>{let n,t,o,i;return n=$localize`:4c4305eb340456e2e50f1eb70a8061a4e63fc3521130690042989597231:Start typing the search term, then use tab to navigate the results`,t=$localize`:8f62b63665181ac3c3afe409d6d76530ef267bc11644955292665662544:Search for a structure`,o=$localize`:6490b3960cc7c4a789cdbd29575d93abad081e077906458871395232033:List`,i=$localize`:979a2479fa31a7c56e45cf33c4d29dbda0b3ace35139118152626940877:Tree`,[["searchInput",""],["tabButton",""],o,i,["role","dialog","cdkTrapFocus","",1,"view-search"],[1,"view-search__header",3,"formGroup"],[1,"view-search__input-row",3,"formGroup"],[1,"view-search__input-container"],["icon","search",1,"view-search__input-icon"],["appAutoFocus","","appSelectOnFocus","","type","search","aria-label",n,"placeholder",t,"formControlName","query",1,"view-search__input"],[1,"view-search__actions-row"],["role","tablist",1,"view-search__actions",3,"keydown.arrowleft","keydown.arrowright"],["type","button","role","tab","id","searchTab",1,"view-search__action",3,"click","keyup.space","ngClass"],["type","button","role","tab","id","treeTab",1,"view-search__action",3,"click","keyup.space","ngClass"],["role","tabpanel",1,"mt-3","view-search__body"],[3,"displayMode","theme","query","viewGraph","viewGraphMetadata","viewGraphRank","selectedChapter","layerOrderMode","showTreeNodeIds","showLatinLabel"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),e.nrm(4,"app-icon",8)(5,"input",9,0),e.k0s()(),e.j41(7,"div",10)(8,"div",11),e.bIt("keydown.arrowleft",function(r){return e.eBV(i),e.Njj(o.shiftFocus(r,-1))})("keydown.arrowright",function(r){return e.eBV(i),e.Njj(o.shiftFocus(r,1))}),e.j41(9,"button",12,1),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleListButtonClick())})("keyup.space",function(){return e.eBV(i),e.Njj(o.handleListButtonClick())}),e.qex(14),e.pXf(15,2),e.bVm(),e.k0s(),e.j41(16,"button",13,1),e.nI1(18,"async"),e.nI1(19,"async"),e.nI1(20,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleTreeButtonClick())})("keyup.space",function(){return e.eBV(i),e.Njj(o.handleTreeButtonClick())}),e.qex(21),e.pXf(22,3),e.bVm(),e.k0s()()()(),e.j41(23,"div",14),e.nrm(24,"app-tree-search",15),e.nI1(25,"async"),e.nI1(26,"async"),e.nI1(27,"async"),e.nI1(28,"async"),e.nI1(29,"async"),e.nI1(30,"async"),e.k0s()()}2&t&&(e.R7$(),e.Y8G("formGroup",o.searchForm),e.R7$(),e.Y8G("formGroup",o.searchForm),e.R7$(7),e.Y8G("ngClass",e.eq3(43,qS,e.bMT(11,19,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)),e.BMQ("aria-selected",e.bMT(12,21,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)("tabIndex",e.bMT(13,23,o.searchDisplayMode$)===o.treeSearchDisplayMode.List?0:-1),e.R7$(7),e.Y8G("ngClass",e.eq3(45,qS,e.bMT(18,25,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)),e.BMQ("aria-selected",e.bMT(19,27,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)("tabIndex",e.bMT(20,29,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree?0:-1),e.R7$(7),e.BMQ("aria-labelledby",o.getActiveTab()),e.R7$(),e.Y8G("displayMode",e.bMT(25,31,o.searchDisplayMode$))("theme",o.themeEnum.Light)("query",e.bMT(26,33,o.searchQuery$))("viewGraph",e.bMT(27,35,o.treeGraph$))("viewGraphMetadata",e.bMT(28,37,o.viewGraphMetadata$))("viewGraphRank",e.bMT(29,39,o.viewGraphRank$))("selectedChapter",e.bMT(30,41,o.selectedChapter$))("layerOrderMode",!1)("showTreeNodeIds",!1)("showLatinLabel",!0))},dependencies:[Qi.kB,q.YU,J2.B,q2,we.me,we.BC,we.cb,yt.R,we.j4,we.JD,Z2.k,q.Jj],styles:[".view-search{display:flex;flex-direction:column;height:100%}@keyframes appear{0%{background-color:transparent}}.view-search__header{flex:0 0 auto;flex-direction:column;display:flex;animation:appear .25s ease-out}.view-search__actions-row{flex:0 0 auto;display:flex;align-items:center}.view-search__actions{display:flex;height:48px;flex:1;justify-content:space-between}.view-search__action{font-size:.625rem;line-height:.75rem;text-transform:uppercase;align-items:center;background:transparent;border:none;border-bottom:2px solid transparent;color:#374a68;display:flex;flex-direction:column;flex:1;justify-content:flex-end;padding-bottom:8px;transition:all .3s ease-in-out;cursor:pointer}.view-search__action:hover:not(.view-search__action--selected){border-bottom-color:#f9fafd}.view-search__action--selected{border-bottom-color:#2d72dc;font-weight:600}.view-search__input-row{flex:0 0 auto;display:flex;padding:24px 0 0}.view-search__input-container{background-color:#fff;border:1px solid #96a8c0;display:flex;flex-grow:1;border-radius:4px}.view-search__input-container:hover{border-color:#61779e}.view-search__input-container:focus-within{outline:#2d72dc solid 2px!important;outline-offset:-2px}.view-search__input-icon{background:0 0;display:flex;align-items:center;justify-content:center;color:#61779e;width:36px;height:36px;outline:0}.view-search__input{font-size:.875rem;line-height:1.25rem;font-weight:400;color:#131c2a;background:transparent;border:1px solid transparent;outline:none;flex:1 0 auto;padding:8px 12px 8px 0}.view-search__input::-ms-clear{display:none}.view-search__input::placeholder{color:#61779e;opacity:1}.view-search__body{flex:1 1 100%}@media not all and (-webkit-min-device-pixel-ratio: 0),not all and (min-resolution: .001dpcm){@supports (-webkit-appearance: none){.view-search__input{font-size:16px;padding:4px 8px;width:0}}}\n"],encapsulation:2,changeDetection:0}),$r([(0,l.l6)(Xe.S.getViewGraph),Br("design:type",y.c)],as.prototype,"viewGraph$",void 0),$r([(0,l.l6)(Xe.S.getTreeGraph),Br("design:type",y.c)],as.prototype,"treeGraph$",void 0),$r([(0,l.l6)(Xe.S.getViewGraphMetadata),Br("design:type",y.c)],as.prototype,"viewGraphMetadata$",void 0),$r([(0,l.l6)(Xe.S.getViewGraphRank),Br("design:type",y.c)],as.prototype,"viewGraphRank$",void 0),$r([(0,l.l6)(_e.getSearchDisplayMode),Br("design:type",y.c)],as.prototype,"searchDisplayMode$",void 0),$r([(0,l.l6)(fe.N.getSelectedChapter),Br("design:type",y.c)],as.prototype,"selectedChapter$",void 0);let nN=(()=>{var n;class t{transform(i,s){return ZS(i)}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=e.EJ8({name:"elementID",type:n,pure:!0}),t})();var Al,ls=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},cs=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const iN=["chapterMenuTrigger"],oN=["chapter"],sN=n=>({"view-chapters__item--viewed":n}),rN=n=>({"outline outline-blue-600 outline-2":n});function aN(n,t){1&n&&e.nrm(0,"app-view-pagination",14),2&n&&e.Y8G("showCount",!1)}function lN(n,t){if(1&n){const o=e.RV6();e.qex(0),e.nrm(1,"app-pillbox-divider"),e.j41(2,"button",15,2),e.bIt("menuOpened",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleChapterMenuOpen())}),e.j41(4,"div",16)(5,"div",17)(6,"span",18),e.pXf(7,4),e.k0s(),e.j41(8,"div",19),e.EFF(9),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s(),e.j41(12,"div",20),e.EFF(13),e.nI1(14,"async"),e.qex(15),e.pXf(16,5),e.bVm(),e.EFF(17),e.nI1(18,"async"),e.k0s()(),e.j41(19,"div",21),e.nrm(20,"app-icon",22),e.k0s()()(),e.bVm()}if(2&n){const o=e.XpG(2),i=e.sdS(6);e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(7),e.SpI(" ",o.getFormattedChapterTitle(e.bMT(10,4,o.chapterTitle$),e.bMT(11,6,o.chapterIndex$))," "),e.R7$(4),e.SpI(" ",e.bMT(14,8,o.chapterIndex$)+1," "),e.R7$(4),e.SpI(" ",e.bMT(18,10,o.chapterCount$)," ")}}function cN(n,t){if(1&n&&(e.j41(0,"div",11),e.DNE(1,aN,1,1,"app-view-pagination",12),e.nI1(2,"async"),e.DNE(3,lN,21,12,"ng-container",13),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.paginationVisible$)),e.R7$(2),e.Y8G("ngIf",o.showTitle)}}function dN(n,t){if(1&n&&(e.j41(0,"div",24)(1,"span",25),e.EFF(2),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()()),2&n){const o=e.XpG(2);e.R7$(2),e.JRh(o.getFormattedChapterTitle(e.bMT(3,1,o.chapterTitle$),e.bMT(4,3,o.chapterIndex$)))}}function _N(n,t){if(1&n&&e.DNE(0,dN,5,5,"div",23),2&n){const o=e.XpG();e.Y8G("ngIf",o.showTitle)}}function pN(n,t){1&n&&(e.j41(0,"span",18),e.pXf(1,6),e.k0s())}function uN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",26,3),e.nI1(2,"elementID"),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.handleChapterClick(s))}),e.nrm(3,"div",27),e.nI1(4,"async"),e.j41(5,"div",28),e.EFF(6),e.k0s(),e.DNE(7,pN,2,0,"span",29),e.nI1(8,"async"),e.k0s()}if(2&n){const o=t.$implicit,i=t.index,s=e.XpG();e.Y8G("ngClass",e.eq3(14,sN,s.isViewed(o.id))),e.BMQ("data-chapter-id",e.bMT(2,8,o.id)),e.R7$(3),e.Y8G("ngClass",e.eq3(16,rN,o.id===e.bMT(4,10,s.selectedChapterId$)))("defaultImage",s.defaultImage)("lazyLoad",s.getChapterThumb(o.id)),e.R7$(3),e.Lme(" ",i+1,": ",s.getFormattedChapterTitle(o.displayName,i)," "),e.R7$(),e.Y8G("ngIf",o.id===e.bMT(8,12,s.selectedChapterId$))}}class fo{constructor(t,o){this.viewService=t,this.store=o,this.viewUI=G,this.showTitle=!0,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png",this.ngUnsubscribe=new Q.B}getChapterThumb(t){const i=this.store.selectSnapshot(to.K.getRegisteredThumbnails).get(t);return i?i.snapshot||i.urls.small:""}getFormattedChapterTitle(t,o){return t||$localize`Chapter`+` ${o+1}`}isViewed(t){return this.store.selectSnapshot(fe.N.getChaptersViewed).some(o=>o===t)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterMenuOpen(){setTimeout(()=>{this.scrollToSelectedChapter()})}handleNextClick(){this.viewService.nextChapter("titleOnly")}handleChapterClick(t){this.viewService.selectChapter(t)}handlePreviousClick(){this.viewService.previousChapter("titleOnly")}scrollToSelectedChapter(){const t=ZS(this.store.selectSnapshot(fe.N.getSelectedChapterId));this.chapters.find(i=>i.nativeElement.dataset.chapterId===t)?.nativeElement.scrollIntoView({block:"center"})}}(Al=fo).\u0275fac=function(t){return new(t||Al)(e.rXU(hn),e.rXU(l.il))},Al.\u0275cmp=e.VBU({type:Al,selectors:[["app-view-title-only"]],viewQuery:function(t,o){if(1&t&&(e.GBs(iN,5),e.GBs(oN,5,e.aKT)),2&t){let i;e.mGM(i=e.lsd())&&(o.chapterMenuTrigger=i.first),e.mGM(i=e.lsd())&&(o.chapters=i)}},inputs:{showTitle:"showTitle"},decls:9,vars:7,consts:()=>{let n,t,o;return n=$localize`:0498f53592b97136a56a48a29c54aea03a15b5e09209125563388589034:Chapter List`,t=$localize`:169eed2bc3e08e1bea977bcc5d799379f6b8a7585881876145178332550:of`,o=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["staticTitle",""],["chapterMenu","matMenu"],["chapterMenuTrigger","matMenuTrigger"],["chapter",""],n,t,o,["orientation","horizontal","data-test","viewTitleOnly","appPreventFadeout","",1,"relative"],["class","flex w-full","style","min-width: 0",4,"ngIf","ngIfElse"],[1,"view-chapters"],["mat-menu-item","","class","view-chapters__item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"flex","w-full",2,"min-width","0"],["data-test","viewFloatingPagination","buttonSize","small","iconSize","lg",3,"showCount",4,"ngIf"],[4,"ngIf"],["data-test","viewFloatingPagination","buttonSize","small","iconSize","lg",3,"showCount"],["app-view-button","","data-test","viewChaptersButton","buttonSize","small",1,"w-full",2,"min-width","0",3,"menuOpened","matMenuTriggerFor"],[1,"flex","flex-row","w-full"],[1,"grow",2,"overflow","hidden","text-align","start","padding","0 8px"],[1,"sr-only"],[1,"view-title-only__title","view-title-only__title--truncated"],[1,"view-title-only__count"],[1,"view-title-only__icon"],["icon","angle-down","size","lg"],["class","view-title-only__title view-title-only__title--static","data-test","viewStaticTitle",4,"ngIf"],["data-test","viewStaticTitle",1,"view-title-only__title","view-title-only__title--static"],[1,"view-title-only__title--truncated"],["mat-menu-item","",1,"view-chapters__item",3,"click","ngClass"],[1,"view-chapters__thumb",3,"ngClass","defaultImage","lazyLoad"],[1,"view-chapters__title"],["class","sr-only",4,"ngIf"]]},template:function(t,o){if(1&t&&(e.j41(0,"app-pillbox",7),e.DNE(1,cN,4,4,"div",8),e.nI1(2,"async"),e.DNE(3,_N,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.j41(5,"mat-menu",9,1),e.DNE(7,uN,9,18,"button",10),e.nI1(8,"async"),e.k0s()),2&t){const i=e.sdS(4);e.R7$(),e.Y8G("ngIf",e.bMT(2,3,o.paginationVisible$))("ngIfElse",i),e.R7$(6),e.Y8G("ngForOf",e.bMT(8,5,o.chapters$))}},dependencies:[rn,q.YU,q.Sq,q.bT,Us,yt.R,is.Je,ei.kk,ei.fb,ei.Cp,Do,sd,os,q.Jj,nN],styles:[".view-title-only{display:flex;align-items:center}.view-title-only__title{font-size:.875rem;line-height:1.25rem;font-weight:600;color:#131c2a}.view-title-only__title--static{padding:0 12px;min-height:40px;display:flex;align-items:center;min-width:0}.view-title-only__title--truncated{overflow:hidden;text-overflow:ellipsis}.view-title-only__count{font-size:10px;text-transform:uppercase;color:#374a68}.view-title-only__icon{display:flex;align-items:center;padding:0 8px}.view-chapters{min-width:300px;max-height:228px;overflow:auto}.view-chapters button.mat-mdc-menu-item{width:100%;height:auto;font-size:.75rem;line-height:1rem}.view-chapters div.mat-mdc-menu-content{padding:0}.view-chapters .mat-mdc-menu-item-text{display:flex;line-height:1.4em!important}.view-chapters__item{height:auto;white-space:normal;display:flex!important;padding:12px 20px!important;background-color:transparent;width:240px;transition:background-color 125ms,color 125ms}.view-chapters__item:first-of-type{border-top-left-radius:4px;border-top-right-radius:4px}.view-chapters__item:last-of-type{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.view-chapters__item:hover{cursor:pointer;background:#eaeff5}.view-chapters__item--selected{background-color:#2d72dc!important;--mat-menu-item-label-text-color: #ffffff}.view-chapters__thumb{background-size:cover;background-color:#f9fafd;border-radius:4px;background-repeat:no-repeat;border:2px solid white;flex:0 0 52px;height:52px;width:52px;transition:border-color .1s}.view-chapters__title{overflow-wrap:break-word;padding-inline-start:16px;word-break:break-word;white-space:normal;display:flex;flex-grow:1;font-weight:500}\n"],encapsulation:2,changeDetection:0}),ls([(0,l.l6)(fe.N.getSelectedChapterTitle),cs("design:type",y.c)],fo.prototype,"chapterTitle$",void 0),ls([(0,l.l6)(fe.N.getSelectedChapterIndex),cs("design:type",y.c)],fo.prototype,"chapterIndex$",void 0),ls([(0,l.l6)(fe.N.getChapterCount),cs("design:type",y.c)],fo.prototype,"chapterCount$",void 0),ls([(0,l.l6)(fe.N.getStoryChapters),cs("design:type",y.c)],fo.prototype,"chapters$",void 0),ls([(0,l.l6)(fe.N.getSelectedChapterId),cs("design:type",y.c)],fo.prototype,"selectedChapterId$",void 0),ls([(0,l.l6)(to.K.getRegisteredThumbnails),cs("design:type",y.c)],fo.prototype,"thumbnails$",void 0),ls([(0,l.l6)(fe.N.getChaptersViewed),cs("design:type",y.c)],fo.prototype,"chaptersViewed$",void 0),ls([(0,l.l6)(Be.getVisible(G.Pagination)),cs("design:type",y.c)],fo.prototype,"paginationVisible$",void 0);let gN=(()=>{var n;class t{constructor(i,s){this.dialogRef=i,this.data=s,this.config=s}handleCloseClick(){this.dialogRef.close()}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(Dt.Vh))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-video-dialog"]],decls:4,vars:2,consts:[["role","dialog","aria-modal","true",1,"video-dialog"],["mode","full",1,"video-dialog__video",3,"sources"],["type","button","app-view-button","","buttonShape","rounded","buttonTheme","white","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"video-dialog__close",3,"click"],["icon","times"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.nrm(1,"app-video-view",1),e.j41(2,"button",2),e.bIt("click",function(){return s.handleCloseClick()}),e.nrm(3,"app-icon",3),e.k0s()()),2&i&&(e.BMQ("aria-label",(s.config.title||"")+" Video Dialog"),e.R7$(),e.Y8G("sources",s.config.videoSources))},dependencies:[yt.R,cS,rn],styles:[".video-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.video-dialog__video[_ngcontent-%COMP%]{display:block;max-width:100%}.video-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;inset-inline-end:24px}"],changeDetection:0}),t})();const ku=[{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.mpd",type:"application/dash+xml"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.m3u8",type:"application/x-mpegURL"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.0000022.jpg",type:"image/jpeg"}];var Xs,Bi=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Zt=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};let An=((Xs=class{constructor(t){this.store=t}static getStacksForChapter(t){return t.stacksForChapter??{}}static getUndoStack(t,o){return t[o]?.undoStack??[]}static getRedoStack(t,o){return t[o]?.redoStack??[]}static canUndo(t){return t.length>0}static canRedo(t){return t.length>0}static getUndoCount(t){return t.length}reset(t,o){t.patchState(Nn.jM(t.getState(),i=>{i.stacksForChapter={}}))}undoAll(t,o){const i=t.getState();if(void 0===i.stacksForChapter[o.chapterId])return;const s=[...i.stacksForChapter[o.chapterId].undoStack].reverse(),r=s.flat().reduce((d,f)=>{const{patchAction:T,inverse:L}=f,ee=T?.type;return d[ee]=d[ee]??{actionClass:T,patches:[]},d[ee].patches.push(...L),d},{});Object.keys(r).forEach(d=>{const{actionClass:f,patches:T}=r[d];t.dispatch(new f(T))});const a=Nn.jM(i,d=>{d.stacksForChapter[o.chapterId].undoStack=[],d.stacksForChapter[o.chapterId].redoStack=s});t.patchState(a)}preserveState(t,o){const i=this.store.selectSnapshot(fe.N.getSelectedChapterId),s=Nn.jM(t.getState(),r=>{0===o.patches.length||o.patches.some(d=>0===d.forward.length)&&o.patches.some(d=>0===d.inverse.length)||(void 0===r.stacksForChapter[i]&&(r.stacksForChapter[i]={redoStack:[],undoStack:[]}),r.stacksForChapter[i].redoStack=[],r.stacksForChapter[i].undoStack.push(o.patches))});t.patchState(s)}redo(t,o){const i=t.getState(),s=(0,m.get)(i.stacksForChapter[o.chapterId],"redoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=Nn.jM(i,d=>{d.stacksForChapter[o.chapterId].redoStack.pop(),d.stacksForChapter[o.chapterId].undoStack.push(r)});t.patchState(a),r.forEach(d=>{t.dispatch(new d.patchAction(d.forward))})}undo(t,o){const i=t.getState(),s=(0,m.get)(i.stacksForChapter[o.chapterId],"undoStack",[]);if(0===s.length)return;const r=s[s.length-1],a=Nn.jM(i,d=>{d.stacksForChapter[o.chapterId].undoStack.pop(),d.stacksForChapter[o.chapterId].redoStack.push(r)});t.patchState(a),r.forEach(d=>{t.dispatch(new d.patchAction(d.inverse))})}}).\u0275fac=function(t){return new(t||Xs)(e.KVO(l.il))},Xs.\u0275prov=e.jDH({token:Xs,factory:Xs.\u0275fac}),Xs);Bi([(0,l.rc)(di.a.Reset),Zt("design:type",Function),Zt("design:paramtypes",[Object,di.a.Reset]),Zt("design:returntype",void 0)],An.prototype,"reset",null),Bi([(0,l.rc)(di.a.UndoAll),Zt("design:type",Function),Zt("design:paramtypes",[Object,di.a.UndoAll]),Zt("design:returntype",void 0)],An.prototype,"undoAll",null),Bi([(0,l.rc)(di.a.SavePatches),Zt("design:type",Function),Zt("design:paramtypes",[Object,di.a.SavePatches]),Zt("design:returntype",void 0)],An.prototype,"preserveState",null),Bi([(0,l.rc)(di.a.Redo),Zt("design:type",Function),Zt("design:paramtypes",[Object,di.a.Redo]),Zt("design:returntype",void 0)],An.prototype,"redo",null),Bi([(0,l.rc)(di.a.Undo),Zt("design:type",Function),Zt("design:paramtypes",[Object,di.a.Undo]),Zt("design:returntype",void 0)],An.prototype,"undo",null),Bi([(0,l.MD)([An]),Zt("design:type",Function),Zt("design:paramtypes",[Object]),Zt("design:returntype",Object)],An,"getStacksForChapter",null),Bi([(0,l.MD)([An.getStacksForChapter,fe.N.getSelectedChapterId]),Zt("design:type",Function),Zt("design:paramtypes",[Object,String]),Zt("design:returntype",Array)],An,"getUndoStack",null),Bi([(0,l.MD)([An.getStacksForChapter,fe.N.getSelectedChapterId]),Zt("design:type",Function),Zt("design:paramtypes",[Object,String]),Zt("design:returntype",Array)],An,"getRedoStack",null),Bi([(0,l.MD)([An.getUndoStack]),Zt("design:type",Function),Zt("design:paramtypes",[Array]),Zt("design:returntype",Boolean)],An,"canUndo",null),Bi([(0,l.MD)([An.getRedoStack]),Zt("design:type",Function),Zt("design:paramtypes",[Array]),Zt("design:returntype",Boolean)],An,"canRedo",null),Bi([(0,l.MD)([An.getUndoStack]),Zt("design:type",Function),Zt("design:paramtypes",[Array]),Zt("design:returntype",Number)],An,"getUndoCount",null),An=Bi([(0,l.Um)({injectContainerState:!1}),(0,l.Uw)({name:"undo",defaults:{stacksForChapter:{}}}),Zt("design:paramtypes",[l.il])],An);var Nl,Lu=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Uu=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};class Rl{constructor(t,o,i){this.store=t,this.visibilityLayersService=o,this.changeDetectorRef=i,this.accessibleLabel=$localize`layer slider`,this.percent=100,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initIndexPositionObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initIndexPositionObserver(){(0,Ht.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,S.p)(([t,o,i])=>!(0,m.isNil)(t)&&!(0,m.isNil)(o)&&!(0,m.isNil)(i)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{const s=this.visibilityLayersService.indexPositionToFraction(i,t,o);this.percent=this.visibilityLayersService.fractionToPercent(s),this.changeDetectorRef.markForCheck()})}handleDragEnded(t){this.syncSliderLayers(t,!1,!0)}handleTrackClicked(t){this.syncSliderLayers(t,!1,!0)}handlePercentChanged(t){this.syncSliderLayers(t,!0,!1)}syncSliderLayers(t,o,i){const s=this.store.selectSnapshot(fe.N.getSelectedChapterId),r=this.store.selectSnapshot(fe.N.getSelectedChapterCurrentLayers),a=this.visibilityLayersService.percentToFraction(t),d=this.visibilityLayersService.fractionToIndex(r,a),f=this.visibilityLayersService.fractionToPosition(r,a,d);o&&this.visibilityLayersService.syncLayersToScene(r,d,f,!1),i&&this.visibilityLayersService.syncLayersToState(s,d,f)}}(Nl=Rl).\u0275fac=function(t){return new(t||Nl)(e.rXU(l.il),e.rXU(No),e.rXU(e.gRc))},Nl.\u0275cmp=e.VBU({type:Nl,selectors:[["app-view-layers-slider"]],decls:4,vars:3,consts:()=>{let n;return n=$localize`:78670204058ee08d827f2323fab98b7520c7c51e7032204075609591368: Changing the value of the slider will modify visibility of different layers of the model `,[n,[1,"flex","justify-center","w-full",2,"height","200px"],[1,"sr-only"],["sliderAxis","y",3,"percentChanged","dragEnded","trackClicked","percent","showTrack","accessibleLabel"]]},template:function(t,o){1&t&&(e.j41(0,"div",1)(1,"span",2),e.pXf(2,0),e.k0s(),e.j41(3,"app-view-slider",3),e.bIt("percentChanged",function(s){return o.handlePercentChanged(s)})("dragEnded",function(s){return o.handleDragEnded(s)})("trackClicked",function(s){return o.handleTrackClicked(s)}),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("percent",o.percent)("showTrack",!0)("accessibleLabel",o.accessibleLabel))},dependencies:[TS],styles:['.view-layers-slider[_ngcontent-%COMP%]{--track-width: 5px;height:200px;width:40px;display:flex;justify-content:center}.view-layers-slider--disabled[_ngcontent-%COMP%]{opacity:.25;pointer-events:none}.view-layers-slider__group[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;width:28px;height:100%}.view-layers-slider__track[_ngcontent-%COMP%]{cursor:pointer;position:absolute;background:#96a8c099;z-index:1;width:var(--track-width);border-radius:var(--track-width);top:14px;bottom:14px}.view-layers-slider__bar[_ngcontent-%COMP%]{position:absolute;background:#374a68;width:var(--track-width);border-radius:var(--track-width);z-index:2;height:0;top:0;pointer-events:none}.view-layers-slider__handle[_ngcontent-%COMP%]{cursor:pointer;width:28px;height:28px;margin-top:-14px;top:14px;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-layers-slider__handle[_ngcontent-%COMP%]:focus{outline:none;border:none}.view-layers-slider__handle--hide[_ngcontent-%COMP%]{display:none}.view-layers-slider__handle[_ngcontent-%COMP%]:after{content:"";width:12px;height:12px;border-radius:6px;background:#374a68;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-layers-slider__handle[_ngcontent-%COMP%]:hover:after, .view-layers-slider__handle[_ngcontent-%COMP%]:focus:after{background:#2d72dc}'],changeDetection:0}),Lu([(0,l.l6)(fe.N.getSelectedChapterCurrentLayers),Uu("design:type",y.c)],Rl.prototype,"selectedChapterCurrentLayers$",void 0),Lu([(0,l.l6)(fe.N.getSelectedChapterCurrentLayersIndex),Uu("design:type",y.c)],Rl.prototype,"selectedChapterCurrentLayersIndex$",void 0),Lu([(0,l.l6)(fe.N.getSelectedChapterCurrentLayersPosition),Uu("design:type",y.c)],Rl.prototype,"selectedChapterCurrentLayersPosition$",void 0);var Dl,cn=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},dn=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const mN=["viewMenu"],fN=["viewQuizMenu"],SN=n=>({"bg-blue-600 text-white":n}),bN=n=>({"font-bold":n});function yN(n,t){1&n&&e.nrm(0,"app-icon",43)}function vN(n,t){1&n&&e.nrm(0,"app-icon",44)}function EN(n,t){1&n&&e.nrm(0,"app-icon",45)}function CN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",38),e.bIt("mousedown",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSecretXRTriggerDown())})("mouseup",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSecretXRTriggerUp())})("touchstart",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSecretXRTriggerDown())})("touchend",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSecretXRTriggerUp())}),e.j41(1,"div",39),e.nI1(2,"async"),e.DNE(3,yN,1,0,"app-icon",40)(4,vN,1,0,"app-icon",41)(5,EN,1,0,"app-icon",42),e.k0s()()}if(2&n){const o=e.XpG(2),i=e.sdS(29);e.Y8G("matMenuTriggerFor",i)("matTooltipPosition",o.tooltipPosition),e.R7$(),e.Y8G("ngSwitch",e.bMT(2,5,o.activeTool$)),e.R7$(3),e.Y8G("ngSwitchCase",o.toolEnum.Hide),e.R7$(),e.Y8G("ngSwitchCase",o.toolEnum.Fade)}}function TN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",46),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleLayers())}),e.nrm(4,"app-icon",47),e.k0s()}if(2&n){let o;const i=e.XpG(2);e.Y8G("buttonTheme","show"===(null==(o=e.bMT(1,4,i.visibilityLayersUI$))?null:o.status)?"blue-fill":"transparent-fill")("matTooltipPosition",i.tooltipPosition),e.BMQ("data-test-visibility-layers",e.bMT(2,6,i.visibilityLayersVisible$))("data-test-skin-layers",e.bMT(3,8,i.skinLayersVisible$))}}function ON(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",48),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSearch())}),e.nrm(3,"app-icon",49),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("buttonTheme","show"===e.bMT(1,3,o.searchStatus$)?"blue-fill":"transparent-fill")("matTooltipPosition",o.tooltipPosition),e.BMQ("aria-pressed","show"===e.bMT(2,5,o.searchStatus$))}}function MN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",50),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleDraw())}),e.nrm(1,"app-icon",51),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("matTooltipPosition",o.tooltipPosition)}}function IN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",53),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.toggleXRModeClick("immersive-vr"))}),e.nrm(4,"app-icon",54),e.k0s()}if(2&n){const o=e.XpG(3);e.Y8G("matTooltip",e.bMT(1,4,o.xrActive$)?"Exit VR":"Enter VR")("matTooltipPosition",o.tooltipPosition)("disabled","immersive-ar"===e.bMT(2,6,o.xrSessionMode$)),e.BMQ("aria-label",e.bMT(3,8,o.xrActive$)?"Exit VR":"Enter VR")}}function wN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",53),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.toggleXRModeClick("immersive-ar"))}),e.nrm(4,"app-icon",55),e.k0s()}if(2&n){const o=e.XpG(3);e.Y8G("matTooltip",e.bMT(1,4,o.xrActive$)?"Exit AR":"Enter AR")("matTooltipPosition",o.tooltipPosition)("disabled","immersive-vr"===e.bMT(2,6,o.xrSessionMode$)),e.BMQ("aria-label",e.bMT(3,8,o.xrActive$)?"Exit AR":"Enter AR")}}function PN(n,t){if(1&n&&(e.qex(0),e.DNE(1,IN,5,10,"button",52),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,wN,5,10,"button",52),e.nI1(5,"async"),e.nI1(6,"async"),e.bVm()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.xrSupportedModes$)["immersive-vr"]&&e.bMT(3,4,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small),e.R7$(3),e.Y8G("ngIf",e.bMT(5,6,o.xrSupportedModes$)["immersive-ar"]&&e.bMT(6,8,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small)}}function AN(n,t){if(1&n&&(e.qex(0),e.DNE(1,CN,6,7,"button",34),e.nI1(2,"async"),e.DNE(3,TN,5,10,"button",35),e.nI1(4,"async"),e.DNE(5,ON,4,7,"button",36),e.nI1(6,"async"),e.DNE(7,MN,2,1,"button",37),e.nI1(8,"async"),e.DNE(9,PN,7,10,"ng-container",22),e.nI1(10,"async"),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,5,o.toolsVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,7,o.visibilityLayersVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(6,9,o.searchVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(8,11,o.whiteboardVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(10,13,o.xrEnabled$))}}function NN(n,t){if(1&n&&(e.j41(0,"button",56),e.nI1(1,"async"),e.nrm(2,"app-icon",57),e.k0s()),2&n){const o=e.XpG(),i=e.sdS(10),s=e.sdS(33);e.Y8G("matMenuTriggerFor",e.bMT(1,2,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small?s:i)("matTooltipPosition",o.tooltipPosition)}}function RN(n,t){1&n&&(e.j41(0,"app-pillbox",58),e.nrm(1,"app-view-layers-slider"),e.k0s())}function DN(n,t){1&n&&e.nrm(0,"app-icon",68)}function kN(n,t){1&n&&e.nrm(0,"app-icon",69)}function LN(n,t){1&n&&e.nrm(0,"app-icon",70)}function UN(n,t){if(1&n&&(e.j41(0,"button",63),e.qex(1,64),e.nI1(2,"async"),e.DNE(3,DN,1,0,"app-icon",65)(4,kN,1,0,"app-icon",66)(5,LN,1,0,"app-icon",67),e.bVm(),e.qex(6),e.pXf(7,8),e.bVm(),e.k0s()),2&n){const o=e.XpG(2),i=e.sdS(29);e.Y8G("matMenuTriggerFor",i),e.R7$(),e.Y8G("ngSwitch",e.bMT(2,4,o.activeTool$)),e.R7$(3),e.Y8G("ngSwitchCase",o.toolEnum.Hide),e.R7$(),e.Y8G("ngSwitchCase",o.toolEnum.Fade)}}function jN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",71),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleLayers())}),e.nrm(3,"app-icon",72),e.qex(4),e.pXf(5,9),e.bVm(),e.k0s()}if(2&n){const o=e.XpG(2);e.BMQ("data-test-visibility-layers",e.bMT(1,2,o.visibilityLayersVisible$))("data-test-skin-layers",e.bMT(2,4,o.skinLayersVisible$))}}function VN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",73),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSearch())}),e.nrm(1,"app-icon",74),e.qex(2),e.pXf(3,10),e.bVm(),e.k0s()}}function xN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",75),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleDraw())}),e.nrm(1,"app-icon",76),e.qex(2),e.pXf(3,11),e.bVm(),e.k0s()}}function FN(n,t){1&n&&(e.qex(0),e.pXf(1,12),e.bVm())}function GN(n,t){1&n&&(e.qex(0),e.pXf(1,13),e.bVm())}function $N(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",78),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.toggleXRModeClick("immersive-vr"))}),e.nrm(2,"app-icon",79),e.DNE(3,FN,2,0,"ng-container",22),e.nI1(4,"async"),e.DNE(5,GN,2,0,"ng-container",22),e.nI1(6,"async"),e.k0s()}if(2&n){const o=e.XpG(3);e.Y8G("disabled","immersive-ar"===e.bMT(1,3,o.xrSessionMode$)),e.R7$(3),e.Y8G("ngIf",e.bMT(4,5,o.xrActive$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(6,7,o.xrActive$))}}function BN(n,t){1&n&&(e.qex(0),e.pXf(1,14),e.bVm())}function zN(n,t){1&n&&(e.qex(0),e.pXf(1,15),e.bVm())}function WN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",78),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.toggleXRModeClick("immersive-ar"))}),e.nrm(2,"app-icon",80),e.DNE(3,BN,2,0,"ng-container",22),e.nI1(4,"async"),e.DNE(5,zN,2,0,"ng-container",22),e.nI1(6,"async"),e.k0s()}if(2&n){const o=e.XpG(3);e.Y8G("disabled","immersive-vr"===e.bMT(1,3,o.xrSessionMode$)),e.R7$(3),e.Y8G("ngIf",e.bMT(4,5,o.xrActive$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(6,7,o.xrActive$))}}function XN(n,t){if(1&n&&(e.qex(0),e.DNE(1,$N,7,9,"button",77),e.nI1(2,"async"),e.DNE(3,WN,7,9,"button",77),e.nI1(4,"async"),e.bVm()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.xrSupportedModes$)["immersive-vr"]),e.R7$(2),e.Y8G("ngIf",e.bMT(4,4,o.xrSupportedModes$)["immersive-ar"])}}function HN(n,t){if(1&n&&(e.qex(0),e.DNE(1,UN,8,6,"button",59),e.nI1(2,"async"),e.DNE(3,jN,6,6,"button",60),e.nI1(4,"async"),e.nI1(5,"async"),e.DNE(6,VN,4,0,"button",61),e.nI1(7,"async"),e.DNE(8,xN,4,0,"button",62),e.nI1(9,"async"),e.DNE(10,XN,5,6,"ng-container",22),e.nI1(11,"async"),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,5,o.toolsVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,7,o.visibilityLayersVisible$)&&e.bMT(5,9,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),e.R7$(3),e.Y8G("ngIf",e.bMT(7,11,o.searchVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(9,13,o.whiteboardVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(11,15,o.xrEnabled$))}}function QN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",82),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG(2);return e.Njj(r.handleSelectTool(s.id))}),e.j41(1,"div",83)(2,"div",84),e.nI1(3,"async"),e.nrm(4,"app-icon",85),e.k0s(),e.j41(5,"div",86),e.nI1(6,"async"),e.EFF(7),e.k0s()()()}if(2&n){const o=t.$implicit,i=e.XpG(2);e.BMQ("data-test","viewQuizTools"+o.label),e.R7$(2),e.Y8G("ngClass",e.eq3(9,SN,e.bMT(3,5,i.activeTool$)===o.id)),e.R7$(2),e.Y8G("icon",o.icon),e.R7$(),e.Y8G("ngClass",e.eq3(11,bN,e.bMT(6,7,i.activeTool$)===o.id)),e.R7$(2),e.SpI(" ",o.label," ")}}function YN(n,t){if(1&n&&(e.qex(0),e.Z7z(1,QN,8,13,"button",81,e.Vm6),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Dyx(o.tools)}}function KN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",87),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleTakeQuiz())}),e.nrm(3,"app-icon",88),e.qex(4),e.pXf(5,16),e.bVm(),e.k0s()}if(2&n){let o;const i=e.XpG();e.Y8G("disabled",!(null!=(o=e.bMT(1,1,i.selectedChapterReady$))&&o.model)||e.bMT(2,3,i.quizActive$))}}function JN(n,t){1&n&&(e.qex(0),e.pXf(1,17),e.bVm())}function qN(n,t){1&n&&(e.qex(0),e.pXf(1,18),e.bVm())}function ZN(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",89),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleLabels())}),e.DNE(1,JN,2,0,"ng-container",22),e.nI1(2,"async"),e.DNE(3,qN,2,0,"ng-container",22),e.nI1(4,"async"),e.k0s()}if(2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.showLabels$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(4,4,o.showLabels$))}}function eR(n,t){if(1&n&&(e.qex(0),e.j41(1,"button",90),e.pXf(2,19),e.k0s(),e.bVm()),2&n){e.XpG();const o=e.sdS(18);e.R7$(),e.Y8G("matMenuTriggerFor",o)}}class an{constructor(t,o,i,s,r,a,d){this.viewService=t,this.viewUIService=o,this.quizService=i,this.dialog=s,this.store=r,this.directionality=a,this.activatedRoute=d,this.toolEnum=qt.s,this.horizontalBreakpoint=Vn,this.canvasHeightBreakpoint=Mo.h,this.viewUI=G,this.viewUIStatus=at,this.bookmarkViewMode=Ne,this.ngUnsubscribe=new Q.B,this.tools=[{id:qt.s.Select,label:$localize`Select`,icon:"mouse-pointer"},{id:qt.s.Hide,label:$localize`Hide`,icon:"eye-slash"},{id:qt.s.Fade,label:$localize`Fade`,icon:"adjust"}],this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}ngOnInit(){this.checkSecretXRTrigger()}ngOnDestroy(){clearTimeout(this.xrTimeout),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}checkSecretXRTrigger(){const t=this.activatedRoute.snapshot.queryParamMap.get("xr");(0,m.isNil)(t)||this.store.dispatch(new ai.SetEnabled("true"===t))}handleSecretXRTriggerDown(){this.xrTimeout=setTimeout(()=>{const o=this.store.selectSnapshot(Ln.getXREnabled);this.store.dispatch(new ai.SetEnabled(!o))},1e4)}handleSecretXRTriggerUp(){clearTimeout(this.xrTimeout)}handleSearch(){this.viewService.toggleSearch()}handleDraw(){this.viewService.toggleWhiteboard(!0)}handleSelectTool(t){(0,m.isNil)(t)||this.viewService.selectTool(t)}handleLayers(){this.viewService.toggleLayers()}handleToggleLabels(){this.viewService.showLabels()}handleTakeQuiz(){this.quizService.startQuiz()}handleHelpShortcuts(){this.viewService.toggleHelp(v.Shortcuts)}handleHelpBasics(){this.viewService.toggleHelp(v.Basics)}handlePlaythrough(t){this.viewService.togglePlaythrough(t)}handleTutorial(){this.viewService.toggleTutorial(!0)}handleVideo(t){this.dialog.open(gN,{id:go.VideoDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{videoSources:ku}}),t.stopPropagation()}isEnabled(t){return this.viewUIService.isUIEnabled(t)}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}toggleXRModeClick(t){this.store.selectSnapshot(Ln.getXRSessionMode)?this.store.dispatch(new ai.ExitXR(!1)):this.store.dispatch(new ai.EnterXR(t))}openRemoteQuest(){const t=new URL("https://oculus.com/open_url/");t.searchParams.set("url",location.href),window.open(t,"__blank")}}(Dl=an).\u0275fac=function(t){return new(t||Dl)(e.rXU(hn),e.rXU(Fc),e.rXU(Mr),e.rXU(Dt.bZ),e.rXU(l.il),e.rXU(qo.dS),e.rXU(ne.nX))},Dl.\u0275cmp=e.VBU({type:Dl,selectors:[["app-view-toolbar"]],viewQuery:function(t,o){if(1&t&&(e.GBs(mN,5),e.GBs(fN,5)),2&t){let i;e.mGM(i=e.lsd())&&(o.viewMenu=i.first),e.mGM(i=e.lsd())&&(o.viewQuizMenu=i.first)}},decls:45,vars:43,consts:()=>{let n,t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n,ft,ze,Je;return n=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,t=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,o=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,i=$localize`:ac0f81713a84217c9bd1d9bb460245d8190b073f5937251202465808296:More`,s=$localize`:58083a2c0d5c2b2184981c0887b01d1b3795eb613384117902239564995:Getting Started Video`,r=$localize`:27469d782d17f88ac1d4bbb5ab0715a83be9bfec1108080934572452765:3D Navigation Tutorial`,a=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,d=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,f=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,T=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,L=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,ee=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,re=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,ve=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,Oe=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,Ee=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,Re=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,Fe=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,Ke=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,it=$localize`:d8f00947439583705b11afdb26b3606125755d7b1909228686165085461:Exit VR`,pt=$localize`:5830a413540a273b819289949937046a450e5d1d3237949197627908261:Enter VR`,Mt=$localize`:1d0d80fb57ed2c1c18d12b2df218541387455b4d6343763191422968223:Exit AR`,$t=$localize`:ea19499751215e7ca470be4008a3fc22ed1281467143676568850518157:Enter AR`,_n=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,ft=$localize`:0176531c3e308e6a4f5dd4776a054145a1a6f2f34142825283571551211:Hide Labels`,ze=$localize`:5a595fd88f56c04bacea3ea933dd02f98f2131506701808385090866243:Show Labels`,Je=$localize`:79b5cb803980738a667e2f41746369c1efc9b0b11685423440406455552: Help `,[["viewMenu","matMenu"],["helpMenu","matMenu"],["selectionToolsMenu","matMenu"],["moreMenu","matMenu"],i,s,r,a,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n,ft,ze,Je,["data-test","viewToolbar",1,"view-toolbar"],["orientation","vertical","role","group","aria-label",n,"appPreventFadeout","",1,"view-toolbar__main"],[4,"ngIf"],["type","button","data-test","viewMenuButton","matTooltip",t,"app-view-button","","buttonSize","small","aria-label",o,3,"matMenuTriggerFor","matTooltipPosition",4,"ngIf"],["appPreventFadeout","","orientation","vertical","class","view-toolbar__tools","data-test","viewLayers",4,"ngIf"],["data-test","viewMenu",1,"view-menu",3,"overlapTrigger"],["mat-menu-item","","data-test","viewMoreMenuButton",3,"matMenuTriggerFor"],[1,"view-menu"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","viewLaunchTutorial",3,"click","disabled"],["mat-menu-item","","data-test","viewKeyboardShortcuts",3,"click"],["data-test","selectionToolsMenu",1,"view-menu"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"disabled","click",4,"ngIf"],["mat-menu-item","","data-test","viewToggleLabels",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","buttonTheme","transparent-fill","data-test","viewToolsButton","aria-label",d,"matTooltip",f,3,"matMenuTriggerFor","matTooltipPosition","mousedown","mouseup","touchstart","touchend",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",T,"matTooltip",L,3,"buttonTheme","matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",ee,"matTooltip",re,3,"buttonTheme","matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",ve,"matTooltip",Oe,3,"matTooltipPosition","click",4,"ngIf"],["app-view-button","","buttonSize","small","buttonTheme","transparent-fill","data-test","viewToolsButton","aria-label",d,"matTooltip",f,3,"mousedown","mouseup","touchstart","touchend","matMenuTriggerFor","matTooltipPosition"],[1,"relative","flex","justify-center",3,"ngSwitch"],["size","lg","icon","mouse-pointer",4,"ngSwitchDefault"],["size","lg","icon","eye-slash",4,"ngSwitchCase"],["size","lg","icon","adjust",4,"ngSwitchCase"],["size","lg","icon","mouse-pointer"],["size","lg","icon","eye-slash"],["size","lg","icon","adjust"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",T,"matTooltip",L,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","sliders-simple"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",ee,"matTooltip",re,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","magnifying-glass"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",ve,"matTooltip",Oe,3,"click","matTooltipPosition"],["size","lg","icon","pen"],["app-view-button","","buttonSize","small",3,"matTooltip","matTooltipPosition","disabled","click",4,"ngIf"],["app-view-button","","buttonSize","small",3,"click","matTooltip","matTooltipPosition","disabled"],["size","lg","icon","head-side-goggles"],["size","lg","icon","glasses"],["type","button","data-test","viewMenuButton","matTooltip",t,"app-view-button","","buttonSize","small","aria-label",o,3,"matMenuTriggerFor","matTooltipPosition"],["size","lg","icon","ellipsis-vertical"],["appPreventFadeout","","orientation","vertical","data-test","viewLayers",1,"view-toolbar__tools"],["mat-menu-item","","data-test","viewToolsButton",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","","data-test","viewLayersButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewSearchButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewDrawButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","viewToolsButton",3,"matMenuTriggerFor"],[3,"ngSwitch"],["class","view-toolbar__menu-icon","size","lg","icon","mouse-pointer",4,"ngSwitchDefault"],["class","view-toolbar__menu-icon","size","lg","icon","eye-slash",4,"ngSwitchCase"],["class","view-toolbar__menu-icon","size","lg","icon","adjust",4,"ngSwitchCase"],["size","lg","icon","mouse-pointer",1,"view-toolbar__menu-icon"],["size","lg","icon","eye-slash",1,"view-toolbar__menu-icon"],["size","lg","icon","adjust",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewLayersButton",3,"click"],["size","lg","icon","sliders-simple",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewSearchButton",3,"click"],["size","lg","icon","magnifying-glass",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewDrawButton",3,"click"],["size","lg","icon","pen",1,"view-toolbar__menu-icon"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["size","lg","icon","head-side-goggles",1,"view-toolbar__menu-icon"],["size","lg","icon","glasses",1,"view-toolbar__menu-icon"],["mat-menu-item","",1,"!px-2"],["mat-menu-item","",1,"!px-2",3,"click"],[1,"flex","items-center","gap-2","pr-4"],["aria-hidden","",1,"flex","items-center","justify-center","w-8","h-8","rounded",3,"ngClass"],["size","lg","appLogicalDir","",3,"icon"],[3,"ngClass"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"click","disabled"],["size","lg","icon","user-graduate","appLogicalDir","",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewToggleLabels",3,"click"],["data-test","viewHelpMenuButton","mat-menu-item","",3,"matMenuTriggerFor"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",20)(1,"app-pillbox",21),e.DNE(2,AN,11,15,"ng-container",22),e.nI1(3,"async"),e.DNE(4,NN,3,4,"button",23),e.nI1(5,"async"),e.k0s(),e.DNE(6,RN,2,0,"app-pillbox",24),e.nI1(7,"async"),e.nI1(8,"async"),e.k0s(),e.j41(9,"mat-menu",25,0),e.nI1(11,"async"),e.DNE(12,HN,12,17,"ng-container",22),e.nI1(13,"async"),e.j41(14,"button",26),e.qex(15),e.pXf(16,4),e.bVm(),e.k0s()(),e.j41(17,"mat-menu",27,1)(19,"button",28),e.bIt("click",function(r){return e.eBV(i),e.Njj(o.handleVideo(r))}),e.pXf(20,5),e.k0s(),e.j41(21,"button",29),e.nI1(22,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleTutorial())}),e.qex(23),e.pXf(24,6),e.bVm(),e.k0s(),e.j41(25,"button",30),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleHelpShortcuts())}),e.qex(26),e.pXf(27,7),e.bVm(),e.k0s()(),e.j41(28,"mat-menu",31,2),e.DNE(30,YN,3,0,"ng-container",22),e.nI1(31,"async"),e.k0s(),e.j41(32,"mat-menu",27,3),e.DNE(34,KN,6,5,"button",32),e.nI1(35,"async"),e.nI1(36,"async"),e.nI1(37,"async"),e.nI1(38,"async"),e.nI1(39,"async"),e.nI1(40,"async"),e.DNE(41,ZN,5,6,"button",33),e.nI1(42,"async"),e.DNE(43,eR,3,1,"ng-container",22),e.nI1(44,"async"),e.k0s()}if(2&t){let i,s;const r=e.sdS(33);e.R7$(2),e.Y8G("ngIf",e.bMT(3,11,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Small),e.R7$(2),e.Y8G("ngIf",e.bMT(5,13,o.toolbarOverflowVisible$)),e.R7$(2),e.Y8G("ngIf","show"===(null==(i=e.bMT(7,15,o.visibilityLayersUI$))?null:i.status)&&"single"===(null==(i=e.bMT(8,17,o.visibilityLayersUI$))?null:i.layersMode)),e.R7$(3),e.Y8G("overlapTrigger",e.bMT(11,19,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),e.R7$(3),e.Y8G("ngIf",e.bMT(13,21,o.canvasHeightBreakpoint$)<o.canvasHeightBreakpoint.Standard),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(7),e.Y8G("disabled",!(null!=(s=e.bMT(22,23,o.selectedChapterReady$))&&s.model)),e.R7$(9),e.Y8G("ngIf",e.bMT(31,25,o.toolsVisible$)),e.R7$(4),e.Y8G("ngIf",e.bMT(35,27,o.hasQuiz$)&&e.bMT(36,29,o.quizEnabled$)&&e.bMT(37,31,o.quizPromptVisible$)&&!1===e.bMT(38,33,o.quizLocked$)&&e.bMT(39,35,o.selectedBookmarkViewMode$)!==o.bookmarkViewMode.Content&&e.bMT(40,37,o.isMobileWeb$)),e.R7$(7),e.Y8G("ngIf",e.bMT(42,39,o.toggleLabelsVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(44,41,o.helpVisible$))}},dependencies:[rn,q.YU,q.bT,q.ux,q.e1,q.fG,Us,$i.e,yt.R,ei.kk,ei.fb,ei.Cp,On.oV,Do,Rl,q.Jj],styles:[".view-toolbar[_ngcontent-%COMP%]{position:relative}.view-toolbar__menu-icon[_ngcontent-%COMP%]{display:inline-block;width:20px;text-align:center;margin-inline-end:4px}.view-toolbar__menu-icon--light[_ngcontent-%COMP%]{color:#374a68}.view-toolbar__tools[_ngcontent-%COMP%]{position:absolute;z-index:2;inset-inline-start:48px;top:0;width:40px}"],changeDetection:0}),cn([(0,l.l6)(Be.getVisible(G.Tools)),dn("design:type",y.c)],an.prototype,"toolsVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.VisibilityLayers)),dn("design:type",y.c)],an.prototype,"visibilityLayersVisible$",void 0),cn([(0,l.l6)(Be.getUIEntry(G.VisibilityLayers)),dn("design:type",y.c)],an.prototype,"visibilityLayersUI$",void 0),cn([(0,l.l6)(Be.getVisible(G.SkinLayers)),dn("design:type",y.c)],an.prototype,"skinLayersVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.Search)),dn("design:type",y.c)],an.prototype,"searchVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.Whiteboard)),dn("design:type",y.c)],an.prototype,"whiteboardVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.ToggleLabels)),dn("design:type",y.c)],an.prototype,"toggleLabelsVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.Help)),dn("design:type",y.c)],an.prototype,"helpVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.Playthrough)),dn("design:type",y.c)],an.prototype,"playthroughVisible$",void 0),cn([(0,l.l6)(Be.getVisible(G.ToolbarOverflow)),dn("design:type",y.c)],an.prototype,"toolbarOverflowVisible$",void 0),cn([(0,l.l6)(Be.getSearchStatus),dn("design:type",y.c)],an.prototype,"searchStatus$",void 0),cn([(0,l.l6)(In.getHorizontalBreakpoint),dn("design:type",y.c)],an.prototype,"horizontalBreakpoint$",void 0),cn([(0,l.l6)(Xe.S.getCanvasHeightBreakpoint),dn("design:type",y.c)],an.prototype,"canvasHeightBreakpoint$",void 0),cn([(0,l.l6)(Ue.j.hasQuiz),dn("design:type",y.c)],an.prototype,"hasQuiz$",void 0),cn([(0,l.l6)(Be.getVisible(G.QuizPrompt)),dn("design:type",y.c)],an.prototype,"quizPromptVisible$",void 0),cn([(0,l.l6)(Ue.j.getQuizEnabled),dn("design:type",y.c)],an.prototype,"quizEnabled$",void 0),cn([(0,l.l6)(Ue.j.getQuizModeLocked),dn("design:type",y.c)],an.prototype,"quizLocked$",void 0),cn([(0,l.l6)(Ue.j.getQuizModeActive),dn("design:type",y.c)],an.prototype,"quizActive$",void 0),cn([(0,l.l6)(Xe.S.getShowLabels),dn("design:type",y.c)],an.prototype,"showLabels$",void 0),cn([(0,l.l6)(Xe.S.getActiveTool),dn("design:type",y.c)],an.prototype,"activeTool$",void 0),cn([(0,l.l6)(fe.N.getSelectedChapterReadyState),dn("design:type",y.c)],an.prototype,"selectedChapterReady$",void 0),cn([(0,l.l6)(_t.getSelectedBookmarkViewMode),dn("design:type",y.c)],an.prototype,"selectedBookmarkViewMode$",void 0),cn([(0,l.l6)(_e.getIsMobileWeb),dn("design:type",y.c)],an.prototype,"isMobileWeb$",void 0),cn([(0,l.l6)(An.canUndo),dn("design:type",y.c)],an.prototype,"canUndo$",void 0),cn([(0,l.l6)(An.canRedo),dn("design:type",y.c)],an.prototype,"canRedo$",void 0),cn([(0,l.l6)(Be.getVisible(G.Undo)),dn("design:type",y.c)],an.prototype,"undoVisible$",void 0),cn([(0,l.l6)(Ln.getXREnabled),dn("design:type",y.c)],an.prototype,"xrEnabled$",void 0),cn([(0,l.l6)(Ln.getXRSessionMode),dn("design:type",y.c)],an.prototype,"xrSessionMode$",void 0),cn([(0,l.l6)(Ln.getXRSupportedModes),dn("design:type",y.c)],an.prototype,"xrSupportedModes$",void 0),cn([(0,l.l6)(Ln.getXRActive),dn("design:type",y.c)],an.prototype,"xrActive$",void 0);const tR=["app-view-rounded-button",""];function nR(n,t){if(1&n&&e.nrm(0,"app-icon",3),2&n){const o=e.XpG();e.Y8G("icon",o.icon)}}let iR=(()=>{var n;class t{constructor(){this.iconPlacement="left",this.compact=!1,this.buttonType="outline"}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["button","app-view-rounded-button",""]],inputs:{icon:"icon",iconPlacement:"iconPlacement",label:"label",compact:"compact",buttonType:"buttonType",shadow:"shadow"},attrs:tR,decls:4,vars:12,consts:[[1,"view-rounded-button"],["class","view-rounded-button__icon mx-1",3,"icon",4,"ngIf"],[1,"view-rounded-button__label","mx-1"],[1,"view-rounded-button__icon","mx-1",3,"icon"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,nR,1,1,"app-icon",1),e.j41(2,"div",2),e.EFF(3),e.k0s()()),2&i&&(e.AVh("view-rounded-button--outline","outline"===s.buttonType)("view-rounded-button--solid","solid"===s.buttonType)("view-rounded-button--shadow",s.shadow)("view-rounded-button--compact",s.compact)("view-rounded-button--reverse","right"===s.iconPlacement),e.R7$(),e.Y8G("ngIf",s.icon),e.R7$(2),e.JRh(s.label))},dependencies:[q.bT,yt.R],styles:["button[app-view-rounded-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all}button[app-view-rounded-button]:hover .view-rounded-button,button[app-view-rounded-button]:focus .view-rounded-button{color:#f9fafd;border-color:#f9fafd;background:#f9fafd40}button[app-view-rounded-button]:hover .view-rounded-button--solid,button[app-view-rounded-button]:focus .view-rounded-button--solid{border-color:#f9fafd40}.view-rounded-button{cursor:pointer;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:12px 16px;border-style:solid;border-width:1px;border-radius:24px;color:#f9fafd;border-color:#f9fafd}.view-rounded-button__label{font-size:1rem;line-height:1.5rem}.view-rounded-button--solid{color:#060502;border-color:#060502;background:#f9fafd}.view-rounded-button--shadow{box-shadow:0 0 8px #00000052}.view-rounded-button--reverse{flex-direction:row-reverse}.view-rounded-button--compact{padding:4px 8px}\n"],encapsulation:2,changeDetection:0}),t})();var Hs=function(n){return n.CameraZoom="camera-zoom",n.CameraRotate="camera-rotate",n.CameraPan="camera-pan",n.NodeSelection="node-selection",n}(Hs||{});function eb(n,t,o=1e3,i=.001){return ju(n).pipe((0,ga.Z)(t.getCameraZoom()),(0,le.T)(()=>t.getCameraZoom()),(0,Ds.J)(),(0,le.T)(([s,r])=>r-s),(0,S.p)(s=>Math.abs(s)>i),(0,Fn.B)(o))}function tb(n,t,o=125){return ju(n).pipe((0,ga.Z)(t.getLookDirection()),(0,le.T)(()=>t.getLookDirection()),(0,Ds.J)(),(0,le.T)(([i,s])=>function dR(n,t){return Rn.angle(n,t)>.001}(i,s)),(0,S.p)(i=>i),(0,Fn.B)(o))}function nb(n){return{camera:n.getCamera(),zoom:n.getCameraZoom()}}function ju(n){return n.getEvent(gt.X.CameraRested)}function ib(n){const{eye:t,look:o}=n,i=Rn.fromValues(t.x,t.y,t.z),s=Rn.fromValues(o.x,o.y,o.z),r=Rn.create();return Rn.sub(r,i,s),r}var ob=_(68545);const pR=["*",[["","slide-footer",""]]],uR=["*","[slide-footer]"];function gR(n,t){if(1&n&&(e.j41(0,"h2",6),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.title," ")}}function hR(n,t){if(1&n&&e.nrm(0,"img",7),2&n){const o=e.XpG(2);e.Y8G("src",o.image,e.B4B)("alt",o.alt)}}function mR(n,t){if(1&n&&(e.j41(0,"div",1),e.DNE(1,gR,2,1,"h2",2),e.j41(2,"article",3),e.SdG(3),e.k0s(),e.DNE(4,hR,1,2,"img",4),e.j41(5,"div",5),e.SdG(6,1),e.k0s()()),2&n){const o=e.XpG();e.AVh("slide--expanded","expanded"===o.spacing),e.Y8G("@refresh",void 0),e.R7$(),e.Y8G("ngIf",o.title),e.R7$(3),e.Y8G("ngIf",o.image)}}let Vu=(()=>{var n;class t{set shown(i){this._shown=i,this.initTrigger(),this.changeRef.markForCheck()}get shown(){return this._shown}constructor(i,s,r,a,d,f){this.store=i,this.actions=s,this.engineService=r,this.cameraService=a,this.engineRendererService=d,this.changeRef=f,this.alt="",this.spacing="compact",this.exitEnabled=!0,this.triggerDelay=300,this.triggerComplete=new e.bkB,this._shown=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){}ngAfterViewInit(){this.initTrigger()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTrigger(){if(this.ngUnsubscribe.next(),this.shown&&this.trigger){const i=this.resetCamera(),s=this.store.selectSnapshot(_e.getCanTouch);(function oR(n,t,o,i,s,r){switch(n){case Hs.CameraZoom:return r?eb(o,i):function sR(n,t,o,i=1e3,s=.001){const r=o.getCanvas(),a=(0,yn.R)(r,"wheel"),d=(0,yn.R)(r,"touchmove").pipe((0,S.p)(T=>2===T.touches.length)),f=eb(n,t,i,s);return(0,Wi.h)(a,d).pipe((0,Cn.Z)(()=>f))}(o,i,s);case Hs.CameraPan:return function lR(n,t,o,i=125){const s=o.getCanvas(),r=(0,yn.R)(s,"mousemove").pipe((0,S.p)(f=>1===f.buttons&&f.shiftKey||2===f.buttons||4===f.buttons)),a=(0,yn.R)(s,"touchmove").pipe((0,S.p)(f=>2===f.touches.length)),d=function aR(n,t,o=125){return ju(n).pipe((0,ga.Z)(nb(t)),(0,le.T)(()=>nb(t)),(0,Fn.B)(o),(0,Ds.J)(),(0,le.T)(([i,s])=>function _R(n,t){const s=ib(n.camera),r=ib(t.camera),a=Rn.create();Rn.sub(a,s,r);const d=a.reduce((T,L)=>T+L),f=t.zoom-n.zoom;return(0!==f||0!==d)&&Math.abs(d)<1&&Math.abs(f)<.001}(i,s)),(0,S.p)(i=>i))}(n,t,i);return(0,Wi.h)(r,a).pipe((0,Cn.Z)(()=>d))}(o,i,s);case Hs.CameraRotate:return r?tb(o,i):function rR(n,t,o,i,s=1e3){const r=i.getCanvas(),a=(0,yn.R)(r,"mousemove").pipe((0,S.p)(T=>1===T.buttons)),d=(0,yn.R)(r,"touchmove").pipe((0,S.p)(T=>1===T.touches.length)),f=tb(t,o,s);return(0,Wi.h)(a,d).pipe((0,Cn.Z)(()=>f),(0,S.p)(()=>"rotate"===n.selectSnapshot(fi.x.getPanMode)),(0,Fn.B)(125))}(t,o,i,s);case Hs.NodeSelection:return function cR(n){return n.select(Mn.z.getCheckedNodes).pipe((0,Ds.J)(),(0,S.p)(([,t])=>t.length>0))}(t)}})(this.trigger,this.store,this.engineService,this.cameraService,this.engineRendererService,s).pipe((0,ob.U)(i),(0,dr.c)(this.triggerDelay),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.triggerComplete.next()})}}resetCamera(){const s=this.store.selectSnapshot(fe.N.getSelectedChapter)?.camera?.location;return(0,m.isNil)(s)?(0,Rt.of)(void 0):this.store.dispatch(new jt.Ih(s,!0)).pipe((0,Cn.Z)(()=>this.actions.pipe((0,l.xi)(jt.Nz))),(0,tn.s)(1))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(l.En),e.rXU(u.y),e.rXU(co.j),e.rXU(Fa.z),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-slide"]],inputs:{title:"title",image:"image",alt:"alt",spacing:"spacing",shown:"shown",exitEnabled:"exitEnabled",trigger:"trigger",triggerDelay:"triggerDelay"},outputs:{triggerComplete:"triggerComplete"},ngContentSelectors:uR,decls:1,vars:1,consts:[["class","slide",3,"slide--expanded",4,"ngIf"],[1,"slide"],["class","slide__title",4,"ngIf"],[1,"slide__content"],["class","slide__image",3,"src","alt",4,"ngIf"],[1,"slide__footer"],[1,"slide__title"],[1,"slide__image",3,"src","alt"]],template:function(i,s){1&i&&(e.NAR(pR),e.DNE(0,mR,7,5,"div",0)),2&i&&e.Y8G("ngIf",s.shown)},dependencies:[q.bT],styles:[".slide[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;max-width:500px}.slide__title[_ngcontent-%COMP%]{margin-bottom:16px;font-weight:600;font-size:1.125rem;line-height:1.75rem}.slide__content[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1rem;line-height:1.5rem;line-height:1.5em;max-width:100%}.slide__image[_ngcontent-%COMP%]{margin:24px auto;max-width:100%;min-height:1px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500;display:flex;flex-direction:row;align-items:center;justify-content:center;max-width:100%}.slide--expanded[_ngcontent-%COMP%]   .slide__title[_ngcontent-%COMP%]{margin:16px}.slide--expanded[_ngcontent-%COMP%]   .slide__content[_ngcontent-%COMP%]{margin:48px}.slide--expanded[_ngcontent-%COMP%]   .slide__image[_ngcontent-%COMP%]{margin:48px auto}@media (max-width: 768px){.slide[_ngcontent-%COMP%]{max-width:400px}.slide__image[_ngcontent-%COMP%]{margin:16px}.slide__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;margin-bottom:12px}.slide__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:12px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 640px){.slide[_ngcontent-%COMP%]{max-width:320px}}@media (max-width: 480px){.slide[_ngcontent-%COMP%]{max-width:240px}.slide__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:8px}.slide__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin-bottom:8px}.slide__image[_ngcontent-%COMP%]{margin:4px auto}.slide__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}@media (max-width: 320px){.slide[_ngcontent-%COMP%]{max-width:160px}}"],data:{animation:[(0,Le.hZ)("refresh",[(0,Le.kY)(":enter",[(0,Le.sM)(Gr.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),t})();const fR=["*"];function SR(n,t){1&n&&(e.j41(0,"div",1)(1,"div",2),e.SdG(2),e.k0s()())}let xu=(()=>{var n;class t{set shown(i){this._shown=i,this.setSelectedSlide(0)}get shown(){return this._shown}constructor(i){this.changeRef=i,this.selectedSlideIndex=0,this._shown=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){}ngAfterViewInit(){this.initListeners(),setTimeout(()=>{this.setSlideShown(this.selectedSlideIndex)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}goToPrevSlide(){this.setSelectedSlide(this.selectedSlideIndex-1)}goToNextSlide(){this.setSelectedSlide(this.selectedSlideIndex+1)}setSelectedSlide(i){if(this.selectedSlideIndex=i,this.slides){const r=Math.max(0,Math.min(this.slides.length-1,i));this.selectedSlideIndex=r}this.setSlideShown(this.selectedSlideIndex)}initListeners(){(0,Wi.h)(...this.slides.map(i=>i.triggerComplete.asObservable())).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.goToNextSlide()})}setSlideShown(i){this.slides&&this.slides.forEach((s,r)=>{s.shown=r===i}),this.changeRef.markForCheck()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-page"]],contentQueries:function(i,s,r){if(1&i&&e.wni(r,Vu,4),2&i){let a;e.mGM(a=e.lsd())&&(s.slides=a)}},inputs:{shown:"shown"},ngContentSelectors:fR,decls:1,vars:1,consts:[["class","page",4,"ngIf"],[1,"page"],[1,"page__contents"]],template:function(i,s){1&i&&(e.NAR(),e.DNE(0,SR,3,0,"div",0)),2&i&&e.Y8G("ngIf",s.shown)},dependencies:[q.bT],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.page__contents[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}@media (max-width: 768px){.page__contents[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 480px){.page__contents[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}"],changeDetection:0}),t})();var kl;const ER=n=>({"pages--opaquer":n});function CR(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",1)(1,"button",2),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.nrm(2,"app-icon",3),e.k0s(),e.j41(3,"div",4),e.SdG(4),e.k0s(),e.j41(5,"div",5)(6,"button",6),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handlePrevClick())}),e.nrm(7,"app-icon",7),e.k0s(),e.j41(8,"div",8),e.EFF(9),e.k0s(),e.j41(10,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleNextClick())}),e.nrm(11,"app-icon",10),e.k0s()()()}if(2&n){const o=t.$implicit;e.Y8G("ngClass",e.eq3(7,ER,o.pageIndex==o.pageSize-1)),e.R7$(6),e.Y8G("disabled",o.pageIndex<1),e.BMQ("tabindex",o.pageIndex<1?-1:0),e.R7$(3),e.Lme("",o.pageIndex+1," / ",o.pageSize,""),e.R7$(),e.Y8G("disabled",o.pageIndex===o.pageSize-1),e.BMQ("tabindex",o.pageIndex===o.pageSize-1?-1:0)}}class Od{constructor(t,o){this.store=t,this.changeRef=o,this.ngUnsubscribe=new Q.B}ngOnInit(){}ngAfterViewInit(){this.tutorial$.pipe((0,b.Q)(this.ngUnsubscribe),(0,S.p)(t=>null!=t&&t.pageSize>0)).subscribe(t=>{this.handleTutorialPages(t)}),this.store.dispatch(new D.SetTutorial({pageSize:this.pages.length,pageIndex:0}))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePrevClick(){this.store.dispatch(new D.TutorialPrevious)}handleNextClick(){this.store.dispatch(new D.TutorialNext)}handleExitClick(){this.store.dispatch(new D.ToggleWindow(fn.Tutorial,!1))}handleTutorialPages(t){this.pages.forEach((o,i)=>{o.shown=i===t.pageIndex}),this.changeRef.markForCheck()}}(kl=Od).\u0275fac=function(t){return new(t||kl)(e.rXU(l.il),e.rXU(e.gRc))},kl.\u0275cmp=e.VBU({type:kl,selectors:[["app-view-tour-pages"]],contentQueries:function(t,o,i){if(1&t&&e.wni(i,xu,4),2&t){let s;e.mGM(s=e.lsd())&&(o.pages=s)}},ngContentSelectors:["*"],decls:2,vars:3,consts:()=>{let n,t,o,i,s,r;return n=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,t=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,o=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,i=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,s=$localize`:a165a2589725552dea3ac6e98be73c72f5ae03a01978646816781669814:Next Tutorial Step`,r=$localize`:4ff3dad8ce52dc71e7b3158b1b20b5039959dabf2249392320351386178: Next Tutorial Step`,[["class","pages",3,"ngClass",4,"ngIf"],[1,"pages",3,"ngClass"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","buttonSize","small","aria-label",n,"matTooltip",t,"matTooltipPosition","right","data-test","tutorialExitButton",1,"pages__close",3,"click"],["icon","times"],[1,"pages__contents"],[1,"pages__footer"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",o,"matTooltip",i,"matTooltipPosition","left","data-test","tutorialPreviousButton",1,"pages__nav",3,"click","disabled"],["icon","angle-left","appLogicalDir",""],[1,"mx-8"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",s,"matTooltip",r,"matTooltipPosition","right","data-test","tutorialNextButton",1,"pages__nav",3,"click","disabled"],["icon","angle-right","appLogicalDir",""]]},template:function(t,o){1&t&&(e.NAR(),e.DNE(0,CR,12,9,"div",0),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,o.tutorial$))},dependencies:[rn,q.YU,q.bT,$i.e,yt.R,On.oV,q.Jj],styles:[".pages[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:20px auto 48px;max-width:600px;position:relative;background:#101823cc;border-radius:16px;padding:24px 28px 20px}.pages--opaquer[_ngcontent-%COMP%]{background:#101823e6}.pages__footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;font-size:1rem;line-height:1.5rem;font-weight:500}.pages__close[_ngcontent-%COMP%]{z-index:1;position:absolute;top:8px;inset-inline-end:8px;align-self:flex-end;display:flex;align-items:center;justify-content:center}.pages__contents[_ngcontent-%COMP%]{padding:16px 0}@media (max-width: 768px){.pages[_ngcontent-%COMP%]{margin:16px 12% 48px;border-radius:10px;padding:18px 22px 14px}.pages__contents[_ngcontent-%COMP%]{padding:24px 0}.pages__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}}@media (max-width: 480px){.pages[_ngcontent-%COMP%]{margin:12px 10% 48px;border-radius:8px;padding:24px 20px 12px}.pages__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(_e.getTutorial),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Od.prototype,"tutorial$",void 0);let sb=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-success"]],inputs:{inline:"inline"},decls:2,vars:2,consts:[[1,"view-tour-success"],["icon","check",1,"view-tour-success__icon"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.nrm(1,"app-icon",1),e.k0s()),2&i&&e.AVh("view-tour-success--inline",s.inline)},dependencies:[yt.R],styles:[".view-tour-success{width:52px;height:52px;display:flex;background-color:#1bbc66;border-radius:50%;justify-content:center;align-items:center}.view-tour-success__icon{font-size:2.25rem;line-height:2.5rem;color:#fff}.view-tour-success--inline{display:inline-flex;width:32px;height:32px}.view-tour-success--inline .view-tour-success__icon{font-size:1.125rem;line-height:1.75rem}@media (max-width: 768px){.view-tour-success{width:36px;height:36px}.view-tour-success__icon{font-size:1.25rem;line-height:1.75rem}.view-tour-success--inline{display:inline-flex;width:24px;height:24px}.view-tour-success--inline .view-tour-success__icon{font-size:.75rem;line-height:1rem}}\n"],encapsulation:2,changeDetection:0}),t})();function TR(n,t){if(1&n&&e.nrm(0,"app-icon",5),2&n){const o=e.XpG(2);e.Y8G("icon",o.icon)}}function OR(n,t){if(1&n&&(e.j41(0,"span",6),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.JRh(o.label)}}function MR(n,t){if(1&n&&(e.qex(0),e.DNE(1,TR,1,1,"app-icon",3)(2,OR,2,1,"span",4),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.icon),e.R7$(),e.Y8G("ngIf",o.icon)}}function IR(n,t){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.label," ")}}let wR=(()=>{var n;class t{constructor(){}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-tip-button"]],inputs:{label:"label",icon:"icon"},decls:3,vars:2,consts:[[1,"view-tour-tip-button","my-1","mx-1",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"icon",4,"ngIf"],["class","sr-only",4,"ngIf"],[3,"icon"],[1,"sr-only"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,MR,3,2,"ng-container",1)(2,IR,2,1,"span",2),e.k0s()),2&i&&(e.Y8G("ngSwitch",!!s.icon),e.R7$(),e.Y8G("ngSwitchCase",!0))},dependencies:[q.bT,q.ux,q.e1,q.fG,yt.R],styles:[".view-tour-tip-button{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;color:#131c2a;background-color:#fff;border-radius:2px;font-weight:700;padding:4px;width:24px;height:24px}@media (max-width: 768px){.view-tour-tip-button{width:20px;height:20px}}\n"],encapsulation:2,changeDetection:0}),t})();var Ll;function NR(n,t){1&n&&(e.qex(0),e.pXf(1,14),e.bVm())}function RR(n,t){1&n&&(e.qex(0),e.pXf(1,15),e.bVm())}class Fu{constructor(t){this.viewService=t,this.triggers=Hs,this.videoTutorialSources=ku}ngOnInit(){this.captureScroll$=this.scrollMode$.pipe((0,le.T)(t=>t===Cr.M.Capture))}handleStartClick(){this.viewService.toggleTutorial(!1)}}(Ll=Fu).\u0275fac=function(t){return new(t||Ll)(e.rXU(hn))},Ll.\u0275cmp=e.VBU({type:Ll,selectors:[["app-view-tour-desktop"]],decls:65,vars:12,consts:()=>{let n,t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n;return n=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,t=$localize`:129a2224e1f9d19eb5e11e2a07fe10a7855564848515973702474791807:up`,o=$localize`:b5fbc7c7f007dd53b2318525bb7ff8b0376c9e371301930865667956193:down`,i=$localize`:478c0bf6552f7226e27bb5b57b8209a040ded2c67449548947549758066:left`,s=$localize`:4a379a71f932b31ecae93a9232f818eef02ece106520868693399199322:right`,r=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,a=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,d=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,f=$localize`:0cfd714a023e7dddfab02ebbaffddf8b3b7dd9881831081178261551807: Click and drag the model to change the viewing angle. `,T=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,L=$localize`:c71aa1ed54f03bfd28210dccb6f900b4962ea522114624992018654005:You can also use the arrow keys`,ee=$localize`:8b5e6e1e74d302bbdd638500b071bb0859f3ab405411319251728756176:to rotate.`,re=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,ve=$localize`:a6a4d760af95bd17149d92758784333d288f02a47584501271397744885:You can also use`,Oe=$localize`:5be36bcbbbee99ffb6ea5f40636c92334e7c3d374307223492407933970:to zoom out.`,Ee=$localize`:197d3f7bb3c4bdbe8c11eb56a4cebb7bc9b5880c2383075435551442269: Hold the shift key and drag to move the model's position. `,Re=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,Fe=$localize`:7e72d30152be758594ce5a0257a4fc0ee19f94d54528617795430260542:You can also use the`,Ke=$localize`:a6e5a9592abcd7af3cf72b5d4ba3a12a124208c79056703775803925947:keys to pan.`,it=$localize`:b9964d82e0ae5a31d53f6aef4fdaa996d15dce161011814326808580654: Click on an individual part of the model to highlight anatomy. `,pt=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,Mt=$localize`:2949e52a456470cb255048c7e1e40b496934ed32962414889722492464: Double-click to zoom in on specific structures.`,$t=$localize`:c4673f13cb56aec8867cfdce431a5c1f283895f66288669230125842319: Hold the control key and scroll up and down to zoom in or out. `,_n=$localize`:dfdbec5eab67c07d82c394952e19cca3652719ea6750824053364243866: Scroll up and down to zoom in or out. `,[f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n,["title",n,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"],["icon","caret-up","label",t],["icon","caret-down","label",o],["appLogicalDir","","icon","caret-left","label",i],["appLogicalDir","","icon","caret-right","label",s],["title",r,3,"trigger","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["label","+"],["label","-"],["title",a,3,"trigger"],["label","W"],["label","A"],["label","S"],["label","D"],["title",d,3,"trigger"]]},template:function(t,o){1&t&&(e.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",16),e.pXf(3,0),e.k0s(),e.j41(4,"app-view-tour-slide")(5,"div",17)(6,"div"),e.nrm(7,"app-view-tour-success",18),e.j41(8,"strong",19),e.pXf(9,1),e.k0s(),e.qex(10),e.pXf(11,2),e.bVm(),e.nrm(12,"app-view-tour-tip-button",20)(13,"app-view-tour-tip-button",21)(14,"app-view-tour-tip-button",22)(15,"app-view-tour-tip-button",23),e.qex(16),e.pXf(17,3),e.bVm(),e.k0s()()()(),e.j41(18,"app-view-tour-page")(19,"app-view-tour-slide",24),e.nI1(20,"async"),e.DNE(21,NR,2,0,"ng-container",25)(22,RR,2,0,"ng-container",26),e.k0s(),e.j41(23,"app-view-tour-slide")(24,"div",17)(25,"div"),e.nrm(26,"app-view-tour-success",18),e.j41(27,"strong",19),e.pXf(28,4),e.k0s(),e.qex(29),e.pXf(30,5),e.bVm(),e.nrm(31,"app-view-tour-tip-button",27),e.eu8(32),e.EFF(33,"to zoom in and "),e.nrm(34,"app-view-tour-tip-button",28),e.qex(35),e.pXf(36,6),e.bVm(),e.k0s()()()(),e.j41(37,"app-view-tour-page")(38,"app-view-tour-slide",29),e.pXf(39,7),e.k0s(),e.j41(40,"app-view-tour-slide")(41,"div",17)(42,"div"),e.nrm(43,"app-view-tour-success",18),e.j41(44,"strong",19),e.pXf(45,8),e.k0s(),e.qex(46),e.pXf(47,9),e.bVm(),e.nrm(48,"app-view-tour-tip-button",30)(49,"app-view-tour-tip-button",31)(50,"app-view-tour-tip-button",32)(51,"app-view-tour-tip-button",33),e.qex(52),e.pXf(53,10),e.bVm(),e.k0s()()()(),e.j41(54,"app-view-tour-page")(55,"app-view-tour-slide",34),e.pXf(56,11),e.k0s(),e.j41(57,"app-view-tour-slide")(58,"div",17)(59,"div"),e.nrm(60,"app-view-tour-success",18),e.j41(61,"strong",19),e.pXf(62,12),e.k0s(),e.qex(63),e.pXf(64,13),e.bVm(),e.k0s()()()()()),2&t&&(e.R7$(2),e.Y8G("trigger",o.triggers.CameraRotate),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.CameraZoom)("ngSwitch",e.bMT(20,10,o.captureScroll$)),e.R7$(2),e.Y8G("ngSwitchCase",!1),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.CameraPan),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.NodeSelection),e.R7$(5),e.Y8G("inline",!0))},dependencies:[q.ux,q.e1,q.fG,$i.e,xu,Od,Vu,sb,wR,q.Jj],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Xe.S.getScrollMode),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Fu.prototype,"scrollMode$",void 0);let DR=(()=>{var n;class t{constructor(i){this.viewService=i,this.triggers=Hs,this.videoTutorialSources=ku}handleStartClick(){this.viewService.toggleTutorial(!1)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(hn))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-mobile"]],decls:27,vars:5,consts:()=>{let o,i,s,r,a,d,f,T,L,ee;return o=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,i=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,s=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,r=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,a=$localize`:40fea76a56245ebbead6177bc3d17ae5ec40a1652280443087469838323: Tap and drag with one finger to change the viewing angle. `,d=$localize`:8427d89e9a09d73465919535774a238eb9d421db2729825529782328186: Pinch with two fingers to zoom in or out. `,f=$localize`:14defb0441cab2a9b33483931a54f51867c652e96006726473932808920: Use two fingers to adjust the model's position. `,T=$localize`:1a9195f9922538bdf4a4aff64ca479c285355cfe7928756420516267887: Tap on an individual part of the model to highlight anatomy. `,L=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,ee=$localize`:646945605f8dced01098f9c393573c2a9b46a8425072295053569562541:Double-tap to zoom in on specific structures.`,[a,d,f,T,L,ee,["title",o,3,"trigger"],["title",i,3,"trigger"],["title",s,3,"trigger"],["title",r,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"]]},template:function(i,s){1&i&&(e.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",6),e.pXf(3,0),e.k0s(),e.j41(4,"app-view-tour-slide"),e.nrm(5,"app-view-tour-success"),e.k0s()(),e.j41(6,"app-view-tour-page")(7,"app-view-tour-slide",7),e.pXf(8,1),e.k0s(),e.j41(9,"app-view-tour-slide"),e.nrm(10,"app-view-tour-success"),e.k0s()(),e.j41(11,"app-view-tour-page")(12,"app-view-tour-slide",8),e.pXf(13,2),e.k0s(),e.j41(14,"app-view-tour-slide"),e.nrm(15,"app-view-tour-success"),e.k0s()(),e.j41(16,"app-view-tour-page")(17,"app-view-tour-slide",9),e.pXf(18,3),e.k0s(),e.j41(19,"app-view-tour-slide")(20,"div",10)(21,"div"),e.nrm(22,"app-view-tour-success",11),e.j41(23,"strong",12),e.pXf(24,4),e.k0s(),e.qex(25),e.pXf(26,5),e.bVm(),e.k0s()()()()()),2&i&&(e.R7$(2),e.Y8G("trigger","camera-rotate"),e.R7$(5),e.Y8G("trigger",s.triggers.CameraZoom),e.R7$(5),e.Y8G("trigger",s.triggers.CameraPan),e.R7$(5),e.Y8G("trigger",s.triggers.NodeSelection),e.R7$(5),e.Y8G("inline",!0))},dependencies:[xu,Od,Vu,sb],changeDetection:0}),t})();var Ul,rb=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ab=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function kR(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",6)(1,"h2",7),e.pXf(2,1),e.k0s(),e.j41(3,"p",8),e.qex(4),e.pXf(5,2),e.bVm(),e.nrm(6,"button",9),e.nI1(7,"async"),e.nI1(8,"async"),e.j41(9,"mat-menu",null,0)(11,"button",10),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleSelectInputModeClick(s.inputModes.Mouse))}),e.EFF(12),e.k0s(),e.j41(13,"button",10),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleSelectInputModeClick(s.inputModes.Touch))}),e.EFF(14),e.k0s()()(),e.j41(15,"div",11)(16,"button",12),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.k0s(),e.j41(17,"button",13),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleStartClick())}),e.k0s()()()}if(2&n){const o=e.sdS(10),i=e.XpG();e.R7$(6),e.Y8G("compact",!0)("label",i.inputModesText[e.bMT(7,6,i.inputMode$)])("matMenuTriggerFor",o),e.BMQ("aria-label",i.inputModesText[e.bMT(8,8,i.inputMode$)]),e.R7$(6),e.SpI(" ",i.inputModesText[i.inputModes.Mouse]," "),e.R7$(2),e.SpI(" ",i.inputModesText[i.inputModes.Touch]," ")}}function LR(n,t){1&n&&e.nrm(0,"app-view-tour-mobile")}function UR(n,t){1&n&&e.nrm(0,"app-view-tour-desktop")}function jR(n,t){if(1&n&&(e.j41(0,"div",14),e.nI1(1,"async"),e.DNE(2,LR,1,0,"app-view-tour-mobile",15)(3,UR,1,0,"app-view-tour-desktop",16),e.k0s()),2&n){const o=e.XpG();e.Y8G("ngSwitch",e.bMT(1,2,o.inputMode$)),e.R7$(2),e.Y8G("ngSwitchCase",o.inputModes.Touch)}}class Md{constructor(t,o,i){this.store=t,this.viewService=o,this.storageService=i,this.inputModes=vs,this.inputModesText={[vs.Mouse]:$localize`mouse, trackpad, or keyboard`,[vs.Touch]:$localize`touchscreen`},this.tourStarted=!1,this.tourEnded=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.initListeners(),this.store.dispatch(new D.TutorialSeen(!0))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.tutorial$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({pageIndex:t,pageSize:o})=>{this.tourStarted=t>-1,this.tourEnded=t===o-1}),(0,yn.R)(window,"keyup").pipe((0,S.p)(t=>"Escape"===t.key),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.exit()})}handleExitClick(){this.exit()}handleStartClick(){this.store.dispatch(new D.StartTutorial(!1))}handleSelectInputModeClick(t){this.store.dispatch(new D.SetInputMode(t))}exit(){this.viewService.toggleTutorial(!1)}}(Ul=Md).\u0275fac=function(t){return new(t||Ul)(e.rXU(l.il),e.rXU(hn),e.rXU(zt.n$))},Ul.\u0275cmp=e.VBU({type:Ul,selectors:[["app-view-tour"]],decls:3,vars:5,consts:()=>{let n,t,o,i,s,r,a;return n=$localize`:b6d518ec10f5635af884c06c0ee31f0d4589e8a2580493549510248593:Getting Started Tutorial`,t=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,o=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,i=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,s=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,r=$localize`:486c6addfeb93356cab8bbb37310c8f61534e1f29156212170228959929:Getting Started`,a=$localize`:80ef270109b95917aeaa29935ed0aeb1b53376275246430719012249797:Welcome! This tutorial will teach you how to navigate and explore in 3D using your`,[["inputSelectionMenu","matMenu"],r,a,["role","dialog","aria-label",n,"cdkTrapFocus","",1,"tour"],["class","tour__intro",4,"ngIf"],["class","tour__contents",3,"ngSwitch",4,"ngIf"],[1,"tour__intro"],[1,"tour__title"],[1,"tour__welcome"],["app-view-rounded-button","","buttonType","outline","icon","chevron-down","iconPlacement","right",1,"tour__input-selection","text-small",3,"compact","label","matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"tour__footer"],["app-view-rounded-button","","buttonType","outline","label",t,"aria-label",o,"data-test","tutorialExitButton",1,"mr-3",3,"click"],["app-view-rounded-button","","buttonType","solid","label",i,"aria-label",s,"data-test","tutorialStartButton",1,"ml-3",3,"click"],[1,"tour__contents",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]]},template:function(t,o){1&t&&(e.j41(0,"div",3),e.DNE(1,kR,18,10,"div",4)(2,jR,4,4,"div",5),e.k0s()),2&t&&(e.AVh("tour--started",o.tourStarted),e.Y8G("@refresh",void 0),e.R7$(),e.Y8G("ngIf",!o.tourStarted),e.R7$(),e.Y8G("ngIf",o.tourStarted))},dependencies:[Qi.kB,q.bT,q.ux,q.e1,q.fG,ei.kk,ei.fb,ei.Cp,iR,Fu,DR,q.Jj],styles:[".tour[_ngcontent-%COMP%]{color:#fff;position:fixed;inset:0;z-index:100;pointer-events:none;display:flex;flex-direction:column;align-items:center;overflow:auto}.tour__title[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}.tour__welcome[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;margin:16px auto 32px}.tour__intro[_ngcontent-%COMP%]{background:#101823e6;border-radius:16px;margin:auto;padding:28px 32px;text-align:center;max-width:560px}.tour__input-selection[_ngcontent-%COMP%]{margin:0 8px;vertical-align:middle}.tour__header[_ngcontent-%COMP%]{flex:none;align-self:flex-end;justify-self:flex-start;margin:24px}.tour__contents[_ngcontent-%COMP%]{flex:auto;display:flex;flex-direction:column;justify-content:flex-end;width:100%}.tour__footer[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;display:flex;flex-direction:row;align-items:center;justify-content:center}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.875rem;line-height:2.25rem;cursor:pointer}.tour--ended[_ngcontent-%COMP%]   .tour__contents[_ngcontent-%COMP%]{justify-content:center}@media (max-width: 768px){.tour__intro[_ngcontent-%COMP%]{border-radius:12px;padding:20px 24px;margin:auto 12%;max-width:100%}.tour__intro__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;max-width:80%}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.875rem;line-height:1.25rem}.tour__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}@media (max-width: 480px){.tour__intro[_ngcontent-%COMP%]{border-radius:8px;padding:16px 20px;margin:auto 10%}.tour__intro__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin:12px auto 16px}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.75rem;line-height:1rem}.tour__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}}"],data:{animation:[(0,Le.hZ)("refresh",[(0,Le.kY)(":enter",[(0,Le.sM)(Gr.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0}),rb([(0,l.l6)(_e.getTutorial),ab("design:type",y.c)],Md.prototype,"tutorial$",void 0),rb([(0,l.l6)(_e.getInputMode),ab("design:type",y.c)],Md.prototype,"inputMode$",void 0);var jl,lb=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},cb=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function VR(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"button",7),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleUndoClick())}),e.nrm(3,"app-icon",8),e.k0s(),e.j41(4,"button",9),e.nI1(5,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleRedoClick())}),e.nrm(6,"app-icon",10),e.k0s(),e.bVm()}if(2&n){const o=e.XpG(2);e.R7$(),e.Y8G("disabled",!1===e.bMT(2,6,o.canUndo$))("matTooltipPosition",o.tooltipPosition),e.R7$(2),e.Y8G("custom",!0),e.R7$(),e.Y8G("disabled",!1===e.bMT(5,8,o.canRedo$))("matTooltipPosition",o.tooltipPosition),e.R7$(2),e.Y8G("custom",!0)}}function xR(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",2)(1,"app-pillbox",3),e.DNE(2,VR,7,10,"ng-container",4),e.j41(3,"button",5),e.nI1(4,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleResetClick())}),e.j41(5,"span",6),e.pXf(6,0),e.k0s()()()()}if(2&n){const o=e.XpG();e.Y8G("@show",void 0),e.R7$(2),e.Y8G("ngIf","full"===o.layout),e.R7$(),e.Y8G("disabled",!1===e.bMT(4,4,o.canUndo$))("matTooltipPosition",o.tooltipPosition)}}class Id{constructor(t,o){this.viewService=t,this.directionality=o,this.layout="full",this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}}(jl=Id).\u0275fac=function(t){return new(t||jl)(e.rXU(hn),e.rXU(qo.dS))},jl.\u0275cmp=e.VBU({type:jl,selectors:[["app-view-undo"]],inputs:{layout:"layout"},decls:2,vars:3,consts:()=>{let n,t,o,i,s,r,a;return n=$localize`:5d09ab375cce1f50ab075f60a2f4e3c2aa39ed465271497798766647376:Undo Tools`,t=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,o=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,i=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,s=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,r=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,a=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,[o,["class","view-undo",4,"ngIf"],[1,"view-undo"],["orientation","vertical","role","group","aria-label",n,"appPreventFadeout",""],[4,"ngIf"],["app-view-button","","buttonSize","small","buttonShape","rounded","data-test","reset-btn","matTooltip",t,3,"click","disabled","matTooltipPosition"],[1,"font-semibold","text-2xs"],["app-view-button","","buttonSize","small","data-test","undo-btn","icon","undo","aria-label",i,"matTooltip",s,3,"click","disabled","matTooltipPosition"],["icon","undo","appLogicalDir","",3,"custom"],["app-view-button","","buttonSize","small","data-test","redo-btn","aria-label",r,"matTooltip",a,"icon","redo",3,"click","disabled","matTooltipPosition"],["icon","redo","appLogicalDir","",3,"custom"]]},template:function(t,o){1&t&&(e.DNE(0,xR,7,6,"div",1),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,o.canUndo$))},dependencies:[rn,q.bT,Us,$i.e,yt.R,On.oV,Do,q.Jj],styles:["[_nghost-%COMP%]{pointer-events:none}"],data:{animation:[(0,Le.hZ)("show",[(0,Le.kY)(":enter",(0,Le.K2)([(0,Le.iF)({transform:"translateX(-100%)",opacity:0}),(0,Le.i0)("150ms ease-in-out",(0,Le.iF)({transform:"translateX(0%)",opacity:1}))]))])]},changeDetection:0}),lb([(0,l.l6)(An.canUndo),cb("design:type",y.c)],Id.prototype,"canUndo$",void 0),lb([(0,l.l6)(An.canRedo),cb("design:type",y.c)],Id.prototype,"canRedo$",void 0);var Gu=_(42482),$u=_(4951);const FR=["textRef"],GR=n=>({"whiteboard-label__label--active":n});function $R(n,t){if(1&n){const o=e.RV6();e.j41(0,"div")(1,"div",4),e.bIt("cdkDragMoved",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.dragMoved(s,"corner1"))}),e.k0s(),e.j41(2,"div",5),e.bIt("cdkDragMoved",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.dragMoved(s,"corner2"))}),e.k0s(),e.j41(3,"div",6),e.bIt("cdkDragMoved",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.dragMoved(s,"corner3"))}),e.k0s(),e.j41(4,"div",7),e.bIt("cdkDragMoved",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.dragMoved(s,"corner4"))}),e.k0s(),e.j41(5,"div",8),e.bIt("cdkDragMoved",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.translateHandleMoved(s))}),e.k0s()()}if(2&n){const o=e.XpG();e.R7$(),e.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner1),e.R7$(),e.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner2),e.R7$(),e.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner3),e.R7$(),e.Y8G("cdkDragFreeDragPosition",o.dragHandles.corner4),e.R7$(),e.Y8G("cdkDragFreeDragPosition",o.dragHandles.translate)}}let BR=(()=>{var n;class t{get id(){return this._id}set id(i){this._id=i,this.initialized=!1}set color(i){this.renderer.setStyle(this.textRef.nativeElement,"color",i)}set exporting(i){i&&(this.active=!1,this.labelActive.next(void 0))}set size(i){this.renderer.setStyle(this.textRef.nativeElement,"font-size",`${i}px`)}constructor(i,s,r,a){this.store=i,this.changeDetectorRef=s,this.renderer=r,this.localeId=a,this.active=!0,this.initialized=!1,this.labelActive=new e.bkB,this.labelEmpty=new e.bkB,this.dragHandles={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.handleCoords={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.textareaTransform={x:0,y:0,width:110,height:40},this.ngUnsubscribe=new Q.B,this.handleDocumentBackspace=d=>{const{activeElement:f}=this.textRef.nativeElement;"Backspace"===d.key&&this.active&&!f&&this.deleteLabel()},this.handleTextboxMouseDown=d=>{this.active=!0,this.labelActive.next(this.id),this.refreshHandles()},this.handleDocumentMouseDown=d=>{const f=d.target.className.includes("view-whiteboard__canvas"),T=d.target.className.includes("whiteboard-label__label"),L=d.target.dataset.id===this.id;this.isLabelEmpty()&&!L&&this.initialized?this.deleteLabel():(f||T&&!L)&&(this.active=!1,this.changeDetectorRef.markForCheck())},this.handleTextKeyDown=d=>{if(d.stopPropagation(),this.isLabelEmpty()&&"Backspace"===d.key)return void this.deleteLabel();const f=this.textRef.nativeElement.scrollHeight,{corner1:T,corner3:L,corner4:ee}=this.handleCoords,re=T.y+f;this.handleCoords.corner3={...L,y:re},this.handleCoords.corner4={...ee,y:re},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.updateTextarea(),this.changeDetectorRef.markForCheck()},this.dir=(0,bn.NS)(this.localeId).direction}ngOnInit(){this.initHandles(),this.initInteractionListeners(),this.initStateListeners(),setTimeout(()=>{this.textRef.nativeElement.focus(),this.initialized=!0})}ngOnDestroy(){this.textRef.nativeElement.removeEventListener("keydown",this.handleTextKeyDown),this.textRef.nativeElement.removeEventListener("mousedown",this.handleTextboxMouseDown),this.mouseDownListener(),this.backspaceListener(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initHandles(){this.textareaTransform.x=this.initialPos.x,this.textareaTransform.y=this.initialPos.y;const{x:i,y:s,width:r,height:a}=this.textareaTransform;this.dragHandles.corner1={x:i,y:s},this.dragHandles.corner2={x:i+r,y:s},this.dragHandles.corner3={x:i+r,y:s+a},this.dragHandles.corner4={x:i,y:s+a},this.dragHandles.translate={x:i+r/2,y:s+-10},this.handleCoords.corner1={...this.dragHandles.corner1},this.handleCoords.corner2={...this.dragHandles.corner2},this.handleCoords.corner3={...this.dragHandles.corner3},this.handleCoords.corner4={...this.dragHandles.corner4},this.handleCoords.translate={...this.dragHandles.translate},this.updateTextarea()}initStateListeners(){this.store.select(_e.getWhiteboardAnnotateMode).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{i!==oo.Text&&(this.active=!1,this.labelActive.next(void 0),this.changeDetectorRef.markForCheck())})}initInteractionListeners(){this.mouseDownListener=this.renderer.listen("document","mousedown",this.handleDocumentMouseDown),this.backspaceListener=this.renderer.listen("document","keydown",this.handleDocumentBackspace),this.textRef.nativeElement.addEventListener("mousedown",this.handleTextboxMouseDown),this.textRef.nativeElement.addEventListener("keydown",this.handleTextKeyDown)}refreshHandles(){this.dragHandles.corner1={...this.handleCoords.corner1},this.dragHandles.corner2={...this.handleCoords.corner2},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.dragHandles.translate={...this.handleCoords.translate},this.changeDetectorRef.markForCheck()}isLabelEmpty(){return""===this.textRef.nativeElement.innerText||"\n"===this.textRef.nativeElement.innerText}deleteLabel(){this.labelEmpty.next(this.id)}updateTextarea(){const{corner1:i,corner2:s,corner3:r}=this.handleCoords;this.textareaTransform.x=i.x,this.textareaTransform.y=i.y,this.textareaTransform.width=s.x-i.x,this.textareaTransform.height=r.y-s.y,this.renderer.setStyle(this.textRef.nativeElement,"transform",`translate(${this.textareaTransform.x}px, ${this.textareaTransform.y}px)`),this.renderer.setStyle(this.textRef.nativeElement,"width",`${this.textareaTransform.width}px`),this.renderer.setStyle(this.textRef.nativeElement,"height",`${this.textareaTransform.height}px`)}updateTranslateHandle(){const{corner1:i,corner2:s}=this.handleCoords;this.handleCoords.translate={x:(s.x-i.x)/2+i.x,y:i.y+-10},this.dragHandles.translate={...this.handleCoords.translate}}setHandle(i,s,r){this.handleCoords[i]={...this.handleCoords[i],[s]:r[s]},this.dragHandles[i]={...this.handleCoords[i]}}addDiffToHandle(i,s){this.handleCoords[i]={x:this.handleCoords[i].x+s.x,y:this.handleCoords[i].y+s.y},this.dragHandles[i]={...this.handleCoords[i]}}translateHandleMoved(i){const s=i.source._dragRef.getFreeDragPosition(),r={x:s.x-this.handleCoords.translate.x,y:s.y-this.handleCoords.translate.y};this.handleCoords.translate={...s},this.addDiffToHandle("corner1",r),this.addDiffToHandle("corner2",r),this.addDiffToHandle("corner3",r),this.addDiffToHandle("corner4",r),this.updateTextarea()}dragMoved(i,s){const r=i.source._dragRef.getFreeDragPosition();this.handleCoords[s]={...r},"corner1"===s&&(this.setHandle("corner2","y",r),this.setHandle("corner4","x",r)),"corner2"===s&&(this.setHandle("corner1","y",r),this.setHandle("corner3","x",r)),"corner3"===s&&(this.setHandle("corner2","x",r),this.setHandle("corner4","y",r)),"corner4"===s&&(this.setHandle("corner1","x",r),this.setHandle("corner3","y",r)),this.updateTranslateHandle(),this.updateTextarea()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(e.gRc),e.rXU(e.sFG),e.rXU(e.xe9))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-whiteboard-label"]],viewQuery:function(i,s){if(1&i&&e.GBs(FR,7),2&i){let r;e.mGM(r=e.lsd())&&(s.textRef=r.first)}},inputs:{id:"id",initialPos:"initialPos",color:"color",exporting:"exporting",size:"size"},outputs:{labelActive:"labelActive",labelEmpty:"labelEmpty"},decls:4,vars:6,consts:()=>{let o;return o=$localize`:0fde29c90b84be4dd7bc39adcce90313a570f14b1511122002214104331:Type..`,[["textRef",""],[1,"whiteboard-label"],[4,"ngIf"],["contenteditable","true","data-placeholder",o,1,"whiteboard-label__label",3,"dir","ngClass"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--move",3,"cdkDragMoved","cdkDragFreeDragPosition"]]},template:function(i,s){1&i&&(e.j41(0,"div",1),e.DNE(1,$R,6,5,"div",2),e.nrm(2,"div",3,0),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",!0===s.active),e.R7$(),e.Y8G("dir",s.dir)("ngClass",e.eq3(4,GR,!0===s.active)),e.BMQ("data-id",s.id))},dependencies:[q.YU,q.bT,Jc.T1,qo.ig],styles:['.whiteboard-label[_ngcontent-%COMP%]{position:relative;z-index:1000}.whiteboard-label__handle[_ngcontent-%COMP%]{position:fixed;z-index:10;width:32px;height:32px;left:-16px;top:-16px}.whiteboard-label__handle[_ngcontent-%COMP%]:after{content:"";position:absolute;width:12px;height:12px;left:10px;top:10px;border-radius:50%;background-color:#2d72dc}.whiteboard-label__handle[_ngcontent-%COMP%]:hover{cursor:pointer}.whiteboard-label__handle--top-left[_ngcontent-%COMP%]:hover{cursor:nw-resize}.whiteboard-label__handle--top-right[_ngcontent-%COMP%]:hover{cursor:ne-resize}.whiteboard-label__handle--bottom-right[_ngcontent-%COMP%]:hover{cursor:se-resize}.whiteboard-label__handle--bottom-left[_ngcontent-%COMP%]:hover{cursor:sw-resize}.whiteboard-label__handle--move[_ngcontent-%COMP%]:hover{cursor:move}.whiteboard-label__label[_ngcontent-%COMP%]{box-sizing:border-box;position:absolute;border:none;padding:5px;overflow-y:hidden}.whiteboard-label__label--active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px #2d72dc}.whiteboard-label__label[_ngcontent-%COMP%]:focus{outline:none}.whiteboard-label__label[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#374a6880}'],changeDetection:0}),t})();var Vl,ds=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},_s=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const zR=["colorBtn"];function WR(n,t){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,5),e.k0s()())}function XR(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.setTextSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,WR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27)(6,"span"),e.EFF(7),e.k0s()()()()}if(2&n){const o=t.$implicit,i=e.XpG();e.R7$(3),e.Y8G("ngIf",o.size===e.bMT(4,2,i.textSize$)),e.R7$(4),e.SpI("",o.label,"px")}}function HR(n,t){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,6),e.k0s()())}function QR(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.setBrushSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,HR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27),e.nrm(6,"app-icon",30),e.j41(7,"span"),e.EFF(8),e.k0s()()()()}if(2&n){const o=t.$implicit,i=e.XpG();e.R7$(3),e.Y8G("ngIf",o.size===e.bMT(4,4,i.brushSize$)),e.R7$(3),e.xc7("font-size",o.size,"px"),e.R7$(2),e.JRh(o.label)}}function YR(n,t){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,7),e.k0s()())}function KR(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.setEraserSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,YR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",31),e.nrm(6,"app-icon",30),e.j41(7,"span"),e.EFF(8),e.k0s()()()()}if(2&n){const o=t.$implicit,i=e.XpG();e.R7$(3),e.Y8G("ngIf",o.size===e.bMT(4,4,i.eraserSize$)),e.R7$(3),e.xc7("font-size",o.size,"px"),e.R7$(2),e.JRh(o.label)}}function JR(n,t){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,8),e.k0s()())}function qR(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.setBrushColor(s.color))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,JR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27),e.nrm(6,"span",32),e.j41(7,"span"),e.EFF(8),e.nI1(9,"titlecase"),e.k0s()()()()}if(2&n){const o=t.$implicit,i=e.XpG();e.R7$(3),e.Y8G("ngIf",o.color===e.bMT(4,4,i.brushColor$)),e.R7$(3),e.xc7("background-color",o.color),e.R7$(2),e.JRh(e.bMT(9,6,o.label))}}class So{constructor(t){this.store=t,this.textSizes=_h,this.brushSizes=dh,this.brushColors=[{label:$localize`Black`,color:C_.color},{label:$localize`Red`,color:"#ff0000"},{label:$localize`Yellow`,color:"#ffff00"},{label:$localize`Green`,color:"#00ff00"},{label:$localize`Cyan`,color:"#00ffff"},{label:$localize`Blue`,color:"#0000ff"},{label:$localize`Pink`,color:"#ff00ff"},{label:$localize`White`,color:uh.color}],this.eraserSizes=ph,this.modeEnum=oo,this.downloadClick=new e.bkB,this.clearClick=new e.bkB,this.exitClick=new e.bkB,this.ngUnsubscribe=new Q.B}ngOnInit(){}ngAfterViewInit(){this.hasPaint$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{!t&&this.store.selectSnapshot(_e.getWhiteboardAnnotateMode)===oo.Erase&&this.handleModeSelect(oo.Paint)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setBrushSize(t){this.store.dispatch(new D.SetWhiteboardBrushSize(t))}setBrushColor(t){this.store.dispatch(new D.SetWhiteboardBrushColor(t))}setTextSize(t){this.store.dispatch(new D.SetWhiteboardTextSize(t))}handleModeSelect(t){this.store.dispatch(new D.SetWhiteboardAnnotateMode(t))}setEraserSize(t){this.store.dispatch(new D.SetWhiteboardEraserSize(t))}handleDownloadClick(){this.downloadClick.next()}handleClearClick(){this.clearClick.next()}handleExitClick(){this.exitClick.next()}}(Vl=So).\u0275fac=function(t){return new(t||Vl)(e.rXU(l.il))},Vl.\u0275cmp=e.VBU({type:Vl,selectors:[["app-view-whiteboard-tools"]],viewQuery:function(t,o){if(1&t&&e.GBs(zR,7,e.aKT),2&t){let i;e.mGM(i=e.lsd())&&(o.colorBtn=i.first)}},outputs:{downloadClick:"downloadClick",clearClick:"clearClick",exitClick:"exitClick"},decls:37,vars:43,consts:()=>{let n,t,o,i,s,r,a,d,f,T,L,ee,re,ve;return n=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,t=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,o=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,i=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,s=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,r=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,a=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,d=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,f=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,T=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,L=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,ee=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,re=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,ve=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["colorBtn","matMenuTrigger"],["textSizeMenu","matMenu"],["brushSizeMenu","matMenu"],["eraserSizeMenu","matMenu"],["brushColorMenu","matMenu"],L,ee,re,ve,[1,"view-whiteboard-tools"],["name","Whiteboard","orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",n,"matTooltip",t,"matTooltipPosition","right",3,"matMenuTriggerFor","buttonTheme"],["size","lg","icon","tint"],["app-view-button","","buttonSize","small","aria-label",o,"matTooltip",i,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","paint-brush"],["app-view-button","","buttonSize","small","aria-label",s,"matTooltip",r,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","text-size"],["app-view-button","","buttonSize","small","aria-label",a,"matTooltip",d,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme","disabled"],["size","lg","icon","eraser"],["orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",f,"matTooltip",T,"matTooltipPosition","right",3,"click","disabled"],["size","lg","icon","trash"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","flex-row","items-center","justify-start"],[1,"view-whiteboard-tools__check"],[4,"ngIf"],[1,"view-whiteboard-tools__label"],["icon","check","aria-hidden","true",1,"mr-2"],[1,"sr-only"],["icon","circle","aria-hidden","true",1,"mr-2"],[1,"view-whiteboard-tools__label","flex","flex-auto","items-center"],[1,"view-whiteboard-tools__swatch"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",9)(1,"app-pillbox",10)(2,"button",11,0),e.nrm(4,"app-icon",12),e.k0s(),e.j41(5,"button",13),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleModeSelect(o.modeEnum.Paint))}),e.nrm(9,"app-icon",14),e.k0s(),e.j41(10,"button",15),e.nI1(11,"async"),e.nI1(12,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleModeSelect(o.modeEnum.Text))}),e.nrm(13,"app-icon",16),e.k0s(),e.j41(14,"button",17),e.nI1(15,"async"),e.nI1(16,"async"),e.nI1(17,"async"),e.nI1(18,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleModeSelect(o.modeEnum.Erase))}),e.nrm(19,"app-icon",18),e.k0s(),e.nrm(20,"app-pillbox-divider",19),e.j41(21,"button",20),e.nI1(22,"async"),e.nI1(23,"async"),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleClearClick())}),e.nrm(24,"app-icon",21),e.k0s(),e.j41(25,"mat-menu",null,1),e.DNE(27,XR,8,4,"button",22),e.k0s(),e.j41(28,"mat-menu",null,2),e.DNE(30,QR,9,6,"button",22),e.k0s(),e.j41(31,"mat-menu",null,3),e.DNE(33,KR,9,6,"button",22),e.k0s(),e.j41(34,"mat-menu",null,4),e.DNE(36,qR,10,8,"button",22),e.k0s()()()}if(2&t){const i=e.sdS(3),s=e.sdS(26),r=e.sdS(29),a=e.sdS(32),d=e.sdS(35);e.R7$(2),e.Y8G("matMenuTriggerFor",d)("buttonTheme",i.menuOpen?"blue-fill":"transparent-fill"),e.BMQ("aria-selected",i.menuOpen)("aria-pressed",i.menuOpen),e.R7$(3),e.Y8G("matMenuTriggerFor",r)("buttonTheme",e.bMT(6,21,o.mode$)===o.modeEnum.Paint?"blue-fill":"transparent-fill"),e.BMQ("aria-selected",e.bMT(7,23,o.mode$)===o.modeEnum.Paint)("aria-pressed",e.bMT(8,25,o.mode$)===o.modeEnum.Paint),e.R7$(5),e.Y8G("matMenuTriggerFor",s)("buttonTheme",e.bMT(11,27,o.mode$)===o.modeEnum.Text?"blue-fill":"transparent-fill"),e.BMQ("aria-pressed",e.bMT(12,29,o.mode$)===o.modeEnum.Text),e.R7$(4),e.Y8G("matMenuTriggerFor",a)("buttonTheme",e.bMT(15,31,o.mode$)===o.modeEnum.Erase?"blue-fill":"transparent-fill")("disabled",!1===e.bMT(16,33,o.hasPaint$)),e.BMQ("aria-selected",e.bMT(17,35,o.mode$)===o.modeEnum.Erase)("aria-pressed",e.bMT(18,37,o.mode$)===o.modeEnum.Erase),e.R7$(7),e.Y8G("disabled",!1===e.bMT(22,39,o.hasPaint$)&&!1===e.bMT(23,41,o.hasText$)),e.R7$(6),e.Y8G("ngForOf",o.textSizes),e.R7$(3),e.Y8G("ngForOf",o.brushSizes),e.R7$(3),e.Y8G("ngForOf",o.eraserSizes),e.R7$(3),e.Y8G("ngForOf",o.brushColors)}},dependencies:[rn,q.Sq,q.bT,yt.R,ei.kk,ei.fb,ei.Cp,On.oV,Do,sd,q.Jj,q.PV],styles:[".view-whiteboard-tools__check{min-width:20px;color:#2d72dc}.view-whiteboard-tools__swatch{display:inline-block;width:14px;height:14px;border-radius:50%;margin-inline-end:8px;box-shadow:0 0 0 1px #96a8c0}\n"],encapsulation:2,changeDetection:0}),ds([(0,l.l6)(_e.isWhiteboardLocked),_s("design:type",y.c)],So.prototype,"isLocked$",void 0),ds([(0,l.l6)(_e.getWhiteboardAnnotateMode),_s("design:type",y.c)],So.prototype,"mode$",void 0),ds([(0,l.l6)(_e.getWhiteboardBrushSize),_s("design:type",y.c)],So.prototype,"brushSize$",void 0),ds([(0,l.l6)(_e.getWhiteboardTextSize),_s("design:type",y.c)],So.prototype,"textSize$",void 0),ds([(0,l.l6)(_e.getWhiteboardBrushColor),_s("design:type",y.c)],So.prototype,"brushColor$",void 0),ds([(0,l.l6)(_e.getWhiteboardEraserSize),_s("design:type",y.c)],So.prototype,"eraserSize$",void 0),ds([(0,l.l6)(_e.getWhiteboardHasPaint),_s("design:type",y.c)],So.prototype,"hasPaint$",void 0),ds([(0,l.l6)(_e.getWhiteboardHasText),_s("design:type",y.c)],So.prototype,"hasText$",void 0);var xl,Qs=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ys=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const ZR=["drawCanvas"],eD=["annotateWrapper"];function tD(n,t){if(1&n){const o=e.RV6();e.j41(0,"app-view-whiteboard-label",12),e.nI1(1,"async"),e.bIt("labelActive",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleLabelActive(s))})("labelEmpty",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleLabelEmpty(s))}),e.k0s()}if(2&n){const o=t.$implicit,i=e.XpG();e.AVh("view-whiteboard__label--clickthrough",e.bMT(1,7,i.annotateMode$)!==i.whiteboardAnnotateMode.Text),e.Y8G("exporting",i.exporting)("id",o.id)("initialPos",o.pos)("color",o.color)("size",o.size)}}function nD(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.j41(1,"span",14),e.pXf(2,2),e.k0s()()}}const Bu=gl.H.PNG;class Uo{constructor(t,o,i,s,r,a,d){this.store=t,this.actions=o,this.viewService=i,this.clipboardService=s,this.applicationEventService=r,this.changeRef=a,this.animationService=d,this.whiteboardAnnotateMode=oo,this.labels=[],this.exporting=!1,this.drawing=!1,this.brushSize=0,this.eraserSize=0,this.lineWidth=0,this.wasPlaying=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.siteHeader=this.store.selectSnapshot(gn.getSiteHeader),this.store.dispatch(new wn.SetHeader(Ko.Hide)),this.canvasElement=this.drawCanvas.nativeElement,this.canvasContext=this.canvasElement.getContext("2d"),this.initActiveLabelColorListener(),this.initActiveLabelTextSizeListener(),this.initAnnotateModeListener(),this.initBrushColorFromBackgroundListener(),this.animationService.isPlaying()&&(this.animationService.pause(),this.wasPlaying=!0)}ngAfterViewInit(){this.initCanvasListeners()}ngOnDestroy(){this.inputManager.destroy(),this.reset(),this.store.dispatch(new wn.SetHeader(this.siteHeader)),this.wasPlaying&&this.animationService.unpause(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initAnnotateModeListener(){this.annotateMode$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(this.inputManager&&this.inputManager.destroy(),t){case oo.Paint:this.canvasContext.globalCompositeOperation="source-over",this.setLineWidth(this.brushSize),this.initDrawListeners();break;case oo.Text:this.initTextListener();break;case oo.Erase:this.canvasContext.globalCompositeOperation="destination-out",this.setLineWidth(this.eraserSize),this.initDrawListeners()}this.applicationEventService.fireEvent(nt.F.WhiteboardModeUpdated,t)})}initActiveLabelColorListener(){this.brushColor$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.labels.find(i=>i.id===this.activeLabelId);o&&(o.color=t,this.changeRef.markForCheck())})}initActiveLabelTextSizeListener(){this.textSize$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.labels.find(i=>i.id===this.activeLabelId);o&&(o.size=t,this.changeRef.markForCheck())})}initBrushColorFromBackgroundListener(){this.background$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=(0,ks.T4)(t)?g0:h0;this.store.dispatch(new D.SetWhiteboardBrushColor(o.color))})}initTextListener(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Tap({event:"tap"})),this.inputManager.on("tap",t=>{if(this.activeLabelId)return void(this.activeLabelId=void 0);const o=(0,m.uniqueId)();let i=t.center.x,s=t.center.y;void 0!==t.pointers[0].x&&(i=t.pointers[0].x,s=t.pointers[0].y);const r=this.store.selectSnapshot(_e.getWhiteboardBrushColor),a=this.store.selectSnapshot(_e.getWhiteboardTextSize);this.labels.push({id:o,pos:{x:i,y:s},color:r,size:a}),this.activeLabelId=o,this.changeRef.markForCheck(),this.dispatchHasText()})}initCanvasListeners(){this.brushSize$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setBrushSize(t)}),this.brushColor$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setBrushColor(t)}),this.eraserSize$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setEraserSize(t)}),this.syncCanvas()}initDrawListeners(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Pan({event:"pan",pointers:0})),this.inputManager.add(new Hammer.Tap({event:"tap"}));const t=new Map;this.inputManager.on("tap",o=>{this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o);this.drawPoint(i,s),this.checkCanvasPaint()}),this.inputManager.on("panstart",o=>{this.drawing=!0,this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o);t.set(o.pointers[0]?.pointerId||1,{x:i,y:s}),this.applicationEventService.fireEvent(nt.F.WhiteboardDrawingStarted)}),this.inputManager.on("pan",o=>{this.drawing=!0,this.changeRef.markForCheck();const{x:i,y:s}=this.getInputPosition(o),r=o.pointers[0]?.pointerId||1,{x:a,y:d}=t.get(r);this.drawLine(a,d,i,s),this.drawPoint(i,s),t.set(r,{x:i,y:s})}),this.inputManager.on("panend",()=>{this.drawing=!1,this.changeRef.markForCheck(),t.clear(),this.checkCanvasPaint(),this.applicationEventService.fireEvent(nt.F.WhiteboardDrawingFinished)})}handleLabelActive(t){this.activeLabelId=t;const o=this.labels.find(i=>i.id===t);o&&this.store.dispatch([new D.SetWhiteboardTextSize(o.size),new D.SetWhiteboardBrushColor(o.color)])}handleLabelEmpty(t){this.labels=this.labels.filter(o=>o.id!==t),this.changeRef.markForCheck(),this.dispatchHasText()}dispatchHasText(){this.store.dispatch(new D.SetWhiteboardHasText(this.labels.length>0))}handleResetClick(){this.reset()}handleDownloadClick(){this.exporting=!0,this.changeRef.detectChanges();const{width:t,height:o}=this.canvasElement,i=this.store.selectSnapshot(fe.N.getSelectedChapterId),s=this.store.selectSnapshot(fe.N.getSelectedChapterBackground),r=this.store.selectSnapshot(Xe.S.getWatermarkEnabled),a=document.querySelector(".engine__watermark"),d=[this.drawCanvas.nativeElement,this.annotateElement.nativeElement];r&&!(0,m.isNil)(a)&&d.push(a),this.store.dispatch(new no.V9(i,s,Bu,100,{width:t,height:o},"original",!0,!0,d)).pipe((0,Ec.q)(()=>this.actions.pipe((0,l.xi)(no.WX),(0,tn.s)(1))),(0,b.Q)(this.ngUnsubscribe),(0,bt.j)(()=>{this.exporting=!1,this.changeRef.markForCheck()})).subscribe(f=>{this.downloadSnapshot(f.blob)})}handleExitClick(){this.resetCanvas(),this.viewService.toggleWhiteboard(!1)}getInputPosition(t){const o=t.pointers[0];return o?.pageX?{x:o.pageX,y:o.pageY}:{x:t.center.x,y:t.center.y}}checkCanvasPaint(){const t=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),i=new Uint32Array(t.data.buffer).some(s=>0!==s);this.store.dispatch(new D.SetWhiteboardHasPaint(i))}drawPoint(t,o){const i=this.lineWidth/2,s=2*Math.PI;this.canvasContext.beginPath(),this.canvasContext.arc(t,o,i,0,s),this.canvasContext.fill()}drawLine(t,o,i,s){this.canvasContext.beginPath(),this.canvasContext.moveTo(t,o),this.canvasContext.lineTo(i,s),this.canvasContext.stroke(),this.canvasContext.closePath()}reset(){this.resetCanvas(),this.labels=[],this.changeRef.markForCheck(),this.dispatchHasText()}setBrushSize(t){this.brushSize=t,this.setLineWidth(t)}setBrushColor(t){this.canvasContext.fillStyle=t,this.canvasContext.strokeStyle=t}setEraserSize(t){this.eraserSize=t,this.setLineWidth(t)}setLineWidth(t){this.canvasContext.lineWidth=t,this.lineWidth=t}syncCanvas(){const t=this.store.selectSnapshot(_e.getWhiteboardBrushSize),o=this.store.selectSnapshot(_e.getWhiteboardBrushColor),i=this.store.selectSnapshot(_e.getWhiteboardEraserSize),{width:s,height:r}=this.getScreenDimensions();this.canvasElement.width=s,this.canvasElement.height=r,this.setBrushSize(t),this.setBrushColor(o),this.setEraserSize(i),this.canvasContext.lineJoin="round"}resetCanvas(){const{width:t,height:o}=this.canvasElement;this.canvasContext.clearRect(0,0,t,o),this.store.dispatch(new D.SetWhiteboardHasPaint(!1))}downloadSnapshot(t){const{displayName:o}=this.store.selectSnapshot(rt.getStory),r=`${(o||"").replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}_drawing.${Bu===gl.H.PNG?"png":"jpg"}`;!0===I.c.native||I.c.platform===ka.N.SDK?Gu.X.blobToBase64(t).pipe((0,Ec.q)(a=>this.clipboardService.copyToClipboard(a,"image")),(0,b.Q)(this.ngUnsubscribe)).subscribe(a=>{}):Gu.X.exportImage(t,Bu,r)}getScreenDimensions(){const{innerWidth:t,innerHeight:o}=window;return{width:t,height:o}}}(xl=Uo).\u0275fac=function(t){return new(t||xl)(e.rXU(l.il),e.rXU(l.En),e.rXU(hn),e.rXU($u.W),e.rXU(po.S),e.rXU(e.gRc),e.rXU(zi.O))},xl.\u0275cmp=e.VBU({type:xl,selectors:[["app-view-whiteboard"]],viewQuery:function(t,o){if(1&t&&(e.GBs(ZR,7),e.GBs(eD,7)),2&t){let i;e.mGM(i=e.lsd())&&(o.drawCanvas=i.first),e.mGM(i=e.lsd())&&(o.annotateElement=i.first)}},decls:17,vars:20,consts:()=>{let n,t,o,i;return n=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,t=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,o=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,i=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,[["annotateWrapper",""],["drawCanvas",""],i,[1,"view-whiteboard"],["dir","ltr"],["class","view-whiteboard__label",3,"view-whiteboard__label--clickthrough","exporting","id","initialPos","color","size","labelActive","labelEmpty",4,"ngFor","ngForOf"],["data-test","drawCanvas",1,"view-whiteboard__canvas"],["data-test","viewWhiteboardTools",1,"view-whiteboard__tools",3,"clearClick","downloadClick","exitClick"],[1,"view-whiteboard__actions"],["app-view-button","","buttonSize","small","data-test","viewWhiteboardDownload","aria-label",n,"matTooltip",t,"matTooltipPosition","right",3,"click"],["size","lg","icon","down-to-bracket"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",o,3,"click",4,"ngIf"],[1,"view-whiteboard__label",3,"labelActive","labelEmpty","exporting","id","initialPos","color","size"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",o,3,"click"],[1,"px-3","uppercase","text-xs"]]},template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"div",3,0),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.j41(5,"div",4),e.DNE(6,tD,2,9,"app-view-whiteboard-label",5),e.k0s(),e.nrm(7,"canvas",6,1),e.j41(9,"app-view-whiteboard-tools",7),e.bIt("clearClick",function(){return e.eBV(i),e.Njj(o.handleResetClick())})("downloadClick",function(){return e.eBV(i),e.Njj(o.handleDownloadClick())})("exitClick",function(){return e.eBV(i),e.Njj(o.handleExitClick())}),e.k0s(),e.j41(10,"div",8)(11,"app-pillbox")(12,"button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleDownloadClick())}),e.nrm(13,"app-icon",10),e.k0s()(),e.j41(14,"app-pillbox"),e.DNE(15,nD,3,0,"button",11),e.nI1(16,"async"),e.k0s()()()}2&t&&(e.AVh("view-whiteboard--exporting",o.exporting)("view-whiteboard--drawing",o.drawing)("view-whiteboard--cursor-paint",e.bMT(2,12,o.annotateMode$)===o.whiteboardAnnotateMode.Paint)("view-whiteboard--cursor-erase",e.bMT(3,14,o.annotateMode$)===o.whiteboardAnnotateMode.Erase)("view-whiteboard--cursor-text",e.bMT(4,16,o.annotateMode$)===o.whiteboardAnnotateMode.Text),e.R7$(6),e.Y8G("ngForOf",o.labels),e.R7$(9),e.Y8G("ngIf",!1===e.bMT(16,18,o.isLocked$)))},dependencies:[rn,q.Sq,q.bT,yt.R,qo.ig,On.oV,Do,BR,So,q.Jj],styles:["@keyframes shadow{0%{box-shadow:inset 0 0 #3e4043b3}to{box-shadow:inset 0 0 10px 4px #3e4043b3}}.view-whiteboard{touch-action:none;animation:shadow .5s ease-out forwards;position:fixed;inset:0;z-index:20;display:flex;flex-direction:column;align-items:center;justify-content:space-between;transition:all .3s linear}.view-whiteboard--exporting{box-shadow:none}.view-whiteboard--exporting .view-whiteboard__tools,.view-whiteboard--exporting .view-whiteboard__actions,.view-whiteboard--drawing .view-whiteboard__tools,.view-whiteboard--drawing .view-whiteboard__actions{display:none}.view-whiteboard--cursor-paint:hover{cursor:url(/assets/images/cursor-whiteboard-paint.svg) 7 20,pointer}.view-whiteboard--cursor-erase:hover{cursor:url(/assets/images/cursor-whiteboard-erase.svg) 7 20,pointer}.view-whiteboard--cursor-text:hover{cursor:url(/assets/images/cursor-whiteboard-text.svg) 7 20,pointer}.view-whiteboard__canvas{box-shadow:inset 0 0 10px #3e404366;position:absolute;inset:0;z-index:1}.view-whiteboard__label{position:absolute;top:0;left:0;z-index:10}.view-whiteboard__label--clickthrough{pointer-events:none}.view-whiteboard__tools{position:absolute;inset-inline-start:12px;top:12px;bottom:12px;z-index:20;display:flex;align-items:center}.view-whiteboard__actions{display:flex;gap:8px;position:absolute;inset-inline-end:12px;top:12px;z-index:20}\n"],encapsulation:2,changeDetection:0}),Qs([(0,l.l6)(_e.isWhiteboardLocked),Ys("design:type",y.c)],Uo.prototype,"isLocked$",void 0),Qs([(0,l.l6)(_e.getWhiteboardAnnotateMode),Ys("design:type",y.c)],Uo.prototype,"annotateMode$",void 0),Qs([(0,l.l6)(_e.getWhiteboardBrushSize),Ys("design:type",y.c)],Uo.prototype,"brushSize$",void 0),Qs([(0,l.l6)(_e.getWhiteboardBrushColor),Ys("design:type",y.c)],Uo.prototype,"brushColor$",void 0),Qs([(0,l.l6)(_e.getWhiteboardTextSize),Ys("design:type",y.c)],Uo.prototype,"textSize$",void 0),Qs([(0,l.l6)(_e.getWhiteboardEraserSize),Ys("design:type",y.c)],Uo.prototype,"eraserSize$",void 0),Qs([(0,l.l6)(fe.N.getSelectedChapterBackground),Ys("design:type",y.c)],Uo.prototype,"background$",void 0);const oD=["zones"],sD=[[["","top",""]],[["","left",""]],[["","right",""]],[["","bottom",""]]],rD=["[top]","[left]","[right]","[bottom]"];let aD=(()=>{var n;class t{constructor(){this.showZones=[]}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-zones"]],viewQuery:function(i,s){if(1&i&&e.GBs(oD,5),2&i){let r;e.mGM(r=e.lsd())&&(s.zones=r.first)}},inputs:{showZones:"showZones"},ngContentSelectors:rD,decls:10,vars:4,consts:[["zones",""],[1,"view-zones"],[1,"view-zones__zone","view-zones__zone--top"],[1,"view-zones__zone","view-zones__zone--left"],[1,"view-zones__zone","view-zones__zone--right"],[1,"view-zones__zone","view-zones__zone--bottom"]],template:function(i,s){1&i&&(e.NAR(sD),e.j41(0,"div",1,0)(2,"div",2),e.SdG(3),e.k0s(),e.j41(4,"div",3),e.SdG(5,1),e.k0s(),e.j41(6,"div",4),e.SdG(7,2),e.k0s(),e.j41(8,"div",5),e.SdG(9,3),e.k0s()()),2&i&&(e.R7$(2),e.Y8G("@isShown",s.showZones.includes("top")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones.includes("left")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones.includes("right")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones.includes("bottom")?"shown":"hidden"))},styles:['[_nghost-%COMP%]{width:100%;height:100%}.view-zones[_ngcontent-%COMP%]{width:100%;height:100%;display:grid;grid-template-areas:"top top top" "left . right" "bottom bottom bottom";grid-template-columns:minmax(40px,auto) 1fr minmax(40px,auto);grid-template-rows:auto 1fr auto;padding:12px;pointer-events:none;position:absolute;z-index:20}.view-zones__zone[_ngcontent-%COMP%]{opacity:0;display:flex;gap:8px}.view-zones__zone--left[_ngcontent-%COMP%]{grid-area:left;flex-direction:column}.view-zones__zone--right[_ngcontent-%COMP%]{grid-area:right;flex-direction:column}.view-zones__zone--top[_ngcontent-%COMP%]{grid-area:top;flex-direction:row;opacity:1}.view-zones__zone--top[_ngcontent-%COMP%]:not(:empty){margin-bottom:8px}.view-zones__zone--bottom[_ngcontent-%COMP%]{grid-area:bottom;flex-direction:row;justify-content:flex-end}.view-zones__zone--bottom[_ngcontent-%COMP%]:not(:empty){margin-top:8px}'],data:{animation:[(0,Le.hZ)("isShown",[(0,Le.wk)("shown",(0,Le.iF)({opacity:1})),(0,Le.wk)("hidden",(0,Le.iF)({opacity:0})),(0,Le.kY)("hidden => shown",[(0,Le.i0)("300ms ease-out")]),(0,Le.kY)("shown => hidden",[(0,Le.i0)("150ms ease-in")])])]},changeDetection:0}),t})();var Fl,ht=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},mt=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const lD=["viewContainer"],cD=["columnContainer"],dD=["drawerContainer"],_D=["engineContainer"],pD=["view"],uD=["viewCameraBar"],gD=["viewLogo"],hD=["viewSceneBase"],mD=["viewToolbar"],fD=(n,t,o,i,s,r,a,d)=>({"view-page--layout-column":n,"view-page--layout-drawer":t,"view-page--show-aside":o,"view-page--column-open":i,"view-page--column-closed":s,"view-page--drawer-open":r,"view-page--drawer-closed":a,"view-page--drawer-peek":d}),SD=n=>({"view-page__drawer-nav--overflow":n}),_b=n=>({"w-full":n}),bD=n=>({grow:n}),yD=n=>({collapsed:n}),vD=n=>({"pt-2":n}),ED=(n,t,o)=>({"view-page__logo--mobile":n,"view-page__logo--web":t,"view-page__logo--raised":o});function CD(n,t){1&n&&e.nrm(0,"app-view-toolbar")}function TD(n,t){if(1&n&&(e.nrm(0,"app-view-undo",38),e.nI1(1,"async")),2&n){const o=e.XpG();e.Y8G("layout",e.bMT(1,1,o.canvasHeightBreakpoint$)>o.canvasHeightBreakpoint.Tiny?"full":"resetOnly")}}function OD(n,t){1&n&&e.nrm(0,"app-view-title-only")}function MD(n,t){1&n&&e.nrm(0,"app-view-audio-mute")}function ID(n,t){if(1&n&&(e.j41(0,"app-pillbox",45),e.DNE(1,MD,1,0,"app-view-audio-mute",18),e.nI1(2,"async"),e.nrm(3,"app-view-drawer-toggle"),e.k0s()),2&n){const o=e.XpG(4);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,o.audioVisible$))}}function wD(n,t){if(1&n&&(e.j41(0,"div",43),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div"),e.DNE(5,OD,1,0,"app-view-title-only",18),e.nI1(6,"async"),e.k0s(),e.DNE(7,ID,4,3,"app-pillbox",44),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&n){const o=e.XpG(3);e.Y8G("ngClass",e.eq3(15,SD,e.bMT(1,3,o.titleOnlyVisible$)&&(e.bMT(2,5,o.drawerToggleVisible$)||e.bMT(3,7,o.audioVisible$)))),e.R7$(5),e.Y8G("ngIf",e.bMT(6,9,o.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(8,11,o.drawerToggleVisible$)||e.bMT(9,13,o.audioVisible$))}}function PD(n,t){if(1&n){const o=e.RV6();e.j41(0,"app-pillbox")(1,"button",46),e.bIt("click",function(){e.eBV(o);const s=e.XpG(3);return e.Njj(s.handleQuizClick())}),e.nrm(2,"app-icon",47),e.k0s()()}}function AD(n,t){if(1&n&&(e.j41(0,"div",41),e.DNE(1,wD,10,17,"div",42),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,PD,3,0,"app-pillbox",18),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.titleOnlyVisible$)||e.bMT(3,4,o.drawerToggleVisible$)||e.bMT(4,6,o.audioVisible$)),e.R7$(4),e.Y8G("ngIf",e.bMT(6,8,o.hasQuiz$)&&e.bMT(7,10,o.quizEnabled$)&&!1===e.bMT(8,12,o.quizModeLocked$)&&e.bMT(9,14,o.quizPromptVisible$)&&!1===e.bMT(10,16,o.quizModeActive$))}}function ND(n,t){if(1&n&&(e.qex(0,39),e.DNE(1,AD,11,18,"div",40),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,o.titleOnlyVisible$)||e.bMT(3,3,o.drawerToggleVisible$)||e.bMT(4,5,o.quizModeActive$)&&!1===e.bMT(5,7,o.quizModeLocked$))}}function RD(n,t){1&n&&e.nrm(0,"app-view-column-toggle")}function DD(n,t){1&n&&(e.qex(0),e.nrm(1,"app-view-title-only"),e.bVm())}function kD(n,t){1&n&&e.nrm(0,"app-view-audio-mute")}function LD(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",52),e.bIt("click",function(){e.eBV(o);const s=e.XpG(4);return e.Njj(s.handleQuizClick())}),e.nrm(1,"app-icon",53),e.j41(2,"span",54),e.pXf(3,6),e.k0s()()}}function UD(n,t){if(1&n&&(e.j41(0,"app-pillbox"),e.DNE(1,kD,1,0,"app-view-audio-mute",18),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,LD,4,0,"button",51),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&n){const o=e.XpG(3);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.audioVisible$)&&!1===e.bMT(3,4,o.columnVisible$)),e.R7$(3),e.Y8G("ngIf",e.bMT(5,6,o.hasQuiz$)&&e.bMT(6,8,o.quizEnabled$)&&!1===e.bMT(7,10,o.quizModeLocked$)&&e.bMT(8,12,o.quizPromptVisible$)&&!1===e.bMT(9,14,o.quizModeActive$))}}function jD(n,t){if(1&n&&(e.j41(0,"div",49)(1,"div",50),e.DNE(2,RD,1,0,"app-view-column-toggle",18),e.nI1(3,"async"),e.DNE(4,DD,2,0,"ng-container",18),e.nI1(5,"async"),e.DNE(6,UD,10,16,"app-pillbox",18),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.k0s()()),2&n){const o=e.XpG(2);e.R7$(2),e.Y8G("ngIf",e.bMT(3,3,o.columnToggleVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(5,5,o.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,7,o.hasQuiz$)&&e.bMT(8,9,o.quizEnabled$)&&!1===e.bMT(9,11,o.quizModeLocked$)&&e.bMT(10,13,o.quizPromptVisible$)&&!1===e.bMT(11,15,o.quizModeActive$)||e.bMT(12,17,o.audioVisible$)&&!1===e.bMT(13,19,o.columnVisible$))}}function VD(n,t){if(1&n&&(e.qex(0,39),e.DNE(1,jD,14,21,"div",48),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,o.columnToggleVisible$)||e.bMT(3,3,o.titleOnlyVisible$)||e.bMT(4,5,o.quizModeActive$))}}function xD(n,t){1&n&&e.eu8(0,39)}function FD(n,t){1&n&&e.nrm(0,"app-engine-camera-bar")}function GD(n,t){1&n&&(e.j41(0,"app-pillbox",55),e.nrm(1,"app-view-fullscreen",56),e.k0s())}function $D(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",68),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(4);return e.Njj(s.handleToggleMedia(!1))}),e.nrm(2,"app-icon",69),e.k0s()}if(2&n){let o;const i=e.XpG(4);e.Y8G("matTooltip",i.mediaBarTooltip)("thin",!0),e.BMQ("aria-label",i.mediaBarTooltip)("aria-expanded","show"===(null==(o=e.bMT(1,4,i.mediaUI$))?null:o.status))}}function BD(n,t){if(1&n&&(e.j41(0,"div",63),e.nI1(1,"async"),e.nI1(2,"async"),e.j41(3,"app-pillbox",64),e.nI1(4,"async"),e.nI1(5,"async"),e.DNE(6,$D,3,6,"button",65),e.nI1(7,"async"),e.nrm(8,"app-pillbox-divider",66)(9,"app-view-media-bar",67),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s()()),2&n){let o,i,s;const r=e.XpG(3);e.Y8G("ngClass",e.eq3(20,_b,e.bMT(1,6,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall&&"full"===(null==(o=e.bMT(2,8,r.mediaUI$))?null:o.template))),e.R7$(3),e.Y8G("ngClass",e.eq3(22,bD,e.bMT(4,10,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall&&"full"===(null==(i=e.bMT(5,12,r.mediaUI$))?null:i.template))),e.R7$(3),e.Y8G("ngIf",e.eq3(24,yD,"show"===(null==(s=e.bMT(7,14,r.mediaUI$))?null:s.status))),e.R7$(3),e.Y8G("autoFocus","keyboard"===r.focusOrigin)("showSpeed",e.bMT(10,16,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall)("showScrubber",e.bMT(11,18,r.horizontalBreakpoint$)>r.horizontalBreakpoint.XSmall)}}function zD(n,t){if(1&n){const o=e.RV6();e.qex(0),e.j41(1,"button",68),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(4);return e.Njj(s.handleToggleMedia(!0))}),e.nrm(3,"app-icon",70),e.k0s(),e.nrm(4,"app-pillbox-divider",66),e.bVm()}if(2&n){let o;const i=e.XpG(4);e.R7$(),e.Y8G("matTooltip",i.mediaBarTooltip)("thin",!0),e.BMQ("aria-label",i.mediaBarTooltip)("aria-expanded","show"===(null==(o=e.bMT(2,4,i.mediaUI$))?null:o.status))}}function WD(n,t){if(1&n&&(e.j41(0,"app-pillbox",66),e.DNE(1,zD,5,6,"ng-container",18),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nrm(5,"app-view-play"),e.k0s()),2&n){let o;const i=e.XpG(3);e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,1,i.isMobileWeb$)&&"collapse"===(null==(o=e.bMT(3,3,i.mediaUI$))?null:o.status)&&"full"===(null==(o=e.bMT(4,5,i.mediaUI$))?null:o.template))}}function XD(n,t){if(1&n&&(e.j41(0,"div",60),e.DNE(1,BD,12,26,"div",61),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,WD,6,7,"app-pillbox",62),e.nI1(5,"async"),e.k0s()),2&n){let o,i;const s=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,s.mediaVisible$)&&"show"===(null==(o=e.bMT(3,4,s.mediaUI$))?null:o.status)),e.R7$(3),e.Y8G("ngIf","show"!==(null==(i=e.bMT(5,6,s.mediaUI$))?null:i.status))}}function HD(n,t){if(1&n&&(e.nrm(0,"app-view-title-only",74),e.nI1(1,"async")),2&n){const o=e.XpG(3);e.Y8G("showTitle",!1===e.bMT(1,1,o.drawerVisible$))}}function QD(n,t){1&n&&(e.j41(0,"app-pillbox",45),e.nrm(1,"app-view-drawer-toggle"),e.k0s())}function YD(n,t){if(1&n&&(e.j41(0,"div",71),e.nI1(1,"async"),e.j41(2,"div",72),e.nI1(3,"async"),e.DNE(4,HD,2,3,"app-view-title-only",73),e.nI1(5,"async"),e.k0s(),e.DNE(6,QD,2,0,"app-pillbox",44),e.nI1(7,"async"),e.k0s()),2&n){const o=e.XpG(2);e.Y8G("ngClass",e.eq3(12,vD,e.bMT(1,4,o.mediaVisible$))),e.R7$(2),e.Y8G("ngClass",e.eq3(14,_b,!1===e.bMT(3,6,o.drawerVisible$))),e.R7$(2),e.Y8G("ngIf",e.bMT(5,8,o.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,10,o.drawerToggleVisible$))}}function KD(n,t){if(1&n&&(e.j41(0,"div",57),e.DNE(1,XD,6,8,"div",58),e.nI1(2,"async"),e.DNE(3,YD,8,16,"div",59),e.nI1(4,"async"),e.nI1(5,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.mediaVisible$)),e.R7$(2),e.Y8G("ngIf",!0===e.bMT(4,4,o.isMobileWeb$)&&"drawer"===e.bMT(5,6,o.viewLayout$))}}function JD(n,t){if(1&n&&(e.nrm(0,"app-view-logo",75),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async")),2&n){const o=e.XpG();e.Y8G("ngClass",e.sMw(11,ED,!0===e.bMT(1,3,o.isMobileWeb$),!1===e.bMT(2,5,o.isMobileWeb$),o.isLogoRaised))("logoColor",o.isBackgroundLight?"color":"white")("logoSize",!0===e.bMT(3,7,o.isMobileWeb$)||e.bMT(4,9,o.horizontalBreakpoint$)<=o.horizontalBreakpoint.Small?"small":"full")}}function qD(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",76)(1,"app-pillbox")(2,"button",46),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleExitQuiz())}),e.j41(3,"span",77),e.pXf(4,7),e.k0s()()()()}}function ZD(n,t){1&n&&e.nrm(0,"app-view-column-container",78)}function e3(n,t){if(1&n){const o=e.RV6();e.j41(0,"app-view-column",79),e.nI1(1,"async"),e.qex(2,80),e.j41(3,"div",81)(4,"div",82),e.pXf(5,8),e.k0s(),e.j41(6,"button",83),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleSearch(!1))}),e.nrm(7,"app-icon",84),e.j41(8,"span",85),e.pXf(9,9),e.k0s()()(),e.bVm(),e.qex(10,86),e.j41(11,"div",87),e.nrm(12,"app-view-search"),e.k0s(),e.bVm(),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("floating",!0)("padded",!1)("wide",e.bMT(1,3,o.paginationVisible$))}}function t3(n,t){if(1&n){const o=e.RV6();e.j41(0,"app-view-column",88),e.nI1(1,"async"),e.qex(2,80),e.j41(3,"div",81)(4,"div",82),e.pXf(5,10),e.k0s(),e.j41(6,"button",89),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleToggleLayers())}),e.nrm(7,"app-icon",84),e.j41(8,"span",85),e.pXf(9,11),e.k0s()()(),e.bVm(),e.qex(10,86),e.j41(11,"div",90),e.nrm(12,"app-view-visibility-layers"),e.k0s(),e.bVm(),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("wide",e.bMT(1,3,o.paginationVisible$))("floating",!0)("padded",!1)}}function n3(n,t){1&n&&(e.j41(0,"div",91,5),e.nrm(2,"app-view-drawer"),e.k0s())}function i3(n,t){1&n&&e.nrm(0,"div",92)}function o3(n,t){if(1&n&&e.nrm(0,"app-view-ondemand",93),2&n){const o=e.XpG();e.Y8G("contentId",o.contentId)("contentType",o.contentType)}}function s3(n,t){if(1&n&&(e.nrm(0,"app-view-progress",94),e.nI1(1,"async")),2&n){const o=e.XpG();e.Y8G("show",e.bMT(1,2,o.viewWindow$)===o.viewWindow.Loader)("percent",o.chapterLoadProgress)}}function r3(n,t){if(1&n&&e.nrm(0,"app-play-loader",96),2&n){const o=e.XpG(2);e.Y8G("percent",o.chapterLoadProgress)}}function a3(n,t){1&n&&e.nrm(0,"app-button-loader")}function l3(n,t){1&n&&e.nrm(0,"app-hand-loader")}function c3(n,t){1&n&&e.nrm(0,"app-summary-loader")}function d3(n,t){if(1&n&&(e.j41(0,"app-view-loader"),e.DNE(1,r3,1,1,"app-play-loader",95),e.nI1(2,"async"),e.DNE(3,a3,1,0,"app-button-loader",18),e.nI1(4,"async"),e.DNE(5,l3,1,0,"app-hand-loader",18),e.nI1(6,"async"),e.DNE(7,c3,1,0,"app-summary-loader",18),e.nI1(8,"async"),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf","play"===e.bMT(2,4,o.interactType$)),e.R7$(2),e.Y8G("ngIf","button"===e.bMT(4,6,o.interactType$)),e.R7$(2),e.Y8G("ngIf","hand"===e.bMT(6,8,o.interactType$)),e.R7$(2),e.Y8G("ngIf","summary"===e.bMT(8,10,o.interactType$))}}function _3(n,t){1&n&&e.nrm(0,"app-view-tour")}function p3(n,t){1&n&&e.nrm(0,"app-view-whiteboard",97)}function u3(n,t){1&n&&e.nrm(0,"app-view-print")}function g3(n,t){1&n&&e.nrm(0,"app-view-content-warning")}class ct{onClick(t){this.handleFirstClickTracking(t)}onFocusin(){this.checkFocus()}onFocusout(){this.checkFocus()}onActive(t){this.showTools$.next(!0)}onInactive(t){const o=this.store.selectSnapshot(_e.getFadeout),i=this.store.selectSnapshot(_e.getFadeoutPaused),s=this.viewLayout$.getValue();0!==o&&s!==Qn.Column&&!i&&this.showTools$.next(!1)}constructor(t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt){this.activatedRoute=t,this.changeDetectorRef=o,this.store=i,this.actions=s,this.liveAnnouncer=r,this.viewService=a,this.viewQuizService=d,this.viewUIService=f,this.engineService=T,this.nodeService=L,this.animationService=ee,this.applicationEventService=re,this.vendorAnalyticsService=ve,this.mediaService=Oe,this.title=Ee,this.platform=Re,this.viewPlaythroughService=Fe,this.focusMonitor=Ke,this.dialog=it,this.visibilityLayersService=pt,this.legacyVisibilityLayersService=Mt,this.application=Wn.c,this.environment=I.c,this.nativePlatform=Wf.I,this.toolEnum=qt.s,this.showTools$=new ui.t(!1),this.mediaExpanded=!1,this.horizontalBreakpoint=Vn,this.canvasHeightBreakpoint=Mo.h,this.viewContentMode=Ft,this.viewLayoutStatus=at,this.viewMode=Wc,this.viewUI=G,this.viewWindow=fn,this.columnLayoutStatus=at.Hide,this.drawerExpandable=!0,this.drawerOpen=!1,this.loadLabel="",this.chapterLoadProgress=0,this.chaptersLoaded=0,this.isBackgroundLight=!0,this.selectedChapterLoading=!1,this.viewToolsMode=zf,this.viewLayout$=new ui.t(Qn.Column),this.showZones=[],this.focusOrigin="",this.isLogoRaised=!1,this.ngUnsubscribe=new Q.B}ngOnInit(){this.resetScene();const t=this.viewService.normalizeQueryParams(this.activatedRoute.snapshot.queryParams);this.contentId=t.id,this.contentType=t.type,this.contentLang=t.lang}ngAfterViewInit(){this.viewService.setViewLanguage(this.contentLang),this.loadStory(),this.store.dispatch(new He.Ds({tag:!0,pin:!1})),this.store.dispatch(new st.kE(!0));const t=this.store.selectSnapshot(Be.getUI).loader.template;this.store.dispatch(new st.Ti(t===Oo.Bar)),t!==Oo.None&&this.store.dispatch(new D.ToggleWindow(fn.Loader,!0)),this.liveAnnouncer.announce("Loading","polite"),this.store.select(Be.getUIEntry(G.Playthrough)).pipe((0,S.p)(i=>i.enable),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new D.SetPlaythroughEnabled(i.enable))}),this.checkCapabilities(),this.initSizeObservers(),this.initHeaderObserver(),this.initViewUIObserver(),this.initUIObserver(),this.initBreakpointObservers(),this.initKeyboardObserver(),this.initLoadProgressObserver(),this.initPlaythroughObserver(),this.initWindowObserver(),this.initMobileNav(),this.initBackgroundColorObserver(),this.initResponsiveLabels(),this.initNodeObserver(),this.initChapterObserver(),this.initChapterAudioPlayer(),this.initToolsFadeout(),this.initAccessibility(),this.initTooltips(),this.initQuizStateListener(),this.initVisibilityLayers(),this.storyId$.pipe((0,S.p)(i=>!(0,m.isNil)(i)&&"preview"!==i),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>this.initVendorAnalyticsEvents()),this.initAnatomyTree()}ngOnDestroy(){this.store.dispatch(new st.t5(!1)),this.store.dispatch(new Sc),this.store.dispatch(new He.S3),io.isFullscreen()&&io.exitFullscreen(),this.viewQuizService.exitQuiz(),this.unbindKeyboard(),this.mediaService.stopAllAudio(),this.mediaService.removeAllAudioPlayers(),this.store.dispatch(new _i.ResetAudio),this.viewPlaythroughService.clearChapterTimers(),this.destroyVisibilityLayers(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.focusMonitor.stopMonitoring(document.body),this.viewService.unobserveMaterialOverlay()}loadStory(){this.onDemand$.pipe((0,S.p)(t=>!t),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.initStory(this.contentId,this.contentType,this.contentLang)})}checkCapabilities(){const t=(0,Hc.ZO)(),o=(0,Hc.yd)();this.store.dispatch(new D.SetCanHover(t)),this.store.dispatch(new D.SetCanTouch(o)),this.store.dispatch(new D.SetCanFullscreen(io.canFullscreen())),this.store.dispatch(new D.SetInputMode(o?vs.Touch:vs.Mouse)),(0,yn.R)(window,"orientationchange").pipe((0,Fn.B)(100),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new D.SetCanHover((0,Hc.ZO)())),this.store.dispatch(new D.SetCanTouch((0,Hc.yd)()))})}initBreakpointObservers(){(0,Ht.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.resetUI(),this.viewService.resetContentMode()})}initResponsiveLabels(){const t=(0,yn.R)(window,"resize").pipe((0,Fn.B)(100)),o=this.store.select(_e.getLabelsBreakpoint),i=this.store.select(Ze.getSelectedLabel),s=this.store.select(Ze.getLabelsCollapsed);i.pipe((0,S.p)(()=>this.store.selectSnapshot(Ze.getLabelsCollapsed)),(0,b.Q)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(null!=r)}),s.pipe((0,S.p)(()=>!!this.store.selectSnapshot(Ze.getSelectedLabel)),(0,b.Q)(this.ngUnsubscribe)).subscribe(r=>{this.viewService.toggleLabelInfo(r)}),(0,Ht.z)(t,o).pipe((0,S.p)(([,r])=>!(0,m.isNil)(r)),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkLabelsCollapsed()}),this.checkLabelsCollapsed()}initSizeObservers(){const t=vC({strategy:"scroll"});(0,yn.R)(window,"resize").pipe((0,Fn.B)(10),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateViewHeight(),this.refreshLayout()}),new y.c(s=>{t.listenTo(this.engineContainer.nativeElement,()=>{s.next()})}).pipe((0,Fn.B)(10)).subscribe(()=>{this.resizeEngineContainer()})}initHeaderObserver(){this.store.select(gn.getSiteHeader).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.updateViewHeight()})}initUIObserver(){this.viewUI$.pipe((0,S.p)(t=>!(0,m.isNil)(t)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.refreshLayout()}),this.viewUI$.pipe((0,S.p)(t=>!(0,m.isNil)(t)),(0,wo.Z)(100),(0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(nt.F.UIUpdated,t)}),this.viewWindow$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.applicationEventService.fireEvent(nt.F.UIWindowUpdated,t)}),(0,Ht.z)([this.isMobileWeb$,this.drawerVisible$,this.paginationVisible$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{this.isLogoRaised=!!t&&(!o||i&&o)})}initViewUIObserver(){(0,Ht.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$,EC(this.engineContainer.nativeElement),this.viewWindow$,this.store.select(fe.N.getSelectedChapterId),this.store.select(Ei.getStoryLoadProgress),this.store.select(Be.getUI),this.store.select(Ze.getSelectedLabel)]).pipe((0,b.Q)(this.ngUnsubscribe),(0,Fn.B)(30)).subscribe(()=>{this.store.dispatch(new Dn.ToggleVisible({[G.Audio]:this.viewUIService.isVisible(G.Audio),[G.Camera]:this.viewUIService.isVisible(G.Camera),[G.Column]:this.viewUIService.isVisible(G.Column),[G.ColumnToggle]:this.viewUIService.isVisible(G.ColumnToggle),[G.Drawer]:this.viewUIService.isVisible(G.Drawer),[G.DrawerToggle]:this.viewUIService.isVisible(G.DrawerToggle),[G.Description]:this.viewUIService.isVisible(G.Description),[G.Fullscreen]:this.viewUIService.isVisible(G.Fullscreen),[G.Help]:this.viewUIService.isVisible(G.Help),[G.LabelList]:this.viewUIService.isVisible(G.LabelList),[G.Legend]:this.viewUIService.isVisible(G.Legend),[G.Logo]:this.viewUIService.isVisible(G.Logo),[G.Media]:this.viewUIService.isVisible(G.Media),[G.ToolbarOverflow]:this.viewUIService.isVisible(G.ToolbarOverflow),[G.NodeInfo]:this.viewUIService.isVisible(G.NodeInfo),[G.Pagination]:this.viewUIService.isVisible(G.Pagination),[G.Playthrough]:this.viewUIService.isVisible(G.Playthrough),[G.QuizPrompt]:this.viewUIService.isVisible(G.QuizPrompt),[G.Search]:this.viewUIService.isVisible(G.Search),[G.TitleOnly]:this.viewUIService.isVisible(G.TitleOnly),[G.Toolbar]:this.viewUIService.isVisible(G.Toolbar),[G.Tools]:this.viewUIService.isVisible(G.Tools),[G.ToggleLabels]:this.viewUIService.isVisible(G.ToggleLabels),[G.Undo]:this.viewUIService.isVisible(G.Undo),[G.VisibilityLayers]:this.viewUIService.isVisible(G.VisibilityLayers),[G.SkinLayers]:this.viewUIService.isVisible(G.SkinLayers),[G.Whiteboard]:this.viewUIService.isVisible(G.Whiteboard)}))})}initKeyboardObserver(){this.inputEnabled$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{t?this.bindKeyboard():this.unbindKeyboard()})}initNodeObserver(){this.actions.pipe((0,l.xi)(st.zE),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.viewService.delegateNodeClick(t.node,t.event)}),this.store.select(Mn.z.getSelectedNode).pipe((0,Ds.J)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{const i=(0,m.get)(t,"objectId",void 0),s=(0,m.get)(o,"objectId",void 0);(void 0===o||i!==s)&&this.viewService.toggleNodeInfo(!1)})}initChapterObserver(){this.store.select(fe.N.getSelectedChapterId).pipe((0,S.p)(t=>!!t),(0,le.T)(()=>this.store.selectSnapshot(fe.N.getSelectedChapter)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.store.dispatch(new He.S3),this.setPageTitle(t),this.refreshLayout(),this.viewService.resetUI(),this.viewService.resetContentMode()}),this.store.select(Xe.S.getChapter).pipe((0,S.p)(t=>!!t),(0,le.T)(()=>this.store.selectSnapshot(fe.N.getSelectedChapter)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{if(this.viewService.applyChapterCamera(t),this.viewService.applyChapterScenegraph(t),this.engineService.fireEvent(gt.X.SceneLoaded,null),this.store.selectSnapshot(_e.getPlaythroughEnabled)){const o=this.store.selectSnapshot(_e.getForceAudio);this.viewPlaythroughService.startChapterTimers(t,o);const i=this.store.selectSnapshot(fe.N.getNextChapter);this.viewPlaythroughService.preloadAudio([i],o)}})}startPlaythroughMonitoring(){this.stopPlaythroughMonitoring(),this.playthroughMonitor$=(0,Ht.z)([this.viewPlaythroughService.audioSubject,this.viewPlaythroughService.animationSubject,this.viewPlaythroughService.readingSubject,this.viewPlaythroughService.minimumSubject]).pipe((0,wo.Z)(50),(0,le.T)(([t,o,i,s])=>t.complete&&o.complete&&i.complete&&s.complete),(0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.viewPlaythroughService.startCountdown()}),this.playthroughCountdown$=this.viewPlaythroughService.countdownComplete.pipe((0,S.p)(()=>this.store.selectSnapshot(_e.getPlaythroughEnabled)),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(_e.getPlaythroughSettings);this.store.selectSnapshot(fe.N.isLastChapter)?t.loop?this.viewService.firstChapter("Playthrough Loop"):this.openPlaythroughDialog():this.viewService.nextChapter("playthrough")}),this.playthroughInterrupt$=(0,Wi.h)((0,yn.R)(document,"mousemove").pipe((0,wo.Z)(50),(0,S.p)(t=>t.buttons>0)),(0,yn.R)(document,"mousedown"),(0,yn.R)(document,"keydown"),(0,yn.R)(document,"wheel")).pipe((0,S.p)(()=>this.viewPlaythroughService.audioSubject.getValue().complete&&this.viewPlaythroughService.animationSubject.getValue().complete&&this.viewPlaythroughService.readingSubject.getValue().complete&&this.viewPlaythroughService.minimumSubject.getValue().complete),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.viewPlaythroughService.delayCountdown()})}stopPlaythroughMonitoring(){[this.playthroughMonitor$,this.playthroughCountdown$,this.playthroughInterrupt$].forEach(t=>{t instanceof bC.yU&&t.unsubscribe()})}openPlaythroughDialog(){(0,m.isNil)(this.playthroughDialog)&&(this.playthroughDialog=this.dialog.open(Zp,{width:"100%",height:"100%"}),this.playthroughDialog.closed.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{switch(t){case"explore":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewService.firstChapter("Playthrough Modal - Explore");break;case"playAgain":this.viewService.togglePlaythrough(!0,!0),this.viewService.firstChapter("Playthrough Modal - Play Again");break;case"takeQuiz":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewQuizService.startQuiz();break;default:this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1)}this.playthroughDialog=null}))}initChapterAudioPlayer(){this.store.select(fe.N.getSelectedChapterId).pipe((0,S.p)(t=>!!t),(0,Is.M)(()=>{this.mediaService.stopAllAudio()}),(0,Fn.B)(300),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(_e.getForceAudio);this.store.selectSnapshot(Ue.j.getQuizModeActive)||(t||this.viewUIService.isAudioVisible())&&this.viewService.playChapterAudio(t)})}initLoadProgressObserver(){this.chapterLoadProgress=0,this.store.select(Ei.getChaptersLoadProgress).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.store.selectSnapshot(rt.getLoadingChapter),i=this.store.selectSnapshot(fe.N.getSelectedChapterId);if(!(0,m.isNil)(o)&&i===o.chapterId){const r=100*(t[i]??0);this.store.dispatch(new D.ToggleWindow(fn.Loader,!0)),this.chapterLoadProgress=r,this.changeDetectorRef.markForCheck()}}),this.store.select(Ei.getStoryLoadProgress).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.engineService.fireEvent(gt.X.HumanProgress,{progress:t})}),this.actions.pipe((0,l.rM)(To),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterLoadProgress=100,this.changeDetectorRef.markForCheck(),this.store.dispatch(new D.ToggleWindow(fn.Loader,!1)),this.liveAnnouncer.announce("Loading complete","polite")})}initPlaythroughObserver(){(0,Ht.z)([this.store.select(_e.getPlaythroughEnabled),this.viewWindow$,this.quizModeActive$]).pipe((0,xn.F)(),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i])=>{t&&null===o&&!0!==i?this.startPlaythrough():this.stopPlaythrough()})}initWindowObserver(){this.viewWindow$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{if(this.viewService.resetUI(),t===fn.Tutorial||t===fn.Interact)this.viewService.resetChapter(),this.viewService.toggleLabels(!1);else{const o=this.viewUIService.isUIEnabled(G.Labels);this.viewService.toggleLabels(o)}})}initMobileNav(){const t=(this.platform.ANDROID||this.platform.IOS||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(!function CC(){try{return window.self!==window.top}catch{return!0}}()||I.c.platform===ka.N.SDK);this.store.dispatch(new D.SetIsMobileWeb(t))}initBackgroundColorObserver(){this.background$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.isBackgroundLight=(0,ks.T4)(t),this.changeDetectorRef.markForCheck()})}initToolsFadeout(){this.showTools$.pipe((0,b.Q)(this.ngUnsubscribe),(0,xn.F)()).subscribe(i=>{this.showZones=this.store.selectSnapshot(_e.getIsMobileWeb)?i?["top","right","bottom","left"]:["bottom"]:i?["top","right","bottom","left"]:["top"],this.changeDetectorRef.markForCheck()});const t=this.store.selectSnapshot(_e.getFadeout);0===t&&this.showTools$.next(!0);const o=this.store.selectSnapshot(_e.getIsMobileWeb);this.viewLayout$.pipe((0,b.Q)(this.ngUnsubscribe),(0,xn.F)()).subscribe(i=>{this.showTools$.next(i===Qn.Column||0===t||o)}),this.showTools$.pipe((0,S.p)(i=>!0===i),(0,S.p)(()=>0!==t),(0,Fn.B)(this.store.selectSnapshot(_e.getFadeout)),(0,S.p)(()=>this.viewLayout$.getValue()!==Qn.Column),(0,S.p)(()=>!o),(0,S.p)(()=>!this.store.selectSnapshot(_e.getFadeoutPaused)),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.showTools$.next(!1)}),this.focusMonitor.monitor(document.body,!0).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.focusOrigin=i,("keyboard"===i||"touch"===i)&&this.showTools$.next(!0)}),this.viewService.observeMaterialOverlay(),this.viewService.materialOverlayOut$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new D.SetPreventFadeoutEvent("overlay",this.viewService.isMaterialMenuOut()))})}initVendorAnalyticsEvents(){const t={totalQuestions:0};this.store.select(Ue.j.getQuestionTotal).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{t.totalQuestions=o}),this.store.select(Ue.j.getQuizModeActive).pipe((0,S.p)(()=>this.store.selectSnapshot(Ue.j.getQuestionTotal)>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{o&&this.vendorAnalyticsService.track("Quiz - Entered",t)}),this.actions.pipe((0,l.xi)(Bt.B.SubmitQuestionAnswer),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(Ue.j.getActiveQuestionIndex),i=this.store.selectSnapshot(Ue.j.getQuestionsRemaining);0===o&&this.vendorAnalyticsService.track("Quiz - First Question Answered",t),0===i&&this.vendorAnalyticsService.track("Quiz - Completed",t)}),this.store.select(fe.N.getSelectedChapterModelReady).pipe((0,S.p)(o=>o),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(rt.getStoryId),i=this.store.selectSnapshot(rt.getStory);this.vendorAnalyticsService.trackOncePerPage("View - Loaded",{id:o,chapters:i.chapters.length,tour:i.tags.includes("tour"),animated:i.tags.includes("animated"),quiz:this.store.selectSnapshot(Ue.j.hasQuiz),edit:!1})})}initAccessibility(){this.actions.pipe((0,l.xi)(Lt.yr)).subscribe(t=>{this.liveAnnouncer.announce("Object "+(t.show?"shown":"hidden"))})}initTooltips(){this.mediaUI$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.mediaBarTooltip="collapse"===t?.status?$localize`Open Media Bar`:$localize`Close Media Bar`,this.changeDetectorRef.markForCheck()})}initQuizStateListener(){(0,Ht.z)([this.actions.pipe((0,l.rM)(aa)),this.store.select(_t.getSelectedBookmarkViewMode)]).pipe((0,S.p)(([,t])=>!(0,m.isNil)(t)),(0,b.Q)(this.ngUnsubscribe)).subscribe(([,t])=>{const o=this.store.selectSnapshot(Ue.j.getQuizSettings);this.store.dispatch(new Bt.B.SetQuizSettings({...o,enabled:t!==Ne.Content}))})}initVisibilityLayers(){this.visibilityLayersService.initObservables(),this.legacyVisibilityLayersService.initObservables()}destroyVisibilityLayers(){this.visibilityLayersService.destroyObservables(),this.legacyVisibilityLayersService.destroyObservables()}initAnatomyTree(){this.store.dispatch(new NC.Z(!1))}handleFirstClickTracking(t){t.composedPath().some(r=>"APP-SITE-HEADER"===r.nodeName)||1===this.store.selectSnapshot(Ei.getStoryLoadProgress)&&this.vendorAnalyticsService.trackOncePerPage("First Click")}handleToggleAutoplay(t){this.viewService.toggleAutoplay(t)}handleColumnToggle(){this.viewService.toggleColumn(),this.changeDetectorRef.markForCheck()}handleDrawClick(){this.viewService.toggleWhiteboard(!0)}handleQuizClick(){this.viewQuizService.startQuiz()}handleExitQuiz(){this.viewQuizService.exitQuiz()}handleToggleSearch(t){this.viewService.toggleSearch(Xi.q.Tree,t)}handleToggleLayers(){this.viewService.toggleLayers(!1)}handleSelectTool(t){this.viewService.selectTool(t)}handleToggleMedia(t){this.viewService.toggleMedia(t)}checkLabelsCollapsed(){const t=this.store.selectSnapshot(In.getHorizontalBreakpoint),o=this.store.selectSnapshot(_e.getLabelsBreakpoint),i=this.isLabelBreaking(o);this.store.dispatch(new He.vf(i,t>=Vn.Large?_a.Q.Toggle:_a.Q.None))}isLabelBreaking(t){return window.innerWidth<t}bindKeyboard(){Zn.bind("1",()=>this.viewService.selectTool(qt.s.Select)),Zn.bind("2",()=>this.viewService.selectTool(qt.s.Hide)),Zn.bind("3",()=>this.viewService.selectTool(qt.s.Fade)),Zn.bind(["command+,","ctrl+,"],t=>{t.preventDefault(),this.store.selectSnapshot(In.getHorizontalBreakpoint)>Vn.Medium?this.viewService.toggleColumn():this.viewService.toggleDrawer(),this.changeDetectorRef.markForCheck()}),Zn.bind(["command+enter","ctrl+enter","command+p"],t=>{t.preventDefault(),io.toggleFullscreen()}),Zn.bind("meta+z",t=>{t.preventDefault(),this.viewService.undo()}),Zn.bind(["meta+y","meta+shift+z"],t=>{t.preventDefault(),this.viewService.redo()}),Zn.bind([".","pagedown"],()=>this.viewService.nextChapter("Keyboard")),Zn.bind([",","pageup"],()=>this.viewService.previousChapter("Keyboard")),Zn.bind(["del","backspace"],t=>{t.preventDefault(),this.viewService.hideSelectedStructures()}),Zn.bind("R",t=>{t.preventDefault(),this.viewService.resetChapter()}),Zn.bind("p",t=>{t.preventDefault(),this.viewService.togglePan()}),Zn.bind("/",()=>{const t=this.store.selectSnapshot(Ue.j.getQuizModeActive),o=this.store.selectSnapshot(Be.getUIEntry(G.Search))?.enable??!1;!t&&o&&this.viewService.toggleSearch()}),Zn.bind("?",()=>this.viewService.toggleHelp(v.Shortcuts)),Zn.bind(["space","k"],t=>{t.preventDefault(),this.viewService.toggleAnimation()}),Zn.bind(["j","l"],t=>{switch(t.preventDefault(),t.key){case"j":this.animationService.scrubRelative(-1,!0);break;case"l":this.animationService.scrubRelative(1,!0)}}),Zn.bind(["H","I","F"],t=>{t.preventDefault();const o=this.store.selectSnapshot(Mn.z.getCheckedNodeIds);if(o.length>0)switch(t.key){case"H":this.store.dispatch(new Lt.yr(!1,o));break;case"I":this.nodeService.hideInverse(o);break;case"F":this.nodeService.fade(o)}})}unbindKeyboard(){Zn.reset()}checkFocus(){const t=i=>!(!i||!i.contains(document.activeElement));let o;t(this.columnContainer.nativeElement)?o="column":t(this.drawerContainer?.nativeElement)&&(o="drawer"),this.store.dispatch(new D.SetFocusedElement(o))}resizeEngineContainer(){const{top:t,left:o,width:i,height:s}=this.engineContainer.nativeElement.getBoundingClientRect(),r=new yC.j(i,s,o,t,i,s,qp.g.Shown,1);this.store.dispatch(new st.Sh(r))}updateViewHeight(){const t=this.store.selectSnapshot(gn.getSiteHeader),s=Hp(t,this.store.selectSnapshot(gn.getSiteHeaderHeight),xc(t));this.view.nativeElement.style.setProperty("--vh",`${s}px`)}resetScene(){this.store.dispatch(new st.t5(!0)),this.store.dispatch(new st.dB(!1)),this.store.dispatch(new st.pL(qt.s.Select)),this.store.dispatch(new Sc),this.store.dispatch(new jt.pU(!1)),this.engineService.getEvent(gt.X.AssetsLoadProgress).pipe((0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new st.dB(!0))})}refreshLayout(){const t=this.store.selectSnapshot(Be.getUI),o=this.store.selectSnapshot(_e.getLayout);this.viewLayout$.next(this.viewUIService.getViewLayout(o)),this.columnLayoutStatus=t.column.status,this.updateViewHeight(),this.resizeEngineContainer(),this.store.dispatch(new He.Tz(t.anatomyLabels.enable??!0,t.nodeInfo.enable??!0,!0,t.nodeAudio.enable??!0)),this.store.dispatch(new st.Gv((t.labels.enable??!0)&&(t.labels.shown??!0))),this.changeDetectorRef.markForCheck()}setPageTitle(t){const o=(0,m.get)(t,"displayName");this.title.setTitle((o?`${o} | `:"")+"BioDigital Human Platform")}deselectLabel(){this.store.dispatch(new He.TR(null))}startPlaythrough(){this.startPlaythroughMonitoring();const t=this.store.selectSnapshot(_e.getPlaythroughSettings);this.store.dispatch(new D.SetForceAudio(t.forceAudio));const o=t.forceAudio,i=this.store.selectSnapshot(fe.N.getSelectedChapter),s=this.store.selectSnapshot(_e.getViewLanguage);(o||this.mediaService.chapterHasAudio(i,s))&&(this.store.dispatch(new _i.SetAudioMuted(!1)),this.viewService.playChapterAudio(o),this.store.dispatch(new Dn.ToggleVisible({[G.Audio]:!0}))),this.viewPlaythroughService.startChapterTimers(i,o)}stopPlaythrough(){this.stopPlaythroughMonitoring(),this.viewPlaythroughService.clearChapterTimers(),this.mediaService.stopAllAudio(),this.mediaService.muteAudio(),this.store.dispatch(new _i.SetAudioMuted(!0))}}(Fl=ct).\u0275fac=function(t){return new(t||Fl)(e.rXU(ne.nX),e.rXU(e.gRc),e.rXU(l.il),e.rXU(l.En),e.rXU(Qi.Ai),e.rXU(hn),e.rXU(Mr),e.rXU(Fc),e.rXU(u.y),e.rXU(Yf.w),e.rXU(zi.O),e.rXU(po.S),e.rXU(qe),e.rXU(Ci),e.rXU(c.hE),e.rXU(lt.OD),e.rXU(Hf),e.rXU(Qi.FN),e.rXU(Qf.lG),e.rXU(Ls),e.rXU(No))},Fl.\u0275cmp=e.VBU({type:Fl,selectors:[["app-view-page"]],viewQuery:function(t,o){if(1&t&&(e.GBs(lD,7),e.GBs(cD,7),e.GBs(dD,5),e.GBs(_D,7),e.GBs(pD,7),e.GBs(uD,5),e.GBs(gD,5),e.GBs(hD,7),e.GBs(mD,5)),2&t){let i;e.mGM(i=e.lsd())&&(o.viewContainer=i.first),e.mGM(i=e.lsd())&&(o.columnContainer=i.first),e.mGM(i=e.lsd())&&(o.drawerContainer=i.first),e.mGM(i=e.lsd())&&(o.engineContainer=i.first),e.mGM(i=e.lsd())&&(o.view=i.first),e.mGM(i=e.lsd())&&(o.viewCameraBar=i.first),e.mGM(i=e.lsd())&&(o.viewLogo=i.first),e.mGM(i=e.lsd())&&(o.viewSceneBase=i.first),e.mGM(i=e.lsd())&&(o.viewToolbar=i.first)}},hostBindings:function(t,o){1&t&&e.bIt("click",function(s){return o.onClick(s)},!1,e.EBC)("focusin",function(s){return o.onFocusin(s)},!1,e.EBC)("focusout",function(s){return o.onFocusout(s)},!1,e.EBC)("mousemove",function(s){return o.onActive(s)},!1,e.EBC)("mouseenter",function(s){return o.onActive(s)},!1,e.EBC)("touchstart",function(s){return o.onActive(s)},!1,e.EBC)("mouseleave",function(s){return o.onInactive(s)},!1,e.EBC)},decls:76,vars:110,consts:()=>{let n,t,o,i,s,r,a,d,f;return n=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,t=$localize`:a8428f42065b95600de48a6a73096f397fe775487584706465725808283:Media Controls`,o=$localize`:76fbeb67fc76fbebecb31395a76d10d6f65188f44157627069774048070:Exit Quiz`,i=$localize`:774e30c83aba684afbcbdfc30ab51e5ccdbb08ef5018030683477673235:Close Anatomy`,s=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,r=$localize`:8d649ab3a81d2e70497b706acb98ee078c9625cf6438735765171590350:Close anatomy column`,a=$localize`:e6871f3c841a7ea3095d82216180cdf00363e6307224674749555007457:Close Anatomy Layers`,d=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,f=$localize`:c02273112dd8379f0d352a3b817f7c69bc525b3c7920034665687725450:Close layers`,[["viewContainer",""],["view",""],["engineContainer",""],["viewSceneBase",""],["columnContainer",""],["drawerContainer",""],n,o,s,r,d,f,["role","main","id","viewContainer"],[1,"view-page",3,"ngClass"],["id","engine-container","data-test","viewEngineContainer",1,"view-page__engine"],[3,"contextMenuEnable"],[3,"showZones"],["left",""],[4,"ngIf"],[3,"layout",4,"ngIf"],["top","",4,"ngIf"],["right",""],[1,"flex","flex-col","justify-end","h-full"],["orientation","vertical","class","mt-2","data-test","viewFullscreen",4,"ngIf"],["bottom",""],["class","w-full",4,"ngIf"],["class","view-page__logo",3,"ngClass","logoColor","logoSize",4,"ngIf"],["class","view-page__exit-quiz",4,"ngIf"],[1,"view-page__scene-base"],["class","view-page__column",4,"ngIf"],["data-test","viewSearch",3,"floating","padded","wide",4,"ngIf"],["data-test","viewVisibilityLayers",3,"wide","floating","padded",4,"ngIf"],["class","view-page__drawer",4,"ngIf"],["class","view-block-input",4,"ngIf"],[3,"contentId","contentType",4,"ngIf"],[3,"show","percent",4,"ngIf"],["data-test","viewWhiteboard",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],[3,"layout"],["top",""],["class","w-full view-page__title-nav",4,"ngIf"],[1,"w-full","view-page__title-nav"],["class","view-page__drawer-nav",3,"ngClass",4,"ngIf"],[1,"view-page__drawer-nav",3,"ngClass"],["appPreventFadeout","",4,"ngIf"],["appPreventFadeout",""],["app-view-button","","buttonSize","small",3,"click"],["size","lg","icon","user-graduate"],["class","flex justify-between w-full",4,"ngIf"],[1,"flex","justify-between","w-full"],[1,"flex","gap-2"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click"],["icon","user-graduate",1,"pl-3"],[1,"px-3","text-xs","font-semibold","uppercase"],["orientation","vertical","data-test","viewFullscreen",1,"mt-2"],["buttonSize","small"],[1,"w-full"],["class","flex justify-end gap-2","role","group","aria-label",t,4,"ngIf"],["class","view-page__mobile-nav",3,"ngClass",4,"ngIf"],["role","group","aria-label",t,1,"flex","justify-end","gap-2"],[3,"ngClass",4,"ngIf"],["orientation","horizontal",4,"ngIf"],[3,"ngClass"],["orientation","horizontal","appPreventFadeout","",3,"ngClass"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"matTooltip","thin","click",4,"ngIf"],["orientation","horizontal"],[1,"w-full",3,"autoFocus","showSpeed","showScrubber"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"click","matTooltip","thin"],["icon","angle-right","appLogicalDir",""],["icon","angle-left","appLogicalDir",""],[1,"view-page__mobile-nav",3,"ngClass"],[2,"min-width","0",3,"ngClass"],[3,"showTitle",4,"ngIf"],[3,"showTitle"],[1,"view-page__logo",3,"ngClass","logoColor","logoSize"],[1,"view-page__exit-quiz"],[1,"px-3","text-xs","uppercase"],[1,"view-page__column"],["data-test","viewSearch",3,"floating","padded","wide"],["header",""],[1,"flex","justify-between"],[1,"px-3","py-6","text-base","font-semibold"],["app-view-button","","matTooltip",i,"matTooltipPosition","right","data-test","viewSearchClose",3,"click"],["icon","times"],[1,"sr-only"],["body",""],[1,"h-full","px-3"],["data-test","viewVisibilityLayers",3,"wide","floating","padded"],["app-view-button","","matTooltip",a,"matTooltipPosition","right","data-test","viewVisibilityLayersClose",3,"click"],[1,"h-full","px-3","py-4"],[1,"view-page__drawer"],[1,"view-block-input"],[3,"contentId","contentType"],[3,"show","percent"],[3,"percent",4,"ngIf"],[3,"percent"],["data-test","viewWhiteboard"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",12,0)(2,"div",13,1),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.j41(14,"div",14,2),e.nrm(16,"app-engine",15),e.nI1(17,"async"),e.j41(18,"app-view-zones",16),e.qex(19,17),e.DNE(20,CD,1,0,"app-view-toolbar",18),e.nI1(21,"async"),e.DNE(22,TD,2,3,"app-view-undo",19),e.nI1(23,"async"),e.bVm(),e.DNE(24,ND,6,9,"ng-container",20),e.nI1(25,"async"),e.nI1(26,"async"),e.DNE(27,VD,5,7,"ng-container",20),e.nI1(28,"async"),e.DNE(29,xD,1,0,"ng-container",20),e.nI1(30,"async"),e.nI1(31,"async"),e.qex(32,21),e.j41(33,"div",22),e.DNE(34,FD,1,0,"app-engine-camera-bar",18),e.nI1(35,"async"),e.DNE(36,GD,2,0,"app-pillbox",23),e.nI1(37,"async"),e.k0s(),e.bVm(),e.qex(38,24),e.DNE(39,KD,6,8,"div",25),e.nI1(40,"async"),e.nI1(41,"async"),e.bVm(),e.k0s(),e.DNE(42,JD,5,15,"app-view-logo",26),e.nI1(43,"async"),e.DNE(44,qD,5,0,"div",27),e.nI1(45,"async"),e.nI1(46,"async"),e.nrm(47,"div",28,3),e.k0s(),e.j41(49,"div",null,4),e.DNE(51,ZD,1,0,"app-view-column-container",29),e.nI1(52,"async"),e.DNE(53,e3,13,5,"app-view-column",30),e.nI1(54,"async"),e.DNE(55,t3,13,5,"app-view-column",31),e.nI1(56,"async"),e.nI1(57,"async"),e.k0s(),e.DNE(58,n3,3,0,"div",32),e.nI1(59,"async"),e.k0s()(),e.DNE(60,i3,1,0,"div",33),e.nI1(61,"async"),e.DNE(62,o3,1,2,"app-view-ondemand",34),e.nI1(63,"async"),e.DNE(64,s3,2,4,"app-view-progress",35),e.nI1(65,"async"),e.DNE(66,d3,9,12,"app-view-loader",18),e.nI1(67,"async"),e.DNE(68,_3,1,0,"app-view-tour",18),e.nI1(69,"async"),e.DNE(70,p3,1,0,"app-view-whiteboard",36),e.nI1(71,"async"),e.DNE(72,u3,1,0,"app-view-print",18),e.nI1(73,"async"),e.DNE(74,g3,1,0,"app-view-content-warning",37),e.nrm(75,"app-view-iphone12-warning")),2&t){let i,s,r,a,d;e.R7$(2),e.Y8G("ngClass",e.lV(101,fD,"column"===e.bMT(4,27,o.viewLayout$),"drawer"===e.bMT(5,29,o.viewLayout$),e.bMT(6,31,o.paginationVisible$),e.bMT(7,33,o.columnVisible$),!1===e.bMT(8,35,o.columnVisible$),e.bMT(9,37,o.drawerVisible$)&&"show"===(null==(i=e.bMT(10,39,o.drawerUI$))?null:i.status),!1===e.bMT(11,41,o.drawerVisible$),e.bMT(12,43,o.drawerVisible$)&&"collapse"===(null==(i=e.bMT(13,45,o.drawerUI$))?null:i.status))),e.R7$(14),e.Y8G("contextMenuEnable",null==(s=e.bMT(17,47,o.contextMenu$))?null:s.enable),e.R7$(2),e.Y8G("showZones",o.showZones),e.R7$(2),e.Y8G("ngIf",e.bMT(21,49,o.toolbarVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(23,51,o.undoVisible$)),e.R7$(2),e.Y8G("ngIf","drawer"===e.bMT(25,53,o.viewLayout$)&&!1===e.bMT(26,55,o.isMobileWeb$)),e.R7$(3),e.Y8G("ngIf","column"===e.bMT(28,57,o.viewLayout$)),e.R7$(2),e.Y8G("ngIf","drawer"===e.bMT(30,59,o.viewLayout$)&&!0===e.bMT(31,61,o.isMobileWeb$)),e.R7$(5),e.Y8G("ngIf",e.bMT(35,63,o.cameraVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(37,65,o.fullscreenVisible$)),e.R7$(3),e.Y8G("ngIf",!0===e.bMT(40,67,o.isMobileWeb$)||e.bMT(41,69,o.mediaVisible$)),e.R7$(3),e.Y8G("ngIf",e.bMT(43,71,o.logoVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(45,73,o.quizModeActive$)&&!e.bMT(46,75,o.quizModeLocked$)),e.R7$(7),e.Y8G("ngIf",e.bMT(52,77,o.columnVisible$)),e.R7$(2),e.Y8G("ngIf","show"===(null==(r=e.bMT(54,79,o.searchUI$))?null:r.status)),e.R7$(2),e.Y8G("ngIf","show"===(null==(a=e.bMT(56,81,o.visibilityLayersUI$))?null:a.status)&&"group"===(null==(a=e.bMT(57,83,o.visibilityLayersUI$))?null:a.layersMode)),e.R7$(3),e.Y8G("ngIf",e.bMT(59,85,o.drawerVisible$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(61,87,o.inputEnabled$)),e.R7$(2),e.Y8G("ngIf",e.bMT(63,89,o.viewWindow$)===o.viewWindow.OnDemand),e.R7$(2),e.Y8G("ngIf","circle"===(null==(d=e.bMT(65,91,o.viewUI$))?null:d.loader.template)),e.R7$(2),e.Y8G("ngIf",e.bMT(67,93,o.viewWindow$)===o.viewWindow.Interact),e.R7$(2),e.Y8G("ngIf",e.bMT(69,95,o.viewWindow$)===o.viewWindow.Tutorial),e.R7$(2),e.Y8G("ngIf",e.bMT(71,97,o.viewWindow$)===o.viewWindow.Whiteboard),e.R7$(2),e.Y8G("ngIf",e.bMT(73,99,o.usePrintImage$)),e.R7$(2),e.Y8G("appFlagApplication",o.application.All)("appFlagApplicationMode","include")("appFlagApplicationNative",o.nativePlatform.All)}},dependencies:[rn,q.YU,q.bT,nu.Y,Us,$i.e,Un,rd,yt.R,On.oV,Do,sd,ns,dd,cd,yu,OS,MS,IS,vd,VA,Iu,ni,d2,m2,b2,E2,Ml,Ru,Du,K2,as,fo,an,Md,Id,Uo,aD,JS,zS,q.Jj],styles:['.view-page{--drawer-height: 0;--column-width: 320px;border:none;width:100vw;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:hidden;display:grid;transition:all .25s}.view-page--layout-column{grid-template-rows:100%;grid-template-columns:var(--column-width) 1fr;grid-template-areas:"column engine"}.view-page--layout-drawer{grid-template-rows:1fr var(--drawer-height);grid-template-columns:1fr;grid-template-areas:"engine" "drawer"}.view-page--column-open{--column-width: 320px}.view-page--column-open.view-page--show-aside{--column-width: 424px}.view-page--column-closed{--column-width: 0}.view-page--drawer-peek{--drawer-height: 40px}.view-page--drawer-open{--drawer-height: 40%}.view-page--drawer-closed.view-page--has-drawer{--drawer-height: 0}.view-page__column{background-color:#fff;grid-area:column;height:100%}.view-page__engine{grid-area:engine;width:100%;height:100%;position:relative}.view-page__drawer{max-width:100vw;border-top:1px solid #d7e0ea;background-color:#fff;grid-area:drawer}.view-page--drawer-push{padding-bottom:var(--drawer-height)}.view-page__title-nav{display:flex;justify-content:flex-start;gap:8px}.view-page__drawer-nav{display:grid;grid-template-columns:minmax(0,1fr) auto;width:auto}.view-page__drawer-nav--overflow{gap:8px}.view-page__mobile-nav{display:flex;justify-content:space-between;gap:8px;width:auto}.view-page__logo{display:inline-block;position:absolute;inset-inline-start:12px;inset-block-end:12px;z-index:10}.view-page__logo--raised{inset-block-end:62px}.view-page__exit-quiz{position:absolute;inset-block-start:12px;inset-inline-end:12px;z-index:10}.view-page__scene-base{position:absolute;left:0;bottom:0;right:0;z-index:10;transition:transform .3s}@media (prefers-reduced-motion: reduce){.view-page{transition:none}}.view-block-input{position:fixed;inset:0;z-index:10000}\n'],encapsulation:2,changeDetection:0}),ht([(0,l.l6)(rt.getStory),mt("design:type",y.c)],ct.prototype,"story$",void 0),ht([(0,l.l6)(rt.getStoryId),mt("design:type",y.c)],ct.prototype,"storyId$",void 0),ht([(0,l.l6)(Be.getUI),mt("design:type",y.c)],ct.prototype,"viewUI$",void 0),ht([(0,l.l6)(_e.getAutoplay),mt("design:type",y.c)],ct.prototype,"autoplay$",void 0),ht([(0,l.l6)(_e.getInputEnabled),mt("design:type",y.c)],ct.prototype,"inputEnabled$",void 0),ht([(0,l.l6)(_e.getIsMobileWeb),mt("design:type",y.c)],ct.prototype,"isMobileWeb$",void 0),ht([(0,l.l6)(_e.getContentMode),mt("design:type",y.c)],ct.prototype,"contentMode$",void 0),ht([(0,l.l6)(_e.getFullscreenActive),mt("design:type",y.c)],ct.prototype,"fullscreenActive$",void 0),ht([(0,l.l6)(_e.getDrawerCoversContent),mt("design:type",y.c)],ct.prototype,"drawerCoversContent$",void 0),ht([(0,l.l6)(_e.getInteractType),mt("design:type",y.c)],ct.prototype,"interactType$",void 0),ht([(0,l.l6)(_e.getOnDemand),mt("design:type",y.c)],ct.prototype,"onDemand$",void 0),ht([(0,l.l6)(_e.getShowHelpTab),mt("design:type",y.c)],ct.prototype,"showHelpTab$",void 0),ht([(0,l.l6)(_e.getUsePrintImage),mt("design:type",y.c)],ct.prototype,"usePrintImage$",void 0),ht([(0,l.l6)(_e.getOpenWindow),mt("design:type",y.c)],ct.prototype,"viewWindow$",void 0),ht([(0,l.l6)(_e.getTutorialSeen),mt("design:type",y.c)],ct.prototype,"tutorialSeen$",void 0),ht([(0,l.l6)(Ei.getStoryLoadProgress),mt("design:type",y.c)],ct.prototype,"storyLoadProgress$",void 0),ht([(0,l.l6)(In.getHorizontalBreakpoint),mt("design:type",y.c)],ct.prototype,"horizontalBreakpoint$",void 0),ht([(0,l.l6)(In.getVerticalBreakpoint),mt("design:type",y.c)],ct.prototype,"verticalBreakpoint$",void 0),ht([(0,l.l6)(fe.N.getSelectedChapter),mt("design:type",y.c)],ct.prototype,"chapter$",void 0),ht([(0,l.l6)(fe.N.getSelectedChapterReadyState),mt("design:type",y.c)],ct.prototype,"selectedChapterReady$",void 0),ht([(0,l.l6)(fe.N.getChaptersLoaded),mt("design:type",y.c)],ct.prototype,"chaptersLoaded$",void 0),ht([(0,l.l6)(fe.N.getSelectedChapterIndex),mt("design:type",y.c)],ct.prototype,"chapterIndex$",void 0),ht([(0,l.l6)(fe.N.getChapterCount),mt("design:type",y.c)],ct.prototype,"chapterCount$",void 0),ht([(0,l.l6)(fe.N.getSelectedChapterBackground),mt("design:type",y.c)],ct.prototype,"background$",void 0),ht([(0,l.l6)(Be.getVisible(G.Audio)),mt("design:type",y.c)],ct.prototype,"audioVisible$",void 0),ht([(0,l.l6)(Xe.S.getAnimationPlaying),mt("design:type",y.c)],ct.prototype,"animationPlaying$",void 0),ht([(0,l.l6)(Xe.S.getHoveredNode),mt("design:type",y.c)],ct.prototype,"hoveredNode$",void 0),ht([(0,l.l6)(Xe.S.getActiveTool),mt("design:type",y.c)],ct.prototype,"activeTool$",void 0),ht([(0,l.l6)(Xe.S.getEnginePosition),mt("design:type",y.c)],ct.prototype,"enginePosition$",void 0),ht([(0,l.l6)(Xe.S.getCanvasHeightBreakpoint),mt("design:type",y.c)],ct.prototype,"canvasHeightBreakpoint$",void 0),ht([(0,l.l6)(Ze.getSelectedLabel),mt("design:type",y.c)],ct.prototype,"selectedLabel$",void 0),ht([(0,l.l6)(Ue.j.hasQuiz),mt("design:type",y.c)],ct.prototype,"hasQuiz$",void 0),ht([(0,l.l6)(Ue.j.getQuizModeActive),mt("design:type",y.c)],ct.prototype,"quizModeActive$",void 0),ht([(0,l.l6)(Ue.j.getQuizModeLocked),mt("design:type",y.c)],ct.prototype,"quizModeLocked$",void 0),ht([(0,l.l6)(Ue.j.getQuizEnabled),mt("design:type",y.c)],ct.prototype,"quizEnabled$",void 0),ht([(0,l.l6)(Ue.j.getActiveQuestionIndex),mt("design:type",y.c)],ct.prototype,"activeQuestionIndex$",void 0),ht([(0,l.l6)(Ue.j.getQuestionTotal),mt("design:type",y.c)],ct.prototype,"questionTotal$",void 0),ht([(0,l.l6)(_e.getStartingTool),mt("design:type",y.c)],ct.prototype,"startingTool$",void 0),ht([(0,l.l6)(Be.getVisible(G.Camera)),mt("design:type",y.c)],ct.prototype,"cameraVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Column)),mt("design:type",y.c)],ct.prototype,"columnVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Drawer)),mt("design:type",y.c)],ct.prototype,"drawerVisible$",void 0),ht([(0,l.l6)(Be.getUIEntry(G.Drawer)),mt("design:type",y.c)],ct.prototype,"drawerUI$",void 0),ht([(0,l.l6)(Be.getVisible(G.DrawerToggle)),mt("design:type",y.c)],ct.prototype,"drawerToggleVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Fullscreen)),mt("design:type",y.c)],ct.prototype,"fullscreenVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Logo)),mt("design:type",y.c)],ct.prototype,"logoVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Media)),mt("design:type",y.c)],ct.prototype,"mediaVisible$",void 0),ht([(0,l.l6)(Be.getUIEntry(G.Media)),mt("design:type",y.c)],ct.prototype,"mediaUI$",void 0),ht([(0,l.l6)(Be.getVisible(G.NodeInfo)),mt("design:type",y.c)],ct.prototype,"nodeInfoVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.QuizPrompt)),mt("design:type",y.c)],ct.prototype,"quizPromptVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Search)),mt("design:type",y.c)],ct.prototype,"searchVisible$",void 0),ht([(0,l.l6)(Be.getUIEntry(G.Search)),mt("design:type",y.c)],ct.prototype,"searchUI$",void 0),ht([(0,l.l6)(Be.getVisible(G.TitleOnly)),mt("design:type",y.c)],ct.prototype,"titleOnlyVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Toolbar)),mt("design:type",y.c)],ct.prototype,"toolbarVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Undo)),mt("design:type",y.c)],ct.prototype,"undoVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.VisibilityLayers)),mt("design:type",y.c)],ct.prototype,"visibilityLayersVisible$",void 0),ht([(0,l.l6)(Be.getUIEntry(G.VisibilityLayers)),mt("design:type",y.c)],ct.prototype,"visibilityLayersUI$",void 0),ht([(0,l.l6)(Be.getVisible(G.ColumnToggle)),mt("design:type",y.c)],ct.prototype,"columnToggleVisible$",void 0),ht([(0,l.l6)(Be.getVisible(G.Pagination)),mt("design:type",y.c)],ct.prototype,"paginationVisible$",void 0),ht([(0,l.l6)(Be.getUIEntry(G.ContextMenu)),mt("design:type",y.c)],ct.prototype,"contextMenu$",void 0);let zu=(()=>{var n;class t{constructor(){}resolve(i){const s={...i.queryParams},r=Object.keys(s).reduce((a,d)=>{const f=Array.isArray(s[d]);return a[d]=f?(0,m.last)(s[d]):s[d],a},{});return(0,cc.N9)(r)}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac}),t})();var h3=_(26047),pb=_(60830);function ps(n,t){const{procName:o,actionFn:i,aliases:s=[],mapFnIn:r,mapFnOut:a,hideDefinition:d=!1}=t,f=function(L){const ee=this,re=r?r(L):L,ve=i(re);if(!(typeof ve>"u"))if(ve instanceof y.c)ve.pipe((0,pb.$)()).subscribe(Ee=>{const Re=a?a(Ee):Ee;ee.setResult(Re)});else{const Oe=a?a(ve):ve;ee.setResult(Oe)}};[o,...s].forEach(L=>{n.defineAPIProcedure(L,f,{hidden:d})})}var Te=function(n){return n.AnnotationsCreate="annotations.create",n.AnnotationsDestroy="annotations.destroy",n.AnnotationsInfo="annotations.info",n.AnnotationsSetDescription="annotations.setDescription",n.AnnotationsSetLabelsShown="annotations.setLabelsShown",n.AnnotationsSetTitle="annotations.setTitle",n.AnnotationsUpdate="annotations.update",n.AnnotationsSetEnabled="annotations.setEnabled",n.CameraInfo="camera.info",n.CameraOrbit="camera.orbit",n.CameraPan="camera.pan",n.CameraReset="camera.reset",n.CameraSet="camera.set",n.CameraZoom="camera.zoom",n.setCameraMode="camera.setCameraMode",n.CameraDisableChapterCamera="camera.disableChapterCamera",n.CameraEnableChapterCamera="camera.enableChapterCamera",n.GetAnnotationInfo="annotations.info",n.HideAnnotations="annotations.hide",n.HotspotsCreate="hotspots.create",n.HotspotsDestroy="hotspots.destroy",n.HotspotsHide="hotspots.hide",n.HotspotsInfo="hotspots.info",n.HotspotsShow="hotspots.show",n.HotspotsTypes="hotspots.types",n.HotspotsUpdate="hotspots.update",n.HumanInfo="human.info",n.HumanCanvasInfo="human.canvasInfo",n.InputDisable="input.disable",n.InputEnable="input.enable",n.LabelsCreate="labels.create",n.LabelsDestroy="labels.destroy",n.LabelsInfo="labels.info",n.LabelsHide="labels.hide",n.LabelsSetEnabled="labels.setEnabled",n.LabelsShow="labels.show",n.LabelsUpdate="labels.update",n.LabelsCanvasUpdate="labels.canvasUpdate",n.LabelsSetScale="labels.setScale",n.NativeErrorMessage="native.errorMessage",n.NativeSetSdkOffline="native.setSdkOffline",n.NativeSetAppVersion="native.setAppVersion",n.NativeRedirect="native.redirect",n.NativeReload="native.reload",n.NativeOfflineModelIds="native.offlineModelIDs",n.QuizInfo="quiz.info",n.QuizEnter="quiz.enter",n.QuizExit="quiz.exit",n.QuizQuestion="quiz.currentQuestion",n.QuizSubmit="quiz.submit",n.QuizNextQuestion="quiz.next",n.QuizPreviousQuestion="quiz.previous",n.QuizSelectQuestion="quiz.select",n.QuizSet="quiz.set",n.QuizReset="quiz.reset",n.SceneMetaData="scene.metadata",n.SceneSetHighlightColor="scene.setHighlightColor",n.SceneColorObject="scene.colorObject",n.SceneDisableHighlight="scene.disableHighlight",n.SceneEnableHighlight="scene.enableHighlight",n.SceneGetColor="scene.getColor",n.SceneInfo="scene.info",n.SceneLoad="scene.load",n.ScenePick="scene.pick",n.SceneReset="scene.reset",n.SceneSelectObjects="scene.selectObjects",n.SceneShowObjects="scene.showObjects",n.SceneTransformObject="scene.transformObject",n.SceneUncolorObject="scene.uncolorObject",n.SceneSnapshot="scene.snapshot",n.SceneCapture="scene.capture",n.SceneRestore="scene.restore",n.SceneEnableXrayMode="scene.enableXray",n.SceneDisableXrayMode="scene.disableXray",n.SceneSetLayersSliderPosition="scene.setLayersSliderPosition",n.SceneGetLayers="scene.getLayers",n.SceneGetPositions="scene.getPositions",n.SceneSetBaseDirectory="scene.setBaseDirectory",n.ShowAnnotations="annotations.show",n.SetAnnotationsShown="annotations.setShown",n.TimelineInfo="timeline.info",n.TimelineQuery="timeline.query",n.TimelineNext="timeline.nextChapter",n.TimelinePause="timeline.pause",n.TimelinePlay="timeline.play",n.TimelinePrev="timeline.previousChapter",n.TimelineSet="timeline.set",n.TimelineSetPlaybackSpeed="timeline.setPlaybackSpeed",n.TimelineGetPlaybackSpeed="timeline.getPlaybackSpeed",n.UIGetBackground="ui.getBackground",n.UIGetDisplay="ui.getDisplay",n.UIGetWorldPosition="ui.getWorldPosition",n.UISetBackground="ui.setBackground",n.UIPresetBackground="ui.presetBackground",n.UISetDisplay="ui.setDisplay",n.UIResetDisplay="ui.resetDisplay",n.UISnapshot="ui.snapshot",n.focusObject="focus.focusObject",n.dissectSetEnabled="dissect.setEnabled",n.pickSingleSetEnabled="pick.single.setEnabled",n.pickMultiSetEnabled="pick.multi.setEnabled",n.getCanvasPos="scene.getCanvasPos",n.sceneSetClickMode="scene.setClickMode",n.sceneGetClickMode="scene.getClickMode",n.IsolateObject="scene.isolateObject",n.UISetOndemand="ui.setOndemand",n.UISetLoadingExperience="ui.setLoadingExperience",n.UISetScrollCaptureMode="ui.setScrollCaptureMode",n.UISetTutorial="ui.setTutorial",n.UISetQuizLock="ui.setQuizLock",n.UIGetWindow="ui.getWindow",n.SceneGetVariantSchemas="scene.getVariantSchemas",n}(Te||{});function Gt(n){return(0,Ht.z)([n.select(fe.N.getStoryChapters),n.select(Xe.S.getChapter)]).pipe((0,S.p)(([t,o])=>!(0,m.isEmpty)(t)&&!!o),(0,dr.c)(0),(0,tn.s)(1))}function us(n){return n.select(fe.N.getAllChaptersModelsReady).pipe((0,S.p)(t=>!0===t),(0,tn.s)(1))}function wd(n){return(0,Ht.z)([n.select(rt.getStory),n.select(Mn.z.getNodes)]).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)&&!(0,m.isEmpty)(o)),(0,tn.s)(1))}function Wu(n){const t=n.captureCamera();return{position:t.lookAt.eye,target:t.lookAt.look,up:t.lookAt.up,zoom:t.zoom}}var Gl,ub=_(34525),y3=_(10352);!function(n){n.isLegacyCaptureFormat=function t(s){return void 0!==s.engineVersion},n.convertCaptureFormat=function o(s){const r=Object.keys(s.objects).reduce((a,d)=>(a.push({objectId:d,selected:!1,hidden:!1}),a),[]);return{storyId:s.timeline.rootName.replace(".json",""),camera:{lookAt:s.camera,zoom:void 0},labels:[],objects:r,background:[],activeChapterId:s.timeline.scrub?s.timeline.scrub.chapterId:void 0}},n.convertMediaFormat=function i(s){const r={};return Object.entries(s).forEach(([a,d])=>{r[a]={fullUrl:d.fullUrl,lang:d.lang,streamType:d.streamType}}),r}}(Gl||(Gl={}));let gb=(()=>{class t{}return t.type="[Analytics] Authorize App",t})(),v3=(()=>{class t{constructor(i,s){this.userType=i,this.response=s}}return t.type="[Analytics] Auth Success",t})(),hb=(()=>{class t{constructor(i,s){this.userType=i,this.response=s}}return t.type="[Analytics] Auth Failure",t})(),$l=(()=>{class t{constructor(i,s){this.interaction=i,this.source=s}}return t.type="[Analytics] Log Interaction",t})(),Xu=(()=>{class t{constructor(i,s){this.interaction=i,this.response=s}}return t.type="[Analyics] Log Interaction Success",t})(),E3=(()=>{class t{constructor(i,s){this.interaction=i,this.response=s}}return t.type="[Analyics] Log Interaction Failure",t})(),mb=(()=>{class t{}return t.type="[Analytics] Log View Analytic",t})(),Hu=(()=>{class t{}return t.type="[Analytics] Log Interaction Chance",t})(),fb=(()=>{class t{}return t.type="[Analytics] Log First Interaction",t})(),Sb=(()=>{class t{}return t.type="[Analytics] Reset First Interaction",t})();var Qu=_(13491);function bb(n){if(!n)return null;const{objectId:t,canvasPos:o,worldPos:i,normal:s}=n;return{objectId:t||void 0,canvasPosition:o?{x:o.x,y:o.y}:void 0,mode:"query",position:i?Qu.n.fromArray(i):void 0,normal:s?Qu.n.fromArray(s):void 0}}function Yu(n,t,o){const i=n.getObjectById(o).parent;return null!==i&&(t[i.objectId].checked||Yu(n,t,i.objectId))}function yb(n,t,o){const i=t.getEvent(gt.X.HumanStarted).pipe((0,pb.$)()),s=o.includes("/")?ye.c.Module:ye.c.Bookmark;return n.dispatch(new Ss(o,s)),i}function vb(n,t){return n.dispatch(new st._y(!0)),t.fireEvent(gt.X.SceneXrayEnabled),!0}function A3(n){return n.find(o=>o.type==uo.m.Images)?.images?.filter(o=>null!=o.urls?.default).map(o=>o.urls.default)??[]}function j3(n,t,o,i,s,r,a,d,f,T,L,ee,re,ve,Oe){return[{procName:Te.SceneMetaData,actionFn:()=>function m3(n){return(0,Ht.z)([n.select(rt.getStory),n.select(fe.N.getStoryChapters)]).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)&&!(0,m.isEmpty)(o)),(0,tn.s)(1))}(n).pipe((0,le.T)(([Ee,Re])=>({title:Ee.displayName,description:Ee.description,chapters:Re.map(Fe=>({id:Fe.id,title:Fe.displayName,description:Fe.description,isAnimated:a.isChapterAnimated(Fe),loops:a.isChapterLooped(Fe),duration:a.getChapterTimeFrame(Fe.id),media:Gl.convertMediaFormat(Fe.media),images:Fe.contentBlocks?A3(Fe.contentBlocks):[],thumbnail:Fe.thumbnails?Fe.thumbnails.default:""}))})))},{procName:Te.focusObject,actionFn:Ee=>(function P3(n,t,o){n.select&&n.xray?vb(t,o):iu(t,o),n.select&&t.dispatch(new Lt.q9(!0,[n.objectId])),t.dispatch(new st.W6(n.objectId,!0,1))}(Ee,n,o),!0),hideDefinition:!0},{procName:Te.dissectSetEnabled,actionFn:Ee=>(n.dispatch(new st.pL(Ee.enable?qt.s.Hide:qt.s.Select)),!0),hideDefinition:!0},{procName:Te.sceneSetClickMode,actionFn:Ee=>(n.dispatch(new st.pL("select"===Ee?qt.s.Select:"hide"===Ee?qt.s.Hide:"fade"===Ee?qt.s.Fade:qt.s.Select)),!0)},{procName:Te.sceneGetClickMode,actionFn:()=>n.selectSnapshot(Xe.S.getActiveTool)},{procName:Te.pickSingleSetEnabled,actionFn:Ee=>{const Re=(()=>{switch(Ee.enable){case void 0:return!n.selectSnapshot(_e.getMultiPickModeEnabled);case!0:return!1;case!1:return!0}})();return n.dispatch(new D.SetMultiPickModeEnabled(Re)),!0},hideDefinition:!0},{procName:Te.pickMultiSetEnabled,actionFn:Ee=>{const Re=void 0===Ee.enable?!n.selectSnapshot(_e.getMultiPickModeEnabled):Ee.enable;return n.dispatch(new D.SetMultiPickModeEnabled(Re)),!0},hideDefinition:!0},{procName:Te.getCanvasPos,actionFn:Ee=>{const Re=ee.getCanvas();return function b3(n,t,o,i,s){o&&Rn.add(t,o,t);const r=n.getViewMat(),a=n.getProjMat(),d=ub.create();Rn.transformMat4(d,t,r),d[3]=1,ub.transformMat4(d,d,a);const T=d[1],L=d[3];return[Math.round((1+d[0]/L)*i/2),Math.round((1-T/L)*s/2)]}(ee,Ee.worldPos,Ee.offset,Re.width,Re.height)},hideDefinition:!0},{procName:Te.SceneCapture,actionFn:()=>Gt(n).pipe((0,le.T)(()=>function M3(n,t,o){const i=o.captureCamera(),s=t.selectSnapshot(Mn.z.getNodes),r=Object.keys(s).map(ee=>({objectId:ee,selected:s[ee].checked||Yu(n,s,ee),hidden:!s[ee].shown})),a=t.selectSnapshot(fe.N.getStoryChapters).map(ee=>({chapterId:ee.id,background:ee.background||y3.RK})),d=t.selectSnapshot(rt.getStoryId);return{camera:i,labels:t.selectSnapshot(Ze.getLabels),storyId:d,objects:r,background:a,activeChapterId:t.selectSnapshot(fe.N.getSelectedChapterId)}}(re,n,s)))},{procName:Te.SceneRestore,actionFn:Ee=>us(n).pipe((0,Cn.Z)(()=>{const Re=Gl.isLegacyCaptureFormat(Ee),Fe=Re?Gl.convertCaptureFormat(Ee):Ee;return function w3(n,t,o,i,s){return yb(o,i,t.storyId).pipe((0,Cn.Z)(()=>(0,v_.H)(function I3(n,t,o,i=!1){return new Promise(s=>{const r=t.objects.filter(L=>!0===L.selected).map(L=>L.objectId),a=i?n.getLeafIds().filter(ee=>void 0===t.objects.find(Oe=>Oe.objectId===ee)):t.objects.filter(L=>!0===L.hidden).map(L=>L.objectId),d=t.background.map(L=>new En.qi(L.chapterId,L.background)),f=t.activeChapterId?[new En.wg(t.activeChapterId)]:[],T=void 0!==t.camera.zoom?[new jt.F5(t.camera.zoom)]:[];setTimeout(()=>{o.dispatch([new jt.Ih(t.camera.lookAt,!1),new He.gJ(t.labels),new Lt.yr(!1,a,void 0,void 0,void 0,!0),new Lt.q9(!0,r),...T,...f,...d]),s(void 0)})})}(n,t,o,s))),(0,Is.M)(()=>{i.fireEvent(gt.X.SceneRestored)}),(0,le.T)(()=>!0))}(re,Fe,n,o,Re)}))},{procName:Te.SceneEnableXrayMode,actionFn:()=>Gt(n).pipe((0,le.T)(()=>vb(n,o)))},{procName:Te.SceneDisableXrayMode,actionFn:()=>Gt(n).pipe((0,le.T)(()=>iu(n,o)))},{procName:Te.SceneLoad,actionFn:Ee=>us(n).pipe((0,Cn.Z)(()=>{t.pipe((0,l.xi)(ys),(0,tn.s)(1)).subscribe(()=>{o.fireEvent(gt.X.SceneReady)});const Re=yb(n,o,Ee);return n.dispatch(new Sb),Re}))},{procName:Te.SceneSetBaseDirectory,actionFn:Ee=>(L.fireEvent(nt.F.NativeSetBaseDirectory,Ee),!0)},{procName:Te.NativeSetSdkOffline,actionFn:Ee=>(L.fireEvent(nt.F.NativeSetSdkOffline,Ee),!0)},{procName:Te.SceneReset,actionFn:()=>(d.resetChapter(),!0)},{procName:Te.SceneInfo,actionFn:Ee=>Gt(n).pipe((0,Cn.Z)(()=>wd(n)),(0,Cn.Z)(([Re,Fe])=>{const Ke=Ee?.chapterId;let it=Fe;Ke&&(it=n.selectSnapshot(Mn.z.getAllNodeState)[Ke]??{});const pt=Ee?.objectId,Mt=pt?[pt]:Object.keys(re.getObjects()),$t=!!Ee.objectId,{displayName:_n}=Re;return function T3(n,t,o,i,s,r,a,d){const f=r.map(T=>function C3(n,t,o,i,s,r){const a=o.getObjectById(s),{children:d,displayName:f,parent:T,shown:L}=a,ee=o.isLeaf(a)?t[s].checked||Yu(o,t,s):void 0,re=t[s].available;return(r?function O3(n,t,o){const i=n.selectSnapshot(_e.getNodeInfoFallback),s=n.selectSnapshot(_e.getViewLanguage);return t.queryNodeInfo(o,i,s).pipe((0,le.T)(r=>r?.description||""),(0,Ai.W)(()=>(0,Rt.of)("")))}(n,i,f):(0,Rt.of)("")).pipe((0,le.T)(Oe=>({objectId:s,name:f,description:Oe,available:re,shown:L,selected:ee,children:d?.map(Ee=>Ee.objectId),parent:T?T.objectId:null})))}(n,t,o,i,T,a));return(0,si.p)(f).pipe((0,le.T)(T=>{const L=T.reduce((ee,re)=>((d||re.available)&&(ee[re.objectId]=re),ee),{});return{name:s,objects:L}}))}(n,it,re,ve,_n,Mt,$t,Ee?.includeUnavailable??!Ke)}))},{procName:Te.ScenePick,actionFn:Ee=>bb(ee.pick(Ee.x,Ee.y))},{procName:Te.SceneSelectObjects,actionFn:Ee=>Gt(n).pipe((0,le.T)(()=>{const Re=!0===Ee.replace,Fe=Ee;return delete Fe.replace,Re&&n.dispatch(new Lt.q9(!1)),n.dispatch(new Lt.q9(!1,[],Fe)),!0}))},{procName:Te.SceneShowObjects,actionFn:Ee=>Gt(n).pipe((0,le.T)(()=>{delete Ee.replace;const Re=(Ke,it)=>{const pt=re.getObjectById(Ke).children;let Mt={[Ke]:it};for(const $t of pt)void 0===Ee[$t.objectId]&&(Mt[$t.objectId]=it,Mt={...Mt,...Re($t.objectId,it)});return Mt},Fe=Object.entries(Ee).reduce((Ke,[it,pt])=>({...Ke,...Re(it,pt)}),{});return n.dispatch(new Lt.yr(!1,[],Fe,void 0,void 0,!0)),!0}))},{procName:Te.IsolateObject,actionFn:Ee=>{const Re="string"==typeof Ee?[Ee]:Ee,Fe=n.selectSnapshot(Xe.S.getViewGraph),Ke=r.getInverseSelection(Fe,Re),it=r.getNodes(Fe,Ke);return n.dispatch(new Lt.yr(!1,it.map(pt=>pt.id),void 0,void 0,void 0,!0)),!0}},{procName:Te.SceneTransformObject,actionFn:Ee=>Gt(n).pipe((0,le.T)(()=>(re.transformObject(Ee.objectId,Ee),!0)))},{procName:Te.SceneColorObject,actionFn:Ee=>wd(n).pipe((0,le.T)(()=>{const{objectId:Re,tintColor:Fe,saturation:Ke,contrast:it,brightness:pt,opacity:Mt}=Ee;return n.dispatch(new Lt.Jp((0,ja.H)({tintColor:Fe,saturation:Ke,contrast:it,brightness:pt,opacity:Mt}),[Re])),!0}))},{procName:Te.SceneGetColor,actionFn:Ee=>wd(n).pipe((0,le.T)(()=>{const Re=n.selectSnapshot(Mn.z.getNodePaint)(Ee.objectId);return(0,ja.Sf)(Re)}))},{procName:Te.SceneUncolorObject,actionFn:Ee=>wd(n).pipe((0,le.T)(()=>(n.dispatch(new Lt.Jp(Es.NR,[Ee.objectId])),!0)))},{procName:Te.SceneDisableHighlight,actionFn:()=>(i.disableHighlight(),!0)},{procName:Te.SceneEnableHighlight,actionFn:()=>(i.enableHighlight(),!0)},{procName:Te.SceneSetHighlightColor,actionFn:Ee=>(i.setHighlightColor(Ee),!0)},{procName:Te.SceneSetLayersSliderPosition,actionFn:Ee=>Gt(n).pipe((0,le.T)(()=>{const{layersMode:Re}=n.selectSnapshot(Be.getUI).visibilityLayers;return Re===cr.Group?function k3(n,t,o){const i=(0,m.clamp)(o.position,0,1),s=!0===o.record,r=n.selectSnapshot(fe.N.getSelectedChapterId),a=n.selectSnapshot(fe.N.getSelectedChapterLayerGroups),d=t.computeGroupPositionsByFraction(a,i);return t.syncLayerGroupsToScene(d),t.syncLayerGroupsToState(r,d,s),!0}(n,f,Ee):function R3(n,t,o){const i=n.selectSnapshot(fe.N.getSelectedChapterId),s=n.selectSnapshot(fe.N.getSelectedChapterCurrentLayers),r=Math.min(1,Math.max(o.position,0)),a=t.fractionToIndex(s,r),d=t.fractionToPosition(s,r,a);return o.record?t.syncLayersToState(i,a,d):t.syncLayersToScene(s,a,d,!1),!0}(n,T,Ee)}))},{procName:Te.SceneGetLayers,actionFn:()=>Gt(n).pipe((0,le.T)(()=>{const{layersMode:Ee}=n.selectSnapshot(Be.getUI).visibilityLayers;return Ee===cr.Group?function D3(n){return[n.selectSnapshot(fe.N.getSelectedChapterLayerGroups).map(i=>i.layers).flat()]}(n):function N3(n){return n.selectSnapshot(fe.N.getAllChaptersCurrentLayers)}(n)}))},{procName:Te.SceneGetPositions,actionFn:()=>Gt(n).pipe((0,le.T)(()=>{const Ee=Oe.findContentBlockByType(n.selectSnapshot(fe.N.getSelectedChapterContentBlocks),uo.m.Positions);return(Ee?Ee.positions:[]).map(Fe=>function L3(n){const t=n.camera.location;return{title:n.title,camera:{position:t.eye,target:t.look,up:t.up}}}(Fe))}))},{procName:Te.SceneGetVariantSchemas,actionFn:()=>Gt(n).pipe((0,le.T)(()=>n.selectSnapshot(rt.getVariantSchemas)))}]}function bo(n,t,o,i){n.defineAPIEvent(t,{events:o||[t],map:i||(s=>s)})}function Eb(n){return n.selectSnapshot(Xe.S.getPlaybackSpeed)}function Cb(n){return uu.T.getColors(n).map(o=>o[255])}function Tb(n,t){const o=n.selectSnapshot(fe.N.getSelectedChapterBackground),{colors:i,colorStops:s,gradientType:r}=o,a=t.gradientType||r,d=t.colorStops||s;if(t.colors){const[f,T]=t.colors;return{colors:[...f,...T],gradientType:a,colorStops:d}}return{colors:i,gradientType:a,colorStops:d}}function Ob(n){return Object.entries(fn).reduce((t,[o,i])=>i===n?o:t,"None")}function Pd(n){return n.selectSnapshot(Ze.getChapterLabels)}function Mb(n,t){return function K3(n,t){return n.find(o=>t===o.id)}(Pd(n),t)}function Ku(n,t){const o=n.getMarkerById(t.id),i=n.getMarkerWorldPosition(o);return{annotationId:t.id,objectId:t.objectId||null,title:t.title,description:t.description,shown:t.shown,occludable:t.occludable,position:i?Qu.n.fromArray(i):null,canvasPosition:o?{x:o.canvasPosition[0],y:o.canvasPosition[1]}:null}}function Ju(n,t){const o=Mb(n,t.annotationId);return o?{...o,...t}:null}function qu(n,t){return t&&n.dispatch(new He.lb(t)),!0}function Zu(n,t){return n.dispatch(new He.eH(t)),!0}function Ib(n,t){return n.reduce((o,i)=>({...o,[`${i}`]:t}),{})}function eg(n,t){return function i4(n,t){return Object.entries(n).filter(([o,i])=>t(o,i)).reduce((o,[i,s])=>({...o,[`${i}`]:s}),{})}(n,(o,i)=>i===t)}function wb(n,t){return Object.keys(eg(n,t))}function Pb(n,t,o){return function J3(n,t){return n.filter(o=>t.includes(o.id))}(n,wb(t,o))}function Ab(n,t,o){const i=wb(t,o).map(r=>function q3(n,...t){const o=t.map(s=>n.filter(a=>s===a.objectId));return function Y3(n){const t=new Set(n);return Array.from(t.values())}([].concat(...o))}(n,r)).map(r=>r.map(a=>a.id));return Ib([].concat(...i),o)}function r4(n,t){return[{eventName:nt.F.AnnotationsCreated,aliasEvents:[nt.F.LabelsCreated],mapFn:o=>Ku(n,o)},{eventName:nt.F.AnnotationsDestroyed,aliasEvents:[nt.F.LabelsDestroyed],mapFn:o=>({annotationId:o.id})},{eventName:nt.F.AnnotationsShown,aliasEvents:[nt.F.LabelsEnabled],mapFn:()=>!0},{eventName:nt.F.AnnotationsHidden,aliasEvents:[nt.F.LabelsDisabled],mapFn:()=>!0}]}function a4(n,t,o,i){return[{procName:Te.AnnotationsInfo,actionFn:()=>Pd(n),mapFnOut:s=>function e4(n,t){return t.reduce((o,i)=>(o[i.id]=Ku(n,i),o),{})}(o,s)},{procName:Te.AnnotationsCreate,mapFnIn:s=>function Z3(n,t,o,i){const s=t.selectSnapshot(fe.N.getSelectedChapter),r=n.getObjectById(i.objectId)?i.objectId:void 0;return o.deserializeAnnotation({annotationId:i.annotationId,title:i.title,description:i.description,objectId:r,pos:i.position,occludable:i.occludable,labelOffset:i.labelOffset,shown:i.shown,labelShown:i.shown},s,Fs.D.Annotation)}(i,n,t,s),actionFn:s=>function t4(n,t){return t.objectId?(n.dispatch(new He.Sh(t,!0)),t):null}(n,s),mapFnOut:s=>s?Ku(o,s):null},{procName:Te.AnnotationsUpdate,mapFnIn:s=>Ju(n,s),actionFn:s=>qu(n,s)},{procName:Te.AnnotationsSetTitle,mapFnIn:s=>Ju(n,s),actionFn:s=>qu(n,s),hideDefinition:!0},{procName:Te.AnnotationsSetDescription,mapFnIn:s=>Ju(n,s),actionFn:s=>qu(n,s),hideDefinition:!0},{procName:Te.AnnotationsDestroy,mapFnIn:s=>Mb(n,s),actionFn:s=>function n4(n,t){return t&&n.dispatch(new He.vx(t)),!0}(n,s)},{procName:Te.ShowAnnotations,actionFn:()=>Zu(n,!0)},{procName:Te.SetAnnotationsShown,actionFn:()=>Zu(n,!0),hideDefinition:!0},{procName:Te.HideAnnotations,actionFn:()=>Zu(n,!1)},{procName:Te.AnnotationsSetLabelsShown,mapFnIn:s=>function o4(n,t){const{annotations:o,objects:i,replace:s}=t,a=o||{},d=i||{},f=Pd(n),T={...eg(a,!0),...eg(a,!1),...Ab(f,d,!0),...Ab(f,d,!1)};return s?{...Ib(f.map(L=>L.id),!1),...T}:T}(n,s),actionFn:s=>function s4(n,t){const o=Pd(n),i=Pb(o,t,!1),s=Pb(o,t,!0);n.dispatch(new He.D3(s,!0)),n.dispatch(new He.D3(i,!1))}(n,s),hideDefinition:!0}]}var zr=_(20714);const l4={};function Nb(n,t){t.hasOwnProperty("data")&&(t[n]=t.data)}const yo={hotspotSeedId:0,hotspotIdMap:new Map,getHotspotMap:n=>{const{hotspotIdMap:t,createHotspotId:o}=yo;return n.selectSnapshot(Ze.getLabels).forEach(s=>{const r=s.id;typeof t.get(r)>"u"&&o(r)}),t},createHotspotId:n=>(yo.hotspotSeedId++,yo.hotspotIdMap.set(n,yo.hotspotSeedId),yo.hotspotSeedId),getHotspotIdByLabel:(n,t,o)=>{const{getHotspotMap:i,createHotspotId:s}=yo,a=i(n).get(t);return o&&typeof a>"u"?s(t):a},getLabelIdByHotspotId:(n,t)=>{const o=yo.getHotspotMap(n),i=Array.from(o).find(([s,r])=>r===t);return i?i[0]:null}};function Rb(n,t){const o=n.selectSnapshot(Ze.getLabels);return typeof t<"u"?o.filter(i=>i.chapterId===t):o}function Ad(n,t){const o=Rb(n),i=yo.getLabelIdByHotspotId(n,t);return o.find(s=>s.id===i)}function Db(n){return n===zr.H.CirclePlus?Ui.O.Plus:n===zr.H.CircleMinus?Ui.O.Minus:Ui.O.Default}function tg(n,t){return yo.getHotspotIdByLabel(n,t)}function Nd(n,t){return{...t,id:tg(n,t.id)}}function kb(n,t,o){const i=t.selectSnapshot(fe.N.getStoryChapters);return o.map(s=>function p4(n,t,o,i){const{id:s,chapterId:r,title:a,objectId:d}=i,f=o.findIndex(ve=>r===ve.id),T=yo.getHotspotIdByLabel(t,s,!0),L=n.getMarkerById(s),ee=n.getMarkerWorldPosition(L),re=L?.marker3D?.direction;return{id:T,title:a,objectId:d,position:ee?Lb(ee):null,direction:re?Lb(re):null,canvasPosition:L?u4(L.canvasPosition):null,chapterScope:f,type:i.pinType===Ui.O.PlusMinus?zr.H.CirclePlus:zr.H.Circle,shown:i.shown,data:l4[i.id]}}(n,t,i,s))}function Lb(n){return{x:n[0],y:n[1],z:n[2]}}function Rd(n){return[n.x,n.y,n.z]}function u4(n){return{x:n[0],y:n[1]}}function Ub(n,t,o){return n.dispatch(new He.D3(t,o)),!0}function ng(n,t){if("number"==typeof t){const o=Ad(n,t);return o?[o]:[]}return Rb(n)}function b4(n){return[{eventName:nt.F.HotspotsEntered,mapFn:t=>Nd(n,t)},{eventName:nt.F.HotspotsLeft,mapFn:t=>Nd(n,t)},{eventName:nt.F.HotspotsPicked,mapFn:t=>Nd(n,t)},{eventName:nt.F.HotspotsDisplayUpdated,mapFn:t=>Nd(n,t)},{eventName:nt.F.HotspotsPositionUpdated,mapFn:t=>function d4(n,t){const{id:o,canvasPos:i}=t,{x:s,y:r}=i;return{id:tg(n,o),canvasPosition:{x:s,y:r,0:s,1:r},occluded:t.occluded}}(n,t)}]}function y4(n,t,o){return[{procName:Te.HotspotsInfo,actionFn:i=>{const s="number"==typeof i?i:void 0;if(void 0!==s){const r=Ad(n,s);return kb(o,n,[r])[0]}{const r=ng(n,s);return kb(o,n,r)}}},{procName:Te.HotspotsTypes,mapFnIn:()=>function g4(){return Object.values(zr.H).map(n=>`${n}`)}(),actionFn:i=>i},{procName:Te.HotspotsCreate,mapFnIn:i=>function c4(n,t,o){const{title:i,objectId:s,position:r,direction:a,chapterScope:d,type:f}=o,T=n.selectSnapshot(fe.N.getStoryChapters),L=n.selectSnapshot(fe.N.getSelectedChapter),ee=n.selectSnapshot(fe.N.getSelectedChapterIndex),re="number"==typeof d?d:ee,ve=T[re]||L,Oe=!1!==o.shown,Re={title:i,type:f||zr.H.CircleLabel,objectId:s,pos:r?Rd(r):null,dir:a?Rd(a):null,shown:Oe,symbol:"",className:""},Fe=t.deserializeHotspots({},ve,re,Re);return Fe.title=i,Fe.flyTo=!1,Fe.flyToTarget=null,Fe.occludable=!0,Fe.pinGlow=!1,Fe.pinType=Ui.O.PlusMinus,Fe.shown=Oe,Fe.hideWire=!0,Fe.theme=Fs.D.StudioNext,Fe.pinType=Db(f),Nb(Fe.id,o),Fe}(n,t,i),actionFn:i=>function h4(n,t){return t.objectId?(n.dispatch(new He.Sh(t,!0)),t):null}(n,i),mapFnOut:i=>i?tg(n,i.id):null},{procName:Te.HotspotsUpdate,mapFnIn:i=>function S4(n,t){const o=Ad(n,t.id);return o?function _4(n,t){const{title:o,objectId:i,direction:s,position:r,shown:a,type:d}=n,f={...t,title:o,objectId:i,shown:a,pos:r?Rd(r):null,dir:s?Rd(s):null,pinType:d?Db(d):null};return Nb(t.id,n),{...t,...(0,m.omitBy)(f,m.isNil)}}(t,o):null}(n,i),actionFn:i=>i?function m4(n,t){return n.dispatch(new He.lb(t)),t}(n,i):null},{procName:Te.HotspotsDestroy,mapFnIn:i=>Ad(n,i),actionFn:i=>i?function f4(n,t){return n.dispatch(new He.vx(t)),t}(n,i):null},{procName:Te.HotspotsShow,mapFnIn:i=>ng(n,i),actionFn:i=>Ub(n,i,!0)},{procName:Te.HotspotsHide,mapFnIn:i=>ng(n,i),actionFn:i=>Ub(n,i,!1)}]}var jb=_(16124),v4=_(95370);function Vb(n){return n.selectSnapshot(Ze.getChapterLabels)}function xb(n,t){return n.dispatch(new He.eH(t)),!0}function Wr(n,t){return Vb(n).find(i=>t===i.id)}function ig(n,t){return Vb(n).filter(i=>t.includes(i.id))}function og(n,t,o){return t&&t.objectId?(n.dispatch(o?new He.Sh(t,!0):new He.lb(t)),t):null}function Fb(n,t){const o=document.createElement("span");return o.innerHTML=n,(0,m.trim)(o.textContent).length<=t}function Gb(n,t){const o=(0,m.cloneDeep)(n);return o.title=t.title&&Fb(t.title,100)?t.title:o.title,o.description=t.description&&Fb(t.description,300)?t.description:o.description,o.theme=t.theme||o.theme,o.pinType=t.pinType||o.pinType,o.sequentialType=t.sequentialType||o.sequentialType,o.offset=function O4(n,t){return t||[-(n.hideWire?20:32),0]}(o,t.labelOffset),o.pinGlow=void 0!==t.pinGlow?t.pinGlow:o.pinGlow,o.hideWire=void 0!==t.hideWire?t.hideWire:o.hideWire,o.hideTag=void 0!==t.hideTag?t.hideTag:o.hideTag,o.collapseDescription=void 0!==t.collapseDescription?t.collapseDescription:o.collapseDescription,o.occludable=void 0!==t.occludable?t.occludable:o.occludable,o.cameraPosition=t.flyToCamera||o.cameraPosition,o.flyTo=function M4(n,t){return!1!==t&&(t||n.flyTo)}(o,t.flyTo),o.states=function I4(n){if(!n.flyTo)return[];const t=[new jb.B,new jb.B];t[0].errands=[new pu.T],t[1].errands=n.cameraPosition?[new v4.v(n.cameraPosition)]:[new _u.F(n.objectId)]}(o),o}function Xr(n,t){if(t){const o=n.getMarkerById(t.id),i=n.getMarkerWorldPosition(o);return{labelId:t.id,objectId:t.objectId,title:t.title,description:t.description,theme:t.theme,pinType:t.pinType,labelOffset:t.offset,hideWire:t.hideWire,pinGlow:t.pinGlow,occludable:t.occludable,sequentialType:t.sequentialType,shown:t.shown,collapseDescription:t.collapseDescription,hideTag:t.hideTag,flyTo:!0===t.flyTo,flyToCamera:t.cameraPosition,position:i??t.pos,canvasPosition:o?.canvasPosition??[-1,-1],occluded:o?.occluded??!0}}return null}function $b(n,t){return t.reduce((o,i)=>(o[i.id]=Xr(n,i),o),{})}function sg(n){return n.selectSnapshot(Ue.j.getAllQuestions)}function rg(n,t){return sg(n).find(o=>o.id===t)}function Bb(n){return rg(n,lg(n))}function Hr(n){return{enabled:n.selectSnapshot(Ue.j.getQuizEnabled),active:n.selectSnapshot(Ue.j.getQuizModeActive),questions:L4(sg(n)),questionId:lg(n),submissions:N4(n,ag(n))}}function N4(n,t){return t.map(o=>zb(n,o))}function zb(n,t){const o=Bb(n);return{questionId:t.questionId,answerIds:o.data.correctAnswer,correctAnswerIds:_g(o),correct:(0,eo.Br)(o,t.answer)}}function ag(n){return n.selectSnapshot(Ue.j.getAllSubmissions)}function lg(n){return n.selectSnapshot(Ue.j.getActiveQuestionId)}function cg(n){const t=Bb(n),o=function A4(n){return ag(n).find(o=>o.questionId===lg(n))}(n);return{question:dg(t),submission:o?zb(n,o):void 0}}function Wb(n){return n.map(t=>function R4(n){const t=n.type;switch(t){case uo.m.Markdown:{const{markdown:o}=n;return{type:t,content:o}}case uo.m.Images:{const{images:o}=n;return{type:t,content:o.map(s=>s.urls.default)}}default:return{type:t,content:""}}}(t))}function dg(n){let t=[],o="";switch(n.type){case vn.Q5.MultipleChoice:{const i=n.data;t=function D4(n){return n.map(t=>function k4(n){return{answerId:n.value,displayText:n.label}}(t))}(i.options),o=i.correctAnswer;break}case vn.Q5.SelectAnatomy:t=n.data.correctAnswer.map(s=>({answerId:s,displayText:s})),o="";break;case vn.Q5.LabelAnatomy:t=n.data.options.map(s=>({answerId:s.value,displayText:s.label.title})),o=""}return{questionId:n.id,questionType:n.type,questionPrompt:Wb(n.questionPrompt),answerExplanation:Wb(n.explanation),answers:t,answerId:o}}function L4(n,t){const o=n.map(i=>dg(i));return typeof t<"u"?o.filter(i=>t.includes(i.questionId)):o}function _g(n){const t=dg(n);switch(t.questionType){case vn.Q5.LabelAnatomy:case vn.Q5.SelectAnatomy:return t.answers.map(({answerId:o})=>o);case vn.Q5.Instructions:return["-"];default:return[t.answerId]}}var V4=_(69984),pg=function(n){return n.InvalidUAID="analytic id does not exist",n.InvalidDeveloperId="Client id invalid",n.InvalidProductKey="app product key",n.MissingUAID="analytic id missing",n.WebOnlyAPI="Api key only compatible with Web Widget",n.AndroidOnlyAPI="Api key only compatible with Mobile Widget SDK for Android",n.IOSOnlyAPI="Api key only compatible with Mobile Widget SDK for iOS",n.MixedAPIKeys="Use of both an app product key and an app api key not allowed",n.ProductKeyNotRegistered='App product key "xxx" has not been registered or is incorrect.  Ensure it has been registered by the system admin',n.ProductKeyInvalidAppBundleID='The app product key "xxx" has not been authorized to be used for app bundle id "yyy".  Confirm the correct values are being used from the system admin',n.ProductKeyBundleIDWhitelist='Use of app product key "xxx" requires the affiliated app bundle id (app_domain) to be white-listed.  Ensure the system admin has white-listed "yyy"',n.ImproperProductKeyUsage='Improper use of app product key "xxx" detected. Contact the system admin if issue continues',n.InvalidPlatformSource="Invalid platform source",n.MissingSource="Missing source",n.MissingPlatform="Missing platform",n.MissingAppDomain="Missing app domain",n.APIKeyMissing="Api key missing",n.APIKeyInvalid="Api key invalid",n.DeveloperDeactivated="Developer account for api key is deactivated",n.BundleIDNotAllowed="App bundle id not allowed",n.BundleIDUnregistered="App bundle id unregistered",n}(pg||{});class x4{}const F4={headers:new w.Lr({"Content-Type":"application/json; charset=utf-8"})},Xb="127.0.0.1";let ug=(()=>{var n;class t{constructor(i,s){this.http=i,this.storageService=s}getAnalytic(i){return I.c.offline?(fetch("https://human.biodigital.com/ws/user/analytics?analytic_id="+i,{method:"GET",mode:"no-cors"}),(0,Rt.of)({success:!0})):this.http.get("/ws/user/analytics?analytic_id="+i).pipe((0,le.T)(()=>({success:!0})),(0,Ai.W)(r=>(0,Rt.of)(this.parseError(r))))}sendAnalytic(i){if(I.c.offline){const a=i instanceof M?"https://human.biodigital.com/ws/user/analytics":"https://human.biodigital.com/ws/developer/apps/access/key",d=(0,V4.stringify)(i);if(navigator.onLine)this.sendOfflineAnalytic(a,d),this.sendSavedOfflineMessages(a);else{const T="offline_event=1&event_timestamp="+(new Date).toISOString().substring(0,19)+"&"+d;this.storageService.setDatabaseAnalyticItem({url:a,message:T})}return(0,Rt.of)({success:!0})}return this.http.post(i instanceof M?"/ws/user/analytics":"/ws/developer/apps/access/key",i,F4).pipe((0,le.T)(()=>({success:!0})),(0,Ai.W)(a=>(0,Rt.of)(this.parseError(a))))}sendOfflineAnalytic(i,s){var r=this;return(0,Ct.A)(function*(){fetch(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:s}).catch(()=>{navigator.onLine?setTimeout(()=>{fetch(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:s})},300):r.storageService.setDatabaseAnalyticItem({url:i,message:s})})})()}sendSavedOfflineMessages(i){this.storageService.getDatabaseOfflineAnalytics(s=>{s.forEach(r=>{this.sendOfflineAnalytic(r.url??i,r.message)})})}buildUserAnalytic(i,s,r){const{widgetUrlConfig:a,parentUrl:d}=i,f=a.uaid,T=d.domain,L={...this.buildAppActivityData(i),parent_analytic_identifier:f,referer_domain:T,[`${s}_source`]:r},ee={analytic_platform:P.Widget,analytic_type:s,analytic_data:L};return I.c.offline&&(ee.app_domain=Xb),(0,p.bj)(M,ee)}buildDeveloperAnalytic(i,s,r=P.Widget,a){const{widgetUrlConfig:d,parentUrl:f,embedded:T}=i;return(0,p.bj)(x4,{platform:r,app_activity:s,app_productkey:d["app-productkey"],app_userid:d["app-userid"],app_apikey:d.dk,app_domain:I.c.offline?Xb:f.full,app_activity_data:a,widget_is_fullscreen:!T})}buildAppActivityData(i){const{engineVersion:s,engineAPIVersion:r,widgetUrlConfig:a}=i,d={engine_version:s,api_version:r};return Object.entries(a).filter(([f])=>"dk"!==f).forEach(([f,T])=>{d[`url_param_${f}`]=T}),(0,p.bj)(R,d)}parseError(i){if(I.c.offline)return{success:!0,message:"",errorCode:null};const s=i.error.error,r=i.status,d=s&&s.message?s.message:"";return{success:r>=500&&r<=504,message:d,errorCode:Object.values(pg).includes(d)?d:null}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(zt.n$))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var jo=function(n){return n.Init="init",n.View="view",n.ChanceInteraction="interactionc",n.FirstInteraction="interactionf",n.Call="call",n}(jo||{});class $4{constructor(t,o,i){this.subject=t,this.callId=o,this.procedureName=i}setResult(t){const{callId:o,procedureName:i}=this;this.subject.next({callId:o,value:t,procedureName:i})}}const B4=Object.values(gt.X),z4=Object.values(nt.F);let gg=(()=>{var n;class t{constructor(i,s){this.engineService=i,this.applicationEventService=s,this.proceduresMap={},this.hiddenProcedures={},this.eventsMap={},this.resultsSubject=new Q.B,this.logEntries=[],this.ngUnsubscribe=new Q.B,this.init()}getAPIProcedureNames(){return Object.keys(this.proceduresMap).filter(i=>!(!0===this.hiddenProcedures[i]))}getAPIEventNames(){const i=Object.keys(this.eventsMap);return[gt.X.HumanReady,...i]}logAPIProcedure(i){this.logEntries.length>1e4&&this.logEntries.shift(),this.logEntries.push({engine_version:g.A,api_version:g.m,identifier:i,category:i.split(".")[0]})}getAPILog(){return this.logEntries}resetAPILog(){this.logEntries.length=0}callAPIProcedure(i,s,r){const a=this.proceduresMap[s];a?a(i,r):console.warn("API:",`Target procedure not found: ${s}`)}defineAPIEvent(i,s){this.eventsMap[i]&&console.warn("API:",`Redefining event: ${i}`),this.eventsMap[i]=s||i}defineAPIProcedure(i,s,r){this.proceduresMap[i]&&console.warn("API:",`Redefining procedure: ${i}`),this.hiddenProcedures[i]=!0===r?.hidden,this.proceduresMap[i]=(a,d)=>{s.call(new $4(this.resultsSubject,a,i),d??{})}}onResults(){return this.resultsSubject.asObservable()}getEvent(i,s){let r;if(B4.includes(i)?r=this.engineService.getEvent(i):z4.includes(i)&&(r=this.applicationEventService.getEvent(i)),!(0,m.isNil)(r))return s?r.pipe((0,tn.s)(1)):r}init(){const i=this;this.defineAPIProcedure("apiEvents.on",function(s){i.enableEvent.call(i,this,s,!1)},{hidden:!0}),this.defineAPIProcedure("apiEvents.once",function(s){i.enableEvent.call(i,this,s,!0)},{hidden:!0})}enableEvent(i,s,r){if(!this.eventsMap[s])return void console.warn("API:",`Event: ${s} not defined.`);const a=this.eventsMap[s];if("string"==typeof a){const d=this.getEvent(a,r);d?d.subscribe(f=>{i.setResult(f)}):console.warn("API:",`Error defining event: ${s}`)}else this.mapEvents(i,a,r)}mapEvents(i,s,r){const a=s.events,d=s.map;s.init&&s.init();const T=a.map(L=>{const ee=this.getEvent(L,r);if(ee)return ee;console.warn("API:",`Error defining event: ${L}`)}).filter(L=>!(0,m.isNil)(L));(0,Wi.h)(...T).subscribe(function f(L){const ee=d?d(L):L;null!==ee&&i.setResult(ee||{})})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(u.y),e.KVO(po.S))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})(),W4=(()=>{var n;class t{constructor(i,s,r){this.engineService=i,this.rpcService=s,this.zone=r,this.responseQueue=[],this.listening=!1,this.listen()}listen(){this.listening||(this.ngUnsubscribe||(this.ngUnsubscribe=new Q.B),this.zone.runOutsideAngular(()=>{this._listen()}))}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null,this.listening=!1)}_listen(){this.listening=!0,this.engineService.getEvent(gt.X.Started).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.sendResponse({message:"status",status:"ready"})}),this.rpcService.onResults().pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(({callId:i,value:s})=>{this.sendResponse({results:{[i]:s}})}),(0,yn.R)(window,"message").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{const s=this.getClientRequest(i.data);if(!s)return;const{action:r,call:a}=s;"connect"===r?this.client||(this.client=i.source,this.clientOrigin=i.origin,this.sendResponse({message:"connected"}),this.flushResponseQueue()):a&&this.executeCall(s)})}getClientRequest(i){try{return JSON.parse(i)}catch{return}}sendResponse(i){const s=JSON.stringify(i);this.client?this.postClientMessage(s):this.responseQueue.push(s)}postClientMessage(i){this.client.postMessage(i,this.clientOrigin)}flushResponseQueue(){for(;this.responseQueue.length>0;)this.postClientMessage(this.responseQueue.pop())}executeCall(i){const{id:s,call:r,params:a}=i;try{this.rpcService.callAPIProcedure(s,r,a),this.rpcService.logAPIProcedure(r)}catch(d){console.error("API:",`Error executing API call [callId: ${s}, procedure: ${r}]: ${d}`)}}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(u.y),e.KVO(gg),e.KVO(e.SKi))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var H4=_(79435);let Q4=(()=>{var n;class t{constructor(i,s,r,a,d,f,T,L,ee,re,ve,Oe,Ee,Re,Fe,Ke,it,pt,Mt,$t,_n){this.store=i,this.actions=s,this.cameraService=r,this.engineService=a,this.animationService=d,this.paintService=f,this.labelsService=T,this.graphService=L,this.viewService=ee,this.analyticsService=re,this.visibilityLayersService=ve,this.legacyVisibilityLayersService=Oe,this.quizService=Ee,this.rpcService=Re,this.windowClient=Fe,this.applicationEventService=Ke,this.engineRendererService=it,this.markerService=pt,this.sceneService=Mt,this.contentInfoService=$t,this.contentBlocksService=_n}listen(i,s){this.ngUnsubscribe||(this.ngUnsubscribe=new Q.B),I.c.native&&this.initNativeEventListeners(),this.initProcedures(),this.initEvents(),i&&s&&this.logAPIUsage(s)}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}logAPIUsage(i){setInterval(()=>{const r=this.rpcService.getAPILog(),a=(0,m.uniqBy)(r,d=>d.identifier);if(a.length>0){const d=JSON.stringify(a),f=this.analyticsService.buildDeveloperAnalytic(i,jo.Call,P.WidgetAPI,d);this.analyticsService.sendAnalytic(f).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe({next:T=>{},error:T=>{throw new Error(T)}}),this.rpcService.resetAPILog()}},1e4)}initEvents(){bo(this.rpcService,gt.X.HumanProgress,void 0,i=>i),function V3(n){return[{eventName:gt.X.HumanReady,aliasEvents:[gt.X.HumanStarted]},{eventName:gt.X.Error,aliasEvents:[gt.X.HumanError],mapFn:t=>t},{eventName:gt.X.HumanCanvasResized,aliasEvents:[gt.X.CanvasResized],mapFn:()=>n.selectSnapshot(Xe.S.getEnginePosition)}]}(this.store).forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function U3(){return[{eventName:gt.X.SceneLoaded,mapFn:()=>!0},{eventName:gt.X.ScenePicked,aliasEvents:[gt.X.PickPicked],mapFn:bb},{eventName:gt.X.SceneObjectsSelected,mapFn:n=>n.selectedObjectsUpdate},{eventName:gt.X.SceneObjectsShown,mapFn:n=>n.enabledObjectsUpdate},{eventName:gt.X.SceneReady,aliasEvents:[gt.X.Started,gt.X.SceneReady]},{eventName:gt.X.SceneRestored,mapFn:()=>!0},{eventName:gt.X.SceneXrayEnabled,mapFn:()=>!0},{eventName:gt.X.SceneXrayDisabled,mapFn:()=>!0},{eventName:nt.F.NativeShare,mapFn:n=>n},{eventName:nt.F.NativeDebugMessage,mapFn:n=>n}]}().forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function f3(n){return[{eventName:gt.X.CameraUpdated,aliasEvents:[gt.X.CameraRested],mapFn:()=>Wu(n)}]}(this.cameraService).forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function F3(){return[{eventName:gt.X.TimelinePlaying,mapFn:n=>n},{eventName:gt.X.TimelineCompleted,mapFn:()=>!0},{eventName:gt.X.TimelineChapterTransition,mapFn:n=>({previousChapter:n.oldChapterIndex,currentChapter:n.newChapterIndex,time:n.time})}]}().forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),[].forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function H3(){return[{eventName:nt.F.UIUpdated,mapFn:n=>Uf(n)},{eventName:nt.F.UIWindowUpdated,mapFn:n=>Ob(n)}]}().forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function w4(n,t){return[...r4(t),...b4(n),{eventName:nt.F.LabelsChapterInfo,mapFn:o=>$b(t,o)},{eventName:nt.F.LabelsCreated,mapFn:o=>Xr(t,o)},{eventName:nt.F.LabelsUpdated,mapFn:o=>Xr(t,o)},{eventName:nt.F.LabelsDestroyed,mapFn:o=>({labelId:o.id})},{eventName:nt.F.LabelsEntered,mapFn:o=>o},{eventName:nt.F.LabelsLeft,mapFn:o=>o},{eventName:nt.F.LabelsPicked,mapFn:o=>o},{eventName:nt.F.LabelsMoved,mapFn:o=>o},{eventName:nt.F.LabelsEnabled,mapFn:()=>!0},{eventName:nt.F.LabelsDisabled,mapFn:()=>!0},{eventName:nt.F.LabelsShown,mapFn:o=>o},{eventName:nt.F.LabelsHidden,mapFn:o=>o}]}(this.store,this.markerService).forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function U4(n){return[{eventName:nt.F.QuizEntered,mapFn:()=>Hr(n)},{eventName:nt.F.QuizExited,mapFn:()=>!0},{eventName:nt.F.QuizQuestionLoaded,mapFn:t=>t},{eventName:nt.F.QuizAnswerSelected,mapFn:t=>{const{questionId:o,answerId:i}=t;return{questionId:o,answerId:i,correctAnswerIds:_g(rg(n,t.questionId))}}},{eventName:nt.F.QuizAnswerSubmitted,mapFn:t=>{const o=rg(n,t.questionId),i=_g(o);return{questionId:t.questionId,answerIds:t.answer,correctAnswerIds:i,correct:(0,eo.Br)(o,t.answer)}}},{eventName:nt.F.QuizCompleted,mapFn:()=>{const t=sg(n),o=ag(n);return(0,eo.MH)(t,o)}}]}(this.store).forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)}),function X4(){return[{eventName:nt.F.WhiteboardDrawingStarted,mapFn:()=>!0},{eventName:nt.F.WhiteboardDrawingFinished,mapFn:()=>!0},{eventName:nt.F.WhiteboardModeUpdated,mapFn:n=>({mode:n})}]}().forEach(i=>{bo(this.rpcService,i.eventName,i.aliasEvents,i.mapFn)})}initProcedures(){(function x3(n,t,o,i){return[{procName:Te.HumanInfo,actionFn:()=>({version:n,webglInfo:t.getWEBGLInfo(),apiFunctions:o.getAPIProcedureNames().sort(),apiEvents:o.getAPIEventNames().sort()})},{procName:Te.HumanCanvasInfo,actionFn:()=>i.selectSnapshot(Xe.S.getEnginePosition)}]})(g.A,this.engineService,this.rpcService,this.store).forEach(i=>{ps(this.rpcService,i)}),j3(this.store,this.actions,this.engineService,this.paintService,this.cameraService,this.graphService,this.animationService,this.viewService,this.visibilityLayersService,this.legacyVisibilityLayersService,this.applicationEventService,this.engineRendererService,this.sceneService,this.contentInfoService,this.contentBlocksService).forEach(i=>{ps(this.rpcService,i)}),function S3(n,t){return[{procName:Te.CameraInfo,actionFn:()=>Gt(n).pipe((0,le.T)(()=>Wu(t)))},{procName:Te.CameraOrbit,actionFn:o=>Gt(n).pipe((0,le.T)(()=>(n.dispatch(new jt.RJ(void 0===o.pitch?0:o.pitch,void 0===o.yaw?0:o.yaw)),!0)))},{procName:Te.CameraPan,actionFn:o=>Gt(n).pipe((0,le.T)(()=>(n.dispatch(new jt.bB(void 0===o.x?0:o.x,void 0===o.y?0:o.y,void 0===o.z?0:o.z)),!0)))},{procName:Te.CameraReset,actionFn:()=>Gt(n).pipe((0,Cn.Z)(()=>n.dispatch(new jt.nW)))},{procName:Te.CameraSet,actionFn:o=>Gt(n).pipe((0,le.T)(()=>{const i=o.animate||!1;if(o.objectId)return n.dispatch(new st.W6(o.objectId,i,o.animationDuration)),!0;const s=Wu(t);return n.dispatch(new jt.Ih({eye:o.position||s.position,look:o.target||s.target,up:o.up||s.up},i)),!0}))},{procName:Te.CameraZoom,actionFn:o=>Gt(n).pipe((0,le.T)(()=>(n.dispatch(new jt.F5(o||0)),!0)))},{procName:Te.setCameraMode,actionFn:o=>(n.dispatch(new jt.vq("pan"===o?"pan":"rotate")),!0)},{procName:Te.CameraDisableChapterCamera,actionFn:()=>(n.dispatch(new jt.Qn(!1)),!0)},{procName:Te.CameraEnableChapterCamera,actionFn:()=>(n.dispatch(new jt.Qn(!0)),!0)}]}(this.store,this.cameraService).forEach(i=>{ps(this.rpcService,i)}),function $3(n,t,o){return[{procName:Te.TimelineQuery,actionFn:()=>({chapters:n.selectSnapshot(fe.N.getStoryChapters).map(s=>({description:s.description,displayName:s.displayName,annotations:s.labels.map(f=>({title:f.title,description:f.description}))}))}),hideDefinition:!0},{procName:Te.TimelineInfo,actionFn:()=>Gt(n).pipe((0,le.T)(([i])=>function G3(n,t,o){const i=o.getChapterTimeFrame();return{time:o.getTime(),startTime:i.firstTime,endTime:i.lastTime,chapters:t.map(s=>s.id),playing:o.isPlaying(),playbackSpeed:Eb(n)}}(n,i,t)))},{procName:Te.TimelinePlay,actionFn:i=>us(n).pipe((0,Cn.Z)(()=>{const s=t.getGlobalTime(),r=i.time??s,a=i.loop??!1;let d=i.chapterId;return void 0===d&&(d=t.mapGlobalTimeToChapterId(r)),new y.c(f=>{n.selectSnapshot(Xe.S.getChapter)!==d&&n.dispatch(new En.wg(d)),n.select(Xe.S.getChapter).pipe((0,S.p)(ee=>ee===d),(0,tn.s)(1)).subscribe(()=>function T(){if(r!==s){const ee=(0,Kt.clamp)(t.mapChapterGlobalTime(d,i.time),0,t.getChapterDuration());t.pause(),t.scrub(ee)}t.setAnimationLoop(a),t.play(),f.next(!0),f.complete()}())})}))},{procName:Te.TimelinePause,actionFn:()=>Gt(n).pipe((0,le.T)(()=>(t.pause(),!0)))},{procName:Te.TimelineSet,actionFn:i=>us(n).pipe((0,Cn.Z)(()=>{if(void 0===i.time&&void 0===i.chapterId)return(0,Rt.of)(!0);let s=i.chapterId;void 0===s&&(s=t.mapGlobalTimeToChapterId(i.time));const r=n.selectSnapshot(Xe.S.getChapter)!==s;return new y.c(a=>{function d(){let f=i.time??0;f=(0,Kt.clamp)(t.mapChapterGlobalTime(s,f),0,t.getChapterDuration()),t.pause(),t.scrub(f),a.next(!0),a.complete()}r?(n.select(Xe.S.getChapter).pipe((0,S.p)(f=>f===s),(0,tn.s)(1)).subscribe(()=>d()),n.dispatch(new En.wg(s))):d()})}))},{procName:Te.TimelineSetPlaybackSpeed,actionFn:i=>us(n).pipe((0,le.T)(()=>"number"==typeof i&&(n.dispatch(new st.Vs(i)),!0)))},{procName:Te.TimelineGetPlaybackSpeed,actionFn:()=>us(n).pipe((0,le.T)(()=>Eb(n)))},{procName:Te.TimelineNext,actionFn:()=>us(n).pipe((0,le.T)(()=>(o.nextChapter("API"),!0)))},{procName:Te.TimelinePrev,actionFn:()=>us(n).pipe((0,le.T)(()=>(o.previousChapter("API"),!0)))}]}(this.store,this.animationService,this.viewService).forEach(i=>{ps(this.rpcService,i)}),function z3(n){return[{procName:Te.InputEnable,actionFn:()=>(n.dispatch(new h(!0)),!0)},{procName:Te.InputDisable,actionFn:()=>(n.dispatch(new h(!1)),!0)}]}(this.store).forEach(i=>{ps(this.rpcService,i)}),function Q3(n,t,o,i){const s=new ui.t(!1);return t.pipe((0,l.rM)(En.lM)).subscribe(()=>{s.next(!0)}),[{procName:Te.UIGetBackground,actionFn:()=>Gt(n).pipe((0,le.T)(()=>function W3(n){const{colors:t,gradientType:o,colorStops:i}=n;return{colors:Array.isArray(t)?[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]]]:[[0,0,0,0],[0,0,0,0]],gradientType:o,colorStops:i}}(n.selectSnapshot(fe.N.getSelectedChapterBackground))))},{procName:Te.UISetBackground,mapFnIn:r=>{const{colors:a,colorStops:d,gradientType:f}=r;return{colors:a&&Cb(a),gradientType:f,colorStops:d}},actionFn:r=>Gt(n).pipe((0,le.T)(()=>{if(r){const a=Tb(n,r);n.dispatch(new En.pb(a))}return!0}))},{procName:Te.UIPresetBackground,mapFnIn:r=>{const{colors:a,colorStops:d,gradientType:f}=r;return{colors:a&&Cb(a),gradientType:f,colorStops:d}},actionFn:r=>{if(r){const a=Tb(n,r);I.c.platform===ka.N.SDK&&s.next(!1),s.pipe((0,S.p)(d=>!!d),(0,tn.s)(1)).subscribe(()=>{n.dispatch(new En.EN(a))})}return!0}},{procName:Te.UIGetWorldPosition,actionFn:r=>Gt(n).pipe((0,le.T)(()=>{const{worldPos:a}=o.pick(r.x,r.y);if(a){const{0:d,1:f,2:T}=a;return{x:d,y:f,z:T}}return null}))},{procName:Te.UISetOndemand,actionFn:r=>(n.dispatch([new D.ToggleWindow(fn.OnDemand,r.enabled)]),!0)},{procName:Te.UISetLoadingExperience,actionFn:r=>((0,m.isEmpty)(r)?n.dispatch([new D.SetInteractType(Bo.None),new D.CloseWindow(fn.Interact)]):n.dispatch([new D.SetInteractType(r),new D.OpenWindow(fn.Interact)]),!0)},{procName:Te.UISetScrollCaptureMode,actionFn:r=>(n.dispatch(new st.hk(r)),!0)},{procName:Te.UISetTutorial,actionFn:r=>(n.dispatch([new D.ToggleWindow(fn.Tutorial,r.enabled),new D.StartTutorial(r.enabled)]),!0)},{procName:Te.UIGetWindow,actionFn:()=>Ob(n.selectSnapshot(_e.getOpenWindow))},{procName:Te.UIGetDisplay,actionFn:()=>Gt(n).pipe((0,le.T)(()=>Uf(n.selectSnapshot(Be.getUI))))},{procName:Te.UISetDisplay,actionFn:r=>{const a=function qE(n){const t=null!=n.all?Vf(n.all):new Tr;return Ns({all:n.all,startingColumn:n.startingColumn,fadeout:n.fadeout,drawerExpanded:n.infoExpand,logoIsHyperLink:void 0,[G.AnatomyLabels]:Yt(n.anatomyLabels,n.anatomyLabels),[G.Audio]:n.audio,[G.Camera]:Yt(n.nav,n.cameraMode,n.center,n.zoomIn,n.zoomOut,n.nav),[G.Column]:Yt(n.info,n.info),[G.ContextActions]:n.contextActions,[G.ContextMenu]:n.contextMenu,[G.Drawer]:Yt(n.info,n.info),[G.Fullscreen]:Yt(n.fullscreen,n.fullscreen),[G.Help]:Yt(n.help,n.help),[G.LabelList]:Yt(n.labelList,n.labelList),[G.Labels]:n.labels,[G.Layout]:n.layout,[G.Legend]:n.legend,[G.Logo]:n.logo,[G.Loader]:Gc(n.loader),[G.Media]:Qp(n.playPause,Yt(n.scrubber,n["scrubber.chapters"]),n.media),[G.NodeAudio]:n.anatomyPronunciations,[G.NodeInfo]:n.anatomyDescriptions,[G.Pagination]:Yt(n.tour,n["tour.chapters"]),[G.Playthrough]:Yt(n.playthrough,n.autoplay),[G.QuizPrompt]:n["ui-quiz"],[G.Search]:Yt(n.objectTree,n.search),[G.TitleOnly]:Yt(n.info,n.info),[G.ToggleLabels]:void 0,[G.Toolbar]:Yt(n.toolbar,n.menu),[G.Tools]:Yt(n.tools,n.tools),[G.Tutorial]:void 0,[G.Undo]:Yt(n.reset,n.undo),[G.VisibilityLayers]:n.visibilityLayers,[G.VisibilityLayersMode]:$c(n.visibilityLayersMode,n.skinLayers),[G.SkinLayers]:Yt(n.skinLayers),[G.Whiteboard]:n.whiteboard},t)}(r);return n.dispatch(new W(a)),r}},{procName:Te.UIResetDisplay,actionFn:()=>{const r=n.selectSnapshot(Be.getInitialUI);n.dispatch(new Dn.SetUI(r))}},{procName:Te.UISetQuizLock,actionFn:r=>(t.pipe((0,l.xi)(g_),(0,tn.s)(1)).subscribe(()=>{n.dispatch(new Bt.B.SetQuizLocked(r)),n.dispatch(new Bt.B.SetEnableQuizRetake(r)),!0===r&&i.startQuiz()}),!0)},{procName:Te.UISnapshot,aliases:[Te.SceneSnapshot],actionFn:r=>Gt(n).pipe((0,Cn.Z)(()=>{const{width:a,height:d}=o.getCanvas();r={width:a,height:d,openInTab:!1,fileType:"jpeg",quality:.92,...r};const{width:f,height:T,openInTab:L,fileType:ee}=r,re=n.selectSnapshot(fe.N.getSelectedChapterId),ve={width:f,height:T},Oe="jpeg"===ee?gl.H.JPEG:gl.H.PNG,Ee=n.selectSnapshot(fe.N.getSelectedChapterBackground);return n.dispatch(new no.V9(re,Ee,Oe,.92,ve,"original",!0,!0)).pipe((0,Cn.Z)(()=>t.pipe((0,l.xi)(no.WX),(0,tn.s)(1))),(0,Cn.Z)(Re=>Gu.X.blobToBase64(Re.blob)),(0,Is.M)(Re=>{L&&Re&&function X3(n){const t=window.open("","_blank");if(t){const o=t.document.createElement("img");o.src=n,t.document.body.appendChild(o)}}(Re)}),(0,Ai.W)(()=>(0,Rt.of)(null)))}))}]}(this.store,this.actions,this.engineRendererService,this.quizService).forEach(i=>{ps(this.rpcService,i)}),function P4(n,t,o,i,s,r){return[...a4(n,t,i,s),...y4(n,t,i),{procName:Te.LabelsInfo,actionFn:a=>Gt(n).pipe((0,le.T)(()=>a.length>0?ig(n,a):n.selectSnapshot(Ze.getChapterLabels))),mapFnOut:a=>$b(i,a)},{procName:Te.LabelsCreate,actionFn:a=>Gt(n).pipe((0,le.T)(()=>{if(a.labelId&&Wr(n,a.labelId))return null;if(!a.objectId)return console.log("attempt to create a label with no objectId."),null;const d=function E4(n,t,o){const i=t.makeDefaultStudioLabel();i.id=o.labelId||vi.u.idWithPrefix("label"),i.objectId=o.objectId,i.pos=o.position,i.renderableIndex=0,i.occludable=!!o.position,i.flyTo=!0,i.description="",i.shown=!0;const s=n.selectSnapshot(fe.N.getSelectedChapter);return s?(i.chapterId=s.id,Gb(i,o)):null}(n,t,a);return og(n,d,!0)})),mapFnOut:a=>Xr(i,a)},{procName:Te.LabelsUpdate,actionFn:a=>Gt(n).pipe((0,le.T)(()=>{let d=null;return Wr(n,a.labelId)&&(d=function C4(n,t){return Gb(Wr(n,t.labelId),t)}(n,a),og(n,d,!1)),d})),mapFnOut:a=>Xr(i,a)},{procName:Te.LabelsCanvasUpdate,actionFn:a=>Gt(n).pipe((0,le.T)(()=>{let d=null;return Wr(n,a.labelId)&&(d=function T4(n,t,o,i){const s=Wr(n,i.labelId),r=i.canvasPosition,a=t.pick(r[0],r[1]);return a&&a.objectId?(s.objectId=a.objectId,s.pos=[a.worldPos[0],a.worldPos[1],a.worldPos[2]],s.offset=[s.hideWire?20:32,0],s.barycentric=[a.barycentric[0],a.barycentric[1],a.barycentric[2]],s.primitiveIndex=a.triIndex,s.renderableIndex=a.renderableIndex||0,s.dir=o.getDirection(a),s):null}(n,o,r,a),d&&og(n,d,!1)),d})),mapFnOut:a=>Xr(i,a)},{procName:Te.LabelsDestroy,actionFn:a=>Gt(n).pipe((0,le.T)(()=>{const d=Wr(n,a);return d?(n.dispatch(new He.vx(d)),{labelId:d.id}):null}))},{procName:Te.LabelsShow,actionFn:a=>Gt(n).pipe((0,le.T)(()=>(a.length>0?n.dispatch(new He.D3(ig(n,a),!0)):xb(n,!0),!0)))},{procName:Te.LabelsHide,actionFn:a=>Gt(n).pipe((0,le.T)(()=>(a.length>0?n.dispatch(new He.D3(ig(n,a),!1)):xb(n,!1),!0)))},{procName:Te.LabelsSetEnabled,aliases:[Te.AnnotationsSetEnabled],actionFn:a=>{n.dispatch(new st.Gv(a.enable))},hideDefinition:!0},{procName:Te.LabelsSetScale,actionFn:a=>{n.dispatch(new He.tH(a.scale))}}]}(this.store,this.labelsService,this.engineRendererService,this.markerService,this.sceneService,this.cameraService).forEach(i=>{ps(this.rpcService,i)}),function j4(n,t){function o(i){return n.selectSnapshot(Ue.j.getQuizModeActive)?i():{error:"quiz mode is not active"}}return[{procName:Te.QuizInfo,actionFn:()=>Gt(n).pipe((0,le.T)(()=>n.selectSnapshot(Ue.j.hasQuiz)?Hr(n):null))},{procName:Te.QuizSubmit,actionFn:i=>Gt(n).pipe((0,le.T)(()=>o(()=>(t.submitQuestion(i.questionId,i.answerIds),Hr(n)))))},{procName:Te.QuizQuestion,actionFn:()=>o(()=>Gt(n).pipe((0,le.T)(()=>cg(n))))},{procName:Te.QuizEnter,actionFn:()=>Gt(n).pipe((0,le.T)(()=>n.selectSnapshot(Ue.j.hasQuiz)?(t.startQuiz(),!0):{error:"quiz not found"}))},{procName:Te.QuizExit,actionFn:()=>Gt(n).pipe((0,le.T)(()=>(t.exitQuiz(),!0)))},{procName:Te.QuizSelectQuestion,actionFn:i=>o(()=>(n.dispatch(new Bt.B.SetActiveQuestion(i)),Hr(n)))},{procName:Te.QuizNextQuestion,actionFn:()=>Gt(n).pipe((0,le.T)(()=>o(()=>(t.nextQuestion(),cg(n)))))},{procName:Te.QuizPreviousQuestion,actionFn:()=>Gt(n).pipe((0,le.T)(()=>o(()=>(n.dispatch(new Bt.B.SetQuizLifecycle(Po.h.Question)),n.dispatch(new Bt.B.PreviousQuestion),cg(n)))))},{procName:Te.QuizReset,actionFn:()=>Gt(n).pipe((0,le.T)(()=>(t.resetQuiz(),Hr(n))))},{procName:Te.QuizSet,actionFn:i=>Gt(n).pipe((0,le.T)(()=>{const{settings:s,startNumber:r,endNumber:a,locked:d}=i;if(!(0,m.isNil)(s)){const T=n.selectSnapshot(Ue.j.getQuizSettings);n.dispatch(new Bt.B.SetQuizSettings({...T,...s}))}if("number"==typeof r||"number"==typeof a){const T=n.selectSnapshot(fe.N.getStoryChapters),L=(0,eo.En)(T),ve=L.slice("number"==typeof r?r-1:0,"number"==typeof a?a:L.length);n.dispatch(new Bt.B.SetQuestions(ve))}return"boolean"==typeof d&&n.dispatch(new Bt.B.SetQuizLocked(d)),n.dispatch(new Bt.B.SetQuizQuestionsMode("number"==typeof r&&"number"==typeof a?"restricted":"all")),Hr(n)}))}]}(this.store,this.quizService).forEach(i=>{ps(this.rpcService,i)})}initNativeEventListeners(){this.applicationEventService.getEvent(nt.F.NativeSetBaseDirectory).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{window.localBaseDirectory=i}),this.applicationEventService.getEvent(nt.F.NativeSetSdkOffline).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{window.sdkOffline=!0===i})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(l.il),e.KVO(l.En),e.KVO(co.j),e.KVO(u.y),e.KVO(zi.O),e.KVO(ua.s),e.KVO(qc.x),e.KVO(Eu.w),e.KVO(hn),e.KVO(ug),e.KVO(Ls),e.KVO(No),e.KVO(Mr),e.KVO(gg),e.KVO(W4),e.KVO(po.S),e.KVO(Fa.z),e.KVO(pa),e.KVO(ji.w),e.KVO(H4.T),e.KVO(Wa.V))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var hg=_(85884),Hb=function(n){return n.Auth="auth",n}(Hb||{}),Y4=_(41775);class Qb{}var gs,mg,vo=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Sn=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const K4={authenticated:!1,bypassAnalytics:!1,activeRequests:new Set,loggedInteractions:{init:!1,view:!1,interactionc:!1,interactionf:!1,call:!1}};let Di=(mg=gs=class{static isAuthenticated(t){return t.authenticated}static isFirstInteractionLogged(t){return t.loggedInteractions.interactionf}authorizeAnalyticId(t){const{activeRequests:o}=t.getState();if(!o.has(jo.Init)){const i=this.store.selectSnapshot(Z.getWidgetState),{embedded:s,userType:r,widgetUrlConfig:a}=i,d=a["bypass-analytics"];let f;t.patchState({bypassAnalytics:d}),!s||I.c.native||d?t.patchState({authenticated:!0}):(f=r===V.User?this.analyticsService.getAnalytic(a.uaid):this.analyticsService.sendAnalytic(this.analyticsService.buildDeveloperAnalytic(i,jo.Init,P.WidgetAPI,this.analyticsService.buildAppActivityData(i))),o.add(jo.Init),t.patchState({activeRequests:o}),f.pipe((0,bt.j)(()=>{o.delete(jo.Init),t.patchState({activeRequests:o})})).subscribe(T=>{const L=T.success;t.patchState({authenticated:L}),t.dispatch(L?new v3(r,T):new hb(r,T))}))}}logInteraction(t,{interaction:o,source:i}){const{activeRequests:s}=t.getState();if(!s.has(o)){const r=this.store.selectSnapshot(Z.getWidgetState),d=r.userType===V.User?this.analyticsService.buildUserAnalytic(r,o,i):this.analyticsService.buildDeveloperAnalytic(r,o,P.Widget,this.analyticsService.buildAppActivityData(r));s.add(o),t.patchState({activeRequests:s}),this.analyticsService.sendAnalytic(d).pipe((0,bt.j)(()=>{s.delete(o),t.patchState({activeRequests:s})})).subscribe(f=>{t.dispatch(f.success?new Xu(o,f):new E3(o,f))})}}logInteractionSuccess(t,o){const{loggedInteractions:i}=t.getState();i[o.interaction]=!0,t.patchState({loggedInteractions:i})}initView(t){const o=["interactive","complete"].includes(document.readyState),i=o?(0,Rt.of)(o):(0,yn.R)(document,"DOMContentLoaded");this.store.select(mg.isAuthenticated).pipe((0,ob.U)(i),(0,S.p)(s=>!0===s),(0,tn.s)(1)).subscribe(()=>{t.getState().bypassAnalytics||this.store.dispatch(new $l(jo.View))})}logInteractionChance(t){const o=t.getState();!o.loggedInteractions.interactionc&&!o.bypassAnalytics&&t.dispatch(new $l(jo.ChanceInteraction))}logFirstInteraction(t){t.getState().loggedInteractions.interactionf||t.dispatch([new Hu,new $l(jo.FirstInteraction)])}resetFirstInteraction(t){const o=t.getState().loggedInteractions;o.interactionf=!1,t.patchState({loggedInteractions:o})}constructor(t,o){this.store=t,this.analyticsService=o}ngxsOnInit(t){t.dispatch(new mb)}},gs.\u0275fac=function(t){return new(t||gs)(e.KVO(l.il),e.KVO(ug))},gs.\u0275prov=e.jDH({token:gs,factory:gs.\u0275fac}),gs);vo([(0,l.rc)(gb),Sn("design:type",Function),Sn("design:paramtypes",[Object]),Sn("design:returntype",void 0)],Di.prototype,"authorizeAnalyticId",null),vo([(0,l.rc)($l),Sn("design:type",Function),Sn("design:paramtypes",[Object,$l]),Sn("design:returntype",void 0)],Di.prototype,"logInteraction",null),vo([(0,l.rc)(Xu),Sn("design:type",Function),Sn("design:paramtypes",[Object,Xu]),Sn("design:returntype",void 0)],Di.prototype,"logInteractionSuccess",null),vo([(0,l.rc)(mb),Sn("design:type",Function),Sn("design:paramtypes",[Object]),Sn("design:returntype",void 0)],Di.prototype,"initView",null),vo([(0,l.rc)(Hu),Sn("design:type",Function),Sn("design:paramtypes",[Object]),Sn("design:returntype",void 0)],Di.prototype,"logInteractionChance",null),vo([(0,l.rc)(fb),Sn("design:type",Function),Sn("design:paramtypes",[Object]),Sn("design:returntype",void 0)],Di.prototype,"logFirstInteraction",null),vo([(0,l.rc)(Sb),Sn("design:type",Function),Sn("design:paramtypes",[Object]),Sn("design:returntype",void 0)],Di.prototype,"resetFirstInteraction",null),vo([(0,l.MD)(),Sn("design:type",Function),Sn("design:paramtypes",[Qb]),Sn("design:returntype",void 0)],Di,"isAuthenticated",null),vo([(0,l.MD)(),Sn("design:type",Function),Sn("design:paramtypes",[Qb]),Sn("design:returntype",void 0)],Di,"isFirstInteractionLogged",null),Di=mg=vo([(0,l.Uw)({name:"modules",defaults:K4}),Sn("design:paramtypes",[l.il,ug])],Di);const J4=new Set([Te.CameraOrbit,Te.CameraPan,Te.CameraReset,Te.CameraSet,Te.CameraZoom,Te.LabelsCreate,Te.LabelsDestroy,Te.LabelsHide,Te.LabelsShow,Te.LabelsUpdate,Te.QuizEnter,Te.QuizExit,Te.QuizSubmit,Te.QuizNextQuestion,Te.QuizPreviousQuestion,Te.QuizReset,Te.QuizSet,Te.SceneColorObject,Te.ScenePick,Te.SceneReset,Te.SceneRestore,Te.SceneSelectObjects,Te.SceneSetLayersSliderPosition,Te.SceneShowObjects,Te.SceneTransformObject,Te.SceneUncolorObject,Te.TimelineNext,Te.TimelinePause,Te.TimelinePlay,Te.TimelinePrev,Te.TimelineSet,Te.UISnapshot]);var Bl,Yb=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Kb=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const q4=["logoElRef"];function Z4(n,t){1&n&&(e.qex(0),e.nrm(1,"img",3,0),e.bVm())}class Dd{constructor(t){this.renderer=t,this.siteHeaderType=Ko,this.ngUnsubscribe=new Q.B}ngAfterViewInit(){this.initLogoListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLogoListener(){(0,Ht.z)([this.headerLogoConfig$,this.siteHeader$]).pipe((0,S.p)(([t,o])=>!(0,m.isNil)(t)),(0,Fn.B)(0),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t])=>{const o=this.logoElRef.nativeElement,{logo_url:i}=(0,YS.g)(t,"full","color");this.renderer.setAttribute(o,"src",i),this.renderer.setAttribute(o,"alt",$localize`Team Logo`),this.renderer.setAttribute(o,"aria-label",$localize`Team Logo`)})}}function ek(n,t){if(1&n){const o=e.RV6();e.j41(0,"a",1),e.bIt("click",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleClick(s))}),e.EFF(1,"Skip to main content"),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("href",o.mainContentLink,e.B4B)}}(Bl=Dd).\u0275fac=function(t){return new(t||Bl)(e.rXU(e.sFG))},Bl.\u0275cmp=e.VBU({type:Bl,selectors:[["app-viewer-header"]],viewQuery:function(t,o){if(1&t&&e.GBs(q4,5),2&t){let i;e.mGM(i=e.lsd())&&(o.logoElRef=i.first)}},decls:3,vars:4,consts:[["logoElRef",""],[1,"viewer-header",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"viewer-header__logo"]],template:function(t,o){1&t&&(e.j41(0,"div",1),e.nI1(1,"async"),e.DNE(2,Z4,3,0,"ng-container",2),e.k0s()),2&t&&(e.Y8G("ngSwitch",e.bMT(1,2,o.siteHeader$)),e.R7$(2),e.Y8G("ngSwitchCase",o.siteHeaderType.Logo))},dependencies:[q.ux,q.e1,q.Jj],styles:[".viewer-header[_ngcontent-%COMP%]{background-color:#fff;border-bottom:1px solid #d7e0ea;display:flex;flex-direction:row;align-items:center;justify-content:center;height:var(--header-height)}.viewer-header__logo[_ngcontent-%COMP%]{min-height:20px;max-height:calc(var(--header-height) * .5);height:auto;width:auto;max-width:calc(100% - 32px)}"],changeDetection:0}),Yb([(0,l.l6)(Dp.X.getHeaderLogoConfig),Kb("design:type",y.c)],Dd.prototype,"headerLogoConfig$",void 0),Yb([(0,l.l6)(gn.getSiteHeader),Kb("design:type",y.c)],Dd.prototype,"siteHeader$",void 0);const Jb="view-title";let tk=(()=>{var n;class t{constructor(i,s){this.location=i,this.store=s,this.columnVisible=(0,mn.ot)(this.store.select(Be.getVisible(G.Column))),this.drawerVisible=(0,mn.ot)(this.store.select(Be.getVisible(G.Drawer))),this.show=(0,e.EWP)(()=>this.columnVisible()||this.drawerVisible()),this.mainContentLink=`#${Jb}`}handleClick(i){i.preventDefault();const s=document.getElementById(Jb);s&&s.focus()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(q.aZ),e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-skip-nav"]],decls:1,vars:1,consts:[["appSkipNav","","tabindex","1","class","sr-only",3,"href","click",4,"ngIf"],["appSkipNav","","tabindex","1",1,"sr-only",3,"click","href"]],template:function(i,s){1&i&&e.DNE(0,ek,2,1,"a",0),2&i&&e.Y8G("ngIf",s.show())},dependencies:[q.bT],changeDetection:0}),t})();var zl,Wl=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Xl=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const nk=["widgetElRef"];function ik(n,t){if(1&n&&(e.j41(0,"div",5),e.nI1(1,"async"),e.nrm(2,"app-viewer-header"),e.k0s()),2&n){const o=e.XpG();e.Y8G("ngSwitch",e.bMT(1,1,o.siteHeader$))}}function ok(n,t){1&n&&e.nrm(0,"div",6)}const sk=(0,bn.DC)().direction;document.dir=sk;class Ks{constructor(t,o,i,s,r,a,d,f,T,L,ee,re,ve){this.document=t,this.store=o,this.actions=i,this.activatedRoute=s,this.widgetAPIHandler=r,this.errorService=a,this.engineService=d,this.cameraService=f,this.storageService=T,this.renderer=L,this.viewService=ee,this.quizService=re,this.rpcService=ve,this.siteHeaderType=Ko,this.title="Biodigital Human",this.environmentApplication=Wn.c,this.environmentPlatform=ka.N,this.ngUnsubscribe=new Q.B,this.firstInteractionLogged$=this.store.select(Di.isFirstInteractionLogged).pipe((0,S.p)(Oe=>Oe))}ngOnInit(){this.initErrorHandling(),this.initAnalytics();const{data:t}=this.activatedRoute.snapshot,o=t.widgetUrlConfig;this.initWidgetBreakpoints(o),this.initWidgetLabelScale(o),this.initWidgetLayout(o),this.initWidgetSetup(o),this.initFadeout(o),this.initStartingColumn(o),this.initStartingTool(o),this.initCustomWidgetSettings(o.paid),this.store.dispatch(new gb),this.initBackgroundFromWidget(o),this.initBackgroundFromChapter(),this.initCamera(o),this.initRotation(o),this.initQuizInteractions(o),this.widgetAPIHandler.listen(I.c.deploy===ri.Z.Production),this.initChaptersReadyListener(),this.initHumanReadyListener(),this.initDynamicLayout()}ngAfterViewInit(){this.initHeaderAndFooter()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWidgetSetup(t){const o=window!==window.top,i=o?BD_DOCUMENT_REFERRER:window.location.href;this.store.dispatch(new $(i,o,t));const s=this.store.selectSnapshot(Be.getUI),r=jf(t),a=xf(s,r);this.store.dispatch(new Dn.SetUI(a)),this.store.dispatch(new Dn.SetInitialUI(a));const d=function tC(n){return n["disable-scroll"]?Cr.M.DoNotCapture:n["disable-scroll.alert"]||n["disable-scroll.overlay"]?Cr.M.DoNotCaptureShowMessage:Cr.M.Capture}(t);this.store.dispatch(new st.hk(d));const f=function nC(n){return!0===n["ui-print-image"]}(t),T=function oC(n){return!1===n["auto-load"]}(t);(function sC(n){return!0===n["ui-poc-whiteboard"]})(t)&&(this.viewService.toggleWhiteboard(!0),this.store.dispatch(new D.SetWhiteboardLocked(!0)));const{interactType:L,isInteractActive:ee}=function iC(n,t,o){const i=n["initial.play"]||n.initial||n["initial.button"]||n["initial.hand"]||n["initial.hand-hint"]||n["initial.summary"]||t;return{interactType:(()=>{switch(!0){case n.initial:case n["initial.button"]:return Bo.Button;case n["initial.hand"]:case n["initial.hand-hint"]:return Bo.Hand;case n["initial.play"]:return Bo.Play;case n["initial.summary"]:return Bo.Summary;default:return o}})(),isInteractActive:i}}(t,this.store.selectSnapshot(_e.shouldWindowOpen(fn.Interact)),this.store.selectSnapshot(_e.getInteractType)),re=this.storageService.getLocalItem(zt.UT.GettingStartedTutorial),ve=!0===r.tutorial&&"true"!==re;this.store.dispatch([new D.SetOnDemand(T),new D.ToggleWindow(fn.OnDemand,T),new D.SetInteractType(L),new D.ToggleWindow(fn.Interact,ee),new D.ToggleWindow(fn.Tutorial,ve),new D.StartTutorial(ve),new D.SetUsePrintImage(f)]);const Oe=function rC(n){return!0===n["demo-mode"]}(t);this.store.dispatch(new st.E7(Oe))}initCustomWidgetSettings(t){I.c.offline||t&&(this.store.select(Z.getWidgetSettings).pipe((0,S.p)(o=>!(0,m.isNil)(o)&&o.length>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{o.forEach(i=>{i.anatomy_description_fallback&&this.viewService.setAnatomyDescriptionFallback(i.anatomy_description_fallback);const s=i.group_logos;if(s){const r=s.viewer?.viewer_logo_setting;"logo_swap"===r?this.viewService.setViewLogos(s):"logo_cobranding"===r&&(this.viewService.setHeaderLogos(s),this.store.dispatch(new wn.SetHeader(Ko.Logo)))}})}),this.store.dispatch(new B(t)))}initErrorHandling(){this.actions.pipe((0,l.xi)(la),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentErrors()),this.actions.pipe((0,l.xi)(hb),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleAuthErrors(t))}initWidgetBreakpoints({"ui-collapse-label":t,"annotation-collapse":o}){const i=[t,o].find(s=>!(0,m.isNil)(s));(0,m.isNil)(i)||this.store.dispatch(new D.SetLabelBreakpoint(i))}initWidgetLabelScale({"label-scale":t}){(0,m.isNil)(t)||this.store.dispatch(new He.tH(t))}initWidgetLayout({"ui-layout":t}){(0,m.isNil)(t)||this.store.dispatch(new D.SetLayout(t))}initFadeout({"ui-fadeout":t}){!(0,m.isNil)(t)&&(0,m.isNumber)(t)&&this.store.dispatch(new D.SetFadeout(t))}initStartingColumn({"ui-starting-column":t}){(0,m.isNil)(t)||this.store.dispatch(new D.SetStartingColumn(t))}initStartingTool({"ui-starting-tool":t}){(0,m.isNil)(t)||this.store.dispatch(new D.SetStartingTool(t))}initQuizInteractions(t){const o=this.store.select(_t.getSelectedBookmark);(0,Ht.z)([this.store.select(Ue.j.hasQuiz),o]).pipe((0,S.p)(([i,s])=>!(0,m.isNil)(s)&&i),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(([i,s])=>{const r=this.store.selectSnapshot(Ue.j.getAllQuestions),d="true"==`${t["ui-quiz-locked"]}`,f=s.viewMode===Ne.Quiz;this.store.dispatch(new Bt.B.SetQuizLocked(d||f)),d&&this.store.dispatch(new Bt.B.SetEnableQuizRetake(!1));const T=parseInt(t["ui-quiz-start"],10),L=parseInt(t["ui-quiz-end"],10),ee=r.length,re=isNaN(T)?1:T,ve=isNaN(L)?ee:L;if(1!==re||ve!==ee){const Re=r.filter((Fe,Ke)=>{const it=Ke+1;return it>=re&&it<=ve});this.store.dispatch(new Bt.B.SetQuestions(Re))}const Ee=isNaN(T)&&isNaN(L)?"all":"restricted";this.store.dispatch(new Bt.B.SetQuizQuestionsMode(Ee)),(d||f)&&setTimeout(()=>{this.quizService.startQuiz()})})}initAnalytics(){this.getIntersectionObserver(this.document.body,.75).pipe((0,tn.s)(1)).subscribe(()=>{this.store.dispatch(new Hu)});const t=this.getDocumentInteraction(),o=this.rpcService.onResults().pipe((0,S.p)(i=>J4.has(i.procedureName)));(0,Wi.h)(t,o).pipe((0,Fn.B)(125),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new fb)})}initBackgroundFromWidget({background:t}){t&&(this.setWidgetTransparent((0,ks.ty)(t)),this.actions.pipe((0,l.rM)(En.lM),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new En.EN(t))}))}initBackgroundFromChapter(){this.store.select(fe.N.getSelectedChapter).pipe((0,S.p)(t=>null!=t),(0,le.T)(t=>(0,ks.ty)(t.background)),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setWidgetTransparent(t)})}initCamera({camera:t}){t&&this.actions.pipe((0,l.xi)(To),(0,tn.s)(1),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new jt.Ih(t,!1))})}initRotation({"load-rotate":t}){if(t){let o=performance.now();const i=this.store.select(fe.N.getSelectedChapter),s=this.store.select(fe.N.getSelectedChapterReadyState);(0,h3.d)().pipe((0,Ua.E)(s),(0,S.p)(([,r])=>r?.model),(0,le.T)(()=>t*(performance.now()-o)*.001),(0,Is.M)(()=>o=performance.now()),(0,b.Q)(this.firstInteractionLogged$),(0,b.Q)(this.ngUnsubscribe)).subscribe(r=>{this.cameraService.rotateCameraStatic(0,r)}),this.firstInteractionLogged$.pipe((0,Ua.E)(i),(0,b.Q)(this.ngUnsubscribe)).subscribe(([,r])=>{const a=r?.camera?.location;a&&this.store.dispatch(new jt.Ih(a,!0,2))})}}initHumanReadyListener(){this.actions.pipe((0,l.xi)(I.c.platform===ka.N.SDK?g_:zg)).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.engineService.fireEvent(gt.X.Started,null)})}initChaptersReadyListener(){this.store.select(fe.N.getAllChaptersModelsReady).pipe((0,S.p)(t=>!0===t),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new zg)})}initDynamicLayout(){(0,Ht.z)([this.store.select(Z.getWidgetApiUIConfig),this.store.select(Z.getWidgetUrlConfig),this.store.select(fe.N.getSelectedChapter),this.store.select(Ue.j.getQuizModeActive),this.store.select(Ue.j.getActiveQuestion)]).pipe((0,S.p)(([t,o,i])=>null!=i&&null!=o),(0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o,i,s,r])=>{const a=jf(o),d=function ZE(n){if(!n||!n.config)return null;const t=new Tr;return t[G.Column]=n.config.info,t[G.Drawer]=n.config.info,t[G.Fullscreen]=n.config.fullscreen,t[G.Search]=n.config.objectTree,t[G.Camera]=n.config.nav,t[G.Loader]=Gc(n.config.loader),t[G.Whiteboard]=n.config.whiteboard,t[G.VisibilityLayers]=n.config.visibilityLayers,t[G.VisibilityLayersMode]=$c(n.config.visibilityLayersMode,n.config.skinLayers),t[G.SkinLayers]=n.config.skinLayers,t[G.ContextActions]=n.config.contextActions,t[G.Audio]=(0,m.isNil)(n.config.audio)?null:n.config.audio!==qn.None,t[G.Media]=Qp(n.config.playPause,n.config.scrubber,n.config.mediaControls),t}(i.ui),f=function eC(n){const t=new Tr;return t.anatomyLabels=!1,t.labelList=!1,t.labels=!1,t.legend=!1,t.nodeInfo=!1,t.pagination=!1,t.search=!1,t.toggleLabels=!1,t.tools=n?.type===vn.Q5.SelectAnatomy,t.visibilityLayers=!1,t.whiteboard=!1,t}(r);this.viewService.setUI({apiUIConfig:t,urlUIConfig:a,chapterUIConfig:d,quizUIConfig:s?f:null})})}initHeaderAndFooter(){(0,Ht.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$]).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(([t,o])=>{const i=t<=Vn.Medium?40:56,s=i;this.store.dispatch(new wn.SetHeaderHeight(i)),this.store.dispatch(new wn.SetFooterHeight(s));const r=this.widgetElRef.nativeElement;r.style.setProperty("--header-height",`${i}px`),r.style.setProperty("--footer-height",`${s}px`)})}handleContentErrors(){this.store.dispatch(new bs(null,null)),this.errorService.redirectToErrorPage(hg.Y.Content)}handleAuthErrors(t){I.c.deploy!==ri.Z.Local&&this.errorService.redirectToErrorPage(Hb.Auth,t.response.errorCode)}getDocumentInteraction(){let t,o;return new y.c(i=>{t=new Yn.Manager(document.documentElement),t.add([new Yn.Tap({event:"singletap"}),new Yn.Tap({event:"doubletap",taps:2}),new Yn.Pan({event:"pan",direction:Yn.DIRECTION_ALL,threshold:0})]),o=()=>i.next(),t.on("panstart",o),t.on("singletap",o),document.documentElement.addEventListener("keypress",o),document.documentElement.addEventListener("focusin",o),document.documentElement.addEventListener("wheel",o)}).pipe((0,bt.j)(()=>{t&&(t.destroy(),t=null),document.documentElement.removeEventListener("keypress",o),document.documentElement.removeEventListener("focusin",o),document.documentElement.removeEventListener("wheel",o)}),(0,b.Q)(this.ngUnsubscribe))}getIntersectionObserver(t,o){return new y.c(i=>{const r=new IntersectionObserver(a=>{a[0].intersectionRatio>=o&&(i.next(t),i.complete(),r.unobserve(t))},{root:null,threshold:o});r.observe(t)})}setWidgetTransparent(t){t?this.renderer.setStyle(document.body,"background","none transparent"):this.renderer.removeStyle(document.body,"background")}}(zl=Ks).\u0275fac=function(t){return new(t||zl)(e.rXU(q.qQ),e.rXU(l.il),e.rXU(l.En),e.rXU(ne.nX),e.rXU(Q4),e.rXU(Y4.I),e.rXU(u.y),e.rXU(co.j),e.rXU(zt.n$),e.rXU(e.sFG),e.rXU(hn),e.rXU(Mr),e.rXU(gg))},zl.\u0275cmp=e.VBU({type:zl,selectors:[["app-widget-master"]],viewQuery:function(t,o){if(1&t&&e.GBs(nk,7),2&t){let i;e.mGM(i=e.lsd())&&(o.widgetElRef=i.first)}},decls:8,vars:6,consts:[["widgetElRef",""],[1,"widget","theme-light"],["class","widget__header",3,"ngSwitch",4,"ngIf"],[1,"widget__body"],["class","widget-shell",4,"appFlagApplication","appFlagApplicationPlatform","appFlagApplicationMode"],[1,"widget__header",3,"ngSwitch"],[1,"widget-shell"]],template:function(t,o){1&t&&(e.j41(0,"div",1,0),e.nrm(2,"app-skip-nav"),e.DNE(3,ik,3,3,"div",2),e.nI1(4,"async"),e.j41(5,"div",3),e.nrm(6,"router-outlet"),e.k0s()(),e.DNE(7,ok,1,0,"div",4)),2&t&&(e.R7$(3),e.Y8G("ngIf",e.bMT(4,4,o.siteHeader$)===o.siteHeaderType.Logo),e.R7$(4),e.Y8G("appFlagApplication",o.environmentApplication.All)("appFlagApplicationPlatform",o.environmentPlatform.SDK)("appFlagApplicationMode","exclude"))},dependencies:[q.bT,q.ux,ne.n3,nu.Y,Dd,tk,q.Jj],styles:[".widget[_ngcontent-%COMP%]{--header-height: 56px;--footer-height: 56px;position:fixed;inset:0;display:flex;flex-direction:column;height:100vh;overflow:hidden}.widget__header[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.widget-shell[_ngcontent-%COMP%]{pointer-events:none;position:fixed;inset:0;z-index:99999;box-shadow:inset 0 0 0 1px #d7e0ea}"]}),Wl([(0,l.l6)(Z.getBypassAnalytics),Xl("design:type",y.c)],Ks.prototype,"bypassAnalytics$",void 0),Wl([(0,l.l6)(gn.getSiteHeader),Xl("design:type",y.c)],Ks.prototype,"siteHeader$",void 0),Wl([(0,l.l6)(In.getHorizontalBreakpoint),Xl("design:type",y.c)],Ks.prototype,"horizontalBreakpoint$",void 0),Wl([(0,l.l6)(In.getVerticalBreakpoint),Xl("design:type",y.c)],Ks.prototype,"verticalBreakpoint$",void 0),Wl([(0,l.l6)(Z.getEmbedded),Xl("design:type",y.c)],Ks.prototype,"embedded$",void 0);const rk={title:"We're unable to find the model you're looking for.",description:'Please check your URL or visit the <a href="/" target="_blank">BioDigital Human</a> to see what\'s available in our 3D model library.'},ak={title:"Your BioDigital Human embed requires proper authentication.",description:""},lk={[pg.InvalidUAID]:{title:"Authentication Issues",description:"Your Human Widget has invalid user credentials.",url:"https://support.biodigital.com"}};function ck(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleSeeDetailsClick())}),e.EFF(1," See Details "),e.k0s()}}function dk(n,t){if(1&n&&(e.j41(0,"textarea",14),e.EFF(1,"        "),e.k0s()),2&n){const o=e.XpG(2);e.Y8G("value",o.engineErrorReport)}}function _k(n,t){if(1&n){const o=e.RV6();e.j41(0,"div")(1,"h1",3),e.EFF(2,"The BioDigital Human encountered an error."),e.k0s(),e.j41(3,"h2",4),e.EFF(4," Error: "),e.j41(5,"span",5),e.EFF(6),e.k0s()(),e.j41(7,"div",6),e.EFF(8," To receive assistance with this error, please follow these steps: "),e.k0s(),e.j41(9,"ol",7)(10,"li",8)(11,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleDownloadClick())}),e.EFF(12," Download "),e.k0s(),e.EFF(13," the error report. "),e.k0s(),e.j41(14,"li",8)(15,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleActionClick(s.supportURL))}),e.EFF(16," Share the report "),e.k0s(),e.EFF(17," with the customer support team. "),e.k0s()(),e.j41(18,"div",10),e.DNE(19,ck,2,0,"button",11),e.j41(20,"div"),e.DNE(21,dk,2,1,"textarea",12),e.k0s()()()}if(2&n){const o=e.XpG();e.R7$(6),e.JRh(o.engineErrorMessage),e.R7$(13),e.Y8G("ngIf",!o.viewEngineErrorDetails),e.R7$(2),e.Y8G("ngIf",o.viewEngineErrorDetails)}}function pk(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",3),e.EFF(1),e.k0s(),e.j41(2,"div",15),e.qex(3),e.j41(4,"button",9),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleActionClick(s.supportURL))}),e.EFF(5," Contact Support "),e.k0s(),e.bVm(),e.k0s(),e.nrm(6,"div",16)}if(2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.title," "),e.R7$(5),e.Y8G("innerHTML",o.description,e.npT)}}const qb=[{path:"",component:Ks,resolve:{widgetUrlConfig:zu},children:[{path:"",component:ct},{path:"error",component:(()=>{var n;class t{handleSeeDetailsClick(){this.viewEngineErrorDetails=!0}get title(){return this.errorConfig.title}get description(){return this.errorConfig.description}constructor(i,s,r){this.router=i,this.snackBar=s,this.engineService=r,this.supportURL="https://support.biodigital.com",this.isEngineError=!1,this.viewEngineErrorDetails=!1;const{errorType:a,errorCode:d,error:f,errorUrl:T}=this.router.getCurrentNavigation().extras.state;this.errorType=a,this.errorUrl=T,this.errorCode=d,this.error=f}ngOnInit(){if(this.errorType===hg.Y.Engine){this.isEngineError=!0;const i={contentId:this.errorUrl,error:this.error,webglInfo:this.engineService.getWEBGLInfo()};this.engineErrorMessage=i.error.message,this.engineErrorReport=JSON.stringify(i,null,2)}else this.errorConfig=this.errorType===hg.Y.Content?rk:lk[this.errorCode]||ak}handleDownloadClick(){(0,Zm.saveAs)(new Blob([this.engineErrorReport],{type:"text/plain"}),"BioDigital_Error_Report.txt")}handleActionClick(i){window.open(i)||this.snackBar.open("Unable to open link in new window, please check your pop-up settings.")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(ne.Ix),e.rXU(_o.UG),e.rXU(u.y))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-error-page"]],decls:4,vars:2,consts:[["notEngineError",""],[1,"error"],[4,"ngIf","ngIfElse"],[1,"text-2xl","font-bold"],[1,"text-base","mt-4","mb-8"],[1,"font-semibold"],[1,"text-base","mb-4"],[1,"text-base"],[1,"my-4"],["app-button","","buttonType","outline","buttonTheme","light",3,"click"],[1,"mt-8"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click",4,"ngIf"],["class","error__details mt-2",3,"value",4,"ngIf"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click"],[1,"error__details","mt-2",3,"value"],[1,"flex","items-start","mt-10"],[1,"error__description","text-base","mt-8",3,"innerHTML"]],template:function(i,s){if(1&i&&(e.j41(0,"div",1),e.DNE(1,_k,22,3,"div",2)(2,pk,7,2,"ng-template",null,0,e.C5r),e.k0s()),2&i){const r=e.sdS(3);e.R7$(),e.Y8G("ngIf",s.isEngineError)("ngIfElse",r)}},dependencies:[bi.Q,q.bT],styles:[".error[_ngcontent-%COMP%]{margin:0 auto;max-width:640px;display:flex;flex-direction:column;padding:40px;color:#283853}.error[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style:decimal}.error__details[_ngcontent-%COMP%]{width:100%;height:200px}.error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#283853}"],changeDetection:0}),t})()}]}],uk=!0===I.c.offline?ne.iI.forRoot(qb,{useHash:!0}):ne.iI.forRoot(qb);let gk=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({providers:[zu],imports:[uk,ne.iI]}),t})();var It=_(45189),Nt=_(35056),hk=_(37522),mk=_(29512),fk=_(57078),Sk=_(50583),bk=_(83649),yk=_(43649),vk=_(98138);[hk.A,mk.A,fk.A,Sk.A,bk.A,yk.A,vk.A].forEach(n=>{(0,q.EO)(n)});let Zb=(()=>{var n;class t{static forRoot(){return{ngModule:t,providers:[{provide:e.xe9,useFactory:bn.kF},{provide:e.hnV,useFactory:zm,deps:[w.Qq,e.xe9],multi:!0}]}}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD]}),t})();var ey=_(81488);class Hl{}var Js,ii=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},vt=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const ty="/viewer",ny={publishing:!1,widgetURL:ty,dimensions:ef.dimensions,minDimensions:{width:300,height:400},aspectRatio:{width:4,height:3}};let Bn=((Js=class{static getDimensions(t){return t.dimensions}static getAspectRatio(t){return t.aspectRatio}static getMinDimensions(t){return t.minDimensions}static getWidgetURL(t){return t.widgetURL}static getPublishing(t){return t.publishing}setPublishWidgetURL(t,o){t.patchState({widgetURL:o.widgetURL||ty})}setPublishDimensions(t,o){t.patchState({dimensions:o.dimensions})}getPublishURL(t,o){const{model:i,camera:s,widgetOptions:r}=o,{widgetURL:a}=t.getState(),d=this.store.selectSnapshot(ke.getUserLanguage),f=this.store.selectSnapshot(ke.getSelectedUserApp),T=this.store.selectSnapshot(et.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetURL(i,a,r,s,Ma.Single,d,f,T).subscribe(L=>{t.dispatch(new Vp(i,L))},()=>{t.dispatch(new xp(i))})}getPublishURLSuccess(t,o){this.vendorAnalyticsService.track("Publish - Success",{type:"url",source:"publish"})}getPublishURLFail(t,o){this.snackbar.open("Unable to generate URL.")}getPublishIFrame(t,o){const{model:i,camera:s,widgetOptions:r}=o,a=t.getState(),d=a.widgetURL,f=o.dimensions??a.dimensions,T=this.store.selectSnapshot(ke.getUserLanguage),L=this.store.selectSnapshot(ke.getSelectedUserApp),ee=this.store.selectSnapshot(et.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetEmbed(i,d,r,f,s,Ma.Single,T,L,ee).subscribe(re=>{t.dispatch(new jp(re))},()=>{t.dispatch(new jE)})}setPublishIFrameSuccess(t,o){this.vendorAnalyticsService.track("Publish - Success",{type:"iframe",source:"publish"})}savePublishImage(t,{imageData:o,imageType:i}){this.publishService.saveUserImage(o,i).subscribe(s=>{t.dispatch(new Fp(s))},()=>{t.dispatch(new VE)})}savePublishImageSuccess(t,o){this.vendorAnalyticsService.track("Publish - Success",{type:"image",source:"publish"})}getPublishImage(t,o){const{model:i,camera:s,widgetOptions:r,imageData:a,fileType:d}=o,{widgetURL:f}=t.getState(),T=this.store.selectSnapshot(ke.getUserLanguage),L=this.store.selectSnapshot(ke.getSelectedUserApp);(0,si.p)(this.publishService.generateWidgetURL(i,f,r,s,Ma.Single,T,L),this.publishService.saveUserImage(a,d)).subscribe(([ee,re])=>{const ve=this.publishService.getImageEmbed(i.title,ee,re);t.dispatch(new xE(ve))},()=>{t.dispatch(new FE)})}setPublishing(t,{publishing:o}){t.patchState({publishing:o})}resetPublish(t,o){t.setState(ny)}constructor(t,o,i,s){this.publishService=t,this.store=o,this.snackbar=i,this.vendorAnalyticsService=s}}).\u0275fac=function(t){return new(t||Js)(e.KVO(Sr),e.KVO(l.il),e.KVO(_o.UG),e.KVO(qe))},Js.\u0275prov=e.jDH({token:Js,factory:Js.\u0275fac}),Js);ii([(0,l.rc)(Up),vt("design:type",Function),vt("design:paramtypes",[Object,Up]),vt("design:returntype",void 0)],Bn.prototype,"setPublishWidgetURL",null),ii([(0,l.rc)(df),vt("design:type",Function),vt("design:paramtypes",[Object,df]),vt("design:returntype",void 0)],Bn.prototype,"setPublishDimensions",null),ii([(0,l.rc)(pf),vt("design:type",Function),vt("design:paramtypes",[Object,pf]),vt("design:returntype",void 0)],Bn.prototype,"getPublishURL",null),ii([(0,l.rc)(Vp),vt("design:type",Function),vt("design:paramtypes",[Object,Vp]),vt("design:returntype",void 0)],Bn.prototype,"getPublishURLSuccess",null),ii([(0,l.rc)(xp),vt("design:type",Function),vt("design:paramtypes",[Object,xp]),vt("design:returntype",void 0)],Bn.prototype,"getPublishURLFail",null),ii([(0,l.rc)(_f),vt("design:type",Function),vt("design:paramtypes",[Object,_f]),vt("design:returntype",void 0)],Bn.prototype,"getPublishIFrame",null),ii([(0,l.rc)(jp),vt("design:type",Function),vt("design:paramtypes",[Object,jp]),vt("design:returntype",void 0)],Bn.prototype,"setPublishIFrameSuccess",null),ii([(0,l.rc)(hf),vt("design:type",Function),vt("design:paramtypes",[Object,hf]),vt("design:returntype",void 0)],Bn.prototype,"savePublishImage",null),ii([(0,l.rc)(Fp),vt("design:type",Function),vt("design:paramtypes",[Object,Fp]),vt("design:returntype",void 0)],Bn.prototype,"savePublishImageSuccess",null),ii([(0,l.rc)(mf),vt("design:type",Function),vt("design:paramtypes",[Object,mf]),vt("design:returntype",void 0)],Bn.prototype,"getPublishImage",null),ii([(0,l.rc)(uf),vt("design:type",Function),vt("design:paramtypes",[Object,uf]),vt("design:returntype",void 0)],Bn.prototype,"setPublishing",null),ii([(0,l.rc)(gf),vt("design:type",Function),vt("design:paramtypes",[Object,gf]),vt("design:returntype",void 0)],Bn.prototype,"resetPublish",null),ii([(0,l.MD)(),vt("design:type",Function),vt("design:paramtypes",[Hl]),vt("design:returntype",void 0)],Bn,"getDimensions",null),ii([(0,l.MD)(),vt("design:type",Function),vt("design:paramtypes",[Hl]),vt("design:returntype",void 0)],Bn,"getAspectRatio",null),ii([(0,l.MD)(),vt("design:type",Function),vt("design:paramtypes",[Hl]),vt("design:returntype",void 0)],Bn,"getMinDimensions",null),ii([(0,l.MD)(),vt("design:type",Function),vt("design:paramtypes",[Hl]),vt("design:returntype",void 0)],Bn,"getWidgetURL",null),ii([(0,l.MD)(),vt("design:type",Function),vt("design:paramtypes",[Hl]),vt("design:returntype",void 0)],Bn,"getPublishing",null),Bn=ii([(0,l.Uw)({name:"publish",defaults:ny}),vt("design:paramtypes",[Sr,l.il,_o.UG,qe])],Bn);var Ek=_(11562),Ck=_(9529);let Tk=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,yi.o,we.YN,we.X1]}),t})(),iy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,we.X1,Nt.G,Ek.YG,Ck.bU,Tk,l.rK.forFeature([Bn])]}),t})(),kd=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([_t]),q.MD,It.G,we.X1,Nt.G,ne.iI,iy]}),t})();class kn{}var oy=function(n){return n[n.Query=0]="Query",n[n.Path=1]="Path",n}(oy||{}),fg=function(n){return n[n.Row=0]="Row",n[n.Card=1]="Card",n}(fg||{});const Ok=I.c.application===Wn.c.Loft?fg.Row:fg.Card;var Ld=function(n){return n.Success="success",n.Fail="fail",n}(Ld||{});const Mk="cdb/content",Ik="cdb/copy/content",wk={headers:new w.Lr({"Content-Type":"application/json; charset=utf-8"})},Pk=["production","client","preview","internal_content","public_preview","demos","social","exports","real_data"];let sy=(()=>{var n;class t{constructor(i,s){this.http=i,this.sceneService=s}saveModule(i,s){s=this.formatModulePath(s);const r=[Mk,"modules",s].join("/"),a=this.JSONStringify(i);return this.http.put(r,a,wk).pipe((0,le.T)(()=>Ld.Success),(0,Ai.W)(({status:d})=>(0,Rt.of)(d>=200&&d<=202?Ld.Success:Ld.Fail)))}mergeModule(i,s,r="exception"){return this.http.post("/cdb/merge/modules",{loft:`${i}.json`,bridge:`${s}.json`,merge_option:r})}copyState(i,s){const r=[Ik,"states",s].join("/"),a={headers:new w.Lr({"Content-Type":"application/json; charset=utf-8","source-state":i})};return this.http.put(r,{},a)}listContents(i,s,r,a=!1){const d=this.generateModulePath(i,s||"",r||"");return this.http.get(`/cdb/ls/content/modules/${d}`).pipe((0,le.T)(f=>a?f.contents.map(L=>{const ee=L.name.replace("/content/modules/","").replace(".json",""),re=L.name.split("/").pop().replace("/content/modules","").replace(".json",""),ve=new me;return ve.id=ee,ve.title=re,ve.type=ye.c.Module,ve}):f.contents))}getState(i){return this.http.get(`/cdb/ls/content/states/${i}`).pipe((0,le.T)(s=>s.contents))}getClients(){return this.http.get("/search/client").pipe((0,le.T)(i=>i.clients))}getUsedStates(){const i={};return Object.values(this.sceneService.getObjects()).reduce((s,r)=>(["transformId","morphId","geometryId","materialId"].forEach(a=>{const d=this.getPropertyState(r,a);d.length&&(i[d]=!0)}),r.hasOwnProperty("renderables")&&["morphId","geometryId","materialId"].forEach(a=>{r.renderables.forEach(f=>{const T=this.getPropertyState(f,a);T.length&&(i[T]=!0)})}),s),{}),Object.keys(i)}parseScenePath(i){const s=i.split("/");return 1===s.length?null:{fullPath:`https://qa.biodigital.com/content/modules/${i}`,relativePath:s.slice(0,s.length-1).join("/"),sceneName:s[s.length-1]}}formatModulePath(i){let s=i;return/\.json$/.test(i)||(s=`${s}.json`),s}getPrimaryCategories(){return(0,Rt.of)(Pk)}getSecondaryCategories(i){switch(i){case"production":return(0,Rt.of)(["maleAdult","femaleAdult"]);case"client":return this.getClients();default:return(0,Rt.of)([])}}generateSaveModule(i){const s=this.parseScenePath(i),r=s.relativePath.split("/");return{id:i,name:s.sceneName,primaryCategory:r[0]||"",secondaryCategory:r[1]||""}}generateModulePath(i,s,r){const a=[];return i.length&&a.push(i),s.length&&a.push(s),r.length&&(r.indexOf(".json")<0&&(r=`${r}.json`),a.push(r)),a.join("/")}getPropertyState(i,s){return null!=i[s]?i[s].split("/")[0]:""}JSONStringify(i){return JSON.stringify(i).replace(/[\u007f-\uffff]/g,s=>"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(ji.w))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();class Ak{constructor(t="",o,i=25,s=0){this.query=t,this.sortBy=o,this.pageSize=i,this.offset=s}}class ry{}let ay=(()=>{var n;class t{constructor(i){this.store=i}ngOnInit(){}close(){this.store.dispatch(new At.ShowFilters(!1,!0))}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-gallery-drawer"]],decls:8,vars:2,consts:[["appEventFence","","data-test","galleryDrawer",1,"gallery-drawer"],[1,"gallery-drawer__header"],[1,"gallery-drawer__label"],["app-button","","buttonType","ghost","buttonTheme","light","type","button","title","Close","data-test","galleryDrawerClose",3,"click"],["icon","times","size","lg"],[1,"gallery-drawer__body"],["viewMode","expanded"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3,"Filters"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return s.close()}),e.nrm(5,"app-icon",4),e.k0s()(),e.j41(6,"div",5),e.nrm(7,"app-gallery-filters",6),e.k0s()()),2&i&&(e.Y8G("@expand",void 0),e.R7$(4),e.BMQ("aria-label","Close"))},styles:[".gallery-drawer[_ngcontent-%COMP%]{box-shadow:0 11px 15px #0003,0 24px 38px #00000024,0 9px 46px #0000001f;background:#fff;border-radius:16px 16px 0 0;display:block;position:fixed;bottom:0;top:auto;width:100vw}.gallery-drawer__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;border-bottom:1px solid #eaeff5;height:52px;padding:0 12px 0 20px;display:flex;align-items:center}.gallery-drawer__label[_ngcontent-%COMP%]{flex:1 0 auto}.gallery-drawer__body[_ngcontent-%COMP%]{padding:20px}"],data:{animation:[(0,Le.hZ)("expand",[(0,Le.kY)(":enter",[(0,Le.K2)([(0,Le.iF)({top:"100%"}),(0,Le.i0)("250ms ease-in-out",(0,Le.iF)({top:"*"}))])])])]},changeDetection:0}),t})(),ly=(()=>{var n;class t{constructor(i,s){this.overlay=i,this.store=s}openDrawer(){this.overlayRef||this._createOverlay();const i=new pd.A8(ay);this.overlayRef.attach(i)}closeDrawer(){this.overlayRef.detach()}_createOverlay(){const i=new Ra.rR({hasBackdrop:!0,scrollStrategy:this.overlay.scrollStrategies.block()});this.overlayRef=this.overlay.create(i),this.overlayRef.backdropClick().subscribe(()=>{this.store.dispatch(new At.ShowFilters(!1,!0))})}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(Ra.hJ),e.KVO(l.il))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var hs;class zn{static getOfflineModelIDs(){return zn._offlineModelIDs$}static setOfflineModelIDs(t){zn._offlineModelIDs.next(t)}static getOfflineModelIDList(){return this._offlineModelIDs.getValue()}static setStore(t){zn.store=t}static setServices(t,o){zn.rpcService=t,zn.applicationEventService=o}static setSnackBar(t){zn.snackBar=t}static setRouter(t){zn.router=t}static debug(t){this.fire(nt.F.NativeDebugMessage,t)}static fire(t,o){zn.applicationEventService&&zn.applicationEventService.fireEvent(t,o)}on(t,o){zn.rpcService&&zn.rpcService.getEvent(t,!1).subscribe(o)}send(t,o){let i=null,s={};switch(t){case Te.NativeErrorMessage:i=zn.snackBar.open(o,"OK",{duration:6e3,verticalPosition:"top"}),i.onAction().subscribe(()=>{i.dismiss()});break;case Te.NativeSetAppVersion:zn.appVersion=o.appVersion;break;case Te.NativeRedirect:s=JSON.parse(o.queryItems),zn.router.navigate([o.url],{queryParams:s});break;case Te.NativeReload:window.location.href=o.url;break;case Te.NativeOfflineModelIds:zn.setOfflineModelIDs(o.modelIds);break;default:zn.debug("unprocessed HumanWindowAPI send "+t)}}}(hs=zn).store=null,hs.snackBar=null,hs.router=null,hs.appVersion="",hs._offlineModelIDs=new ui.t([]),hs._offlineModelIDs$=hs._offlineModelIDs.asObservable();var qs,xt=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Ie=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const cy=[Pn.Organization,Pn.Collection],Nk=[...cy,Pn.Category],dy={[ao.Private]:"My Models",[ao.TeamEdit]:"View & Edit",[ao.TeamView]:"View Only"},Rk=Object.fromEntries(Object.entries(dy).map(([n,t])=>[t,n])),_y={loading:!0,searchMode:oy.Query,viewMode:Ok,showFilters:!1,searchResults:{total:0,items:[]},checkedResults:[],searchConfig:null,searchOptions:null,sidenav:{enabled:!0,open:!0,disableClose:!1},bulkActions:{enabled:!0,active:!1,items:[]},cardActions:{enabled:!0}},Dk=[...Tn.tags,...yf.tags,...kc.tags,...Ia.tags,...br.tags];let wt=(qs=class{static getLoading(t){return t.loading}static getSearchMode(t){return t.searchMode}static getSearchConfig(t){return t.searchConfig}static getSearchOptions(t){return t.searchOptions}static getHasFilters(t){return Nk.includes(t.searchConfig?.type)||!0===I.c.native}static getAvailableTags(t,o){const i=new Set,s=t.searchResults.items,r=I.c.native?zn.getOfflineModelIDList():[];return cy.includes(t.searchConfig?.type)?function IE(n){const t=new Set;return n.forEach(o=>{const i=!0===o.is_owner,s=Op(o),r=Ym(o),a=Mp(o);i?t.add(ao.Private):s&&r?t.add(ao.TeamEdit):(s&&!r||a)&&t.add(ao.TeamView)}),Array.from(t)}(s).forEach(f=>{i.add(dy[f])}):s.forEach(d=>{d.tags.forEach(f=>{"quiz"===f&&(f="Quiz"),Dk.includes(f)&&i.add(f)}),I.c.native&&r.includes(d.id)&&i.add("Downloaded")}),Array.from(i)}static getActiveTags(t){const i={};return t.searchConfig.tags.forEach(s=>{const r=BE.find(a=>a.tags.some(d=>d===s));if(r){const a=(0,m.get)(r,"title","");i[a]=s}}),i}static getActiveTagsCount(t){return(0,m.compact)(t.searchConfig.tags).length}static getSearchType(t){return t.searchConfig?t.searchConfig.type:null}static getSearchGroup(t){switch(t.searchConfig?.type){case Pn.Category:case Pn.Community:case Pn.Internal:case Pn.Loft:return ye.c.Module;case Pn.Collection:case Pn.Private:case Pn.Organization:return ye.c.Bookmark}}static getViewMode(t){return t.viewMode}static getShowFilters(t){return t.showFilters}static getSort(t){return t.searchOptions.sortBy}static getSortOptions(t){switch(t.searchConfig.type){case Pn.Loft:return[Aa,Uc];case Pn.Category:return[Mf,Lc,Aa,Uc];default:return[Lc,Aa,Uc,If,wf]}}static getSidenav(t){return t.sidenav}static getBulkActions(t){return t.bulkActions}static getBulkActionsAvailable(t){const{enabled:o,items:i}=t.bulkActions;return o&&i.length>0}static getBulkActionsActive(t){return t.bulkActions.active}static getCardActions(t){return t.cardActions}static getFilteredResults(t){const{searchResults:o,searchOptions:i,searchConfig:s}=t,{ascending:r,fields:a}=i.sortBy,{offset:d,pageSize:f}=i;let T=Wp(o.items,a,r);return T=Af(i,s,T),T=T.slice(d,d+f),{...o,items:T}}static getAllResults(t){const{searchResults:o,searchOptions:i,searchConfig:s}=t,{ascending:r,fields:a}=i.sortBy;let d=Wp(o.items,a,r);return d=Af(i,s,d),{total:o.total,items:d}}static getCheckedResults(t){return t.checkedResults}static isZSpaceSearch(t){return t.searchConfig.type===Pn.Category&&t.searchConfig.categoryId===Ti.a.Zspace}setSearchMode(t,o){t.patchState({searchMode:o.searchMode})}setViewMode(t,o){t.patchState({viewMode:o.viewMode})}showFilters(t,o){t.patchState({showFilters:o.show}),o.triggerDrawer&&(o.show?this.galleryService.openDrawer():this.galleryService.closeDrawer())}setSearchOptions(t,o){t.patchState({searchOptions:{...o.options}})}setActiveTags(t,o){const s={...t.getState().searchConfig,tags:(0,m.flatten)(Object.values(o.activeTags))};this.store.dispatch(new At.SetSearchConfig(s))}setSearchConfig(t,o){const i=o.config||t.getState().searchConfig,s=o.options||t.getState().searchOptions;null!==i&&t.patchState({searchOptions:{...s},searchConfig:{...i}})}searchCategory(t,{categoryId:o}){const i="public"===o?new QE(""):new HE(o);t.dispatch(new At.SetSearchConfig(i))}searchStudio(t,o){const{searchConfig:i,searchOptions:s}=t.getState(),r=new Ak("",Aa),a=this.store.selectSnapshot(ke.getUserLanguage),d=this.store.selectSnapshot(et.isZSpaceAccount);t.patchState({loading:!0,searchOptions:{...s,pageSize:r.pageSize,offset:r.offset},checkedResults:[]});let f=new y.c;switch(i.type){case Pn.Category:f=this.exploreService.getAnatomyCategory(i.query,"all"===i.categoryId?"":i.categoryId,i.tags.filter(ee=>!ee.startsWith("Downloaded")),d,a);break;case Pn.Organization:f=this.bookmarksService.getOrganizationContent(i.organizationId,i.query,a);break;case Pn.Collection:f=this.organizationsService.getCollectionContent(i.organizationId,i.collectionId,i.query,a);break;case Pn.Community:f=this.bookmarksService.getPublicBookmarks(i.query,a);break;case Pn.Private:f=this.bookmarksService.getPrivateContent(i.query,a);break;case Pn.Internal:f=this.exploreService.searchInternal(i.query,i.directory);break;case Pn.Loft:const L=i.query.indexOf(".json")>0;f=this.modulesService.listContents(i.primary,i.secondary,L?i.query:"",!0).pipe((0,le.T)(ee=>L?ee:ee.filter(re=>re.title.indexOf(i.query)>=0)))}const T=i.tags.reduce((L,ee)=>{const re=Rk[ee];return re&&L.push(re),L},[]);f.pipe((0,le.T)(L=>T.length>0?function ME(n,t,o=!0){return n.filter(i=>{const s=!0===i.is_owner,r=Op(i),a=Ym(i),d=Mp(i),f=T=>{switch(T){case ao.Private:return s;case ao.TeamEdit:return r&&a;case ao.TeamView:return r&&!a||d;default:return!1}};return o?t.every(f):t.some(f)})}(L,T):L),(0,bt.j)(()=>t.patchState({loading:!1}))).subscribe(L=>{const ee=I.c.native?zn.getOfflineModelIDList():[],re=i.tags.includes("Downloaded")?L.filter(ve=>ee.includes(ve.id)):L;t.dispatch(new At.SearchSuccess(re))})}searchSuccess(t,o){t.patchState({searchResults:{items:o.bookmarks,total:o.bookmarks.length}});const i=t.getState().searchConfig,s=o.bookmarks.length>0?"Search - With Results":"Search - No Results",r={...i,tags:i.tags.filter(a=>""!==a).join(", ")};this.vendorAnalyticsService.track(s,r)}checkItem(t,o){let i=t.getState().checkedResults;const s=i.some(r=>r===o.id);o.checked&&!s?i=[...i,o.id]:o.checked||(i=i.filter(r=>r!==o.id)),t.patchState({checkedResults:i})}checkAll(t,o){const i=t.getState().searchResults.items.map(s=>s.id);t.patchState({checkedResults:i})}uncheckAll(t,o){t.patchState({checkedResults:[]})}setCheckedItems(t,o){t.patchState({checkedResults:o.ids})}setSidenav(t,o){t.patchState({sidenav:{...o.sidenav}})}setCardActions(t,o){t.patchState({cardActions:{...o.cardActions}})}setBulkActions(t,o){const{bulkActions:i}=t.getState();t.patchState({bulkActions:{...i,...o.bulkActions}})}clearResults(t,o){t.patchState({searchResults:{items:[],total:0}})}resetGallery(t,o){t.patchState(_y)}constructor(t,o,i,s,r,a,d){this.organizationsService=t,this.modulesService=o,this.exploreService=i,this.bookmarksService=s,this.galleryService=r,this.store=a,this.vendorAnalyticsService=d}},qs.\u0275fac=function(t){return new(t||qs)(e.KVO(he),e.KVO(sy),e.KVO(jc),e.KVO(Pa),e.KVO(ly),e.KVO(l.il),e.KVO(qe))},qs.\u0275prov=e.jDH({token:qs,factory:qs.\u0275fac}),qs);xt([(0,l.rc)(At.SetSearchMode),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetSearchMode]),Ie("design:returntype",void 0)],wt.prototype,"setSearchMode",null),xt([(0,l.rc)(At.SetViewMode),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetViewMode]),Ie("design:returntype",void 0)],wt.prototype,"setViewMode",null),xt([(0,l.rc)(At.ShowFilters),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.ShowFilters]),Ie("design:returntype",void 0)],wt.prototype,"showFilters",null),xt([(0,l.rc)(At.SetSearchOptions),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetSearchOptions]),Ie("design:returntype",void 0)],wt.prototype,"setSearchOptions",null),xt([(0,l.rc)(At.SetActiveTags),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetActiveTags]),Ie("design:returntype",void 0)],wt.prototype,"setActiveTags",null),xt([(0,l.rc)(At.SetSearchConfig),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetSearchConfig]),Ie("design:returntype",void 0)],wt.prototype,"setSearchConfig",null),xt([(0,l.rc)(At.SearchCategory),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SearchCategory]),Ie("design:returntype",void 0)],wt.prototype,"searchCategory",null),xt([(0,l.rc)(At.SearchStudio),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SearchStudio]),Ie("design:returntype",void 0)],wt.prototype,"searchStudio",null),xt([(0,l.rc)(At.SearchSuccess),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SearchSuccess]),Ie("design:returntype",void 0)],wt.prototype,"searchSuccess",null),xt([(0,l.rc)(At.CheckItem),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.CheckItem]),Ie("design:returntype",void 0)],wt.prototype,"checkItem",null),xt([(0,l.rc)(At.CheckAll),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.CheckAll]),Ie("design:returntype",void 0)],wt.prototype,"checkAll",null),xt([(0,l.rc)(At.UncheckAll),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.UncheckAll]),Ie("design:returntype",void 0)],wt.prototype,"uncheckAll",null),xt([(0,l.rc)(At.SetCheckedItems),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetCheckedItems]),Ie("design:returntype",void 0)],wt.prototype,"setCheckedItems",null),xt([(0,l.rc)(At.SetSidenav),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetSidenav]),Ie("design:returntype",void 0)],wt.prototype,"setSidenav",null),xt([(0,l.rc)(At.SetCardActions),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetCardActions]),Ie("design:returntype",void 0)],wt.prototype,"setCardActions",null),xt([(0,l.rc)(At.SetBulkActions),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.SetBulkActions]),Ie("design:returntype",void 0)],wt.prototype,"setBulkActions",null),xt([(0,l.rc)(At.ClearResults),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.ClearResults]),Ie("design:returntype",void 0)],wt.prototype,"clearResults",null),xt([(0,l.rc)(At.Reset),Ie("design:type",Function),Ie("design:paramtypes",[Object,At.Reset]),Ie("design:returntype",void 0)],wt.prototype,"resetGallery",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getLoading",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSearchMode",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSearchConfig",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSearchOptions",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getHasFilters",null),xt([(0,l.MD)([ke]),Ie("design:type",Function),Ie("design:paramtypes",[kn,Object]),Ie("design:returntype",void 0)],wt,"getAvailableTags",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getActiveTags",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getActiveTagsCount",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSearchType",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSearchGroup",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getViewMode",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getShowFilters",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSort",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSortOptions",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getSidenav",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getBulkActions",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getBulkActionsAvailable",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",Boolean)],wt,"getBulkActionsActive",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getCardActions",null),xt([(0,l.MD)([ke]),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",ry)],wt,"getFilteredResults",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",ry)],wt,"getAllResults",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"getCheckedResults",null),xt([(0,l.MD)(),Ie("design:type",Function),Ie("design:paramtypes",[kn]),Ie("design:returntype",void 0)],wt,"isZSpaceSearch",null),wt=xt([(0,l.Uw)({name:"gallery",defaults:_y}),Ie("design:paramtypes",[he,sy,jc,Pa,ly,l.il,qe])],wt);var Ql=_(89511),Yl=_(59162),Sg=_(78696);const kk=["app-pill-button",""],Lk=["*"],Uk=n=>({"pill-button--selected":n});let jk=(()=>{var n;class t{constructor(){this.selected=!1}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["button","app-pill-button",""],["a","app-pill-button",""]],inputs:{selected:"selected"},attrs:kk,ngContentSelectors:Lk,decls:2,vars:3,consts:[[1,"pill-button",3,"ngClass"]],template:function(i,s){1&i&&(e.NAR(),e.j41(0,"span",0),e.SdG(1),e.k0s()),2&i&&e.Y8G("ngClass",e.eq3(1,Uk,s.selected))},dependencies:[q.YU],styles:["[_nghost-%COMP%]{border-color:transparent;background:none;border-width:0;padding:0;margin:0;border-radius:4px;outline:0 none}[_nghost-%COMP%]:not([disabled]):hover{cursor:pointer}[_nghost-%COMP%]:focus   .pill-button[_ngcontent-%COMP%]{outline:#2d72dc solid 2px!important}[_nghost-%COMP%]:disabled   .pill-button[_ngcontent-%COMP%], [_nghost-%COMP%]:disabled:hover   .pill-button[_ngcontent-%COMP%]{background-color:#f9fafd;color:#96a8c0}.pill-button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-family:Inter,sans-serif;font-weight:500;color:#374a68;display:flex;align-items:center;justify-content:center;background-color:#eaeff5;border-radius:100px;padding:8px 16px;transition:background-color .12s,color .12s;width:100%}.pill-button[_ngcontent-%COMP%]:hover{background-color:#d7e0ea}.pill-button--selected[_ngcontent-%COMP%], .pill-button--selected[_ngcontent-%COMP%]:hover{background-color:#2d72dc;color:#fff}"],changeDetection:0}),t})();var Kl;function Fk(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",9)(1,"button",10),e.nI1(2,"async"),e.bIt("click",function(){const s=e.eBV(o).$implicit,r=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.setTag(r.title,a.activeTags[r.title]===s?"":s))}),e.EFF(3),e.nI1(4,"titlecase"),e.k0s()()}if(2&n){let o;const i=t.$implicit,s=e.XpG().$implicit,r=e.XpG(2);e.R7$(),e.Y8G("disabled",!(null!=(o=e.bMT(2,3,r.availableTags$))&&o.includes(i)))("selected",r.activeTags[s.title]===i),e.R7$(2),e.SpI(" ",e.bMT(4,5,i)," ")}}function Gk(n,t){if(1&n&&(e.j41(0,"div",5)(1,"h2",6),e.EFF(2),e.k0s(),e.j41(3,"ul",7),e.DNE(4,Fk,5,7,"li",8),e.k0s()()),2&n){const o=t.$implicit;e.R7$(2),e.JRh(o.title),e.R7$(2),e.Y8G("ngForOf",o.tags)}}function $k(n,t){if(1&n&&(e.j41(0,"div",3),e.DNE(1,Gk,5,2,"div",4),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.tagGroups)}}function Bk(n,t){if(1&n){const o=e.RV6();e.j41(0,"li",9)(1,"button",14),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2).$implicit,r=e.XpG(2);return e.Njj(r.setTag(s.title,""))}),e.j41(2,"span",15),e.EFF(3),e.nI1(4,"titlecase"),e.k0s(),e.nrm(5,"app-icon",16),e.k0s()()}if(2&n){const o=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,1,o))}}function zk(n,t){if(1&n&&(e.qex(0),e.DNE(1,Bk,6,3,"li",13),e.bVm()),2&n){const o=t.$implicit,i=e.XpG().$implicit,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",s.activeTags[i.title]===o)}}function Wk(n,t){if(1&n&&(e.qex(0),e.DNE(1,zk,2,1,"ng-container",12),e.bVm()),2&n){const o=t.$implicit;e.R7$(),e.Y8G("ngForOf",o.tags)}}function Xk(n,t){if(1&n&&(e.j41(0,"ul",11),e.DNE(1,Wk,2,1,"ng-container",12),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.tagGroups)}}class bg{get viewMode(){return this._viewMode}set viewMode(t){this._viewMode=t}get activeTags(){return this._activeTags}set activeTags(t){null==t&&(t={}),this._activeTags=t,this.activeTagList=Object.values(this.activeTags).reduce((o,i)=>(""!=i&&o.push(i),o),[]),this.changeDetectorRef.markForCheck()}constructor(t,o,i){this.changeDetectorRef=t,this.store=o,this.router=i,this.activeTagList=[],this.ngUnsubscribe=new Q.B,this._viewMode="expanded",this.tagGroups=[],this._activeTags={},this.selectedTagChange=new e.bkB}ngOnInit(){this.store.select(wt.getActiveTags).pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.activeTags=t}),this.initFilters()}isMyLibrary(){return this.router.url.includes("/results/bookmarks")}initFilters(){const t=I.c.native;if(this.tagGroups=[],t&&this.tagGroups.push(Cf),this.isMyLibrary())this.tagGroups.push(Tf);else{const o=["Quiz",Ti.a.Zspace];this.tagGroups=this.tagGroups.concat([kc,{...Ia,tags:(0,m.without)(Ia.tags,...o)}])}}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setTag(t,o){const i=this.store.selectSnapshot(wt.getActiveTags);i[t]=o,this.store.dispatch(new At.SetActiveTags(i))}}(Kl=bg).\u0275fac=function(t){return new(t||Kl)(e.rXU(e.gRc),e.rXU(l.il),e.rXU(ne.Ix))},Kl.\u0275cmp=e.VBU({type:Kl,selectors:[["app-gallery-filters"]],inputs:{viewMode:"viewMode"},outputs:{selectedTagChange:"selectedTagChange"},decls:3,vars:4,consts:[["data-test","galleryFilters",1,"gallery-filters"],["class","gallery-filters__expanded","data-test","galleryFiltersExpanded",4,"ngIf"],["class","gallery-filters__tags","data-test","galleryFiltersSummary",4,"ngIf"],["data-test","galleryFiltersExpanded",1,"gallery-filters__expanded"],["class","gallery-filters__group",4,"ngFor","ngForOf"],[1,"gallery-filters__group"],[1,"gallery-filters__header"],[1,"gallery-filters__tags"],["class","gallery-filters__tag",4,"ngFor","ngForOf"],[1,"gallery-filters__tag"],["app-pill-button","","data-test","galleryFiltersTag",3,"click","disabled","selected"],["data-test","galleryFiltersSummary",1,"gallery-filters__tags"],[4,"ngFor","ngForOf"],["class","gallery-filters__tag",4,"ngIf"],["app-pill-button","","data-test","galleryFiltersTag",3,"click"],[1,"mr-2"],["icon","times"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.DNE(1,$k,2,1,"div",1)(2,Xk,2,1,"ul",2),e.k0s()),2&t&&(e.AVh("gallery-filters--multiple",o.tagGroups.length>1),e.R7$(),e.Y8G("ngIf","expanded"===o.viewMode),e.R7$(),e.Y8G("ngIf","summary"===o.viewMode))},dependencies:[jk,q.Sq,q.bT,yt.R,q.Jj,q.PV],styles:[".gallery-filters__expanded[_ngcontent-%COMP%]{display:flex;gap:32px}.gallery-filters__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:8px}.gallery-filters__tag[_ngcontent-%COMP%]{display:inline-block;margin:0 12px 12px 0}@media (max-width: 540px){.gallery-filters__expanded[_ngcontent-%COMP%]{flex-direction:column;gap:0}.gallery-filters__group[_ngcontent-%COMP%]{padding:0 0 24px}}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(wt.getAvailableTags),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],bg.prototype,"availableTags$",void 0);var Hk=_(32996);let Qk=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,pd.jc,Hk.z,yi.o,Oi.C,Nt.G]}),t})();var Yk=_(27878);let Kk=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,Nt.G,pi.y2.forChild()]}),t})(),Ud=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,Nt.G,It.G,Kk]}),t})();var Jk=_(67575);let py=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,Nt.G,It.G,Jk.PO,Ud,Yk.wR]}),t})();const qk=["featuredCard"];function Zk(n,t){if(1&n&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.JRh(o.subtitle())}}function eL(n,t){if(1&n&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.JRh(o.metadata())}}function tL(n,t){if(1&n&&(e.j41(0,"figure",10),e.nrm(1,"img",11),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.Y8G("lazyLoad",o.featuredIcon())}}let nL=(()=>{var n;class t{constructor(){this.defaultImage="/assets/images/card-thumbnail-placeholder.png",this.title=e.hFB.required(),this.subtitle=(0,e.hFB)(),this.metadata=(0,e.hFB)(),this.image=(0,e.hFB)(),this.featuredIcon=(0,e.hFB)(),this.colorOnHover=(0,e.hFB)(!1),this.routerLink=(0,e.hFB)(),this.queryParams=(0,e.hFB)(),this.innerColor=(0,e.hFB)(),this.outerColor=(0,e.hFB)(),this.foreground=(0,e.hFB)("white"),this.gradientColor=(0,e.EWP)(()=>`radial-gradient(${this.innerColor()}, ${this.outerColor()})`),(0,e.QZP)(()=>{this.colorOnHover()?this.removeColorFromCard():this.applyColorToCard()})}onMouseEnter(){this.colorOnHover()&&this.applyColorToCard()}onMouseLeave(){this.colorOnHover()&&this.removeColorFromCard()}applyColorToCard(){this.featuredCardElement.nativeElement.style.setProperty("--background",this.gradientColor()),this.featuredCardElement.nativeElement.style.setProperty("--foreground",this.foreground()),this.colorOnHover()&&this.featuredCardElement.nativeElement.style.setProperty("--border",this.outerColor())}removeColorFromCard(){this.featuredCardElement.nativeElement.style.setProperty("--background","white"),this.featuredCardElement.nativeElement.style.setProperty("--foreground","#1c2a3f"),this.colorOnHover()&&this.featuredCardElement.nativeElement.style.setProperty("--border","#d7e0ea")}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-featured-card"]],viewQuery:function(i,s){if(1&i&&e.GBs(qk,7),2&i){let r;e.mGM(r=e.lsd())&&(s.featuredCardElement=r.first)}},inputs:{title:[e.Mj6.SignalBased,"title"],subtitle:[e.Mj6.SignalBased,"subtitle"],metadata:[e.Mj6.SignalBased,"metadata"],image:[e.Mj6.SignalBased,"image"],featuredIcon:[e.Mj6.SignalBased,"featuredIcon"],colorOnHover:[e.Mj6.SignalBased,"colorOnHover"],routerLink:[e.Mj6.SignalBased,"routerLink"],queryParams:[e.Mj6.SignalBased,"queryParams"],innerColor:[e.Mj6.SignalBased,"innerColor"],outerColor:[e.Mj6.SignalBased,"outerColor"],foreground:[e.Mj6.SignalBased,"foreground"]},standalone:!0,features:[e.aNF],decls:12,vars:8,consts:[["featuredCard",""],[1,"@container","featured-card"],[1,"flex","w-full","rounded-lg","cursor-pointer","h-24","@xs:h-48",3,"mouseenter","mouseleave","routerLink","queryParams"],[1,"rounded-l-lg","hidden","@lg:block","h-48","w-48",3,"defaultImage","lazyLoad"],[1,"flex","flex-col","justify-between","h-full","w-full","p-4","@xs:p-8"],[1,"text-xs","@xs:text-lg","font-semibold"],[1,"flex","gap-3"],[1,"flex","flex-col","flex-grow","gap-2"],[1,"text-2xs","@xs:text-sm","font-normal","@xs:font-semibold"],[1,"hidden","@xs:block","text-2xs","@xs:text-sm","font-normal"],[1,"rounded","bg-white","min-w-8","min-h-8","w-8","h-8","items-center","justify-center","justify-self-end","self-end","hidden","@xs:flex"],[3,"lazyLoad"]],template:function(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",1,0)(2,"a",2),e.bIt("mouseenter",function(){return e.eBV(r),e.Njj(s.onMouseEnter())})("mouseleave",function(){return e.eBV(r),e.Njj(s.onMouseLeave())}),e.nrm(3,"img",3),e.j41(4,"div",4)(5,"h1",5),e.EFF(6),e.k0s(),e.j41(7,"div",6)(8,"div",7),e.DNE(9,Zk,2,1,"div",8)(10,eL,2,1,"div",9),e.k0s(),e.DNE(11,tL,2,1,"figure",10),e.k0s()()()()}2&i&&(e.R7$(2),e.Y8G("routerLink",s.routerLink())("queryParams",s.queryParams()),e.R7$(),e.Y8G("defaultImage",s.defaultImage)("lazyLoad",s.image()),e.R7$(3),e.SpI(" ",s.title()," "),e.R7$(3),e.vxM(9,s.subtitle()?9:-1),e.R7$(),e.vxM(10,s.metadata()?10:-1),e.R7$(),e.vxM(11,s.featuredIcon()?11:-1))},dependencies:[q.MD,ne.iI,ne.Wk,is.Un,is.Je],styles:[".featured-card[_ngcontent-%COMP%]{--background: white;--foreground: #1c2a3f;--border: transparent}.featured-card[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{background:var(--background);color:var(--foreground);outline:1px solid var(--border)!important}"],changeDetection:0}),t})(),iL=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([wt]),is.Un,ne.iI,Oi.C,q.MD,we.X1,kd,Ql.h,Sg.H,It.G,ey.f,Yl.M,Nt.G,hS.g7,Qk,py,nL]}),t})();e.wjB(ay,function(){return[bi.Q,Zc.L,yt.R,bg]},[]);let uy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,ne.iI,Nt.G]}),t})(),jd=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([Jo.U]),q.MD]}),t})(),gy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[Nt.G,It.G,q.MD,ne.iI,ey.f,Zb,we.X1,kd,iL,uy,jd,l.rK.forFeature([gn])]}),t})();var yg=_(82192);let vg=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([Ue.j]),q.MD,yi.o,we.X1]}),t})(),Eg=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([rt,fe.N,Ze,to.K,Pr]),q.MD,Nt.G,It.G,yg.G,Ud,we.X1,pi.y2.forChild(),vg]}),t})(),Cg=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([Ln])]}),t})();var oL=_(43631);let Tg=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([oL._,Xe.S,fi.x,Mn.z,Ei,Go.B]),q.MD,Ql.h,It.G,we.YN,we.X1,Eg,Nt.G,yg.G,Cg,qa]}),t})(),sL=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,iy,l.rK.forFeature([et])]}),t})(),hy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),Og=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,we.YN,we.X1,od.D]}),t})(),my=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1,Og]}),t})(),fy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),Sy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),by=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),yy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),vy=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),Ey=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})();var Eo;function aL(n,t){if(1&n&&(e.j41(0,"button",7),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.settings.miscText," ")}}function lL(n,t){if(1&n&&(e.j41(0,"button",8),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.Y8G("mat-dialog-close",!1),e.R7$(),e.SpI(" ",o.settings.cancelText," ")}}function cL(n,t){if(1&n&&(e.j41(0,"button",9),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.Y8G("mat-dialog-close",!0),e.R7$(),e.SpI(" ",o.settings.confirmText," ")}}!function(n){n.OpenLimit=(()=>{class f{constructor(){}}return f.type="[Dialog] Open Limit",f})(),n.CloseLimit=(()=>{class f{constructor(L){this.upgrade=L}}return f.type="[Dialog] Close Limit",f})(),n.OpenPremiumContent=(()=>{class f{constructor(){}}return f.type="[Dialog] Open Premium Content",f})(),n.ClosePremiumContent=(()=>{class f{constructor(L){this.confirmed=L}}return f.type="[Dialog] Close Premium Content",f})(),n.OpenUpgrade=(()=>{class f{constructor(){}}return f.type="[Dialog] Open Upgrade",f})(),n.CloseUpgrade=(()=>{class f{constructor(){}}return f.type="[Dialog] Close Upgrade",f})()}(Eo||(Eo={}));let dL=(()=>{var n;class t{constructor(i,s){this.dialogRef=i,this.data=s,this.settings={titleText:"Confirm Action",bodyText:"",confirmText:"Confirm",confirmColor:"primary",cancelText:"Cancel",confirmEnabled:!0,cancelEnabled:!0,miscText:""},s&&(this.settings={...this.settings,...s})}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(Dt.Vh))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-confirm-dialog"]],decls:9,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"text-sm"],["mat-dialog-actions",""],["app-button","","buttonTheme","light",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close",4,"ngIf"],["app-button","","buttonTheme","light",3,"mat-dialog-close"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(i,s){1&i&&(e.j41(0,"h1",0),e.EFF(1),e.k0s(),e.j41(2,"div",1)(3,"div",2),e.EFF(4),e.k0s()(),e.j41(5,"div",3),e.DNE(6,aL,2,1,"button",4)(7,lL,2,2,"button",5)(8,cL,2,2,"button",6),e.k0s()),2&i&&(e.R7$(),e.JRh(s.settings.titleText),e.R7$(3),e.JRh(s.settings.bodyText),e.R7$(2),e.Y8G("ngIf",s.settings.miscText),e.R7$(),e.Y8G("ngIf",s.settings.cancelEnabled),e.R7$(),e.Y8G("ngIf",s.settings.confirmEnabled))},dependencies:[q.bT,Dt.tx,Dt.BI,Dt.E7,Dt.Yi,bi.Q],styles:["[_nghost-%COMP%]{display:block}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;width:100%}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}@media (min-width: 480px){[_nghost-%COMP%]{min-width:320px}}"],changeDetection:0}),t})();const _L=["modalContents"];let Cy=(()=>{var n;class t{constructor(i,s,r,a,d,f){this.dialogRef=i,this.data=s,this.sanitizer=r,this.renderer=a,this.vendorAnalyticsService=d,this.productService=f}onMessage(i){switch(i.data.action){case"close":this.dialogRef.close(i.data);break;case"track":this.vendorAnalyticsService.track(i.data.label,{...i.data.metadata,platform:this.productService.productType})}}ngOnInit(){this.title=this.data.title,this.url=this.data.url?this.sanitizer.bypassSecurityTrustResourceUrl(this.data.url):"",this.renderer.setStyle(this.modalContents.nativeElement,"background-color",this.data.backgroundColor||"#ffffff")}closeDialog(){this.dialogRef.close()}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(Dt.Vh),e.rXU(c.up),e.rXU(e.sFG),e.rXU(qe),e.rXU(je))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-iframe-dialog"]],viewQuery:function(i,s){if(1&i&&e.GBs(_L,7),2&i){let r;e.mGM(r=e.lsd())&&(s.modalContents=r.first)}},hostBindings:function(i,s){1&i&&e.bIt("message",function(a){return s.onMessage(a)},!1,e.tSv)},decls:6,vars:3,consts:[["modalContents",""],["role","dialog","aria-modal","true",1,"modal"],[1,"modal__contents"],["cdkFocusInitial","",1,"modal__frame",3,"src"],["app-button","","buttonTheme","dark","buttonType","white","buttonShape","circle","type","button","title","Close",1,"modal__close",3,"click"],["icon","times","size","lg"]],template:function(i,s){if(1&i){const r=e.RV6();e.j41(0,"div",1)(1,"div",2,0),e.nrm(3,"iframe",3),e.k0s(),e.j41(4,"button",4),e.bIt("click",function(){return e.eBV(r),e.Njj(s.closeDialog())}),e.nrm(5,"app-icon",5),e.k0s()()}2&i&&(e.BMQ("aria-label",s.title),e.R7$(3),e.Y8G("src",s.url,e.f$h),e.R7$(),e.BMQ("aria-label","Close"))},dependencies:[yt.R,bi.Q],styles:[".modal[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative}.modal__close[_ngcontent-%COMP%]{margin-bottom:4px;align-self:flex-end;cursor:pointer;position:absolute;right:12px;top:12px}.modal__contents[_ngcontent-%COMP%]{flex-grow:1}.modal__frame[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0}),t})();var Vd=function(n){return n.PersonalUse="Personal Use",n.Education="Education",n.Business="Business",n}(Vd||{});let Ty=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Users] Join Organization",t})(),pL=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Users] Join Organization Success",t})(),uL=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Users] Join Organization Fail",t})(),Oy=(()=>{class t{constructor(i){this.code=i}}return t.type="[Users] Join Organization With Code",t})(),My=(()=>{class t{constructor(i){this.organizationName=i}}return t.type="[Users] Join Organization With Code Success",t})(),gL=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Join Organization With Code Fail",t})(),Iy=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Users] Leave Organization",t})(),hL=(()=>{class t{constructor(i){this.organization=i}}return t.type="[Users] Leave Organization Success",t})(),mL=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Leave Organization Fail",t})(),xd=(()=>{class t{constructor(i,s){this.groupEID=i,this.invites=s}}return t.type="[Users] Send Organization Invite",t})(),wy=(()=>{class t{constructor(i){this.responses=i}}return t.type="[Users] Send Organization Invite Success",t})(),Py=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Send Organization Invite Fail",t})(),Ay=(()=>{class t{constructor(i){this.groupId=i}}return t.type="[Users] Get Organization Users",t})(),Mg=(()=>{class t{constructor(i){this.users=i}}return t.type="[Users] Get Organization Users Success",t})(),fL=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Get Organization Users Fail",t})(),Ny=(()=>{class t{constructor(i){this.groupId=i}}return t.type="[Users] Get Organization Invited Users",t})(),Ig=(()=>{class t{constructor(i){this.invites=i}}return t.type="[Users] Get Organization Invited Users Success",t})(),SL=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Get Organization Invited Users Fail",t})(),bL=(()=>{class t{}return t.type="[Users] Reset",t})(),Ry=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Update User Roles",t})(),yL=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Update User Roles Success",t})(),vL=(()=>{class t{}return t.type="[Users] Update User Roles Fail",t})(),Dy=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Remove Organization User",t})(),EL=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Remove Organization User Success",t})(),CL=(()=>{class t{}return t.type="[Users] Remove Organization User Fail",t})(),ky=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Transfer Organization Content",t})(),TL=(()=>{class t{constructor(i,s){this.groupId=i,this.users=s}}return t.type="[Users] Transfer Organization Content Success",t})(),OL=(()=>{class t{}return t.type="[Users] Transfer Organization Content Fail",t})(),wg=(()=>{class t{constructor(i){this.params=i}}return t.type="[Users] Get Eligible Join Organizations",t})(),Fd=(()=>{class t{constructor(i){this.eligibleOrganizations=i}}return t.type="[Users] Get Eligible Join Organizations Success",t})(),ML=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Get Eligible Join Organizations Error",t})(),Pg=(()=>{class t{}return t.type="[Users] Clear Eligible Join Organizations",t})(),Jl=(()=>{class t{constructor(i){this.params=i}}return t.type="[Users] Get Join Requests",t})(),Gd=(()=>{class t{constructor(i){this.joinRequests=i}}return t.type="[Users] Get Join Requests Success",t})(),Ag=(()=>{class t{constructor(i,s){this.organizationId=i,this.description=s}}return t.type="[Users] Post Join Request",t})(),IL=(()=>{class t{constructor(i){this.joinRequestKey=i}}return t.type="[Users] Post Join Request Success",t})(),Ly=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Post Join Request Error",t})(),Ng=(()=>{class t{constructor(i){this.joinRequestKey=i}}return t.type="[Users] Delete Join Request",t})(),Uy=(()=>{class t{}return t.type="[Users] Delete Join Request Success",t})(),jy=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Delete Join Request Error",t})(),Vy=(()=>{class t{constructor(i){this.params=i}}return t.type="[Users] Get Organization Join Requests",t})(),Rg=(()=>{class t{constructor(i){this.organizationJoinRequests=i}}return t.type="[Users] Get Organization Join Requests Success",t})(),wL=(()=>{class t{constructor(i){this.error=i}}return t.type="[Users] Get Organization Join Requests Error",t})(),xy=(()=>{class t{constructor(i){this.joinRequests=i}}return t.type="[Users] Accept Join Requests",t})(),PL=(()=>{class t{constructor(i){this.count=i}}return t.type="[Users] Accept Join Requests Success",t})(),AL=(()=>{class t{constructor(i,s){this.count=i,this.error=s}}return t.type="[Users] Accept Join Requests Error",t})(),Fy=(()=>{class t{constructor(i){this.joinRequestKeys=i}}return t.type="[Users] Deny Join Requests",t})(),NL=(()=>{class t{constructor(i){this.count=i}}return t.type="[Users] Deny Join Requests Success",t})(),RL=(()=>{class t{constructor(i,s){this.count=i,this.error=s}}return t.type="[Users] Deny Join Requests Error",t})();var DL=_(7974),kL=_(63831),LL=_(26727);const Dg="/ws/organization/join/requests",$d="/ws/user/join/requests",kg="/ws/organization/user",Lg="/ws/organization/users";let $y=(()=>{var n;class t{constructor(i,s){this.http=i,this.productService=s}getOrganizationJoinRequests(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new w.Nl({fromObject:{...s}});return this.http.get(Dg,{params:r})}acceptOrganizationJoinRequests(i){return this.batchRequest(i,r=>this.http.post(Dg,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_accept:r}))}denyOrganizationJoinRequests(i){return this.batchRequest(i,r=>this.http.post(Dg,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_deny:r}))}getEligibleJoinOrganizations(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new w.Nl({fromObject:{...s}});return this.http.get(`${$d}/eligibility`,{params:r})}getJoinRequests(i){const s={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...i},r=new w.Nl({fromObject:{...s}});return this.http.get($d,{params:r})}postJoinRequest(i,s){return this.http.post($d,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,organization_id:i,request_desc:s})}deleteJoinRequest(i){return this.http.request("delete",$d,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_request_key:i}})}getOrganizationUsers(i){const s=De(i);return this.http.get(`${Lg}${s}`).pipe((0,le.T)(r=>r.users),(0,le.T)(r=>r.map(a=>({...a,user_role:va(a.user_role)}))))}getOrganizationInvites(i){const s=De(i);return this.http.get(`/ws/organization/invite${s}`).pipe((0,le.T)(r=>r.invites),(0,le.T)(r=>r.map(a=>({...a,invite_user:{...a.inviter_user,user_role:va(a.inviter_user.user_role)},invitee_user:{...a.invitee_user,user_role:va(a.invitee_user.user_role)}}))))}sendOrganizationInvites(i,s,r){return this.http.post("/ws/organization/invite",{version:2,group_eid:i,invite_emails:s,site_verify_response:r}).pipe((0,le.T)(a=>{const{messages:d}=a.results_summary;return d}))}addUserToOrganization(i){return this.http.post(`${kg}/add`,{group_eid:i})}addUserWithGroupCode(i){return this.http.post(`${kg}/add`,{group_code:i}).pipe((0,le.T)(s=>s.organization_name))}updateUserRoles(i,s){return this.batchRequest(s,a=>this.http.post(Lg,{group_id:i,update_users:a.map(d=>({user_id:d.userId,role_id:d.roleId}))}))}removeUser(i){return this.http.post(`${kg}/leave`,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:i})}removeUsers(i,s){return this.batchRequest(s,a=>this.http.post(Lg,{group_id:i,remove_users:a.map(d=>this.createTransferRequest(d))}))}transferUserContent(i,s){return this.batchRequest(s,a=>this.http.post("/ws/organization/bookmark/transfer",{group_id:i,transfer_bookmarks:a.map(d=>this.createTransferRequest(d))}))}createUserDisplayModel(i,s,r){return{name:this.formatUserName(i),initials:this.formatBadgeLabel(i),email:i.user_email,id:i.user_id,role:i.user_role,activeDeveloper:this.hasActiveDeveloperAccount(i),selected:!1,invitationStatus:s,joinRequestKey:r}}isUserModel(i){return["developer_account","developer_account_active","developer_has_apps"].every(r=>i.hasOwnProperty(r))}hasActiveDeveloperAccount(i){return!!this.isUserModel(i)&&i.developer_account&&i.developer_account_active&&i.developer_has_apps}batchRequest(i,s){let r=0;const a=[];for(;r<i.length;){const f=i.slice(r,r+50);a.push(s(f)),r+=50}const d=(0,DL.c)(a,kL.T).pipe((0,LL.K)());return(0,si.p)(d).pipe((0,le.T)(()=>!0))}createTransferRequest(i){const{sourceUserId:s,targetUserId:r}=i;return"number"==typeof r?{user_id:s,group_bookmarks:{transfer_ownership:1,transfer_user_id:r}}:{user_id:s}}formatUserName(i){const{user_first_name:s,user_last_name:r}=i,a=[s,r].filter(d=>!!d);return a.length>0?a.join(" "):""}formatBadgeLabel(i){const{user_first_name:s,user_last_name:r}=i;return[s,r].filter(d=>!!d).map(d=>d[0]).join("")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(je))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();class oi{}var ms,jg,Ug=function(n){return n.Pending="pending",n.Accepted="accepted",n.Denied="denied",n.Expired="expired",n}(Ug||{}),Ut=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Me=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const By={joining:!1,leaving:!1,inviting:!1,loadingUsers:!1,loadingInvites:!1,loadingOrganizationJoinRequests:!1,loadingJoinRequests:!1,loadingEligibleOrganizations:!1,postingJoinRequest:!1,deletingJoinRequest:!1,users:[],invites:[],joinRequests:[],organizationJoinRequests:[]};let Ot=(ms=class{static getUsers(t){return t.users}static getInvites(t){return t.invites}static getUsersLoading(t){return t.loadingUsers}static getJoining(t){return t.joining}static getLeaving(t){return t.leaving}static getInviting(t){return t.inviting}static getLoadingJoinRequests(t){return t.loadingJoinRequests}static getLoadingOrganizationJoinRequests(t){return t.organizationJoinRequests}static getLoadingEligibleOrganizations(t){return t.loadingEligibleOrganizations}static getPostingJoinRequest(t){return t.postingJoinRequest}static getDeletingJoinRequest(t){return t.deletingJoinRequest}static getRequesting(t){return t.loadingJoinRequests||t.loadingEligibleOrganizations||t.postingJoinRequest||t.deletingJoinRequest}static getEligibleOrganizations(t){return t.eligibleOrganizations}static hasEligibleOrganizations(t){return Array.isArray(t.eligibleOrganizations)&&t.eligibleOrganizations.length>0}static getJoinRequests(t){return t.joinRequests}static getPendingJoinRequest(t){return t.joinRequests?.find(o=>o.request_status===Ug.Pending)}static getOrganizationJoinRequests(t){return t.organizationJoinRequests}static getPendingOrganizationJoinRequests(t){return t.organizationJoinRequests.filter(o=>o.request_status===Ug.Pending)}joinOrganization(t,{organization:o}){t.patchState({joining:!0}),this.usersService.addUserToOrganization(o.eid).pipe((0,bt.j)(()=>t.patchState({joining:!1}))).subscribe(()=>t.dispatch(new pL(o)),()=>t.dispatch(new uL(o)))}joinOrganizationWithCode(t,{code:o}){t.patchState({joining:!0}),this.usersService.addUserWithGroupCode(o).pipe((0,bt.j)(()=>t.patchState({joining:!1}))).subscribe(i=>t.dispatch(new My(i)),i=>t.dispatch(new gL(i)))}joinOrganizationWithCodeSuccess(){this.vendorAnalyticsService.track("Account Upgrade - Free Individual to Team")}leaveOrganization(t,{organization:o}){t.patchState({leaving:!0}),this.usersService.removeUser(o.id).pipe((0,bt.j)(()=>t.patchState({leaving:!1}))).subscribe({next:()=>t.dispatch(new hL(o)),error:i=>t.dispatch(new mL(i))})}sendOrganizationInvite(t,{groupEID:o,invites:i}){t.patchState({inviting:!0}),this.authService.verifyIsHuman("invites","",!0).pipe((0,Cn.Z)(({isHuman:s,verification:r})=>{if(!s)throw new lo;return this.usersService.sendOrganizationInvites(o,i,r)}),(0,bt.j)(()=>t.patchState({inviting:!1}))).subscribe({next:s=>{t.dispatch(new wy(s))},error:s=>{s instanceof lo&&t.dispatch(new ur(s)),t.dispatch(new Py(s))}})}getOrganizationUsers(t,{groupId:o}){t.patchState({loadingUsers:!0}),this.usersService.getOrganizationUsers({group_id:o}).pipe((0,bt.j)(()=>t.patchState({loadingUsers:!1}))).subscribe(i=>t.dispatch(new Mg(i)),i=>t.dispatch(new fL(i)))}getOrganizationUsersSuccess(t,{users:o}){t.patchState({users:o})}getOrganizationUserInvites(t,{groupId:o}){t.patchState({loadingInvites:!0}),this.usersService.getOrganizationInvites({group_id:o,version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}).pipe((0,bt.j)(()=>t.patchState({loadingInvites:!1}))).subscribe(i=>t.dispatch(new Ig(i)),i=>t.dispatch(new SL(i)))}getOrganizationUserInvitesSuccess(t,{invites:o}){t.patchState({invites:o})}resetOrganizations(t){t.setState(By)}updateUserRoles(t,{groupId:o,users:i}){this.usersService.updateUserRoles(o,i).subscribe(()=>t.dispatch(new yL(o,i)),()=>t.dispatch(new vL))}removeOrganizationUser(t,{groupId:o,users:i}){this.usersService.removeUsers(o,i).subscribe(()=>t.dispatch(new EL(o,i)),()=>t.dispatch(new CL))}transferOrganizationContent(t,{groupId:o,users:i}){this.usersService.transferUserContent(o,i).subscribe(()=>t.dispatch(new TL(o,i)),()=>t.dispatch(new OL))}clearEligibleJoinOrganizations(t,o){t.patchState({eligibleOrganizations:[]})}getEligibleJoinOrganizations(t,o){t.patchState({loadingEligibleOrganizations:!0}),this.usersService.getEligibleJoinOrganizations(o.params).pipe((0,bt.j)(()=>t.patchState({loadingEligibleOrganizations:!1}))).subscribe({next:i=>{t.dispatch(new Fd(i.eligible_orgs))},error:i=>t.dispatch(new ML(i))})}getEligibleJoinOrganizationsSuccess(t,{eligibleOrganizations:o}){t.patchState({eligibleOrganizations:o})}getJoinRequests(t,o){t.patchState({loadingJoinRequests:!0}),this.usersService.getJoinRequests(o.params).pipe((0,bt.j)(()=>t.patchState({loadingJoinRequests:!1}))).subscribe(i=>{t.dispatch(new Gd(i.join_requests))})}getJoinRequestsSuccess(t,{joinRequests:o}){t.patchState({joinRequests:o}),jg.getPendingJoinRequest(t.getState())&&t.dispatch(new Pg)}postJoinRequest(t,o){t.patchState({postingJoinRequest:!0}),this.usersService.postJoinRequest(o.organizationId,o.description).pipe((0,bt.j)(()=>t.patchState({postingJoinRequest:!1}))).subscribe({next:i=>{t.dispatch(new IL(i.join_request_key)),t.dispatch(new Jl)},error:i=>t.dispatch(new Ly(i))})}deleteJoinRequest(t,o){t.patchState({deletingJoinRequest:!0}),this.usersService.deleteJoinRequest(o.joinRequestKey).pipe((0,bt.j)(()=>t.patchState({deletingJoinRequest:!1}))).subscribe({next:()=>{t.dispatch(new Uy),t.dispatch(new Jl)},error:i=>t.dispatch(new jy(i))})}getOrganizationJoinRequests(t,o){t.patchState({loadingOrganizationJoinRequests:!0}),this.usersService.getOrganizationJoinRequests(o.params).pipe((0,bt.j)(()=>t.patchState({loadingOrganizationJoinRequests:!1}))).subscribe({next:i=>{t.dispatch(new Rg(i.join_requests))},error:i=>t.dispatch(new wL(i))})}getOrganizationJoinRequestsSuccess(t,{organizationJoinRequests:o}){t.patchState({organizationJoinRequests:o})}acceptJoinRequests(t,o){const i=o.joinRequests.length;this.usersService.acceptOrganizationJoinRequests(o.joinRequests).subscribe({next:()=>{t.dispatch(new PL(i))},error:s=>t.dispatch(new AL(i,s))})}denyJoinRequests(t,o){const i=o.joinRequestKeys.length;this.usersService.denyOrganizationJoinRequests(o.joinRequestKeys).subscribe({next:()=>{t.dispatch(new NL(i))},error:s=>t.dispatch(new RL(i,s))})}constructor(t,o,i,s){this.usersService=t,this.vendorAnalyticsService=o,this.productService=i,this.authService=s}},jg=ms,ms.\u0275fac=function(t){return new(t||ms)(e.KVO($y),e.KVO(qe),e.KVO(je),e.KVO(hr))},ms.\u0275prov=e.jDH({token:ms,factory:ms.\u0275fac}),ms);function zy(n){return t=>{const o=ro.l.parseEmails(t.value),i=o.filter(d=>!ro.l.validateEmail(d)),s=o.length,r="number"==typeof n&&s>n;let a={};return r&&(a={...a,maxEmailsExceeded:r,currentEmailCount:s}),i.length>0&&(a={...a,invalidEmails:i}),Object.keys(a).length>0?(0,Rt.of)(a):(0,Rt.of)(null)}}Ut([(0,l.rc)(Ty),Me("design:type",Function),Me("design:paramtypes",[Object,Ty]),Me("design:returntype",void 0)],Ot.prototype,"joinOrganization",null),Ut([(0,l.rc)(Oy),Me("design:type",Function),Me("design:paramtypes",[Object,Oy]),Me("design:returntype",void 0)],Ot.prototype,"joinOrganizationWithCode",null),Ut([(0,l.rc)(My),Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",void 0)],Ot.prototype,"joinOrganizationWithCodeSuccess",null),Ut([(0,l.rc)(Iy),Me("design:type",Function),Me("design:paramtypes",[Object,Iy]),Me("design:returntype",void 0)],Ot.prototype,"leaveOrganization",null),Ut([(0,l.rc)(xd),Me("design:type",Function),Me("design:paramtypes",[Object,xd]),Me("design:returntype",void 0)],Ot.prototype,"sendOrganizationInvite",null),Ut([(0,l.rc)(Ay),Me("design:type",Function),Me("design:paramtypes",[Object,Ay]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationUsers",null),Ut([(0,l.rc)(Mg),Me("design:type",Function),Me("design:paramtypes",[Object,Mg]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationUsersSuccess",null),Ut([(0,l.rc)(Ny),Me("design:type",Function),Me("design:paramtypes",[Object,Ny]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationUserInvites",null),Ut([(0,l.rc)(Ig),Me("design:type",Function),Me("design:paramtypes",[Object,Ig]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationUserInvitesSuccess",null),Ut([(0,l.rc)(bL),Me("design:type",Function),Me("design:paramtypes",[Object]),Me("design:returntype",void 0)],Ot.prototype,"resetOrganizations",null),Ut([(0,l.rc)(Ry),Me("design:type",Function),Me("design:paramtypes",[Object,Ry]),Me("design:returntype",void 0)],Ot.prototype,"updateUserRoles",null),Ut([(0,l.rc)(Dy),Me("design:type",Function),Me("design:paramtypes",[Object,Dy]),Me("design:returntype",void 0)],Ot.prototype,"removeOrganizationUser",null),Ut([(0,l.rc)(ky),Me("design:type",Function),Me("design:paramtypes",[Object,ky]),Me("design:returntype",void 0)],Ot.prototype,"transferOrganizationContent",null),Ut([(0,l.rc)(Pg),Me("design:type",Function),Me("design:paramtypes",[Object,Pg]),Me("design:returntype",void 0)],Ot.prototype,"clearEligibleJoinOrganizations",null),Ut([(0,l.rc)(wg),Me("design:type",Function),Me("design:paramtypes",[Object,wg]),Me("design:returntype",void 0)],Ot.prototype,"getEligibleJoinOrganizations",null),Ut([(0,l.rc)(Fd),Me("design:type",Function),Me("design:paramtypes",[Object,Fd]),Me("design:returntype",void 0)],Ot.prototype,"getEligibleJoinOrganizationsSuccess",null),Ut([(0,l.rc)(Jl),Me("design:type",Function),Me("design:paramtypes",[Object,Jl]),Me("design:returntype",void 0)],Ot.prototype,"getJoinRequests",null),Ut([(0,l.rc)(Gd),Me("design:type",Function),Me("design:paramtypes",[Object,Gd]),Me("design:returntype",void 0)],Ot.prototype,"getJoinRequestsSuccess",null),Ut([(0,l.rc)(Ag),Me("design:type",Function),Me("design:paramtypes",[Object,Ag]),Me("design:returntype",void 0)],Ot.prototype,"postJoinRequest",null),Ut([(0,l.rc)(Ng),Me("design:type",Function),Me("design:paramtypes",[Object,Ng]),Me("design:returntype",void 0)],Ot.prototype,"deleteJoinRequest",null),Ut([(0,l.rc)(Vy),Me("design:type",Function),Me("design:paramtypes",[Object,Vy]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationJoinRequests",null),Ut([(0,l.rc)(Rg),Me("design:type",Function),Me("design:paramtypes",[Object,Rg]),Me("design:returntype",void 0)],Ot.prototype,"getOrganizationJoinRequestsSuccess",null),Ut([(0,l.rc)(xy),Me("design:type",Function),Me("design:paramtypes",[Object,xy]),Me("design:returntype",void 0)],Ot.prototype,"acceptJoinRequests",null),Ut([(0,l.rc)(Fy),Me("design:type",Function),Me("design:paramtypes",[Object,Fy]),Me("design:returntype",void 0)],Ot.prototype,"denyJoinRequests",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getUsers",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getInvites",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getUsersLoading",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getJoining",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getLeaving",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getInviting",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getLoadingJoinRequests",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getLoadingOrganizationJoinRequests",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getLoadingEligibleOrganizations",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getPostingJoinRequest",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getDeletingJoinRequest",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getRequesting",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getEligibleOrganizations",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"hasEligibleOrganizations",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getJoinRequests",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getPendingJoinRequest",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getOrganizationJoinRequests",null),Ut([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[oi]),Me("design:returntype",void 0)],Ot,"getPendingOrganizationJoinRequests",null),Ot=jg=Ut([(0,l.Uw)({name:"users",defaults:By}),Me("design:paramtypes",[$y,qe,je,hr])],Ot);var ql,Zl,ec,Wy=_(53719),Xy=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Hy=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};function jL(n,t){if(1&n&&(e.j41(0,"div",10)(1,"app-message-toggle",11),e.EFF(2),e.k0s()()),2&n){const o=e.XpG(2);e.R7$(2),e.SpI(" ",o.sentResponses.length," invite(s) have been sent. Please allow up to a few minutes for invitees to receive their invitations. ")}}function VL(n,t){if(1&n&&(e.qex(0),e.DNE(1,jL,3,1,"div",9),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("ngIf",o.sentResponses.length>0)}}function xL(n,t){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const o=t.$implicit;e.R7$(),e.SpI(" ",o," ")}}function FL(n,t){if(1&n&&(e.j41(0,"div",19)(1,"app-message-toggle",20)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,xL,2,1,"div",21),e.k0s()()),2&n){const o=e.XpG(3);e.R7$(3),e.SpI("There was an error sending ",o.errorResponses.length," invite(s)."),e.R7$(),e.Y8G("ngForOf",o.formatResponses(o.errorResponses))}}function GL(n,t){if(1&n&&(e.j41(0,"div",19)(1,"app-message-toggle",20),e.EFF(2),e.k0s()()),2&n){const o=e.XpG(3);e.R7$(2),e.SpI(" ",o.errorMessage," ")}}function $L(n,t){if(1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.R7$(2),e.Lme(" Please limit your entry to ",i.maxEmailCount,". Current count: ",null==o.errors?null:o.errors.currentEmailCount,". ")}}function BL(n,t){if(1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.R7$(2),e.Lme(" ",i.formatEmails(null==o.errors?null:o.errors.invalidEmails)," ",1===o.errors.invalidEmails.length?"is not a valid email address.":"are not valid email addresses."," ")}}function zL(n,t){if(1&n&&(e.j41(0,"option",27),e.EFF(1),e.k0s()),2&n){const o=t.$implicit;e.Y8G("value",o.role_id),e.R7$(),e.SpI(" ",o.role_display_name," ")}}function WL(n,t){1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2," Please select a valid role. "),e.k0s()())}function XL(n,t){if(1&n&&(e.j41(0,"app-form-field",23)(1,"select",24)(2,"option",25),e.EFF(3,"--"),e.k0s(),e.DNE(4,zL,2,2,"option",26),e.k0s(),e.DNE(5,WL,3,0,"div",17),e.k0s()),2&n){const o=t.$implicit,i=e.XpG(3);e.R7$(4),e.Y8G("ngForOf",i.availableRoles),e.R7$(),e.Y8G("ngIf",o.touched&&o.invalid)}}function HL(n,t){if(1&n&&(e.qex(0,13),e.DNE(1,FL,5,2,"div",14)(2,GL,3,1,"div",14),e.j41(3,"app-form-field",15)(4,"textarea",16),e.EFF(5,"          "),e.k0s(),e.DNE(6,$L,3,2,"div",17)(7,BL,3,2,"div",17),e.k0s(),e.DNE(8,XL,6,2,"app-form-field",18),e.bVm()),2&n){const o=t.$implicit,i=e.XpG(2);e.Y8G("formGroup",i.form),e.R7$(),e.Y8G("ngIf",i.errorResponses.length>0),e.R7$(),e.Y8G("ngIf",i.errorMessage),e.R7$(2),e.Y8G("placeholder","Enter up to "+i.maxEmailCount+" email addresses separated by commas or line breaks"),e.R7$(2),e.Y8G("ngIf",null==o.errors?null:o.errors.maxEmailsExceeded),e.R7$(),e.Y8G("ngIf",null==o.errors?null:o.errors.invalidEmails),e.R7$(),e.Y8G("ngIf",i.form.get("roleId"))}}function QL(n,t){if(1&n&&e.DNE(0,HL,9,7,"ng-container",12),2&n){const o=e.XpG();e.Y8G("ngIf",o.form.get("emails"))}}function YL(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleCancelClick())}),e.EFF(1),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("uppercase","inline"===o.layout),e.R7$(),e.SpI(" ",o.cancelText," ")}}function KL(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",30),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleInviteClick())}),e.EFF(2),e.k0s()}if(2&n){const o=e.XpG(2);e.Y8G("uppercase","inline"===o.layout)("disabled",o.form.invalid||e.bMT(1,3,o.inviting$)),e.R7$(2),e.SpI(" ",o.errorResponses.length>0?"Try Again":o.sendText," ")}}function JL(n,t){1&n&&e.eu8(0)}function qL(n,t){1&n&&e.eu8(0)}function ZL(n,t){if(1&n&&(e.qex(0),e.DNE(1,JL,1,0,"ng-container",31)(2,qL,1,0,"ng-container",31),e.bVm()),2&n){e.XpG();const o=e.sdS(3),i=e.sdS(5);e.R7$(),e.Y8G("ngTemplateOutlet",o),e.R7$(),e.Y8G("ngTemplateOutlet",i)}}function eU(n,t){1&n&&e.eu8(0)}function tU(n,t){1&n&&e.eu8(0)}function nU(n,t){if(1&n&&e.DNE(0,eU,1,0,"ng-container",31)(1,tU,1,0,"ng-container",31),2&n){e.XpG();const o=e.sdS(3),i=e.sdS(5);e.Y8G("ngTemplateOutlet",i),e.R7$(),e.Y8G("ngTemplateOutlet",o)}}function iU(n,t){if(1&n&&(e.j41(0,"div")(1,"div",28),e.DNE(2,YL,2,2,"ng-template",null,1,e.C5r)(4,KL,3,5,"ng-template",null,2,e.C5r)(6,ZL,3,2,"ng-container",6)(7,nU,2,2,"ng-template",null,3,e.C5r),e.k0s()()),2&n){const o=e.sdS(8),i=e.XpG();e.R7$(6),e.Y8G("ngIf","inline"===i.layout)("ngIfElse",o)}}class Bd{get valid(){return this.form.valid}constructor(t,o,i,s){this.store=t,this.actions=o,this.formBuilder=i,this.changeRef=s,this.maxEmailCount=50,this.availableRoles=[],this.layout="inline",this.enableActions=!0,this.sendText="Send invites",this.cancelText="Cancel",this.inviteSent=new e.bkB,this.inviteCancelled=new e.bkB,this.ngUnsubscribe=new Q.B,this.sent=!1,this.sentResponses=[],this.errorResponses=[]}ngOnInit(){this.initForm(),this.initInviteListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.store.dispatch(new Oc),this.currentUserRole=this.store.selectSnapshot(ke.getUserRole),this.userRoles$.pipe((0,S.p)(t=>t.length>0),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.availableRoles=t.filter(o=>Ac.indexOf(o.role_name)<=Ac.indexOf(this.currentUserRole.role_name)),this.changeRef.markForCheck()}),this.form=this.formBuilder.group({emails:["",we.k0.required,zy(this.maxEmailCount).bind(this)],roleId:["",we.k0.required]})}initInviteListeners(){this.actions.pipe((0,l.xi)(xd),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.resetState(),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(wy),(0,b.Q)(this.ngUnsubscribe)).subscribe(({responses:t})=>{this.resetState(),this.sentResponses=t.filter(o=>"success"===o.status),this.errorResponses=t.filter(o=>"error"===o.status),this.sent=0===this.errorResponses.length,this.sent&&this.inviteSent.next(t),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(Py,ur),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.resetState(),this.errorMessage=Qo(t.error)||"There was an error sending the invites, please try again.",this.changeRef.markForCheck()})}handleCancelClick(){this.inviteCancelled.next()}backToFormClick(){this.resetState(),this.changeRef.markForCheck()}handleInviteClick(){const{eid:t}=this.organization,i=ro.l.parseEmails(this.form.value.emails).map(s=>({user_email:s,role_id:parseInt(this.form.value.roleId,10)}));this.store.dispatch(new xd(t,i))}formatEmails(t){return t.join(", ")}formatResponses(t){const o=t.map(s=>s.reason);return[...new Set([...o])].map(s=>{const r=t.filter(d=>d.reason===s).map(d=>d.email),a=this.formatEmails(r);return`"${s}": ${a}`})}resetState(){this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.errorMessage=""}}(ql=Bd).\u0275fac=function(t){return new(t||ql)(e.rXU(l.il),e.rXU(l.En),e.rXU(we.ze),e.rXU(e.gRc))},ql.\u0275cmp=e.VBU({type:ql,selectors:[["app-team-invite"]],inputs:{organization:"organization",layout:"layout",enableActions:"enableActions",sendText:"sendText",cancelText:"cancelText"},outputs:{inviteSent:"inviteSent",inviteCancelled:"inviteCancelled"},ngContentSelectors:["*"],decls:8,vars:7,consts:[["sendFormTmp",""],["cancelBtnTmp",""],["sendBtnTmp",""],["blockBtnTmp",""],[1,"invite"],[1,"theme-light"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"invite__footer"],["class","my-1",4,"ngIf"],[1,"my-1"],["data-test","teamInviteSuccess","type","message"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","mb-4",4,"ngIf"],["theme","light","label","Invite via email"],["formControlName","emails","data-test","teamInviteEmails","rows","8",1,"invite__input","input",3,"placeholder"],["class","mt-1",4,"ngIf"],["theme","light","label","Role",4,"ngIf"],[1,"mb-4"],["type","error"],[4,"ngFor","ngForOf"],[1,"mt-1"],["theme","light","label","Role"],["formControlName","roleId",1,"input"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"invite__buttons"],["app-button","","buttonSize","xl","buttonTheme","light","buttonType","default","data-test","skipInvitesButton",1,"invite__button",3,"click","uppercase"],["app-button","","buttonSize","xl","buttonType","primary","data-test","sendInvitesButton",1,"invite__button",3,"click","uppercase","disabled"],[4,"ngTemplateOutlet"]],template:function(t,o){if(1&t&&(e.NAR(),e.j41(0,"div",4)(1,"div",5),e.DNE(2,VL,2,1,"ng-container",6)(3,QL,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(5,iU,9,2,"div",7),e.j41(6,"div",8),e.SdG(7,0,["[select]","invite - footer"]),e.k0s()()),2&t){const i=e.sdS(4);e.AVh("invite--inline","inline"===o.layout)("invite--block","block"===o.layout),e.R7$(2),e.Y8G("ngIf",o.sent)("ngIfElse",i),e.R7$(3),e.Y8G("ngIf",o.enableActions&&!o.sent)}},dependencies:[bi.Q,q.Sq,q.bT,q.T3,mS,Wy.TL,we.xH,we.y7,we.me,we.wz,we.BC,we.cb,we.j4,we.JD,Ed,q.Jj],styles:[".invite__input[_ngcontent-%COMP%]{resize:vertical}.invite__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.invite__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.invite__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:8px auto}.invite--inline[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin-left:16px}.invite--inline[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end}.invite--block[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin:16px 0}.invite--block[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end;flex-direction:column}"],changeDetection:0}),Xy([(0,l.l6)(Ot.getInviting),Hy("design:type",y.c)],Bd.prototype,"inviting$",void 0),Xy([(0,l.l6)(ke.getUserRoles),Hy("design:type",y.c)],Bd.prototype,"userRoles$",void 0);class Vg{constructor(t,o,i){this.clipboardService=t,this.changeRef=o,this.snackbar=i,this.ngUnsubscribe=new Q.B,this.copyErrorMessage="There was a problem copying to the clipboard."}ngOnInit(){this.groupCode$.pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.groupCode=t,this.signupLink=`https://${window.location.host}/login/create?code=${t}`,this.changeRef.markForCheck()})}handleCopyCodeClick(t){t.preventDefault(),this.clipboardService.copyToClipboard(this.groupCode,"text").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.snackbar.open(o?"Team invite code copied to your clipboard.":this.copyErrorMessage)})}handleCopyLinkClick(t){t.preventDefault(),this.clipboardService.copyToClipboard(this.signupLink,"url").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(o=>{this.snackbar.open(o?"Team invite link copied to your clipboard.":this.copyErrorMessage)})}}function lU(n,t){1&n&&e.eu8(0)}function cU(n,t){1&n&&e.eu8(0)}function dU(n,t){if(1&n){const o=e.RV6();e.j41(0,"div",11)(1,"app-team-invite",12),e.bIt("inviteSent",function(s){e.eBV(o);const r=e.XpG();return e.Njj(r.handleInviteSent(s))})("inviteCancelled",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.handleInviteCancelled())}),e.k0s()()}if(2&n){const o=e.XpG();e.R7$(),e.Y8G("organization",o.organization)("layout","inline")}}function _U(n,t){1&n&&(e.j41(0,"div",13),e.nrm(1,"app-team-group-code"),e.k0s())}(Zl=Vg).\u0275fac=function(t){return new(t||Zl)(e.rXU($u.W),e.rXU(e.gRc),e.rXU(_o.UG))},Zl.\u0275cmp=e.VBU({type:Zl,selectors:[["app-team-group-code"]],decls:10,vars:6,consts:[[1,"team-group-code","text-sm","mb-4"],[1,"flex","mb-3"],["type","text",1,"team-group-code__input","input",3,"readonly","value"],["app-button","","buttonSize","md","buttonTheme","light","buttonType","primary",1,"team-group-code__button","ml-4",3,"click","uppercase"],[1,"flex"],["type","text",1,"team-group-code__input","input","underline",3,"readonly","value"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.EFF(1," Share this code or invite link so people can join your team directly.\n"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"input",2),e.j41(4,"button",3),e.bIt("click",function(s){return o.handleCopyCodeClick(s)}),e.EFF(5," Copy Code "),e.k0s()(),e.j41(6,"div",4),e.nrm(7,"input",5),e.j41(8,"button",3),e.bIt("click",function(s){return o.handleCopyLinkClick(s)}),e.EFF(9," Copy Link "),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("readonly",!0)("value",o.groupCode),e.R7$(),e.Y8G("uppercase",!0),e.R7$(3),e.Y8G("readonly",!0)("value",o.signupLink),e.R7$(),e.Y8G("uppercase",!0))},dependencies:[bi.Q],styles:[".team-group-code__input[_ngcontent-%COMP%]{background-color:#eaeff5!important}.team-group-code__button[_ngcontent-%COMP%]{flex:0 0 112px}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(et.getOrganizationGroupCode),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Vg.prototype,"groupCode$",void 0);class xg{constructor(t,o){this.dialogRef=t,this.data=o,this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.ngUnsubscribe=new Q.B,this.organization=o.organization}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleInviteSent(t){setTimeout(()=>{this.inviteComplete()},5e3)}handleInviteCancelled(){this.inviteComplete()}inviteComplete(){this.dialogRef.close()}}(ec=xg).\u0275fac=function(t){return new(t||ec)(e.rXU(Dt.CP),e.rXU(Dt.Vh))},ec.\u0275cmp=e.VBU({type:ec,selectors:[["app-team-invite-dialog"]],decls:15,vars:4,consts:[["inviteTmpl",""],["groupCodeTmpl",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"dialog__close",3,"click"],["icon","times","size","lg"],["tabSize","medium","tabTheme","light","tabColor","red",3,"tabUnderline"],["label","Invite By Email"],[4,"ngTemplateOutlet"],["label","Share Code or Link"],[1,"theme-light","pt-6"],["sentText","Send invites","cancelText","Cancel",3,"inviteSent","inviteCancelled","organization","layout"],[1,"theme-light","py-6"]],template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"h1",2),e.EFF(1,"Invite Members"),e.k0s(),e.j41(2,"div",3)(3,"div",4)(4,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(o.handleInviteCancelled())}),e.nrm(5,"app-icon",6),e.k0s(),e.j41(6,"app-tabs",7)(7,"app-tab",8),e.DNE(8,lU,1,0,"ng-container",9),e.k0s(),e.j41(9,"app-tab",10),e.DNE(10,cU,1,0,"ng-container",9),e.k0s()(),e.DNE(11,dU,2,2,"ng-template",null,0,e.C5r)(13,_U,2,0,"ng-template",null,1,e.C5r),e.k0s()()}if(2&t){const i=e.sdS(12),s=e.sdS(14);e.R7$(4),e.BMQ("aria-label","Close"),e.R7$(2),e.Y8G("tabUnderline",!0),e.R7$(2),e.Y8G("ngTemplateOutlet",i),e.R7$(2),e.Y8G("ngTemplateOutlet",s)}},dependencies:[q.T3,Dt.BI,Dt.Yi,bi.Q,yt.R,Ff.j,Gf.O,Bd,Vg],styles:[".dialog[_ngcontent-%COMP%]{width:480px}.dialog__input[_ngcontent-%COMP%]{resize:vertical}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.dialog__close[_ngcontent-%COMP%]{position:absolute;right:24px;top:24px}@media (max-width: 480px){.dialog[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ot.getInviting),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],xg.prototype,"inviting$",void 0);let Qy=(()=>{class t{constructor(){}}return t.type="[Share] Reset",t})(),zd=(()=>{class t{constructor(i){this.shareEmail=i}}return t.type="[Share] Share Email Link",t})(),Yy=(()=>{class t{constructor(i){this.shareEmail=i}}return t.type="[Share] Share Email Link Success",t})(),Ky=(()=>{class t{constructor(i){this.error=i}}return t.type="[Share] Share Email Link Fail",t})();var fs=function(n){return n.Facebook="facebook",n.LinkedIn="linkedin",n.Twitter="twitter",n}(fs||{}),Fg=function(n){return n.Model="model",n.Quiz="quiz",n}(Fg||{});let Jy=(()=>{var n;class t{constructor(i,s){this.http=i,this.APP_BASE_URL=s}shareEmailLink(i){return this.http.post("/ws/user/share/email",i)}generateShareLink(i,s="en"){const r=i.thumbnail_url.replace("/small/","/large/");return{type:i.quiz?Fg.Quiz:Fg.Model,title:i.title,relativeUrl:this.createShareUrl(i,"share",s,!1,!1),fullUrl:this.createShareUrl(i,"share",s,!0,!1),thumbUrl:r,social:[{type:fs.Facebook,url:`https://www.facebook.com/sharer/sharer.php?u=${this.createShareUrl(i,fs.Facebook,s,!0,!0)}`},{type:fs.LinkedIn,url:`https://www.linkedin.com/sharing/share-offsite/?url=${this.createShareUrl(i,fs.LinkedIn,s,!0,!0)}`},{type:fs.Twitter,url:`http://twitter.com/share?url=${this.createShareUrl(i,fs.Twitter,s,!0,!0)}`}]}}createShareUrl(i,s,r,a,d){const f=i.id.replace(".json",""),T=Object.values(fs).includes(s),ee=`/view?id=${f}&lang=${r}&ref=${s}`,re=a||T?`${T?"https://human.biodigital.com":this.APP_BASE_URL}${ee}`:ee;return d?encodeURIComponent(re):re}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(w.Qq),e.KVO(kp))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var Zs,Wd=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},Co=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const qy={sharing:!1};let Qr=((Zs=class{static getSharing(t){return t.sharing}resetShare(t,o){t.setState(qy)}sendEmail(t,{shareEmail:o}){t.patchState({sharing:!0}),this.authService.verifyIsHuman("share_email").pipe((0,Cn.Z)(({isHuman:i,verification:s})=>{if(!i)throw new lo;return this.shareService.shareEmailLink({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,site_verify_response:s,...o})}),(0,bt.j)(()=>t.patchState({sharing:!1}))).subscribe({next:()=>{t.dispatch(new Yy(o))},error:i=>{i instanceof lo&&t.dispatch(new ur(i)),t.dispatch(new Ky(i))}})}constructor(t,o,i){this.shareService=t,this.productService=o,this.authService=i}}).\u0275fac=function(t){return new(t||Zs)(e.KVO(Jy),e.KVO(je),e.KVO(hr))},Zs.\u0275prov=e.jDH({token:Zs,factory:Zs.\u0275fac}),Zs);Wd([(0,l.rc)(Qy),Co("design:type",Function),Co("design:paramtypes",[Object,Qy]),Co("design:returntype",void 0)],Qr.prototype,"resetShare",null),Wd([(0,l.rc)(zd),Co("design:type",Function),Co("design:paramtypes",[Object,zd]),Co("design:returntype",void 0)],Qr.prototype,"sendEmail",null),Wd([(0,l.MD)(),Co("design:type",Function),Co("design:paramtypes",[class pU{}]),Co("design:returntype",void 0)],Qr,"getSharing",null),Qr=Wd([(0,l.Uw)({name:"share",defaults:qy}),Co("design:paramtypes",[Jy,je,hr])],Qr);var tc,Zy=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ev=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};const uU=["emailField"];function gU(n,t){1&n&&(e.qex(0),e.j41(1,"div",15)(2,"app-message-toggle",16),e.EFF(3," Your email was successfully sent. "),e.k0s()(),e.bVm())}function hU(n,t){if(1&n&&(e.j41(0,"div",15)(1,"app-message-toggle",22),e.EFF(2),e.k0s()()),2&n){const o=e.XpG(3);e.R7$(2),e.SpI(" ",o.errorMessage," ")}}function mU(n,t){1&n&&e.nrm(0,"app-spinner",23)}function fU(n,t){1&n&&(e.j41(0,"div",25)(1,"mat-error"),e.EFF(2,"Please enter a valid email address."),e.k0s()())}function SU(n,t){if(1&n&&(e.j41(0,"div",27)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const o=e.XpG(2).$implicit,i=e.XpG(3);e.R7$(2),e.Lme(" Maximum email addresses excceeded, ",o.currentEmailCount," of ",i.maxEmailCount," max. ")}}function bU(n,t){if(1&n&&e.DNE(0,SU,3,2,"div",26),2&n){const o=e.XpG().$implicit;e.Y8G("ngIf",o.maxEmailsExceeded)}}function yU(n,t){if(1&n&&(e.qex(0),e.DNE(1,fU,3,0,"div",24)(2,bU,1,1,"ng-template",null,2,e.C5r),e.bVm()),2&n){const o=t.$implicit,i=e.sdS(3);e.R7$(),e.Y8G("ngIf",o.invalidEmails)("ngIfElse",i)}}function vU(n,t){if(1&n){const o=e.RV6();e.DNE(0,hU,3,1,"div",17),e.j41(1,"form",18),e.bIt("submit",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.submitForm(s.config.shareLink))}),e.j41(2,"textarea",19,1),e.EFF(4,"          "),e.k0s(),e.j41(5,"button",20),e.nI1(6,"async"),e.DNE(7,mU,1,0,"app-spinner",21),e.nI1(8,"async"),e.EFF(9),e.nI1(10,"async"),e.k0s()(),e.DNE(11,yU,4,2,"ng-container",6)}if(2&n){const o=e.XpG(2);e.Y8G("ngIf",o.errorMessage),e.R7$(),e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("disabled",!o.form.valid||e.bMT(6,7,o.sharing$)),e.BMQ("aria-label","Send Email"),e.R7$(2),e.Y8G("ngIf",e.bMT(8,9,o.sharing$)),e.R7$(2),e.SpI(" ",e.bMT(10,11,o.sharing$)?"Sending":"Send Email"," "),e.R7$(2),e.Y8G("ngIf",o.form.get("emails").errors)}}function EU(n,t){if(1&n&&(e.qex(0),e.DNE(1,gU,4,0,"ng-container",14)(2,vU,12,13,"ng-template",null,0,e.C5r),e.bVm()),2&n){const o=e.sdS(3),i=e.XpG();e.R7$(),e.Y8G("ngIf",i.emailSent)("ngIfElse",o)}}function CU(n,t){if(1&n&&(e.j41(0,"a",28),e.nI1(1,"titlecase"),e.nI1(2,"titlecase"),e.nrm(3,"img",9),e.k0s()),2&n){const o=t.$implicit;e.Y8G("href",o.url,e.B4B)("matTooltip","Share via "+e.bMT(1,5,o.type)),e.BMQ("aria-label","Share via "+e.bMT(2,7,o.type))("data-test",o.type+"LinkButton"),e.R7$(3),e.Y8G("src","/assets/images/social/"+o.type+"-share.svg",e.B4B)}}function TU(n,t){if(1&n&&(e.j41(0,"p",29),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.config.description," ")}}class Xd{constructor(t,o,i,s,r,a,d,f){this.store=t,this.actions=o,this.dialogRef=i,this.data=s,this.clipboardService=r,this.snackBar=a,this.formBuilder=d,this.changeRef=f,this.maxEmailCount=50,this.config={title:"Share"},this.emailSent=!1,this.errorMessage="",this.formError="",this.ngUnsubscribe=new Q.B,this.config={...this.config,...s},this.initForm()}ngOnInit(){this.initEmailListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({emails:["",we.k0.required,zy(this.maxEmailCount).bind(this)]})}initEmailListeners(){this.actions.pipe((0,l.xi)(zd),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!1,this.errorMessage="",this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(Yy),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!0,this.errorMessage="",setTimeout(()=>{this.emailSent=!1,this.form.setValue({emails:""}),this.changeRef.markForCheck(),setTimeout(()=>this.focus())},5e3),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(Ky),(0,b.Q)(this.ngUnsubscribe)).subscribe(t=>{this.emailSent=!1,this.errorMessage=Qo(t.error)||"There was an error sending the email.",setTimeout(()=>this.focus()),this.changeRef.markForCheck()})}focus(){const t=this.emailField?.nativeElement;t&&t.focus()}submitForm(t){const{type:o,title:i,relativeUrl:s,thumbUrl:r}=t,a=ro.l.parseEmails(this.form.value.emails);this.store.dispatch(new zd({share_type:o,share_title:i,share_thumbnail_path:r,share_link_path:s,share_emails:a}))}handleCopyClick(t,o){this.clipboardService.copyToClipboard(t,"url").pipe((0,b.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(`Link ${i?"copied":"not copied"}.`)}),o.preventDefault()}handleCloseClick(){this.dialogRef.close()}}function OU(n,t){if(1&n&&e.nrm(0,"img",17),2&n){const o=e.XpG().$implicit;e.Y8G("src",o.logo,e.B4B)}}function MU(n,t){if(1&n&&(e.j41(0,"h2",18),e.EFF(1),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(),e.SpI(" ",o.title," ")}}function IU(n,t){if(1&n&&e.nrm(0,"p",19),2&n){const o=e.XpG().$implicit;e.AVh("text-xl",o.logo)("font-medium",o.logo),e.Y8G("innerHTML",o.text,e.npT)}}function wU(n,t){if(1&n&&e.nrm(0,"img",20),2&n){const o=e.XpG().$implicit;e.Y8G("src",o.image,e.B4B)}}function PU(n,t){if(1&n&&(e.j41(0,"div",12),e.DNE(1,OU,1,1,"img",13)(2,MU,2,1,"h2",14)(3,IU,1,5,"p",15)(4,wU,1,1,"img",16),e.k0s()),2&n){const o=t.$implicit,i=t.index,s=e.XpG();e.AVh("slide__item--hidden",s.selectedIndex!==i),e.R7$(),e.Y8G("ngIf",o.logo),e.R7$(),e.Y8G("ngIf",o.title),e.R7$(),e.Y8G("ngIf",o.text),e.R7$(),e.Y8G("ngIf",o.image)}}function AU(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){const s=e.eBV(o).index,r=e.XpG();return e.Njj(r.handleSelectSlideClick(s))}),e.k0s()}if(2&n){const o=t.$implicit,i=t.index,s=e.XpG();e.AVh("slide__nav-dot--active",s.selectedIndex===i),e.BMQ("title",o.title)("aria-label",o.title)}}(tc=Xd).\u0275fac=function(t){return new(t||tc)(e.rXU(l.il),e.rXU(l.En),e.rXU(Dt.CP),e.rXU(Dt.Vh),e.rXU($u.W),e.rXU(_o.UG),e.rXU(we.ok),e.rXU(e.gRc))},tc.\u0275cmp=e.VBU({type:tc,selectors:[["app-share-url-dialog"]],viewQuery:function(t,o){if(1&t&&e.GBs(uU,5),2&t){let i;e.mGM(i=e.lsd())&&(o.emailField=i.first)}},decls:14,vars:9,consts:[["emailFormTmp",""],["emailField",""],["maxEmailErrorTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"share-url-dialog"],[4,"ngIf"],[1,"share-url-dialog__social"],["target","_blank","aria-label","Copy Link","matTooltip","Copy Link","matTooltipPosition","below","data-test","copyLinkButton",1,"share-url-dialog__social-link",3,"click","href"],[3,"src"],["class","share-url-dialog__social-link","target","_blank","matTooltipPosition","below",3,"href","matTooltip",4,"ngFor","ngForOf"],["class","share-url-dialog__description my-3",4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonType","flat","buttonTheme","light","type","button","title","Close",1,"share-url-dialog__close",3,"click"],[4,"ngIf","ngIfElse"],[1,"my-2"],["type","message"],["class","my-2",4,"ngIf"],[1,"share-url-dialog__form",3,"submit","formGroup"],["rows","1","formControlName","emails","placeholder","Email, comma separated","data-test","emailEntryField",1,"share-url-dialog__input","input","theme-light"],["type","submit","app-button","","buttonType","primary","title","'Send Email'","data-test","emailLinkButton",1,"share-url-dialog__submit",3,"disabled"],["size","small","class","mr-2","render","inline",4,"ngIf"],["type","error"],["size","small","render","inline",1,"mr-2"],["class","my-1",4,"ngIf","ngIfElse"],[1,"my-1"],["class","flex flex-col my-1",4,"ngIf"],[1,"flex","flex-col","my-1"],["target","_blank","matTooltipPosition","below",1,"share-url-dialog__social-link",3,"href","matTooltip"],[1,"share-url-dialog__description","my-3"]],template:function(t,o){1&t&&(e.j41(0,"h1",3),e.EFF(1),e.k0s(),e.j41(2,"div",4)(3,"div",5),e.DNE(4,EU,4,2,"ng-container",6),e.nI1(5,"async"),e.j41(6,"div",7)(7,"a",8),e.bIt("click",function(s){return o.handleCopyClick(null==o.config.shareLink?null:o.config.shareLink.fullUrl,s)}),e.nrm(8,"img",9),e.k0s(),e.DNE(9,CU,4,9,"a",10),e.k0s(),e.DNE(10,TU,2,1,"p",11),e.k0s()(),e.j41(11,"div",12)(12,"button",13),e.bIt("click",function(){return o.handleCloseClick()}),e.EFF(13," Close "),e.k0s()()),2&t&&(e.R7$(),e.JRh(o.config.title),e.R7$(3),e.Y8G("ngIf",e.bMT(5,7,o.userProfile$)),e.R7$(3),e.Y8G("href",null==o.config.shareLink?null:o.config.shareLink.fullUrl,e.B4B),e.R7$(),e.Y8G("src","/assets/images/social/link-share.svg",e.B4B),e.R7$(),e.Y8G("ngForOf",null==o.config.shareLink?null:o.config.shareLink.social),e.R7$(),e.Y8G("ngIf",o.config.description),e.R7$(2),e.BMQ("aria-label","Close"))},dependencies:[q.Sq,q.bT,Wy.TL,Dt.BI,Dt.E7,Dt.Yi,On.oV,bi.Q,Gs,Ed,we.qT,we.me,we.BC,we.cb,we.j4,we.JD,q.Jj,q.PV],styles:[".share-url-dialog__description[_ngcontent-%COMP%]{color:#61779e;font-size:.75rem;line-height:1rem}.share-url-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:12px}.share-url-dialog__submit[_ngcontent-%COMP%]{flex:1 0 120px}.share-url-dialog__social[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;margin-top:32px;margin-bottom:20px}.share-url-dialog__social-link[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:100%;cursor:pointer}.share-url-dialog__social-link[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.share-url-dialog__social-link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.share-url-dialog__input[_ngcontent-%COMP%], .share-url-dialog__input[_ngcontent-%COMP%]:disabled{background-color:#f9fafd;color:#61779e;font-size:.75rem;line-height:1rem;opacity:1;resize:vertical;max-height:240px}@media (max-width: 480px){.share-url-dialog__form[_ngcontent-%COMP%]{flex-wrap:wrap}}"],changeDetection:0}),Zy([(0,l.l6)(ke.getUserProfile),ev("design:type",y.c)],Xd.prototype,"userProfile$",void 0),Zy([(0,l.l6)(Qr.getSharing),ev("design:type",y.c)],Xd.prototype,"sharing$",void 0);var Hd=function(n){return n[n.NewUser=0]="NewUser",n[n.ExistingUser=1]="ExistingUser",n[n.Group=2]="Group",n}(Hd||{});const NU=[{text:"We make it easy to visualize the human body<br/> for your educational needs - all in interactive 3D.",logo:"/assets/images/biodigital-logo.svg"},{title:"Explore",text:"Browse our digital library for 3D models to complement your curriculum.",image:"/assets/images/welcome-tour-explore.jpg"},{title:"Customize",text:"Use our authoring tools to create 3D views tailored to your educational goals.",image:"/assets/images/welcome-tour-customize.jpg"},{title:"Collaborate",text:"Share your saved 3D views with your team from a central Library.",image:"/assets/images/welcome-tour-collaborate.jpg"},{title:"Integrate",text:"Publish your interactive 3D model and drop into your digital content.",image:"/assets/images/welcome-tour-integrate.jpg"}],RU=[{title:"Introducing Human Studio",text:"The first product for authoring custom interactive 3D models of anatomy, disease and treatments.",image:"/assets/images/studio-tour-studio.jpg"},{title:"Interactive Labels",text:"Quickly add anatomical labels to call out key learning objectives.",image:"/assets/images/studio-tour-labels.jpg"},{title:"Paint",text:"Customize the look and feel of your 3D model by applying different paint effects to anatomical structures.",image:"/assets/images/studio-tour-paint.jpg"},{title:"Tour Builder",text:"Tell an interactive story by stringing together different views of your 3D model.",image:"/assets/images/studio-tour-tour.jpg"},{title:"Text Manager",text:"Add or modify text from one dedicated place.",image:"/assets/images/studio-tour-text.jpg"}];let DU=(()=>{var n;class t{get isFirstSlide(){return 0===this.selectedIndex}get isLastSlide(){return this.selectedIndex===this.slides.length-1}constructor(i,s,r){switch(this.store=i,this.dialogRef=s,this.data=r,this.ngUnsubscribe=new Q.B,this.settings={userType:Hd.NewUser},this.slides=[],this.selectedIndex=0,this.settings={...this.settings,...r},this.settings.userType){case Hd.NewUser:this.slides=NU;break;case Hd.ExistingUser:this.slides=RU}}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCloseTour(){this.close()}close(){this.dialogRef.close()}handleSelectSlideClick(i){this.selectedIndex=i}handleNextClick(){this.incrementSelectedIndex(1)}handlePrevClick(){this.incrementSelectedIndex(-1)}incrementSelectedIndex(i){this.selectedIndex=Math.max(0,this.selectedIndex+i)%this.slides.length}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(l.il),e.rXU(Dt.CP),e.rXU(Dt.Vh))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-welcome-tour-dialog"]],decls:12,vars:8,consts:[["role","dialog","aria-modal","true","data-test","welcomeTour",1,"welcome"],[1,"slide"],["class","slide__item",3,"slide__item--hidden",4,"ngFor","ngForOf"],[1,"slide__nav"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Previous Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-left","size","md"],[1,"slide__nav-dots"],["type","button","class","slide__nav-dot",3,"slide__nav-dot--active","click",4,"ngFor","ngForOf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Next Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-right","size","md"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close","data-test","welcomeTourClose",1,"welcome__close",3,"click"],["icon","times","size","lg"],[1,"slide__item"],["class","slide__logo",3,"src",4,"ngIf"],["class","text-2xl uppercase mt-4",4,"ngIf"],["class","text-lg mt-4 mb-4",3,"text-xl","font-medium","innerHTML",4,"ngIf"],["class","slide__image",3,"src",4,"ngIf"],[1,"slide__logo",3,"src"],[1,"text-2xl","uppercase","mt-4"],[1,"text-lg","mt-4","mb-4",3,"innerHTML"],[1,"slide__image",3,"src"],["type","button",1,"slide__nav-dot",3,"click"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,PU,5,6,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return s.handlePrevClick()}),e.nrm(5,"app-icon",5),e.k0s(),e.j41(6,"div",6),e.DNE(7,AU,1,4,"button",7),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return s.handleNextClick()}),e.nrm(9,"app-icon",9),e.k0s()()(),e.j41(10,"button",10),e.bIt("click",function(){return s.handleCloseTour()}),e.nrm(11,"app-icon",11),e.k0s()()),2&i&&(e.BMQ("aria-label","Welcome Tour"),e.R7$(2),e.Y8G("ngForOf",s.slides),e.R7$(2),e.Y8G("disabled",s.isFirstSlide),e.BMQ("aria-label","Previous Slide"),e.R7$(3),e.Y8G("ngForOf",s.slides),e.R7$(),e.Y8G("disabled",s.isLastSlide),e.BMQ("aria-label","Next Slide"),e.R7$(2),e.BMQ("aria-label","Close"))},dependencies:[q.Sq,q.bT,bi.Q,yt.R],styles:[".welcome[_ngcontent-%COMP%]{position:relative;display:flex;align-items:flex-end;flex-direction:column;padding:24px}.welcome__close[_ngcontent-%COMP%]{position:absolute;top:24px;right:24px}.slide[_ngcontent-%COMP%]{width:800px;height:600px;position:relative;margin:auto;display:flex;flex-direction:column;justify-content:space-between}.slide__item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.slide__item--hidden[_ngcontent-%COMP%]{display:none}.slide__logo[_ngcontent-%COMP%]{width:300px;margin:160px 0 40px}.slide__image[_ngcontent-%COMP%]{flex:2;overflow:auto;width:100%}.slide__nav[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:16px;margin:12px 0}.slide__nav-arrow[_ngcontent-%COMP%]{cursor:pointer;margin:auto 12px;opacity:.8}.slide__nav-arrow[_ngcontent-%COMP%]:hover:not([disabled]){opacity:1}.slide__nav-dots[_ngcontent-%COMP%]{display:flex}.slide__nav-dot[_ngcontent-%COMP%]{margin:auto 4px;cursor:pointer;display:flex;background-color:#1c2a3f66;border-radius:50%;border:none;width:14px;height:14px;line-height:17px}.slide__nav-dot[_ngcontent-%COMP%]:hover{background-color:#1c2a3f99}.slide__nav-dot--active[_ngcontent-%COMP%]{background-color:#2d72dc}@media (max-width: 1024px){.slide[_ngcontent-%COMP%]{width:100%;height:80vh}}"],changeDetection:0}),t})();var nc;const UU=(n,t,o,i)=>({"team-join--compact":n,"team-join--readonly":t,"team-join--theme-dark":o,"team-join--theme-light":i});function jU(n,t){1&n&&(e.j41(0,"div",3),e.nrm(1,"app-spinner",4),e.k0s())}function VU(n,t){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"img",13),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("src",o.pendingJoinOrganization.logoUrl,e.B4B)}}function xU(n,t){if(1&n&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.pendingJoinOrganization.name," ")}}function FU(n,t){if(1&n&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.pendingJoinOrganization.members," ")}}function GU(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.handleCancelJoinClick(s.pendingJoinRequest.join_request_key))}),e.EFF(1," Cancel Request "),e.k0s()}}function $U(n,t){if(1&n&&(e.qex(0),e.nrm(1,"app-html",5),e.j41(2,"div",6)(3,"div",7),e.DNE(4,VU,2,1,"div",8)(5,xU,2,1,"div",9)(6,FU,2,1,"div",10),e.k0s(),e.DNE(7,GU,2,0,"button",11),e.k0s(),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("markdownText",o.joinRequestText),e.R7$(3),e.Y8G("ngIf",o.pendingJoinOrganization.logoUrl),e.R7$(),e.Y8G("ngIf",!o.compact||!o.pendingJoinOrganization.logoUrl),e.R7$(),e.Y8G("ngIf",!o.compact),e.R7$(),e.Y8G("ngIf",!o.readonly)}}function BU(n,t){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"img",13),e.k0s()),2&n){const o=e.XpG(2).$implicit;e.R7$(),e.Y8G("src",o.logoUrl,e.B4B)}}function zU(n,t){if(1&n&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",o.name," ")}}function WU(n,t){if(1&n&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",o.members," ")}}function XU(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2).$implicit,r=e.XpG(2);return e.Njj(r.handleRequestJoinClick(s.id))}),e.EFF(1," Request to Join "),e.k0s()}}function HU(n,t){if(1&n&&(e.j41(0,"div",6)(1,"div",7),e.DNE(2,BU,2,1,"div",8)(3,zU,2,1,"div",9)(4,WU,2,1,"div",10),e.k0s(),e.DNE(5,XU,2,0,"button",20),e.k0s()),2&n){const o=e.XpG().$implicit,i=e.XpG(2);e.R7$(2),e.Y8G("ngIf",o.logoUrl),e.R7$(),e.Y8G("ngIf",!i.compact||!o.logoUrl),e.R7$(),e.Y8G("ngIf",!i.compact),e.R7$(),e.Y8G("ngIf",!i.readonly)}}function QU(n,t){if(1&n&&(e.j41(0,"div"),e.DNE(1,HU,6,4,"div",19),e.k0s()),2&n){const o=t.index,i=e.XpG(2);e.R7$(),e.Y8G("ngIf",0===o||i.showAllOrganizations)}}function YU(n,t){if(1&n){const o=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(o);const s=e.XpG(2);return e.Njj(s.toggleShowAllOrganizations())}),e.j41(1,"div",23),e.EFF(2),e.nrm(3,"app-icon",24),e.k0s()()}if(2&n){const o=e.XpG(2);e.Y8G("uppercase",!1),e.R7$(2),e.SpI(" ",o.toggleText," "),e.R7$(),e.Y8G("icon",o.showAllOrganizations?"caret-up":"caret-down")}}function KU(n,t){if(1&n&&(e.qex(0),e.nrm(1,"app-html",5),e.DNE(2,QU,2,1,"div",17)(3,YU,4,3,"button",18),e.bVm()),2&n){const o=e.XpG();e.R7$(),e.Y8G("markdownText",o.requestOrganizationsText),e.R7$(),e.Y8G("ngForOf",o.requestOrganizations),e.R7$(),e.Y8G("ngIf",o.showToggle)}}class Gg{get joinRequestText(){if(this._joinRequestText)return this._joinRequestText;{let t=this.pendingJoinOrganization?.name;return t=t?`${t} team`:"team",`Your request to join the ${t} is pending approval from a team administrator. It will automatically expire in 14 days if not approved.`}}set joinRequestText(t){this._joinRequestText=t}constructor(t,o,i,s){this.changeDetectorRef=t,this.store=o,this.actions=i,this.snackBar=s,this.readonly=!1,this.compact=!1,this.theme="dark",this.organizations=[],this._joinRequestText="",this.requestOrganizationsText="It looks like some of your teammates are already using the BioDigital Human.",this.pendingJoinRequestSuccess=new e.bkB,this.requestOrganizationsSuccess=new e.bkB,this.joinRequestsLoaded=!1,this.requestOrganizations=[],this.showAllOrganizations=!1,this.showToggle=!1,this.showMoreText="",this.ngUnsubscribe=new Q.B}get showPendingRequest(){return void 0!==this.pendingJoinRequest}get showRequestOrganizations(){return void 0===this.pendingJoinRequest&&this.requestOrganizations.length>0}get toggleText(){return this.showAllOrganizations?"Show less":this.showMoreText}ngOnInit(){this.initEventListeners(),this.initRequests()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initRequests(){this.showAllOrganizations=!this.compact,0===this.organizations.length?this.store.dispatch(new Jl):this.createRequestOrganizations(this.organizations)}initEventListeners(){this.actions.pipe((0,l.xi)(Gd),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetJoinRequestsSuccess()),this.actions.pipe((0,l.xi)(Fd),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetEligibleOrganizationsSuccess()),this.actions.pipe((0,l.xi)(Uy),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Join request successfully cancelled.")}),this.actions.pipe((0,l.xi)(jy),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with cancelling the request.")}),this.actions.pipe((0,l.xi)(Ly),(0,b.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with making this request.")})}handleRequestJoinClick(t){this.store.dispatch(new Ag(t))}handleCancelJoinClick(t){this.store.dispatch(new Ng(t))}toggleShowAllOrganizations(){this.showAllOrganizations=!this.showAllOrganizations}handleGetJoinRequestsSuccess(){this.joinRequestsLoaded=!0,this.pendingJoinRequest=this.store.selectSnapshot(Ot.getPendingJoinRequest),this.pendingJoinRequest?this.pendingJoinOrganization=this.createDisplayOrganization(this.pendingJoinRequest.request_organization):this.store.dispatch(new wg),this.pendingJoinRequestSuccess.next(this.pendingJoinRequest),this.changeDetectorRef.markForCheck()}handleGetEligibleOrganizationsSuccess(){this.createRequestOrganizations(this.store.selectSnapshot(Ot.getEligibleOrganizations)),this.requestOrganizationsSuccess.next(this.requestOrganizations),this.changeDetectorRef.markForCheck()}createRequestOrganizations(t){this.showToggle=this.compact&&t.length>1;const o=t.length-1;this.showMoreText=`Show ${o} more team${1===o?"":"s"}`,this.requestOrganizations=t.map(this.createDisplayOrganization,this),this.requestOrganizations.sort((i,s)=>s.logoUrl&&!i.logoUrl?1:-1),this.changeDetectorRef.markForCheck()}createDisplayOrganization(t){return{id:t.organization_id,name:t.organization_name,logoUrl:t.group_logos.default,members:`${t.users_count} member${1===t.users_count?"":"s"}`}}}(nc=Gg).\u0275fac=function(t){return new(t||nc)(e.rXU(e.gRc),e.rXU(l.il),e.rXU(l.En),e.rXU(_o.UG))},nc.\u0275cmp=e.VBU({type:nc,selectors:[["app-team-join"]],inputs:{readonly:"readonly",compact:"compact",theme:"theme",organizations:"organizations",joinRequestText:"joinRequestText",requestOrganizationsText:"requestOrganizationsText"},outputs:{pendingJoinRequestSuccess:"pendingJoinRequestSuccess",requestOrganizationsSuccess:"requestOrganizationsSuccess"},decls:7,vars:15,consts:[[1,"team-join",3,"ngClass"],["class","my-6",4,"ngIf"],[4,"ngIf"],[1,"my-6"],["size","huge"],[1,"team-join__text","block","my-4",3,"markdownText"],[1,"team-join__organization","flex","justify-between","mb-3"],[1,"team-join__organization-info","flex","flex-col"],["class","mb-3",4,"ngIf"],["class","team-join__organization-name",4,"ngIf"],["class","team-join__organization-members",4,"ngIf"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click",4,"ngIf"],[1,"mb-3"],[1,"team-join__organization-logo",3,"src"],[1,"team-join__organization-name"],[1,"team-join__organization-members"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click"],[4,"ngFor","ngForOf"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"uppercase","click",4,"ngIf"],["class","team-join__organization flex justify-between mb-3",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"click","uppercase"],[1,"text-sm","underline"],[1,"pl-1",3,"icon"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.DNE(1,jU,2,0,"div",1),e.nI1(2,"async"),e.DNE(3,$U,8,5,"ng-container",2),e.nI1(4,"async"),e.DNE(5,KU,4,3,"ng-container",2),e.nI1(6,"async"),e.k0s()),2&t&&(e.Y8G("ngClass",e.ziG(10,UU,o.compact,o.readonly,"dark"===o.theme,"light"===o.theme)),e.R7$(),e.Y8G("ngIf",e.bMT(2,4,o.requesting$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(4,6,o.requesting$)&&o.showPendingRequest),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(6,8,o.requesting$)&&o.showRequestOrganizations))},dependencies:[bi.Q,q.YU,q.Sq,q.bT,yt.R,Gs,Zo,q.Jj],styles:[".team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--theme-light[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{color:#283853}.team-join__organization[_ngcontent-%COMP%]{border:1px solid #d7e0ea;border-radius:4px;padding:16px}.team-join__organization-info[_ngcontent-%COMP%]{flex-basis:50%}.team-join__organization-logo[_ngcontent-%COMP%]{display:block;max-height:32px;max-width:100%}.team-join__organization-name[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600}.team-join__organization-members[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:500;color:#61779e}.team-join--compact[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization[_ngcontent-%COMP%]{border:none;border-radius:0;padding:0}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization-name[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500}.team-join--readonly[_ngcontent-%COMP%]   .team-join__organization-info[_ngcontent-%COMP%]{flex-basis:auto}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(Ot.getRequesting),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Gg.prototype,"requesting$",void 0);let JU=(()=>{var n;class t{constructor(i,s,r,a){this.dialogRef=i,this.router=s,this.storageService=r,this.data=a,this.requestOrganizationsText="",this.organizations=[]}ngOnInit(){this.organizations=this.data.organizations,this.storageService.setLocalItem(zt.UT.UserJoinPromptSeen,!0),this.dialogRef.afterClosed().subscribe(i=>{i&&this.router.navigateByUrl("/account/team")})}handleViewTeamsCancel(){this.dialogRef.close(!1)}handleViewTeamsClick(){this.dialogRef.close(!0)}}return(n=t).\u0275fac=function(i){return new(i||n)(e.rXU(Dt.CP),e.rXU(ne.Ix),e.rXU(zt.n$),e.rXU(Dt.Vh))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-user-join-dialog"]],decls:7,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"readonly","organizations"],["mat-dialog-actions",""],["app-button","","buttonType","primary",3,"click"]],template:function(i,s){1&i&&(e.j41(0,"h1",0),e.EFF(1,"We found your team"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"app-team-join",2),e.k0s(),e.j41(4,"div",3)(5,"button",4),e.bIt("click",function(){return s.handleViewTeamsClick()}),e.EFF(6,"View Teams"),e.k0s()()),2&i&&(e.R7$(3),e.Y8G("readonly",!0)("organizations",s.organizations))},dependencies:[Dt.BI,Dt.E7,Dt.Yi,bi.Q,Gg],changeDetection:0}),t})();function qU(n,t){if(1&n&&e.nrm(0,"app-icon",2),2&n){const o=e.XpG();e.Y8G("icon",o.icon)}}let ZU=(()=>{var n;class t{constructor(){this.size="medium",this.type="outline",this.color="#CCCCCC"}ngOnInit(){}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-profile-badge"]],inputs:{size:"size",type:"type",color:"color",icon:"icon",label:"label"},decls:3,vars:12,consts:[[1,"badge","uppercase"],[3,"icon",4,"ngIf"],[3,"icon"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,qU,1,1,"app-icon",1),e.EFF(2),e.k0s()),2&i&&(e.AVh("badge--outline","outline"===s.type)("badge--solid","solid"===s.type)("badge--small","small"===s.size)("badge--medium","medium"===s.size)("badge--large","large"===s.size),e.R7$(),e.Y8G("ngIf",s.icon),e.R7$(),e.SpI(" ",s.label,"\n"))},dependencies:[q.bT,yt.R],styles:[".badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border-radius:50%;color:#101823}.badge--outline[_ngcontent-%COMP%]{border:1px solid #ffffff;background-color:#96a8c099;color:#fff}.badge--small[_ngcontent-%COMP%]{width:32px;height:32px;font-size:.75rem;line-height:1rem}.badge--medium[_ngcontent-%COMP%]{width:40px;height:40px;font-size:.875rem;line-height:1.25rem}.badge--large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1rem;line-height:1.5rem}.badge--x-large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.125rem;line-height:1.75rem}"],changeDetection:0}),t})();var ic;const n8=(n,t)=>({"team-user--light":n,"team-user--dark":t});function i8(n,t){if(1&n&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.user.name||"<Name Unknown>"," ")}}function o8(n,t){1&n&&(e.j41(0,"div",9),e.EFF(1,"Developer"),e.k0s())}function s8(n,t){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.R7$(),e.SpI(" ",o.user.email," ")}}function r8(n,t){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const o=e.XpG();e.AVh("team-user__role--expired","expired"===o.user.invitationStatus),e.R7$(),e.SpI(" ",o.user.invitationStatus?o.user.invitationStatus:o.user.role.role_display_name," ")}}class $g{constructor(){this.showEmail=!1,this.showRole=!0,this.theme="light"}set showNameUnknown(t){this.showName=t||this.user.name.length>0}}var oc;function c8(n,t){if(1&n&&(e.j41(0,"option",14),e.EFF(1),e.k0s()),2&n){const o=t.$implicit;e.Y8G("value",o.role_id),e.R7$(),e.SpI(" ",o.role_display_name," ")}}function d8(n,t){if(1&n&&(e.j41(0,"select",12),e.DNE(1,c8,2,2,"option",13),e.nI1(2,"async"),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,o.userRoles$))}}function _8(n,t){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-team-user",10),e.DNE(2,d8,3,3,"select",11),e.k0s()),2&n){const o=t.$implicit,i=t.index,s=e.XpG();e.Y8G("formGroupName",i),e.R7$(),e.Y8G("user",o)("showEmail",!0)("showNameUnknown",!0)("showRole",!1),e.R7$(),e.Y8G("ngIf",s.data.accept)}}(ic=$g).\u0275fac=function(t){return new(t||ic)},ic.\u0275cmp=e.VBU({type:ic,selectors:[["app-team-user"]],inputs:{user:"user",showEmail:"showEmail",showNameUnknown:"showNameUnknown",showRole:"showRole",theme:"theme"},decls:8,vars:10,consts:[[1,"team-user","flex","flex-row","grow","align-center","items-center",3,"ngClass"],[1,"team-user__badge","mr-3"],["type","outline","size","small",3,"label","icon"],[1,"team-user__text"],["class","team-user__name text-sm","data-test","teamMemberName",4,"ngIf"],["class","team-user__developer",4,"ngIf"],["class","team-user__email text-xs","data-test","teamMemberEmail",4,"ngIf"],["class","team-user__role flex flex-row items-center justify-end mx-2 text-2xs","data-test","teamMemberInfo",3,"team-user__role--expired",4,"ngIf"],["data-test","teamMemberName",1,"team-user__name","text-sm"],[1,"team-user__developer"],["data-test","teamMemberEmail",1,"team-user__email","text-xs"],["data-test","teamMemberInfo",1,"team-user__role","flex","flex-row","items-center","justify-end","mx-2","text-2xs"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-profile-badge",2),e.k0s(),e.j41(3,"div",3),e.DNE(4,i8,2,1,"div",4)(5,o8,2,0,"div",5)(6,s8,2,1,"div",6),e.k0s(),e.DNE(7,r8,2,3,"div",7),e.k0s()),2&t&&(e.Y8G("ngClass",e.l_i(7,n8,"light"===o.theme,"dark"===o.theme)),e.R7$(2),e.Y8G("label",o.user.initials)("icon",o.user.initials?"":"user"),e.R7$(2),e.Y8G("ngIf",o.showName),e.R7$(),e.Y8G("ngIf",o.user.activeDeveloper),e.R7$(),e.Y8G("ngIf",o.showEmail),e.R7$(),e.Y8G("ngIf",o.showRole))},dependencies:[q.YU,q.bT,ZU],styles:[".team-user__badge[_ngcontent-%COMP%]{align-self:center}.team-user__text[_ngcontent-%COMP%]{width:0;flex-grow:1;flex-shrink:1;overflow:hidden}.team-user__name[_ngcontent-%COMP%]{color:#1c2a3f;overflow:hidden;text-overflow:ellipsis}.team-user__developer[_ngcontent-%COMP%]{height:16px;padding:0 8px;margin:4px 0;display:inline-flex;align-items:center;justify-content:center;font-size:8px;color:#374a68;background-color:#eaeff5;border-radius:8px;border:1px solid #96a8c0;text-transform:uppercase}.team-user__email[_ngcontent-%COMP%]{color:#374a68;overflow:hidden;text-overflow:ellipsis}.team-user__role[_ngcontent-%COMP%]{text-transform:uppercase;color:#96a8c0}.team-user__role--expired[_ngcontent-%COMP%]{color:#ed4758}.team-user--dark[_ngcontent-%COMP%]   .team-user__developer[_ngcontent-%COMP%]{background-color:#f9fafd}"],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(ke.isAdmin),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],$g.prototype,"isAdmin$",void 0);class Bg{constructor(t,o,i){this.dialogRef=t,this.formBuilder=o,this.data=i}ngOnInit(){this.action=this.data.accept?"approve":"deny";const t="request"+(this.data.users.length>1?"s":"");this.title=`${(0,m.capitalize)(this.action)} ${(0,m.capitalize)(t)}?`,this.text=`Are you sure you want to ${this.action} the following ${t} to join your team?`,this.initForm()}initForm(){const t=this.data.users.map(o=>this.formBuilder.group({joinRequestKey:o.joinRequestKey,roleId:o.role.role_id}));this.form=this.formBuilder.group({joinRequests:new we.Bm(t)})}createPayload(){const{joinRequests:t}=this.form.value;return t.map(this.data.accept?o=>({join_request_key:o.joinRequestKey,user_role_id:parseInt(o.roleId)}):o=>o.joinRequestKey)}handleConfirmClick(){this.dialogRef.close(this.createPayload())}}(oc=Bg).\u0275fac=function(t){return new(t||oc)(e.rXU(Dt.CP),e.rXU(we.ze),e.rXU(Dt.Vh))},oc.\u0275cmp=e.VBU({type:oc,selectors:[["app-team-join-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],["formArrayName","joinRequests"],[1,"my-3","text-sm"],["class","flex space-between align-center my-2 py-2",3,"formGroupName",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","mat-dialog-close",""],["app-button","","buttonType","primary",3,"click"],[1,"flex","space-between","align-center","my-2","py-2",3,"formGroupName"],[1,"flex","grow",3,"user","showEmail","showNameUnknown","showRole"],["class","input w-auto","formControlName","roleId",4,"ngIf"],["formControlName","roleId",1,"input","w-auto"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){1&t&&(e.j41(0,"h1",0),e.EFF(1),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6),e.k0s(),e.DNE(7,_8,3,6,"div",5),e.k0s()()(),e.j41(8,"div",6)(9,"button",7),e.EFF(10,"Cancel"),e.k0s(),e.j41(11,"button",8),e.bIt("click",function(){return o.handleConfirmClick()}),e.EFF(12),e.k0s()()),2&t&&(e.R7$(),e.JRh(o.title),e.R7$(2),e.Y8G("formGroup",o.form),e.R7$(3),e.JRh(o.text),e.R7$(),e.Y8G("ngForOf",o.data.users),e.R7$(5),e.SpI(" ",o.action," "))},dependencies:[q.Sq,q.bT,Dt.tx,Dt.BI,Dt.E7,Dt.Yi,bi.Q,$g,we.xH,we.y7,we.wz,we.BC,we.cb,we.j4,we.JD,we.$R,we.v8,q.Jj],changeDetection:0}),function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);s>3&&r&&Object.defineProperty(t,o,r)}([(0,l.l6)(ke.getUserRoles),function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",t)}(0,y.c)],Bg.prototype,"userRoles$",void 0);const tv={maxWidth:"100vw",width:"100vw",height:"100vh",panelClass:"full-modal"};let nv=(()=>{var n;class t{get isMobile(){return window.innerWidth<=959}constructor(i,s,r,a,d,f,T){this.dialog=i,this.applicationEventService=s,this.router=r,this.store=a,this.vendorAnalyticsService=d,this.productService=f,this.organizationsService=T}openShareDialog(i,s,r){return this.dialog.open(Xd,{id:go.ShareUrlDialog,data:{title:s,description:r,shareLink:i},width:"480px",maxWidth:"90vw"})}openConfirmDialog(i){const s={id:go.ConfirmDialog,...i};return this.dialog.open(dL,s)}openUpgradeDialog(i=!0){i&&this.closeAllDialogs();const s=this.store.selectSnapshot(ke.getUserProfile),r=this.getContactProfileParams(s),a=s.premium_account_valid?s.premium_account_type:"free",d=(0,m.get)(s,"organizations[0].subscription.type","").toLowerCase(),f=this.store.selectSnapshot(et.isSubscriptionExpired),T=s.premium_account_eligibility.group_free_trial,L=x(s.account_settings),ee=(0,m.get)(L,"account_purpose.value","");let re;if(I.c.native)re="mobile.html";else switch(ee){case Vd.Business:re="business.html";break;case Vd.Education:re="school.html";break;default:re="individual.html"}const ve={...r,accountType:a,subscription:d,expired:f,groupFreeTrial:T},Fe=`${I.c.native?"":{[ri.Z.Local]:"https://localhost:1234",[ri.Z.QA]:"https://pricing-qa.biodigital.com",[ri.Z.Staging]:"https://pricing.biodigital.com",[ri.Z.Production]:"https://pricing.biodigital.com"}[I.c.deploy]}/${re}?${this.serializeQueryParams(ve)}`,Ke={id:go.PricingDialog,...tv,data:{title:"Upgrade",url:Fe,backgroundColor:"#0B1220"}},it=encodeURIComponent(this.router.url);return this.dialog.open(Cy,Ke).afterClosed().subscribe(pt=>{if(pt){const Mt={action:"",plan:"",...pt.metadata},$t={business:["starter","premium","enterprise"],education:["class","institution"]};let _n="Individual";Object.entries($t).forEach(([ze,Je])=>{Je.indexOf(Mt.plan)&&(_n=ze)}),Mt.action&&this.vendorAnalyticsService.track(`Pricing - ${(0,m.capitalize)(Mt.action)} - ${(0,m.capitalize)(Mt.plan)}`,{platform:this.productService.productType,page:_n});let ft="";switch(Mt.action){case"buy":if(I.c.native)return void this.applicationEventService.fireEvent(nt.F.NativeUpgrade);this.router.navigate(["/account/profile"],{queryParams:{section:"subscription",mode:"edit"}});break;case"contact":this.openContactDialog("pricing page");break;case"try":switch(!0){case $t.business.includes(Mt.plan):ft=`/account/workflow/team/create?purpose=Business&returnTo=${it}`;break;case $t.education.includes(Mt.plan):ft=`/account/workflow/team/create?purpose=Education&returnTo=${it}`;break;default:ft="account/workflow"}this.router.navigateByUrl(ft)}}else this.vendorAnalyticsService.track("Pricing - Exit")})}openContactDialog(i=""){const s=this.store.selectSnapshot(et.getOrganization),r=(0,m.isNil)(s)?"":`${s.id}`,a=this.store.selectSnapshot(ke.getUserProfile),d=this.getContactProfileParams(a),f={[ri.Z.Local]:"http://craft-sandbox.biodigital.local",[ri.Z.QA]:"http://craft-sandbox.biodigital.local",[ri.Z.Staging]:"https://www.biodigital.com",[ri.Z.Production]:"https://www.biodigital.com"},T=I.c.native?f[ri.Z.Production]:f[I.c.deploy];if(I.c.native){const L=this.serializeQueryParams({...d,organizationId:r,utm_source:"human-mobile",utm_campaign:i});return window.open(`${T}/contact?${L}`,"_blank")}{const ee=`${T}/headless/contact-us?${this.serializeQueryParams({...d,organizationId:r,utm_source:"human-web",utm_campaign:i})}`,re={id:go.ContactDialog,...tv,data:{title:"Contact Us",url:ee}};return this.dialog.open(Cy,re)}}openPremiumContentDialog(){const i=I.c.native||!this.isMobile;return this.openConfirmDialog({id:go.PremiumContentDialog,data:{titleText:"Premium Content",bodyText:i?"This is premium content. Upgrade to a Premium Plan for unlimited access.":"This is premium content. Visit us on desktop to upgrade to a premium plan.",confirmText:"Upgrade Now",confirmEnabled:i,cancelText:"OK",confirmColor:"warn"}})}openAddUserDialog(){const i=this.store.selectSnapshot(et.getOrganization);this.dialog.open(xg,{id:go.AddTeamModelDialog,disableClose:!1,data:{organization:i}})}openWelcomeTourDialog(i,s){const r={id:go.WelcomeTourDialog,disableClose:!1,data:{userType:i},...s};return this.dialog.open(DU,r)}openUserJoinDialog(i,s){return this.dialog.open(JU,{width:"480px",data:{userEmail:i,organizations:s}})}openTeamJoinDialog(i,s){return this.dialog.open(Bg,{width:"480px",disableClose:!1,data:{users:i,accept:s}})}closeAllDialogs(){this.dialog.closeAll()}getContactProfileParams(i){const{first_name:s,last_name:r,email:a}=i,d=(0,m.get)(i,"organizations[0].name",""),f=(0,m.get)(i,"organizations[0].group_attributes",[]),T=x(i.account_settings),L=(0,m.get)(T,"account_purpose.value",""),ee=(0,m.get)(T,"account_field.value",""),re=(0,m.get)(T,"account_field.value",""),ve=(0,m.get)(T,"account_role.value",""),Oe=this.organizationsService.getOrganizationAttribute(f,"account_settings","account_company_size"),Ee=this.organizationsService.getOrganizationAttribute(f,"account_settings","account_company_website");return{first_name:s,last_name:r,email:a,company:d,website:Ee?Ee.value:"",purpose:L,role:ve,program_type:re,program_size:Oe?Oe.value:"",industry:L===Vd.Education?"Academia":ee}}serializeQueryParams(i){return Object.entries(i).map(([s,r])=>{const a="string"!=typeof r?JSON.stringify(r):r;return`${s}=${encodeURIComponent(a)}`}).join("&")}}return(n=t).\u0275fac=function(i){return new(i||n)(e.KVO(Dt.bZ),e.KVO(po.S),e.KVO(ne.Ix),e.KVO(l.il),e.KVO(qe),e.KVO(je),e.KVO(he))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var er,sc=function(n,t,o,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,o,i);else for(var d=n.length-1;d>=0;d--)(a=n[d])&&(r=(s<3?a(r):s>3?a(t,o,r):a(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},ki=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)};let tr=((er=class{static getOpenDialog(t){return t.openDialog}openPremiumContent(t,o){this.dialogService.openPremiumContentDialog().afterClosed().subscribe(s=>{t.dispatch(new Eo.ClosePremiumContent(s))})}closePremiumContent(t,o){o.confirmed&&t.dispatch(new Eo.OpenUpgrade)}openUpgrade(t,o){this.dialogService.openUpgradeDialog()}constructor(t){this.dialogService=t}}).\u0275fac=function(t){return new(t||er)(e.KVO(nv))},er.\u0275prov=e.jDH({token:er,factory:er.\u0275fac}),er);sc([(0,l.rc)(Eo.OpenPremiumContent),ki("design:type",Function),ki("design:paramtypes",[Object,Eo.OpenPremiumContent]),ki("design:returntype",void 0)],tr.prototype,"openPremiumContent",null),sc([(0,l.rc)(Eo.ClosePremiumContent),ki("design:type",Function),ki("design:paramtypes",[Object,Eo.ClosePremiumContent]),ki("design:returntype",void 0)],tr.prototype,"closePremiumContent",null),sc([(0,l.rc)(Eo.OpenUpgrade),ki("design:type",Function),ki("design:paramtypes",[Object,Eo.OpenUpgrade]),ki("design:returntype",void 0)],tr.prototype,"openUpgrade",null),sc([(0,l.MD)(),ki("design:type",Function),ki("design:paramtypes",[class rL{}]),ki("design:returntype",void 0)],tr,"getOpenDialog",null),tr=sc([(0,l.Uw)({name:"dialog",defaults:{openDialog:null}}),ki("design:paramtypes",[nv])],tr);let iv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),ov=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),sv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),rv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),av=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,we.YN,we.X1,Nt.G]}),t})();var lv=_(59464);let cv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),dv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),_v=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,yi.o,Oi.C]}),t})();var u8=_(64026);let g8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,we.YN,od.D,we.X1,Yl.M,Oi.C,py,lv.j,yi.o,u8.m,Sg.H]}),t})(),pv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1,g8,Og]}),t})(),h8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),m8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),uv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),gv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),hv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),f8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.YN,we.X1]}),t})(),mv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,pi.y2.forChild()]}),t})(),fv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1,Og]}),t})(),Sv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),bv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),yv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),vv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G]}),t})(),Ev=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Nt.G,we.X1]}),t})(),S8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([tr]),hy,my,fv,fy,hv,Sy,by,_v,yy,vy,Ey,iv,ov,sv,rv,av,cv,dv,pv,uv,gv,Ev,lv.j,od.D,Nt.G,mv,Sv,bv,yv,vv,hy,my,fv,fy,hv,Sy,by,_v,yy,vy,Ey,iv,pv,ov,sv,rv,av,cv,dv,h8,m8,uv,gv,Ev,uy,f8,mv,Sv,bv,yv,vv]}),t})(),b8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,yi.o]}),t})();var y8=_(46374),v8=_(6049);let E8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD]}),t})();var C8=_(18824),T8=_(90556);let O8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,It.G,Oi.C,Ql.h,yi.o,Ud,Sg.H,we.X1,vg,Yl.M]}),t})();const M8=[];let I8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[ne.iI.forChild(M8),ne.iI]}),t})();var Cv=_(5584);let Tv=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,Qi.Pd,It.G]}),t})(),w8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,Qi.Pd,Oi.C,It.G,Tg,yi.o,Cv.d,we.YN,Tv,Yl.M,Nt.G]}),t})();var P8=_(64218);let A8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,yi.o,P8.H,Oi.C]}),t})(),N8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([Ni]),q.MD]}),t})(),R8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([_e]),l.rK.forFeature([Be]),pi.y2.forChild(),Qi.Pd,kd,Oi.C,q.MD,Ud,Ql.h,Tg,we.YN,yi.o,is.Un,It.G,N8,yg.G,b8,y8.b,v8.Y,E8,Yl.M,vg,we.X1,Nt.G,Eg,C8.j,Cv.d,T8.f,Tv,w8,O8,I8,A8,Cg,zs.Ez,jd,ud,jS,yu,_d,md]}),t})(),Ov=(()=>{var n;class t{intercept(i,s){return s.handle(i).pipe((0,le.T)(r=>(r instanceof w.cS&&r.body&&r.body.hasOwnProperty("results")&&(r=r.clone({body:r.body.results})),r)))}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac}),t})(),D8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({providers:[zu],imports:[l.rK.forFeature([Z]),q.MD,Nt.G]}),t})(),k8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,ne.iI,Oi.C,Ql.h,yi.o,gy,jd]}),t})(),Mv=(()=>{var n;class t{parse(i){i=i.replace(/&amp;/g,"&");const r=(new ne.nU).parse(i);return this.ensureQueryParam(r.queryParams,"dk",i),this.ensureQueryParam(r.queryParams,"uaid",i),r}serialize(i){return(new ne.nU).serialize(i).replace(/%2F/g,"/")}ensureQueryParam(i,s,r){if(i.hasOwnProperty(s))return i;const a=this.getParameterByName(s,r);return null!==a&&(i[s]=a),i}getParameterByName(i,s){s||(s=window.location.href),i=i.replace(/[\[\]]/g,"\\$&");const a=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(s);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac}),t})(),L8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([In]),q.MD]}),t})(),U8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[l.rK.forFeature([An]),q.MD]}),t})();var j8=_(40832);function V8(){const n=new j8.A4;return n.link=(t,o,i)=>`<a href="${function x8(n){return n.match(/^(?:(?:(?:ht)tps?):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i)?n:""}(t)}" target="_blank" rel="noreferrer nofollow">${i}</a>`,n.paragraph=t=>`<p>${t}</p>`,n.image=(t,o,i)=>"",{renderer:n,gfm:!1}}let F8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,pi.y2.forRoot({markedOptions:{provide:pi.GY,useFactory:V8}})]}),t})(),G8=(()=>{var n;class t{static forRoot(i){return{ngModule:t,providers:[qe,{provide:"vendorAnalyticsConfig",useValue:i}]}}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({}),t})(),$8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[q.MD,l.rK.forFeature([Di])]}),t})();var Qd=_(4845);Nn.IP(),Nn.YT(),Nn.ht(!1);const B8=[{provide:w.a7,useClass:Ov,multi:!0},{provide:ne.Sd,useClass:Mv},{provide:q.kB,useValue:"./"},{provide:q.hb,useClass:q.fw},{provide:Qd.g8,useFactory:Qd.f_}],z8=[{provide:w.a7,useClass:Ov,multi:!0},{provide:ne.Sd,useClass:Mv},{provide:Qd.g8,useFactory:Qd.ht}];let W8=(()=>{var n;class t{}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n,bootstrap:[Jp]}),n.\u0275inj=e.G2t({providers:!0===I.c.offline?B8:z8,imports:[l.rK.forRoot(),L8,Zb.forRoot(),G8.forRoot({enabled:!1,pendoId:I.c.pendoId,hubspotId:I.c.hubspotId}),F8,c.Bb,O.wb,w.q1,jd,Tg,Cg,kd,gy,sL,Eg,U8,S8,R8,k8,D8,$8,UE,gk]}),t})();I.c.production&&(0,e.SmG)(),c.sG().bootstrapModule(W8).catch(n=>console.error(n))},95904:()=>{},42634:()=>{}},Se=>{Se.O(0,[502],()=>Se(Se.s=66323)),Se.O()}]);