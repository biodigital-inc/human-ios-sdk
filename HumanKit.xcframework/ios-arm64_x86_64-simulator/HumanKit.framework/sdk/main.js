(self.webpackChunkviewer=self.webpackChunkviewer||[]).push([[792],{46842:(be,q,d)=>{"use strict";d.d(q,{U:()=>$});var c=d(92014),e=d(54438),y=function(j,m,O,V){var M,I=arguments.length,L=I<3?m:null===V?V=Object.getOwnPropertyDescriptor(m,O):V;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)L=Reflect.decorate(j,m,O,V);else for(var S=j.length-1;S>=0;S--)(M=j[S])&&(L=(I<3?M(L):I>3?M(m,O,L):M(m,O))||L);return I>3&&L&&Object.defineProperty(m,O,L),L},l=function(j,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(j,m)};const X={prefersReducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches};let $=class id{static getPrefersReducedMotion(m){return m.prefersReducedMotion}static#e=this.\u0275fac=function(O){return new(O||id)};static#t=this.\u0275prov=e.jDH({token:id,factory:id.\u0275fac})};y([(0,c.MD)(),l("design:type",Function),l("design:paramtypes",[Object]),l("design:returntype",void 0)],$,"getPrefersReducedMotion",null),$=y([(0,c.Uw)({name:"accessibility",defaults:X})],$)},27153:(be,q,d)=>{"use strict";d.d(q,{E:()=>O,Iw:()=>L,NP:()=>M,eu:()=>I,fQ:()=>X,mY:()=>$,n3:()=>l});var c=d(71217),e=d(30234);const l={[e.a.WoltersKluwer]:"Wolters Kluwer",[e.a.Zspace]:"zSpace"},X={[e.a.WoltersKluwer]:"https://tools.ovid.com/support/index_inner.html",[e.a.Zspace]:"https://support.zspace.com/s/contactsupport"},$={[e.a.WoltersKluwer]:"HLRP-AcademicOperations@wolterskluwer.com"};function O(f){return!f?.organizations[0]?.external_account?.is_external_account&&function m(f){return!0===f?.premium_account_valid||"group"===f?.premium_account_type}(f)}function I(f){return`/login?${b(f)}`}function L(f){return`/login/create?${b(f)}`}function M(f,U="",C=""){return`mailto:${f}?subject=${encodeURIComponent(U)}&body=${encodeURIComponent(C)}`}function b(f){const U=new URLSearchParams;if(f?.type===c.P.Organization){const T=f.data,w=T?.session_source,v=T?.session_source_id;"ovid_osptok"===w&&U.append("osptok",v)}return U}},20342:(be,q,d)=>{"use strict";d.d(q,{O:()=>l,g:()=>X});const y=`https://www.biodigital.com?utm_source=${d(24418).c.native?"human_mobile":"human_web"}&utm_medium=PLG&utm_campaign=poweredby&ref=poweredby`,l={default:"./assets/images/powered-by-biodigital-color.svg",human_app:{default:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:y}},viewer:{viewer_logo_setting:null,full_dark:{logo_url:"./assets/images/powered-by-biodigital-color.svg",logo_linkout_url:y},full_light:{logo_url:"./assets/images/powered-by-biodigital-white.svg",logo_linkout_url:y},square_dark:{logo_url:"./assets/images/logo-color.svg",logo_linkout_url:y},square_light:{logo_url:"./assets/images/logo-white.svg",logo_linkout_url:y}}};function X($,j,m){const{full_dark:O,full_light:V,square_dark:I,square_light:L}=$.viewer;switch(j){case"full":return"color"===m?O:V;case"small":return"color"===m?I:L}}},71217:(be,q,d)=>{"use strict";d.d(q,{P:()=>c});var c=function(e){return e.User="user",e.Organization="organization",e}(c||{})},74394:(be,q,d)=>{"use strict";d.d(q,{Ht:()=>O,L7:()=>X,NB:()=>$,Pg:()=>C,Ub:()=>f,Ue:()=>l,VM:()=>S,a:()=>m,iE:()=>j,oM:()=>V});const l={title:"Tags",tags:["Animated","Tour","Quiz","featured","new",d(30234).a.Zspace,"read only"]},X={title:"Gender",tags:["male","female"]},$={title:"Pregnancy",tags:["First Trimester","Second Trimester","Third Trimester"]},j={title:"Regions",tags:["Head and Neck","Thorax","Abdomen","Back","Upper Limb","Pelvis","Lower Limb"]},m={title:"Type (Deprecated)",tags:["Anatomy","Disease","Pharmacology","Physiology","Procedure"]},O={title:"Type",tags:["Anatomy and Physiology","Conditions","Procedures and Treatments"]},V={title:"Level of Detail",tags:["Gross Anatomy","Tissue","Cellular","Molecular"]},S={title:"Downloaded",tags:["Downloaded"]},f={title:"Permissions",tags:["My Models","View & Edit","View Only"]},C=[{title:"Status",tags:["Live","obsolete"]},{title:"Platform",tags:["web platform","ios platform","android platform"]},l,X,O,m,V,{title:"Anatomy Categories",tags:["complete anatomy","system","regional","Bony Landmarks, Origins, and Insertions","Cross Section","Cross Sections and Microanatomy","Donor Scans","Guided Anatomy","Micro Anatomy"]},{title:"Clinical Specialty",tags:["Allergy and Immunology","Cardiology","Dentistry","Dermatology","Endocrinology","Gastroenterology and Hepatology","Gynecology","Hematology","Infectious Disease","Neurology and Psychiatry","Obstetrics","Oncology","Ophthalmology","Orthopedics and Rheumatology","Ear, Nose, and Throat","Pediatrics","Physical Therapy","Primary Care","Pulmonology and Respiratory","Urology and Nephrology"]},S,f,j,$]},47632:(be,q,d)=>{"use strict";d.d(q,{$H:()=>tt,A:()=>S,B7:()=>A,B9:()=>U,C$:()=>Ue,CF:()=>we,CR:()=>m,Cr:()=>te,D3:()=>Z,DN:()=>O,ET:()=>at,F_:()=>Te,GZ:()=>Se,Gr:()=>e,HN:()=>W,I0:()=>Y,J9:()=>T,Kf:()=>l,Ln:()=>ke,M:()=>E,Mo:()=>Ee,Mv:()=>H,Ny:()=>Q,PS:()=>yt,PU:()=>y,Pd:()=>N,Qw:()=>V,Ri:()=>f,U8:()=>pe,Ur:()=>M,VN:()=>ie,Xt:()=>X,ZA:()=>re,ZW:()=>se,Zp:()=>oe,a1:()=>x,cK:()=>ge,dc:()=>De,eW:()=>p,e_:()=>K,g:()=>R,iw:()=>h,iy:()=>I,j5:()=>w,lN:()=>D,ov:()=>v,pE:()=>u,sN:()=>$,te:()=>Qe,u:()=>B,x$:()=>L,yH:()=>C,zP:()=>k,zW:()=>z,zX:()=>j});var c=d(11040);let e=(()=>{class Oe{static#e=this.type="[Bookmarks] Load";constructor(ce,ve){this.query=ce,this.lang=ve}}return Oe})(),y=(()=>{class Oe{static#e=this.type="[Bookmarks] Load Organization Bookmarks";constructor(ce,ve,Ne){this.organizationId=ce,this.query=ve,this.lang=Ne}}return Oe})(),l=(()=>{class Oe{static#e=this.type="[Bookmarks] Load Collection Bookmarks";constructor(ce,ve,Ne,jt){this.organizationId=ce,this.collectionId=ve,this.query=Ne,this.lang=jt}}return Oe})(),X=(()=>{class Oe{static#e=this.type="[Bookmarks] Select Bookmark";constructor(ce,ve,Ne=!1){this.id=ce,this.type=ve,this.preview=Ne}}return Oe})(),$=(()=>{class Oe{static#e=this.type="[Bookmarks] Select Bookmark Success";constructor(ce){this.bookmark=ce}}return Oe})(),j=(()=>{class Oe{static#e=this.type="[Bookmarks] Load Success";constructor(ce){this.result=ce}}return Oe})(),m=(()=>{class Oe{static#e=this.type="[Bookmarks] Delete Bookmark";constructor(ce){this.bookmarkId=ce}}return Oe})(),O=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Delete Success";constructor(ce){this.bookmarkId=ce}}return Oe})(),V=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Delete Fail";constructor(ce,ve){this.bookmarkId=ce,this.error=ve}}return Oe})(),I=(()=>{class Oe{static#e=this.type="[Bookmarks] Save Bookmark";constructor(ce,ve,Ne){this.bookmarkEntry=ce,this.serializeScene=ve,this.includeCameraPositions=Ne}}return Oe})(),L=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Saved";constructor(ce,ve,Ne){this.bookmark=ce,this.story=ve,this.method=Ne}}return Oe})(),M=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Save Failed";constructor(ce,ve){this.bookmarkEntry=ce,this.error=ve}}return Oe})(),S=(()=>{class Oe{static#e=this.type="[Bookmarks] Cancel Save Bookmark"}return Oe})(),f=(()=>{class Oe{static#e=this.type="[Bookmarks] Reset"}return Oe})(),U=(()=>{class Oe{static#e=this.type="[Bookmarks] Clear Bookmarks"}return Oe})(),C=(()=>{class Oe{static#e=this.type="[Bookmarks] Sort";constructor(ce){this.sort=ce}}return Oe})(),T=(()=>{class Oe{static#e=this.type="[Bookmarks] Check Bookmark";constructor(ce,ve){this.id=ce,this.checked=ve}}return Oe})(),w=(()=>{class Oe{static#e=this.type="[Bookmarks] Set Checked Bookmarks";constructor(ce){this.ids=ce}}return Oe})(),v=(()=>{class Oe{static#e=this.type="[Bookmarks] Export Bookmarks";constructor(ce,ve,Ne,jt,pt,ct,ze,Hn,Pi){this.bookmarks=ce,this.organizationId=ve,this.collections=Ne,this.widgetURL=jt,this.userLanguage=pt,this.userApp=ct,this.widgetOptions=ze,this.offlineEnabled=Hn,this.productAccountId=Pi}}return Oe})(),A=(()=>{class Oe{static#e=this.type="[Bookmarks] Export Bookmarks Success";constructor(ce){this.bookmarks=ce}}return Oe})(),R=(()=>{class Oe{static#e=this.type="[Bookmarks] Export Bookmarks Error";constructor(ce){this.bookmarks=ce}}return Oe})(),N=(()=>{class Oe{static#e=this.type="[Bookmarks] Update Bookmark Collections";constructor(ce,ve=[],Ne=new Map){this.bookmark=ce,this.addCollections=ve,this.removeCollections=Ne}}return Oe})(),B=(()=>{class Oe{static#e=this.type="[Bookmarks] Update Bookmark Collections Success";constructor(ce,ve,Ne){this.bookmark=ce,this.addCollections=ve,this.removeCollections=Ne}}return Oe})(),Q=(()=>{class Oe{static#e=this.type="[Bookmarks] Update Bookmark Collections Error";constructor(ce,ve,Ne){this.bookmark=ce,this.addCollections=ve,this.removeCollections=Ne}}return Oe})(),H=(()=>{class Oe{static#e=this.type="[Bookmarks] Add Bookmark Collections Success";constructor(ce,ve){this.bookmark=ce,this.collections=ve}}return Oe})(),Z=(()=>{class Oe{static#e=this.type="[Bookmarks] Add Bookmark Collections Error";constructor(ce,ve){this.bookmark=ce,this.collections=ve}}return Oe})(),k=(()=>{class Oe{static#e=this.type="[Bookmarks] Remove Bookmark Collections Success";constructor(ce,ve){this.bookmark=ce,this.collections=ve}}return Oe})(),h=(()=>{class Oe{static#e=this.type="[Bookmarks] Remove Bookmark Collections Error";constructor(ce,ve){this.bookmark=ce,this.collections=ve}}return Oe})(),p=(()=>{class Oe{static#e=this.type="[Bookmarks] Copy Bookmark";constructor(ce,ve,Ne,jt=c.q.lang,pt,ct){this.id=ce,this.title=ve,this.type=Ne,this.lang=jt,this.groupAccess=pt,this.collections=ct}}return Oe})(),D=(()=>{class Oe{static#e=this.type="[Bookmarks] Copy Bookmark Success";constructor(ce,ve){this.bookmark=ce,this.story=ve}}return Oe})(),te=(()=>{class Oe{static#e=this.type="[Bookmarks] Copy Bookmark Failure";constructor(ce,ve){this.id=ce,this.error=ve}}return Oe})(),E=(()=>{class Oe{static#e=this.type="[Bookmarks] Cancel Copy Bookmark"}return Oe})(),K=(()=>{class Oe{static#e=this.type="[Bookmarks] Set Bookmark Text";constructor(ce){this.title=ce}}return Oe})(),u=(()=>{class Oe{static#e=this.type="[Bookmarks] Set Bookmark View Mode";constructor(ce){this.viewMode=ce}}return Oe})(),x=(()=>{class Oe{static#e=this.type="[Bookmarks] Set Selected Category";constructor(ce){this.category=ce}}return Oe})(),z=(()=>{class Oe{static#e=this.type="[Bookmarks] Get Bookmark Jobs"}return Oe})(),oe=(()=>{class Oe{static#e=this.type="[Bookmarks] Set Bookmark Jobs";constructor(ce){this.bookmarkJobs=ce}}return Oe})(),ge=(()=>{class Oe{static#e=this.type="[Bookmarks] Get Bookmark Jobs Success";constructor(ce){this.bookmarkJobs=ce}}return Oe})(),ie=(()=>{class Oe{static#e=this.type="[Bookmarks] Get Bookmark Jobs Failure";constructor(ce){this.error=ce}}return Oe})(),Y=(()=>{class Oe{static#e=this.type="[Bookmarks] Cancel Bookmark Job";constructor(ce,ve){this.jobId=ce,this.jobType=ve}}return Oe})(),W=(()=>{class Oe{static#e=this.type="[Bookmarks] Cancel Bookmark Job Success";constructor(ce,ve){this.jobId=ce,this.jobType=ve}}return Oe})(),Ee=(()=>{class Oe{static#e=this.type="[Bookmarks] Cancel Bookmark Job Fail";constructor(ce,ve,Ne){this.jobId=ce,this.jobType=ve,this.error=Ne}}return Oe})(),re=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Copy Bookmarks";constructor(ce){this.copyBookmarkModels=ce}}return Oe})(),Se=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Copy Bookmarks Processing";constructor(ce,ve){this.copyBookmarkModels=ce,this.jobId=ve}}return Oe})(),se=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Copy Bookmarks Error"}return Oe})(),pe=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Copy Bookmarks Complete"}return Oe})(),Te=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Copy Bookmarks Failure";constructor(ce,ve){this.copyBookmarkModels=ce,this.error=ve}}return Oe})(),we=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Delete Bookmark";constructor(ce){this.bookmarkIds=ce}}return Oe})(),Qe=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Bulk Delete Processing";constructor(ce,ve){this.deleteBookmarkIds=ce,this.jobId=ve}}return Oe})(),tt=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Bulk Delete Complete"}return Oe})(),Ue=(()=>{class Oe{static#e=this.type="[Bookmarks] Bookmark Bulk Delete Fail";constructor(ce,ve){this.bookmarkIds=ce,this.error=ve}}return Oe})(),yt=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Delete Bookmarks Error"}return Oe})(),ke=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Update Bookmark Collections";constructor(ce,ve){this.groupId=ce,this.updates=ve}}return Oe})(),at=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Update Bookmark Collections Success";constructor(ce){this.updates=ce}}return Oe})(),De=(()=>{class Oe{static#e=this.type="[Bookmarks] Bulk Update Bookmark Collections Error";constructor(ce,ve){this.updates=ce,this.error=ve}}return Oe})()},13976:(be,q,d)=>{"use strict";d.d(q,{V:()=>l});var c=d(65776),e=d(54438);const y={[c.m.Markdown]:({markdown:X})=>0===(X??"").length,[c.m.Images]:({images:X})=>0===X.length,[c.m.AnimatedImages]:({images:X})=>0===X.length,[c.m.Ticker]:({images:X})=>0===X.length,[c.m.Videos]:({videos:X})=>0===X.length,[c.m.Positions]:({positions:X})=>0===X.length,[c.m.CTA]:({url:X})=>0===(X??"").length};let l=(()=>{class X{isContentBlockType(j,m){return j?.type===m}isTickerBlock(j){return this.isContentBlockType(j,c.m.Ticker)}isImageBlock(j){return this.isContentBlockType(j,c.m.Images)}isAnimatedImageBlock(j){return this.isContentBlockType(j,c.m.AnimatedImages)}isEmptyBlock(j){return!0===y[j?.type]?.(j)}filterEmptyBlocks(j){return j.filter(m=>!this.isEmptyBlock(m))}filterContentBlocksByType(j,m=[],O=[]){return j.filter(V=>!m.length||m.includes(V.type)).filter(V=>!O.length||!O.includes(V.type))}findContentBlockByType(j,m){return this.filterContentBlocksByType(j,[m])[0]}extractContentBlockText(j,m=""){return j?j.filter(O=>O.type===c.m.Markdown).map(O=>O.markdown).join(m):""}hasContentBlockText(j){return""!==this.extractContentBlockText(j)}static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275prov=e.jDH({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},65776:(be,q,d)=>{"use strict";d.d(q,{m:()=>c});var c=function(e){return e.Markdown="markdown",e.Images="images",e.AnimatedImages="animatedImages",e.Ticker="ticker",e.Videos="videos",e.Positions="positions",e.CTA="cta",e}(c||{})},11153:(be,q,d)=>{"use strict";d.d(q,{hw:()=>y,v9:()=>c,vf:()=>e});let c=(()=>{class l{static#e=this.type="[AppConfig] Set View Logos";constructor($){this.logoConfig=$}}return l})(),e=(()=>{class l{static#e=this.type="[AppConfig] Set Header Logos";constructor($){this.logoConfig=$}}return l})(),y=(()=>{class l{static#e=this.type="[AppConfig] Reset";constructor(){}}return l})()},98020:(be,q,d)=>{"use strict";d.d(q,{X:()=>O});var c=d(92014);class e{}var y=d(20342),l=d(11153),X=d(54438),$=function(V,I,L,M){var f,S=arguments.length,b=S<3?I:null===M?M=Object.getOwnPropertyDescriptor(I,L):M;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)b=Reflect.decorate(V,I,L,M);else for(var U=V.length-1;U>=0;U--)(f=V[U])&&(b=(S<3?f(b):S>3?f(I,L,b):f(I,L))||b);return S>3&&b&&Object.defineProperty(I,L,b),b},j=function(V,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(V,I)};const m={viewLogoConfig:y.O,headerLogoConfig:y.O};let O=class od{static getViewLogoConfig(I){return I.viewLogoConfig}static getHeaderLogoConfig(I){return I.headerLogoConfig}setLogos(I,{logoConfig:L}){I.patchState({viewLogoConfig:L})}setAppHeaderLogos(I,{logoConfig:L}){I.patchState({headerLogoConfig:L})}resetAppConfig(I){I.setState({...m})}static#e=this.\u0275fac=function(L){return new(L||od)};static#t=this.\u0275prov=X.jDH({token:od,factory:od.\u0275fac})};$([(0,c.rc)(l.v9),j("design:type",Function),j("design:paramtypes",[Object,l.v9]),j("design:returntype",void 0)],O.prototype,"setLogos",null),$([(0,c.rc)(l.vf),j("design:type",Function),j("design:paramtypes",[Object,l.v9]),j("design:returntype",void 0)],O.prototype,"setAppHeaderLogos",null),$([(0,c.rc)(l.hw),j("design:type",Function),j("design:paramtypes",[Object]),j("design:returntype",void 0)],O.prototype,"resetAppConfig",null),$([(0,c.MD)(),j("design:type",Function),j("design:paramtypes",[e]),j("design:returntype",void 0)],O,"getViewLogoConfig",null),$([(0,c.MD)(),j("design:type",Function),j("design:paramtypes",[e]),j("design:returntype",void 0)],O,"getHeaderLogoConfig",null),O=$([(0,c.Uw)({name:"appConfig",defaults:{...m}})],O)},65294:(be,q,d)=>{"use strict";d.d(q,{F:()=>c});var c=function(e){return e.AnnotationsCreated="annotations.created",e.AnnotationsDestroyed="annotations.destroyed",e.AnnotationsHidden="annotations.hidden",e.AnnotationsShown="annotations.shown",e.QuizEntered="quiz.entered",e.QuizExited="quiz.exited",e.QuizQuestionLoaded="quiz.questionLoaded",e.QuizAnswerSelected="quiz.answerSelected",e.QuizAnswerSubmitted="quiz.answerSubmitted",e.QuizCompleted="quiz.completed",e.LabelsCreated="labels.created",e.LabelsUpdated="labels.updated",e.LabelsMoved="labels.moved",e.LabelsDestroyed="labels.destroyed",e.LabelsChapterInfo="labels.chapterInfo",e.LabelsShown="labels.shown",e.LabelsHidden="labels.hidden",e.LabelsEnabled="labels.enabled",e.LabelsDisabled="labels.disabled",e.LabelsEntered="labels.entered",e.LabelsLeft="labels.left",e.LabelsPicked="labels.picked",e.HotspotsDisplayUpdated="hotspots.displayUpdated",e.HotspotsEntered="hotspots.entered",e.HotspotsLeft="hotspots.left",e.HotspotsPicked="hotspots.picked",e.HotspotsPositionUpdated="hotspots.positionUpdated",e.NativeDeleteData="native.deleteData",e.NativeUpgrade="native.upgrade",e.NativeRestore="native.restore",e.NativeShare="native.share",e.NativeGoogleSignUp="native.googleSignUp",e.NativeDebugMessage="native.debugMessage",e.NativeSetSdkOffline="native.setSdkOffline",e.NativeSetBaseDirectory="native.setBaseDirectory",e.WhiteboardDrawingStarted="whiteboard.drawingStarted",e.WhiteboardDrawingFinished="whiteboard.drawingFinished",e.WhiteboardModeUpdated="whiteboard.modeUpdated",e.UIUpdated="ui.updated",e.UIWindowUpdated="ui.windowUpdated",e}(c||{})},83621:(be,q,d)=>{"use strict";d.d(q,{S:()=>y});var c=d(26982),e=d(54438);let y=(()=>{class l extends c.U{static#e=this.\u0275fac=(()=>{let $;return function(m){return($||($=e.xGo(l)))(m||l)}})();static#t=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},26982:(be,q,d)=>{"use strict";d.d(q,{U:()=>e});var c=d(85052);class e{constructor(){this._subjects={}}getEvent(l){return(this._subjects[l]=this._subjects[l]??new c.B).asObservable()}fireEvent(l,X){const $=this._subjects[l];$&&$.next(X)}}},10352:(be,q,d)=>{"use strict";d.d(q,{RK:()=>c});const c={colors:[245,245,245,1,245,245,245,1],gradientType:"radial",colorStops:[0,100]}},84370:(be,q,d)=>{"use strict";d.d(q,{t:()=>c});var c=function(e){return e.AboutDialog="AboutDialog",e.AddTeamModelDialog="AddTeamModelDialog",e.AssignUserRoleDialog="AssignUserRoleDialog",e.BulkUpdateDialog="BulkUpdateDialog",e.BookmarkAccessDialog="BookmarkAccessDialog",e.ShareUrlDialog="ShareUrlDialog",e.ConfirmDialog="ConfirmDialog",e.ContactDialog="ContactDialog",e.GroupRestrictionDialog="GroupRestrictionDialog",e.ImageDialog="ImageDialog",e.VideoDialog="VideoDialog",e.ImportDialog="ImportDialog",e.JoinDomainDialog="JoinDomainDialog",e.LimitDialog="LimitDialog",e.ManageDialog="ManageDialog",e.PremiumContentDialog="PremiumContentDialog",e.PricingDialog="PricingDialog",e.ProfileDialog="ProfileDialog",e.QuizSettingsDialog="QuizSettingsDialog",e.SaveAsBookmarkDialog="SaveAsBookmarkDialog",e.SaveBookmarkDialog="SaveBookmarkDialog",e.SaveModuleDialog="SaveModuleDialog",e.TransferUserContentDialog="TransferUserContentDialog",e.RemoveUserDialog="RemoveUserDialog",e.MergeModuleDialog="MergeModuleDialog",e.MergeConflictDialog="MergeConflictDialog",e.WelcomeTourDialog="WelcomeTourDialog",e.TrialExpiredDialog="TrialExpiredDialog",e.PremiumAccessDialog="PremiumAccessDialog",e.ConfirmRoleDialog="ConfirmRoleDialog",e.CollectionNameDialog="CollectionNameDialog",e.PublicViewGateDialog="PublicViewGateDialog",e.BookmarkJobsDialog="BookmarkJobsDialog",e.BulkAddModelDialog="BulkAddModelDialog",e.BulkDeleteModelDialog="BulkDeleteModelDialog",e.BentoDialog="BentoDialog",e}(c||{})},1102:(be,q,d)=>{"use strict";d.d(q,{H:()=>m,ql:()=>V,Sf:()=>O});class c{constructor(f={center:[0,0,0],edge:[1,1,1],centerBias:1,edgeBias:0,power:1}){const{edge:U,center:C,centerBias:T,edgeBias:w,power:v}=f;this.edge=U,this.center=C,this.centerBias=T,this.edgeBias=w,this.power=v}static toEngine(f){const{center:U,edge:C,centerBias:T,edgeBias:w,power:v}=f;return[[...U],[...C],T,w,v]}}var e=d(1367),y=d(49204);function l(b,f){switch(!0){case void 0===b[f]:return;case!1===b[f]:return!1;case"number"==typeof b[f]:return 100*b[f];default:return new e.R({center:b[f][0],edge:b[f][1],centerBias:b[f][2],edgeBias:b[f][3],power:b[f][4]})}}function $(b){return!(0,y.isNil)(b)&&Object.prototype.hasOwnProperty.call(b,"edge")&&Object.prototype.hasOwnProperty.call(b,"edgeBias")&&Object.prototype.hasOwnProperty.call(b,"center")&&Object.prototype.hasOwnProperty.call(b,"centerBias")&&Object.prototype.hasOwnProperty.call(b,"power")}function m(b){return{tintColor:(()=>{switch(!0){case void 0===b.tintColor:return;case!1===b.tintColor:return!1;case Array.isArray(b.tintColor):return 3===b.tintColor.length?[...b.tintColor]:new c({center:b.tintColor[0],edge:b.tintColor[1],centerBias:b.tintColor[2],edgeBias:b.tintColor[3],power:b.tintColor[4]})}})(),saturation:l(b,"saturation"),brightness:l(b,"brightness"),contrast:l(b,"contrast"),opacity:l(b,"opacity")}}function O(b){let f=!1!==b.tintColor&&void 0,U=!1!==b.saturation&&void 0,C=!1!==b.brightness&&void 0,T=!1!==b.contrast&&void 0,w=!1!==b.opacity&&void 0;return Array.isArray(b.tintColor)?f=[...b.tintColor]:$(b.tintColor)&&(f=c.toEngine(b.tintColor)),"number"==typeof b.saturation?U=b.saturation/100:$(b.saturation)&&(U=e.R.toEngine(b.saturation)),"number"==typeof b.brightness?C=b.brightness/100:$(b.brightness)&&(C=e.R.toEngine(b.brightness)),"number"==typeof b.contrast?T=b.contrast/100:$(b.contrast)&&(T=e.R.toEngine(b.contrast)),"number"==typeof b.opacity?w=b.opacity/100:$(b.opacity)&&(w=e.R.toEngine(b.opacity)),{tintColor:f,saturation:U,brightness:C,contrast:T,opacity:w}}function V(b,f){const U=Object.assign({},b);for(const[C,T]of Object.entries(f))typeof T<"u"&&(U[C]=T);return U}},58398:(be,q,d)=>{"use strict";d.d(q,{Jl:()=>X,UD:()=>$,c7:()=>m,n4:()=>l});var c=d(49204);function l(O,V){return!(!O||!V)&&JSON.stringify(O,Object.keys(O).sort())===JSON.stringify(V,Object.keys(V).sort())}function X(O){return!(0,c.isNil)(O)&&(!(0,c.isNil)(O.brightness)&&!1!==O.brightness||!(0,c.isNil)(O.contrast)&&!1!==O.contrast||!(0,c.isNil)(O.opacity)&&!1!==O.opacity||!(0,c.isNil)(O.saturation)&&!1!==O.saturation||!(0,c.isNil)(O.tintColor)&&!1!==O.tintColor)}function $(O,V){try{const I=j(O),L=j(V),M=!1===O.opacity?1:O.opacity,S=!1===V.opacity?1:V.opacity;return I===L?M===S?O.saturation===V.saturation?O.brightness===V.brightness?O.contrast>V.contrast?I+4:I-4:O.brightness>V.brightness?I+3:I-3:O.saturation>V.saturation?I+2:I-2:M>S?I+1:I-1:I-L}catch{return 0}}function j(O){if(!O.tintColor)return-10;const V=O.tintColor[0],I=O.tintColor[1],L=O.tintColor[2],M=Math.max(V,I,L),b=M-Math.min(V,I,L);let f=0;return f=M===V?(I-L)/b:M===I?2+(L-V)/b:4+(V-I)/b,f*=60,f<0&&(f+=360),f}function m(O){const V=new Map;return O.filter(L=>{const M=JSON.stringify(L,Object.keys(L));return!V.has(M)&&(V.set(M,!0),!0)})}},1367:(be,q,d)=>{"use strict";d.d(q,{R:()=>c});class c{constructor(y={center:0,edge:1,centerBias:1,edgeBias:0,power:1}){const{edge:l,center:X,centerBias:$,edgeBias:j,power:m}=y;this.edge=l,this.center=X,this.centerBias=$,this.edgeBias=j,this.power=m}static toEngine(y){const{center:l,edge:X,centerBias:$,edgeBias:j,power:m}=y;return[l,X,$,j,m]}static isFresnelObject(y){let l=!1;return y&&(l="center,centerBias,edge,edgeBias,power"==Object.keys(y).sort().toString()),l}}},21164:(be,q,d)=>{"use strict";d.d(q,{p:()=>Q});var c=d(23881),e=d(49204),y=d(8358),l=d(44867),$=d(287);var I=d(13409),L=d(1102),M=d(29284),S=d(12921),b=d(87710),f=d(65650),U=d(60286),C=d(63508),T=d(92333),w=d(56343),v=d(3829),A=d(54438),R=d(92014);const B={play:{count:1}};let Q=(()=>{class H{constructor(k,h,p){this.store=k,this.labelService=h,this.paintService=p}getMinimumGraphSync(k,h,p){const D=this.paintService.getColorRecipes(),te=Object.keys((0,c.ow)(D)),E=function X(H,Z,k){const h={},p={};return(0,l.Wy)(H,te=>{p[te]=(0,l.jX)(H,te)?{...(0,l._D)(H,te,k),...Z[te]||{}}:{...p[H.predecessors[te]],...Z[te]||{}},(0,l.xe)(H,te)&&(h[te]=p[te])}),h}(k,h,te),K=function N(H){return H.reduce((Z,k)=>(Z[k]=w.t.MajorityWins,Z),{available:w.t.MajorityWins,shown:w.t.MajorityWins,selected:w.t.MajorityWins,pickable:w.t.MajorityWins})}(D),u=function V(H,Z,k){const h=Object.keys(Z),p=Object.keys(k),D=(0,$.sO)(k,h),te=(0,$.FV)(p,H),E=(0,e.range)(te,-1).reduce((x,z)=>{const oe=(0,$.AY)(H,Object.keys(x.remainingVoters),z),ge=(0,$.kK)(H,x.remainingVoters,oe,Z),ie=function m(H){return H.reduce((Z,k)=>{const D=Object.keys(k).map(te=>function j(H,Z,k,h){const p=h.reduce((D,te)=>(D[te]={[H]:!k},D),{});return p[Z]={[H]:k},p}(te,k[te].id,k[te].result,k[te].dissenters)).reduce((te,E)=>(0,e.merge)(te,E),{});return Object.keys(D).forEach(te=>{Z[te]=D[te]}),Z},{})}(ge.results);return Object.keys(ie).forEach(Y=>{x.syncGraph[Y]=ie[Y]}),x.remainingVoters=ge.remainingVoters,x},{syncGraph:{},remainingVoters:D}).syncGraph;return function O(H,Z,k,h){const p=Z.reduce((D,te)=>{const K=H[te],u=H[h.predecessors[te]];for(const x of k)K[x]===u[x]&&D.push({successorId:te,prop:x});return D},[]);for(const D of p)delete H[D.successorId][D.prop],0===Object.keys(H[D.successorId]).length&&delete H[D.successorId];return H}(E,Object.keys(E).filter(x=>!H.roots[x]&&!!H.successors[x]),h,H)}(k,K,E);Object.entries(h).forEach(([z,oe])=>{const ge=(0,e.omit)(oe,te);(0,e.isEmpty)(ge)||(u[z]={...u[z]||{},...ge})});const x=new c.YR;return Object.entries(u).forEach(([z,oe])=>{x[this.switchNamespace(z,p)]=oe},this),x}convertGraphSync(k){const h={},p={},D={},te={},E={};return Object.entries(k).forEach(([K,u])=>{Object.entries(u).forEach(([x,z])=>{"available"===x?h[K]=z:"shown"===x?p[K]=z:"selected"===x?D[K]=z:"pickable"===x?te[K]=!z:E[K]={...E[K]||{},[x]:z}},this)},this),{availableObjects:h,showObjects:p,selectObjects:D,pickThroughObjects:te,synchronization:E}}switchNamespace(k,h){return h[k]||k}serializeHotspots(k,h){let p=[...k.hotspots],D={};return h.filter(E=>E.chapterId===k.id).forEach(E=>{const K=this.labelService.serializeLabel(E,p.length);p=[...p,...K.hotspots],D={...D,...K.data}}),{customData:D,hotspots:p}}calcMinimumPaintState(k,h){function p(D,te=!0){const K=(k.successors[D]||[]).reduce((u,x)=>({...u,...p(x,!(0,e.isEqual)(h[D],h[x]))}),{});return te?{[D]:h[D],...K}:K}return Object.keys(k.roots).reduce((D,te)=>({...D,...p(te)}),{})}serializeVisibilityLayers(k,h){const D={...k};return Array.isArray(k?.layers)&&(D.layers=k.layers.map(te=>({...te,objectIds:te.objectIds.filter(E=>Object.prototype.hasOwnProperty.call(h.nodes,E))})).filter(te=>te.objectIds.length>0)),D}serializeCamera(k){const h=k.title===T.y?void 0:k.title;return{[k.action]:{...k.location,title:h},cameraRotationCenter:k.rotationCenter}}duplicateTimelineMap(k){return k?k.map(h=>{const p=(0,e.cloneDeep)(h);return delete p.id,p}):[]}duplicateQuizQuestions(k){return this.store.selectSnapshot(b.j.getQuizQuestionsByChapter(k)).map(h=>{const p=(0,e.cloneDeep)(h);return delete p.chapterId,p})}serializeChapter(k,h,p,D,te,E=!1){const K=this.serializeHotspots(h,D),u=this.store.selectSnapshot(S.B.particleSystemsForChapter(h.id)),z={...(0,e.pickBy)(h.customData,(pe,Te)=>!Te.startsWith("errand")),...K.customData,particleSystems:u.map(pe=>pe.id)};let oe=h.camera;if(E){const Te=this.store.selectSnapshot(v.x.getChapterCameraPositions).get(h.id);Te&&(oe=Object.assign({},oe,Te))}const ge=te[h.id],ie=this.store.selectSnapshot(f.K.getRegisteredThumbnails),Y=ie.get(ge)?.urls||ie.get(h.id)?.urls||null,W={id:ge,createdFrom:h.createdFrom,displayName:h.displayName,description:h.description,...this.serializeCamera(oe),background:h.background??{},hotspots:K.hotspots,clippingPlanes:{clips:h.clippingPlanes.clips,boundary:h.clippingPlanes.boundary},ui:(0,e.isEmpty)(h.ui)?B:h.ui,media:h.media,timelineMap:this.duplicateTimelineMap(h.timelineMap),customData:z,transparencyMode:h.transparencyMode||null,fallbackTransparency:h.fallbackTransparency,properties:h.properties,transitions:h.transitions,legend:h.legend||[],visibilityLayers:this.serializeVisibilityLayers(h.sliderLayers.src,k),contentBlocks:h.contentBlocks||[],thumbnails:{default:"",...Y},quizQuestions:this.duplicateQuizQuestions(h.id),synchronization:void 0};if((0,C.Mi)(h))W.lightLibraryId=h.lightLibraryId;else if((0,C.Uv)(h)){const pe=W;pe.lights=h.lights,pe.environment=h.environment}const re=this.store.selectSnapshot(I.z.getAllNodeState)[h.id],Se=Object.entries(re).reduce((pe,[Te,we])=>{const Qe=we.shownSetByTween?(0,M.BK)(k,Te,h.showObjects)||(0,M._x)(k,Te,h.showObjects):we.shown;return pe.boolState[Te]={shown:Qe,pickable:we.pickable,available:we.available},pe.paintState[Te]=(0,L.Sf)(we.paint),pe},{boolState:{},paintState:{}}),se=this.getMinimumGraphSync(k,Se.boolState,p);return Object.entries(this.convertGraphSync(se)).forEach(([pe,Te])=>{W[pe]=Te}),W.synchronization=this.calcMinimumPaintState(k,Se.paintState),W}static#e=this.\u0275fac=function(h){return new(h||H)(A.KVO(R.il),A.KVO(y.x),A.KVO(U.s))};static#t=this.\u0275prov=A.jDH({token:H,factory:H.\u0275fac,providedIn:"root"})}return H})()},41862:(be,q,d)=>{"use strict";d.d(q,{tV:()=>j,yF:()=>c});let c=(()=>{class L{static#e=this.type="[Edit] Set view";constructor(S){this.view=S}}return L})(),j=(()=>{class L{static#e=this.type="[Edit] Reset";constructor(){}}return L})()},81881:(be,q,d)=>{"use strict";d.d(q,{Df:()=>X,GG:()=>e,Hr:()=>y,Nf:()=>$,T2:()=>L,WD:()=>c,b8:()=>m,hd:()=>O,ut:()=>I,wx:()=>S,yE:()=>j,yG:()=>V,yJ:()=>M,yk:()=>l});let c=(()=>{class b{static#e=this.type="[Edit Paint] Set Color Recipe";constructor(U){this.colorRecipe=U}}return b})(),e=(()=>{class b{static#e=this.type="[Edit Paint] Set Paint Brush Mode";constructor(U){this.brushMode=U}}return b})(),y=(()=>{class b{static#e=this.type="[Edit Paint] Clear Current Recipe";constructor(){}}return b})(),l=(()=>{class b{static#e=this.type="[Edit Paint] Reset Paint";constructor(){}}return b})(),X=(()=>{class b{static#e=this.type="[Edit Paint] Add Recent Recipe";constructor(U){this.recipe=U}}return b})(),$=(()=>{class b{static#e=this.type="[Edit Paint] Set Recent Recipes";constructor(U){this.recipes=U}}return b})(),j=(()=>{class b{static#e=this.type="[Edit Paint] Reset Story Recipes";constructor(){}}return b})(),m=(()=>{class b{static#e=this.type="[Edit Paint] Set Story Recipes For Chapter";constructor(U,C){this.chapterId=U,this.recipes=C}}return b})(),O=(()=>{class b{static#e=this.type="[Edit Paint] Add Palette";constructor(U){this.palette=U}}return b})(),V=(()=>{class b{static#e=this.type="[Edit Paint] Remove Palette";constructor(U){this.paletteId=U}}return b})(),I=(()=>{class b{static#e=this.type="[Edit Paint] Update Palette";constructor(U){this.palette=U}}return b})(),L=(()=>{class b{static#e=this.type="[Edit Paint] Set Palettes";constructor(U){this.palettes=U}}return b})(),M=(()=>{class b{static#e=this.type="[Edit Paint] Add Recipe to Palette";constructor(U,C){this.recipe=U,this.paletteId=C}}return b})(),S=(()=>{class b{static#e=this.type="[Edit Paint] Toggle Palette";constructor(U,C){this.paletteId=U,this.open=C}}return b})()},12347:(be,q,d)=>{"use strict";d.d(q,{O:()=>M});var c=d(28407),e=d(49204),y=d(72849),l=d(11724),X=d(515),$=d(33013),j=d(85586),m=d(47610),O=d(76304),I=d(54438),L=d(92014);let M=(()=>{class S{constructor(f,U){this.engineService=f,this.store=U,this.fps=30}setChapter(f,U=!1){var C=this;return(0,c.A)(function*(){const{story:T}=C.engineService.engine,{chapters:w,activeChapter:v}=T;if(f&&(f!==v?.id||U)){const R=w.findIndex(N=>N.id===f);return T.activateChapter(R).then(N=>(C.initPlayer(N),N.id))}return f})()}initPlayer(f){this.destroyPlayer();const{animationSystem:U}=f;this._animationPlayer=new l.BioDigitalAnimationPlayer(U),this.engineService.engine.renderer.on("animate",()=>{this.engineService.fireEvent(X.X.TimelineAnimatingStart),this._animationPlayer.update(),this.engineService.fireEvent(X.X.TimelineAnimatingEnd)}),this._animationPlayer.on("timeupdate",()=>{this.engineService.fireEvent(X.X.TimelinePlaying,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("play",()=>{this.engineService.fireEvent(X.X.TimelinePlayed,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("pause",()=>{this.engineService.fireEvent(X.X.TimelinePaused,{time:this._animationPlayer.currentTime})}),this._animationPlayer.on("ended",()=>{this.engineService.fireEvent(X.X.TimelineCompleted)}),this._animationPlayer.on("ratechange",({playBackRate:Z})=>{const k=this.engineService.engine?.story;k&&(k.playBackRate=Z)});const C=this.store.selectSnapshot(O.S.getPlaybackSpeed);this.setPlaybackRate(C);const T=[];f.timelineMap.forEach((Z,k)=>{const h={id:k,...Z};h.name=h.name??"",T.push(h)}),this.store.dispatch(new $.bg(T)),f.timelineMap.on("change",()=>{this.engineService.fireEvent(X.X.TimelineTimeFrameUpdated)}),this.store.dispatch(new $.M5(f.id,{model:!0,animation:!0}));const w=this.store.selectSnapshot(O.S.getChapter),v=this.store.selectSnapshot(j.N.getStoryChapters),A=v.findIndex(Z=>Z.id===w),R=v.findIndex(Z=>Z.id===f.id),Q=-1===(this.store.selectSnapshot(j.N.getChapter(f.id))?.ui?.play?.count??0);this.setAnimationLoop(Q),A!==R&&this.engineService.fireEvent(X.X.TimelineChapterTransition,{oldChapterIndex:A,newChapterIndex:R,time:0}),this.store.dispatch(new m.u3(f.id))}destroyPlayer(){this._animationPlayer?.pause(),this._animationPlayer?.destroy(),this._animationPlayer=null}isChapterAnimated(f){return!!f?.timelineMap&&function V(S){return S.some(b=>"dummy"!==b?.data?.timeline&&"dummy"!==b?.name)}(f.timelineMap)}isChapterLooped(f){return!0===(0,e.get)(f,"loop")||-1===(0,e.get)(f,"ui.play.count")}restart(){if((0,e.isNil)(this._animationPlayer))return;const f=this.isPlaying();f&&this.pause(),this._animationPlayer.currentTime=0,f&&this.play()}play(){this._animationPlayer?.play(),this.playParticles()}pause(){this._animationPlayer?.pause(),this.pauseParticles()}unpause(){this._animationPlayer&&(this.hasChapterFinished()&&this.scrub(0),this.play())}scrub(f){this._animationPlayer&&(this._animationPlayer.currentTime=(0,e.clamp)(f,0,this._animationPlayer.duration),this.engineService.fireEvent(X.X.TimelineScrubbed,{time:this._animationPlayer.currentTime}))}scrubRelative(f,U){this._animationPlayer&&(U&&this.isPlaying()?(this.pause(),this.scrub(this.getTime()+f),setTimeout(()=>this.unpause())):this.scrub(this.getTime()+f))}scrubFrame(f){const U="next"===f?1:-1,C=this.getTime(),w=this.secondsToFrames(C)+U,v=this.framesToSeconds(w);this.scrub(v)}secondsToFrames(f){return Math.round(f*this.fps)}framesToSeconds(f){return f/this.fps}getNearestFrameTime(f){return this.framesToSeconds(this.secondsToFrames(f))}formatTime(f){const U=R=>{const N=f<0?Math.ceil:Math.floor;return Math.abs(N(R)).toString().padStart(2,"0")},T=U(f/60),w=U(f%60),v=(R=>Math.abs(this.secondsToFrames(R%1)).toString().padStart(2,"0"))(f%1);return`${f<0?"-":""}${T}:${w}:${v}`}parseFormattedTime(f){const U=/^-/,C=U.test(f)?-1:1;-1===C&&(f=f.replace(U,""));const T=f.split(":").reverse();let w=parseInt(T[0],10),v=parseInt(T[1],10),A=parseInt(T[2],10);return isNaN(w)&&(w=0),isNaN(v)&&(v=0),isNaN(A)&&(A=0),(60*A+v+this.framesToSeconds(w))*C}updateTimelineClips(f){const U=this.engineService.engine.story.activeChapter;f.forEach(C=>{U.timelineMap.set(C.id,C)})}deleteTimelineClips(f){const U=this.engineService.engine.story.activeChapter;f.forEach(C=>{U.timelineMap.delete(C)})}setPlaybackRate(f){this._animationPlayer.playBackRate=f}getStoryAnimationNames(){const f=this.store.selectSnapshot(j.N.getStoryChapters),U=[];return f.forEach(C=>{C.timelineMap.forEach(T=>{const w=T.data.timeline;U.includes(w)||U.push(w)})}),U}getChapterTimeFrame(f){return{firstTime:0,lastTime:this.getChapterDuration(f)}}getChapterDuration(f){return(0,e.isNil)(f)?(0,e.isNil)(this._animationPlayer)?0:this._animationPlayer.duration:this.engineService.engine.story.chapters.find(w=>w.id===f)?.animationSystem?.duration??0}getTime(){return(0,e.isNil)(this._animationPlayer)?0:this._animationPlayer.currentTime}isPlaying(){return!(0,e.isNil)(this._animationPlayer)&&!this._animationPlayer.paused}hasChapterFinished(){return!(0,e.isNil)(this._animationPlayer)&&this._animationPlayer.currentTime===this._animationPlayer.duration}setAnimationLoop(f){if(!this._animationPlayer)throw new Error("Animation player is not initialized");this._animationPlayer.loop=f}mapChapterGlobalTime(f,U){let C=U;if((0,e.isNil)(C))return 0;const T=this.store.selectSnapshot(j.N.getStoryChapters),w=T.findIndex(v=>v.id===f);for(let v=0;v<w;v++){let R=0;T[v].timelineMap.forEach(N=>{N.end>R&&(R=N.end)}),C-=R}return C}mapGlobalTimeToChapterId(f){let U=0;const C=this.store.selectSnapshot(j.N.getStoryChapters);let T;for(let w=0;w<C.length;w++){const v=C[w],A=this.getChapterDuration(v.id);if(f>=U&&f<U+A){T=v.id;break}U+=A}return f===U&&!T&&(T=C[C.length-1].id),T}getGlobalTime(){const f=this.store.selectSnapshot(j.N.getSelectedChapterIndex),U=this.store.selectSnapshot(j.N.getStoryChapters);let C=this._animationPlayer.currentTime;for(let T=0;T<f;T++){let v=0;U[T].timelineMap.forEach(A=>{A.end>v&&(v=A.end)}),C+=v}return C}playParticles(){this.engineService.engine?.story?.activeChapter?.start()}pauseParticles(){this.engineService.engine?.story?.activeChapter?.stop()}static#e=this.\u0275fac=function(U){return new(U||S)(I.KVO(y.y),I.KVO(L.il))};static#t=this.\u0275prov=I.jDH({token:S,factory:S.\u0275fac,providedIn:"root"})}return S})()},3266:(be,q,d)=>{"use strict";d.d(q,{j:()=>Q});var c=d(13491),e=d(85052),y=d(66017),l=d(15913),X=d(2353),$=d(38472),j=d(72849),m=d(11724),O=d(515),V=d(35650),I=d(46889),L=d(49204);const b={backOff:0,stopFOV:55,dist:2.5};function f(H,Z,k,h=b){const p={...b,...h},D=p.dist,te=p.stopFOV,E=1-(0,L.clamp)(p.backOff,0,1),K=(0,I.E8)(H,Z);return Math.abs(K/(1+.8*E)/Math.tan(te/2))/k*D}function U(H,Z,k){const h=c.n.toArray(H.look),p=c.n.toArray(H.eye),D=$.create();$.subtract(D,p,h);const te=$.create();$.normalize(te,D);const E=Math.abs($.length(te)),{min:K,max:u}=(0,X.n)(Z),x=f(K,u,E,k),z=(0,I.A1)(K,u);$.scale(D,te,x);const oe=$.add($.create(),z,D);return{eye:c.n.fromArray(oe),look:c.n.fromArray(z),up:c.n.fromArray([0,1,0])}}class C{constructor(Z,k){this.tempVec=$.create(),this.eyeVec=$.create(),this.lookVec=$.create(),this.cameraService=Z;const{targetCamera:h,targetBoundary:p}=k,D=Z.getCamera();if(this.initialLook=c.n.toArray(D.look),this.initialEye=c.n.toArray(D.eye),this.initialUp=c.n.toArray(D.up),p){$.subtract(this.tempVec,this.initialEye,this.initialLook);const u=$.create();$.normalize(u,this.tempVec);const x=Math.abs($.length(u)),{min:z,max:oe}=(0,X.n)(p),ge=f(z,oe,x,k);$.scale(this.tempVec,u,ge),this.targetLook=(0,I.A1)(z,oe),this.targetEye=$.add($.create(),this.targetLook,this.tempVec),this.targetUp=$.fromValues(0,1,0)}h&&(this.targetLook=c.n.toArray(h.look),this.targetEye=c.n.toArray(h.eye),this.targetUp=c.n.toArray(h.up)),$.subtract(this.tempVec,this.targetLook,this.initialLook);const te=Math.abs($.length(this.tempVec));$.subtract(this.tempVec,this.targetEye,this.initialEye);const E=Math.abs($.length(this.tempVec));this.animationDuration=k.animationDuration?1e3*k.animationDuration:1e3*((te>E?te:E)/(200*(k.velocity||1))+1),this.onComplete=k.onComplete}update(Z){if(void 0===this.startTime&&(this.startTime=Z,this.endTime=this.startTime+this.animationDuration),this.animationDone||Z>this.endTime)return this.animationDone||this.cameraService.setCamera({eye:c.n.fromArray(this.targetEye),look:c.n.fromArray(this.targetLook),up:c.n.fromArray(this.targetUp)}),this.animationDone=!0,void this.onComplete(this);const h=(0,I.vT)((Z-this.startTime)/this.animationDuration,0,1);(0,I.dL)(h,0,1,this.initialLook,this.targetLook,this.lookVec),(0,I.dL)(h,0,1,this.initialEye,this.targetEye,this.eyeVec),(0,I.dL)(h,0,1,this.initialUp,this.targetUp),this.cameraService.setCamera({eye:c.n.fromArray(this.eyeVec),look:c.n.fromArray(this.lookVec),up:c.n.fromArray(this.targetUp)})}stop(){}}var T=d(54438),w=d(81642);const R=180/Math.PI,N=1/m.BIODIGITAL_SCENE_SCALE,B=m.BIODIGITAL_SCENE_SCALE;let Q=(()=>{class H{get cameraController(){const k=this.engineService.engine?.story?.cameraController;if(!k)throw new Error("Story not instantiated, cannot get camera controller");return k}constructor(k,h,p){this.engineService=k,this.numberService=h,this.sceneService=p,this.rotation={vx:0,vy:0},this.pan={x:0,y:0,z:0},this.zoom=0,this.animationCallbacks=[],this.initCameraEvents()}tickCamera(k){this.animation&&this.animation.update(performance.now())}getCamera(){const{up:k,target:h,position:p}=this.cameraController,D=m.vec3Pool.get(),te=m.vec3Pool.get();$.scale(D,p,N),$.scale(te,h,N);const E={eye:c.n.fromArray(D),look:c.n.fromArray(te),up:c.n.fromArray(k)};return m.vec3Pool.release(D),m.vec3Pool.release(te),E}setCamera(k,h=!1){const{cameraController:p}=this,{eye:D,look:te,up:E}=k;let K,u,x;D&&(K=m.vec3Pool.get(),$.scale(K,c.n.toArray(D),B)),te&&(u=m.vec3Pool.get(),$.scale(u,c.n.toArray(te),B)),E&&(x=c.n.toArray(E)),p.setCamera(K??p.position,u??p.target,x),K&&m.vec3Pool.release(K),u&&m.vec3Pool.release(u),te&&!h&&this.setCameraRotationCenter(te)}getLookDirection(){const{target:k,position:h}=this.cameraController,p=$.create();return $.sub(p,k,h),$.normalize(p,p),p}getLookDistance(){return this.cameraController.distance*N}getCameraZoom(){return this.cameraController.zoom}captureCamera(){return{lookAt:this.getCamera(),zoom:this.getCameraZoom()}}getDirection(k){const{position:h}=this.cameraController,p=$.create();return $.sub(p,h,k.worldPos),$.normalize(p,p),[p[0],p[1],p[2]]}rotateCameraStatic(k,h){this.cameraController.orbit(k/R,h/R)}panCameraStatic(k,h,p){this.cameraController.pan(k*B,h*B,p*B)}setRelativeZoom(k){this.cameraController.dolly(k)}setAbsoluteZoom(k){this.cameraController.zoom=k}getCameraRotationCenter(){const k=m.vec3Pool.get();$.scale(k,this.cameraController.center,N);const h=c.n.fromArray(k);return m.vec3Pool.release(k),h}setCameraRotationCenter(k){const h=m.vec3Pool.get(),p=Array.isArray(k)?k:c.n.toArray(k);$.scale(h,p,B),$.copy(this.cameraController.center,h),m.vec3Pool.release(h)}setCameraRotation(k,h){this.rotation.vx=h,this.rotation.vy=-k}setCameraPan(k,h){this.pan.x=k,this.pan.y=h}setCameraZoom(k){this.zoom=.03*k}setCameraZoomWithVelocity(k){this.setCameraZoom(k),requestAnimationFrame(()=>{k*=.85,Math.abs(k)>1&&this.setCameraZoomWithVelocity(k)})}tickCameraRotation(){return this.rotation.vx=this.checkEpsilon(this.rotation.vx),this.rotation.vy=this.checkEpsilon(this.rotation.vy),this.rotation}tickCameraPan(){return this.pan.x=this.checkEpsilon(this.pan.x),this.pan.y=this.checkEpsilon(this.pan.y),this.pan.z=this.checkEpsilon(this.pan.z),this.pan}tickCameraZoom(){return this.zoom=this.checkEpsilon(this.zoom),this.zoom}areCamerasEqual(k,h){return this.compareXYZ(k.eye,h.eye)&&this.compareXYZ(k.look,h.look)&&this.compareXYZ(k.up,h.up)}compareXYZ(k,h){return k.x===h.x&&k.y===h.y&&k.z===h.z}roundCamera(k,h){const{eye:p,look:D,up:te}=k;return{eye:this.numberService.roundModel(p,h),look:this.numberService.roundModel(D,h),up:this.numberService.roundModel(te,h)}}flyToObject(k,h){return new Promise(p=>{const D=this.sceneService.getObjectBoundary([k]);(0,X.L)(D)?(this.animationCallbacks.push(p),this.animation=new C(this,{targetBoundary:D,animationDuration:h,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())):p(void 0)})}flyToCamera(k,h){return new Promise(p=>{this.animationCallbacks.push(p),this.animation=new C(this,{targetCamera:k,animationDuration:h,onComplete:()=>{this.finishAnimation()}}),this.animation.update(performance.now())})}jumpToObject(k){const h=this.sceneService.getObjectBoundary([k]);if((0,X.L)(h)){const D=U(this.getCamera(),h);return this.jumpToCamera(D)}return new Promise(p=>p(void 0))}jumpToCamera(k){return new Promise(h=>{this.finishAnimation(),this.setCamera(k),h(void 0)})}getCameraAfterFlyTo(k){return U(this.getCamera(),k)}checkEpsilon(k){return Math.abs(k)<.001?0:k}initCameraEvents(){const k=new e.B,h=k.asObservable();h.subscribe(te=>{this.engineService.fireEvent(O.X.CameraUpdated,te)});const D=this.engineService.getEvent(O.X.Tick).pipe((0,y.S)(2));h.pipe((0,l.s)(()=>D)).subscribe(te=>{this.engineService.fireEvent(O.X.CameraRested,te)}),this.engineService.engineCreated$.subscribe(te=>{te.camera.on("updateWorldMatrix",E=>{if(!te?.story)return;const x={...this.getCamera(),dist:this.getLookDistance()};k.next(x)})})}finishAnimation(){for(this.animation&&(this.animation.stop(),this.animation=null);this.animationCallbacks.length>0;)this.animationCallbacks.pop()()}static#e=this.\u0275fac=function(h){return new(h||H)(T.KVO(j.y),T.KVO(w.D),T.KVO(V.w))};static#t=this.\u0275prov=T.jDH({token:H,factory:H.\u0275fac,providedIn:"root"})}return H})()},46799:(be,q,d)=>{"use strict";d.d(q,{z:()=>I});var c=d(65133),e=d(38472),y=d(11724);const l={stats:{textures:{baseColor:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},alpha:{"1024x1024":1,memory:1e6,"512x512":1},normals:{"1024x1024":1,memory:1e6,"512x512":1,"2048x2048":1},emit:{"1024x1024":1,memory:1e6,"512x512":1,"256x256":1},roughness:{"512x512":1,memory:1e6,"1024x1024":1}}}};var X=d(72849),$=d(515),j=d(49204),m=d(54438);const O=c.create(),V=c.create();let I=(()=>{class L{get canvas(){if(!this.engineService.engine)throw new Error("Engine not defined, cannot use canvas");return this.engineService.engine.renderer.canvas}constructor(S){this.engineService=S}forceRenderFrame(){this.engineService.engine.renderer.render()}getCanvas(){return this.canvas}getScene(){return l}getViewMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.worldMatrixInverse)}getProjMat(){return this.scaleAndNormalizeMatrix(this.engineService.engine.story.camera.projectionMatrix)}pick(S,b,f=!0){const U=this.engineService.engine,C=U.story?.anatomySceneGraph,T=U.rayCastCamera(S,b,{filter:w=>C?.findAnatomyObject(w)?.pickable});if(T){const w=this.generateHitModel(C,T,f,S,b);return this.engineService.fireEvent($.X.PickPicked,w),w}return{canvasPos:{x:S,y:b}}}pickMatrix(S,b=!0){const f=this.engineService.engine,U=f.story?.anatomySceneGraph,C=f.rayCast(S,{filter:T=>U?.findAnatomyObject(T)?.pickable,near:0});if(C){const T=this.generateHitModel(U,C,b);return this.engineService.fireEvent($.X.PickPicked,T),T}}setTransparencyMode(S){this.engineService.engine.renderer.transparencyMode=S}scaleAndNormalizeMatrix(S){return c.copy(V,S),V[12]*=y.BIODIGITAL_SCENE_SCALE,V[13]*=y.BIODIGITAL_SCENE_SCALE,V[14]*=y.BIODIGITAL_SCENE_SCALE,V}generateHitModel(S,b,f,U,C){const{triIndex:T,intersection:w,object:v}=b,A=S.findAnatomyObject(v),{objectId:R,renderables:N}=A,B=N.findIndex(k=>k.meshNode===v),Q=N[B]?.meshNode,Z={canvasPos:(0,j.isNil)(U)||(0,j.isNil)(C)?void 0:{x:U,y:C},objectId:R,renderableIndex:B,triIndex:T};if(f){const k=this.getBarycentricCoordinate(Q,w,T),h=this.getTriangleNormal(Q,T);return e.scale(w,w,1/y.BIODIGITAL_SCENE_SCALE),{...Z,barycentric:k,worldPos:w,normal:h}}return Z}getBarycentricCoordinate(S,b,f){const U=e.create(),C=y.vec3Pool.get(),T=y.vec3Pool.get(),w=y.vec3Pool.get(),v=y.vec3Pool.get();return c.invert(O,S.worldMatrix),e.transformMat4(C,b,O),(0,y.getTrianglePositions)(S,f,T,w,v),(0,y.barycentricCoord)(U,C,T,w,v),e.transformMat4(T,T,S.worldMatrix),e.transformMat4(w,w,S.worldMatrix),e.transformMat4(v,v,S.worldMatrix),y.vec3Pool.release(C),y.vec3Pool.release(T),y.vec3Pool.release(w),y.vec3Pool.release(v),U}getTriangleNormal(S,b){const f=e.create(),U=y.vec3Pool.get(),C=y.vec3Pool.get(),T=y.vec3Pool.get();return(0,y.getTrianglePositions)(S,b,U,C,T),e.transformMat4(U,U,S.worldMatrix),e.transformMat4(C,C,S.worldMatrix),e.transformMat4(T,T,S.worldMatrix),(0,y.triangleNormal)(f,U,C,T),y.vec3Pool.release(U),y.vec3Pool.release(C),y.vec3Pool.release(T),f}static#e=this.\u0275fac=function(b){return new(b||L)(m.KVO(X.y))};static#t=this.\u0275prov=m.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},72849:(be,q,d)=>{"use strict";d.d(q,{y:()=>ge});var c=d(28407),e=d(29160),y=d(85052),l=d(14264),X=d(11756),$=d(40215),j=d(37925),m=d(515),O=d(24418),V=d(17215),I=d(85884),L=d(41775),M=d(11724),S=d(49204);const b={[M.FogModeNumericEnum.Linear]:"linear",[M.FogModeNumericEnum.Exponential]:"exp",[M.FogModeNumericEnum.ExponentialSquared]:"exp2"};var f=d(70432),U=d(34992);const C=(ie,Y)=>(0,M.joinPath)(ie,"assets",Y),w=5,v=new U.A({concurrency:900});function R(){return(R=(0,c.A)(function*(ie,Y,W){const Ee=yield fetch(ie,{signal:Y});return Ee.ok?W(Ee):null})).apply(this,arguments)}function N(ie,Y,W,Ee){return B.apply(this,arguments)}function B(){return B=(0,c.A)(function*(ie,Y,W,Ee){const re=C(Y,W);return v.add(()=>(0,f.A)(()=>function A(ie,Y,W){return R.apply(this,arguments)}(re,ie,Ee),{retries:w}))}),B.apply(this,arguments)}function Q(ie,Y,W){return N(ie,Y,W,function(){var Ee=(0,c.A)(function*(re){return re.json()});return function(re){return Ee.apply(this,arguments)}}())}function H(ie,Y,W){return N(ie,Y,W,function(){var Ee=(0,c.A)(function*(re){return re.arrayBuffer()});return function(re){return Ee.apply(this,arguments)}}())}function k(){return(k=(0,c.A)(function*(ie){return(yield fetch(ie)).json()})).apply(this,arguments)}function p(){return(p=(0,c.A)(function*(ie,Y){return v.add(()=>(0,f.A)(()=>fetch("/assets/"+ie,Y),{retries:w}))})).apply(this,arguments)}const D={material:Q,morph:H,geometry:H,transform:Q};class te{fetch(Y,W){return(0,c.A)(function*(){const Ee=v.add(()=>(0,f.A)(()=>fetch(Y),{retries:w}));return void 0!==Ee?Ee:null})()}constructor(Y,W,Ee={}){let re=new M.BioDigitalWebSocketServer(W,Ee);const Se=typeof AbortController>"u"?null:new M.MultiKeyMap;function Te(){return Te=(0,c.A)(function*(we,Qe,tt,Ue){const yt=tt.split("/"),ke=(0,M.joinPath)(we,"content/states",yt[0],Qe,yt[1],Ue);return v.add(()=>(0,f.A)(()=>function Z(ie){return k.apply(this,arguments)}(ke),{retries:w}))}),Te.apply(this,arguments)}this.getAsset=function(){var we=(0,c.A)(function*(Qe,tt){const Ue=D[Qe];if(!Ue)throw new Error("BioDigitalHybridServer: Unsupported type '$type'");let yt=null;Se&&(yt=new AbortController,Se.set(Qe,tt,yt));let ke=yield Ue(yt?.signal,Y,tt);return null===ke&&(ke=yield function se(){return re||(re=new M.BioDigitalWebSocketServer(W,Ee)),re}().getAsset(Qe,tt),function h(ie,Y){p.apply(this,arguments)}(tt,{method:"PUT",body:"morph"===Qe||"geometry"===Qe?ke:JSON.stringify(ke)})),Se&&Se?.delete(Qe,tt),ke});return function(Qe,tt){return we.apply(this,arguments)}}(),this.getAssetLibrary=function pe(we,Qe,tt,Ue){return Te.apply(this,arguments)},this.destroy=()=>{Se&&(Se.forEach(we=>we.abort()),Se.clear()),re&&re.destroy()}}}var E=d(54438),K=d(26982);let u=(()=>{class ie extends K.U{static#e=this.\u0275fac=(()=>{let W;return function(re){return(W||(W=E.xGo(ie)))(re||ie)}})();static#t=this.\u0275prov=E.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})();var x=d(21626);let ge=(()=>{class ie{get engine(){return this._engine}get server(){return this._server}get serverBaseDirectory(){return typeof localBaseDirectory>"u"?"/":localBaseDirectory}constructor(W,Ee,re,Se){this.errorService=W,this.storageService=Ee,this.engineEventService=re,this.http=Se,this.events={},this.errorLogged=!1,this._engineCreated=new e.t(void 0),this._engineDestroyed=new y.B,this.registerEngineWorkers(),this.events=Object.values(m.X).reduce((se,pe)=>(se[pe]=this.engineEventService.getEvent(pe),se),{}),this.engineCreated$=this._engineCreated.asObservable().pipe((0,l.p)(se=>!(0,S.isNil)(se))),this.engineDestroyed$=this._engineDestroyed.asObservable(),this.engineCreated$.pipe((0,X.Z)(se=>this.getGPUCapabilities(se))).subscribe(se=>{this.gpuCapabilities=se}),this.initEngineErrorHandling()}getEvent(W){return this.events[W]}fireEvent(W,Ee){this.engineEventService.fireEvent(W,Ee)}initEngine(W){return this.createServerInstance(),this.createEngineInstance(W),this.fireEvent(m.X.Loaded),this.engine}destroyEngine(){this._engine&&(this._engineCreated.next(void 0),this._engineDestroyed.next(),this._engine.destroy(),this._engine=null),this._server&&(this._server.destroy(),this._server=null)}setStory(W){this.engine.setStory(W),O.c.offline&&(this._server.moduleId=W.moduleId,typeof requiresFileExtensions<"u"&&(this._server.requiresFileExtensions=requiresFileExtensions)),this.engine.story.chapters.forEach(Ee=>{Ee.on("progress",()=>{const{id:re,loadProgress:Se}=Ee;this.fireEvent(m.X.AssetsLoadProgress,{chapterId:re,chapterProgress:Se})})})}getWEBGLInfo(){return this.gpuCapabilities?.webgl?.params}setProperties(W){const{story:Ee,renderer:re}=this.engine,Se=Ee?.activeChapter,se=Ee?.cameraController;(0,S.isNil)(Se)||(this.setFogProperties(re,Se,W),this.setCameraProperties(re,Se,se,W))}setFogProperties(W,Ee,re){Object.entries(re).forEach(([se,pe])=>{if(se.startsWith("fog.")&&((0,S.has)(W.environment,se)&&(0,S.set)(Ee.properties,se,pe),(0,S.has)(W.environment,se)))switch(se){case"fog.density":W.environment.fog.density=pe/M.BIODIGITAL_SCENE_SCALE;break;case"fog.mode":W.environment.fog.mode=b[pe];break;case"fog.start":W.environment.fog.start=pe*M.BIODIGITAL_SCENE_SCALE;break;case"fog.end":W.environment.fog.end=pe*M.BIODIGITAL_SCENE_SCALE;break;default:(0,S.set)(W.environment,se,pe)}}),!1===re["fog.enabled"]&&(W.environment.fog.mode="")}setCameraProperties(W,Ee,re,Se){Object.entries(Se).forEach(([Te,we])=>{if(Te.startsWith("camera."))switch(Te){case"camera.optics.near":Ee.properties.camera.optics.near=we;break;case"camera.optics.far":Ee.properties.camera.optics.far=we;break;case"camera.optics.fov":Ee.properties.camera.optics.fov=we;break;case"camera.zoomLimits":Ee.properties.camera.zoomLimits=we}});const{optics:se,zoomLimits:pe}=Ee.properties.camera;W.camera.fov=se.fov*Math.PI/180,W.camera.far=se.far*M.BIODIGITAL_SCENE_SCALE,W.camera.near=se.near*M.BIODIGITAL_SCENE_SCALE,W.camera.dirtyProjection(),re.minDistance=pe.min*M.BIODIGITAL_SCENE_SCALE,re.maxDistance=pe.max*M.BIODIGITAL_SCENE_SCALE}getGPUCapabilities(W){var Ee=this;return(0,c.A)(function*(){return Ee.gpuCapabilities=Ee.gpuCapabilities??(yield W.renderer.getGPUCapabilities()),Ee.gpuCapabilities})()}initAnalytics(W,Ee,re,Se){var se=this;return(0,c.A)(function*(){se.gpuAnalytic={version:4,app_producttype:W,app_productkey:Ee,gpu_data:{},acct_cred_type:re,acct_cred_id:Se,offline_event:O.c.offline?1:0};const pe=yield(0,$._)(se.engineCreated$),Te=yield se.getGPUCapabilities(pe);if(se.gpuAnalytic={...se.gpuAnalytic,gpu_data:{...Te}},!se.storageService.getSessionItem(V.d0.GPUAnalyticsStored)){const Qe=O.c.offline?{...se.gpuAnalytic,event_timestamp:(new Date).toISOString().substring(0,19)}:se.gpuAnalytic;O.c.offline?fetch("https://human.biodigital.com/ws/product/analytic/gpu-event",{method:"POST",body:JSON.stringify(Qe),headers:new Headers({"Content-Type":"application/json; charset=utf-8"}),mode:"no-cors"}).then(()=>{se.storageService.setSessionItem(V.d0.GPUAnalyticsStored,Date.now())}):se.http.post("/ws/product/analytic/gpu-event",Qe,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(()=>{se.storageService.setSessionItem(V.d0.GPUAnalyticsStored,Date.now())})}})()}createServerInstance(){if(this._server)throw new Error("Websocket server already exists");this._server=O.c.offline?new M.BioDigitalFileServer(this.serverBaseDirectory):O.c.native?new te(this.serverBaseDirectory,O.c.assetDomain,{timeout:6e5,socketProtocol:"wss"}):new M.BioDigitalWebSocketServer(O.c.assetDomain,{timeout:6e5})}createEngineInstance(W){if(this._engine)throw new Error("Engine is already instantiated");try{const Ee=typeof localBaseDirectory>"u"?"/":localBaseDirectory;this._engine=new M.BioDigitalEngine(this._server,{...W,baseUrl:Ee}),this.initEngineTickEvent(this._engine),this.initTweenVisibilityEvent(this._engine),this._engineCreated.next(this._engine)}catch(Ee){const re=Ee??new Error("There was an error creating the engine");this.fireEvent(m.X.HumanError,re)}}initEngineErrorHandling(){this.getEvent(m.X.HumanError).pipe((0,l.p)(W=>!(0,S.isNil)(W))).subscribe(W=>{this.handleFatalEngineErrors(W)})}initEngineTickEvent(W){const Ee=re=>{this.fireEvent(m.X.Tick,re)};W.renderer.on("animate",Ee),W.on("destroy",()=>{W.renderer.off("animate",Ee)})}initTweenVisibilityEvent(W){let Ee={shown:{},shownSetByTween:{},variant:{}},re=!1;this.getEvent(m.X.TimelineAnimatingStart).pipe((0,j.Q)(this._engineDestroyed)).subscribe(()=>{re=!0,Ee={shown:{},shownSetByTween:{},variant:{}}}),this.getEvent(m.X.TimelinePlaying).pipe((0,j.Q)(this._engineDestroyed)).subscribe(()=>{const{shownSetByTween:Se,variant:se}=Ee;Object.keys(Se).length>0&&this.fireEvent(m.X.TweenVisibilityUpdate,Se),Object.keys(se).length>0&&this.fireEvent(m.X.VariantsUpdate,se),re=!1,Ee={shown:{},shownSetByTween:{},variant:{}}}),W.on("changestory",()=>{const Se=pe=>{const Te=pe?.property,we=pe?.object,Qe=we?.objectId;if(Te in Ee&&(Ee[Te][Qe]=we[Te],"shown"===Te&&re)){const{shown:Ue}=we;Ee.shownSetByTween[Qe]=Ue}},{anatomyObjects:se}=W.story.anatomySceneGraph;se.forEach(pe=>{pe.on("change",Se)})}),W.on("changechapter",()=>{const{anatomyObjects:Se}=W.story.anatomySceneGraph,se={shown:{},shownSetByTween:{},variant:{}};Se.forEach(Te=>function oe(ie,Y){for(const W in ie)W in Y&&(ie[W][Y.objectId]=Y[W])}(se,Te));const{variant:pe}=se;this.fireEvent(m.X.VariantsUpdate,pe)})}registerEngineWorkers(){new Worker(d.tu(new URL(d.p+d.u(401),d.b))),(0,M.registerWorker)("geometry",()=>new Worker(d.tu(new URL(d.p+d.u(762),d.b)))),(0,M.registerWorker)("texture",()=>new Worker(d.tu(new URL(d.p+d.u(235),d.b)))),(0,M.registerWorker)("simulation",()=>new Worker(d.tu(new URL(d.p+d.u(513),d.b))))}handleFatalEngineErrors(W){const{message:Ee,name:re,stack:Se}=W,se={name:re,message:Ee,stack:Se},pe={...this.gpuAnalytic,error_category:re,error_message:JSON.stringify({message:Ee,stack:Se})};O.c.offline&&(pe.event_timestamp=(new Date).toISOString().substring(0,19)),this.errorLogged||(this.http.post("/ws/product/error/gpu-event",pe,{headers:{"Content-Type":"application/json; charset=utf-8"}}).subscribe(),this.errorLogged=!0),this.errorService.redirectToErrorPage(I.Y.Engine,void 0,se)}static#e=this.\u0275fac=function(Ee){return new(Ee||ie)(E.KVO(L.I),E.KVO(V.n$),E.KVO(u),E.KVO(x.Qq))};static#t=this.\u0275prov=E.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})()},62943:(be,q,d)=>{"use strict";d.d(q,{T4:()=>m,iu:()=>l,tH:()=>X,ty:()=>j});var c=d(11789);function l(O){if(!Object.keys(O).length)return null;const V=[...O.colors];V.forEach((S,b)=>{V[b]=(b+1)%4&&S<=1?Math.round(255*S):S});const I=/radial|linear/.test(O.gradientType)?O.gradientType:"radial",L=O.colorStops,M=Array.isArray(L)&&2===L.length?[L[0],L[1]]:[0,100];return{colors:V,gradientType:I,colorStops:M}}function X(O){const V=O.colors,I=`rgba(${V[0]},${V[1]}, ${V[2]}, ${V[3]}) ${O.colorStops[0]}%`,L=`rgba(${V[4]},${V[5]}, ${V[6]}, ${V[7]}) ${O.colorStops[1]}%`;return"radial"===O.gradientType?`radial-gradient(circle, ${I}, ${L})`:`linear-gradient(180deg, ${I}, ${L})`}function j(O){if(!O||!O.colors)return!1;const V=O.colors,I=V[3];return V.length<=4?0===I:0===I&&0===V[7]}function m(O){const V=O?.colors;if(Array.isArray(V)){const I=V.slice(0,3);return c.T.isLight(I)}return!1}},2353:(be,q,d)=>{"use strict";d.d(q,{L:()=>l,n:()=>y});var c=d(49204);function y(X){const{xmin:$,ymin:j,zmin:m,xmax:O,ymax:V,zmax:I}=X;return{min:[$,j,m],max:[O,V,I]}}function l(X){if((0,c.isNil)(X))return!1;{const $=Object.values(X);return 6===$.length&&$.every(j=>Number.isFinite(j))}}},57021:(be,q,d)=>{"use strict";d.d(q,{x:()=>c});class c{constructor(y=0,l=0,X=0,$=0,j=0,m=!1){this.zoom=y,this.panX=l,this.panY=X,this.rotateX=$,this.rotateY=j,this.applyFriction=m}}},73987:(be,q,d)=>{"use strict";d.d(q,{h:()=>c});var c=function(e){return e[e.Tiny=0]="Tiny",e[e.Small=1]="Small",e[e.Standard=2]="Standard",e}(c||{})},515:(be,q,d)=>{"use strict";d.d(q,{X:()=>c});var c=function(e){return e.Started="started",e.Loaded="loaded",e.Tick="tick",e.HumanReady="human.ready",e.HumanStarted="started",e.Error="error",e.HumanError="human.error",e.CanvasResized="canvas.resized",e.HumanCanvasResized="human.canvasResized",e.LogDebug="_log.debug",e.LogError="_log.error",e.LogInfo="_log.info",e.LogWarn="_log.warn",e.SceneLoaded="scene.loaded",e.HumanProgress="human.progress",e.AssetsLoadFinish="assets.load.finish",e.AssetsLoadProgress="assets.load.progress",e.AssetsLoadStart="assets.load.start",e.CameraRested="camera.rested",e.CameraUpdated="camera.updated",e.ModuleInteractive="module.interactive",e.ModulesActivateFinish="modules.activate.finish",e.ModulesCreateFinish="modules.create.finish",e.ModulesDestroyFinish="modules.destroy.finish",e.ModulesFetchStart="modules.fetch.start",e.PickPicked="pick.picked",e.SceneMarkersUpdated="scene.markers.updated",e.SceneObjectRenderable="scene.objectRenderable",e.SceneObjectsSelected="scene.objectsSelected",e.SceneObjectsShown="scene.objectsShown",e.ScenePicked="scene.picked",e.SceneRestored="scene.restored",e.SceneXrayEnabled="scene.xrayEnabled",e.SceneXrayDisabled="scene.xrayDisabled",e.SceneReady="scene.ready",e.TimelineChapterTransition="timeline.chapterTransition",e.TimelinePlaying="timeline.playing",e.TimelineScrubbed="timeline.scrubbed",e.TimelinePlayed="timeline.played",e.TimelinePaused="timeline.paused",e.TimelineCompleted="timeline.completed",e.TimelineTimeFrameUpdated="timeline.timeFrame.updated",e.TimelineAnimatingStart="timeline.animating.start",e.TimelineAnimatingEnd="timeline.animating.end",e.GraphAssetAttachFinish="graph.assetAttach.finish",e.TweenVisibilityUpdate="TweenVisibilityUpdate",e.VariantsUpdate="VariantsUpdate",e}(c||{})},24911:(be,q,d)=>{"use strict";d.d(q,{j:()=>c});class c{constructor(y,l,X,$,j,m,O,V){this.viewportWidth=y,this.viewportHeight=l,this.left=X,this.top=$,this.width=j,this.height=m,this.visibility=O,this.scale=V}}},4664:(be,q,d)=>{"use strict";d.d(q,{g:()=>c});var c=function(e){return e[e.Hidden=-1]="Hidden",e[e.Shown=1]="Shown",e}(c||{})},20458:(be,q,d)=>{"use strict";d.d(q,{EC:()=>L,NR:()=>e,Rn:()=>l});var c=d(1367);const e={label:"Original",tintColor:!1,saturation:!1,contrast:!1,brightness:!1,opacity:!1},l={tintColor:[1,0,0],saturation:!1,contrast:!1,brightness:!1,opacity:!1},L={label:"Fade",tintColor:[0,0,0],contrast:!1,brightness:55,saturation:-100,opacity:new c.R({edge:1,center:0,edgeBias:0,centerBias:1,power:1})}},13878:(be,q,d)=>{"use strict";d.d(q,{M:()=>c});var c=function(e){return e.Capture="capture",e.DoNotCaptureShowMessage="do_not_capture_show_message",e.DoNotCapture="do_not_capture",e}(c||{})},1308:(be,q,d)=>{"use strict";d.d(q,{F$:()=>j,_:()=>$});var c=d(20342),e=d(10352),y=d(9592),l=d(62943);const $={imageType:y.H.JPEG,crop:"original",copyrightEnabled:!1,copyrightImagePath:c.O.viewer.full_dark.logo_url,copyrightPosition:{x:"left",y:"bottom"},copyrightOffset:{x:12,y:-12},imageQuality:1};function j(m,O){return m===y.H.PNG?O||e.RK:O&&!(0,l.ty)(O)?O:e.RK}},47555:(be,q,d)=>{"use strict";d.d(q,{s:()=>c});var c=function(e){return e.Select="Select",e.Hide="Hide",e.Paint="Paint",e.Eyedropper="Eyedropper",e.Label="Label",e.Isolate="Isolate",e.Fade="Fade",e.Positions="Positions",e.Quiz="Quiz",e.Image="Image",e.Dimensions="Dimensions",e.Background="Background",e}(c||{})},22959:(be,q,d)=>{"use strict";d.d(q,{w:()=>D});var c=d(78109),e=d(75069),y=d(3266),l=d(20458),X=d(35650),$=d(81025),m=d(7431),O=d(3829),V=d(76304),I=d(61295),L=d(13409),M=d(12865),S=d(92014);class b{}var Z,f=d(81881),U=function(te){return te[te.Modify=0]="Modify",te[te.Replace=1]="Replace",te}(U||{}),C=d(58398),T=d(17215),w=d(49204),v=d(1102),A=d(85586),R=d(59676),N=d(59429),B=d(54438),Q=function(te,E,K,u){var oe,x=arguments.length,z=x<3?E:null===u?u=Object.getOwnPropertyDescriptor(E,K):u;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(te,E,K,u);else for(var ge=te.length-1;ge>=0;ge--)(oe=te[ge])&&(z=(x<3?oe(z):x>3?oe(E,K,z):oe(E,K))||z);return x>3&&z&&Object.defineProperty(E,K,z),z},H=function(te,E){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(te,E)};const k={currentRecipe:l.Rn,brushMode:U.Replace,storyRecipes:{},recentRecipes:[],uniqueStoryRecipes:[],palettes:[]};let h=class sd{static#e=Z=this;static getCurrentRecipe(E){return E.currentRecipe}static getCurrentRecipeForEngine(E){return(0,v.Sf)(E.currentRecipe)}static getPaintBrushMode(E){return E.brushMode}static getRecentRecipes(E){return E.recentRecipes}static getStoryRecipes(E){return E.storyRecipes}static getUniqueStoryRecipes(E){return E.uniqueStoryRecipes}static getPalettes(E){return E.palettes}static getCurrentChapterRecipes(E,K){return E.storyRecipes[K.selectedChapter]}static getChapterRecipes(E){return(0,S.Mz)([Z],K=>K.storyRecipes[E])}setCurrentRecipe(E,{colorRecipe:K}){E.patchState({currentRecipe:K})}setBrushMode(E,K){E.patchState({brushMode:K.brushMode})}clearCurrentRecipe(E,K){E.patchState({currentRecipe:null})}resetPaint(E,K){E.setState(k)}addRecentRecipe(E,K){let u=E.getState().recentRecipes;u.some(z=>(0,C.n4)(z,K.recipe))||(u.splice(0,0,K.recipe),u.length>14&&(u=u.slice(0,14)),this.storageService.setLocalItem(T.UT.RecentRecipes,u),E.patchState({recentRecipes:[...u]}))}setRecentRecipes(E,K){const u=(0,w.isNil)(K.recipes)?[]:[...K.recipes];E.patchState({recentRecipes:u}),this.storageService.setLocalItem(T.UT.RecentRecipes,u)}setStoryRecipesForChapter(E,K){const u=(0,C.c7)(K.recipes),x=E.getState().storyRecipes;x[K.chapterId]=[...u],E.patchState({storyRecipes:x});const z=Object.values(x).reduce((ge,ie)=>[...ge,...ie],[]),oe=(0,C.c7)(z).sort(C.UD);E.patchState({uniqueStoryRecipes:oe})}resetStoryRecipes(E,K){E.patchState({storyRecipes:{}})}addPalette(E,K){K.palette.id=N.u.idWithPrefix("palette");const u=[...E.getState().palettes,K.palette];E.dispatch(new f.T2(u))}updatePalette(E,K){const u=E.getState().palettes,x=u.findIndex(z=>z.id===K.palette.id);x>=0&&(u[x]={...K.palette}),E.dispatch(new f.T2(u))}removePalette(E,K){const u=[...E.getState().palettes.filter(x=>x.id!==K.paletteId)];E.dispatch(new f.T2(u))}setPalettes(E,K){const u=(0,w.cloneDeep)(K.palettes?[...K.palettes]:[]);E.patchState({palettes:u}),localStorage.setItem(T.UT.PaintPalettes,JSON.stringify(u))}addRecipeToPalette(E,K){const u=E.getState().palettes,x=u.findIndex(z=>z.id===K.paletteId);x>=0&&u[x].recipes.push(K.recipe),E.dispatch(new f.T2(u))}togglePalette(E,K){const u=E.getState().palettes,x=u.findIndex(z=>z.id===K.paletteId);x>=0&&(u[x].open=(0,w.isNil)(K.open)?!u[x].open:K.open,E.dispatch(new f.T2(u)))}ngxsOnInit(E){}constructor(E){this.storageService=E}static#t=this.\u0275fac=function(K){return new(K||sd)(B.KVO(T.n$))};static#n=this.\u0275prov=B.jDH({token:sd,factory:sd.\u0275fac})};Q([(0,S.rc)(f.WD),H("design:type",Function),H("design:paramtypes",[Object,f.WD]),H("design:returntype",void 0)],h.prototype,"setCurrentRecipe",null),Q([(0,S.rc)(f.GG),H("design:type",Function),H("design:paramtypes",[Object,f.GG]),H("design:returntype",void 0)],h.prototype,"setBrushMode",null),Q([(0,S.rc)(f.Hr),H("design:type",Function),H("design:paramtypes",[Object,f.Hr]),H("design:returntype",void 0)],h.prototype,"clearCurrentRecipe",null),Q([(0,S.rc)(f.yk),H("design:type",Function),H("design:paramtypes",[Object,f.yk]),H("design:returntype",void 0)],h.prototype,"resetPaint",null),Q([(0,S.rc)(f.Df),H("design:type",Function),H("design:paramtypes",[Object,f.Df]),H("design:returntype",void 0)],h.prototype,"addRecentRecipe",null),Q([(0,S.rc)(f.Nf),H("design:type",Function),H("design:paramtypes",[Object,f.Nf]),H("design:returntype",void 0)],h.prototype,"setRecentRecipes",null),Q([(0,S.rc)(f.b8),H("design:type",Function),H("design:paramtypes",[Object,f.b8]),H("design:returntype",void 0)],h.prototype,"setStoryRecipesForChapter",null),Q([(0,S.rc)(f.yE),H("design:type",Function),H("design:paramtypes",[Object,f.yE]),H("design:returntype",void 0)],h.prototype,"resetStoryRecipes",null),Q([(0,S.rc)(f.hd),H("design:type",Function),H("design:paramtypes",[Object,f.hd]),H("design:returntype",void 0)],h.prototype,"addPalette",null),Q([(0,S.rc)(f.ut),H("design:type",Function),H("design:paramtypes",[Object,f.ut]),H("design:returntype",void 0)],h.prototype,"updatePalette",null),Q([(0,S.rc)(f.yG),H("design:type",Function),H("design:paramtypes",[Object,f.yG]),H("design:returntype",void 0)],h.prototype,"removePalette",null),Q([(0,S.rc)(f.T2),H("design:type",Function),H("design:paramtypes",[Object,f.T2]),H("design:returntype",void 0)],h.prototype,"setPalettes",null),Q([(0,S.rc)(f.yJ),H("design:type",Function),H("design:paramtypes",[Object,f.yJ]),H("design:returntype",void 0)],h.prototype,"addRecipeToPalette",null),Q([(0,S.rc)(f.wx),H("design:type",Function),H("design:paramtypes",[Object,f.wx]),H("design:returntype",void 0)],h.prototype,"togglePalette",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getCurrentRecipe",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getCurrentRecipeForEngine",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getPaintBrushMode",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getRecentRecipes",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getStoryRecipes",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getUniqueStoryRecipes",null),Q([(0,S.MD)(),H("design:type",Function),H("design:paramtypes",[b]),H("design:returntype",void 0)],h,"getPalettes",null),Q([(0,S.MD)([h,A.N]),H("design:type",Function),H("design:paramtypes",[b,R.G]),H("design:returntype",void 0)],h,"getCurrentChapterRecipes",null),h=Z=Q([(0,S.Uw)({name:"editPaint",defaults:k}),H("design:paramtypes",[T.n$])],h);var p=d(18617);let D=(()=>{class te{constructor(K,u,x,z,oe){this.store=K,this.graphService=u,this.cameraService=x,this.sceneService=z,this.liveAnnouncer=oe}applyCurrentRecipe(K){const u=this.store.selectSnapshot(h.getCurrentRecipe);if(!u)return;Object.entries(u).forEach(([z,oe])=>{typeof oe>"u"&&(u[z]=!1)}),this.store.dispatch(new I.Jp(u,K));const x=K.reduce((z,oe)=>(z[oe]=!1,z),{});this.sceneService.setNodesProperty(x,"selected")}fadeInverse(K){const u=this.store.selectSnapshot(V.S.getViewGraph),x=this.graphService.getInverseSelection(u,K),z=this.graphService.getNodes(u,x);this.store.dispatch(new I.Jp(l.EC,z.map(oe=>oe.id))).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}fade(K){this.store.dispatch(new I.Jp(l.EC,K)).subscribe(()=>{this.liveAnnouncer.announce("Fade complete")})}hideInverse(K){const u=this.store.selectSnapshot(V.S.getViewGraph),x=this.graphService.getAllLeafDescendants(u,K),z=this.graphService.getInverseSelection(u,K),oe={};x.forEach(Se=>{oe[Se]=!0}),z.forEach(Se=>{oe[Se]=!1});const ge=new I.yr(void 0,void 0,oe),ie=(0,M.r)(this.store.selectSnapshot(L.z.getState),ge,this.sceneService);this.store.dispatch(new I.NP(ie.patches));const Y=this.sceneService.getObjectBoundary(K),W=this.cameraService.getCameraAfterFlyTo(Y),Ee=new m.Yp(W),re=function j(te,E){const[K,u,x]=$.vI(te,z=>{z.cameraFlyTo=E.camera});return{nextState:K,patches:u,inversePatches:x}}(this.store.selectSnapshot(O.x.getState),Ee);this.store.dispatch(new m.sQ(re.patches)).subscribe(()=>{this.liveAnnouncer.announce("Isolate complete")}),this.store.dispatch(new I.hg),this.store.dispatch(new I.q9(!1)),this.store.dispatch(new e.a.SavePatches([{forward:ie.patches,inverse:ie.inversePatches,patchAction:I.NP},{forward:re.patches,inverse:re.inversePatches,patchAction:m.sQ}]))}clearSelection(){this.store.dispatch(new I.hg),this.store.dispatch(new I.q9(!1))}show(K,u){this.store.dispatch(new I.yr(u,[K]))}static#e=this.\u0275fac=function(u){return new(u||te)(B.KVO(S.il),B.KVO(c.w),B.KVO(y.j),B.KVO(X.w),B.KVO(p.Ai))};static#t=this.\u0275prov=B.jDH({token:te,factory:te.\u0275fac,providedIn:"root"})}return te})()},60286:(be,q,d)=>{"use strict";d.d(q,{s:()=>$});var c=d(78109),e=d(1102),y=d(35650),X=d(54438);let $=(()=>{class j{constructor(O,V){this.graphService=O,this.sceneService=V,this.highlightDisabled=!1}colorObject(O,V){const I=this.sceneService.getObjectById(O);if(this.sceneService.isLeaf(I)){const L=I.modifiers;Object.keys(V).forEach(M=>{const S=V[M];if(!1===S)L.delete(M);else if(Array.isArray(S)&&5===S.length){const[b,f,U,C,T]=S;L.set(M,{applyTo:M,fresnel:{center:b,edge:f,centerBias:U,edgeBias:C,power:T}})}else L.set(M,{applyTo:M,value:S})})}}getColor(O){return function l(j,m){const O=j.getObjectById(m);if(j.isLeaf(O)){const I={};return O.modifiers.forEach(L=>{I[L.applyTo]=L.fresnel??L.value}),I}return null}(this.sceneService,O)}uncolorObject(O){const V=this.sceneService.getObjectById(O);this.sceneService.isLeaf(V)&&V.modifiers.clear()}unpaint(O,V){this.graphService.getLeafDescendants(O,V.id).forEach(I=>{const L=this.sceneService.getObjectById(I);this.sceneService.isLeaf(L)&&L.modifiers.clear()})}paint(O,V,I){const L=(0,e.Sf)(I);this.graphService.getLeafDescendants(O,V).forEach(M=>{this.colorObject(M,L)})}highlight(O,V,I){(!1===this.highlightDisabled||!1===I)&&this.graphService.getLeafDescendants(O,V).forEach(L=>{const M=this.sceneService.getObjectById(L);this.sceneService.isLeaf(M)&&(M.selected=I)})}paintAll(O,V,I){V.forEach(L=>this.paint(O,L,I))}unpaintAll(O,V){V.forEach(I=>{this.unpaint(O,I)})}highlightAll(O,V,I){V.forEach(L=>this.highlight(O,L,I))}disableHighlight(){this.highlightDisabled=!0}enableHighlight(){this.highlightDisabled=!1}setHighlightColor(O){}getColorRecipes(){return[]}static#e=this.\u0275fac=function(V){return new(V||j)(X.KVO(c.w),X.KVO(y.w))};static#t=this.\u0275prov=X.jDH({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})()},35650:(be,q,d)=>{"use strict";d.d(q,{w:()=>U});var c=d(2353),e=d(38472),y=d(44867),l=d(23881),X=d(78109),$=d(72849),j=d(11724),O=d(46889),V=d(49204),L=d(56343),M=d(54438);const S=1/j.BIODIGITAL_SCENE_SCALE,b=new j.AABB,f={shown:L.t.TrueWins,renderable:L.t.FalseWins,pickable:L.t.TrueWins};let U=(()=>{class C{constructor(w,v){this.engineService=w,this.graphService=v}getObjects(){const w={};return this.getAnatomySceneGraph()?.anatomyObjects.forEach((A,R)=>w[R]=A),w}getObjectById(w){return this.getAnatomySceneGraph()?.anatomyObjects?.get(w)}getObjectsById(w){const A=this.getAnatomySceneGraph()?.anatomyObjects;return w.reduce((R,N)=>{const B=A?.get(N);return B&&(R[B.objectId]=B),R},{})}isObjectLoaded(w){return!0===this.getObjectById(w)?.loaded}isObjectCulledByClip(w,v){if(0===v.length)return!1;const A=v.map(R=>R.plane);return w.renderables.some(R=>(0,j.boxIntersectsPlaneBounds)(A,R.meshNode.worldBounds))}getRootObjects(){return this.getAnatomySceneGraph()?.anatomyRoots??[]}getSceneBoundary(){const{rootNode:w}=this.engineService.engine;return this.getSceneNodeBoundaryModel([w],b)}getObjectBoundary(w){const v=w.map(A=>this.getObjectById(A).sceneNode);return this.getSceneNodeBoundaryModel(v,b)}getObjectBoundaryCenter(w){const v=this.getObjectBoundary([w]),{min:A,max:R}=(0,c.n)(v);return(0,O.A1)(A,R)}setShownObjects(w){const{replace:v,showObjects:A}=w,R=this.getRootObjects();this.setObjectsShown(R,A,!v&&void 0)}getLeavesByObject(w){const v=w.children??[];return 0===v.length?[w]:v.map(A=>this.getLeavesByObject(A)).flat()}getLeaves(w){if(w){const v=this.getObjectById(w);return v?this.getLeavesByObject(v):[]}return this.getRootObjects().map(A=>this.getLeavesByObject(A)).flat()}getLeafIds(w){return this.getLeaves(w).map(v=>v.objectId)}getEnabledLeafIds(){return this.getLeaves().filter(w=>!0===w?.shown).map(w=>w.objectId)}isLeaf(w){return 0===w.children.length}transformObject(w,v){const A=this.getObjectById(w)?.sceneNode;A?(0,j.applyTransform)(A,v):console.error(`Scene node not found: '${w}'`)}setNodesVisible(w,v=!1){const A={replace:v,showObjects:{...w}};this.setShownObjects(A)}setNodesProperty(w,v){Object.keys(w).forEach(A=>{const R=this.getObjectById(A);(this.isLeaf(R)?[A]:this.getLeafIds(A)).forEach(B=>{this.getObjectById(B)[v]=w[A]})})}setObjectLayer(w,v,A){w.get(v).layer=A}setObjectVariant(w,v,A){w.get(v).variant=A}getObjectLayerValues(w){const v={},A=this.getSceneBoundary();return w.forEach(R=>{const N=this.getObjectById(R),B=this.getObjectBoundary([R]),Q=Math.min(B.xmin-A.xmin,A.xmax-B.xmax),H=2*Math.min(B.ymin-A.ymin,A.ymax-B.ymax),Z=Math.min(B.zmin-A.zmin,A.zmax-B.zmax),k=N.layer;v[k]=v[k]??[],v[k].push({nodeId:R,value:Math.min(Q,H,Z)})}),v}getWorldPosition(w,v,A,R=0){const B=this.getObjectById(w)?.renderables[R]?.meshNode;if((0,V.isNil)(B))return;const Q=B.worldMatrix,H=e.create(),Z=j.vec3Pool.get(),k=j.vec3Pool.get(),h=j.vec3Pool.get();return(0,j.getTrianglePositions)(B,v,Z,k,h),(0,j.cartesianCoord)(H,A,Z,k,h),e.transformMat4(H,H,Q),e.scale(H,H,1/j.BIODIGITAL_SCENE_SCALE),j.vec3Pool.release(Z),j.vec3Pool.release(k),j.vec3Pool.release(h),H}getSceneGraph(w){const{anatomyObjects:v}=this.getAnatomySceneGraph(),A={...(0,l.ow)(),shown:N=>!0===v.get(N)?.shown,pickable:N=>!0===v.get(N)?.pickable,label:N=>v.get(N)?.displayName??"",layer:N=>v.get(N)?.layer??0},R=(0,y.fm)(w,A);return this.graphService.synchronize(R,f),R}createViewGraph({availableObjects:w,showObjects:v,includeRoot:A=!1,viewGraphMetadata:R}){const N=this.getRootObjects(),B=v?(0,y.TJ)(N,v):N,Q=B.reduce((Z,k)=>{const h=!A&&k.objectId.includes("-root");return Z[k.objectId]=!h,h&&k.children.forEach(p=>{Z[p.objectId]=!0}),Z},{}),H=this.getSceneGraph((0,y.TJ)(B,Q));return this.graphService.resetDepth(H),(0,V.isEmpty)(w)||this.computeObjectAvailable(H,w),(0,V.isEmpty)(R)||this.computeNodesMetadata(H,R),H}computeObjectAvailable(w,v){const{anatomyObjects:A}=this.getAnatomySceneGraph(),R=B=>A.get(B).parent?.objectId,N=B=>{const Q=A.get(B);return Q?Q.children.map(H=>H.objectId):[]};Object.entries(w.nodes).forEach(([B,Q])=>{Q.boolState.available=(0,y.If)(B,v,R,N)})}computeNodesMetadata(w,v){(0,y.u7)(w,v)}getViewNode(w,v){return this.graphService.nodeExists(w,v)?(0,y.dV)(w,v):null}setObjectsShown(w,v,A){w.forEach(R=>{const B=v[R.objectId]??A;"boolean"==typeof B&&R.shown!==B&&(R.shown=B),this.setObjectsShown(R.children,v,A)})}getSceneNodeBoundaryModel(w,v){const{min:A,max:R}=this.getSceneNodeBounds(w,v);return e.scale(A,A,S),e.scale(R,R,S),{xmin:A[0],ymin:A[1],zmin:A[2],xmax:R[0],ymax:R[1],zmax:R[2]}}getSceneNodeBounds(w,v){return v.clear(),w.forEach(A=>{(0,j.traverseSceneNodes)(A,R=>{R instanceof j.MeshNode&&v.expand(R.worldBounds)})}),v}getChapterIndex(w){return this.engineService.engine.story?.chapters?.findIndex(R=>R.id===w)}getChapter(w){const v=this.engineService.engine?.story,A=v?.chapters,R=v?.activeChapterIndex;return A?.[w??R]}getAnatomySceneGraph(){return this.engineService.engine?.story?.anatomySceneGraph}static#e=this.\u0275fac=function(v){return new(v||C)(M.KVO($.y),M.KVO(X.w))};static#t=this.\u0275prov=M.jDH({token:C,factory:C.\u0275fac,providedIn:"root"})}return C})()},30582:(be,q,d)=>{"use strict";d.d(q,{M:()=>C});var c=d(28407),e=d(21472),y=d(15877),l=d(35892),X=d(2573),$=d(36110),j=d(98837),m=d(11756),O=d(28577),V=d(8358),I=d(42482),L=d(46799),M=d(11789),S=d(98020),b=d(20342),f=d(54438),U=d(92014);let C=(()=>{class T{constructor(v,A,R){this.labelsService=v,this.engineRendererService=A,this.store=R,this.drawCanvas=null,this.annotateElement=null}setDrawCanvas(v){this.drawCanvas=v}getDrawCanvas(){return this.drawCanvas}setAnnotateElement(v){this.annotateElement=v}getAnnotateElement(){return this.annotateElement}localResize(v,A){const R=this.engineRendererService.getCanvas(),N=R.parentNode,B=N.clientWidth,Q=N.clientHeight;return R.width=v,R.height=A,N.style.width=`${v}px`,N.style.height=`${A}px`,[B,Q]}canvasToImage(v,A="original",R){var N=this;return(0,c.A)(function*(){const{width:B,height:Q}=v,H=v.getContext("2d"),Z=N.labelsService.getLabelContainer().nativeElement,k=v.width/v.height,h=N.engineRendererService.getCanvas();let{width:p,height:D}=h,te=.5*(h.width-p),E=0;switch(A){case"square":D>p?D=p:p=D,te=.5*(h.width-p),E=.5*(h.height-D);break;case"original":p=k*D}return N.engineRendererService.forceRenderFrame(),H.drawImage(h,te,E,p,D,0,0,B,Q),R&&Z?new Promise(requestAnimationFrame).then((0,c.A)(function*(){const K=yield I.X.elementToCanvas(Z,!0);return H.drawImage(K,te,E,p,D,0,0,B,Q),v})):v})()}canvasToImageWithResize(v,A){var R=this;return(0,c.A)(function*(){const{width:N,height:B}=v,Q=R.engineRendererService.getCanvas(),H=v.getContext("2d"),Z=R.labelsService.getLabelContainer().nativeElement,[k,h]=R.localResize(N,B);return R.engineRendererService.forceRenderFrame(),H.drawImage(Q,0,0,N,B),A&&Z?new Promise(requestAnimationFrame).then((0,c.A)(function*(){const p=yield I.X.elementToCanvas(Z,!0);return H.drawImage(p,0,0,N,B),R.localResize(k,h),v})):(R.localResize(k,h),v)})()}drawRadialGradient(v,A){const R=A.colors,[B,Q]=A.colorStops.map(p=>((p,D,te)=>{const[E,K]=[Math.pow(D/2,2),Math.pow(te/2,2)];return p/100*Math.pow(E+K,.5)})(p,v.width,v.height)),H=v.getContext("2d"),[Z,k]=[v.width/2,v.height/2],h=H.createRadialGradient(Z,k,B,Z,k,Q);h.addColorStop(A.colorStops[0]/100,`rgba(${R.slice(0,4).join(",")})`),h.addColorStop(A.colorStops[1]/100,`rgba(${R.slice(4,8).join(",")})`),H.fillStyle=h,H.fillRect(0,0,v.width,v.height)}drawLinearGradient(v,A){const R=A.colors,N=v.getContext("2d"),[B,Q]=[v.width/2,v.height/2],H=N.createLinearGradient(B,Q,B,v.height);H.addColorStop(A.colorStops[0]/100,`rgba(${R.slice(0,4).join(",")})`),H.addColorStop(A.colorStops[1]/100,`rgba(${R.slice(4,8).join(",")})`),N.fillStyle=H,N.fillRect(0,0,v.width,v.height)}takeSnapshot(v,A,R,N,B,Q,H=1){const{imageType:Z,imageQuality:k,copyrightEnabled:h,crop:p}=Q,D=document.createElement("canvas");D.width=v,D.height=A,"radial"===R.gradientType?this.drawRadialGradient(D,R):"linear"===R.gradientType&&this.drawLinearGradient(D,R);const te=this.engineRendererService.getCanvas(),K=[],u=1!==H||D.height>te.height||D.width>te.width?this.canvasToImageWithResize(D,B):this.canvasToImage(D,p,B),x=(0,e.H)(u);K.push(x);const z=[...N];return K.push(...z.map(oe=>(oe instanceof HTMLCanvasElement?(0,y.of)(oe):(0,e.H)(I.X.elementToCanvas(oe,!0))).pipe((0,$.T)(ie=>I.X.fitCanvas(ie,v,A))))),this.engineRendererService.forceRenderFrame(),(0,l.x)(K).pipe((0,j.p)(),(0,$.T)(oe=>I.X.combineCanvasElements(oe)),(0,m.Z)(oe=>h?this.writeLogoToCanvas(oe,Q):(0,y.of)(oe)),(0,m.Z)(oe=>I.X.canvasToBlob(oe,Z,k)))}writeLogoToCanvas(v,A){return this.getLogoImage(A.copyrightImagePath).pipe((0,$.T)(R=>{let{width:N,height:B}=R;const{width:Q,height:H}=v;if(.1*Q>N){const p=B/N;N=.1*Q,B=p*N}const{xOffset:Z,yOffset:k}=this.getLogoPosition(Q,H,N,B,A);return v.getContext("2d").drawImage(R,Z,k,N,B),v}),(0,O.W)(()=>(0,y.of)(v)))}getLogoImage(v){return new X.c(A=>{const R=new Image;R.onload=()=>{A.next(R),A.complete()},R.onerror=()=>A.error(),R.src=v})}getLogoPosition(v,A,R,N,B){const{copyrightPosition:Q,copyrightOffset:H}=B;let Z,k;switch(Q.x){case"right":Z=v-R;break;case"center":Z=v/2-R/2;break;default:Z=0}switch(Q.y){case"bottom":k=A-N;break;case"center":k=A/2-N/2;break;default:k=0}return{xOffset:Z+H.x,yOffset:k+H.y}}getLogoFromBackground(v){const A=v.colors.slice(0,3),R=M.T.isLight(A),N=this.store.selectSnapshot(S.X.getViewLogoConfig);return(0,b.g)(N,"full",R?"color":"white")}static#e=this.\u0275fac=function(A){return new(A||T)(f.KVO(V.x),f.KVO(L.z),f.KVO(U.il))};static#t=this.\u0275prov=f.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},7431:(be,q,d)=>{"use strict";d.d(q,{Cy:()=>X,F5:()=>O,Ih:()=>c,Nz:()=>e,P4:()=>$,Qn:()=>y,RG:()=>V,RJ:()=>b,Xz:()=>U,Yi:()=>I,Yp:()=>T,bB:()=>L,gV:()=>l,j4:()=>M,nW:()=>j,pU:()=>C,pg:()=>m,qG:()=>S,sQ:()=>w,vq:()=>f});let c=(()=>{class v{static#e=this.type="[Engine Camera] Set Camera";constructor(R,N=!0,B,Q){this.camera=R,this.animate=N,this.animationDuration=B,this.rotationCenter=Q}}return v})(),e=(()=>{class v{static#e=this.type="[Engine Camera] Set Camera Success"}return v})(),y=(()=>{class v{static#e=this.type="[Engine Camera] Set Chapter Camera Enabled";constructor(R){this.enabled=R}}return v})(),l=(()=>{class v{static#e=this.type="[Engine Camera] Set Chapter Camera Position";constructor(R,N){this.chapterId=R,this.position=N}}return v})(),X=(()=>{class v{static#e=this.type="[Engine Camera] Clear Chapter Camera Positions"}return v})(),$=(()=>{class v{static#e=this.type="[Engine Camera] Move Camera";constructor(R){this.cameraMotion=R}}return v})(),j=(()=>{class v{static#e=this.type="[Engine Camera] Reset Camera"}return v})(),m=(()=>{class v{static#e=this.type="[Engine Camera] Zoom Camera";constructor(R){this.value=R}}return v})(),O=(()=>{class v{static#e=this.type="[Engine Camera] Zoom Camera Static";constructor(R){this.value=R}}return v})(),V=(()=>{class v{static#e=this.type="[Engine Camera] Pan Camera X";constructor(R){this.value=R}}return v})(),I=(()=>{class v{static#e=this.type="[Engine Camera] Pan Camera Y";constructor(R){this.value=R}}return v})(),L=(()=>{class v{static#e=this.type="[Engine Camera] Pan Camera Static";constructor(R,N,B){this.x=R,this.y=N,this.z=B}}return v})(),M=(()=>{class v{static#e=this.type="[Engine Camera] Rotate Camera X";constructor(R){this.value=R}}return v})(),S=(()=>{class v{static#e=this.type="[Engine Camera] Rotate Camera Y";constructor(R){this.value=R}}return v})(),b=(()=>{class v{static#e=this.type="[Engine Camera] Rotate Camera Static";constructor(R,N){this.x=R,this.y=N}}return v})(),f=(()=>{class v{static#e=this.type="[Engine Camera] Set Camera Mode";constructor(R){this.mode=R}}return v})(),U=(()=>{class v{static#e=this.type="[Engine Camera] Set Zoomed";constructor(R){this.zoomed=R}}return v})(),C=(()=>{class v{static#e=this.type="[Engine Camera] Lock camera";constructor(R){this.lock=R}}return v})(),T=(()=>{class v{static#e=this.type="[Engine Camera] Set Camera Fly To";constructor(R){this.camera=R}}return v})(),w=(()=>{class v{static#e=this.type="[Engine Camera] Patch Camera State";constructor(R){this.patches=R}}return v})()},3829:(be,q,d)=>{"use strict";d.d(q,{x:()=>f});var c=d(28407),e=d(92014);class y{}var l=d(7431),X=d(3266),$=d(57021),j=d(85586),m=d(81025),O=d(18617),V=d(72849),I=d(49204),L=d(54438),M=function(U,C,T,w){var R,v=arguments.length,A=v<3?C:null===w?w=Object.getOwnPropertyDescriptor(C,T):w;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)A=Reflect.decorate(U,C,T,w);else for(var N=U.length-1;N>=0;N--)(R=U[N])&&(A=(v<3?R(A):v>3?R(C,T,A):R(C,T))||A);return v>3&&A&&Object.defineProperty(C,T,A),A},S=function(U,C){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(U,C)};const b={cameraMotion:new $.x,panMode:"rotate",zoomed:!1,lockCamera:!1,cameraFlyTo:void 0,chapterCameraEnabled:!0,chapterCameraPositions:new Map};let f=class ad{static getState(C){return C}static getCameraMotion(C){return C.cameraMotion}static getPanMode(C){return C.panMode}static getZoomed(C){return C.zoomed}static getLockCamera(C){return C.lockCamera}static getChapterCameraEnabled(C){return C.chapterCameraEnabled}static getChapterCameraPositions(C){return C.chapterCameraPositions}setCameraFlyTo(C,T){C.patchState(m.jM(C.getState(),w=>{w.cameraFlyTo=T.camera}))}applyCameraPatch(C,T){const w=m.$i(C.getState(),T.patches);C.patchState(w);const v=void 0===w.cameraFlyTo?this.store.selectSnapshot(j.N.getChapterCamera):w.cameraFlyTo;C.dispatch(new l.Ih(v,!0,1))}moveCamera(C,T){C.patchState({cameraMotion:{...T.cameraMotion}})}resetCamera(C,T){var w=this;return(0,c.A)(function*(){const v=w.store.selectSnapshot(j.N.getSelectedChapter);return((0,I.isNil)(w.engineService.engine?.story?.activeChapter)?Promise.resolve():w.cameraService.flyToCamera(v.camera.location)).then(()=>{C.patchState({cameraMotion:new $.x})})})()}zoomCamera(C,T){const{cameraMotion:w}=C.getState();w.zoom=T.value,C.patchState({cameraMotion:{...w}})}panCameraX(C,T){const{cameraMotion:w}=C.getState();w.panX=T.value,C.patchState({cameraMotion:{...w}})}panCameraY(C,T){const{cameraMotion:w}=C.getState();w.panY=T.value,C.patchState({cameraMotion:{...w}})}rotateCameraX(C,T){const{cameraMotion:w}=C.getState();C.patchState({cameraMotion:{...w,rotateX:T.value}})}rotateCameraY(C,T){const{cameraMotion:w}=C.getState();w.rotateY=T.value,C.patchState({cameraMotion:{...w}})}SetCameraMode(C,T){C.patchState({panMode:T.mode}),this.liveAnnouncer.announce(`Switched to ${T.mode} mode`)}setZoomed(C,T){C.patchState({zoomed:T.zoomed})}lockCamera(C,T){C.patchState({lockCamera:T.lock})}setChapterCameraEnabled(C,T){C.patchState({chapterCameraEnabled:T.enabled})}setChapterCameraPosition(C,T){const w=C.getState().chapterCameraPositions;w.set(T.chapterId,T.position),C.patchState({chapterCameraPositions:w})}clearChapterCameraPositions(C){const T=C.getState().chapterCameraPositions;T.clear(),C.patchState({chapterCameraPositions:T})}constructor(C,T,w,v){this.cameraService=C,this.liveAnnouncer=T,this.store=w,this.engineService=v}static#e=this.\u0275fac=function(T){return new(T||ad)(L.KVO(X.j),L.KVO(O.Ai),L.KVO(e.il),L.KVO(V.y))};static#t=this.\u0275prov=L.jDH({token:ad,factory:ad.\u0275fac})};M([(0,e.rc)(l.Yp),S("design:type",Function),S("design:paramtypes",[Object,l.Yp]),S("design:returntype",void 0)],f.prototype,"setCameraFlyTo",null),M([(0,e.rc)(l.sQ),S("design:type",Function),S("design:paramtypes",[Object,l.sQ]),S("design:returntype",void 0)],f.prototype,"applyCameraPatch",null),M([(0,e.rc)(l.P4),S("design:type",Function),S("design:paramtypes",[Object,l.P4]),S("design:returntype",void 0)],f.prototype,"moveCamera",null),M([(0,e.rc)(l.nW),S("design:type",Function),S("design:paramtypes",[Object,l.nW]),S("design:returntype",Promise)],f.prototype,"resetCamera",null),M([(0,e.rc)(l.pg),S("design:type",Function),S("design:paramtypes",[Object,l.pg]),S("design:returntype",void 0)],f.prototype,"zoomCamera",null),M([(0,e.rc)(l.RG),S("design:type",Function),S("design:paramtypes",[Object,l.RG]),S("design:returntype",void 0)],f.prototype,"panCameraX",null),M([(0,e.rc)(l.Yi),S("design:type",Function),S("design:paramtypes",[Object,l.Yi]),S("design:returntype",void 0)],f.prototype,"panCameraY",null),M([(0,e.rc)(l.j4),S("design:type",Function),S("design:paramtypes",[Object,l.j4]),S("design:returntype",void 0)],f.prototype,"rotateCameraX",null),M([(0,e.rc)(l.qG),S("design:type",Function),S("design:paramtypes",[Object,l.qG]),S("design:returntype",void 0)],f.prototype,"rotateCameraY",null),M([(0,e.rc)(l.vq),S("design:type",Function),S("design:paramtypes",[Object,l.vq]),S("design:returntype",void 0)],f.prototype,"SetCameraMode",null),M([(0,e.rc)(l.Xz),S("design:type",Function),S("design:paramtypes",[Object,l.Xz]),S("design:returntype",void 0)],f.prototype,"setZoomed",null),M([(0,e.rc)(l.pU),S("design:type",Function),S("design:paramtypes",[Object,l.pU]),S("design:returntype",void 0)],f.prototype,"lockCamera",null),M([(0,e.rc)(l.Qn),S("design:type",Function),S("design:paramtypes",[Object,l.Qn]),S("design:returntype",void 0)],f.prototype,"setChapterCameraEnabled",null),M([(0,e.rc)(l.gV),S("design:type",Function),S("design:paramtypes",[Object,l.gV]),S("design:returntype",void 0)],f.prototype,"setChapterCameraPosition",null),M([(0,e.rc)(l.Cy),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",void 0)],f.prototype,"clearChapterCameraPositions",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getState",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getCameraMotion",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getPanMode",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getZoomed",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getLockCamera",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getChapterCameraEnabled",null),M([(0,e.MD)(),S("design:type",Function),S("design:paramtypes",[y]),S("design:returntype",void 0)],f,"getChapterCameraPositions",null),f=M([(0,e.Uw)({name:"engineCamera",defaults:b}),S("design:paramtypes",[X.j,O.Ai,e.il,V.y])],f)},20339:(be,q,d)=>{"use strict";d.d(q,{Z:()=>c});let c=(()=>{class e{static#e=this.type="[Engine Config] Set Show Unavailable Nodes";constructor(l){this.showUnavailableNodes=l}}return e})()},43631:(be,q,d)=>{"use strict";d.d(q,{_:()=>j});var c=d(92014);class e{}var y=d(20339),l=d(54438),X=function(m,O,V,I){var S,L=arguments.length,M=L<3?O:null===I?I=Object.getOwnPropertyDescriptor(O,V):I;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)M=Reflect.decorate(m,O,V,I);else for(var b=m.length-1;b>=0;b--)(S=m[b])&&(M=(L<3?S(M):L>3?S(O,V,M):S(O,V))||M);return L>3&&M&&Object.defineProperty(O,V,M),M},$=function(m,O){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(m,O)};let j=class rd{static getPerChapterTreeEnabled(O){return O.perChapterTreeEnabled}static getShowUnavailableNodes(O){return O.showUnavailableNodes}setShowUnavailableNodes(O,{showUnavailableNodes:V}){O.patchState({showUnavailableNodes:V})}static#e=this.\u0275fac=function(V){return new(V||rd)};static#t=this.\u0275prov=l.jDH({token:rd,factory:rd.\u0275fac})};X([(0,c.rc)(y.Z),$("design:type",Function),$("design:paramtypes",[Object,y.Z]),$("design:returntype",void 0)],j.prototype,"setShowUnavailableNodes",null),X([(0,c.MD)(),$("design:type",Function),$("design:paramtypes",[e]),$("design:returntype",void 0)],j,"getPerChapterTreeEnabled",null),X([(0,c.MD)(),$("design:type",Function),$("design:paramtypes",[e]),$("design:returntype",void 0)],j,"getShowUnavailableNodes",null),j=X([(0,c.Uw)({name:"engineConfig",defaults:{showUnavailableNodes:!1,perChapterTreeEnabled:!0}})],j)},47610:(be,q,d)=>{"use strict";d.d(q,{$V:()=>A,$h:()=>u,A0:()=>w,A6:()=>k,AU:()=>y,BM:()=>at,DZ:()=>pe,E7:()=>yt,GT:()=>v,Gv:()=>H,In:()=>O,JK:()=>$,K6:()=>te,LL:()=>I,NO:()=>nt,P6:()=>B,PF:()=>z,Pk:()=>De,RR:()=>Ue,RV:()=>we,RZ:()=>x,Rc:()=>R,Sh:()=>oe,Tf:()=>c,Ti:()=>Q,Vs:()=>D,W6:()=>T,YI:()=>W,_h:()=>Ee,_o:()=>re,_y:()=>S,bo:()=>Qe,dB:()=>j,dE:()=>h,fZ:()=>C,hk:()=>X,iQ:()=>e,jM:()=>p,k2:()=>Oe,kE:()=>E,lQ:()=>ge,pL:()=>Z,q:()=>L,qL:()=>tt,ro:()=>Te,t5:()=>l,u3:()=>b,uM:()=>Y,v$:()=>se,vA:()=>ke,w8:()=>M,z:()=>Se,zE:()=>f,zW:()=>m,zw:()=>K});let c=(()=>{class ce{static#e=this.type="[Engine] Load";constructor(){}}return ce})(),e=(()=>{class ce{static#e=this.type="[Engine] Load Success";constructor(Ne){this.result=Ne}}return ce})(),y=(()=>{class ce{static#e=this.type="[Engine] Set Ready";constructor(Ne){this.ready=Ne}}return ce})(),l=(()=>{class ce{static#e=this.type="[Engine] Set Display of 3D Scene";constructor(Ne){this.display=Ne}}return ce})(),X=(()=>{class ce{static#e=this.type="[Engine] Set Zoom via scroll Allowed";constructor(Ne){this.scrollMode=Ne}}return ce})(),$=(()=>{class ce{static#e=this.type="[Engine] Set Scroll Alert Shwon";constructor(Ne){this.shown=Ne}}return ce})(),j=(()=>{class ce{static#e=this.type="[Engine] Set Visibility of 3D Scene";constructor(Ne){this.visible=Ne}}return ce})(),m=(()=>{class ce{static#e=this.type="[Engine] Fade";constructor(Ne,jt){this.color=Ne,this.duration=jt}}return ce})(),O=(()=>{class ce{static#e=this.type="[Engine] Fade Complete";constructor(){}}return ce})(),I=(()=>{class ce{static#e=this.type="[Engine] Set Graph";constructor(Ne){this.graph=Ne}}return ce})(),L=(()=>{class ce{static#e=this.type="[Engine] Get Graph Metadata";constructor(){}}return ce})(),M=(()=>{class ce{static#e=this.type="[Engine] Clear Graph";constructor(){}}return ce})(),S=(()=>{class ce{static#e=this.type="[Engine] Set Xray Mode";constructor(Ne){this.enabled=Ne}}return ce})(),b=(()=>{class ce{static#e=this.type="[Engine] Set Engine Chapter";constructor(Ne){this.chapterId=Ne}}return ce})(),f=(()=>{class ce{static#e=this.type="[Engine] Click Node";constructor(Ne,jt,pt){this.node=Ne,this.event=jt,this.hit=pt}}return ce})(),C=(()=>{class ce{static#e=this.type="[Engine] Set Contextmenu";constructor(Ne,jt){this.node=Ne,this.hit=jt}}return ce})(),T=(()=>{class ce{static#e=this.type="[Engine] Fly To Object";constructor(Ne,jt=!0,pt){this.objectId=Ne,this.animate=jt,this.animationDuration=pt}}return ce})(),w=(()=>{class ce{static#e=this.type="[Engine] Synchronize Visible Nodes On Tree";constructor(Ne,jt){this.leafVisibilityState=Ne,this.nodes=jt}}return ce})(),v=(()=>{class ce{static#e=this.type="[Engine] Synchronize Renderable State of Nodes On Tree";constructor(Ne){this.leafRenderableState=Ne}}return ce})(),A=(()=>{class ce{static#e=this.type="[Engine] Synchronize Pickable State of Nodes On Tree";constructor(Ne,jt){this.leafPickableState=Ne,this.nodes=jt}}return ce})(),R=(()=>{class ce{static#e=this.type="[Engine] Synchronize Available State of Nodes On Tree";constructor(Ne,jt){this.leafAvailableState=Ne,this.nodes=jt}}return ce})(),B=(()=>{class ce{static#e=this.type="[Engine] Toggle Camera Bar";constructor(Ne){this.show=Ne}}return ce})(),Q=(()=>{class ce{static#e=this.type="[Engine] Toggle Progress Bar";constructor(Ne){this.show=Ne}}return ce})(),H=(()=>{class ce{static#e=this.type="[Engine] Toggle Labels";constructor(Ne){this.show=Ne}}return ce})(),Z=(()=>{class ce{static#e=this.type="[Engine] Set active tool";constructor(Ne){this.tool=Ne}}return ce})(),k=(()=>{class ce{static#e=this.type="[Engine] Play chapter animation";constructor(){}}return ce})(),h=(()=>{class ce{static#e=this.type="[Engine] Play animation";constructor(Ne=!0){this.play=Ne}}return ce})(),p=(()=>{class ce{static#e=this.type="[Engine] Set animation playing";constructor(Ne){this.playing=Ne}}return ce})(),D=(()=>{class ce{static#e=this.type="[Engine] Set playback speed";constructor(Ne){this.speed=Ne}}return ce})(),te=(()=>{class ce{static#e=this.type="[Engine] Play chapter from start";constructor(){}}return ce})(),E=(()=>{class ce{static#e=this.type="[Engine] Set autoplay";constructor(Ne){this.enable=Ne}}return ce})(),K=(()=>{class ce{static#e=this.type="[Engine] Set object layer order";constructor(Ne,jt){this.nodes=Ne,this.layer=jt}}return ce})(),u=(()=>{class ce{static#e=this.type="[Engine] Set object display name";constructor(Ne,jt){this.nodeId=Ne,this.displayName=jt}}return ce})(),x=(()=>{class ce{static#e=this.type="[Engine] Auto Sort object layer orders";constructor(){}}return ce})(),z=(()=>{class ce{static#e=this.type="[Engine] Reset object layer orders";constructor(){}}return ce})(),oe=(()=>{class ce{static#e=this.type="[Engine] Set Engine Position";constructor(Ne){this.position=Ne}}return ce})(),ge=(()=>{class ce{static#e=this.type="[Engine] Reset Engine Position";constructor(){}}return ce})(),Y=(()=>{class ce{static#e=this.type="[Engine] Set Post Processing Effects";constructor(Ne){this.effects=Ne}}return ce})(),W=(()=>{class ce{static#e=this.type="[Engine] Set Properties";constructor(Ne){this.properties=Ne}}return ce})(),Ee=(()=>{class ce{static#e=this.type="[Engine] Set Transparency Mode";constructor(Ne){this.mode=Ne}}return ce})(),re=(()=>{class ce{static#e=this.type="[Engine] Expand ViewTree Node";constructor(Ne){this.node=Ne}}return ce})(),Se=(()=>{class ce{static#e=this.type="[Engine] Collapse ViewTree Node";constructor(Ne){this.node=Ne}}return ce})(),se=(()=>{class ce{static#e=this.type="[Engine] Collapse All ViewTree Nodes";constructor(){}}return ce})(),pe=(()=>{class ce{static#e=this.type="[Engine] Hover Node";constructor(Ne,jt){this.node=Ne,this.hit=jt}}return ce})(),Te=(()=>{class ce{static#e=this.type="[Engine] Set Label Edit Node";constructor(Ne){this.node=Ne}}return ce})(),we=(()=>{class ce{static#e=this.type="[Engine] Set Node Info";constructor(Ne,jt){this.node=Ne,this.info=jt}}return ce})(),Qe=(()=>{class ce{static#e=this.type="[Engine] Query Node Info";constructor(Ne,jt,pt){this.node=Ne,this.fallback=jt,this.lang=pt}}return ce})(),tt=(()=>{class ce{static#e=this.type="[Engine] Query Node Info Success";constructor(Ne,jt){this.node=Ne,this.info=jt}}return ce})(),Ue=(()=>{class ce{static#e=this.type="[Engine Nodes] Query Node Info Failure";constructor(Ne){this.node=Ne}}return ce})(),yt=(()=>{class ce{static#e=this.type="[Engine] Set Watermark Enabled";constructor(Ne){this.enabled=Ne}}return ce})(),ke=(()=>{class ce{static#e=this.type="[Engine] Set Engine WebGL Context";constructor(Ne){this.context=Ne}}return ce})(),at=(()=>{class ce{static#e=this.type="[Engine] Set Engine Stats Enabled";constructor(Ne,jt){this.enabled=Ne,this.showAdvancedTools=jt}}return ce})(),De=(()=>{class ce{static#e=this.type="[Engine] Set Pick State";constructor(Ne){this.pickState=Ne}}return ce})(),Oe=(()=>{class ce{static#e=this.type="[Engine] Take Snapshot";constructor(Ne,jt,pt,ct,ze,Hn,Pi){this.width=Ne,this.height=jt,this.background=pt,this.layers=ct,this.includeLabels=ze,this.snapshotConfig=Hn,this.scale=Pi}}return ce})(),nt=(()=>{class ce{static#e=this.type="[Engine] Take Snapshot Success";constructor(Ne){this.blob=Ne}}return ce})()},76304:(be,q,d)=>{"use strict";d.d(q,{S:()=>re});var c=d(92014);class e{}var y=d(47610),l=d(78109),X=d(72849),$=d(23881),j=d(24911),m=d(4664),O=d(3829),V=d(47555),I=d(13878),L=d(14264),M=d(17365),S=d(15152),b=d(79435),f=d(44867),U=d(12347),C=d(54438);let T=(()=>{class Se{constructor(pe){this.engineService=pe}setPostProcessingFeatures(pe){const{renderer:Te,story:we}=this.engineService.engine;we?.activeChapter&&(we.activeChapter.postProcess.length=0,we.activeChapter.postProcess.push(...pe)),Te.setPostProcessingPipeline(pe)}static#e=this.\u0275fac=function(Te){return new(Te||Se)(C.KVO(X.y))};static#t=this.\u0275prov=C.jDH({token:Se,factory:Se.\u0275fac,providedIn:"root"})}return Se})();var w=d(46799),v=d(35650),A=d(73987),R=d(56343),N=d(43631),B=d(28407);const Q={};var H=function(Se){return Se.Binary="application/octet-stream",Se.JSON="application/json;charset=UTF-8",Se}(H||{});const Z="assetCache";class k{addToCache(se,pe){return(0,B.A)(function*(){const Te=pe instanceof ArrayBuffer?pe:JSON.stringify(pe),we=Te instanceof ArrayBuffer?H.Binary:H.JSON,Qe=Te instanceof ArrayBuffer?Te.byteLength:Te.length,tt=new Response(Te,{headers:{...Q,"Content-Type":we,"Content-Length":`${Qe}`}});return(yield caches.open(Z)).put(se,tt)})()}removeFromCache(se){return(0,B.A)(function*(){return(yield caches.open(Z)).delete(se)})()}getFromCache(se){return(0,B.A)(function*(){const Te=yield(yield caches.open(Z)).match(se),we=Te?.headers?.get("Content-Type");if(we)return"application/octet-stream"===we?Te.arrayBuffer():Te.json()})()}closeCache(){return(0,B.A)(function*(){})()}}var h=d(29160);const p="/assets/latin/l2bi.json";function D(Se){return{titlesToLatin:K(Se)}}function E(){return(E=(0,B.A)(function*(){return yield(yield fetch(p)).json()})).apply(this,arguments)}function K(Se){return Object.entries(Se).reduce((se,[pe,Te])=>(Te.forEach(we=>{se[we]=pe}),se),{})}var u=d(49204);let x=(()=>{class Se{constructor(){this.graphMetadata=new h.t(void 0)}getGraphMetadata(){return(0,u.isNil)(this.graphMetadata.value)&&this.fetchGraphMetadata().then(pe=>{this.graphMetadata.next(pe)}),this.graphMetadata.asObservable()}destroy(){this.cacheDatabase?.closeCache(),this.cacheDatabase=null}fetchGraphMetadata(){var pe=this;return(0,B.A)(function*(){pe.destroy(),pe.cacheDatabase=new k;const Te=yield pe.cacheDatabase.getFromCache(p);if(Te){const we=D(Te);return pe.graphMetadata.next(we),we}{const we=yield function te(){return E.apply(this,arguments)}();pe.cacheDatabase.addToCache(p,we);const Qe=D(we);return pe.graphMetadata.next(Qe),Qe}})()}static#e=this.\u0275fac=function(Te){return new(Te||Se)};static#t=this.\u0275prov=C.jDH({token:Se,factory:Se.\u0275fac,providedIn:"root"})}return Se})();var W,z=d(90917),oe=d(32724),ge=d(30582),ie=function(Se,se,pe,Te){var tt,we=arguments.length,Qe=we<3?se:null===Te?Te=Object.getOwnPropertyDescriptor(se,pe):Te;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Qe=Reflect.decorate(Se,se,pe,Te);else for(var Ue=Se.length-1;Ue>=0;Ue--)(tt=Se[Ue])&&(Qe=(we<3?tt(Qe):we>3?tt(se,pe,Qe):tt(se,pe))||Qe);return we>3&&Qe&&Object.defineProperty(se,pe,Qe),Qe},Y=function(Se,se){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(Se,se)};const Ee=new j.j(0,0,0,0,0,0,m.g.Hidden,1);let re=class ld{static#e=W=this;static getEngine(se){return se.engine}static getReady(se){return se.ready}static getDisplay(se){return se.display}static getScrollMode(se){return se.scrollMode}static getVisible(se){return se.visible}static getViewGraph(se){return se.viewGraph}static getViewGraphMetadata(se){return se.viewGraphMetadata}static getTreeGraph(se,pe){return pe?se:(0,f.vU)(se)}static getViewGraphNode(se){return pe=>se.viewGraph.nodes[pe]}static getEnginePosition(se){return se.enginePosition}static getCanvasHeightBreakpoint(se,pe){return pe?A.h.Standard:se?.height<375?A.h.Tiny:se?.height<480?A.h.Small:A.h.Standard}static getChapter(se){return se.chapter}static getActiveTool(se){return se.activeTool}static getShowCameraBar(se){return se.showCameraBar}static getShowProgressBar(se){return se.showProgressBar}static getShowLabels(se){return se.showLabels}static getAnimationPlaying(se){return se.animationPlaying}static getAutoplay(se){return se.autoplay}static getXrayModeEnabled(se){return se.xrayModeEnabled}static getHoveredNode(se){return se.hoveredNode}static getLabelEditNode(se){return se.labelEditNode}static getQuerying(se){return se.queryingAnatomy}static getContextMenu(se){return se.contextMenu}static getPlaybackSpeed(se){return se.playbackSpeed}static getWatermarkEnabled(se){return se.watermarkEnabled}static getWebGLContextName(se){return se.webGLContextName}static getStatsEnabled(se){return se.stats.enabled}static getShowAdvancedStatsTools(se){return se.stats.showAdvancedTools}static getClickPickEnabled(se){return se.pickState.clickEnabled}static getHoverPickEnabled(se){return se.pickState.hoverEnabled}static getViewGraphRank(se){return se.viewGraphRank}load(se,pe){se.dispatch(new y.iQ("engine"))}loadSuccess({patchState:se},pe){se({engine:pe.result})}setReady(se,pe){se.patchState({ready:pe.ready})}setDisplay(se,pe){se.patchState({display:pe.display})}setZoomViaScrollAllowed(se,pe){se.patchState({scrollMode:pe.scrollMode})}setVisible(se,pe){se.patchState({visible:pe.visible})}setEnginePosition(se,pe){se.patchState({enginePosition:{...pe.position,right:pe.position.left+pe.position.width,bottom:pe.position.top+pe.position.height}})}resetEnginePosition(se,pe){se.patchState({enginePosition:Ee})}setChapter(se,pe){se.patchState({chapter:pe.chapterId})}setActiveTool(se,pe){se.patchState({activeTool:pe.tool})}setGraph(se,{graph:pe}){const Te=(0,z.D$)(Object.values(pe.nodes),[{field:"shown",dir:"asc"},{field:"label",dir:"asc"}]).reduce((we,Qe,tt)=>(we[Qe.id]=tt,we),{});se.patchState({viewGraph:{...pe},viewGraphRank:{initiallyShownRank:Te}})}getGraphMetadata(se){const{viewGraphMetadata:pe}=se.getState();(0,u.isEmpty)(pe)&&this.nodeSearchService.getGraphMetadata().pipe((0,L.p)(Te=>!(0,u.isEmpty)(Te)),(0,M.s)(1)).subscribe(Te=>{const{viewGraph:we}=se.getState();se.patchState({viewGraphMetadata:Te,viewGraph:{...(0,f.u7)(we,Te)}})})}clearGraph(se){se.patchState({viewGraph:(0,$.q3)(),viewGraphRank:{initiallyShownRank:{}}})}setXrayMode(se,pe){se.patchState({xrayModeEnabled:pe.enabled})}toggleProgressBar(se,pe){se.patchState({showProgressBar:pe.show})}toggleCameraBar(se,pe){se.patchState({showCameraBar:pe.show})}toggleLabels(se,pe){const Te=null!=pe.show?pe.show:!se.getState().showLabels;se.patchState({showLabels:Te})}synchronizeVisibleNodes(se,pe){const Te=se.getState().viewGraph,we=this.stateMapToNodeIds(Te,pe.leafVisibilityState),Qe={};we.forEach(tt=>{const yt=this.sceneService.getLeafIds(tt).reduce((ke,at)=>ke||pe.nodes[at].shown,!1);Qe[tt]={shown:yt}}),this.graphService.synchronize({...Te},{shown:R.t.TrueWins},Qe),se.patchState({viewGraph:{...Te}})}synchronizeRenderableNodes(se,pe){const Te=se.getState().viewGraph,we=this.stateMapToNodeIds(Te,pe.leafRenderableState),Qe={};we.forEach(tt=>{Qe[tt]={renderable:!0}}),this.graphService.synchronize(Te,{renderable:R.t.FalseWins},Qe)}synchronizePickableNodes(se,pe){const Te=se.getState().viewGraph,we=this.stateMapToNodeIds(Te,pe.leafPickableState),Qe={};we.forEach(tt=>{const yt=this.sceneService.getLeafIds(tt).reduce((ke,at)=>ke||this.sceneService.getObjectById(at).pickable,!1);Qe[tt]={pickable:yt}}),this.graphService.synchronize(Te,{pickable:R.t.TrueWins},Qe),se.patchState({viewGraph:{...Te}})}synchronizeAvailableNodes(se,pe){const Te=se.getState().viewGraph,we=this.stateMapToNodeIds(Te,pe.leafAvailableState),Qe={};we.forEach(tt=>{const yt=this.sceneService.getLeafIds(tt).reduce((ke,at)=>ke||pe.nodes[at].available,!1);Qe[tt]={available:yt}}),this.graphService.synchronize(Te,{available:R.t.TrueWins},Qe),se.patchState({viewGraph:{...Te}})}playChapterAnimation(se,pe){this.animationService.restart(),se.getState().animationPlaying||this.animationService.pause()}toggleAnimation(se,pe){pe.play?this.animationService.unpause():this.animationService.pause()}setAnimationPlaying(se,pe){se.patchState({animationPlaying:pe.playing})}setPlaybackSpeed(se,pe){se.patchState({playbackSpeed:pe.speed})}setAutoplay(se,pe){se.patchState({autoplay:pe.enable})}setObjectLayerOrder(se,pe){const Te=se.getState().viewGraph,we=isNaN(pe.layer)?0:pe.layer,{anatomyObjects:Qe}=this.sceneService.getAnatomySceneGraph();let tt=[];pe.nodes.forEach(Ue=>{const yt=this.graphService.getDescendants(Te,Ue.id,!0);tt=tt.concat(yt)}),tt.forEach(Ue=>{this.sceneService.setObjectLayer(Qe,Ue,we),this.graphService.setState(Te,Ue,{layer:we})}),se.patchState({viewGraph:{...Te}})}setObjectDisplayName(se,pe){const{nodeId:Te,displayName:we}=pe,Qe=se.getState().viewGraph,tt=Qe.nodes[Te],Ue=this.sceneService.getObjectById(Te);Ue&&(Ue.displayName=we),tt&&(tt.label=we,se.patchState({viewGraph:{...Qe}}))}autoSortObjectLayers(se,pe){const Te=se.getState().viewGraph;let Qe=0;const tt=this.sceneService.getEnabledLeafIds(),Ue=this.sceneService.getObjectLayerValues(tt),{anatomyObjects:yt}=this.sceneService.getAnatomySceneGraph();Object.keys(Ue).map(ke=>parseInt(ke,10)).sort((ke,at)=>ke-at).forEach(ke=>{Ue[ke].sort((at,De)=>De.value-at.value).forEach(at=>{const De=20*Qe;this.sceneService.setObjectLayer(yt,at.nodeId,De),this.graphService.setState(Te,at.nodeId,{layer:De}),Qe++})}),se.patchState({viewGraph:{...Te}})}resetObjectLayers(se,pe){const Te=se.getState().viewGraph,we=this.sceneService.getEnabledLeafIds(),{anatomyObjects:Qe}=this.sceneService.getAnatomySceneGraph();we.forEach(tt=>{this.sceneService.setObjectLayer(Qe,tt,0),this.graphService.setState(Te,tt,{layer:0})}),se.patchState({viewGraph:{...Te}})}setPostProcessingEffects(se,{effects:pe}){this.postProcessingService.setPostProcessingFeatures(pe)}setProperties(se,{properties:pe}){this.engineService.setProperties({...pe})}setTransparencyMode(se,{mode:pe}){this.engineRendererService.setTransparencyMode(pe)}expandNode(se,pe){const Te=this.store.selectSnapshot(W.getViewGraph);(0,f.DS)(Te,pe.node.id,!0).forEach(Qe=>{Te.nodes[Qe].boolState.expanded=!0}),se.patchState({viewGraph:{...Te}})}collapseNode(se,pe){const Te=this.store.selectSnapshot(W.getViewGraph);Te.nodes[pe.node.id].boolState.expanded=!1,se.patchState({viewGraph:{...Te}})}collapseAllViewTreeNodes(se,pe){const Te=this.store.selectSnapshot(W.getViewGraph);Object.values(Te.nodes).forEach(we=>{we.boolState.expanded=!1}),se.patchState({viewGraph:{...Te}})}hoverNode(se,pe){se.patchState({hoveredNode:pe.node})}setLabelEditNode(se,pe){se.patchState({labelEditNode:pe.node})}queryNodeInfo(se,{node:pe,fallback:Te,lang:we}){se.patchState({queryingAnatomy:!0}),this.contentInfoService.queryNodeInfo(pe.label,Te,we).pipe((0,S.j)(()=>se.patchState({queryingAnatomy:!1}))).subscribe(Qe=>se.dispatch(new y.qL(pe,Qe)),()=>se.dispatch(new y.RR(pe)))}queryNodeInfoSuccess(se,{node:pe,info:Te}){se.dispatch(new y.RV(pe,Te))}setNodeInfo(se,{node:pe,info:Te}){const we=this.store.selectSnapshot(W.getViewGraph),Qe=we.nodes[pe.id];Qe&&Te&&(Qe.description=Te.description,Qe.info=Te,se.patchState({viewGraph:{...we}}))}setContextMenu(se,{node:pe,hit:Te}){se.patchState({contextMenu:{node:pe,hit:Te}})}setWatermarkEnabled(se,{enabled:pe}){se.patchState({watermarkEnabled:pe})}setWebGLContext(se,pe){se.patchState({webGLContextName:pe.context})}setEngineStatsEnabled(se,{enabled:pe,showAdvancedTools:Te}){se.patchState({stats:{enabled:pe,showAdvancedTools:Te}})}setHoverPick(se,pe){se.patchState({pickState:{...se.getState().pickState,...pe.pickState}})}takeSnapshot(se,pe){const{width:Te,height:we,background:Qe,layers:tt,includeLabels:Ue,snapshotConfig:yt,scale:ke}=pe;this.snapshotService.takeSnapshot(Te,we,Qe,tt,Ue,yt,ke).subscribe(at=>{se.dispatch(new y.NO(at))})}stateMapToNodeIds(se,pe){const Te=Object.keys(pe).map(we=>this.sceneService.getViewNode(se,we)).filter(we=>!!we).map(we=>we.id);return new Set(Te)}constructor(se,pe,Te,we,Qe,tt,Ue,yt,ke,at){this.store=se,this.graphService=pe,this.engineService=Te,this.contentInfoService=we,this.animationService=Qe,this.postProcessingService=tt,this.engineRendererService=Ue,this.sceneService=yt,this.nodeSearchService=ke,this.snapshotService=at}static#t=this.\u0275fac=function(pe){return new(pe||ld)(C.KVO(c.il),C.KVO(l.w),C.KVO(X.y),C.KVO(b.T),C.KVO(U.O),C.KVO(T),C.KVO(w.z),C.KVO(v.w),C.KVO(x),C.KVO(ge.M))};static#n=this.\u0275prov=C.jDH({token:ld,factory:ld.\u0275fac})};ie([(0,c.rc)(y.Tf),Y("design:type",Function),Y("design:paramtypes",[Object,y.Tf]),Y("design:returntype",void 0)],re.prototype,"load",null),ie([(0,c.rc)(y.iQ),Y("design:type",Function),Y("design:paramtypes",[Object,y.iQ]),Y("design:returntype",void 0)],re.prototype,"loadSuccess",null),ie([(0,c.rc)(y.AU),Y("design:type",Function),Y("design:paramtypes",[Object,y.AU]),Y("design:returntype",void 0)],re.prototype,"setReady",null),ie([(0,c.rc)(y.t5),Y("design:type",Function),Y("design:paramtypes",[Object,y.t5]),Y("design:returntype",void 0)],re.prototype,"setDisplay",null),ie([(0,c.rc)(y.hk),Y("design:type",Function),Y("design:paramtypes",[Object,y.hk]),Y("design:returntype",void 0)],re.prototype,"setZoomViaScrollAllowed",null),ie([(0,c.rc)(y.dB),Y("design:type",Function),Y("design:paramtypes",[Object,y.dB]),Y("design:returntype",void 0)],re.prototype,"setVisible",null),ie([(0,c.rc)(y.Sh),Y("design:type",Function),Y("design:paramtypes",[Object,y.Sh]),Y("design:returntype",void 0)],re.prototype,"setEnginePosition",null),ie([(0,c.rc)(y.lQ),Y("design:type",Function),Y("design:paramtypes",[Object,y.lQ]),Y("design:returntype",void 0)],re.prototype,"resetEnginePosition",null),ie([(0,c.rc)(y.u3),Y("design:type",Function),Y("design:paramtypes",[Object,y.u3]),Y("design:returntype",void 0)],re.prototype,"setChapter",null),ie([(0,c.rc)(y.pL),Y("design:type",Function),Y("design:paramtypes",[Object,y.pL]),Y("design:returntype",void 0)],re.prototype,"setActiveTool",null),ie([(0,c.rc)(y.LL),Y("design:type",Function),Y("design:paramtypes",[Object,y.LL]),Y("design:returntype",void 0)],re.prototype,"setGraph",null),ie([(0,c.rc)(y.q),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],re.prototype,"getGraphMetadata",null),ie([(0,c.rc)(y.w8),Y("design:type",Function),Y("design:paramtypes",[Object]),Y("design:returntype",void 0)],re.prototype,"clearGraph",null),ie([(0,c.rc)(y._y),Y("design:type",Function),Y("design:paramtypes",[Object,y._y]),Y("design:returntype",void 0)],re.prototype,"setXrayMode",null),ie([(0,c.rc)(y.Ti),Y("design:type",Function),Y("design:paramtypes",[Object,y.Ti]),Y("design:returntype",void 0)],re.prototype,"toggleProgressBar",null),ie([(0,c.rc)(y.P6),Y("design:type",Function),Y("design:paramtypes",[Object,y.P6]),Y("design:returntype",void 0)],re.prototype,"toggleCameraBar",null),ie([(0,c.rc)(y.Gv),Y("design:type",Function),Y("design:paramtypes",[Object,y.Gv]),Y("design:returntype",void 0)],re.prototype,"toggleLabels",null),ie([(0,c.rc)(y.A0),Y("design:type",Function),Y("design:paramtypes",[Object,y.A0]),Y("design:returntype",void 0)],re.prototype,"synchronizeVisibleNodes",null),ie([(0,c.rc)(y.GT),Y("design:type",Function),Y("design:paramtypes",[Object,y.GT]),Y("design:returntype",void 0)],re.prototype,"synchronizeRenderableNodes",null),ie([(0,c.rc)(y.$V),Y("design:type",Function),Y("design:paramtypes",[Object,y.$V]),Y("design:returntype",void 0)],re.prototype,"synchronizePickableNodes",null),ie([(0,c.rc)(y.Rc),Y("design:type",Function),Y("design:paramtypes",[Object,y.Rc]),Y("design:returntype",void 0)],re.prototype,"synchronizeAvailableNodes",null),ie([(0,c.rc)(y.A6),Y("design:type",Function),Y("design:paramtypes",[Object,y.A6]),Y("design:returntype",void 0)],re.prototype,"playChapterAnimation",null),ie([(0,c.rc)(y.dE),Y("design:type",Function),Y("design:paramtypes",[Object,y.dE]),Y("design:returntype",void 0)],re.prototype,"toggleAnimation",null),ie([(0,c.rc)(y.jM),Y("design:type",Function),Y("design:paramtypes",[Object,y.jM]),Y("design:returntype",void 0)],re.prototype,"setAnimationPlaying",null),ie([(0,c.rc)(y.Vs),Y("design:type",Function),Y("design:paramtypes",[Object,y.Vs]),Y("design:returntype",void 0)],re.prototype,"setPlaybackSpeed",null),ie([(0,c.rc)(y.kE),Y("design:type",Function),Y("design:paramtypes",[Object,y.kE]),Y("design:returntype",void 0)],re.prototype,"setAutoplay",null),ie([(0,c.rc)(y.zw),Y("design:type",Function),Y("design:paramtypes",[Object,y.zw]),Y("design:returntype",void 0)],re.prototype,"setObjectLayerOrder",null),ie([(0,c.rc)(y.$h),Y("design:type",Function),Y("design:paramtypes",[Object,y.$h]),Y("design:returntype",void 0)],re.prototype,"setObjectDisplayName",null),ie([(0,c.rc)(y.RZ),Y("design:type",Function),Y("design:paramtypes",[Object,y.RZ]),Y("design:returntype",void 0)],re.prototype,"autoSortObjectLayers",null),ie([(0,c.rc)(y.PF),Y("design:type",Function),Y("design:paramtypes",[Object,y.PF]),Y("design:returntype",void 0)],re.prototype,"resetObjectLayers",null),ie([(0,c.rc)(y.uM),Y("design:type",Function),Y("design:paramtypes",[Object,y.uM]),Y("design:returntype",void 0)],re.prototype,"setPostProcessingEffects",null),ie([(0,c.rc)(y.YI),Y("design:type",Function),Y("design:paramtypes",[Object,y.YI]),Y("design:returntype",void 0)],re.prototype,"setProperties",null),ie([(0,c.rc)(y._h),Y("design:type",Function),Y("design:paramtypes",[Object,y._h]),Y("design:returntype",void 0)],re.prototype,"setTransparencyMode",null),ie([(0,c.rc)(y._o),Y("design:type",Function),Y("design:paramtypes",[Object,y._o]),Y("design:returntype",void 0)],re.prototype,"expandNode",null),ie([(0,c.rc)(y.z),Y("design:type",Function),Y("design:paramtypes",[Object,y.z]),Y("design:returntype",void 0)],re.prototype,"collapseNode",null),ie([(0,c.rc)(y.v$),Y("design:type",Function),Y("design:paramtypes",[Object,y.v$]),Y("design:returntype",void 0)],re.prototype,"collapseAllViewTreeNodes",null),ie([(0,c.rc)(y.DZ),Y("design:type",Function),Y("design:paramtypes",[Object,y.DZ]),Y("design:returntype",void 0)],re.prototype,"hoverNode",null),ie([(0,c.rc)(y.ro),Y("design:type",Function),Y("design:paramtypes",[Object,y.ro]),Y("design:returntype",void 0)],re.prototype,"setLabelEditNode",null),ie([(0,c.rc)(y.bo),Y("design:type",Function),Y("design:paramtypes",[Object,y.bo]),Y("design:returntype",void 0)],re.prototype,"queryNodeInfo",null),ie([(0,c.rc)(y.qL),Y("design:type",Function),Y("design:paramtypes",[Object,y.qL]),Y("design:returntype",void 0)],re.prototype,"queryNodeInfoSuccess",null),ie([(0,c.rc)(y.RV),Y("design:type",Function),Y("design:paramtypes",[Object,y.RV]),Y("design:returntype",void 0)],re.prototype,"setNodeInfo",null),ie([(0,c.rc)(y.fZ),Y("design:type",Function),Y("design:paramtypes",[Object,y.fZ]),Y("design:returntype",void 0)],re.prototype,"setContextMenu",null),ie([(0,c.rc)(y.E7),Y("design:type",Function),Y("design:paramtypes",[Object,y.E7]),Y("design:returntype",void 0)],re.prototype,"setWatermarkEnabled",null),ie([(0,c.rc)(y.vA),Y("design:type",Function),Y("design:paramtypes",[Object,y.vA]),Y("design:returntype",void 0)],re.prototype,"setWebGLContext",null),ie([(0,c.rc)(y.BM),Y("design:type",Function),Y("design:paramtypes",[Object,y.BM]),Y("design:returntype",void 0)],re.prototype,"setEngineStatsEnabled",null),ie([(0,c.rc)(y.Pk),Y("design:type",Function),Y("design:paramtypes",[Object,y.Pk]),Y("design:returntype",void 0)],re.prototype,"setHoverPick",null),ie([(0,c.rc)(y.k2),Y("design:type",Function),Y("design:paramtypes",[Object,y.k2]),Y("design:returntype",void 0)],re.prototype,"takeSnapshot",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getEngine",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getReady",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getDisplay",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getScrollMode",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getVisible",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getViewGraph",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getViewGraphMetadata",null),ie([(0,c.MD)([re.getViewGraph,N._.getShowUnavailableNodes]),Y("design:type",Function),Y("design:paramtypes",[Object,Boolean]),Y("design:returntype",Object)],re,"getTreeGraph",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getViewGraphNode",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getEnginePosition",null),ie([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([re.getEnginePosition,oe.U.getXRActive]),Y("design:type",Function),Y("design:paramtypes",[j.j,Boolean]),Y("design:returntype",Number)],re,"getCanvasHeightBreakpoint",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getChapter",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getActiveTool",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getShowCameraBar",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getShowProgressBar",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getShowLabels",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getAnimationPlaying",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getAutoplay",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getXrayModeEnabled",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getHoveredNode",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getLabelEditNode",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getQuerying",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getContextMenu",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getPlaybackSpeed",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getWatermarkEnabled",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getWebGLContextName",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getStatsEnabled",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getShowAdvancedStatsTools",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getClickPickEnabled",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getHoverPickEnabled",null),ie([(0,c.MD)(),Y("design:type",Function),Y("design:paramtypes",[e]),Y("design:returntype",void 0)],re,"getViewGraphRank",null),re=W=ie([(0,c.Uw)({name:"engine",defaults:{loading:!1,ready:!1,viewGraph:(0,$.q3)(),viewGraphMetadata:void 0,viewGraphRank:{initiallyShownRank:{}},hoveredNode:void 0,labelEditNode:void 0,queryingAnatomy:!1,engine:"",chapter:"",showProgressBar:!0,showCameraBar:!0,showLabels:!0,activeTool:V.s.Select,animationPlaying:!1,autoplay:!0,display:!0,visible:!0,scrollMode:I.M.Capture,playbackSpeed:1,xrayModeEnabled:!1,contextMenu:{node:null,hit:null},watermarkEnabled:!1,stats:{enabled:!1,showAdvancedTools:!1},webGLContextName:void 0,pickState:{clickEnabled:!0,hoverEnabled:!0},xrRequesting:!1},children:[O.x]}),Y("design:paramtypes",[c.il,l.w,X.y,b.T,U.O,T,w.z,v.w,x,ge.M])],re)},29284:(be,q,d)=>{"use strict";d.d(q,{BK:()=>j,_x:()=>$,iE:()=>M});var c=d(20458),e=d(1102),y=d(44867),l=d(49204);function $(S,b,f){const U=(0,y.IA)(S,b);if(0===U.length)return!1;for(const C of U)if(!0===f[C])return!0;return U.some(C=>$(S,C,f))}function j(S,b,f){switch(f[b]){case!0:return!0;case!1:return!1;case void 0:{const U=(0,y.ir)(S,b);return!!U&&j(S,U,f)}}}function m(S,b,f){if((0,l.isNil)(f))return!0;switch(f[b]){case!0:return!1;case!1:return!0;case void 0:{const U=(0,y.ir)(S,b);return!U||m(S,U,f)}}}function L(S,b,f){if(f&&f[b]&&function I(S){return"tintColor"in S||"opacity"in S||"brightness"in S||"saturation"in S||"contrast"in S}(f[b]))return(0,e.H)(f[b]);const U=(0,y.ir)(S,b);return U?L(S,U,f):c.NR}function M(S,b,f,U,C){function T(v){const A=function V(S,b,f){return(0,y.If)(b,f,U=>(0,y.ir)(S,U),U=>(0,y.IA)(S,U))}(S,v,f),R=function O(S,b,f){return j(S,b,f)||$(S,b,f)}(S,v,b),N=m(S,v,U);return{objectId:v,checked:!1,selected:!1,paint:L(S,v,C),pickable:N,shown:R,shownSetByTween:!1,available:A,variant:0}}return Object.keys(S.nodes).reduce((v,A)=>(v[A]=T(A),v),{})}},61295:(be,q,d)=>{"use strict";d.d(q,{IA:()=>l,Jp:()=>I,K8:()=>e,Ke:()=>V,LV:()=>$,NP:()=>y,Ws:()=>L,Yn:()=>c,ZF:()=>M,_n:()=>S,hg:()=>m,q9:()=>O,rg:()=>X,yr:()=>j});let c=(()=>{class b{static#e=this.type="[Engine Nodes] Reset";constructor(){}}return b})(),e=(()=>{class b{static#e=this.type="[Engine Nodes] init nodes";constructor(U){this.nodeState=U}}return b})(),y=(()=>{class b{static#e=this.type="[Engine Nodes] patch nodes";constructor(U){this.patches=U}}return b})(),l=(()=>{class b{static#e=this.type="[Engine Nodes] set active chapter";constructor(U){this.activeChapterId=U}}return b})(),X=(()=>{class b{static#e=this.type="[Engine Nodes] Duplicate node state";constructor(U,C){this.originalChapterId=U,this.copyChapterId=C}}return b})(),$=(()=>{class b{static#e=this.type="[Engine Nodes] update tween nodes shown";constructor(U,C){this.show=U,this.objectIds=C}}return b})(),j=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes shown";constructor(U,C,T,w=!0,v=!1,A=!1){this.show=U,this.objectIds=C,this.patch=T,this.record=w,this.setByTween=v,this.includeUnavailable=A}}return b})(),m=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes selected";constructor(U){this.objectId=U}}return b})(),O=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes checked";constructor(U,C,T){this.checked=U,this.objectIds=C,this.patch=T}}return b})(),V=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes pickable";constructor(U,C,T){this.pickable=U,this.objectIds=C,this.patch=T}}return b})(),I=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes paint";constructor(U,C,T,w=!0){this.recipe=U,this.objectIds=C,this.patch=T,this.record=w}}return b})(),L=(()=>{class b{static#e=this.type="[Engine Nodes] update nodes available";constructor(U,C,T){this.available=U,this.objectIds=C,this.patch=T}}return b})(),M=(()=>{class b{static#e=this.type="[Engine Nodes] copy nodes paint";constructor(U,C){this.objectIds=U,this.sourceChapterId=C}}return b})(),S=(()=>{class b{static#e=this.type="[Engine Nodes] update node variants";constructor(U,C=!0){this.objectVariants=U,this.record=C}}return b})()},13409:(be,q,d)=>{"use strict";d.d(q,{z:()=>f});var c=d(92014);class e{}var y=d(61295),l=d(75069),X=d(10467),$=d(12865),j=d(1102),m=d(81025),O=d(35650),V=d(43631),I=d(44867),L=d(54438),M=function(U,C,T,w){var R,v=arguments.length,A=v<3?C:null===w?w=Object.getOwnPropertyDescriptor(C,T):w;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)A=Reflect.decorate(U,C,T,w);else for(var N=U.length-1;N>=0;N--)(R=U[N])&&(A=(v<3?R(A):v>3?R(C,T,A):R(C,T))||A);return v>3&&A&&Object.defineProperty(C,T,A),A},S=function(U,C){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(U,C)};let f=class cd{static getState(C){return C}static getAllNodeState(C){return C.nodeState}static getActiveChapter(C){return C.activeChapterId}static getPatches(C){return C.patches}static getNodes(C,T){return C?.[T]??{}}static getAvailableNodes(C,T){return T?C:(0,I.bd)(C)}static getNodePaint(C){return T=>C.nodeState[C.activeChapterId][T].paint}static getNodeIds(C){return Object.keys(C)}static getCheckedNodeIds(C){return C.map(T=>T.objectId)}static getCheckedNodesCount(C){return C.length}static getCheckedNodes(C){return Object.values(C).filter(T=>T.checked)}static getSelectedNode(C){return Object.values(C).find(T=>T.selected)}reset(C,T){C.patchState(m.jM(C.getState(),w=>{w.activeChapterId=void 0,w.nodeState=void 0,w.patches=[],w.patchesForChapter={}}))}applyPatch(C,T){const w=m.$i(C.getState(),T.patches),v=m.jM(w,A=>{A.patchesForChapter[A.activeChapterId].push(...T.patches),A.patches=T.patches});C.patchState(v)}initNodeState(C,T){C.patchState({nodeState:T.nodeState})}setActiveChapter(C,T){const w=C.getState(),v=m.jM(w,A=>{A.activeChapterId=T.activeChapterId,A.patchesForChapter[T.activeChapterId]=A.patchesForChapter[T.activeChapterId]||[],A.patches=A.patchesForChapter[T.activeChapterId]});C.patchState(v)}duplicateNodeState(C,T){const w=C.getState(),v=m.jM(w,A=>{A.nodeState[T.copyChapterId]=A.nodeState[T.originalChapterId],A.patchesForChapter[T.copyChapterId]=A.patchesForChapter[T.originalChapterId].map(N=>(N.path[1]=T.copyChapterId,N))});C.patchState(v)}updateTweenNodesShown(C,T){const w=C.getState(),{finalState:v}=(0,$.r)(w,{...T,record:!1,setByTween:!0,includeUnavailable:!0},this.sceneService),{nodeState:A}=v;C.patchState({nodeState:A})}updateNodesShown(C,T){const w=C.getState(),{finalState:v,patches:A,inversePatches:R}=(0,$.r)(w,T,this.sceneService);C.patchState(v),T.record&&C.dispatch(new l.a.SavePatches([{forward:A,inverse:R,patchAction:y.NP}]))}updateNodesSelected(C,T){const w=C.getState();if(!w)return;const v=m.jM(w,A=>{const R=A.nodeState?.[A.activeChapterId]??{},N=Object.keys(R);void 0===T.objectId?N.forEach(B=>R[B].selected=!1):(N.forEach(B=>R[B].selected=!1),R[T.objectId].selected=!0)});C.patchState(v)}updateNodesChecked(C,T){const w=C.getState(),[v,A,R]=m.vI(w,B=>{const Q=B.nodeState?.[B.activeChapterId]??{};void 0===T.patch?(T.objectIds||Object.keys(Q)).forEach(Z=>{Q[Z].checked=T.checked,T.objectIds&&(0,X.I7)(this.sceneService,Z,Q,"checked",T.checked)}):Object.entries(T.patch).forEach(([H,Z])=>Q[H].checked=Z)}),N=m.jM(v,B=>{B.patches=A});C.patchState(N)}updateNodesPickable(C,T){const w=C.getState(),[v,A,R]=m.vI(w,B=>{const Q=B.nodeState?.[B.activeChapterId]??{};T.patch?Object.entries(T.patch).forEach(([H,Z])=>Q[H].pickable=Z):(T.objectIds||Object.keys(Q)).forEach(Z=>{Q[Z].pickable=T.pickable,T.objectIds&&(0,X.I7)(this.sceneService,Z,Q,"pickable",T.pickable)})}),N=m.jM(v,B=>{B.patches=A,B.patchesForChapter[B.activeChapterId].push(...A)});C.patchState(N),C.dispatch(new l.a.SavePatches([{forward:A,inverse:R,patchAction:y.NP}]))}updateNodesPaint(C,T){const w=C.getState(),[v,A,R]=m.vI(w,B=>{const Q=B.nodeState?.[B.activeChapterId]??{},H=T.objectIds||Object.keys(Q);T.patch?Object.entries(T.patch).forEach(([Z,k])=>{const h=(0,j.ql)(Q[Z].paint,k);Q[Z].paint=h}):H.forEach(Z=>{const k=(0,j.ql)(Q[Z].paint,T.recipe);Q[Z].paint=k,T.objectIds&&(0,X.I7)(this.sceneService,Z,Q,"paint",k)})}),N=m.jM(v,B=>{B.patches=A,B.patchesForChapter[B.activeChapterId].push(...A)});C.patchState(N),T.record&&C.dispatch(new l.a.SavePatches([{forward:A,inverse:R,patchAction:y.NP}]))}updateNodesAvailable(C,T){const w=C.getState(),[v,A,R]=m.vI(w,B=>{const Q=B.nodeState?.[B.activeChapterId]??{};if(T.patch)Object.entries(T.patch).forEach(([H,Z])=>{Q[H].available=Z,Q[H].pickable=Z});else{const{available:H,objectIds:Z}=T;(Z??Object.keys(Q)).forEach(h=>{Q[h].available=H,Q[h].pickable=H,Z&&((0,X.I7)(this.sceneService,h,Q,"available",H),(0,X.I7)(this.sceneService,h,Q,"pickable",H))})}}),N=m.jM(v,B=>{B.patches=A,B.patchesForChapter[B.activeChapterId].push(...A)});C.patchState(N),C.dispatch(new l.a.SavePatches([{forward:A,inverse:R,patchAction:y.NP}]))}updateNodeVariants(C,{objectVariants:T,record:w}){const v=C.getState(),[A,R,N]=m.vI(v,Q=>{const H=Q.nodeState?.[Q.activeChapterId]??{};Object.entries(T).forEach(([Z,k])=>{H[Z].variant=k})}),B=m.jM(A,Q=>{Q.patches=R,Q.patchesForChapter[Q.activeChapterId].push(...R)});C.patchState(B),w&&C.dispatch(new l.a.SavePatches([{forward:R,inverse:N,patchAction:y.NP}]))}copyNodesPaint(C,{sourceChapterId:T,objectIds:w}){const v=C.getState(),[A,R,N]=m.vI(v,Q=>{(0,X.hW)(this.sceneService,Q.nodeState?.[T]??{},Q.nodeState?.[Q.activeChapterId]??{},w,"paint")}),B=m.jM(A,Q=>{Q.patches=R,Q.patchesForChapter[Q.activeChapterId].push(...R)});C.patchState(B),C.dispatch(new l.a.SavePatches([{forward:R,inverse:N,patchAction:y.NP}]))}constructor(C){this.sceneService=C}static#e=this.\u0275fac=function(T){return new(T||cd)(L.KVO(O.w))};static#t=this.\u0275prov=L.jDH({token:cd,factory:cd.\u0275fac})};M([(0,c.rc)(y.Yn),S("design:type",Function),S("design:paramtypes",[Object,y.Yn]),S("design:returntype",void 0)],f.prototype,"reset",null),M([(0,c.rc)(y.NP),S("design:type",Function),S("design:paramtypes",[Object,y.NP]),S("design:returntype",void 0)],f.prototype,"applyPatch",null),M([(0,c.rc)(y.K8),S("design:type",Function),S("design:paramtypes",[Object,y.K8]),S("design:returntype",void 0)],f.prototype,"initNodeState",null),M([(0,c.rc)(y.IA),S("design:type",Function),S("design:paramtypes",[Object,y.IA]),S("design:returntype",void 0)],f.prototype,"setActiveChapter",null),M([(0,c.rc)(y.rg),S("design:type",Function),S("design:paramtypes",[Object,y.rg]),S("design:returntype",void 0)],f.prototype,"duplicateNodeState",null),M([(0,c.rc)(y.LV),S("design:type",Function),S("design:paramtypes",[Object,y.LV]),S("design:returntype",void 0)],f.prototype,"updateTweenNodesShown",null),M([(0,c.rc)(y.yr),S("design:type",Function),S("design:paramtypes",[Object,y.yr]),S("design:returntype",void 0)],f.prototype,"updateNodesShown",null),M([(0,c.rc)(y.hg),S("design:type",Function),S("design:paramtypes",[Object,y.hg]),S("design:returntype",void 0)],f.prototype,"updateNodesSelected",null),M([(0,c.rc)(y.q9),S("design:type",Function),S("design:paramtypes",[Object,y.q9]),S("design:returntype",void 0)],f.prototype,"updateNodesChecked",null),M([(0,c.rc)(y.Ke),S("design:type",Function),S("design:paramtypes",[Object,y.Ke]),S("design:returntype",void 0)],f.prototype,"updateNodesPickable",null),M([(0,c.rc)(y.Jp),S("design:type",Function),S("design:paramtypes",[Object,y.Jp]),S("design:returntype",void 0)],f.prototype,"updateNodesPaint",null),M([(0,c.rc)(y.Ws),S("design:type",Function),S("design:paramtypes",[Object,y.Ws]),S("design:returntype",void 0)],f.prototype,"updateNodesAvailable",null),M([(0,c.rc)(y._n),S("design:type",Function),S("design:paramtypes",[Object,y._n]),S("design:returntype",void 0)],f.prototype,"updateNodeVariants",null),M([(0,c.rc)(y.ZF),S("design:type",Function),S("design:paramtypes",[Object,y.ZF]),S("design:returntype",void 0)],f.prototype,"copyNodesPaint",null),M([(0,c.MD)(),S("design:type",Function),S("design:paramtypes",[e]),S("design:returntype",void 0)],f,"getState",null),M([(0,c.MD)(),S("design:type",Function),S("design:paramtypes",[e]),S("design:returntype",void 0)],f,"getAllNodeState",null),M([(0,c.MD)(),S("design:type",Function),S("design:paramtypes",[e]),S("design:returntype",void 0)],f,"getActiveChapter",null),M([(0,c.MD)(),S("design:type",Function),S("design:paramtypes",[e]),S("design:returntype",void 0)],f,"getPatches",null),M([(0,c.MD)([f.getAllNodeState,f.getActiveChapter]),S("design:type",Function),S("design:paramtypes",[Object,String]),S("design:returntype",void 0)],f,"getNodes",null),M([(0,c.MD)([f.getNodes,V._.getShowUnavailableNodes]),S("design:type",Function),S("design:paramtypes",[Object,Boolean]),S("design:returntype",Object)],f,"getAvailableNodes",null),M([(0,c.MD)(),S("design:type",Function),S("design:paramtypes",[e]),S("design:returntype",void 0)],f,"getNodePaint",null),M([(0,c.MD)([f.getNodes]),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",void 0)],f,"getNodeIds",null),M([(0,c.MD)([f.getCheckedNodes]),S("design:type",Function),S("design:paramtypes",[Array]),S("design:returntype",void 0)],f,"getCheckedNodeIds",null),M([(0,c.MD)([f.getCheckedNodes]),S("design:type",Function),S("design:paramtypes",[Array]),S("design:returntype",void 0)],f,"getCheckedNodesCount",null),M([(0,c.MD)([f.getAvailableNodes]),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",void 0)],f,"getCheckedNodes",null),M([(0,c.MD)([f.getAvailableNodes]),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",void 0)],f,"getSelectedNode",null),f=M([(0,c.Uw)({name:"engineNodes",defaults:{activeChapterId:void 0,nodeState:void 0,patches:[],patchesForChapter:{}}}),S("design:paramtypes",[O.w])],f)},12865:(be,q,d)=>{"use strict";d.d(q,{r:()=>l});var c=d(10467),e=d(81025),y=d(44867);function l(X,$,j){if(!X.activeChapterId||!X.nodeState)return;const{objectIds:m,patch:O,setByTween:V,show:I,includeUnavailable:L}=$,[M,S,b]=e.vI(X,U=>{const C=U.nodeState[U.activeChapterId],T=L?C:(0,y.bd)(C);O?Object.entries(O).forEach(([w,v])=>{w in T&&(T[w].shown=v)}):(m??Object.keys(T)).forEach(v=>{v in T&&(T[v].shown=I,T[v].shownSetByTween=V,m&&((0,c.I7)(j,v,T,"shown",I),!0===V&&(0,c.I7)(j,v,T,"shownSetByTween",V)))})});return{finalState:e.jM(M,U=>{U.patches=S,U.patchesForChapter[U.activeChapterId].push(...S)}),patches:S,inversePatches:b}}},10467:(be,q,d)=>{"use strict";d.d(q,{I7:()=>l,hW:()=>X});var c=d(49204);function y(j,m){const O=m.children;return 0===O.length?[]:(0,c.flattenDeep)(O.map(V=>[V.objectId,...y(j,j.getObjectById(V.objectId))]))}function l(j,m,O,V,I){const L=j.getObjectById(m);y(j,L).forEach(S=>{S in O&&(O[S][V]=I)})}function X(j,m,O,V,I){V.forEach(L=>{const M=j.getObjectById(L),S=y(j,M);$(m,O,L,I),S.forEach(b=>{$(m,O,b,I)})})}function $(j,m,O,V){m[O][V]=(0,c.cloneDeep)(j[O][V])}},35939:(be,q,d)=>{"use strict";var c,e;d.d(q,{u:()=>c}),(e=c||(c={})).SetParticleState=(()=>{class v{static#e=this.type="[Engine Particles] Set Particle State";constructor(R,N,B){this.particleSystems=R,this.assignedParticles=N,this.tweenParticleLookup=B}}return v})(),e.NewParticleSystem=(()=>{class v{static#e=this.type="[Engine Particles] New Particle System";constructor(R,N){this.particleSystem=R,this.chapterId=N}}return v})(),e.DuplicateParticleSystem=(()=>{class v{static#e=this.type="[Engine Particles] Duplicate Particle System";constructor(R,N){this.id=R,this.targetChapterId=N}}return v})(),e.DuplicateParticleSystemSuccess=(()=>{class v{static#e=this.type="[Engine Particles] Duplicate Particle System Success";constructor(R,N){this.id=R,this.targetChapterId=N}}return v})(),e.UpdateParticleSystem=(()=>{class v{static#e=this.type="[Engine Particles] Update Particle System";constructor(R,N){this.id=R,this.particleSystem=N}}return v})(),e.SetParticleSystemsVisible=(()=>{class v{static#e=this.type="[Engine Particles] Set Particle Systems Visible";constructor(R,N){this.visible=R,this.chapterId=N}}return v})(),e.SetParticleSystemVisible=(()=>{class v{static#e=this.type="[Engine Particles] Set Particle System Visible";constructor(R,N,B){this.id=R,this.visible=N,this.chapterId=B}}return v})(),e.AssignParticle=(()=>{class v{static#e=this.type="[Engine Particles] Assign Particle";constructor(R,N){this.id=R,this.chapterId=N}}return v})(),e.UnassignParticle=(()=>{class v{static#e=this.type="[Engine Particles] Unassign Particle";constructor(R,N){this.id=R,this.chapterId=N}}return v})(),e.DeleteParticleSystem=(()=>{class v{static#e=this.type="[Engine Partiles] Delete Particle System";constructor(R){this.id=R}}return v})(),e.SelectParticleSystem=(()=>{class v{static#e=this.type="[Engine Partiles] Select Particle System";constructor(R){this.id=R}}return v})(),e.SelectParticleConstraint=(()=>{class v{static#e=this.type="[Engine Partiles] Select Particle Constraint";constructor(R){this.index=R}}return v})(),e.SelectParticleCreator=(()=>{class v{static#e=this.type="[Engine Partiles] Select Particle Creator";constructor(R){this.index=R}}return v})(),e.SelectParticleUpdater=(()=>{class v{static#e=this.type="[Engine Partiles] Select Particle Updater";constructor(R){this.index=R}}return v})(),e.UpdateTweenParticleLookupChapters=(()=>{class v{static#e=this.type="[Engine Particles] Update Lookup Chapters";constructor(R){this.chapterMap=R}}return v})(),e.SetLookupForChapter=(()=>{class v{static#e=this.type="[Engine Particles] Set Lookup for chapter";constructor(R,N){this.chapterId=R,this.lookup=N}}return v})(),e.DeleteChapterLookup=(()=>{class v{static#e=this.type="[Engine Particles] Delete chapter lookup";constructor(R){this.chapterId=R}}return v})(),e.ApplyPatch=(()=>{class v{static#e=this.type="[Engine Particles] Apply Patch";constructor(R){this.patches=R}}return v})()},12921:(be,q,d)=>{"use strict";d.d(q,{B:()=>V});var O,c=d(92014),e=d(35939),y=d(11113),l=d(86544),X=d(81025),$=d(54438),j=function(I,L,M,S){var U,b=arguments.length,f=b<3?L:null===S?S=Object.getOwnPropertyDescriptor(L,M):S;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(I,L,M,S);else for(var C=I.length-1;C>=0;C--)(U=I[C])&&(f=(b<3?U(f):b>3?U(L,M,f):U(L,M))||f);return b>3&&f&&Object.defineProperty(L,M,f),f},m=function(I,L){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(I,L)};let V=class dd{static#e=O=this;static particleSystemIdExists(L){return(0,c.Mz)([O],M=>void 0!==M.particleSystems[L])}static particleSystemsForChapter(L){return(0,c.Mz)([O],M=>(M.assignedParticles[L]||[]).map(b=>M.particleSystems[b]))}static getVisibleParticleSystemsForChapter(L){return(0,c.Mz)([O],M=>{const b=M.visibleParticleSystems[L]||{};return(M.assignedParticles[L]||[]).filter(f=>!1!==b[f])})}static getTweenParticleLookup(L){return L.tweenParticleLookup}static getParticleSystems(L){return L.particleSystems}static getVisisbleParticleSystems(L){return L.visibleParticleSystems}static getParticleSystemsList(L){return Object.values(L.particleSystems)}static getAssignedParticleSystems(L){return L.assignedParticles}static getSelectedParticleSystemId(L){return L.particleSelection.selectedParticle}static getSelectedParticleSystem(L){const{particleSystems:M,particleSelection:S}=L;return M[S.selectedParticle]}static getSelectedParticleConstraintIndex(L){return L.particleSelection.selectedConstraint}static getSelectedParticleConstraint(L){const M=O.getSelectedParticleSystem(L);return M?M.constraints[L.particleSelection.selectedConstraint]:null}static getSelectedParticleCreatorIndex(L){return L.particleSelection.selectedCreator}static getSelectedParticleCreator(L){const M=O.getSelectedParticleSystem(L);return M?M.creators[L.particleSelection.selectedCreator]:null}static getSelectedParticleUpdaterIndex(L){return L.particleSelection.selectedUpdater}static getSelectedParticleUpdater(L){const M=O.getSelectedParticleSystem(L);return M?M.updaters[L.particleSelection.selectedUpdater]:null}applyPatch(L,M){const S=X.$i(L.getState(),M.patches);L.patchState(S)}setParticleState(L,M){L.patchState(X.jM(L.getState(),S=>{S.particleSystems=M.particleSystems.reduce((b,f)=>(b[f.id]=f,b),{}),S.assignedParticles=M.assignedParticles,S.tweenParticleLookup=M.tweenParticleLookup,S.visibleParticleSystems={}}))}setParticlesVisible(L,{visible:M,chapterId:S}){L.patchState(X.jM(L.getState(),b=>{const U=(b.assignedParticles[S]||[]).reduce((C,T)=>(C[T]=M,C),{});b.visibleParticleSystems={...b.visibleParticleSystems,[S]:U}}))}setParticleVisible(L,{id:M,visible:S,chapterId:b}){L.patchState(X.jM(L.getState(),f=>{f.visibleParticleSystems[b]={...f.visibleParticleSystems[b]||{},[M]:S}}))}newParticleSystem(L,M){const{particleSystem:S,chapterId:b}=M,f=S.id,[U,C,T]=X.vI(L.getState(),w=>{w.particleSystems[f]=S,w.assignedParticles[b]=[...w.assignedParticles[b]||[],f]});L.patchState(U)}duplicateParticleSystem(L,M){const{id:S,targetChapterId:b}=M,f=l.R.generateParticleId(S);L.patchState(X.jM(L.getState(),U=>{U.particleSystems[f]=JSON.parse(JSON.stringify(U.particleSystems[S])),U.particleSystems[f].id=f,U.assignedParticles[b].push(f);const C=l.R.getParticleIdRoot(S);U.tweenParticleLookup[b]&&U.tweenParticleLookup[b][C]&&(U.tweenParticleLookup=y.e.addEntryForChapter(b,{[C]:f},U.tweenParticleLookup))})),L.dispatch(new e.u.DuplicateParticleSystemSuccess(f,b))}updateParticleSystem(L,M){const S=X.jM(L.getState(),b=>{b.particleSystems[M.id]=M.particleSystem});L.patchState({...S,particleSystems:{...S.particleSystems}})}deleteChapterLookup(L,M){L.patchState(X.jM(L.getState(),S=>{delete S.tweenParticleLookup[M.chapterId]}))}setLookupForChapter(L,M){L.patchState(X.jM(L.getState(),S=>{S.tweenParticleLookup[M.chapterId]=M.lookup}))}assignParticle(L,M){L.patchState(X.jM(L.getState(),S=>{const b=S.assignedParticles[M.chapterId]||[],f=l.R.getParticleIdRoot(M.id);S.assignedParticles[M.chapterId]=b.concat(M.id),S.tweenParticleLookup=y.e.addEntryForChapter(M.chapterId,{[f]:M.id},S.tweenParticleLookup),S.particleSystems={...S.particleSystems}}))}unassignParticle(L,M){L.patchState(X.jM(L.getState(),S=>{const b=S.assignedParticles[M.chapterId]||[],f=l.R.getParticleIdRoot(M.id);S.assignedParticles[M.chapterId]=b.filter(U=>U!==M.id),S.tweenParticleLookup[M.chapterId]&&delete S.tweenParticleLookup[M.chapterId][f],S.particleSystems={...S.particleSystems}}))}deleteParticleSystem(L,M){L.patchState(X.jM(L.getState(),S=>{delete S.particleSystems[M.id],Object.keys(S.assignedParticles).forEach(b=>{S.assignedParticles[b]=S.assignedParticles[b].filter(f=>f!==M.id)}),Object.keys(S.tweenParticleLookup).forEach(b=>{delete S.tweenParticleLookup[b][l.R.getParticleIdRoot(M.id)]})}))}selectParticleSystem(L,M){L.patchState(X.jM(L.getState(),S=>{S.particleSelection={selectedParticle:M.id}}))}selectParticleConstraint(L,M){const b=L.getState().particleSelection;L.patchState(X.jM(L.getState(),f=>{f.particleSelection={...b,selectedConstraint:M.index}}))}selectParticleCreator(L,M){const b=L.getState().particleSelection;L.patchState(X.jM(L.getState(),f=>{f.particleSelection={...b,selectedCreator:M.index}}))}selectParticleUpdater(L,M){const b=L.getState().particleSelection;L.patchState(X.jM(L.getState(),f=>{f.particleSelection={...b,selectedUpdater:M.index}}))}updateTweenParticleLookupChapters(L,M){L.patchState(X.jM(L.getState(),S=>{S.tweenParticleLookup=y.e.updateChapterIds(S.tweenParticleLookup,M.chapterMap)}))}constructor(){}static#t=this.\u0275fac=function(M){return new(M||dd)};static#n=this.\u0275prov=$.jDH({token:dd,factory:dd.\u0275fac})};j([(0,c.rc)(e.u.ApplyPatch),m("design:type",Function),m("design:paramtypes",[Object,e.u.ApplyPatch]),m("design:returntype",void 0)],V.prototype,"applyPatch",null),j([(0,c.rc)(e.u.SetParticleState),m("design:type",Function),m("design:paramtypes",[Object,e.u.SetParticleState]),m("design:returntype",void 0)],V.prototype,"setParticleState",null),j([(0,c.rc)(e.u.SetParticleSystemsVisible),m("design:type",Function),m("design:paramtypes",[Object,e.u.SetParticleSystemsVisible]),m("design:returntype",void 0)],V.prototype,"setParticlesVisible",null),j([(0,c.rc)(e.u.SetParticleSystemVisible),m("design:type",Function),m("design:paramtypes",[Object,e.u.SetParticleSystemVisible]),m("design:returntype",void 0)],V.prototype,"setParticleVisible",null),j([(0,c.rc)(e.u.NewParticleSystem),m("design:type",Function),m("design:paramtypes",[Object,e.u.NewParticleSystem]),m("design:returntype",void 0)],V.prototype,"newParticleSystem",null),j([(0,c.rc)(e.u.DuplicateParticleSystem),m("design:type",Function),m("design:paramtypes",[Object,e.u.DuplicateParticleSystem]),m("design:returntype",void 0)],V.prototype,"duplicateParticleSystem",null),j([(0,c.rc)(e.u.UpdateParticleSystem),m("design:type",Function),m("design:paramtypes",[Object,e.u.UpdateParticleSystem]),m("design:returntype",void 0)],V.prototype,"updateParticleSystem",null),j([(0,c.rc)(e.u.DeleteChapterLookup),m("design:type",Function),m("design:paramtypes",[Object,e.u.DeleteChapterLookup]),m("design:returntype",void 0)],V.prototype,"deleteChapterLookup",null),j([(0,c.rc)(e.u.SetLookupForChapter),m("design:type",Function),m("design:paramtypes",[Object,e.u.SetLookupForChapter]),m("design:returntype",void 0)],V.prototype,"setLookupForChapter",null),j([(0,c.rc)(e.u.AssignParticle),m("design:type",Function),m("design:paramtypes",[Object,e.u.AssignParticle]),m("design:returntype",void 0)],V.prototype,"assignParticle",null),j([(0,c.rc)(e.u.UnassignParticle),m("design:type",Function),m("design:paramtypes",[Object,e.u.UnassignParticle]),m("design:returntype",void 0)],V.prototype,"unassignParticle",null),j([(0,c.rc)(e.u.DeleteParticleSystem),m("design:type",Function),m("design:paramtypes",[Object,e.u.DeleteParticleSystem]),m("design:returntype",void 0)],V.prototype,"deleteParticleSystem",null),j([(0,c.rc)(e.u.SelectParticleSystem),m("design:type",Function),m("design:paramtypes",[Object,e.u.SelectParticleSystem]),m("design:returntype",void 0)],V.prototype,"selectParticleSystem",null),j([(0,c.rc)(e.u.SelectParticleConstraint),m("design:type",Function),m("design:paramtypes",[Object,e.u.SelectParticleConstraint]),m("design:returntype",void 0)],V.prototype,"selectParticleConstraint",null),j([(0,c.rc)(e.u.SelectParticleCreator),m("design:type",Function),m("design:paramtypes",[Object,e.u.SelectParticleCreator]),m("design:returntype",void 0)],V.prototype,"selectParticleCreator",null),j([(0,c.rc)(e.u.SelectParticleUpdater),m("design:type",Function),m("design:paramtypes",[Object,e.u.SelectParticleUpdater]),m("design:returntype",void 0)],V.prototype,"selectParticleUpdater",null),j([(0,c.rc)(e.u.UpdateTweenParticleLookupChapters),m("design:type",Function),m("design:paramtypes",[Object,e.u.UpdateTweenParticleLookupChapters]),m("design:returntype",void 0)],V.prototype,"updateTweenParticleLookupChapters",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getTweenParticleLookup",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getParticleSystems",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getVisisbleParticleSystems",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getParticleSystemsList",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getAssignedParticleSystems",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleSystemId",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleSystem",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleConstraintIndex",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleConstraint",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleCreatorIndex",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleCreator",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleUpdaterIndex",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],V,"getSelectedParticleUpdater",null),V=O=j([(0,c.Uw)({name:"engineParticles",defaults:{particleSelection:{},particleSystems:{},visibleParticleSystems:{},assignedParticles:{},tweenParticleLookup:{}}}),m("design:paramtypes",[])],V)},11040:(be,q,d)=>{"use strict";d.d(q,{DC:()=>I,IB:()=>$,NS:()=>m,U1:()=>O,WF:()=>y,kF:()=>L,q:()=>l});var c=d(24418),e=d(27180);const y={ja:"ja-JP","pt-PT":"pt-BR"},l={title:"English",lang:"en",country:"us",id:"en-US",direction:"ltr",applications:[e.c.All]},$=[l,{title:"Espa\xf1ol",lang:"es",country:"es",id:"es-ES",direction:"ltr",applications:[e.c.All]},{title:"\u4e2d\u6587(\u7b80\u4f53)",lang:"zh",country:"cn",id:"zh-CN",direction:"ltr",applications:[e.c.All]},{title:"Fran\xe7ais",lang:"fr",country:"fr",id:"fr-FR",direction:"ltr",applications:[e.c.All]},{title:"Deutsch",lang:"de",country:"de",id:"de-DE",direction:"ltr",applications:[e.c.All]},{title:"Italiano",lang:"it",country:"it",id:"it-IT",direction:"ltr",applications:[e.c.All]},{title:"\u65e5\u672c\u8a9e",lang:"ja",country:"ja",id:"ja",direction:"ltr",applications:[e.c.All]},{title:"Portugu\xeas",lang:"pt",country:"pt",id:"pt-PT",direction:"ltr",applications:[e.c.All]},{title:"\u05e2\u05b4\u05d1\u05e8\u05b4\u05d9\u05ea",lang:"he",country:"il",id:"he-IL",direction:"rtl",applications:[e.c.Viewer]}].filter(M=>M.applications.includes(e.c.All)||M.applications.includes(c.c.application));function m(M){return $.find(S=>S.id===M)}function O(M){return $.find(S=>S.lang===M)}function I(){return O(new URLSearchParams(window.location.search).get("lang"))??l}function L(){return(c.c.application===e.c.Viewer?I():function V(){let M="";try{M=localStorage.getItem("locale")}catch{}return m(M)||l}()).id}},45189:(be,q,d)=>{"use strict";d.d(q,{G:()=>Z});var c=d(45887),e=d(64109),y=d(82765),l=d(86600),X=d(88834),$=d(5951),j=d(82798),m=d(59115),O=d(55911),V=d(65571),I=d(34006),L=d(14823),M=d(95416),S=d(71997),b=d(90882),f=d(67575),T=(d(28931),d(65478)),w=d(81391),v=d(90953),A=d(76939),R=d(30450),N=d(54438);const B={disabled:!0,animation:{enterDuration:0,exitDuration:0}},Q={...(0,L.zi)(),touchGestures:"off",disableTooltipInteractivity:!0},H={overlayPanelClass:"bd-select-panel"};let Z=(()=>{class k{static#e=this.\u0275fac=function(D){return new(D||k)};static#t=this.\u0275mod=N.$C({type:k});static#n=this.\u0275inj=N.G2t({providers:[{provide:M.x6,useValue:{duration:3e3}},{provide:l.$E,useValue:B},{provide:L.sM,useValue:Q},{provide:j.JO,useValue:H}],imports:[w.ad,c.N0,y.g7,y.g7,X.Hl,$.Wk,j.Ve,m.Cn,O.s5,V.Vg,I.hM,L.uc,M._T,S.w,b.vg,T.E9,v.z_,A.jc,R.mV,w.ad,c.N0,e.Dc,y.g7,y.g7,X.Hl,$.Wk,j.Ve,m.Cn,O.s5,V.Vg,I.hM,L.uc,M._T,S.w,b.vg,T.E9,v.z_,A.jc,R.mV,f.PO]})}return k})()},30234:(be,q,d)=>{"use strict";d.d(q,{O:()=>e,a:()=>c});var c=function(y){return y.WoltersKluwer="wolters_kluwer",y.Zspace="zspace",y}(c||{}),e=function(y){return y.None="none",y.Subscription="subcription",y.Device="device",y}(e||{})},76774:(be,q,d)=>{"use strict";d.d(q,{Br:()=>C,En:()=>O,Ie:()=>v,MH:()=>w,z9:()=>S});var c=d(49204),$=(d(59429),d(24151),d(69568),d(43753));function O(R){const N=R.map(B=>(B.quizQuestions||[]).map(H=>({...H,chapterId:H.chapterId||B.id})));return[].concat(...N)}function S(R,N,B){return{...R,id:N,chapterId:B,data:b(R.type,R.data,B)}}function b(R,N,B){return R===$.Q5.LabelAnatomy?function f(R,N){return{...R,options:R.options.map(B=>({...B,label:{...B.label,chapterId:N}}))}}(N,B):(0,c.cloneDeep)(N)}function U(R){return"string"==typeof R.data.correctAnswer?[R.data.correctAnswer]:R.data.correctAnswer}function C(R,N){const B=U(R);switch(R.type){case $.Q5.LabelAnatomy:return(0,c.isEqual)(B,N);case $.Q5.MultipleChoice:return(0,c.isEqual)(B.sort(),N.sort());case $.Q5.SelectAnatomy:if(void 0===R.data.selectType||"all"===R.data.selectType)return(0,c.isEqual)(B.sort(),N.sort());if("any"===R.data.selectType)return 0===(0,c.difference)(N,B).length&&N.length>0}}function w(R,N){const B=R.filter(E=>E.type!==$.Q5.Instructions),Q=R.reduce((E,K)=>(E[K.id]=function T(R,N){const B=R.find(Q=>Q.questionId===N);return B?B.answer:void 0}(N,K.id),E),{}),H=R.reduce((E,K)=>(E[K.id]=U(K),E),{}),Z=B.filter(E=>{const K=Q[E.id];return C(E,typeof K>"u"?[]:"string"==typeof K?[K]:K)}),k=R.length,h=B.length,p=Z.length,D=k-p;return{score:k>0?Math.round(p/h*100):0,total:k,scorableTotal:h,correctTotal:p,incorrectTotal:D,questionAnswers:Q,correctQuestionAnswers:H}}function v(R){switch((0,c.get)(R,"type","")){case $.Q5.MultipleChoice:const B=(0,c.get)(R,"data.correctAnswer","");return B&&""!==B;case $.Q5.SelectAnatomy:case $.Q5.LabelAnatomy:return(0,c.get)(R,"data.correctAnswer",[]).length>0;default:return!0}}d(65776)},24552:(be,q,d)=>{"use strict";d.d(q,{h:()=>c});var c=function(e){return e[e.Question=0]="Question",e[e.Explanation=1]="Explanation",e[e.Review=2]="Review",e}(c||{})},43753:(be,q,d)=>{"use strict";d.d(q,{Q5:()=>c,of:()=>e});var c=function(l){return l.MultipleChoice="multiple-choice",l.SelectAnatomy="select-anatomy",l.LabelAnatomy="label-anatomy",l.Instructions="text-only",l}(c||{});const e={[c.MultipleChoice]:"Multiple Choice",[c.SelectAnatomy]:"Select Anatomy in 3D",[c.LabelAnatomy]:"Label Anatomy",[c.Instructions]:"Instructions"}},76016:(be,q,d)=>{"use strict";var c,e;d.d(q,{B:()=>c}),(e=c||(c={})).SetQuizState=(()=>{class R{static#e=this.type="[Quiz] Set Quiz State";constructor(B){this.quizState=B}}return R})(),e.ResetQuizState=(()=>{class R{static#e=this.type="[Quiz] Reset Quiz State";constructor(){}}return R})(),e.SetQuizSettings=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Settings";constructor(B){this.quizSettings=B}}return R})(),e.SetQuizActive=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Active";constructor(B){this.active=B}}return R})(),e.SetQuizLocked=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Locked";constructor(B){this.locked=B}}return R})(),e.SetEnableQuizRetake=(()=>{class R{static#e=this.type="[Quiz] Set Enable Quiz Retake";constructor(B){this.enable=B}}return R})(),e.SetQuizQuestionsMode=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Questions Mode";constructor(B){this.mode=B}}return R})(),e.ReorderQuestions=(()=>{class R{static#e=this.type="[Quiz] Reoder Quiz Questions";constructor(B){this.chapterIds=B}}return R})(),e.AddQuestion=(()=>{class R{static#e=this.type="[Quiz] Add Quiz Question";constructor(B){this.question=B}}return R})(),e.SetQuestions=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Questions";constructor(B){this.questions=B}}return R})(),e.RemoveQuestions=(()=>{class R{static#e=this.type="[Quiz] Remove Quiz Questions";constructor(B){this.questionIds=B}}return R})(),e.SetQuestion=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Question";constructor(B){this.question=B}}return R})(),e.SubmitQuestionAnswer=(()=>{class R{static#e=this.type="[Quiz] Submit Question Answer";constructor(B){this.submission=B}}return R})(),e.NextQuestion=(()=>{class R{static#e=this.type="[Quiz] Advance Question";constructor(){}}return R})(),e.PreviousQuestion=(()=>{class R{static#e=this.type="[Quiz] Previous Question";constructor(){}}return R})(),e.ClearSubmissions=(()=>{class R{static#e=this.type="[Quiz] Clear Submissions";constructor(){}}return R})(),e.SetActiveQuestion=(()=>{class R{static#e=this.type="[Quiz] Set Active Question";constructor(B){this.questionId=B}}return R})(),e.SetQuizPickMode=(()=>{class R{static#e=this.type="[Quiz] Set Pick Mode";constructor(B){this.pickMode=B}}return R})(),e.SetActiveSubmission=(()=>{class R{static#e=this.type="[Quiz] Set Active QuestionAnswer";constructor(B){this.submission=B}}return R})(),e.SetQuizLifecycle=(()=>{class R{static#e=this.type="[Quiz] Set Quiz Lifecycle";constructor(B){this.lifecycle=B}}return R})()},87710:(be,q,d)=>{"use strict";d.d(q,{W:()=>V,j:()=>U});var O,c=d(92014),e=d(76016),y=d(76774),l=d(43753),X=d(24552),$=d(54438),j=function(C,T,w,v){var N,A=arguments.length,R=A<3?T:null===v?v=Object.getOwnPropertyDescriptor(T,w):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)R=Reflect.decorate(C,T,w,v);else for(var B=C.length-1;B>=0;B--)(N=C[B])&&(R=(A<3?N(R):A>3?N(T,w,R):N(T,w))||R);return A>3&&R&&Object.defineProperty(T,w,R),R},m=function(C,T){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(C,T)},V=function(C){return C[C.Learning=0]="Learning",C[C.Assessment=1]="Assessment",C}(V||{});const L={quizModeActive:!1,quizModeLocked:!1,quizQuestionsMode:"all",enableQuizRetake:!0,launchMode:V.Learning,questions:[],activeQuestionId:void 0,activeSubmission:void 0,questionSubmissions:[],quizSettings:{enabled:!0,showSummary:!0,showExplanation:!0,showSubmit:!0,showProgress:!0},pickMode:"single",lifecycle:X.h.Question};function M(C,T){return C.filter(w=>w.chapterId===T)}function b(C,T){const w=T.map(A=>M(C,A));return[].concat(...w)}function f(C){const T=function S(C){return[...new Set(C.map(T=>T.chapterId))]}(C);return b(C,T)}let U=class _d{static#e=O=this;static getQuizQuestionsByChapter(T){return(0,c.Mz)([O],w=>M(w.questions,T))}static getLifecycle(T){return T.lifecycle}static getQuizSettings(T){return T.quizSettings}static getQuizLaunchMode(T){return T.launchMode}static getQuizModeActive(T){return T.quizModeActive}static getQuizModeLocked(T){return T.quizModeLocked}static getEnableQuizRetake(T){return T.enableQuizRetake}static getQuizReviewEnabled(T){const{quizModeLocked:w,quizQuestionsMode:v,questions:A,quizSettings:R}=T;return!(w&&!R.showSummary||w&&"restricted"===v&&1===A.length)}static globalSceneConfig(T){return T.sceneConfig}static hasQuiz(T){return T.questions.length>0}static getQuizEnabled(T){return!1!==T.quizSettings.enabled}static getAllQuestions(T){return T.questions}static getAllSubmissions(T){return T.questionSubmissions}static getActiveSubmitted(T){const{questionSubmissions:w,activeQuestionId:v}=T;return w.find(A=>A.questionId===v)}static getActiveSubmission(T){return T.activeSubmission}static getActiveQuestion(T){return T.questions.find(w=>w.id===T.activeQuestionId)}static getActiveQuestionId(T){return T.activeQuestionId}static getActiveQuestionLabels(T){const w=T.questions.find(v=>v.id===T.activeQuestionId);return w&&w.type===l.Q5.LabelAnatomy?w.data.options:[]}static getActiveQuestionIndex(T){return T.questions.findIndex(w=>w.id===T.activeQuestionId)}static getQuestionIndex(T,w){return(0,c.Mz)([O],v=>b(v.questions,T).findIndex(A=>A.id===w))}static getQuestionTotal(T){return T.questions.length}static getCorrectAnswerTotal(T){const{questionSubmissions:w,questions:v}=T;return w.filter(R=>{const N=v.find(B=>B.id===R.questionId);return(0,y.Br)(N,R.answer)}).length}static getQuestionsRemaining(T){const{questions:w,questionSubmissions:v}=T;return w.length-v.length}static hasQuestionRemaining(T){const{questions:w,questionSubmissions:v}=T;return v.length<w.length}static getPickMode(T){return T.pickMode}resetQuizState(T,w){T.setState({...L})}setQuizState(T,{quizState:w}){T.setState({...L,...w})}setQuizSettings(T,{quizSettings:w}){T.patchState({quizSettings:w})}setQuizActive(T,w){T.patchState({quizModeActive:w.active,activeQuestionId:!1===w.active?void 0:T.getState().activeQuestionId})}setQuizLocked(T,w){T.patchState({quizModeLocked:w.locked})}setEnableQuizRetake(T,w){T.patchState({enableQuizRetake:w.enable})}setQuizQuestionsMode(T,w){T.patchState({quizQuestionsMode:w.mode})}reorderQuestions(T,{chapterIds:w}){T.patchState({questions:b(T.getState().questions,w)})}addQuestion(T,w){const v=[...T.getState().questions,w.question];T.patchState({questions:f(v)})}setQuestions(T,{questions:w}){T.patchState({questions:f(w)})}setQuestion(T,w){const v=T.getState().questions.map(A=>A.id===w.question.id?w.question:A);T.patchState({questions:v})}removeQuestions(T,w){const v=T.getState(),A=null!=w.questionIds?w.questionIds:v.questions.map(N=>N.id),R=v.questions.filter(N=>!A.includes(N.id));T.patchState({questions:f(R)})}submitQuestionAnswer(T,w){const v=[...T.getState().questionSubmissions],A=v.findIndex(N=>N.questionId===w.submission.questionId);A>-1?v[A]=w.submission:v.push(w.submission),T.patchState({questionSubmissions:v})}nextQuestion(T){const{questions:w,activeQuestionId:v}=T.getState(),A=T.getState().questions.findIndex(N=>N.id===v),R=w[A+1]?.id||void 0;void 0!==R&&T.patchState({activeQuestionId:R})}previousQuestion(T){const{questions:w,activeQuestionId:v}=T.getState(),A=T.getState().questions.findIndex(N=>N.id===v),R=w[A-1]?.id||void 0;void 0!==R&&T.patchState({activeQuestionId:R})}clearSubmissions(T){T.patchState({questionSubmissions:[]})}setActiveQuestion(T,w){T.patchState({activeQuestionId:w.questionId})}setQuizPickMode(T,{pickMode:w}){T.patchState({pickMode:w})}setActiveSubmission(T,{submission:w}){T.patchState({activeSubmission:w})}setQuizLifecycle(T,w){T.patchState({lifecycle:w.lifecycle})}static#t=this.\u0275fac=function(w){return new(w||_d)};static#n=this.\u0275prov=$.jDH({token:_d,factory:_d.\u0275fac})};j([(0,c.rc)(e.B.ResetQuizState),m("design:type",Function),m("design:paramtypes",[Object,e.B.ResetQuizState]),m("design:returntype",void 0)],U.prototype,"resetQuizState",null),j([(0,c.rc)(e.B.SetQuizState),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizState]),m("design:returntype",void 0)],U.prototype,"setQuizState",null),j([(0,c.rc)(e.B.SetQuizSettings),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizSettings]),m("design:returntype",void 0)],U.prototype,"setQuizSettings",null),j([(0,c.rc)(e.B.SetQuizActive),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizActive]),m("design:returntype",void 0)],U.prototype,"setQuizActive",null),j([(0,c.rc)(e.B.SetQuizLocked),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizLocked]),m("design:returntype",void 0)],U.prototype,"setQuizLocked",null),j([(0,c.rc)(e.B.SetEnableQuizRetake),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetEnableQuizRetake]),m("design:returntype",void 0)],U.prototype,"setEnableQuizRetake",null),j([(0,c.rc)(e.B.SetQuizQuestionsMode),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizQuestionsMode]),m("design:returntype",void 0)],U.prototype,"setQuizQuestionsMode",null),j([(0,c.rc)(e.B.ReorderQuestions),m("design:type",Function),m("design:paramtypes",[Object,e.B.ReorderQuestions]),m("design:returntype",void 0)],U.prototype,"reorderQuestions",null),j([(0,c.rc)(e.B.AddQuestion),m("design:type",Function),m("design:paramtypes",[Object,e.B.AddQuestion]),m("design:returntype",void 0)],U.prototype,"addQuestion",null),j([(0,c.rc)(e.B.SetQuestions),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuestions]),m("design:returntype",void 0)],U.prototype,"setQuestions",null),j([(0,c.rc)(e.B.SetQuestion),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuestion]),m("design:returntype",void 0)],U.prototype,"setQuestion",null),j([(0,c.rc)(e.B.RemoveQuestions),m("design:type",Function),m("design:paramtypes",[Object,e.B.RemoveQuestions]),m("design:returntype",void 0)],U.prototype,"removeQuestions",null),j([(0,c.rc)(e.B.SubmitQuestionAnswer),m("design:type",Function),m("design:paramtypes",[Object,e.B.SubmitQuestionAnswer]),m("design:returntype",void 0)],U.prototype,"submitQuestionAnswer",null),j([(0,c.rc)(e.B.NextQuestion),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U.prototype,"nextQuestion",null),j([(0,c.rc)(e.B.PreviousQuestion),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U.prototype,"previousQuestion",null),j([(0,c.rc)(e.B.ClearSubmissions),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U.prototype,"clearSubmissions",null),j([(0,c.rc)(e.B.SetActiveQuestion),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetActiveQuestion]),m("design:returntype",void 0)],U.prototype,"setActiveQuestion",null),j([(0,c.rc)(e.B.SetQuizPickMode),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizPickMode]),m("design:returntype",void 0)],U.prototype,"setQuizPickMode",null),j([(0,c.rc)(e.B.SetActiveSubmission),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetActiveSubmission]),m("design:returntype",void 0)],U.prototype,"setActiveSubmission",null),j([(0,c.rc)(e.B.SetQuizLifecycle),m("design:type",Function),m("design:paramtypes",[Object,e.B.SetQuizLifecycle]),m("design:returntype",void 0)],U.prototype,"setQuizLifecycle",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getLifecycle",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Object)],U,"getQuizSettings",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Number)],U,"getQuizLaunchMode",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getQuizModeActive",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getQuizModeLocked",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getEnableQuizRetake",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Boolean)],U,"getQuizReviewEnabled",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"globalSceneConfig",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"hasQuiz",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getQuizEnabled",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getAllQuestions",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getAllSubmissions",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getActiveSubmitted",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getActiveSubmission",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getActiveQuestion",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getActiveQuestionId",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",Array)],U,"getActiveQuestionLabels",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getActiveQuestionIndex",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getQuestionTotal",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getCorrectAnswerTotal",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getQuestionsRemaining",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"hasQuestionRemaining",null),j([(0,c.MD)(),m("design:type",Function),m("design:paramtypes",[Object]),m("design:returntype",void 0)],U,"getPickMode",null),U=O=j([(0,c.Uw)({name:"quiz",defaults:L})],U)},65881:(be,q,d)=>{"use strict";d.d(q,{G:()=>y,S:()=>e});var c=d(59429);function e(l,X){return l.reduce(($,j)=>($[j.id]=!0===X?y():j.id,$),{})}function y(){return c.u.idWithPrefix("chapter")}},4951:(be,q,d)=>{"use strict";d.d(q,{W:()=>m});var c=d(2573),e=d(15877),y=d(24418),l=d(92811),X=d(65294),$=d(54438),j=d(83621);let m=(()=>{class O{constructor(I){this.applicationEventService=I}getClipboardAPISupport(){return"clipboard"in navigator}getClipboardAPI(){return navigator.clipboard}nativeShareLink(I){(!0===y.c.native||y.c.platform===l.N.SDK)&&this.applicationEventService.fireEvent(X.F.NativeShare,{type:"shareLinkModel",value:JSON.stringify(I)})}copyToClipboard(I,L){if(!0===y.c.native||y.c.platform===l.N.SDK)return new c.c(M=>{this.applicationEventService.fireEvent(X.F.NativeShare,{type:L,value:I}),M.next(!0),M.complete()});if(this.getClipboardAPISupport()){const M=this.getClipboardAPI();return new c.c(S=>{setTimeout(()=>{M.writeText(I).then(()=>{S.next(!0),S.complete()}).catch(b=>{console.log(b),S.next(!1),S.complete()})})})}return(0,e.of)(!1)}copyInputFieldValue(I){I.select();let L=!1;try{L=document.execCommand("copy")}catch{L=!1}return L}static#e=this.\u0275fac=function(L){return new(L||O)($.KVO(j.S))};static#t=this.\u0275prov=$.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})()},90908:(be,q,d)=>{"use strict";function c(){const X=document.createElement("canvas"),$=X.getContext("webgl")||X.getContext("experimental-webgl"),j=$ instanceof WebGLRenderingContext;return j&&$.getExtension("WEBGL_lose_context")?.loseContext(),j}function e(){return window.matchMedia("(hover: hover)").matches}function y(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function l(){return"scrollBehavior"in document.documentElement.style}d.d(q,{MN:()=>c,ZO:()=>e,uK:()=>l,yd:()=>y})},21007:(be,q,d)=>{"use strict";d.d(q,{Q:()=>I});var c=d(54438),e=d(82542);const y=["app-button",""],l=["*"],$={[e.P.Light]:{default:"text-gray-800 hover:bg-gray-900/10",flat:"text-gray-700 bg-gray-200 hover:text-black",outline:"border border-solid border-gray-400 text-gray-800 hover:bg-gray-900/10 text-gray-900",primary:"bg-red-600 text-white hover:bg-red-500",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-900 hover:text-gray-800"},[e.P.Dark]:{default:"text-gray-200 hover:bg-gray-800",flat:"bg-gray-700 hover:bg-gray-600",outline:"border border-solid border-gray-600 text-gray-200 hover:bg-white/10 hover:text-white",primary:"bg-red-600 text-white hover:bg-red-500",info:"bg-blue-600 text-white hover:bg-blue-500",text:"text-gray-500"}},j={default:"rounded px-4",rounded:"rounded-3xl px-4",circle:"rounded-full",square:"rounded",text:""},m={"2xs":"h-5",xs:"h-6",sm:"h-8",md:"h-9",lg:"h-11",xl:"h-12"},O={"2xs":"w-5",xs:"w-6",sm:"w-8",md:"w-9",lg:"w-11",xl:"w-12"},V={"2xs":"text-2xs",xs:"text-2xs",sm:"text-xs",md:"text-xs",lg:"text-sm",xl:"text-sm"};let I=(()=>{class L{constructor(){this.buttonSize=(0,c.hFB)("md"),this.buttonType=(0,c.hFB)("default"),this.buttonTheme=(0,c.hFB)(e.P.Dark),this.buttonShape=(0,c.hFB)("default"),this.buttonAlign=(0,c.hFB)("center"),this.uppercase=(0,c.hFB)(!0),this.disabled=(0,c.hFB)(!1),this.classes=(0,c.EWP)(()=>{const S=[];switch(S.push("flex items-center justify-center font-sans transition-colors"),S.push(this.disabled()?"opacity-50":"cursor-pointer"),this.uppercase()&&S.push("uppercase"),S.push("left"===this.buttonAlign()?"text-left":"text-center"),S.push($[this.buttonTheme()][this.buttonType()]),S.push(m[this.buttonSize()]),S.push(V[this.buttonSize()]),S.push(j[this.buttonShape()]),this.buttonShape()){case"circle":case"square":S.push(O[this.buttonSize()])}return S.join(" ")})}get hostDisabled(){return this.disabled()}get hostButtonType(){return this.buttonType()}static#e=this.\u0275fac=function(b){return new(b||L)};static#t=this.\u0275cmp=c.VBU({type:L,selectors:[["button","app-button",""],["a","app-button",""]],hostVars:2,hostBindings:function(b,f){2&b&&(c.Mr5("disabled",f.hostDisabled),c.BMQ("data-button-type",f.hostButtonType))},inputs:{buttonSize:[1,"buttonSize"],buttonType:[1,"buttonType"],buttonTheme:[1,"buttonTheme"],buttonShape:[1,"buttonShape"],buttonAlign:[1,"buttonAlign"],uppercase:[1,"uppercase"],disabled:[1,"disabled"]},attrs:y,ngContentSelectors:l,decls:2,vars:2,template:function(b,f){1&b&&(c.NAR(),c.j41(0,"span"),c.SdG(1),c.k0s()),2&b&&c.HbH(f.classes())},styles:["a[app-button],button[app-button]{border-color:transparent;background:none;border-width:0;padding:0;border-radius:4px;outline:0 none}a[app-button]:focus,button[app-button]:focus{--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-opacity: 1;--tw-ring-color: rgb(36 114 233 / var(--tw-ring-opacity, 1))}a[app-button][buttonshape=circle],a[app-button][ng-reflect-button-shape=circle],button[app-button][buttonshape=circle],button[app-button][ng-reflect-button-shape=circle]{border-radius:.25rem;border-radius:9999px}a[app-button]:not([disabled]):hover,button[app-button]:not([disabled]):hover{cursor:pointer}\n"],encapsulation:2,changeDetection:0})}return L})()},11818:(be,q,d)=>{"use strict";d.d(q,{C:()=>X});var c=d(60177),e=d(72026),y=d(45189),l=d(54438);let X=(()=>{class ${static#e=this.\u0275fac=function(O){return new(O||$)};static#t=this.\u0275mod=l.$C({type:$});static#n=this.\u0275inj=l.G2t({imports:[c.MD,e.o,y.G]})}return $})()},65985:(be,q,d)=>{"use strict";d.d(q,{Mp:()=>$,ri:()=>m});var c=d(54438);const e=["viewButton"],y=["app-view-button",""],l=["*"];var X=function(O){return O.Rounded="rounded",O.Square="square",O.Narrow="narrow",O.Squat="squat",O}(X||{}),$=function(O){return O.Default="default",O.Fill="fill",O.Small="small",O.XSmall="xsmall",O.XXSmall="2xsmall",O}($||{});const j={transparent:{background:"transparent",color:"inherit",border:"transparent",borderWidth:"0"},"transparent-fill":{background:"transparent",color:"#374A68",border:"transparent"},"blue-fill":{background:"#2d72dc",color:"#ffffff",border:"transparent",focusBorder:"#1C2A3F"},"red-fill":{background:"#f44336",color:"#ffffff",border:"transparent"},"dark-gray-fill":{background:"#283853",color:"#ffffff",border:"transparent",disabledColor:"#374a68"},"light-gray-fill":{background:"#eaeff5",color:"#374a68",border:"transparent",disabledColor:"#d7e0ea"},"white-outline":{background:"transparent",color:"#ffffff",border:"#ffffff",borderWidth:"1px"},white:{background:"transparent",color:"#ffffff",border:"transparent"},"light-gray-outline":{background:"transparent",color:"#000000",border:"#d7e0ea",borderWidth:"1px"}};let m=(()=>{class O{constructor(I,L){this.tabindex=I,this.hostElement=L,this.selected=!1,this.thin=!1,this.short=!1,this.buttonSize=$.Default,this.buttonShape=X.Square,this.addFocusStyle=!1,this.buttonTheme="transparent-fill",this.hasFocus=!1}ngOnInit(){this.styleButton()}ngOnChanges(){this.styleButton()}get attrAriaDisabled(){return this.disabled}onFocus(){this.hasFocus=!0,this.styleButton()}onBlur(){this.hasFocus=!1,this.styleButton()}styleButton(){const I=this.viewButton.nativeElement.style,L=j[this.buttonTheme??"transparent-fill"];switch(I.setProperty("border-color",L.border||"transparent"),I.setProperty("border-width",L.borderWidth||"2px"),I.setProperty("background-color",L.background),I.setProperty("color",L.color),(this.hasFocus||this.addFocusStyle)&&I.setProperty("border-color",L.focusBorder||"#2d72dc"),this.buttonShape){case X.Rounded:I.setProperty("border-radius","4px");break;case X.Square:I.setProperty("border-radius","0")}switch(this.buttonSize){case $.XXSmall:I.setProperty("min-height","28px"),I.setProperty("min-width","28px");break;case $.XSmall:I.setProperty("min-height","32px"),I.setProperty("min-width","32px");break;case $.Small:I.setProperty("min-height","40px"),I.setProperty("min-width","40px");break;case $.Fill:I.setProperty("min-height","100%"),I.setProperty("min-width","100%");break;default:I.setProperty("min-height","48px"),I.setProperty("min-width","48px")}this.thin&&I.setProperty("min-width","28px"),this.short&&I.setProperty("min-height","28px"),this.disabled&&I.setProperty("color",L.disabledColor||"#d7e0ea")}focus(){this.hostElement.nativeElement.focus()}static#e=this.\u0275fac=function(L){return new(L||O)(c.kS0("tabindex"),c.rXU(c.aKT))};static#t=this.\u0275cmp=c.VBU({type:O,selectors:[["button","app-view-button",""]],viewQuery:function(L,M){if(1&L&&c.GBs(e,7),2&L){let S;c.mGM(S=c.lsd())&&(M.viewButton=S.first)}},hostVars:2,hostBindings:function(L,M){1&L&&c.bIt("focus",function(){return M.onFocus()})("blur",function(){return M.onBlur()}),2&L&&(c.Mr5("disabled",M.disabled),c.BMQ("aria-disabled",M.attrAriaDisabled))},inputs:{disabled:"disabled",selected:"selected",thin:"thin",short:"short",buttonSize:"buttonSize",buttonShape:"buttonShape",addFocusStyle:"addFocusStyle",buttonTheme:"buttonTheme"},features:[c.OA$],attrs:y,ngContentSelectors:l,decls:4,vars:0,consts:[["viewButton",""],[1,"view-button"],[1,"view-button__content"]],template:function(L,M){1&L&&(c.NAR(),c.j41(0,"div",1,0)(2,"span",2),c.SdG(3),c.k0s()())},styles:['button[app-view-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all;position:relative;font-size:14px}button[app-view-button]::-moz-focus-inner{border:0}button[app-view-button]:not(:disabled):hover{cursor:pointer}button[app-view-button]:hover:not(:disabled):after{content:" ";pointer-events:none;position:absolute;inset:0;background-color:#0000000d}button[app-view-button]:disabled .view-button{color:#536788}.view-button{--background-color: transparent;--color: $gray-20;--border-color: transparent;--border-radius: 0;--border-width: 2px;--min-width: 48px;--min-height: 48px;background:var(--background-color);border:var(--border-width) solid var(--border-color);border-radius:var(--border-radius);color:var(--color);display:flex;align-items:center;justify-content:center;-webkit-user-select:none;user-select:none;pointer-events:none;min-width:var(--min-width);min-height:var(--min-height);height:100%;width:100%;transition:background-color .15s ease-out,border-color .15s ease-out,color .15s ease-out}.view-button--focus{--border-color: #2472e9 !important}.view-button__content{width:100%;transition:all .15s ease-out}\n'],encapsulation:2,changeDetection:0})}return O})()},86225:(be,q,d)=>{"use strict";d.d(q,{f:()=>X});var c=d(54438),e=d(66432),y=d(60177);const l=(0,e.QU)();let X=(()=>{class ${constructor(){this.category=(0,c.hFB)(""),this.color=(0,c.hFB)("mono"),this.imageCSSClass=(0,c.EWP)(()=>{const m=this.category(),O=this.color(),I=l.find(({id:L,title:M})=>L===m||M.toLowerCase()===m.toLowerCase())?.icon;return I?`category-image--${O}-${I}`:""})}static#e=this.\u0275fac=function(O){return new(O||$)};static#t=this.\u0275cmp=c.VBU({type:$,selectors:[["app-category-image"]],inputs:{category:[1,"category"],color:[1,"color"]},standalone:!0,features:[c.aNF],decls:1,vars:2,consts:[["role","img",1,"category-image","inline-block","w-full","h-full","bg-no-repeat","bg-center","bg-contain"]],template:function(O,V){1&O&&c.nrm(0,"div",0),2&O&&c.HbH(V.imageCSSClass())},dependencies:[y.MD],styles:[".category-image--color-all-models{background-image:url(color-all-models.svg)}.category-image--mono-all-models{background-image:url(mono-all-models.svg)}.category-image--color-complete-anatomy{background-image:url(color-complete-anatomy.svg)}.category-image--mono-complete-anatomy{background-image:url(mono-complete-anatomy.svg)}.category-image--color-anatomy-by-systems{background-image:url(color-anatomy-by-systems.svg)}.category-image--mono-anatomy-by-systems{background-image:url(mono-anatomy-by-systems.svg)}.category-image--color-anatomy-by-regions{background-image:url(color-anatomy-by-regions.svg)}.category-image--mono-anatomy-by-regions{background-image:url(mono-anatomy-by-regions.svg)}.category-image--color-allergy-and-immunology{background-image:url(color-allergy-and-immunology.svg)}.category-image--mono-allergy-and-immunology{background-image:url(mono-allergy-and-immunology.svg)}.category-image--color-cardiology{background-image:url(color-cardiology.svg)}.category-image--mono-cardiology{background-image:url(mono-cardiology.svg)}.category-image--color-cross-sections-and-micro-anatomy{background-image:url(color-cross-sections-and-micro-anatomy.svg)}.category-image--mono-cross-sections-and-micro-anatomy{background-image:url(mono-cross-sections-and-micro-anatomy.svg)}.category-image--color-bony-landmarks{background-image:url(color-bony-landmarks.svg)}.category-image--mono-bony-landmarks{background-image:url(mono-bony-landmarks.svg)}.category-image--color-origins-and-insertions{background-image:url(color-origins-and-insertions.svg)}.category-image--mono-origins-and-insertions{background-image:url(mono-origins-and-insertions.svg)}.category-image--color-dentistry{background-image:url(color-dentistry.svg)}.category-image--mono-dentistry{background-image:url(mono-dentistry.svg)}.category-image--color-dermatology{background-image:url(color-dermatology.svg)}.category-image--mono-dermatology{background-image:url(mono-dermatology.svg)}.category-image--color-endocrinology{background-image:url(color-endocrinology.svg)}.category-image--mono-endocrinology{background-image:url(mono-endocrinology.svg)}.category-image--color-gastroenterology{background-image:url(color-gastroenterology.svg)}.category-image--mono-gastroenterology{background-image:url(mono-gastroenterology.svg)}.category-image--color-hematology{background-image:url(color-hematology.svg)}.category-image--mono-hematology{background-image:url(mono-hematology.svg)}.category-image--color-infectious-disease{background-image:url(color-infectious-disease.svg)}.category-image--mono-infectious-disease{background-image:url(mono-infectious-disease.svg)}.category-image--color-obstetrics{background-image:url(color-obstetrics.svg)}.category-image--mono-obstetrics{background-image:url(mono-obstetrics.svg)}.category-image--color-nephrology{background-image:url(color-nephrology.svg)}.category-image--mono-nephrology{background-image:url(mono-nephrology.svg)}.category-image--color-neurology-and-psychiatry{background-image:url(color-neurology-and-psychiatry.svg)}.category-image--mono-neurology-and-psychiatry{background-image:url(mono-neurology-and-psychiatry.svg)}.category-image--color-gynecology{background-image:url(color-gynecology.svg)}.category-image--mono-gynecology{background-image:url(mono-gynecology.svg)}.category-image--color-guided-anatomy{background-image:url(color-guided-anatomy.svg)}.category-image--mono-guided-anatomy{background-image:url(mono-guided-anatomy.svg)}.category-image--color-oncology{background-image:url(color-oncology.svg)}.category-image--mono-oncology{background-image:url(mono-oncology.svg)}.category-image--color-ophtalmology{background-image:url(color-ophtalmology.svg)}.category-image--mono-ophtalmology{background-image:url(mono-ophtalmology.svg)}.category-image--color-orthopedics{background-image:url(color-orthopedics.svg)}.category-image--mono-orthopedics{background-image:url(mono-orthopedics.svg)}.category-image--color-otolarygngology{background-image:url(color-otolarygngology.svg)}.category-image--mono-otolarygngology{background-image:url(mono-otolarygngology.svg)}.category-image--color-pediatrics{background-image:url(color-pediatrics.svg)}.category-image--mono-pediatrics{background-image:url(mono-pediatrics.svg)}.category-image--color-physical-therapy{background-image:url(color-physical-therapy.svg)}.category-image--mono-physical-therapy{background-image:url(mono-physical-therapy.svg)}.category-image--color-primary-care{background-image:url(color-primary-care.svg)}.category-image--mono-primary-care{background-image:url(mono-primary-care.svg)}.category-image--color-pulmonology{background-image:url(color-pulmonology.svg)}.category-image--mono-pulmonology{background-image:url(mono-pulmonology.svg)}.category-image--color-quizzes-and-assessments{background-image:url(color-quizzes-and-assessments.svg)}.category-image--mono-quizzes-and-assessments{background-image:url(mono-quizzes-and-assessments.svg)}.category-image--color-rheumatology{background-image:url(color-rheumatology.svg)}.category-image--mono-rheumatology{background-image:url(mono-rheumatology.svg)}.category-image--color-urology{background-image:url(color-urology.svg)}.category-image--mono-urology{background-image:url(mono-urology.svg)}.category-image--color-community-bookmarks{background-image:url(color-community-bookmarks.svg)}.category-image--mono-community-bookmarks{background-image:url(mono-community-bookmarks.svg)}.category-image--color-zspace{background-image:url(color-zspace.svg)}.category-image--mono-zspace{background-image:url(mono-zspace.svg)}\n"],encapsulation:2,changeDetection:0})}return $})()},32996:(be,q,d)=>{"use strict";d.d(q,{z:()=>l});var c=d(60177),e=d(59162),y=d(54438);let l=(()=>{class X{static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275mod=y.$C({type:X});static#n=this.\u0275inj=y.G2t({imports:[c.MD,e.M]})}return X})()},26779:(be,q,d)=>{"use strict";d.d(q,{R:()=>y});var c=d(54438),e=d(60177);let y=(()=>{class l{get iconClass(){let j=`${this.custom?"fak":"fas"} fa-${this.icon}`;return this.size&&(j+=` fa-${this.size}`),j}constructor(){this.custom=!1}ngOnInit(){}static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275cmp=c.VBU({type:l,selectors:[["app-icon"]],inputs:{icon:"icon",size:"size",custom:"custom"},decls:1,vars:1,consts:[[3,"ngClass"]],template:function(j,m){1&j&&c.nrm(0,"i",0),2&j&&c.Y8G("ngClass",m.iconClass)},dependencies:[e.YU],styles:["[_nghost-%COMP%]{display:inline-block}"],changeDetection:0})}return l})()},72026:(be,q,d)=>{"use strict";d.d(q,{o:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},26621:(be,q,d)=>{"use strict";d.d(q,{o:()=>M});var c=d(60177),e=d(14823),y=d(34006),l=d(54438),X=d(65985),$=d(26779),j=d(97352);function m(S,b){1&S&&(l.j41(0,"div",5),l.nrm(1,"app-spinner",6),l.k0s())}let O=(()=>{class S{constructor(f,U,C){this.dialogRef=f,this.data=U,this.changeRef=C,this.config=U}ngOnInit(){}handleCloseClick(){this.dialogRef.close()}handleImageLoaded(){this.imageLoaded=!0,this.changeRef.markForCheck()}static#e=this.\u0275fac=function(U){return new(U||S)(l.rXU(y.CP),l.rXU(y.Vh),l.rXU(l.gRc))};static#t=this.\u0275cmp=l.VBU({type:S,selectors:[["app-image-dialog"]],decls:5,vars:6,consts:[["role","dialog","aria-modal","true",1,"image-dialog",3,"click","keyup.enter"],["class","image-dialog__loading flex flex-col p-8",4,"ngIf"],[1,"image-dialog__image",3,"load","src","title","alt"],["type","button","app-view-button","","buttonTheme","white","buttonShape","rounded","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"image-dialog__close",3,"click"],["icon","times"],[1,"image-dialog__loading","flex","flex-col","p-8"],["size","huge"]],template:function(U,C){1&U&&(l.j41(0,"div",0),l.bIt("click",function(){return C.handleCloseClick()})("keyup.enter",function(){return C.handleCloseClick()}),l.DNE(1,m,2,0,"div",1),l.j41(2,"img",2),l.bIt("load",function(){return C.handleImageLoaded()}),l.k0s(),l.j41(3,"button",3),l.bIt("click",function(){return C.handleCloseClick()}),l.nrm(4,"app-icon",4),l.k0s()()),2&U&&(l.BMQ("aria-label",(C.config.title||C.config.alt||"")+" Image Dialog"),l.R7$(),l.Y8G("ngIf",!C.imageLoaded),l.R7$(),l.Y8G("src",C.config.src,l.B4B)("title",C.config.title||"")("alt",C.config.alt||""),l.BMQ("aria-label",C.config.title||""))},dependencies:[c.bT,e.oV,X.ri,$.R,j.tI],styles:[".image-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.image-dialog__loading[_ngcontent-%COMP%]{position:absolute}.image-dialog__image[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}.image-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;right:24px}"],changeDetection:0})}return S})();var V=d(84370),I=d(72026);const L=["imageView"];let M=(()=>{class S{constructor(f){this.dialog=f,this.fit="normal",this.fullscreenEnabled=!1}handleFullscreen(f){this.dialog.open(O,{id:V.t.ImageDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{src:this.fullscreenSrc||this.src,alt:this.alt||""}}),f.stopPropagation()}static#e=this.\u0275fac=function(U){return new(U||S)(l.rXU(y.bZ))};static#t=this.\u0275cmp=l.VBU({type:S,selectors:[["app-image-view"]],viewQuery:function(U,C){if(1&U&&l.GBs(L,7),2&U){let T;l.mGM(T=l.lsd())&&(C.imageView=T.first)}},inputs:{fit:"fit",fitSize:"fitSize",src:"src",fullscreenSrc:"fullscreenSrc",alt:"alt"},standalone:!0,features:[l.aNF],decls:7,vars:8,consts:()=>{let f,U;return f=$localize`:1f332ec66f3bc8d943c248091be7f92772ba280f1359092845802014498:Expand`,U=$localize`:18f469ed5b239831a3f607f35e2faa3ccd9527d63521332303708985940:Click to expand the image`,[["imageView",""],U,["role","button","tabindex","0","matTooltip",f,1,"image-view",3,"click","keyup.enter"],[1,"sr-only"],[1,"image-view__image",3,"src"],["aria-hidden","true",1,"image-view__overlay"],["icon","expand-alt",1,"image-view__icon"]]},template:function(U,C){if(1&U){const T=l.RV6();l.j41(0,"div",2,0),l.bIt("click",function(v){return l.eBV(T),l.Njj(C.handleFullscreen(v))})("keyup.enter",function(v){return l.eBV(T),l.Njj(C.handleFullscreen(v))}),l.j41(2,"span",3),l.pXf(3,1),l.k0s(),l.nrm(4,"img",4),l.j41(5,"div",5),l.nrm(6,"app-icon",6),l.k0s()()}2&U&&(l.AVh("image-view--auto-fit","auto"===C.fit),l.R7$(4),l.xc7("max-width","auto"===C.fit&&C.fitSize?C.fitSize+"px":"100%")("max-height","auto"===C.fit&&C.fitSize?C.fitSize+"px":"100%"),l.Y8G("src",C.src,l.B4B),l.BMQ("alt",C.alt))},dependencies:[c.MD,e.uc,e.oV,I.o,$.R],styles:[".image-view[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:inherit;min-height:32px;position:relative;background-color:#f8f9fa}.image-view__image[_ngcontent-%COMP%]{width:auto;height:auto}.image-view--auto-fit[_ngcontent-%COMP%]   .image-view__image[_ngcontent-%COMP%]{max-width:100%;height:auto}.image-view__overlay[_ngcontent-%COMP%]{background:#1421364d;color:#fff;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:8px;position:absolute;inset:0;opacity:0;transition:opacity .25s}.image-view__icon[_ngcontent-%COMP%]{text-shadow:0 0 2px rgba(0,0,0,.6)}.image-view[_ngcontent-%COMP%]:hover{cursor:pointer}.image-view[_ngcontent-%COMP%]:hover   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}.image-view[_ngcontent-%COMP%]:focus{outline:#2472e9 solid 2px!important}.image-view[_ngcontent-%COMP%]:focus   .image-view__overlay[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}return S})()},78696:(be,q,d)=>{"use strict";d.d(q,{H:()=>$});var c=d(60177),e=d(89417),y=d(45189),l=d(72026),X=d(54438);let $=(()=>{class j{static#e=this.\u0275fac=function(V){return new(V||j)};static#t=this.\u0275mod=X.$C({type:j});static#n=this.\u0275inj=X.G2t({imports:[y.G,e.YN,c.MD,l.o]})}return j})()},3272:(be,q,d)=>{"use strict";d.d(q,{D:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},81488:(be,q,d)=>{"use strict";d.d(q,{f:()=>l});var c=d(60177),e=d(72026),y=d(54438);let l=(()=>{class X{static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275mod=y.$C({type:X});static#n=this.\u0275inj=y.G2t({imports:[c.MD,e.o]})}return X})()},44120:(be,q,d)=>{"use strict";d.d(q,{D:()=>tt});var c=d(54438),e=d(47610),y=d(13409),l=d(27180),X=d(61295),$=d(4951),j=d(59115),m=d(1102),O=d(58398),V=d(81881),I=d(47555),L=d(41862),M=function(Ue){return Ue.Chapter="chapter",Ue.Label="label",Ue.Paint="paint",Ue.Positions="positions",Ue.Quiz="quiz",Ue.Image="image",Ue}(M||{}),S=d(22959),b=d(43631),f=d(85586),U=d(44867),C=d(60177),T=d(89511),w=d(11818),v=d(72026),A=d(71997),R=d(89079),N=d(92014),B=d(95416),Q=d(18617),H=d(59369),Z=d(21007),k=d(26779);const h=["nodeActionsTrigger"],p=(Ue,yt)=>yt.id;function D(Ue,yt){if(1&Ue&&(c.qex(0),c.j41(1,"button",65),c.pXf(2,22),c.k0s(),c.nrm(3,"mat-divider"),c.bVm()),2&Ue){c.XpG();const ke=c.sdS(30);c.R7$(),c.Y8G("matMenuTriggerFor",ke)}}function te(Ue,yt){1&Ue&&(c.qex(0),c.pXf(1,23),c.bVm())}function E(Ue,yt){1&Ue&&(c.qex(0),c.pXf(1,24),c.bVm())}function K(Ue,yt){if(1&Ue&&(c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",66),c.pXf(3,25),c.k0s(),c.bVm()),2&Ue){c.XpG();const ke=c.sdS(49);c.R7$(2),c.Y8G("matMenuTriggerFor",ke)}}function u(Ue,yt){if(1&Ue&&(c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",67),c.pXf(3,26),c.k0s(),c.bVm()),2&Ue){c.XpG(2);const ke=c.sdS(56);c.R7$(2),c.Y8G("matMenuTriggerFor",ke)}}function x(Ue,yt){if(1&Ue&&c.DNE(0,u,4,1,"ng-container",47),2&Ue){const ke=c.XpG();c.Y8G("appFlagApplication",ke.application.Loft)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit")}}function z(Ue,yt){1&Ue&&c.nrm(0,"mat-divider")}function oe(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",68),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.editNodeLabel(De.node()))}),c.pXf(1,27),c.k0s()}}function ge(Ue,yt){if(1&Ue){const ke=c.RV6();c.qex(0),c.j41(1,"button",64),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.copy(De.node().label))}),c.pXf(2,28),c.k0s(),c.bVm()}}function ie(Ue,yt){if(1&Ue&&(c.j41(0,"button",70),c.pXf(1,30),c.k0s()),2&Ue){c.XpG(2);const ke=c.sdS(69);c.Y8G("matMenuTriggerFor",ke)}}function Y(Ue,yt){if(1&Ue&&(c.qex(0),c.j41(1,"button",69),c.pXf(2,29),c.k0s(),c.DNE(3,ie,2,1,"button",70),c.bVm()),2&Ue){const ke=c.XpG(),at=c.sdS(60);c.R7$(),c.Y8G("matMenuTriggerFor",at),c.R7$(2),c.vxM(ke.node().boolState.available?3:-1)}}function W(Ue,yt){if(1&Ue){const ke=c.RV6();c.qex(0),c.nrm(1,"mat-divider"),c.j41(2,"button",71),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.samplePaint(De.node()))}),c.pXf(3,31),c.k0s(),c.bVm()}}function Ee(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",72),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.toggleVisible(De.node(),!1))}),c.pXf(1,32),c.k0s()}}function re(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",73),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.toggleVisible(De.node(),!0))}),c.pXf(1,33),c.k0s()}}function Se(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",74),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.togglePickable(De.node(),!1))}),c.pXf(1,34),c.k0s()}}function se(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",75),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.togglePickable(De.node(),!0))}),c.pXf(1,35),c.k0s()}}function pe(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",76),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.toggleAvailable(De.node(),!1))}),c.pXf(1,36),c.k0s()}}function Te(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",77),c.bIt("click",function(){c.eBV(ke);const De=c.XpG();return c.Njj(De.toggleAvailable(De.node(),!0))}),c.pXf(1,37),c.k0s()}}function we(Ue,yt){if(1&Ue){const ke=c.RV6();c.j41(0,"button",62),c.bIt("click",function(){c.eBV(ke);const De=c.XpG().$implicit,Oe=c.XpG();return c.Njj(Oe.copyChapterPaint(Oe.node(),De.id))}),c.pXf(1,38),c.k0s()}if(2&Ue){const ke=c.XpG().$index;c.R7$(),c.uP7(ke+1),c.nnv(1)}}function Qe(Ue,yt){if(1&Ue&&c.DNE(0,we,2,1,"button",78),2&Ue){const ke=yt.$implicit,at=c.XpG();c.vxM(ke.id!==at.selectedChapterId()?0:-1)}}let tt=(()=>{class Ue{constructor(ke,at,De,Oe,nt,ce){this.store=ke,this.clipboardService=at,this.snackbar=De,this.liveAnnouncer=Oe,this.nodeService=nt,this.changeDetectorRef=ce,this.application=l.c,this.perChapterTreeEnabled=(0,R.ot)(this.store.select(b._.getPerChapterTreeEnabled)),this.chapters=(0,R.ot)(this.store.select(f.N.getStoryChapters)),this.selectedChapterId=(0,R.ot)(this.store.select(f.N.getSelectedChapterId)),this.node=(0,c.hFB)(),this.theme=(0,c.hFB)("dark"),this.shortId=(0,c.EWP)(()=>{const ve=this.node();return(0,U.KJ)(ve.id)}),this.eventCategory=(0,c.hFB)(""),this.nodeActionsClosed=(0,c.CGW)(),this.nodeActionsTrigger=(0,c.ebz)("nodeActionsTrigger")}isNodeChecked(ke){return this.store.selectSnapshot(y.z.getNodes)[ke].checked}isNodeShown(ke){return this.store.selectSnapshot(y.z.getNodes)[ke].shown}checkNode(ke,at){const De=void 0===at?!this.isNodeChecked(ke.id):at;this.store.dispatch(new X.q9(De,[ke.id]))}checkInverse(ke){this.store.dispatch(new X.q9(!0)),this.store.dispatch(new X.q9(!1,[ke.id]))}setCheckedNodes(ke,at){this.store.dispatch(new X.q9(!1));const De=void 0===at?!this.isNodeChecked(ke.id):at;this.store.dispatch(new X.q9(De,[ke.id]))}flyToNode(ke){this.store.dispatch(new e.W6(ke.id)).subscribe(()=>{this.liveAnnouncer.announce("Fly to complete")})}hideNode(ke){this.store.dispatch(new X.yr(!1,[ke.id]))}showNode(ke){this.store.dispatch(new X.yr(!0,[ke.id])),this.changeDetectorRef.markForCheck()}toggleVisible(ke,at){const De=void 0===at?this.isNodeShown(ke.id):at;this.store.dispatch(new X.yr(De,[ke.id])),this.changeDetectorRef.markForCheck()}togglePickable(ke,at){this.store.dispatch(new X.Ke(at,[ke.id])),this.changeDetectorRef.markForCheck()}makeEverythingElseUnpickale(ke){this.store.dispatch(new X.Ke(!1)),this.store.dispatch(new X.Ke(!0,[ke.id]))}toggleAvailable(ke,at){this.store.dispatch(new X.Ws(at,[ke.id])),this.changeDetectorRef.markForCheck()}hideInverse(ke){this.nodeService.hideInverse([ke.id])}fadeNode(ke){this.nodeService.fade([ke.id])}fadeInverseNodes(ke){this.nodeService.fadeInverse([ke.id])}editNodeLabel(ke){this.store.dispatch(new e._o(ke)),this.store.dispatch(new e.ro(ke))}copy(ke){this.clipboardService.copyToClipboard(ke,"text").subscribe(()=>{this.snackbar.open(`Copied ${ke} to clipboard.`)})}onMenuClosed(){this.nodeActionsClosed.emit()}samplePaint(ke){const at=this.store.selectSnapshot(y.z.getNodePaint)(ke.id),De=(0,m.Sf)(at);(0,O.Jl)(De)?this.store.dispatch(new V.WD(at)):this.store.dispatch(new V.Hr),this.store.dispatch(new e.pL(I.s.Paint)),this.store.dispatch(new L.yF(M.Paint))}copyChapterPaint(ke,at){this.store.dispatch(new X.ZF([ke.id],at))}static#e=this.\u0275fac=function(at){return new(at||Ue)(c.rXU(N.il),c.rXU($.W),c.rXU(B.UG),c.rXU(Q.Ai),c.rXU(S.w),c.rXU(c.gRc))};static#t=this.\u0275cmp=c.VBU({type:Ue,selectors:[["app-node-actions"]],viewQuery:function(at,De){1&at&&c.wEZ(De.nodeActionsTrigger,h,5),2&at&&c.NyB()},inputs:{node:[1,"node"],theme:[1,"theme"],eventCategory:[1,"eventCategory"]},outputs:{nodeActionsClosed:"nodeActionsClosed"},standalone:!0,features:[c.aNF],decls:72,vars:31,consts:()=>{let ke,at,De,Oe,nt,ce,ve,Ne,jt,pt,ct,ze,Hn,Pi,me,Je,li,il,na,ol,sl,al,rl,Za,ll,Cs,cl,dl,_l,er;return ke=$localize`:8973bc8c23a3f7c42aa9bd447386a3b0d26b74bc278590554940342755:menu`,at=$localize`:0a1d519b102495c607707a8de3e121d9777eb8f57459515625406813591: Isolate `,De=$localize`:3f42464a5a50bfc4200a744e960b2193b395d8336476624779946658339: Fade `,Oe=$localize`:23054cc1a12bc2f02ce35c53dda0a85a599c42b91462430833776684733: Fly To `,nt=$localize`:54cc524c29eb42615ed3660dbda137e40d9dd5027873649950229208086: Select This `,ce=$localize`:0fffdd57d53d51daf33ea3051cfee157555f7a052795853712015890159: Select Everything Else `,ve=$localize`:0ef9e3fa378a368d7def26850536752a3de491cf5280042464648975457: Fade This `,Ne=$localize`:b8640b44be68c687650962b406f6363a3b8758d76392506384252263496: Fade Everything Else `,jt=$localize`:59e0b28333dd6b25a8fccbe60b09a1e3be64c3eb4950300091124319961:Hide Everything Else`,pt=$localize`:3cea94df167f2ab21fb6fbca0ac24da30254ab374608376353419364284: Make Everything Else Unselectable `,ct=$localize`:70b9aca63f75c39c1c4a5a05b2ba3023a77a2b089128837186595333201: Copy Short ID `,ze=$localize`:f9220e31a995fb0f115662c3b630782b55a205069004635034659549721: Copy Full ID `,Hn=$localize`:0a3f724079cb80043738d1f0784a7563106faddc2488186665405139057: Copy Display Name `,Pi=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,me=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,Je=$localize`:2aba1e87039819aca3b70faa9aa848c12bf139ca8461842260159597706:Show`,li=$localize`:864421378feb1d521cd7a7174c792db76b43a2187629795719386983652: Selectable / Unselectable `,il=$localize`:f8552086e072958cbd175fce6ca62724c5f313bb4966413469492836967: Available / Unavailable `,na=$localize`:9ca20604245c07d56b1413d9e67a151a3ab2022d55699984583421362: Edit Display Name `,ol=$localize`:db693767fd3d7ba3a7c6d19faf21fbacf09226512283300174173662646: Copy Display Name `,sl=$localize`:353d39004ad14e085967669d05448251baab93a72821938014126744982: Copy `,al=$localize`:9190906690c1c5cd2136c84fb81d0c85751dbc814172863901001023616: Paint `,rl=$localize`:28fc8508c6148c461ec04013970b2ed628bfc06e6750409730286190445: Sample Paint `,Za=$localize`:f05cec857f16c24d8db89c50f3059742cbbfbbda5339110957660716850: Hide This `,ll=$localize`:552d734ad4619a8965231cc491c0e85a7bb155c73401892363421578792: Show This `,Cs=$localize`:968164c8722359889c83d149a11a5397358416601582264599495505864: Make Unselectable `,cl=$localize`:e7a08e6fec5a48b10e609eb63886bbd92fbdbacf2477567055965309744: Make Selectable `,dl=$localize`:99751ab6a5c4c71f400d25371daa6fa7d8d74abb2837486388916680829: Make Unavailable `,_l=$localize`:7df51bb35892872f649fbbe6c8ae82dae9edcd123656836653049520580: Make Available `,er=$localize`:a8db3e589abd66249c1c5671c8587cc8b6714ffc6619637855472690038: Apply Chapter ${"\ufffd0\ufffd"}:INTERPOLATION: Paint `,[["nodeActionsTrigger","matMenuTrigger"],["nodeActions","matMenu"],["selectActions","matMenu"],["fadeActions","matMenu"],["showHideActions","matMenu"],["pickableActions","matMenu"],["availableActions","matMenu"],["copyActions","matMenu"],["paintActions","matMenu"],ke,at,De,Oe,nt,ce,ve,Ne,jt,pt,ct,ze,Hn,Pi,me,Je,li,il,na,ol,sl,al,rl,Za,ll,Cs,cl,dl,_l,er,["app-button","","data-test","nodeActionsTrigger","buttonSize","xs","buttonShape","square",3,"menuClosed","buttonTheme","matMenuTriggerFor"],["icon","ellipsis-v","aria-hidden","true"],[1,"sr-only"],[3,"overlapTrigger"],[4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsHideShow",3,"click"],["mat-menu-item","","data-test","nodeActionsIsolate",3,"click"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationPage"],["mat-menu-item","","data-test","nodeActionsFlyTo",3,"click"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click",4,"appFlagApplication","appFlagApplicationPage","appFlagApplicationMode"],["mat-menu-item","","data-test","nodeActionsSelectThis",3,"click"],["mat-menu-item","","data-test","nodeActionsSelectEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse"],["mat-menu-item","","data-test","nodeActionsShowThis"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable"],["mat-menu-item","","data-test","nodeActionsUnpickable"],["mat-menu-item","","data-test","nodeActionsEverythingElseUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable"],["mat-menu-item","","data-test","nodeActionsAvailable"],["mat-menu-item","","data-test","nodeActionsCopyShortID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyFullID",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyDisplayName",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPickableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsAvailableTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsEditName",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsPaintTrigger",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","nodeActionsSamplePaint",3,"click"],["mat-menu-item","","data-test","nodeActionsShowEverythingElse",3,"click"],["mat-menu-item","","data-test","nodeActionsShowThis",3,"click"],["mat-menu-item","","data-test","nodeActionsPickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnpickable",3,"click"],["mat-menu-item","","data-test","nodeActionsUnavailable",3,"click"],["mat-menu-item","","data-test","nodeActionsAvailable",3,"click"],["mat-menu-item","","data-test","nodeActionsCopyShortID"]]},template:function(at,De){if(1&at){const Oe=c.RV6();c.qex(0),c.j41(1,"button",39,0),c.bIt("menuClosed",function(){return c.eBV(Oe),c.Njj(De.onMenuClosed())}),c.nrm(3,"app-icon",40),c.j41(4,"span",41),c.EFF(5),c.qex(6),c.pXf(7,9),c.bVm(),c.k0s()(),c.j41(8,"mat-menu",42,1),c.DNE(10,D,4,1,"ng-container",43),c.j41(11,"button",44),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.toggleVisible(De.node(),!De.node().boolState.shown))}),c.DNE(12,te,2,0,"ng-container")(13,E,2,0,"ng-container"),c.k0s(),c.j41(14,"button",45),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.hideInverse(De.node()))}),c.pXf(15,10),c.k0s(),c.nrm(16,"mat-divider"),c.j41(17,"button",46),c.pXf(18,11),c.k0s(),c.DNE(19,K,4,1,"ng-container",47)(20,x,1,3,"ng-container"),c.nrm(21,"mat-divider"),c.j41(22,"button",48),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.flyToNode(De.node()))}),c.pXf(23,12),c.k0s(),c.DNE(24,z,1,0,"mat-divider",43)(25,oe,2,0,"button",49)(26,ge,3,0,"ng-container",43)(27,Y,4,2,"ng-container",43)(28,W,4,0,"ng-container",43),c.k0s(),c.j41(29,"mat-menu",null,2)(31,"button",50),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.checkNode(De.node(),!0))}),c.pXf(32,13),c.k0s(),c.j41(33,"button",51),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.checkInverse(De.node()))}),c.pXf(34,14),c.k0s()(),c.j41(35,"mat-menu",null,3)(37,"button",52),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.fadeNode(De.node()))}),c.pXf(38,15),c.k0s(),c.j41(39,"button",53),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.fadeInverseNodes(De.node()))}),c.pXf(40,16),c.k0s()(),c.j41(41,"mat-menu",null,4),c.DNE(43,Ee,2,0,"button",54)(44,re,2,0,"button",55),c.nrm(45,"mat-divider"),c.j41(46,"button",56),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.hideInverse(De.node()))}),c.pXf(47,17),c.k0s()(),c.j41(48,"mat-menu",null,5),c.DNE(50,Se,2,0,"button",57)(51,se,2,0,"button",58),c.nrm(52,"mat-divider"),c.j41(53,"button",59),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.makeEverythingElseUnpickale(De.node()))}),c.pXf(54,18),c.k0s()(),c.j41(55,"mat-menu",null,6),c.DNE(57,pe,2,0,"button",60)(58,Te,2,0,"button",61),c.k0s(),c.j41(59,"mat-menu",null,7)(61,"button",62),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.copy(De.shortId()))}),c.pXf(62,19),c.k0s(),c.j41(63,"button",63),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.copy(De.node().id))}),c.pXf(64,20),c.k0s(),c.nrm(65,"mat-divider"),c.j41(66,"button",64),c.bIt("click",function(){return c.eBV(Oe),c.Njj(De.copy(De.node().label))}),c.pXf(67,21),c.k0s()(),c.j41(68,"mat-menu",null,8),c.Z7z(70,Qe,1,1,null,null,p),c.k0s(),c.bVm()}if(2&at){const Oe=c.sdS(9),nt=c.sdS(36);c.R7$(),c.Y8G("buttonTheme",De.theme())("matMenuTriggerFor",Oe),c.R7$(4),c.SpI("",De.node().label," "),c.R7$(3),c.Y8G("overlapTrigger",!0),c.R7$(2),c.Y8G("appFlagApplication",De.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(2),c.vxM(De.node().boolState.shown?12:13),c.R7$(5),c.Y8G("matMenuTriggerFor",nt),c.R7$(2),c.Y8G("appFlagApplication",De.application.All)("appFlagApplicationMode","include")("appFlagApplicationPage","/edit"),c.R7$(),c.vxM(De.perChapterTreeEnabled()?20:-1),c.R7$(4),c.Y8G("appFlagApplication",De.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",De.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",De.application.Studio)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",De.application.Loft)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(),c.Y8G("appFlagApplication",De.application.All)("appFlagApplicationPage","/edit")("appFlagApplicationMode","include"),c.R7$(15),c.vxM(De.node().boolState.shown?43:44),c.R7$(7),c.vxM(De.node().boolState.pickable?50:51),c.R7$(7),c.vxM(De.node().boolState.available?57:58),c.R7$(13),c.Dyx(De.chapters())}},dependencies:[C.MD,j.Cn,j.kk,j.fb,j.Cp,A.w,A.q,T.h,H.Y,w.C,Z.Q,v.o,k.R],changeDetection:0})}return Ue})()},82192:(be,q,d)=>{"use strict";d.d(q,{G:()=>m});var c=d(60177),e=d(44120),y=d(45189),l=d(72026),X=d(11818),$=d(89511),j=d(54438);let m=(()=>{class O{static#e=this.\u0275fac=function(L){return new(L||O)};static#t=this.\u0275mod=j.$C({type:O});static#n=this.\u0275inj=j.G2t({imports:[c.MD,$.h,y.G,X.C,l.o,e.D]})}return O})()},46374:(be,q,d)=>{"use strict";d.d(q,{b:()=>$});var c=d(60177),e=d(11818),y=d(45189),l=d(72026),X=d(54438);let $=(()=>{class j{static#e=this.\u0275fac=function(V){return new(V||j)};static#t=this.\u0275mod=X.$C({type:j});static#n=this.\u0275inj=X.G2t({imports:[c.MD,e.C,y.G,l.o]})}return j})()},59162:(be,q,d)=>{"use strict";d.d(q,{M:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},97352:(be,q,d)=>{"use strict";d.d(q,{tI:()=>m});var c=d(54438),e=d(60177);const y=(O,V,I)=>[O,V,I];function l(O,V){if(1&O&&(c.j41(0,"div",3),c.EFF(1),c.k0s()),2&O){const I=c.XpG();c.R7$(),c.SpI(" ",I.label," ")}}var X=function(O){return O.Small="small",O.Medium="medium",O.Large="large",O.Huge="huge",O}(X||{}),$=function(O){return O.Horizontal="horizontal",O.Vertical="vertical",O}($||{}),j=function(O){return O.Inline="inline",O.Block="block",O.Fill="fill",O}(j||{});let m=(()=>{class O{constructor(){this.size=X.Medium,this.label="",this.direction=$.Horizontal,this.render=j.Fill}ngOnInit(){}static#e=this.\u0275fac=function(L){return new(L||O)};static#t=this.\u0275cmp=c.VBU({type:O,selectors:[["app-spinner"]],inputs:{size:"size",label:"label",direction:"direction",render:"render"},decls:3,vars:6,consts:[[1,"spinner","spinner--horizontal",3,"ngClass"],[1,"spinner__circle"],["class","spinner__label",4,"ngIf"],[1,"spinner__label"]],template:function(L,M){1&L&&(c.j41(0,"div",0),c.nrm(1,"div",1),c.DNE(2,l,2,1,"div",2),c.k0s()),2&L&&(c.Y8G("ngClass",c.sMw(2,y,"spinner--"+M.size,"spinner--"+M.render,"spinner--"+M.direction)),c.R7$(2),c.Y8G("ngIf",M.label.length))},dependencies:[e.YU,e.bT],styles:['@keyframes _ngcontent-%COMP%_spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:11px;height:11px}.spinner--small[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:14px;height:14px}.spinner--medium[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:10px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:28px;height:28px}.spinner--large[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:14px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{width:44px;height:44px}.spinner--huge[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{font-size:16px}.spinner--horizontal[_ngcontent-%COMP%]{flex-direction:row}.spinner--vertical[_ngcontent-%COMP%]{align-items:center;flex-direction:column}.spinner--vertical[_ngcontent-%COMP%]   .spinner__label[_ngcontent-%COMP%]{padding:8px 0 0}.spinner--inline[_ngcontent-%COMP%]{display:inline-flex}.spinner--block[_ngcontent-%COMP%]{display:flex}.spinner--fill[_ngcontent-%COMP%]{display:flex;height:100%}.spinner__circle[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:50%;border:2px solid rgba(12,23,38,.1);position:relative}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]{border-color:#fff6}.spinner__circle[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_spinner .4s linear infinite;content:" ";border-radius:50%;border:2px solid transparent;border-top-color:#fff3;border-right-color:#0c172633;box-sizing:border-box;position:absolute;display:block;width:14px;height:14px;top:-2px;left:-2px}.theme-dark[_nghost-%COMP%]   .spinner__circle[_ngcontent-%COMP%]:after{border-top-color:#fff;border-right-color:#fff}.spinner__label[_ngcontent-%COMP%]{padding-left:8px;font-size:14px;text-transform:uppercase}.theme-dark[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#fff3}.theme-light[_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .spinner__label[_ngcontent-%COMP%]{color:#0c172699}'],changeDetection:0})}return O})()},87424:(be,q,d)=>{"use strict";d.d(q,{j:()=>X});var c=d(54438),e=d(60177);const y=["*"];function l($,j){1&$&&(c.j41(0,"div"),c.SdG(1),c.k0s())}let X=(()=>{class ${get isActive(){return this._isActive}set isActive(m){this._isActive=m,this.changeDetector.markForCheck()}constructor(m){this.changeDetector=m,this.hide=!1,this._isActive=!1}ngOnInit(){}static#e=this.\u0275fac=function(O){return new(O||$)(c.rXU(c.gRc))};static#t=this.\u0275cmp=c.VBU({type:$,selectors:[["app-tab"]],inputs:{label:"label",hide:"hide"},ngContentSelectors:y,decls:1,vars:1,consts:[[4,"ngIf"]],template:function(O,V){1&O&&(c.NAR(),c.DNE(0,l,2,0,"div",0)),2&O&&c.Y8G("ngIf",V.isActive)},dependencies:[e.bT],changeDetection:0})}return $})()},59464:(be,q,d)=>{"use strict";d.d(q,{j:()=>l});var c=d(60177),e=d(45189),y=d(54438);let l=(()=>{class X{static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275mod=y.$C({type:X});static#n=this.\u0275inj=y.G2t({imports:[c.MD,e.G]})}return X})()},57018:(be,q,d)=>{"use strict";d.d(q,{O:()=>U});var c=d(54438),e=d(87424),y=d(29160),l=d(85052),X=d(37925),$=d(1670),j=d(14264),m=d(60177),O=d(71997);const V=["tabButton"],I=["*"],L=(C,T,w,v)=>({"tabs--small":C,"tabs--medium":T,"tabs--scrollable":w,"tabs--padded":v}),M=(C,T,w,v,A,R)=>({"tabs__label--dark":C,"tabs__label--light":T,"tabs__label--dark-active":w,"tabs__label--light-active":v,"tabs__label--blue":A,"tabs__label--red":R});function S(C,T){if(1&C){const w=c.RV6();c.j41(0,"button",7,1),c.bIt("click",function(){const A=c.eBV(w).$implicit,R=c.XpG();return c.Njj(R.handleTabSelect(A))}),c.EFF(2),c.k0s()}if(2&C){const w=T.$implicit,v=c.XpG();c.Y8G("ngClass",c.l4e(4,M,"dark"===v.tabTheme,"light"===v.tabTheme,"dark"===v.tabTheme&&v.isTabActive(w),"light"===v.tabTheme&&v.isTabActive(w),"blue"===v.tabColor,"red"===v.tabColor)),c.BMQ("aria-selected",v.isTabActive(w))("tabIndex",v.isTabActive(w)?0:-1),c.R7$(2),c.SpI(" ",w.label," ")}}function b(C,T){1&C&&c.nrm(0,"mat-divider")}let U=(()=>{class C{get activeTab(){return this._activeTab.value}set activeTab(w){null!=w&&("string"==typeof w&&(w=w.toUpperCase()),this._activeTab.next(w))}get tabItems(){return this._tabItems}set tabItems(w){this._tabItems=w}constructor(w){this.changeDetector=w,this.display="normal",this.tabTheme="dark",this.activeTabChange=new c.bkB,this._activeTab=new y.t(0),this.tabSize="small",this.tabAlign="default",this.tabColor="blue",this.tabUnderline=!1,this.tabPadded=!1,this.scrollable=!1,this.ngUnsubscribe=new l.B}ngAfterContentInit(){this._tabs.changes.pipe((0,X.Q)(this.ngUnsubscribe)).subscribe(w=>{this.mapTabs(),this.changeDetector.markForCheck()}),this.mapTabs(),this._activeTab.pipe((0,X.Q)(this.ngUnsubscribe)).subscribe(w=>{this.showTab(w)}),this._activeTab.pipe((0,$.J)(),(0,j.p)(([w,v])=>w!==v),(0,X.Q)(this.ngUnsubscribe)).subscribe(([w,v])=>{this.activeTabChange.next(v)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTabSelect(w){this._activeTab.next(w.index)}mapTabs(){this.tabItems=this._tabs.map((w,v)=>({index:v,label:w.label||`Item ${v}`,tab:w}))}showTab(w){this._tabs.forEach((v,A)=>{switch(typeof w){case"number":v.isActive=w===A;break;case"string":v.isActive=w.toString().toUpperCase()===v.label.toUpperCase()}}),this.changeDetector.markForCheck()}isTabActive(w){return("string"==typeof this._activeTab.value?w.label.toUpperCase():w.index)===this._activeTab.value}shiftTab(w){const A=(this.tabItems.find(R=>this.isTabActive(R)).index+w+this.tabItems.length)%this.tabItems.length;this._activeTab.next(A),this._buttonRefs.toArray()[A].nativeElement.focus()}static#e=this.\u0275fac=function(v){return new(v||C)(c.rXU(c.gRc))};static#t=this.\u0275cmp=c.VBU({type:C,selectors:[["app-tabs"]],contentQueries:function(v,A,R){if(1&v&&c.wni(R,e.j,4),2&v){let N;c.mGM(N=c.lsd())&&(A._tabs=N)}},viewQuery:function(v,A){if(1&v&&c.GBs(V,5),2&v){let R;c.mGM(R=c.lsd())&&(A._buttonRefs=R)}},inputs:{display:"display",tabTheme:"tabTheme",activeTab:"activeTab",tabSize:"tabSize",tabAlign:"tabAlign",tabColor:"tabColor",tabUnderline:"tabUnderline",tabPadded:"tabPadded",scrollable:"scrollable"},outputs:{activeTabChange:"activeTabChange"},ngContentSelectors:I,decls:7,vars:10,consts:[["tabElements",""],["tabButton",""],[1,"tabs",3,"ngClass"],["role","tablist",1,"tabs__labels",3,"keyup.arrowright","keyup.arrowleft"],["class","tabs__label","role","tab","type","button","data-test","tabButton",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"tabs__content"],["role","tab","type","button","data-test","tabButton",1,"tabs__label",3,"click","ngClass"]],template:function(v,A){if(1&v){const R=c.RV6();c.NAR(),c.j41(0,"div",2)(1,"div",3,0),c.bIt("keyup.arrowright",function(){return c.eBV(R),c.Njj(A.shiftTab(1))})("keyup.arrowleft",function(){return c.eBV(R),c.Njj(A.shiftTab(-1))}),c.DNE(3,S,3,11,"button",4)(4,b,1,0,"mat-divider",5),c.k0s(),c.j41(5,"div",6),c.SdG(6),c.k0s()()}2&v&&(c.Y8G("ngClass",c.ziG(5,L,"small"===A.tabSize,"medium"===A.tabSize,A.scrollable,A.tabPadded)),c.R7$(),c.AVh("tabs__labels--center","center"===A.tabAlign),c.R7$(2),c.Y8G("ngForOf",A.tabItems),c.R7$(),c.Y8G("ngIf",A.tabUnderline))},dependencies:[m.YU,m.Sq,m.bT,O.q],styles:['.tabs__labels[_ngcontent-%COMP%]{margin-bottom:8px}.tabs__labels--center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.tabs__label[_ngcontent-%COMP%]{padding:2px 4px 4px;margin-right:8px;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:500;-webkit-user-select:none;user-select:none;position:relative;background:none;border:none}.tabs__label[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid;margin-top:4px;width:0;transition:.25s ease;position:absolute;bottom:0;left:0}.tabs__label[_ngcontent-%COMP%]:hover{cursor:pointer}.tabs__label--blue[_ngcontent-%COMP%]:after{border-color:#2472e9}.tabs__label--red[_ngcontent-%COMP%]:after{border-color:#de3535}.tabs__label--dark[_ngcontent-%COMP%]{color:#8999b3}.tabs__label--dark[_ngcontent-%COMP%]:hover, .tabs__label--dark-active[_ngcontent-%COMP%]{color:#fff}.tabs__label--dark-active[_ngcontent-%COMP%]:after{width:100%}.tabs__label--light[_ngcontent-%COMP%]{color:#384c6c}.tabs__label--light[_ngcontent-%COMP%]:hover, .tabs__label--light-active[_ngcontent-%COMP%]{color:#283853}.tabs__label--light-active[_ngcontent-%COMP%]:after{width:100%}.tabs--medium[_ngcontent-%COMP%]   .tabs__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tabs--scrollable[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:100%}.tabs--scrollable[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{overflow:auto;flex:1 1 auto}.tabs--padded[_ngcontent-%COMP%]   .tabs__content[_ngcontent-%COMP%]{padding:20px 4px}'],changeDetection:0})}return C})()},64026:(be,q,d)=>{"use strict";d.d(q,{m:()=>l});var c=d(60177),e=d(11818),y=d(54438);let l=(()=>{class X{static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275mod=y.$C({type:X});static#n=this.\u0275inj=y.G2t({imports:[c.MD,e.C]})}return X})()},18824:(be,q,d)=>{"use strict";d.d(q,{j:()=>X});var c=d(60177),e=d(11818),y=d(72026),l=d(54438);let X=(()=>{class ${static#e=this.\u0275fac=function(O){return new(O||$)};static#t=this.\u0275mod=l.$C({type:$});static#n=this.\u0275inj=l.G2t({imports:[c.MD,e.C,y.o]})}return $})()},5584:(be,q,d)=>{"use strict";d.d(q,{d:()=>l});var c=d(60177),e=d(72026),y=d(54438);let l=(()=>{class X{static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275mod=y.$C({type:X});static#n=this.\u0275inj=y.G2t({imports:[c.MD,e.o]})}return X})()},12854:(be,q,d)=>{"use strict";d.d(q,{X:()=>S});var c=d(54438),e=d(78109),y=d(44867),l=d(47610),X=d(82542),$=d(60177),j=d(60724),m=d(92014);const O=(b,f)=>f.id,V=b=>({"tree-group--light":b});function I(b,f){if(1&b){const U=c.RV6();c.j41(0,"div",5),c.bIt("click",function(){c.eBV(U);const T=c.XpG(2).$implicit,w=c.XpG();return c.Njj(w.handleExpandClick(T,!0))}),c.k0s()}if(2&b){const U=c.XpG(2).$implicit;c.Y8G("title",U.label)}}function L(b,f){if(1&b&&(c.j41(0,"div",2),c.DNE(1,I,1,1,"div",3),c.nrm(2,"app-tree-group",4),c.k0s()),2&b){const U=c.XpG().$implicit,C=c.XpG();c.R7$(),c.vxM(C.hasChildren(U)?1:-1),c.R7$(),c.Y8G("graph",C.graph())("graphNode",U)("theme",C.theme())("layerOrderMode",C.layerOrderMode())("showTreeNodeIds",C.showTreeNodeIds())("showLatinLabel",C.showLatinLabel())}}function M(b,f){if(1&b&&(c.j41(0,"div",0),c.nrm(1,"app-tree-nested-node",1),c.DNE(2,L,3,7,"div",2),c.k0s()),2&b){const U=f.$implicit,C=c.XpG();c.Y8G("ngClass",c.eq3(8,V,C.theme()===C.themeEnum.Light)),c.R7$(),c.Y8G("graph",C.graph())("node",U)("theme",C.theme())("layerOrderMode",C.layerOrderMode())("showTreeNodeIds",C.showTreeNodeIds())("showLatinLabel",C.showLatinLabel()),c.R7$(),c.vxM(U.boolState.expanded?2:-1)}}let S=(()=>{class b{constructor(U,C){this.graphService=U,this.store=C,this.themeEnum=X.P,this.graph=c.hFB.required(),this.layerOrderMode=c.hFB.required(),this.showTreeNodeIds=c.hFB.required(),this.showLatinLabel=c.hFB.required(),this.graphNode=(0,c.hFB)(),this.theme=(0,c.hFB)(X.P.Dark),this.nodes=(0,c.EWP)(()=>{const T=this.graphNode(),w=this.graph(),v=T?(0,y.IA)(w,T.id):(0,y.ug)(w);return this.graphService.getNodes(w,v)})}hasChildren(U){const C=this.graph();return(0,y.IA)(C,U.id).length>0}handleExpandClick(U,C){this.store.dispatch(C?new l.z(U):new l._o(U))}static#e=this.\u0275fac=function(C){return new(C||b)(c.rXU(e.w),c.rXU(m.il))};static#t=this.\u0275cmp=c.VBU({type:b,selectors:[["app-tree-group"]],inputs:{graph:[1,"graph"],layerOrderMode:[1,"layerOrderMode"],showTreeNodeIds:[1,"showTreeNodeIds"],showLatinLabel:[1,"showLatinLabel"],graphNode:[1,"graphNode"],theme:[1,"theme"]},standalone:!0,features:[c.aNF],decls:2,vars:0,consts:[[1,"tree-group",3,"ngClass"],[3,"graph","node","theme","layerOrderMode","showTreeNodeIds","showLatinLabel"],[1,"tree-group__children"],[1,"tree-group__collapse",3,"title"],[3,"graph","graphNode","theme","layerOrderMode","showTreeNodeIds","showLatinLabel"],[1,"tree-group__collapse",3,"click","title"]],template:function(C,T){1&C&&c.Z7z(0,M,3,10,"div",0,O),2&C&&c.Dyx(T.nodes())},dependencies:[b,$.MD,$.YU,j.r],styles:['.tree-group[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:after{background:#e7eaee}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover{background:transparent}.tree-group--light[_ngcontent-%COMP%]   .tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#d4d9e3}.tree-group__children[_ngcontent-%COMP%]{padding-inline-start:20px;position:relative}.tree-group__collapse[_ngcontent-%COMP%]{position:absolute;inset-inline-start:0;top:0;bottom:0;width:20px;z-index:1}.tree-group__collapse[_ngcontent-%COMP%]:after{content:" ";display:block;position:absolute;width:1px;inset-inline-start:10px;top:0;bottom:0;background:#142136}.tree-group__collapse[_ngcontent-%COMP%]:hover{cursor:pointer}.tree-group__collapse[_ngcontent-%COMP%]:hover:after{background:#283853}'],changeDetection:0})}return b})()},60724:(be,q,d)=>{"use strict";d.d(q,{r:()=>E});var c=d(54438),e=d(89079),y=d(47610),l=d(13409),X=d(24418),$=d(44867),j=d(61295),m=d(76304),O=d(82542),V=d(35650),I=d(43631),L=d(60177),M=d(89511),S=d(11818),b=d(72026),f=d(82192),U=d(92014),C=d(38645),T=d(37737),w=d(25780),v=d(49989),A=d(21007),R=d(26779),N=d(44120);const B=(K,u,x,z)=>({"tree-node--light":K,"tree-node--hidden":u,"tree-node--selected":x,"tree-node--unpickable":z}),Q=K=>({"tree-node__label--padded":K});function H(K,u){if(1&K){const x=c.RV6();c.j41(0,"button",14),c.bIt("click",function(){c.eBV(x);const oe=c.XpG();return c.Njj(oe.handleExpandClick(oe.node()))}),c.nrm(1,"app-icon",15),c.k0s()}if(2&K){const x=c.XpG();c.Y8G("buttonTheme",x.theme()),c.BMQ("aria-label",x.getExpandedLabel(x.node()))("aria-expanded",x.node().boolState.expanded),c.R7$(),c.AVh("rotate-45",x.node().boolState.expanded)}}function Z(K,u){if(1&K&&(c.j41(0,"div",18),c.EFF(1),c.k0s()),2&K){const x=c.XpG(2);c.R7$(),c.SpI(" ",x.shortId()," ")}}function k(K,u){1&K&&c.nrm(0,"app-icon",20)}function h(K,u){if(1&K&&(c.j41(0,"div",22),c.EFF(1),c.k0s()),2&K){const x=c.XpG(2);c.R7$(),c.SpI(" ",x.node().latinLabel," ")}}function p(K,u){if(1&K){const x=c.RV6();c.j41(0,"div",16),c.bIt("dblclick",function(){c.eBV(x);const oe=c.XpG();return c.Njj(oe.setEditLabelMode(!0))}),c.j41(1,"div",17),c.DNE(2,Z,2,1,"div",18),c.j41(3,"div",19),c.DNE(4,k,1,0,"app-icon",20),c.j41(5,"span",21),c.pXf(6,2),c.k0s(),c.EFF(7),c.k0s(),c.DNE(8,h,2,1,"div",22),c.k0s()()}if(2&K){const x=c.XpG();c.Y8G("ngClass",c.eq3(6,Q,!x.hasChildren()&&x.nested())),c.BMQ("aria-current",x.checked()),c.R7$(2),c.vxM(x.showTreeNodeIds()?2:-1),c.R7$(2),c.vxM(x.perChapterTreeEnabled()&&!1===x.node().boolState.available?4:-1),c.R7$(3),c.SpI(" ",x.node().label," "),c.R7$(),c.vxM(x.showLatinLabel()&&x.node().latinLabel?8:-1)}}function D(K,u){if(1&K){const x=c.RV6();c.j41(0,"input",23),c.bIt("blur",function(oe){c.eBV(x);const ge=c.XpG();return c.Njj(ge.handleObjectLabel(oe))})("keyup",function(oe){c.eBV(x);const ge=c.XpG();return c.Njj(ge.handleObjectLabel(oe))}),c.k0s()}if(2&K){const x=c.XpG();c.Y8G("value",x.node().label)}}function te(K,u){if(1&K){const x=c.RV6();c.j41(0,"input",24),c.bIt("change",function(oe){c.eBV(x);const ge=c.XpG();return c.Njj(ge.handleLayerOrder(oe,ge.node()))}),c.k0s()}if(2&K){const x=c.XpG();c.Y8G("value",x.node().numState.layer)}}let E=(()=>{class K{constructor(x,z,oe){this.store=x,this.sceneService=z,this.router=oe,this.themeEnum=O.P,this.isLoft="module"===X.c.exportType,this.nodes=this.store.selectSignal(l.z.getNodes),this.labelEditNode=(0,e.ot)(this.store.select(m.S.getLabelEditNode)),this.perChapterTreeEnabled=(0,e.ot)(this.store.select(I._.getPerChapterTreeEnabled)),this.graph=c.hFB.required(),this.node=c.hFB.required(),this.layerOrderMode=(0,c.hFB)(),this.showTreeNodeIds=(0,c.hFB)(),this.showLatinLabel=(0,c.hFB)(),this.nested=(0,c.hFB)(!0),this.theme=(0,c.hFB)(O.P.Dark),this.hasChildren=(0,c.EWP)(()=>{const ge=this.node(),ie=this.graph();return this.nodeHasChildren(ie,ge?.id)}),this.checked=(0,c.EWP)(()=>{const ge=this.node(),ie=this.nodes();return this.isNodeChecked(ie,ge.id)}),this.editLabelMode=(0,c.EWP)(()=>{const ge=this.node(),ie=this.labelEditNode();return ge.id===ie?.id}),this.sanitizedID=(0,c.EWP)(()=>{const ge=this.node();return(0,$.Nk)(ge.id)}),this.shortId=(0,c.EWP)(()=>{const ge=this.node();return(0,$.KJ)(ge.id).replace(/_/g," ")})}ngOnInit(){this.isEditMode=this.router.url.indexOf("/edit")>=0}isNodeChecked(x,z){return!0===x[z]?.checked}nodeHasChildren(x,z){return!(!x||!z)&&(0,$.IA)(x,z).length>0}getExpandedLabel(x){const{boolState:z,label:oe}=x;return z.expanded?$localize`Collapse`+` ${oe}`:$localize`Expand`+` ${oe}`}handleExpandClick(x){this.toggleExpanded(x,x.boolState.expanded)}toggleVisibleClick(x){this.toggleVisible(x,x.boolState.shown)}handleNodeClick(x,z){x.shiftKey?this.checkNode(z):(this.setCheckedNodes(z),this.isFlyToNodeEnabled(z)&&this.store.dispatch(new y.W6(z.id)),this.toggleExpanded(z,!z.boolState.expanded))}toggleVisible(x,z){this.store.dispatch(new j.yr(!z,[x.id]))}toggleExpanded(x,z){this.store.dispatch(z?new y.z(x):new y._o(x))}handleLayerOrder(x,z){const ge=parseInt(x.target.value,10);this.setLayerOrder(z,ge)}checkNode(x){const z=this.nodes(),oe=!this.isNodeChecked(z,x.id);this.store.dispatch(new j.q9(oe,[x.id]))}setCheckedNodes(x){const z=this.nodes();this.store.dispatch(new j.q9(!1));const oe=!this.isNodeChecked(z,x.id);this.store.dispatch(new j.q9(oe,[x.id]))}setLayerOrder(x,z){this.store.dispatch(new y.zw([x],z))}handleObjectLabel(x){const z=x.target;x instanceof KeyboardEvent?("enter"===x.key.toLowerCase()&&(this.setLabel(z.value),this.setEditLabelMode(!1)),"escape"===x.key.toLowerCase()&&this.setEditLabelMode(!1)):x instanceof FocusEvent&&"blur"===x.type&&(this.setLabel(z.value),this.setEditLabelMode(!1))}setLabel(x){const z=this.node();this.store.dispatch(new y.$h(z.id,x))}setEditLabelMode(x){if(this.isEditMode){const z=this.node();this.store.dispatch(new y.ro(x?z:null))}}isFlyToNodeEnabled(x){return!this.isEditMode&&(x.boolState.shown||this.sceneService.isObjectLoaded(x.id))}static#e=this.\u0275fac=function(z){return new(z||K)(c.rXU(U.il),c.rXU(V.w),c.rXU(C.Ix))};static#t=this.\u0275cmp=c.VBU({type:K,selectors:[["app-tree-nested-node"]],inputs:{graph:[1,"graph"],node:[1,"node"],layerOrderMode:[1,"layerOrderMode"],showTreeNodeIds:[1,"showTreeNodeIds"],showLatinLabel:[1,"showLatinLabel"],nested:[1,"nested"],theme:[1,"theme"]},standalone:!0,features:[c.aNF],decls:17,vars:16,consts:()=>{let x,z,oe;return x=$localize`:6e998fc06a19659c22cca43efa1b35515761cbb25633144232269377096:hide`,z=$localize`:f67337c708d49ce56772539ee443bac996a24f8e1504349909398224884:show`,oe=$localize`:9ca82952a6bc860b5391d5975322d8af8ceddfa43797570084942068182:Select`,[x,z,oe,["data-test","treeNode",1,"tree-node",3,"keyup.enter","click","ngClass"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"buttonTheme"],["tabindex","0","role","button",1,"tree-node__label",3,"ngClass"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"value"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"value"],["app-button","","buttonSize","xs","buttonShape","square","data-test","treeNodeVisible","appEventFence","",1,"tree-node__visible",3,"click","buttonTheme"],["icon","eye","data-test","treeNodeVisibleTrue","size","xs",1,"text-sm","tree-node__eye"],[1,"sr-only","tree-node__eye"],["icon","eye-slash","data-test","treeNodeVisibleFalse","size","xs",1,"text-sm","tree-node__eye-slash"],[1,"sr-only","tree-node__eye-slash"],["eventCategory","Search Node","appEventFence","",3,"theme","node"],["app-button","","appEventFence","","buttonSize","xs","buttonShape","square","data-test","treeNodeExpand",3,"click","buttonTheme"],["appLogicalDir","","icon","caret-right",1,"inline-block","text-sm"],["tabindex","0","role","button",1,"tree-node__label",3,"dblclick","ngClass"],[1,"flex","flex-col"],["data-test","treeNodeId",1,"uppercase","text-2xs",2,"opacity","0.7"],["data-test","treeNodeLabel",1,"flex","items-center"],["icon","ban","data-test","treeNodeUnavailable","size","xs",1,"mr-1","text-xs","tree-node__unavailable"],[1,"sr-only"],[1,"tree-node__latin-label"],["type","text","appEventFence","","appAutoFocus","","data-test","treeNodeEditLabel",1,"input",3,"blur","keyup","value"],["appEventFence","","type","text","data-test","treeNodeLayerOrder",1,"input","input--small","tree-node__layer-order",3,"change","value"]]},template:function(z,oe){1&z&&(c.j41(0,"div",3),c.bIt("keyup.enter",function(ie){return oe.handleNodeClick(ie,oe.node())})("click",function(ie){return oe.handleNodeClick(ie,oe.node())}),c.DNE(1,H,2,5,"button",4)(2,p,9,8,"div",5)(3,D,1,1,"input",6)(4,te,1,1,"input",7),c.j41(5,"button",8),c.bIt("click",function(){return oe.toggleVisibleClick(oe.node())}),c.nrm(6,"app-icon",9),c.j41(7,"span",10),c.qex(8),c.pXf(9,0),c.bVm(),c.EFF(10),c.k0s(),c.nrm(11,"app-icon",11),c.j41(12,"span",12),c.qex(13),c.pXf(14,1),c.bVm(),c.EFF(15),c.k0s()(),c.nrm(16,"app-node-actions",13),c.k0s()),2&z&&(c.Y8G("ngClass",c.ziG(11,B,oe.theme()===oe.themeEnum.Light,!oe.node().boolState.shown,oe.checked(),!oe.node().boolState.pickable)),c.BMQ("data-id",oe.sanitizedID()),c.R7$(),c.vxM(oe.nested()&&oe.hasChildren()?1:-1),c.R7$(),c.vxM(oe.editLabelMode()?-1:2),c.R7$(),c.vxM(oe.editLabelMode()?3:-1),c.R7$(),c.vxM(oe.layerOrderMode()?4:-1),c.R7$(),c.Y8G("buttonTheme",oe.theme()),c.R7$(5),c.SpI(" ",oe.node().label,""),c.R7$(5),c.SpI(" ",oe.node().label,""),c.R7$(),c.Y8G("theme",oe.theme())("node",oe.node()))},dependencies:[L.MD,L.YU,M.h,T.B,w.L,v.e,S.C,A.Q,b.o,R.R,f.G,N.D],styles:[":host{display:block}.tree-node{border-radius:4px;padding:4px;margin-bottom:4px;display:flex;align-items:center;height:100%;-webkit-user-select:none;user-select:none;min-width:200px;transition:background-color .12s}.tree-node--light{padding-right:12px}.tree-node--light:focus{outline:#2472e9 solid 2px!important;outline-offset:-2px;border-radius:4px}.tree-node--light .tree-node__label{color:#0c1726;font-size:.75rem;line-height:1rem}.tree-node--light .tree-node__latin-label{color:#384c6c;font-size:.625rem;line-height:.75rem;text-transform:lowercase;font-style:italic}.tree-node--light.tree-node--selected{background:transparent;border-left-color:transparent}.tree-node--light.tree-node--selected .tree-node__label{color:#0c1726!important}.tree-node--light.tree-node--selected .tree-node__expand,.tree-node--light.tree-node--selected .tree-node__visible{color:#0c1726}.tree-node--light.tree-node--unpickable{border:none}.tree-node--light.tree-node--hidden .tree-node__label,.tree-node--light.tree-node--hidden .tree-node__latin-label{color:#536788}.tree-node--light .tree-node__expand,.tree-node--light .tree-node__visible{background-color:transparent;color:#8999b3;border-radius:4px}.tree-node--selected{background-color:#2472e9}.tree-node--selected .tree-node__label{color:#fff}.tree-node--unpickable{border:1px dashed #536788}.tree-node--hidden .tree-node__expand,.tree-node--hidden .tree-node__visible,.tree-node--hidden .tree-node__label{color:#8999b3}.tree-node--hidden .tree-node__visible{visibility:visible}.tree-node.tree-node--hidden.tree-node--selected .tree-node__expand,.tree-node.tree-node--hidden.tree-node--selected .tree-node__visible,.tree-node.tree-node--hidden.tree-node--selected .tree-node__label{color:#fff}.tree-node__label{font-size:.75rem;line-height:1rem;font-weight:400;line-height:1.3em;color:#d4d9e3;padding:8px 4px 8px 12px;display:flex;align-items:center;flex:1 1 100%;min-height:28px}.tree-node__label--padded{padding-left:36px}.tree-node__expand i{transition:transform .12s}.tree-node__expand--open app-icon{transform:rotate(45deg)}.tree-node .tree-node__expand+.tree-node__label{margin-left:-8px}.tree-node__expand,.tree-node__visible{border-radius:4px;color:#d4d9e3;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center;border:none}.tree-node__layer-order{font-size:10px;flex:0 0 56px;min-height:28px;height:28px;padding:4px;margin:2px;text-align:center}.tree-node .tree-node__unavailable{color:#de5959}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}@media (hover: hover){.tree-node__visible{visibility:hidden}.tree-node:hover,.tree-node:focus-within{cursor:pointer}.tree-node:hover .tree-node__visible,.tree-node:focus-within .tree-node__visible{visibility:visible}.tree-node:hover .tree-node__label,.tree-node:focus-within .tree-node__label{color:#fff}.tree-node--light:hover,.tree-node--light:focus-within{background-color:#0c17260d}.tree-node--light:hover .tree-node__label,.tree-node--light:focus-within .tree-node__label{color:#0c1726}.tree-node--light:hover .tree-node__latin-label,.tree-node--light:focus-within .tree-node__latin-label{color:#384c6c}.tree-node--light.tree-node--selected{background-color:#0c17260d}.tree-node--light.tree-node--selected:hover{background-color:#0c17261a}.tree-node--light.tree-node--selected .tree-node__label{color:#0c1726}.tree-node--light.tree-node--selected .tree-node__expand:hover,.tree-node--light.tree-node--selected .tree-node__visible:hover,.tree-node--light .tree-node__expand:hover,.tree-node--light .tree-node__visible:hover{background-color:transparent;color:inherit}.tree-node__expand:hover,.tree-node__visible:hover{background-color:#142136;color:#fff;cursor:pointer}.tree-node--selected .tree-node__expand:hover,.tree-node--selected .tree-node__visible:hover{background-color:#2472e9}.tree-node .tree-node__eye,.tree-node .tree-node__eye-slash{display:none}.tree-node:hover:not(.tree-node--hidden) .tree-node__eye{display:inline}.tree-node.tree-node--hidden .tree-node__eye-slash{display:inline}}\n"],encapsulation:2,changeDetection:0})}return K})()},30356:(be,q,d)=>{"use strict";d.d(q,{k:()=>w});var c=d(54438),e=d(89079),y=d(87996),l=d(14264),X=d(17365),$=d(90917),j=d(82542),m=d(18272),O=d(47610),V=d(60177),I=d(7806),L=d(60724),M=d(65478),S=d(92014),b=d(18617);function f(v,A){1&v&&(c.j41(0,"div",5),c.pXf(1,0),c.k0s())}function U(v,A){if(1&v&&c.nrm(0,"app-tree",3),2&v){const R=c.XpG();c.Y8G("theme",R.theme())("graph",R.searchGraph())("layerOrderMode",R.layerOrderMode())("showTreeNodeIds",R.showTreeNodeIds())("showLatinLabel",R.showLatinLabel())}}function C(v,A){if(1&v&&(c.j41(0,"div"),c.nrm(1,"app-tree-nested-node",8),c.k0s()),2&v){const R=A.$implicit,N=c.XpG(2);c.R7$(),c.Y8G("theme",N.theme())("nested",!1)("node",R)("graph",N.viewGraph())("layerOrderMode",N.layerOrderMode())("showTreeNodeIds",N.showTreeNodeIds())("showLatinLabel",N.showLatinLabel())}}function T(v,A){if(1&v&&(c.j41(0,"cdk-virtual-scroll-viewport",4)(1,"div",6),c.DNE(2,C,2,7,"div",7),c.k0s()()),2&v){const R=c.XpG();c.Y8G("itemSize",64),c.R7$(2),c.Y8G("cdkVirtualForOf",R.searchResults())("cdkVirtualForTrackBy",R.trackTreeNode)}}let w=(()=>{class v{constructor(R,N){this.store=R,this.liveAnnouncer=N,this.treeSearchDisplayMode=m.q,this.selectedChapter=c.hFB.required(),this.theme=(0,c.hFB)(j.P.Dark),this.query=(0,c.hFB)(),this.displayMode=(0,c.hFB)(m.q.List),this.viewGraph=(0,c.hFB)(),this.viewGraphMetadata=(0,c.hFB)(),this.viewGraphRank=c.hFB.required(),this.layerOrderMode=(0,c.hFB)(),this.showTreeNodeIds=(0,c.hFB)(),this.showLatinLabel=(0,c.hFB)(),this.searchResults=(0,c.EWP)(()=>{const B=this.query().trim(),Q=this.viewGraph(),H=this.displayMode(),Z=this.viewGraphRank();if(H===m.q.Tree)return(0,$.i)(Q,B,[{field:"label",dir:"asc"}]);{const k=(0,$.Z6)(Object.values(Q.nodes),B);return(0,$.XS)(k,Z.initiallyShownRank)}}),this.searchGraph=(0,c.EWP)(()=>{const B=this.viewGraph(),Q=this.searchResults();return(0,$.YL)(B,Q)}),(0,e.br)(this.query).pipe((0,y.B)(600),(0,e.pQ)()).subscribe(()=>{const B=this.searchResults().length;this.liveAnnouncer.announce(`${B} structures found`)}),(0,e.br)(this.displayMode).pipe((0,l.p)(B=>B===m.q.List),(0,X.s)(1),(0,e.pQ)()).subscribe(()=>{this.store.dispatch(new O.q)})}trackTreeNode(R,N){return N.id}static#e=this.\u0275fac=function(N){return new(N||v)(c.rXU(S.il),c.rXU(b.Ai))};static#t=this.\u0275cmp=c.VBU({type:v,selectors:[["app-tree-search"]],inputs:{selectedChapter:[1,"selectedChapter"],theme:[1,"theme"],query:[1,"query"],displayMode:[1,"displayMode"],viewGraph:[1,"viewGraph"],viewGraphMetadata:[1,"viewGraphMetadata"],viewGraphRank:[1,"viewGraphRank"],layerOrderMode:[1,"layerOrderMode"],showTreeNodeIds:[1,"showTreeNodeIds"],showLatinLabel:[1,"showLatinLabel"]},standalone:!0,features:[c.aNF],decls:4,vars:2,consts:()=>{let R;return R=$localize`:e4e28b371f8453e22779db590cb0fe67f2a080e87839102902838664367:No results`,[R,[1,"tree-search"],["class","tree-search__empty",4,"ngIf"],[1,"tree-search__tree",3,"theme","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"],[3,"itemSize"],[1,"tree-search__empty"],[1,"flex","flex-col","flex-auto","gap-1"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"",3,"theme","nested","node","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"]]},template:function(N,B){if(1&N&&(c.j41(0,"div",1),c.DNE(1,f,2,0,"div",2)(2,U,1,5,"app-tree",3)(3,T,3,3,"cdk-virtual-scroll-viewport",4),c.k0s()),2&N){let Q;c.R7$(),c.Y8G("ngIf",0===B.searchResults().length),c.R7$(),c.vxM((Q=B.displayMode())===B.treeSearchDisplayMode.Tree?2:Q===B.treeSearchDisplayMode.List?3:-1)}},dependencies:[V.MD,V.bT,I.g,L.r,M.E9,M.yg,M.E$,M.d6],styles:[".tree-search{display:flex;flex-direction:column;flex:1 1 auto;height:100%}.tree-search__tree{flex-grow:1;width:100%;overflow-y:auto;contain:strict}.tree-search__empty{font-size:.875rem;line-height:1.25rem;padding:12px;font-style:italic;margin-top:12px}.tree-search cdk-virtual-scroll-viewport{flex:1 1 auto}\n"],encapsulation:2,changeDetection:0})}return v})()},90917:(be,q,d)=>{"use strict";d.d(q,{D$:()=>V,XS:()=>I,YL:()=>j,Z6:()=>O,i:()=>m});var c=d(44867),e=d(23881),y=d(49204),X=d(78851);function $(b,f,U){(0,c.iu)(b,f);const C=(0,c.ir)(U,f.id);if(C){const T=b.successors[C]||[];T.push(f.id);const w=U.successors[C];return b.successors[C]=(0,y.uniq)(T).sort((v,A)=>w.indexOf(v)-w.indexOf(A)),b.predecessors[f.id]=C,$(b,(0,c.dV)(U,C),U)}return(0,c.Sg)(b,f),b}function j(b,f){if(0===f.length)return(0,e.q3)();const U=f.reduce((T,w)=>$(T,w,b),(0,e.q3)()),C=Object.keys(b.roots);return U.roots=C.reduce((T,w)=>(w in U.roots&&(T[w]=U.roots[w]),T),{}),U}function m(b,f,U=[]){if((0,y.isEmpty)(b))return[];const T=O(Object.values(b.nodes),f);return U.length>0?V(T,U):T}function O(b,f){return f=(0,X.TF)(f.toLowerCase()),b.filter(U=>{const{label:C,latinLabel:T}=U;if(0===f.length)return!0;const w=(0,X.TF)(C.toLowerCase()??""),v=T?.toLowerCase()??"";return w.includes(f)||v.includes(f)})}function V(b,f){return b.sort((U,C)=>{for(let T=0;T<f.length;T++){const{field:w,dir:v}=f[T];if("label"===w){const A=L(U.label,C.label,"asc"===v);if(0!==A)return A}if("depth"===w){const A=M(U.depth,C.depth,"asc"===v);if(0!==A)return A}if("shown"===w){const A=S(U.boolState.shown,C.boolState.shown,"asc"===v);if(0!==A)return A}}return 0})}function I(b,f){return b.sort((U,C)=>f[U.id]-f[C.id])}function L(b,f,U){return U?b.localeCompare(f):f.localeCompare(b)}function M(b,f,U){const C=Math.sign(b-f);return U?C:-C}function S(b,f,U){const C=Math.sign(Number(f)-Number(b));return U?C:-C}},90556:(be,q,d)=>{"use strict";d.d(q,{f:()=>L});var c=d(60177),e=d(45189),y=d(12854),l=d(60724),X=d(7806),$=d(30356),j=d(89511),m=d(72026),O=d(82192),V=d(11818),I=d(54438);let L=(()=>{class M{static#e=this.\u0275fac=function(f){return new(f||M)};static#t=this.\u0275mod=I.$C({type:M});static#n=this.\u0275inj=I.G2t({imports:[c.MD,m.o,e.G,V.C,O.G,j.h,X.g,y.X,l.r,$.k]})}return M})()},7806:(be,q,d)=>{"use strict";d.d(q,{g:()=>b});var c=d(54438),e=d(14264),y=d(87996),l=d(13409),X=d(82542),$=d(49204),m=d(46842),O=d(44867),V=d(90908),I=d(89079),L=d(60177),M=d(12854),S=d(92014);let b=(()=>{class f{constructor(C){this.store=C,this.graph=c.hFB.required(),this.layerOrderMode=c.hFB.required(),this.showTreeNodeIds=c.hFB.required(),this.showLatinLabel=(0,c.hFB)(),this.theme=(0,c.hFB)(X.P.Dark),this.initNodeScrollListener()}initNodeScrollListener(){this.store.select(l.z.getCheckedNodes).pipe((0,e.p)(C=>1===C.length),(0,y.B)(0),(0,I.pQ)()).subscribe(([C])=>{this.scrollNodeIntoView(C.objectId)})}scrollNodeIntoView(C){const T=(0,O.Nk)(C),w=document.querySelector(`[data-id="${T}"]`);if(!(0,$.isNil)(w)&&(0,V.uK)()){const v=this.store.selectSnapshot(m.U.getPrefersReducedMotion)?"instant":"smooth";w.scrollIntoView({behavior:v,block:"nearest"})}}static#e=this.\u0275fac=function(T){return new(T||f)(c.rXU(S.il))};static#t=this.\u0275cmp=c.VBU({type:f,selectors:[["app-tree"]],inputs:{graph:[1,"graph"],layerOrderMode:[1,"layerOrderMode"],showTreeNodeIds:[1,"showTreeNodeIds"],showLatinLabel:[1,"showLatinLabel"],theme:[1,"theme"]},standalone:!0,features:[c.aNF],decls:1,vars:5,consts:[[3,"theme","graph","layerOrderMode","showTreeNodeIds","showLatinLabel"]],template:function(T,w){1&T&&c.nrm(0,"app-tree-group",0),2&T&&c.Y8G("theme",w.theme())("graph",w.graph())("layerOrderMode",w.layerOrderMode())("showTreeNodeIds",w.showTreeNodeIds())("showLatinLabel",w.showLatinLabel())},dependencies:[L.MD,M.X],changeDetection:0})}return f})()},64218:(be,q,d)=>{"use strict";d.d(q,{H:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},79435:(be,q,d)=>{"use strict";d.d(q,{T:()=>V});var c=d(15877),e=d(45326),y=d(36110),l=d(28577),X=d(39705),$=d(24418),j=d(79083),m=d(54438),O=d(21626);let V=(()=>{class I{constructor(M){this.http=M,this.nodeInfoCache=new Map}queryNodeInfo(M,S,b="en",f=!0){if($.c.offline)return(0,c.of)(void 0);const C=`/search/descriptions?name=${M}&plan=${S===j.H.Wikipedia?"wiki":S}&ol=${b}`,T=C;if(f&&this.nodeInfoCache.has(T)){const w=this.nodeInfoCache.get(T);return(0,c.of)(w)}return this.http.get(C).pipe((0,y.T)(w=>({label:M,latinLabel:w.latin_term,description:w.description,source:w.source,sourceLink:w.url})),(0,l.W)(w=>404===w.status?(0,c.of)(void 0):(0,e.$)(w)),(0,X.M)(w=>this.nodeInfoCache.set(T,w)))}static#e=this.\u0275fac=function(S){return new(S||I)(m.KVO(O.Qq))};static#t=this.\u0275prov=m.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}return I})()},37737:(be,q,d)=>{"use strict";d.d(q,{B:()=>y});var c=d(90908),e=d(54438);let y=(()=>{class l{constructor($){this.el=$}ngAfterContentInit(){(0,c.ZO)()&&setTimeout(()=>{this.el.nativeElement.focus()},0)}static#e=this.\u0275fac=function(j){return new(j||l)(e.rXU(e.aKT))};static#t=this.\u0275dir=e.FsC({type:l,selectors:[["input","appAutoFocus",""]]})}return l})()},89511:(be,q,d)=>{"use strict";d.d(q,{h:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},25780:(be,q,d)=>{"use strict";d.d(q,{L:()=>e});var c=d(54438);let e=(()=>{class y{onClick(X){return X.stopPropagation(),X.stopImmediatePropagation(),X.target instanceof HTMLInputElement&&"checkbox"===X.target.type}onEnter(X){return X.stopPropagation(),X.stopImmediatePropagation(),!1}onPointerdown(X){X.stopPropagation(),X.stopImmediatePropagation()}onMouseDown(X){X.stopPropagation(),X.stopImmediatePropagation()}onMousUp(X){return X.stopPropagation(),X.stopImmediatePropagation(),!1}static#e=this.\u0275fac=function($){return new($||y)};static#t=this.\u0275dir=c.FsC({type:y,selectors:[["","appEventFence",""]],hostBindings:function($,j){1&$&&c.bIt("click",function(O){return j.onClick(O,O.target)})("keydown.enter",function(O){return j.onEnter(O,O.target)})("keyup.enter",function(O){return j.onEnter(O,O.target)})("pointerdown",function(O){return j.onPointerdown(O,O.target)})("mousedown",function(O){return j.onMouseDown(O,O.target)})("mouseup",function(O){return j.onMousUp(O,O.target)})}})}return y})()},59369:(be,q,d)=>{"use strict";d.d(q,{Y:()=>X});var c=d(24418),e=d(90699),y=d(54438),l=d(38645);let X=(()=>{class ${constructor(m,O,V){this.templateRef=m,this.viewContainer=O,this.router=V,this._appFlagApplicationMode="include"}get appFlagApplication(){return this._appFlagApplication}set appFlagApplication(m){this._appFlagApplication=m}get appFlagApplicationMode(){return this._appFlagApplicationMode}set appFlagApplicationMode(m){this._appFlagApplicationMode=m}get appFlagApplicationPage(){return this._appFlagApplicationPage}set appFlagApplicationPage(m){this._appFlagApplicationPage=m}get appFlagApplicationPlatform(){return this._appFlagApplicationPlatform}set appFlagApplicationPlatform(m){this._appFlagApplicationPlatform=m}get appFlagApplicationNative(){return this._appFlagApplicationNative}set appFlagApplicationNative(m){this._appFlagApplicationNative=m}ngOnInit(){this.update()}update(){let m=!1,O=!1,V=!1,I=!1,L=!1;if(""===this.appFlagApplication?O=!0:Array.isArray(this.appFlagApplication)?O=this.appFlagApplication.some(S=>S===c.c.application):"string"==typeof this.appFlagApplication&&(O=this.appFlagApplication===c.c.application),null==this.appFlagApplicationPage)V=!0;else{const S=this.router.url;Array.isArray(this.appFlagApplicationPage)?V=this.appFlagApplicationPage.some(b=>S.indexOf(b)>=0):"string"==typeof this.appFlagApplicationPage&&(V=S.indexOf(this.appFlagApplicationPage)>=0)}if(null==this.appFlagApplicationPlatform)I=!0;else{const S=c.c.platform;Array.isArray(this.appFlagApplicationPlatform)?I=this.appFlagApplicationPlatform.some(b=>S.indexOf(b)>=0):"string"==typeof this.appFlagApplicationPlatform&&(I=S.indexOf(this.appFlagApplicationPlatform)>=0)}null==this.appFlagApplicationNative?L=!0:(L=c.c.native,(Array.isArray(this.appFlagApplicationNative)?this.appFlagApplicationNative:[this.appFlagApplicationNative]).includes(e.I.iOS)&&(L=c.c.native&&void 0!==window.webkit)),m=O&&V&&I&&L,m&&"include"===this.appFlagApplicationMode||!m&&"exclude"===this.appFlagApplicationMode?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}static#e=this.\u0275fac=function(O){return new(O||$)(y.rXU(y.C4Q),y.rXU(y.c1b),y.rXU(l.Ix))};static#t=this.\u0275dir=y.FsC({type:$,selectors:[["","appFlagApplication",""]],inputs:{appFlagApplication:"appFlagApplication",appFlagApplicationMode:"appFlagApplicationMode",appFlagApplicationPage:"appFlagApplicationPage",appFlagApplicationPlatform:"appFlagApplicationPlatform",appFlagApplicationNative:"appFlagApplicationNative"}})}return $})()},49989:(be,q,d)=>{"use strict";d.d(q,{e:()=>y});var c=d(54438),e=d(11040);let y=(()=>{class l{constructor($,j){this.localeId=$,this.el=j}ngOnInit(){"rtl"===(0,e.NS)(this.localeId).direction&&(this.el.nativeElement.style.scale="-1 1")}static#e=this.\u0275fac=function(j){return new(j||l)(c.rXU(c.xe9),c.rXU(c.aKT))};static#t=this.\u0275dir=c.FsC({type:l,selectors:[["","appLogicalDir",""]]})}return l})()},41775:(be,q,d)=>{"use strict";d.d(q,{I:()=>X});var c=d(24418),e=d(27180),y=d(54438),l=d(38645);let X=(()=>{class ${constructor(m){this.router=m}redirectToErrorPage(m,O,V){(this.router.url||"").match("/error")||this.router.navigateByUrl(c.c.application===e.c.Viewer?"/error":"/view/error",{skipLocationChange:!0,state:{errorType:m,errorCode:O,error:V,errorUrl:this.router.url}})}static#e=this.\u0275fac=function(O){return new(O||$)(y.KVO(l.Ix))};static#t=this.\u0275prov=y.jDH({token:$,factory:$.\u0275fac,providedIn:"root"})}return $})()},85884:(be,q,d)=>{"use strict";d.d(q,{Y:()=>c});var c=function(e){return e.Content="content",e.Engine="engine",e}(c||{})},66432:(be,q,d)=>{"use strict";d.d(q,{QU:()=>$,e7:()=>m});var c=d(49204),e=d(30234),y=d(74394);const l=[{title:"zSpace Models",id:e.a.Zspace,type:"Category",icon:"zspace"}],X={main:[{title:"All Models",id:"all",type:"Category",icon:"all-models",tabTags:y.Ht,translations:{es:{title:"Todas las Categor\xedas"},zh:{title:"\u6240\u6709\u7c7b\u522b"},fr:{title:"Toutes les cat\xe9gories"},de:{title:"Alle Kategorien"},it:{title:"Tutte le categorie"},ja:{title:"\u3059\u3079\u3066\u306e\u30ab\u30c6\u30b4\u30ea"},pt:{title:"Todas as categorias"}}}],categories:[{title:"Anatomy by Region",id:"regional",type:"Category",icon:"anatomy-by-regions",tabTags:y.iE,translations:{es:{title:"Anatom\xeda regional"},zh:{title:"\u5c40\u90e8\u89e3\u5256"},fr:{title:"Anatomie r\xe9gionale"},de:{title:"Regionale Anatomie"},it:{title:"Anatomia regionale"},ja:{title:"\u5404\u90e8\u4f4d\u306e\u69cb\u9020"},pt:{title:"Anatomia Regional"}}},{title:"Anatomy by System",id:"system",type:"Category",icon:"anatomy-by-systems",tabTags:y.L7,translations:{es:{title:"Anatom\xeda sistem\xe1tica"},zh:{title:"\u7cfb\u7edf\u89e3\u5256"},fr:{title:"Anatomie du syst\xe8me"},de:{title:"Systematische Anatomie"},it:{title:"Anatomia sistemica"},ja:{title:"\u5404\u5668\u5b98\u7cfb\u306e\u69cb\u9020"},pt:{title:"Anatomia do Sistema"}}},{title:"Complete Anatomy",id:"complete anatomy",type:"Category",icon:"complete-anatomy",translations:{de:{title:"Vollst\xe4ndige Anatomie"},es:{title:"Anatom\xeda completa"},fr:{title:"Anatomie compl\xe8te"},it:{title:"Anatomia completa"},ja:{title:"\u4eba\u4f53\u306e\u5168\u4f53\u69cb\u9020"},pt:{title:"Anatomia Completa"},zh:{title:"\u5b8c\u6574\u89e3\u5256"}}},{title:"Bony Landmarks, Origins, and Insertions",id:"Bony Landmarks, Origins, and Insertions",type:"Category",icon:"bony-landmarks",tabTags:y.L7,translations:{de:{title:"Kn\xf6cherne Orientierungspunkte, Urspr\xfcnge und Ans\xe4tze"},es:{title:"Puntos de referencia \xf3seos, or\xedgenes e inserciones"},fr:{title:"Rep\xe8res osseux, origines et insertions"},it:{title:"Punti di repere ossei, origini e inserzioni"},ja:{title:"\u9aa8\u306e\u30e9\u30f3\u30c9\u30de\u30fc\u30af, \u8d77\u59cb\u30fb\u505c\u6b62"},pt:{title:"Marcos \xd3sseos, Origens e Inser\xe7\xf5es"},zh:{title:"\u9aa8\u6027\u6807\u5fd7\u3001\u8d77\u6e90\u4e0e\u63d2\u5165"}}},{title:"Cross Sections and Microanatomy",id:"Cross Sections and Microanatomy",type:"Category",icon:"cross-sections-and-micro-anatomy",translations:{de:{title:"Querschnitte und mikroskopische Anatomie"},es:{title:"Cortes transversales y microanatom\xeda"},fr:{title:"Coupes transversales et micro anatomie"},it:{title:"Sezioni trasversali e anatomia microscopica"},ja:{title:"\u65ad\u9762\u56f3\u30fb\u30de\u30a4\u30af\u30ed\u89e3\u5256\u5b66"},pt:{title:"Sec\xe7\xf5es Transversais e Microanatomia"},zh:{title:"\u6a2a\u65ad\u9762&\u663e\u5fae\u89e3\u5256"}}},{title:"Anatomy Quizzes",id:"quiz",type:"Category",icon:"quizzes-and-assessments",tabTags:y.iE,translations:{de:{title:"Anatomie Quizfragen"},es:{title:"Pruebas de anatom\xeda"},fr:{title:"Quizz d'anatomie"},it:{title:"Domande di anatomia"},ja:{title:"\u89e3\u5256\u5b66\u30af\u30a4\u30ba"},pt:{title:"Question\xe1rios de Anatomia"},zh:{title:"\u89e3\u5256\u5b66\u6d4b\u9a8c"}}}],specialties:[{title:"Allergy and Immunology",id:"Allergy and Immunology",type:"Category",icon:"allergy-and-immunology",tabTags:y.Ht,translations:{de:{title:"Allergie und Immunologie"},es:{title:"Alergia e inmunolog\xeda"},fr:{title:"Allergie et immunologie"},it:{title:"Allergologia e immunologia"},ja:{title:"\u30a2\u30ec\u30eb\u30ae\u30fc\u3068\u514d\u75ab\u5b66"},pt:{title:"Alergia e Imunologia"},zh:{title:"\u8fc7\u654f\u4e0e\u514d\u75ab\u5b66"}}},{title:"Cardiology",id:"Cardiology",type:"Category",icon:"cardiology",tabTags:y.Ht,translations:{de:{title:"Kardiologie"},es:{title:"Cardiolog\xeda"},fr:{title:"Cardiologie"},it:{title:"Cardiologia"},ja:{title:"\u5fc3\u81d3\u75c5\u5b66"},pt:{title:"Cardiologia"},zh:{title:"\u5fc3\u810f\u79d1"}}},{title:"Dentistry",id:"Dentistry",type:"Category",icon:"dentistry",tabTags:y.Ht,translations:{de:{title:"Zahnmedizin"},es:{title:"Odontolog\xeda"},fr:{title:"Dentisterie"},it:{title:"Odontoiatria"},ja:{title:"\u6b6f\u5b66"},pt:{title:"Odontologia"},zh:{title:"\u7259\u79d1"}}},{title:"Dermatology",id:"Dermatology",type:"Category",icon:"dermatology",tabTags:y.Ht,translations:{de:{title:"Dermatologie"},es:{title:"Dermatolog\xeda"},fr:{title:"Dermatologie"},it:{title:"Dermatologia"},ja:{title:"\u76ae\u819a\u5b66"},pt:{title:"Dermatologia"},zh:{title:"\u76ae\u80a4\u79d1"}}},{title:"Ear, Nose, and Throat",id:"Ear, Nose, and Throat",type:"Category",icon:"otolarygngology",tabTags:y.Ht,translations:{de:{title:"Otolaryngologie"},es:{title:"Otorrinolaringolog\xeda"},fr:{title:"Otorhinolaryngologie"},it:{title:"Otorinolaringoiatria"},ja:{title:"\u8033\u9f3b\u79d1\u5b66"},pt:{title:"Otorrinolaringologia"},zh:{title:"\u8033\u9f3b\u5589\u79d1"}}},{title:"Endocrinology",id:"Endocrinology",type:"Category",icon:"endocrinology",tabTags:y.Ht,translations:{de:{title:"Endokrinologie"},es:{title:"Endocrinolog\xeda"},fr:{title:"Endocrinologie"},it:{title:"Endocrinologia"},ja:{title:"\u5185\u5206\u6ccc\u5b66"},pt:{title:"Endocrinologia"},zh:{title:"\u5185\u5206\u6ccc\u79d1"}}},{title:"Gastroenterology",id:"Gastroenterology and Hepatology",type:"Category",icon:"gastroenterology",tabTags:y.Ht,translations:{de:{title:"Gastroenterologie"},es:{title:"Gastroenterolog\xeda"},fr:{title:"Gastroent\xe9rologie"},it:{title:"Gastroenterologia"},ja:{title:"\u80c3\u8178\u5b66"},pt:{title:"Gastroenterologia"},zh:{title:"\u80c3\u80a0\u75c5\u5b66"}}},{title:"Gynecology",id:"Gynecology",type:"Category",icon:"gynecology",tabTags:y.Ht,translations:{de:{title:"Gyn\xe4kologie"},es:{title:"Ginecolog\xeda"},fr:{title:"Gyn\xe9cologie"},it:{title:"Ginecologia"},ja:{title:"\u5a66\u4eba\u79d1\u5b66"},pt:{title:"Ginecologia"},zh:{title:"\u5987\u79d1"}}},{title:"Hematology",id:"Hematology",type:"Category",icon:"hematology",tabTags:y.Ht,translations:{de:{title:"H\xe4matologie"},es:{title:"Hematolog\xeda"},fr:{title:"H\xe9matologie"},it:{title:"Ematologia"},ja:{title:"\u8840\u6db2\u5b66"},pt:{title:"Hematologia"},zh:{title:"\u8840\u6db2\u79d1"}}},{title:"Infectious Disease",id:"Infectious Disease",type:"Category",icon:"infectious-disease",tabTags:y.Ht,translations:{de:{title:"Infektionskrankheit"},es:{title:"Enfermedades infecciosas"},fr:{title:"Maladies infectieuses"},it:{title:"Malattie infettive"},ja:{title:"\u611f\u67d3\u75c7"},pt:{title:"Doen\xe7a Infecciosa"},zh:{title:"\u4f20\u67d3\u75c5"}}},{title:"Neurology and Psychiatry",id:"Neurology and Psychiatry",type:"Category",icon:"neurology-and-psychiatry",tabTags:y.Ht,translations:{de:{title:"Neurologie und Psychiatrie"},es:{title:"Neurolog\xeda y psiquiatr\xeda"},fr:{title:"Neurologie et psychiatrie"},it:{title:"Neurologia e psichiatria"},ja:{title:"\u795e\u7d4c\u5b66\u30fb\u7cbe\u795e\u533b\u5b66"},pt:{title:"Neurologia e Psiquiatria"},zh:{title:"\u795e\u7ecf\u79d1&\u7cbe\u795e\u79d1"}}},{title:"Obstetrics",id:"Obstetrics",type:"Category",icon:"obstetrics",tabTags:y.NB,translations:{de:{title:"Geburtshilfe"},es:{title:"Obstetricia "},fr:{title:"Obst\xe9trique"},it:{title:"Ostetricia"},ja:{title:"\u7523\u79d1\u5b66"},pt:{title:"Obstetr\xedcia"},zh:{title:"\u4ea7\u79d1"}}},{title:"Oncology",id:"Oncology",type:"Category",icon:"oncology",tabTags:y.Ht,translations:{de:{title:"Onkologie"},es:{title:"Oncolog\xeda"},fr:{title:"Oncologie"},it:{title:"Oncologia"},ja:{title:"\u816b\u760d\u5b66"},pt:{title:"Oncologia"},zh:{title:"\u80bf\u7624\u79d1"}}},{title:"Ophthalmology",id:"Ophthalmology",type:"Category",icon:"ophtalmology",tabTags:y.Ht,translations:{de:{title:"Ophthalmologie"},es:{title:"Oftalmolog\xeda"},fr:{title:"Ophtalmologie"},it:{title:"Oftalmologia"},ja:{title:"\u773c\u79d1\u5b66"},pt:{title:"Oftalmologia"},zh:{title:"\u773c\u79d1"}}},{title:"Orthopedics and Rheumatology",id:"Orthopedics and Rheumatology",type:"Category",icon:"orthopedics",tabTags:y.Ht,translations:{de:{title:"Orthop\xe4die"},es:{title:"Ortopedia"},fr:{title:"Orthop\xe9die"},it:{title:"Ortopedia"},ja:{title:"\u6574\u5f62\u5916\u79d1\u5b66"},pt:{title:"Ortopedia"},zh:{title:"\u9aa8\u79d1"}}},{title:"Pediatrics",id:"Pediatrics",type:"Category",icon:"pediatrics",tabTags:y.Ht,translations:{de:{title:"P\xe4diatrie"},es:{title:"Pediatr\xeda"},fr:{title:"P\xe9diatrie"},it:{title:"Pediatria"},ja:{title:"\u5c0f\u5150\u79d1\u5b66"},pt:{title:"Pediatria"},zh:{title:"\u513f\u79d1"}}},{title:"Physical Therapy",id:"Physical Therapy",type:"Category",icon:"physical-therapy",tabTags:y.Ht,translations:{de:{title:"Physiotherapie"},es:{title:"Fisioterapia"},fr:{title:"Kin\xe9sith\xe9rapie"},it:{title:"Fisioterapia"},ja:{title:"\u7406\u5b66\u7642\u6cd5"},pt:{title:"Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597"}}},{title:"Primary Care",id:"Primary Care",type:"Category",icon:"primary-care",tabTags:y.Ht,translations:{de:{title:"Prim\xe4rversorgung"},es:{title:"Atenci\xf3n primaria"},fr:{title:"Soins de sant\xe9 primaires"},it:{title:"Assistenza sanitaria di base"},ja:{title:"\u30d7\u30e9\u30a4\u30de\u30ea\u30fc\u30b1\u30a2"},pt:{title:"Aten\xe7\xe3o Prim\xe1ria"},zh:{title:"\u521d\u7ea7\u536b\u751f\u4fdd\u5065"}}},{title:"Pulmonology",id:"Pulmonology and Respiratory",type:"Category",icon:"pulmonology",tabTags:y.Ht,translations:{de:{title:"Pulmonologie"},es:{title:"Neumolog\xeda"},fr:{title:"Pneumologie"},it:{title:"Pneumologia"},ja:{title:"\u547c\u5438\u5668\u5b66"},pt:{title:"Pneumologia"},zh:{title:"\u80ba\u75c5\u79d1"}}},{title:"Urology and Nephrology",id:"Urology and Nephrology",type:"Category",icon:"urology",tabTags:y.Ht,translations:{de:{title:"Urologie"},es:{title:"Urolog\xeda"},fr:{title:"Urologie"},it:{title:"Urologia"},ja:{title:"\u6ccc\u5c3f\u5668\u79d1\u5b66"},pt:{title:"Urologia"},zh:{title:"\u6ccc\u5c3f\u5916\u79d1"}}}],community:[{title:"Community Content",id:"public",type:"Community",icon:"community-bookmarks",translations:{de:{title:"Community-Inhalte"},es:{title:"Contenido de la comunidad"},fr:{title:"Contenu communautaire"},it:{title:"Contenuto della comunit\xe0"},ja:{title:"\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30b3\u30f3\u30c6\u30f3\u30c4"},pt:{title:"Conte\xfado da Domunidade"},zh:{title:"\u793e\u533a\u5185\u5bb9"}}}],"expert collections":[{id:"Anatomy for Physical Therapy Students",featured:!0,type:"Category",title:"Anatomy for Physical Therapy Students",subtitle:"Created with Kirsten C Moisio PT, PhD",metadata:"Professor of Physical Therapy",image:"/assets/images/expert-collections/physical-therapy.png",featuredIcon:"/assets/images/logos/northwestern-medicine-logo.svg",outerColor:"#28167E",innerColor:"#5B49B6",translations:{de:{title:"Anatomie f\xfcr Studierende der Physiotherapie",subtitle:"Erstellt mit Kirsten C Moisio PT, PhD",metadata:"Professor f\xfcr Physikalische Therapie"},es:{title:"Anatom\xeda para estudiantes de fisioterapia",subtitle:"Creado con Kirsten C Moisio PT, PhD",metadata:"Profesor de Fisioterapia"},fr:{title:"Anatomie pour \xe9tudiants en physioth\xe9rapie",subtitle:"Cr\xe9\xe9 avec Kirsten C Moisio PT, PhD",metadata:"Professeur de kin\xe9sith\xe9rapie"},it:{title:"Anatomia per studenti di terapia fisica",subtitle:"Creato con Kirsten C Moisio PT, PhD",metadata:"Professore di terapia fisica"},ja:{title:"\u7406\u5b66\u7642\u6cd5\u5b66\u751f\u306e\u305f\u3081\u306e\u89e3\u5256\u5b66",subtitle:"Kirsten C Moisio PT, PhD\u3068\u5171\u540c\u3067\u4f5c\u6210",metadata:"\u7406\u5b66\u7642\u6cd5\u5b66\u6559\u6388"},pt:{title:"Anatomia para estudantes de fisioterapia",subtitle:"Criado com Kirsten C Moisio PT, PhD",metadata:"Professor de Fisioterapia"},zh:{title:"\u7269\u7406\u6cbb\u7597\u5b66\u751f\u7684\u89e3\u5256\u5b66",subtitle:"\u7531 Kirsten C Moisio PT \u535a\u58eb\u521b\u4f5c",metadata:"\u7269\u7406\u7597\u6cd5\u6559\u6388"}}},{id:"Anatomy for Medical Students",featured:!0,type:"Category",tabTags:y.iE,title:"Anatomy for Medical Students",subtitle:"Created with Jonathan J Wisco, PhD",metadata:"Associate Professor of Anatomy & Neurobiology",image:"/assets/images/expert-collections/medical.png",featuredIcon:"/assets/images/logos/bu-logo.svg",outerColor:"#242629",innerColor:"#585D64",translations:{de:{title:"Anatomie f\xfcr Medizinstudenten",subtitle:"Erstellt mit Jonathan J Wisco, PhD",metadata:"Assoziierter Professor f\xfcr Anatomie und Neurobiologie"},es:{title:"Anatom\xeda para estudiantes de medicina",subtitle:"Creado con Jonathan J Wisco, PhD",metadata:"Profesor asociado de anatom\xeda y neurobiolog\xeda"},fr:{title:"Anatomie pour les \xe9tudiants en m\xe9decine",subtitle:"Cr\xe9\xe9 avec Jonathan J Wisco, PhD",metadata:"Professeur associ\xe9 d'anatomie et de neurobiologie"},it:{title:"Anatomia per studenti di medicina",subtitle:"Creato con Jonathan J Wisco, PhD",metadata:"Professore associato di Anatomia e Neurobiologia"},ja:{title:"\u533b\u5b66\u751f\u306e\u305f\u3081\u306e\u89e3\u5256\u5b66",subtitle:"\u30b8\u30e7\u30ca\u30b5\u30f3\u30fbJ\u30fb\u30a6\u30a3\u30b9\u30b3\u535a\u58eb\u3068\u5171\u540c\u3067\u4f5c\u6210",metadata:"\u89e3\u5256\u5b66\u304a\u3088\u3073\u795e\u7d4c\u751f\u7269\u5b66\u306e\u51c6\u6559\u6388"},pt:{title:"Anatomia para estudantes de medicina",subtitle:"Criado com Jonathan J Wisco, PhD",metadata:"Professor Associado de Anatomia e Neurobiologia"},zh:{title:"\u533b\u5b66\u751f\u89e3\u5256\u5b66",subtitle:"\u7531 Jonathan J Wisco \u535a\u58eb\u521b\u4f5c",metadata:"\u89e3\u5256\u5b66\u548c\u795e\u7ecf\u751f\u7269\u5b66\u526f\u6559\u6388"}}}]};function $(S){return[...L(X.main,S),...L(X.categories,S),...L(l,S),...L(X.specialties,S),...L(X.community,S),...L(X["expert collections"],S)]}function m(S,b){return L(X[S],b)}function L(S,b){return S.map(f=>function M(S,b){const f=(0,c.cloneDeep)(S);return b&&(f.title=(0,c.get)(f,`translations.${b}.title`,f.title),f.subtitle&&(f.subtitle=(0,c.get)(f,`translations.${b}.subtitle`,f.subtitle)),f.metadata&&(f.metadata=(0,c.get)(f,`translations.${b}.metadata`,f.metadata))),f}(f,b))}},70914:(be,q,d)=>{"use strict";d.d(q,{V:()=>l});var c=d(60177),e=d(54438),y=d(35286);let l=(()=>{class X{constructor(){this.markdownText=e.hFB.required()}static#e=this.\u0275fac=function(m){return new(m||X)};static#t=this.\u0275cmp=e.VBU({type:X,selectors:[["app-html"]],inputs:{markdownText:[1,"markdownText"]},standalone:!0,features:[e.aNF],decls:3,vars:5,consts:[[1,"html",3,"innerHTML"]],template:function(m,O){1&m&&(e.nrm(0,"div",0),e.nI1(1,"markdown"),e.nI1(2,"async")),2&m&&e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,O.markdownText())),e.npT)},dependencies:[c.Jj,y.y2,y.i0],encapsulation:2,changeDetection:0})}return X})()},11789:(be,q,d)=>{"use strict";var c;d.d(q,{T:()=>c}),function(e){const l=/(\s*[\d\.]+\s*,){2,15}\s*[\d\.]+\s*/g,X=/^#(?:[\da-f]{3}){1,2}$|^#(?:[\da-f]{4}){1,2}$|(rgb|hsl)a?\((\s*-?\d+%?\s*,){2}(\s*-?\d+%?\s*)\)|(rgb|hsl)a?\((\s*-?\d+%?\s*,){3}\s*(0|(0?\.\d+)|1)\)/gim;function m(N){for(let B=0;B<3;B++)if(parseFloat(`${N[B]}`)>1)return!0;return!1}function V(N){const B=document.createElement("div");B.style.backgroundColor=N,document.documentElement.appendChild(B);const Q=window.getComputedStyle(B).backgroundColor.replace(/\s/g,"");return window.document.documentElement.removeChild(B),Q}function I(N){const B=N.slice(0,4);3===B.length&&B.push(1);for(let Q=0;Q<4;Q++)B[Q]=parseFloat(`${B[Q]}`),B[Q]<0&&(B[Q]=0),B[Q]>255&&(B[Q]=255);return B[3]>1&&(B[3]=1),B}function L(N){let B;if(Array.isArray(N))B=I(N);else if("string"==typeof N){let Q=N.match(l);Q?B=I(Q[0].split(",")):(Q=V(N).match(l),Q&&(B=I(Q[0].split(","))))}return B}function M(N){const B=L(N);if(!B)throw new TypeError("Invalid color input.");const Q=b(B);return{1:m(B)?Q:B,255:m(B)?B:Q}}function b(N){const B=m(N),Q=[];for(let H=0;H<3;H++){let Z=B?N[H]/255:255*N[H];Z=B?Math.round(100*Z)/100:Math.round(Z),Q.push(Z)}return 4===N.length&&Q.push(N[3]),Q}function f(N,B=!1){N=N.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(p,D,te,E)=>[D,D,te,te,E,E].join("")).replace(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,(p,D,te,E)=>[D,te,E,"ff"].join(""));const Q=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(N),H=parseInt(Q[1],16),Z=parseInt(Q[2],16),k=parseInt(Q[3],16),h=parseInt(Q[4],16)/255;if(B){const p=v([H,Z,k]);return[p[0],p[1],p[2],h]}return[H,Z,k,h]}function T(N){const[B,Q,H]=N;return Math.sqrt(B*B*.299+Q*Q*.587+H*H*.114)}function v(N){return N.map(Q=>Q/255)}function A(N){return N.map(Q=>Math.round(255*Q))}function R(N){return`#${N.map(Q=>{const H=Q.toString(16);return H.length%2?`0${H}`:H}).join("")}`}e.isCSSColor=function j(N){return N.match(X)?.length>0},e.is255=m,e.isLight=function O(N,B){return B||(B=[...N]),(T(N)+T(B))/2>140.25},e.getComputedColor=V,e.convertChannels=I,e.convert=L,e.getColor=M,e.getColors=function S(N){let B=[];if("string"==typeof N){const Q=N.match(l);Q&&(N=Q.join(",")),N=N.split(",")}if(Array.isArray(N))if(Array.isArray(N[0])&&Array.isArray(N[1]))B=N;else if(N.length<=2)B=1===N.length?N.concat(N):N;else{const H=Math.floor(N.length/2);B=N.length>4?[N.slice(0,H),N.slice(H)]:[N,N]}return B.map(Q=>M(Q))},e.scaleColor=b,e.hexToRgba=f,e.hexToRgb=function U(N,B=!1){const Q=f(N,B);return[Q[0],Q[1],Q[2]]},e.rgbToHex=function C(N,B=!1){return R(B?A(N):N)},e.rgbToHSP=T,e.rgbaToHex=function w(N,B=!1){const Q=N[0],H=N[1],Z=N[2],k=255*N[3];return R(B?[...A([Q,H,Z]),k]:[Q,H,Z,k])},e.rgbToDecimal=v,e.rgbFromDecimal=A}(c||(c={}))},3287:(be,q,d)=>{"use strict";d.d(q,{H:()=>y});var c=d(2573),e=d(74902);function y(l,X,$=!0){const j=new e.F,m=[];return $&&m.push(X.map(O=>O.label)),l.forEach(O=>{const V=X.map(I=>O[I.field]);m.push(V)}),new c.c(O=>{const V=j.unparse(m,{quotes:!0,header:!1});O.next(V),O.complete()})}},42482:(be,q,d)=>{"use strict";d.d(q,{X:()=>O});var O,c=d(28407),e=d(15877),y=d(2573),l=d(37678),$=d(67092),j=d(68947),m=d(7662);!function(V){function b(){return(b=(0,c.A)(function*(v,A=!1){return(0,m.mo)(v,{pixelRatio:1,skipFonts:!0,...A?{backgroundColor:"transparent"}:{}})})).apply(this,arguments)}V.exportImage=function I(v,A,R,N){const B="string"==typeof v?V.base64ToBlob(v,A):v;return N?(0,$.r)(B,N).then(function(Q){(0,l.saveAs)(Q,R)}):(0,l.saveAs)(B,R),(0,e.of)(!0)},V.canvasToBlob=function L(v,A,R){return new y.c(N=>{v.toBlob(B=>{N.next(B),N.complete()},A,R)})},V.fitCanvas=function M(v,A,R){const N=document.createElement("canvas");N.width=A,N.height=R;const B=N.getContext("2d"),k=Math.max(.5*(v.width-N.width/N.height*v.height),0);return B.drawImage(v,k,0,N.width,N.height),N},V.elementToCanvas=function S(v){return b.apply(this,arguments)},V.combineCanvasElements=function f(v){const A=Math.max(0,...v.map(Q=>Q.width)),R=Math.max(0,...v.map(Q=>Q.height)),N=document.createElement("canvas");N.width=A,N.height=R;const B=N.getContext("2d");return v.forEach(Q=>{B.drawImage(Q,0,0)}),N},V.base64ToBlob=function U(v,A){const R=atob(v.split(",")[1]),N=new ArrayBuffer(R.length),B=new Uint8Array(N);for(let Q=0;Q<R.length;Q++)B[Q]=R.charCodeAt(Q);return new Blob([N],{type:A})},V.blobToBase64=function C(v){return new y.c(A=>{const R=new FileReader;R.addEventListener("load",()=>{A.next(R.result),A.complete()}),R.readAsDataURL(v)})},V.blobToCanvas=function T(v,A,R){return new y.c(N=>{const B=document.createElement("canvas");B.width=A,B.height=R;const Q=B.getContext("2d"),H=new Image,Z=URL.createObjectURL(v);H.addEventListener("load",()=>{Q.drawImage(H,0,0),URL.revokeObjectURL(Z),N.next(B),N.complete()}),H.src=Z})},V.createModelFileName=function w(v,A,R,N){let B=v||A||"";return v&&A&&v!==A&&(B=`${v}_${A}`),`${j.l.normalize(B).replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}${N?`_${N}`:""}.${R.replace(".","")}`}}(O||(O={}))},46889:(be,q,d)=>{"use strict";d.d(q,{A1:()=>y,E8:()=>e,dL:()=>l,nv:()=>$,vT:()=>X});var c=d(38472);function e(j,m){const O=c.create();return c.sub(O,m,j),c.length(O)}function y(j,m){const O=c.create();return c.add(O,m,j),c.scale(O,O,.5),O}function l(j,m,O,V,I,L){const M=(j-m)/(O-m);return(L=L??c.create())[0]=V[0]+M*(I[0]-V[0]),L[1]=V[1]+M*(I[1]-V[1]),L[2]=V[2]+M*(I[2]-V[2]),L}function X(j,m,O){const V=j*j;return m+O*(-1*V*V+V*j*4+-6*V+4*j)}function $(j){return j*(180/Math.PI)}},68947:(be,q,d)=>{"use strict";d.d(q,{l:()=>l});var l,c=d(28407),e=d(49204);!function(X){function L(){return(L=(0,c.A)(function*(b,f,U,C=!1){return M(b,yield f.parse(U),C)})).apply(this,arguments)}function M(b,f,U=!1){const C=b.createElement("div");return b.setProperty(C,"innerHTML",f),U&&C.querySelectorAll("p").forEach(w=>{b.setProperty(w,"textContent",w.textContent+" ")}),(0,e.trim)(C.textContent)}X.normalize=function $(b){return`${b||""}`.replace(/&#(\d+);/g,(U,C)=>String.fromCharCode(C)).replace(/(&.+;)/gi,(U,C)=>String.fromCharCode(U.charCodeAt(0)))},X.prettyPrint=function j(b){return`${b||""}`.trim().replace(/([A-Z])/g," $1").replace(/^./,U=>U.toUpperCase()).trim()},X.parseEmails=function m(b){return b.split(/[,\r\n]/).map(f=>f.trim()).filter(f=>!!f)},X.validateEmail=function O(b){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(b)},X.toTitleCase=function V(b){return b.replace(/\w\S*/g,f=>f.charAt(0).toUpperCase()+f.substring(1).toLowerCase())},X.getPlainTextFromMarkdown=function I(b,f,U){return L.apply(this,arguments)},X.getPlainTextFromHTML=M,X.splitTextByCharacterCount=function S(b,f){for(var U=[];b.length>f;){var C=b.substring(0,f).lastIndexOf(" ");U.push(b.substring(0,C=C<=0?f:C));var T=b.indexOf(" ",C)+1;(T<C||T>C+f)&&(T=C),b=b.substring(T)}return U.push(b),U}}(l||(l={}))},9592:(be,q,d)=>{"use strict";d.d(q,{H:()=>c});var c=function(y){return y.JPEG="image/jpeg",y.PNG="image/png",y}(c||{})},82542:(be,q,d)=>{"use strict";d.d(q,{P:()=>c});var c=function(e){return e.Dark="dark",e.Light="light",e}(c||{})},18272:(be,q,d)=>{"use strict";d.d(q,{q:()=>c});var c=function(e){return e[e.List=0]="List",e[e.Tree=1]="Tree",e}(c||{})},13491:(be,q,d)=>{"use strict";d.d(q,{n:()=>c});class c{static toArray(y){return[y.x,y.y,y.z]}static fromArray(y){return{x:y[0],y:y[1],z:y[2]}}}},81642:(be,q,d)=>{"use strict";d.d(q,{D:()=>e});var c=d(54438);let e=(()=>{class y{constructor(){}roundModel(X,$){const j={...X};return Object.keys(X).filter(m=>"number"==typeof X[m]).forEach(m=>{j[m]=this.roundNumber(X[m],$)}),j}roundNumber(X,$){return Math.round(X*Math.pow(10,$))/Math.pow(10,$)}static#e=this.\u0275fac=function($){return new($||y)};static#t=this.\u0275prov=c.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},86544:(be,q,d)=>{"use strict";d.d(q,{R:()=>y});var y,c=d(59429);!function(l){function X(j){return j.split("-")[0].replace(/_particle$/,"")}l.getParticleIdRoot=X,l.generateParticleId=function $(j,m=c.u.getUuid){return`${X(j)}-${m()}`}}(y||(y={}))},6049:(be,q,d)=>{"use strict";d.d(q,{Y:()=>y});var c=d(60177),e=d(54438);let y=(()=>{class l{static#e=this.\u0275fac=function(j){return new(j||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[c.MD]})}return l})()},35056:(be,q,d)=>{"use strict";d.d(q,{G:()=>ge});var c=d(60177),e=d(11562),y=d(78696),l=d(45189),X=d(89417),$=d(54438);let j=(()=>{class ie{static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[c.MD,X.YN]})}return ie})();class m{}var O=d(49204),V=d(27153);let L=(()=>{class ie{constructor(W){if(!W.accountUrl)throw new Error("Missing accountUrl. Please set in app config via ZendeskWidgetProvider");this.window=function I(){return window}();let Ee=this.window;Ee.zEmbed||function(){var se,pe,Te,Qe,tt=[],Ue=document.createElement("iframe");Ee.zEmbed=function(){tt.push(arguments)},Ee.zE=Ee.zE||Ee.zEmbed,Ue.src="javascript:false",Ue.title="",Ue.style.cssText="display: none",(Te=(Te=document.getElementsByTagName("script"))[Te.length-1]).parentNode.insertBefore(Ue,Te),Qe=Ue.contentWindow.document;try{pe=Qe}catch{se=document.domain,Ue.src='javascript:var d=document.open();d.domain="'+se+'";void(0);',pe=Qe}pe.open()._l=function(){var yt=this.createElement("script");se&&(this.domain=se),yt.id="js-iframe-async",yt.src="https://assets.zendesk.com/embeddable_framework/main.js",this.t=+new Date,this.zendeskHost=W.accountUrl,this.zEQueue=tt,this.body.appendChild(yt)},pe.write('<body onload="document._l();">'),pe.close()}(),this.window.zE(()=>{W.beforePageLoad(this.window.zE)})}setLocale(W){this.window.zE(()=>{this.window.zE.setLocale(W)})}identify(W){this.window.zE(()=>{(0,O.isNil)(W)?this.window.zE("webWidget","clear"):this.window.zE.identify({name:this.getUserFullName(W),email:W.email})})}hide(){this.window.zE(()=>{this.window.zE.hide()})}show(){this.window.zE(()=>{this.window.zE.show()})}activate(W){this.window.zE(()=>{this.window.zE.activate(W)})}showWidget(W="help"){this.hide(),this.setSettings({webWidget:{helpCenter:{suppress:"contact"===W}}}),this.activate({hideOnClose:!0})}setHelpCenterSuggestions(W){this.window.zE(()=>{this.window.zE.setHelpCenterSuggestions(W)})}setSettings(W){this.window.zE(()=>{this.window.zE("webWidget","updateSettings",W)})}updateFromProfile(W){const Ee=[];if(null!=W){const{premium_account:Se,premium_account_type:se,developer_account:pe,subscription:Te}=W;Se?(Ee.push(`premium_account_${se}`),Te&&Ee.push(`subscription_${Te.subscription_provider}`)):Ee.push("free_account"),pe&&Ee.push("developer_account")}const re=(0,V.E)(W);this.setSettings({webWidget:{position:{horizontal:"right",vertical:"bottom"},offset:{horizontal:"0px",vertical:"0px"},contactForm:{suppress:!re,tags:Ee,fields:[{id:"name",prefill:{"*":this.getUserFullName(W)}}]}}})}getUserFullName(W){if(W){const{first_name:Ee,last_name:re}=W;return`${Ee} ${re}`}return""}static#e=this.\u0275fac=function(Ee){return new(Ee||ie)($.KVO(m))};static#t=this.\u0275prov=$.jDH({token:ie,factory:ie.\u0275fac,providedIn:"root"})}return ie})(),M=(()=>{class ie{static forRoot(W){return{ngModule:ie,providers:[{provide:W,useClass:W},{provide:L,useClass:L,deps:[W]}]}}static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[c.MD]})}return ie})();class S extends m{constructor(){super(...arguments),this.accountUrl="biodigital.zendesk.com"}beforePageLoad(Y){Y.setLocale("en"),Y.hide()}}let b=(()=>{class ie{static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[M.forRoot(S)]})}return ie})();var f=d(11818),U=d(90556),C=d(3272),T=d(89511),w=d(59162),v=d(6049),A=d(46374),R=d(59464),N=d(32996),B=d(72026),Q=d(82192),H=d(35286),Z=d(86225),k=d(81488),h=d(38645),p=d(70914),D=d(26621);let te=(()=>{class ie{static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[c.MD,B.o]})}return ie})(),E=(()=>{class ie{static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[c.MD,y.H,B.o]})}return ie})();var K=d(18824),u=d(9529),x=d(5584),z=d(64218),oe=d(64026);let ge=(()=>{class ie{static#e=this.\u0275fac=function(Ee){return new(Ee||ie)};static#t=this.\u0275mod=$.$C({type:ie});static#n=this.\u0275inj=$.G2t({imports:[h.iI,f.C,e.YG,N.z,c.MD,T.h,B.o,C.D,y.H,l.G,k.f,Q.G,A.b,v.Y,w.M,X.X1,j,R.j,te,U.f,b,K.j,u.bU,x.d,z.H,H.y2.forChild(),oe.m,p.V,D.o,Z.f,f.C,N.z,T.h,C.D,B.o,y.H,k.f,Q.G,v.Y,A.b,E,w.M,j,R.j,te,U.f,x.d,z.H,oe.m]})}return ie})()},17215:(be,q,d)=>{"use strict";d.d(q,{AJ:()=>j,UT:()=>X,d0:()=>$,n$:()=>V});var c=d(28407),e=d(9989);class y extends e.Ay{constructor(){super("HumanDatabase"),this.version(2).stores({keyValue:",value",analytics:"message"}),this.open(),this.keyValue=this.table("keyValue"),this.analytics=this.table("analytics")}}var l=d(54438),X=function(I){return I.WidgetOptions="widgetOptions",I.SnapshotOptions="snapshotOptions",I.Locale="locale",I.GroupRestriction="GroupRestriction",I.UserAppId="userAppId",I.RememberMeEmail="rememberMeEmail",I.LabelConversionSeen="labelConversionSeen",I.DefaultGroupEdit="defaultGroupEdit",I.DefaultCollectionId="defaultCollectionId",I.GettingStartedTutorial="gettingStartedTutorial",I.SystemMessage="systemMessage",I.ExploreRedesignMessage="exploreRedesignMessage",I.Iphone12Warning="iphone12Warning",I.RecentRecipes="recentRecipes",I.TeamTrialExpirationSeen="teamTrialExpiredSeen",I.ProExpirationSeen="proExpirationSeen",I.PaintPalettes="paintPalettes",I.RecentSearchConfig="recentSearchConfig",I.CameraDebug="cameraDebug",I.TeamWelcomeTourSeen="teamWelcomeTourSeen",I.UserJoinPromptSeen="userJoinPromptSeen",I.UserJoinNotificationInteracted="userJoinNotificationInteracted",I.ZSpaceDevice="zSpaceDevice",I.EnableAdvancedStats="enableAdvancedStats",I}(X||{}),$=function(I){return I.UserMessagesSeen="userMessagesSeen",I.PreviewSize="previewSize",I.GPUAnalyticsStored="gpuAnalyticsStored",I}($||{}),j=function(I){return I.PreviewStory="previewStory",I.PreviewBookmark="previewBookmark",I}(j||{});class O{constructor(){this._data={}}get keys(){return Object.keys(this._data)}get length(){return this.keys.length}clear(){this._data={}}getItem(L){return this._data[L]}key(L){return this.keys[L]}removeItem(L){delete this._data[L]}setItem(L,M){this._data[L]=M}}let V=(()=>{class I{constructor(){this._localStorage=this.getStorage("localStorage"),this._sessionStorage=this.getStorage("sessionStorage"),this._indexedStorage=new y}getLocalItem(M){return this._localStorage.getItem(`${M}`)}getLocalJSON(M){const S=this.getLocalItem(M);return S?JSON.parse(S):null}setLocalItem(M,S){const b="object"==typeof S?JSON.stringify(S):`${S}`;try{return this._localStorage.setItem(`${M}`,b),!0}catch{return!1}}removeLocalItem(M){this._localStorage.removeItem(`${M}`)}getSessionItem(M){const S=this._sessionStorage.getItem(`${M}`);return S?JSON.parse(S):null}setSessionItem(M,S){const b=JSON.stringify(S);try{return this._sessionStorage.setItem(`${M}`,b),!0}catch{return!1}}removeSessionItem(M){this._sessionStorage.removeItem(`${M}`)}setDatabaseItem(M,S){return this._indexedStorage.keyValue.put(S,M)}setDatabaseAnalyticItem(M){var S=this;(0,c.A)(function*(){yield S._indexedStorage.analytics.put(M)})()}getDatabaseOfflineAnalytics(M){var S=this;(0,c.A)(function*(){const b=yield S._indexedStorage.analytics.toArray();S._indexedStorage.analytics.clear(),M(b)})()}getDatabaseOfflineAnalyticsCount(M){var S=this;(0,c.A)(function*(){const b=yield S._indexedStorage.analytics.toArray();M(b.length)})()}getDatabaseItem(M){return this._indexedStorage.keyValue.get(M)}clearStorage(){this.clearLocalStorage(),this.clearSessionStorage()}clearLocalStorage(){this._localStorage.clear()}clearSessionStorage(){this._sessionStorage.clear()}getStorage(M){try{return window[M]||new O}catch{return new O}}static#e=this.\u0275fac=function(S){return new(S||I)};static#t=this.\u0275prov=l.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}return I})()},97415:(be,q,d)=>{"use strict";d.d(q,{I:()=>c});const c={small:{width:256,height:256},medium:{width:512,height:512},large:{width:1024,height:1024}}},93455:(be,q,d)=>{"use strict";d.d(q,{V:()=>y});var e,c=d(81025);class y{constructor(){this[e]=!0}static#e=e=c.lE}},11113:(be,q,d)=>{"use strict";var c,e;d.d(q,{e:()=>c}),(e=c||(c={})).updateChapterIds=function y(j,m){return Object.keys(j).reduce((I,L)=>(I[m[L]]=j[L],I),{})},e.duplicateChapter=function l(j,m,O){return{...O,[m]:O[j]}},e.deleteChapter=function X(j,m){const O={...m};return delete O[j],O},e.addEntryForChapter=function $(j,m,O){return O[j]={...O[j],...m},O}},59429:(be,q,d)=>{"use strict";var c;d.d(q,{u:()=>c}),function(e){function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(X){const $=16*Math.random()|0;return("x"===X?$:3&$|8).toString(16)})}e.getUuid=y,e.idWithPrefix=function l(X){return X?`${X}-${y()}`:y()}}(c||(c={}))},4959:(be,q,d)=>{"use strict";d.d(q,{j:()=>B});var c=d(21164),e=d(62943),y=d(8358),l=d(49204),X=d(76872),$=d(92677),j=d(65881);const m={enabled:!1,clips:{left:{clipId:0,enabled:!1,fade:!1,fadeDistance:0,progress:0},right:{clipId:1,enabled:!1,fade:!1,fadeDistance:0,progress:0},back:{clipId:5,enabled:!1,fade:!1,fadeDistance:0,progress:0},front:{clipId:4,enabled:!1,fade:!1,fadeDistance:0,progress:0},top:{clipId:3,enabled:!1,fade:!1,fadeDistance:0,progress:0},bottom:{clipId:2,enabled:!1,fade:!1,fadeDistance:0,progress:0}}},V={0:"left",1:"right",2:"bottom",3:"top",4:"front",5:"back"};var I=d(29284),L=d(23881),M=d(44867),S=d(13491),b=d(35650),f=d(60286),U=d(62751),C=d(11724),T=d(63508),w=d(92333),v=d(76774),A=d(17766),R=d(13976),N=d(54438);let B=(()=>{class Q{constructor(Z,k,h,p,D){this.serializeChapterService=Z,this.labelService=k,this.paintService=h,this.sceneService=p,this.contentBlocksService=D}processChapterForEngine(Z){const k=(0,j.S)([Z],!1),D=this.sceneService.getRootObjects(),te=(0,L.ow)(this.paintService.getColorRecipes()),E=(0,M.fm)(D,te);return{...this.serializeChapterService.serializeChapter(E,Z,{},[],k,!1),sliderLayers:Z.sliderLayers}}copyChapter(Z,k){const h=(0,l.cloneDeep)(Z);return h.id=k,h.readyState={model:!0,animation:!1},h}getChapter(Z,k,h,p,D){const te=p.id||(0,j.G)();let E;(0,l.isNil)(p.background)||(E=(0,e.iu)(p.background));const K=p.transparencyMode||C.TransparencyModeEnum.Alpha,u=this.deserializeCamera(p);let x=!1;const z=p.timelineMap;let oe;z.forEach(ve=>{"dummy"!==ve.name&&"dummy"!==ve.data.timeline&&(x=!0)});const ge=p.animation?.loop??k.animation?.loop??!1;if(p.ui&&!(0,l.isEmpty)(p.ui))oe=p.ui;else{let ve=0;x&&ge?ve=-1:x&&!ge&&(ve=1),oe={play:{count:ve}}}const ie=X.D.Annotation,Y=[...p.annotations||[]].map(ve=>this.labelService.deserializeAnnotation(ve,p,ie)),W=[],re=this.groupHotspots([...p.hotspots||[]].filter(ve=>{const Ne=this.labelService.filterHotspot(k,p,ve);return Ne?ve.theme||(ve.theme=h===A.c.Module?$.T.studioNext:$.T.classicHotspot):W.push(ve),Ne})).map(ve=>this.labelService.deserializeHotspots(k,p,D,...ve)),Se=p.labels?.length>0?p.labels:[...Y,...re],se=W,pe=(0,l.isEmpty)(p.clippingPlanes)?m:this.sanitizeClippingPlanes(p.clippingPlanes),Te=this.deserializeContentBlocks(p.contentBlocks),we=p.legend??[],tt=(p.quizQuestions??[]).map(ve=>(0,v.z9)(ve,ve.id,p.id)),Ue=p.media??{};Object.values(Ue).forEach(ve=>{ve&&(0,l.isEmpty)(ve.lang)&&(ve.lang="en")});const ke=p.thumbnails,at=Z.map(ve=>ve.objectId),{availableObjects:De,showObjects:Oe}=p,nt=(0,l.isEmpty)(De)?(0,M.K$)(at,Oe,De):De;return{...p,id:te,background:E,camera:u,timelineMap:z,loop:ge,ui:oe,labels:Se,hotspots:se,clippingPlanes:pe,contentBlocks:Te,legend:we,quizQuestions:tt,media:Ue,readyState:{model:!1,animation:!1},thumbnails:ke,transparencyMode:K,sliderLayers:{src:{},currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]},availableObjects:nt}}deserializeContentBlocks(Z=[]){return Z.map(k=>(this.contentBlocksService.isTickerBlock(k)&&(k.enable=k.enable??!0),k))}deserializeCamera(Z){const k=Z.jumpTo?U.L.JumpTo:U.L.FlyTo,{eye:h,look:p,up:D,title:te}=Z[k],E={action:k,location:{eye:h,look:p,up:D},title:te??w.y};return Z.cameraRotationCenter&&(E.rotationCenter=Z.cameraRotationCenter),Z.camera&&Array.isArray(Z.camera.rotationCenter)&&(E.rotationCenter=S.n.fromArray(Z.camera.rotationCenter)),E}getChapterTweenStates(Z){const k=Z.timelineMap.filter(h=>"dummy"!==h.data.timeline).map(h=>h.data.timeline);return Array.from(new Set(k))}getChapterLightLibraries(Z){return(0,T.Uv)(Z)?(Z.lights?.libraries??[]).filter(h=>"default"!==h):[]}getChapterReflectionLibraries(Z){if((0,T.Uv)(Z)){const h=Z.environment&&Z.environment.reflectionMap||[],p=te=>te.split(".")[0],D=(Z.environment&&Z.environment.lightMap||[]).map(p).concat(h.map(p));return Array.from(new Set(D))}return[]}hasVisibilityLayers(Z){return Array.isArray(Z)&&Z.length>0}buildVisibilityLayers(Z){const k=Z.visibilityLayers,h=Z.showObjects,p={src:k,currentLayers:{},sourceLayerGroups:[],currentLayerGroups:[]};if(k&&this.hasVisibilityLayers(k.layers)){const D=k.initIndex||0,te=this.unpackLayers(k.layers),E=this.buildShownObjectsSet(h),K=this.buildCurrentLayers(te,E),u=this.buildLayerGrouping(K);p.src={layers:k.layers,initIndex:D},p.currentLayers={layers:K,index:D,position:0},p.sourceLayerGroups=(0,l.cloneDeep)(u),p.currentLayerGroups=(0,l.cloneDeep)(u)}return p}buildShownObjectsSet(Z){const k=this.sceneService.getSceneGraph(this.sceneService.getRootObjects()),h=Object.keys(k.nodes).filter(p=>(0,I.BK)(k,p,Z)||(0,I._x)(k,p,Z));return new Set(h)}unpackLayers(Z){const k=[];return Z.forEach(h=>{let p=[];h.objectIds.forEach(te=>{const E=this.sceneService.getObjectById(te);if(E){const K=this.sceneService.getLeaves(E.objectId);p=p.concat(K.map(u=>u.objectId))}}),k.push({name:h.name,objectIds:p})}),k}buildCurrentLayers(Z,k){const h=[];return Z.forEach((p,D)=>{let te=!1;p.objectIds.forEach(E=>{k.has(E)&&(te?h[h.length-1].objectIds.push(E):(h.push({name:Z[D].name,objectIds:[E]}),te=!0))})}),h}buildLayerGrouping(Z){return Z.reduce((k,h,p)=>{const{name:D}=h;let te=k.find(E=>E.name===D);return te||(te={name:D,position:0,layers:[]},k.push(te)),te.layers.push(h),te.position=te.layers.length,k},[])}sanitizeClippingPlanes(Z){const k=Object.values(Z.clips).some(p=>p.progress>0),h=(0,l.mapKeys)(Z.clips,(p,D)=>V[D]||D);return{...Z,clips:h,enabled:k}}groupHotspots(Z){const k={},h=D=>D.primitiveIndex?D.primitiveIndex.toFixed(0):D.pos?D.pos.map(te=>te.toFixed(3)).join(":"):Math.random().toFixed(3),p=D=>RegExp("^circle-(plus|minus)").test(D)?"pair":"single";return Z.forEach(D=>{const te=[p(D.type),D.objectId,h(D)].join("|");te in k?k[te].push(D):k[te]=[D]}),Object.values(k)}static#e=this.\u0275fac=function(k){return new(k||Q)(N.KVO(c.p),N.KVO(y.x),N.KVO(f.s),N.KVO(b.w),N.KVO(R.V))};static#t=this.\u0275prov=N.jDH({token:Q,factory:Q.\u0275fac,providedIn:"root"})}return Q})()},8358:(be,q,d)=>{"use strict";d.d(q,{x:()=>v});var c=d(69568),e=d(59429),y=d(24151),l=d(76872),X=d(92677),$=d(16124),j=d(49746),m=d(95370),O=d(40470),V=d(20714),I=d(38157),L=d(1300),M=d(79817),S=d(49204),f=d(12347),U=d(35650),C=d(54438);const T={flyToCamera:"flyTo",flyToChapter:"flyTo"};let v=(()=>{class A{constructor(N,B){this.animationService=N,this.sceneService=B,this.convertActionToErrand=(Q,H,Z)=>{const k=new RegExp("^flyTo(Async)?"),h=new RegExp("^flyToObject(Async)?"),p=new RegExp("^flyTo[w.:]+currentChapter.[flyTo|jumpTo]"),D=Z.split(":").slice(0,2),te=Q;let E=D[1];/currentChapter/.test(E)&&(E=E.replace("currentChapter",`chapters[${H}]`));let K=null;return h.test(D[0])?K=new j.F((0,S.get)(te,E)):k.test(D[0])?K=new m.v((0,S.get)(te,E)):p.test(D[0])&&(K=new L.T),K},this.convertErrandToAction=(Q,H)=>{const Z=e.u.idWithPrefix("errand").replace(/-/g,"_"),k={};let h="";const p=function w(A){return T[A]||A}(H.type);return H.type===I.X.flyToChapter||(h=`${p}Async:currentChapter.customData.${Z}`,k[Z]=H.value),{action:h,data:k}}}filterHotspot(N,B,Q){const H=new RegExp("^(flyTo|flyToObject|hideHotspot|showHotspot|resetHotspots)"),Z=this.getHotspotAction(N,Q),k=Z.filter(h=>H.test(h));return Z.length===k.length}deserializeAnnotation(N,B,Q){const H=new c.ed(N.title||"");return H.id=N.annotationId||e.u.idWithPrefix("label"),H.chapterId=B.id,H.expandTag=!0,H.showDescription=!0,H.collapseDescription=!1,H.pinGlow=!1,H.hideWire=!1,H.hideTag=!1,Q===l.D.Annotation?(H.theme=l.D.Annotation,H.pinType=y.O.Default,H.flyTo=!1,H.states=[]):(H.theme=l.D.StudioNext,H.pinType=y.O.PlusMinus,H.flyTo=!0,H.states=[new $.B,new $.B],H.states[0].errands=[new L.T],H.states[1].errands=[new j.F(N.objectId)]),H.occludable=!1!==N.occludable,H.renderableIndex=N.renderableIndex||0,N.objectId&&Object.prototype.hasOwnProperty.call(N,"barycentric")?(H.objectId=N.objectId,H.primitiveIndex=N.primitiveIndex,H.barycentric=N.barycentric):Object.prototype.hasOwnProperty.call(N,"pos")&&(Object.prototype.hasOwnProperty.call(N,"objectId")&&(H.objectId=N.objectId),H.pos=N.pos),N.dir&&Array.isArray(N.dir)?H.dir=N.dir:N.dir&&N.dir instanceof Object&&(H.dir=Object.values(N.dir)),H.description=N.description||"",H.offset=N.labelOffset||[40,40],H.shown=!1!==N.shown,H.labelShown=!1!==N.labelShown,H}deserializeHotspots(N,B,Q,...H){const[Z,k]=H,h=new c.ed(Z.title||"");switch(h.id=e.u.idWithPrefix("hotspot"),h.objectId=Z.objectId,h.chapterId=B.id,h.description=Z.description||"",h.pinType=/plus|minus/.test(Z.className)?y.O.PlusMinus:/sequential/.test(Z.className)?y.O.Sequential:/none/.test(Z.className)?y.O.None:y.O.Default,/alphabetical/.test(Z.className)?h.sequentialType=M.C.Alphabetical:/numerical/.test(Z.className)&&(h.sequentialType=M.C.Numerical),h.pinGlow=/pulse/.test(Z.className),h.occludable=!0,h.shown=Z.shown,h.offset=Z.labelOffset?Z.labelOffset:[22,-17],(/left/.test(Z.className)&&h.offset[0]>0||/right/.test(Z.className)&&h.offset[0]<0)&&(h.offset[0]*=-1),Object.prototype.hasOwnProperty.call(Z,"barycentric")?(h.renderableIndex=Z.renderableIndex||0,h.barycentric=Z.barycentric,h.primitiveIndex=Z.primitiveIndex):h.pos=Z.pos,h.dir=Z.dir,Z.theme=Z.theme?Z.theme:X.T.classicHotspot,Z.theme){case X.T.classicAnnotation:h.theme=l.D.Annotation,h.showDescription=!0,h.collapseDescription=/collapsible/g.test(Z.className),h.expandTag=Z.expandTag??!0,h.hideTag=Z.hideTag??!1,h.hideWire=!/leader-line/.test(Z.className);break;case X.T.classicHotspot:h.theme=l.D.Classic,h.showDescription=/label/.test(Z.className),h.expandTag=/label/.test(Z.className),h.hideTag=!h.expandTag,h.collapseDescription=!1,h.hideWire=!/leader-line/.test(Z.className);break;case X.T.studioNext:h.theme=l.D.StudioNext,h.showDescription=this.hasContent(Z),h.collapseDescription=/collapsible/g.test(Z.className),h.hideTag=Z.hideTag??!1,h.expandTag=Z.expandTag??!0,h.hideWire=!/leader-line/.test(Z.className);break;case X.T.custom:h.theme=l.D.Custom,h.themeStyles=Z.themeStyles,h.showDescription=this.hasContent(Z),h.collapseDescription=/collapsible/g.test(Z.className),h.hideTag=Z.hideTag??!1,h.expandTag=Z.expandTag??!0,h.hideWire=!/leader-line/.test(Z.className)}h.flyTo=!1,h.flyToTarget=null,h.states=[];const p=this.filterHotspotActions(this.getHotspotAction(N,Z)),D=k?this.filterHotspotActions(this.getHotspotAction(N,k)):[],te=new $.B,E=new $.B;p.length&&(te.errands=p.map(u=>this.convertActionToErrand(N,Q,u))),D.length&&(E.errands=D.map(u=>this.convertActionToErrand(N,Q,u))),h.states=[E,te],te.errands.length>0&&(h.flyTo=!0,h.flyToTarget=te.errands[0].type,te.errands[0].type===I.X.flyToCamera&&(h.cameraPosition=te.errands[0].value));const K=Z.contentBlocks;return K&&(h.contentBlocks=JSON.parse(JSON.stringify(K))),h}makeDefaultStudioLabel(N){const B=N?{...N}:new c.ed("");return B.pinType=y.O.PlusMinus,B.theme=l.D.StudioNext,B.expandTag=!0,B.showDescription=!0,B.collapseDescription=!1,B.pinGlow=!1,B.hideWire=!1,B.hideTag=!1,B.occludable=!0,B.flyTo=!0,B.description="",B.shown=!0,B.states=[new $.B,new $.B],B}makeAnnotationLabel(N){const B=N?{...N}:new c.ed("");return B.pinType=y.O.Default,B.theme=l.D.Annotation,B.expandTag=!0,B.showDescription=!0,B.collapseDescription=!1,B.pinGlow=!1,B.hideWire=!1,B.hideTag=!1,B.states=[],B}serializeLabel(N,B){const Q={symbol:void 0,className:void 0,dir:void 0,objectId:void 0,shown:void 0,type:void 0},H=(0,O.uK)(N),Z=["circle","draggable"];if(Q.shown=!0,N.objectId&&(Q.objectId=H.objectId),N.objectId&&N.primitiveIndex&&N.barycentric)Q.renderableIndex=N.renderableIndex||0,Q.primitiveIndex=N.primitiveIndex,Q.barycentric=N.barycentric;else{if(!N.objectId)return{data:{},hotspots:[]};Q.pos=H.pos}switch((Array.isArray(N.dir)||ArrayBuffer.isView(N.dir))&&(Q.dir=Array.prototype.slice.call(N.dir)),Q.labelOffset=N.offset,N.theme){case l.D.Annotation:Q.theme=X.T.classicAnnotation;break;case l.D.Classic:Q.theme=X.T.classicHotspot;break;case l.D.Custom:Q.theme=X.T.custom,Q.themeStyles=N.themeStyles;break;default:Q.theme=X.T.studioNext}Q.hideTag=H.hideTag,Q.expandTag=H.expandTag,""!==H.title||""!==H.description?(Q.title=H.title,Q.description=H.description,Q.type=V.H.CircleLabel):Q.type=V.H.Circle,N.pinGlow&&Z.push("pulse"),N.pinType===y.O.PlusMinus&&Z.push("plus"),N.pinType===y.O.Sequential&&(Z.push("sequential"),Z.push(N.sequentialType===M.C.Alphabetical?"alphabetical":"numerical")),N.pinType===y.O.None&&Z.push("none"),N.hideWire||Z.push("leader-line"),N.hideTag||Z.push("label"),N.collapseDescription&&Z.push("collapsible collapsed"),Q.className=Z.join(" ");let k={};Q.actions=[];const h=[Q],p=N.states.length;N.states.forEach((te,E)=>{if(E===p-1)h[0].actions.push("resetHotspots"),te.errands.forEach(K=>{const u=this.convertErrandToAction(N,K);h[0].actions.push(u.action),k={...k,...u.data}});else{const K=(0,S.cloneDeep)(Q);K.actions=[],K.className=K.className.replace("plus","minus"),te.errands.forEach(u=>{const x=this.convertErrandToAction(N,u);K.actions.push(x.action),k={...k,...x.data}}),h.push(K)}}),2===h.length&&(h[0].actions.push(`hideHotspots:currentChapter.hotspots[${B}]`),h[0].actions.push(`showHotspots:currentChapter.hotspots[${B+1}]`),h[1].actions.push(`hideHotspots:currentChapter.hotspots[${B+1}]`),h[1].actions.push(`showHotspots:currentChapter.hotspots[${B}]`),h[0].shown=!0,h[1].shown=!1),2===h.length&&N.collapseDescription&&(h[1].className+=h[1].className.replace("collapsed","")),h.forEach(te=>{Q.labelOffset[0]<0?te.className=te.className.replace("right","")+" left":Q.labelOffset[0]>0&&(te.className=te.className.replace("left","")+" right")});const D=N.contentBlocks;return D&&(Q.contentBlocks=JSON.parse(JSON.stringify(D))),{data:k,hotspots:h}}setLabelContainer(N){this._labelContainer=N}getLabelContainer(){return this._labelContainer}hasContent(N){const{description:B,contentBlocks:Q}=N;return!!B||!(0,S.isNil)(Q)&&Q.length>0}getHotspotAction(N,B){const Q=B.actionSrc?(0,S.get)(N,B.actionSrc):B.actions?B.actions:[];return Array.isArray(Q)?Q:[]}filterHotspotActions(N){const B=new RegExp("^(flyTo|flyToObject)");return N.filter(Q=>B.test(Q))}static#e=this.\u0275fac=function(B){return new(B||A)(C.KVO(f.O),C.KVO(U.w))};static#t=this.\u0275prov=C.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},62751:(be,q,d)=>{"use strict";d.d(q,{L:()=>c});var c=function(e){return e.JumpTo="jumpTo",e.FlyTo="flyTo",e}(c||{})},92333:(be,q,d)=>{"use strict";d.d(q,{y:()=>e}),d(62751);const e=$localize`Starting Position`},17766:(be,q,d)=>{"use strict";d.d(q,{c:()=>c});var c=function(e){return e.Bookmark="bookmark",e.Module="module",e.Internal="internal",e}(c||{})},38157:(be,q,d)=>{"use strict";d.d(q,{X:()=>c});var c=function(e){return e.flyToChapter="flyToChapter",e.flyToObject="flyToObject",e.flyToCamera="flyToCamera",e}(c||{})},95370:(be,q,d)=>{"use strict";d.d(q,{v:()=>e});var c=d(38157);class e{constructor(l){this.type=c.X.flyToCamera,this.value=l}}},1300:(be,q,d)=>{"use strict";d.d(q,{T:()=>e});var c=d(38157);class e{constructor(){this.type=c.X.flyToChapter,this.value=null}}},49746:(be,q,d)=>{"use strict";d.d(q,{F:()=>e});var c=d(38157);class e{constructor(l){this.type=c.X.flyToObject,this.value=l}}},92677:(be,q,d)=>{"use strict";d.d(q,{T:()=>c});var c=function(e){return e.classicAnnotation="classic-annotation",e.classicHotspot="classic-hotspot",e.studioNext="studio-light",e.custom="custom",e}(c||{})},20714:(be,q,d)=>{"use strict";d.d(q,{H:()=>c});var c=function(e){return e.Circle="circle",e.CirclePlus="circle-plus",e.CircleMinus="circle-minus",e.Label="label",e.CircleLabel="circle-label",e}(c||{})},15375:(be,q,d)=>{"use strict";d.d(q,{Q:()=>c});var c=function(e){return e.Toggle="toggle",e.None="none",e}(c||{})},24151:(be,q,d)=>{"use strict";d.d(q,{O:()=>c});var c=function(e){return e.Default="default",e.Plus="plus",e.Minus="minus",e.PlusMinus="plusMinus",e.Sequential="sequential",e.None="none",e}(c||{})},79817:(be,q,d)=>{"use strict";d.d(q,{C:()=>c});var c=function(e){return e.Alphabetical="alphabetical",e.Numerical="numerical",e}(c||{})},16124:(be,q,d)=>{"use strict";d.d(q,{B:()=>c});class c{constructor(){this.title=null,this.description=null,this.errands=[]}}},76872:(be,q,d)=>{"use strict";d.d(q,{D:()=>c});var c=function(e){return e.Annotation="annotation",e.Classic="classic",e.StudioNext="studioNext",e.Context="context",e.Custom="custom",e}(c||{})},69568:(be,q,d)=>{"use strict";d.d(q,{ed:()=>X});var c=d(24151),e=d(76872),y=d(79817);class X{constructor(m){this.pinType=c.O.PlusMinus,this.sequentialType=y.C.Alphabetical,this.theme=e.D.StudioNext,this.expandTag=!0,this.showDescription=!0,this.collapseDescription=!1,this.pinGlow=!1,this.hideWire=!1,this.hideTag=!1,this.title=m}}},57238:(be,q,d)=>{"use strict";d.d(q,{R:()=>e});var c=d(93455);class e extends c.V{}},33013:(be,q,d)=>{"use strict";d.d(q,{$V:()=>K,Aq:()=>X,Bc:()=>ge,EN:()=>Q,Eh:()=>u,Ej:()=>N,Eo:()=>l,F0:()=>y,FN:()=>p,Lx:()=>M,M5:()=>f,Nw:()=>A,O:()=>L,Oj:()=>b,PA:()=>k,R:()=>w,VU:()=>O,WZ:()=>E,Wd:()=>H,X_:()=>v,YA:()=>h,bg:()=>Y,eV:()=>U,is:()=>oe,jo:()=>x,jy:()=>S,lM:()=>m,lc:()=>z,pN:()=>V,pb:()=>Z,qi:()=>B,rT:()=>C,sC:()=>I,sN:()=>T,tg:()=>e,tn:()=>D,wg:()=>j,yr:()=>c,yz:()=>$,zh:()=>ie});let c=(()=>{class W{static#e=this.type="[Story Chapter] Apply Patch";constructor(re){this.patches=re}}return W})(),e=(()=>{class W{static#e=this.type="[Story Chapter] Next Chapter";constructor(){}}return W})(),y=(()=>{class W{static#e=this.type="[Story Chapter] Previous Chapter";constructor(){}}return W})(),l=(()=>{class W{static#e=this.type="[Story Chapter] First Chapter";constructor(){}}return W})(),X=(()=>{class W{static#e=this.type="[Story Chapter] Last Chapter";constructor(){}}return W})(),$=(()=>{class W{static#e=this.type="[Story Chapter] Select Chapter";constructor(re){this.chapter=re}}return W})(),j=(()=>{class W{static#e=this.type="[Story Chapter] Select Chapter by chapter id";constructor(re){this.chapterId=re}}return W})(),m=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapters";constructor(re){this.chapters=re}}return W})(),O=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Camera Action";constructor(re,Se){this.chapterId=re,this.cameraAction=Se}}return W})(),V=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Camera Title";constructor(re,Se){this.chapterId=re,this.title=Se}}return W})(),I=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter UI";constructor(re,Se){this.chapterId=re,this.ui=Se}}return W})(),L=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Info";constructor(re,Se,se){this.chapterId=re,this.description=Se,this.displayName=se}}return W})(),M=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Legend";constructor(re,Se){this.chapterId=re,this.legend=Se}}return W})(),S=(()=>{class W{static#e=this.type="[Story Chapter] Add To Chapter Legend";constructor(re,Se){this.chapterId=re,this.legend=Se}}return W})(),b=(()=>{class W{static#e=this.type="[Story Chapter] Reorder Chapters";constructor(re,Se){this.previousIndex=re,this.currentIndex=Se}}return W})(),f=(()=>{class W{static#e=this.type="[Story Chapter] Set Readystate";constructor(re,Se){this.chapterId=re,this.readyState=Se}}return W})(),U=(()=>{class W{static#e=this.type="[Story Chapter] Build Chapter Visibility Layers";constructor(re){this.chapterId=re}}return W})(),C=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter PostProcessing";constructor(re,Se,se){this.chapterId=re,this.effects=Se,this.properties=se}}return W})(),T=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Transitions";constructor(re,Se,se){this.chapterId=re,this.transition=Se,this.key=se}}return W})(),w=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Properties";constructor(re,Se){this.chapterIds=re,this.properties=Se}}return W})(),v=(()=>{class W{static#e=this.type="[Story Chapter] Remove Chapter Properties";constructor(re,Se){this.chapterIds=re,this.properties=Se}}return W})(),A=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Transparency Mode";constructor(re,Se){this.chapterId=re,this.transparencyMode=Se}}return W})(),N=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Clipping Planes";constructor(re,Se,se,pe){this.chapterId=re,this.clips=Se,this.enabled=se,this.record=pe}}return W})(),B=(()=>{class W{static#e=this.type="[Story Chapter] Set Chapter Background";constructor(re,Se){this.chapterId=re,this.background=Se}}return W})(),Q=(()=>{class W{static#e=this.type="[Story Chapter] Set All Chapters Background";constructor(re){this.background=re}}return W})(),H=(()=>{class W{static#e=this.type="[Story Chapter] Reset Selected Chapter Background";constructor(){}}return W})(),Z=(()=>{class W{static#e=this.type="[Story Chapter] Set Selected Chapter Background";constructor(re){this.background=re}}return W})(),k=(()=>{class W{static#e=this.type="[Story Chapter] Duplicate An Existing Chapter";constructor(re,Se,se){this.story=re,this.chapter=Se,this.chapterId=se}}return W})(),h=(()=>{class W{static#e=this.type="[Story Chapter] Remove Chapter";constructor(re){this.chapter=re}}return W})(),p=(()=>{class W{static#e=this.type="[Story Chapter] Reset";constructor(){}}return W})(),D=(()=>{class W{static#e=this.type="[Story Chapters] Record Camera";constructor(re,Se,se){this.chapterId=re,this.camera=Se,this.rotationCenter=se}}return W})(),E=(()=>{class W{static#e=this.type="[Story Chapters] Set the current visibility layers index and position";constructor(re,Se,se,pe){this.chapterId=re,this.index=Se,this.position=se,this.record=pe}}return W})(),K=(()=>{class W{static#e=this.type="[Story Chapters] Set the current group layers position";constructor(re,Se,se){this.chapterId=re,this.targetGroups=Se,this.record=se}}return W})(),u=(()=>{class W{static#e=this.type="[Story Chapters] Set the media object";constructor(re,Se){this.chapterId=re,this.media=Se}}return W})(),x=(()=>{class W{static#e=this.type="[Story Chapters] Set the content blocks";constructor(re,Se,se){this.chapterId=re,this.contentBlocks=Se,this.record=se}}return W})(),z=(()=>{class W{static#e=this.type="[Story Chapters] Add to timelineMap array";constructor(re){this.timelineMaps=re}}return W})(),oe=(()=>{class W{static#e=this.type="[Story Chapters] Update timelineMap array";constructor(re){this.updates=re}}return W})(),ge=(()=>{class W{static#e=this.type="[Story Chapters] Remove from timelineMap array";constructor(re){this.timelineMapIds=re}}return W})(),ie=(()=>{class W{static#e=this.type="[Story Chapters] Set the lights";constructor(re,Se){this.chapterId=re,this.lightLibId=Se}}return W})(),Y=(()=>{class W{static#e=this.type="[Story Chapters] set chapter timeline with data from the engine";constructor(re){this.timelineMaps=re}}return W})()},59676:(be,q,d)=>{"use strict";d.d(q,{G:()=>c});class c{}},85586:(be,q,d)=>{"use strict";d.d(q,{N:()=>E});var c=d(28407),e=d(92014),y=d(59676),l=d(33013),X=d(4959),$=d(93915),j=d(47610),m=d(49204),O=d(10352),V=d(97415),I=d(12347),L=d(75069),M=d(81391),S=d(61295),b=d(76016),f=d(9592),U=d(65776),C=d(82323),T=d(65650),w=d(11724),v=d(57238),A=d(81025),R=d(35650),N=d(72849),B=d(63508),Q=d(54438);let H=(()=>{class K{constructor(x,z){this.engineService=x,this.store=z}getGeometries(){return{}}getGeometryCompressionSupported(){return!0}getLoadedAssets(){return{}}getLights(){return{}}getMaterials(){return{}}getTextureCompressionSupported(){return!0}getMorphs(){return{}}getAssetLibrary(x,z,oe){const{server:ge,serverBaseDirectory:ie}=this.engineService;return ge.getAssetLibrary(ie,x,z,oe)}getAssetNamespaces(){const x={},z=this.getLoadedAssets();return Object.keys(z).map(oe=>oe.split("/")[0]).forEach(oe=>{x[oe]=!0}),Object.keys(x)}enableLightLib(x){const oe=this.getLights()[x];if(Array.isArray(oe)){const ge={};oe.forEach(ie=>{ge[ie]=!0}),console.warn("Enabling of lights in real-time not yet implemented.")}}setBranchLights(x,z){const oe=this.store.selectSnapshot(E.getSelectedChapter);(0,B.Uv)(oe)&&oe.lights.libraries[0]!==z&&(oe.lights.libraries[0]=z,this.enableLightLib(z))}loadLightLib(x){var z=this;return(0,c.A)(function*(){return z.getAssetLibrary("lights",x,"outline").then(oe=>({type:"physicalImageLight"in oe?"physical":"legacy",libId:x,asset:oe}))})()}getLightingLibs(x){var z=this;return(0,c.A)(function*(){return Promise.all(x.map(oe=>z.loadLightLib(oe)))})()}static#e=this.\u0275fac=function(z){return new(z||K)(Q.KVO(N.y),Q.KVO(e.il))};static#t=this.\u0275prov=Q.jDH({token:K,factory:K.\u0275fac,providedIn:"root"})}return K})();var D,Z=d(16606),k=d(68947),h=function(K,u,x,z){var ie,oe=arguments.length,ge=oe<3?u:null===z?z=Object.getOwnPropertyDescriptor(u,x):z;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)ge=Reflect.decorate(K,u,x,z);else for(var Y=K.length-1;Y>=0;Y--)(ie=K[Y])&&(ge=(oe<3?ie(ge):oe>3?ie(u,x,ge):ie(u,x))||ge);return oe>3&&ge&&Object.defineProperty(u,x,ge),ge},p=function(K,u){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(K,u)};const te={loading:!1,chapters:[],chaptersViewed:[],selectedChapter:null,isChapterAnimated:!1,thumbnails:new Map,patches:[],inversePatches:[]};let E=class pd{static#e=D=this;static getStoryChapters(u){return u.chapters}static getChaptersViewed(u){return u.chaptersViewed}static getFirstChapter(u){return u.chapters.at(0)}static getChapter(u){return(0,e.Mz)([D],x=>x.chapters.find(z=>z.id===u))}static getSelectedChapterId(u){return u.selectedChapter}static getSelectedChapter(u){return u.chapters.find(x=>x.id===u.selectedChapter)||null}static getSelectedChapterTitle(u){const x=u.chapters.find(z=>z.id===u.selectedChapter)||null;return k.l.normalize(x?.displayName)}static getNextChapter(u){const x=(0,w.clamp)(D.getSelectedChapterIndex(u)+1,0,u.chapters.length-1);return u.chapters[x]}static getPreviousChapter(u){const x=(0,w.clamp)(D.getSelectedChapterIndex(u)-1,0,u.chapters.length-1);return u.chapters[x]}static getSelectedChapterIndex(u){return u.chapters.findIndex(x=>x.id===u.selectedChapter)}static getChapterCount(u){return u.chapters.length}static getChapterPagination(u){const x=u.chapters.findIndex(z=>z.id===u.selectedChapter);return{count:u.chapters.length,index:x,label:`${x+1} ${$localize`of`} ${u.chapters.length}`}}static getChapterCompletionPercent(u){return(u.chapters.findIndex(z=>z.id===u.selectedChapter)+1)/u.chapters.length*100}static getRegisteredThumbnails(u){return u.thumbnails}static getIsChapterAnimated(u){return u.isChapterAnimated}static getSelectedChapterReadyState(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.readyState??{model:!1,animation:!1,audio:!1}}static getChaptersLoaded(u){return{count:u.chapters.length,modelChapters:u.chapters.filter(x=>x.readyState.model),animationChapters:u.chapters.filter(x=>x.readyState.animation)}}static getAllChaptersModelsReady(u){return u.chapters.length>0&&u.chapters.every(x=>x.readyState.model)}static getSelectedChapterModelReady(u){const x=D.getSelectedChapterReadyState(u);return!(0,m.isNil)(x)&&x.model}static getAllChaptersAnimationsReady(u){return u.chapters.length>0&&u.chapters.every(x=>x.readyState.animation)}static getSelectedChapterAnimationReady(u){const x=D.getSelectedChapterReadyState(u);return!(0,m.isNil)(x)&&x.animation}static getSelectedChapterBackground(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.background??O.RK}static getAllChaptersBackground(u){return u.chapters.map(x=>x?.background)}static getSelectedChapterAllAudio(u){const x=u.chapters.find(z=>z.id===u.selectedChapter);return x&&x.media?Object.values(x.media).filter(oe=>"audio"===oe.streamType):[]}static getSelectedChapterLegend(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.legend??[]}static getSelectedChapterClippingPlanes(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.clippingPlanes}static getChapterCamera(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.camera?.location}static findChapter(u,x){return u.find(z=>z.id===x)}static getAllChaptersCurrentLayers(u){return u.chapters.map(x=>x?.sliderLayers?.currentLayers?.layers??[])}static getSelectedChapterSrcLayers(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.src?.layers??[]}static getSelectedChapterSourceLayerGroups(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.sourceLayerGroups??[]}static getSelectedChapterLayerGroups(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.currentLayerGroups??[]}static getSelectedChapterCurrentLayers(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.currentLayers?.layers??[]}static getSelectedChapterCurrentLayersIndex(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.currentLayers?.index}static getSelectedChapterCurrentLayersPosition(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.sliderLayers?.currentLayers?.position}static getSelectedChapterContentBlocks(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.contentBlocks??[]}static getSelectedChapterTimelineMap(u){const{chapters:x,selectedChapter:z}=u;return D.findChapter(x,z)?.timelineMap??[]}static isLastChapter(u){return D.getSelectedChapterIndex(u)+1===u.chapters.length}setChapters(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters=x.chapters}))}SetChapterCameraAction(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).camera.action=x.cameraAction}))}setChapterCameraTitle(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).camera.title=x.title}))}setChapterUI(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).ui=x.ui}))}setChapterInfo(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===x.chapterId);oe.description=x.description,oe.displayName=x.displayName}))}setChapterLegend(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).legend=x.legend}))}addToChapterLegend(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).legend.push(x.legend)}))}ReorderChapters(u,x){var z=this;return(0,c.A)(function*(){return z.storyService.moveChapterInEngine(x.previousIndex,x.currentIndex).then(oe=>{if(oe){const ie=u.getState().chapters.find(Y=>Y.id===oe);u.dispatch(new l.yz(ie)),u.dispatch(new S.IA(oe))}u.patchState(A.jM(u.getState(),ie=>{(0,M.HD)(ie.chapters,x.previousIndex,x.currentIndex)}));const ge=u.getState().chapters.map(ie=>ie.id);u.dispatch(new b.B.ReorderQuestions(ge))})})()}SetChapterReadyState(u,x){const z=A.jM(u.getState(),oe=>{if(x.chapterId){const ge=oe.chapters.find(ie=>ie.id===x.chapterId);ge&&(ge.readyState={...ge.readyState,...x.readyState})}});u.patchState(z)}BuildChapterVisibilityLayers(u,x){const z=A.jM(u.getState(),oe=>{if(x.chapterId){const ge=oe.chapters.findIndex(Y=>Y.id===x.chapterId),ie=oe.chapters[ge];ie.sliderLayers=this.chapterService.buildVisibilityLayers(ie)}});u.patchState(z)}SetChapterPostProcessing(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(Y=>Y.id===x.chapterId),ie=oe.properties||{};oe.customData={...oe.customData?oe.customData:{},postprocess:x.effects},oe.properties={...ie,...x.properties}}))}SetChapterTransitions(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===x.chapterId);oe.transitions=oe.transitions||{},oe.transitions[x.key]=x.transition}))}setChapterProperties(u,x){const z=x.chapterIds,oe=x.properties;u.patchState(A.jM(u.getState(),ge=>{ge.chapters.filter(ie=>z.includes(ie.id)).forEach(ie=>{ie.properties={...ie.properties??{},...oe}})}))}removeChapterProperties(u,x){const z=x.chapterIds,oe=x.properties;u.patchState(A.jM(u.getState(),ge=>{ge.chapters.filter(ie=>z.includes(ie.id)).forEach(ie=>{ie?.properties&&oe.forEach(Y=>{delete ie.properties[Y]})})}))}SetChapterTransparencyMode(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).transparencyMode=x.transparencyMode}))}applyChapterPatch(u,x){const z=A.$i(u.getState(),x.patches);u.patchState(A.jM(z,oe=>{oe.patches=[],oe.inversePatches=[]}))}setChapterClippingPlane(u,x){const[z,oe,ge]=A.vI(u.getState(),Y=>{const W=Y.chapters.find(Ee=>Ee.id===x.chapterId);W.clippingPlanes.clips=x.clips,W.clippingPlanes.enabled=x.enabled,W.clippingPlanes.boundary=W.clippingPlanes.boundary??this.sceneService.getSceneBoundary()}),ie=A.jM(z,Y=>{Y.patches.push(...oe),Y.inversePatches.push(...ge)});x.record&&u.dispatch(new L.a.SavePatches([{forward:ie.patches,inverse:[...ie.inversePatches].reverse(),patchAction:l.yr}])),u.patchState(x.record?A.jM(ie,Y=>{Y.patches=[],Y.inversePatches=[]}):ie)}setChapterBackground(u,x){x.background&&u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).background=x.background}))}setAllChaptersBackground(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.forEach(oe=>{oe.background=x.background})}))}resetSelectedChapterBackground(u,x){const{selectedChapter:z}=u.getState();this.store.dispatch(new l.qi(z,O.RK))}setSelectedChapterBackground(u,{background:x}){const z=u.getState().selectedChapter;this.store.dispatch(new l.qi(z,x))}selectChapter(u,x){if(!x.chapter)return;this.store.dispatch([new S.q9(!1),new S.hg]);const z=this.animationService.isChapterAnimated(x.chapter);this.store.dispatch(new j.dB(!!x.chapter));const oe=A.jM(u.getState(),ge=>{ge.chaptersViewed.some(ie=>x.chapter.id===ie)||ge.chaptersViewed.push(x.chapter.id),ge.selectedChapter=x.chapter?x.chapter.id:null,ge.isChapterAnimated=z});u.patchState(oe)}selectChapterById(u,{chapterId:x}){this.store.dispatch(new j.dB(!0)),u.patchState({selectedChapter:x})}duplicateChapter(u,x){const z=x.chapter,oe=this.chapterService.copyChapter(z,x.chapterId),ge=this.store.selectSnapshot(D.getSelectedChapterBackground),ie=this.store.selectSnapshot(T.K.getRegisteredThumbnails),Y=ie.get(z.id);if((0,m.isNil)(Y))if(z.thumbnails){const re=new v.R;re.chapterId=oe.id,re.snapshot=z.thumbnails.default,ie.set(oe.id,re)}else u.dispatch(new C.V9(oe.id,ge,f.H.JPEG,92,V.I.medium,"square"));else ie.set(oe.id,Y);const Ee=u.getState().chapters.findIndex(re=>re.id==z.id)+1;u.patchState(A.jM(u.getState(),re=>{re.chapters.splice(Ee,0,oe)})),this.storyService.addChapterToEngine(oe,Ee).then(()=>{}).catch(re=>{console.error(`Error importing chapter "${oe.id}":`,re)})}nextChapter(u,x){const z=this.store.selectSnapshot(D.getNextChapter);u.dispatch(new l.yz(z))}previousChapter(u,x){const z=this.store.selectSnapshot(D.getPreviousChapter);u.dispatch(new l.yz(z))}lastChapter(u,x){const z=u.getState().chapters;u.dispatch(new l.yz(z[z.length-1]))}firstChapter(u,x){const z=u.getState().chapters;u.dispatch(new l.yz(z[0]))}removeChapter(u,x){const{chapters:z,selectedChapter:oe}=u.getState();if(1===z.length)return;const ge=z.findIndex(ie=>ie.id===x.chapter.id);if(this.storyService.removeChapterFromEngine(ge),u.patchState(A.jM(u.getState(),ie=>{ie.chapters.splice(ge,1)})),x.chapter.id===oe){const ie=u.getState().chapters,Y=Math.min(ge,ie.length-1);u.dispatch(new l.yz(ie[Y]))}u.dispatch(new $.u1(x.chapter,!1))}resetStoryChaptersState(u,x){u.setState(te)}RecordCamera(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===x.chapterId);oe.camera.location=x.camera,x.rotationCenter&&(oe.camera.rotationCenter=x.rotationCenter)}))}setChapterCurrentLayersIndexPosition(u,x){const[z,oe,ge]=A.vI(u.getState(),Y=>{const Ee=Y.chapters.find(re=>re.id===x.chapterId).sliderLayers.currentLayers;Ee.index=x.index,Ee.position=x.position}),ie=A.jM(z,Y=>{Y.patches.push(...oe),Y.inversePatches.push(...ge)});u.patchState(ie),x.record&&u.dispatch(new L.a.SavePatches([{forward:ie.patches,inverse:ie.inversePatches,patchAction:l.yr}]))}setChapterCurrentGroupLayersPosition(u,x){const[z,oe,ge]=A.vI(u.getState(),Y=>{const W=Y.chapters.find(Ee=>Ee.id===x.chapterId);W&&(W.sliderLayers.currentLayerGroups=W.sliderLayers.currentLayerGroups.map(Ee=>{const re=x.targetGroups.find(Se=>Se.name===Ee.name);return{...Ee,position:re?.position??Ee.position}}))}),ie=A.jM(z,Y=>{Y.patches.push(...oe),Y.inversePatches.push(...ge)});u.patchState(ie),x.record&&u.dispatch(new L.a.SavePatches([{forward:ie.patches,inverse:ie.inversePatches,patchAction:l.yr}]))}setChapterMedia(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===x.chapterId).media=x.media}))}setChapterContentBlocks(u,x){x.contentBlocks=[...x.contentBlocks.filter(Y=>Y.type===U.m.Ticker),...x.contentBlocks.filter(Y=>Y.type!==U.m.Ticker)];const[z,oe,ge]=A.vI(u.getState(),Y=>{Y.chapters.find(Ee=>Ee.id===x.chapterId).contentBlocks=x.contentBlocks}),ie=A.jM(z,Y=>{Y.patches.push(...oe),Y.inversePatches.push(...ge)});u.patchState(ie),x.record&&u.dispatch(new L.a.SavePatches([{forward:ie.patches,inverse:ie.inversePatches,patchAction:l.yr}]))}setChapterTimelineMap(u,x){u.patchState(A.jM(u.getState(),z=>{z.chapters.find(ge=>ge.id===z.selectedChapter).timelineMap=x.timelineMaps}))}addChapterTimelineMap(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===z.selectedChapter);x.timelineMaps.forEach(ge=>{oe.timelineMap.push(ge)})}))}updateChapterTimelineMap(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===z.selectedChapter);x.updates.forEach(ge=>{const ie=oe.timelineMap.findIndex(Y=>Y.id===ge.id);oe.timelineMap.splice(ie,1),oe.timelineMap.push(ge)})}))}removeFromChapterTimelineMap(u,x){u.patchState(A.jM(u.getState(),z=>{const oe=z.chapters.find(ge=>ge.id===z.selectedChapter);x.timelineMapIds.forEach(ge=>{const ie=oe.timelineMap.findIndex(Y=>Y.id===ge);oe.timelineMap.splice(ie,1)})}))}SetChapterLights(u,{chapterId:x,lightLibId:z}){u.patchState(A.jM(u.getState(),oe=>{const ge=oe.chapters.find(ie=>ie.id===x);(0,B.Mi)(ge)?ge.lightLibraryId=z:(0,B.Uv)(ge)&&(ge.lights.libraries=[z],this.assetService.setBranchLights(x,z))}))}constructor(u,x,z,oe,ge,ie){this.store=u,this.chapterService=x,this.animationService=z,this.assetService=oe,this.sceneService=ge,this.storyService=ie}static#t=this.\u0275fac=function(x){return new(x||pd)(Q.KVO(e.il),Q.KVO(X.j),Q.KVO(I.O),Q.KVO(H),Q.KVO(R.w),Q.KVO(Z.J))};static#n=this.\u0275prov=Q.jDH({token:pd,factory:pd.\u0275fac})};h([(0,e.rc)(l.lM),p("design:type",Function),p("design:paramtypes",[Object,l.lM]),p("design:returntype",void 0)],E.prototype,"setChapters",null),h([(0,e.rc)(l.VU),p("design:type",Function),p("design:paramtypes",[Object,l.VU]),p("design:returntype",void 0)],E.prototype,"SetChapterCameraAction",null),h([(0,e.rc)(l.pN),p("design:type",Function),p("design:paramtypes",[Object,l.pN]),p("design:returntype",void 0)],E.prototype,"setChapterCameraTitle",null),h([(0,e.rc)(l.sC),p("design:type",Function),p("design:paramtypes",[Object,l.sC]),p("design:returntype",void 0)],E.prototype,"setChapterUI",null),h([(0,e.rc)(l.O),p("design:type",Function),p("design:paramtypes",[Object,l.O]),p("design:returntype",void 0)],E.prototype,"setChapterInfo",null),h([(0,e.rc)(l.Lx),p("design:type",Function),p("design:paramtypes",[Object,l.Lx]),p("design:returntype",void 0)],E.prototype,"setChapterLegend",null),h([(0,e.rc)(l.jy),p("design:type",Function),p("design:paramtypes",[Object,l.jy]),p("design:returntype",void 0)],E.prototype,"addToChapterLegend",null),h([(0,e.rc)(l.Oj),p("design:type",Function),p("design:paramtypes",[Object,l.Oj]),p("design:returntype",Promise)],E.prototype,"ReorderChapters",null),h([(0,e.rc)(l.M5),p("design:type",Function),p("design:paramtypes",[Object,l.M5]),p("design:returntype",void 0)],E.prototype,"SetChapterReadyState",null),h([(0,e.rc)(l.eV),p("design:type",Function),p("design:paramtypes",[Object,l.eV]),p("design:returntype",void 0)],E.prototype,"BuildChapterVisibilityLayers",null),h([(0,e.rc)(l.rT),p("design:type",Function),p("design:paramtypes",[Object,l.rT]),p("design:returntype",void 0)],E.prototype,"SetChapterPostProcessing",null),h([(0,e.rc)(l.sN),p("design:type",Function),p("design:paramtypes",[Object,l.sN]),p("design:returntype",void 0)],E.prototype,"SetChapterTransitions",null),h([(0,e.rc)(l.R),p("design:type",Function),p("design:paramtypes",[Object,l.R]),p("design:returntype",void 0)],E.prototype,"setChapterProperties",null),h([(0,e.rc)(l.X_),p("design:type",Function),p("design:paramtypes",[Object,l.X_]),p("design:returntype",void 0)],E.prototype,"removeChapterProperties",null),h([(0,e.rc)(l.Nw),p("design:type",Function),p("design:paramtypes",[Object,l.Nw]),p("design:returntype",void 0)],E.prototype,"SetChapterTransparencyMode",null),h([(0,e.rc)(l.yr),p("design:type",Function),p("design:paramtypes",[Object,l.yr]),p("design:returntype",void 0)],E.prototype,"applyChapterPatch",null),h([(0,e.rc)(l.Ej),p("design:type",Function),p("design:paramtypes",[Object,l.Ej]),p("design:returntype",void 0)],E.prototype,"setChapterClippingPlane",null),h([(0,e.rc)(l.qi),p("design:type",Function),p("design:paramtypes",[Object,l.qi]),p("design:returntype",void 0)],E.prototype,"setChapterBackground",null),h([(0,e.rc)(l.EN),p("design:type",Function),p("design:paramtypes",[Object,l.EN]),p("design:returntype",void 0)],E.prototype,"setAllChaptersBackground",null),h([(0,e.rc)(l.Wd),p("design:type",Function),p("design:paramtypes",[Object,l.Wd]),p("design:returntype",void 0)],E.prototype,"resetSelectedChapterBackground",null),h([(0,e.rc)(l.pb),p("design:type",Function),p("design:paramtypes",[Object,Object]),p("design:returntype",void 0)],E.prototype,"setSelectedChapterBackground",null),h([(0,e.rc)(l.yz),p("design:type",Function),p("design:paramtypes",[Object,l.yz]),p("design:returntype",void 0)],E.prototype,"selectChapter",null),h([(0,e.rc)(l.wg),p("design:type",Function),p("design:paramtypes",[Object,Object]),p("design:returntype",void 0)],E.prototype,"selectChapterById",null),h([(0,e.rc)(l.PA),p("design:type",Function),p("design:paramtypes",[Object,l.PA]),p("design:returntype",void 0)],E.prototype,"duplicateChapter",null),h([(0,e.rc)(l.tg),p("design:type",Function),p("design:paramtypes",[Object,l.tg]),p("design:returntype",void 0)],E.prototype,"nextChapter",null),h([(0,e.rc)(l.F0),p("design:type",Function),p("design:paramtypes",[Object,l.F0]),p("design:returntype",void 0)],E.prototype,"previousChapter",null),h([(0,e.rc)(l.Aq),p("design:type",Function),p("design:paramtypes",[Object,l.Aq]),p("design:returntype",void 0)],E.prototype,"lastChapter",null),h([(0,e.rc)(l.Eo),p("design:type",Function),p("design:paramtypes",[Object,l.Aq]),p("design:returntype",void 0)],E.prototype,"firstChapter",null),h([(0,e.rc)(l.YA),p("design:type",Function),p("design:paramtypes",[Object,l.YA]),p("design:returntype",void 0)],E.prototype,"removeChapter",null),h([(0,e.rc)(l.FN),p("design:type",Function),p("design:paramtypes",[Object,l.FN]),p("design:returntype",void 0)],E.prototype,"resetStoryChaptersState",null),h([(0,e.rc)(l.tn),p("design:type",Function),p("design:paramtypes",[Object,l.tn]),p("design:returntype",void 0)],E.prototype,"RecordCamera",null),h([(0,e.rc)(l.WZ),p("design:type",Function),p("design:paramtypes",[Object,l.WZ]),p("design:returntype",void 0)],E.prototype,"setChapterCurrentLayersIndexPosition",null),h([(0,e.rc)(l.$V),p("design:type",Function),p("design:paramtypes",[Object,l.$V]),p("design:returntype",void 0)],E.prototype,"setChapterCurrentGroupLayersPosition",null),h([(0,e.rc)(l.Eh),p("design:type",Function),p("design:paramtypes",[Object,l.Eh]),p("design:returntype",void 0)],E.prototype,"setChapterMedia",null),h([(0,e.rc)(l.jo),p("design:type",Function),p("design:paramtypes",[Object,l.jo]),p("design:returntype",void 0)],E.prototype,"setChapterContentBlocks",null),h([(0,e.rc)(l.bg),p("design:type",Function),p("design:paramtypes",[Object,l.lc]),p("design:returntype",void 0)],E.prototype,"setChapterTimelineMap",null),h([(0,e.rc)(l.lc),p("design:type",Function),p("design:paramtypes",[Object,l.lc]),p("design:returntype",void 0)],E.prototype,"addChapterTimelineMap",null),h([(0,e.rc)(l.is),p("design:type",Function),p("design:paramtypes",[Object,l.is]),p("design:returntype",void 0)],E.prototype,"updateChapterTimelineMap",null),h([(0,e.rc)(l.Bc),p("design:type",Function),p("design:paramtypes",[Object,l.Bc]),p("design:returntype",void 0)],E.prototype,"removeFromChapterTimelineMap",null),h([(0,e.rc)(l.zh),p("design:type",Function),p("design:paramtypes",[Object,l.zh]),p("design:returntype",void 0)],E.prototype,"SetChapterLights",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getStoryChapters",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChaptersViewed",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getFirstChapter",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterId",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapter",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterTitle",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getNextChapter",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getPreviousChapter",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterIndex",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChapterCount",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChapterPagination",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChapterCompletionPercent",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getRegisteredThumbnails",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getIsChapterAnimated",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterReadyState",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChaptersLoaded",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getAllChaptersModelsReady",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterModelReady",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getAllChaptersAnimationsReady",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterAnimationReady",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterBackground",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getAllChaptersBackground",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterAllAudio",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterLegend",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getSelectedChapterClippingPlanes",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"getChapterCamera",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getAllChaptersCurrentLayers",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterSrcLayers",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterSourceLayerGroups",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterLayerGroups",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterCurrentLayers",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Number)],E,"getSelectedChapterCurrentLayersIndex",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Number)],E,"getSelectedChapterCurrentLayersPosition",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterContentBlocks",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",Array)],E,"getSelectedChapterTimelineMap",null),h([(0,e.MD)(),p("design:type",Function),p("design:paramtypes",[y.G]),p("design:returntype",void 0)],E,"isLastChapter",null),E=D=h([(0,e.Uw)({name:"storyChapters",defaults:te}),p("design:paramtypes",[e.il,X.j,I.O,H,R.w,Z.J])],E)},93915:(be,q,d)=>{"use strict";d.d(q,{$K:()=>b,$y:()=>S,D3:()=>U,Ds:()=>w,HP:()=>I,S3:()=>m,Sh:()=>X,TR:()=>M,Tz:()=>f,eH:()=>C,gJ:()=>l,h5:()=>$,lb:()=>V,sW:()=>e,tH:()=>L,u1:()=>O,vf:()=>T,vx:()=>j,yi:()=>y});var c=d(15375);let e=(()=>{class v{static#e=this.type="[Story Labels] Patch Labels";constructor(R){this.patches=R}}return v})(),y=(()=>{class v{static#e=this.type="[Story Labels] Set label Offset";constructor(R,N){this.labelId=R,this.offset=N}}return v})(),l=(()=>{class v{static#e=this.type="[Story Labels] Set Labels";constructor(R){this.labels=R}}return v})(),X=(()=>{class v{static#e=this.type="[Story Labels] Add Label";constructor(R,N=!1){this.label=R,this.record=N}}return v})(),$=(()=>{class v{static#e=this.type="[Story Labels] Set Contexdt Label";constructor(R){this.label=R}}return v})(),j=(()=>{class v{static#e=this.type="[Story Labels] Remove Label";constructor(R){this.label=R}}return v})(),m=(()=>{class v{static#e=this.type="[Story Labels] Remove Context Label";constructor(){}}return v})(),O=(()=>{class v{static#e=this.type="[Story Labels] Remove All Chapter Labels";constructor(R,N=!1){this.chapter=R,this.record=N}}return v})(),V=(()=>{class v{static#e=this.type="[Story Labels] Set Label";constructor(R,N=!1){this.label=R,this.record=N}}return v})(),I=(()=>{class v{static#e=this.type="[Story Labels] Set Label States";constructor(R,N){this.id=R,this.states=N}}return v})(),L=(()=>{class v{static#e=this.type="[Story Labels] Set Label Scale";constructor(R){this.scale=R}}return v})(),M=(()=>{class v{static#e=this.type="[Story Labels] Select Label";constructor(R){this.label=R}}return v})(),S=(()=>{class v{static#e=this.type="[Story Labels] Reset";constructor(){}}return v})(),b=(()=>{class v{static#e=this.type="[Story Labels] Convert";constructor(R,N){this.labels=R,this.fields=N}}return v})(),f=(()=>{class v{static#e=this.type="[Story Labels] Enable Context Label";constructor(R,N=!0,B=!0,Q=!0){this.enable=R,this.enableInfo=N,this.enableActions=B,this.enableAudio=Q}}return v})(),U=(()=>{class v{static#e=this.type="[Story Labels] Set Labels Shown";constructor(R,N){this.labels=R,this.shown=N}}return v})(),C=(()=>{class v{static#e=this.type="[Story Labels] Set All Labels Shown";constructor(R){this.show=R}}return v})(),T=(()=>{class v{static#e=this.type="[Story Labels] Set Labels Collapsed";constructor(R,N=c.Q.None){this.collapsed=R,this.collapsedMode=N}}return v})(),w=(()=>{class v{static#e=this.type="[Story Labels] Set Draggable";constructor(R){this.draggable=R}}return v})()},66056:(be,q,d)=>{"use strict";d.d(q,{Ck:()=>f,Hd:()=>j,Hy:()=>R,KM:()=>V,Nu:()=>Q,P5:()=>N,Pv:()=>O,S9:()=>T,Tt:()=>X,V_:()=>I,Ye:()=>e,Z0:()=>C,cX:()=>l,dC:()=>b,dr:()=>m,fK:()=>$,fn:()=>w,jj:()=>A,nm:()=>B,si:()=>S,t1:()=>U,ub:()=>M,yi:()=>L,yw:()=>v});var c=d(11040);let e=(()=>{class H{static#e=this.type="[Story] Load Current Story";constructor(k,h,p=c.q.lang,D=!1){this.id=k,this.type=h,this.lang=p,this.preview=D}}return H})(),l=(()=>{class H{static#e=this.type="[Story] Replace the Story";constructor(k){this.story=k}}return H})(),X=(()=>{class H{static#e=this.type="[Story] Set the Story ID";constructor(k){this.id=k}}return H})(),$=(()=>{class H{static#e=this.type="[Story] Set Story Text";constructor(k){this.displayName=k}}return H})(),j=(()=>{class H{static#e=this.type="[Story] Set Story Tags";constructor(k){this.tags=k}}return H})(),m=(()=>{class H{static#e=this.type="[Story] Set Story Playthrough";constructor(k){this.playthroughSettings=k}}return H})(),O=(()=>{class H{static#e=this.type="[Story] Set Story Source Info";constructor(k){this.sourceInfo=k}}return H})(),V=(()=>{class H{static#e=this.type="[Story] Set Story Light Libs";constructor(k){this.lightLibs=k}}return H})(),I=(()=>{class H{static#e=this.type="[Story] Load Manifests"}return H})(),L=(()=>{class H{static#e=this.type="[Story] Set Incoming Story Id";constructor(k,h,p){this.id=k,this.type=h,this.reset=p}}return H})(),M=(()=>{class H{static#e=this.type="[Story] Load Story Chunk";constructor(){}}return H})(),S=(()=>{class H{static#e=this.type="[Story] Reorder Load Chunks";constructor(k){this.chapterId=k}}return H})(),b=(()=>{class H{static#e=this.type="[Story] Load Story Chunk Success";constructor(k){this.chapter=k}}return H})(),f=(()=>{class H{static#e=this.type="[Story] Build Story In Engine From Story Model";constructor(k,h,p,D,te=!0){this.id=k,this.story=h,this.type=p,this.chapterIdx=D,this.replaceActiveStory=te}}return H})(),U=(()=>{class H{static#e=this.type="[Story] Build Story Success";constructor(k,h,p){this.story=k,this.id=h,this.type=p}}return H})(),C=(()=>{class H{static#e=this.type="[Story] Load Success";constructor(k,h,p,D){this.story=k,this.id=h,this.type=p,this.lang=D}}return H})(),T=(()=>{class H{static#e=this.type="[Story] Load Fail";constructor(k,h){this.id=k,this.type=h}}return H})(),w=(()=>{class H{static#e=this.type="[Story] Import";constructor(k,h,p=c.q.lang){this.id=k,this.type=h,this.lang=p}}return H})(),v=(()=>{class H{static#e=this.type="[Story] Import Success";constructor(k,h,p){this.story=k,this.id=h,this.type=p}}return H})(),A=(()=>{class H{static#e=this.type="[Story] Clear";constructor(){}}return H})(),R=(()=>{class H{static#e=this.type="[Story] Synchronize Chapters";constructor(){}}return H})(),N=(()=>{class H{static#e=this.type="[Story] Human Ready (Web)";constructor(){}}return H})(),B=(()=>{class H{static#e=this.type="[Story] Human Ready (SDK)";constructor(){}}return H})(),Q=(()=>{class H{static#e=this.type="[Story] Merge Bridge Module Success";constructor(k){this.story=k}}return H})()},26657:(be,q,d)=>{"use strict";d.d(q,{Z:()=>e,o:()=>c});class c{}class e{}},82323:(be,q,d)=>{"use strict";d.d(q,{V9:()=>X,W2:()=>y,WX:()=>$,cf:()=>l});var c=d(10352),e=d(9592);let y=(()=>{class j{static#e=this.type="[Story Chapters] Register thumbnail URLs from story";constructor(O){this.thumbnails=O}}return j})(),l=(()=>{class j{static#e=this.type="[Story Chapters] Set chapter thumbnail";constructor(O,V){this.chapterId=O,this.thumbnail=V}}return j})(),X=(()=>{class j{static#e=this.type="[Story Chapters] Take picture";constructor(O,V=c.RK,I=e.H.JPEG,L=.92,M,S="original",b,f,U=[]){this.chapterId=O,this.background=V,this.imageType=I,this.imageQuality=L,this.dimensions=M,this.crop=S,this.includeLabels=b,this.includeCopyright=f,this.layers=U}}return j})(),$=(()=>{class j{static#e=this.type="[Story Chapters] Take picture success";constructor(O,V,I){this.chapterId=O,this.blob=V,this.dimensions=I}}return j})()},65650:(be,q,d)=>{"use strict";d.d(q,{K:()=>M});var c=d(92014),y=d(82323),l=d(1308),X=d(97415),$=d(57238),j=d(30582),m=d(81025),O=d(54438),V=function(S,b,f,U){var w,C=arguments.length,T=C<3?b:null===U?U=Object.getOwnPropertyDescriptor(b,f):U;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(S,b,f,U);else for(var v=S.length-1;v>=0;v--)(w=S[v])&&(T=(C<3?w(T):C>3?w(b,f,T):w(b,f))||T);return C>3&&T&&Object.defineProperty(b,f,T),T},I=function(S,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(S,b)};const L={thumbnails:new Map};let M=class ud{static getRegisteredThumbnails(b){return b.thumbnails}registerChapterThumbnails(b,f){b.patchState(m.jM(b.getState(),U=>{U.thumbnails=new Map(f.thumbnails)}))}setChapterThumbnail(b,f){b.patchState(m.jM(b.getState(),U=>{U.thumbnails.set(f.chapterId,f.thumbnail)}))}takeChapterPicture(b,f){const{background:U,chapterId:C,includeLabels:T,includeCopyright:w,dimensions:v,imageType:A,imageQuality:R,crop:N,layers:B}=f,Q=v||X.I.large,{width:H,height:Z}=Q,k=(0,l.F$)(A,U),h=this.snapshotService.getLogoFromBackground(U),p={...l._,crop:N,imageType:A,imageQuality:R,copyrightEnabled:w,copyrightImagePath:h.logo_url};this.snapshotService.takeSnapshot(H,Z,k,B,T,p).subscribe(D=>{b.dispatch(new y.WX(C,D,Q))})}takeChapterPictureSuccess(b,f){b.patchState(m.jM(b.getState(),U=>{const C=U.thumbnails.get(f.chapterId)||new $.R;C.snapshot=URL.createObjectURL(f.blob),U.thumbnails.set(f.chapterId,C)}))}constructor(b,f){this.snapshotService=b,this.store=f}static#e=this.\u0275fac=function(f){return new(f||ud)(O.KVO(j.M),O.KVO(c.il))};static#t=this.\u0275prov=O.jDH({token:ud,factory:ud.\u0275fac})};V([(0,c.rc)(y.W2),I("design:type",Function),I("design:paramtypes",[Object,y.W2]),I("design:returntype",void 0)],M.prototype,"registerChapterThumbnails",null),V([(0,c.rc)(y.cf),I("design:type",Function),I("design:paramtypes",[Object,y.cf]),I("design:returntype",void 0)],M.prototype,"setChapterThumbnail",null),V([(0,c.rc)(y.V9),I("design:type",Function),I("design:paramtypes",[Object,y.V9]),I("design:returntype",void 0)],M.prototype,"takeChapterPicture",null),V([(0,c.rc)(y.WX),I("design:type",Function),I("design:paramtypes",[Object,y.WX]),I("design:returntype",void 0)],M.prototype,"takeChapterPictureSuccess",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[class e{}]),I("design:returntype",void 0)],M,"getRegisteredThumbnails",null),M=V([(0,c.Uw)({name:"storyThumbnails",defaults:L}),I("design:paramtypes",[j.M,c.il])],M)},16606:(be,q,d)=>{"use strict";d.d(q,{J:()=>k});var c=d(28407),e=d(15877),y=d(46104),l=d(38399),X=d(36110),$=d(28577),j=d(26657),m=d(4959),O=d(17766),V=d(72849),I=d(11789),L=d(24418),M=d(13976),S=d(43753),b=d(12347),f=d(85586),U=d(33013),C=d(65881),T=d(49204),v=d(63745),A=d(47632),R=d(66056),N=d(54438),B=d(21626),Q=d(92014),H=d(60177);function Z(h,p,D){return p===O.c.Bookmark?`/search/bookmarks/tr/${D}/${h}`:`/tr/${D}/${h}.json`}let k=(()=>{class h{constructor(D,te,E,K,u,x,z){this.http=D,this.animationService=te,this.engineService=E,this.chapterService=K,this.contentBlocksService=u,this.store=x,this.location=z}getLoadChapter(D,te){const E=new j.Z;return E.activate=!1,E.chapterId=te.id,E.readyState={model:!0,animation:!0},E}getStory(D,te,E="en"){const K=te===O.c.Bookmark?this.getBookmark(D):this.getContent(D);if("en"===E)return K;{let u;return K.pipe((0,l.q)(x=>(u=x,this.getStoryTranslation(D,te,E)))).pipe((0,X.T)(x=>this.translateStory(u,x)),(0,$.W)(()=>K))}}getContentRoot(){return!0===L.c.offline?typeof localBaseDirectory>"u"?"":localBaseDirectory:"/"}getContent(D){return this.http.get(this.getContentRoot()+`content/modules/${D}.json`).pipe((0,X.T)(te=>this.normalizeStory(te)))}getBookmark(D){return this.http.get("/search/bookmarks/data",{params:{be:D}}).pipe((0,X.T)(te=>this.normalizeStory(te.bookmark)))}addContentRecord(D,te){te.createdFrom||(te.createdFrom=[]),te.createdFrom.unshift({id:(0,v.u2)(D),timestamp:Date.now()})}loadNewBookmark(D,te,E,K){const u=D.id,x=D.type,z=new URLSearchParams(document.location.search);z.set("id",u),this.location.replaceState(document.location.pathname,`?${z.toString()}`),this.store.dispatch(new A.sN(D)),this.store.dispatch(new R.Ck(u,te,x,K,E))}checkStoryIdChange(D,te){return(0,v.u2)(D)!==(0,v.u2)(te)}getMorphManifest(D){return this.http.get(`/content/states/${D}/animations/morphs/manifest`).pipe((0,X.T)(te=>[D,te]))}getLargestKeyFromManifest(D){const te=Object.values(D.morphs).map(E=>E.keys[E.keys.length-1]);return Math.max(...te)}findMorphEndTimes(D){const te=new Set;if(D.forEach(E=>{E.renderables.filter(({morphId:K})=>!(0,T.isNil)(K)).forEach(({morphId:K})=>{te.add(K.split("/")[0])})}),0===te.size)return(0,e.of)({});{const E=Array.from(te).map(K=>this.getMorphManifest(K));return(0,y.p)(E).pipe((0,X.T)(K=>K.reduce((u,[x,z])=>(u[x]=this.getLargestKeyFromManifest(z),u),{})))}}getTweenEndTimes(){const te={};return this.engineService.engine.story.chapters.forEach(E=>{const{tweens:K}=E;Object.keys(K).forEach(u=>{const x=Object.values(K[u].tweens),z=Math.max(...x.map(ge=>ge.keys).flat()),oe=u.split("/")[0];z>(te[oe]??0)&&(te[oe]=z)})}),te}getStoryChapters(D,te,E){return te.chapters.map((K,u)=>this.chapterService.getChapter(D,te,E,K,u))}getStoryLoadChapters(D){return D.chapters.map(E=>this.getLoadChapter(D,E))}loadChapter(D){var te=this;return(0,c.A)(function*(){const E=te.engineService.engine.story.chapters,K=te.store.selectSnapshot(f.N.getStoryChapters),u=te.store.selectSnapshot(f.N.getSelectedChapterIndex),x=K.findIndex(oe=>oe.id===D.chapterId),z=E[x];return z.load().then(()=>x===u?te.animationService.setChapter(D.chapterId):z.id)})()}addChapterToEngine(D,te){var E=this;return(0,c.A)(function*(){const u=E.chapterService.processChapterForEngine(D),x=E.engineService.engine.story.createChapter(u,te);return E.engineService.engine.story.chapters[x].load().then(()=>{E.store.dispatch(new U.yz(D))})})()}removeChapterFromEngine(D){this.engineService.engine.story.chapters.splice(D,1)}moveChapterInEngine(D,te){var E=this;return(0,c.A)(function*(){const K=E.engineService.engine?.story?.activeChapter?.id,u=E.engineService.engine?.story?.chapters.splice(D,1).pop();if(E.engineService.engine.story.chapters.splice(te,0,u),u.id===K)return E.animationService.setChapter(u.id,!0).then(()=>u.id)})()}getStoryTranslation(D,te,E){const K=Z(D,te,E);return this.http.get(K)}getStoryLang(D,te,E){if("en"===E)return(0,e.of)("en");const K=Z(D,te,E);return this.http.head(K).pipe((0,X.T)(()=>!0),(0,$.W)(()=>(0,e.of)(!1)),(0,X.T)(u=>u?E:"en"))}getStoryType(D){return D.indexOf("/")>=0?O.c.Module:O.c.Bookmark}translateStory(D,te){const K=D.chapters||[],u=D.sceneGraph||[],x=te.objects||{},z=te.chapters||[];return D.displayName=te.displayName||D.displayName,D.description=te.description||D.description,u.forEach(oe=>{(oe.objects||[]).forEach(ie=>{this.translateObject(ie,x)})}),K.forEach((oe,ge)=>{const ie=z[ge];if(ie){this.translateMetaInfo(oe,ie);const W=ie.annotations||[];(oe.annotations||[]).forEach((we,Qe)=>{const tt=W[Qe];tt&&this.translateMetaInfo(we,tt)});const re=ie.hotspots||[];(oe.hotspots||[]).forEach((we,Qe)=>{const tt=re[Qe];tt&&this.translateMetaInfo(we,tt)});const se=ie.quizQuestions||[];(oe.quizQuestions||[]).forEach((we,Qe)=>{const tt=se[Qe];tt&&this.translateQuizQuestion(we,tt)});const pe=oe?.contentBlocks,Te=ie?.contentBlocks;Array.isArray(pe)&&Array.isArray(Te)&&pe.forEach((we,Qe)=>{const tt=Te[Qe];tt&&this.translateContentBlock(we,tt)})}}),D}translateQuizQuestion(D,te){if(te.nextLabel&&(D.nextLabel=te.nextLabel),["questionPrompt","explanation"].forEach(E=>{const u=te[E]||[];(D[E]||[]).forEach((x,z)=>{const oe=u[z];oe&&(x.markdown=oe.markdown)})}),D.data&&te.data){const K=te.data.options||[];(D.data.options||[]).forEach((u,x)=>{const z=K[x];z&&(D.type===S.Q5.LabelAnatomy?this.translateMetaInfo(u.label,z.label):u.label=z.label)})}}translateMetaInfo(D,te){const{title:E,description:K}=te;D.hasOwnProperty("displayName")&&(D.displayName=E),D.hasOwnProperty("title")&&(D.title=E),D.hasOwnProperty("description")&&(D.description=K)}translateObject(D,te){const K=te[D.objectId];K&&(D.displayName=K);const u=D.objects;u&&u.forEach(x=>{this.translateObject(x,te)})}translateContentBlock(D,te){(0,T.merge)(D,te)}exportWrittenContent(D,te,E){const K=[];return K.push(`\n${D.displayName}\n    `),te.forEach((u,x)=>{K.push(`\n---\n\n# Chapter ${x+1}: ${u.displayName||"-No Title-"}\n\n${u.description||"-No Description-"}\n      `),u.legend.length&&(K.push("\n## Legend\n"),u.legend.forEach(oe=>{K.push(`\n* ${oe.label} (${I.T.rgbToHex(oe.colors,!0)})\n`)}));const z=E.filter(oe=>oe.chapterId===u.id);z.length&&(K.push("\n## Labels\n"),z.forEach(oe=>{K.push(`\n* ${oe.title}\n`),oe.description&&K.push(`\n  > ${oe.description}\n`)}))}),K.join("")}exportQuizKey(D){const te=[];return D.forEach((E,K)=>{switch(te.push(`\n# QUESTION ${K+1} (${S.of[E.type]})\n\n## PROMPT\n${this.contentBlocksService.extractContentBlockText(E.questionPrompt)}\n      `),E.type){case S.Q5.MultipleChoice:E.data.options.forEach((u,x)=>{te.push(`\n## ANSWER ${x+1} ${E.data.correctAnswer===u.value?"- CORRECT":""}\n${u.label}\n            `)});break;case S.Q5.SelectAnatomy:te.push("\n## ANSWERS\n          "),E.data.correctAnswer.forEach((u,x)=>{te.push(`\n${u}\n            `)});break;case S.Q5.LabelAnatomy:E.data.options.forEach((u,x)=>{te.push(`\n## ANSWER ${x+1}\n${u.label.title}\n            `)})}this.contentBlocksService.extractContentBlockText(E.explanation).length&&te.push(`\n  \n## EXPLANATION\n${this.contentBlocksService.extractContentBlockText(E.explanation)}\n        `),te.push("\n\n\n      ")}),te.join("")}normalizeStory(D){return D.chapters.forEach(te=>{te.id||(te.id=(0,C.G)())}),D}static#e=this.\u0275fac=function(te){return new(te||h)(N.KVO(B.Qq),N.KVO(b.O),N.KVO(V.y),N.KVO(m.j),N.KVO(M.V),N.KVO(Q.il),N.KVO(H.aZ))};static#t=this.\u0275prov=N.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},63508:(be,q,d)=>{"use strict";d.d(q,{Mi:()=>l,Uv:()=>y});var c=d(49204);function y(O){return!!("lights"in O&&Array.isArray(O?.lights.libraries)||"environment"in O&&!(0,c.isEmpty)(O?.environment))}function l(O){return"lightLibraryId"in O}},75069:(be,q,d)=>{"use strict";var c,e;d.d(q,{a:()=>c}),(e=c||(c={})).Reset=(()=>{class m{static#e=this.type="[Undo] Reset";constructor(){}}return m})(),e.Undo=(()=>{class m{static#e=this.type="[Undo] Undo";constructor(V){this.chapterId=V}}return m})(),e.UndoAll=(()=>{class m{static#e=this.type="[Undo] Undo All";constructor(V){this.chapterId=V}}return m})(),e.Redo=(()=>{class m{static#e=this.type="[Undo] Redo";constructor(V){this.chapterId=V}}return m})(),e.SavePatches=(()=>{class m{static#e=this.type="[Undo] Store Patches";constructor(V){this.patches=V}}return m})()},79083:(be,q,d)=>{"use strict";d.d(q,{H:()=>c});var c=function(e){return e.BioDigital="biodigital",e.Wikipedia="wikipedia",e.NCIT="ncit",e}(c||{})},63745:(be,q,d)=>{"use strict";d.d(q,{N9:()=>C,lm:()=>j,mF:()=>X,u2:()=>$});var c=d(11789);const l=["ui-bd.class","ui-play-pause","ui-camera-mode","ui-center","ui-cross-section","ui-dissect","ui-fs","ui-tools-display","ui-tree","ui-zoom","ui-zoom-in","ui-zoom-out","ui-pan","ui-share","ui-keys","ui-slider","o","background.color-stops","background.gradient-type","dd","dn","image-display","imageDisplay","imageSrc","pre","referrer"];function X(T){const{id:w,s:v,m:A,be:R,b:N}=T;let B="";if(w)B=w;else if(R)B=R;else if(N){const Q=parseInt(N,10);B=Number.isNaN(Q)?"":function m(T){const v=(B,Q)=>[Math.floor(B/Q),B%Q],A=[];let N,R=T;for(;R>0;)[R,N]=v(R,62),A.unshift("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[N]);return A.join("")}(Q)}else A&&(B=function O(T,w="male"){return T.includes("/")?T:`production/${w}Adult/${T}`}(A,"female"===v?"female":"male"));return $(B)}function $(T){return T.replace(/\.json$/,"")}function j(T){return X(T).includes("/")?"module":"bookmark"}const V={type:T=>j(T),id:T=>X(T),background:T=>T.bgstd||T["background.colors"]||T.background};function M(T){if(3===T.length){const{0:w,1:v,2:A}=T;return{x:w,y:v,z:A}}return null}const f={camera:function S(T){const w=T.split(",").map(A=>parseFloat(A));if(w.length%3!=0||w.some(A=>Number.isNaN(A)))return null;{const A=w.slice(0,3),R=w.slice(3,6),N=w.slice(6,9);return{eye:M(A),look:M(R),up:M(N)}}},background:function b(T){const w=c.T.getColors(T);return w?{colors:[...w[0][255],...w[1][255]],gradientType:"radial",colorStops:[0,100]}:null}};function U(T){const w=v=>{if(v){const A=v.toLowerCase();if("true"===A)return!0;if("false"===A)return!1;if(!isNaN(Number(A)))return Number(A)}return v};return Object.keys(T).reduce((v,A)=>{const N=(f[A]||w)(T[A]);return"load-rotate"===A&&isNaN(Number(N))||(v[A]=N),v},{})}function C(T){const w=function I(T){const w=Object.keys(T),v=w.filter(A=>l.includes(A));if(v.length>0){const A=[`The following URL parameters have been deprecated: "${v.join('", "')}"`,"Please contact support@biodigital.com for more information."];console.warn(A.join("\n"))}return w.reduce((A,R)=>(l.includes(R)&&delete A[R],A),T)}(T),v=function L(T){return Object.keys(V).filter(w=>typeof T[w]>"u").reduce((w,v)=>{const R=(0,V[v])(T);return typeof R<"u"&&(w[v]=R),w},T)}(w);return U(v)}},9984:(be,q,d)=>{"use strict";d.d(q,{I:()=>c});var c=function(e){return e.Inactive="Inactive",e.Valid="Valid",e.Invalid="Invalid",e.Missing="Missing",e}(c||{})},59038:(be,q,d)=>{"use strict";d.d(q,{H:()=>c});const c={inline:!1,"immersive-ar":!1,"immersive-vr":!1}},48570:(be,q,d)=>{"use strict";var c,e;d.d(q,{W:()=>c}),(e=c||(c={})).SetEnabled=(()=>{class M{static#e=this.type="[XR] Set XR Enabled";constructor(b){this.enabled=b}}return M})(),e.SetSession=(()=>{class M{static#e=this.type="[XR] Set XR Session";constructor(b,f,U,C){this.active=b,this.session=f,this.sessionMode=U,this.supportedModes=C}}return M})(),e.SetXRState=(()=>{class M{static#e=this.type="[XR] Set XR State";constructor(b){this.value=b}}return M})(),e.EnterXR=(()=>{class M{static#e=this.type="[XR] Enter XR";constructor(b="immersive-vr"){this.sessionMode=b}}return M})(),e.ExitXR=(()=>{class M{static#e=this.type="[XR] Exit XR";constructor(b=!1){this.closeTab=b}}return M})(),e.SetARSelectingLocation=(()=>{class M{static#e=this.type="[XR] Set XR Selecting Location";constructor(b){this.selectingLocation=b}}return M})(),e.SetARSelectingLocationVisible=(()=>{class M{static#e=this.type="[XR] Set XR Selecting Location Visible";constructor(b){this.visible=b}}return M})(),e.SetARLocation=(()=>{class M{static#e=this.type="[XR] Set AR Location";constructor(){}}return M})(),e.SetARLocationSuccess=(()=>{class M{static#e=this.type="[XR] Set AR Location Success";constructor(){}}return M})(),e.SetARLocationFail=(()=>{class M{static#e=this.type="[XR] Set AR Location Fail";constructor(){}}return M})()},32724:(be,q,d)=>{"use strict";d.d(q,{U:()=>M});var c=d(92014),e=d(59038),y=d(48570),l=d(51196),X=d(17215),$=d(90699),j=d(36860),m=d(9984),O=d(54438),V=function(S,b,f,U){var w,C=arguments.length,T=C<3?b:null===U?U=Object.getOwnPropertyDescriptor(b,f):U;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)T=Reflect.decorate(S,b,f,U);else for(var v=S.length-1;v>=0;v--)(w=S[v])&&(T=(C<3?w(T):C>3?w(b,f,T):w(b,f))||T);return C>3&&T&&Object.defineProperty(b,f,T),T},I=function(S,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(S,b)};const L={enabled:!1,active:!1,requesting:!1,selectingLocation:!1,error:!1,session:null,sessionMode:null,supportedModes:{...e.H},platform:$.I.All,placementState:m.I.Inactive};let M=class hd{constructor(b,f,U){this.xrService=b,this.storageService=f,this.platform=U}ngxsOnInit(b){const{IOS:f,ANDROID:U}=this.platform;b.patchState({enabled:!1,platform:U?$.I.Android:f?$.I.iOS:$.I.All}),this.xrService.getSelecting().subscribe(T=>{b.patchState({selectingLocation:T})}),this.xrService.getPlacementState().subscribe(T=>{b.patchState({placementState:T})})}static getXREnabled(b){return b.enabled}static getXRSupported(b,f){return b&&Object.values(f).some(U=>U)}static getVREnabled(b,f){return b&&f["immersive-vr"]}static getAREnabled(b,f){return b&&f["immersive-ar"]}static getNativeAREnabled(b,f){return b&&"ios"===f}static getXRActive(b){return b.active}static getVRActive(b,f){return b&&"immersive-vr"===f}static getARActive(b,f){return b&&"immersive-ar"===f}static getXROverlayType(b){return b.session?.domOverlayState?.type||""}static getXRSessionMode(b){return b.sessionMode}static getXRSupportedModes(b){return b.supportedModes}static getXRError(b){return!0===b.error}static getXRRequesting(b){return b.requesting}static getXRPlatform(b){return b.platform}static getSelectingLocation(b){return b.selectingLocation}static getPlacementState(b){return b.placementState}setXRState(b,f){b.setState(f.value)}setEnabled(b,f){b.patchState({enabled:f.enabled})}enterXR(b,f){b.patchState({requesting:!0}),this.xrService.enterXR(f.sessionMode).then(()=>{console.log("Enter XR Success"),b.patchState({error:!1}),"immersive-ar"===f.sessionMode&&b.dispatch(new y.W.SetARSelectingLocation(!0))}).catch(U=>{console.warn("Enter XR Fail",U),b.patchState({error:!0})}).finally(()=>{b.patchState({requesting:!1})})}exitXR(b,{closeTab:f}){this.xrService.exitXR(),f&&window.close(),console.log("Exit XR Success")}setSession(b,f){b.patchState({active:f.active,session:f.session,sessionMode:f.sessionMode,supportedModes:{...e.H,...f.supportedModes},error:!1})}setXRSelectingLocation(b,{selectingLocation:f}){this.xrService.selectingLocation=f,b.patchState({selectingLocation:f}),b.dispatch(new y.W.SetARSelectingLocationVisible(!0))}setARSelectingLocationVisible(b,{visible:f}){this.xrService.selectingLocationVisible=f}SetXRLocation(b){this.xrService.selectLocation().then(f=>{b.dispatch(f?new y.W.SetARLocationSuccess:new y.W.SetARLocationFail)}).catch(f=>{b.dispatch(new y.W.SetARLocationFail)})}static#e=this.\u0275fac=function(f){return new(f||hd)(O.KVO(l.S),O.KVO(X.n$),O.KVO(j.OD))};static#t=this.\u0275prov=O.jDH({token:hd,factory:hd.\u0275fac})};V([(0,c.rc)(y.W.SetXRState),I("design:type",Function),I("design:paramtypes",[Object,y.W.SetXRState]),I("design:returntype",void 0)],M.prototype,"setXRState",null),V([(0,c.rc)(y.W.SetEnabled),I("design:type",Function),I("design:paramtypes",[Object,y.W.SetEnabled]),I("design:returntype",void 0)],M.prototype,"setEnabled",null),V([(0,c.rc)(y.W.EnterXR),I("design:type",Function),I("design:paramtypes",[Object,y.W.EnterXR]),I("design:returntype",void 0)],M.prototype,"enterXR",null),V([(0,c.rc)(y.W.ExitXR),I("design:type",Function),I("design:paramtypes",[Object,y.W.ExitXR]),I("design:returntype",void 0)],M.prototype,"exitXR",null),V([(0,c.rc)(y.W.SetSession),I("design:type",Function),I("design:paramtypes",[Object,y.W.SetSession]),I("design:returntype",void 0)],M.prototype,"setSession",null),V([(0,c.rc)(y.W.SetARSelectingLocation),I("design:type",Function),I("design:paramtypes",[Object,y.W.SetARSelectingLocation]),I("design:returntype",void 0)],M.prototype,"setXRSelectingLocation",null),V([(0,c.rc)(y.W.SetARSelectingLocationVisible),I("design:type",Function),I("design:paramtypes",[Object,y.W.SetARSelectingLocationVisible]),I("design:returntype",void 0)],M.prototype,"setARSelectingLocationVisible",null),V([(0,c.rc)(y.W.SetARLocation),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M.prototype,"SetXRLocation",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXREnabled",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXREnabled,M.getXRSupportedModes]),I("design:type",Function),I("design:paramtypes",[Boolean,Object]),I("design:returntype",Boolean)],M,"getXRSupported",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXREnabled,M.getXRSupportedModes]),I("design:type",Function),I("design:paramtypes",[Boolean,Object]),I("design:returntype",void 0)],M,"getVREnabled",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXREnabled,M.getXRSupportedModes]),I("design:type",Function),I("design:paramtypes",[Boolean,Object]),I("design:returntype",void 0)],M,"getAREnabled",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXREnabled,M.getXRPlatform]),I("design:type",Function),I("design:paramtypes",[Boolean,String]),I("design:returntype",void 0)],M,"getNativeAREnabled",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRActive",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXRActive,M.getXRSessionMode]),I("design:type",Function),I("design:paramtypes",[Boolean,String]),I("design:returntype",void 0)],M,"getVRActive",null),V([(0,c.Um)({injectContainerState:!1}),(0,c.MD)([M.getXRActive,M.getXRSessionMode]),I("design:type",Function),I("design:paramtypes",[Boolean,String]),I("design:returntype",void 0)],M,"getARActive",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXROverlayType",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRSessionMode",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRSupportedModes",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRError",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRRequesting",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getXRPlatform",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getSelectingLocation",null),V([(0,c.MD)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],M,"getPlacementState",null),M=V([(0,c.Uw)({name:"xr",defaults:L}),I("design:paramtypes",[l.S,X.n$,j.OD])],M)},51196:(be,q,d)=>{"use strict";d.d(q,{S:()=>Q});var c=d(28407),e=d(59038),y=d(11724),X=d(9556),$=d(38472),j=d(48570),m=d(46799),O=d(72849),V=d(29160),I=d(85052),L=d(9984),M=d(54438),S=d(92014);const b=[120,120,120,255].map(H=>H/255),v=[1,1,1],A=[1,0,0],R=Math.cos(30*Math.PI/180),N=[0,1,0],B=[0,0,0,1];let Q=(()=>{class H{constructor(k,h,p){this.store=k,this.engineService=h,this.engineRendererService=p,this.presentingXR=null,this._trackingPose=!1,this._placementState=new V.t(L.I.Inactive),this.objectSelectedSubject=new I.B,this.xrViewerSpace=null,this.xrHitTestSource=null,this.hitTestResult=null,this.xrAnchor=null,this.hitTestReticle=null,this.hitTestReticleMaterial=null,this._selectingLocation=new V.t(!1),this._selectingLocationVisible=!0}initXR(k){var h=this;const{renderer:p}=k,D={...e.H},te=function(){var K=(0,c.A)(function*(){if(h.presentingXR){const u=h.presentingXR,x=yield h.getRefSpace(u.session,k);u===h.presentingXR&&(p.xrRefSpace=x)}});return function(){return K.apply(this,arguments)}}(),E=({frame:K,inputSource:u})=>{if("screen"===u.targetRayMode){const x=K.getPose(u.targetRaySpace,k.renderer.xrRefSpace),z=this.engineRendererService.pickMatrix(x.transform.matrix);this.objectSelectedSubject.next(z)}};if(!this._xr){const K=oe=>(0,c.A)(function*(){const{presenting:ge,session:ie,sessionMode:Y,supported:W}=oe;if(ge?h.presentingXR=oe:oe===h.presentingXR&&(h.presentingXR=null,p.xrSession=null,p.xrRefSpace=null,k.contentNode.setMatrix([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),ie&&!p.xrSession){const Ee=yield h.getRefSpace(ie,k);p.xrRefSpace=Ee,p.xrSession=ie,ie.addEventListener("reset",te)}ge||(h._trackingPose=!1,h.placementState=L.I.Inactive),h.initializeHitTests(),ge&&"immersive-vr"===Y?k.renderer.setXRClearColor(...b):k.renderer.setXRClearColor(0,0,0,0),ge&&"immersive-ar"===Y&&h.presentingXR?.session?.addEventListener("select",E),D[Y]=W,h.store.dispatch(new j.W.SetSession(null!==h.presentingXR,ie,h.presentingXR?.sessionMode||null,D))}),u=["local-floor","bounded-floor","hand-tracking"];p.extensions.includes("OCULUS_multiview")&&u.push("layers");const x=new y.XR("immersive-vr",{optionalFeatures:u}),z=new y.XR("immersive-ar",{requiredFeatures:["local-floor"],optionalFeatures:["dom-overlay","hit-test","anchors"],domOverlay:{root:document.body}});this._xr={"immersive-vr":x,"immersive-ar":z},x.on("*",K(x)),z.on("*",K(z)),k.renderer.on("xrframe",({frame:oe,viewerPose:ge})=>{if(this._trackingPose=!!ge,!ge)return void(this.placementState=L.I.Missing);let ie=null;if(this.selectingLocation&&this.xrHitTestSource){const Y=oe.getHitTestResults(this.xrHitTestSource);this.hitTestResult=Y.length?Y[0]:null,ie=this.hitTestResult?.getPose(k.renderer.xrRefSpace)}if(ie){const Y=y.vec3Pool.get(),{x:W,y:Ee,z:re,w:Se}=ie.transform.orientation;X.set(B,W,Ee,re,Se),$.transformQuat(Y,N,B);const se=$.dot(Y,N);y.vec3Pool.release(Y),this.placementState=se<R?L.I.Invalid:L.I.Valid}else this.placementState=L.I.Missing;if(this.hitTestReticle&&this.selectingLocationVisible&&(ie?(this.hitTestReticle.parent=k.rootNode,this.hitTestReticle.setWorldMatrix(ie.transform.matrix),$.copy(this.hitTestReticleMaterial.baseColor,this.placementState===L.I.Invalid?A:v),this.hitTestReticleMaterial.emit("change",{material:this.hitTestReticleMaterial,property:"baseColor"})):this.hitTestReticle.parent=null),this.xrAnchor&&oe.trackedAnchors?.has(this.xrAnchor)){const Y=oe.getPose(this.xrAnchor.anchorSpace,k.renderer.xrRefSpace);k.contentNode.setMatrix(Y.transform.matrix)}})}}destroyXR(){this._xr?.["immersive-ar"].destroy(),this._xr?.["immersive-vr"].destroy(),this._xr=null,this.presentingXR=null}enterXR(k="immersive-vr"){if(!this._xr)throw new Error("Cannot enter XR. XR service has been destroyed.");return this._xr[k].enter()}exitXR(){this.hitTestReticle&&((0,y.traverseSceneNodes)(this.hitTestReticle,k=>{k instanceof y.BioDigitalMeshNode&&(k.geometry?.destroy(),k.geometry=null,k.material?.destroy(),k.material=null)}),this.hitTestReticle.destroy(),this.hitTestReticle=null,this.hitTestReticleMaterial=null),this.presentingXR?.exit()}getObjectSelecting(){return this.objectSelectedSubject.asObservable()}getSelecting(){return this._selectingLocation.asObservable()}getPlacementState(){return this._placementState.asObservable()}get trackingPose(){return this._trackingPose}get placementState(){return this._placementState.value}set placementState(k){k!==this._placementState.value&&this._placementState.next(k)}get session(){return this.presentingXR?.session??null}get canSelectLocation(){return!!this.presentingXR?.session?.requestHitTestSource&&this.presentingXR.session.enabledFeatures.indexOf("hit-test")>=0}get selectingLocation(){return this._selectingLocation.value}set selectingLocation(k){k!==this._selectingLocation.value&&(this._selectingLocation.next(k),this.engineService.engine.contentNode.parent=k?null:this.engineService.engine.rootNode)}get selectingLocationVisible(){return this._selectingLocationVisible}set selectingLocationVisible(k){this._selectingLocationVisible=k}selectLocation(){var k=this;return(0,c.A)(function*(){let h=!1;if(k.selectingLocation&&k.hitTestResult&&(k.selectingLocation=!1,"createAnchor"in k.hitTestResult))try{k.xrAnchor=yield k.hitTestResult.createAnchor(void 0),h=!0}catch(p){console.log("failed to get xrAnchor",p)}return h})()}getRefSpace(k,h){var p=this;return(0,c.A)(function*(){let D=null;try{D=yield k.requestReferenceSpace("bounded-floor")}catch{D=yield k.requestReferenceSpace("local-floor")}if(p.canSelectLocation)return D;const{bounds:te,story:E}=h,{module:K}=E,u=$.distance(te.min,te.max),x=E.module.chapters[E.activeChapterIndex],z=x.jumpTo||x.flyTo||K.camera,oe=y.vec3Pool.get(),ge=y.vec3Pool.get(),ie=y.vec3Pool.get(),Y=y.vec3Pool.get(),W=z?.eye||K.camera?.eye;if(W){const{x:Ue,y:yt,z:ke}=W;$.set(oe,Ue,yt,ke),$.scale(oe,oe,y.BIODIGITAL_SCENE_SCALE)}const Ee=z?.look||K.camera?.look;if(Ee){const{x:Ue,y:yt,z:ke}=Ee;$.set(ge,Ue,yt,ke),$.scale(ge,ge,y.BIODIGITAL_SCENE_SCALE)}$.subtract(ie,oe,ge),$.set(Y,ie[0],ie[1],0);const re=[0,0,0,1],Se=-Math.atan2(ie[0],ie[2]);X.fromEuler(re,0,180*Se/Math.PI,0);const se={x:re[0],y:re[1],z:re[2],w:re[3]},pe=Math.max(.6,.6*u,$.length(Y)),Qe={x:0,y:Math.max("screen-space"!==k.interactionMode?1.6-oe[1]:0,-te.min[1]),z:-pe,w:1};y.vec3Pool.release(Y),y.vec3Pool.release(ie),y.vec3Pool.release(ge),y.vec3Pool.release(oe);const tt=new XRRigidTransform(Qe,se);return D.getOffsetReferenceSpace(tt)})()}resetHitTests(){this.selectingLocation=!1,this.xrHitTestSource?.cancel(),this.xrHitTestSource=null,this.xrViewerSpace=null,this.xrHitTestSource=null,this.xrAnchor=null,this.hitTestReticle&&(this.hitTestReticle.parent=null)}initializeHitTests(){var k=this;return(0,c.A)(function*(){if(k.canSelectLocation)if(k.presentingXR?.session){if(k.xrViewerSpace=yield k.presentingXR.session.requestReferenceSpace("viewer"),k.xrHitTestSource=yield k.presentingXR.session.requestHitTestSource({space:k.xrViewerSpace}),!k.hitTestReticle){const h=yield fetch("assets/images/ar-position-reticle.png").then(D=>D.blob()),p=yield(0,y.loadImageBlobTexture)(h,{name:"ar-position-reticle"});k.hitTestReticle=new y.SceneNode,k.hitTestReticleMaterial=new y.UnlitMaterial({baseColor:[1,1,1],opacity:.4,baseColorMaps:[{texture:p,blendMode:"multiply"}],opacityMaps:[{texture:p,channel:"a"}]}),k.hitTestReticleMaterial.on("destroy",()=>{p.destroy()}),k.hitTestReticle.add(new y.BioDigitalMeshNode(new y.BioDigitalGeometry({position:[-1,0,1,1,0,1,1,0,-1,-1,0,-1],texcoord:[1,0,0,0,0,1,1,1],indices:[0,1,2,0,2,3]}),k.hitTestReticleMaterial,{scale:[.25,.25,.25]}))}}else k.resetHitTests();else k.resetHitTests()})()}static#e=this.\u0275fac=function(h){return new(h||H)(M.KVO(S.il),M.KVO(O.y),M.KVO(m.z))};static#t=this.\u0275prov=M.jDH({token:H,factory:H.\u0275fac,providedIn:"root"})}return H})()},24418:(be,q,d)=>{"use strict";d.d(q,{c:()=>X});var c=d(27180),e=d(17766),y=d(12215),l=d(92811);const X={production:!0,assetDomain:"assets-human.biodigital.com",supportEmail:"support@biodigital.com",googleAuthKey:"66261904577-061oin26uo7sor0vrqc8dnn105irq82n.apps.googleusercontent.com",googleAnalyticsId:"UA-1141985-29",linkedinId:"2641938",pendoId:"3a783681-e53b-4ebd-69c0-788bbae48f13",rollbarToken:"eccc0d971b014ed6abaf2d3172d2c709",hubspotId:"23868815",recaptchaV3Key:"6LdvZvcUAAAAAM0Z1St9WQXwvSYd__hMUY2WZ6um",recaptchaV2Key:"6LdtyhsUAAAAAF-hCYS1co8ZhnAEnzHlNhRMHSxE",application:c.c.Viewer,deploy:y.Z.Production,platform:l.N.SDK,exportType:e.c.Bookmark,offline:!1,native:!0,minPasswordLength:8}},27180:(be,q,d)=>{"use strict";d.d(q,{c:()=>c});var c=function(e){return e.Loft="Loft",e.Studio="Studio",e.Viewer="Viewer",e.All="",e}(c||{})},12215:(be,q,d)=>{"use strict";d.d(q,{Z:()=>c});var c=function(e){return e.Local="Local",e.QA="QA",e.Staging="Staging",e.Production="Production",e}(c||{})},92811:(be,q,d)=>{"use strict";d.d(q,{N:()=>c});var c=function(e){return e.Web="web",e.SDK="sdk",e}(c||{})},90699:(be,q,d)=>{"use strict";d.d(q,{I:()=>c});var c=function(e){return e.All="all",e.iOS="ios",e.Android="android",e}(c||{})},287:(be,q,d)=>{"use strict";d.d(q,{AY:()=>V,FV:()=>O,Nq:()=>M,dU:()=>j,kK:()=>S,sO:()=>m});var c=d(44867),e=d(56343);const $={trueWins:b=>({result:b.votesFor.length>0,dissenters:[...b.votesAgainst]}),falseWins:b=>({result:b.votesAgainst.length>0,dissenters:[...b.votesFor]}),majorityWins:b=>{const f=b.votesFor.length>b.votesAgainst.length;return{result:f,dissenters:f?[...b.votesAgainst]:[...b.votesFor]}}};function j(b,f){return b.reduce((U,C)=>(U[C]=f[C]||!1,U),{})}function m(b,f){return Object.keys(b).reduce((C,T)=>(C[T]=j(f,b[T]),C),{})}function O(b,f){const C=b.map(w=>(0,c.dV)(f,w).depth);return Math.max(0,...C)-1}function V(b,f,U){return(0,c.y$)(b,f).filter(T=>T&&(0,c.dV)(b,T).depth===U)}function M(b,f,U){return Object.keys(f).reduce((T,w)=>{const v=f[w],A=U[w]||e.t.MajorityWins,{result:R,dissenters:N}=$[A](v);return T[w]={id:b,result:R,dissenters:N,voters:[...v.votesFor,...v.votesAgainst]},T},{})}function S(b,f,U,C){const T=Object.keys(C);return{results:U.reduce((v,A)=>{const R=(0,c.IA)(b,A),N=R.map(H=>({[H]:f[H]||j(T,(0,c._D)(b,H,T))}));R.forEach(H=>{delete f[H]});const Q=M(A,function I(b,f){return b.reduce((U,C)=>{const T=function L(b,f){return b.reduce((U,C)=>{const T=Object.keys(C)[0];return C[T][f]?U.votesFor.push(T):U.votesAgainst.push(T),U},{votesFor:[],votesAgainst:[]})}(f,C);return U[C]=T,U},{})}(T,N),C);return f[A]=Object.entries(Q).reduce((H,[Z,k])=>(H[Z]=k.result,H),{}),v.push(Q),v},[]),remainingVoters:f}}},44867:(be,q,d)=>{"use strict";d.d(q,{DS:()=>$,IA:()=>I,If:()=>R,K$:()=>N,KJ:()=>h,Nk:()=>k,Sg:()=>l,TJ:()=>w,Wy:()=>C,_D:()=>L,bd:()=>Q,dV:()=>m,fm:()=>T,ir:()=>O,iu:()=>j,jX:()=>S,u7:()=>H,ug:()=>b,vU:()=>B,xe:()=>M,y$:()=>V});var c=d(23881),e=d(49204);function l(p,D){j(p,D);const te=m(p,D.id);p.roots[te.id]=te}function $(p,D,te=!1,E="ascending"){const K=te?[D]:[];let u=p.predecessors[D];for(;u;)K.push(u),u=p.predecessors[u];return"descending"===E&&K.reverse(),K}function j(p,D){p.nodes[D.id]||(p.nodes[D.id]=D)}function m(p,D){return p.nodes[D]??null}function O(p,D){return p.predecessors[D]??null}function V(p,D){const te=new Set;return D.forEach(E=>{const K=O(p,E);K&&te.add(K)}),Array.from(te)}function I(p,D){return[...p.successors[D]||[]]}function L(p,D,te){const E={},K=m(p,D);return Object.entries(K.boolState).forEach(([u,x])=>{te&&te.includes(u)&&(E[u]=x)}),Object.entries(K.numState).forEach(([u,x])=>{te&&te.includes(u)&&(E[u]=x)}),E}function M(p,D){return!!p.nodes[D]&&void 0===p.successors[D]}function S(p,D){return p.roots.hasOwnProperty(D)||!1}function b(p){return Object.keys(p.roots)}function U(p,D,te,E,K){const u=(0,c.vm)(te.objectId);u.depth=K,function f(p,D,te){Object.entries(te).forEach(([E,K])=>{const u=K(D.objectId);"boolean"==typeof u?p.boolState[E]=u:"number"==typeof u?p.numState[E]=u:p[E]=u})}(u,te,E),p.nodes[u.id]=u,D?(p.successors[D]=[...p.successors[D]||[],u.id],p.predecessors[u.id]=D):p.roots[u.id]=u,K+=1,te.children.forEach(z=>{U(p,u.id,z,E,K)})}function C(p,D,te){te?(D(te),I(p,te).forEach(E=>{(0,e.isNil)(E)||C(p,D,E)})):b(p).forEach(E=>{D(E),C(p,D,E)})}function T(p,D){const E=(0,c.q3)();return p.forEach(K=>{U(E,null,K,D,0)}),E}function w(p,D,te){const E=[];for(const K of p){const u=D[K.objectId],x=void 0===u?te:u,z=w(K.children||[],D,x);if(x){const oe={...K};oe.children=z,E.push(oe)}else z.forEach(oe=>E.push(oe))}return E}function v(p,D,te,E){const K=D?.[p];if("boolean"==typeof K)return K;{const u=te(p);return u?.length>0?v(u,D,te,E):E}}function A(p,D,te,E){const K=te(p);return 0===K.length?E:K.some(x=>!0===D?.[x])||K.some(x=>A(x,D,te,E))}function R(p,D,te,E){const K=A(p,D,E,void 0);return!(!1===v(p,D,te,void 0)&&(!1===K||void 0===K))}function N(p,D,te){return p.reduce((E,K)=>(E[K]=E[K]??!1,E),{...D,...te})}function B(p,D=!0){const{roots:te,successors:E,predecessors:K,nodes:u}=p,x=(0,c.q3)();for(const z in u){const oe=u[z];if(oe.boolState.available===D){x.nodes[z]=oe;const ie=K[z];ie&&(x.predecessors[z]=ie);const Y=E[z];Y&&(x.successors[z]=Y);const W=te[z];W&&(x.roots[z]=W)}}return x}function Q(p){const D={};for(const te in p){const E=p[te];E.available&&(D[te]=E)}return D}function H(p,D){const te=D?.titlesToLatin??{};return Object.values(p.nodes).forEach(E=>{const K=function Z(p,D){const{id:te,label:E}=D,K=p[E];if(K)return K;const x=p[h(te)];return x||void 0}(te,E);K&&(E.latinLabel=K)}),p}function k(p){const D=new RegExp(/\|:/,"gi");return p.replace(D,"_")}function h(p){const D=p.split("-");return 2===D.length?D[1]:D[0]}},78109:(be,q,d)=>{"use strict";d.d(q,{w:()=>X});var c=d(287),e=d(44867);class y{}var l=d(54438);let X=(()=>{class ${serializeNode(m,O,V={},I=L=>!0){const L={};return L.id=O.id,Object.entries(O.boolState).forEach(([M,S])=>{V.hasOwnProperty(M)&&(L[M]=S)}),Object.entries(O.numState).forEach(([M,S])=>{V.hasOwnProperty(M)&&(L[M]=S)}),m.successors[O.id]&&(L.children=[],m.successors[O.id].forEach(M=>{I(M)&&L.children.push(this.serializeNode(m,m.nodes[M],V,I))},this)),L}getAllSiblingsFromList(m,O,V){const I=[];let L;for(L=0;L<O.length;L++)this.getSiblings(m,O[L],V).forEach(M=>{I.includes(M)||I.push(M)});return I}getElectionResults(m,O,V,I){class L extends y{constructor(C,T){super(),Object.entries(C).forEach(([w,v])=>{this[w]={votesFor:[],votesAgainst:[]},Object.entries(T).forEach(([A,R])=>{R[w]?this[w].votesFor.push(A):this[w].votesAgainst.push(A)},this)},this)}}let M,S;const b=Object.keys(I),f=[];return V.forEach(U=>{S={},(0,e.IA)(m,U).forEach(w=>{S[w]=O[w]||(0,c.dU)(b,(0,e._D)(m,w,b)),delete O[w]},this),M=new L(I,S);const C=(0,c.Nq)(U,M,I);f.push(C);const T={};Object.entries(C).forEach(([w,v])=>{T[w]=v.result}),O[U]=T},this),f}updateGraphStateRecord(m,O,V,I,L=!0){V.forEach(M=>{const S=M[I[0]].id,b=(0,e._D)(m,S,I),f={};let U=!1;I.forEach(C=>{(L||M[C].result!==b[C])&&(f[C]=M[C].result,U=!0)}),U&&(O[S]=f)},this)}nodeExists(m,O){return!!m.nodes[O]}getLeaves(m){const O=[];return Object.entries(m.nodes).forEach(([V,I])=>{m.successors[V]||O.push(V)}),O}getDescendants(m,O,V=!1){const I=[];return function M(S){(0,e.IA)(m,S).forEach(b=>{I.push(b),M(b)})}(O),V&&I.push(O),I}getLeafDescendants(m,O,V=!1){const I=this.getDescendants(m,O,V).filter(L=>(0,e.xe)(m,L));return((0,e.xe)(m,O)||V)&&I.push(O),I}getAllLeafDescendants(m,O){const V=[];O.forEach(L=>{(0,e.xe)(m,L)?V.push(L):V.push(...this.getLeafDescendants(m,L,!1))});const I=new Set(V.sort());return Array.from(I)}getInverseSelection(m,O){const V=this.getAllLeafDescendants(m,O);return this.getLeaves(m).filter(I=>V.indexOf(I)<0)}getSiblings(m,O,V=!1){const I=m.predecessors[O];let L=[];if(L=I?(0,e.IA)(m,I):(0,e.ug)(m),!V){const M=L.indexOf(O);M>=0&&L.splice(M,1)}return L}getNodes(m,O){const V=[];return O.forEach(I=>{m.nodes[I]&&V.push(m.nodes[I])}),V}setState(m,O,V){const I=(0,e.dV)(m,O),L={};return Object.entries(V).forEach(([M,S])=>{"boolean"==typeof S&&I.boolState[M]!==S?(I.boolState[M]=S,L[M]=S):"number"==typeof S&&I.numState[M]!==S&&(I.numState[M]=S,L[M]=S)}),L}synchronize(m,O,V){const I=this.calculateGraphStateMap(m,O,V);return Object.entries(I).forEach(([L,M])=>{this.setState(m,L,M)},this),I}calculateGraphStateMap(m,O,V,I=!V){let L=[];const M={};let S=[];const b={},f=Object.keys(O);let U=0;for(V?Object.entries(V).forEach(([C,T])=>{M[C]=(0,c.dU)(f,V[C]),b[C]={...M[C]},U=Math.max(U,(0,e.dV)(m,C).depth)},this):this.getLeaves(m).forEach(C=>{M[C]=(0,c.dU)(f,(0,e.dV)(m,C).boolState),b[C]={...M[C]},U=Math.max(U,(0,e.dV)(m,C).depth)},this),U-=1,L=(0,c.AY)(m,Object.keys(M),U);U>=0;)S=this.getElectionResults(m,M,L,O),this.updateGraphStateRecord(m,b,S,f,I),U-=1,L=(0,c.AY)(m,Object.keys(M),U);return b}filterGraphAccessors(m,O){const I=this.getNodes(m,O).sort((S,b)=>S.depth-b.depth),L=new Map;return I.filter(S=>!L.has(S.id)&&(this.getDescendants(m,S.id,!0).forEach(b=>L.set(b,!0)),!0)).map(S=>S.id)}resetDepth(m){(0,e.Wy)(m,V=>{let I=0;m.predecessors[V]&&(I=(0,e.dV)(m,m.predecessors[V]).depth+1),(0,e.dV)(m,V).depth=I})}deleteNode(m,O,V=!0){if(!this.nodeExists(m,O))return;delete m.nodes[O];const I=m.predecessors[O];I&&(delete m.predecessors[O],m.successors[I]&&(m.successors[I]=m.successors[I].filter(M=>M!==O)));const L=m.successors[O];L&&(delete m.successors[O],V&&L.forEach(M=>{this.deleteNode(m,M)},this)),m.roots[O]&&delete m.roots[O]}resetAsLeaf(m,O){let V=[];return m.nodes[O]&&!(0,e.xe)(m,O)&&(V=this.getDescendants(m,O),delete m.successors[O],V.forEach(I=>{delete m.nodes[I],delete m.successors[I],delete m.predecessors[I]})),V}static#e=this.\u0275fac=function(O){return new(O||$)};static#t=this.\u0275prov=l.jDH({token:$,factory:$.\u0275fac,providedIn:"root"})}return $})()},56343:(be,q,d)=>{"use strict";d.d(q,{t:()=>c});var c=function(e){return e.MajorityWins="majorityWins",e.TrueWins="trueWins",e.FalseWins="falseWins",e}(c||{})},23881:(be,q,d)=>{"use strict";function c($){return{id:$,depth:0,boolState:{},numState:{}}}function e(){return{nodes:{},successors:{},predecessors:{},roots:{}}}d.d(q,{YR:()=>l,ow:()=>X,q3:()=>e,vm:()=>c});class l{}function X($=[]){return{available:()=>!0,shown:()=>!1,selected:()=>!1,pickable:()=>!0,renderable:()=>!1,expanded:()=>!1,...$.reduce((j,m)=>(j[m]=()=>!1,j),{})}}},19408:(be,q,d)=>{"use strict";var c=d(345),e=d(54438),y=d(728),l=d(92014);class ${}let j=(()=>{class n{static#e=this.type="[Widget] Setup Widget";constructor(t,o,s){this.hostingURL=t,this.embedded=o,this.widgetConfig=s}}return n})(),m=(()=>{class n{static#e=this.type="[Widget] Reset"}return n})(),O=(()=>{class n{static#e=this.type="[Widget] Set Input Enabled";constructor(t){this.enabled=t}}return n})(),V=(()=>{class n{static#e=this.type="[Widget] Set API Config";constructor(t){this.config=t}}return n})(),I=(()=>{class n{static#e=this.type="[Widget] Get Widget Product Settings";constructor(t){this.productAccountId=t}}return n})(),L=(()=>{class n{static#e=this.type="[Widget] Set Widget Product Settings";constructor(t){this.widgetSettings=t}}return n})();var M=function(n){return n[n.User=0]="User",n[n.Developer=1]="Developer",n}(M||{}),S=function(n){return n.Widget="widget",n.WidgetAPI="widgetapi",n}(S||{}),b=d(40470),f=d(21626);let U=(()=>{class n{constructor(t){this.http=t}getWidgetSettings(t){return this.http.get(`/ws/product/account/settings?product_acctid=${t}`)}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class C{}class w{}var v=d(72849),A=d(11724);const R=A.VERSION,N="2.0.1";var B=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Q=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const H={userType:M.User,authenticating:!1,authenticated:!1,widgetUrlConfig:{id:"",type:""},widgetApiConfig:null,parentUrl:{full:"",domain:""},embedded:!1,engineVersion:"",engineAPIVersion:"",inputEnabled:!0,widgetSettings:void 0};let Z=class gd{static getWidgetState(i){return i}static getUserType(i){return i.userType}static getWidgetAuthenticating(i){return i.authenticating}static getWidgetAuthenticated(i){return i.authenticated}static getInputEnabled(i){return i.inputEnabled}static getEmbedded(i){return i.embedded}static getBypassAnalytics(i){return i.widgetUrlConfig["bypass-analytics"]}static getParentURL(i){return i.parentUrl.full}static getWidgetUrlConfig(i){return i.widgetUrlConfig}static getWidgetApiUIConfig(i){return i.widgetApiConfig}static getWidgetSettings(i){return i.widgetSettings}setupWidget(i,{hostingURL:t,embedded:o,widgetConfig:s}){const a=t.match(/:\/\/(.[^/]+)/);i.patchState({userType:s.uaid?M.User:M.Developer,embedded:o,widgetUrlConfig:s,parentUrl:{full:t,domain:a&&a[1]?a[1]:t}})}getWidgetProductSettings(i,{productAccountId:t}){this.widgetConfigService.getWidgetSettings(t).subscribe(({settings:o})=>{i.dispatch(new L(o))})}setWidgetProductSettings(i,{widgetSettings:t}){i.patchState({widgetSettings:t})}resetWidget(i){i.setState(H)}buildAppActivityData(i){const{engineVersion:t,engineAPIVersion:o,widgetUrlConfig:s}=i,a={engine_version:t,api_version:o};return Object.entries(s).filter(([r])=>"dk"!==r).forEach(([r,_])=>{a[`url_param_${r}`]=_}),(0,b.bj)(C,a)}setInputEnabled(i,t){i.patchState({inputEnabled:t.enabled})}setWidgetApiConfig(i,t){i.patchState({widgetApiConfig:t.config})}buildUserAnalytic(i,t,o){const{widgetUrlConfig:s,parentUrl:a}=i,r=s.uaid,_=a.domain,g={...this.buildAppActivityData(i),parent_analytic_identifier:r,referer_domain:_,[`${t}_source`]:o};return(0,b.bj)(w,{analytic_platform:S.Widget,analytic_type:t,analytic_data:g})}ngxsOnInit(i){i.patchState({engineVersion:R,engineAPIVersion:N})}constructor(i,t){this.widgetConfigService=i,this.engineService=t}static#e=this.\u0275fac=function(t){return new(t||gd)(e.KVO(U),e.KVO(v.y))};static#t=this.\u0275prov=e.jDH({token:gd,factory:gd.\u0275fac})};B([(0,l.rc)(j),Q("design:type",Function),Q("design:paramtypes",[Object,j]),Q("design:returntype",void 0)],Z.prototype,"setupWidget",null),B([(0,l.rc)(I),Q("design:type",Function),Q("design:paramtypes",[Object,I]),Q("design:returntype",void 0)],Z.prototype,"getWidgetProductSettings",null),B([(0,l.rc)(L),Q("design:type",Function),Q("design:paramtypes",[Object,L]),Q("design:returntype",void 0)],Z.prototype,"setWidgetProductSettings",null),B([(0,l.rc)(m),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],Z.prototype,"resetWidget",null),B([(0,l.rc)(O),Q("design:type",Function),Q("design:paramtypes",[Object,O]),Q("design:returntype",void 0)],Z.prototype,"setInputEnabled",null),B([(0,l.rc)(V),Q("design:type",Function),Q("design:paramtypes",[Object,V]),Q("design:returntype",void 0)],Z.prototype,"setWidgetApiConfig",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getWidgetState",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getUserType",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getWidgetAuthenticating",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getWidgetAuthenticated",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getInputEnabled",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getEmbedded",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getBypassAnalytics",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getParentURL",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getWidgetUrlConfig",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",void 0)],Z,"getWidgetApiUIConfig",null),B([(0,l.MD)(),Q("design:type",Function),Q("design:paramtypes",[$]),Q("design:returntype",Array)],Z,"getWidgetSettings",null),Z=B([(0,l.Uw)({name:"widget",defaults:H}),Q("design:paramtypes",[U,v.y])],Z);var E,n,k=d(85052),h=d(2573),p=d(37925),D=d(14264),te=function(n){return n[n.Basics=0]="Basics",n[n.All=1]="All",n[n.Shortcuts=2]="Shortcuts",n}(te||{});(n=E||(E={})).SetAutoplay=(()=>{class $e{static#e=this.type="[View] Set Autoplay";constructor(He){this.autoplay=He}}return $e})(),n.SetContentMode=(()=>{class $e{static#e=this.type="[View] Set Content Mode";constructor(He){this.column=He}}return $e})(),n.SetCanHover=(()=>{class $e{static#e=this.type="[View] Set Can Hover";constructor(He){this.canHover=He}}return $e})(),n.SetCanTouch=(()=>{class $e{static#e=this.type="[View] Set Can Touch";constructor(He){this.canTouch=He}}return $e})(),n.SetCanFullscreen=(()=>{class $e{static#e=this.type="[View] Set Can Fullscreen";constructor(He){this.canFullscreen=He}}return $e})(),n.SetInputEnabled=(()=>{class $e{static#e=this.type="[View] Set Input Enabled";constructor(He){this.enabled=He}}return $e})(),n.SetSearchDisplayMode=(()=>{class $e{static#e=this.type="[View] Set Search Display Mode";constructor(He){this.mode=He}}return $e})(),n.TogglePresentation=(()=>{class $e{static#e=this.type="[View] Toggle Presentation";constructor(He){this.active=He}}return $e})(),n.SetInteractType=(()=>{class $e{static#e=this.type="[View] Set Interact Type";constructor(He){this.interactType=He}}return $e})(),n.SetForceAudio=(()=>{class $e{static#e=this.type="[View] Set Force Audio";constructor(He){this.forceAudio=He}}return $e})(),n.SetOnDemand=(()=>{class $e{static#e=this.type="[View] Set On Demand";constructor(He){this.onDemand=He}}return $e})(),n.SetLayout=(()=>{class $e{static#e=this.type="[View] Set Layout";constructor(He){this.layout=He}}return $e})(),n.ToggleHelpTab=(()=>{class $e{static#e=this.type="[View] Toggle Help Tab";constructor(He=te.Basics){this.tab=He}}return $e})(),n.SetInputMode=(()=>{class $e{static#e=this.type="[View] Set Input Mode";constructor(He){this.inputMode=He}}return $e})(),n.SetTutorial=(()=>{class $e{static#e=this.type="[View] Set Tutorial";constructor(He){this.tutorial=He}}return $e})(),n.SetIsMobileWeb=(()=>{class $e{static#e=this.type="[View] Set Is Mobile Web";constructor(He){this.isMobileWeb=He}}return $e})(),n.StartTutorial=(()=>{class $e{static#e=this.type="[View] Start Tutorial";constructor(He){this.intro=He}}return $e})(),n.TutorialSeen=(()=>{class $e{static#e=this.type="[View] Tutorial Seen";constructor(He){this.seen=He}}return $e})(),n.TutorialNext=(()=>{class $e{static#e=this.type="[View] Tutorial Next";constructor(){}}return $e})(),n.TutorialPrevious=(()=>{class $e{static#e=this.type="[View] Tutorial Previous";constructor(){}}return $e})(),n.ToggleNodeInfo=(()=>{class $e{static#e=this.type="[View] Toggle Node Info";constructor(He){this.show=He}}return $e})(),n.TogglePanel=(()=>{class $e{static#e=this.type="[View] Toggle Panel";constructor(He,Et){this.panel=He,this.show=Et}}return $e})(),n.SetViewLanguage=(()=>{class $e{static#e=this.type="[View] Set View Language";constructor(He){this.lang=He}}return $e})(),n.SetNodeInfoConfig=(()=>{class $e{static#e=this.type="[View] Set Node Info Config";constructor(He){this.fallback=He}}return $e})(),n.SetMultiPickModeEnabled=(()=>{class $e{static#e=this.type="[View] Set multi pick mode enabled";constructor(He){this.enabled=He}}return $e})(),n.SetLabelBreakpoint=(()=>{class $e{static#e=this.type="[View] Set Label Breakpoint";constructor(He){this.labelsBreakpoint=He}}return $e})(),n.SetPlaythrough=(()=>{class $e{static#e=this.type="[View] Set Playthrough";constructor(He){this.playthrough=He}}return $e})(),n.SetPlaythroughEnabled=(()=>{class $e{static#e=this.type="[View] Set Playthrough Enabled";constructor(He){this.enabled=He}}return $e})(),n.SetStartingColumn=(()=>{class $e{static#e=this.type="[View] Set Starting Column";constructor(He){this.column=He}}return $e})(),n.SetPreferredColumn=(()=>{class $e{static#e=this.type="[View] Set Preferred Column";constructor(He){this.column=He}}return $e})(),n.SetStartingTool=(()=>{class $e{static#e=this.type="[View] Set Starting Tool";constructor(He){this.tool=He}}return $e})(),n.SetFadeout=(()=>{class $e{static#e=this.type="[View] Set Fadeout";constructor(He){this.fadeout=He}}return $e})(),n.SetPreventFadeoutEvent=(()=>{class $e{static#e=this.type="[View] Set Prevent Fadeout Event";constructor(He,Et){this.event=He,this.value=Et}}return $e})(),n.SetUsePrintImage=(()=>{class $e{static#e=this.type="[View] Set Use Print Image";constructor(He){this.usePrintImage=He}}return $e})(),n.SetWindows=(()=>{class $e{static#e=this.type="[View] Set Windows";constructor(He){this.windows=He}}return $e})(),n.OpenWindow=(()=>{class $e{static#e=this.type="[View] Open Window";constructor(He){this.window=He}}return $e})(),n.CloseWindow=(()=>{class $e{static#e=this.type="[View] Close Window";constructor(He){this.window=He}}return $e})(),n.ToggleWindow=(()=>{class $e{static#e=this.type="[View] Toggle Window";constructor(He,Et){this.window=He,this.show=Et}}return $e})(),n.ToggleMenu=(()=>{class $e{static#e=this.type="[View] Toggle Menu";constructor(He){this.open=He}}return $e})(),n.SetWhiteboardEnabled=(()=>{class $e{static#e=this.type="[View] Whiteboard Enabled";constructor(He){this.enabled=He}}return $e})(),n.SetWhiteboardLocked=(()=>{class $e{static#e=this.type="[View] Whiteboard locked";constructor(He){this.locked=He}}return $e})(),n.SetWhiteboardBrushSize=(()=>{class $e{static#e=this.type="[View] Whiteboard Brush Size";constructor(He){this.brushSize=He}}return $e})(),n.SetWhiteboardBrushColor=(()=>{class $e{static#e=this.type="[View] Whiteboard Brush Color";constructor(He){this.brushColor=He}}return $e})(),n.SetWhiteboardTextSize=(()=>{class $e{static#e=this.type="[View] Whiteboard Text Size";constructor(He){this.size=He}}return $e})(),n.SetWhiteboardEraserSize=(()=>{class $e{static#e=this.type="[View] Whiteboard Eraser Size";constructor(He){this.eraserSize=He}}return $e})(),n.SetWhiteboardAnnotateMode=(()=>{class $e{static#e=this.type="[View] Whiteboard Annotate Mode";constructor(He){this.mode=He}}return $e})(),n.SetWhiteboardHasPaint=(()=>{class $e{static#e=this.type="[View] Whiteboard Has Paint";constructor(He){this.hasPaint=He}}return $e})(),n.SetWhiteboardHasText=(()=>{class $e{static#e=this.type="[View] Whiteboard Has Text";constructor(He){this.hasText=He}}return $e})(),n.ShowScrim=(()=>{class $e{static#e=this.type="[View] Show Scrim";constructor(He,Et){this.showSpinner=He,this.label=Et}}return $e})(),n.HideScrim=(()=>{class $e{static#e=this.type="[View] Hide Scrim";constructor(){}}return $e})(),n.SetChapterCallToActionSeen=(()=>{class $e{static#e=this.type="[View] Set Chapter Call To Action Seen";constructor(He){this.chapterCallToActionSeen=He}}return $e})(),n.ResetViewState=(()=>{class $e{static#e=this.type="[View] Reset View State";constructor(){}}return $e})();var K=d(38645),u=d(49204),x=d(87145),z=d(24418);function oe(n,i=!1){return(i?function ie(n){return n.filter(i=>Object.values(i).some(t=>!(0,u.isNil)(t.value)&&""!==t.value))}(n):n).reduce((o,s)=>({...o,...s}),{})}class Y{}var W=d(36110),Ee=d(16938);class re{}var Se=d(17766);class Te{constructor(){this.type=Se.c.Bookmark,this.favorite=!1,this.unavailable=!1}}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,Ee.Z)(()=>re),function(){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],Te.prototype,"group_access",void 0);var we=function(n){return n.All="",n.Quiz="mode-quiz",n.Content="mode-content",n}(we||{});function Qe(n){const{id:i,type:t}=n;if("module"===t&&(n.id=function tt(n){return n.replace("Condition.content.","").replace(".json","").split(".").join("/")}(i)),n.tour=n.tags.includes("tour"),n.animated=n.tags.includes("animated"),n.quiz=n.tags.includes("quiz"),n.lowDefinition=n.tags.includes("low definition"),!n.viewMode){const o=Object.values(we).find(s=>n.tags.includes(s));n.viewMode=o??we.All}return n}var Ue=function(n){return n.IdAsc="+collection_id",n.IdDesc="-collection_id",n.NameAsc="+collection_name",n.NameDesc="-collection_name",n.UpdateDateAsc="+collection_updatedate",n.UpdateDateDesc="-collection_updatedate",n.CreateDateAsc="+collection_createdate",n.CreateDateDesc="-collection_createdate",n.CustomAsc="+custom_sort_order",n.CustomDesc="-custom_sort_order",n}(Ue||{});function yt(n){return"?"+Object.entries(n).filter(([i,t])=>!(0,u.isNil)(t)).map(([i,t])=>`${i}=${encodeURIComponent(t)}`).join("&")}var ke=d(36860),at=function(n){return n.Web="web",n.Android="mobile_android",n.iOS="mobile_ios",n}(at||{});let De=(()=>{class n{constructor(t){this.platform=t}get productKey(){return z.c.productKey}get productType(){if(z.c.native){if(this.platform.ANDROID)return at.Android;if(this.platform.IOS)return at.iOS}return at.Web}get productHeader(){return{"Bd-Product-Ua":`BD/Product/${this.productType}/${this.productKey}`}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(ke.OD))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Oe="/ws/organization/collection",nt="/ws/organization/join/domains";let ce=(()=>{class n{constructor(t,o){this.http=t,this.productService=o}createOrganization(t){return this.http.post("/ws/organization/create",t)}updateOrganization(t){return this.http.post("/ws/organization/update",t)}deleteOrganization(t){return this.http.request("delete","/ws/organization/delete",{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:t}})}getCollections(t){t.sort_order||(t.sort_order=[Ue.CustomAsc,Ue.NameDesc]);const o=yt(t);return this.http.get(`${Oe}${o}`).pipe((0,W.T)(s=>(0,b.bj)(Y,s).map(a=>this.normalizeCollectionModel(a))))}getCollectionContent(t,o,s="",a="en"){const r=s.toLocaleLowerCase().split(" ");return this.getCollections({group_id:t,collection_id:o,include_content:1,ol:a}).pipe((0,W.T)(_=>_[0].collection_content.map(P=>(0,b.bj)(Te,P)).filter(P=>{let F=!0;return r.length&&P.title&&r.forEach(ee=>{F=F&&P.title.toLocaleLowerCase().indexOf(ee)>=0}),F=F&&!0!==P.unavailable,F})))}addCollection(t,o){return this.http.post(Oe,{group_id:t,collection_name:o})}removeCollection(t){return this.http.request("DELETE",Oe,{body:{group_id:t.group_id,collection_id:t.collection_id}})}renameCollection(t,o){return this.http.post(Oe,{group_id:t.group_id,collection_id:t.collection_id,collection_name:o})}reorderCollections(t,o){return this.http.post(`${Oe}/sort-order`,{group_id:t,collection_id_sort_list:o.map(s=>s.collection_id)})}updateCollectionContent(t,o,s){return this.http.post(`${Oe}/content`,{group_id:t,add_content:o,remove_content:s})}getOrganizationAttribute(t,o,s){return t.find(a=>a.type===o&&a.name===s)}getPublicProfile(t){return this.http.get("/ws/organization/public/profile",{params:{...t}}).pipe((0,W.T)(o=>o))}normalizeCollectionModel(t){return t.collection_content&&t.collection_content.forEach(o=>{Qe(o)}),t}isNewJoinDomain(t){return(0,u.isNil)(t.join_domain_id)}checkJoinDomains(t){return this.http.post("/ws/organization/join/domain/check",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:t}).pipe((0,W.T)(s=>{const a=s.email_domains_checked;return t.map(r=>a[r].is_blacklisted)}))}getJoinDomains(t){const o={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...t},s=new f.Nl({fromObject:{...o}});return this.http.get(nt,{params:s})}postJoinDomains(t){return this.http.post(nt,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,email_domains:t})}deleteJoinDomains(t){return this.http.request("delete",nt,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_domain_ids:t}})}generateGroupCode(t){return this.http.post("/ws/organization/generate/groupcode",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:t})}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(De))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ve=(()=>{class n{constructor(t,o,s,a){this.config=t,this.router=o,this.route=s,this.organizationsService=a,this.appended=!1,this.initialized=!1,this.sessionEvents={},this.pageEvents={},this.queuedEvents=[],this.initRouteListener()}appendScripts(){!this.config.enabled||this.appended||(this.appendPendo(),this.appendHubspot(),this.appended=!0)}initialize(t,o){this.config.enabled&&(pendo.initialize({visitor:t,account:o}),this.flushQueuedEvents(),this.initialized=!0)}identify(t,o){this.config.enabled&&(pendo.identify({visitor:t,account:o}),this.hubspotIdentify({...t,account:o}))}createVisitorData(t){const o={},s=oe(t.account_settings),a=(0,u.get)(t,"organizations[0].user_role.role_display_name",null);if((0,u.has)(t,"id")&&(o.id=this.getPrefixedId(t.id.toString())),(0,u.has)(t,"email")&&(o.email=t.email),(0,u.has)(t,"first_name")&&(0,u.has)(t,"last_name")&&(o.full_name=`${t.first_name} ${t.last_name}`),(0,u.has)(t,"registration_date")&&(o.registration_date=t.registration_date),(0,u.has)(t,"premium_account")&&(o.premium=t.premium_account),(0,u.has)(t,"user_is_developer")&&(o.developer=t.user_is_developer),(0,u.has)(t,"subscription")&&(o.subscriptionType=t.subscription?t.subscription.subscription_type:null),(0,u.has)(t,"is_third_party")&&(o.thirdParty=t.is_third_party),(0,u.has)(s,"account_purpose")&&(o.purpose=s.account_purpose?s.account_purpose.value:null),(0,u.has)(s,"account_role")&&(o.role=s.account_role?s.account_role.value:null),(0,u.has)(s,"account_field")&&(o.field=s.account_field?s.account_field.value:null),(0,u.has)(s,"email_marketing_optin")){const r=(0,u.get)(s,"email_marketing_optin.value",!1);o.emailMarketing=!!r}return a&&(o.teamRole=a),o}createAccountData(t){const o=(0,u.get)(t,"group_attributes",null);return{id:this.getPrefixedId((0,u.get)(t,"id",null)),name:(0,u.get)(t,"name",null),subscriptionType:(0,u.get)(t,"subscription.type",null),subscriptionEndDate:(0,u.get)(t,"subscription.paid_through_date",null),usersCount:(0,u.get)(t,"users_count",null),purpose:this.getGroupAttributeValue(o,"account_purpose"),field:this.getGroupAttributeValue(o,"account_field"),companyWebsite:this.getGroupAttributeValue(o,"account_company_website"),companySize:this.getGroupAttributeValue(o,"account_company_size"),externalAccountProvider:(0,u.get)(t,"external_account.external_account_provider",null)}}updateVisitorData(t){if(!this.config.enabled)return;const o=this.createVisitorData(t);pendo.updateOptions({visitor:o}),this.hubspotIdentify(o,!0)}updateAccountData(t){if(!this.config.enabled)return;const o=this.createAccountData(t);pendo.updateOptions({account:o})}flushQueuedEvents(){this.queuedEvents.forEach(t=>{this.track(t.trackType,t.metadata)})}track(t,o){this.config.enabled&&(this.initialized?pendo.track(t,o):this.queuedEvents.push({trackType:t,metadata:o}))}trackOncePerSession(t,o){this.sessionEvents[t]||this.config.enabled&&(this.track(t,o),this.sessionEvents[t]=!0)}trackOncePerPage(t,o){this.pageEvents[t]||this.config.enabled&&(this.track(t,o),this.pageEvents[t]=!0)}trackSignIn(t){this.trackSignInSignUp("Sign In - Success",t)}trackSignUp(t){this.trackSignInSignUp("Sign Up - Success",t)}trackSignInSignUp(t,o){const s=this.route.snapshot.queryParams;this.track(t,{type:o,referrer:document.referrer,refParam:s.ref||null,groupInvite:(0,u.has)(s,"group_invite"),groupCode:(0,u.has)(s,"group")&&(0,u.has)(s,"code")})}initRouteListener(){this.router.events.pipe((0,D.p)(t=>t instanceof K.wF),(0,x.i)(1)).subscribe(t=>{this.pageEvents={},this.hubspotTrackPageView(t.urlAfterRedirects)})}getPrefixedId(t){return t&&`${(0,u.get)(this.config,`idPrefixes[${z.c.deploy}]`,"")}${t}`}getGroupAttributeValue(t,o){if(!t)return null;const s=this.organizationsService.getOrganizationAttribute(t,"account_settings",o);return s?s.value:null}appendPendo(){const t=`\n      (function(apiKey){\n        (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];\n        v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){\n            o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);\n            y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';\n            z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');\n      })('${this.config.pendoId}');\n    `,o=document.createElement("script");o.textContent=t,document.body.appendChild(o)}appendHubspot(){_hsq=window._hsq=window._hsq||[];const t=`${location.pathname}${location.search}${location.hash}`;_hsq.push(["setPath",t]);const o=document.createElement("script");o.async=!0,o.defer=!0,o.src=`//js.hs-scripts.com/${this.config.hubspotId}.js`,document.body.appendChild(o)}hubspotIdentify(t,o=!1){window._hsq?.push(["identify",t]);const s=o?"Visitor Updated":"Visitor Identified";window._hsq?.push(["trackCustomBehavioralEvent",{name:s}])}hubspotTrackPageView(t){window._hsq?.push(["setPath",t]),window._hsq?.push(["trackPageView"])}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO("vendorAnalyticsConfig"),e.KVO(K.Ix),e.KVO(K.nX),e.KVO(ce))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();d(26579),d(75067);var pt=d(28407),ct=d(66056),ze=d(76304),Hn=d(26657),Pi=d(16606),me=d(85586),Je=d(93915),li=d(59429),na=d(44867);function al(n,i){const t=le=>void 0!==le.objectId,[o,s]=(0,u.partition)(n,t),[a,r]=(0,u.partition)(i,t),_=function ol(n,i){return i.reduce((t,o)=>{for(const s of n)(0,u.isEqual)(s,o)||t.push(o);return t},n)}(s,r),{sceneGraph:g,graphsMerged:P,objectIdsUniqueToNew:F,objectIdsUniqueToOriginal:ee}=function sl(n,i){const t=n.reduce((a,r)=>(a[r.objectId]=r,a),{}),o=i.reduce((a,r)=>{if(void 0===a.nodes[r.objectId])return a.nodes[r.objectId]=r,a;if(!(0,u.isEqual)(r,a.nodes[r.objectId])){const _=function il(n,i){const t={},o={};return{root:function s(r,_){if(r.objectId!==_.objectId)return t[_.objectId]=!0,[r,_];if(void 0===r.objects&&_.objects){for(const F of _.objects)t[F.objectId]=!0;return[{..._}]}if(r.objects&&void 0===_.objects){for(const F of r.objects)o[F.objectId]=!0;return[{...r}]}if(void 0===r.objects&&void 0===_.objects)return[{...r}];const g=[];for(const F of r.objects){const ee=_.objects.find(le=>le.objectId===F.objectId);ee?g.push(s(F,ee)):(o[F.objectId]=!0,g.push(F))}for(const F of _.objects)r.objects.find(le=>le.objectId===F.objectId)||(t[F.objectId]=!0,g.push(F));const P={...r};return P.objects=(0,u.flatten)(g),[P]}(n,i),objectIdsUniqueToNew:t,objectIdsUniqueToOriginal:o}}(a.nodes[r.objectId],r);a.nodes[r.objectId]=_.root[0],a.graphsMerged.push(r.objectId),a.objectIdsUniqueToNew[r.objectId]=_.objectIdsUniqueToNew,a.objectIdsUniqueToOriginal[r.objectId]=_.objectIdsUniqueToOriginal}return a},{nodes:t,graphsMerged:[],objectIdsUniqueToNew:{},objectIdsUniqueToOriginal:{}});return{sceneGraph:Object.keys(o.nodes).reduce((a,r)=>(a.push(o.nodes[r]),a),[]),graphsMerged:o.graphsMerged,objectIdsUniqueToNew:o.objectIdsUniqueToNew,objectIdsUniqueToOriginal:o.objectIdsUniqueToOriginal}}(o,a);return{sceneGraph:[..._,...g],graphsMerged:P,objectIdsUniqueToNew:F,objectIdsUniqueToOriginal:ee}}function Za(n,i,t){const o=function rl(n,i,t){const o={};for(const s of n){const a=Object.keys(i[s]);for(const r of a)o[r]=t}return o}(i,t,!1);return n.map(s=>({...s,availableObjects:{...s.availableObjects,...o},showObjects:{...s.showObjects,...o},selectObjects:{...s.selectObjects,...o},pickThroughObjects:{...s.pickThroughObjects,...o}}))}function Cs(n){return n.split("/").length>1?Se.c.Module:Se.c.Bookmark}var er=d(63508);function gn(n,i){return n.map(t=>{if((0,er.Mi)(t)||(0,er.Uv)(t)&&!(0,u.isEmpty)(t.lights))return t;const o={libraries:[...i],lights:[]};return{...t,lights:o}})}var Ku=d(86544);function qu(n){return n.reduce((i,t)=>(i[t.id]=t,i),{})}function Ju(n){return n.reduce((i,t)=>{const o=t.id,s=t.customData?.particleSystems??[];return s.length>0&&(i[o]=function ry(n){return n.reduce((i,t)=>(i[Ku.R.getParticleIdRoot(t)]=t,i),{})}(s)),i},{})}function Zu(n,i){return n.map(t=>{const o=t.customData?.particleSystems??[];return o.length&&(t.customData.particleSystems=o.map(s=>i[s]?.id??s)),t})}var pl=d(63745),xn=d(27180);function eh(n){if((0,u.isEmpty)(n))return;const{audit:i,reviewed:t,collaborated:o,references:s}=n,a=s?.filter(_=>_.label.trim().length>0)??[],r={};return a.length>0&&(r.references=a),z.c.application!==xn.c.Loft||(t?.enabled&&(r.reviewed=t),o?.enabled&&(r.collaborated=o)),i?.enabled&&(r.audit=i),(0,u.isEmpty)(r)?void 0:r}function dy(n,i,t,o,s=Se.c.Bookmark,a=li.u.idWithPrefix){const{sceneGraph:r,graphsMerged:_,objectIdsUniqueToNew:g,objectIdsUniqueToOriginal:P}=al(n.sceneGraph,t.sceneGraph),F=function _l(n,i){const t=(r,_)=>(0,u.uniq)([...r,..._]);return{lights:t(n.lights,i.lights),tweens:t(n.tweens,i.tweens),reflections:t(n.reflections,i.reflections)}}(n.assetLibraries,t.assetLibraries),ee=function dl(n,i,t,o){i=i||{};const s=(a,r)=>r.includes("/")?r:`${function cl(n){return Cs(n)===Se.c.Bookmark?n:n.split("/").pop()}(a)}/${r}`;return{...(0,u.mapKeys)(n=n||{},(a,r)=>s(t,r)),...(0,u.mapKeys)(i,(a,r)=>s(o,r))}}(n.reflections,t.reflections,i,o),le=gn(n.chapters,n.assetLibraries.lights),he=gn(t.chapters,t.assetLibraries.lights),Ve=function ly(n,i,t,o,s){const a=n.customData?.particleSystems??[],r=i.customData?.particleSystems??[],_=qu(a),g=qu(r);Object.entries(g).forEach(([ue,ye])=>{const Ge=_[ue];(0,u.isNil)(Ge)||(g[ue]=(0,u.isEqual)(Ge,ye)?Ge:{...(0,u.cloneDeep)(ye),id:Ku.R.generateParticleId(ue,s)})});const P=Array.from(new Set([...Object.values(_),...Object.values(g)])),F=Zu(t,_),ee=Zu(o,g),le={...Ju(F),...Ju(ee)};return{mergedParticles:P,currentChapters:F,importedChapters:ee,tweenParticleLookup:(0,u.pickBy)(le,ue=>!(0,u.isEmpty)(ue))}}(n,t,Za(le,_,g),Za(he,_,P).map(hn=>{const rn=hn.createdFrom??[];return rn.unshift({id:(0,pl.u2)(o),timestamp:Date.now()}),{...hn,id:a("chapter"),createdFrom:rn}}),a),ot=function ll(n,i){const t=n.map(o=>o.objectId);return i.map(o=>{const s=o.showObjects??{},a=o.availableObjects??{};return{...o,availableObjects:(0,na.K$)(t,s,a)}})}(r,[...Ve.currentChapters,...Ve.importedChapters]),_t={...n.customData,particleSystems:Ve.mergedParticles},xt="module"===s?n.tags:[],$t=function cy(n,i){const t=[...n?.references??[],...i?.references??[]];if(t.length>0)return{references:t,audit:{enabled:!0===n?.audit?.enabled&&!0===i?.audit?.enabled}}}(n.sourceInfo,t.sourceInfo);return{...n,assetLibraries:F,chapters:ot,sceneGraph:r,customData:_t,tags:xt,reflections:ee,stateId:(0,u.uniq)([...n.stateId,...t.stateId]),tweenParticleLookup:Ve.tweenParticleLookup,sourceInfo:$t}}var lo=d(32914);function th(n){return function py(n){return new h.c(i=>{const t=new Image;t.onload=()=>{const o=function _y(n){const i=document.createElement("canvas"),t=i.getContext("2d");return i.width=n.naturalWidth,i.height=n.naturalHeight,t.drawImage(n,0,0),i}(t);i.next(o),i.complete()},t.onerror=()=>{const o=document.createElement("canvas");i.next(o),i.complete()},t.src=n})}(n).pipe((0,D.p)(i=>!(0,u.isNil)(i)),(0,lo.n)(i=>new h.c(t=>{i.toBlob(o=>{t.next(o),t.complete()},"image/jpeg",100)})))}var Fo,ul=d(57238);!function(n){function o(r,_){const g=new ul.R;if(r.thumbnails)g.legacy=!1,g.storyId=_,g.chapterId=r.id,g.urls={...r.thumbnails};else{const F=`/thumbs/${Se.c.Bookmark===Cs(_)?"bookmarks":"modules"}/${_.replace(".json","")}`;g.legacy=!0,g.storyId=_,g.chapterId=r.id,g.urls={small:`${F}/small/chapters/${r.id}.jpg`,large:`${F}/large/chapters/${r.id}.jpg`}}return g}n.generateLegacyThumbnail=function i(r,_){const F=`/thumbs/${Se.c.Bookmark===Cs(r)?"bookmarks":"modules"}/${r.replace(".json","")}`;return{small:`${F}/small/chapters/${_}.jpg`,large:`${F}/large/chapters/${_}.jpg`}},n.generateThumbnails=function t(r){return r.reduce((_,{originalChapterId:g,newChapterId:P,originalStoryId:F})=>{const ee=Se.c.Bookmark===Cs(F),le=new ul.R;le.storyId=F,le.chapterId=g;const ue=`/thumbs/${ee?"bookmarks":"modules"}/${F.replace(".json","")}`;return le.urls={small:`${ue}/small/chapters/${g}.jpg`,large:`${ue}/large/chapters/${g}.jpg`},_.set(P,le),_},new Map)},n.getChapterThumbnail=o,n.getChapterThumbnails=function s(r,_){return _.reduce((g,P)=>{const F=o(P,r);return g.set(P.id,F),g},new Map)},n.makeFreshThumbnail=function a(r,_,g){return th(g).pipe((0,D.p)(P=>!(0,u.isNil)(P)),(0,W.T)(P=>{const F=new ul.R;return F.snapshot=URL.createObjectURL(P),F.chapterId=_,F.storyId=r,F}))}}(Fo||(Fo={}));var qn,uy=d(21164),hy=d(23881),co=d(12347);!function(n){function i(a,r){const _=Object.entries(r);return _.sort((g,P)=>g[0].length===P[0].length?0:g[0].length<P[0].length?1:-1),_.reduce((g,[P,F])=>{if(g.startsWith(P)){const ee=new RegExp(`^${P}`);g=g.replace(ee,F)}return g},a||"")}n.renamespaceValue=i,n.renamespaceKeys=function t(a,r){return Object.entries(a).reduce((_,[g,P])=>(_[i(g,r)]=P,_),{})},n.renamespaceAssetLibrary=function o(a,r,_){if(!_)return a;const g=a.tweens.map(F=>i(F,r)),P=a.reflections.map(F=>i(F,r));return{...a,tweens:g,reflections:P}},n.renamespaceReflections=function s(a,r,_){return _?(0,u.mapValues)(a,g=>i(g,r)):a}}(qn||(qn={}));var es=d(38157),Yt=function(n){return n.DirectionalVelocity="DirectionalVelocity",n.Lifetime="Lifetime",n.PointPosition="PointPosition",n.RandomVelocity="RandomVelocity",n.SpherePosition="SpherePosition",n.CylinderPosition="CylinderPosition",n.CubePosition="CubePosition",n.RandomRotation="RandomRotation",n.RandomRotationSpeed="RandomRotationSpeed",n.RandomScale="RandomScale",n.SpriteAnimationDuration="SpriteAnimationDuration",n}(Yt||{}),fn=function(n){return n.AgeColorBlend="AgeColorBlend",n.BrownianMotion="BrownianMotion",n.UniformForce="UniformForce",n.RadialForce="RadialForce",n.Friction="Friction",n.Gravity="Gravity",n.Path="Path",n.AxisForce="AxisForce",n.SpriteAnimation="SpriteAnimation",n}(fn||{}),zn=function(n){return n.LifetimeKill="LifetimeKill",n.LifetimeStop="LifetimeStop",n.PathKill="PathKill",n.PathStop="PathStop",n.PathRadius="PathRadius",n.ShapeBounce="ShapeBounce",n.ShapeKill="ShapeKill",n.ShapeStop="ShapeStop",n}(zn||{}),Ld=function(n){return n.Sphere="Sphere",n.Plane="Plane",n.Cube="Cube",n.Cylinder="Cylinder",n}(Ld||{}),Ud=function(n){return n.In="in",n.Out="out",n}(Ud||{});const my=["objectId","displayName","geometryId","morphId","materialId","transformId"],fy=["geometryId","materialId","morphId"];function nh(n,i){return{availableObjects:(0,u.mapKeys)(n.availableObjects,(_,g)=>qn.renamespaceValue(g,i)),showObjects:(0,u.mapKeys)(n.showObjects,(_,g)=>qn.renamespaceValue(g,i)),selectObjects:(0,u.mapKeys)(n.selectObjects,(_,g)=>qn.renamespaceValue(g,i)),pickThroughObjects:(0,u.mapKeys)(n.pickThroughObjects,(_,g)=>qn.renamespaceValue(g,i)),synchronization:(0,u.mapKeys)(n.synchronization,(_,g)=>qn.renamespaceValue(g,i))}}function Sy(n,i){const t=o=>o.map(s=>s.type===es.X.flyToChapter||s.type===es.X.flyToObject?{...s,value:qn.renamespaceValue(s.value,i)}:s);return(n||[]).map(o=>({...o,objectId:qn.renamespaceValue(o.objectId,i),states:o.states.map(s=>({...s,errands:t(s.errands)}))}))}function by(n,i){return(n||[]).map(t=>(t.data.timeline=i[t.data.timeline]||t.data.timeline,t))}function yy(n,i){return(n||[]).map(t=>(t.objectId&&(t.objectId=qn.renamespaceValue(t.objectId,i)),t))}function vy(n,i){return n?{xray:(0,u.mapKeys)(n.xray,(t,o)=>qn.renamespaceValue(o,i)),highlight:(0,u.mapKeys)(n.highlight,(t,o)=>qn.renamespaceValue(o,i))}:{}}function Ey(n,i){const o={...n};return Array.isArray(n?.layers)&&(o.layers=n.layers.map(s=>({...s,objectIds:s.objectIds.map(a=>qn.renamespaceValue(a,i))}))),o}function ih(n,i){return n.forEach(t=>{my.forEach(o=>{const s=t[o];s&&"string"==typeof s&&(t[o]=qn.renamespaceValue(s,i))}),t.renderables?.forEach(o=>{fy.forEach(s=>{const a=o[s];a&&"string"==typeof a&&(o[s]=qn.renamespaceValue(a,i))})}),t.objects&&ih(t.objects,i)}),n}function Oy(n,i){function t(a=[]){return a.map(r=>({...r,src:qn.renamespaceValue(r.src,i)}))}let s=[];return n&&Array.isArray(n.particleSystems)&&(s=n.particleSystems.map(function o(a){return function gy(n){return"material"in n&&!("workflow"in n.material)}(a)?{...a,textures:t(a.textures)}:{...a}})),s}function My(n,i){const t=function Ty(n,i){return"string"==typeof n?[i[n]||n]:n.map(t=>i[t]||t)}(n.stateId,i),o=n.assetLibraries.tweens.map(P=>qn.renamespaceValue(P,i)),s=n.assetLibraries.reflections.map(P=>qn.renamespaceValue(P,i)),a=(0,u.mapValues)(n.reflections,(P,F)=>qn.renamespaceValue(P,i)),r=function Cy(n,i){return n.map(t=>({...t,...nh(t,i),colorRecipeObjects:vy(t.colorRecipeObjects,i),timelineMap:by(t.timelineMap,i),labels:Sy(t.labels,i),hotspots:yy(t.hotspots,i),visibilityLayers:Ey(t.visibilityLayers,i)}))}(n.chapters,i),_=ih(n.sceneGraph,i),g={...n.customData,particleSystems:Oy(n.customData,i)};return{...n,stateId:t,...nh(n,i),assetLibraries:{...n.assetLibraries,tweens:o,reflections:s},reflections:a,chapters:r,sceneGraph:_,customData:g}}const hl="context-label";class Vi{}var Iy=d(59676),tr=d(15375),bi=d(75069),ci=d(24151),ia=d(79817),jn=d(81025),wi=d(38472),Ct=d(515),Fi=d(35650);let nr=(()=>{class n{constructor(t,o){this.engineService=t,this.sceneService=o,this.markers=new Map,this.initMarkerEvents()}getMarkerWorldPosition(t){if((0,u.isNil)(t))return;const o=wi.clone(t.marker3D.position);return wi.scale(o,o,1/A.BIODIGITAL_SCENE_SCALE),o}getMarkerById(t){return this.markers.get(t)}createMarker(t){const{id:o,objectId:s,primitiveIndex:a,renderableIndex:r,barycentric:_,pos:g}=t,{engine:P}=this.engineService,{activeChapter:F,chapters:ee}=P.story,le=ee.find(_t=>_t.id===t.chapterId)??F,he=a>=0?"primitive":"object";if(!s)return console.warn("An object id is required for creating a marker.",{id:o}),null;const ue=this.sceneService.getObjectById(s);if((0,u.isNil)(ue))return console.warn("A valid object id is required for creating a marker.",{id:o,objectId:s}),null;let ye=g?wi.clone(g):void 0;"object"===he&&(0,u.isNil)(ye)&&(ye=this.sceneService.getObjectBoundaryCenter(s)),(0,u.isNil)(ye)||wi.scale(ye,ye,A.BIODIGITAL_SCENE_SCALE);const Ge={object:ue,trackingMode:he,renderableIndex:r||0,primitiveIndex:a,barycenter:_||[1/3,1/3,1/3],worldPosition:ye,variantIndex:ue.variant},it=(0,u.isNil)(P.renderer?.xrSession?.domOverlayState)?void 0:document.body,ot=new A.BioDigitalScreenMarker(P,le,Ge,o,it);return this.markers.set(o,ot),ot.update(),ot}deleteMarker(t){this.markers.get(t)?.destroy(),this.markers.delete(t)}deleteMarkers(){this.markers.forEach(t=>t.destroy()),this.markers.clear()}initMarkerEvents(){this.engineService.engineCreated$.subscribe(t=>{const{renderer:o}=t;o.on("update",()=>{o.xrSession?.domOverlayState||this.updateMarkers()}),o.on("xrframe",({viewerPose:s})=>{const a=s?.views?.[0];a&&o.xrSession?.domOverlayState&&this.updateMarkers(a)})})}updateMarkers(t){0!==this.markers.size&&(this.markers.forEach(o=>o.update(t)),this.engineService.fireEvent(Ct.X.SceneMarkersUpdated,this.markers))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(v.y),e.KVO(Fi.w))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var oa,ln=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Ye=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const oh={enableContextLabel:{enable:!0,enableInfo:!0,enableActions:!0,enableAudio:!0},loading:!1,labelsCollapsed:!1,labelsCollapsedMode:tr.Q.None,labelScale:null,labels:[],contextLabel:null,selectedLabel:null,draggable:{pin:!0,tag:!0}};let et=class md{static#e=oa=this;static getLabels(i){return i.labels}static getLabelsCollapsed(i){return i.labelsCollapsed}static getLabelsCollapsedMode(i){return i.labelsCollapsedMode}static getSelectedLabelId(i){return i.selectedLabel}static getSelectedLabel(i){return i.labels.find(t=>t.id===i.selectedLabel)||null}static getContextLabel(i){return i.contextLabel}static getChapterLabels(i,t){return i.labels?i.labels.filter(o=>o.chapterId===t.selectedChapter):[]}static getChapterSequentialLabels(i){return(0,l.Mz)([oa,me.N],(t,o)=>t.labels.filter(s=>s.chapterId===o.selectedChapter&&s.pinType===ci.O.Sequential&&s.sequentialType===i))}static getLabelSequence(i){return(0,l.Mz)([oa,oa.getChapterSequentialLabels(ia.C.Alphabetical),oa.getChapterSequentialLabels(ia.C.Numerical)],(t,o,s)=>{if(i.pinType!==ci.O.Sequential)return null;switch(i.sequentialType){case ia.C.Alphabetical:{const a=o.findIndex(r=>r.id===i.id);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(a)}case ia.C.Numerical:return s.findIndex(a=>a.id===i.id)+1}})}static getEnableContextLabel(i){return i.enableContextLabel.enable}static getEnableContextLabelInfo(i){return i.enableContextLabel.enableInfo}static getEnableContextLabelActions(i){return i.enableContextLabel.enableActions}static getEnableContextLabelAudio(i){return i.enableContextLabel.enableAudio}static getLabelsDraggable(i){return i.draggable}static getLabelScale(i){return i.labelScale}PatchLabels(i,t){const o=jn.$i(i.getState(),t.patches);i.patchState(o)}setLabelOffset(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{const _=r.labels.find(g=>g.id===t.labelId);_&&(_.offset=t.offset)});i.patchState(o),this.savePatches(s,a)}setLabels(i,t){i.patchState(jn.jM(i.getState(),o=>{o.labels=t.labels}))}setLabel(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{r.labels=r.labels.map(_=>_.id===t.label.id?t.label:_)});i.patchState(o),t.record&&this.savePatches(s,a)}setLabelStates(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{r.labels.find(g=>g.id===t.id).states=t.states});i.patchState(o),this.savePatches(s,a)}setLabelScale(i,t){i.patchState({labelScale:t.scale})}addLabel(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{const _=t.label.id||li.u.idWithPrefix("label"),g={...t.label,id:_};r.labels.push(g)});i.patchState(o),t.record&&this.savePatches(s,a)}addContextLabel(i,t){const o=jn.jM(i.getState(),s=>{s.contextLabel={...t.label,id:hl}});i.patchState(o)}removeLabel(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{r.labels=r.labels.filter(_=>_.id!==t.label.id)});i.patchState(o),this.markerService.deleteMarker(t.label.id),this.savePatches(s,a)}removeContextLabel(i,t){const o=jn.jM(i.getState(),s=>{s.contextLabel=void 0});this.markerService.deleteMarker(hl),i.patchState(o)}removeAllChapterLabels(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{const[_,g]=(0,u.partition)(r.labels,P=>P.chapterId!==t.chapter.id);g.forEach(P=>this.markerService.deleteMarker(P.id)),r.labels=_});i.patchState(o),t.record&&this.savePatches(s,a)}selectLabel(i,t){i.patchState({selectedLabel:t.label?t.label.id:null})}resetLabels(i,t){const o=i.getState();this.markerService.deleteMarker(hl),o.labels.forEach(s=>{this.markerService.deleteMarker(s.id)}),i.setState(jn.jM(i.getState(),s=>{}))}convertLabels(i,t){const[o,s,a]=jn.vI(i.getState(),r=>{t.labels.forEach(_=>{const g=r.labels.findIndex(P=>P.id===_.id);r.labels[g]={...r.labels[g],...t.fields}})});i.setState({...o}),this.savePatches(s,a)}enableContextLabel(i,t){i.patchState({enableContextLabel:{...t}})}setLabelsShown(i,{labels:t,shown:o}){const s=i.getState().labels.map(a=>{const r=t.some(_=>_.id===a.id);return{...a,shown:r?o:a.shown}});i.patchState({labels:[...s]})}setAllLabelsShown(i,{show:t}){const o=i.getState().labels;i.dispatch(new Je.D3(o,t))}setLabelsCollapsed(i,{collapsed:t,collapsedMode:o}){i.patchState({labelsCollapsed:t,labelsCollapsedMode:o})}setLabelsDraggable(i,t){i.patchState({draggable:{...t.draggable}})}savePatches(i,t){this.store.dispatch(new bi.a.SavePatches([{forward:i,inverse:t,patchAction:Je.sW}]))}constructor(i,t){this.store=i,this.markerService=t}static#t=this.\u0275fac=function(t){return new(t||md)(e.KVO(l.il),e.KVO(nr))};static#n=this.\u0275prov=e.jDH({token:md,factory:md.\u0275fac})};ln([(0,l.rc)(Je.sW),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.sW]),Ye("design:returntype",void 0)],et.prototype,"PatchLabels",null),ln([(0,l.rc)(Je.yi),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.yi]),Ye("design:returntype",void 0)],et.prototype,"setLabelOffset",null),ln([(0,l.rc)(Je.gJ),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.gJ]),Ye("design:returntype",void 0)],et.prototype,"setLabels",null),ln([(0,l.rc)(Je.lb),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.lb]),Ye("design:returntype",void 0)],et.prototype,"setLabel",null),ln([(0,l.rc)(Je.HP),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.HP]),Ye("design:returntype",void 0)],et.prototype,"setLabelStates",null),ln([(0,l.rc)(Je.tH),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.tH]),Ye("design:returntype",void 0)],et.prototype,"setLabelScale",null),ln([(0,l.rc)(Je.Sh),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.Sh]),Ye("design:returntype",void 0)],et.prototype,"addLabel",null),ln([(0,l.rc)(Je.h5),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.h5]),Ye("design:returntype",void 0)],et.prototype,"addContextLabel",null),ln([(0,l.rc)(Je.vx),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.vx]),Ye("design:returntype",void 0)],et.prototype,"removeLabel",null),ln([(0,l.rc)(Je.S3),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.S3]),Ye("design:returntype",void 0)],et.prototype,"removeContextLabel",null),ln([(0,l.rc)(Je.u1),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.u1]),Ye("design:returntype",void 0)],et.prototype,"removeAllChapterLabels",null),ln([(0,l.rc)(Je.TR),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.TR]),Ye("design:returntype",void 0)],et.prototype,"selectLabel",null),ln([(0,l.rc)(Je.$y),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.$y]),Ye("design:returntype",void 0)],et.prototype,"resetLabels",null),ln([(0,l.rc)(Je.$K),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.$K]),Ye("design:returntype",void 0)],et.prototype,"convertLabels",null),ln([(0,l.rc)(Je.Tz),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.Tz]),Ye("design:returntype",void 0)],et.prototype,"enableContextLabel",null),ln([(0,l.rc)(Je.D3),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.D3]),Ye("design:returntype",void 0)],et.prototype,"setLabelsShown",null),ln([(0,l.rc)(Je.eH),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.eH]),Ye("design:returntype",void 0)],et.prototype,"setAllLabelsShown",null),ln([(0,l.rc)(Je.vf),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.vf]),Ye("design:returntype",void 0)],et.prototype,"setLabelsCollapsed",null),ln([(0,l.rc)(Je.Ds),Ye("design:type",Function),Ye("design:paramtypes",[Object,Je.Ds]),Ye("design:returntype",void 0)],et.prototype,"setLabelsDraggable",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getLabels",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getLabelsCollapsed",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getLabelsCollapsedMode",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getSelectedLabelId",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getSelectedLabel",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getContextLabel",null),ln([(0,l.MD)([et,me.N]),Ye("design:type",Function),Ye("design:paramtypes",[Vi,Iy.G]),Ye("design:returntype",void 0)],et,"getChapterLabels",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getEnableContextLabel",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getEnableContextLabelInfo",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getEnableContextLabelActions",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getEnableContextLabelAudio",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getLabelsDraggable",null),ln([(0,l.MD)(),Ye("design:type",Function),Ye("design:paramtypes",[Vi]),Ye("design:returntype",void 0)],et,"getLabelScale",null),et=oa=ln([(0,l.Uw)({name:"labels",defaults:oh}),Ye("design:paramtypes",[l.il,nr])],et);var ts=d(12921),Fe=d(87710),sh=d(4959),Rn=d(13409),ir=d(60286);let ah=(()=>{class n{constructor(t){this.engineService=t}createEngineClippingPlanes(t){return(0,A.makeClippingPlanes)(t)}setClippingPlanes(t){const{story:o}=this.engineService.engine,{activeChapter:s}=o;if((0,u.isNil)(s))return;const a=this.createEngineClippingPlanes(t);s.clippingPlanes.length=0,s.clippingPlanes.push(...a)}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(v.y))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const xd=1e-4;function gl(n,i){const t={};return Math.abs(n[0]-i)>=xd&&(t.x=n[0]),Math.abs(n[1]-i)>=xd&&(t.y=n[1]),Math.abs(n[2]-i)>=xd&&(t.z=n[2]),t.x||t.y||t.z?t:null}function rh(n,i){if(i[n.objectId])return null;let t={objectId:n.objectId,displayName:n.displayName,layer:n.layer};return n.transformId?t.transformId=n.transformId:t=function Py(n,i){const t=A.vec3Pool.get();wi.scale(t,n.sceneNode.rotation,180/Math.PI);const o={translate:gl(n.sceneNode.position,0),rotate:gl(t,0),scale:gl(n.sceneNode.scale,1),pivot:gl(n.sceneNode.origin,0)};return A.vec3Pool.release(t),(0,u.isNull)(o.translate)||(i.translate=o.translate),(0,u.isNull)(o.rotate)||(i.rotate=o.rotate),(0,u.isNull)(o.scale)||(i.scale=o.scale),(0,u.isNull)(o.pivot)||(i.pivot=o.pivot),i.transformId&&(console.error("There should not be a transform"),delete i.transformId),i}(n,t),t=function wy(n,i){const o=lh(n.renderables??[]);return 1===o.length?(0,u.merge)(i,o[0]):o.length>1&&(i.renderables=o),i}(n,t),n.children&&n.children.length&&(t.objects=[]),n.children.forEach(o=>{const s=rh(o,i);null!==s&&t.objects.push(s)},this),n.variants?.length>1&&(t.variants=n.variants.map(o=>lh(o))),t}function lh(n){return n.map(i=>{const{geometryId:t,morphId:o,materialId:s,layer:a}=i;return{geometryId:t,morphId:o,materialId:s,layer:a}})}let ml=(()=>{class n{constructor(t,o,s,a,r,_,g,P){this.store=t,this.engineService=o,this.chapterSerializer=s,this.animationService=a,this.chapterService=r,this.paintService=_,this.clippingPlanesService=g,this.sceneService=P}serializeUI(t){const o={...t.ui};return t.chapters.length>1&&(o.scrubber=!1,o.playPause=!1,o.tour={chapters:!0}),o}serializeAnimation(t){return this.animationService.isChapterAnimated(t)?{play:{startTime:t.timelineMap[0].start,loop:!1!==t.loop,numChapters:1}}:{}}getClippedObjects(){const t=this.store.selectSnapshot(me.N.getSelectedChapterClippingPlanes),o=this.clippingPlanesService.createEngineClippingPlanes(t);return 0===o.length?{}:this.sceneService.getLeafIds().reduce((s,a)=>{const r=this.sceneService.getObjectById(a);return this.sceneService.isObjectCulledByClip(r,o)&&(s[a]=!0),s},{})}generateTrimObjectMap(t){const o={};if(t.graph.unavailable){const a=this.store.selectSnapshot(Rn.z.getAllNodeState);Object.values(a).forEach(r=>{Object.entries(r).forEach(([_,g])=>{!1!==o[_]&&(o[_]=!g.available)})})}if(t.graph.hidden){const a=this.store.selectSnapshot(Rn.z.getAllNodeState);Object.values(a).forEach(r=>{Object.entries(r).forEach(([_,g])=>{!1!==o[_]&&(o[_]=!(g.shown||g.shownSetByTween))})})}const s=t.graph.clipped?this.getClippedObjects():{};return{...o,...s}}trimObjects(t,o){if(o[t.objectId])return null;const s=[];return t.children.forEach(a=>{const r=this.trimObjects(a,o);(0,u.isNil)(r)||s.push(r)}),t.children=s,t}serialize(t,o,s=!1,a,r,_,g=!1){const P=(0,u.cloneDeep)(a),F=this.generateTrimObjectMap(o),ee=this.sceneService.getRootObjects();P.sceneGraph=function Ay(n,i){const t=[];return Object.entries(n).forEach(([o,s])=>{const a=rh(s,i);null!==a&&t.push(a)},this),t}(ee,F);const le=[];Object.values(ee).forEach(rn=>{const qe=this.trimObjects(rn,F);null!==qe&&le.push(qe)},this);const he=(0,hy.ow)(this.paintService.getColorRecipes()),ue=(0,na.fm)(le,he),ye=this.store.selectSnapshot(et.getLabels);P.chapters=r.map(rn=>this.chapterSerializer.serializeChapter(ue,rn,t,ye,_,g)),P.ui=this.serializeUI(P),P.animation=this.serializeAnimation(r[0]),P.customData={...P.customData,particleSystems:this.store.selectSnapshot(ts.B.getParticleSystemsList)},P.sourceInfo=eh(P.sourceInfo);const Ge=this.store.selectSnapshot(Fe.j.getAllQuestions),Ve=this.store.selectSnapshot(Fe.j.getQuizSettings);Ve&&Ge.length>0?P.quizSettings=Ve:delete P.quizSettings,P.playthroughSettings=a.playthroughSettings,P.tweenParticleLookup=this.store.selectSnapshot(ts.B.getTweenParticleLookup);const it=r.reduce((rn,qe)=>rn.concat(this.chapterService.getChapterLightLibraries(qe)),[]),ot=Array.from(new Set(it));P.assetLibraries.lights.forEach(rn=>{ot.includes(rn)||ot.push(rn)}),P.assetLibraries.lights=ot;const _t=this.getReflectionLibraries(P.reflections),xt=r.reduce((rn,qe)=>rn.concat(this.chapterService.getChapterReflectionLibraries(qe)),[]);P.assetLibraries.reflections=Array.from(new Set(_t.concat(xt)));const $t=[...Object.values(P.assetLibraries)].flat(),hn=this.getSceneGraphStateIds(P.sceneGraph);return P.stateId=Array.from(new Set($t.map(this.getStateId).concat(hn))),(0,u.isEmpty)(a.variantSchemas)?delete P.variantSchemas:P.variantSchemas=a.variantSchemas,{story:s?My(P,t):P}}getReflectionLibraries(t){return t=t||{},Object.values(t).map(s=>{const a=s.split(".");return[a[0],a[1]].join("/")})}getSceneGraphStateIds(t){return t.map(o=>o.objectId.split("-")[0])}getStateId(t){return t.split("/")[0]}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(v.y),e.KVO(uy.p),e.KVO(co.O),e.KVO(sh.j),e.KVO(ir.s),e.KVO(ah),e.KVO(Fi.w))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class ch{constructor(){this.graph={unavailable:!1,hidden:!1,clipped:!1}}}var fl,Vt=d(61295),Ry=d(29284),jd=d(65881),yn=d(35939),Xt=d(76016),Vd=d(21472),di=d(46104),It=d(17215),_o=d(76774),Go=d(65650),Nn=d(33013),Ts=d(82323),Jn=d(11040),nn=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Be=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const dh={loading:!1,incoming:{id:void 0,type:void 0},storyId:void 0,storyType:void 0,storyLang:void 0,loadingChapter:null,loadChapters:[],loadChaptersRemaining:[],thumbnailLookup:[],manifestsMaxTimes:void 0};let dt=class fd{static#e=fl=this;static getStory(i){return i.story}static getStoryId(i){return i.storyId}static getStoryType(i){return i.storyType}static getLoadingChapter(i){return i.loadingChapter}static getLoadChapters(i){return i.loadChapters}static getLoadChaptersRemaining(i){return i.loadChaptersRemaining}static getStoryInfo(i){return{id:i.storyId,type:i.storyType}}static getIncomingStoryInfo(i){return i.incoming}static getStoryTags(i){return i?.story?.tags??[]}static getStoryLanguage(i){return i.storyLang??Jn.q.lang}static getAnimationManifests(i){return i.manifestsMaxTimes}static getStorySourceInfo(i){return i.story?.sourceInfo}static getVariantSchemas(i){return i.story?.variantSchemas??{}}static getVariantSchema(i){return(0,l.Mz)([fl.getVariantSchemas],t=>t[i])}setStoryText(i,t){const o=i.getState().story;o&&i.patchState({story:{...o,displayName:t.displayName}})}setStoryTags(i,{tags:t}){const o=i.getState().story;o&&i.patchState({story:{...o,tags:t}})}setStoryPlaythrough(i,{playthroughSettings:t}){const o=i.getState().story;o&&i.patchState({story:{...o,playthroughSettings:t}})}setStorySourceInfo(i,{sourceInfo:t}){const o=i.getState().story;o&&i.patchState({story:{...o,sourceInfo:t}})}loadManifests(i){i.patchState({manifestsMaxTimes:void 0});const t=this.storyService.getTweenEndTimes(),o=Object.values(this.sceneService.getObjects());this.storyService.findMorphEndTimes(o).subscribe(s=>{i.patchState({manifestsMaxTimes:{...s,...t}})})}setStoryLightLibs(i,t){const o=i.getState().story;o&&i.patchState({story:{...o,assetLibraries:{...o.assetLibraries,lights:t.lightLibs}}})}setStory(i,t){i.patchState({story:t.story})}SetStoryId(i,t){i.patchState({storyId:t.id})}setIncomingStory(i,t){const o=i.getState(),{id:s,type:a,reset:r}=t;(s!==o.storyId||r)&&i.patchState({incoming:{id:s,type:a}})}loadStory(i,t){const o=t.preview?(0,Vd.H)(this.storageService.getDatabaseItem(It.AJ.PreviewStory)):this.storyService.getStory(t.id,t.type,t.lang),s=this.storyService.getStoryLang(t.id,t.type,t.lang);(0,di.p)([o,s]).subscribe(([a,r])=>{i.dispatch(new ct.Z0(a,t.id,t.type,r))},()=>{!0===this.reload?(this.reload=!1,this.loadStory(i,t)):i.dispatch(new ct.S9(t.id,t.type))})}loadStorySuccess(i,{story:t,id:o,type:s,lang:a}){i.patchState({story:t,storyId:o,storyType:s,storyLang:a}),i.dispatch(new ct.Ck(o,t,s))}buildStoryWorkflow(i,t,o,s,a=0,r=new Map,_=!0){if((0,u.isNil)(this.engineService.engine))return;_&&(o.moduleId=t,this.engineService.setStory(o),i.patchState({storyId:t,story:o})),this.engineService.engine.start();const g=this.sceneService.getRootObjects(),P=this.storyService.getStoryChapters(g,o,s);let F=[];P.forEach(it=>{F=[...F,...it.labels]});const ee=this.storyService.getStoryLoadChapters(o);i.patchState({loadChapters:ee,loadChaptersRemaining:ee,incoming:{id:void 0,type:void 0}});const le=this.sceneService.getSceneGraph(g),he=P.reduce((it,ot)=>(it[ot.id]=(0,Ry.iE)(le,ot.showObjects,ot.availableObjects,ot.pickThroughObjects,ot.synchronization),it),{});P.forEach(it=>{((0,u.isNil)(it.createdFrom)||0===it.createdFrom.length)&&(it.createdFrom=[{id:t,timestamp:Date.now()}])}),i.dispatch(new Vt.K8(he)),i.dispatch(new Vt.IA(P[a].id)),i.dispatch(new Nn.lM(P)),i.dispatch(new Ts.W2(r)),i.dispatch(new Je.gJ(F)),i.dispatch(new Nn.yz(P[a]));const ue=o.tweenParticleLookup??{},ye=o.customData?.particleSystems??[],Ge=P.reduce((it,ot)=>(it[ot.id]=ot.customData?.particleSystems??[],it),{});i.dispatch(new yn.u.SetParticleState(ye,Ge,ue)),i.dispatch(new Xt.B.ResetQuizState),o.quizSettings&&i.dispatch(new Xt.B.SetQuizSettings(o.quizSettings));const Ve=(0,_o.En)(P);i.dispatch(new Xt.B.SetQuestions(Ve)),i.dispatch(new ct.nm),i.dispatch(new E.SetChapterCallToActionSeen(!1)),i.dispatch(new ct.t1(o,t,s)),i.dispatch(new ct.ub)}importStorySuccess(i,t){const o=i.getState(),s=o.storyType,a=o.storyId,_=new ch,P=this.store.selectSnapshot(fl.getStory),F=this.store.selectSnapshot(me.N.getStoryChapters),ee=(0,jd.S)(F,!1),le=this.serializeModuleService.serialize({},_,!1,P,F,ee,!1).story,he=dy(le,a,t.story,t.id,z.c.exportType),ue=he.chapters.slice(le.chapters.length).reduce((Ge,Ve,it)=>(Ge[t.story.chapters[it].id]=Ve.id,Ge),{}),ye=t.story.chapters.reduce((Ge,Ve)=>{const it=Ve.thumbnails?Ve.thumbnails.large:Fo.generateLegacyThumbnail(t.id,Ve.id).large,ot=Fo.makeFreshThumbnail(a,ue[Ve.id],it);return Ge.push(ot),Ge},[]);(0,di.p)(ye).subscribe(Ge=>{const Ve=this.store.selectSnapshot(Go.K.getRegisteredThumbnails);Ge.forEach(it=>{Ve.set(it.chapterId,it)}),this.buildStoryWorkflow(i,a,he,s,he.chapters.length-1,Ve)})}buildStory(i,t){const o=Fo.getChapterThumbnails(t.id,t.story.chapters);this.buildStoryWorkflow(i,t.id,t.story,t.type,t.chapterIdx||0,o,t.replaceActiveStory)}loadChapter(i){const t=i.getState().loadChaptersRemaining[0];if(!t)return;i.patchState({loadingChapter:t});let o=!1;this.storyService.loadChapter(t).then(()=>{}).catch(s=>{(0,u.isNil)(this.engineService.engine?.story)?o=!0:console.error(s)}).finally(()=>{o?console.warn(`Loading of chapter ${t.chapterId} cancelled.`):i.dispatch([new ct.dC(t),new ct.ub])})}reorderLoadChapters(i,t){const{loadChaptersRemaining:o}=i.getState(),[s,a]=(0,u.partition)(o,r=>r.chapterId===t.chapterId);i.patchState({loadChaptersRemaining:[...s,...a]})}loadChapterSuccess(i,t){const o=i.getState().loadChaptersRemaining.filter(s=>s.chapterId!==t.chapter.chapterId);i.patchState({loadingChapter:null,loadChaptersRemaining:o}),i.dispatch(new Nn.M5(t.chapter.chapterId,{model:!0,animation:!1,...t.chapter.readyState})),i.dispatch(new Nn.eV(t.chapter.chapterId))}synchronizeChapters(i){const t=this.store.selectSnapshot(me.N.getStoryChapters),{story:o}=i.getState();i.patchState({story:{...o,chapters:[...t]}})}importStory(i,t){this.storyService.getStory(t.id,t.type,t.lang).subscribe(o=>{i.dispatch(new ct.yw(o,t.id,t.type))})}resetStory(i){i.setState(dh)}mergeBridgeModuleSuccess(i,{story:t}){const o=i.getState(),s=this.store.selectSnapshot(me.N.getSelectedChapterIndex),a=Fo.getChapterThumbnails(o.storyId,t.chapters);this.buildStoryWorkflow(i,o.storyId,t,Se.c.Module,s,a)}constructor(i,t,o,s,a,r){this.store=i,this.storyService=t,this.serializeModuleService=o,this.storageService=s,this.sceneService=a,this.engineService=r,this.reload=z.c.native}static#t=this.\u0275fac=function(t){return new(t||fd)(e.KVO(l.il),e.KVO(Pi.J),e.KVO(ml),e.KVO(It.n$),e.KVO(Fi.w),e.KVO(v.y))};static#n=this.\u0275prov=e.jDH({token:fd,factory:fd.\u0275fac})};nn([(0,l.rc)(ct.fK),Be("design:type",Function),Be("design:paramtypes",[Object,ct.fK]),Be("design:returntype",void 0)],dt.prototype,"setStoryText",null),nn([(0,l.rc)(ct.Hd),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Hd]),Be("design:returntype",void 0)],dt.prototype,"setStoryTags",null),nn([(0,l.rc)(ct.dr),Be("design:type",Function),Be("design:paramtypes",[Object,ct.dr]),Be("design:returntype",void 0)],dt.prototype,"setStoryPlaythrough",null),nn([(0,l.rc)(ct.Pv),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Pv]),Be("design:returntype",void 0)],dt.prototype,"setStorySourceInfo",null),nn([(0,l.rc)(ct.V_),Be("design:type",Function),Be("design:paramtypes",[Object]),Be("design:returntype",void 0)],dt.prototype,"loadManifests",null),nn([(0,l.rc)(ct.KM),Be("design:type",Function),Be("design:paramtypes",[Object,ct.KM]),Be("design:returntype",void 0)],dt.prototype,"setStoryLightLibs",null),nn([(0,l.rc)(ct.cX),Be("design:type",Function),Be("design:paramtypes",[Object,ct.cX]),Be("design:returntype",void 0)],dt.prototype,"setStory",null),nn([(0,l.rc)(ct.Tt),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Tt]),Be("design:returntype",void 0)],dt.prototype,"SetStoryId",null),nn([(0,l.rc)(ct.yi),Be("design:type",Function),Be("design:paramtypes",[Object,ct.yi]),Be("design:returntype",void 0)],dt.prototype,"setIncomingStory",null),nn([(0,l.rc)(ct.Ye),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Ye]),Be("design:returntype",void 0)],dt.prototype,"loadStory",null),nn([(0,l.rc)(ct.Z0),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Z0]),Be("design:returntype",void 0)],dt.prototype,"loadStorySuccess",null),nn([(0,l.rc)(ct.yw),Be("design:type",Function),Be("design:paramtypes",[Object,ct.yw]),Be("design:returntype",void 0)],dt.prototype,"importStorySuccess",null),nn([(0,l.rc)(ct.Ck),Be("design:type",Function),Be("design:paramtypes",[Object,ct.Ck]),Be("design:returntype",void 0)],dt.prototype,"buildStory",null),nn([(0,l.rc)(ct.ub),Be("design:type",Function),Be("design:paramtypes",[Object]),Be("design:returntype",void 0)],dt.prototype,"loadChapter",null),nn([(0,l.rc)(ct.si),Be("design:type",Function),Be("design:paramtypes",[Object,ct.si]),Be("design:returntype",void 0)],dt.prototype,"reorderLoadChapters",null),nn([(0,l.rc)(ct.dC),Be("design:type",Function),Be("design:paramtypes",[Object,ct.dC]),Be("design:returntype",void 0)],dt.prototype,"loadChapterSuccess",null),nn([(0,l.rc)(ct.Hy),Be("design:type",Function),Be("design:paramtypes",[Object]),Be("design:returntype",void 0)],dt.prototype,"synchronizeChapters",null),nn([(0,l.rc)(ct.fn),Be("design:type",Function),Be("design:paramtypes",[Object,ct.fn]),Be("design:returntype",void 0)],dt.prototype,"importStory",null),nn([(0,l.rc)(ct.jj),Be("design:type",Function),Be("design:paramtypes",[Object]),Be("design:returntype",void 0)],dt.prototype,"resetStory",null),nn([(0,l.rc)(ct.Nu),Be("design:type",Function),Be("design:paramtypes",[Object,Object]),Be("design:returntype",void 0)],dt.prototype,"mergeBridgeModuleSuccess",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStory",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStoryId",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStoryType",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getLoadingChapter",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getLoadChapters",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getLoadChaptersRemaining",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStoryInfo",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getIncomingStoryInfo",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStoryTags",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStoryLanguage",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getAnimationManifests",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",void 0)],dt,"getStorySourceInfo",null),nn([(0,l.MD)(),Be("design:type",Function),Be("design:paramtypes",[Hn.o]),Be("design:returntype",Object)],dt,"getVariantSchemas",null),dt=fl=nn([(0,l.Uw)({name:"story",defaults:dh}),Be("design:paramtypes",[l.il,Pi.J,ml,It.n$,Fi.w,v.y])],dt);var po,cn=d(82656),qt=d(17365),dn=d(47555),st=d(47610),Sn=d(35426),ki=d(76718),sa=d(35160);!function(n){function t(P){a()&&(P||(P=document.body),P.requestFullscreen?P.requestFullscreen():P.webkitRequestFullscreen&&P.webkitRequestFullscreen())}function o(){a()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}function s(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}function a(){return!!s()||(console.warn("Fullscreen is not enabled"),!1)}function r(){return document.fullscreenElement||document.webkitFullscreenElement}function _(){return!(0,u.isNil)(r())}n.toggleFullscreen=function i(P){const F=r();(0,u.isNil)(F)?t(P):o()},n.requestFullscreen=t,n.exitFullscreen=o,n.canFullscreen=s,n.checkFullscreenSupport=a,n.getFullscreenElement=r,n.isFullscreen=_,n.onFullscreenChange=function g(){const P=["mozfullscreenchange","webkitfullscreenchange","fullscreenchange"].map(F=>(0,Sn.R)(document.body,F));return(0,ki.h)(...P).pipe((0,W.T)(()=>_()),(0,sa.Z)(_()))}}(po||(po={}));var Ki=function(n){return n.None="none",n.Play="play",n.Button="button",n.Hand="hand",n.Summary="summary",n}(Ki||{}),_n=function(n){return n[n.XRLoader=0]="XRLoader",n[n.OnDemand=1]="OnDemand",n[n.Interact=2]="Interact",n[n.Loader=3]="Loader",n[n.Tutorial=4]="Tutorial",n[n.Whiteboard=5]="Whiteboard",n[n.Help=6]="Help",n}(_n||{}),To=function(n){return n.Text="text",n.Paint="paint",n.Erase="erase",n}(To||{});const _h=[4,8,12,16,24,32],Fd=n=>n.slice(0).reverse().map(i=>({label:`${i}`,size:i})),ph=Fd(_h),uh=Fd([8,12,16,20,24,32]),hh=Fd(_h),Gd={color:"#000000"},gh={color:"#ffffff"},ky=ph[4],Dy=Gd,Ly=uh[3],Uy=hh[4],xy=Gd,jy=gh;var $d,Os=function(n){return n.Mouse="mouse",n.Touch="touch",n}(Os||{}),Sl=function(n){return n[n.Default=0]="Default",n.DrawerOnly="drawer",n.ColumnOnly="column",n}(Sl||{}),Vy=d(79083),uo=d(18272),Bt=function(n){return n.NodeInfo="nodeInfo",n.LabelInfo="labelInfo",n.ChapterInfo="chapterInfo",n.Quiz="Quiz",n.Search="Search",n.VisibilityLayers="VisibilityLayers",n}(Bt||{}),Xe=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},ne=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class Dt{}const mh={autoplay:!1,contentMode:Bt.ChapterInfo,lang:"en",canFullscreen:!1,canHover:!1,canTouch:!1,drawerCoversContent:!1,fadeout:3e3,preventFadeoutEvents:{mouseenter:!1,focusin:!1,overlay:!1},forceAudio:!1,fullscreenActive:!1,help:{tab:te.Basics},inputEnabled:!0,inputMode:Os.Mouse,interactType:Ki.Play,isMobileWeb:!1,onDemand:!1,layout:Sl.Default,labelsBreakpoint:480,menuOpen:!1,multiPickModeEnabled:!1,openWindows:[_n.Loader],toggledPanels:new Map,playthroughSettings:{enabled:!1,countdown:3e3,countdownDelay:2e3,forceAudio:!0,loop:!1,minimum:1e4},presentationActive:!1,searchDisplayMode:uo.q.List,startingColumn:"info",preferredColumn:null,startingTool:null,nodeInfo:{show:!1,fallback:Vy.H.Wikipedia},tutorial:{pageSize:0,pageIndex:-1},tutorialSeen:!0,usePrintImage:!1,whiteboard:{enabled:!1,locked:!1,hasPaint:!1,hasText:!1,brushSize:ky.size,brushColor:Dy.color,textSize:Ly.size,eraserSize:Uy.size,annotateMode:To.Paint},scrim:{show:!1,label:""},chapterCallToActionSeen:!1};let de=class Sd{static#e=$d=this;static getAutoplay(i){return i.autoplay}static getContentMode(i){return i.contentMode}static getLabelsBreakpoint(i){return i.labelsBreakpoint}static getInputEnabled(i){return i.inputEnabled}static getIsMobileWeb(i){return i.isMobileWeb}static getFullscreenActive(i){return i.fullscreenActive}static getPresentationActive(i){return i.presentationActive}static getDrawerCoversContent(i){return i.drawerCoversContent}static getShowNodeInfo(i){return i.nodeInfo.show}static getNodeInfoFallback(i){return i.nodeInfo.fallback}static getToggledPanels(i){return i.toggledPanels}static getViewLanguage(i){return i.lang}static getInteractType(i){return i.interactType}static getForceAudio(i){return i.forceAudio}static getOnDemand(i){return i.onDemand}static getFadeout(i){return i.fadeout}static getFadeoutPaused(i){return i.preventFadeoutEvents.mouseenter||i.preventFadeoutEvents.focusin||i.preventFadeoutEvents.overlay}static getPlaythroughSettings(i){return i.playthroughSettings}static getPlaythroughEnabled(i){return i.playthroughSettings.enabled}static getPreferredColumn(i){return i.preferredColumn}static getStartingColumn(i){return i.startingColumn}static getStartingTool(i){return i.startingTool}static getLayout(i){return i.layout}static getInputMode(i){return i.inputMode}static getShowHelpTab(i){return i.help.tab}static getTutorial(i){return i.tutorial}static getTutorialSeen(i){return i.tutorialSeen}static getWhiteboardEnabled(i){return i.whiteboard.enabled}static isWhiteboardLocked(i){return i.whiteboard.locked}static getWhiteboardBrushSize(i){return i.whiteboard.brushSize}static getWhiteboardTextSize(i){return i.whiteboard.textSize}static getWhiteboardEraserSize(i){return i.whiteboard.eraserSize}static getWhiteboardAnnotateMode(i){return i.whiteboard.annotateMode}static getWhiteboardBrushColor(i){return i.whiteboard.brushColor}static getWhiteboardHasPaint(i){return i.whiteboard.hasPaint}static getWhiteboardHasText(i){return i.whiteboard.hasText}static getCanTouch(i){return i.canTouch}static getCanHover(i){return i.canHover}static getMultiPickModeEnabled(i){return i.multiPickModeEnabled}static getSearchDisplayMode(i){return i.searchDisplayMode}static getUsePrintImage(i){return i.usePrintImage}static getOpenWindow(i){return i.openWindows.length>0?i.openWindows.sort()[0]:null}static getMenuOpen(i){return i.menuOpen}static getScrim(i){return i.scrim}static getChapterCallToActionSeen(i){return i.chapterCallToActionSeen}static shouldWindowOpen(i){return(0,l.Mz)([$d],t=>t.openWindows.indexOf(i)>=0)}setAutoplay(i,t){i.patchState({autoplay:t.autoplay})}setContentMode(i,t){i.patchState({contentMode:t.column})}setInputEnabled(i,t){i.patchState({inputEnabled:t.enabled})}setCanHover(i,t){i.patchState({canHover:t.canHover})}setCanTouch(i,t){i.patchState({canTouch:t.canTouch})}setCanFullscreen(i,t){i.patchState({canFullscreen:t.canFullscreen})}setSearchDisplayMode(i,t){i.patchState({searchDisplayMode:t.mode})}setViewLanguage(i,{lang:t}){i.patchState({lang:t})}toggleNodeInfo(i,{show:t}){i.patchState({nodeInfo:{...i.getState().nodeInfo,show:t}})}setNodeInfoConfig(i,{fallback:t}){i.patchState({nodeInfo:{...i.getState().nodeInfo,fallback:t}})}togglePanel(i,t){const o=i.getState().toggledPanels;o.set(t.panel,t.show),i.patchState({toggledPanels:o})}togglePresentation(i,t){i.patchState({presentationActive:t.active})}toggleHelp(i,t){i.patchState({help:{tab:t.tab}})}setFadeout(i,t){i.patchState({fadeout:t.fadeout})}addPreventFadeoutElement(i,t){const o=i.getState().preventFadeoutEvents;o[t.event]=t.value,i.patchState({preventFadeoutEvents:{...o}})}setPlaythrough(i,t){const o=i.getState().playthroughSettings;(0,u.mergeWith)(o,t.playthrough,(s,a)=>{if(!(0,u.isNil)(a))return a}),i.patchState({playthroughSettings:o})}setPlaythroughEnabled(i,t){let o=i.getState().playthroughSettings;o={...o,enabled:t.enabled},i.patchState({playthroughSettings:o})}setStartingColumn(i,t){i.patchState({startingColumn:t.column})}setPreferredColumn(i,t){i.patchState({preferredColumn:t.column})}setStartingTool(i,t){i.patchState({startingTool:t.tool})}setLoaderType(i,t){i.patchState({interactType:t.interactType})}setForceAudio(i,t){i.patchState({forceAudio:t.forceAudio})}setOnDemand(i,t){i.patchState({onDemand:t.onDemand})}setInputMode(i,{inputMode:t}){i.patchState({inputMode:t})}SetLayout(i,t){i.patchState({layout:t.layout})}setTutorial(i,t){const o=i.getState().tutorial;i.patchState({tutorial:{...o,...t.tutorial}})}startTutorial(i,t){i.patchState({tutorial:{...i.getState().tutorial,pageIndex:t.intro?-1:0}}),i.dispatch(new E.TutorialSeen(!0))}tutorialSeen(i,t){this.storageService.setLocalItem(It.UT.GettingStartedTutorial,t.seen),i.patchState({tutorialSeen:t.seen})}tutorialPrevious(i,t){const o=i.getState().tutorial,s=Math.max(o.pageIndex-1,0);i.dispatch(new E.SetTutorial({...o,pageIndex:s}))}tutorialNext(i,t){const o=i.getState().tutorial,s=Math.min(o.pageIndex+1,o.pageSize-1);i.dispatch(new E.SetTutorial({...o,pageIndex:s}))}setWhiteboardEnabled(i,{enabled:t}){i.patchState({whiteboard:{...i.getState().whiteboard,enabled:t}})}setWhiteboardLocked(i,{locked:t}){i.patchState({whiteboard:{...i.getState().whiteboard,locked:t}})}setWhiteboardBrushSize(i,{brushSize:t}){i.patchState({whiteboard:{...i.getState().whiteboard,brushSize:t}})}setWhiteboardTextSize(i,{size:t}){i.patchState({whiteboard:{...i.getState().whiteboard,textSize:t}})}setWhiteboardEraserSize(i,{eraserSize:t}){i.patchState({whiteboard:{...i.getState().whiteboard,eraserSize:t}})}setWhiteboardAnnotateMode(i,{mode:t}){i.patchState({whiteboard:{...i.getState().whiteboard,annotateMode:t}})}setWhiteboardBrushColor(i,{brushColor:t}){i.patchState({whiteboard:{...i.getState().whiteboard,brushColor:t}})}setWhiteboardHasPaint(i,{hasPaint:t}){i.patchState({whiteboard:{...i.getState().whiteboard,hasPaint:t}})}setWhiteboardHasText(i,{hasText:t}){i.patchState({whiteboard:{...i.getState().whiteboard,hasText:t}})}setMultiPickModeEnabled(i,t){i.patchState({multiPickModeEnabled:t.enabled})}setLabelBreakpoint(i,t){i.patchState({labelsBreakpoint:t.labelsBreakpoint})}setUsePrintImage(i,t){i.patchState({usePrintImage:t.usePrintImage})}setWindows(i,t){i.patchState({openWindows:t.windows})}setIsMobileWeb(i,t){i.patchState({isMobileWeb:t.isMobileWeb})}openWindow(i,t){const o=i.getState().openWindows;o.indexOf(t.window)<0&&i.patchState({openWindows:[t.window,...o]})}closeWindow(i,t){let o=i.getState().openWindows;null!=t.window?o=o.filter(s=>s!==t.window):o.shift(),i.patchState({openWindows:[...o]})}toggleWindow(i,t){const o=i.getState().openWindows.indexOf(t.window)>=0;i.dispatch((null!=t.show?t.show:!o)?new E.OpenWindow(t.window):new E.CloseWindow(t.window))}toggleMenu(i,t){i.patchState({menuOpen:t.open})}showScrim(i,t){i.patchState({scrim:{show:!0,label:t.label}})}hideScrim(i,t){i.patchState({scrim:{show:!1,label:""}})}setChapterCallToActionSeen(i,t){i.patchState({chapterCallToActionSeen:t.chapterCallToActionSeen})}ResetViewState(i,t){i.setState({...mh})}constructor(i){this.storageService=i}ngxsOnInit(i){po.onFullscreenChange().subscribe(t=>{i.patchState({fullscreenActive:t})}),i.patchState({tutorialSeen:this.storageService.getLocalJSON(It.UT.GettingStartedTutorial)||!1})}static#t=this.\u0275fac=function(t){return new(t||Sd)(e.KVO(It.n$))};static#n=this.\u0275prov=e.jDH({token:Sd,factory:Sd.\u0275fac})};Xe([(0,l.rc)(E.SetAutoplay),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetAutoplay]),ne("design:returntype",void 0)],de.prototype,"setAutoplay",null),Xe([(0,l.rc)(E.SetContentMode),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetContentMode]),ne("design:returntype",void 0)],de.prototype,"setContentMode",null),Xe([(0,l.rc)(E.SetInputEnabled),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetInputEnabled]),ne("design:returntype",void 0)],de.prototype,"setInputEnabled",null),Xe([(0,l.rc)(E.SetCanHover),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetCanHover]),ne("design:returntype",void 0)],de.prototype,"setCanHover",null),Xe([(0,l.rc)(E.SetCanTouch),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetCanTouch]),ne("design:returntype",void 0)],de.prototype,"setCanTouch",null),Xe([(0,l.rc)(E.SetCanFullscreen),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetCanFullscreen]),ne("design:returntype",void 0)],de.prototype,"setCanFullscreen",null),Xe([(0,l.rc)(E.SetSearchDisplayMode),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetSearchDisplayMode]),ne("design:returntype",void 0)],de.prototype,"setSearchDisplayMode",null),Xe([(0,l.rc)(E.SetViewLanguage),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetViewLanguage]),ne("design:returntype",void 0)],de.prototype,"setViewLanguage",null),Xe([(0,l.rc)(E.ToggleNodeInfo),ne("design:type",Function),ne("design:paramtypes",[Object,E.ToggleNodeInfo]),ne("design:returntype",void 0)],de.prototype,"toggleNodeInfo",null),Xe([(0,l.rc)(E.SetNodeInfoConfig),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetNodeInfoConfig]),ne("design:returntype",void 0)],de.prototype,"setNodeInfoConfig",null),Xe([(0,l.rc)(E.TogglePanel),ne("design:type",Function),ne("design:paramtypes",[Object,E.TogglePanel]),ne("design:returntype",void 0)],de.prototype,"togglePanel",null),Xe([(0,l.rc)(E.TogglePresentation),ne("design:type",Function),ne("design:paramtypes",[Object,E.TogglePresentation]),ne("design:returntype",void 0)],de.prototype,"togglePresentation",null),Xe([(0,l.rc)(E.ToggleHelpTab),ne("design:type",Function),ne("design:paramtypes",[Object,E.ToggleHelpTab]),ne("design:returntype",void 0)],de.prototype,"toggleHelp",null),Xe([(0,l.rc)(E.SetFadeout),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetFadeout]),ne("design:returntype",void 0)],de.prototype,"setFadeout",null),Xe([(0,l.rc)(E.SetPreventFadeoutEvent),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetPreventFadeoutEvent]),ne("design:returntype",void 0)],de.prototype,"addPreventFadeoutElement",null),Xe([(0,l.rc)(E.SetPlaythrough),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetPlaythrough]),ne("design:returntype",void 0)],de.prototype,"setPlaythrough",null),Xe([(0,l.rc)(E.SetPlaythroughEnabled),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetPlaythroughEnabled]),ne("design:returntype",void 0)],de.prototype,"setPlaythroughEnabled",null),Xe([(0,l.rc)(E.SetStartingColumn),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetStartingColumn]),ne("design:returntype",void 0)],de.prototype,"setStartingColumn",null),Xe([(0,l.rc)(E.SetPreferredColumn),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetPreferredColumn]),ne("design:returntype",void 0)],de.prototype,"setPreferredColumn",null),Xe([(0,l.rc)(E.SetStartingTool),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetStartingTool]),ne("design:returntype",void 0)],de.prototype,"setStartingTool",null),Xe([(0,l.rc)(E.SetInteractType),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetInteractType]),ne("design:returntype",void 0)],de.prototype,"setLoaderType",null),Xe([(0,l.rc)(E.SetForceAudio),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetForceAudio]),ne("design:returntype",void 0)],de.prototype,"setForceAudio",null),Xe([(0,l.rc)(E.SetOnDemand),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetOnDemand]),ne("design:returntype",void 0)],de.prototype,"setOnDemand",null),Xe([(0,l.rc)(E.SetInputMode),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetInputMode]),ne("design:returntype",void 0)],de.prototype,"setInputMode",null),Xe([(0,l.rc)(E.SetLayout),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetLayout]),ne("design:returntype",void 0)],de.prototype,"SetLayout",null),Xe([(0,l.rc)(E.SetTutorial),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetTutorial]),ne("design:returntype",void 0)],de.prototype,"setTutorial",null),Xe([(0,l.rc)(E.StartTutorial),ne("design:type",Function),ne("design:paramtypes",[Object,E.StartTutorial]),ne("design:returntype",void 0)],de.prototype,"startTutorial",null),Xe([(0,l.rc)(E.TutorialSeen),ne("design:type",Function),ne("design:paramtypes",[Object,E.TutorialSeen]),ne("design:returntype",void 0)],de.prototype,"tutorialSeen",null),Xe([(0,l.rc)(E.TutorialPrevious),ne("design:type",Function),ne("design:paramtypes",[Object,E.TutorialPrevious]),ne("design:returntype",void 0)],de.prototype,"tutorialPrevious",null),Xe([(0,l.rc)(E.TutorialNext),ne("design:type",Function),ne("design:paramtypes",[Object,E.TutorialNext]),ne("design:returntype",void 0)],de.prototype,"tutorialNext",null),Xe([(0,l.rc)(E.SetWhiteboardEnabled),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardEnabled]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardEnabled",null),Xe([(0,l.rc)(E.SetWhiteboardLocked),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardLocked]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardLocked",null),Xe([(0,l.rc)(E.SetWhiteboardBrushSize),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardBrushSize]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardBrushSize",null),Xe([(0,l.rc)(E.SetWhiteboardTextSize),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardTextSize]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardTextSize",null),Xe([(0,l.rc)(E.SetWhiteboardEraserSize),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardEraserSize]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardEraserSize",null),Xe([(0,l.rc)(E.SetWhiteboardAnnotateMode),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardAnnotateMode]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardAnnotateMode",null),Xe([(0,l.rc)(E.SetWhiteboardBrushColor),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardBrushColor]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardBrushColor",null),Xe([(0,l.rc)(E.SetWhiteboardHasPaint),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardHasPaint]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardHasPaint",null),Xe([(0,l.rc)(E.SetWhiteboardHasText),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWhiteboardHasText]),ne("design:returntype",void 0)],de.prototype,"setWhiteboardHasText",null),Xe([(0,l.rc)(E.SetMultiPickModeEnabled),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetMultiPickModeEnabled]),ne("design:returntype",void 0)],de.prototype,"setMultiPickModeEnabled",null),Xe([(0,l.rc)(E.SetLabelBreakpoint),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetLabelBreakpoint]),ne("design:returntype",void 0)],de.prototype,"setLabelBreakpoint",null),Xe([(0,l.rc)(E.SetUsePrintImage),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetUsePrintImage]),ne("design:returntype",void 0)],de.prototype,"setUsePrintImage",null),Xe([(0,l.rc)(E.SetWindows),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetWindows]),ne("design:returntype",void 0)],de.prototype,"setWindows",null),Xe([(0,l.rc)(E.SetIsMobileWeb),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetIsMobileWeb]),ne("design:returntype",void 0)],de.prototype,"setIsMobileWeb",null),Xe([(0,l.rc)(E.OpenWindow),ne("design:type",Function),ne("design:paramtypes",[Object,E.OpenWindow]),ne("design:returntype",void 0)],de.prototype,"openWindow",null),Xe([(0,l.rc)(E.CloseWindow),ne("design:type",Function),ne("design:paramtypes",[Object,E.CloseWindow]),ne("design:returntype",void 0)],de.prototype,"closeWindow",null),Xe([(0,l.rc)(E.ToggleWindow),ne("design:type",Function),ne("design:paramtypes",[Object,E.ToggleWindow]),ne("design:returntype",void 0)],de.prototype,"toggleWindow",null),Xe([(0,l.rc)(E.ToggleMenu),ne("design:type",Function),ne("design:paramtypes",[Object,E.ToggleMenu]),ne("design:returntype",void 0)],de.prototype,"toggleMenu",null),Xe([(0,l.rc)(E.ShowScrim),ne("design:type",Function),ne("design:paramtypes",[Object,E.ShowScrim]),ne("design:returntype",void 0)],de.prototype,"showScrim",null),Xe([(0,l.rc)(E.HideScrim),ne("design:type",Function),ne("design:paramtypes",[Object,E.HideScrim]),ne("design:returntype",void 0)],de.prototype,"hideScrim",null),Xe([(0,l.rc)(E.SetChapterCallToActionSeen),ne("design:type",Function),ne("design:paramtypes",[Object,E.SetChapterCallToActionSeen]),ne("design:returntype",void 0)],de.prototype,"setChapterCallToActionSeen",null),Xe([(0,l.rc)(E.ResetViewState),ne("design:type",Function),ne("design:paramtypes",[Object,E.ResetViewState]),ne("design:returntype",void 0)],de.prototype,"ResetViewState",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getAutoplay",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getContentMode",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getLabelsBreakpoint",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getInputEnabled",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getIsMobileWeb",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getFullscreenActive",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getPresentationActive",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getDrawerCoversContent",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getShowNodeInfo",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getNodeInfoFallback",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getToggledPanels",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getViewLanguage",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getInteractType",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getForceAudio",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getOnDemand",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getFadeout",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getFadeoutPaused",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getPlaythroughSettings",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getPlaythroughEnabled",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getPreferredColumn",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getStartingColumn",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getStartingTool",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getLayout",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getInputMode",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getShowHelpTab",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getTutorial",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getTutorialSeen",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardEnabled",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"isWhiteboardLocked",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardBrushSize",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardTextSize",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardEraserSize",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardAnnotateMode",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardBrushColor",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardHasPaint",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getWhiteboardHasText",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getCanTouch",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getCanHover",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getMultiPickModeEnabled",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getSearchDisplayMode",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getUsePrintImage",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getOpenWindow",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getMenuOpen",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getScrim",null),Xe([(0,l.MD)(),ne("design:type",Function),ne("design:paramtypes",[Dt]),ne("design:returntype",void 0)],de,"getChapterCallToActionSeen",null),de=$d=Xe([(0,l.Uw)({name:"view",defaults:mh}),ne("design:paramtypes",[It.n$])],de);var mt=function(n){return n.Hide="hide",n.Show="show",n.Collapse="collapse",n}(mt||{}),Ms=d(20458),Ut=d(7431);let Gy=(()=>{class n{constructor(t){this.store=t}chapterHasTransition(t,o){const a=(0,u.get)(t,o?"transitions.pre":"transitions.post");return!!a&&(o?a.onPrevious:a.onNext)}searchChapterTransitions(t,o,s){let a=[...s],r=a.findIndex(F=>F.id===t),_=a.findIndex(F=>F.id===o);const g=_<r;if(g&&(a=a.reverse(),r=a.findIndex(F=>F.id===t),_=a.findIndex(F=>F.id===o)),r<0||_<0||r===_)return null;const P=a.slice(r,_).find(F=>this.chapterHasTransition(F,g));return P?g?P.transitions.pre:P.transitions.post:null}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ns,Bd=d(62751);!function(n){n.SetHorizontalBreakpoint=(()=>{class o{static#e=this.type="[View] Set Horizontal Breakpoint";constructor(a){this.breakpoint=a}}return o})(),n.SetVerticalBreakpoint=(()=>{class o{static#e=this.type="[View] Set Vertical Breakpoint";constructor(a){this.breakpoint=a}}return o})()}(ns||(ns={}));var Qn=function(n){return n[n.XSmall=0]="XSmall",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n[n.Large=3]="Large",n[n.XLarge=4]="XLarge",n}(Qn||{}),bl=function(n){return n[n.Tiny=0]="Tiny",n[n.Small=1]="Small",n[n.Medium=2]="Medium",n}(bl||{}),zd=d(99327),Tn=d(21082),Is=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Zn=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class yl{}let Dn=class bd{static getHorizontalBreakpoint(i){return i.horizontalBreakpoint}static getHorizontalBreakpointLabel(i){return["(max-width: 374px)","(max-width: 599px)","(max-width: 959px)","(max-width: 1439px)","(min-width: 1440px)"][i.horizontalBreakpoint]}static getVerticalBreakpoint(i){return i.verticalBreakpoint}static getVerticalBreakpointLabel(i){return["(max-height: 479px)","(min-height: 480px)","(min-height: 375px)"][i.verticalBreakpoint]}setBreakpoint(i,t){i.patchState({horizontalBreakpoint:t.breakpoint})}setVerticalBreakpoint(i,t){i.patchState({verticalBreakpoint:t.breakpoint})}constructor(i,t){this.breakpointObserver=i,this.store=t}ngxsOnInit(i){this.initHorizontalBreakpointObserver(i),this.initVerticalBreakpointObserver(i)}initHorizontalBreakpointObserver(i){const t=this.breakpointObserver.observe(["(max-width: 374px)"]),o=this.breakpointObserver.observe(["(max-width: 599px)"]),s=this.breakpointObserver.observe(["(max-width: 959px)"]),a=this.breakpointObserver.observe(["(max-width: 1439px)"]),r=this.breakpointObserver.observe(["(min-width: 1440px)"]);(0,cn.z)([t,o,s,a,r]).pipe((0,W.T)(([_,g,P,F,ee])=>_.matches?Qn.XSmall:g.matches?Qn.Small:P.matches?Qn.Medium:F.matches?Qn.Large:ee.matches?Qn.XLarge:null),(0,Tn.F)(),(0,D.p)(_=>null!=_)).subscribe(_=>{i.dispatch(new ns.SetHorizontalBreakpoint(_))})}initVerticalBreakpointObserver(i){const t=this.breakpointObserver.observe(["(max-height: 374px)"]),o=this.breakpointObserver.observe(["(max-height: 479px)"]),s=this.breakpointObserver.observe(["(min-height: 480px)"]);(0,cn.z)([t,o,s]).pipe((0,W.T)(([a,r,_])=>a.matches?bl.Tiny:r.matches?bl.Small:_.matches?bl.Medium:null),(0,Tn.F)(),(0,D.p)(a=>null!=a)).subscribe(a=>{i.dispatch(new ns.SetVerticalBreakpoint(a))})}static#e=this.\u0275fac=function(t){return new(t||bd)(e.KVO(zd.QP),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:bd,factory:bd.\u0275fac})};Is([(0,l.rc)(ns.SetHorizontalBreakpoint),Zn("design:type",Function),Zn("design:paramtypes",[Object,ns.SetHorizontalBreakpoint]),Zn("design:returntype",void 0)],Dn.prototype,"setBreakpoint",null),Is([(0,l.rc)(ns.SetVerticalBreakpoint),Zn("design:type",Function),Zn("design:paramtypes",[Object,ns.SetVerticalBreakpoint]),Zn("design:returntype",void 0)],Dn.prototype,"setVerticalBreakpoint",null),Is([(0,l.MD)(),Zn("design:type",Function),Zn("design:paramtypes",[yl]),Zn("design:returntype",void 0)],Dn,"getHorizontalBreakpoint",null),Is([(0,l.MD)(),Zn("design:type",Function),Zn("design:paramtypes",[yl]),Zn("design:returntype",void 0)],Dn,"getHorizontalBreakpointLabel",null),Is([(0,l.MD)(),Zn("design:type",Function),Zn("design:paramtypes",[yl]),Zn("design:returntype",void 0)],Dn,"getVerticalBreakpoint",null),Is([(0,l.MD)(),Zn("design:type",Function),Zn("design:paramtypes",[yl]),Zn("design:returntype",void 0)],Dn,"getVerticalBreakpointLabel",null),Dn=Is([(0,l.Uw)({name:"breakpoint",defaults:{horizontalBreakpoint:null,verticalBreakpoint:null}}),Zn("design:paramtypes",[zd.QP,l.il])],Dn);var G=function(n){return n.AnatomyLabels="anatomyLabels",n.Audio="audio",n.Camera="camera",n.Column="column",n.ColumnToggle="columnToggle",n.ContextActions="contextActions",n.ContextMenu="contextMenu",n.Description="description",n.Drawer="drawer",n.DrawerToggle="drawerToggle",n.DrawerExpanded="drawerExpanded",n.Fullscreen="fullscreen",n.Help="help",n.LabelList="labelList",n.Labels="labels",n.VisibilityLayers="visibilityLayers",n.VisibilityLayersMode="visibilityLayersMode",n.SkinLayers="skinLayers",n.Layout="layout",n.Legend="legend",n.Loader="loader",n.XRLoader="xrLoader",n.Logo="logo",n.Media="media",n.ToolbarOverflow="toolbarOverflow",n.NodeInfo="nodeInfo",n.NodeAudio="nodeAudio",n.Pagination="pagination",n.Playthrough="playthrough",n.QuizPrompt="quizPrompt",n.Search="search",n.TitleOnly="titleOnly",n.ToggleLabels="toggleLabels",n.Toolbar="toolbar",n.Tools="tools",n.Tutorial="tutorial",n.Undo="undo",n.Whiteboard="whiteboard",n}(G||{}),Gi=function(n){return n.None="none",n.Circle="circle",n.Bar="bar",n}(Gi||{});const fh=Gi.Circle,Wd=z.c.application===xn.c.Viewer?fh:Gi.Circle;var Yn=function(n){return n.Drawer="drawer",n.Column="column",n}(Yn||{});let Xd=(()=>{class n{static#e=this.type="[Engine Progress] Set Progress";constructor(t,o,s){this.storyLoadProgress=t,this.chapterId=o,this.chapterProgress=s}}return n})(),vl=(()=>{class n{static#e=this.type="[Engine Progress] Reset Progress";constructor(){}}return n})();var or=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},$i=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const Sh={storyLoadProgress:0,chapterLoadProgress:{}};let Ai=class yd{constructor(){}static getStoryLoadProgress(i){return i.storyLoadProgress}static getChaptersLoadProgress(i){return i.chapterLoadProgress}setProgress(i,t){const{storyLoadProgress:o,chapterId:s,chapterProgress:a}=t;i.patchState({storyLoadProgress:o,chapterLoadProgress:{...i.getState().chapterLoadProgress,[s]:a}})}resetProgress(i,t){i.setState({...Sh})}static#e=this.\u0275fac=function(t){return new(t||yd)};static#t=this.\u0275prov=e.jDH({token:yd,factory:yd.\u0275fac})};or([(0,l.rc)(Xd),$i("design:type",Function),$i("design:paramtypes",[Object,Xd]),$i("design:returntype",void 0)],Ai.prototype,"setProgress",null),or([(0,l.rc)(vl),$i("design:type",Function),$i("design:paramtypes",[Object,vl]),$i("design:returntype",void 0)],Ai.prototype,"resetProgress",null),or([(0,l.MD)(),$i("design:type",Function),$i("design:paramtypes",[Object]),$i("design:returntype",void 0)],Ai,"getStoryLoadProgress",null),or([(0,l.MD)(),$i("design:type",Function),$i("design:paramtypes",[Object]),$i("design:returntype",void 0)],Ai,"getChaptersLoadProgress",null),Ai=or([(0,l.Uw)({name:"engineProgress",defaults:Sh}),$i("design:paramtypes",[])],Ai);var Vn,Bi=function(n){return n.None="none",n.Small="small",n.Full="full",n}(Bi||{}),Di=function(n){return n.None="none",n.VR="vr",n.AR="ar",n}(Di||{}),aa=function(n){return n.Single="single",n.Group="group",n}(aa||{});class on{constructor(i=mt.Hide,t=!0){this.status=i,this.enable=t}}class bh extends on{constructor(i){super(),this.userStatusPreference=i}}!function(n){n.ToggleVisible=(()=>{class s{static#e=this.type="[ViewUI] Toggle Visible";constructor(r){this.settings=r}}return s})(),n.SetUI=(()=>{class s{static#e=this.type="[ViewUI] Set UI";constructor(r){this.ui=r}}return s})(),n.SetInitialUI=(()=>{class s{static#e=this.type="[ViewUI] Set Initial UI";constructor(r){this.ui=r}}return s})()}(Vn||(Vn={}));var El,Ps=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},ni=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const Hd={[G.Audio]:new on,[G.AnatomyLabels]:new on,[G.Camera]:new on,[G.Column]:new bh(null),[G.ColumnToggle]:new on,[G.ContextActions]:new on,[G.ContextMenu]:new on(mt.Show,!0),[G.Description]:new on,[G.Drawer]:new class By extends bh{constructor(){super(...arguments),this.isExpandedInitially=!1}}(null),[G.DrawerToggle]:new on,[G.Fullscreen]:new on,[G.Help]:new on,[G.Labels]:new class Qy extends on{constructor(i=!0){super(),this.shown=i}},[G.LabelList]:new on(mt.Show,!1),[G.Legend]:new on,[G.Loader]:new class Xy extends on{constructor(i=Wd){super(),this.template=i}},[G.XRLoader]:new class Hy extends on{constructor(i=Di.None){super(),this.template=i}},[G.Logo]:new class zy extends on{constructor(i=!0){super(),this.isHyperLink=i}},[G.Media]:new class Wy extends on{constructor(i=Bi.Full,t=mt.Hide){super(t),this.template=i,this.status=t}},[G.NodeInfo]:new on(mt.Hide,!1),[G.NodeAudio]:new on,[G.Playthrough]:new on(mt.Hide,!1),[G.Pagination]:new on,[G.QuizPrompt]:new on,[G.Search]:new on,[G.TitleOnly]:new on,[G.ToggleLabels]:new on,[G.Toolbar]:new on,[G.ToolbarOverflow]:new on(mt.Show,!1),[G.Tools]:new on,[G.Tutorial]:new on(mt.Hide,!1),[G.Undo]:new on,[G.VisibilityLayers]:new class Yy extends on{constructor(i=aa.Single){super(),this.layersMode=i}},[G.SkinLayers]:new on(mt.Show,!0),[G.Whiteboard]:new on};class Qd{}const Ky={visible:{[G.Audio]:!1,[G.AnatomyLabels]:!1,[G.Camera]:!1,[G.Column]:!1,[G.ColumnToggle]:!1,[G.ContextActions]:!1,[G.Description]:!1,[G.Drawer]:!1,[G.DrawerToggle]:!1,[G.Fullscreen]:!1,[G.Help]:!1,[G.Labels]:!1,[G.LabelList]:!1,[G.Legend]:!1,[G.Logo]:!1,[G.Media]:!1,[G.ToolbarOverflow]:!1,[G.NodeInfo]:!1,[G.NodeAudio]:!1,[G.Pagination]:!1,[G.Playthrough]:!1,[G.QuizPrompt]:!1,[G.Search]:!1,[G.ToggleLabels]:!1,[G.TitleOnly]:!1,[G.Toolbar]:!1,[G.Tools]:!1,[G.Tutorial]:!1,[G.Undo]:!1,[G.VisibilityLayers]:!1,[G.SkinLayers]:!1,[G.Whiteboard]:!1},ui:Hd,initialUI:Hd};let Ke=class vd{static#e=El=this;static getVisible(i){return(0,l.Mz)([El],t=>t.visible[i])}static getUIEntry(i){return(0,l.Mz)([El],t=>t.ui[i])}static getSearchStatus(i){return i.ui.search.status}static getUI(i){return i.ui}static getInitialUI(i){return i.initialUI}toggleVisible(i,t){const o=i.getState().visible;Object.entries(t.settings).forEach(([s,a])=>{o[s]=a}),i.patchState({visible:o})}setUI(i,t){i.patchState({ui:(0,u.cloneDeep)({...i.getState().ui,...t.ui})})}setInitialUI(i,t){i.patchState({initialUI:(0,u.cloneDeep)({...i.getState().ui,...t.ui})})}static#t=this.\u0275fac=function(t){return new(t||vd)};static#n=this.\u0275prov=e.jDH({token:vd,factory:vd.\u0275fac})};Ps([(0,l.rc)(Vn.ToggleVisible),ni("design:type",Function),ni("design:paramtypes",[Object,Vn.ToggleVisible]),ni("design:returntype",void 0)],Ke.prototype,"toggleVisible",null),Ps([(0,l.rc)(Vn.SetUI),ni("design:type",Function),ni("design:paramtypes",[Object,Vn.SetUI]),ni("design:returntype",void 0)],Ke.prototype,"setUI",null),Ps([(0,l.rc)(Vn.SetInitialUI),ni("design:type",Function),ni("design:paramtypes",[Object,Vn.SetInitialUI]),ni("design:returntype",void 0)],Ke.prototype,"setInitialUI",null),Ps([(0,l.MD)(),ni("design:type",Function),ni("design:paramtypes",[Qd]),ni("design:returntype",void 0)],Ke,"getSearchStatus",null),Ps([(0,l.MD)(),ni("design:type",Function),ni("design:paramtypes",[Qd]),ni("design:returntype",void 0)],Ke,"getUI",null),Ps([(0,l.MD)(),ni("design:type",Function),ni("design:paramtypes",[Qd]),ni("design:returntype",void 0)],Ke,"getInitialUI",null),Ke=El=Ps([(0,l.Uw)({name:"viewUI",defaults:Ky})],Ke);var qy=d(97953);class Jy{get currentPlayer(){return this.players[this.index]}constructor(i){this.players=i,this.index=0,this.isPlaying=!1,this.eventSubject=new k.B,this.ngUnsubscribe=new k.B,this.loadState="unloaded",this.totalDuration=0,this.init()}state(){return this.loadState}duration(){return this.totalDuration}play(){this.currentPlayer&&this.currentPlayer.play()}pause(){this.currentPlayer&&this.currentPlayer.pause()}stop(){this.currentPlayer&&this.currentPlayer.stop(),this.index=0}seek(i){if(this.currentPlayer)return this.currentPlayer.seek(i)}rate(i){if(this.currentPlayer)return this.currentPlayer.rate(i)}mute(i){if(this.currentPlayer){if((0,u.isNil)(i))return this.currentPlayer.mute();this.currentPlayer.mute(i)}}playing(){return!!this.currentPlayer&&this.currentPlayer.playing()}on(i,t){this.eventSubject.asObservable().pipe((0,D.p)(o=>o===i),(0,p.Q)(this.ngUnsubscribe)).subscribe(t)}load(){this.players.forEach(i=>i.load())}unload(){this.players.forEach(i=>i.unload()),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){const i=this.players.length;let t=0;this.players.forEach((o,s)=>{o.on("load",()=>{this.totalDuration+=o.duration(),t++,t>=i&&(this.eventSubject.next("load"),this.loadState="loaded")}),o.on("play",()=>{"unloaded"===this.loadState&&(this.loadState="loading"),this.isPlaying||this.eventSubject.next("play"),this.isPlaying=!0,this.index=s}),o.on("pause",()=>{this.isPlaying=!1,this.eventSubject.next("pause")}),o.on("end",()=>{if(this.isPlaying){const r=this.players[s+1];r?r.play():(this.isPlaying=!1,this.index=0,this.eventSubject.next("end"))}}),o.on("stop",()=>{this.isPlaying=!1,this.eventSubject.next("stop")}),o.on("loaderror",()=>{this.eventSubject.next("loaderror")}),o.on("playerror",()=>{this.eventSubject.next("playerror")})})}}var zi=d(28577),Rt=d(15877);Math.pow(1024,2),Math.pow(1024,2),Math.pow(1024,2),Math.pow(1024,3);const yh={".svg":["image/svg+xml"],".jpg":["image/jpeg"],".jpeg":["image/jpeg"],".png":["image/png"],".aac":["audio/aac"],".m4a":["audio/mp4","audio/x-m4a"],".mp3":["audio/mpeg"],".webm":["video/webm"],".mpg":["video/mpeg"],".mp2":["video/mpeg"],".mpeg":["video/mpeg"],".mpe":["video/mpeg"],".mpv":["video/x-mpv"],".ogg":["video/ogg"],".mp4":["video/mp4"],".m4p":["video/mp4","video/x-m4p"],".m4v":["video/mp4","video/x-m4v"],".avi":["video/x-msvideo"],".wmv":["video/x-ms-wmv"],".mov":["video/quicktime"],".qt":["video/quicktime"],".flv":["video/x-flv"],".swf":["application/x-shockwave-flash"],".mpd":["application/dash+xml"],".m3u8":["application/x-mpegURL"],".webp":["image/webp"]};var ho=d(68947);const s0=0,vh={eng:"en",spa:"es",cmn:"zh",fra:"fr",deu:"de",ita:"it",jpn:"ja",por:"pt"},a0=Object.keys(vh);function Eh(n){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,pt.A)(function*(n){return d.e(17).then(d.bind(d,16017)).then(i=>function r0(n,i){const t=n.franc(i,{minLength:s0,only:a0}),o=vh[t];return Jn.IB.find(a=>a.lang===o)?.id}(i,n))}),Yd.apply(this,arguments)}const l0="mp3",Th={voiceId:"Amy",voiceLocaleId:"en-GB",supportedLocaleIds:["en-US"],engine:"neural"},c0=[Th,{voiceId:"Mia",voiceLocaleId:"es-MX",supportedLocaleIds:["es-ES"],engine:"neural"},{voiceId:"Zhiyu",voiceLocaleId:"cmn-CN",supportedLocaleIds:["zh-CN"],engine:"neural"},{voiceId:"Lea",voiceLocaleId:"fr-FR",supportedLocaleIds:[],engine:"neural"},{voiceId:"Vicki",voiceLocaleId:"de-DE",supportedLocaleIds:[],engine:"neural"},{voiceId:"Bianca",voiceLocaleId:"it-IT",supportedLocaleIds:[],engine:"neural"},{voiceId:"Takumi",voiceLocaleId:"ja-JP",supportedLocaleIds:["ja"],engine:"neural"},{voiceId:"Camila",voiceLocaleId:"pt-BR",supportedLocaleIds:["pt-PT"],engine:"neural"}];function Kd(n,i){return(n.length>3e3?ho.l.splitTextByCharacterCount(n,3e3):[n]).map(s=>function d0(n,i){const s=function _0(n){return c0.find(i=>{const{voiceLocaleId:t,supportedLocaleIds:o}=i;return t===n||o.includes(n)})}(i)??Th,{voiceId:a,engine:r,voiceLocaleId:_}=s;return`/ws/polly/synthesize?text=${encodeURIComponent(n)}&voice_id=${a}&format=${l0}&lang=${_}&engine=${r}&version=2`}(s,i))}var yi,ii=function(n){return n.File="file",n.TTS="tts",n.None="none",n}(ii||{});!function(n){n.SetAudioMuted=(()=>{class s{static#e=this.type="[Media] Set Audio Muted";constructor(r){this.mute=r}}return s})(),n.SetAutoplayAudio=(()=>{class s{static#e=this.type="[Media] Set Autoplay Audio";constructor(r){this.autoplay=r}}return s})(),n.ResetAudio=(()=>{class s{static#e=this.type="[Media] Reset Audio";constructor(){}}return s})()}(yi||(yi={}));var Wn=d(35286);const Oh="/media/audio",h0=new RegExp(`^${Oh}/(.*)/.*$`),g0=["aac","m4a","mp3","ogg"],Mh={aac:"audio/aac",m4a:"audio/mp4",mp3:"audio/mpeg",ogg:"audio/ogg"};Howler.autoUnlock=!1;let vi=(()=>{class n{constructor(t,o,s,a,r){this.http=o,this.markdownService=s,this.animationService=a,this.store=r,this.audioPromises=new Map,this.audioPlayers=new Map,this.audioEventSubject=new k.B,this.videoPlayers=new Map,this.videoEventSubject=new k.B,this.videoSources=new Map,this.renderer=t.createRenderer(null,null)}addAudioPlayer(t,o,s,a={}){var r=this;return(0,pt.A)(function*(){r.removeAudioPlayer(t);const _=o.then(F=>r.createAudioPlayer(F,s,a));r.audioPromises.set(t,_);const g=yield _,P=()=>{g.playing()&&(r.audioEventSubject.next({event:"playing",id:t,data:{time:g.seek()}}),requestAnimationFrame(P))};return g.on("load",()=>{r.audioEventSubject.next({event:"load",id:t})}),g.on("play",()=>{r.audioEventSubject.next({event:"play",id:t}),P()}),g.on("pause",()=>{r.audioEventSubject.next({event:"pause",id:t})}),g.on("stop",()=>{r.audioEventSubject.next({event:"stop",id:t})}),g.on("seek",()=>{r.audioEventSubject.next({event:"seek",id:t,data:{time:g.seek()}})}),g.on("end",()=>{r.audioEventSubject.next({event:"end",id:t})}),g.on("playerror",()=>{r.audioEventSubject.next({event:"playerror",id:t})}),r.audioPlayers.set(t,g),g})()}createAudioPlayer(t,o,s){var a=this;return(0,pt.A)(function*(){if(o){const r=yield a.createAudioDataUrl(t);return a.createSinglePlayer(r,s)}return t.length>1?a.createSinglePlayer(t[0],s):a.createMultiPlayer(t,s)})()}createSinglePlayer(t,o){return new qy.Howl({...o,src:t,format:g0})}createMultiPlayer(t,o){const s=t.map(a=>this.createSinglePlayer(a,o));return new Jy(s)}removeAudioPlayer(t){var o=this;return(0,pt.A)(function*(){const s=o.audioPromises.get(t);if(o.audioPromises.delete(t),o.audioPlayers.delete(t),s)return s.then(a=>a.unload())})()}getAudioPlayer(t){var o=this;return(0,pt.A)(function*(){return o.audioPromises.get(t)})()}hasAudioPlayer(t){return this.audioPromises.has(t)}removeAllAudioPlayers(){this.audioPromises.forEach((t,o)=>this.removeAudioPlayer(o))}createAudioUploadEvent(t){return{type:"uploadFile",url:"/ws/media/audio/upload",method:"POST",file:t}}getAudioEvents(){return this.audioEventSubject.asObservable()}getAudioClips(t){return Object.values(t).filter(o=>"audio"===o.streamType)}createAudioClip(t,o,s){const a=this.getAudioUUID(o),{firstTime:r,lastTime:_}=this.animationService.getChapterTimeFrame();return[a,{clipId:a,streamType:"audio",fullUrl:o,time1:r,time2:_,lang:s}]}createAudioDataUrl(t){return(0,pt.A)(function*(){const o=t.map(s=>fetch(s).then(a=>a.blob()));return Promise.all(o).then(s=>{const a=t[0].split(".").pop();return URL.createObjectURL(new Blob(s,{type:Mh[a]||Mh.mp3}))})})()}getDuration(t){return(0,pt.A)(function*(){return"loaded"===t.state()?t.duration():new Promise(o=>{t.on("load",()=>{o(t.duration())})})})()}getTTSSources(t,o=Jn.q.id){var s=this;return(0,pt.A)(function*(){const a=yield ho.l.getPlainTextFromMarkdown(s.renderer,s.markdownService,t||"",!0);return Kd(a,(yield Eh(a))||o)})()}getAudioUUID(t){return t.match(h0)[1]}getAudioSrc(t){return t.match(Oh)?t:`/content/states/${t}`}muteAudio(){this.audioPlayers.forEach(t=>{t.mute(!0)})}unmuteAudio(t){const o=this.audioPlayers.get(t);o&&(o.mute(!1),this.store.dispatch(new yi.SetAudioMuted(!1)))}stopAllAudio(){this.stopAudio()}stopAllOtherAudio(t){this.stopAudio(t)}stopAudio(t){this.audioPlayers.forEach((o,s)=>{(!t||s!==t)&&o.stop()})}playAudio(t,o){this.getAudioPlayer(t).then(s=>{s&&((0,u.isNil)(o)||(s.mute(o),this.store.dispatch(new yi.SetAudioMuted(o))),s.play())})}playChapterAudio(t){this.stopAllAudio(),this.playAudio(t,!1),this.store.dispatch(new yi.SetAutoplayAudio(!0)),this.store.dispatch(new yi.SetAudioMuted(!1))}getPlayingAudio(){const t=[];return this.audioPlayers.forEach(o=>{o.playing()&&t.push(o)}),t}getChapterAudioPlayer(t,o,s=!1){var a=this;return(0,pt.A)(function*(){return a.getChapterAudioPlaybackType(t,o,s)!==ii.None?a.hasAudioPlayer(t.id)?yield a.getAudioPlayer(t.id):yield a.createChapterAudioPlayer(t,o,s):null})()}createChapterAudioPlayer(t,o,s=!1){var a=this;return(0,pt.A)(function*(){const r=a.getChapterAudioPlaybackType(t,o,s),_=a.buildChapterAudioSources(t,r,o);return r===ii.None?null:yield a.addAudioPlayer(t.id,_,!0,{preload:!0,mute:!0})})()}buildChapterAudioSources(t,o,s){var a=this;return(0,pt.A)(function*(){const _=a.getChapterAudioInLanguage(t,s)?.fullUrl??"",g=t?.description,P=Jn.IB.find(F=>F.lang===s);switch(o){case ii.File:return _?[a.getAudioSrc(_)]:[];case ii.TTS:return a.getTTSSources(g,P?.id);default:return[]}})()}getChapterAudioList(t){return t.media?Object.values(t.media).filter(s=>"audio"===s.streamType):[]}getChapterAudioInLanguage(t,o){return this.getChapterAudioList(t).find(a=>a.lang===o)}getChapterAudioPlaybackType(t,o,s=!1){let a=t?.ui?.config?.audio??ii.File;const r=!(0,u.isNil)(this.getChapterAudioList(t).find(g=>g.lang===o));s&&!r&&a!==ii.TTS&&(a=ii.TTS);const _=(0,u.trim)(t?.description??"").length>0;switch(a){case ii.File:return r?ii.File:ii.None;case ii.TTS:return _?ii.TTS:ii.None;default:return ii.None}}chapterHasAudio(t,o){return this.getChapterAudioPlaybackType(t,o)!==ii.None}getVideoPlayer(t){return this.videoPlayers.get(t)}createVideoPlayer(t,o){return(0,pt.A)(function*(){return(0,(yield d.e(78).then(d.bind(d,37078))).default)(t,o)})()}getVideoEvents(){return this.videoEventSubject.asObservable()}addVideoPlayer(t,o){var s=this;return(0,pt.A)(function*(){const a=yield s.createVideoPlayer(t,o),r=a.id();return a.on("play",()=>{s.videoEventSubject.next({event:"play",id:r})}),a.on("pause",()=>{s.videoEventSubject.next({event:"pause",id:r})}),a.on("seeking",()=>{s.videoEventSubject.next({event:"seeking",id:r})}),a.on("ended",()=>{s.videoEventSubject.next({event:"ended",id:r})}),a.on("error",()=>{s.videoEventSubject.next({event:"error",id:r})}),s.videoPlayers.set(r,a),r})()}removeVideoPlayer(t){const o=this.getVideoPlayer(t);o&&(o.dispose(),this.videoPlayers.delete(t))}getVideoUrls(t){return this.http.post("/ws/mc/video/upload/authorize",{filename:t})}checkVideoStatus(t){return this.videoSources.has(t)?new h.c(o=>{o.next(this.videoSources.get(t)),o.complete()}):this.http.get(t).pipe((0,W.T)(o=>{const s=o.listing.map(a=>({src:a,type:this.getFileMIMEType(a)}));return this.videoSources.set(t,s),s}),(0,zi.W)(()=>(0,Rt.of)(!1)))}checkAnimatedImageStatus(t){return(0,pt.A)(function*(){return new Promise(o=>{const s=new Image;s.onload=()=>o(!0),s.onerror=()=>o(!1),s.onabort=()=>o(!1),s.src=t})})()}getFileMIMEType(t){const o=t.split(".").pop(),s=yh[`.${o}`];return s?s[0]:""}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(e._9s),e.KVO(f.Qq),e.KVO(Wn.Rl),e.KVO(co.O),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class qi{}var Ie=d(47632),Ot=d(15152),Ln=d(11756),is=d(39705),qd=d(64346),ws=d(19833),ra=d(38399),Ih=d(45326),As=function(n){return n.UserGeneratedTour="user_generated_tour",n.Animated="animated",n.Quiz="quiz",n.ModeQuiz="mode_quiz",n.ModeContent="mode_content",n}(As||{}),os=function(n){return n.Private="private",n.Group="enterprise",n.Public="public",n}(os||{});let Jd=(()=>{class n{static#e=this.type="[Auth] Is Logged In";constructor(){}}return n})(),Cl=(()=>{class n{static#e=this.type="[Auth] Is Logged In Success";constructor(t){this.sessionType=t}}return n})(),Tl=(()=>{class n{static#e=this.type="[Auth] Is Logged In Failure";constructor(t){this.sessionType=t}}return n})(),Ph=(()=>{class n{static#e=this.type="[Auth] Login With Biodigital";constructor(t,o){this.login=t,this.verification=o}}return n})(),wh=(()=>{class n{static#e=this.type="[Auth] Initialize Google Auth";constructor(){}}return n})(),m0=(()=>{class n{static#e=this.type="[Auth] Authenticate With Google";constructor(t){this.credential=t}}return n})(),f0=(()=>{class n{static#e=this.type="[Auth] Prompt With Google";constructor(){}}return n})(),Zd=(()=>{class n{static#e=this.type="[Auth] Prompt With Google Success";constructor(t){this.promptResult=t}}return n})(),Ah=(()=>{class n{static#e=this.type="[Auth] Login With Google";constructor(t){this.login=t}}return n})(),Rh=(()=>{class n{static#e=this.type="[Auth] Login With Group";constructor(t){this.login=t}}return n})(),sr=(()=>{class n{static#e=this.type="[Auth] Login Success";constructor(t,o){this.loginType=t,this.response=o}}return n})(),ar=(()=>{class n{static#e=this.type="[Auth] Login Failure";constructor(t,o,s){this.loginType=t,this.error=o,this.login=s}}return n})(),Nh=(()=>{class n{static#e=this.type="[Auth] Logout";constructor(){}}return n})(),e_=(()=>{class n{static#e=this.type="[Auth] Logout Success";constructor(){}}return n})(),S0=(()=>{class n{static#e=this.type="[Auth] Logout Failure";constructor(){}}return n})(),kh=(()=>{class n{static#e=this.type="[Auth] Get Environment Settings";constructor(){}}return n})(),t_=(()=>{class n{static#e=this.type="[Auth] Get Environment Settings Success";constructor(t){this.environmentSettings=t}}return n})(),b0=(()=>{class n{static#e=this.type="[Auth] Get Environment Settings Failure";constructor(t){this.error=t}}return n})(),n_=(()=>{class n{static#e=this.type="[Auth] Get Group User Profile";constructor(){}}return n})(),i_=(()=>{class n{static#e=this.type="[Auth] Get Group User Profile Success";constructor(t){this.groupUserProfile=t}}return n})(),y0=(()=>{class n{static#e=this.type="[Auth] Get Group User Profile Failure";constructor(t){this.error=t}}return n})(),o_=(()=>{class n{static#e=this.type="[Auth] Get User Profile";constructor(t=!1){this.hardCheck=t}}return n})(),s_=(()=>{class n{static#e=this.type="[Auth] Get User Profile Success";constructor(t){this.userProfile=t}}return n})(),v0=(()=>{class n{static#e=this.type="[Auth] Get User Profile Failure";constructor(t){this.error=t}}return n})(),a_=(()=>{class n{static#e=this.type="[Auth] Update User Profile";constructor(t){this.userProfile=t}}return n})(),Dh=(()=>{class n{static#e=this.type="[Auth] Update User Profile Success";constructor(t){this.userProfile=t}}return n})(),E0=(()=>{class n{static#e=this.type="[Auth] Update User Profile Failure";constructor(t){this.error=t}}return n})(),Lh=(()=>{class n{static#e=this.type="[Auth] Delete User Profile";constructor(){}}return n})(),C0=(()=>{class n{static#e=this.type="[Auth] Delete User Profile Success";constructor(t){this.userEmail=t}}return n})(),T0=(()=>{class n{static#e=this.type="[Auth] Delete User Profile Failure";constructor(t){this.error=t}}return n})(),Uh=(()=>{class n{static#e=this.type="[Auth] Check Profile";constructor(t){this.email=t}}return n})(),r_=(()=>{class n{static#e=this.type="[Auth] Check Profile Success";constructor(t){this.profile=t}}return n})(),O0=(()=>{class n{static#e=this.type="[Auth] Check Profile Failure";constructor(t){this.error=t}}return n})(),Ol=(()=>{class n{static#e=this.type="[Auth] Get User Roles";constructor(){}}return n})(),xh=(()=>{class n{static#e=this.type="[Auth] Reset Password";constructor(t){this.email=t}}return n})(),M0=(()=>{class n{static#e=this.type="[Auth] Reset Password Success";constructor(t){this.email=t}}return n})(),I0=(()=>{class n{static#e=this.type="[Auth] Reset Password Failure";constructor(t){this.error=t}}return n})(),jh=(()=>{class n{static#e=this.type="[Auth] Transfer Facebook Account";constructor(t){this.email=t}}return n})(),P0=(()=>{class n{static#e=this.type="[Auth] Transfer Facebook Account Success";constructor(t){this.email=t}}return n})(),Vh=(()=>{class n{static#e=this.type="[Auth] Transfer Facebook Account Failure";constructor(t){this.error=t}}return n})(),Fh=(()=>{class n{static#e=this.type="[Auth] Update Password";constructor(t,o,s){this.currentPassword=t,this.newPassword=o,this.confirmNewPassword=s}}return n})(),w0=(()=>{class n{static#e=this.type="[Auth] Update Password Success";constructor(){}}return n})(),A0=(()=>{class n{static#e=this.type="[Auth] Update Password Failure";constructor(t){this.error=t}}return n})(),Ml=(()=>{class n{static#e=this.type="[Auth] Check Session";constructor(){}}return n})(),Gh=(()=>{class n{static#e=this.type="[Auth] Sign Up";constructor(t,o){this.value=t,this.verification=o}}return n})(),l_=(()=>{class n{static#e=this.type="[Auth] Sign Up Success";constructor(t){this.response=t}}return n})(),c_=(()=>{class n{static#e=this.type="[Auth] Sign Up Failure";constructor(t){this.error=t}}return n})(),d_=(()=>{class n{static#e=this.type="[Auth] Set User Locale";constructor(t,o){this.locale=t,this.reload=o}}return n})(),__=(()=>{class n{static#e=this.type="[Auth] Set User Locale Success";constructor(t){this.locale=t}}return n})(),la=(()=>{class n{static#e=this.type="[Auth] Check Locale";constructor(){}}return n})(),p_=(()=>{class n{static#e=this.type="[Auth] Get User Apps";constructor(){}}return n})(),u_=(()=>{class n{static#e=this.type="[Auth] Set User Apps";constructor(t){this.apps=t}}return n})(),Il=(()=>{class n{static#e=this.type="[Auth] Check Selected App";constructor(){}}return n})(),Pl=(()=>{class n{static#e=this.type="[Auth] Set Selected User App";constructor(t){this.appId=t}}return n})(),$h=(()=>{class n{static#e=this.type="[Auth] Send User Message";constructor(t){this.message=t}}return n})(),R0=(()=>{class n{static#e=this.type="[Auth] Send User Message Success";constructor(t){this.message=t}}return n})(),N0=(()=>{class n{static#e=this.type="[Auth] Send User Message Fail";constructor(t){this.err=t}}return n})(),Bh=(()=>{class n{static#e=this.type="[Auth] Get User Message";constructor(t,o){this.type=t,this.mode=o}}return n})(),k0=(()=>{class n{static#e=this.type="[Auth] Get User Message Success";constructor(t){this.message=t}}return n})(),D0=(()=>{class n{static#e=this.type="[Auth] Get User Message Fail";constructor(t){this.type=t}}return n})(),zh=(()=>{class n{static#e=this.type="[Auth] Set Message Viewed";constructor(t){this.messageSeenId=t}}return n})(),L0=(()=>{class n{static#e=this.type="[Auth] Set Message Viewed Success";constructor(){}}return n})(),U0=(()=>{class n{static#e=this.type="[Auth] Set Message Viewed Fail";constructor(){}}return n})(),ca=(()=>{class n{static#e=this.type="[Auth] Verify Fail";constructor(t){this.error=t}}return n})(),h_=(()=>{class n{static#e=this.type="[Auth] Reset";constructor(){}}return n})(),Wh=(()=>{class n{static#e=this.type="[Auth] Request Verification Code";constructor(t,o){this.email=t,this.token=o}}return n})(),x0=(()=>{class n{static#e=this.type="[Auth] Request Verification Code Success";constructor(t){this.response=t}}return n})(),j0=(()=>{class n{static#e=this.type="[Auth] Request Verification Code Fail";constructor(t){this.error=t}}return n})(),Xh=(()=>{class n{static#e=this.type="[Auth] Verify Profile";constructor(t,o,s){this.email=t,this.token=o,this.code=s}}return n})(),Hh=(()=>{class n{static#e=this.type="[Auth] Verify Profile Success";constructor(t){this.response=t}}return n})(),g_=(()=>{class n{static#e=this.type="[Auth] Verify Profile Fail";constructor(t){this.error=t}}return n})(),m_=(()=>{class n{static#e=this.type="[Auth] Notify User Restriction";constructor(t,o,s){this.type=t,this.display=o,this.data=s}}return n})(),V0=(()=>{class n{static#e=this.type="[Auth] Clear User Restriction";constructor(t){this.displays=t}}return n})(),Qh=(()=>{class n{static#e=this.type="[Auth] Set Content Viewed";constructor(t,o){this.contentId=t,this.contentType=o}}return n})(),F0=(()=>{class n{static#e=this.type="[Auth] Set Content Viewed Success";constructor(){}}return n})(),f_=(()=>{class n{static#e=this.type="[Auth] Check Content Viewed";constructor(){}}return n})(),G0=(()=>{class n{static#e=this.type="[Auth] Check Content Viewed Success";constructor(t){this.contentViews=t}}return n})(),Yh=(()=>{class n{static#e=this.type="[Auth] Set Developer Referral";constructor(t){this.isDeveloperReferral=t}}return n})(),$0=(()=>{class n{static#e=this.type="[Auth] Get User Notices"}return n})(),B0=(()=>{class n{static#e=this.type="[Auth] Get User Notices Success";constructor(t){this.userNotices=t}}return n})(),z0=(()=>{class n{static#e=this.type="[Auth] Get User Notices Fail";constructor(t){this.error=t}}return n})(),Kh=(()=>{class n{static#e=this.type="[Auth] Mark User Notice As Seen";constructor(t){this.noticeId=t}}return n})(),W0=(()=>{class n{static#e=this.type="[Auth] Mark User Notice As Seen Success";constructor(t){this.noticeId=t}}return n})(),X0=(()=>{class n{static#e=this.type="[Auth] Mark User Notice As Seen Fail";constructor(t){this.error=t}}return n})();class qh{}class S_{}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,Ee.Z)(()=>qh),function(){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",Array)}()],S_.prototype,"organizations",void 0);class b_{static fromJSON(i){const t=new b_;return t.isUser=i.is_user,t.email=i.user_email,t.firstName=i.user_first_name,t.lastName=i.user_last_name,t.name=`${i.user_first_name} ${i.user_last_name}`,t.isDeveloper=i.user_is_developer,t.isDeveloperActive=i.user_is_developer_active,t.isDeveloperVerified=i.user_is_developer_verified,t.isThirdParty=i.user_is_third_party,t.thirdPartyProvider=i.user_third_party_provider,t.isTeamMember=i.user_is_team_member,t}}class y_{static fromJSON(i){const t=new y_;return t.google=i.google_api_key,t}}class wl{constructor(){this.version=5,this.groupInviteMode=0,this.groupCodeMode=0}}class K0 extends wl{static toJSON(i){return{version:i.version,app_producttype:i.app_producttype,app_productkey:i.app_productkey,email:i.email,password:i.password,first_name:i.firstName,last_name:i.lastName,group_invite_mode:i.groupInviteMode,group_invite_key:i.groupInviteKey,group_code_mode:i.groupCodeMode,group_code:i.groupCode,group_ovid_mode:i.groupOvidMode,group_ovid_osptok:i.groupOvidOsptok,platform:i.platform,return_to:i.returnTo,brand_id:i.brandId,locale_id:i.localeId,timestamp:i.timestamp,site_verify_response:i.site_verify_response}}}class q0 extends wl{constructor(i){super(),this.token=i}static toJSON(i){return{id_token:i.token,version:i.version,app_producttype:i.app_producttype,app_productkey:i.app_productkey,group_invite_mode:i.groupInviteMode,group_invite_key:i.groupInviteKey,group_code_mode:i.groupCodeMode,group_code:i.groupCode,group_ovid_mode:i.groupOvidMode,group_ovid_osptok:i.groupOvidOsptok,platform:i.platform,return_to:i.returnTo,brand_id:i.brandId,locale_id:i.localeId,timestamp:i.timestamp,site_verify_response:i.site_verify_response}}}class J0 extends wl{constructor(i,t,o){super(),this.email=i,this.password=t,this.rememberMe=o}static toJSON(i){return{id_token:i.token,version:i.version,app_producttype:i.app_producttype,app_productkey:i.app_productkey,group_invite_mode:i.groupInviteMode,group_invite_key:i.groupInviteKey,group_code_mode:i.groupCodeMode,group_code:i.groupCode,group_ovid_mode:i.groupOvidMode,group_ovid_osptok:i.groupOvidOsptok,email:i.email,password:i.password,email_remember_me:i.rememberMe,platform:i.platform,return_to:i.returnTo,brand_id:i.brandId,locale_id:i.localeId,timestamp:i.timestamp,site_verify_response:i.site_verify_response}}}var Jh=d(90450),Zh=function(n){return n.Zendesk="zendesk",n}(Zh||{});class v_{}var Jt=function(n){return n.AssignRole="assignRole",n.RemoveUser="removeUser",n.TransferContent="transferContent",n.CreateCollection="createCollection",n.DeleteCollection="deleteCollection",n.EditTeamAccount="editTeamAccount",n.EditTeamBookmarks="editTeamBookmarks",n.EditAllTeamBookmarks="editAllTeamBookmarks",n.AddTeamBookmarks="addTeamBookmarks",n.RemoveTeamBookmarks="removeTeamBookmarks",n.EditBookmarks="editBookmarks",n.PublishBookmarks="publishBookmarks",n.SavePrivateBookmarks="savePrivateBookmarks",n.CopyUrl="copyURL",n.ViewBookmarks="viewBookmarks",n.InviteUsers="inviteUsers",n.ViewUsers="viewUsers",n.ExportCSV="exportCSV",n.DuplicateTeamBookmarks="duplicateTeamBookmarks",n.BulkManageTeamBookmarks="bulkManageTeamBookmarks",n.ManageJoinRequests="manageJoinRequests",n}(Jt||{}),Ji=function(n){return n.Admin="admin",n.Creator="creator",n.Viewer="viewer",n}(Ji||{});const eg=[Jt.ViewBookmarks,Jt.CopyUrl,Jt.SavePrivateBookmarks,Jt.ExportCSV],E_=[...eg,Jt.ViewUsers,Jt.InviteUsers,Jt.PublishBookmarks,Jt.EditBookmarks,Jt.EditTeamBookmarks,Jt.RemoveTeamBookmarks,Jt.AddTeamBookmarks,Jt.DuplicateTeamBookmarks,Jt.BulkManageTeamBookmarks],Z0=[...E_,Jt.EditTeamAccount,Jt.EditAllTeamBookmarks,Jt.CreateCollection,Jt.TransferContent,Jt.RemoveUser,Jt.AssignRole,Jt.ManageJoinRequests],Al=[Ji.Viewer,Ji.Creator,Ji.Admin],rr={role_id:void 0,role_name:Ji.Creator,role_display_name:"",role_description:"",permissions:[...E_]},e1={permissions:[Jt.ViewBookmarks,Jt.SavePrivateBookmarks,Jt.PublishBookmarks,Jt.EditBookmarks]},t1={[Ji.Viewer]:eg,[Ji.Creator]:E_,[Ji.Admin]:Z0},n1={[Ji.Viewer]:"Can view team content and edit personal content",[Ji.Creator]:"Can edit and view team content",[Ji.Admin]:"Can manage team settings and edit all content"};function i1(n){return t1[n]||[]}function lr(n){const i=n?.role_name??rr.role_name,t=n?.role_description??n1[i],o=n?.permissions;return{...n,role_description:t,permissions:(0,u.isNil)(o)?i1(i):o}}class o1{}class s1{}class a1{}var da=function(n){return n.DomainAlert="join_group_through_domain_alert",n.WelcomeTour="welcome_tour_alert",n.CompleteProfileAlert="complete_profile_alert",n}(da||{});let C_=(()=>{class n{constructor(t,o){this.http=t,this.storageService=o}getUserMessage(t,o="",s=!0){const a=this.getCachedMessage(t);return s&&a?(0,Rt.of)(a):this.http.get(`/ws/user/message?version=2&type=${t}&mode=${o}`).pipe((0,W.T)(r=>{const{message_seen_id:_,show_alert:g}=r;let P;switch(t){case da.DomainAlert:P=(0,b.bj)(qh,r.join_organization);break;case da.WelcomeTour:P=`${r.tour_version}`;break;case da.CompleteProfileAlert:const{is_new_user:F,is_team_user:ee}=r||{};P=(0,b.bj)(a1,{is_new_user:F,is_team_user:ee})}return{messageSeenId:_,messageType:t,showUserAlert:g,messageData:P}}),(0,is.M)(r=>{r.showUserAlert||this.addCachedMessage(r)}))}setUserMessageViewed(t){return this.http.post("/ws/user/message",{version:2,message_seen_id:t})}sendMessage(t){return this.http.post("/ws/user/message",t)}getCachedMessage(t){return this.getCachedMessages().find(s=>s.messageType===t)}getCachedMessages(){return this.storageService.getSessionItem(It.d0.UserMessagesSeen)||[]}addCachedMessage(t){if(!this.getCachedMessage(t.messageType)){const o=this.getCachedMessages();this.storageService.setSessionItem(It.d0.UserMessagesSeen,[...o,t])}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(It.n$))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var pi=d(12215);class r1 extends wl{constructor(i,t,o,s){super(),this.app_producttype=i,this.app_productkey=t,this.groupOvidMode=o,this.groupOvidOsptok=s}static toJSON(i){return{version:i.version,app_producttype:i.app_producttype,app_productkey:i.app_productkey,group_ovid_mode:i.groupOvidMode,group_ovid_osptok:i.groupOvidOsptok,ignore_ovid_exp:z.c.application===xn.c.Studio&&z.c.deploy!==pi.Z.Production&&!1===z.c.native?1:0}}}const l1=["harvard.edu","liberty.edu"];let _a=(()=>{class n{constructor(t,o,s,a,r){this.http=t,this.reCaptchaV3Service=o,this.userMessageService=s,this.productService=a,this.RECAPTCHA_V3_SITE_KEY=r}loginWithBiodigital(t){return this.http.post("/ws/user/sign/in",J0.toJSON(t),{headers:this.productService.productHeader})}loginWithGoogle(t){return this.http.post("/ws/user/sign/in/google",q0.toJSON(t),{headers:this.productService.productHeader})}loginWithGroup(t){return this.http.post("/ws/organization/sign/in",r1.toJSON(t),{headers:this.productService.productHeader})}logout(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/user/sign/out")}logoutGroup(){return google.accounts.id.disableAutoSelect(),this.http.get("/ws/organization/sign/out",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}checkProfile(t){return this.http.post("/ws/user/profile/check",{version:5,email:t,app_producttype:this.productService.productType,app_productkey:this.productService.productKey},{headers:this.productService.productHeader}).pipe((0,W.T)(r=>b_.fromJSON(r)))}getUserProfile(t){return this.http.get("/ws/user/profile",{params:{version:2,subscription_hard_check:t?1:0}}).pipe((0,W.T)(a=>{const r=(0,b.bj)(S_,a);return r.organizations.forEach(_=>{const g=(0,u.get)(_,"user_role",rr);_.user_role=lr(g)}),r}))}getUserRoles(){return this.http.get("/ws/organization/user/roles").pipe((0,W.T)(t=>t.user_roles.map(o=>lr((0,b.bj)(v_,o)))))}getGroupUserProfile(){return this.http.get("/ws/organization/profile",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}updaterUserProfile(t){return this.http.post("/ws/user/profile?version=2",t)}deleteUserProfile(){return this.http.post("/ws/user/profile/delete",{}).pipe((0,W.T)(t=>t.deleted_user_email))}getEnvironmentSettings(){return this.http.get("/ws/environment/settings?version=2").pipe((0,W.T)(t=>y_.fromJSON(t)))}getUserApps(){return this.http.get("/ws/developer/apps/profile").pipe((0,W.T)(t=>t&&t.apps?JSON.parse(t.apps):[]))}getGroupConfigFromRoute(t){const s=t.queryParams.code||"",a=t.queryParams.group_invite||"",r=t.queryParams.osptok||"";return{group:t.queryParams.group||"",groupCode:s,groupCodeMode:s?1:0,groupInviteMode:a?1:0,groupInviteKey:a,groupOvidMode:r?1:0,groupOvidOsptok:r}}getPlatformConfigFromRoute(t){const{zendesk_signin:o,return_to:s,brand_id:a,locale_id:r,timestamp:_}=t.queryParams;if("1"===o)return{platform:Zh.Zendesk,returnTo:s,brandId:a,localeId:r,timestamp:_}}isLoggedIn(){return this.http.get("/ws/product/account/is/signed-in",{params:{version:1,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}})}getProfileRestrictions(t){let o=!1,s=!1,a="";return t.organizations.forEach(r=>{o||s||(a=r.name,o=r.user_is_subscribed&&r.email_domain_restriction&&!r.user_has_email_domain_access,s=r.user_is_subscribed&&r.ip_address_restriction&&!r.user_has_domain_access)}),{organizationName:a,email:o,ip:s}}resetPassword(t){return this.http.post("/ws/user/password/forgot",{email:t})}deactivateFacebook(t){return this.http.post("/ws/user/sign/in/facebook/deactivate",t)}updatePassword(t,o,s){return this.http.post("/ws/user/password/change",{current_password:t,new_password:o,confirm_new_password:s})}signUp(t){return this.http.post("/ws/user/sign/up",K0.toJSON(t),{headers:this.productService.productHeader})}verifyToken(t,o){return this.http.post("/ws/recaptcha/siteverify",{recaptcha_reponse_token:t,recaptcha_version:o})}verifyReCaptcha(t,o){return o&&grecaptcha.reset(this.RECAPTCHA_V3_SITE_KEY),this.reCaptchaV3Service.execute(t).pipe((0,Ln.Z)(s=>this.verifyToken(s,"v3")),(0,W.T)(s=>({isHuman:s.action===t&&s.score>.2,verification:s})))}isReCaptchaWhiteListed(t){return l1.some(o=>new RegExp(`${o}$`,"i").test(t))}verifyIsHuman(t,o,s=!1){return this.isReCaptchaWhiteListed(o)?(0,Rt.of)({isHuman:!0}):this.verifyReCaptcha(t,s)}isValidGoogleDomain(){return new Set(["human-qa.biodigital.com","human-staging.biodigital.com","human.biodigital.com","loft.biodigital.com","loft-qa.biodigital.com","qa.biodigital.com","localhost:4200","localhost:4201"]).has(window.location.host)}requestVerificationCode(t){const o={...t,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/request",o).pipe((0,W.T)(s=>(0,b.bj)(o1,s)))}verifyProfile(t){const o={...t,version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey};return this.http.post("/ws/user/verification/confirm",o).pipe((0,W.T)(s=>(0,b.bj)(s1,s)))}checkProfileIncomplete(){return this.userMessageService.getUserMessage(da.CompleteProfileAlert,"v2",!1).pipe((0,zi.W)(()=>(0,Rt.of)({messageType:da.CompleteProfileAlert,messageData:{},showUserAlert:!1})))}getUserNotices(){const o=new f.Nl({fromObject:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}});return this.http.get("ws/user/notices",{params:o})}markUserNoticeAsSeen(t){return this.http.post("ws/user/notices/seen",{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,notice_id:t})}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(Jh.ob),e.KVO(C_),e.KVO(De),e.KVO(Jh.gq))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Rl=(()=>{class n{static#e=this.type="[Organizations] Set Organizations";constructor(t){this.organizations=t}}return n})(),tg=(()=>{class n{static#e=this.type="[Organizations] Select Organization";constructor(t){this.organization=t}}return n})(),ng=(()=>{class n{static#e=this.type="[Organizations] Select Collection";constructor(t){this.collection=t}}return n})(),Nl=(()=>{class n{static#e=this.type="[Organizations] Get Collections";constructor(t){this.organizationId=t}}return n})(),T_=(()=>{class n{static#e=this.type="[Organizations] Get Collections Success";constructor(t){this.collections=t}}return n})(),ig=(()=>{class n{static#e=this.type="[Organizations] Add Collection";constructor(t,o){this.organizationId=t,this.collectionName=o}}return n})(),O_=(()=>{class n{static#e=this.type="[Organizations] Add Collection Success";constructor(t,o){this.organizationId=t,this.collectionName=o}}return n})(),M_=(()=>{class n{static#e=this.type="[Organizations] Add Collection Error";constructor(t){this.error=t}}return n})(),og=(()=>{class n{static#e=this.type="[Organizations] Remove Collection";constructor(t){this.collection=t}}return n})(),I_=(()=>{class n{static#e=this.type="[Organizations] Remove Collection Success";constructor(t){this.collection=t}}return n})(),P_=(()=>{class n{static#e=this.type="[Organizations] Remove Collection Error";constructor(t){this.error=t}}return n})(),sg=(()=>{class n{static#e=this.type="[Organizations] Set Collection Rename Mode";constructor(t){this.collection=t}}return n})(),ag=(()=>{class n{static#e=this.type="[Organizations] Rename Collection";constructor(t,o){this.collection=t,this.collectionName=o}}return n})(),w_=(()=>{class n{static#e=this.type="[Organizations] Rename Collection Success";constructor(t,o){this.collection=t,this.collectionName=o}}return n})(),A_=(()=>{class n{static#e=this.type="[Organizations] Rename Collection Error";constructor(t){this.error=t}}return n})(),rg=(()=>{class n{static#e=this.type="[Organizations] Reorder Collections";constructor(t,o){this.organizationId=t,this.collections=o}}return n})(),R_=(()=>{class n{static#e=this.type="[Organizations] Reorder Collections Success";constructor(t,o){this.organizationId=t,this.collections=o}}return n})(),c1=(()=>{class n{static#e=this.type="[Organizations] Reorder Collections Error";constructor(t){this.error=t}}return n})(),N_=(()=>{class n{static#e=this.type="[Organizations] Reset";constructor(){}}return n})(),lg=(()=>{class n{static#e=this.type="[Organizations] Create Organization";constructor(t){this.organization=t}}return n})(),cg=(()=>{class n{static#e=this.type="[Organizations] Create Organization Success";constructor(){}}return n})(),k_=(()=>{class n{static#e=this.type="[Organizations] Create Organization Fail";constructor(t){this.error=t}}return n})(),dg=(()=>{class n{static#e=this.type="[Organizations] Update Organization";constructor(t){this.organization=t}}return n})(),d1=(()=>{class n{static#e=this.type="[Organizations] Update Organization Success";constructor(){}}return n})(),_1=(()=>{class n{static#e=this.type="[Organizations] Update Organization Fail";constructor(t){this.error=t}}return n})(),_g=(()=>{class n{static#e=this.type="[Organizations] Delete Organization";constructor(t){this.organization=t}}return n})(),p1=(()=>{class n{static#e=this.type="[Organizations] Delete Organization Success";constructor(t){this.organization=t}}return n})(),u1=(()=>{class n{static#e=this.type="[Organizations] Delete Organization Fail";constructor(t){this.error=t}}return n})(),pg=(()=>{class n{static#e=this.type="[Organizations] Get Organization Profile";constructor(t){this.request=t}}return n})(),D_=(()=>{class n{static#e=this.type="[Organizations] Get Organization Profile Success";constructor(t){this.organizationProfile=t}}return n})(),h1=(()=>{class n{static#e=this.type="[Organizations] Get Organization Profile Fail";constructor(t){this.error=t}}return n})(),ug=(()=>{class n{static#e=this.type="[Organizations] Clear Organization Profile";constructor(){}}return n})(),hg=(()=>{class n{static#e=this.type="[Organizations] Get Join Domains";constructor(t){this.params=t}}return n})(),L_=(()=>{class n{static#e=this.type="[Organizations] Get Join Domains Success";constructor(t){this.joinDomains=t}}return n})(),gg=(()=>{class n{static#e=this.type="[Organizations] Post Join Domains";constructor(t){this.emailDomains=t}}return n})(),g1=(()=>{class n{static#e=this.type="[Organizations] Post Join Domains Success";constructor(t){this.emailDomains=t}}return n})(),m1=(()=>{class n{static#e=this.type="[Organizations] Post Join Domains Fail";constructor(t){this.error=t}}return n})(),mg=(()=>{class n{static#e=this.type="[Organizations] Delete Join Domains";constructor(t){this.joinDomainIds=t}}return n})(),f1=(()=>{class n{static#e=this.type="[Organizations] Delete Join Domains Success";constructor(t){this.joinDomainIds=t}}return n})(),S1=(()=>{class n{static#e=this.type="[Organizations] Delete Join Domains Fail";constructor(t){this.error=t}}return n})(),fg=(()=>{class n{static#e=this.type="[Organizations] Generate Group Code";constructor(t){this.groupId=t}}return n})(),U_=(()=>{class n{static#e=this.type="[Organizations] Generate Group Code Success";constructor(t){this.groupCode=t}}return n})(),b1=(()=>{class n{static#e=this.type="[Organizations] Generate Group Code Fail";constructor(t){this.error=t}}return n})();var y1=d(35801);const v1={"en-US":!0,"en-GB":!0,"es-ES":!0,"es-MX":!0,"fr-FR":!0,"it-IT":!0,"pt-PT":!0,"pt-BR":!0,"he-IL":!0,"de-DE":!1,"zh-CN":!1,"cmn-CN":!1,ja:!1,"ja-JP":!1};function bg(n,i){return()=>{if(i===Jn.q.id)return(0,Rt.of)({});const t=Jn.WF[i]??i;return function Sg(n,i){const t=Jn.WF[i]??i;return v1[t]??1?n.get(`assets/locales/${t}.json`).pipe((0,zi.W)(()=>(0,Rt.of)(void 0))):(0,Rt.of)(void 0)}(n,i).pipe((0,lo.n)(o=>{const s=o?.translations;return(0,u.isNil)(s)?console.warn(`Translations not found for locale: ${t}`):(0,y1.Zi)(s),(0,Rt.of)(o)}))}}var Un,E1=d(41862);!function(n){n.SetTheme=(()=>{class P{static#e=this.type="[Layout] Set Theme";constructor(ee){this.theme=ee}}return P})(),n.SetSidenav=(()=>{class P{static#e=this.type="[Layout] Set Sidenav";constructor(ee){this.sidenav=ee}}return P})(),n.ToggleSidenav=(()=>{class P{static#e=this.type="[Layout] Toggle Sidenav";constructor(ee){this.open=ee}}return P})(),n.SetHeader=(()=>{class P{static#e=this.type="[Layout] Set Header";constructor(ee){this.siteHeaderType=ee}}return P})(),n.SetFooter=(()=>{class P{static#e=this.type="[Layout] Set Footer";constructor(ee){this.siteFooterType=ee}}return P})(),n.SetHeaderHeight=(()=>{class P{static#e=this.type="[Layout] Set Header Height";constructor(ee){this.height=ee}}return P})(),n.SetFooterHeight=(()=>{class P{static#e=this.type="[Layout] Set Footer Height";constructor(ee){this.height=ee}}return P})(),n.ResetLayout=(()=>{class P{static#e=this.type="[Layout] Reset";constructor(){}}return P})()}(Un||(Un={}));class C1{constructor(i,t,o){this.category=i,this.message=t,this.log=o}}let yg=(()=>{class n{constructor(t){this.http=t,this.log={}}logError(t,o=!1){const s=`${t.category}${t.message}`;return o&&this.log[s]?(0,Rt.of)():(this.log[s]=!0,this.http.post("/ws/human-error",t))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var kt;!function(n){n.SetSearchMode=(()=>{class qe{static#e=this.type="[Gallery] Set Search Mode";constructor(Pt){this.searchMode=Pt}}return qe})(),n.SetViewMode=(()=>{class qe{static#e=this.type="[Gallery] Set View Mode";constructor(Pt){this.viewMode=Pt}}return qe})(),n.ShowFilters=(()=>{class qe{static#e=this.type="[Gallery] Show Filters";constructor(Pt,ti=!1){this.show=Pt,this.triggerDrawer=ti}}return qe})(),n.GetStudioOptions=(()=>{class qe{static#e=this.type="[Gallery] Get Studio Options";constructor(Pt){this.organizationId=Pt}}return qe})(),n.GetStudioOptionsSuccess=(()=>{class qe{static#e=this.type="[Gallery] Get Studio Options Success";constructor(Pt){this.options=Pt}}return qe})(),n.SearchLoft=(()=>{class qe{static#e=this.type="[Gallery] Search Loft";constructor(Pt){this.config=Pt}}return qe})(),n.SearchLoftSuccess=(()=>{class qe{static#e=this.type="[Gallery] Search Loft Success";constructor(Pt){this.bookmarks=Pt}}return qe})(),n.SetSearchConfig=(()=>{class qe{static#e=this.type="[Gallery] Set Search Config";constructor(Pt,ti){this.config=Pt,this.options=ti}}return qe})(),n.SetSearchOptions=(()=>{class qe{static#e=this.type="[Gallery] Set Search Options";constructor(Pt){this.options=Pt}}return qe})(),n.SetActiveTags=(()=>{class qe{static#e=this.type="[Gallery] Set Active Tags";constructor(Pt){this.activeTags=Pt}}return qe})(),n.SearchCategory=(()=>{class qe{static#e=this.type="[Gallery] Search Category";constructor(Pt){this.categoryId=Pt}}return qe})(),n.SearchStudio=(()=>{class qe{static#e=this.type="[Gallery] Search Studio";constructor(){}}return qe})(),n.SearchStudioSuccess=(()=>{class qe{static#e=this.type="[Gallery] Search Studio Success";constructor(Pt){this.bookmarks=Pt}}return qe})(),n.SearchSuccess=(()=>{class qe{static#e=this.type="[Gallery] Search Success";constructor(Pt){this.bookmarks=Pt}}return qe})(),n.SelectBookmark=(()=>{class qe{static#e=this.type="[Gallery] Select Bookmark";constructor(Pt){this.result=Pt}}return qe})(),n.SetSidenav=(()=>{class qe{static#e=this.type="[Gallery] Set Sidenav";constructor(Pt){this.sidenav=Pt}}return qe})(),n.SetBulkActions=(()=>{class qe{static#e=this.type="[Gallery] Set Bulk Actions";constructor(Pt){this.bulkActions=Pt}}return qe})(),n.SetCardActions=(()=>{class qe{static#e=this.type="[Gallery] Set Card Actions";constructor(Pt){this.cardActions=Pt}}return qe})(),n.ClearResults=(()=>{class qe{static#e=this.type="[Gallery] Clear Results";constructor(){}}return qe})(),n.CheckItem=(()=>{class qe{static#e=this.type="[Gallery] Check Item";constructor(Pt,ti){this.id=Pt,this.checked=ti}}return qe})(),n.CheckAll=(()=>{class qe{static#e=this.type="[Gallery] Check All";constructor(){}}return qe})(),n.UncheckAll=(()=>{class qe{static#e=this.type="[Gallery] Uncheck All";constructor(){}}return qe})(),n.SetCheckedItems=(()=>{class qe{static#e=this.type="[Gallery] Set Checked Items";constructor(Pt){this.ids=Pt}}return qe})(),n.Reset=(()=>{class qe{static#e=this.type="[Gallery] Reset";constructor(){}}return qe})()}(kt||(kt={}));var vg=function(n){return n.Web="web",n.Mobile="mobilesdk",n}(vg||{});let O1=(()=>{class n{static#e=this.type="[Subscription] Reset Subscription State"}return n})();const M1={"Sign in":"3971305","Sign up":"3971297"};let Eg=(()=>{class n{constructor(t){this.config=t,this.initialized=!1}initialize(){if(!this.config.enabled||this.initialized)return;const t=`\n      _linkedin_partner_id = "${this.config.linkedinId}"; \n      window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || []; \n      window._linkedin_data_partner_ids.push(_linkedin_partner_id);\n      (function(){var s = document.getElementsByTagName("script")[0]; var b = document.createElement("script"); b.type = "text/javascript";b.async = true; b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js"; s.parentNode.insertBefore(b, s);})();\n    `,o=document.createElement("script");o.textContent=t,document.body.appendChild(o),this.initialized=!0}track(t){const o=M1[t];if(o){const s=document.createElement("img");s.height=1,s.width=1,s.style.display="none",s.alt="",s.src=`https://px.ads.linkedin.com/collect/?pid=${this.config.linkedinId}&conversionId=${o}&fmt=gif`,document.body.appendChild(s)}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO("linkedinConfig"))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var cr=function(n){return n.Free="free",n.Premium="premium",n.Team="team",n}(cr||{});let x_=(()=>{class n{constructor(t,o){this.http=t,this.productService=o}trackContentPublish(t,o){return this.http.post("/ws/user/analytics/content/inapp/publish",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:o,content_id:t})}trackContentView(t,o){return this.http.post("/ws/user/analytics/content/inapp/view",{version:4,app_producttype:this.productService.productType,app_productkey:this.productService.productKey,content_type:o,content_id:t})}checkContentView(){return this.http.get("/ws/user/content/inapp/view/check")}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(De))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Cg=function(n){return n.User="user",n.Group="group",n}(Cg||{}),Oo=function(n){return n.Private="Private",n.TeamView="Team - View Only",n.TeamEdit="Team - View & Edit",n}(Oo||{});function Wi(n,i){return(0,u.get)(n,"permissions",[]).includes(i)}function j_(n,i){const t=Wi(n,Jt.EditBookmarks);return!!t&&(i.type===Se.c.Module?t:!(!0!==i.is_owner)||!!pa(i)&&Og(n,i))}function Og(n,i){if(Wi(n,Jt.EditAllTeamBookmarks))return!0;const o=Wi(n,Jt.EditTeamBookmarks),s=pa(i)&&i.group_access[0].member_edit;return o&&s}function V_(n){return pa(n)&&!0===n.group_access[0].visible}function Mg(n){return pa(n)&&!0===n.group_access[0].member_edit}function kl(n){return!(0,u.isNil)(n.module_accessor_level)}function Ig(n,i,t,o){return!(!t||!o)&&Wi(n,Jt.CopyUrl)}function F_(n){return Wi(n,Jt.PublishBookmarks)}function G_(n){return n.type==Se.c.Module&&n.module_accessor_level===Cg.Group}function pa(n){return Array.isArray(n.group_access)&&n.group_access.length>0}var $_=d(71217);function Pg(n,i){return{type:n,data:i}}var Zi=d(27153),Ei=d(30234);const B_=Zi.fQ[Ei.a.WoltersKluwer],x1={};function ss(n,i){if("string"==typeof n)return n;const t=function $1(n){return function G1(n){const t=n?.error?.error;return"string"==typeof t?.error_id||"string"==typeof t?.message}(n)?n.error.error:void 0}(n),o=t?.error_id||function F1(n){return n instanceof Error?"":wg(n,"error_id")||""}(n),s=t?.message||wg(n,"message")||"",a=function V1(n,i){switch(n){case"1003":return`Unsupported video length. Please upload a video ${i?.limit} secs or less.`;case"OPPH01.00126":case"SUH01.00040":return"This invite code is invalid or has expired. Please reach out to your administrator for a new code.";case"OPPH01.00122":case"SUH01.00122":case"SIH01.00122":case"FSH01.00122":case"GSH01.00122":return`We were unable to find an account associated with your institution. \n      Please contact your administrator [here](${B_}) and provide this error ID: ${n}.`;case"OPPH01.00123":case"SUH01.00123":case"SIH01.00123":case"FSH01.00123":case"GSH01.00123":return`There are multiple team accounts associated with your institution. \n      Please contact your administrator [here](${B_}) and provide this error ID: ${n}.`;case"OPPH01.00124":case"OPPH01.00125":case"OPPH01.00110":case"OPPH01.00111":case"OPPH01.00112":case"SUH01.00124":case"SUH01.00110":case"SUH01.00111":case"SUH01.00112":case"SIH01.00124":case"SIH01.00110":case"SIH01.00111":case"SIH01.00112":case"FSH01.00124":case"FSH01.00125":case"FSH01.00110":case"FSH01.00111":case"FSH01.00112":case"GSH01.00124":case"GSH01.00110":case"GSH01.00111":case"GSH01.00112":return`There was an issue with retrieving information from your institution. \n      Please try again or contact your administrator [here](${B_}) and provide this error ID: ${n}.`;case"OSIH01.00111":case"OSIH01.00112":return"We were unable to load this page due to an invalid Ovid token";default:return x1[n]||""}}(o,i);return a||(s?s.replace(/^\[(.+)\]$/,"$1").replace(/^\'(.+)\'$/,"$1"):"")}function wg(n,i,t=3){let o=n,s=0;for(;s<t&&o&&!o[i];)o=o.error,s++;return o&&o[i]}var z_=d(11153);class Mo extends Error{constructor(){super("reCAPTCHA error. Please complete the form to continue.")}}var dr,Ze=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},ae=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const Dl=z.c.application===xn.c.Studio,Ag={signed_in:!1},W_={loading:!1,requestingCode:!1,profileStatus:"ready",auth2:null,googleCredential:null,googlePromptResult:null,loggedIn:Ag,userLocale:null,userRoles:[],contentViews:{limit_reached:!1,inapp_view_limit:0,inapp_view_count:0},developerReferral:!1};let Pe=class Ed{static#e=dr=this;static getLoggedIn(i){return!0===i.loggedIn?.signed_in}static getLoggedInState(i){return i.loggedIn}static getEnvironmentSettings(i){return i.environmentSettings}static getProfile(i){const{userProfile:t,groupUserProfile:o}=i;return(0,u.isNil)(t)?(0,u.isNil)(o)?void 0:Pg($_.P.Organization,o):Pg($_.P.User,t)}static getUserProfile(i){return i.userProfile}static getGroupUserProfile(i){return i.groupUserProfile}static getUserRole(i){return(0,u.isNil)(i.userProfile)?(0,u.isNil)(i.groupUserProfile)?void 0:e1:i.userProfile?.organizations[0]?.user_role??rr}static getUserRoles(i){return i.userRoles}static getSystemDefaultRole(i){let t;return i&&(t=i.userRoles.find(o=>o.role_name===rr.role_name)),null!==t?t:rr}static getUserType(i){if(!(0,u.isNil)(i.userProfile)){const{premium_account:t,premium_account_type:o}=i.userProfile;if(t)return"group"===o?cr.Team:cr.Premium}return cr.Free}static getUserSessionType(i){return i.loggedIn?.session_type}static canInviteUsers(i){if(!(0,u.isNil)(i.userProfile)){const t=dr.getUserType(i);return Wi(dr.getUserRole(i),Jt.InviteUsers)&&t===cr.Team}return!1}static getUserAccountSettings(i){return i?.userProfile?.account_settings??[]}static getAuth2(i){return i.auth2}static getGooglePromptResult(i){return i.googlePromptResult}static getProfileCheck(i){return i.profileCheck}static getLoading(i){return i.loading}static getVerifyingProfile(i){return"verifying"===i.profileStatus}static getProfileUpdating(i){return"updating"===i.profileStatus}static getProfileDeleting(i){return"deleting"===i.profileStatus}static getUserLocale(i){return i.userLocale}static getUserLanguage(i){return i.userLocale?.lang||Jn.q.lang}static getUserApps(i){return i?.userApps??[]}static getSelectedUserApp(i){return(i.userApps||[]).find(o=>o.id===i.selectedAppId)}static getUserFullName(i){return(0,u.isNil)(i?.userProfile)?null:(0,u.trim)([i.userProfile.first_name??"",i.userProfile.last_name??""].join(" "))}static getUserEmail(i){return(0,u.isNil)(i?.userProfile)?null:i.userProfile.email}static isPrivateUser(i){return!(0,u.isNil)(i?.userProfile)&&0===(i?.userProfile?.organizations??[]).length}static isPremiumUser(i){return!0===i?.userProfile?.premium_account_valid}static isAdmin(i){const t=this.getUserRole(i);return!!t&&t.role_name===Ji.Admin}static isDeveloperReferral(i){return i.developerReferral}static getContentViews(i){return i.contentViews}static getContentViewsReached(i){return!dr.isPremiumUser(i)&&i.contentViews.limit_reached}static hasActiveDeveloperAccount(i){return!(0,u.isNil)(i?.userProfile)&&i.userProfile.developer_account&&(i.userProfile.developer_account_active||i.userProfile.developer_account_verified)&&i.userProfile.developer_has_apps}static getUserNotices(i){return i.userNotices}static canStartFreeTrial(i){return i.userProfile?.premium_account_eligibility.group_free_trial??!1}initializeGoogleAuth(i){const t={client_id:z.c.googleAuthKey,itp_support:!1};navigator.userAgent.indexOf("BioDigitalVR")>=0?(t.ux_mode="redirect",t.login_uri="https://"+window.location.host+"/ws/google/to/auth"):(t.ux_mode="popup",t.callback=s=>{i.patchState({googleCredential:s.credential}),i.dispatch(new m0(s.credential))}),google.accounts.id.initialize(t)}promptWithGoogle(i){google.accounts.id.prompt(t=>{const o={dismissedReason:t.getDismissedReason(),momentType:t.getMomentType(),notDisplayedReason:t.getNotDisplayedReason(),skippedReason:t.getSkippedReason()};i.dispatch(new Zd(o))})}promptWithGoogleSuccess(i,t){i.patchState({googlePromptResult:t.promptResult})}isLoggedIn(i,t){i.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{const{signed_in:s,session_type:a}=o;i.dispatch(s?new Cl(a):new Tl(a))})}isLoggedInSuccess(i,t){i.patchState({loggedIn:{signed_in:!0,session_type:t.sessionType}})}isLoggedInFailure(i,t){i.patchState({loggedIn:Ag})}login(i,t){const{login:o,verification:s}=t,{email:a}=o;i.patchState({loading:!0}),(s?.isHuman?(0,Rt.of)(s):this.authService.verifyIsHuman("studio_login",a)).pipe((0,Ln.Z)(({isHuman:_,verification:g})=>{if(!_)throw new Mo;return this.authService.loginWithBiodigital({...o,...g?{site_verify_response:g}:null})}),(0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe({next:_=>{i.dispatch(new sr("biodigital",_))},error:_=>{_ instanceof Mo&&i.dispatch(new ca(_)),this.logFailure("LOGIN_FAILURE",_),i.dispatch(new ar("biodigital",_,o))}})}loginWithGoogle(i,t){i.patchState({loading:!0}),this.authService.loginWithGoogle(t.login).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new sr("google",o))},o=>{(1===t.login.groupCodeMode||1===t.login.groupInviteMode)&&this.logFailure("GOOGLE_SIGNUP_FAILURE",o),i.dispatch(new ar("google",o,t.login))})}loginWithGroup(i,t){i.patchState({loading:!0}),this.authService.loginWithGroup(t.login).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new sr("group",o))},o=>{i.dispatch(new ar("group",o,t.login))})}loginSuccess(i,t){Dl&&(this.linkedinInsights.track("Sign in"),"google"===t.loginType&&"signup"===t.response.authentication_type?this.vendorAnalyticsService.trackSignUp(t.loginType):this.vendorAnalyticsService.trackSignIn(t.loginType)),i.dispatch(new Jd),i.dispatch(new la)}loginFailure(i,t){Dl&&this.vendorAnalyticsService.track("Sign In - Failure",{type:t.loginType,error:ss(t.error)||"There was an error logging in.",statusCode:t.error?.status})}logout(i,t){i.patchState({loading:!0}),("organization"===i.getState().loggedIn?.session_type?this.authService.logoutGroup():this.authService.logout()).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(()=>i.dispatch(new e_),()=>i.dispatch(new S0))}logoutSuccess(i,t){i.setState(W_),i.dispatch(new h_),i.dispatch(new O1),i.dispatch(new Ie.Ri),i.dispatch(new E1.tV),i.dispatch(new st.lQ),i.dispatch(new Je.$y),i.dispatch(new Un.ResetLayout),i.dispatch(new N_),i.dispatch(new ct.jj),i.dispatch(new Nn.FN),i.dispatch(new kt.Reset),i.dispatch(new z_.hw),this.storageService.clearSessionStorage()}checkProfile(i,t){return i.patchState({loading:!0}),this.authService.checkProfile(t.email).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new r_(o))},o=>{i.dispatch(new O0(o))})}checkProfileSuccess(i,t){i.patchState({profileCheck:t.profile})}getGroupUserProfileAction(i,t){return i.patchState({loading:!0}),this.authService.getGroupUserProfile().pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new i_(o))},o=>{i.dispatch(new y0(o))})}getGroupUserProfileSuccess(i,{groupUserProfile:t}){i.patchState({userProfile:null,groupUserProfile:t}),i.dispatch(new Rl(t.organizations)),i.dispatch(new la)}getUserProfile(i,{hardCheck:t}){return i.patchState({loading:!0}),this.authService.getUserProfile(t).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new s_(o))},o=>{i.dispatch(new v0(o))})}getUserProfileSuccess(i,t){i.patchState({userProfile:t.userProfile,groupUserProfile:null}),i.dispatch(new Rl(t.userProfile.organizations)),i.dispatch(new p_),i.dispatch(new la)}updateUserProfile(i,{userProfile:t}){i.patchState({profileStatus:"updating"}),this.authService.updaterUserProfile(t).pipe((0,Ot.j)(()=>i.patchState({profileStatus:"ready"}))).subscribe(()=>{i.dispatch(new Dh(t))},o=>{i.dispatch(new E0(o))})}updateUserProfileSuccess(i,{userProfile:t}){this.vendorAnalyticsService.updateVisitorData(t)}deleteUserProfile(i,t){i.patchState({profileStatus:"deleting"}),this.authService.deleteUserProfile().pipe((0,Ot.j)(()=>i.patchState({profileStatus:"ready"}))).subscribe(o=>{i.dispatch(new C0(o))},o=>{i.dispatch(new T0(o))})}getUserRoles(i,t){this.authService.getUserRoles().subscribe(o=>{i.patchState({userRoles:o})})}getUserApps(i,t){this.authService.getUserApps().subscribe(o=>{i.dispatch(new u_(o)),i.dispatch(new Il)},o=>{})}setUserApps(i,{apps:t}){i.patchState({userApps:t})}setSelectedUserApp(i,{appId:t}){i.patchState({selectedAppId:t}),null!==t?this.storageService.setLocalItem(It.UT.UserAppId,t):this.storageService.removeLocalItem(It.UT.UserAppId)}checkSelectedUserApp(i,t){const o=i.getState().userApps,s=this.storageService.getLocalItem(It.UT.UserAppId);if(s){const a=parseInt(s,10);i.dispatch(new Pl(a))}else if(o&&o.length){const a=o.find(r=>r.app_platform.some(_=>_.type===vg.Web));i.dispatch(new Pl(a?a.id:void 0))}}checkSession(i,t){i.patchState({loading:!0}),this.authService.isLoggedIn().pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{const{signed_in:s,session_type:a}=o;s?(i.dispatch(new Cl(a)),"organization"===a?i.dispatch(new n_):(i.dispatch(new o_),i.dispatch(new Ol))):i.dispatch(new Tl(a))})}getEnvironmentSettings(i,t){return i.patchState({loading:!0}),this.authService.getEnvironmentSettings().pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new t_(o))},o=>{i.dispatch(new b0(o))})}GetEnvironmentSettingsSuccess(i,t){i.patchState({environmentSettings:t.environmentSettings})}resetPassword(i,t){i.patchState({loading:!0}),this.authService.resetPassword(t.email).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(()=>{i.dispatch(new M0(t.email))},o=>{i.dispatch(new I0(o))})}transferFacebookAccount(i,t){i.patchState({loading:!0}),this.authService.verifyIsHuman("deactivate_facebook",t.email).pipe((0,Ln.Z)(({isHuman:o,verification:s})=>{if(!o)throw new Mo;return this.authService.deactivateFacebook({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...s?{site_verify_response:s}:null,user_email:t.email})}),(0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe({next:o=>{i.dispatch(o.conversion_complete&&o.reset_password_email_sent?new P0(t.email):new Vh(new Error("Facebook deactivation failed")))},error:o=>{o instanceof Mo&&i.dispatch(new ca(o)),i.dispatch(new Vh(o))}})}updatePassword(i,t){const{currentPassword:o,newPassword:s,confirmNewPassword:a}=t;this.authService.updatePassword(o,s,a).subscribe(()=>{i.dispatch(new w0)},r=>{i.dispatch(new A0(r))})}signUp(i,t){const{value:o,verification:s}=t,{email:a}=o;i.patchState({loading:!0}),(s?.isHuman?(0,Rt.of)(s):this.authService.verifyIsHuman("studio_signup",a)).pipe((0,Ln.Z)(({isHuman:_,verification:g})=>{if(!_)throw new Mo;return this.authService.signUp({...o,...g?{site_verify_response:g}:null})}),(0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe({next:_=>{i.dispatch(new l_(_))},error:_=>{_ instanceof Mo&&i.dispatch(new ca(_)),i.dispatch(new c_(_))}})}signUpSuccess(i,t){Dl&&this.vendorAnalyticsService.trackSignUp("biodigital")}signUpFailure(i,t){Dl&&this.vendorAnalyticsService.track("Sign Up - Failure",{error:ss(t?.error)||"There was an error signing up.",statusCode:t.error?.status}),this.logFailure("BIODIGITAL_SIGNUP_FAILURE",t)}setUserLocale(i,{locale:t,reload:o}){this.storageService.setLocalItem(It.UT.Locale,t.id),o?window.location.reload():(i.patchState({userLocale:t}),i.dispatch(new __(t)))}setUserLocaleSuccess(i,{locale:t}){bg(this.httpClient,t.id)().subscribe(()=>{})}checkLocale(i,t){const o=(0,Jn.kF)(),s=Jn.IB.find(a=>a.id===o)||Jn.q;i.dispatch(new d_(s))}sendUserMessage(i,{message:t}){this.userMessageService.sendMessage(t).subscribe(()=>{i.dispatch(new R0(t))},o=>{i.dispatch(new N0(o))})}getUserMessage(i,{type:t,mode:o}){this.userMessageService.getUserMessage(t,o).subscribe(s=>{i.dispatch(new k0(s))},()=>{i.dispatch(new D0(t))})}setUserMessageViewed(i,{messageSeenId:t}){this.userMessageService.setUserMessageViewed(t).subscribe(()=>i.dispatch(new L0),()=>i.dispatch(new U0))}resetAuth(i,t){i.setState(W_)}requestVerificationCode(i,{email:t,token:o}){i.patchState({requestingCode:!0}),this.authService.requestVerificationCode({user_email:t,verification_jwt:o}).pipe((0,Ot.j)(()=>i.patchState({requestingCode:!1}))).subscribe(s=>{i.dispatch(new x0(s))},s=>{i.dispatch(new j0(s))})}verifyProfile(i,{email:t,token:o,code:s}){const a=s.toUpperCase();i.patchState({profileStatus:"verifying"}),this.authService.verifyProfile({user_email:t,verification_code:a,verification_jwt:o}).pipe((0,Ot.j)(()=>i.patchState({profileStatus:"ready"}))).subscribe(r=>{i.dispatch(new Hh(r)),i.dispatch(new Ml)},r=>{i.dispatch(new g_(r))})}verifyProfileSuccess(i){this.vendorAnalyticsService.track("Email Verify - Success",{platform:this.productService.productType})}verifyProfileFail(i,t){this.vendorAnalyticsService.track("Email Verify - Failure",{error:ss(t?.error)||"There was an error with email verification.",statusCode:t.error?.status})}setContentView(i,{contentId:t,contentType:o}){this.contentViewService.trackContentView(t,o).subscribe(()=>{i.dispatch(new F0),i.dispatch(new f_)})}checkContentViews(i,t){this.contentViewService.checkContentView().subscribe(o=>{i.patchState({contentViews:o}),i.dispatch(new G0(o))})}setDeveloperReferral(i,t){i.patchState({developerReferral:t.isDeveloperReferral})}logFailure(i,t){const o=t?.message||"",s=ss(t)||"";this.errorLoggingService.logError(new C1(i,o,s)).subscribe()}getUserNotices(i){this.authService.getUserNotices().subscribe({next:t=>{const o=t.notices;i.patchState({userNotices:o}),i.dispatch(new B0(o))},error:t=>i.dispatch(new z0(t))})}markUserNoticeAsSeen(i,{noticeId:t}){this.authService.markUserNoticeAsSeen(t).subscribe({next:()=>{const o=i.getState().userNotices;if(o){const s=o.findIndex(a=>a.notice_id===t);o.splice(s,1),i.patchState({userNotices:[...o]}),i.dispatch(new W0(t))}},error:o=>i.dispatch(new X0(o))})}constructor(i,t,o,s,a,r,_,g,P){this.authService=i,this.userMessageService=t,this.storageService=o,this.errorLoggingService=s,this.linkedinInsights=a,this.vendorAnalyticsService=r,this.contentViewService=_,this.productService=g,this.httpClient=P}ngxsOnInit(i){i.dispatch(new Ml),i.dispatch(new la),i.dispatch(new Il),i.dispatch(new wh)}static#t=this.\u0275fac=function(t){return new(t||Ed)(e.KVO(_a),e.KVO(C_),e.KVO(It.n$),e.KVO(yg),e.KVO(Eg),e.KVO(ve),e.KVO(x_),e.KVO(De),e.KVO(f.Qq))};static#n=this.\u0275prov=e.jDH({token:Ed,factory:Ed.\u0275fac})};Ze([(0,l.rc)(wh),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe.prototype,"initializeGoogleAuth",null),Ze([(0,l.rc)(f0),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe.prototype,"promptWithGoogle",null),Ze([(0,l.rc)(Zd),ae("design:type",Function),ae("design:paramtypes",[Object,Zd]),ae("design:returntype",void 0)],Pe.prototype,"promptWithGoogleSuccess",null),Ze([(0,l.rc)(Jd),ae("design:type",Function),ae("design:paramtypes",[Object,Jd]),ae("design:returntype",void 0)],Pe.prototype,"isLoggedIn",null),Ze([(0,l.rc)(Cl),ae("design:type",Function),ae("design:paramtypes",[Object,Cl]),ae("design:returntype",void 0)],Pe.prototype,"isLoggedInSuccess",null),Ze([(0,l.rc)(Tl),ae("design:type",Function),ae("design:paramtypes",[Object,Tl]),ae("design:returntype",void 0)],Pe.prototype,"isLoggedInFailure",null),Ze([(0,l.rc)(Ph),ae("design:type",Function),ae("design:paramtypes",[Object,Ph]),ae("design:returntype",void 0)],Pe.prototype,"login",null),Ze([(0,l.rc)(Ah),ae("design:type",Function),ae("design:paramtypes",[Object,Ah]),ae("design:returntype",void 0)],Pe.prototype,"loginWithGoogle",null),Ze([(0,l.rc)(Rh),ae("design:type",Function),ae("design:paramtypes",[Object,Rh]),ae("design:returntype",void 0)],Pe.prototype,"loginWithGroup",null),Ze([(0,l.rc)(sr),ae("design:type",Function),ae("design:paramtypes",[Object,sr]),ae("design:returntype",void 0)],Pe.prototype,"loginSuccess",null),Ze([(0,l.rc)(ar),ae("design:type",Function),ae("design:paramtypes",[Object,ar]),ae("design:returntype",void 0)],Pe.prototype,"loginFailure",null),Ze([(0,l.rc)(Nh),ae("design:type",Function),ae("design:paramtypes",[Object,Nh]),ae("design:returntype",void 0)],Pe.prototype,"logout",null),Ze([(0,l.rc)(e_),ae("design:type",Function),ae("design:paramtypes",[Object,e_]),ae("design:returntype",void 0)],Pe.prototype,"logoutSuccess",null),Ze([(0,l.rc)(Uh),ae("design:type",Function),ae("design:paramtypes",[Object,Uh]),ae("design:returntype",void 0)],Pe.prototype,"checkProfile",null),Ze([(0,l.rc)(r_),ae("design:type",Function),ae("design:paramtypes",[Object,r_]),ae("design:returntype",void 0)],Pe.prototype,"checkProfileSuccess",null),Ze([(0,l.rc)(n_),ae("design:type",Function),ae("design:paramtypes",[Object,n_]),ae("design:returntype",void 0)],Pe.prototype,"getGroupUserProfileAction",null),Ze([(0,l.rc)(i_),ae("design:type",Function),ae("design:paramtypes",[Object,i_]),ae("design:returntype",void 0)],Pe.prototype,"getGroupUserProfileSuccess",null),Ze([(0,l.rc)(o_),ae("design:type",Function),ae("design:paramtypes",[Object,o_]),ae("design:returntype",void 0)],Pe.prototype,"getUserProfile",null),Ze([(0,l.rc)(s_),ae("design:type",Function),ae("design:paramtypes",[Object,s_]),ae("design:returntype",void 0)],Pe.prototype,"getUserProfileSuccess",null),Ze([(0,l.rc)(a_),ae("design:type",Function),ae("design:paramtypes",[Object,a_]),ae("design:returntype",void 0)],Pe.prototype,"updateUserProfile",null),Ze([(0,l.rc)(Dh),ae("design:type",Function),ae("design:paramtypes",[Object,a_]),ae("design:returntype",void 0)],Pe.prototype,"updateUserProfileSuccess",null),Ze([(0,l.rc)(Lh),ae("design:type",Function),ae("design:paramtypes",[Object,Lh]),ae("design:returntype",void 0)],Pe.prototype,"deleteUserProfile",null),Ze([(0,l.rc)(Ol),ae("design:type",Function),ae("design:paramtypes",[Object,Ol]),ae("design:returntype",void 0)],Pe.prototype,"getUserRoles",null),Ze([(0,l.rc)(p_),ae("design:type",Function),ae("design:paramtypes",[Object,p_]),ae("design:returntype",void 0)],Pe.prototype,"getUserApps",null),Ze([(0,l.rc)(u_),ae("design:type",Function),ae("design:paramtypes",[Object,u_]),ae("design:returntype",void 0)],Pe.prototype,"setUserApps",null),Ze([(0,l.rc)(Pl),ae("design:type",Function),ae("design:paramtypes",[Object,Pl]),ae("design:returntype",void 0)],Pe.prototype,"setSelectedUserApp",null),Ze([(0,l.rc)(Il),ae("design:type",Function),ae("design:paramtypes",[Object,Il]),ae("design:returntype",void 0)],Pe.prototype,"checkSelectedUserApp",null),Ze([(0,l.rc)(Ml),ae("design:type",Function),ae("design:paramtypes",[Object,Ml]),ae("design:returntype",void 0)],Pe.prototype,"checkSession",null),Ze([(0,l.rc)(kh),ae("design:type",Function),ae("design:paramtypes",[Object,kh]),ae("design:returntype",void 0)],Pe.prototype,"getEnvironmentSettings",null),Ze([(0,l.rc)(t_),ae("design:type",Function),ae("design:paramtypes",[Object,t_]),ae("design:returntype",void 0)],Pe.prototype,"GetEnvironmentSettingsSuccess",null),Ze([(0,l.rc)(xh),ae("design:type",Function),ae("design:paramtypes",[Object,xh]),ae("design:returntype",void 0)],Pe.prototype,"resetPassword",null),Ze([(0,l.rc)(jh),ae("design:type",Function),ae("design:paramtypes",[Object,jh]),ae("design:returntype",void 0)],Pe.prototype,"transferFacebookAccount",null),Ze([(0,l.rc)(Fh),ae("design:type",Function),ae("design:paramtypes",[Object,Fh]),ae("design:returntype",void 0)],Pe.prototype,"updatePassword",null),Ze([(0,l.rc)(Gh),ae("design:type",Function),ae("design:paramtypes",[Object,Gh]),ae("design:returntype",void 0)],Pe.prototype,"signUp",null),Ze([(0,l.rc)(l_),ae("design:type",Function),ae("design:paramtypes",[Object,l_]),ae("design:returntype",void 0)],Pe.prototype,"signUpSuccess",null),Ze([(0,l.rc)(c_),ae("design:type",Function),ae("design:paramtypes",[Object,c_]),ae("design:returntype",void 0)],Pe.prototype,"signUpFailure",null),Ze([(0,l.rc)(d_),ae("design:type",Function),ae("design:paramtypes",[Object,d_]),ae("design:returntype",void 0)],Pe.prototype,"setUserLocale",null),Ze([(0,l.rc)(__),ae("design:type",Function),ae("design:paramtypes",[Object,__]),ae("design:returntype",void 0)],Pe.prototype,"setUserLocaleSuccess",null),Ze([(0,l.rc)(la),ae("design:type",Function),ae("design:paramtypes",[Object,la]),ae("design:returntype",void 0)],Pe.prototype,"checkLocale",null),Ze([(0,l.rc)($h),ae("design:type",Function),ae("design:paramtypes",[Object,$h]),ae("design:returntype",void 0)],Pe.prototype,"sendUserMessage",null),Ze([(0,l.rc)(Bh),ae("design:type",Function),ae("design:paramtypes",[Object,Bh]),ae("design:returntype",void 0)],Pe.prototype,"getUserMessage",null),Ze([(0,l.rc)(zh),ae("design:type",Function),ae("design:paramtypes",[Object,zh]),ae("design:returntype",void 0)],Pe.prototype,"setUserMessageViewed",null),Ze([(0,l.rc)(h_),ae("design:type",Function),ae("design:paramtypes",[Object,h_]),ae("design:returntype",void 0)],Pe.prototype,"resetAuth",null),Ze([(0,l.rc)(Wh),ae("design:type",Function),ae("design:paramtypes",[Object,Wh]),ae("design:returntype",void 0)],Pe.prototype,"requestVerificationCode",null),Ze([(0,l.rc)(Xh),ae("design:type",Function),ae("design:paramtypes",[Object,Xh]),ae("design:returntype",void 0)],Pe.prototype,"verifyProfile",null),Ze([(0,l.rc)(Hh),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe.prototype,"verifyProfileSuccess",null),Ze([(0,l.rc)(g_),ae("design:type",Function),ae("design:paramtypes",[Object,g_]),ae("design:returntype",void 0)],Pe.prototype,"verifyProfileFail",null),Ze([(0,l.rc)(Qh),ae("design:type",Function),ae("design:paramtypes",[Object,Qh]),ae("design:returntype",void 0)],Pe.prototype,"setContentView",null),Ze([(0,l.rc)(f_),ae("design:type",Function),ae("design:paramtypes",[Object,f_]),ae("design:returntype",void 0)],Pe.prototype,"checkContentViews",null),Ze([(0,l.rc)(Yh),ae("design:type",Function),ae("design:paramtypes",[Object,Yh]),ae("design:returntype",void 0)],Pe.prototype,"setDeveloperReferral",null),Ze([(0,l.rc)($0),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe.prototype,"getUserNotices",null),Ze([(0,l.rc)(Kh),ae("design:type",Function),ae("design:paramtypes",[Object,Kh]),ae("design:returntype",void 0)],Pe.prototype,"markUserNoticeAsSeen",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getLoggedIn",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Object)],Pe,"getLoggedInState",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getEnvironmentSettings",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Object)],Pe,"getProfile",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",S_)],Pe,"getUserProfile",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",class B1{})],Pe,"getGroupUserProfile",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",v_)],Pe,"getUserRole",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Array)],Pe,"getUserRoles",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",v_)],Pe,"getSystemDefaultRole",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",String)],Pe,"getUserType",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserSessionType",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Boolean)],Pe,"canInviteUsers",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Array)],Pe,"getUserAccountSettings",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Object)],Pe,"getAuth2",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",Object)],Pe,"getGooglePromptResult",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getProfileCheck",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getLoading",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getVerifyingProfile",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getProfileUpdating",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getProfileDeleting",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserLocale",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",String)],Pe,"getUserLanguage",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserApps",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getSelectedUserApp",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserFullName",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserEmail",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"isPrivateUser",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"isPremiumUser",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"isAdmin",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"isDeveloperReferral",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getContentViews",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getContentViewsReached",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"hasActiveDeveloperAccount",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"getUserNotices",null),Ze([(0,l.MD)(),ae("design:type",Function),ae("design:paramtypes",[Object]),ae("design:returntype",void 0)],Pe,"canStartFreeTrial",null),Pe=dr=Ze([(0,l.Uw)({name:"auth",defaults:W_}),ae("design:paramtypes",[_a,C_,It.n$,yg,Eg,ve,x_,De,f.Qq])],Pe);class Ht{}var Rs=function(n){return n.Enabled="enabled",n.Disabled="disabled",n.Locked="locked",n}(Rs||{});class $o{constructor(){this.background={colors:null},this.uiAnnotations=!1,this.uiAudio=!0,this.uiMedia=Bi.Full,this.uiInfo=!0,this.uiFullscreen=!0,this.uiScrubber=!1,this.uiHelp=!0,this.uiBd="",this.loadRotate=null,this.initial={button:!1,handHint:!1,play:!1,summary:!1},this.disableScroll={alert:!1,overlay:!1},this.uiQuiz={mode:Rs.Enabled,number:void 0},this.autoLoad=!0,this.playthrough=!1,this.uiTour=!1,this.uiNav=!0,this.uiSearch=!0,this.uiTools=!0,this.uiUndo=!0,this.uiLabelList=!0,this.uiChapterList=!1,this.all=!1,this.collapseLabel=null,this.uiMenu=!0,this.uiAnatomyDescriptions=!0,this.uiAnatomyPronunciations=!0,this.uiTutorial=!1,this.uiLegend=!0,this.uiLoader=Wd,this.uiWhiteboard=!0,this.uiVisibilityLayers=!0,this.uiSkinLayers=!0,this.uiAnatomyLabels=!0}}var go=d(3266),eo=function(n){return n.Responsive="responsive",n.Fixed="fixed",n}(eo||{});const Rg={title:"Desktop",type:"desktop",dimensions:{width:700,height:550},orientation:"vertical"},X_={title:"Standard Aspect Ratio (4:3)",type:"aspectRatio",dimensions:{width:4,height:3,type:eo.Responsive},orientation:"horizontal"},z1={title:"Widescreen Aspect Ratio (16:9)",type:"aspectRatio",dimensions:{width:16,height:9,type:eo.Responsive},orientation:"horizontal"},W1={title:"Square Aspect Ratio (1:1)",type:"aspectRatio",dimensions:{width:1,height:1,type:eo.Responsive},orientation:"horizontal"},Ng={...X_,title:"Custom"},X1=[X_,z1,W1];function Ll(n,i=300,t=2){return parseFloat((n/i).toFixed(t))}Ll(300),Ll(300),Ll(5120),Ll(2880);var H1=d(3287),J=d(60177),Q_=d(98020);const Y_=new e.nKC(""),K_=new e.nKC(""),Lg=z.c.deploy===pi.Z.Production?"https://human.biodigital.com":window.location.origin,Q1=z.c.deploy===pi.Z.Local?"https://localhost:4202":`${Lg}/viewer`;let Y1=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({providers:[{provide:Y_,useValue:Lg},{provide:K_,useValue:Q1}],imports:[l.rK.forFeature([Q_.X]),J.MD]})}return n})();var Ug=d(37678),K1=d.n(Ug),xg=d(81642),ui=d(95416),ua=function(n){return n.Single="share.widget.link",n.Bulk="share.widget.export",n}(ua||{});const jg={headers:new f.Lr({"Content-Type":"application/json; charset=utf-8"})},ha=new $o,q_={id:"embedded-human",dimensions:Rg.dimensions,fullScreen:!0};let Io=(()=>{class n{constructor(t,o,s,a,r,_,g,P){this.http=t,this.cameraService=o,this.numberService=s,this.orgnanizationService=a,this.contentViewService=r,this.matSnackbar=_,this.APP_BASE_URL=g,this.VIEWER_BASE_URL=P}exportBookmarks(t,o,s,a,r,_,g,P,F=!1,ee=""){this.matSnackbar.open(`Exporting ${t.length} models to CSV...`);const le=[{label:"Title",field:"title"},{label:"ID",field:"id"},{label:"Collection",field:"collection"},{label:"URL",field:"url"},{label:"iFrame",field:"iFrame"},{label:"Author",field:"author"},{label:"Thumbnail URL",field:"thumbnail_url"},{label:"Created Date",field:"create_date_time"},{label:"Updated Date",field:"update_date_time"}];F&&le.push({label:"Offline Package URL",field:"offline_url"});const he=P?(0,Rt.of)(null):this.getUAID(ua.Bulk),ue=F?this.getDownloadURLs(t):(0,Rt.of)([]),ye=new Map,Ge=s.length?(0,di.p)(s.map(Ve=>this.orgnanizationService.getCollectionContent(o,Ve.collection_id,"",g).pipe((0,W.T)(it=>{it.forEach(ot=>{ye.set(ot.id,Ve)})})))):(0,Rt.of)(!0);return(0,di.p)([he,ue,Ge]).pipe((0,W.T)(([Ve,it])=>t.map((ot,_t)=>{const{id:xt,title:$t,author:hn,thumbnail_url:rn,create_date_time:qe,update_date_time:en}=ot,Pt=ye.get(ot.id)?.collection_name??"",ti=this.getWidgetURL(ot,a,r,null,Ve,g,P,ee),tn=this.getWidgetEmbed(ti,_),ro=this.buildThumbnailURL(rn),Ka=it[_t]||"";return{title:$t,id:xt,collection:Pt,url:ti,iFrame:tn,author:hn,thumbnail_url:ro,create_date_time:(0,J.Yq)(new Date(qe),"shortDate","en"),update_date_time:(0,J.Yq)(new Date(en),"shortDate","en"),offline_url:Ka}})),(0,lo.n)(Ve=>(0,H1.H)(Ve,le)),(0,lo.n)(Ve=>{const ot=`BioDigital-Widgets-${(new Date).toISOString().split("T")[0]}-export.csv`,_t=new Blob([Ve],{type:"text/csv;charset=utf-8"});return K1()(_t,ot),(0,Rt.of)(!0)}))}generateWidgetURL(t,o,s,a,r,_,g,P){const F=g||!r?(0,Rt.of)(null):this.getUAID(r);return(0,di.p)([F,this.contentViewService.trackContentPublish(t.id,t.type)]).pipe((0,W.T)(([ee])=>this.getWidgetURL(t,o,s,a,ee,_,g,P)))}getWidgetURL(t,o,s,a,r,_="en",g,P){s=s||ha;const F="bookmark"===t.type,ee={};ee[F?"id":"m"]=`${F?t.id:t.module_name}`;const ue={...ee,...this.getParamsForUIOptions(s||ha),...this.getParamsForLoadingExperience(s||ha),...this.getParamsForScrollMode(s||ha),...this.getParamsForLoadRotate(s||ha),...this.getParamsForLabelScale(s||ha)},ye=(0,u.get)(s,"background.colors");if(Array.isArray(ye)&&ye.length>=3){const Ve=ye.slice(0,4).map(it=>this.numberService.roundNumber(it,3));ue["background.colors"]=`${Ve}`}if(a){const{eye:Ve,look:it,up:ot}=this.cameraService.roundCamera(a,3);ue.camera=`${[Ve.x,Ve.y,Ve.z,it.x,it.y,it.z,ot.x,ot.y,ot.z]}`}g?ue.dk=g.app_apikey:r&&(ue.uaid=r),_&&"en"!==_&&(ue.lang=_),P&&(ue.paid=P);const Ge=this.isCustomWidget(t.embed_url_path)?t.embed_url_path:o;return this.buildWidgetURL(Ge,ue)}generateWidgetEmbed(t,o,s,a,r,_,g,P,F){return this.generateWidgetURL(t,o,s,r,_,g,P,F).pipe((0,W.T)(ee=>this.getWidgetEmbed(ee,a)))}getWidgetEmbed(t,o){const{width:s,height:a,type:r}=o||q_.dimensions;let _="";return _=r===eo.Responsive?`style="aspect-ratio: ${s} / ${a}; width: 100%"`:`width="${s}" height="${a}"`,`<iframe id="${q_.id}" frameBorder="0" ${_} allowFullScreen="${q_.fullScreen}" loading="lazy" src="${t}"></iframe>`}getImageEmbed(t,o,s){const a=`BioDigital Human: ${t}`.replace(/"/g,"&quot;");return`<a href="${o}" target="_blank"><img src="${s}" alt="${a}" title="${a}" /></a>`}getUAID(t){return this.http.post("/ws/user/analytics",{analytic_type:`${t}`,analytic_platform:"app"},jg).pipe((0,W.T)(s=>s.id))}getDownloadURLs(t){const o=t.filter(s=>!s.favorite&&!s.unavailable).map(s=>({type:s.type,id:"module"===s.type?s.module_name:s.id}));return this.http.post("/ws/download/reserve",{content:o},{headers:{"Content-Type":"application/json"}}).pipe((0,W.T)(s=>{const a=s.tokens;return t.map(r=>{const _=r.type,g="module"===r.type?r.module_name:r.id,P=a.find(F=>F.type===_&&F.id===g);return P&&P.token?this.buildDownloadURL(P.token):""})}),(0,zi.W)(()=>(0,Rt.of)(t.map(()=>""))))}extendWidgetOptions(t,o){const s=this.expandWidgetOptions(o);return this.deepExtendWidgetOptions(t,s),t}getWidgetConfig(t){const o={};return Object.keys(t).forEach(a=>{const r=t[a];if(null!==r){const _=this.getConfigName(a);o[_]=r}}),o}getConfigName(t){const s=this.camelToDashCase(t).replace(/^ui-/g,"");return this.dashCaseToCamelCase(s)}getParamsForLoadingExperience(t){const o={};return t.autoLoad||(o["auto-load"]=!1),t.initial.button?o["initial.button"]=!0:t.initial.handHint?o["initial.hand"]=!0:t.initial.play?o["initial.play"]=!0:t.initial.summary?o["initial.summary"]=!0:o["initial.none"]=!0,t.playthrough&&(o.playthrough=!0),o}getParamsForScrollMode(t){return t.disableScroll.alert?{"disable-scroll.alert":!0}:t.disableScroll.overlay?{"disable-scroll":!0}:{"disable-scroll":!1}}getParamsForLoadRotate(t){return"number"==typeof t.loadRotate?{"load-rotate":t.loadRotate}:{}}getParamsForLabelScale(t){return{}}getParamsForUIOptions(t){return{"ui-anatomy-descriptions":t.uiAnatomyDescriptions,"ui-anatomy-pronunciations":t.uiAnatomyPronunciations,"ui-anatomy-labels":t.uiAnatomyLabels,"ui-audio":t.uiAudio,"ui-chapter-list":t.uiChapterList,"ui-fullscreen":t.uiFullscreen,"ui-help":t.uiHelp,"ui-info":t.uiInfo,"ui-label-list":t.uiLabelList,"ui-layers":t.uiVisibilityLayers,"ui-skin-layers":t.uiSkinLayers,"ui-loader":t.uiLoader,"ui-media-controls":t.uiMedia,"ui-menu":t.uiMenu,"ui-nav":t.uiNav,"ui-search":t.uiSearch,"ui-tools":t.uiTools,"ui-tutorial":t.uiTutorial,"ui-undo":t.uiUndo,"ui-whiteboard":t.uiWhiteboard,...this.getParamsForUIQuiz(t)}}getParamsForUIQuiz(t){const o={},s=(0,u.get)(t,"uiQuiz.mode"),a=(0,u.get)(t,"uiQuiz.number");return s===Rs.Disabled&&(o["ui-quiz"]=!1),s===Rs.Locked&&(o["ui-quiz-locked"]=!0),(0,u.isNil)(a)||(o["ui-quiz-start"]=a,o["ui-quiz-end"]=a),o}camelToDashCase(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}dashCaseToCamelCase(t){return t.replace(/-([a-z])/g,o=>o[1].toUpperCase())}isCustomWidget(t){return/widgets\/([^\/]+)\//.test(t)}saveUserImage(t,o="jpeg"){return this.http.post("/ws/user/image/v1-0",{image_src:t,image_type:o},jg).pipe((0,W.T)(s=>s.url))}buildWidgetURL(t,o){const s=Object.entries(o).map(([r,_])=>`${r}=${_}`).join("&");let a=t.replace(/^\/|\/$/g,"");return!1===o["auto-load"]&&"viewer"===a&&(a="tiny-viewer"),z.c.deploy===pi.Z.Local?`${this.VIEWER_BASE_URL}/?${s}`:`${this.APP_BASE_URL}/${a}/?${s}`}buildThumbnailURL(t){return`${this.APP_BASE_URL}${t}`}buildDownloadURL(t){return`${this.APP_BASE_URL}/download?t=${t}`}deepExtendWidgetOptions(t,o){Object.entries(t).forEach(([s,a])=>{const r=typeof a;[s,this.camelToDashCase(s),this.getConfigName(s)].forEach(g=>{if(o.hasOwnProperty(g)&&null!==o[g]){const P=o[g];null===a?t[s]=P:r===typeof P&&("object"===r?this.deepExtendWidgetOptions(a,P):t[s]=P)}})})}expandWidgetOptions(t){const o={};return Object.entries(t).forEach(([s,a])=>{const r=s.split(".");if(r.length>1){const _=r[0],g=r.slice(1).join(".");(null===o[_]||"object"!=typeof o[_])&&(o[_]={}),o[_][g]=a}else o[s]=t[s]}),o}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(go.j),e.KVO(xg.D),e.KVO(ce),e.KVO(x_),e.KVO(ui.UG),e.KVO(Y_),e.KVO(K_))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),J_=(()=>{class n{static#e=this.type="[Publish] Set Widget URL";constructor(t){this.widgetURL=t}}return n})(),Z_=(()=>{class n{static#e=this.type="[Publish] Set Dimensions";constructor(t){this.dimensions=t}}return n})(),ep=(()=>{class n{static#e=this.type="[Publish] Get iFrame";constructor(t,o,s,a){this.model=t,this.widgetOptions=o,this.camera=s,this.dimensions=a}}return n})(),Ul=(()=>{class n{static#e=this.type="[Publish] Get iFrame Success";constructor(t){this.embed=t}}return n})(),Vg=(()=>{class n{static#e=this.type="[Publish] Get iFrame Fail";constructor(){}}return n})(),tp=(()=>{class n{static#e=this.type="[Publish] Get URL";constructor(t,o,s){this.model=t,this.widgetOptions=o,this.camera=s}}return n})(),xl=(()=>{class n{static#e=this.type="[Publish] Get URL Success";constructor(t,o){this.model=t,this.url=o}}return n})(),np=(()=>{class n{static#e=this.type="[Publish] Get URL Fail";constructor(t){this.model=t}}return n})(),jl=(()=>{class n{static#e=this.type="[Publish] Set Publishing";constructor(t){this.publishing=t}}return n})(),Fg=(()=>{class n{static#e=this.type="[Publish] Reset Publishing";constructor(){}}return n})(),Gg=(()=>{class n{static#e=this.type="[Publish] Save Publish Image";constructor(t,o="jpeg"){this.imageData=t,this.imageType=o}}return n})(),ip=(()=>{class n{static#e=this.type="[Publish] Save Publish Image Success";constructor(t){this.imageURL=t}}return n})(),q1=(()=>{class n{static#e=this.type="[Publish] Save Publish Image Fail";constructor(){}}return n})(),$g=(()=>{class n{static#e=this.type="[Publish] Get Publish Image Code";constructor(t,o,s,a,r){this.model=t,this.imageData=o,this.fileType=s,this.widgetOptions=a,this.camera=r}}return n})(),J1=(()=>{class n{static#e=this.type="[Publish] Get Publish Image Code Success";constructor(t){this.embed=t}}return n})(),Z1=(()=>{class n{static#e=this.type="[Publish] Get Publish Image Code Fail";constructor(){}}return n})();var lt=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},_e=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const Bg={joinDomains:[],loading:!1,creating:!1,updating:!1,deleting:!1,loadingJoinDomains:!1,addingJoinDomains:!1,removingJoinDomains:!1,generatingGroupCode:!1,loadingCollections:!1,addingCollection:!1,reorderingCollections:!1,removingCollection:!1,updatingCollection:!1,isZSpaceAccount:!1,collectionRenaming:null};let We=class Cd{static getOrganizations(i){return i.organizations}static getOrganization(i){return i.organization}static getOrganizationLogo(i){return i.organization?.group_logos?.human_app?.default?.logo_url??""}static getSelectedOrganization(i){return i.selectedOrganization}static getSelectedOrganizationProductAccountId(i){return i.organization?.product_acctid||""}static getOrganizationProfile(i){return i.organizationProfile}static getOrganizationGroupAttributes(i){return i.organization?.group_attributes||[]}static getOrganizationAccountSettings(i){return function ev(n,i){return n.filter(t=>t.type===i).map(t=>{const{name:o,value:s}=t;return{[o]:{value:s}}})}(this.getOrganizationGroupAttributes(i),"account_settings")}static getDefaultUserRole(i,t){return this.getOrganizationGroupAttributes(i).find(s=>"default_user_role"===s.name).value??Pe.getSystemDefaultRole(t)}static getOrganizationGroupCode(i){return(0,u.get)(i,"organization.group_code","")}static getCollections(i){return i.collections}static getSelectedCollection(i){return i.selectedCollection}static getReorderingCollections(i){return i.reorderingCollections}static getAddingCollection(i){return i.addingCollection}static getRemovingCollection(i){return i.removingCollection}static getUpdatingCollection(i){return i.updatingCollection}static getCollectionRenaming(i){return i.collectionRenaming}static getGeneratingGroupCode(i){return i.generatingGroupCode}static getWidgetURL(i){return i.widgetURL}static getWidgetOptions(i){return i.widgetOptions}static getAppFeatures(i){return i.appFeatures}static getCreating(i){return i.creating}static getUpdating(i){return i.updating}static getDeleting(i){return i.deleting}static getLoading(i){return i.loading}static getCollectionsLoading(i){return i.loadingCollections}static getLoadingJoinDomains(i){return i.loadingJoinDomains}static getAddingJoinDomains(i){return i.addingJoinDomains}static getRemovingJoinDomains(i){return i.removingJoinDomains}static hasOrganization(i){return!(0,u.isNil)(i.organization)}static isTrial(i){return(0,u.get)(i,"organization.subscription.free_trial",!1)}static isSubscriptionExpired(i){return!0===(0,u.get)(i,"organization.subscription.expired",!1)}static getSubscriptionEndDate(i){const t=(0,u.get)(i,"organization.subscription.paid_through_date_time");return(0,u.isNil)(t)?void 0:new Date(t)}static getExternalAccount({organization:i}){return i?.external_account}static isValidPaidSubscription(i){return this.hasOrganization(i)&&!this.isTrial(i)&&!this.isSubscriptionExpired(i)}static getJoinDomains(i){return i.joinDomains}static isZSpaceAccount(i){return i.isZSpaceAccount}static getOrganizationAddOns(i){return i?.organization?.subscription?.addons}selectOrganization(i,t){const o=t.organization;i.patchState({selectedOrganization:o,selectedCollection:null}),o&&i.dispatch(new Nl(o.id))}setOrganizations(i,t){const o=t.organizations||[],s=o[0];let a,r=null,_={...i.getState().appFeatures};if(s&&s.group_attributes){const P=s.group_attributes,F=this.organizationsService.getOrganizationAttribute(P,"widget_settings","widget_custom_url_path");F&&F.value&&(a=F.value);const ee=this.organizationsService.getOrganizationAttribute(P,"widget_settings","widget_url_params");ee&&ee.value&&(r=this.publishService.extendWidgetOptions(new $o,ee.value));const le=this.organizationsService.getOrganizationAttribute(P,"app_settings","web_app_features");le&&(_={..._,...le.value})}i.patchState({organization:s,organizations:o,widgetURL:a,widgetOptions:r,appFeatures:_,isZSpaceAccount:s.external_account.external_account_provider===Ei.a.Zspace}),i.dispatch(new J_(a)),s&&this.vendorAnalyticsService.updateAccountData(s)}getCollections(i,t){i.patchState({loadingCollections:!0}),this.organizationsService.getCollections({group_id:t.organizationId}).pipe((0,Ot.j)(()=>i.patchState({loadingCollections:!1}))).subscribe(o=>{i.dispatch(new T_(o))})}getCollectionsSuccess(i,t){i.patchState({collections:t.collections})}selectCollection(i,t){const{organization:o,selectedOrganization:s}=i.getState();i.patchState({selectedOrganization:s||o,selectedCollection:t.collection})}addCollection(i,t){i.patchState({addingCollection:!0}),this.organizationsService.addCollection(t.organizationId,t.collectionName).pipe((0,Ot.j)(()=>{i.patchState({addingCollection:!1})})).subscribe(()=>{i.dispatch(new O_(t.organizationId,t.collectionName))},o=>{i.dispatch(new M_(o))})}addCollectionSuccess(i,t){this.vendorAnalyticsService.track("Add Collection - Success",{platform:this.productService.productType})}addCollectionError(i,t){this.vendorAnalyticsService.track("Add Collection - Failure",{error:(0,u.get)(t,"error.error.error.message")||"There was an error with collection creation."})}removeCollection(i,t){i.patchState({removingCollection:!0}),this.organizationsService.removeCollection(t.collection).pipe((0,Ot.j)(()=>{i.patchState({removingCollection:!1})})).subscribe(()=>{i.dispatch(new I_(t.collection))},o=>{i.dispatch(new P_(o))})}removeCollectionSuccess(i,t){this.vendorAnalyticsService.track("Remove Collection - Success",{platform:this.productService.productType})}removeCollectionError(i,t){this.vendorAnalyticsService.track("Remove Collection - Failure",{error:(0,u.get)(t,"error.error.error.message")||"There was an error with collection removal."})}setCollectionRenameMode(i,t){i.patchState({collectionRenaming:t.collection})}renameCollection(i,t){i.patchState({updatingCollection:!0}),this.organizationsService.renameCollection(t.collection,t.collectionName).pipe((0,Ot.j)(()=>{i.patchState({updatingCollection:!1})})).subscribe(()=>{i.dispatch(new w_(t.collection,t.collectionName))},o=>{i.dispatch(new A_(o))})}renameCollectionSuccess(i,t){this.vendorAnalyticsService.track("Rename Collection - Success",{platform:this.productService.productType})}renameCollectionError(i,t){this.vendorAnalyticsService.track("Rename Collection - Failure",{error:(0,u.get)(t,"error.error.error.message")||"There was an error with collection renaming."})}reorderCollections(i,t){i.patchState({reorderingCollections:!0}),this.organizationsService.reorderCollections(t.organizationId,t.collections).pipe((0,Ot.j)(()=>{i.patchState({reorderingCollections:!1})})).subscribe(()=>{i.dispatch(new R_(t.organizationId,t.collections))},o=>{i.dispatch(new c1(o))})}reorderCollectionsSuccess(i,t){i.patchState({collections:[...t.collections]})}resetOrganizations(i,t){i.setState(Bg)}createOrganization(i,{organization:t}){i.patchState({creating:!0}),this.organizationsService.createOrganization(t).pipe((0,Ot.j)(()=>i.patchState({creating:!1}))).subscribe(()=>i.dispatch(new cg),o=>i.dispatch(new k_(o)))}createOrganizationSuccess(i){this.vendorAnalyticsService.track("Team Creation - Success",{platform:this.productService.productType})}createOrganizationFail(i,t){this.vendorAnalyticsService.track("Team Creation - Failure",{error:(0,u.get)(t,"error.error.error.message")||"There was an error with team creation."})}updateOrganization(i,{organization:t}){i.patchState({updating:!0}),this.organizationsService.updateOrganization(t).pipe((0,Ot.j)(()=>i.patchState({updating:!1}))).subscribe(()=>i.dispatch(new d1),o=>i.dispatch(new _1(o)))}deleteOrganization(i,{organization:t}){i.patchState({deleting:!0}),this.organizationsService.deleteOrganization(t.id).pipe((0,Ot.j)(()=>i.patchState({deleting:!1}))).subscribe({next:()=>i.dispatch(new p1(t)),error:o=>i.dispatch(new u1(o))})}getOrganizationProfile(i,{request:t}){i.patchState({loading:!0}),this.organizationsService.getPublicProfile(t).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>i.dispatch(new D_(o)),o=>i.dispatch(new h1(o)))}getOrganizationProfileSuccess(i,{organizationProfile:t}){i.patchState({organizationProfile:t})}clearOrganizationProfile(i,t){i.patchState({organizationProfile:void 0})}getJoinDomains(i,t){i.patchState({loadingJoinDomains:!0}),this.organizationsService.getJoinDomains(t.params).pipe((0,Ot.j)(()=>i.patchState({loadingJoinDomains:!1}))).subscribe(o=>{i.dispatch(new L_(o.email_domains))})}getJoinDomainsSuccess(i,{joinDomains:t}){i.patchState({joinDomains:t})}postJoinDomains(i,t){i.patchState({addingJoinDomains:!0}),this.organizationsService.postJoinDomains(t.emailDomains).pipe((0,Ot.j)(()=>i.patchState({addingJoinDomains:!1}))).subscribe({next:()=>{i.dispatch(new g1(t.emailDomains))},error:o=>{i.dispatch(new m1(o))}})}deleteJoinDomains(i,t){i.patchState({removingJoinDomains:!0}),this.organizationsService.deleteJoinDomains(t.joinDomainIds).pipe((0,Ot.j)(()=>i.patchState({removingJoinDomains:!1}))).subscribe({next:()=>{i.dispatch(new f1(t.joinDomainIds))},error:o=>{i.dispatch(new S1(o))}})}generateGroupCode(i,t){i.patchState({generatingGroupCode:!0}),this.organizationsService.generateGroupCode(t.groupId).pipe((0,Ot.j)(()=>i.patchState({generatingGroupCode:!1}))).subscribe({next:o=>i.dispatch(new U_(o.group_code)),error:o=>i.dispatch(new b1(o))})}generateGroupCodeSuccess(i,t){const o={...i.getState().organization,group_code:t.groupCode};i.patchState({organization:o})}constructor(i,t,o,s){this.organizationsService=i,this.publishService=t,this.vendorAnalyticsService=o,this.productService=s}static#e=this.\u0275fac=function(t){return new(t||Cd)(e.KVO(ce),e.KVO(Io),e.KVO(ve),e.KVO(De))};static#t=this.\u0275prov=e.jDH({token:Cd,factory:Cd.\u0275fac})};lt([(0,l.rc)(tg),_e("design:type",Function),_e("design:paramtypes",[Object,tg]),_e("design:returntype",void 0)],We.prototype,"selectOrganization",null),lt([(0,l.rc)(Rl),_e("design:type",Function),_e("design:paramtypes",[Object,Rl]),_e("design:returntype",void 0)],We.prototype,"setOrganizations",null),lt([(0,l.rc)(Nl),_e("design:type",Function),_e("design:paramtypes",[Object,Nl]),_e("design:returntype",void 0)],We.prototype,"getCollections",null),lt([(0,l.rc)(T_),_e("design:type",Function),_e("design:paramtypes",[Object,T_]),_e("design:returntype",void 0)],We.prototype,"getCollectionsSuccess",null),lt([(0,l.rc)(ng),_e("design:type",Function),_e("design:paramtypes",[Object,ng]),_e("design:returntype",void 0)],We.prototype,"selectCollection",null),lt([(0,l.rc)(ig),_e("design:type",Function),_e("design:paramtypes",[Object,ig]),_e("design:returntype",void 0)],We.prototype,"addCollection",null),lt([(0,l.rc)(O_),_e("design:type",Function),_e("design:paramtypes",[Object,O_]),_e("design:returntype",void 0)],We.prototype,"addCollectionSuccess",null),lt([(0,l.rc)(M_),_e("design:type",Function),_e("design:paramtypes",[Object,M_]),_e("design:returntype",void 0)],We.prototype,"addCollectionError",null),lt([(0,l.rc)(og),_e("design:type",Function),_e("design:paramtypes",[Object,og]),_e("design:returntype",void 0)],We.prototype,"removeCollection",null),lt([(0,l.rc)(I_),_e("design:type",Function),_e("design:paramtypes",[Object,I_]),_e("design:returntype",void 0)],We.prototype,"removeCollectionSuccess",null),lt([(0,l.rc)(P_),_e("design:type",Function),_e("design:paramtypes",[Object,P_]),_e("design:returntype",void 0)],We.prototype,"removeCollectionError",null),lt([(0,l.rc)(sg),_e("design:type",Function),_e("design:paramtypes",[Object,sg]),_e("design:returntype",void 0)],We.prototype,"setCollectionRenameMode",null),lt([(0,l.rc)(ag),_e("design:type",Function),_e("design:paramtypes",[Object,ag]),_e("design:returntype",void 0)],We.prototype,"renameCollection",null),lt([(0,l.rc)(w_),_e("design:type",Function),_e("design:paramtypes",[Object,w_]),_e("design:returntype",void 0)],We.prototype,"renameCollectionSuccess",null),lt([(0,l.rc)(A_),_e("design:type",Function),_e("design:paramtypes",[Object,A_]),_e("design:returntype",void 0)],We.prototype,"renameCollectionError",null),lt([(0,l.rc)(rg),_e("design:type",Function),_e("design:paramtypes",[Object,rg]),_e("design:returntype",void 0)],We.prototype,"reorderCollections",null),lt([(0,l.rc)(R_),_e("design:type",Function),_e("design:paramtypes",[Object,R_]),_e("design:returntype",void 0)],We.prototype,"reorderCollectionsSuccess",null),lt([(0,l.rc)(N_),_e("design:type",Function),_e("design:paramtypes",[Object,N_]),_e("design:returntype",void 0)],We.prototype,"resetOrganizations",null),lt([(0,l.rc)(lg),_e("design:type",Function),_e("design:paramtypes",[Object,lg]),_e("design:returntype",void 0)],We.prototype,"createOrganization",null),lt([(0,l.rc)(cg),_e("design:type",Function),_e("design:paramtypes",[Object]),_e("design:returntype",void 0)],We.prototype,"createOrganizationSuccess",null),lt([(0,l.rc)(k_),_e("design:type",Function),_e("design:paramtypes",[Object,k_]),_e("design:returntype",void 0)],We.prototype,"createOrganizationFail",null),lt([(0,l.rc)(dg),_e("design:type",Function),_e("design:paramtypes",[Object,dg]),_e("design:returntype",void 0)],We.prototype,"updateOrganization",null),lt([(0,l.rc)(_g),_e("design:type",Function),_e("design:paramtypes",[Object,_g]),_e("design:returntype",void 0)],We.prototype,"deleteOrganization",null),lt([(0,l.rc)(pg),_e("design:type",Function),_e("design:paramtypes",[Object,pg]),_e("design:returntype",void 0)],We.prototype,"getOrganizationProfile",null),lt([(0,l.rc)(D_),_e("design:type",Function),_e("design:paramtypes",[Object,D_]),_e("design:returntype",void 0)],We.prototype,"getOrganizationProfileSuccess",null),lt([(0,l.rc)(ug),_e("design:type",Function),_e("design:paramtypes",[Object,ug]),_e("design:returntype",void 0)],We.prototype,"clearOrganizationProfile",null),lt([(0,l.rc)(hg),_e("design:type",Function),_e("design:paramtypes",[Object,hg]),_e("design:returntype",void 0)],We.prototype,"getJoinDomains",null),lt([(0,l.rc)(L_),_e("design:type",Function),_e("design:paramtypes",[Object,L_]),_e("design:returntype",void 0)],We.prototype,"getJoinDomainsSuccess",null),lt([(0,l.rc)(gg),_e("design:type",Function),_e("design:paramtypes",[Object,gg]),_e("design:returntype",void 0)],We.prototype,"postJoinDomains",null),lt([(0,l.rc)(mg),_e("design:type",Function),_e("design:paramtypes",[Object,mg]),_e("design:returntype",void 0)],We.prototype,"deleteJoinDomains",null),lt([(0,l.rc)(fg),_e("design:type",Function),_e("design:paramtypes",[Object,fg]),_e("design:returntype",void 0)],We.prototype,"generateGroupCode",null),lt([(0,l.rc)(U_),_e("design:type",Function),_e("design:paramtypes",[Object,U_]),_e("design:returntype",void 0)],We.prototype,"generateGroupCodeSuccess",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getOrganizations",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getOrganization",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",String)],We,"getOrganizationLogo",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getSelectedOrganization",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",String)],We,"getSelectedOrganizationProductAccountId",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getOrganizationProfile",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getOrganizationGroupAttributes",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",Array)],We,"getOrganizationAccountSettings",null),lt([(0,l.MD)([We,Pe]),_e("design:type",Function),_e("design:paramtypes",[Ht,Object]),_e("design:returntype",void 0)],We,"getDefaultUserRole",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getOrganizationGroupCode",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getCollections",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getSelectedCollection",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getReorderingCollections",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getAddingCollection",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getRemovingCollection",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getUpdatingCollection",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getCollectionRenaming",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getGeneratingGroupCode",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getWidgetURL",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getWidgetOptions",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getAppFeatures",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getCreating",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getUpdating",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getDeleting",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getLoading",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getCollectionsLoading",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getLoadingJoinDomains",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getAddingJoinDomains",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getRemovingJoinDomains",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"hasOrganization",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"isTrial",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"isSubscriptionExpired",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getSubscriptionEndDate",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",Object)],We,"getExternalAccount",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"isValidPaidSubscription",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"getJoinDomains",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",void 0)],We,"isZSpaceAccount",null),lt([(0,l.MD)(),_e("design:type",Function),_e("design:paramtypes",[Ht]),_e("design:returntype",Object)],We,"getOrganizationAddOns",null),We=lt([(0,l.Uw)({name:"organizations",defaults:Bg}),_e("design:paramtypes",[ce,Io,ve,De])],We);var op=d(66432);const ga=1e4,sp="/ws/user/bookmark/v4",_r={headers:new f.Lr({"Content-Type":"application/json; charset=utf-8"})};let Bo=(()=>{class n{constructor(t,o,s,a,r){this.store=t,this.http=o,this.storyService=s,this.productService=a,this.storageService=r}getBookmarkModel(t){return this.http.get(`/ws/search/bookmarks?eid=${t}`).pipe((0,qd.l)(o=>o.pipe((0,ws.c)(1e3),(0,qt.s)(3))),(0,W.T)(o=>(0,b.bj)(Te,o.bookmark_info)),(0,W.T)(o=>Qe(o)))}getUserBookmarks(t,o="",s=ga,a,r){const _={q:o,page_size:`${s}`,ol:a};return(0,u.isNil)(r)||(_.is_owner=""+(r?1:0)),this.http.get(`/ws/search/bookmarks/${t}`,{params:_}).pipe((0,qd.l)(g=>g.pipe((0,ws.c)(1e3),(0,qt.s)(3))),(0,W.T)(g=>g.results.map(P=>(0,b.bj)(Te,P)).map(P=>Qe(P))))}getUserConditions(t,o="",s,a,r=ga){let _="";switch(t){case os.Private:_="user";break;case os.Group:_="group"}return this.http.get(`/ws/search/conditions/private?q=${o}&page_size=${r}&ol=${s}`).pipe((0,W.T)(g=>g.results.filter(P=>P.module_accessor_level===_&&(!a||P.module_accessor_id===a))),(0,W.T)(g=>g.map(P=>Qe(P))))}getPrivateBookmarks(t="",o,s=ga){return this.getUserBookmarks(os.Private,t,s,o,!0)}getPrivateConditions(t="",o){return this.getUserConditions(os.Private,t,o)}getOrganizationBookmarks(t,o="",s=ga,a){return this.getUserBookmarks(os.Private,o,s,a).pipe((0,W.T)(r=>r.filter(_=>_.tags.includes("enterprise")).filter(_=>_.group_access.some(g=>g.group_id===t))))}getOrganizationConditions(t,o="",s){return this.getUserConditions(os.Group,o,s,t)}getOrganizationContent(t,o="",s){return(0,di.p)([this.getOrganizationBookmarks(t,o,ga,s),this.getOrganizationConditions(t,o,s)]).pipe((0,W.T)(([a,r])=>[...a,...r]))}getPrivateContent(t="",o){return(0,di.p)([this.getPrivateBookmarks(t,o),this.getPrivateConditions(t,o)]).pipe((0,W.T)(([s,a])=>[...s,...a]))}getPublicBookmarks(t="",o){return this.getUserBookmarks(os.Public,t,ga,o)}saveBookmark(t){const o=this.getNormalizedBookmarkEntry(t);let s;return s=this.http.post(t.id?`${sp}/update`:`${sp}/save`,o,_r),s.pipe((0,ra.q)(a=>this.getBookmarkModel(a.id)))}bulkCopyBookmarks(t){const{productType:o,productKey:s}=this.productService;return this.http.post("/ws/user/bookmark/bulk/copy",{version:1,app_producttype:o,app_productkey:s,source_content:t},_r)}getBookmarkJobs(t={}){const{productType:o,productKey:s}=this.productService;return this.http.get("/ws/user/jobs",{params:{version:1,app_producttype:o,app_productkey:s,...t}}).pipe((0,W.T)(a=>a?.jobs??[]))}cancelBookmarkJob(t){const{productType:o,productKey:s}=this.productService;return this.http.post("/ws/user/jobs/cancel",{version:1,app_producttype:o,app_productkey:s,job_id:t},_r)}deleteBookmark(t){return this.http.delete(`${sp}/delete`,{params:{eid:t,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}).pipe((0,zi.W)(a=>{const r=ss(a);return(0,Ih.$)(()=>r)}))}bulkDeleteBookmarks(t){const{productType:o,productKey:s}=this.productService;return this.http.post("/ws/user/bookmark/bulk/delete",{version:1,app_producttype:o,app_productkey:s,eids:t},_r)}atMaxFreeBookmarkCount(){return this.http.get("/ws/user/content/limit/check?version=2").pipe((0,zi.W)(t=>(0,Rt.of)({limit_reached:!1})))}filterByTags(t,o,s=!1){return t.filter(a=>s?o.every(r=>a.tags.includes(r)):o.some(r=>a.tags.includes(r)))}getTags(t){if(t){const o=[],a=j_(this.store.selectSnapshot(Pe.getUserRole),t),r=t.type===Se.c.Bookmark&&!a;return this.isZSpaceModel(t)&&o.push(Zi.n3[Ei.a.Zspace]),r&&o.push("View Only"),t.animated&&o.push("Animated"),t.tour&&o.push("Tour"),t.quiz&&o.push("Quiz"),o}return[]}getCategories(t,o="en",s){const a=null!=s?(0,u.flatten)(s.map(_=>(0,op.e7)(_,o))):(0,op.QU)(o),r=[];return t.type===Se.c.Module?(t.tags.forEach(_=>{const g=a.find(P=>P.id===_);g&&r.push(g)}),r):null}isZSpaceModel(t){return!!(0,u.isArray)(t.tags)&&t.tags.includes(Ei.a.Zspace)}getZSpaceRestriction(){return z.c.application===xn.c.Loft?Ei.O.None:!this.store.selectSnapshot(We.hasOrganization)||this.store.selectSnapshot(We.isSubscriptionExpired)?Ei.O.Subscription:"true"!==this.storageService.getLocalItem(It.UT.ZSpaceDevice)?Ei.O.Device:Ei.O.None}getShowcase(t,o,s="en"){const a=[];if(!(0,u.isNil)(t)&&t.type===$_.P.User){const r=this.getUserShowcase(s);a.push(r)}if(!(0,u.isNil)(o)){const r=this.getOrganizationShowcase(o,s);a.push(r)}return a.length?(0,di.p)(a):(0,Rt.of)([])}getUserShowcase(t="en"){return this.getPrivateBookmarks("",t,10).pipe((0,W.T)(o=>this.createPrivateShowcase(o)))}getOrganizationShowcase(t,o="en"){return this.getOrganizationBookmarks(t.id,"",10,o).pipe((0,W.T)(s=>this.createOrganizationShowcase(s,t)))}createMockBookmark(t){return{author:"",author_first_name:"",author_last_name:"",cost:0,create_date_time:new Date,description:"",id:"",is_owner:!0,last_editor:"",last_editor_first_name:"",last_editor_last_name:"",tags:[],thumbnail_url:"",title:"",update_date_time:new Date,type:Se.c.Bookmark,...t?{animated:!0,tour:!0}:{}}}createMockBookmarks(t=5){return[...Array(t).keys()].map(o=>this.createMockBookmark(o%2==0))}getOrganizationBookmarkGroup(t,o){let s;return o&&t.group_access&&(s=t.group_access.find(a=>a.group_id===o.id)),s}createPrivateShowcase(t){return{title:"Pick up where you left off",description:"",url:"/results/bookmarks?type=Private",bookmarks:t}}createOrganizationShowcase(t,o){return{title:`Recently added to ${o.name}`,description:"Recently added models to your Team library.",url:`/results/bookmarks?organizationId=${o.id}&type=Organization`,bookmarks:t}}translateBookmark(t,o,s,a){const r=s===Se.c.Module||s===Se.c.Internal?o.replace(".json",""):o;return(0,di.p)([this.storyService.getStory(t,Se.c.Bookmark),this.storyService.getStoryTranslation(r,s,a)]).pipe((0,W.T)(([_,g])=>this.storyService.translateStory(_,g)),(0,ra.q)(_=>this.saveBookmark({isOwner:!0,title:_.displayName.substr(0,60),id:t,index:_})),(0,W.T)(_=>_.id),(0,zi.W)(_=>404===_.status?(0,Rt.of)(t):(0,Ih.$)(_)))}getNormalizedBookmarkEntry(t){let o,s,a,r;if(t.isOwner){if(o=t.add_group_access?this.getGroupAccess(t.add_group_access):[],t.remove_group_access&&t.remove_group_access.forEach(_=>{const g=this.getNormalizeGroupAccess({group_id:_.group_id,remove:!0});o.push(g)}),s=this.getNormalizedBool(t.public_access),t.index){a={},t.index.chapters&&(a[As.UserGeneratedTour]=this.getNormalizedBool(t.index.chapters.length>1));const _=(t.index.tags||[]).includes("animated");a[As.Animated]=this.getNormalizedBool(_),a[As.ModeQuiz]=this.getNormalizedBool(t.viewMode===we.Quiz),a[As.ModeContent]=this.getNormalizedBool(t.viewMode===we.Content),a[As.Quiz]=this.getNormalizedBool(t.index?.quizSettings?.enabled??!1)}r=this.getNormalizedBool(t.is_content_copy)}return{eid:t.id,name:t.title,description:t.description,index:t.index,group_access:o,public_access:s,flags:a,is_content_copy:r,app_producttype:this.productService.productType,app_productkey:this.productService.productKey}}getGroupAccess(t){return t.map(o=>this.getNormalizeGroupAccess(o))}getNormalizeGroupAccess(t){const{group_id:o,group_name:s,member_edit:a,visible:r,remove:_}=t;return{group_id:o,group_name:s,member_edit:this.getNormalizedBool(a),visibility:this.getNormalizedBool(r),remove:this.getNormalizedBool(_)}}getNormalizedBool(t){return!0===t?"1":!1===t?"0":""}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(f.Qq),e.KVO(Pi.J),e.KVO(De),e.KVO(It.n$))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const zg={label:"Relevance",fields:[],ascending:!0},Vl={label:"Most Recent",fields:["collection_content_createdate","update_date_time","create_date_time"],ascending:!1},pr={label:"Title (A-Z)",fields:["title"],ascending:!0},Fl={label:"Title (Z-A)",fields:["title"],ascending:!1},Wg={label:"Author (A-Z)",fields:["author"],ascending:!0},Xg={label:"Author (Z-A)",fields:["author"],ascending:!1};var kn=function(n){return n.Organization="Organization",n.Collection="Collection",n.Private="Private",n.Category="Category",n.Community="Community",n.Internal="Internal",n.Loft="Loft",n}(kn||{});const tv=`/results/modules?categoryId=${Ei.a.Zspace}&type=Category`;class nv{constructor(i,t=[],o=""){this.categoryId=i,this.tags=t,this.query=o,this.type=kn.Category}}class iv{constructor(i="",t=[]){this.query=i,this.tags=t,this.categoryId="public",this.type=kn.Community}}const ov=["live"];let Gl=(()=>{class n{constructor(t){this.http=t}searchInternal(t="",o=""){return this.http.get(`/ws/search/internal?k=${t}&dir=${o}`).pipe((0,W.T)(s=>this.normalizeBookmarks(s.results)))}getAnatomyCategory(t,o,s=[],a=!1,r="en"){return this.search(t,[o,...s],a,r)}getConditionModel(t){if(z.c.offline)return(0,Rt.of)(null);const o=this.toDatabaseContentId(t);return this.http.get(`/search/conditions?q=${o}`).pipe((0,qd.l)(s=>s.pipe((0,ws.c)(1e3),(0,qt.s)(3))),(0,W.T)(s=>this.normalizeBookmarks(s.results)),(0,W.T)(s=>s[0]))}getShowcase(t){return this.http.get(`/ws/product/app/settings/homepage-showcase?ol=${t}`).pipe((0,W.T)(o=>o.results.map(a=>(a.bookmarks=this.normalizeBookmarks(a.bookmarks),a))))}getZSpaceShowcase(){return this.getAnatomyCategory("",Ei.a.Zspace,[],!0).pipe((0,W.T)(t=>({title:"zSpace Models",description:" ",url:tv,bookmarks:t})))}createMockShowcase(t){return{title:" ",description:" ",url:"",bookmarks:[...t],loading:!0}}createMockShowcases(t,o){return[...Array(t).keys()].map(()=>this.createMockShowcase(o))}search(t="",o,s,a){const r=t.split(/[ ]+/).join("+"),_=ov.concat(o).filter(g=>""!==g&&null!=g).map(g=>`"${g}"`).join("+");return this.http.get(`/search/ai?k=${r}&t=${_}&zspace=${s}&il=${a}&ol=${a}&odns=true`).pipe((0,W.T)(g=>this.normalizeBookmarks(g.results)))}normalizeBookmarks(t){return t.map(o=>Qe(o))}getStoryCategory(t){if(!t.tags)return null;const o=(0,op.QU)().map(s=>s.id.toLocaleLowerCase());return t.tags.find(s=>o.includes(s.toLocaleLowerCase()))}toAppContentId(t){return t.replace("Condition.content.","").replace(".json","").split(".").join("/")}toDatabaseContentId(t){return t.match("Condition.content")?t:`Condition.content.${t.replace(".json","").split("/").join(".")}.json`}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Hg(n,i,t){const o=i.map(s=>n[s]).filter(s=>!(0,u.isNil)(s));return t?o.sort().shift():o.sort().pop()}function ap(n,i,t){if(0===i.length)return n;const o=new Intl.Collator("en-US",{sensitivity:"base"});return n.sort((s,a)=>{const r=Hg(s,i,t)||"",_=Hg(a,i,t)||"";return(t?1:-1)*o.compare(r.toString(),_.toString())})}function Qg(n,i,t){return 0===n.sortBy.fields.length&&""===i?.query&&i?.type===kn.Category&&"regional"===i?.categoryId?[...t.filter(s=>!s.tags.includes("Guided Anatomy")),...t.filter(s=>s.tags.includes("Guided Anatomy"))]:[...t]}class sv{}let $l=(()=>{class n{constructor(t){this.http=t}generateFreshChapterImages(t,o,s=!1){const a=[];return t.forEach(r=>{const _=Fo.getChapterThumbnail(r,o);(_.legacy||s)&&a.push(Fo.makeFreshThumbnail(_.storyId,_.chapterId,_.urls.large))}),a.length?(0,di.p)(a):(0,Rt.of)([])}saveChapterThumbnails(t,o,s){return t.reduce((r,_)=>{const F=o.get(s[_.id]),ee=(0,u.get)(F,"snapshot");return ee&&r.push(this.saveNewChapterImage(_.id,ee)),r},[])}saveNewChapterImage(t,o){return new h.c(s=>{th(o).pipe((0,lo.n)(a=>this.saveImageBlob(a)),(0,W.T)(a=>({chapterId:t,...a}))).subscribe(a=>{s.next(a),s.complete()},()=>{s.next(null),s.complete()})})}getIndexThumbnail(t,o="large"){return`${typeof localBaseDirectory>"u"?"":localBaseDirectory}thumbs/modules/${t}/${o}/index.jpg`}saveImageBlob(t){const s=new File([t],"image.jpg",{type:"image/jpeg"}),a=new FormData;return a.append("file",s),this.http.post("/ws/media/images/upload",a)}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var av=d(11113),Ci=d(40215),wt=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Me=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function Yg(n,i,t,o,s,a){return a?(0,Vd.H)(t.getDatabaseItem(It.AJ.PreviewBookmark)):s===Se.c.Bookmark?n.getBookmarkModel(o):i.getConditionModel(o)}const Kg={loading:!0,exporting:!1,copying:!1,saving:!1,bookmarks:[],selectedBookmark:null,sort:Vl,checkedBookmarks:[],selectedCategory:null,bookmarkJobs:[]};let ft=class Td{static getBookmarks(i){const{bookmarks:t,sort:o}=i,{ascending:s,fields:a}=o;return ap(t,a,s)}static getCheckedBookmarks(i){return i.checkedBookmarks}static getSelectedBookmark(i){return i.selectedBookmark}static getSelectedBookmarkViewMode(i){return i.selectedBookmark?i.selectedBookmark.viewMode:we.All}static getLoading(i){return i.loading}static getExporting(i){return i.exporting}static getSaving(i){return i.saving}static getCopying(i){return i.copying}static getSort(i){return i.sort}static getSelectedCategory(i){return i.selectedCategory}static getBookmarkJobs(i){return i.bookmarkJobs}static getActiveBookmarkJob(i){const t=["aborted","complete","error"];return i.bookmarkJobs.find(o=>!t.includes(o.job_status))}loadBookmarks(i,t){i.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),(0,di.p)(this.bookmarksService.getPrivateBookmarks(t.query,t.lang),this.bookmarksService.getPrivateConditions(t.query,t.lang)).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(([o,s])=>{i.dispatch(new Ie.zX([...o,...s]))})}loadOrganizationBookmarks(i,{organizationId:t,query:o,lang:s}){i.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.bookmarksService.getOrganizationContent(t,o,s).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(a=>{i.dispatch(new Ie.zX(a))})}loadCollectionBookmarks(i,t){i.patchState({loading:!0,bookmarks:[],checkedBookmarks:[]}),this.organizationsService.getCollectionContent(t.organizationId,t.collectionId,t.query,t.lang).pipe((0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(o=>{i.dispatch(new Ie.zX(o))})}loadSuccess({patchState:i},t){i({bookmarks:t.result})}selectBookmark(i,t){const{id:o,type:s,preview:a}=t;Yg(this.bookmarksService,this.exploreService,this.storageService,o,s,a).subscribe(_=>{i.dispatch(new Ie.sN(_))})}selectBookmarkSuccess(i,t){let{bookmark:o}=t;o&&(o=Qe(o)),i.patchState({selectedBookmark:o})}saveBookmark(i,t){var o=this;return(0,pt.A)(function*(){i.patchState({saving:!0});const s=t.bookmarkEntry,a=s.id?"update":"save",r=o.store.selectSnapshot(me.N.getStoryChapters),_="save"===a,g=(0,jd.S)(r,_);let P;_&&(yield(0,Ci._)(o.store.dispatch(new yn.u.UpdateTweenParticleLookupChapters(g)))),P=t.serializeScene?o.serializeModuleService.serialize({},new ch,!1,o.store.selectSnapshot(dt.getStory),o.store.selectSnapshot(me.N.getStoryChapters),g,t.includeCameraPositions).story:yield(0,Ci._)(o.storyService.getStory(s.id,Se.c.Bookmark)),"save"===a&&o.storyService.addContentRecord(o.store.selectSnapshot(dt.getStoryId),P),P.displayName=s.title,s.index=P;let F=(0,Rt.of)([]);if(t.serializeScene){const ee=o.store.selectSnapshot(Go.K.getRegisteredThumbnails),le=o.imagesService.saveChapterThumbnails(s.index.chapters,ee,(0,u.invert)(g));le.length&&(F=(0,di.p)(le))}F.pipe((0,Ln.Z)(ee=>{const le=o.store.selectSnapshot(Go.K.getRegisteredThumbnails);return ee.forEach(he=>{const ue=new ul.R;ue.storyId=s.id,ue.chapterId=he.chapterId,ue.urls={small:he.uris.small,large:he.uris.large},le.set(he.chapterId,ue);const ye=s.index.chapters.findIndex(Ge=>Ge.id===he.chapterId);ye>=0&&(s.index.chapters[ye].thumbnails={...he.uris})}),i.dispatch(new Ts.W2(le)),o.bookmarksService.saveBookmark(s)})).subscribe({next:ee=>{const le=Array.isArray(s.addCollections)&&s.addCollections.length>0,he=s.removeCollections&&Array.from(s.removeCollections.keys()).length>0;le||he?(o.actions.pipe((0,l.xi)(Ie.u,Ie.Ny),(0,qt.s)(1)).subscribe(()=>{i.dispatch(new Ie.x$(ee,s.index,a))}),i.dispatch(new Ie.Pd(ee,s.addCollections,s.removeCollections))):i.dispatch(new Ie.x$(ee,s.index,a))},error:ee=>{i.dispatch(new Ie.Ur(s,ee))}}),o.vendorAnalyticsService.track("Bookmark Save - Start")})()}saveBookmarkSuccess(i,t){i.patchState({saving:!1});const o=t.bookmark,s=i.getState().bookmarks,a=s.findIndex(r=>r.id===o.id);-1!==a&&(s[a]=o,i.patchState({bookmarks:[...s]})),this.vendorAnalyticsService.track("Bookmark Save - Success",{id:o.id,chapters:t.story.chapters.length,tour:o.tour,animated:o.animated,quiz:o.quiz,edit:this.router.url.startsWith("/edit")})}saveBookmarkFail(i,t){i.patchState({saving:!1});const o=t.bookmarkEntry?.id||"",s=o.includes("/")?Se.c.Module:Se.c.Bookmark,a=ss(t.error),r=t.error?.status;this.vendorAnalyticsService.track("Bookmark Save - Failure",{contentId:o,contentType:s,error:a,statusCode:r,application:z.c.application})}deleteBookmark(i,t){const o=t.bookmarkId;this.bookmarksService.deleteBookmark(o).subscribe(()=>{i.dispatch(new Ie.DN(o))},s=>{i.dispatch(new Ie.Qw(o,s))})}deleteBookmarkSuccess(i,t){const o=i.getState().bookmarks.filter(s=>s.id!==t.bookmarkId);i.patchState({bookmarks:[...o]}),this.snackbar.open("Successfully deleted 3D model")}bulkDeleteBookmark(i,{bookmarkIds:t}){this.vendorAnalyticsService.track("Bulk Delete - Start"),this.bookmarksService.bulkDeleteBookmarks(t).subscribe({next:o=>{i.dispatch(new Ie.te(t,o.job_id)),i.dispatch(new Ie.zW)},error:o=>{this.vendorAnalyticsService.track("Bulk Delete - Error"),i.dispatch(new Ie.C$(t,o))}})}bulkDeleteBookmarkComplete(i,t){this.vendorAnalyticsService.track("Bulk Delete - Complete")}bulkDeleteBookmarksError(i,t){this.vendorAnalyticsService.track("Bulk Delete - Error")}sortBookmarks(i,t){const o=i.getState().bookmarks;i.patchState({sort:t.sort,bookmarks:[...o]})}clearBookmarks(i,t){i.patchState({bookmarks:[],checkedBookmarks:[]})}resetBookmarks(i,t){i.setState(Kg)}checkBookmark(i,t){let o=i.getState().checkedBookmarks;const s=o.some(a=>a===t.id);t.checked&&!s?o=[...o,t.id]:t.checked||(o=o.filter(a=>a!==t.id)),i.patchState({checkedBookmarks:o})}setCheckedBookmarks(i,t){i.patchState({checkedBookmarks:t.ids})}exportBookmarks(i,t){const{bookmarks:o,organizationId:s,collections:a,widgetURL:r,widgetOptions:_,offlineEnabled:g,productAccountId:P}=t,F=_||new $o;i.patchState({exporting:!0}),this.publishService.exportBookmarks(o,s,a,r,F,null,t.userLanguage,t.userApp,g,P).pipe((0,Ot.j)(()=>{i.patchState({exporting:!1})})).subscribe(ee=>{i.dispatch(ee?new Ie.B7(o):new Ie.g(o))})}postUpdateBookmarkCollections(i,t){const o=new Map,s=new Map;t.forEach(({bookmark:_,addCollections:g,removeCollections:P})=>{g.forEach(F=>{const ee=F.collection_id,le={content_type:_.type,content_id:_.id},he=o.get(ee)??[];he.push(le),o.set(ee,he)}),P.forEach((F,ee)=>{const le=ee.collection_id,he=s.get(le)??[];he.push(F),s.set(le,he)})});const a=Array.from(o).map(([_,g])=>({collection_id:_,content_list:g})),r=Array.from(s).map(([_,g])=>({collection_id:_,collection_content_id_list:g}));return this.organizationsService.updateCollectionContent(i,a,r)}bulkUpdateBookmarkCollections(i,{groupId:t,updates:o}){this.vendorAnalyticsService.track("Bulk Move/Remove - Start"),this.postUpdateBookmarkCollections(t,o).subscribe({next:()=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Success"),i.dispatch(new Ie.ET(o))},error:s=>{this.vendorAnalyticsService.track("Bulk Move/Remove - Error"),i.dispatch(new Ie.dc(o,s))}})}updateBookmarkCollections(i,t){const o=t.addCollections,s=o.map(g=>({collection_id:g.collection_id,content_list:[{content_type:t.bookmark.type,content_id:t.bookmark.id}]})),a=Array.from(t.removeCollections.keys()),r=a.map(g=>({collection_id:g.collection_id,collection_content_id_list:[t.removeCollections.get(g)]})),_=o.concat(a)[0].group_id;this.organizationsService.updateCollectionContent(_,s,r).subscribe(()=>{o.length>0&&i.dispatch(new Ie.Mv(t.bookmark,o)),a.length>0&&i.dispatch(new Ie.zP(t.bookmark,a)),i.dispatch(new Ie.u(t.bookmark,o,a))},()=>{o.length>0&&i.dispatch(new Ie.D3(t.bookmark,o)),a.length>0&&i.dispatch(new Ie.iw(t.bookmark,a)),i.dispatch(new Ie.Ny(t.bookmark,o,a))})}removeBookmarkCollectionSuccess(i,t){const{bookmarks:o,selectedCategory:s}=i.getState();if("collection"===s){const a=t.bookmark.id,r=o.filter(_=>_.id!==a);i.patchState({bookmarks:[...r]})}}copyBookmark(i,t){this.vendorAnalyticsService.track("Bookmark Copy - Start");const{groupAccess:o,collections:s}=t;let a,r,_,g,P;i.patchState({copying:!0,saving:!0});const F=Yg(this.bookmarksService,this.exploreService,this.storageService,t.id,t.type,!1),ee=this.storyService.getStory(t.id,t.type,t.lang);(0,di.p)([F,ee]).pipe((0,W.T)(([le,he])=>{r=(0,u.cloneDeep)(he),_=(0,u.cloneDeep)(he),this.storyService.addContentRecord(t.id,_),g=(0,jd.S)(r.chapters,!0),_.chapters.forEach(ue=>{ue.id=g[ue.id]}),t.title&&(_.displayName=t.title),t.type?delete _.sourceInfo:_.sourceInfo=eh(_.sourceInfo),_.tweenParticleLookup&&(_.tweenParticleLookup=av.e.updateChapterIds(_.tweenParticleLookup,g)),P=le.viewMode}),(0,lo.n)(()=>this.imagesService.generateFreshChapterImages(r.chapters,t.id)),(0,lo.n)(le=>{const he=le.map(ue=>this.imagesService.saveNewChapterImage(ue.chapterId,ue.snapshot));return he.length?(0,di.p)(he):(0,Rt.of)([])}),(0,W.T)(le=>{le.forEach(he=>{he.chapterId=g[he.chapterId]}),_.chapters.forEach(he=>{const ue=le.find(ye=>ye.chapterId===he.id);ue&&(he.thumbnails={...ue.uris})})}),(0,lo.n)(()=>{const le=new sv;return le.title=t.title,le.isOwner=!0,le.index=_,le.viewMode=P,le.is_content_copy=!0,o&&(le.add_group_access=[o]),this.bookmarksService.saveBookmark(le)}),(0,is.M)(le=>{a=le}),(0,lo.n)(()=>{if(o&&s&&s.length>0){const le=s[0].group_id,he=s.map(ue=>({collection_id:ue.collection_id,content_list:[{content_type:a.type,content_id:a.id}]}));return this.organizationsService.updateCollectionContent(le,he,[])}return(0,Rt.of)(!0)}),(0,Ot.j)(()=>{i.patchState({copying:!1,saving:!1})})).subscribe(()=>{this.vendorAnalyticsService.track("Bookmark Copy - Success",{id:a.id,chapters:_.chapters.length,tour:a.tour,animated:a.animated,quiz:a.quiz,edit:this.router.url.startsWith("/edit")}),i.dispatch(new Ie.lN(a,_))},le=>{this.vendorAnalyticsService.track("Bookmark Copy - Failure"),i.dispatch(new Ie.Cr(t.id,le))})}copyBookmarks(i,{copyBookmarkModels:t}){this.vendorAnalyticsService.track("Bulk Add - Start"),i.patchState({copying:!0}),this.bookmarksService.bulkCopyBookmarks(t).pipe((0,Ot.j)(()=>{i.patchState({copying:!1})})).subscribe({next:o=>{i.dispatch(new Ie.GZ(t,o.job_id)),i.dispatch(new Ie.zW)},error:o=>{this.vendorAnalyticsService.track("Bulk Add - Error"),i.dispatch(new Ie.F_(t,o))}})}bulkCopyBookmarksComplete(i,t){this.vendorAnalyticsService.track("Bulk Add - Success")}BulkCopyBookmarksError(i,t){this.vendorAnalyticsService.track("Bulk Add - Error")}getBookmarkJobs(i,t){this.bookmarksService.getBookmarkJobs().subscribe({next:o=>{i.dispatch(new Ie.cK(o))},error:o=>{i.dispatch(new Ie.VN(o))}})}setBookmarkJobs(i,{bookmarkJobs:t}){i.patchState({bookmarkJobs:t})}getBookmarkJobsSuccess(i,{bookmarkJobs:t}){i.dispatch(new Ie.Zp(t))}cancelBookmarkJob(i,{jobId:t,jobType:o}){this.vendorAnalyticsService.track(("bookmark_copy"===o?"Bulk Add":"Bulk Delete")+" - Stopped"),this.bookmarksService.cancelBookmarkJob(t).subscribe({next:()=>{i.dispatch(new Ie.HN(t,o)),i.dispatch(new Ie.zW)},error:s=>{i.dispatch(new Ie.Mo(t,o,s))}})}setBookmarkText(i,t){const o=i.getState().selectedBookmark;i.patchState({selectedBookmark:{...o,title:t.title}})}setBookmarkViewMode(i,t){const o=i.getState().selectedBookmark;i.patchState({selectedBookmark:{...o,viewMode:t.viewMode}})}setSelectedCategory(i,{category:t}){i.patchState({selectedCategory:t||null})}cancelSaveBookmark(i,t){i.patchState({saving:!1})}cancelCopyBookmark(i,t){i.patchState({copying:!1})}constructor(i,t,o,s,a,r,_,g,P,F,ee,le,he){this.store=i,this.actions=t,this.bookmarksService=o,this.imagesService=s,this.storyService=a,this.exploreService=r,this.publishService=_,this.organizationsService=g,this.snackbar=P,this.vendorAnalyticsService=F,this.storageService=ee,this.router=le,this.serializeModuleService=he}static#e=this.\u0275fac=function(t){return new(t||Td)(e.KVO(l.il),e.KVO(l.En),e.KVO(Bo),e.KVO($l),e.KVO(Pi.J),e.KVO(Gl),e.KVO(Io),e.KVO(ce),e.KVO(ui.UG),e.KVO(ve),e.KVO(It.n$),e.KVO(K.Ix),e.KVO(ml))};static#t=this.\u0275prov=e.jDH({token:Td,factory:Td.\u0275fac})};wt([(0,l.rc)(Ie.Gr),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Gr]),Me("design:returntype",void 0)],ft.prototype,"loadBookmarks",null),wt([(0,l.rc)(Ie.PU),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.PU]),Me("design:returntype",void 0)],ft.prototype,"loadOrganizationBookmarks",null),wt([(0,l.rc)(Ie.Kf),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Kf]),Me("design:returntype",void 0)],ft.prototype,"loadCollectionBookmarks",null),wt([(0,l.rc)(Ie.zX),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.zX]),Me("design:returntype",void 0)],ft.prototype,"loadSuccess",null),wt([(0,l.rc)(Ie.Xt),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Xt]),Me("design:returntype",void 0)],ft.prototype,"selectBookmark",null),wt([(0,l.rc)(Ie.sN),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.sN]),Me("design:returntype",void 0)],ft.prototype,"selectBookmarkSuccess",null),wt([(0,l.rc)(Ie.iy),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.iy]),Me("design:returntype",Promise)],ft.prototype,"saveBookmark",null),wt([(0,l.rc)(Ie.x$),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.x$]),Me("design:returntype",void 0)],ft.prototype,"saveBookmarkSuccess",null),wt([(0,l.rc)(Ie.Ur),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Ur]),Me("design:returntype",void 0)],ft.prototype,"saveBookmarkFail",null),wt([(0,l.rc)(Ie.CR),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.CR]),Me("design:returntype",void 0)],ft.prototype,"deleteBookmark",null),wt([(0,l.rc)(Ie.DN),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.DN]),Me("design:returntype",void 0)],ft.prototype,"deleteBookmarkSuccess",null),wt([(0,l.rc)(Ie.CF),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.CF]),Me("design:returntype",void 0)],ft.prototype,"bulkDeleteBookmark",null),wt([(0,l.rc)(Ie.$H),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.$H]),Me("design:returntype",void 0)],ft.prototype,"bulkDeleteBookmarkComplete",null),wt([(0,l.rc)(Ie.PS),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.PS]),Me("design:returntype",void 0)],ft.prototype,"bulkDeleteBookmarksError",null),wt([(0,l.rc)(Ie.yH),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.yH]),Me("design:returntype",void 0)],ft.prototype,"sortBookmarks",null),wt([(0,l.rc)(Ie.B9),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.B9]),Me("design:returntype",void 0)],ft.prototype,"clearBookmarks",null),wt([(0,l.rc)(Ie.Ri),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Ri]),Me("design:returntype",void 0)],ft.prototype,"resetBookmarks",null),wt([(0,l.rc)(Ie.J9),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.J9]),Me("design:returntype",void 0)],ft.prototype,"checkBookmark",null),wt([(0,l.rc)(Ie.j5),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.j5]),Me("design:returntype",void 0)],ft.prototype,"setCheckedBookmarks",null),wt([(0,l.rc)(Ie.ov),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.ov]),Me("design:returntype",void 0)],ft.prototype,"exportBookmarks",null),wt([(0,l.rc)(Ie.Ln),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Ln]),Me("design:returntype",void 0)],ft.prototype,"bulkUpdateBookmarkCollections",null),wt([(0,l.rc)(Ie.Pd),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Pd]),Me("design:returntype",void 0)],ft.prototype,"updateBookmarkCollections",null),wt([(0,l.rc)(Ie.zP),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.zP]),Me("design:returntype",void 0)],ft.prototype,"removeBookmarkCollectionSuccess",null),wt([(0,l.rc)(Ie.eW),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.eW]),Me("design:returntype",void 0)],ft.prototype,"copyBookmark",null),wt([(0,l.rc)(Ie.ZA),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.ZA]),Me("design:returntype",void 0)],ft.prototype,"copyBookmarks",null),wt([(0,l.rc)(Ie.U8),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.U8]),Me("design:returntype",void 0)],ft.prototype,"bulkCopyBookmarksComplete",null),wt([(0,l.rc)(Ie.ZW),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.ZW]),Me("design:returntype",void 0)],ft.prototype,"BulkCopyBookmarksError",null),wt([(0,l.rc)(Ie.zW),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.zW]),Me("design:returntype",void 0)],ft.prototype,"getBookmarkJobs",null),wt([(0,l.rc)(Ie.Zp),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.Zp]),Me("design:returntype",void 0)],ft.prototype,"setBookmarkJobs",null),wt([(0,l.rc)(Ie.cK),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.cK]),Me("design:returntype",void 0)],ft.prototype,"getBookmarkJobsSuccess",null),wt([(0,l.rc)(Ie.I0),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.I0]),Me("design:returntype",void 0)],ft.prototype,"cancelBookmarkJob",null),wt([(0,l.rc)(Ie.e_),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.e_]),Me("design:returntype",void 0)],ft.prototype,"setBookmarkText",null),wt([(0,l.rc)(Ie.pE),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.pE]),Me("design:returntype",void 0)],ft.prototype,"setBookmarkViewMode",null),wt([(0,l.rc)(Ie.a1),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.a1]),Me("design:returntype",void 0)],ft.prototype,"setSelectedCategory",null),wt([(0,l.rc)(Ie.A),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.A]),Me("design:returntype",void 0)],ft.prototype,"cancelSaveBookmark",null),wt([(0,l.rc)(Ie.M),Me("design:type",Function),Me("design:paramtypes",[Object,Ie.M]),Me("design:returntype",void 0)],ft.prototype,"cancelCopyBookmark",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getBookmarks",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getCheckedBookmarks",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getSelectedBookmark",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getSelectedBookmarkViewMode",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getLoading",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getExporting",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getSaving",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getCopying",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getSort",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getSelectedCategory",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getBookmarkJobs",null),wt([(0,l.MD)(),Me("design:type",Function),Me("design:paramtypes",[qi]),Me("design:returntype",void 0)],ft,"getActiveBookmarkJob",null),ft=wt([(0,l.Uw)({name:"bookmarks",defaults:Kg}),Me("design:paramtypes",[l.il,l.En,Bo,$l,Pi.J,Gl,Io,ce,ui.UG,ve,It.n$,K.Ix,ml])],ft);class ma{}var qg=function(n){return n.Light="theme-light",n.Dark="theme-dark",n}(qg||{}),as=function(n){return n[n.Application=0]="Application",n[n.Search=1]="Search",n[n.View=2]="View",n[n.Hide=3]="Hide",n[n.Share=4]="Share",n[n.Logo=5]="Logo",n}(as||{}),Jg=function(n){return n[n.Mobile=0]="Mobile",n[n.None=1]="None",n}(Jg||{}),Ri=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},zt=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const Zg={theme:qg.Light,sidenav:{enabled:!0,open:!1},siteHeader:as.Application,siteFooter:Jg.None,siteHeaderHeight:56,siteFooterHeight:56};let vn=class Od{static getTheme(i){return i.theme}static getSidenav(i){return i.sidenav}static getSiteHeader(i){return i.siteHeader}static getSiteHeaderHeight(i){return i.siteHeaderHeight}static getSiteFooter(i){return i.siteFooter}static getSiteFooterHeight(i){return i.siteFooterHeight}setTheme({patchState:i},{theme:t}){i({theme:t})}setHeader(i,t){i.patchState({siteHeader:t.siteHeaderType})}setFooter(i,t){i.patchState({siteFooter:t.siteFooterType})}setHeaderHeight(i,t){i.patchState({siteHeaderHeight:t.height})}setFooterHeight(i,t){i.patchState({siteFooterHeight:t.height})}setSidenav(i,t){i.patchState({sidenav:{...t.sidenav}})}toggleSidenav(i,t){const o=i.getState().sidenav;i.patchState({sidenav:{...o,open:t.open}})}resetLayout(i,t){i.setState(Zg)}static#e=this.\u0275fac=function(t){return new(t||Od)};static#t=this.\u0275prov=e.jDH({token:Od,factory:Od.\u0275fac})};function rp(n,i,t=!0){return.01*(window.innerHeight-(t&&n!==as.Hide?i:0))}function Bl(n){return n===as.Logo||z.c.application!==xn.c.Viewer}Ri([(0,l.rc)(Un.SetTheme),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetTheme]),zt("design:returntype",void 0)],vn.prototype,"setTheme",null),Ri([(0,l.rc)(Un.SetHeader),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetHeader]),zt("design:returntype",void 0)],vn.prototype,"setHeader",null),Ri([(0,l.rc)(Un.SetFooter),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetFooter]),zt("design:returntype",void 0)],vn.prototype,"setFooter",null),Ri([(0,l.rc)(Un.SetHeaderHeight),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetHeaderHeight]),zt("design:returntype",void 0)],vn.prototype,"setHeaderHeight",null),Ri([(0,l.rc)(Un.SetFooterHeight),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetFooterHeight]),zt("design:returntype",void 0)],vn.prototype,"setFooterHeight",null),Ri([(0,l.rc)(Un.SetSidenav),zt("design:type",Function),zt("design:paramtypes",[Object,Un.SetSidenav]),zt("design:returntype",void 0)],vn.prototype,"setSidenav",null),Ri([(0,l.rc)(Un.ToggleSidenav),zt("design:type",Function),zt("design:paramtypes",[Object,Un.ToggleSidenav]),zt("design:returntype",void 0)],vn.prototype,"toggleSidenav",null),Ri([(0,l.rc)(Un.ResetLayout),zt("design:type",Function),zt("design:paramtypes",[Object,Un.ResetLayout]),zt("design:returntype",void 0)],vn.prototype,"resetLayout",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getTheme",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getSidenav",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getSiteHeader",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getSiteHeaderHeight",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getSiteFooter",null),Ri([(0,l.MD)(),zt("design:type",Function),zt("design:paramtypes",[ma]),zt("design:returntype",void 0)],vn,"getSiteFooterHeight",null),vn=Ri([(0,l.Uw)({name:"layout",defaults:Zg})],vn);var zo=d(73987),Ns=d(13976);let lp=(()=>{class n{constructor(t,o,s,a,r){this.store=t,this.chapterService=o,this.animationService=s,this.mediaService=a,this.contentBlocksService=r,this.ui=null,this.horizontalBreakpoint=null}getBase(){return{ui:this.store.selectSnapshot(Ke.getUI),layout:this.store.selectSnapshot(de.getLayout),horizontalBreakpoint:this.store.selectSnapshot(Dn.getHorizontalBreakpoint),canvasHeightBreakpoint:this.store.selectSnapshot(ze.S.getCanvasHeightBreakpoint),quizActive:this.store.selectSnapshot(Fe.j.getQuizModeActive),hideUI:this.isUIHidden()}}isUIHidden(){const t=this.store.selectSnapshot(de.getOpenWindow),o=this.store.selectSnapshot(me.N.getSelectedChapterIndex),s=this.store.selectSnapshot(Ke.getUI),a=t===_n.Loader&&o<=0&&s.loader.template===Gi.Circle,r=this.store.selectSnapshot(Ai.getStoryLoadProgress);return a||0===r||t===_n.OnDemand||t===_n.Interact||t===_n.Tutorial||t===_n.Whiteboard||t===_n.XRLoader}isDrawerVisible(){const{layout:t,quizActive:o,hideUI:s}=this.getBase();if(s||this.getViewLayout(t)!==Yn.Drawer)return!1;if(o)return!0;const a=this.store.selectSnapshot(de.getContentMode);return!(a===Bt.ChapterInfo&&"full"!==this.getVisibleContent(Bt.ChapterInfo)||a===Bt.Quiz&&"full"!==this.getVisibleContent(Bt.Quiz)||a===Bt.LabelInfo&&"none"===this.getVisibleContent(Bt.LabelInfo))&&this.isUIVisible(G.Drawer)}isDrawerToggleVisible(){const{ui:t,layout:o,quizActive:s}=this.getBase(),a=this.getVisibleContent(Bt.ChapterInfo);return this.getViewLayout(o)===Yn.Drawer&&"full"===a&&!1!==t.drawer.enable&&!s&&this.isUIVisible(G.DrawerToggle)}isColumnVisible(){const{layout:t,ui:o}=this.getBase();if(o.column.status===mt.Collapse||this.getViewLayout(t)!==Yn.Column)return!1;const s=this.store.selectSnapshot(de.getContentMode);return!(s===Bt.ChapterInfo&&"full"!==this.getVisibleContent(Bt.ChapterInfo)||s===Bt.Quiz&&"full"!==this.getVisibleContent(Bt.Quiz))&&this.isUIVisible(G.Column)}isColumnToggleVisible(){const{hideUI:t,layout:o,ui:s}=this.getBase();if(t||this.getViewLayout(o)!==Yn.Column)return!1;const a=this.store.selectSnapshot(de.getContentMode);return!(a===Bt.ChapterInfo&&"full"!==this.getVisibleContent(Bt.ChapterInfo)||a===Bt.Quiz&&"full"!==this.getVisibleContent(Bt.Quiz))&&s.column.enable}isTitleOnlyVisible(){const{hideUI:t,ui:o,layout:s}=this.getBase();if(t)return!1;const a=this.getViewLayout(s),r=this.getVisibleContent(Bt.ChapterInfo),_=this.isPaginationVisible();let g=!0;return!(this.store.selectSnapshot(Fe.j.getQuizModeActive)||a===Yn.Column&&(!1===o.column.enable&&!1===_||!1===o.column.enable&&"titleOnly"===r&&!1===_||o.column.enable&&"full"===r&&o.column.status!==mt.Collapse))&&(a===Yn.Drawer&&(g=o.drawer.enable||_),g)}isToggleLabelsVisible(){return 0!==this.store.selectSnapshot(et.getChapterLabels).length&&this.isUIVisible(G.ToggleLabels)}isToolsVisible(){return this.isUIVisible(G.Tools)}isToolbarVisible(){return this.isUIVisible(G.Toolbar)}isFullScreenVisible(){return!this.store.selectSnapshot(de.getIsMobileWeb)&&this.isUIVisible(G.Fullscreen)}isLogoVisible(){const{ui:t}=this.getBase();if(this.store.selectSnapshot(de.getOpenWindow)===_n.OnDemand)return!1;const o=this.store.selectSnapshot(de.getIsMobileWeb),s=this.store.selectSnapshot(Ke.getUIEntry(G.Media));return!(this.isMediaVisible()&&"show"===s.status&&!o)&&t.logo.enable}isCameraVisible(){return this.isUIVisible(G.Camera)}isPaginationVisible(){return!(this.store.selectSnapshot(me.N.getChapterCount)<=1||this.store.selectSnapshot(Fe.j.getQuizModeActive))&&this.isUIVisible(G.Pagination)}isMediaVisible(){const{hideUI:t,ui:o}=this.getBase(),s=o.media.enable,a=this.store.selectSnapshot(me.N.getSelectedChapter);return!(this.store.selectSnapshot(ze.S.getCanvasHeightBreakpoint)===zo.h.Tiny||t||!s||!a?.id||!this.animationService.isChapterAnimated(a))&&this.isUIVisible(G.Media)}isPlaythroughVisible(){const t=this.store.selectSnapshot(me.N.getChapterCount)>1;return!(this.store.selectSnapshot(ft.getSelectedBookmarkViewMode)===we.Quiz||!t)&&this.isUIVisible(G.Playthrough)}isToolbarOverflowVisible(){const{canvasHeightBreakpoint:t}=this.getBase(),o=this.isUIVisible(G.Help),s=this.isToggleLabelsVisible(),a=this.store.selectSnapshot(Fe.j.hasQuiz),r=this.store.selectSnapshot(Fe.j.getQuizEnabled),_=this.isUIVisible(G.QuizPrompt),g=this.store.selectSnapshot(Fe.j.getQuizModeLocked),P=this.store.selectSnapshot(ft.getSelectedBookmarkViewMode),F=this.store.selectSnapshot(de.getIsMobileWeb);if(t>zo.h.Tiny&&(o||s||a&&_&&r&&!1===g&&P!==we.Content&&F))return!0;const le=this.isUIVisible(G.Tools),he=this.isUIVisible(G.VisibilityLayers),ue=this.isUIVisible(G.Search),ye=this.isUIVisible(G.Whiteboard);return!!(t<=zo.h.Tiny&&(le||he||ue||ye))||this.isUIVisible(G.ToolbarOverflow)}isNodeInfoColumnVisible(){const{hideUI:t,ui:o,horizontalBreakpoint:s}=this.getBase();return!t&&(!!(s>=Qn.Large&&this.isUIVisible(G.NodeInfo))||(s<Qn.Large?!o.drawer.enable&&this.isUIVisible(G.NodeInfo):void 0))}isNodeInfoVisible(t){const{hideUI:o,horizontalBreakpoint:s}=this.getBase();return!o&&(s>=Qn.Large&&t===Yn.Column||s<Qn.Large&&t===Yn.Drawer)&&this.isUIVisible(G.NodeInfo)}isAudioVisible(){const{hideUI:t,ui:o}=this.getBase(),s=this.store.selectSnapshot(de.getViewLanguage),a=this.store.selectSnapshot(me.N.getSelectedChapter),r=this.store.selectSnapshot(de.getForceAudio);return!(0,u.isNil)(a)&&this.mediaService.getChapterAudioPlaybackType(a,s,r)!==ii.None&&!t&&o[G.Audio].status!==mt.Hide&&(o[G.Audio].enable||r)}isQuizPromptVisible(){const{hideUI:t}=this.getBase();return!t&&this.isUIVisible(G.QuizPrompt)}isSearchVisible(){return this.store.selectSnapshot(ze.S.getCanvasHeightBreakpoint)!==zo.h.Tiny&&this.isUIVisible(G.Search)}isUndoVisible(){const{hideUI:t,ui:o}=this.getBase();return!t&&o.undo.enable}isSkinLayersVisible(){const t=this.store.selectSnapshot(dt.getVariantSchema("skin"));return!(0,u.isEmpty)(t)&&this.store.selectSnapshot(ze.S.getCanvasHeightBreakpoint)!==zo.h.Tiny&&this.isUIVisible(G.SkinLayers)}isVisibilityLayersVisible(){const t=this.store.selectSnapshot(me.N.getSelectedChapterSrcLayers),o=this.isSkinLayersVisible();return!(!this.chapterService.hasVisibilityLayers(t)&&!o||this.store.selectSnapshot(ze.S.getCanvasHeightBreakpoint)===zo.h.Tiny)&&(this.isUIVisible(G.VisibilityLayers)||this.isSkinLayersVisible())}isWhiteboardVisible(){return this.isUIVisible(G.Whiteboard)}isVisible(t){switch(t){case G.Audio:return this.isAudioVisible();case G.Camera:return this.isCameraVisible();case G.Column:return this.isColumnVisible();case G.ColumnToggle:return this.isColumnToggleVisible();case G.Drawer:return this.isDrawerVisible();case G.DrawerToggle:return this.isDrawerToggleVisible();case G.Fullscreen:return this.isFullScreenVisible();case G.Logo:return this.isLogoVisible();case G.Media:return this.isMediaVisible();case G.ToolbarOverflow:return this.isToolbarOverflowVisible();case G.QuizPrompt:return this.isQuizPromptVisible();case G.Pagination:return this.isPaginationVisible();case G.Playthrough:return this.isPlaythroughVisible();case G.Search:return this.isSearchVisible();case G.TitleOnly:return this.isTitleOnlyVisible();case G.ToggleLabels:return this.isToggleLabelsVisible();case G.Tools:return this.isToolsVisible();case G.Toolbar:return this.isToolbarVisible();case G.Undo:return this.isUndoVisible();case G.VisibilityLayers:return this.isVisibilityLayersVisible();case G.SkinLayers:return this.isSkinLayersVisible();case G.Whiteboard:return this.isWhiteboardVisible();default:return this.isUIVisible(t)}}isUIVisible(t){const{hideUI:o,ui:s}=this.getBase();return s[t]?!o&&s[t].enable&&s[t].status!==mt.Hide:(console.warn("Attempting to check visibility of a non-existent element: ${element}"),!1)}isUIEnabled(t){const{ui:o}=this.getBase();return o[t].enable}getChapterVisibility(){const{ui:t}=this.getBase(),o=this.store.selectSnapshot(et.getChapterLabels),s=this.store.selectSnapshot(me.N.getSelectedChapter),a=s?.displayName,r=null!=a&&(0,u.trim)(a).length>0,g=this.contentBlocksService.filterEmptyBlocks(s?.contentBlocks??[]).length>0,P=t.labelList.enable&&o.length>0,F=s?.description,ee=null!=F&&(0,u.trim)(F).length>0,le=(0,u.get)(s,"legend",[]);return P||ee||t.legend.enable&&le.length>0||g?"full":r?"titleOnly":"none"}getQuizVisibility(){return this.store.selectSnapshot(Fe.j.getQuizModeActive)?"full":"none"}getLabelInfoVisibility(){const t=this.store.selectSnapshot(et.getSelectedLabel);if((0,u.isNil)(t))return"none";const o=t?.title,s=null!=o&&(0,u.trim)(o).length>0;return(0,u.trim)(t.description).length>0||t.contentBlocks?.length>0?"full":s?"titleOnly":"none"}getVisibleContent(t){switch(t){case Bt.ChapterInfo:return this.getChapterVisibility();case Bt.LabelInfo:return this.getLabelInfoVisibility();case Bt.Quiz:return this.getQuizVisibility()}}getViewLayout(t){const{innerHeight:o,innerWidth:s}=window,a=s/o>=1?"landscape":"portrait",{horizontalBreakpoint:r}=this.getBase(),_=this.store.selectSnapshot(vn.getSiteHeader),g=this.store.selectSnapshot(vn.getSiteHeaderHeight),F=384+(Bl(_)?g:0);switch(t){case Sl.ColumnOnly:return Yn.Column;case Sl.DrawerOnly:return Yn.Drawer;default:return"portrait"===a?Yn.Drawer:r>=Qn.Large||o<=F&&s>=708?Yn.Column:Yn.Drawer}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(sh.j),e.KVO(co.O),e.KVO(vi),e.KVO(Ns.V))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Wo=d(13878),Pn=d(43753);class fa{static#e=G.Whiteboard}const pn=(n,i)=>(0,u.isNil)(n)?i:n;function Zt(...n){return!!n.some(i=>!0===i)||!n.some(i=>!1===i)&&void 0}function cp(n,i,t){const o=Xl(t,Object.values(Bi));return(0,u.isNil)(o)?!1===n?Bi.None:null!=i?i?Bi.Full:Bi.Small:null:o}function zl(n){return Xl(n,Object.values(Gi))}function dp(n){return Xl(n,Object.values(Di))||(!0===n?Di.AR:Di.None)}function Wl(n,i){return!0===i?aa.Group:Xl(n,Object.values(aa))}function Xl(n,i){return i.includes(n)?n:null}function em(n){const i={all:void 0,anatomyLabels:n.anatomyLabels.enable,audio:n.audio.enable,cameraMode:n.camera.enable,center:n.camera.enable,contextActions:n.contextActions.enable,contextMenu:n.contextMenu.enable,fadeout:void 0,fullscreen:n.fullscreen.enable,help:n.help.enable,info:n.column.enable||n.drawer.enable,infoExpand:n.drawer.isExpandedInitially,labels:n.labels.enable,legend:n.legend.enable,loader:zl(n.loader.template),xrLoader:dp(n.xrLoader.template),nav:n.camera.enable,objectTree:n.search.enable,playPause:n.media.enable,"scrubber.chapters":n.media.enable,scrubber:n.media.enable,"tools-display":n.tools.enable,tools:n.tools.enable,"tour.chapters":n.pagination.enable,tour:n.pagination.enable,visibilityLayers:n.visibilityLayers.enable,visibilityLayersMode:n.visibilityLayers.layersMode,skinLayers:n.skinLayers.enable,whiteboard:n.whiteboard.enable,zoomIn:n.camera.enable,zoomOut:n.camera.enable,share:!1,dissect:!1,xray:!1,annotations:!1,crossSection:!1,isolate:!1};return(0,u.pickBy)(i,t=>!(0,u.isNil)(t))}function tm(n){const i=null!=n["ui-all"]?_p(n["ui-all"]):new fa;return rs({[G.Layout]:n["ui-layout"],[G.Loader]:zl(n["ui-loader"]),[G.XRLoader]:dp(n["ui-xr-loader"]),[G.NodeInfo]:n["ui-anatomy-descriptions"],[G.NodeAudio]:n["ui-anatomy-pronunciations"],[G.Tools]:n["ui-tools"],[G.Media]:cp(null,Zt(n["ui-scrubber"],n["ui-scrubber.chapters"],n["ui-scrubber.tour"]),n["ui-media-controls"]),[G.Audio]:n["ui-audio"],[G.Fullscreen]:n["ui-fullscreen"],[G.Help]:n["ui-help"],[G.Camera]:n["ui-nav"],[G.Toolbar]:Zt(n["ui-toolbar"],n["ui-menu"]),[G.Pagination]:n["ui-tour"],[G.Search]:Zt(n["ui-search"],n["ui-object-tree"]),[G.Column]:Zt(n["ui-info"],n["ui-panel"]),[G.Drawer]:Zt(n["ui-info"],n["ui-panel"]),[G.Description]:Zt(n["ui-info"]),[G.TitleOnly]:Zt(n["ui-info"]),[G.Logo]:Zt(n["ui-bd"],n["ui-logo"]),logoIsHyperLink:Zt(n["ui-bd.link"],n["ui-logo.islink"]),[G.Labels]:n["ui-labels"],[G.LabelList]:n["ui-label-list"],all:n["ui-all"],drawerExpanded:n["ui-info-expand"],fadeout:n["ui-fadeout"],startingColumn:n["ui-starting-column"],startingTool:n["ui-starting-tool"],[G.AnatomyLabels]:Zt(n["ui-anatomy-labels"]),[G.Tutorial]:Zt(n["ui-tutorial"]),[G.Legend]:Zt(n["ui-legend"]),[G.Undo]:Zt(n["ui-undo"],n["ui-reset"]),[G.Whiteboard]:Zt(n["ui-whiteboard"]),[G.VisibilityLayers]:Zt(n["ui-visibility-layers"],n["ui-layers"]),[G.VisibilityLayersMode]:Wl(n["ui-visibility-layers-mode"],n["ui-skin-layers"]),[G.SkinLayers]:Zt(n["ui-skin-layers"]),[G.ContextActions]:Zt(n["ui-context-actions"]),[G.ContextMenu]:Zt(n["ui-context-menu"]),[G.ToggleLabels]:void 0,[G.QuizPrompt]:n["ui-quiz"],[G.Playthrough]:Zt(n.playthrough,n.autoplay)},i)}function _p(n){return{all:n,drawerExpanded:null,logoIsHyperLink:null,fadeout:null,startingColumn:null,[G.AnatomyLabels]:null,[G.Audio]:n,[G.Camera]:n,[G.Column]:n,[G.ContextActions]:n,[G.ContextMenu]:null,[G.Drawer]:n,[G.Fullscreen]:n,[G.Help]:n,[G.LabelList]:n,[G.Labels]:null,[G.Legend]:!0,[G.Loader]:n?Wd:Gi.None,[G.XRLoader]:void 0,[G.Logo]:!0,[G.Media]:n?Bi.Full:Bi.None,[G.NodeAudio]:n,[G.NodeInfo]:n,[G.Pagination]:n,[G.QuizPrompt]:n,[G.Search]:n,[G.TitleOnly]:n,[G.ToggleLabels]:!0,[G.Toolbar]:n,[G.Tools]:n,[G.Tutorial]:null,[G.Undo]:n,[G.VisibilityLayers]:n,[G.VisibilityLayersMode]:null,[G.SkinLayers]:n,[G.Whiteboard]:n}}function cv(){const n=_p(!1);return n.tools=!0,n.toolbar=!0,n.undo=!0,n.labels=!0,n.anatomyLabels=!0,n.nodeInfo=!0,n}function dv(n){const i=new fa;return i.anatomyLabels=!1,i.labelList=!1,i.labels=!1,i.legend=!1,i.nodeInfo=!1,i.pagination=!1,i.search=!1,i.toggleLabels=!1,i.tools=n?.type===Pn.Q5.SelectAnatomy,i.visibilityLayers=!1,i.whiteboard=!1,i}function rs(n,i){return null==i?n:(0,u.uniq)([...Object.keys(n),...Object.keys(i)]).reduce((o,s)=>(o[s]=null==n[s]?i[s]:n[s],o),new fa)}function nm(n,i){const t=JSON.parse(JSON.stringify(n)),o={...Hd};return t.loader.enable=pn(i[G.Loader]!==Gi.None,o.loader.enable),null!=i[G.Loader]&&(t.loader.template=i[G.Loader]),t.xrLoader.enable=pn(i[G.XRLoader]!==Di.None,o.xrLoader.enable),null!=i[G.XRLoader]&&(t.xrLoader.template=i[G.XRLoader]),t.anatomyLabels.enable=pn(i[G.AnatomyLabels],o.anatomyLabels.enable),t.audio.enable=pn(i[G.Audio],o.audio.enable),t.camera.enable=pn(i[G.Camera],o.camera.enable),t.column.enable=pn(i[G.Column],o.column.enable),t.contextActions.enable=pn(i[G.ContextActions],o.contextActions.enable),t.contextMenu.enable=pn(i[G.ContextMenu],o.contextMenu.enable),t.description.enable=pn(i[G.Description],o.description.enable),t.drawer.enable=pn(i[G.Drawer],o.drawer.enable),t.drawer.isExpandedInitially=pn(i[G.DrawerExpanded],o.drawer.isExpandedInitially),t.fullscreen.enable=pn(i[G.Fullscreen],o.fullscreen.enable),t.help.enable=pn(i[G.Help],o.help.enable),t.labelList.enable=pn(i[G.LabelList],o.labelList.enable),t.labels.enable=pn(i[G.Labels],o.labels.enable),t.logo.enable=pn(i[G.Logo],o.logo.enable),t.logo.isHyperLink=pn(i.logoIsHyperLink,o.logo.isHyperLink),t.media.enable=pn(i[G.Media]!==Bi.None,o.media.enable),t.media.template=i[G.Media],t.nodeAudio.enable=pn(i[G.NodeAudio],o.nodeAudio.enable),t.nodeInfo.enable=pn(i[G.NodeInfo],o.nodeInfo.enable),t.pagination.enable=pn(i[G.Pagination],o.pagination.enable),t.playthrough.enable=pn(i[G.Playthrough],o.playthrough.enable),t.quizPrompt.enable=pn(i[G.QuizPrompt],o.quizPrompt.enable),t.search.enable=pn(i[G.Search],o.search.enable),t.titleOnly.enable=pn(i[G.TitleOnly],o.titleOnly.enable),t.toggleLabels.enable=pn(i[G.ToggleLabels],o.toggleLabels.enable),t.toolbar.enable=pn(i[G.Toolbar],o.toolbar.enable),t.tools.enable=pn(i[G.Tools],o.tools.enable),t.tutorial.enable=pn(i[G.Tutorial],o.tutorial.enable),t.undo.enable=pn(i[G.Undo],o.undo.enable),t.visibilityLayers.enable=pn(i[G.VisibilityLayers],o.visibilityLayers.enable),t.visibilityLayers.layersMode=Wl(i[G.VisibilityLayersMode]??o.visibilityLayers.layersMode,i[G.SkinLayers]),t.skinLayers.enable=pn(i[G.SkinLayers],o.skinLayers.enable),t.whiteboard.enable=pn(i[G.Whiteboard],o.whiteboard.enable),t}var vt=d(34006),ut=d(26779),im=d(87424),om=d(57018);let fv=(()=>{class n{transform(t){return t.split(" ").map(s=>`<kbd>${s}</kbd>`).join("")}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275pipe=e.EJ8({name:"kbd",type:n,pure:!0})}return n})();function Sv(n,i){if(1&n&&(e.j41(0,"label",10),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.pronunciation)}}function bv(n,i){if(1&n&&(e.j41(0,"span"),e.nrm(1,"kbd",8),e.nI1(2,"kbd"),e.DNE(3,Sv,2,1,"label",9),e.k0s()),2&n){const t=i.$implicit;e.R7$(),e.Y8G("innerHTML",e.bMT(2,3,t.shortcut),e.npT),e.BMQ("aria-hidden",t.hasOwnProperty("pronunciation")),e.R7$(2),e.Y8G("ngIf",t.hasOwnProperty("pronunciation"))}}function yv(n,i){if(1&n&&(e.j41(0,"tr")(1,"th",6),e.EFF(2),e.k0s(),e.j41(3,"td",7),e.DNE(4,bv,4,5,"span",5),e.k0s()()),2&n){const t=i.$implicit;e.R7$(2),e.JRh(t.label),e.R7$(2),e.Y8G("ngForOf",t.keys)}}function vv(n,i){if(1&n&&(e.j41(0,"div",2)(1,"h2",3),e.EFF(2),e.k0s(),e.j41(3,"table",4),e.DNE(4,yv,5,2,"tr",5),e.k0s()()),2&n){const t=i.$implicit;e.R7$(2),e.JRh(t.label),e.R7$(2),e.Y8G("ngForOf",t.shortcuts)}}var Xo=function(n){return n.Left="\u2190",n.Right="\u2192",n.Up="\u2191",n.Down="\u2193",n.Command="\u2318",n}(Xo||{});let Ev=(()=>{class n{constructor(){this.shortcutGroups=[{label:$localize`Navigation`,shortcuts:[{keys:[{shortcut:",",pronunciation:"Comma."},{shortcut:"Pg-Up",pronunciation:"page-up"}],label:$localize`Previous chapter`},{keys:[{shortcut:".",pronunciation:"Period."},{shortcut:"Pg-Down",pronunciation:"Page-down."}],label:$localize`Next chapter`},{keys:[{shortcut:"/",pronunciation:"Forward slash."}],label:$localize`Open Search`},{keys:[{shortcut:"Ctrl + Enter"}],label:$localize`Enter Fullscreen`},{keys:[{shortcut:"Ctrl/Cmd + ,",pronunciation:"Control or command plus comma."}],label:$localize`Toggle Description`},{keys:[{shortcut:"Shift + /"}],label:$localize`Open Help`}]},{label:$localize`Tools`,shortcuts:[{keys:[{shortcut:"1"}],label:$localize`Use "Select" tool`},{keys:[{shortcut:"2"}],label:$localize`Use "Hide" tool`},{keys:[{shortcut:"3"}],label:$localize`Use "Fade" tool`},{keys:[{shortcut:"del",pronunciation:"Delete."},{shortcut:"backspace"}],label:$localize`Hide selected structure`},{keys:[{shortcut:"Shift + R"}],label:$localize`Reset chapter`},{keys:[{shortcut:"P"}],label:$localize`Toggle between pan and rotate mode`},{keys:[{shortcut:"Ctrl/Cmd + Z",pronunciation:"Control or command plus z."}],label:$localize`Undo`},{keys:[{shortcut:"Ctrl/Cmd + Shift + Z",pronunciation:"Control or command plus shift pluz z."},{shortcut:"Ctrl/Cmd + Y",pronunciation:"Control or command plus y."}],label:$localize`Redo`}]},{label:$localize`Pan`,shortcuts:[{keys:[{shortcut:"W"}],label:$localize`Pan up`},{keys:[{shortcut:"S"}],label:$localize`Pan down`},{keys:[{shortcut:"A"}],label:$localize`Pan left`},{keys:[{shortcut:"D"}],label:$localize`Pan right`},{keys:[{shortcut:"Shift + W"}],label:$localize`Slow pan up`},{keys:[{shortcut:"Shift + S"}],label:$localize`Slow pan down`},{keys:[{shortcut:"Shift + A"}],label:$localize`Slow pan left`},{keys:[{shortcut:"Shift + D"}],label:$localize`Slow pan right`}]},{label:$localize`Rotate`,shortcuts:[{keys:[{shortcut:Xo.Up}],label:$localize`Rotate up`},{keys:[{shortcut:Xo.Down}],label:$localize`Rotate down`},{keys:[{shortcut:Xo.Left}],label:$localize`Rotate left`},{keys:[{shortcut:Xo.Right}],label:$localize`Rotate right`},{keys:[{shortcut:`Shift + ${Xo.Up}`}],label:$localize`Slow rotate up`},{keys:[{shortcut:`Shift + ${Xo.Down}`}],label:$localize`Slow rotate down`},{keys:[{shortcut:`Shift + ${Xo.Left}`}],label:$localize`Slow rotate left`},{keys:[{shortcut:`Shift + ${Xo.Right}`}],label:$localize`Slow rotate right`}]},{label:$localize`Zoom`,shortcuts:[{keys:[{shortcut:"E"},{shortcut:"=",pronunciation:"Equals."}],label:$localize`Zoom in`},{keys:[{shortcut:"C"},{shortcut:"-",pronunciation:"Hyphen."}],label:$localize`Zoom out`},{keys:[{shortcut:"Shift + E"},{shortcut:"Shift + =",pronunciation:"Shift plus equals."}],label:$localize`Slow zoom in`},{keys:[{shortcut:"Shift + C"},{shortcut:"Shift + -",pronunciation:"Shift plus hyphen."}],label:$localize`Slow zoom out`}]},{label:$localize`Modify Selected Objects`,shortcuts:[{keys:[{shortcut:"Shift + H"}],label:$localize`Hide selected objects`},{keys:[{shortcut:"Shift + F"}],label:$localize`Fade selected objects`},{keys:[{shortcut:"Shift + I"}],label:$localize`Isolate selected objects`}]},{label:$localize`Media Controls`,shortcuts:[{keys:[{shortcut:"J"}],label:$localize`Rewind 1 second`},{keys:[{shortcut:"L"}],label:$localize`Fast forward 1 second`},{keys:[{shortcut:"K"},{shortcut:"space"}],label:$localize`Play / pause`}]}]}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-shortcuts"]],decls:2,vars:1,consts:[[1,"view-shortcuts"],["class","view-shortcuts__group",4,"ngFor","ngForOf"],[1,"view-shortcuts__group"],[1,"view-shortcuts__label","font-bold"],[1,"view-shortcuts__table"],[4,"ngFor","ngForOf"],["scope","row",1,"view-shortcuts__cell-header"],[1,"view-shortcuts__cell","view-shortcuts__cell--key"],[1,"view-shortcuts__key",3,"innerHTML"],["class","sr-only",4,"ngIf"],[1,"sr-only"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,vv,5,2,"div",1),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",s.shortcutGroups))},dependencies:[J.Sq,J.bT,fv],styles:[".view-shortcuts{display:flex;flex-direction:column}.view-shortcuts__group{width:100%;padding-bottom:32px;margin-top:32px}.view-shortcuts__label{padding:8px 0 12px}.view-shortcuts__table{width:100%}.view-shortcuts__cell{padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__cell-header{text-align:start;padding:8px;border-bottom:1px solid rgba(255,255,255,.3);width:50%}.view-shortcuts__key{border-radius:4px;display:inline-flex;padding:4px;margin-right:4px;background:#000;color:#fff;justify-content:center;align-items:center;font-family:monospace;font-size:16px}.view-shortcuts__key>kbd{margin-inline-end:8px}.view-shortcuts__key>kbd:last-child{margin-inline-end:0}\n"],encapsulation:2,changeDetection:0})}return n})();const Ov=["viewHelp"];class ur{constructor(i,t,o,s){this.dialogRef=i,this.renderer=t,this.store=o,this.data=s,this.helpTypeEnum=te,this.activeTab=te.Basics,this.ngUnsubscribe=new k.B,this.activeTab=s.tab}ngOnInit(){this.initWindowSizeObserver()}ngAfterViewInit(){this.updateViewHeight()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWindowSizeObserver(){this.renderer.listen("window","resize",()=>{this.updateViewHeight()})}updateViewHeight(){const o=rp(this.store.selectSnapshot(vn.getSiteHeader),this.store.selectSnapshot(vn.getSiteHeaderHeight),!1);this.viewHelp.nativeElement.style.setProperty("--vh",`${o}px`)}handleCloseClick(){this.dialogRef.close()}static#e=this.\u0275fac=function(t){return new(t||ur)(e.rXU(vt.CP),e.rXU(e.sFG),e.rXU(l.il),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:ur,selectors:[["app-help-dialog"]],viewQuery:function(t,o){if(1&t&&e.GBs(Ov,7),2&t){let s;e.mGM(s=e.lsd())&&(o.viewHelp=s.first)}},decls:147,vars:1,consts:()=>{let i,t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt,$t,hn,rn,qe,en,Pt,ti,tn,ro,Ka,qa,Ja,nl,Vc,Fc,Gc,$c,Bc,zc,Wc,Xc,Hc,Qc,Yc,Kc,qc,Jc,Zc,ed,td,nd,$e,Tt,He;return i=$localize`:fe6f57177418d5e7beb3165189f76d610996162d7676085147402388734:Navigation Basics`,t=$localize`:429597f3d7d1d78213dcf7dd66eebfde0d86678e6253898756323650322:A heart with an arrow wrapped around it, which symbolises objects being rotated withing the 3D viewport.`,o=$localize`:e18d3340208bca7ddf2d94f70d0a660dbd42385d5773019152243041254:A heart with left and right arrows pointing away from it, which symbolises objects being panned within the 3D viewport`,s=$localize`:d39dadf537d9b0839ce21a28536327f9f5a686c74934730967388350918:A heart with a magnifying glass over it, which symbolises zooming into and out from an object within the 3D viewport.`,a=$localize`:304ad8b02639512724d4bd74a4e0948235755937354592426013976576:A heart with a smaller region colored in blue and a popup window specifying that the Right Ventricle is selected.`,r=$localize`:6cfe97f88f0ed2276b3712e9f9f3afa30a5202816061724875357600922:All Controls`,_=$localize`:18a94681247b809ceced9eb0f694ae4c0d312da46414411281097606478:A mouse with the left button being held in.`,g=$localize`:1170cfcc8c84af3864f78a0492ec1fd7802843688257874423928835005:A mouse with the right button being held in.`,P=$localize`:7af3be3703c527b268af7bdf41dbea65aa79a6ec9056964158501440909:A mouse with the left button being clicked.`,F=$localize`:2060ac29b56620ac4dee9e60c192070663dbe8ae1011682562656049028:A mouse with the left button being double clicked.`,ee=$localize`:3151632192d235a3f169dca7cc9ef84780febe866187030666890085624:A mouse with the left button being held in for a long duration.`,le=$localize`:966f12391c5738cf46c32d1cb6a5f5a8340486424740543999988156181:The arrow keys.`,he=$localize`:6ba68416157f6fe2131511ecdd079903b2eeefb78470097694829285611:The W, A, S and D keys.`,ue=$localize`:0ac7f1fedebf3949fc40233a13c6eb4e0e0406644819033955395086119:The plus and minus keys grouped together or the E and C keys grouped together.`,ye=$localize`:2b78dffe01cdcaf46976e26b031c327066fff0fa6264224730837738660:The shift key.`,Ge=$localize`:a302d6da0d4e760ae27cb11470852686dc8472914683038358223678995:A finger clicking the trackpad once.`,Ve=$localize`:ed595e7bcf6f65d4bfcb7302f8436fdc171e87a12262651993298779843:A finger clicking the trackpad twice.`,it=$localize`:23c69f01719b0c53dea3a4f38b7b6b20b1a68f354216705101587735156:A finger pressing for a long duration on the trackpad.`,ot=$localize`:58f7f1cfc7494c3ad8af6f045a100569af8e763d3981109811663390815:Two fingers pressing the trackpad while moving vertically.`,_t=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,xt=$localize`:85b79c9064aed1ead31ace985f31aa1363f6bdaf7911416166208830577:Help`,$t=$localize`:0ce04cf84ced2fc10b64d8d01c93254302fae7208819530610784848299:Close help modal`,hn=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,rn=$localize`:b2ba3edf1e4f930372c8c0648a80cd8540824bb27927106883889636493:Click and drag or use one finger to change the viewing angle.`,qe=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,en=$localize`:5f2421818b14ff6b2b6760f657072c9d1edf54c0875857706935138088:Hold the shift key and drag or use two fingers to move the model's position.`,Pt=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,ti=$localize`:943378a26adbb00b393fc72f7d8751a3d154419f2968417613352515367:Scroll up and down or pinch with two fingers to zoom in or out.`,tn=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,ro=$localize`:1e2bffd4aecf789df7c101eec013ece36ac4d1b13307141625837320493:Click or tap an anatomic structure or label to learn more.`,Ka=$localize`:06525f75da53823cbe1725093bc86cd88ade8597728862926652618704:Mouse`,qa=$localize`:c3cee0bf85850fda5c38ee3e4d1bff10de4ce5c57193182677599035399:Hold left button to rotate`,Ja=$localize`:23c0d0956b66d711cfe7df58ef6a7b4d07075b004504766784431323465:Hold right button to pan`,nl=$localize`:430665e380a10950da6951cf7f4002d0cc8dd1575037804585803260848:Single-click left button to select a structure`,Vc=$localize`:45cebd73bba4b4553ff774400b20119e5a9d97ff2243293724382272862:Double-click left button to auto-focus on a structure`,Fc=$localize`:7e25565e229d4feddc9c05e1738729a9aac57a287760284646478975781:Long-click to fly to a structure`,Gc=$localize`:acf011d3a80afd38b5f793c53325ed05c673e8235236879271199776564:Keyboard`,$c=$localize`:50b412747cc527764294a1b903ec5c1d62844a111724029931462476938:Rotate with arrows`,Bc=$localize`:07614e55f8def77bf252040fc41cc9453e0fa34d8399776404178179481:Pan up (W), left (A), down (S), right(D)`,zc=$localize`:064d015bd99ad65866112d59a58eb66cd4ed3dcf2527063424056268537:Zoom out (-, C) and zoom in (+, E)`,Wc=$localize`:6b1e5719efa1db70ea28a09765b11b1488dc3dcb3479840639285374289:Hold with any previous key to slow down motion`,Xc=$localize`:3b12deb58592fad9559bee11b1c81a314f6c0dfd5453789791073353804:Trackpad`,Hc=$localize`:03e5f4b8f37c3498d675cce895d5cbbe14f001dd8732399774338102812:Single-tap to auto-focus a structure`,Qc=$localize`:fa6d739684a57595169beedef230af0de5e835f8893674047997882971:Double-tap to select a structure`,Yc=$localize`:38d81be3a0506d3d76acab0eb9ba6d756e643b9e6955199594650294227:Long-press to fly to a structure`,Kc=$localize`:bbc241c56a687bd4b728277bbbfc5714fe71564d8600401187735507174:Scroll up and down to zoom`,qc=$localize`:2d2c5215cbb8cb0c926c8d132668eb16275558b08973369245527156970:In-App`,Jc=$localize`:74d17ea41b9374ceefcf8f7c763a1176cd96dbae491840984763060870: The plus symbol, which represents zooming in in the camera control menu. `,Zc=$localize`:e28ee80cd3a124e109793180dfd1f8d8067dcc6b6500061599200357251:Zoom in`,ed=$localize`:402a1f359e7c008f0aef6b084fafaf2f49ce56d3399413764515891152: The minus symbol, which represents zooming out in the camera control menu. `,td=$localize`:a3dfc58748f790fa096cf3c5fc331f90846e1772944767796496567082:Zoom out`,nd=$localize`:c4f9fc3dd4d06c87f09dc68e8e0a3b38ae4948ff7289327967342552784: The map pin symbol, which resets the camera in the camera control menu. `,$e=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,Tt=$localize`:5108bd6e5963ccd847b1a768fd214262ccfbc81d8038524584906192988: Arrows pointing in four directions, which represents panning in the camera control menu. `,He=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,[["viewHelp",""],xt,$t,hn,rn,qe,en,Pt,ti,tn,ro,Ka,qa,Ja,nl,Vc,Fc,Gc,$c,Bc,zc,Wc,Xc,Hc,Qc,Yc,Kc,qc,Jc,Zc,ed,td,nd,$e,Tt,He,["role","dialog","aria-labelledby","helpTitle",1,"view-help"],["id","helpTitle",1,"view-help__header"],["type","button",1,"view-help__close",3,"click"],["icon","times","aria-hidden","true"],[1,"sr-only"],[1,"view-help__inner"],["tabSize","medium","tabAlign","center","cdkFocusInitial","",3,"activeTab"],["label",i,"id","helpBasics","aria-controls","basicsPanel"],["role","tabpanel","aria-labelledby","helpBasics","tabindex","0","id","basicsPanel"],[1,"view-help__group"],[1,"view-help__item"],[1,"view-help__image"],["src","assets/images/widget/help-rotate.svg","alt",t],[1,"view-help__label"],["src","assets/images/widget/help-pan.svg","alt",o],["src","assets/images/widget/help-zoom.svg","alt",s],["src","assets/images/widget/help-learn.svg","alt",a],["label",r,"id","helpAll","aria-controls","allPanel"],["role","tabpanel","aria-labelledby","helpAll","tabindex","0","id","allPanel"],[1,"view-help__section-header"],["src","assets/images/widget/help-mouse-hold-left.svg","alt",_],["src","assets/images/widget/help-mouse-hold-right.svg","alt",g],["src","assets/images/widget/help-mouse-single-click-left.svg","alt",P],["src","assets/images/widget/help-mouse-double-click-left.svg","alt",F],["src","assets/images/widget/help-mouse-long-press-left.svg","alt",ee],["src","assets/images/widget/help-keyboard-rotate.svg","alt",le],["src","assets/images/widget/help-keyboard-pan.svg","alt",he],["src","assets/images/widget/help-keyboard-zoom.svg","alt",ue],["src","assets/images/widget/help-keyboard-slow-motion.svg","alt",ye],["src","assets/images/widget/help-trackpad-single-tap.svg","alt",Ge],["src","assets/images/widget/help-trackpad-double-tap.svg","alt",Ve],["src","assets/images/widget/help-trackpad-long-press.svg","alt",it],["src","assets/images/widget/help-trackpad-scroll.svg","alt",ot],["icon","plus","aria-hidden","true",1,"view-help__icon"],["icon","minus","aria-hidden","true",1,"view-help__icon"],["icon","location","aria-hidden","true",1,"view-help__icon"],["icon","arrows","aria-hidden","true",1,"view-help__icon"],["label",_t,"id","helpShortcuts","aria-controls","shortcutsPanel"],["role","tabpanel","aria-labelledby","helpShortcuts","tabindex","0","id","shortcutsPanel"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",36,0)(2,"h2",37),e.pXf(3,1),e.k0s(),e.j41(4,"button",38),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleCloseClick())}),e.nrm(5,"app-icon",39),e.j41(6,"span",40),e.pXf(7,2),e.k0s()(),e.j41(8,"div",41)(9,"app-tabs",42)(10,"app-tab",43)(11,"div",44)(12,"ul",45)(13,"li",46)(14,"div",47),e.nrm(15,"img",48),e.k0s(),e.j41(16,"div",49),e.pXf(17,3),e.k0s(),e.qex(18),e.pXf(19,4),e.bVm(),e.k0s(),e.j41(20,"li",46)(21,"div",47),e.nrm(22,"img",50),e.k0s(),e.j41(23,"div",49),e.pXf(24,5),e.k0s(),e.qex(25),e.pXf(26,6),e.bVm(),e.k0s(),e.j41(27,"li",46)(28,"div",47),e.nrm(29,"img",51),e.k0s(),e.j41(30,"div",49),e.pXf(31,7),e.k0s(),e.qex(32),e.pXf(33,8),e.bVm(),e.k0s(),e.j41(34,"li",46)(35,"div",47),e.nrm(36,"img",52),e.k0s(),e.j41(37,"div",49),e.pXf(38,9),e.k0s(),e.qex(39),e.pXf(40,10),e.bVm(),e.k0s()()()(),e.j41(41,"app-tab",53)(42,"div",54)(43,"h3",55),e.pXf(44,11),e.k0s(),e.j41(45,"ul",45)(46,"li",46)(47,"div",47),e.nrm(48,"img",56),e.k0s(),e.qex(49),e.pXf(50,12),e.bVm(),e.k0s(),e.j41(51,"li",46)(52,"div",47),e.nrm(53,"img",57),e.k0s(),e.qex(54),e.pXf(55,13),e.bVm(),e.k0s(),e.j41(56,"li",46)(57,"div",47),e.nrm(58,"img",58),e.k0s(),e.qex(59),e.pXf(60,14),e.bVm(),e.k0s(),e.j41(61,"li",46)(62,"div",47),e.nrm(63,"img",59),e.k0s(),e.qex(64),e.pXf(65,15),e.bVm(),e.k0s(),e.j41(66,"li",46)(67,"div",47),e.nrm(68,"img",60),e.k0s(),e.qex(69),e.pXf(70,16),e.bVm(),e.k0s()(),e.j41(71,"h3",55),e.pXf(72,17),e.k0s(),e.j41(73,"ul",45)(74,"li",46)(75,"div",47),e.nrm(76,"img",61),e.k0s(),e.qex(77),e.pXf(78,18),e.bVm(),e.k0s(),e.j41(79,"li",46)(80,"div",47),e.nrm(81,"img",62),e.k0s(),e.qex(82),e.pXf(83,19),e.bVm(),e.k0s(),e.j41(84,"li",46)(85,"div",47),e.nrm(86,"img",63),e.k0s(),e.qex(87),e.pXf(88,20),e.bVm(),e.k0s(),e.j41(89,"li",46)(90,"div",47),e.nrm(91,"img",64),e.k0s(),e.qex(92),e.pXf(93,21),e.bVm(),e.k0s()(),e.j41(94,"h3",55),e.pXf(95,22),e.k0s(),e.j41(96,"ul",45)(97,"li",46)(98,"div",47),e.nrm(99,"img",65),e.k0s(),e.qex(100),e.pXf(101,23),e.bVm(),e.k0s(),e.j41(102,"li",46)(103,"div",47),e.nrm(104,"img",66),e.k0s(),e.qex(105),e.pXf(106,24),e.bVm(),e.k0s(),e.j41(107,"li",46)(108,"div",47),e.nrm(109,"img",67),e.k0s(),e.qex(110),e.pXf(111,25),e.bVm(),e.k0s(),e.j41(112,"li",46)(113,"div",47),e.nrm(114,"img",68),e.k0s(),e.qex(115),e.pXf(116,26),e.bVm(),e.k0s()(),e.j41(117,"h3",55),e.pXf(118,27),e.k0s(),e.j41(119,"ul",45)(120,"li",46),e.nrm(121,"app-icon",69),e.j41(122,"span",40),e.pXf(123,28),e.k0s(),e.qex(124),e.pXf(125,29),e.bVm(),e.k0s(),e.j41(126,"li",46),e.nrm(127,"app-icon",70),e.j41(128,"span",40),e.pXf(129,30),e.k0s(),e.qex(130),e.pXf(131,31),e.bVm(),e.k0s(),e.j41(132,"li",46),e.nrm(133,"app-icon",71),e.j41(134,"span",40),e.pXf(135,32),e.k0s(),e.qex(136),e.pXf(137,33),e.bVm(),e.k0s(),e.j41(138,"li",46),e.nrm(139,"app-icon",72),e.j41(140,"span",40),e.pXf(141,34),e.k0s(),e.qex(142),e.pXf(143,35),e.bVm(),e.k0s()()()(),e.j41(144,"app-tab",73)(145,"div",74),e.nrm(146,"app-view-shortcuts"),e.k0s()()()()()}2&t&&(e.R7$(9),e.Y8G("activeTab",o.activeTab))},dependencies:[ut.R,im.j,om.O,Ev],styles:[".view-help{background-color:#0c1726e6;color:#fff;display:flex;align-items:center;flex-direction:column;position:fixed;top:0;left:0;right:0;z-index:10000;height:100vh;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:auto}.view-help__inner{width:100%;max-width:1140px;height:99vh;height:calc(var(--vh, 1vh) * 99);padding:32px;position:relative}.view-help__close{color:#fff;width:40px;height:40px;display:flex;align-items:center;justify-content:center;position:fixed;right:8px;top:8px;z-index:10;border:none;background:none}.view-help__header{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__section-header{font-size:.75rem;line-height:1rem;border-bottom:1px solid rgba(255,255,255,.3);font-weight:600;padding-bottom:12px;margin-top:32px}.view-help__label{font-size:.875rem;line-height:1.25rem;font-weight:600;margin-bottom:12px}.view-help__group{display:flex;justify-content:space-around;flex-wrap:wrap}.view-help__item{font-size:.75rem;line-height:1rem;display:flex;flex-flow:column;text-align:center;padding:20px;flex:0 1 180px}.view-help__image{justify-content:center;margin-bottom:16px;width:160px;height:100px}.view-help__icon{font-size:24px;margin-bottom:16px}\n"],encapsulation:2,changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(de.getCanTouch),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],ur.prototype,"canTouch$",void 0);var Ti=d(3829),Hl=function(n){return n.DiscoveredChapterNav="Discovered Chapter Nav",n}(Hl||{}),Sa=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Ni=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class sm{}const am={audioMuted:!0,autoplayAudio:!1};let Xi=class Md{static getAudioMuted(i){return i.audioMuted}static getAutoplayAudio(i){return i.autoplayAudio}setAudioMuted(i,t){const o=jn.jM(i.getState(),s=>{s.audioMuted=t.mute});i.setState(o)}setAutoplayAudio(i,t){const o=jn.jM(i.getState(),s=>{s.autoplayAudio=t.autoplay});i.setState(o)}resetAudio(i,t){i.setState(am)}static#e=this.\u0275fac=function(t){return new(t||Md)};static#t=this.\u0275prov=e.jDH({token:Md,factory:Md.\u0275fac})};Sa([(0,l.rc)(yi.SetAudioMuted),Ni("design:type",Function),Ni("design:paramtypes",[Object,yi.SetAudioMuted]),Ni("design:returntype",void 0)],Xi.prototype,"setAudioMuted",null),Sa([(0,l.rc)(yi.SetAutoplayAudio),Ni("design:type",Function),Ni("design:paramtypes",[Object,yi.SetAutoplayAudio]),Ni("design:returntype",void 0)],Xi.prototype,"setAutoplayAudio",null),Sa([(0,l.rc)(yi.ResetAudio),Ni("design:type",Function),Ni("design:paramtypes",[Object,yi.ResetAudio]),Ni("design:returntype",void 0)],Xi.prototype,"resetAudio",null),Sa([(0,l.MD)(),Ni("design:type",Function),Ni("design:paramtypes",[sm]),Ni("design:returntype",void 0)],Xi,"getAudioMuted",null),Sa([(0,l.MD)(),Ni("design:type",Function),Ni("design:paramtypes",[sm]),Ni("design:returntype",void 0)],Xi,"getAutoplayAudio",null),Xi=Sa([(0,l.Uw)({name:"media",defaults:am})],Xi);var ls=d(46842),hi=d(65776);class Mv{constructor(){this.type=hi.m.Positions,this.positions=[]}}var Ql=d(1308),pp=d(30582),hr=d(9592),Iv=d(97415),rm=d(10352);let up=(()=>{class n{constructor(t,o,s,a,r,_){this.store=t,this.actions=o,this.cameraService=s,this.snapshotService=a,this.imagesService=r,this.contentBlocksService=_,this.startingPositionClipboard=null,this.additionalPositionClipboard=null,this.additionalPositionsClipboard=null}getCamera(){const t=this.cameraService.getCamera(),o=t.look,s=this.cameraService.getCameraRotationCenter();let a;return this.cameraService.compareXYZ(o,s)||(a=s),{location:t,rotationCenter:a}}getChapterStartingPosition(t){return{camera:this.store.selectSnapshot(me.N.getChapter(t)).camera,thumbnail:this.store.selectSnapshot(Go.K.getRegisteredThumbnails).get(t)}}startingPositionToAdditionalPosition(t){const{camera:o,thumbnail:s}=this.getChapterStartingPosition(t),{location:a,rotationCenter:r,title:_}=o;return{camera:{location:a,rotationCenter:r,action:Bd.L.FlyTo},thumbnail:s,title:_}}copyStartingPosition(t){let o=!1;const{camera:s,thumbnail:a}=this.getChapterStartingPosition(t);return s&&a&&(this.startingPositionClipboard=(0,u.cloneDeep)({camera:s,thumbnail:a}),o=!0),o}pasteStartingPosition(t=!1){let o=0;if(this.startingPositionClipboard){const{camera:s,thumbnail:a}=this.startingPositionClipboard,r=t?this.store.selectSnapshot(me.N.getStoryChapters):[this.store.selectSnapshot(me.N.getSelectedChapter)];r.forEach(_=>{this.store.dispatch(new Nn.tn(_.id,s.location,s.rotationCenter)),this.store.dispatch(new Nn.pN(_.id,s.title)),this.store.dispatch(new Ts.cf(_.id,a))}),this.store.dispatch(new Ut.Ih(s.location)),o=r.length}return this.clearStartingPosition(),o}clearStartingPosition(){this.startingPositionClipboard=null}copyAdditionalPosition(t){this.additionalPositionClipboard=(0,u.cloneDeep)(t)}clearAdditionalPosition(){this.additionalPositionClipboard=null}copyAdditionalPositions(t){this.additionalPositionsClipboard=(0,u.cloneDeep)(t)}pasteAdditionalPositions(t=!1){let o=0;if(this.additionalPositionsClipboard){const s=t?this.store.selectSnapshot(me.N.getStoryChapters):[this.store.selectSnapshot(me.N.getSelectedChapter)];s.forEach(a=>{let r=this.contentBlocksService.findContentBlockByType(a.contentBlocks,hi.m.Positions);r||(r=new Mv,a.contentBlocks.push(r)),r.positions.push(...this.additionalPositionsClipboard),this.store.dispatch(new Nn.jo(a.id,[...a.contentBlocks],!1))}),o=s.length}return this.clearAdditionalPositions(),o}clearAdditionalPositions(){this.additionalPositionsClipboard=null}clearAllClipboards(){this.clearStartingPosition(),this.clearAdditionalPosition(),this.clearAdditionalPositions()}captureStartingPositionCamera(t){const o=this.getCamera();this.store.dispatch(new Nn.tn(t,o.location,o.rotationCenter))}captureStartingPositionThumbnail(t){var o=this;return(0,pt.A)(function*(){const{background:s,imageType:a,imageQuality:r,dimensions:_,crop:g,includeLabels:P,includeCopyright:F,layers:ee}=o.getThumbnailSettings(t);return o.store.dispatch(new Ts.V9(t,s,a,r,_,g,P,F,ee)),yield(0,Ci._)(o.actions.pipe((0,l.rM)(Ts.WX)))})()}captureAdditionalPositionThumbnail(t){var o=this;return(0,pt.A)(function*(){const{background:s,imageType:a,imageQuality:r,dimensions:_,crop:g,includeLabels:P,includeCopyright:F,layers:ee}=o.getThumbnailSettings(t),le={...Ql._,crop:g,imageType:a,imageQuality:r,copyrightEnabled:F},he=yield(0,Ci._)(o.snapshotService.takeSnapshot(_.width,_.height,s,ee,P,le)),ue=yield(0,Ci._)(o.imagesService.saveImageBlob(he));return{small:ue.uris.small,large:ue.uris.large}})()}getThumbnailSettings(t){return{background:this.store.selectSnapshot(me.N.getChapter(t)).background??rm.RK,imageType:hr.H.JPEG,imageQuality:92,dimensions:Iv.I.medium,crop:"square",includeLabels:!1,includeCopyright:!1,layers:[]}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(l.En),e.KVO(go.j),e.KVO(pp.M),e.KVO($l),e.KVO(Ns.V))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var mo=d(18617),gr=d(90953);let En=(()=>{class n{constructor(t,o,s,a,r,_,g,P,F,ee,le){this.dialog=t,this.store=o,this.location=s,this.transitionService=a,this.mediaService=r,this.sceneService=_,this.viewUIService=g,this.vendorAnalyticsService=P,this.liveAnnouncer=F,this.overlayContainer=ee,this.positionsService=le,this.materialOverlayOut$=new k.B}initStory(t,o,s){const a="preview"===t;this.store.dispatch(new Ie.Xt(t,o,a)),this.store.dispatch(new ct.yi(t,o,!0));const r=this.store.select(ze.S.getReady),_=this.store.select(dt.getIncomingStoryInfo);(0,cn.z)([r,_]).pipe((0,D.p)(([g,P])=>g&&!!P.id),(0,qt.s)(1)).subscribe(()=>{this.store.dispatch(new Nn.yz),this.store.dispatch(new ct.Ye(t,o,s,a))})}nextChapter(t){const o=this.store.selectSnapshot(me.N.getSelectedChapterIndex),s=this.store.selectSnapshot(me.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Hl.DiscoveredChapterNav,{source:t,breakpoint:this.store.selectSnapshot(Dn.getHorizontalBreakpointLabel)});const a=s[o+1];a&&this.selectChapter(a)}previousChapter(t){const o=this.store.selectSnapshot(me.N.getSelectedChapterIndex),s=this.store.selectSnapshot(me.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(Hl.DiscoveredChapterNav,{source:t,breakpoint:this.store.selectSnapshot(Dn.getHorizontalBreakpointLabel)});const a=s[o-1];a&&this.selectChapter(a)}firstChapter(t){const o=this.store.selectSnapshot(me.N.getStoryChapters);this.vendorAnalyticsService.trackOncePerSession(t,{source:t,breakpoint:this.store.selectSnapshot(Dn.getHorizontalBreakpointLabel)});const s=o[0];s&&this.selectChapter(s)}selectChapter(t){var o=this;return(0,pt.A)(function*(){if(!o.store.selectSnapshot(Fe.j.getQuizModeActive)){const r=o.store.selectSnapshot(me.N.getSelectedChapterId),_=t.id,g=o.store.selectSnapshot(me.N.getStoryChapters);let P=null;o.store.selectSnapshot(ls.U.getPrefersReducedMotion)||(P=o.transitionService.searchChapterTransitions(r,_,g)),o.vendorAnalyticsService.trackOncePerSession(Hl.DiscoveredChapterNav,{source:"Chapter List",breakpoint:o.store.selectSnapshot(Dn.getHorizontalBreakpointLabel)}),o.store.dispatch(new Ut.gV(r,o.positionsService.getCamera())),P&&(yield o.chapterTransition(P)),o.store.dispatch([new ct.si(t.id),new Nn.yz(t)])}const a=document.getElementById("chapter-title");a&&setTimeout(()=>a.querySelector("button").focus(),200)})()}chapterTransition(t){return new Promise(o=>{t.camera&&this.store.dispatch(new Ut.Ih(t.camera,!0,t.duration)),t.fadeColor&&this.store.dispatch(new st.zW(t.fadeColor,t.duration)),setTimeout(()=>{o(!0)},1e3*t.duration)})}hideSelectedStructures(){const t=this.store.selectSnapshot(Rn.z.getCheckedNodeIds);this.store.dispatch(new Vt.yr(!1,t))}selectTool(t){this.store.selectSnapshot(Fe.j.getQuizModeActive)&&t===dn.s.Select&&(t=dn.s.Quiz),this.store.dispatch(new st.pL(t))}toggleAutoplay(t){t=t??!this.store.selectSnapshot(de.getAutoplay),this.store.dispatch(new E.SetAutoplay(t))}toggleAnimation(){const t=this.store.selectSnapshot(ze.S.getAnimationPlaying);this.store.dispatch(new st.dE(!t))}toggleMedia(t){const o=this.store.selectSnapshot(Ke.getUI);o.media.status=(t=t??o.media.status!==mt.Show)?mt.Show:mt.Collapse,this.store.dispatch(new Vn.SetUI(o))}toggleDrawer(t,o=!1){const s=this.store.selectSnapshot(Ke.getUI);null==t&&(t=s.drawer.status==mt.Hide?mt.Show:mt.Hide),s.drawer.status=t,o&&(s.drawer.userStatusPreference=s.drawer.status),this.store.dispatch(new Vn.SetUI(s))}toggleColumn(t){const o=this.store.selectSnapshot(Ke.getUI);null==t&&(t=o.column.status!==mt.Show),o.column.status=t?mt.Show:mt.Collapse,o.column.userStatusPreference=o.column.status,this.store.dispatch(new Vn.SetUI(o))}togglePresentation(){this.store.selectSnapshot(de.getPresentationActive)?this.stopPresentation():this.startPresentation()}startPresentation(){this.store.dispatch(new E.TogglePresentation(!0))}stopPresentation(){this.store.dispatch(new E.TogglePresentation(!1))}toggleHelp(t=te.Basics){0===this.dialog.openDialogs.length&&this.dialog.open(ur,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{tab:t}})}toggleInteract(t){this.store.dispatch(new E.ToggleWindow(_n.Interact,t))}toggleOnDemand(t){this.store.dispatch(new E.SetOnDemand(t)),this.store.dispatch(new E.ToggleWindow(_n.OnDemand,t))}togglePlaythrough(t,o){this.store.dispatch(new E.SetPlaythroughEnabled(t)),(0,u.isNil)(o)||this.store.dispatch(new E.SetForceAudio(o))}toggleTutorial(t){this.store.dispatch(new E.ToggleWindow(_n.Tutorial,t)),t&&this.store.dispatch(new E.StartTutorial(!0))}toggleWhiteboard(t){this.store.dispatch(new E.ToggleWindow(_n.Whiteboard,t)),t&&this.store.dispatch(new E.SetWhiteboardEnabled(!0))}showLabels(t){const o=this.store.selectSnapshot(Ke.getUI);t=(0,u.isNil)(t)?!o.labels.shown:t,o.labels.shown=t,this.store.dispatch(new Vn.SetUI(o))}toggleLabels(t){this.store.dispatch(new st.Gv(t))}togglePan(){const t="pan"===this.store.selectSnapshot(Ti.x.getPanMode)?"rotate":"pan";this.store.dispatch(new Ut.vq(t))}toggleSearch(t=uo.q.List,o){const s=this.store.selectSnapshot(Ke.getUI);s.search.status=(o=o??s.search.status!==mt.Show)?mt.Show:mt.Collapse,o&&(s.visibilityLayers.status=mt.Collapse,s.nodeInfo.status=mt.Hide),this.store.dispatch(new E.SetSearchDisplayMode(t)),this.store.dispatch(new Vn.SetUI(s))}toggleLayers(t){const o=this.store.selectSnapshot(de.getLayout);this.viewUIService.getViewLayout(o)===Yn.Drawer?this.toggleLayersDrawer(t):this.toggleLayersColumn(t)}toggleLayersColumn(t){const o=this.store.selectSnapshot(Ke.getUI);o.visibilityLayers.status=(t=t??o.visibilityLayers.status!==mt.Show)?mt.Show:mt.Collapse,t&&(o.search.status=mt.Collapse,o.nodeInfo.status=mt.Hide),this.store.dispatch(new Vn.SetUI(o))}toggleLayersDrawer(t){const o=this.store.selectSnapshot(de.getContentMode);this.setContentMode((t=t??o!==Bt.VisibilityLayers)?Bt.VisibilityLayers:null),this.toggleDrawer(t?mt.Show:mt.Hide)}toggleNodeInfo(t){this.setContentMode(t?Bt.NodeInfo:null)}toggleLabelInfo(t){const o=this.store.selectSnapshot(Ke.getVisible(G.Drawer)),s=this.store.selectSnapshot(de.getContentMode);t=(0,u.isNull)(t)?!o:t;const a=this.store.selectSnapshot(et.getSelectedLabel),r=this.store.selectSnapshot(Ke.getVisible(G.LabelList)),_=o&&r;if(t&&a)this.toggleDrawer(_&&s===Bt.ChapterInfo||a?.description||a.contentBlocks?.length>0?mt.Show:mt.Collapse),_||this.setContentMode(Bt.LabelInfo);else{if(_&&s===Bt.ChapterInfo)return;this.toggleDrawer(mt.Hide)}}playChapterAudio(t=!1){const o=this.store.selectSnapshot(de.getViewLanguage),s=this.store.selectSnapshot(me.N.getSelectedChapter);this.mediaService.stopAllAudio(),this.mediaService.getChapterAudioPlayer(s,o,t).then(a=>{if((this.store.selectSnapshot(Xi.getAutoplayAudio)||t)&&this.store.selectSnapshot(me.N.getSelectedChapterId)===s.id){const g=this.store.selectSnapshot(Xi.getAudioMuted);this.mediaService.playAudio(s.id,g)}})}setContentMode(t){t||(t=Bt.ChapterInfo),this.store.dispatch(new E.SetContentMode(t))}delegateNodeClick(t,o){if(this.clearSelectedLabel(),t||o?.srcEvent.shiftKey)if(o?.srcEvent.shiftKey||this.store.selectSnapshot(de.getMultiPickModeEnabled))this.checkNode(t);else switch(this.store.selectSnapshot(ze.S.getActiveTool)){case dn.s.Hide:this.hideNode(t);break;case dn.s.Select:this.selectNode(t);break;case dn.s.Isolate:this.isolateNode(t);break;case dn.s.Fade:this.fadeNode(t)}else this.clearSelectedNodes()}clearSelectedLabel(){this.store.dispatch(new Je.TR)}clearSelectedNodes(){this.store.dispatch(new Vt.hg),this.store.dispatch(new Vt.q9(!1))}clearFadedNodes(){const t=this.store.selectSnapshot(me.N.getSelectedChapterId);this.store.dispatch(new bi.a.UndoAll(t))}checkNode(t,o){void 0!==t&&(null==o&&(o=this.store.selectSnapshot(Rn.z.getNodes)[t.id].checked),this.store.dispatch(new Vt.q9(!o,[t.id])),this.store.dispatch(new Vt.hg(t.id)))}fadeNode(t){this.store.dispatch(new Vt.Jp(Ms.EC,[t.id]))}isolateNode(t){this.store.dispatch(new Vt.yr(!1)),this.store.dispatch(new Vt.yr(!0,[t.id]))}selectNode(t){const o=!this.store.selectSnapshot(Rn.z.getNodes)[t.id].checked;this.store.dispatch(new Vt.q9(!1)),o&&(this.store.dispatch(new Vt.q9(!0,[t.id])),this.store.dispatch(new Vt.hg(t.id))),this.store.dispatch(new st._o(t));const s=this.store.selectSnapshot(de.getNodeInfoFallback),a=this.store.selectSnapshot(de.getViewLanguage);this.store.dispatch(new st.bo(t,s,a))}hideNode(t){this.store.dispatch(new Vt.yr(!1,[t.id])),this.store.dispatch(new Vt.q9(!1))}selectLabel(t,o=!1){const{objectId:s,states:a}=t;this.store.dispatch(new Je.TR(t)),o&&s&&0===a.length&&this.store.dispatch(new st.W6(s,!0))}applyChapterCamera(t){if(this.store.selectSnapshot(Ti.x.getChapterCameraEnabled)){const o=this.store.selectSnapshot(Ti.x.getChapterCameraPositions).get(t.id)??t.camera;this.store.dispatch(new Ut.Ih(o.location,t.camera.action===Bd.L.FlyTo,void 0,o.rotationCenter))}}applyChapterScenegraph(t){const o=this.sceneService.createViewGraph({availableObjects:t.availableObjects,viewGraphMetadata:this.store.selectSnapshot(ze.S.getViewGraphMetadata)});this.store.dispatch(new st.LL(o)),this.store.dispatch(new Vt.IA(t.id))}playChapterFromStart(){this.store.dispatch(new st.K6)}resetCamera(){const o=this.store.selectSnapshot(me.N.getSelectedChapter)?.camera?.location;(0,u.isNil)(o)||this.store.dispatch(new Ut.Ih(o))}resetChapter(){this.resetCamera();const t=this.store.selectSnapshot(me.N.getSelectedChapterId);this.store.dispatch(new bi.a.UndoAll(t)).subscribe(()=>{this.liveAnnouncer.announce("reset complete")}),this.store.dispatch(new Vt.q9(!1)),this.store.dispatch(new Je.S3)}resetUI(){const t=this.store.selectSnapshot(Ke.getUI);this.viewUIService.isUIHidden()?Object.keys(t).forEach(o=>{t[o].status=mt.Hide}):(this.store.selectSnapshot(Fe.j.getQuizModeActive)||(t.drawer.status=t.drawer.isExpandedInitially?mt.Show:mt.Hide),Object.keys(t).forEach(s=>{t[s].userStatusPreference?t[s].status=t[s].userStatusPreference:s!==G.Drawer&&(t[s].status=mt.Show)}),t.search.status=mt.Collapse,t.visibilityLayers.status=mt.Collapse,t.nodeInfo.status=mt.Hide,t.media.status=mt.Collapse,t.quizPrompt.status=this.store.selectSnapshot(Fe.j.hasQuiz)?mt.Show:mt.Hide),this.store.dispatch(new Vn.SetUI(t))}resetContentMode(){const o=this.store.selectSnapshot(Fe.j.getQuizModeActive)?Bt.Quiz:Bt.ChapterInfo;this.store.dispatch(new E.SetContentMode(o))}undo(){this.store.dispatch(new bi.a.Undo(this.store.selectSnapshot(me.N.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("undo complete")})}redo(){this.store.dispatch(new bi.a.Redo(this.store.selectSnapshot(me.N.getSelectedChapterId))).subscribe(()=>{this.liveAnnouncer.announce("redo complete")})}toggleTools(t){const o=this.store.selectSnapshot(Ke.getUI);o.tools.status=(t=t??o.tools.status!==mt.Show)?mt.Show:mt.Collapse,this.store.dispatch(new Vn.SetUI(o))}closeToolbar(){const t=this.store.selectSnapshot(Ke.getUI);t.media.status=mt.Hide,t.tools.status=mt.Hide,t.visibilityLayers.status=mt.Hide,this.selectTool(dn.s.Select),this.store.dispatch(new Vn.SetUI(t))}normalizeQueryParams(t){const o={...t};return{id:(0,pl.mF)(o),type:(0,pl.lm)(o),lang:t.lang}}sanitizeRouteId(t){return t=t.replace(/\.json$/,""),this.location.replaceState("view",`?id=${t}`),t}openInNewTab(){const t=window.document.location.href;window.open(t)}getComputedTransform(t){const a=getComputedStyle(t).transform.replace("matrix3d","").replace("matrix","").replace("(","").replace(")","").split(",").map(g=>g.trim()).map(g=>parseInt(g,10)),r=16===a.length?a[12]:a[4],_=16===a.length?a[13]:a[5];return Number.isNaN(r)||Number.isNaN(_)?null:{x:r,y:_}}setUI(t){let o=new fa;o=rs(o,t.xrUIConfig),o=rs(o,t.quizUIConfig),o=rs(o,t.apiUIConfig),o=rs(o,t.urlUIConfig),o=rs(o,t.chapterUIConfig),o=rs(o,t.baseUIConfig),this.store.selectSnapshot(ls.U.getPrefersReducedMotion)&&(o.media=Bi.Full);const a=nm(this.store.selectSnapshot(Ke.getUI),o);this.store.dispatch(new Vn.SetUI(a))}setViewLanguage(t="en"){this.store.dispatch(new E.SetViewLanguage(t))}setViewLogos(t){this.store.dispatch(new z_.v9(t))}setHeaderLogos(t){this.store.dispatch(new z_.vf(t))}setAnatomyDescriptionFallback(t){this.store.dispatch(new E.SetNodeInfoConfig(t))}observeMaterialOverlay(){this.materialOverlayObserver=new MutationObserver(()=>{this.materialOverlayOut$.next(this.isMaterialOverlayOut())}),this.materialOverlayObserver.observe(this.overlayContainer.getContainerElement(),{childList:!0})}unobserveMaterialOverlay(){this.materialOverlayObserver&&this.materialOverlayObserver.disconnect(),this.materialOverlayOut$.complete()}isMaterialOverlayOut(){return this.overlayContainer.getContainerElement().childElementCount>0}isMaterialMenuOut(){return null!==this.overlayContainer.getContainerElement().querySelector("[role=menu]")}elementHasFocus(t){return!(!t||!t.contains(document.activeElement))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(vt.bZ),e.KVO(l.il),e.KVO(J.aZ),e.KVO(Gy),e.KVO(vi),e.KVO(Fi.w),e.KVO(lp),e.KVO(ve),e.KVO(mo.Ai),e.KVO(gr.Sf),e.KVO(up))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Pv=(()=>{class n{constructor(t){this.viewService=t}initialize(){window.BDGlobalActions={toggleTutorial:t=>this.viewService.toggleTutorial(t)}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(En))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Yl=function(n){return n.APIKey="apikey",n.UserAnalyticId="uaid",n.ProductKey="productkey",n.UserId="userid",n}(Yl||{});class mr{constructor(i,t,o,s,a,r){this.store=i,this.router=t,this.vendorAnalyticsService=o,this.globalActionsService=s,this.engineService=a,this.productService=r,this.title="Biodigital Human",this.ngUnsubscribe=new k.B}ngOnInit(){this.initVendorAnalytics(),this.initPageAnalytics(),this.initInputObserver(),this.initGPUAnalytics(),this.initStats(),this.globalActionsService.initialize()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initVendorAnalytics(){this.vendorAnalyticsService.appendScripts(),this.vendorAnalyticsService.initialize({},{})}initInputObserver(){this.inputEnabled$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new E.SetInputEnabled(i))})}initPageAnalytics(){this.router.events.pipe((0,D.p)(i=>i instanceof K.wF),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{})}initGPUAnalytics(){const{dk:i,uaid:t,"app-productkey":o}=this.store.selectSnapshot(Z.getWidgetUrlConfig);let r,_;i?(r=Yl.APIKey,_=i):t?(r=Yl.UserAnalyticId,_=t):o&&(r=Yl.ProductKey,_=o),this.engineService.initAnalytics(this.productService.productType,o||this.productService.productKey,r,_)}initStats(){const i=new URLSearchParams(window.location.search),t="true"===i.get("ui-stats");this.store.dispatch(new st.BM(t,!0));const o=i.get("engine-context");("webgl"===o||"webgl2"===o)&&this.store.dispatch(new st.vA(o))}static#e=this.\u0275fac=function(t){return new(t||mr)(e.rXU(l.il),e.rXU(K.Ix),e.rXU(ve),e.rXU(Pv),e.rXU(v.y),e.rXU(De))};static#t=this.\u0275cmp=e.VBU({type:mr,selectors:[["app-root"]],decls:1,vars:0,template:function(t,o){1&t&&e.nrm(0,"router-outlet")},dependencies:[K.n3],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Z.getInputEnabled),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],mr.prototype,"inputEnabled$",void 0);var Li=d(29160),Rv=d(81027),Nv=d(24911),hp=d(4664),wn=d(87996),Ho=d(9065),ks=d(1670),Kl=function(n){return n[n.Content=0]="Content",n[n.Label=1]="Label",n[n.Tools=2]="Tools",n[n.Search=3]="Search",n[n.Help=4]="Help",n[n.NodeInfo=5]="NodeInfo",n[n.LabelInfo=6]="LabelInfo",n}(Kl||{}),oi=d(73828),kv=d(38465),lm=function(n){return n[n.Main=0]="Main",n[n.Media=1]="Media",n[n.Tools=2]="Tools",n[n.Whiteboard=3]="Whiteboard",n[n.VisibilityLayers=4]="VisibilityLayers",n[n.Empty=5]="Empty",n}(lm||{}),Ds=d(62943),fr=d(90699),rt=d(65294),Qo=d(24552),Po=d(83621);let ba=(()=>{class n{constructor(t,o,s){this.store=t,this.viewService=o,this.applicationEventService=s}startQuiz(){this.viewService.toggleColumn(!0),this.viewService.toggleLabels(!1),this.viewService.toggleLayers(!1),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Ut.nW),this.viewService.setContentMode(Bt.Quiz),this.store.dispatch(new Xt.B.SetQuizActive(!0));const t=this.store.selectSnapshot(Fe.j.getAllQuestions)[0].id;this.store.dispatch(new Xt.B.SetActiveQuestion(t))}resetQuiz(){this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Ut.nW),this.store.dispatch(new Xt.B.SetQuizActive(!1)),this.store.dispatch(new Xt.B.SetActiveSubmission(void 0)),this.store.dispatch(new Xt.B.ClearSubmissions),this.store.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Question))}exitQuiz(){this.resetQuiz(),this.viewService.setContentMode(Bt.ChapterInfo),this.viewService.toggleLabels(!0),this.viewService.toggleDrawer(mt.Hide),setTimeout(()=>{this.store.dispatch(new Ut.Ih(this.store.selectSnapshot(me.N.getChapterCamera),!1))})}submitQuestion(t,o){const s=this.store.selectSnapshot(Fe.j.getAllQuestions).find(g=>g.id===t),a=this.store.selectSnapshot(Fe.j.getQuizSettings),r=this.store.selectSnapshot(Fe.j.getQuizLaunchMode);this.store.dispatch(new Xt.B.SubmitQuestionAnswer({questionId:s.id,answer:o})),this.store.dispatch(new Xt.B.SetActiveSubmission({questionId:s.id,answer:o})),this.applicationEventService.fireEvent(rt.F.QuizAnswerSubmitted,{questionId:s.id,answer:o}),r===Fe.W.Learning&&s.type!==Pn.Q5.Instructions&&!1!==a.showExplanation?this.store.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Explanation)):this.nextQuestion()}nextQuestion(){this.store.dispatch(new Xt.B.SetActiveSubmission(void 0)),this.store.selectSnapshot(Fe.j.hasQuestionRemaining)?(this.store.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Question)),this.viewService.clearFadedNodes(),this.viewService.clearSelectedNodes(),this.store.dispatch(new Xt.B.NextQuestion)):(this.store.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Review)),this.applicationEventService.fireEvent(rt.F.QuizCompleted,!0))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(En),e.KVO(Po.S))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Dv(n){return new h.c(i=>{const t=new ResizeObserver(o=>{i.next(o)});return t.observe(n),function(){t.unobserve(n)}})}var Ls=d(92811);let dm=(()=>{class n{constructor(t,o,s){this.mediaService=t,this.animationService=o,this.store=s,this.countdownStatus=new Li.t("inactive"),this.countdownChanged=new k.B,this.countdownComplete=new k.B,this.audioObserver=new h.c,this.audioSubject=new Li.t({current:0,duration:0,complete:!1}),this.animationSubject=new Li.t({current:0,duration:0,complete:!1}),this.readingSubject=new Li.t({current:0,duration:0,complete:!1}),this.minimumSubject=new Li.t({current:0,duration:0,complete:!1})}startChapterTimers(t,o=!1){var s=this;return(0,pt.A)(function*(){const r={current:0,duration:0,complete:!1},_=s.store.selectSnapshot(de.getViewLanguage),g=s.store.selectSnapshot(ls.U.getPrefersReducedMotion);if(s.clearChapterTimers(),s.clearCountdown(),(o||s.mediaService.chapterHasAudio(t,_))&&(s.audioRef=yield s.mediaService.getChapterAudioPlayer(t,_,o)),s.audioRef){const F=yield s.mediaService.getDuration(s.audioRef);s.audioSubject.next({current:0,duration:F,complete:!1}),s.audioRef.on("end",()=>{s.audioSubject.next({...s.audioSubject.value,complete:!0})}),s.audioRef.on("stop",()=>{s.audioSubject.next({...s.audioSubject.value,complete:!1})}),s.audioRef.on("play",()=>{s.audioSubject.next({current:s.audioRef?.seek(),duration:F,complete:!1})})}else s.audioSubject.next({current:0,duration:0,complete:!0});s.animationSubject.next({current:s.animationService.getTime(),duration:s.animationService.getChapterDuration(),complete:!1}),s.readingSubject.next({current:0,duration:s.calculateChapterReadingTime(t),complete:!1});const{minimum:P}=s.store.selectSnapshot(de.getPlaythroughSettings);s.minimumSubject.next({current:0,duration:P,complete:!1}),s.interval=setInterval(()=>{s.audioSubject.next(s.audioRef?{...s.audioSubject.value,current:s.audioRef?.seek()}:{...r,complete:!0}),!s.animationService.isChapterAnimated(t)||g?s.animationSubject.next({...r,complete:!0}):s.animationService.isChapterLooped(t)?s.animationSubject.next({...s.animationSubject.value,current:s.animationSubject.value.current+.05,complete:s.animationSubject.value.current>=s.animationSubject.value.duration}):s.animationSubject.next({...s.animationSubject.value,current:s.animationService.getTime(),complete:s.animationService.hasChapterFinished()}),s.readingSubject.next({...s.readingSubject.value,current:s.readingSubject.value.current+50,complete:s.readingSubject.value.current>=s.readingSubject.value.duration}),s.minimumSubject.next({...s.minimumSubject.value,current:s.minimumSubject.value.current+50,complete:s.minimumSubject.value.current>=s.minimumSubject.value.duration})},50)})()}clearChapterTimers(){clearInterval(this.interval),this.audioRef=null;const t={current:0,duration:0,complete:!1};this.animationSubject.next({...t}),this.audioSubject.next({...t}),this.readingSubject.next({...t}),this.minimumSubject.next({...t})}calculateMaximumRemainingTime(){return[{...this.audioSubject.getValue(),type:"audio"},{...this.animationSubject.getValue(),type:"animation"},{...this.readingSubject.getValue(),type:"reading"},{...this.minimumSubject.getValue(),type:"minimum"}].reduce((t,o)=>(o.complete||(("audio"===o.type||"animation"===o.type)&&(o={...o,current:1e3*o.current,duration:1e3*o.duration}),o.duration-o.current>t.duration-t.current&&(t={...o})),t),{complete:!0,current:0,duration:0})}calculateChapterReadingTime(t){return 1e3*Math.floor((t.description??"").split(" ").length/200*60)}preloadAudio(t,o=!1){var s=this;return(0,pt.A)(function*(){const a=s.store.selectSnapshot(de.getViewLanguage);for(const r of t)yield s.mediaService.getChapterAudioPlayer(r,a,o)})()}startCountdown(){this.clearCountdown(),this.countdownStatus.next("active");let{countdown:t}=this.store.selectSnapshot(de.getPlaythroughSettings);this.countdownInterval=setInterval(()=>{t-=50,this.countdownChanged.next(t),t<=0&&(this.countdownComplete.next(),this.clearCountdown())},50)}delayCountdown(){const{countdownDelay:t}=this.store.selectSnapshot(de.getPlaythroughSettings);this.countdownInterval&&(this.clearCountdown(),clearTimeout(this.countdownDelay),this.countdownStatus.next("delay"),this.countdownDelay=setTimeout(()=>{this.startCountdown()},t))}clearCountdown(){const{countdown:t}=this.store.selectSnapshot(de.getPlaythroughSettings);clearInterval(this.countdownInterval),clearTimeout(this.countdownDelay),this.countdownChanged.next(t),this.countdownStatus.next("inactive")}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(vi),e.KVO(co.O),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var _m=d(82529),Qt=d(65985);function jv(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleAction("takeQuiz"))}),e.pXf(1,2),e.k0s()}}class Sr{constructor(i){this.dialogRef=i}ngOnInit(){}handleAction(i){this.dialogRef.close(i)}static#e=this.\u0275fac=function(t){return new(t||Sr)(e.rXU(_m.ce))};static#t=this.\u0275cmp=e.VBU({type:Sr,selectors:[["app-view-playthrough-modal"]],decls:10,vars:3,consts:()=>{let i,t,o;return i=$localize`:1cbfa5d1bd6e6c717ce755355bc69d490bacec684369858959634679447:${"\ufffd#4\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#4\ufffd"}:CLOSE_TAG_APP_ICON: Explore on Your Own `,t=$localize`:1a4ef7deae63552688d7b8d2aa530d0ed9addf038508351863775798459:${"\ufffd#9\ufffd"}:START_TAG_APP_ICON:${"\ufffd/#9\ufffd"}:CLOSE_TAG_APP_ICON: Play Again `,o=$localize`:3453239ade2e7a669baf13d6322db6a7dcc276882019708727875402043: Take Quiz `,[i,t,o,[1,"view-playthrough-modal"],[1,"view-playthrough-modal__buttons"],["app-view-button","","buttonTheme","blue-fill","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","arrow-pointer","aria-hidden","true"],["app-view-button","","class","view-playthrough-modal__button","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",3,"click",4,"ngIf"],["app-view-button","","buttonTheme","white-outline","buttonSize","large","buttonShape","rounded",1,"view-playthrough-modal__button",3,"click"],["icon","rotate-left","aria-hidden","true"]]},template:function(t,o){1&t&&(e.j41(0,"div",3)(1,"div",4)(2,"button",5),e.bIt("click",function(){return o.handleAction("explore")}),e.PLo(3,0),e.nrm(4,"app-icon",6),e.YFu(),e.k0s(),e.DNE(5,jv,2,0,"button",7),e.nI1(6,"async"),e.j41(7,"button",8),e.bIt("click",function(){return o.handleAction("playAgain")}),e.PLo(8,1),e.nrm(9,"app-icon",9),e.YFu(),e.k0s()()()),2&t&&(e.R7$(5),e.Y8G("ngIf",e.bMT(6,1,o.hasQuiz$)))},dependencies:[Qt.ri,J.bT,ut.R,J.Jj],styles:["[_nghost-%COMP%]{display:flex;background:#1018238c;width:100%;height:100%;justify-content:center;align-items:center;transition:background .3 ease-out}.view-playthrough-modal__button[_ngcontent-%COMP%]{width:280px}.view-playthrough-modal__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Fe.j.hasQuiz),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Sr.prototype,"hasQuiz$",void 0);var ya=d(90908),va=d(94909),br=d(1102),yr=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},vr=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class to{constructor(i,t,o){this.store=i,this.sceneService=t,this.paintService=o,this.nodeChapterOpacities={}}initObservables(){this.nodesLayerIndex=0,this.objectsLayerIndex=0,this.nodeChapterOpacities={},this.destroyObservables(),this.ngUnsubscribe=new k.B,(0,cn.z)([this.selectedChapterId$,this.selectedEngineChapterId$]).pipe((0,D.p)(([i,t])=>i&&(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{this.updateNodeChapterOpacities(i)}),this.selectedChapterCurrentLayers$.pipe((0,va.E)(this.selectedChapterCurrentLayersIndex$),(0,p.Q)(this.ngUnsubscribe)).subscribe(([,i])=>{this.nodesLayerIndex=this.objectsLayerIndex=i}),(0,cn.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,D.p)(([i,t])=>!(0,u.isNil)(i)&&!(0,u.isNil)(t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o])=>{this.syncLayersToScene(o,i,t,!0)})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayersToState(i,t,o){this.store.dispatch(new Nn.WZ(i,t,o,!0))}syncLayersToScene(i,t,o,s){this.updateLayerIndex(t,i,s),this.updateLayerPosition(o,i,s)}fractionToIndex(i,t){const o=this.getThreshold(i),s=Math.floor(t/o);return Math.max(0,Math.min(i.length-2,s))}fractionToPosition(i,t,o){const s=this.getThreshold(i);return Math.max(0,Math.min((t-s*o)/s,1))}indexPositionToFraction(i,t,o){const s=this.getThreshold(i);return t*s+o*s}fractionToPercent(i){return Math.round(100*(1-i))}percentToFraction(i){return 1-i/100}getThreshold(i){return i.length>1?1/(i.length-1):1}getCurrentLayerIndexProp(i){return i?"nodesLayerIndex":"objectsLayerIndex"}updateLayerIndex(i,t,o){const s=this.getCurrentLayerIndexProp(o);i!==this[s]&&(this.restoreLayers(i,this[s],t,o),o&&(this.nodesLayerIndex=i),this.objectsLayerIndex=i)}updateLayerPosition(i,t,o){const s=this.getCurrentLayerIndexProp(o),a=t[this[s]]?.objectIds;a?.length>0&&this.setObjectsOpacity(a,1-i)}restoreLayers(i,t,o,s){const r=(i-t)/Math.abs(i-t);let _=[],g=t;for(;g!==i;)_=_.concat(o[g].objectIds),g+=r;const F=-1===r;this.setObjectsOpacity(_,1===r?0:1),s?this.setNodesShown(_,F):this.setObjectsShown(_,F),-1===r&&(s?this.setNodesShown(o[i].objectIds,!0):this.setObjectsShown(o[i].objectIds,!0))}setObjectsOpacity(i,t){i.forEach(o=>{const s=this.nodeChapterOpacities[o];let a;Array.isArray(s)?(a=s.slice(),a[0]=t*s[0],a[1]=t*s[1]):a=t*s,this.paintService.colorObject(o,{opacity:a})})}updateNodeChapterOpacities(i){const o=this.store.selectSnapshot(Rn.z.getAllNodeState)[i];this.nodeChapterOpacities={},Object.entries(o).forEach(([s,a])=>{if(this.nodeChapterOpacities[s]=1,a.paint&&Object.prototype.hasOwnProperty.call(a.paint,"opacity")){const r=(0,br.Sf)(a.paint);!1!==r.opacity&&(this.nodeChapterOpacities[s]=r.opacity)}})}setObjectsShown(i,t){const o={};for(let s=0;s<i.length;s++)o[i[s]]=t;this.sceneService.setShownObjects({showObjects:o})}setNodesShown(i,t){this.store.dispatch(new Vt.yr(t,i,void 0,!1))}static#e=this.\u0275fac=function(t){return new(t||to)(e.KVO(l.il),e.KVO(Fi.w),e.KVO(ir.s))};static#t=this.\u0275prov=e.jDH({token:to,factory:to.\u0275fac,providedIn:"root"})}yr([(0,l.l6)(me.N.getSelectedChapterCurrentLayers),vr("design:type",h.c)],to.prototype,"selectedChapterCurrentLayers$",void 0),yr([(0,l.l6)(me.N.getSelectedChapterCurrentLayersIndex),vr("design:type",h.c)],to.prototype,"selectedChapterCurrentLayersIndex$",void 0),yr([(0,l.l6)(me.N.getSelectedChapterCurrentLayersPosition),vr("design:type",h.c)],to.prototype,"selectedChapterCurrentLayersPosition$",void 0),yr([(0,l.l6)(me.N.getSelectedChapterId),vr("design:type",h.c)],to.prototype,"selectedChapterId$",void 0),yr([(0,l.l6)(ze.S.getChapter),vr("design:type",h.c)],to.prototype,"selectedEngineChapterId$",void 0);var gp=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},mp=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class wo{constructor(i,t){this.store=i,this.sceneService=t}initObservables(){this.destroyObservables(),this.ngUnsubscribe=new k.B,this.selectedChapterId$.pipe((0,D.p)(i=>!(0,u.isNil)(i)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.listenForCurrentLayerGroupsChanges()})}listenForCurrentLayerGroupsChanges(){const i=this.selectedChapterId$.pipe((0,x.i)(1),(0,qt.s)(1));this.currentLayerGroups$.pipe((0,D.p)(t=>!(0,u.isNil)(t)&&t.length>0),(0,x.i)(1),(0,p.Q)(i)).subscribe(t=>{const o=this.getObjectVisibilityFromGroups(t);this.store.dispatch(new Vt.yr(!1,[],o,!1))})}destroyObservables(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}syncLayerGroupsToScene(i){const t=this.getObjectVisibilityFromGroups(i);this.sceneService.setShownObjects({showObjects:t})}syncLayerGroupsToState(i,t,o){this.store.dispatch(new Nn.$V(i,t,o))}computeGroupPositionsByFraction(i,t){const s=i.map(_=>_.layers).flat().length,a=Math.round(s*(0,u.clamp)(t,0,1));let r=s;for(let _=0;_<i.length;_++){const g=i[_];g.position=0;for(let P=g.layers.length,F=P-1,ee=P;F>=0;F--,ee--,r--)r<=a&&0===g.position&&(g.position=ee)}return i}getObjectVisibilityFromGroups(i){const t={};return i.forEach(({layers:o,position:s})=>{const a=o.length-s;o.forEach((r,_)=>{const{objectIds:g}=r,P=a<=_;g.forEach(F=>t[F]=P)})}),t}static#e=this.\u0275fac=function(t){return new(t||wo)(e.KVO(l.il),e.KVO(Fi.w))};static#t=this.\u0275prov=e.jDH({token:wo,factory:wo.\u0275fac,providedIn:"root"})}gp([(0,l.l6)(me.N.getSelectedChapterId),mp("design:type",h.c)],wo.prototype,"selectedChapterId$",void 0),gp([(0,l.l6)(me.N.getSelectedChapterLayerGroups),mp("design:type",h.c)],wo.prototype,"currentLayerGroups$",void 0),gp([(0,l.l6)(Ke.getUIEntry(G.VisibilityLayers)),mp("design:type",h.c)],wo.prototype,"visibilityLayersUI$",void 0);var Vv=d(20339),fp=d(22959),On=d(32724);function Sp(n){return n.reduce((i,t)=>{if(t.type===hi.m.CTA){const o=t,{action:s,url:a}=o;"ar-link"===s&&a.endsWith(".usdz")&&i.push(a)}return i},[])}var Ui=d(48570),bp=d(59369);let Us=(()=>{class n{onEnter(){this.store.dispatch(new E.SetPreventFadeoutEvent("mouseenter",!0))}onLeave(){this.store.dispatch(new E.SetPreventFadeoutEvent("mouseenter",!1))}onFocusin(){this.store.dispatch(new E.SetPreventFadeoutEvent("focusin",!0))}onFocusout(){this.store.dispatch(new E.SetPreventFadeoutEvent("focusin",!1))}constructor(t){this.store=t}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appPreventFadeout",""]],hostBindings:function(o,s){1&o&&e.bIt("mouseenter",function(){return s.onEnter()})("mouseleave",function(){return s.onLeave()})("focusin",function(){return s.onFocusin()})("focusout",function(){return s.onFocusout()})}})}return n})();var Ao=d(49989),Gv=d(83609),pm=d(2094),$v=d(57021);function yp(n,i){return n.dispatch(new st._y(!1)),i.fireEvent(Ct.X.SceneXrayDisabled),!0}var ei=d(28931);class Bv{constructor(i,t){this.store=i,this.particleSystemsService=t,this.ngUnsubscribe=new k.B,this.listenForParticleChanges()}destroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}listenForParticleChanges(){const i=this.store.select(ts.B.getParticleSystems),t=this.store.select(ts.B.getVisisbleParticleSystems);(0,cn.z)([i,t]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([o])=>{const s=this.store.selectSnapshot(me.N.getSelectedChapterId),a=this.store.selectSnapshot(ts.B.getVisibleParticleSystemsForChapter(s));this.particleSystemsService.setEngineParticles(o,s,a)})}}const vp={type:Ld.Cube,direction:Ud.In,translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},zv=[zn.ShapeBounce,zn.ShapeKill,zn.ShapeStop],um={[zn.LifetimeKill]:{type:zn.LifetimeKill},[zn.LifetimeStop]:{type:zn.LifetimeStop},[zn.PathKill]:{type:zn.PathKill},[zn.PathStop]:{type:zn.PathStop},[zn.PathRadius]:{type:zn.PathRadius},[zn.ShapeBounce]:{type:zn.ShapeBounce,trap:!1,shape:{...vp}},[zn.ShapeKill]:{type:zn.ShapeKill,trap:!1,shape:{...vp}},[zn.ShapeStop]:{type:zn.ShapeStop,trap:!1,shape:{...vp}}},ql={[Yt.DirectionalVelocity]:{type:Yt.DirectionalVelocity,directionAverage:[0,1,0],forceAverage:5,directionVariance:.5,forceVariance:1},[Yt.Lifetime]:{type:Yt.Lifetime,average:2.5,variance:1},[Yt.PointPosition]:{type:Yt.PointPosition,position:[0,0,0]},[Yt.RandomVelocity]:{type:Yt.RandomVelocity,forceAverage:5,forceVariance:0},[Yt.SpherePosition]:{type:Yt.SpherePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Yt.CylinderPosition]:{type:Yt.CylinderPosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Yt.CubePosition]:{type:Yt.CubePosition,scale:[1,1,1],rotate:[0,0,0],translate:[0,0,0]},[Yt.RandomRotation]:{type:Yt.RandomRotation,average:0,variance:0},[Yt.RandomRotationSpeed]:{type:Yt.RandomRotationSpeed,average:0,variance:180},[Yt.RandomScale]:{type:Yt.RandomScale,average:1,variance:0},[Yt.SpriteAnimationDuration]:{type:Yt.SpriteAnimationDuration,average:1,variance:0}},Ep={[fn.AgeColorBlend]:{type:fn.AgeColorBlend,colors:[[255,0,0,255],[0,255,0,255],[0,0,0,255]]},[fn.BrownianMotion]:{type:fn.BrownianMotion,frequency:10,forceAverage:5,forceVariance:0},[fn.UniformForce]:{type:fn.UniformForce,directionAverage:[0,1,0],forceAverage:5,directionVariance:0,forceVariance:0},[fn.RadialForce]:{type:fn.RadialForce,position:[0,0,0],forceAverage:5,forceVariance:0},[fn.Friction]:{type:fn.Friction,friction:.1},[fn.Gravity]:{type:fn.Gravity,position:[0,0,0],radius:1,forceAverage:5,forceVariance:0},[fn.Path]:{type:fn.Path,nodes:[{position:[0,0,0],forceAverage:1,radius:1,forceVariance:0}]},[fn.AxisForce]:{type:fn.AxisForce,position:[0,0,0],direction:[1,0,0],forceAverage:5,forceVariance:0},[fn.SpriteAnimation]:{type:fn.SpriteAnimation}},hm={id:"",name:"",numParticles:1e4,pointSize:10,emissionAverage:500,emissionVariance:0,textures:[],properties:{layer:1,depthMask:!1,roundPoints:!0,perspectivePoints:!0,addAlpha:!1},constraints:[um[zn.LifetimeKill]],creators:[ql[Yt.PointPosition],ql[Yt.RandomVelocity],ql[Yt.Lifetime]],updaters:[Ep[fn.AgeColorBlend],Ep[fn.Friction]]};function gm(){const n=JSON.parse(JSON.stringify(hm)),{constraints:i,creators:t,updaters:o}=n;return{...n,constraints:i.map((s,a)=>({...s,id:li.u.idWithPrefix("constraint")})),creators:t.map((s,a)=>({...s,id:li.u.idWithPrefix("creator")})),updaters:o.map((s,a)=>({...s,id:li.u.idWithPrefix("updater")}))}}function Cp(n){return{...um[n]}}function Tp(n){return{...ql[n]}}function Op(n){return{...Ep[n]}}function Jl(n){return(0,u.omitBy)(n,u.isNil)}function Jv(n,i){return Jl(function Yv(n,i){const{id:t,name:o,shape:s,trap:a}=i;return zv.includes(n)?{id:t,name:o,type:n,trap:a,shape:s}:{id:t,name:o,type:n}}(n,i))}function Zv(n,i){return Jl(function Kv(n,i){const{id:t,name:o,directionAverage:s,forceAverage:a,directionVariance:r,forceVariance:_,average:g,variance:P,position:F,scale:ee,rotate:le,translate:he}=i;switch(n){case Yt.DirectionalVelocity:return{id:t,name:o,type:n,directionAverage:s,forceAverage:a,directionVariance:r,forceVariance:_};case Yt.Lifetime:return{id:t,name:o,type:n,average:g,variance:P};case Yt.PointPosition:return{id:t,name:o,type:n,position:F};case Yt.RandomVelocity:return{id:t,name:o,type:n,forceAverage:a,forceVariance:_};case Yt.SpherePosition:case Yt.CylinderPosition:case Yt.CubePosition:return{id:t,name:o,type:n,scale:ee,rotate:le,translate:he};case Yt.RandomRotation:case Yt.RandomRotationSpeed:case Yt.RandomScale:case Yt.SpriteAnimationDuration:return{id:t,name:o,type:n,average:g,variance:P};default:return}}(n,i))}function eE(n,i){return Jl(function qv(n,i){const{id:t,name:o,colors:s,position:a,direction:r,friction:_,frequency:g,forceAverage:P,radius:F,forceVariance:ee,nodes:le,shape:he,directionAverage:ue,directionVariance:ye}=i;switch(n){case fn.AgeColorBlend:return{id:t,name:o,type:n,colors:s,shape:he};case fn.BrownianMotion:return{id:t,name:o,type:n,frequency:g,forceAverage:P,forceVariance:ee,shape:he};case fn.UniformForce:return{id:t,name:o,type:n,directionAverage:ue,forceAverage:P,directionVariance:ye,forceVariance:ee,shape:he};case fn.RadialForce:return{id:t,name:o,type:n,position:a,forceAverage:P,forceVariance:ee,shape:he};case fn.Friction:return{id:t,name:o,type:n,friction:_,shape:he};case fn.Gravity:return{id:t,name:o,type:n,position:a,radius:F,forceAverage:P,forceVariance:ee,shape:he};case fn.Path:return{id:t,name:o,type:n,nodes:le,shape:he};case fn.AxisForce:return{id:t,name:o,type:n,position:a,direction:r,forceAverage:P,forceVariance:ee,shape:he};case fn.SpriteAnimation:return{id:t,name:o,type:n};default:return}}(n,i))}let tE=(()=>{class n{constructor(t,o){this.engineService=t,this.store=o}createParticleSystem(t){const o={...gm(),id:li.u.idWithPrefix("system")};this.store.dispatch(new yn.u.NewParticleSystem(o,t))}duplicateParticleSystem(t,o){this.store.dispatch(new yn.u.DuplicateParticleSystem(t,o))}resetParticleSystem(t){const o={...gm(),id:t};this.store.dispatch(new yn.u.UpdateParticleSystem(t,o))}toggleParticleSystemVisible(t,o){const s=this.isParticleSystemVisible(t,o);this.store.dispatch(new yn.u.SetParticleSystemVisible(t,!s,o))}isParticleSystemVisible(t,o){return this.store.selectSnapshot(ts.B.getVisibleParticleSystemsForChapter(o)).includes(t)}addChapterParticleSystem(t,o){this.store.dispatch(new yn.u.AssignParticle(t,o))}removeChapterParticleSystem(t,o){this.store.dispatch(new yn.u.UnassignParticle(t,o))}removeAllChapterParticleSystem(t){this.store.selectSnapshot(ts.B.particleSystemsForChapter(t)).forEach(s=>{this.removeChapterParticleSystem(s.id,t)})}createNewConstraint(t,o){const{id:s,constraints:a}=t;this.store.dispatch(new yn.u.UpdateParticleSystem(s,{...t,constraints:[...a,{...Cp(o),id:li.u.idWithPrefix("constraint")}]}))}duplicateConstraint(t,o){t.constraints=[...t.constraints,{...Jv(o.type,o),id:li.u.idWithPrefix("constraint")}],this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleConstraint(t.constraints.length-1))}resetConstraint(t,o){const s=t.constraints[o],{id:a,type:r}=s;t.constraints[o]={...Cp(r),id:a},this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}resetConstraints(t){t.constraints=t.constraints.map(o=>{const{id:s,type:a}=o;return{...Cp(a),id:s}}),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}removeConstraint(t,o){t.constraints.splice(o,1),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleConstraint(-1))}createNewCreator(t,o){const{id:s,creators:a}=t;this.store.dispatch(new yn.u.UpdateParticleSystem(s,{...t,creators:[...a,{...Tp(o),id:li.u.idWithPrefix("creator")}]}))}duplicateCreator(t,o){t.creators=[...t.creators,{...Zv(o.type,o),id:li.u.idWithPrefix("creator")}],this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleCreator(t.creators.length-1))}resetCreator(t,o){const s=t.creators[o],{id:a,type:r}=s;t.creators[o]={...Tp(r),id:a},this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}resetCreators(t){t.creators=t.creators.map(o=>{const{id:s,type:a}=o;return{...Tp(a),id:s}}),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}removeCreator(t,o){t.creators.splice(o,1),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleConstraint(-1))}createNewUpdater(t,o){const{id:s,updaters:a}=t;this.store.dispatch(new yn.u.UpdateParticleSystem(s,{...t,updaters:[...a,{...Op(o),id:li.u.idWithPrefix("updater")}]}))}duplicateUpdater(t,o){t.updaters=[...t.updaters,{...eE(o.type,o),id:li.u.idWithPrefix("updater")}],this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleUpdater(t.updaters.length-1))}resetUpdater(t,o){const s=t.updaters[o],{id:a,type:r}=s;t.updaters[o]={...Op(r),id:a},this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}resetUpdaters(t){t.updaters=t.updaters.map(o=>{const{id:s,type:a}=o;return{...Op(a),id:s}}),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t))}removeUpdater(t,o){t.updaters.splice(o,1),this.store.dispatch(new yn.u.UpdateParticleSystem(t.id,t)),this.store.dispatch(new yn.u.SelectParticleConstraint(-1))}setEngineParticles(t,o,s){const a=this.engineService.engine?.story,r=a?.chapters?.find(_=>_.id===o);(0,u.isNil)(r)||(a.particleSystemDefs.forEach((_,g)=>{(0,u.isNil)(t[g])&&a.particleSystemDefs.delete(g)}),Object.entries(t).forEach(([_,g])=>{const P=a.particleSystemDefs.get(_);((0,u.isNil)(P)||!(0,u.isEqual)(P,g))&&a.particleSystemDefs.set(_,g)}),r.particleSystemIds.forEach(_=>{s.includes(_)||r.particleSystemIds.delete(_)}),s.forEach(_=>{r.particleSystemIds.has(_)||r.particleSystemIds.add(_)}))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(v.y),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Er=d(46799);let Zl=(()=>{class n{static#e=this.type="[Story Video] Set current video";constructor(t){this.currentVideo=t}}return n})();var Mp=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},xs=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};let Ea=class Id{static getCurrentVideo(i){return i.currentVideo}SetCurrentVideo(i,t){i.patchState(jn.jM(i.getState(),o=>{const s=o.currentVideo;o.currentVideo=t.currentVideo;const a=this.mediaService.getVideoPlayer(s);a&&a.pause()}))}constructor(i){this.mediaService=i}static#e=this.\u0275fac=function(t){return new(t||Id)(e.KVO(vi))};static#t=this.\u0275prov=e.jDH({token:Id,factory:Id.\u0275fac})};Mp([(0,l.rc)(Zl),xs("design:type",Function),xs("design:paramtypes",[Object,Zl]),xs("design:returntype",void 0)],Ea.prototype,"SetCurrentVideo",null),Mp([(0,l.MD)(),xs("design:type",Function),xs("design:paramtypes",[Object]),xs("design:returntype",void 0)],Ea,"getCurrentVideo",null),Ea=Mp([(0,l.Uw)({name:"storyVideo",defaults:{currentVideo:null}}),xs("design:paramtypes",[vi])],Ea);var mm=d(51196),Cr=d(81391),Tr=d(8358),Hi=d(76872),Ip=d(49746),Pp=d(1300),Or=(d(69568),d(11789));const iE=["pinElRef"],oE=(n,i,t,o,s,a)=>({"label-pin--light":n,"label-pin--dark":i,"label-pin--none":t,"label-pin--custom":o,"label-pin--selected":s,"label-pin--hovered":a});function sE(n,i){1&n&&(e.qSk(),e.j41(0,"svg",2),e.nrm(1,"path",6),e.k0s())}function aE(n,i){1&n&&(e.qSk(),e.j41(0,"svg",3),e.nrm(1,"path",7),e.k0s())}function rE(n,i){if(1&n&&(e.j41(0,"div",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.sequence()," ")}}function lE(n,i){1&n&&e.nrm(0,"div",5)}let wp=(()=>{class n{constructor(){this.labelPinType=ci.O,this.labelThemeEnum=Hi.D,this.pinElRef=(0,e.ebz)("pinElRef"),this.labelTheme=e.hFB.required(),this.pinType=e.hFB.required(),this.glow=(0,e.hFB)(!1),this.selected=(0,e.hFB)(!1),this.hovered=(0,e.hFB)(!1),this.sequence=(0,e.hFB)(),this.showOnNone=(0,e.hFB)(!1),this.foregroundColor=(0,e.hFB)(),this.backgroundColor=(0,e.hFB)(),this.pinContentType=(0,e.EWP)(()=>{const t=this.pinType(),o=this.selected();switch(t){case ci.O.Plus:return"plus";case ci.O.Minus:return"minus";case ci.O.PlusMinus:return o?"minus":"plus";case ci.O.Sequential:return"text";default:return"none"}}),(0,e.QZP)(()=>{const t=this.pinElRef()?.nativeElement,o=this.labelTheme(),s=this.foregroundColor(),a=this.backgroundColor();(0,u.isNil)(t)||(t.style.removeProperty("--label-pin-text-color"),t.style.removeProperty("--label-pin-border-color"),t.style.removeProperty("--label-pin-color"),o===Hi.D.Custom&&(s&&Or.T.isCSSColor(s)&&(t.style.setProperty("--label-pin-text-color",s),t.style.setProperty("--label-pin-border-color",s)),a&&Or.T.isCSSColor(a)&&t.style.setProperty("--label-pin-color",a)))})}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-label-pin"]],viewQuery:function(o,s){1&o&&e.wEZ(s.pinElRef,iE,5),2&o&&e.NyB()},inputs:{labelTheme:[1,"labelTheme"],pinType:[1,"pinType"],glow:[1,"glow"],selected:[1,"selected"],hovered:[1,"hovered"],sequence:[1,"sequence"],showOnNone:[1,"showOnNone"],foregroundColor:[1,"foregroundColor"],backgroundColor:[1,"backgroundColor"]},standalone:!0,features:[e.aNF],decls:6,vars:10,consts:[["pinElRef",""],[1,"label-pin",3,"ngClass"],["width","10","height","10","viewBox","0 0 10 10","fill","none",1,"label-pin__image"],["width","10","height","4","viewBox","0 0 10 4","fill","none",1,"label-pin__image-text"],[1,"label-pin__text"],[1,"label-pin__glow"],["fill-rule","evenodd","clip-rule","evenodd","d","M6.25 0V3.75H10V6.25H6.25V10H3.75V6.25H0V3.75L3.75 3.74875V0H6.25Z",1,"label-pin__image-text"],["d","M10 0.800049H0V3.20005H10V0.800049Z",1,"label-pin__text"]],template:function(o,s){if(1&o&&(e.j41(0,"div",1,0),e.DNE(2,sE,2,0,":svg:svg",2)(3,aE,2,0,":svg:svg",3)(4,rE,2,1,"div",4)(5,lE,1,0,"div",5),e.k0s()),2&o){let a;e.Y8G("ngClass",e.l4e(3,oE,s.labelTheme()===s.labelThemeEnum.StudioNext,s.labelTheme()===s.labelThemeEnum.Annotation,s.pinType()===s.labelPinType.None&&!s.showOnNone(),s.labelTheme()===s.labelThemeEnum.Custom,s.selected(),s.hovered())),e.R7$(2),e.vxM("plus"===(a=s.pinContentType())?2:"minus"===a?3:"text"===a?4:-1),e.R7$(3),e.vxM(s.glow()?5:-1)}},dependencies:[J.MD,J.YU],styles:[':root{--label-pin-size: 20px;--label-pin-text-size: 10px;--label-pin-scale: 1;--label-pin-color: transparent;--label-pin-border-width: 1px;--label-pin-border-color: transparent;--label-pin-text-color: transparent;--label-pin-box-shadow-color: transparent;--label-pin-box-shadow-width: 1px;--label-pin-glow-color: rgba(255, 255, 255, .3);--label-pin-glow-scale: 1.6}@keyframes classic-glow{0%{transform:scale(1)}10%{transform:scale(1)}50%{transform:scale(var(--label-pin-glow-scale))}90%{transform:scale(1)}to{transform:scale(1)}}.label-pin{display:flex;align-items:center;justify-content:center;position:relative;z-index:10;width:var(--label-pin-size);height:var(--label-pin-size);transition:transform .15s ease-out;transform:scale(var(--label-pin-scale))}.label-pin__text{font-size:var(--label-pin-text-size);font-weight:700;color:var(--label-pin-text-color)}.label-pin__image-text{fill:var(--label-pin-text-color)}.label-pin__glow{display:block;position:absolute;left:0;top:0;width:100%;height:100%;border-radius:50%;z-index:-2;background-color:var(--label-pin-glow-color);animation:classic-glow 4s infinite}.label-pin:before{content:" ";background-color:transparent;border-style:solid;border-radius:50%;box-sizing:border-box;display:block;position:absolute;left:0;top:0;z-index:-1;height:100%;width:100%;background-color:var(--label-pin-color);border-width:var(--label-pin-border-width);border-color:var(--label-pin-border-color);box-shadow:0 0 0 var(--label-pin-box-shadow-width) var(--label-pin-box-shadow-color);transition:box-shadow .15s ease-out}.label-pin--hovered,.label-pin:hover{--label-pin-box-shadow-color: #2472e9}.label-pin--selected{--label-pin-box-shadow-color: #2472e9;--label-pin-box-shadow-width: 2px}.label-pin--light{--label-pin-color: #ffffff;--label-pin-text-color: #0c1726;--label-pin-border-color: #0c1726}.label-pin--dark{--label-pin-glow-color: rgba(255, 255, 255, .25);--label-pin-color: #283853;--label-pin-text-color: #ffffff;--label-pin-border-color: #ffffff}.label-pin--dark.label-pin--selected{--label-pin-color: #0c1726}.label-pin--custom{--label-pin-color: #ffffff;--label-pin-text-color: #0c1726;--label-pin-border-color: #0c1726}.label-pin--none{display:none}\n'],encapsulation:2,changeDetection:0})}return n})();var fm=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Sm=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const cE=["labelContainerEl"],dE=["labelEl"],_E=["wire"],pE=["tag"],uE=["pin"],hE=["title"],gE=[[["","label-header",""]],[["","label-actions",""]],[["","label-more",""]],[["","label-body",""]]],mE=["[label-header]","[label-actions]","[label-more]","[label-body]"],fE=(n,i,t,o,s,a,r,_,g)=>({"label--selected":n,"label--hovered":i,"label--annotation":t,"label--invert":o,"label--studio":s,"label--context":a,"label--screenshot-mode":r,"label--auto-fit":_,"label--opaque":g}),SE=n=>({"label__wire--collapse":n}),bE=(n,i,t,o)=>({"label__tag--collapse":n,"label__tag--collapsible":i,"label__tag--floating":t,"label__tag--draggable":o}),yE=n=>({"label__body--collapse":n});function vE(n,i){if(1&n&&(e.j41(0,"div",8,5),e.nrm(2,"app-label-pin",16),e.nI1(3,"async"),e.k0s()),2&n){let t,o;const s=e.XpG();e.R7$(2),e.Y8G("pinType",s.label().pinType)("labelTheme",s.label().theme)("glow",s.label().pinGlow)("selected",s.selected)("hovered",e.bMT(3,8,s.hovered$))("sequence",s.sequence())("foregroundColor",null==(t=s.label().themeStyles)?null:t.pinForegroundColor)("backgroundColor",null==(o=s.label().themeStyles)?null:o.pinBackgroundColor)}}function EE(n,i){1&n&&(e.j41(0,"div",17),e.nrm(1,"img",18),e.k0s())}function CE(n,i){if(1&n&&(e.j41(0,"div",19),e.SdG(1,3),e.k0s()),2&n){const t=e.XpG();e.Y8G("ngClass",e.eq3(1,yE,t.isCollapsed()||t.descriptionCollapsed()))}}class Yo{set selected(i){this._selected=i}get selected(){return this._selected}constructor(i,t,o,s,a,r,_,g,P,F){this.renderer=i,this.labelsService=t,this.engineService=o,this.cameraService=s,this.engineRendererService=a,this.store=r,this.actions=_,this.changeDetection=g,this.markerService=P,this.localeId=F,this.labelPinType=ci.O,this.labelSequentialType=ia.C,this.labelUpdated=new e.bkB,this.offsetUpdated=new e.bkB,this.pinClicked=new e.bkB,this.tagClicked=new e.bkB,this.displayUpdated=new e.bkB,this.positionUpdated=new e.bkB,this.hoverStart=new e.bkB,this.hoverEnd=new e.bkB,this.labelOffsetUpdated=new e.bkB,this.fit=(0,e.hFB)("fixed"),this.opaque=(0,e.hFB)(!1),this.fixedScale=(0,e.hFB)(0),this.sequence=(0,e.hFB)(void 0),this.hasContent=(0,e.hFB)(void 0),this.isCollapsed=(0,e.hFB)(!1),this.descriptionCollapsed=(0,e.hFB)(void 0),this.tagCollapsed=(0,e.hFB)(!1),this.theme=(0,e.hFB)("classic"),this.pinDraggable=(0,e.hFB)(!0),this.tagDraggable=(0,e.hFB)(!0),this.label=(0,e.hFB)(),this._selected=!1,this.isLightTheme=(0,e.EWP)(()=>{const ee=this.label();return[Hi.D.StudioNext,Hi.D.Custom].includes(ee?.theme)}),this.isDarkTheme=(0,e.EWP)(()=>{const ee=this.label();return[Hi.D.Annotation,Hi.D.Classic].includes(ee?.theme)}),this.enginePosition=null,this.isBackgroundDark=!1,this.pinDragging=!1,this.screenshotMode=!1,this.hammerManagers=[],this.displayUpdated$=new k.B,this.positionUpdated$=new k.B,this.ngUnsubscribe=new k.B,this.dir=(0,Jn.NS)(this.localeId).direction,(0,e.QZP)(()=>{const ee=this.label();(0,u.isEmpty)(ee)?this.destroyLabel():this.initLabel(ee)})}ngOnInit(){this.initListeners()}ngAfterViewInit(){this.bindTagEvents(),this.bindPinEvents(),this.bindHoverEvents()}ngOnDestroy(){this.destroyLabel(),this.emitDisplayUpdated({id:this.label().id,inView:!1,shown:!1,objectShown:this.objectShown}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}destroyLabel(){this.hammerManagers.forEach(i=>i.destroy()),this.hammerManagers=[],this.deleteMarker(this.marker)}initListeners(){this.enginePosition$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.enginePosition=i}),this.engineService.getEvent(Ct.X.Tick).pipe((0,D.p)(()=>!(0,u.isNil)(this.label())&&!(0,u.isNil)(this.enginePosition)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setCanvasPos()}),this.displayUpdated$.pipe((0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.displayUpdated.next(i)}),this.positionUpdated$.pipe((0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.positionUpdated.next(i)}),this.background$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.colors.slice(0,3),o=i.colors.slice(4,7);this.isBackgroundDark=!Or.T.isLight(t,o),this.changeDetection.markForCheck()}),this.actions.pipe((0,l.xi)(Ts.V9),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!0,this.changeDetection.detectChanges()}),this.actions.pipe((0,l.rM)(Ts.WX),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.screenshotMode=!1,this.changeDetection.markForCheck()}),this.hovered$=(0,ki.h)(this.hoverStart.asObservable().pipe((0,W.T)(()=>!0)),this.hoverEnd.asObservable().pipe((0,W.T)(()=>!1)))}bindTagEvents(){const i=new ei.Manager(this.tagRef.nativeElement,{domEvents:!0});i.add(new ei.Pan({direction:ei.DIRECTION_ALL,threshold:3})),i.add(new ei.Tap({event:"tap"})),i.on("pan",t=>{if(!this.tagDraggable())return;t.srcEvent.stopPropagation(),this.cachedTagOffset||(this.cachedTagOffset=this.label().offset);const o=[this.cachedTagOffset[0]+t.deltaX,this.cachedTagOffset[1]+t.deltaY];this.label().offset=o,t.isFinal&&(this.cachedTagOffset=null,this.offsetUpdated.next({labelId:this.label().id,offset:o}))}),i.on("tap",t=>{t.srcEvent.preventDefault(),t.srcEvent.stopPropagation(),this.tagClicked.next(t)}),this.hammerManagers.push(i)}bindPinEvents(){if(this.label().pinType===ci.O.None)return;const i=new ei.Manager(this.pinRef.nativeElement);i.add(new ei.Pan({direction:ei.DIRECTION_ALL,threshold:4})),i.add(new ei.Tap({event:"tap"})),i.on("pan",t=>{if(!this.pinDraggable())return;t.srcEvent.stopPropagation(),this.pinDragging=!0;let{layerX:o,layerY:s}=t.changedPointers[0];if(o-=16,s-=16,this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${o}px, ${s}px)`),t.isFinal){this.pinDragging=!1;const a={...this.label()},r=this.engineRendererService.pick(o,s),_="string"==typeof r.objectId;_&&(a.dir=this.cameraService.getDirection(r),a.objectId=r.objectId,a.barycentric=[r.barycentric[0],r.barycentric[1],r.barycentric[2]],a.pos=[r.worldPos[0],r.worldPos[1],r.worldPos[2]],a.primitiveIndex=r.triIndex),this.labelUpdated.next({label:a,shouldPreserve:_})}}),i.on("tap",t=>{t.srcEvent.preventDefault(),t.srcEvent.stopImmediatePropagation(),this.pinClicked.next(t)}),this.hammerManagers.push(i)}bindHoverEvents(){const i=this.labelRef.nativeElement;this.renderer.listen(i,"mouseenter",()=>{this.hoverStart.next({labelId:this.label().id})}),this.renderer.listen(i,"mouseleave",()=>{this.hoverEnd.next({labelId:this.label().id})})}initLabel(i){this.initMarker(i),this.ensureObjectId(i),this.initObjectSubscription(i)}initMarker(i){this.marker&&this.deleteMarker(this.marker),this.marker=this.markerService.createMarker(i)}checkLabelDisplay(){return{id:this.label().id,shown:this.label().shown,inView:this.isOnCanvas(),objectShown:!0}}ensureObjectId(i){if(!i.objectId&&this.marker){const[t,o]=this.marker.screenPosition,s=this.engineRendererService.pick(t,o);s.objectId&&(i.objectId=s.objectId,i.states.forEach(a=>{a.errands.forEach(r=>{r.type===es.X.flyToObject&&(r.value=s.objectId)})}),this.labelUpdated.next({label:i,shouldPreserve:void 0}))}}initObjectSubscription(i){this.object$&&this.object$.unsubscribe(),i.objectId&&(this.object$=this.store.select(ze.S.getViewGraphNode).pipe((0,W.T)(t=>t(i.objectId)),(0,D.p)(t=>!!t),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.objectShown=t.boolState.shown}))}deleteMarker(i){this.markerService.deleteMarker(i?.id),this.marker=null}setCanvasPos(){if(this.pinDragging||!this.marker)return void((0,u.isNil)(this.marker)&&this.setDisplay(!1));const i=this.isOccluded(),t=this.isOcclusionIgnored(),o=this.isOnCanvas(),s=i&&!t,a=void 0===this.objectShown?o&&!s:o&&this.objectShown&&!s;a!==this.shown&&(this.shown=a,this.setDisplay(a)),this.setElementPosition(),this.setElementScale(),this.setTagPosition(),this.setWirePosition();const[_,g]=this.marker.screenPosition;this.positionUpdated$.next({positionUpdate:{id:this.label().id,canvasPos:{x:_,y:g},occluded:s},onCanvas:o})}isOcclusionIgnored(){return this.selected||!this.label().occludable}isOccluded(){return this.marker?.occluded}isOnCanvas(){if(!this.marker)return!1;const{offsetWidth:i,offsetHeight:t}=this.labelsService.getLabelContainer().nativeElement,[o,s]=this.marker.screenPosition;return o>0&&s>0&&o<i&&s<t}setDisplay(i){this.renderer.setStyle(this.labelRef.nativeElement,"visibility",i?"visible":"hidden"),this.emitDisplayUpdated({id:this.label().id,inView:this.isOnCanvas(),shown:i,objectShown:this.objectShown})}setElementPosition(){const[i,t]=this.marker?.screenPosition??[0,0];this.renderer.setStyle(this.labelContainerRef.nativeElement,"transform",`translate(${i}px, ${t}px)`)}setElementScale(){let i;const t=this.fixedScale();if(t)i=t;else{const s=this.store.selectSnapshot(ze.S.getEnginePosition).width;i=s>1440?s/1440:1}const o=32*i-32;this.renderer.setStyle(this.labelRef.nativeElement,"transform-origin","top left"),this.renderer.setStyle(this.labelRef.nativeElement,"transform",`translate(-${o/2}px, -${o/2}px) scale(${i}, ${i})`)}setTagPosition(){const[i,t]=this.label().offset,o=this.tagRef.nativeElement.offsetWidth;let s;s=this.label().pinType===ci.O.None&&this.label().hideWire||i>0?"left":"right";let a=20,r=6;switch(this.label().theme){case Hi.D.Annotation:case Hi.D.Classic:a="right"===s?18:22,r=10}switch(s){case"left":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${a+i}px, ${r+t}px)`);break;case"right":this.renderer.setStyle(this.tagRef.nativeElement,"transform",`translate(${a+i-o}px, ${r+t}px)`)}}setWirePosition(){let[i,t]=this.label().offset;switch(this.label().theme){case Hi.D.Annotation:case Hi.D.Classic:t+=this.titleRef.nativeElement.offsetHeight-16-2}const o=Math.sqrt(i*i+t*t);this.renderer.setStyle(this.wireRef.nativeElement,"width",`${o}px`),this.renderer.setStyle(this.wireRef.nativeElement,"transform",`rotate(${Math.atan2(t,i)}rad)`)}emitDisplayUpdated(i){this.label().id!==hl&&(null==i.inView||null==i.shown||this.displayUpdated$.next(i))}static#e=this.\u0275fac=function(t){return new(t||Yo)(e.rXU(e.sFG),e.rXU(Tr.x),e.rXU(v.y),e.rXU(go.j),e.rXU(Er.z),e.rXU(l.il),e.rXU(l.En),e.rXU(e.gRc),e.rXU(nr),e.rXU(e.xe9))};static#t=this.\u0275cmp=e.VBU({type:Yo,selectors:[["app-generic-label"]],viewQuery:function(t,o){if(1&t&&(e.GBs(cE,5),e.GBs(dE,5),e.GBs(_E,5),e.GBs(pE,5),e.GBs(uE,5),e.GBs(hE,5)),2&t){let s;e.mGM(s=e.lsd())&&(o.labelContainerRef=s.first),e.mGM(s=e.lsd())&&(o.labelRef=s.first),e.mGM(s=e.lsd())&&(o.wireRef=s.first),e.mGM(s=e.lsd())&&(o.tagRef=s.first),e.mGM(s=e.lsd())&&(o.pinRef=s.first),e.mGM(s=e.lsd())&&(o.titleRef=s.first)}},hostVars:2,hostBindings:function(t,o){2&t&&e.AVh("selected",o.selected)},inputs:{fit:[1,"fit"],opaque:[1,"opaque"],fixedScale:[1,"fixedScale"],sequence:[1,"sequence"],hasContent:[1,"hasContent"],isCollapsed:[1,"isCollapsed"],descriptionCollapsed:[1,"descriptionCollapsed"],tagCollapsed:[1,"tagCollapsed"],theme:[1,"theme"],pinDraggable:[1,"pinDraggable"],tagDraggable:[1,"tagDraggable"],label:[1,"label"],selected:"selected"},outputs:{labelUpdated:"labelUpdated",offsetUpdated:"offsetUpdated",pinClicked:"pinClicked",tagClicked:"tagClicked",displayUpdated:"displayUpdated",positionUpdated:"positionUpdated",hoverStart:"hoverStart",hoverEnd:"hoverEnd",labelOffsetUpdated:"labelOffsetUpdated"},standalone:!0,features:[e.aNF],ngContentSelectors:mE,decls:19,vars:26,consts:[["labelContainerEl",""],["labelEl",""],["wire",""],["tag",""],["title",""],["pin",""],["data-test","labelContainer",1,"label-container"],["data-test","labelElement",1,"label",3,"ngClass"],[1,"label__pin"],[1,"label__wire",3,"ngClass"],["aria-hidden","true",1,"label__tag",3,"dir","ngClass"],[1,"label__header"],["data-test","labelTitle",1,"label__title"],["class","label__more","appLogicalDir","",4,"ngIf"],["appEventFence","",1,"label__actions"],["class","label__body",3,"ngClass",4,"ngIf"],[3,"pinType","labelTheme","glow","selected","hovered","sequence","foregroundColor","backgroundColor"],["appLogicalDir","",1,"label__more"],["src","./assets/images/labels/caret-right.svg"],[1,"label__body",3,"ngClass"]],template:function(t,o){1&t&&(e.NAR(gE),e.j41(0,"div",6,0)(2,"div",7,1),e.nI1(4,"async"),e.DNE(5,vE,4,10,"div",8),e.nrm(6,"div",9,2),e.j41(8,"div",10,3)(10,"div",11)(11,"div",12,4),e.SdG(13),e.k0s(),e.DNE(14,EE,2,0,"div",13),e.j41(15,"div",14),e.SdG(16,1),e.k0s()(),e.DNE(17,CE,2,3,"div",15),e.SdG(18,2),e.k0s()()()),2&t&&(e.R7$(2),e.Y8G("ngClass",e.zJS(9,fE,[o.selected,e.bMT(4,7,o.hovered$),o.isDarkTheme(),o.isBackgroundDark,o.isLightTheme(),"context"===o.label().theme,o.screenshotMode,"auto"===o.fit(),o.opaque()])),e.R7$(3),e.vxM("none"!==o.label().pinType?5:-1),e.R7$(),e.Y8G("ngClass",e.eq3(19,SE,o.isCollapsed()||o.tagCollapsed()||o.label().hideWire)),e.R7$(2),e.Y8G("dir",o.dir)("ngClass",e.ziG(21,bE,o.isCollapsed()||o.tagCollapsed(),o.label().collapseDescription,o.label().hideWire,o.tagDraggable())),e.R7$(6),e.Y8G("ngIf",o.hasContent()&&o.label().collapseDescription),e.R7$(3),e.Y8G("ngIf",o.hasContent()))},dependencies:[J.MD,J.YU,J.bT,J.Jj,wp],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{opacity:1;display:block}}@keyframes _ngcontent-%COMP%_fadeOut{0%{display:block;opacity:1}99%{opacity:0}to{opacity:0;display:none}}[_nghost-%COMP%], .label-container[_ngcontent-%COMP%]{display:block;position:absolute;z-index:10;width:200px;pointer-events:all;pointer-events:none}[_nghost-%COMP%]:hover, .label-container[_ngcontent-%COMP%]:hover{z-index:12}.selected[_nghost-%COMP%]{z-index:11}.label-container[_ngcontent-%COMP%]{left:-16px;top:-16px}.label[_ngcontent-%COMP%]{display:block;overflow:visible;-webkit-user-select:none;user-select:none;justify-content:center;align-items:center;height:32px}.label--screenshot-mode[_ngcontent-%COMP%]{text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:before, .label--screenshot-mode[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%]:after{box-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{box-shadow:none!important;text-shadow:none!important}.label--screenshot-mode[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:none!important}.label--auto-fit[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:max-content;padding:0!important}.label--auto-fit[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding:0!important}.label--selected[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{transform:rotate(45deg)}.label__more[_ngcontent-%COMP%]{color:#384c6c;display:none;flex:0 0 16px;height:16px;align-items:center;justify-content:center;transition:transform .15s ease-in-out}.label__pin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;position:absolute;pointer-events:all;transition:background-color .12s;z-index:10}.label__pin[_ngcontent-%COMP%]:hover, .label__pin--draggable[_ngcontent-%COMP%]:hover{cursor:pointer}.label__wire[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;height:0;transform-origin:0 100%;pointer-events:none;z-index:1}.label__wire--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]{display:inline-block;left:16px;top:0;z-index:10;max-width:160px;pointer-events:all}.label__tag[_ngcontent-%COMP%]:hover, .label__tag--draggable[_ngcontent-%COMP%]:hover{cursor:pointer}.label__tag--collapse[_ngcontent-%COMP%]{display:none}.label__tag[_ngcontent-%COMP%]:focus{outline:#2472e9 solid 2px!important;border-radius:4px}.label__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;line-height:140%;align-self:center}.label__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;letter-spacing:0;padding-top:12px}.label__body--collapse[_ngcontent-%COMP%]{display:none}.label__icon[_ngcontent-%COMP%]{margin:0 -4px 0 4px}.label__actions[_ngcontent-%COMP%]{padding-left:4px}.label--studio.label--opaque[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#ffffffd9!important}.label--studio.label.label--hovered[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff}.label--studio.label.label--hovered[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%], .label--studio.label.label--selected[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#2472e9}.label--studio.label.label--hovered[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%], .label--studio.label.label--selected[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background-color:#fff;border-color:#2472e9;box-shadow:0 0 0 1px #2472e9b3}.label--studio.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid rgba(12,23,38,.8);box-shadow:0 0 0 1px #f9fafd40}.label--studio.label[_ngcontent-%COMP%]   .label__wire--collapse[_ngcontent-%COMP%]{display:none}.label--studio.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{background:#ffffff8c;border:1px solid rgba(12,23,38,.8);box-shadow:0 0 24px #0c17261a;padding:4px 8px;border-radius:4px;max-width:200px}.label--studio.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#0c1726;flex:1 1 auto}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#384c6c;padding-top:4px}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--studio.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.label--studio.label[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex}.label--annotation.label--none[_ngcontent-%COMP%]{display:none}.label--annotation.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-top:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{min-width:10px;color:#eee}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__tag--floating[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:none}.label--annotation.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:focus{outline-offset:4px}.label--annotation.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-bottom:1px solid #666666}.label--annotation.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;min-height:18px;width:100%;padding-bottom:4px;margin-bottom:-2px;color:#000}.label--annotation.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{padding-top:4px;color:#333}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__tag--collapsible[_ngcontent-%COMP%]   .label__more[_ngcontent-%COMP%]{display:flex;color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{color:#fff}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{border-color:#eee}.label--annotation.label.label--invert.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{color:#eee}.label--context.label[_ngcontent-%COMP%]{pointer-events:none}.label--context.label[_ngcontent-%COMP%]   .label__pin[_ngcontent-%COMP%], .label--context.label[_ngcontent-%COMP%]   .label__wire[_ngcontent-%COMP%]{display:none}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;background:#ffffffb3;border:1px solid rgba(12,23,38,.8);box-shadow:0 0 24px #0c17261a;padding:0;border-radius:4px;width:fit-content;min-width:200px;max-width:none;min-height:75px;opacity:1;transition:width .25s,opacity .1s}.label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]:hover{background:#fffc;cursor:pointer}.label--context.label[_ngcontent-%COMP%]   .label__header[_ngcontent-%COMP%]{padding:4px 8px 0}.label--context.label[_ngcontent-%COMP%]   .label__title[_ngcontent-%COMP%]{font-weight:600;color:#0c1726}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid #e7eaee;color:#0c1726;overflow-x:hidden;padding-top:8px}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.label--context.label[_ngcontent-%COMP%]   .label__body[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.context-label--large[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:300px}@media (min-width: 960px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{width:400px}}@media (max-width: 959px){.context-label--expanded[_nghost-%COMP%]   .label--context.label[_ngcontent-%COMP%]   .label__tag[_ngcontent-%COMP%]{opacity:0}}"],changeDetection:0})}fm([(0,l.l6)(ze.S.getEnginePosition),Sm("design:type",h.c)],Yo.prototype,"enginePosition$",void 0),fm([(0,l.l6)(me.N.getSelectedChapterBackground),Sm("design:type",h.c)],Yo.prototype,"background$",void 0);var Mr=function(n){return n.Normal="normal",n.Compact="compact",n}(Mr||{}),Ko=d(70914);let ym=(()=>{class n{constructor(){this.layout=Mr.Normal}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-markdown-block"]],inputs:{markdownBlock:"markdownBlock",layout:"layout"},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[[1,"markdown-block"],[3,"markdownText"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.nrm(1,"app-html",1),e.k0s()),2&o&&(e.R7$(),e.Y8G("markdownText",s.markdownBlock.markdown))},dependencies:[Ko.V],encapsulation:2,changeDetection:0})}return n})();var Lt=d(35056),Kt=d(14823),bn=d(11818),sn=d(72026),TE=d(26621);function OE(n,i){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-image-view",10),e.k0s()),2&n){const t=e.XpG(3);e.AVh("mb-3",t.currentImage().caption),e.R7$(),e.Y8G("src",t.currentImage().urls.small)("fullscreenSrc",t.currentImage().urls.default)("alt",t.currentImage().alt)("fit",t.fit)("fitSize",t.fitSize)}}function ME(n,i){1&n&&(e.j41(0,"div",8)(1,"div",11),e.pXf(2,0),e.k0s(),e.j41(3,"div",12),e.pXf(4,1),e.k0s()())}function IE(n,i){if(1&n&&e.DNE(0,OE,2,7,"div",7)(1,ME,5,0,"div",8),2&n){const t=e.XpG(2);e.vxM(!0===t.currentImage().transcoded?0:!1===t.currentImage().transcoded?1:-1)}}function PE(n,i){if(1&n&&e.nrm(0,"app-html",13),2&n){const t=e.XpG(2);e.Y8G("markdownText",t.currentImage().caption)}}function wE(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",14)(1,"button",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handlePrevClick())}),e.nrm(2,"app-icon",16),e.k0s(),e.j41(3,"button",17),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleNextClick())}),e.nrm(4,"app-icon",18),e.k0s()()}}function AE(n,i){if(1&n&&(e.j41(0,"div",3)(1,"div",4),e.DNE(2,IE,2,1)(3,PE,1,1,"app-html",5)(4,wE,5,0,"div",6),e.k0s()()),2&n){const t=e.XpG();e.HbH("images-block--"+t.layout),e.AVh("images-block--slideshow",t.images&&t.images.length>1),e.R7$(2),e.vxM(t.currentImage().urls?2:-1),e.R7$(),e.Y8G("ngIf",t.currentImage().caption),e.R7$(),e.Y8G("ngIf",t.images.length>1)}}let vm=(()=>{class n{get imagesBlock(){return this._imagesBlock}set imagesBlock(t){this._imagesBlock=t;const o=(0,u.get)(t,"images",[]).map(s=>{const a=this.contentBlocksService.isImageBlock(this.imagesBlock),r=(0,e.vPA)({...s,transcoded:a||void 0});return a||this.checkTranscodingStatus(r),r});o.length&&(this.images=o,this.currentImage=this.images[0])}get fit(){return"compact"===this.layout?"auto":"normal"}get fitSize(){return"compact"===this.layout?100:void 0}constructor(t,o){this.contentBlocksService=t,this.mediaService=o,this.currentImage=(0,e.vPA)(null),this.layout=Mr.Normal}handlePrevClick(){let t=this.getCurrentImageIndex();t--,t<0&&(t=this.images.length-1),this.currentImage=this.images[t]}handleNextClick(){let t=this.getCurrentImageIndex();t++,t>=this.images.length&&(t=0),this.currentImage=this.images[t]}getCurrentImageIndex(){return this.images.indexOf(this.currentImage)}checkTranscodingStatus(t){var o=this;return(0,pt.A)(function*(){const s=yield o.mediaService.checkAnimatedImageStatus(t().urls.default);t.set({...t(),transcoded:s})})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Ns.V),e.rXU(vi))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-images-block"]],inputs:{imagesBlock:"imagesBlock",layout:"layout"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let t,o,s,a,r,_;return t=$localize`:e58ec8a32823536140cecc28fb83731389a6bdd64428081059558168074:Processing...`,o=$localize`:d42c9f0fedd02c63f5c7c427be1d009a60bc222a1933294937220675094:Please check back in a few minutes for updates.`,s=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,a=$localize`:bff50c5768e60557928b77318e5dbeff17952bfe338174691477444439:Previous Image`,r=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,_=$localize`:e1c872c4f9394cb6870bf82b7227481e47eaa8414885809904292086423:Next Image`,[t,o,["class","images-block","data-test","images-block",3,"class","images-block--slideshow",4,"ngIf"],["data-test","images-block",1,"images-block"],[1,"images-block__content"],["class","images-block__caption",3,"markdownText",4,"ngIf"],["class","images-block__actions",4,"ngIf"],[1,"images-block__image-container",3,"mb-3"],[1,"images-block__image-processing"],[1,"images-block__image-container"],[1,"images-block__image-view",3,"src","fullscreenSrc","alt","fit","fitSize"],[1,"text-xs","font-semibold"],[1,"mt-1","text-2xs"],[1,"images-block__caption",3,"markdownText"],[1,"images-block__actions"],["type","button","app-view-button","","buttonSize","sm","matTooltip",s,"aria-label",a,3,"click"],["icon","chevron-left"],["type","button","app-view-button","","buttonSize","sm","matTooltip",r,"aria-label",_,3,"click"],["icon","chevron-right"]]},template:function(o,s){1&o&&e.DNE(0,AE,5,7,"div",2),2&o&&e.Y8G("ngIf",s.currentImage)},dependencies:[J.MD,J.bT,sn.o,ut.R,bn.C,Qt.ri,Kt.uc,Kt.oV,Ko.V,TE.o],styles:[".images-block__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.images-block__image-processing{display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;background-color:#fff;border:1px solid #8999b3;border-radius:4px;padding:0 20px;aspect-ratio:16/9;color:#384c6c}.images-block__label{font-size:12px;letter-spacing:.72px;line-height:1.25em;text-transform:uppercase;color:#384c6c;font-weight:600;display:flex;align-items:center;min-height:28px}.images-block__image-container{display:flex;justify-content:center;background-color:#f8f9fa}.images-block__image-view{display:flex;height:100%;min-height:32px}.images-block__caption{font-size:12px;margin-top:12px}.images-block__actions{display:flex;justify-content:flex-end;margin-top:14px}.images-block--slideshow .images-block__image-container{height:200px}\n"],encapsulation:2,changeDetection:0})}return n})();var Nt=d(45189),Em=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Cm=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const NE=["image"],kE=["imagePre"],DE=["imagePost"],LE=["imageContainer"];function UE(n,i){if(1&n&&(e.nrm(0,"div",5),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.label)),e.npT)}}function xE(n,i){if(1&n&&e.nrm(0,"img",7,2),2&n){const t=e.XpG();e.Y8G("src",t.imageUrl,e.B4B)}}function jE(n,i){if(1&n&&e.nrm(0,"img",8,3),2&n){const t=e.XpG();e.Y8G("src",t.imageUrl,e.B4B)}}class js{constructor(i,t,o,s){this.renderer=i,this.engineService=t,this.animationService=o,this.store=s,this.ngUnsubscribe=new k.B,this.loopImage=!1}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,D.p)(i=>!!i.animation),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame()})}initTimelineListener(){(0,ki.h)(this.engineService.getEvent(Ct.X.TimelineScrubbed),this.engineService.getEvent(Ct.X.TimelinePlaying)).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.getChapterPercent();this.moveImage(t)})}handleClick(i){const t=this.store.selectSnapshot(ze.S.getAnimationPlaying);t&&this.animationService.pause(),this.scrub(i),setTimeout(()=>{t&&this.animationService.unpause()})}scrub(i){if(i.currentTarget instanceof HTMLElement){const t=i.currentTarget.getBoundingClientRect(),a=this.timerange.lastTime-this.timerange.firstTime,_=(i.clientX-t.left-t.width/2)*(a/this.getImageWidth());let g=this.animationService.getTime()+_;this.loopImage&&(g<0?g=a+g:g>a&&(g-=a)),g>=0&&g<=a&&this.animationService.scrub(g)}}moveImage(i){const t=this.getImageWidth();this.renderer.setStyle(this.imageContainer.nativeElement,"transform",`translate(${i/100*-t}px, 0)`),this.loopImage&&(this.renderer.setStyle(this.imagePre.nativeElement,"transform",`translate(${-t}px, 0)`),this.renderer.setStyle(this.imagePost.nativeElement,"transform",`translate(${t}px, 0)`))}getImageWidth(){return this.image.nativeElement.getBoundingClientRect().width}getChapterPercent(){if((0,u.isNil)(this.timerange))return 0;const{firstTime:i,lastTime:t}=this.timerange,o=this.animationService.getTime();return Math.max(i,Math.min(o,t))/t*100}static#e=this.\u0275fac=function(t){return new(t||js)(e.rXU(e.sFG),e.rXU(v.y),e.rXU(co.O),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:js,selectors:[["app-ticker-block-item"]],viewQuery:function(t,o){if(1&t&&(e.GBs(NE,7),e.GBs(kE,5),e.GBs(DE,5),e.GBs(LE,7)),2&t){let s;e.mGM(s=e.lsd())&&(o.image=s.first),e.mGM(s=e.lsd())&&(o.imagePre=s.first),e.mGM(s=e.lsd())&&(o.imagePost=s.first),e.mGM(s=e.lsd())&&(o.imageContainer=s.first)}},inputs:{label:"label",imageUrl:"imageUrl",loopImage:"loopImage"},standalone:!0,features:[e.aNF],decls:8,vars:4,consts:[["imageContainer",""],["image",""],["imagePre",""],["imagePost",""],[1,"ticker-block-item",3,"click"],[1,"ticker-block-item__label","html",3,"innerHTML"],[1,"ticker-block-item__image-container"],[1,"ticker-block-item__image","ticker-block-item__image--pre",3,"src"],[1,"ticker-block-item__image","ticker-block-item__image--post",3,"src"],[1,"ticker-block-item__image",3,"src"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",4),e.bIt("click",function(r){return e.eBV(s),e.Njj(o.handleClick(r))}),e.DNE(1,UE,3,5,"div",5),e.j41(2,"div",6,0),e.DNE(4,xE,2,1,"img",7)(5,jE,2,1,"img",8),e.nrm(6,"img",9,1),e.k0s()()}2&t&&(e.R7$(),e.vxM(o.label?1:-1),e.R7$(3),e.vxM(o.loopImage?4:-1),e.R7$(),e.vxM(o.loopImage?5:-1),e.R7$(),e.Y8G("src",o.imageUrl,e.B4B))},dependencies:[J.MD,J.Jj,Wn.y2,Wn.i0],styles:['.ticker-block-item[_ngcontent-%COMP%]{--label-height: 24px;background:#f9fafd;background:linear-gradient(90deg,#f9fafd 20%,#fff0,#fff,#f9fafd 80%);overflow:hidden;padding-left:50%;position:relative;cursor:pointer}.ticker-block-item[_ngcontent-%COMP%]:hover   .ticker-block-item__label[_ngcontent-%COMP%]{background:#ffffffe6}.ticker-block-item[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;left:50%;top:0;height:100%;width:1px;background:red;box-shadow:0 0 0 4px #f003;z-index:10}.ticker-block-item__label[_ngcontent-%COMP%]{position:absolute;height:var(--label-height);left:0;top:0;width:100%;display:flex;align-items:center;font-size:12px;z-index:10;background:#ffffff8c}.ticker-block-item__image-container[_ngcontent-%COMP%]{position:relative;margin-top:var(--label-height);pointer-events:none;-webkit-user-select:none;user-select:none}.ticker-block-item__image[_ngcontent-%COMP%]{display:block;max-width:none}.ticker-block-item__image--pre[_ngcontent-%COMP%], .ticker-block-item__image--post[_ngcontent-%COMP%]{position:absolute;top:0;left:0}'],changeDetection:0})}Em([(0,l.l6)(ze.S.getAnimationPlaying),Cm("design:type",h.c)],js.prototype,"animationPlaying$",void 0),Em([(0,l.l6)(me.N.getSelectedChapterReadyState),Cm("design:type",h.c)],js.prototype,"chapterReadyState$",void 0);const GE=["guideline"];function $E(n,i){if(1&n&&e.nrm(0,"app-ticker-block-item",4),2&n){const t=i.$implicit,o=e.XpG(2);e.Y8G("imageUrl",t.urls.default)("label",t.caption)("loopImage",o.tickerBlock.loopImage)}}function BE(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",2)(1,"div",3),e.bIt("mouseenter",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleMouseEnter())})("mouseleave",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleMouseLeave())})("mousemove",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleMouseMove(s))}),e.Z7z(2,$E,1,3,"app-ticker-block-item",4,e.Vm6),e.nrm(4,"div",5,0),e.k0s(),e.j41(6,"button",6),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handlePlayClick())}),e.j41(7,"span",7),e.EFF(8),e.nI1(9,"async"),e.k0s(),e.nrm(10,"app-icon",8),e.nI1(11,"async"),e.j41(12,"span",9),e.pXf(13,1),e.nI1(14,"async"),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(2),e.Dyx(t.tickerBlock.images),e.R7$(6),e.JRh(t.getAnimationPlayingTooltip(e.bMT(9,3,t.animationPlaying$))),e.R7$(2),e.Y8G("icon",e.bMT(11,5,t.animationPlaying$)?"pause":"play"),e.R7$(4),e.uP7(e.bMT(14,7,t.animationPlaying$)?"Pause":"Play"),e.nnv(13)}}class Ca{constructor(i,t){this.store=i,this.renderer=t,this.ngUnsubscribe=new k.B}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayClick(){const i=this.store.selectSnapshot(ze.S.getAnimationPlaying);this.store.dispatch(new st.dE(!i))}getAnimationPlayingTooltip(i){return i?$localize`Pause Animation`:$localize`Play Animation`}handleMouseMove(i){const t=this.guideline.nativeElement,s=t.parentElement.getBoundingClientRect();this.renderer.setStyle(t,"transform",`translate(${i.clientX-s.left}px, 0)`)}handleMouseEnter(){this.renderer.setStyle(this.guideline.nativeElement,"display","block")}handleMouseLeave(){this.renderer.setStyle(this.guideline.nativeElement,"display","none")}static#e=this.\u0275fac=function(t){return new(t||Ca)(e.rXU(l.il),e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:Ca,selectors:[["app-ticker-block"]],viewQuery:function(t,o){if(1&t&&e.GBs(GE,5),2&t){let s;e.mGM(s=e.lsd())&&(o.guideline=s.first)}},inputs:{tickerBlock:"tickerBlock"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let i;return i=$localize`:026d242c5f68dd78d7735a118cb96c4d3ed15eb6793165009929591137:${"\ufffd0\ufffd"}:INTERPOLATION: Animation`,[["guideline",""],i,[1,"ticker-block"],[1,"ticker-block__item-container",3,"mouseenter","mouseleave","mousemove"],[3,"imageUrl","label","loopImage"],[1,"ticker-block__guideline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"ticker-block__play",3,"click"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"],[1,"ml-2","text-uppercase","text-10"]]},template:function(t,o){1&t&&e.DNE(0,BE,15,9,"div",2),2&t&&e.vxM(o.tickerBlock?0:-1)},dependencies:[J.MD,J.Jj,bn.C,Qt.ri,sn.o,ut.R,js],styles:[".ticker-block__item-container[_ngcontent-%COMP%]{position:relative}.ticker-block__guideline[_ngcontent-%COMP%]{display:none;position:absolute;pointer-events:none;left:0;top:0;height:100%;width:1px;background:red;z-index:10}.ticker-block__play[_ngcontent-%COMP%]{width:100%;margin:12px 0}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(ze.S.getAnimationPlaying),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Ca.prototype,"animationPlaying$",void 0);const zE=["target"];var ec=function(n){return n.Basic="basic",n.Full="full",n}(ec||{});const WE={[ec.Basic]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay"],[ec.Full]:["progressControl","playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","customControlSpacer","pictureInPictureToggle","fullscreenToggle"]};let Tm=(()=>{class n{constructor(t){this.mediaService=t}ngOnInit(){var t=this;return(0,pt.A)(function*(){t.playerId=yield t.mediaService.addVideoPlayer(t.target.nativeElement,{preload:"metadata",sources:t.sources,fluid:!0,controls:!0,responsive:!0,controlBar:{volumePanel:{inline:!1},children:WE[t.mode]},breakpoints:{tiny:200}})})()}ngOnDestroy(){this.playerId&&this.mediaService.removeVideoPlayer(this.playerId)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vi))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-video-view"]],viewQuery:function(o,s){if(1&o&&e.GBs(zE,7),2&o){let a;e.mGM(a=e.lsd())&&(s.target=a.first)}},inputs:{sources:"sources",mode:"mode"},decls:2,vars:0,consts:[["target",""]],template:function(o,s){1&o&&e.nrm(0,"video-js",null,0)},styles:['@charset "UTF-8";.vjs-modal-dialog .vjs-modal-dialog-content,.video-js .vjs-modal-dialog,.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-button>.vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{text-align:center}@font-face{font-family:VideoJS;src:url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABDkAAsAAAAAG6gAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPgAAAFZRiV3hY21hcAAAAYQAAADaAAADPv749/pnbHlmAAACYAAAC3AAABHQZg6OcWhlYWQAAA3QAAAAKwAAADYZw251aGhlYQAADfwAAAAdAAAAJA+RCLFobXR4AAAOHAAAABMAAACM744AAGxvY2EAAA4wAAAASAAAAEhF6kqubWF4cAAADngAAAAfAAAAIAE0AIFuYW1lAAAOmAAAASUAAAIK1cf1oHBvc3QAAA/AAAABJAAAAdPExYuNeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS7wTiBgZWBgaWQ5RkDA8MvCM0cwxDOeI6BgYmBlZkBKwhIc01hcPjI+FGJHcRdyA4RZgQRADK3CxEAAHic7dFZbsMgAEXRS0ycyZnnOeG7y+qC8pU1dHusIOXxuoxaOlwZYWQB0Aea4quIEN4E9LzKbKjzDeM6H/mua6Lmc/p8yhg0lvdYx15ZG8uOLQOGjMp3EzqmzJizYMmKNRu27Nhz4MiJMxeu3Ljz4Ekqm7T8P52G8PP3lnTOVk++Z6iN6QZzNN1F7ptuN7eGOjDUoaGODHVsuvU8MdTO9Hd5aqgzQ50b6sJQl4a6MtS1oW4MdWuoO0PdG+rBUI+GejLUs6FeDPVqqDdDvRvqw1CfhpqM9At0iFLaAAB4nJ1YDXBTVRZ+5/22TUlJ8we0pHlJm7RJf5O8F2j6EymlSPkpxaL8U2xpa3DKj0CBhc2IW4eWKSokIoLsuMqssM64f+jA4HSdWXXXscBq67IOs3FXZ1ZYWVyRFdo899yXtIBQZ90k7717zz3v3HPPOfd854YCCj9cL9dL0RQFOqCbGJnrHb5EayiKIWN8iA/hWBblo6hUWm8TtCDwE80WMJus/irwyxOdxeB0MDb14VNJHnXYoLLSl6FfCUYO9nYPTA8Epg9090LprfbBbZ2hY0UlJUXHQp3/vtWkS6EBv8+rPMq5u9692f/dNxJNiqwC1xPE9TCUgCsSdQWgE3XQD25lkG4CN2xmTcOXWBOyser6RN6KnGbKSbmQ3+d0OI1m2W8QzLLkI2sykrWAgJJEtA8vGGW/2Q+CmT3n8zS9wZwu2DCvtuZKZN3xkrLh36yCZuUomQSqGpY8t/25VfHVhw8z4ebGBtfLb0ya9PCaDc+8dGTvk2dsh6z7WzvowlXKUSWo9MJ15a3KrEP2loOr2Ojhw6iW6hf2BDdEccQvZGpaAy7YovSwq8kr7HGllxpd71rkS6G0Sf11sl9OvMK1+jwPPODxjUwkOim9CU3ix1wNjXDfmJSEn618Bs6lpWwUpU+8PCqLMY650zjq8VhCIP17NEKTx3eaLL+s5Pi6yJWaWjTHLR1jYzPSV9VF/6Ojdb/1kO3Mk3uhHC0x6gc1BjlKQ+nQFxTYdaJkZ7ySVxLBbhR1dsboNXp1tCYKW2LRaEzpYcIx2BKNxaL0ZaUnSqfFoiNhHKR/GkX6PWUSAaJelQaqZL1EpoHNsajSEyPSoJ9IjhIxTdjHLmwZvhRDOiFTY/YeQnvrVZmiTQtGncECXtFTBZLOVwwMRgoXHAkXzMzPn1nAJJ8jYSbMDaqN2waGLzNhih/bZynUBMpIWSg7VYi7DRx2m8ALkIdRCJwI6ArJx2EI8kaDWeTQKeAFk9fjl/1AvwktjQ1P7NjyMGQyfd4vjipX6M/i52D7Cq80kqlcxEcGXRr/FEcgs0u5uGgB4VWuMFfpdn2Re6Hi3PqzmxWKsz6+ae2Pn9hXXw/fqM859UiGC0oKYYILJBqJrsn1Z1E5qOs9rQCiUQRREjm8yJcbHF5cUJufX1vAHlefw0XgUoboS3ETfQlTxBC4SOtuE8VPRJTBSCQSjZCpk7Gqzu+masaZ2y7Zjehho4F3g82BNDkAHpORG4+OCS+f6JTPmtRn/PH1kch6d04sp7AQb25aQ/pqUyXeQ8vrebG8OYQdXOQ+585u0sdW9rqalzRURiJ+9F4MweRFrKUjl1GUYhH1A27WOHw5cTFSFPMo9EeUIGnQTZHIaJ7AHLaOKsOODaNF9jkBjYG2QEsQ2xjMUAx2bBEbeTBWMHwskBjngq56S/yfgkBnWBa4K9sqKtq2t1UI8S9He5XuBRbawAdatrQEAi30Aks2+LM8WeCbalVZkWNylvJ+dqJnzVb+OHlSoKW8nPCP7Rd+CcZ2DdWAGqJ2CBFOphgywFFCFBNtfAbGtNPBCwxvygHeYMZMY9ZboBqwq/pVrsbgN5tkv152ODlbMfiqwGMBgxa4Exz3QhovRIUp6acqZmQzRq0ypDXS2TPLT02YIkQETnOE445oOGxOmXAqUJNNG7XgupMjPq2ua9asrj5yY/yuKteO1Kx0YNJTufrirLe1mZnat7OL6rnUdCWenpW6I8mAnbsY8KWs1PuSovCW9A/Z25PQ24a7cNOqgmTkLmBMgh4THgc4b9k2IVv1/g/F5nGljwPLfOgHAzJzh45V/4+WenTzmMtR5Z7us2Tys909UHqrPY7KbckoxRvRHhmVc3cJGE97uml0R1S0jdULVl7EvZtDFVBF35N9cEdjpgmAiOlFZ+Dtoh93+D3zzHr8RRNZQhnCNMNbcegOvpEwZoL+06cJQ07h+th3fZ/7PVbVC6ngTAV/KoLFuO6+2KFcU651gEb5ugPSIb1D+Xp8V4+k3sEIGnw5mYe4If4k1lFYr6SCzmM2EQ8iWtmwjnBI9kTwe1TlfAmXh7H02by9fW2gsjKwtv0aaURKil4OdV7rDL1MXIFNrhdxohcZXYTnq47WisrKitaObbf5+yvkLi5J6lCNZZ+B6GC38VNBZBDidSS/+mSvh6s+srgC8pyKMvDtt+de3c9fU76ZPfuM8ud4Kv0fyP/LqfepMT/3oZxSqpZaTa1DaQYLY8TFsHYbWYsPoRhRWfL5eSSQbhUGgGC3YLbVMk6PitTFNGpAsNrC6D1VNBKgBHMejaiuRWEWGgsSDBTJjqWIl8kJLlsaLJ2tXDr6xGfT85bM2Q06a46x2HTgvdnV8z5YDy/27J4zt6x2VtkzjoYpkq36kaBr4eQSg7tyiVweWubXZugtadl58ydapfbORfKsDTuZ0OBgx4cfdjCf5tbWNITnL120fdOi1RV1C3uKGzNdwYLcMvZ3BxoPyTOCD1XvXTp7U10gWCVmTV9b3r2z0SkGWovb2hp9I89O8a2smlyaO8muMU+dRmtzp60IzAoFpjLr1n388boLyf0dRvxhsHZ0qbWqDkwqvvpkj4l0fY6EIXRi5sQSrAvsVYwXRy4qJ2EVtD1AN7a0HWth9ymvL1xc3WTUKK/TAHA/bXDVtVWfOMfuGxGZv4Ln/jVr9jc3j1yMv0tndmyt9Vq88Y9gH1wtLX3KWjot5++jWHgAoZZkQ14wGQ20Fli71UmKJAy4xKMSTGbVdybW7FDDAut9XpD5AzWrYO7zQ8qffqF8+Ynd/clrHcdyxGy3a/3+mfNnzC/cBsveTjnTvXf1o6vzOlZw7WtqtdmPK/Errz/6NNtD72zmNOZfbmYdTGHfoofqI79Oc+R2n1lrnL6pOm0Up7kwxhTW12Amm7WYkXR2qYrF2AmgmbAsxZjwy1xpg/m1Je2vrp8v/nz2xpmlBg4E9hrMU341wVpTOh/OfmGvAnra8q6uctr60ZQHV3Q+WMQJykMj8ZsWn2QBOmmHMB+m5pDIpTFonYigiaKAhGEiAHF7EliVnQkjoLVIMPtJpBKHYd3A8GYH9jJzrWwmHx5Qjp7vDAX0suGRym1vtm/9W1/HyR8vczfMs6Sk8DSv855/5dlX9oQq52hT8syyp2rx5Id17IAyAM3wIjQPMOHzytEB64q6D5zT91yNbnx3V/nqnd017S9Y0605k3izoXLpsxde2n38yoOV9s1LcjwzNjbdX6asnBVaBj/6/DwKwPkpcqbDG7BnsXoSqWnUAmottYF6jMSdVyYZh3zVXCjwTiwwHH6sGuRiEHQGzuRX6whZkp123oy1BWE2mEfJ/tvIRtM4ZM5bDXiMsPMaAKOTyc5uL57rqyyc5y5JE5pm1i2S2iUX0CcaQ6lC6Zog7JqSqZmYlosl2K6pwNA84zRnQW6SaALYZQGW5lhCtU/W34N6o+bKfZ8cf3/Cl/+iTX3wBzpOY4mRkeNf3rptycGSshQWgGbYt5jFc2e0+DglIrwl6DVWQ7BuwaJ3Xk1J4VL5urnLl/Wf+gHU/hZoZdKNym6lG+I34FaNeZKcSpJIo2IeCVvpdsDGfKvzJnAwmeD37Ow65ZWwSowpgwX5T69s/rB55dP5BcpgDKFV8p7q2sn/1uc93bVzT/w6UrCqDTWvfCq/oCD/qZXNoUj8BL5Kp6GU017frfNXkAtiiyf/SOCEeLqnd8R/Ql9GlCRfctS6k5chvIBuQ1zCCjoCHL2DHNHIXxMJ3kQeO8lbsUXONeSfA5EjcG6/E+KdhN4bP04vBhdi883+BFBzQbxFbvZzQeY9LNBZc0FNfn5NwfDn6rCTnTw6R8o+gfpf5hCom33cRuiTlss3KHmZjD+BPN+5gXuA2ziS/Q73mLxUkpbKN/eqwz5uK0X9F3h2d1V4nGNgZGBgAOJd776+iue3+crAzc4AAje5Bfcg0xz9YHEOBiYQBQA8FQlFAHicY2BkYGBnAAGOPgaG//85+hkYGVCBMgBGGwNYAAAAeJxjYGBgYB8EmKOPgQEAQ04BfgAAAAAAAA4AaAB+AMwA4AECAUIBbAGYAcICGAJYArQC4AMwA7AD3gQwBJYE3AUkBWYFigYgBmYGtAbqB1gIEghYCG4IhAi2COh4nGNgZGBgUGYoZWBnAAEmIOYCQgaG/2A+AwAYCQG2AHicXZBNaoNAGIZfE5PQCKFQ2lUps2oXBfOzzAESyDKBQJdGR2NQR3QSSE/QE/QEPUUPUHqsvsrXjTMw83zPvPMNCuAWP3DQDAejdm1GjzwS7pMmwi75XngAD4/CQ/oX4TFe4Qt7uMMbOzjuDc0EmXCP/C7cJ38Iu+RP4QEe8CU8pP8WHmOPX2EPz87TPo202ey2OjlnQSXV/6arOjWFmvszMWtd6CqwOlKHq6ovycLaWMWVydXKFFZnmVFlZU46tP7R2nI5ncbi/dDkfDtFBA2DDXbYkhKc+V0Bqs5Zt9JM1HQGBRTm/EezTmZNKtpcAMs9Yu6AK9caF76zoLWIWcfMGOSkVduvSWechqZsz040Ib2PY3urxBJTzriT95lipz+TN1fmAAAAeJxtkMl2wjAMRfOAhABlKm2h80C3+ajgCKKDY6cegP59TYBzukAL+z1Zsq8ctaJTTKPrsUQLbXQQI0EXKXroY4AbDDHCGBNMcYsZ7nCPB8yxwCOe8IwXvOIN7/jAJ76wxHfUqWX+OzgumWAjJMV17i0Ndlr6irLKO+qftdT7i6y4uFSUvCknay+lFYZIZaQcmfH/xIFdYn98bqhra1aKTM/6lWMnyaYirx1rFUQZFBkb2zJUtoXeJCeg0WnLtHeSFc3OtrnozNwqi0TkSpBMDB1nSde5oJXW23hTS2/T0LilglXX7dmFVxLnq5U0vYATHFk3zX3BOisoQHNDFDeZnqKDy9hRNawN7Vh727hFzcJ5c8TILrKZfH7tIPxAFP0BpLeJPA==) format("woff");font-weight:400;font-style:normal}.vjs-icon-play,.video-js .vjs-play-control .vjs-icon-placeholder,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play:before,.video-js .vjs-play-control .vjs-icon-placeholder:before,.video-js .vjs-big-play-button .vjs-icon-placeholder:before{content:"\\f101"}.vjs-icon-play-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-play-circle:before{content:"\\f102"}.vjs-icon-pause,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pause:before,.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f103"}.vjs-icon-volume-mute,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mute:before,.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f104"}.vjs-icon-volume-low,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-low:before,.video-js .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder:before{content:"\\f105"}.vjs-icon-volume-mid,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-mid:before,.video-js .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder:before{content:"\\f106"}.vjs-icon-volume-high,.video-js .vjs-mute-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-volume-high:before,.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f107"}.vjs-icon-fullscreen-enter,.video-js .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-enter:before,.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f108"}.vjs-icon-fullscreen-exit,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-fullscreen-exit:before,.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f109"}.vjs-icon-square{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-square:before{content:"\\f10a"}.vjs-icon-spinner{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-spinner:before{content:"\\f10b"}.vjs-icon-subtitles,.video-js .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-subtitles-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-subtitles:before,.video-js .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-GB) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-IE) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-AU) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js.video-js:lang(en-NZ) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-subtitles-button .vjs-icon-placeholder:before{content:"\\f10c"}.vjs-icon-captions,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder,.video-js .vjs-captions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-captions:before,.video-js:lang(en) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js:lang(fr-CA) .vjs-subs-caps-button .vjs-icon-placeholder:before,.video-js .vjs-captions-button .vjs-icon-placeholder:before{content:"\\f10d"}.vjs-icon-chapters,.video-js .vjs-chapters-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-chapters:before,.video-js .vjs-chapters-button .vjs-icon-placeholder:before{content:"\\f10e"}.vjs-icon-share{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-share:before{content:"\\f10f"}.vjs-icon-cog{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cog:before{content:"\\f110"}.vjs-icon-circle,.vjs-seek-to-live-control .vjs-icon-placeholder,.video-js .vjs-volume-level,.video-js .vjs-play-progress{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle:before,.vjs-seek-to-live-control .vjs-icon-placeholder:before,.video-js .vjs-volume-level:before,.video-js .vjs-play-progress:before{content:"\\f111"}.vjs-icon-circle-outline{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-outline:before{content:"\\f112"}.vjs-icon-circle-inner-circle{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-circle-inner-circle:before{content:"\\f113"}.vjs-icon-hd{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-hd:before{content:"\\f114"}.vjs-icon-cancel,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-cancel:before,.video-js .vjs-control.vjs-close-button .vjs-icon-placeholder:before{content:"\\f115"}.vjs-icon-replay,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-replay:before,.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f116"}.vjs-icon-facebook{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-facebook:before{content:"\\f117"}.vjs-icon-gplus{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-gplus:before{content:"\\f118"}.vjs-icon-linkedin{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-linkedin:before{content:"\\f119"}.vjs-icon-twitter{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-twitter:before{content:"\\f11a"}.vjs-icon-tumblr{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-tumblr:before{content:"\\f11b"}.vjs-icon-pinterest{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-pinterest:before{content:"\\f11c"}.vjs-icon-audio-description,.video-js .vjs-descriptions-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio-description:before,.video-js .vjs-descriptions-button .vjs-icon-placeholder:before{content:"\\f11d"}.vjs-icon-audio,.video-js .vjs-audio-button .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-audio:before,.video-js .vjs-audio-button .vjs-icon-placeholder:before{content:"\\f11e"}.vjs-icon-next-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-next-item:before{content:"\\f11f"}.vjs-icon-previous-item{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-previous-item:before{content:"\\f120"}.vjs-icon-picture-in-picture-enter,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-enter:before,.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f121"}.vjs-icon-picture-in-picture-exit,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder{font-family:VideoJS;font-weight:400;font-style:normal}.vjs-icon-picture-in-picture-exit:before,.video-js.vjs-picture-in-picture .vjs-picture-in-picture-control .vjs-icon-placeholder:before{content:"\\f122"}.video-js{display:block;vertical-align:top;box-sizing:border-box;color:#fff;background-color:#000;position:relative;padding:0;font-size:10px;line-height:1;font-weight:400;font-style:normal;font-family:Arial,Helvetica,sans-serif;word-break:initial}.video-js:-moz-full-screen{position:absolute}.video-js:-webkit-full-screen{width:100%!important;height:100%!important}.video-js[tabindex="-1"]{outline:none}.video-js *,.video-js *:before,.video-js *:after{box-sizing:inherit}.video-js ul{font-family:inherit;font-size:inherit;line-height:inherit;list-style-position:outside;margin:0}.video-js.vjs-fluid,.video-js.vjs-16-9,.video-js.vjs-4-3,.video-js.vjs-9-16,.video-js.vjs-1-1{width:100%;max-width:100%}.video-js.vjs-fluid:not(.vjs-audio-only-mode),.video-js.vjs-16-9:not(.vjs-audio-only-mode),.video-js.vjs-4-3:not(.vjs-audio-only-mode),.video-js.vjs-9-16:not(.vjs-audio-only-mode),.video-js.vjs-1-1:not(.vjs-audio-only-mode){height:0}.video-js.vjs-16-9:not(.vjs-audio-only-mode){padding-top:56.25%}.video-js.vjs-4-3:not(.vjs-audio-only-mode){padding-top:75%}.video-js.vjs-9-16:not(.vjs-audio-only-mode){padding-top:177.7777777778%}.video-js.vjs-1-1:not(.vjs-audio-only-mode){padding-top:100%}.video-js.vjs-fill:not(.vjs-audio-only-mode){width:100%;height:100%}.video-js .vjs-tech{position:absolute;top:0;left:0;width:100%;height:100%}.video-js.vjs-audio-only-mode .vjs-tech{display:none}body.vjs-full-window{padding:0;margin:0;height:100%}.vjs-full-window .video-js.vjs-fullscreen{position:fixed;overflow:hidden;z-index:1000;inset:0}.video-js.vjs-fullscreen:not(.vjs-ios-native-fs){width:100%!important;height:100%!important;padding-top:0!important}.video-js.vjs-fullscreen.vjs-user-inactive{cursor:none}.vjs-hidden{display:none!important}.vjs-disabled{opacity:.5;cursor:default}.video-js .vjs-offscreen{height:1px;left:-9999px;position:absolute;top:0;width:1px}.vjs-lock-showing{display:block!important;opacity:1!important;visibility:visible!important}.vjs-no-js{padding:20px;color:#fff;background-color:#000;font-size:18px;font-family:Arial,Helvetica,sans-serif;text-align:center;width:300px;height:150px;margin:0 auto}.vjs-no-js a,.vjs-no-js a:visited{color:#66a8cc}.video-js .vjs-big-play-button{font-size:3em;line-height:1.5em;height:1.63332em;width:3em;display:block;position:absolute;top:10px;left:10px;padding:0;cursor:pointer;opacity:1;border:.06666em solid #fff;background-color:#2b333f;background-color:#2b333fb3;border-radius:.3em;transition:all .4s}.vjs-big-play-centered .vjs-big-play-button{top:50%;left:50%;margin-top:-.81666em;margin-left:-1.5em}.video-js:hover .vjs-big-play-button,.video-js .vjs-big-play-button:focus{border-color:#fff;background-color:#73859f;background-color:#73859f80;transition:all 0s}.vjs-controls-disabled .vjs-big-play-button,.vjs-has-started .vjs-big-play-button,.vjs-using-native-controls .vjs-big-play-button,.vjs-error .vjs-big-play-button{display:none}.vjs-has-started.vjs-paused.vjs-show-big-play-button-on-pause .vjs-big-play-button{display:block}.video-js button{background:none;border:none;color:inherit;display:inline-block;font-size:inherit;line-height:inherit;text-transform:none;text-decoration:none;transition:none;appearance:none}.vjs-control .vjs-button{width:100%;height:100%}.video-js .vjs-control.vjs-close-button{cursor:pointer;height:3em;position:absolute;right:0;top:.5em;z-index:2}.video-js .vjs-modal-dialog{background:#000c;background:linear-gradient(180deg,#000c,#fff0);overflow:auto}.video-js .vjs-modal-dialog>*{box-sizing:border-box}.vjs-modal-dialog .vjs-modal-dialog-content{font-size:1.2em;line-height:1.5;padding:20px 24px;z-index:1}.vjs-menu-button{cursor:pointer}.vjs-menu-button.vjs-disabled{cursor:default}.vjs-workinghover .vjs-menu-button.vjs-disabled:hover .vjs-menu{display:none}.vjs-menu .vjs-menu-content{display:block;padding:0;margin:0;font-family:Arial,Helvetica,sans-serif;overflow:auto}.vjs-menu .vjs-menu-content>*{box-sizing:border-box}.vjs-scrubbing .vjs-control.vjs-menu-button:hover .vjs-menu{display:none}.vjs-menu li{list-style:none;margin:0;padding:.2em 0;line-height:1.4em;font-size:1.2em;text-align:center;text-transform:lowercase}.vjs-menu li.vjs-menu-item:focus,.vjs-menu li.vjs-menu-item:hover,.js-focus-visible .vjs-menu li.vjs-menu-item:hover{background-color:#73859f;background-color:#73859f80}.vjs-menu li.vjs-selected,.vjs-menu li.vjs-selected:focus,.vjs-menu li.vjs-selected:hover,.js-focus-visible .vjs-menu li.vjs-selected:hover{background-color:#fff;color:#2b333f}.video-js .vjs-menu *:not(.vjs-selected):focus:not(:focus-visible),.js-focus-visible .vjs-menu *:not(.vjs-selected):focus:not(.focus-visible){background:none}.vjs-menu li.vjs-menu-title{text-align:center;text-transform:uppercase;font-size:1em;line-height:2em;padding:0;margin:0 0 .3em;font-weight:700;cursor:default}.vjs-menu-button-popup .vjs-menu{display:none;position:absolute;bottom:0;width:10em;left:-3em;height:0em;margin-bottom:1.5em;border-top-color:#2b333fb3}.vjs-menu-button-popup .vjs-menu .vjs-menu-content{background-color:#2b333f;background-color:#2b333fb3;position:absolute;width:100%;bottom:1.5em;max-height:15em}.vjs-layout-tiny .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:5em}.vjs-layout-small .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:10em}.vjs-layout-medium .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:14em}.vjs-layout-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-x-large .vjs-menu-button-popup .vjs-menu .vjs-menu-content,.vjs-layout-huge .vjs-menu-button-popup .vjs-menu .vjs-menu-content{max-height:25em}.vjs-workinghover .vjs-menu-button-popup.vjs-hover .vjs-menu,.vjs-menu-button-popup .vjs-menu.vjs-lock-showing{display:block}.video-js .vjs-menu-button-inline{transition:all .4s;overflow:hidden}.video-js .vjs-menu-button-inline:before{width:2.222222222em}.video-js .vjs-menu-button-inline:hover,.video-js .vjs-menu-button-inline:focus,.video-js .vjs-menu-button-inline.vjs-slider-active,.video-js.vjs-no-flex .vjs-menu-button-inline{width:12em}.vjs-menu-button-inline .vjs-menu{opacity:0;height:100%;width:auto;position:absolute;left:4em;top:0;padding:0;margin:0;transition:all .4s}.vjs-menu-button-inline:hover .vjs-menu,.vjs-menu-button-inline:focus .vjs-menu,.vjs-menu-button-inline.vjs-slider-active .vjs-menu{display:block;opacity:1}.vjs-no-flex .vjs-menu-button-inline .vjs-menu{display:block;opacity:1;position:relative;width:auto}.vjs-no-flex .vjs-menu-button-inline:hover .vjs-menu,.vjs-no-flex .vjs-menu-button-inline:focus .vjs-menu,.vjs-no-flex .vjs-menu-button-inline.vjs-slider-active .vjs-menu{width:auto}.vjs-menu-button-inline .vjs-menu-content{width:auto;height:100%;margin:0;overflow:hidden}.video-js .vjs-control-bar{display:none;width:100%;position:absolute;bottom:0;left:0;right:0;height:3em;background-color:#2b333f;background-color:#2b333fb3}.vjs-has-started .vjs-control-bar,.vjs-audio-only-mode .vjs-control-bar{display:flex;visibility:visible;opacity:1;transition:visibility .1s,opacity .1s}.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{visibility:visible;opacity:0;pointer-events:none;transition:visibility 1s,opacity 1s}.vjs-controls-disabled .vjs-control-bar,.vjs-using-native-controls .vjs-control-bar,.vjs-error .vjs-control-bar{display:none!important}.vjs-audio.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar,.vjs-audio-only-mode.vjs-has-started.vjs-user-inactive.vjs-playing .vjs-control-bar{opacity:1;visibility:visible;pointer-events:auto}.vjs-has-started.vjs-no-flex .vjs-control-bar{display:table}.video-js .vjs-control{position:relative;text-align:center;margin:0;padding:0;height:100%;width:4em;flex:none}.video-js .vjs-control.vjs-visible-text{width:auto;padding-left:1em;padding-right:1em}.vjs-button>.vjs-icon-placeholder:before{font-size:1.8em;line-height:1.67}.vjs-button>.vjs-icon-placeholder{display:block}.video-js .vjs-control:focus:before,.video-js .vjs-control:hover:before,.video-js .vjs-control:focus{text-shadow:0em 0em 1em white}.video-js *:not(.vjs-visible-text)>.vjs-control-text{border:0;clip:rect(0 0 0 0);height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.vjs-no-flex .vjs-control{display:table-cell;vertical-align:middle}.video-js .vjs-custom-control-spacer{display:none}.video-js .vjs-progress-control{cursor:pointer;flex:auto;display:flex;align-items:center;min-width:4em;touch-action:none}.video-js .vjs-progress-control.disabled{cursor:default}.vjs-live .vjs-progress-control{display:none}.vjs-liveui .vjs-progress-control{display:flex;align-items:center}.vjs-no-flex .vjs-progress-control{width:auto}.video-js .vjs-progress-holder{flex:auto;transition:all .2s;height:.3em}.video-js .vjs-progress-control .vjs-progress-holder{margin:0 10px}.video-js .vjs-progress-control:hover .vjs-progress-holder{font-size:1.6666666667em}.video-js .vjs-progress-control:hover .vjs-progress-holder.disabled{font-size:1em}.video-js .vjs-progress-holder .vjs-play-progress,.video-js .vjs-progress-holder .vjs-load-progress,.video-js .vjs-progress-holder .vjs-load-progress div{position:absolute;display:block;height:100%;margin:0;padding:0;width:0}.video-js .vjs-play-progress{background-color:#fff}.video-js .vjs-play-progress:before{font-size:.9em;position:absolute;right:-.5em;top:-.3333333333em;z-index:1}.video-js .vjs-load-progress{background:#73859f80}.video-js .vjs-load-progress div{background:#73859fbf}.video-js .vjs-time-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-progress-holder:focus .vjs-time-tooltip{display:none}.video-js .vjs-progress-control:hover .vjs-time-tooltip,.video-js .vjs-progress-control:hover .vjs-progress-holder:focus .vjs-time-tooltip{display:block;font-size:.6em;visibility:visible}.video-js .vjs-progress-control.disabled:hover .vjs-time-tooltip{font-size:1em}.video-js .vjs-progress-control .vjs-mouse-display{display:none;position:absolute;width:1px;height:100%;background-color:#000;z-index:1}.vjs-no-flex .vjs-progress-control .vjs-mouse-display{z-index:0}.video-js .vjs-progress-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-progress-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-progress-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-time-tooltip{color:#fff;background-color:#000;background-color:#000c}.video-js .vjs-slider{position:relative;cursor:pointer;padding:0;margin:0 .45em;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;background-color:#73859f;background-color:#73859f80}.video-js .vjs-slider.disabled{cursor:default}.video-js .vjs-slider:focus{text-shadow:0em 0em 1em white;box-shadow:0 0 1em #fff}.video-js .vjs-mute-control{cursor:pointer;flex:none}.video-js .vjs-volume-control{cursor:pointer;margin-right:1em;display:flex}.video-js .vjs-volume-control.vjs-volume-horizontal{width:5em}.video-js .vjs-volume-panel .vjs-volume-control{visibility:visible;opacity:0;width:1px;height:1px;margin-left:-1px}.video-js .vjs-volume-panel{transition:width 1s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control,.video-js .vjs-volume-panel:active .vjs-volume-control,.video-js .vjs-volume-panel:focus .vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control:active,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active{visibility:visible;opacity:1;position:relative;transition:visibility .1s,opacity .1s,height .1s,width .1s,left 0s,top 0s}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-horizontal,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-horizontal,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-horizontal{width:5em;height:3em;margin-right:0}.video-js .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:active .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel:focus .vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control:active.vjs-volume-vertical,.video-js .vjs-volume-panel.vjs-hover .vjs-mute-control~.vjs-volume-control.vjs-volume-vertical,.video-js .vjs-volume-panel .vjs-volume-control.vjs-slider-active.vjs-volume-vertical{left:-3.5em;transition:left 0s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active{width:10em;transition:width .1s}.video-js .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-mute-toggle-only{width:4em}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:8em;width:3em;left:-3000em;transition:visibility 1s,opacity 1s,height 1s 1s,width 1s 1s,left 1s 1s,top 1s 1s}.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{transition:visibility 1s,opacity 1s,height 1s 1s,width 1s,left 1s 1s,top 1s 1s}.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-horizontal{width:5em;height:3em;visibility:visible;opacity:1;position:relative;transition:none}.video-js.vjs-no-flex .vjs-volume-control.vjs-volume-vertical,.video-js.vjs-no-flex .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{position:absolute;bottom:3em;left:.5em}.video-js .vjs-volume-panel{display:flex}.video-js .vjs-volume-bar{margin:1.35em .45em}.vjs-volume-bar.vjs-slider-horizontal{width:5em;height:.3em}.vjs-volume-bar.vjs-slider-vertical{width:.3em;height:5em;margin:1.35em auto}.video-js .vjs-volume-level{position:absolute;bottom:0;left:0;background-color:#fff}.video-js .vjs-volume-level:before{position:absolute;font-size:.9em;z-index:1}.vjs-slider-vertical .vjs-volume-level{width:.3em}.vjs-slider-vertical .vjs-volume-level:before{top:-.5em;left:-.3em;z-index:1}.vjs-slider-horizontal .vjs-volume-level{height:.3em}.vjs-slider-horizontal .vjs-volume-level:before{top:-.3em;right:-.5em}.video-js .vjs-volume-panel.vjs-volume-panel-vertical{width:4em}.vjs-volume-bar.vjs-slider-vertical .vjs-volume-level{height:100%}.vjs-volume-bar.vjs-slider-horizontal .vjs-volume-level{width:100%}.video-js .vjs-volume-vertical{width:3em;height:8em;bottom:8em;background-color:#2b333f;background-color:#2b333fb3}.video-js .vjs-volume-horizontal .vjs-menu{left:-2em}.video-js .vjs-volume-tooltip{background-color:#fff;background-color:#fffc;border-radius:.3em;color:#000;float:right;font-family:Arial,Helvetica,sans-serif;font-size:1em;padding:6px 8px 8px;pointer-events:none;position:absolute;top:-3.4em;visibility:hidden;z-index:1}.video-js .vjs-volume-control:hover .vjs-volume-tooltip,.video-js .vjs-volume-control:hover .vjs-progress-holder:focus .vjs-volume-tooltip{display:block;font-size:1em;visibility:visible}.video-js .vjs-volume-vertical:hover .vjs-volume-tooltip,.video-js .vjs-volume-vertical:hover .vjs-progress-holder:focus .vjs-volume-tooltip{left:1em;top:-12px}.video-js .vjs-volume-control.disabled:hover .vjs-volume-tooltip{font-size:1em}.video-js .vjs-volume-control .vjs-mouse-display{display:none;position:absolute;width:100%;height:1px;background-color:#000;z-index:1}.video-js .vjs-volume-horizontal .vjs-mouse-display{width:1px;height:100%}.vjs-no-flex .vjs-volume-control .vjs-mouse-display{z-index:0}.video-js .vjs-volume-control:hover .vjs-mouse-display{display:block}.video-js.vjs-user-inactive .vjs-volume-control .vjs-mouse-display{visibility:hidden;opacity:0;transition:visibility 1s,opacity 1s}.video-js.vjs-user-inactive.vjs-no-flex .vjs-volume-control .vjs-mouse-display{display:none}.vjs-mouse-display .vjs-volume-tooltip{color:#fff;background-color:#000;background-color:#000c}.vjs-poster{display:inline-block;vertical-align:middle;background-repeat:no-repeat;background-position:50% 50%;background-size:contain;background-color:#000;cursor:pointer;margin:0;padding:0;position:absolute;inset:0;height:100%}.vjs-has-started .vjs-poster,.vjs-using-native-controls .vjs-poster{display:none}.vjs-audio.vjs-has-started .vjs-poster,.vjs-has-started.vjs-audio-poster-mode .vjs-poster{display:block}.video-js .vjs-live-control{display:flex;align-items:flex-start;flex:auto;font-size:1em;line-height:3em}.vjs-no-flex .vjs-live-control{display:table-cell;width:auto;text-align:left}.video-js:not(.vjs-live) .vjs-live-control,.video-js.vjs-liveui .vjs-live-control{display:none}.video-js .vjs-seek-to-live-control{align-items:center;cursor:pointer;flex:none;display:inline-flex;height:100%;padding-left:.5em;padding-right:.5em;font-size:1em;line-height:3em;width:auto;min-width:4em}.vjs-no-flex .vjs-seek-to-live-control{display:table-cell;width:auto;text-align:left}.video-js.vjs-live:not(.vjs-liveui) .vjs-seek-to-live-control,.video-js:not(.vjs-live) .vjs-seek-to-live-control{display:none}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge{cursor:auto}.vjs-seek-to-live-control .vjs-icon-placeholder{margin-right:.5em;color:#888}.vjs-seek-to-live-control.vjs-control.vjs-at-live-edge .vjs-icon-placeholder{color:red}.video-js .vjs-time-control{flex:none;font-size:1em;line-height:3em;min-width:2em;width:auto;padding-left:1em;padding-right:1em}.vjs-live .vjs-time-control,.video-js .vjs-current-time,.vjs-no-flex .vjs-current-time,.video-js .vjs-duration,.vjs-no-flex .vjs-duration{display:none}.vjs-time-divider{display:none;line-height:3em}.vjs-live .vjs-time-divider{display:none}.video-js .vjs-play-control{cursor:pointer}.video-js .vjs-play-control .vjs-icon-placeholder{flex:none}.vjs-text-track-display{position:absolute;inset:0 0 3em;pointer-events:none}.video-js.vjs-controls-disabled .vjs-text-track-display,.video-js.vjs-user-inactive.vjs-playing .vjs-text-track-display{bottom:1em}.video-js .vjs-text-track{font-size:1.4em;text-align:center;margin-bottom:.1em}.vjs-subtitles{color:#fff}.vjs-captions{color:#fc6}.vjs-tt-cue{display:block}video::-webkit-media-text-track-display{transform:translateY(-3em)}.video-js.vjs-controls-disabled video::-webkit-media-text-track-display,.video-js.vjs-user-inactive.vjs-playing video::-webkit-media-text-track-display{transform:translateY(-1.5em)}.video-js .vjs-picture-in-picture-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-picture-in-picture-control{display:none}.video-js .vjs-fullscreen-control{cursor:pointer;flex:none}.video-js.vjs-audio-only-mode .vjs-fullscreen-control{display:none}.vjs-playback-rate>.vjs-menu-button,.vjs-playback-rate .vjs-playback-rate-value{position:absolute;top:0;left:0;width:100%;height:100%}.vjs-playback-rate .vjs-playback-rate-value{pointer-events:none;font-size:1.5em;line-height:2;text-align:center}.vjs-playback-rate .vjs-menu{width:4em;left:0}.vjs-error .vjs-error-display .vjs-modal-dialog-content{font-size:1.4em;text-align:center}.vjs-error .vjs-error-display:before{color:#fff;content:"X";font-family:Arial,Helvetica,sans-serif;font-size:4em;left:0;line-height:1;margin-top:-.5em;position:absolute;text-shadow:.05em .05em .1em #000;text-align:center;top:50%;vertical-align:middle;width:100%}.vjs-loading-spinner{display:none;position:absolute;top:50%;left:50%;margin:-25px 0 0 -25px;opacity:.85;text-align:left;border:6px solid rgba(43,51,63,.7);box-sizing:border-box;background-clip:padding-box;width:50px;height:50px;border-radius:25px;visibility:hidden}.vjs-seeking .vjs-loading-spinner,.vjs-waiting .vjs-loading-spinner{display:block;animation:vjs-spinner-show 0s linear .3s forwards}.vjs-loading-spinner:before,.vjs-loading-spinner:after{content:"";position:absolute;margin:-6px;box-sizing:inherit;width:inherit;height:inherit;border-radius:inherit;opacity:1;border:inherit;border-color:transparent;border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:before,.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:after{animation:vjs-spinner-spin 1.1s cubic-bezier(.6,.2,0,.8) infinite,vjs-spinner-fade 1.1s linear infinite}.vjs-seeking .vjs-loading-spinner:before,.vjs-waiting .vjs-loading-spinner:before{border-top-color:#fff}.vjs-seeking .vjs-loading-spinner:after,.vjs-waiting .vjs-loading-spinner:after{border-top-color:#fff;animation-delay:.44s}@keyframes vjs-spinner-show{to{visibility:visible}}@keyframes vjs-spinner-spin{to{transform:rotate(360deg)}}@keyframes vjs-spinner-fade{0%{border-top-color:#73859f}20%{border-top-color:#73859f}35%{border-top-color:#fff}60%{border-top-color:#73859f}to{border-top-color:#73859f}}.video-js.vjs-audio-only-mode .vjs-captions-button{display:none}.vjs-chapters-button .vjs-menu ul{width:24em}.video-js.vjs-audio-only-mode .vjs-descriptions-button{display:none}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-subs-caps-button+.vjs-menu .vjs-captions-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:"\\f10d";font-size:1.5em;line-height:inherit}.video-js.vjs-audio-only-mode .vjs-subs-caps-button{display:none}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder{vertical-align:middle;display:inline-block;margin-bottom:-.1em}.video-js .vjs-audio-button+.vjs-menu .vjs-main-desc-menu-item .vjs-menu-item-text .vjs-icon-placeholder:before{font-family:VideoJS;content:" \\f11d";font-size:1.5em;line-height:inherit}.video-js.vjs-layout-small .vjs-current-time,.video-js.vjs-layout-small .vjs-time-divider,.video-js.vjs-layout-small .vjs-duration,.video-js.vjs-layout-small .vjs-remaining-time,.video-js.vjs-layout-small .vjs-playback-rate,.video-js.vjs-layout-small .vjs-volume-control,.video-js.vjs-layout-x-small .vjs-current-time,.video-js.vjs-layout-x-small .vjs-time-divider,.video-js.vjs-layout-x-small .vjs-duration,.video-js.vjs-layout-x-small .vjs-remaining-time,.video-js.vjs-layout-x-small .vjs-playback-rate,.video-js.vjs-layout-x-small .vjs-volume-control,.video-js.vjs-layout-tiny .vjs-current-time,.video-js.vjs-layout-tiny .vjs-time-divider,.video-js.vjs-layout-tiny .vjs-duration,.video-js.vjs-layout-tiny .vjs-remaining-time,.video-js.vjs-layout-tiny .vjs-playback-rate,.video-js.vjs-layout-tiny .vjs-volume-control{display:none}.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:hover,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal:active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-slider-active,.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-volume-panel-horizontal.vjs-hover{width:auto;width:initial}.video-js.vjs-layout-x-small .vjs-progress-control,.video-js.vjs-layout-tiny .vjs-progress-control{display:none}.video-js.vjs-layout-x-small .vjs-custom-control-spacer{flex:auto;display:block}.video-js.vjs-layout-x-small.vjs-no-flex .vjs-custom-control-spacer{width:auto}.vjs-modal-dialog.vjs-text-track-settings{background-color:#2b333f;background-color:#2b333fbf;color:#fff;height:70%}.vjs-text-track-settings .vjs-modal-dialog-content{display:table}.vjs-text-track-settings .vjs-track-settings-colors,.vjs-text-track-settings .vjs-track-settings-font,.vjs-text-track-settings .vjs-track-settings-controls{display:table-cell}.vjs-text-track-settings .vjs-track-settings-controls{text-align:right;vertical-align:bottom}@supports (display: grid){.vjs-text-track-settings .vjs-modal-dialog-content{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;padding:20px 24px 0}.vjs-track-settings-controls .vjs-default-button{margin-bottom:20px}.vjs-text-track-settings .vjs-track-settings-controls{grid-column:1/-1}.vjs-layout-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-x-small .vjs-text-track-settings .vjs-modal-dialog-content,.vjs-layout-tiny .vjs-text-track-settings .vjs-modal-dialog-content{grid-template-columns:1fr}}.vjs-track-setting>select{margin-right:1em;margin-bottom:.5em}.vjs-text-track-settings fieldset{margin:5px;padding:3px;border:none}.vjs-text-track-settings fieldset span{display:inline-block}.vjs-text-track-settings fieldset span>select{max-width:7.3em}.vjs-text-track-settings legend{color:#fff;margin:0 0 5px}.vjs-text-track-settings .vjs-label{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);display:block;margin:0 0 5px;padding:0;border:0;height:1px;width:1px;overflow:hidden}.vjs-track-settings-controls button:focus,.vjs-track-settings-controls button:active{outline-style:solid;outline-width:medium;background-image:linear-gradient(0deg,#fff 88%,#73859f)}.vjs-track-settings-controls button:hover{color:#2b333fbf}.vjs-track-settings-controls button{background-color:#fff;background-image:linear-gradient(-180deg,#fff 88%,#73859f);color:#2b333f;cursor:pointer;border-radius:2px}.vjs-track-settings-controls .vjs-default-button{margin-right:1em}@media print{.video-js>*:not(.vjs-tech):not(.vjs-poster){visibility:hidden}}.vjs-resize-manager{position:absolute;top:0;left:0;width:100%;height:100%;border:none;z-index:-1000}.js-focus-visible .video-js *:focus:not(.focus-visible){outline:none}.video-js *:focus:not(:focus-visible){outline:none}.video-js.vjs-fluid{width:1280px}.video-js .vjs-time-control{padding:0 4px!important;min-width:auto!important;height:30px!important;font-size:12px;align-items:center}.video-js .vjs-volume-control,.video-js .vjs-time-control{display:flex!important}.video-js :not(.vjs-has-started) .vjs-big-play-button{display:flex}.video-js .vjs-icon-placeholder:before{font-family:"Font Awesome 6 Pro"}.video-js .vjs-picture-in-picture-control .vjs-icon-placeholder:before{font-family:VideoJS}.video-js .vjs-big-play-button{align-items:center;justify-content:center;border:none!important;border-radius:50%!important;background-color:#0c1726cc!important;top:50%;left:50%;height:60px!important;width:60px!important;margin-left:-30px;margin-top:-30px;font-size:24px;transition:none!important}.video-js .vjs-big-play-button .vjs-icon-placeholder{margin-right:-8%}.video-js .vjs-big-play-button .vjs-icon-placeholder:before{position:static;content:"\\f04b";font-family:"Font Awesome 6 Pro";font-weight:900}.video-js .vjs-play-control .vjs-icon-placeholder:before{content:"\\f04b"}.video-js .vjs-play-control.vjs-playing .vjs-icon-placeholder:before{content:"\\f04c"}.video-js .vjs-play-control.vjs-ended .vjs-icon-placeholder:before{content:"\\f2ea"}.video-js .vjs-mute-control .vjs-icon-placeholder:before{content:"\\f6a8"}.video-js .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before{content:"\\f2e2"}.video-js .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f065"}.video-js.vjs-fullscreen .vjs-fullscreen-control .vjs-icon-placeholder:before{content:"\\f066"}.video-js .vjs-control-bar{flex-wrap:wrap;height:5em}.video-js .vjs-control{height:3em}.video-js .vjs-progress-control{width:100%!important;height:2em!important}.video-js .vjs-custom-control-spacer{display:block;flex:auto}.video-js .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.5em;line-height:2em}.video-js.vjs-layout-tiny .vjs-control-bar{height:4.5em}.video-js.vjs-layout-tiny .vjs-control{height:2.5em;width:2.5em}.video-js.vjs-layout-tiny .vjs-button:not(.vjs-picture-in-picture-control)>.vjs-icon-placeholder:before{font-size:1.2em;line-height:2.2em}.video-js.vjs-layout-tiny .vjs-button>.vjs-icon-placeholder:before{font-size:1.6em}.video-js.vjs-layout-tiny .vjs-progress-control{display:flex!important}.video-js.vjs-layout-tiny .vjs-progress-control .vjs-progress-holder{margin:0 8px}.video-js.vjs-layout-tiny .vjs-time-control{display:none!important}.video-js.vjs-layout-tiny .vjs-volume-bar.vjs-slider-vertical{height:4em!important}.video-js.vjs-layout-tiny .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{height:6em!important;bottom:6em!important;width:2.5em!important}.video-js.vjs-layout-tiny .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-2.5em!important}.video-js.vjs-layout-tiny .vjs-big-play-button{height:48px!important;width:48px!important;margin-left:-24px;margin-top:-24px;font-size:18px}.video-js.vjs-layout-x-small .vjs-progress-control{display:flex!important}.video-js.vjs-layout-x-small .vjs-control{width:3em}.video-js.vjs-layout-x-small .vjs-volume-panel.vjs-hover .vjs-volume-control.vjs-volume-vertical{left:-3em!important}.vjs-error .vjs-error-display:before{content:"";display:none}\n'],encapsulation:2,changeDetection:0})}return n})();var Om=d(64218);function XE(n,i){return this.trackVideo}function HE(n,i){if(1&n&&e.nrm(0,"app-video-view",8),2&n){const t=e.XpG(),o=t.$implicit,s=t.$index,a=e.XpG(2);e.AVh("videos-block__video--next-sibling",s>0),e.Y8G("sources",o.sources)("mode",a.mode)}}function QE(n,i){1&n&&(e.j41(0,"div",12),e.pXf(1,1),e.k0s())}function YE(n,i){if(1&n&&(e.j41(0,"div",9)(1,"div",10)(2,"div",11),e.pXf(3,0),e.k0s(),e.DNE(4,QE,2,0,"div",12),e.k0s()()),2&n){const t=e.XpG().$index,o=e.XpG(2);e.AVh("videos-block__video--next-sibling",t>0),e.R7$(4),e.vxM(o.emailMessage?4:-1)}}function KE(n,i){if(1&n&&e.nrm(0,"app-html",7),2&n){const t=e.XpG().$implicit;e.Y8G("markdownText",t.caption)}}function qE(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,HE,1,4,"app-video-view",5)(2,YE,5,3,"div",6)(3,KE,1,1,"app-html",7),e.k0s()),2&n){const t=i.$implicit;e.R7$(),e.vxM(t.transcoded?1:2),e.R7$(2),e.vxM(t.caption?3:-1)}}function JE(n,i){if(1&n&&(e.j41(0,"div",3)(1,"div",4),e.Z7z(2,qE,4,2,"div",null,XE,!0),e.k0s()()),2&n){const t=e.XpG();e.HbH("videos-block--"+t.layout),e.R7$(2),e.Dyx(t.videos)}}let Mm=(()=>{class n{get videosBlock(){return this._videosBlock}set videosBlock(t){this._videosBlock=t,this.videos=(0,u.get)(t,"videos",[]).map(o=>{const s={...o};return this.checkTranscodingStatus(s),s}),this.hasVideos=this.videos.length>0}constructor(t,o){this.mediaService=t,this.changeRef=o,this.layout=Mr.Normal,this.mode=ec.Full,this.emailMessage=!1,this.videos=[],this.hasVideos=!1}checkTranscodingStatus(t){this.mediaService.checkVideoStatus(t.url).pipe((0,qt.s)(1)).subscribe(o=>{o&&"boolean"!=typeof o?(t.sources=o,t.transcoded=!0):t.transcoded=!1,this.changeRef.markForCheck()})}trackVideo(t,o){return o.url}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vi),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-videos-block"]],inputs:{layout:"layout",mode:"mode",emailMessage:"emailMessage",videosBlock:"videosBlock"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let t,o;return t=$localize`:76807dc051a8773b9486978f33c7f05090c566fb2265850775265912967:Processing Video`,o=$localize`:3e4738ac862bbcd7a02a7355fe93de2f32521c544720931509138129579:Check your email for updates.`,[t,o,["data-test","videoBlock",1,"videos-block",3,"class"],["data-test","videoBlock",1,"videos-block"],[1,"videos-block__content"],[1,"videos-block__video","videos-block__video-view",3,"sources","mode","videos-block__video--next-sibling"],[1,"videos-block__video","videos-block__video-processing",3,"videos-block__video--next-sibling"],[1,"videos-block__video-caption",3,"markdownText"],[1,"videos-block__video","videos-block__video-view",3,"sources","mode"],[1,"videos-block__video","videos-block__video-processing"],[1,"videos-block__video-processing-content"],[1,"text-xs","font-semibold"],[1,"mt-1","text-2xs"]]},template:function(o,s){1&o&&e.DNE(0,JE,4,2,"div",2),2&o&&e.vxM(s.hasVideos?0:-1)},dependencies:[J.MD,Om.H,Tm,Ko.V],styles:[".videos-block[_ngcontent-%COMP%]{color:#384c6c}.videos-block__video[_ngcontent-%COMP%]{display:block}.videos-block__video--next-sibling[_ngcontent-%COMP%]{margin-top:20px}.videos-block__video-processing[_ngcontent-%COMP%]{padding-top:56.25%;position:relative;display:flex;justify-content:center;background-color:#fff;text-align:center;border:1px solid #8999b3;border-radius:4px;min-width:180px}.videos-block__video-processing-content[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:0 8px}.videos-block__video-caption[_ngcontent-%COMP%]{display:block;font-size:12px;margin-top:12px}.videos-block--compact[_ngcontent-%COMP%]   .videos-block__video-caption[_ngcontent-%COMP%]{font-size:10px;margin-top:4px}"],changeDetection:0})}return n})();d(93455);const ZE=["thumbnailView"];let eC=(()=>{class n{get thumbnail(){return this._thumbnail}set thumbnail(t){(0,u.isEqual)(this._thumbnail,t)||(this._thumbnail=t,null!=t?this.setImageStyle():this.clearImageStyle())}constructor(t){this.renderer=t}setImageStyle(){let t=this.thumbnail.snapshot||this.thumbnail.urls.small;const o=(new Date).valueOf();t.startsWith("blob:")||(t=`${t}?cb=${o}&uncached=true`);const s=new Image;s.src=t,s.onload=()=>{this.renderer.setStyle(this.thumbnailView.nativeElement,"background-size","cover"),this.renderer.setStyle(this.thumbnailView.nativeElement,"background-image",`url(${t})`)}}clearImageStyle(){this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-size"),this.renderer.removeStyle(this.thumbnailView.nativeElement,"background-image")}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-thumbnail-view"]],viewQuery:function(o,s){if(1&o&&e.GBs(ZE,7,e.aKT),2&o){let a;e.mGM(a=e.lsd())&&(s.thumbnailView=a.first)}},inputs:{thumbnail:"thumbnail"},standalone:!0,features:[e.aNF],decls:2,vars:0,consts:[["thumbnailView",""],[1,"thumbnail-view"]],template:function(o,s){1&o&&e.nrm(0,"div",1,0)},styles:[".thumbnail-view[_ngcontent-%COMP%]{background-color:#283853;background-image:url(/assets/images/logo-dark-transparent.svg);background-position:center center;background-repeat:no-repeat;background-size:25% 25%;border-radius:4px;height:100%;width:100%}.theme-light[_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .thumbnail-view[_ngcontent-%COMP%]{background-color:#e7eaee}"],changeDetection:0})}return n})();function tC(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",1)(1,"button",2),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handlePositionClick(s))}),e.j41(2,"div",3),e.nrm(3,"app-thumbnail-view",4),e.k0s(),e.j41(4,"div",5),e.EFF(5),e.k0s()()()}if(2&n){const t=i.$implicit;e.R7$(3),e.Y8G("thumbnail",t.thumbnail),e.R7$(2),e.JRh(t.title)}}let nC=(()=>{class n{constructor(t){this.store=t}handlePositionClick(t){this.store.dispatch(new Ut.Ih(t.camera.location,t.camera.action===Bd.L.FlyTo,void 0,t.camera.rotationCenter))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-position-block"]],inputs:{positionBlock:"positionBlock"},standalone:!0,features:[e.aNF],decls:3,vars:0,consts:[[1,"view-positions"],[1,"view-positions__list-item"],[1,"view-positions__item",3,"click"],[1,"view-positions__thumbnail"],[3,"thumbnail"],[1,"view-positions__title"]],template:function(o,s){1&o&&(e.j41(0,"ul",0),e.Z7z(1,tC,6,2,"li",1,e.Vm6),e.k0s()),2&o&&(e.R7$(),e.Dyx(s.positionBlock.positions))},dependencies:[eC],styles:[".view-positions__list-item[_ngcontent-%COMP%]{padding-bottom:8px}.view-positions__item[_ngcontent-%COMP%]{background:none;border:0;display:flex;padding:12px 12px 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:start;align-items:center}.view-positions__item[_ngcontent-%COMP%]:focus{outline:#2472e9 solid 2px!important}.view-positions__item[_ngcontent-%COMP%]:hover, .view-positions__item--selected[_ngcontent-%COMP%]:hover{background-color:#0c17260d}.view-positions__item--selected[_ngcontent-%COMP%]   .view-positions__title[_ngcontent-%COMP%]{font-weight:600}.view-positions__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-inline-end:12px;border:1px solid #e7eaee;border-radius:4px}.view-positions__title[_ngcontent-%COMP%]{color:#0c1726;font-size:.875rem;line-height:1.25rem;word-break:break-word}"],changeDetection:0})}return n})();var je=d(89079);const iC=["link"];function oC(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,1),e.k0s())}function sC(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,2),e.k0s())}function aC(n,i){if(1&n&&(e.nrm(0,"app-icon",6),e.DNE(1,oC,2,0,"span")(2,sC,2,0,"span")),2&n){const t=e.XpG();e.R7$(),e.vxM(t.active()?1:2)}}function rC(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,3),e.k0s())}function lC(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,4),e.k0s())}function cC(n,i){if(1&n&&(e.nrm(0,"img",7),e.DNE(1,rC,2,0,"span")(2,lC,2,0,"span")),2&n){const t=e.XpG();e.R7$(),e.vxM(t.active()?1:2)}}let Ir=(()=>{class n{constructor(t){this.store=t,this.xrLoaderEnum=Di,this.link=(0,e.ebz)("link"),this.vrActive=(0,je.ot)(this.store.select(On.U.getVRActive)),this.arActive=(0,je.ot)(this.store.select(On.U.getARActive)),this.platform=(0,je.ot)(this.store.select(On.U.getXRPlatform)),this.mode=e.hFB.required(),this.title=e.hFB.required(),this.transparent=e.hFB.required(),this.bordered=e.hFB.required(),this.compact=(0,e.hFB)(!1),this.modelUrl=(0,e.hFB)(),this.exitXT=(0,e.CGW)(),this.modelLink=(0,e.EWP)(()=>{const o=this.mode(),s=this.title(),a=this.modelUrl();return o===Di.AR&&a?function Fv(n,i){return`${n}#${Object.entries(i).reduce((s,[a,r])=>{if(a&&r){const _=`${a}=${encodeURI(r)}`;s.push(_)}return s},[]).join("&")}`}(a,{checkoutTitle:s,checkoutSubtitle:$localize`Browse our documentation`,callToAction:$localize`Learn More`}):"#"}),this.active=(0,e.EWP)(()=>{const o=this.mode(),s=this.vrActive(),a=this.arActive();switch(o){case Di.VR:return s;case Di.AR:return a;default:return!1}}),this.cssClasses=(0,e.EWP)(()=>{const o=this.compact(),s=this.transparent(),a=this.bordered(),r=[];return r.push(...o?["min-h-10","min-w-10"]:["min-h-12","min-w-12"]),r.push(s?"bg-transparent":"bg-white"),a&&r.push("border","border-solid","border-gray-200"),r}),this.destroyRef=(0,e.WQX)(e.abz)}ngAfterViewInit(){const t=this.link().nativeElement;(0,Sn.R)(t,"click").pipe((0,je.pQ)(this.destroyRef)).subscribe(o=>{const s=this.active(),a=this.mode(),r=this.platform();r!==fr.I.iOS&&(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation()),this.handleXRClick(s,a,r)}),(0,Sn.R)(t,"message").pipe((0,je.pQ)(this.destroyRef)).subscribe(o=>{if("_apple_ar_quicklook_button_tapped"===o?.data){const s=this.mode();this.exitXT.emit(s)}})}handleXRClick(t,o,s){if(this.store.dispatch(new E.ToggleWindow(_n.XRLoader,!1)),t)this.store.dispatch(new Ui.W.ExitXR);else if(s!==fr.I.iOS)return o===Di.VR?this.store.dispatch(new Ui.W.EnterXR("immersive-vr")):o===Di.AR&&this.store.dispatch(new Ui.W.EnterXR("immersive-ar")),!1}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-xr-button"]],viewQuery:function(o,s){1&o&&e.wEZ(s.link,iC,5),2&o&&e.NyB()},inputs:{mode:[1,"mode"],title:[1,"title"],transparent:[1,"transparent"],bordered:[1,"bordered"],compact:[1,"compact"],modelUrl:[1,"modelUrl"]},outputs:{exitXT:"exitXT"},standalone:!0,features:[e.aNF],decls:4,vars:4,consts:()=>{let t,o,s,a;return t=$localize`:d8f00947439583705b11afdb26b3606125755d7b1909228686165085461:Exit VR`,o=$localize`:8b77d7e13579af1dbecb22db0e5a928086275f053152290368589851844:View in VR`,s=$localize`:1d0d80fb57ed2c1c18d12b2df218541387455b4d6343763191422968223:Exit AR`,a=$localize`:36eff850df47c04db84bb5447dec7e42e65697375491567984328908672:View in AR`,[["link",""],t,o,s,a,["rel","ar noreferrer nofollow",1,"flex","flex-row","items-center","justify-center","gap-2","px-2","text-sm","rounded","visited:text-gray-600","whitespace-nowrap",3,"href"],["icon","head-side-goggles"],["src","assets/images/ar_icon.svg","width","16","alt","View in AR","i18-alt",""]]},template:function(o,s){if(1&o&&(e.j41(0,"a",5,0),e.DNE(2,aC,3,1)(3,cC,3,1),e.k0s()),2&o){let a;e.HbH(s.cssClasses()),e.Y8G("href",s.modelLink(),e.B4B),e.R7$(2),e.vxM((a=s.mode())===s.xrLoaderEnum.VR?2:a===s.xrLoaderEnum.AR?3:-1)}},dependencies:[sn.o,ut.R]})}return n})();var xi=d(89511),Ta=d(25780);function dC(n,i){if(1&n&&(e.j41(0,"a",0),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.Y8G("href",t.ctaBlock().url,e.B4B),e.R7$(),e.SpI(" ",t.ctaBlock().label||t.ctaBlock().url," ")}}function _C(n,i){if(1&n&&e.nrm(0,"app-view-xr-button",1),2&n){const t=e.XpG(2);e.Y8G("mode","ar")("title",t.ctaBlock().label)("modelUrl",t.ctaBlock().url)("transparent",!1)("bordered",!0)("compact",!0)}}function pC(n,i){if(1&n&&e.DNE(0,_C,1,6,"app-view-xr-button",1),2&n){const t=e.XpG();e.vxM(t.nativeAREnabled()?0:-1)}}let Im=(()=>{class n{constructor(t){this.store=t,this.nativeAREnabled=(0,je.ot)(this.store.select(On.U.getNativeAREnabled)),this.ctaBlock=e.hFB.required()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-cta-block"]],inputs:{ctaBlock:[1,"ctaBlock"]},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[["appEventFence","","target","_blank","rel","noreferrer nofollow",1,"block","px-4","py-3","text-center","bg-white","border","border-gray-200","border-solid","rounded","text-gray-950","visited:text-gray-950",3,"href"],[3,"mode","title","modelUrl","transparent","bordered","compact"]],template:function(o,s){if(1&o&&e.DNE(0,dC,2,2,"a",0)(1,pC,1,1),2&o){let a;e.vxM("link"===(a=s.ctaBlock().action)?0:"ar-link"===a?1:-1)}},dependencies:[Ir,xi.h,Ta.L],encapsulation:2,changeDetection:0})}return n})();function uC(n,i){return this.trackContentBlock}function hC(n,i){if(1&n&&e.nrm(0,"app-ticker-block",6),2&n){const t=e.XpG(2).$implicit;e.Y8G("tickerBlock",t)}}function gC(n,i){if(1&n&&e.DNE(0,hC,1,1,"app-ticker-block",6),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.vxM(o.isTickerBlockEnabled(t)?0:-1)}}function mC(n,i){if(1&n&&e.nrm(0,"app-markdown-block",1),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.Y8G("markdownBlock",t)("layout",o.layout)}}function fC(n,i){if(1&n&&e.nrm(0,"app-images-block",2),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.Y8G("imagesBlock",t)("layout",o.layout)}}function SC(n,i){if(1&n&&e.nrm(0,"app-images-block",2),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.Y8G("imagesBlock",t)("layout",o.layout)}}function bC(n,i){if(1&n&&e.nrm(0,"app-videos-block",3),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.Y8G("videosBlock",t)("layout",o.layout)}}function yC(n,i){if(1&n&&e.nrm(0,"app-position-block",4),2&n){const t=e.XpG().$implicit;e.Y8G("positionBlock",t)}}function vC(n,i){if(1&n&&e.nrm(0,"app-cta-block",5),2&n){const t=e.XpG().$implicit;e.Y8G("ctaBlock",t)}}function EC(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,gC,1,1)(2,mC,1,2,"app-markdown-block",1)(3,fC,1,2,"app-images-block",2)(4,SC,1,2,"app-images-block",2)(5,bC,1,2,"app-videos-block",3)(6,yC,1,1,"app-position-block",4)(7,vC,1,1,"app-cta-block",5),e.k0s()),2&n){let t;const o=i.$implicit,s=i.$index,a=e.XpG(2);e.AVh("mt-6",s>0),e.R7$(),e.vxM((t=o.type)===a.contentBlockTypes.Ticker?1:t===a.contentBlockTypes.Markdown?2:t===a.contentBlockTypes.Images?3:t===a.contentBlockTypes.AnimatedImages?4:t===a.contentBlockTypes.Videos?5:t===a.contentBlockTypes.Positions?6:t===a.contentBlockTypes.CTA?7:-1)}}function CC(n,i){if(1&n&&e.Z7z(0,EC,8,3,"div",0,uC,!0),2&n){const t=e.XpG();e.Dyx(t.contentBlocks)}}let Vs=(()=>{class n{get contentBlocks(){return this.contentBlocksService.filterContentBlocksByType(this._contentBlocks,this.include,this.exclude)}set contentBlocks(t){this._contentBlocks=t}constructor(t){this.contentBlocksService=t,this.contentBlockTypes=hi.m,this._contentBlocks=[],this.layout=Mr.Normal,this.include=[],this.exclude=[]}isTickerBlockEnabled(t){return t?.enable}trackContentBlock(t,o){return o.type}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Ns.V))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-content-blocks"]],inputs:{contentBlocks:"contentBlocks",layout:"layout",include:"include",exclude:"exclude"},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[[3,"mt-6"],[3,"markdownBlock","layout"],[3,"imagesBlock","layout"],[3,"videosBlock","layout"],[3,"positionBlock"],[3,"ctaBlock"],[3,"tickerBlock"]],template:function(o,s){1&o&&e.DNE(0,CC,2,0),2&o&&e.vxM(s.contentBlocks.length>0?0:-1)},dependencies:[J.MD,Ca,ym,vm,Mm,nC,Im],encapsulation:2,changeDetection:0})}return n})(),TC=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Lt.G,Wn.y2.forChild(),Ca,js]})}return n})(),Pr=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Lt.G,Nt.G,TC,Vs,ym,vm,Mm,Im]})}return n})();var Pm=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},wm=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const OC=["body"];function MC(n,i){if(1&n&&(e.nrm(0,"div",6),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.label.description)),e.npT)}}function IC(n,i){if(1&n&&(e.j41(0,"div",7),e.nrm(1,"app-content-blocks",8),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("contentBlocks",t.label.contentBlocks)("layout","compact")}}class Fs{get isCollapsed(){if(this.collapsedMode===tr.Q.Toggle){const i=this.store.selectSnapshot(et.getSelectedLabelId)===this.label.id;return this.collapsed&&!i}return this.collapsed}get hasContent(){return this.labelsService.hasContent(this.label)}constructor(i,t,o,s){this.changeDetectorRef=i,this.labelsService=t,this.store=o,this.applicationEventService=s,this.emitEvents=!0,this.collapsedMode=tr.Q.None,this.collapsed=!1,this.pinDraggable=!1,this.tagDraggable=!1,this.descriptionCollapsed=!1,this.tagCollapsed=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.selectedLabel$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleLabelSelected(t)),this.store.select(et.getChapterLabels).pipe((0,p.Q)(this.ngUnsubscribe),(0,wn.B)(100)).subscribe(()=>{this.sequence=this.store.selectSnapshot(et.getLabelSequence(this.label)),this.changeDetectorRef.markForCheck()}),this.descriptionCollapsed=this.label.collapseDescription,this.tagCollapsed=this.label.hideTag||!(this.label.title||this.hasContent)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleLabelUpdated(i){const{label:t,shouldPreserve:o}=i;this.store.dispatch(new Je.lb(t,o))}handleOffsetUpdated(i){const{labelId:t,offset:o}=i;this.store.dispatch(new Je.yi(t,o))}handlePinClicked(i){this.selectLabel()}handleTagClicked(i){this.selectLabel()}selectLabel(){const i=this.store.selectSnapshot(et.getSelectedLabel);this.store.dispatch(new Je.TR(i&&i.id===this.label.id?null:this.label)),this.emitEvent(rt.F.HotspotsPicked,{id:this.label.id}),this.emitEvent(rt.F.LabelsPicked,{labelId:this.label.id})}emitEvent(i,t){this.emitEvents&&this.applicationEventService.fireEvent(i,t)}handleDisplayUpdated(i){this.setBodyOpacity(i.shown),this.emitEvent(rt.F.HotspotsDisplayUpdated,i)}handlePositionUpdated(i){this.emitEvent(rt.F.HotspotsPositionUpdated,i.positionUpdate),this.emitEvent(rt.F.LabelsMoved,{labelId:i.positionUpdate.id,canvasPosition:[i.positionUpdate.canvasPos.x,i.positionUpdate.canvasPos.y],occluded:i.positionUpdate.occluded||!i.onCanvas})}handleHoverStart(i){this.emitEvent(rt.F.HotspotsEntered,{id:i.labelId}),this.emitEvent(rt.F.LabelsEntered,{labelId:i.labelId})}handleHoverEnd(i){this.emitEvent(rt.F.HotspotsLeft,{id:i.labelId}),this.emitEvent(rt.F.LabelsLeft,{labelId:i.labelId})}handleLabelSelected(i){const t=i&&i.id===this.label.id,o=(0,u.get)(i,"states[1].errands"),s=this.store.selectSnapshot(Ti.x.getLockCamera);t&&o&&!s&&o.forEach(r=>{switch(r.type){case es.X.flyToObject:this.store.dispatch(new st.W6(r.value));break;case es.X.flyToCamera:this.store.dispatch(new Ut.Ih(r.value))}this.store.dispatch(new Ut.Xz(!0))}),this.tagCollapsed=!this.label.title&&!this.hasContent||(this.label.expandTag&&this.label.hideTag?!t:this.label.hideTag),this.descriptionCollapsed=this.label.showDescription&&this.label.collapseDescription?!t:this.label.collapseDescription}handleBodyPointerDown(i){const t=this.body.nativeElement,o=t.offsetWidth-t.clientWidth;if(o>0){const a=t.getBoundingClientRect().right-o;i.clientX>a&&i.stopPropagation()}}handleBodyWheel(i){const t=this.body.nativeElement;t.scrollHeight>t.clientHeight&&i.stopPropagation()}setBodyOpacity(i){const t=this.body.nativeElement;i?t.style.removeProperty("opacity"):t.style.opacity="0"}static#e=this.\u0275fac=function(t){return new(t||Fs)(e.rXU(e.gRc),e.rXU(Tr.x),e.rXU(l.il),e.rXU(Po.S))};static#t=this.\u0275cmp=e.VBU({type:Fs,selectors:[["app-story-label"]],viewQuery:function(t,o){if(1&t&&e.GBs(OC,7),2&t){let s;e.mGM(s=e.lsd())&&(o.body=s.first)}},inputs:{label:"label",emitEvents:"emitEvents",collapsedMode:"collapsedMode",collapsed:"collapsed",pinDraggable:"pinDraggable",tagDraggable:"tagDraggable"},standalone:!0,features:[e.aNF],decls:10,vars:20,consts:[["body",""],[1,"story-label",3,"labelUpdated","offsetUpdated","tagClicked","pinClicked","keydown.enter","displayUpdated","positionUpdated","hoverStart","hoverEnd","label","selected","fixedScale","sequence","isCollapsed","tagCollapsed","pinDraggable","tagDraggable","descriptionCollapsed","hasContent"],["label-header","",1,"html",3,"innerHTML"],["label-body","",1,"story-label__body","html",3,"pointerdown","wheel"],["data-test","labelDescription",3,"innerHTML",4,"ngIf"],["class","my-1","appEventFence","","style","cursor: auto",4,"ngIf"],["data-test","labelDescription",3,"innerHTML"],["appEventFence","",1,"my-1",2,"cursor","auto"],[3,"contentBlocks","layout"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"app-generic-label",1),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("labelUpdated",function(r){return e.eBV(s),e.Njj(o.handleLabelUpdated(r))})("offsetUpdated",function(r){return e.eBV(s),e.Njj(o.handleOffsetUpdated(r))})("tagClicked",function(r){return e.eBV(s),e.Njj(o.handleTagClicked(r))})("pinClicked",function(r){return e.eBV(s),e.Njj(o.handlePinClicked(r))})("keydown.enter",function(r){return e.eBV(s),e.Njj(o.handleTagClicked(r))})("displayUpdated",function(r){return e.eBV(s),e.Njj(o.handleDisplayUpdated(r))})("positionUpdated",function(r){return e.eBV(s),e.Njj(o.handlePositionUpdated(r))})("hoverStart",function(r){return e.eBV(s),e.Njj(o.handleHoverStart(r))})("hoverEnd",function(r){return e.eBV(s),e.Njj(o.handleHoverEnd(r))}),e.nrm(3,"div",2),e.nI1(4,"markdown"),e.nI1(5,"async"),e.j41(6,"div",3,0),e.bIt("pointerdown",function(r){return e.eBV(s),e.Njj(o.handleBodyPointerDown(r))})("wheel",function(r){return e.eBV(s),e.Njj(o.handleBodyWheel(r))}),e.DNE(8,MC,3,5,"div",4)(9,IC,2,2,"div",5),e.k0s()()}if(2&t){let s;e.Y8G("label",o.label)("selected",(null==(s=e.bMT(1,12,o.selectedLabel$))?null:s.id)===o.label.id)("fixedScale",e.bMT(2,14,o.labelScale$))("sequence",o.sequence)("isCollapsed",o.isCollapsed)("tagCollapsed",o.tagCollapsed)("pinDraggable",o.pinDraggable)("descriptionCollapsed",o.descriptionCollapsed)("hasContent",o.hasContent),e.R7$(3),e.Y8G("innerHTML",e.bMT(5,18,e.bMT(4,16,o.label.title)),e.npT),e.R7$(5),e.Y8G("ngIf",o.label.description),e.R7$(),e.Y8G("ngIf",o.label.contentBlocks)}},dependencies:[J.MD,J.bT,J.Jj,Yo,Wn.y2,Wn.i0,Pr,Vs],styles:[".story-label__body[_ngcontent-%COMP%]{max-height:120px;overflow-x:hidden;overflow-y:auto;margin-right:-8px;padding-right:8px}"],changeDetection:0})}Pm([(0,l.l6)(et.getLabelScale),wm("design:type",h.c)],Fs.prototype,"labelScale$",void 0),Pm([(0,l.l6)(et.getSelectedLabel),wm("design:type",h.c)],Fs.prototype,"selectedLabel$",void 0);var Mn=d(21007);function PC(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.playAudio())}),e.nrm(1,"app-icon",10),e.k0s()}}function wC(n,i){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.latinLabel)}}function AC(n,i){if(1&n&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.description)),e.npT)}}let RC=(()=>{class n{constructor(t,o,s){this.dialogRef=t,this.mediaService=o,this.data=s,this.title=s.title,this.audioPlayer=s.audioPlayer,this.latinLabel=s.latinLabel,this.description=s.description}ngOnDestroy(){this.audioPlayer&&(this.audioPlayer=null)}handleCloseClick(){this.dialogRef.close()}playAudio(){this.mediaService.stopAllAudio(),this.audioPlayer.play()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(vi),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-context-label-dialog"]],decls:11,vars:9,consts:[[1,"context-label-dialog","flex","flex-col"],[1,"flex","flex-row","justify-between","items-start"],[1,"flex","flex-row","items-start"],[1,"context-label-dialog__title","mt-2","mr-2",3,"innerHTML"],["class","context-label-dialog__audio","type","button","app-button","","buttonTheme","light","buttonSize","md",3,"click",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"context-label-dialog__close",3,"click"],["icon","times","size","lg"],["class","context-label-dialog__latin-label mt-1",4,"ngIf"],["class","context-label-dialog__description mt-6",3,"innerHTML",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","md",1,"context-label-dialog__audio",3,"click"],["icon","volume-up","appLogicalDir",""],[1,"context-label-dialog__latin-label","mt-1"],[1,"context-label-dialog__description","mt-6",3,"innerHTML"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"div",3),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,PC,2,0,"button",4),e.k0s(),e.j41(7,"button",5),e.bIt("click",function(){return s.handleCloseClick()}),e.nrm(8,"app-icon",6),e.k0s()(),e.DNE(9,wC,2,1,"div",7)(10,AC,3,5,"div",8),e.k0s()),2&o&&(e.R7$(3),e.Y8G("innerHTML",e.bMT(5,7,e.bMT(4,5,s.title)),e.npT),e.R7$(3),e.Y8G("ngIf",s.audioPlayer),e.R7$(),e.BMQ("aria-label","Close"),e.R7$(2),e.Y8G("ngIf",s.latinLabel),e.R7$(),e.Y8G("ngIf",s.description))},dependencies:[J.bT,Mn.Q,Ao.e,ut.R,J.Jj,Wn.i0],styles:[".context-label-dialog{height:100%;padding:24px}.context-label-dialog__title{font-weight:700;font-size:20px;word-break:break-word}.context-label-dialog__latin-label{font-style:italic;font-weight:400;font-size:14px;letter-spacing:.02em}.context-label-dialog__description{font-size:14px;line-height:20px;overflow:auto;margin-right:-24px;padding-right:24px}.context-label-dialog__description p{padding-bottom:12px}\n"],encapsulation:2})}return n})();var un=d(59115),Ap=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Rp=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const NC=["labelDescription"];function kC(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.playAudio())}),e.nrm(1,"app-icon",21),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled",t.audioPlayerLoading)}}function DC(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleReadMoreClick())}),e.nrm(1,"app-icon",23),e.k0s()}if(2&n){const t=e.XpG(2);e.R7$(),e.AVh("context-label__info--expanded",t.expanded)}}function LC(n,i){if(1&n&&(e.j41(0,"div",17),e.DNE(1,kC,2,1,"button",18)(2,DC,2,2,"button",19),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.enableAudio),e.R7$(),e.Y8G("ngIf",t.enableInfo&&(null==t.node||null==t.node.info?null:t.node.info.description))}}function UC(n,i){if(1&n&&(e.j41(0,"i",24),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.node.info.latinLabel," ")}}function xC(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",25,2),e.nI1(2,"markdown"),e.nI1(3,"async"),e.bIt("pointerdown",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleDescriptionPointerDown(s))})("wheel",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.stopPropagation(s))}),e.k0s()}if(2&n){const t=e.XpG();e.AVh("context-label__description--expanded",t.expanded),e.Y8G("innerHTML",e.bMT(3,5,e.bMT(2,3,t.node.info.description)),e.npT)}}function jC(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",26)(1,"button",27),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.hideNode())}),e.pXf(2,5),e.k0s(),e.j41(3,"button",28),e.qex(4),e.pXf(5,6),e.bVm(),e.nrm(6,"app-icon",29),e.k0s(),e.j41(7,"button",27),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.hideInverseNodes())}),e.pXf(8,7),e.k0s()()}if(2&n){e.XpG();const t=e.sdS(12);e.R7$(3),e.Y8G("matMenuTriggerFor",t)}}const VC=["es-ES","en-US"];class cs{set label(i){this._label=i,this.largeTitle=this._label.title.length>60,this.removeAudioPlayer(),this.setLabelNode(),this.changeDetectorRef.markForCheck()}get label(){return this._label}get enableAudio(){return VC.includes(this.localeCode)&&this._enableAudio}set enableAudio(i){this._enableAudio=i,this.removeAudioPlayer(),this.changeDetectorRef.markForCheck()}constructor(i,t,o,s,a,r,_,g,P){this.store=i,this.actions=t,this.sceneService=o,this.dialog=s,this.nodeService=a,this.mediaService=r,this.renderer2=_,this.markdownService=g,this.changeDetectorRef=P,this.largeTitle=!1,this.expanded=!1,this.ngUnsubscribe=new k.B,this.id=li.u.getUuid()}ngOnInit(){this.initInfoListeners(),this.initBreakpointListeners(),this.initLocale()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.removeAudioPlayer()}setLabelNode(){const i=(0,u.get)(this.label,"objectId");if(i){const t=this.store.selectSnapshot(ze.S.getViewGraph);this.node=this.sceneService.getViewNode(t,i)}else this.node=null;this.expanded=!1,this.changeDetectorRef.markForCheck()}initInfoListeners(){this.actions.pipe((0,l.rM)(st.RV),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setLabelNode()})}initBreakpointListeners(){this.horizontalBreakpoint$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.expanded&&(i<Qn.Large&&!this.curDialog?this.openContextLabelDialog():i>=Qn.Large&&this.curDialog&&this.curDialog?.close(!0))})}initLocale(){var i=this;return(0,pt.A)(function*(){i.localeCode=yield i.getLocaleCode(),i.changeDetectorRef.markForCheck()})()}handleReadMoreClick(){this.node&&(this.expanded=!this.expanded,this.expanded&&this.store.selectSnapshot(Dn.getHorizontalBreakpoint)<Qn.Large&&this.openContextLabelDialog())}stopPropagation(i){i.stopPropagation()}handleDescriptionPointerDown(i){const t=this.labelDescription.nativeElement,o=t.offsetWidth-t.clientWidth;if(o>0){const a=t.getBoundingClientRect().right-o;i.clientX>a&&this.stopPropagation(i)}}playAudio(){var i=this;return(0,pt.A)(function*(){(0,u.isNil)(i.audioPlayer)&&(yield i.setAudioPlayer(i.localeCode)),i.audioPlayer.stop(),i.audioPlayer.play()})()}setAudioPlayer(i){var t=this;return(0,pt.A)(function*(){t.removeAudioPlayer(),t.audioPlayerLoading=!0,t.changeDetectorRef.markForCheck(),t.audioPlayer=yield t.mediaService.addAudioPlayer(t.id,t.getAudioSource(i),!1),t.audioPlayerLoading=!1,t.changeDetectorRef.markForCheck()})()}getAudioSource(i){var t=this;return(0,pt.A)(function*(){return Kd(yield ho.l.getPlainTextFromMarkdown(t.renderer2,t.markdownService,t._label.title,!0),i)})()}getLocaleCode(){var i=this;return(0,pt.A)(function*(){const t=i.store.selectSnapshot(dt.getStoryInfo);let o=Jn.q.id;if(t.type===Se.c.Bookmark){let a=i.store.selectSnapshot(dt.getStory).chapters.map(r=>r.description||"").join(" ").trim();if(!a){const r=i.store.selectSnapshot(ze.S.getViewGraph);a=Object.values(r.nodes).map(g=>g.label).join(", ").trim()}return Eh(a)}{const s=i.store.selectSnapshot(dt.getStoryLanguage);o=(0,Jn.U1)(s).id}return o})()}removeAudioPlayer(){this.mediaService.removeAudioPlayer(this.id),this.audioPlayer=null}hideNode(){this.store.dispatch(new Vt.yr(!1,[this.node.id]))}fadeInverseNodes(){this.nodeService.fadeInverse([this.node.id])}fadeNode(){this.nodeService.fade([this.node.id])}hideInverseNodes(){this.nodeService.hideInverse([this.node.id])}openContextLabelDialog(){this.curDialog=this.dialog.open(RC,{width:"calc(100% - 80px)",maxWidth:"100%",height:"calc(100% - 80px)",maxHeight:"100%",data:{title:this.label.title,audioPlayer:this.audioPlayer,latinLabel:this.node.info.latinLabel,description:this.node.info.description}}),this.curDialog.afterClosed().subscribe(i=>{this.curDialog=void 0,i||(this.expanded=!1,this.changeDetectorRef.markForCheck())})}static#e=this.\u0275fac=function(t){return new(t||cs)(e.rXU(l.il),e.rXU(l.En),e.rXU(Fi.w),e.rXU(vt.bZ),e.rXU(fp.w),e.rXU(vi),e.rXU(e.sFG),e.rXU(Wn.Rl),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:cs,selectors:[["app-context-label"]],viewQuery:function(t,o){if(1&t&&e.GBs(NC,5),2&t){let s;e.mGM(s=e.lsd())&&(o.labelDescription=s.first)}},inputs:{label:"label",enableInfo:"enableInfo",enableActions:"enableActions",enableAudio:"enableAudio"},standalone:!0,features:[e.aNF],decls:17,vars:17,consts:()=>{let i,t,o,s,a;return i=$localize`:b759baf42e7a90ef5e8c645babba3f7737e6a5265489525302847889282: Fade This `,t=$localize`:1eeab5878ca4b21288c9610b9837d0cf81cc64a06683889227007993247: Fade Everything Else `,o=$localize`:ccf7390cbf933d13bbd3558c3f16040691f3f5c37951634674386802910: Hide `,s=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,a=$localize`:bfe7e779289d630d424893f857357ae741f6acfd8086714388799643845: Isolate `,[["title",""],["fadeActions","matMenu"],["labelDescription",""],i,t,o,s,a,[1,"context-label",3,"fixedScale","label"],["label-header","",1,"context-label__header","html",3,"innerHTML"],["class","context-label__actions","label-actions","",4,"ngIf"],["label-more",""],["class","context-label__latin",4,"ngIf"],["class","context-label__description",3,"context-label__description--expanded","innerHTML","pointerdown","wheel",4,"ngIf"],["class","context-label__node-actions",4,"ngIf"],["mat-menu-item","","data-test","nodeActionsFadeThis",3,"click"],["mat-menu-item","","data-test","nodeActionsFadeEverythingElse",3,"click"],["label-actions","",1,"context-label__actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"disabled","click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click",4,"ngIf"],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click","disabled"],["icon","volume-up","appLogicalDir",""],["type","button","app-button","","buttonTheme","light","buttonSize","xs","buttonShape","square",3,"click"],["icon","info-circle",1,"context-label__info"],[1,"context-label__latin"],[1,"context-label__description",3,"pointerdown","wheel","innerHTML"],[1,"context-label__node-actions"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"click"],["type","button","app-button","","buttonTheme","light","buttonSize","xs",1,"context-label__node-action",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"app-generic-label",8),e.nI1(1,"async"),e.nrm(2,"div",9,0),e.nI1(4,"markdown"),e.nI1(5,"async"),e.DNE(6,LC,3,2,"div",10),e.qex(7,11),e.DNE(8,UC,2,1,"i",12)(9,xC,4,7,"div",13)(10,jC,9,1,"div",14),e.j41(11,"mat-menu",null,1)(13,"button",15),e.bIt("click",function(){return e.eBV(s),e.Njj(o.fadeNode())}),e.pXf(14,3),e.k0s(),e.j41(15,"button",16),e.bIt("click",function(){return e.eBV(s),e.Njj(o.fadeInverseNodes())}),e.pXf(16,4),e.k0s()(),e.bVm(),e.k0s()}2&t&&(e.AVh("context-label--expanded",o.expanded)("context-label--large",o.largeTitle),e.Y8G("fixedScale",e.bMT(1,11,o.labelScale$))("label",o.label),e.R7$(2),e.Y8G("innerHTML",e.bMT(5,15,e.bMT(4,13,o.label.title)),e.npT),e.R7$(4),e.Y8G("ngIf",o.node),e.R7$(2),e.Y8G("ngIf",o.node&&(null==o.node.info?null:o.node.info.latinLabel)),e.R7$(),e.Y8G("ngIf",o.enableInfo&&(null==o.node||null==o.node.info?null:o.node.info.description)),e.R7$(),e.Y8G("ngIf",o.node))},dependencies:[J.MD,J.bT,J.Jj,un.Cn,un.kk,un.fb,un.Cp,sn.o,ut.R,Wn.y2,Wn.i0,xi.h,Ao.e,bn.C,Mn.Q,Yo],styles:[".context-label[_ngcontent-%COMP%]{z-index:12}.context-label__header[_ngcontent-%COMP%]{word-break:break-word}.context-label__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;min-height:24px}.context-label__info--expanded[_ngcontent-%COMP%]{color:#2472e9}.context-label__latin[_ngcontent-%COMP%]{display:block;padding:0 8px 4px;font-size:.625rem;line-height:.75rem;font-style:italic}.context-label__description[_ngcontent-%COMP%]{max-height:0;margin:0;overflow:auto;font-size:12px;line-height:18px;transition:max-height .25s,margin .25s}.context-label__node-actions[_ngcontent-%COMP%]{display:flex;border-top:1px solid rgba(12,23,38,.5);margin-top:4px;white-space:nowrap}.context-label__node-action[_ngcontent-%COMP%]{border-radius:0;border-inline-end:1px solid rgba(12,23,38,.5);flex:1}.context-label__node-action[_ngcontent-%COMP%]:last-child{border-inline-end:0}@media (min-width: 960px){.context-label__description--expanded[_ngcontent-%COMP%]{margin:8px;max-height:200px}}"],changeDetection:0})}Ap([(0,l.l6)(ze.S.getQuerying),Rp("design:type",h.c)],cs.prototype,"querying$",void 0),Ap([(0,l.l6)(et.getLabelScale),Rp("design:type",h.c)],cs.prototype,"labelScale$",void 0),Ap([(0,l.l6)(Dn.getHorizontalBreakpoint),Rp("design:type",h.c)],cs.prototype,"horizontalBreakpoint$",void 0);var fe=d(89417);let Am=(()=>{class n{get control(){return this.formControl||this.controlContainer.control.get(this.formControlName)}constructor(t){this.controlContainer=t}registerOnTouched(t){this.formControlDirective.valueAccessor.registerOnTouched(t)}registerOnChange(t){this.formControlDirective.valueAccessor.registerOnChange(t)}writeValue(t){this.formControlDirective.valueAccessor.writeValue(t)}setDisabledState(t){this.formControlDirective.valueAccessor.setDisabledState(t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(fe.ZU))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-base-accessor-control"]],viewQuery:function(o,s){if(1&o&&e.GBs(fe.l_,7),2&o){let a;e.mGM(a=e.lsd())&&(s.formControlDirective=a.first)}},inputs:{formControl:"formControl",formControlName:"formControlName"},decls:0,vars:0,template:function(o,s){},encapsulation:2})}return n})(),FC=(()=>{class n{get value(){return this._value}set value(t){(0,u.isEqual)(this._value,t)||(this._value=t,this.setFormValues(t),this.onChange(t))}constructor(){}onChange(t){}onTouched(){}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}writeValue(t){this.value=t}setDisabledState(t){this.disabled=t}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-abstract-input-control"]],inputs:{value:"value",disabled:"disabled"},decls:0,vars:0,template:function(o,s){},encapsulation:2})}return n})();function GC(n,i){if(1&n&&(e.j41(0,"option",9),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.label.title," ")}}function $C(n,i){if(1&n&&(e.j41(0,"select",6)(1,"option",7),e.EFF(2,"Select"),e.k0s(),e.DNE(3,GC,2,2,"option",8),e.k0s()),2&n){const t=e.XpG();e.R7$(3),e.Y8G("ngForOf",t.options)}}let Np=(()=>{class n extends FC{get options(){return this._options}set options(t){const o=(0,u.clone)(t);this._options=o.sort((s,a)=>s.label.title.localeCompare(a.label.title)),this.changeRef.markForCheck()}constructor(t,o){super(),this.formBuilder=t,this.changeRef=o,this.outline=!0,this.valueChange=new e.bkB,this.ngUnsubscribe=new k.B,this.form=this.formBuilder.group({value:[""]}),this.valueControl=this.form.get("value")}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({value:t})=>{this.writeValue(t),this.valueChange.next(t)})}setDisabledState(t){super.setDisabledState(t),t?this.form.disable():this.form.enable(),this.changeRef.markForCheck()}setFormValues(t){this.valueControl.setValue(t),this.changeRef.markForCheck()}getSelectedOption(){const t=this.valueControl.value;return this.options.find(o=>o.value===t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(fe.ze),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-quiz-label-anatomy-select"]],inputs:{options:"options",outline:"outline"},outputs:{valueChange:"valueChange"},standalone:!0,features:[e.Jv_([{provide:fe.kq,useExisting:(0,e.Rfq)(()=>n),multi:!0}]),e.Vt3,e.aNF],decls:7,vars:5,consts:[[1,"label",3,"formGroup"],[1,"flex","text-xs","label__select-label"],[1,"flex","justify-between","flex-auto","p-2"],[1,"mr-2"],["icon","caret-down","size","lg"],["class","input label__select","placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",4,"ngIf"],["placeholder","Select Option","formControlName","value","data-test","quizLabelSelect",1,"input","label__select"],["value","","data-test","questionAnswerOption"],["class","label__option","data-test","questionAnswerOption",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswerOption",1,"label__option",3,"value"]],template:function(o,s){if(1&o&&(e.j41(0,"div",0)(1,"label",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.nrm(5,"app-icon",4),e.k0s(),e.DNE(6,$C,4,1,"select",5),e.k0s()()),2&o){let a;e.AVh("label--empty",""===s.valueControl.value),e.Y8G("formGroup",s.form),e.R7$(4),e.JRh((null==(a=s.getSelectedOption())||null==a.label?null:a.label.title)||"Select"),e.R7$(2),e.Y8G("ngIf",!s.disabled)}},dependencies:[J.MD,J.Sq,J.bT,fe.YN,fe.xH,fe.y7,fe.wz,fe.BC,fe.cb,fe.X1,fe.j4,fe.JD,sn.o,ut.R],styles:[".label[_ngcontent-%COMP%]{overflow:hidden}.label__select-label[_ngcontent-%COMP%]{color:#0c1726;position:relative}.label__select[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;opacity:.01}.label--empty[_ngcontent-%COMP%]   .label__select-label[_ngcontent-%COMP%]{color:#8999b3}"],changeDetection:0})}return n})();function WC(n,i){1&n&&e.nrm(0,"app-icon",8)}function XC(n,i){1&n&&e.nrm(0,"app-icon",9)}function HC(n,i){if(1&n&&(e.j41(0,"div",10)(1,"em",11),e.EFF(2),e.k0s(),e.EFF(3,". "),e.k0s()),2&n){const t=e.XpG(2);e.R7$(2),e.JRh(t.option.label.title)}}function QC(n,i){if(1&n&&(e.j41(0,"div",10)(1,"p",12),e.EFF(2," You selected "),e.j41(3,"em",11),e.EFF(4),e.k0s(),e.EFF(5,". "),e.k0s(),e.j41(6,"p"),e.EFF(7," This is the "),e.j41(8,"em",11),e.EFF(9),e.k0s(),e.EFF(10,". "),e.k0s()()),2&n){let t;const o=e.XpG(2);e.R7$(4),e.JRh(null==(t=o.getSelectedLabel(o.options,o.control.value))?null:t.title.trim()),e.R7$(5),e.JRh(o.option.label.title.trim())}}function YC(n,i){if(1&n&&(e.j41(0,"div",4),e.DNE(1,WC,1,0,"app-icon",5)(2,XC,1,0,"app-icon",6)(3,HC,4,1,"div",7)(4,QC,11,2,"div",7),e.k0s()),2&n){const t=e.XpG();e.Y8G("ngSwitch",t.correct),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1)}}class ds extends Am{constructor(){super(...arguments),this.sequence=0,this.labelUpdated=new e.bkB}ngOnInit(){}handleLabelUpdated(i){this.labelUpdated.next(i.label)}handleOffsetUpdated(i){this.labelUpdated.next({...this.option.label,offset:i.offset})}getSelectedLabel(i,t){const o=this.options.find(s=>s.value===t);return o?o.label:void 0}static#e=this.\u0275fac=(()=>{let i;return function(o){return(i||(i=e.xGo(ds)))(o||ds)}})();static#t=this.\u0275cmp=e.VBU({type:ds,selectors:[["app-quiz-label"]],inputs:{sequence:"sequence",collapsed:"collapsed",options:"options",option:"option",correct:"correct",mode:"mode"},outputs:{labelUpdated:"labelUpdated"},standalone:!0,features:[e.Jv_([{provide:fe.kq,useExisting:(0,e.Rfq)(()=>ds),multi:!0}]),e.Vt3,e.aNF],decls:5,vars:17,consts:[[1,"label","theme-light",3,"labelUpdated","offsetUpdated","label","fit","opaque","fixedScale","pinDraggable","tagDraggable","isCollapsed","descriptionCollapsed","hasContent","sequence"],["label-body","",1,"label__body"],[3,"outline","hidden","options","formControl"],["class","label__summary flex items-start",3,"ngSwitch",4,"ngIf"],[1,"label__summary","flex","items-start",3,"ngSwitch"],["class","label__icon label__icon--correct","style","font-size: 16px","icon","check-circle",4,"ngSwitchCase"],["class","label__icon label__icon--incorrect","style","font-size: 16px","icon","times-circle",4,"ngSwitchCase"],["class","label__text pl-2",4,"ngSwitchCase"],["icon","check-circle",1,"label__icon","label__icon--correct",2,"font-size","16px"],["icon","times-circle",1,"label__icon","label__icon--incorrect",2,"font-size","16px"],[1,"label__text","pl-2"],[1,"font-semibold"],[1,"pb-2"]],template:function(t,o){1&t&&(e.j41(0,"app-generic-label",0),e.nI1(1,"async"),e.bIt("labelUpdated",function(a){return o.handleLabelUpdated(a)})("offsetUpdated",function(a){return o.handleOffsetUpdated(a)}),e.j41(2,"div",1),e.nrm(3,"app-quiz-label-anatomy-select",2),e.DNE(4,YC,5,5,"div",3),e.k0s()()),2&t&&(e.Y8G("label",o.option.label)("fit","summary"===o.mode?"fixed":"auto")("opaque",!0)("fixedScale",e.bMT(1,15,o.labelScale$))("pinDraggable","edit"===o.mode)("tagDraggable",!0)("isCollapsed",o.collapsed)("descriptionCollapsed",!1)("hasContent",!0)("sequence",o.sequence),e.R7$(3),e.Y8G("outline",!1)("hidden","summary"===o.mode)("options",o.options)("formControl",o.control),e.R7$(),e.Y8G("ngIf","summary"===o.mode))},dependencies:[J.MD,J.bT,J.ux,J.e1,J.Jj,fe.YN,fe.BC,fe.X1,fe.l_,sn.o,ut.R,Yo,Np],styles:[".label__body[_ngcontent-%COMP%]{color:#0c1726;min-width:142px;max-width:200px}.label__icon[_ngcontent-%COMP%]{position:relative;flex-basis:0 0 20px;justify-content:center}.label__icon--correct[_ngcontent-%COMP%]{color:#86efac}.label__icon--incorrect[_ngcontent-%COMP%]{color:#dc2626}.label__text[_ngcontent-%COMP%]{flex-wrap:wrap}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(et.getLabelScale),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],ds.prototype,"labelScale$",void 0);var Oa=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Ma=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function KC(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"app-quiz-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.bIt("labelUpdated",function(s){const a=e.eBV(t).index,r=e.XpG();return e.Njj(r.handleLabelUpdated(s,a))}),e.k0s(),e.bVm()}if(2&n){const t=i.$implicit,o=i.index,s=e.XpG();e.R7$(),e.Y8G("mode",s.mode)("formControl",t)("option",e.bMT(2,7,s.quizLabels$)[o])("options",e.bMT(3,9,s.quizLabels$))("sequence",o+1)("correct",s.isCorrect(e.bMT(4,11,s.quizLabels$)[o],e.bMT(5,13,s.activeSubmitted$),o))("collapsed",e.bMT(6,15,s.labelsCollapsed$))}}class fo{constructor(i,t,o,s){this.store=i,this.formBuilder=t,this.changeRef=o,this.router=s,this.ngUnsubscribe=new k.B,this.mode="edit",this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.initQuizSubmissionListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.quizLabels$.pipe((0,Tn.F)((i,t)=>{const o=i.map(a=>a.value),s=t.map(a=>a.value);return(0,u.isEqual)(o,s)}),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(Fe.j.getQuizModeActive);this.buildFormOptions(i,t),this.changeRef.markForCheck()}),(0,cn.z)([this.quizModeActive$,this.quizLabels$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{this.setFormEnabled(i),this.changeRef.markForCheck()})}initQuizSubmissionListeners(){this.activeSubmission$.pipe((0,D.p)(i=>!(0,u.isNil)(i)&&!(0,u.isNil)(i.answer)&&Array.isArray(i.answer)),(0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=i.answer;(0,u.isEqual)(this.form.value.options,o)||(this.form.patchValue({options:o},{emitEvent:!1,onlySelf:!0}),this.changeRef.markForCheck())}),this.form.valueChanges.pipe((0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(Fe.j.getActiveQuestionId),o=this.store.selectSnapshot(Fe.j.getActiveSubmitted),s=this.store.selectSnapshot(Fe.j.getActiveSubmission),a=(0,u.isNil)(s)?[]:s.answer,r=i.options;(0,u.isNil)(o)&&((0,u.isEqual)(r,a)||this.store.dispatch(new Xt.B.SetActiveSubmission({questionId:t,answer:r})),this.changeRef.markForCheck())}),(0,cn.z)([this.quizModeActive$,this.activeSubmitted$]).subscribe(([i,t])=>{this.mode=this.router.url.includes("/edit")?"edit":i&&!(0,u.isNil)(t)?"summary":"view",this.changeRef.markForCheck()})}isCorrect(i,t,o){if(!(0,u.isNil)(t))return t.answer[o]===i.value}handleLabelUpdated(i,t){const o=this.store.selectSnapshot(Fe.j.getActiveQuestion);o.data.options[t].label=i,this.store.dispatch(new Xt.B.SetQuestion(o))}buildFormOptions(i,t){this.optionsArray.clear(),i.forEach(o=>{this.optionsArray.push(this.formBuilder.control(t?"":o.value))})}setFormEnabled(i){i?this.optionsArray.enable():this.optionsArray.disable()}static#e=this.\u0275fac=function(t){return new(t||fo)(e.rXU(l.il),e.rXU(fe.ze),e.rXU(e.gRc),e.rXU(K.Ix))};static#t=this.\u0275cmp=e.VBU({type:fo,selectors:[["app-quiz-labels"]],standalone:!0,features:[e.aNF],decls:3,vars:2,consts:[["data-test","quizLabelsElement",3,"formGroup"],["formArrayName","options"],[4,"ngFor","ngForOf"],["data-test","appQuizLabel",3,"labelUpdated","mode","formControl","option","options","sequence","correct","collapsed"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,KC,7,17,"ng-container",2),e.k0s()()),2&t&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.optionsArray.controls))},dependencies:[J.MD,J.Sq,J.Jj,fe.YN,fe.BC,fe.cb,fe.X1,fe.l_,fe.j4,fe.v8,ds],changeDetection:0})}Oa([(0,l.l6)(et.getLabelsCollapsed),Ma("design:type",h.c)],fo.prototype,"labelsCollapsed$",void 0),Oa([(0,l.l6)(Fe.j.getActiveQuestionLabels),Ma("design:type",h.c)],fo.prototype,"quizLabels$",void 0),Oa([(0,l.l6)(Fe.j.getQuizModeActive),Ma("design:type",h.c)],fo.prototype,"quizModeActive$",void 0),Oa([(0,l.l6)(Fe.j.getAllSubmissions),Ma("design:type",h.c)],fo.prototype,"allSubmissions$",void 0),Oa([(0,l.l6)(Fe.j.getActiveSubmission),Ma("design:type",h.c)],fo.prototype,"activeSubmission$",void 0),Oa([(0,l.l6)(Fe.j.getActiveSubmitted),Ma("design:type",h.c)],fo.prototype,"activeSubmitted$",void 0);var gi=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},mi=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function qC(n,i){if(1&n&&(e.nrm(0,"app-context-label",5),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async")),2&n){let t,o,s;const a=e.XpG(3);e.Y8G("label",e.bMT(1,4,a.contextLabel$))("enableInfo",e.bMT(2,6,a.enableContextLabelInfo$)&&(null==(t=e.bMT(3,8,a.viewUI$))?null:t.nodeInfo.enable))("enableActions",e.bMT(4,10,a.enableContextLabelActions$)&&(null==(o=e.bMT(5,12,a.viewUI$))?null:o.contextActions.enable))("enableAudio",e.bMT(6,14,a.enableContextLabelAudio$)&&(null==(s=e.bMT(7,16,a.viewUI$))?null:s.nodeAudio.enable))}}function JC(n,i){if(1&n&&(e.qex(0),e.nrm(1,"app-story-label",6),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bVm()),2&n){let t,o;const s=i.$implicit,a=e.XpG(3);e.R7$(),e.AVh("labels__label--hidden",!s.shown),e.Y8G("pinDraggable",null==(t=e.bMT(2,7,a.draggable$))?null:t.pin)("tagDraggable",null==(o=e.bMT(3,9,a.draggable$))?null:o.tag)("label",s)("collapsed",e.bMT(4,11,a.labelsCollapsed$))("collapsedMode",e.bMT(5,13,a.labelsCollapsedMode$))}}function ZC(n,i){if(1&n&&(e.qex(0),e.DNE(1,qC,8,18,"app-context-label",3),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,JC,6,15,"ng-container",4),e.nI1(5,"async"),e.bVm()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,3,t.enableContextLabel$)&&e.bMT(3,5,t.contextLabel$)),e.R7$(3),e.Y8G("ngForOf",e.bMT(5,7,t.labels$))("ngForTrackBy",t.trackLabel)}}function eT(n,i){1&n&&(e.qex(0),e.nrm(1,"app-quiz-labels"),e.bVm())}function tT(n,i){if(1&n&&(e.j41(0,"div",1),e.DNE(1,ZC,6,9,"ng-container",2)(2,eT,2,0,"ng-container",2),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.showAnatomyLabels),e.R7$(),e.Y8G("ngIf",t.showQuizLabels)}}class Fn{constructor(i,t,o,s,a,r,_,g){this.action$=i,this.cameraService=t,this.changeDetector=o,this.elRef=s,this.labelsService=a,this.router=r,this.store=_,this.applicationEventService=g,this.interactive=!1,this.showAnatomyLabels=!1,this.showQuizLabels=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.bindEngineEvents(),this.bindApplicationEvents(),this.labelsService.setLabelContainer(this.elRef)}ngOnDestroy(){this.labelsService.setLabelContainer(null),this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}bindApplicationEvents(){this.action$.pipe((0,l.xi)(st.zE),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleClickNode(t)}),this.action$.pipe((0,l.xi)(st.fZ),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t.node&&this.store.dispatch(new Je.S3)}),this.labels$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.changeDetector.markForCheck()}),this.selectedLabel$.pipe((0,D.p)(t=>null==t),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(Ti.x.getZoomed),o=this.store.selectSnapshot(Ti.x.getLockCamera);t&&!o&&this.resetCamera()});const i=(0,cn.z)([this.activeTool$,this.activeQuestion$]).pipe((0,p.Q)(this.ngUnsubscribe),(0,W.T)(([t,o])=>{const s=this.router.url.indexOf("/edit")>=0,a=(0,u.get)(o,"type")===Pn.Q5.LabelAnatomy;return s?t===dn.s.Quiz:a}));(0,cn.z)([this.showLabels$,i,this.activeQuestion$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([t,o,s])=>{const a=(0,u.get)(s,"showChapterLabels");this.showQuizLabels=o,this.showAnatomyLabels=!this.showQuizLabels&&t||a,this.changeDetector.markForCheck()}),this.store.select(me.N.getSelectedChapterReadyState).pipe((0,D.p)(t=>null!=t),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.interactive=t.model,this.changeDetector.markForCheck()})}bindEngineEvents(){this.action$.pipe((0,l.xi)(st.Gv,Je.eH),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applicationEventService.fireEvent(i.show?rt.F.LabelsEnabled:rt.F.LabelsDisabled,null)}),this.action$.pipe((0,l.xi)(Je.Sh),(0,p.Q)(this.ngUnsubscribe),(0,ws.c)(0)).subscribe(i=>{this.applicationEventService.fireEvent(rt.F.LabelsCreated,i.label)}),this.action$.pipe((0,l.xi)(Je.lb),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applicationEventService.fireEvent(rt.F.LabelsUpdated,i.label)}),this.action$.pipe((0,l.xi)(Je.D3),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{i.labels.forEach(t=>{this.applicationEventService.fireEvent(i.shown?rt.F.LabelsShown:rt.F.LabelsHidden,{labelId:t.id})})}),this.action$.pipe((0,l.xi)(Je.vx),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applicationEventService.fireEvent(rt.F.LabelsDestroyed,i.label)})}handleClickNode(i){const t=this.store.selectSnapshot(ze.S.getActiveTool);if((0,u.isNil)(i.node))this.store.dispatch(new Je.TR(null)),this.store.dispatch(new Je.S3);else{const o=this.store.selectSnapshot(et.getEnableContextLabel);t===dn.s.Label?this.addLabel(i.hit,i.node):o&&setTimeout(()=>{this.toggleContextLabel(i.hit,i.node)})}}addLabel(i,t){const o=this.cameraService.getDirection(i),s=this.getLabelDefaults(i.objectId),a=s.hideWire?20:32;s.title=t.label,s.offset=[a,0],s.objectId=i.objectId,s.barycentric=[i.barycentric[0],i.barycentric[1],i.barycentric[2]],s.pos=[i.worldPos[0],i.worldPos[1],i.worldPos[2]],s.primitiveIndex=i.triIndex,s.renderableIndex=i.renderableIndex||0,s.dir=o,s.chapterId=this.store.selectSnapshot(me.N.getSelectedChapter).id,s.occludable=!0,s.shown=!0,this.store.dispatch(new Je.Sh(s,!0)),this.store.dispatch(new Je.TR(s))}toggleContextLabel(i,t){const o=this.store.selectSnapshot(Rn.z.getCheckedNodeIds);if(!this.store.selectSnapshot(ze.S.getContextMenu).node&&o.some(a=>a===t.id)){const a=this.cameraService.getDirection(i),r=this.labelsService.makeDefaultStudioLabel();r.theme=Hi.D.Context,r.title=t.label,r.offset=[32,0],r.objectId=i.objectId,r.barycentric=[i.barycentric[0],i.barycentric[1],i.barycentric[2]],r.pos=[i.worldPos[0],i.worldPos[1],i.worldPos[2]],r.primitiveIndex=i.triIndex,r.renderableIndex=i.renderableIndex||0,r.dir=a,r.occludable=!1,r.hideWire=!0,r.pinType=ci.O.None,this.store.dispatch(new Je.h5(r))}else this.store.dispatch(new Je.S3)}getLabelDefaults(i){let t=this.store.selectSnapshot(et.getSelectedLabel);if(null==t){let o=this.store.selectSnapshot(et.getChapterLabels);(!o||0===o.length)&&(o=this.store.selectSnapshot(et.getLabels)),o.length&&(t=(0,u.cloneDeep)(o[o.length-1]))}if(null!=t){const o=this.labelsService.makeDefaultStudioLabel();switch(o.hideWire=t.hideWire,o.pinGlow=t.pinGlow,o.pinType=t.pinType,o.theme=t.theme,o.themeStyles=t.themeStyles,o.sequentialType=t.sequentialType,o.states[0].errands[0]=new Pp.T,(0,u.get)(t,"states[1].errands[0].type")){case es.X.flyToObject:case es.X.flyToCamera:o.states[1].errands[0]=new Ip.F(i)}return o}{const o=this.labelsService.makeDefaultStudioLabel();return o.states[0].errands[0]=new Pp.T,o.states[1].errands[0]=new Ip.F(i),o}}trackLabel(i,t){const{id:o,shown:s,theme:a}=t;return`${o}${s}${a}`}resetCamera(){const t=this.store.selectSnapshot(me.N.getSelectedChapter)?.camera?.location;(0,u.isNil)(t)||this.store.dispatch(new Ut.Ih(t))}static#e=this.\u0275fac=function(t){return new(t||Fn)(e.rXU(l.En),e.rXU(go.j),e.rXU(e.gRc),e.rXU(e.aKT),e.rXU(Tr.x),e.rXU(K.Ix),e.rXU(l.il),e.rXU(Po.S))};static#t=this.\u0275cmp=e.VBU({type:Fn,selectors:[["app-labels"]],standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[["class","labels","data-test","labelsElement","dir","ltr",4,"ngIf"],["data-test","labelsElement","dir","ltr",1,"labels"],[4,"ngIf"],[3,"label","enableInfo","enableActions","enableAudio",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"label","enableInfo","enableActions","enableAudio"],["data-test","appStoryLabel",1,"labels__label",3,"pinDraggable","tagDraggable","label","collapsed","collapsedMode"]],template:function(t,o){1&t&&e.DNE(0,tT,3,2,"div",0),2&t&&e.Y8G("ngIf",o.interactive)},dependencies:[J.MD,J.Sq,J.bT,J.Jj,Fs,fo,cs],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;position:relative}.labels[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2;pointer-events:none}.labels__label--hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}function Ia(n){return n/1048576}gi([(0,l.l6)(Ke.getUI),mi("design:type",h.c)],Fn.prototype,"viewUI$",void 0),gi([(0,l.l6)(et.getChapterLabels),mi("design:type",h.c)],Fn.prototype,"labels$",void 0),gi([(0,l.l6)(Fe.j.getQuizModeActive),mi("design:type",h.c)],Fn.prototype,"quizModeActive$",void 0),gi([(0,l.l6)(ze.S.getActiveTool),mi("design:type",h.c)],Fn.prototype,"activeTool$",void 0),gi([(0,l.l6)(Fe.j.getActiveQuestion),mi("design:type",h.c)],Fn.prototype,"activeQuestion$",void 0),gi([(0,l.l6)(me.N.getSelectedChapter),mi("design:type",h.c)],Fn.prototype,"selectedChapter$",void 0),gi([(0,l.l6)(et.getSelectedLabel),mi("design:type",h.c)],Fn.prototype,"selectedLabel$",void 0),gi([(0,l.l6)(et.getLabelsCollapsed),mi("design:type",h.c)],Fn.prototype,"labelsCollapsed$",void 0),gi([(0,l.l6)(et.getLabelsCollapsedMode),mi("design:type",h.c)],Fn.prototype,"labelsCollapsedMode$",void 0),gi([(0,l.l6)(et.getContextLabel),mi("design:type",h.c)],Fn.prototype,"contextLabel$",void 0),gi([(0,l.l6)(ze.S.getShowLabels),mi("design:type",h.c)],Fn.prototype,"showLabels$",void 0),gi([(0,l.l6)(Ti.x.getZoomed),mi("design:type",h.c)],Fn.prototype,"zoomed$",void 0),gi([(0,l.l6)(et.getEnableContextLabel),mi("design:type",h.c)],Fn.prototype,"enableContextLabel$",void 0),gi([(0,l.l6)(et.getEnableContextLabelInfo),mi("design:type",h.c)],Fn.prototype,"enableContextLabelInfo$",void 0),gi([(0,l.l6)(et.getEnableContextLabelActions),mi("design:type",h.c)],Fn.prototype,"enableContextLabelActions$",void 0),gi([(0,l.l6)(et.getEnableContextLabelAudio),mi("design:type",h.c)],Fn.prototype,"enableContextLabelAudio$",void 0),gi([(0,l.l6)(et.getLabelsDraggable),mi("design:type",h.c)],Fn.prototype,"draggable$",void 0);var Rm=d(82542);function Nm(n){return n.toLocaleString()}const tc={totalVisibleLeafObjects:{title:"Visible Objects",description:"This value represents the number of visible objects in current chapter.",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},geometries:{title:"Geometry + Morphs",description:"",thresholds:{stable:[0,1e3],warning:[1e3,2e3],danger:[2e3,Number.MAX_SAFE_INTEGER]}},materials:{title:"Material Count",description:"This value represents the number of materials downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},textures:{title:"Texture Count",description:"This value represents the number of textures downloaded from BioDigital server whenever a page is reloaded.",thresholds:{stable:[0,50],warning:[50,100],danger:[100,Number.MAX_SAFE_INTEGER]}},duration:{title:"Time to Load (s)",description:"This value represents the number of seconds it takes for the entire BioDigital scene (Materials + Textures + Vertices + etc) to load when the page is refreshed.",thresholds:{stable:[0,4],warning:[4,10],danger:[10,Number.MAX_SAFE_INTEGER]}},drawCalls:{title:"Draw Call Count",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},drawVertices:{title:"Vertex Count",description:"",thresholds:{stable:[0,25e4],warning:[25e4,5e5],danger:[5e5,Number.MAX_SAFE_INTEGER]}},cpuTime:{title:"CPU Time (ms)",description:"",thresholds:{stable:[0,8],warning:[8,12],danger:[12,Number.MAX_SAFE_INTEGER]}},frameRate:{title:"Frame Rate (fps)",description:"",thresholds:{stable:[58,Number.MAX_SAFE_INTEGER],warning:[45,58],danger:[0,45]}},downloadGeometry:{title:"Geometry Data",description:"",thresholds:{stable:[0,10],warning:[10,25],danger:[25,Number.MAX_SAFE_INTEGER]}},downloadMorph:{title:"Morph Data",description:"",thresholds:{stable:[0,5],warning:[5,10],danger:[10,Number.MAX_SAFE_INTEGER]}},downloadMaterial:{title:"Material Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},downloadTransform:{title:"Transform Data",description:"",thresholds:{stable:[0,.5],warning:[.5,1],danger:[1,Number.MAX_SAFE_INTEGER]}},memoryUsage:{title:"Active Memory Usage",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},chapterPeakMemory:{title:"Chapter Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}},scenePeakMemory:{title:"Scene Peak Memory",description:"",thresholds:{stable:[0,400],warning:[400,600],danger:[600,Number.MAX_SAFE_INTEGER]}}};function sT(n){return tc[n]?.title??""}function aT(n){const t=tc[n]?.thresholds,o=[];if(t){const a=Object.entries(t).reduce((r,[_,g])=>(r.push(`${_.toUpperCase()}: ${function iT(n){const[i,t]=n;let o=Nm(i);i===Number.MIN_SAFE_INTEGER&&(o="min");let s=Nm(t);return t===Number.MAX_SAFE_INTEGER&&(s="max"),`[${o} - ${s}]`}(g)}`),r),[]).join(" ");o.push(a)}return o.join(" ")}function rT(n,i){const t=tc[n]?.thresholds;if(t){const{stable:o,warning:s,danger:a}=t;if((0,u.inRange)(i,...o))return"stable";if((0,u.inRange)(i,...s))return"warning";if((0,u.inRange)(i,...a))return"danger"}return"stable"}var nc=d(3272),Gs=d(82765);const lT=["labelEl"],cT=["*",[["","form-field-help",""]]],dT=["*","[form-field-help]"],_T=(n,i,t,o)=>({"field--light":n,"field--dark":i,"field--inline":t,"field--compact":o});function pT(n,i){1&n&&e.eu8(0)}function uT(n,i){if(1&n&&(e.j41(0,"label",4,1),e.DNE(2,pT,1,0,"ng-container",5),e.k0s()),2&n){const t=e.XpG(),o=e.sdS(4);e.BMQ("aria-label",t.label),e.R7$(2),e.Y8G("ngTemplateOutlet",o)}}function hT(n,i){1&n&&e.eu8(0)}function gT(n,i){if(1&n&&(e.j41(0,"div",4),e.DNE(1,hT,1,0,"ng-container",5),e.k0s()),2&n){const t=e.XpG(),o=e.sdS(4);e.BMQ("aria-label",t.label),e.R7$(),e.Y8G("ngTemplateOutlet",o)}}function mT(n,i){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.AVh("uppercase",t.uppercase),e.R7$(),e.SpI(" ",t.label," ")}}function fT(n,i){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.labelHelp," ")}}function ST(n,i){if(1&n&&(e.DNE(0,mT,2,3,"div",6)(1,fT,2,1,"div",7),e.j41(2,"div",8),e.SdG(3),e.j41(4,"div",9),e.SdG(5,1),e.k0s()()),2&n){const t=e.XpG();e.Y8G("ngIf",t.label),e.R7$(),e.Y8G("ngIf",t.labelHelp)}}let ic=(()=>{class n{constructor(){this.display="block",this.theme="dark",this.uppercase=!0,this.isCompact=!1,this.labelElement=!0,this.ngUnsubscribe=new k.B}ngOnInit(){}ngAfterViewInit(){this.labelEl&&this.initLabel()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLabel(){this.labelEl.nativeElement.querySelectorAll("[contenteditable]").length>0&&(0,Sn.R)(this.labelEl.nativeElement,"click").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(s=>{s.preventDefault()})}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-form-field"]],viewQuery:function(o,s){if(1&o&&e.GBs(lT,5),2&o){let a;e.mGM(a=e.lsd())&&(s.labelEl=a.first)}},inputs:{label:"label",labelHelp:"labelHelp",display:"display",theme:"theme",uppercase:"uppercase",isCompact:"isCompact",labelElement:"labelElement"},ngContentSelectors:dT,decls:5,vars:8,consts:[["contentTemplate",""],["labelEl",""],["data-test","formField",1,"field",3,"ngClass"],["class","field__container",4,"ngIf"],[1,"field__container"],[4,"ngTemplateOutlet"],["class","field__label text-2xs","data-test","formFieldLabel",3,"uppercase",4,"ngIf"],["class","text-xs text-gray-400 my-1",4,"ngIf"],[1,"field__input"],[1,"field__help","text-gray-400","text-xs"],["data-test","formFieldLabel",1,"field__label","text-2xs"],[1,"text-xs","text-gray-400","my-1"]],template:function(o,s){1&o&&(e.NAR(cT),e.j41(0,"div",2),e.DNE(1,uT,3,2,"label",3)(2,gT,2,2,"div",3)(3,ST,6,2,"ng-template",null,0,e.C5r),e.k0s()),2&o&&(e.Y8G("ngClass",e.ziG(3,_T,"light"===s.theme,"dark"===s.theme,"inline"===s.display,s.isCompact)),e.R7$(),e.Y8G("ngIf",s.labelElement),e.R7$(),e.Y8G("ngIf",!s.labelElement))},dependencies:[J.YU,J.bT,J.T3],styles:[".field[_ngcontent-%COMP%]{padding-bottom:16px;display:block;width:100%}.field__input[_ngcontent-%COMP%]{margin-top:4px}.field--light[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#384c6c}.field--dark[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{color:#8999b3}.field--inline[_ngcontent-%COMP%]   .field__container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:auto}.field--inline[_ngcontent-%COMP%]   .field__label[_ngcontent-%COMP%]{margin-right:8px}.field--inline[_ngcontent-%COMP%]   .field__input[_ngcontent-%COMP%]{margin-top:auto}.field--compact[_ngcontent-%COMP%]{padding-bottom:0}.field__help[_ngcontent-%COMP%]:not(:empty){padding-top:4px}"],changeDetection:0})}return n})();var km=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Dm=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const bT=(n,i)=>({"engine-stats--light":n,"engine-stats--dark":i,"engine-stats--advanced":!0});function yT(n,i){if(1&n&&(e.j41(0,"a",1)(1,"span",7),e.EFF(2," Documentation"),e.k0s(),e.nrm(3,"app-icon",8),e.k0s()),2&n){const t=e.XpG(2);e.BMQ("href",t.statsSupportUrl,e.B4B)}}function vT(n,i){if(1&n&&(e.j41(0,"section",3)(1,"table",4)(2,"caption",5),e.EFF(3," Download Size (Total) "),e.k0s(),e.j41(4,"tr")(5,"th",6),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"number"),e.k0s()(),e.j41(10,"tr")(11,"th",6),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.nI1(15,"number"),e.k0s()(),e.j41(16,"tr")(17,"th",6),e.EFF(18),e.k0s(),e.j41(19,"td"),e.EFF(20),e.nI1(21,"number"),e.k0s()(),e.j41(22,"tr")(23,"th",6),e.EFF(24),e.k0s(),e.j41(25,"td"),e.EFF(26),e.nI1(27,"number"),e.k0s()()()()),2&n){const t=e.XpG(2);e.R7$(5),e.Y8G("matTooltip",t.getStatDescription("downloadGeometry")),e.R7$(),e.SpI(" ",t.getStatTitle("downloadGeometry")," "),e.R7$(),e.HbH(t.getStatCSS("downloadGeometry",t.engineStats.downloadGeometry)),e.R7$(),e.SpI(" ",e.i5U(9,20,t.engineStats.downloadGeometry,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("downloadMorph")),e.R7$(),e.SpI(" ",t.getStatTitle("downloadMorph")," "),e.R7$(),e.HbH(t.getStatCSS("downloadMorph",t.engineStats.downloadMorph)),e.R7$(),e.SpI(" ",e.i5U(15,23,t.engineStats.downloadMorph,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("downloadMaterial")),e.R7$(),e.SpI(" ",t.getStatTitle("downloadMaterial")," "),e.R7$(),e.HbH(t.getStatCSS("downloadMaterial",t.engineStats.downloadMaterial)),e.R7$(),e.SpI(" ",e.i5U(21,26,t.engineStats.downloadMaterial,"1.2-2")," MB "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("downloadTransform")),e.R7$(),e.SpI(" ",t.getStatTitle("downloadTransform")," "),e.R7$(),e.HbH(t.getStatCSS("downloadTransform",t.engineStats.downloadTransform)),e.R7$(),e.SpI(" ",e.i5U(27,29,t.engineStats.downloadTransform,"1.2-2")," MB ")}}function ET(n,i){if(1&n&&(e.j41(0,"section",3)(1,"table",4)(2,"caption",5),e.EFF(3," Memory "),e.k0s(),e.j41(4,"tr")(5,"th",6),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"number"),e.k0s()(),e.j41(10,"tr")(11,"th",6),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.nI1(15,"number"),e.k0s()(),e.j41(16,"tr")(17,"th",6),e.EFF(18),e.k0s(),e.j41(19,"td"),e.EFF(20),e.nI1(21,"number"),e.k0s()()()()),2&n){const t=e.XpG(3);e.R7$(5),e.Y8G("matTooltip",t.getStatDescription("memoryUsage")),e.R7$(),e.SpI(" ",t.getStatTitle("memoryUsage")," "),e.R7$(),e.HbH(t.getStatCSS("memoryUsage",t.currentAppStat.memoryUsage)),e.R7$(),e.SpI(" ",e.i5U(9,15,t.currentAppStat.memoryUsage,"1.0-0")," MB "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("chapterPeakMemory")),e.R7$(),e.SpI(" ",t.getStatTitle("chapterPeakMemory")," "),e.R7$(),e.HbH(t.getStatCSS("chapterPeakMemory",t.currentAppStat.chapterPeakMemory)),e.R7$(),e.SpI(" ",e.i5U(15,18,t.currentAppStat.chapterPeakMemory,"1.0-0")," MB "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("scenePeakMemory")),e.R7$(),e.SpI(" ",t.getStatTitle("scenePeakMemory")," "),e.R7$(),e.HbH(t.getStatCSS("scenePeakMemory",t.currentAppStat.scenePeakMemory)),e.R7$(),e.SpI(" ",e.i5U(21,21,t.currentAppStat.scenePeakMemory,"1.0-0")," MB ")}}function CT(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.viewReportClick())}),e.EFF(1," View Report "),e.k0s()}if(2&n){const t=e.XpG(4);e.Y8G("buttonTheme",t.theme())}}function TT(n,i){if(1&n){const t=e.RV6();e.j41(0,"section",3)(1,"h2",5),e.EFF(2,"Profiler"),e.k0s(),e.j41(3,"form",9)(4,"div",10)(5,"app-form-field",11)(6,"select",12)(7,"option",13),e.EFF(8,"DOM"),e.k0s(),e.j41(9,"option",14),e.EFF(10,"Markers"),e.k0s(),e.j41(11,"option",15),e.EFF(12,"None"),e.k0s()()(),e.j41(13,"app-form-field",16)(14,"mat-checkbox",17),e.EFF(15," Hover Pick Enabled "),e.k0s()()(),e.j41(16,"div",18)(17,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.toggleCaptureClick())}),e.EFF(18),e.k0s(),e.DNE(19,CT,2,1,"button",20),e.k0s()()(),e.j41(20,"section",3)(21,"h2",5),e.EFF(22,"Tools"),e.k0s(),e.j41(23,"div",18)(24,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.rayPickClick())}),e.EFF(25," Start Ray Picking "),e.k0s(),e.j41(26,"button",21),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.runSpectorJSClick())}),e.EFF(27," Run SpectorJS "),e.k0s()()()}if(2&n){const t=e.XpG(3);e.R7$(3),e.Y8G("formGroup",t.form),e.R7$(2),e.Y8G("isCompact",!0),e.R7$(8),e.Y8G("isCompact",!0),e.R7$(4),e.Y8G("buttonTheme",t.theme())("disabled",t.rayPicking),e.R7$(),e.SpI(" ",t.capturing?"Stop":"Start"," Capture "),e.R7$(),e.vxM(!t.capturing&&t.capturedStats.length>0?19:-1),e.R7$(5),e.Y8G("buttonTheme",t.theme())("disabled",t.capturing||t.rayPicking),e.R7$(2),e.Y8G("buttonTheme",t.theme())}}function OT(n,i){if(1&n&&e.DNE(0,ET,22,24,"section",3)(1,TT,28,10),2&n){const t=e.XpG(2);e.vxM(null!=t.currentAppStat&&t.currentAppStat.memoryUsage?0:-1),e.R7$(),e.vxM(t.showAdvancedTools()?1:-1)}}function MT(n,i){if(1&n&&(e.j41(0,"div",0),e.DNE(1,yT,4,1,"a",1),e.j41(2,"div",2)(3,"section",3)(4,"table",4)(5,"caption",5),e.EFF(6," Per Module "),e.k0s(),e.j41(7,"tr")(8,"th",6),e.EFF(9),e.k0s(),e.j41(10,"td"),e.EFF(11),e.nI1(12,"number"),e.k0s()(),e.j41(13,"tr")(14,"th",6),e.EFF(15),e.k0s(),e.j41(16,"td"),e.EFF(17),e.nI1(18,"number"),e.k0s()(),e.j41(19,"tr")(20,"th",6),e.EFF(21),e.k0s(),e.j41(22,"td"),e.EFF(23),e.nI1(24,"number"),e.k0s()(),e.j41(25,"tr")(26,"th",6),e.EFF(27),e.k0s(),e.j41(28,"td"),e.EFF(29),e.nI1(30,"number"),e.k0s()(),e.j41(31,"tr")(32,"th",6),e.EFF(33),e.k0s(),e.j41(34,"td"),e.EFF(35),e.nI1(36,"number"),e.k0s()()()(),e.j41(37,"section",3)(38,"table",4)(39,"caption",5),e.EFF(40),e.k0s(),e.j41(41,"tr")(42,"th",6),e.EFF(43),e.k0s(),e.j41(44,"td"),e.EFF(45),e.nI1(46,"number"),e.k0s()(),e.j41(47,"tr")(48,"th",6),e.EFF(49),e.k0s(),e.j41(50,"td"),e.EFF(51),e.nI1(52,"number"),e.k0s()(),e.j41(53,"tr")(54,"th",6),e.EFF(55),e.k0s(),e.j41(56,"td"),e.EFF(57),e.nI1(58,"number"),e.k0s()(),e.j41(59,"tr")(60,"th",6),e.EFF(61),e.k0s(),e.j41(62,"td"),e.EFF(63),e.nI1(64,"number"),e.k0s()()()(),e.DNE(65,vT,28,32,"section",3)(66,OT,2,2),e.nI1(67,"async"),e.k0s()()),2&n){const t=e.XpG();e.Y8G("ngClass",e.l_i(79,bT,"light"===t.theme(),"dark"===t.theme())),e.R7$(),e.vxM(t.enableAdvancedStats?1:-1),e.R7$(7),e.Y8G("matTooltip",t.getStatDescription("totalVisibleLeafObjects")),e.R7$(),e.SpI(" ",t.getStatTitle("totalVisibleLeafObjects")," "),e.R7$(),e.HbH(t.getStatCSS("totalVisibleLeafObjects",t.engineStats.totalVisibleLeafObjects)),e.R7$(),e.SpI(" ",e.i5U(12,50,t.engineStats.totalVisibleLeafObjects,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("geometries")),e.R7$(),e.SpI(" ",t.getStatTitle("geometries")," "),e.R7$(),e.HbH(t.getStatCSS("geometries",t.engineStats.geometries)),e.R7$(),e.SpI(" ",e.i5U(18,53,t.engineStats.geometries,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("materials")),e.R7$(),e.SpI(" ",t.getStatTitle("materials")," "),e.R7$(),e.HbH(t.getStatCSS("materials",t.engineStats.materials)),e.R7$(),e.SpI(" ",e.i5U(24,56,t.engineStats.materials,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("textures")),e.R7$(),e.SpI(" ",t.getStatTitle("textures")," "),e.R7$(),e.HbH(t.getStatCSS("textures",t.engineStats.textures)),e.R7$(),e.SpI(" ",e.i5U(30,59,t.engineStats.textures,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("duration")),e.R7$(),e.SpI(" ",t.getStatTitle("duration")," "),e.R7$(),e.HbH(t.getStatCSS("duration",null==t.currentAppStat?null:t.currentAppStat.duration)),e.R7$(),e.SpI(" ",e.i5U(36,62,null==t.currentAppStat?null:t.currentAppStat.duration,"1.1-1")," "),e.R7$(5),e.SpI(" Per Frame",t.statsCached?" (cached)":""," "),e.R7$(2),e.Y8G("matTooltip",t.getStatDescription("drawCalls")),e.R7$(),e.SpI(" ",t.getStatTitle("drawCalls")," "),e.R7$(),e.HbH(t.getStatCSS("drawCalls",t.engineStats.drawCalls)),e.R7$(),e.SpI(" ",e.i5U(46,65,t.engineStats.drawCalls,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("drawVertices")),e.R7$(),e.SpI(" ",t.getStatTitle("drawVertices")," "),e.R7$(),e.HbH(t.getStatCSS("drawVertices",t.engineStats.drawVertices)),e.R7$(),e.SpI(" ",e.i5U(52,68,t.engineStats.drawVertices,"1.0")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("cpuTime")),e.R7$(),e.SpI(" ",t.getStatTitle("cpuTime")," "),e.R7$(),e.HbH(t.getStatCSS("cpuTime",t.engineStats.cpuTime)),e.R7$(),e.SpI(" ",e.i5U(58,71,t.engineStats.cpuTime,"1.3-3")," "),e.R7$(3),e.Y8G("matTooltip",t.getStatDescription("frameRate")),e.R7$(),e.SpI(" ",t.getStatTitle("frameRate")," "),e.R7$(),e.HbH(t.getStatCSS("frameRate",t.engineStats.frameRate)),e.R7$(),e.SpI(" ",e.i5U(64,74,t.engineStats.frameRate,"1.0-0")," "),e.R7$(2),e.vxM(t.enableAdvancedStats?65:-1),e.R7$(),e.vxM(t.enableAdvancedStats&&e.bMT(67,77,t.chapterReady$)?66:-1)}}const IT=["cpuTime","gpuTime","postProcessTime","frameTime","frameRate"];class $s{get engineStats(){return this.engineStats$.value}constructor(i,t,o,s,a,r,_){this.store=i,this.engineService=t,this.rendererService=o,this.markerService=s,this.storageService=a,this.dialog=r,this.changeRef=_,this.statsSupportUrl="https://www.notion.so/biodigital/Performance-Panel-Help-Doc-WIP-c0e54dfc39f2465383a18e33a97bdb4c",this.getStatTitle=sT,this.getStatDescription=aT,this.enableAdvancedStats=!1,this.theme=(0,e.hFB)(Rm.P.Dark),this.showAdvancedTools=(0,e.hFB)(!0),this.capturedStats=[],this.engineStats$=new Li.t(void 0),this.capturing=!1,this.rayPicking=!1,this.initialLabels=[],this.initialSceneMemory=0,this.initialMemoryByChapter={},this.peakMemoryByChapter={},this.chapterLoadStats={},this.ngUnsubscribe=new k.B,this.initState()}ngOnInit(){this.initFormListeners(),this.initStatsListeners(),this.initMemoryListeners();const i=new URLSearchParams(window.location.search),t="true"===i.get("ui-stats-capture"),o="false"!==i.get("ui-stats-hover"),s=i.get("ui-stats-label")||"dom";this.form.setValue({hoverPickEnabled:o,labelsMode:s}),t&&this.toggleCapture(!0),this.enableAdvancedStats=z.c.application===xn.c.Loft||z.c.deploy!==pi.Z.Production||"true"===this.storageService.getLocalItem(It.UT.EnableAdvancedStats),this.changeRef.markForCheck()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}rayPickClick(){confirm("Please note, this may take upto 10+ seconds to run and will lock your browser temporarily. Continue?")&&(this.rayPicking=!0,this.changeRef.markForCheck(),setTimeout(()=>{this.runRayPickSuite().then(i=>{this.rayPicking=!1,this.changeRef.markForCheck();const{startMemoryUsage:t,endMemoryUsage:o,meanRayPickTime:s}=i,a={startMemoryUsage:`${t.toFixed(0)} MB`,endMemoryUsage:`${o.toFixed(0)} MB`,meanRayPickTime:`${s.toFixed(2)} ms`};alert(JSON.stringify(a,null,2))})},1))}runRayPickSuite(){var i=this;return(0,pt.A)(function*(){return new Promise(t=>{const{offsetWidth:o,offsetHeight:s}=i.rendererService.getCanvas(),a=i.currentAppStat.memoryUsage,r=[];for(let g=0;g<s;g+=5)for(let P=0;P<o;P+=5){const F=performance.now();i.rendererService.pick(P,g,!0);const le=performance.now()-F;r.push(le)}const _=(0,u.mean)(r);r.length=0,setTimeout(()=>{t({startMemoryUsage:a,endMemoryUsage:i.currentAppStat.memoryUsage,meanRayPickTime:_})},1e3)})})()}toggleCaptureClick(){if(!this.capturing&&confirm("Do you want to reload the page to ensure accurate profiling? Otherwise the profiler will start immediately.")){const{hoverPickEnabled:t,labelsMode:o}=this.form.value,s=new URLSearchParams(window.location.search);s.set("ui-stats-capture","true"),s.set("ui-stats-hover",`${t}`),s.set("ui-stats-label",`${o}`);const a=`${location.pathname}?${s.toString()}`;window.location.href=a}else this.toggleCapture(!this.capturing)}toggleCapture(i){this.capturing=i,this.capturing?(this.capturedStats.length=0,this.capturing=!0):(this.capturing=!1,this.viewReport()),this.changeRef.markForCheck()}getStatCSS(i,t){return["engine-stats-row",`engine-stats-row--${rT(i,t)}`]}runSpectorJSClick(){this.runSpectorJS()}runSpectorJS(){var i=this;return(0,pt.A)(function*(){d.e(492).then(d.t.bind(d,47492,23)).then(({EmbeddedFrontend:t,Spector:o})=>{i.spector||(i.spector=new o,i.spector.onCapture.add(a=>{console.log("specture captured",a,i.spector),console.log({EmbeddedFrontend:t});const r=new t.ResultView;r.display(),r.addCapture(a)}),i.spector.onError.add(a=>{console.warn("specture error",a,i.spector)})),i.spector.captureNextFrame(i.engineService.engine.renderer.canvas,!1)})})()}viewReportClick(){var i=this;return(0,pt.A)(function*(){i.viewReport()})()}viewReport(){var i=this;return(0,pt.A)(function*(){const t=i.capturedStats,o=i.store.selectSnapshot(me.N.getStoryChapters),{StatsDialogComponent:s}=yield d.e(608).then(d.bind(d,36608));i.dialog.open(s,{width:"90vw",panelClass:"bd-publish-dialog-panel",data:{chapters:o,appStats:t,chapterLoadStats:i.chapterLoadStats}}).afterClosed().pipe((0,p.Q)(i.ngUnsubscribe)).subscribe()})()}initState(){const i=performance?.memory?.usedJSHeapSize??0;this.initialSceneMemory=Ia(i),this.form=new fe.gE({hoverPickEnabled:new fe.MJ(!0),labelsMode:new fe.MJ("dom")}),this.store.select(et.getLabels).pipe((0,D.p)(t=>t?.length>0),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.initialLabels=t;const{labelsMode:o}=this.form.value;this.toggleLabelsMode(o)})}initFormListeners(){this.form.valueChanges.pipe((0,W.T)(i=>i.hoverPickEnabled),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.toggleHoverPick(i)}),this.form.valueChanges.pipe((0,W.T)(i=>i.labelsMode),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.toggleLabelsMode(i)})}initStatsListeners(){this.engineService.getEvent(Ct.X.AssetsLoadProgress).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const{chapterId:t,chapterProgress:o}=i,s=this.chapterLoadStats[t]??{chapterId:t,startTime:performance.now()};1===o&&(s.endTime=performance.now(),s.duration=(s.endTime-s.startTime)/1e3),this.chapterLoadStats[t]=s}),this.engineService.engineCreated$.pipe((0,Ln.Z)(i=>{const t=this.engineService.server;return function nT(n,i){const{renderer:t}=n;return new h.c(o=>{let s=performance.now(),a=s,r=0,_=0,g=0,P=0,F=0,ee=0,le=0,he=0,ue=0,ye=0,Ge=0;const Ve=function(){var ot=(0,pt.A)(function*(){_++;const _t=performance.now();r=_t-s,_t>=a+1e3&&(P=1e3*_/(_t-a),a=_t,_=0),s=_t;const xt=performance?.memory?.usedJSHeapSize??0;g=Ia(xt),he=Ia(i?.dataSize?.material??0),ue=Ia(i?.dataSize?.morph??0),ye=Ia(i?.dataSize?.geometry??0),Ge=Ia(i?.dataSize?.transform??0),o.next({...t.stats,totalObjects:F,totalLeafObjects:ee,totalVisibleLeafObjects:le,frameRate:P,frameTime:r,memoryUsage:g,downloadMaterial:he,downloadMorph:ue,downloadGeometry:ye,downloadTransform:Ge})});return function(){return ot.apply(this,arguments)}}(),it=()=>{n&&(n.off("destroy",it),t.off("end",Ve)),o.next({...t.stats,totalObjects:F,totalLeafObjects:ee,totalVisibleLeafObjects:le,frameRate:P,frameTime:r,memoryUsage:g,downloadMaterial:he,downloadMorph:ue,downloadGeometry:ye,downloadTransform:Ge}),o.complete()};t.on("end",Ve),n.on("changestory",()=>{const{anatomyObjects:ot}=n.story.anatomySceneGraph;F=ot.size;const _t=()=>{ee=0,le=0,ot.forEach($t=>{!$t.children?.length&&(ee++,$t.shown&&le++)})},xt=$t=>{"shown"===$t?.property&&_t()};_t(),ot.forEach($t=>{$t.on("change",xt)})}),n.on("destroy",it),o.add(it)})}(i,t instanceof A.BioDigitalWebSocketServer?t:void 0)}),(0,Ho.Z)(100),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.statsCached=!1;const t=this.engineStats,o=Object.entries(i).reduce((s,[a,r])=>{const _=a;if(!IT.includes(_)){const g=t?.[_];!r&&g&&(s[_]=g,this.statsCached=!0)}return s},{...t,...i});this.engineStats$.next(o),this.changeRef.markForCheck()})}initMemoryListeners(){(0,cn.z)([this.engineStats$,this.chapterId$,this.chapterReady$]).pipe((0,D.p)(([i,,t])=>!(0,u.isNil)(i)&&t),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const o=this.initialSceneMemory,s=i.memoryUsage,a=s-o;this.initialMemoryByChapter[t]=this.initialMemoryByChapter[t]??s;const g=Math.max(this.peakMemoryByChapter[t]??0,s);this.peakMemoryByChapter[t]=g;const P=Object.values(this.peakMemoryByChapter).reduce((ye,Ge)=>Math.max(ye,Ge),0),F={chapterInitialMemory:this.initialMemoryByChapter[t],chapterPeakMemory:this.peakMemoryByChapter[t],chapterDeltaMemory:a,sceneInitialMemory:o,scenePeakMemory:P},ee=this.chapterLoadStats[t]??{},le=performance.now(),{labelsMode:he,hoverPickEnabled:ue}=this.form.value;this.currentAppStat={...i,...ee,...F,timestamp:le,chapterId:t,labelsMode:he,hoverPickEnabled:ue},this.capturing&&this.capturedStats.push(this.currentAppStat),this.changeRef.markForCheck()})}toggleLabelsMode(i){switch(this.store.dispatch(new Je.gJ([])),this.markerService.deleteMarkers(),i){case"dom":this.store.dispatch(new Je.gJ(this.initialLabels));break;case"marker":this.initialLabels.forEach(t=>this.markerService.createMarker(t))}}toggleHoverPick(i){this.store.dispatch(new st.Pk({hoverEnabled:i}))}static#e=this.\u0275fac=function(t){return new(t||$s)(e.rXU(l.il),e.rXU(v.y),e.rXU(Er.z),e.rXU(nr),e.rXU(It.n$),e.rXU(vt.bZ),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:$s,selectors:[["app-engine-stats"]],inputs:{theme:[1,"theme"],showAdvancedTools:[1,"showAdvancedTools"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:[[1,"engine-stats",3,"ngClass"],["target","_blank","rel","noreferrer nofollow",1,"self-end","text-xs","font-semibold","text-link"],[1,"engine-stats__sections"],[1,"engine-stats__section"],[1,"engine-stats__table"],[1,"engine-stats__section-header"],["scope","row","matTooltipPosition","left",3,"matTooltip"],[1,"text-underline"],["icon","arrow-up-right-from-square",1,"ml-1"],[1,"flex","flex-col","text-xs",3,"formGroup"],[1,"flex","flex-row","justify-between"],["label","Labels",1,"my-1",3,"isCompact"],["formControlName","labelsMode",1,"input"],["value","dom",1,"my-1"],["value","marker",1,"my-1"],["value","none",1,"my-1"],["label","Input",1,"my-1","ml-1",3,"isCompact"],["formControlName","hoverPickEnabled"],[1,"my-1","engine-stats__buttons"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme","disabled"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"buttonTheme"],["type","button","app-button","","buttonType","outline","buttonSize","sm",3,"click","buttonTheme"]],template:function(t,o){1&t&&e.DNE(0,MT,68,82,"div",0),2&t&&e.vxM(o.engineStats?0:-1)},dependencies:[J.MD,J.YU,J.Jj,J.QX,fe.X1,fe.qT,fe.xH,fe.y7,fe.wz,fe.BC,fe.cb,fe.j4,fe.JD,nc.D,ic,Gs.So,Kt.oV,bn.C,Mn.Q,sn.o,ut.R],styles:[":root{--engine-stats-color: #384c6c;--engine-stats-background-color: #ffffff;--engine-stats-border-color: #e7eaee}.engine-stats{display:flex;flex-direction:column;padding:8px;text-align:left;border-radius:4px;color:var(--engine-stats-color);background-color:var(--engine-stats-background-color);border:1px solid var(--engine-stats-border-color)}.engine-stats__sections{display:flex;flex-direction:column;gap:16px}.engine-stats__section{display:flex;flex-direction:column;font-size:.75rem;line-height:1rem}.engine-stats__section-header{padding-top:.25rem;padding-bottom:.25rem;text-align:left;font-size:.875rem;line-height:1.25rem;font-weight:600}.engine-stats__buttons{display:flex;flex-direction:column;gap:8px}.engine-stats table th{width:60%;border-right:1px solid var(--engine-stats-border-color);font-weight:500;text-align:right}.engine-stats table td{font-weight:600}.engine-stats table th,.engine-stats table td{padding:2px 4px}.engine-stats table tr{border-top:1px solid var(--engine-stats-border-color);border-bottom:1px solid var(--engine-stats-border-color);border-collapse:collapse}.engine-stats-row--warning{background-color:#eab308;color:#384c6c}.engine-stats-row--danger{background-color:#b91c1c;color:#d4d9e3}.engine-stats--dark{--engine-stats-color: #d4d9e3;--engine-stats-background-color: #283853;--engine-stats-border-color: #142136}.engine-stats--advanced{width:260px}\n"],encapsulation:2,changeDetection:0})}km([(0,l.l6)(ze.S.getChapter),Dm("design:type",h.c)],$s.prototype,"chapterId$",void 0),km([(0,l.l6)(me.N.getSelectedChapterModelReady),Dm("design:type",h.c)],$s.prototype,"chapterReady$",void 0);const PT=(n,i,t,o,s)=>({"progress--small":n,"progress--medium":i,"progress--large":t,"progress--light":o,"progress--dark":s}),wT=n=>({"progress__bar--complete":n}),AT=n=>({width:n});let Lm=(()=>{class n{get value(){return this._value}set value(t){this._value=t,this.percentWidth=this.value/this.total*100,this.changeDetector.markForCheck()}constructor(t,o){this.router=t,this.changeDetector=o,this.total=100,this._value=0,this.size="small",this.disableComplete=!1,this.theme="dark",this.percentWidth=0,this.ngUnsubscribe=new k.B}ngOnInit(){this.router.events.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t instanceof K.Z&&(this.value=0)})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(K.Ix),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-progress"]],inputs:{total:"total",value:"value",size:"size",disableComplete:"disableComplete",theme:"theme"},decls:2,vars:14,consts:[[1,"progress",3,"ngClass"],["role","progressbar","aria-label","content loading progress","aria-valuemin","0","aria-valuemax","100","data-test","loadingProgressBar",1,"progress__bar",3,"ngClass","ngStyle"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.nrm(1,"div",1),e.k0s()),2&o&&(e.Y8G("ngClass",e.s1E(4,PT,"small"===s.size,"medium"===s.size,"large"===s.size,"light"===s.theme,"dark"===s.theme)),e.R7$(),e.Y8G("ngClass",e.eq3(10,wT,!s.disableComplete&&100===s.percentWidth))("ngStyle",e.eq3(12,AT,s.percentWidth+"%")),e.BMQ("aria-valuenow",s.percentWidth))},dependencies:[J.YU,J.B3],styles:["[_ngcontent-%COMP%]:root{--app-progress-color: transparent;--app-progress-success-color: #22c55e}@keyframes _ngcontent-%COMP%_progressSuccess{0%{width:100%!important;background:var(--app-progress-success-color)}50%{opacity:1;background:var(--app-progress-success-color)}to{opacity:0}}.progress[_ngcontent-%COMP%]{border-radius:0 1px 1px 0;display:flex;align-items:center;width:100%}.progress__bar[_ngcontent-%COMP%]{background:var(--app-progress-color);height:100%;width:0}.progress__bar--complete[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressSuccess 2s linear forwards}.progress--small[_ngcontent-%COMP%]{height:4px}.progress--medium[_ngcontent-%COMP%]{height:8px}.progress--large[_ngcontent-%COMP%]{height:12px}.progress--light[_ngcontent-%COMP%]{--app-progress-color: #ffffff}.progress--dark[_ngcontent-%COMP%]{--app-progress-color: #de3535}"],changeDetection:0})}return n})(),RT=(()=>{class n{constructor(t,o){this.store=t,this.changeDetectorRef=o,this.ngUnsubscribe=new k.B,this.storyLoadProgress=0}ngOnInit(){const t=this.store.select(Ai.getChaptersLoadProgress),o=this.store.select(dt.getLoadingChapter);(0,cn.z)(t,o).pipe((0,D.p)(()=>{const s=this.store.selectSnapshot(dt.getLoadChapters);return!(0,u.isNil)(s)&&s.length>0}),(0,p.Q)(this.ngUnsubscribe)).subscribe(([s,a])=>{const r=this.store.selectSnapshot(me.N.getSelectedChapterId),_=!(0,u.isNil)(a)&&a.chapterId===r;this.storyLoadProgress=_?s[r]??0:1,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-progress"]],decls:1,vars:3,consts:[["data-test","engineProgress",1,"engine-progress",3,"value","total"]],template:function(o,s){1&o&&e.nrm(0,"app-progress",0),2&o&&(e.Y8G("value",s.storyLoadProgress)("total",1),e.BMQ("data-progress",s.storyLoadProgress))},dependencies:[Lm],styles:[".engine-progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;z-index:2;pointer-events:none}"],changeDetection:0})}return n})();var xe=d(49969);function NT(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",1),e.bIt("@show.done",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.onShowDone())}),e.j41(1,"div",2),e.EFF(2,"Use control + scroll to zoom"),e.k0s()()}2&n&&e.Y8G("@show",void 0)}let kT=(()=>{class n{constructor(t,o){this.actions=t,this.changeDetectorRef=o,this.ngUnsubscribe=new k.B,this.show=!1}ngOnInit(){this.actions.pipe((0,l.xi)(st.JK),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.show=!0,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onShowDone(){this.show=!1}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.En),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-scroll"]],decls:1,vars:1,consts:[["class","engine-scroll","data-test","engineScroll",4,"ngIf"],["data-test","engineScroll",1,"engine-scroll"],[1,"engine-scroll__label"]],template:function(o,s){1&o&&e.DNE(0,NT,3,1,"div",0),2&o&&e.Y8G("ngIf",s.show)},dependencies:[J.bT],styles:[".engine-scroll[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;inset:0;z-index:10000;opacity:0;pointer-events:none}.engine-scroll__label[_ngcontent-%COMP%]{background:#10182380;font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;padding:24px 32px;border-radius:40px}"],data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",[(0,xe.K2)([(0,xe.iF)({opacity:"*"}),(0,xe.i0)("500ms ease-in-out",(0,xe.iF)({opacity:1})),(0,xe.i0)("500ms 2000ms ease-in-out",(0,xe.iF)({opacity:0}))])])])]},changeDetection:0})}return n})();const DT=(n,i)=>({backgroundColor:n,duration:i}),LT=(n,i)=>({value:n,params:i}),UT=(0,xe.lY)([(0,xe.iF)({opacity:"0",backgroundColor:"*"}),(0,xe.K2)([(0,xe.i0)("{{ duration }}ms {{ easing }}",(0,xe.iF)({opacity:1,backgroundColor:"{{ backgroundColor }}"})),(0,xe.i0)("250ms 500ms ease-in",(0,xe.iF)({opacity:0}))])],{params:{duration:2e3,backgroundColor:"#ffffff",easing:"ease-out"}});let xT=(()=>{class n{constructor(t,o,s){this.actions=t,this.changeDetectorRef=o,this.store=s,this.color="#FFFFFF",this.duration=2e3,this.isVisible=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.initFadeListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFadeListener(){this.actions.pipe((0,l.xi)(st.zW),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.fadeIn(t.color,t.duration)})}handleFadeComplete(){this.store.dispatch(new st.In),this.isVisible=!1,this.changeDetectorRef.markForCheck()}fadeIn(t,o){this.isVisible=!0,this.color=t,this.duration=1e3*o,this.changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.En),e.rXU(e.gRc),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-fade"]],decls:1,vars:7,consts:[[1,"engine-fade"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.bIt("@fade.done",function(){return s.handleFadeComplete()}),e.k0s()),2&o&&e.Y8G("@fade",e.l_i(4,LT,s.isVisible,e.l_i(1,DT,s.color,s.duration)))},styles:[".engine-fade{pointer-events:none;display:block;position:absolute;inset:0;z-index:10000}\n"],encapsulation:2,data:{animation:[(0,xe.hZ)("fade",[(0,xe.kY)("* => true",(0,xe.sM)(UT))])]},changeDetection:0})}return n})(),jT=(()=>{class n{constructor(t,o,s,a){this.engineService=t,this.cameraService=o,this.numberService=s,this.changeDetectionRef=a,this.camera={x:0,y:0,z:0,zoom:0,dist:0}}ngOnInit(){this.initCameraListener()}initCameraListener(){this.engineService.getEvent(Ct.X.CameraUpdated).pipe((0,Ho.Z)(50)).subscribe(t=>{const o=this.numberService.roundModel(t.eye,0),{x:s,y:a,z:r}=o,_=Math.floor(100*this.cameraService.getCameraZoom()),g=this.numberService.roundNumber(t.dist,0);this.camera={x:s,y:a,z:r,zoom:_,dist:g},this.changeDetectionRef.markForCheck()})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(v.y),e.rXU(go.j),e.rXU(xg.D),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-camera-position"]],decls:2,vars:5,consts:[[1,"engine-camera-position"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.EFF(1),e.k0s()),2&o&&(e.R7$(),e.SjE(" X:",null==s.camera?null:s.camera.x," Y:",null==s.camera?null:s.camera.y," Z:",null==s.camera?null:s.camera.z," Dist:",null==s.camera?null:s.camera.dist," Zoom:",null==s.camera?null:s.camera.zoom,"\n"))},styles:[".engine-camera-position[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;text-shadow:0 0 2px rgba(0,0,0,.8);z-index:10}"],changeDetection:0})}return n})();var Um=d(44120);let VT=(()=>{class n{constructor(t){this.store=t}ngAfterViewInit(){this.nodeActionsComponent.nodeActionsTrigger().openMenu()}onNodeActionsClosed(){this.store.dispatch(new st.fZ(null,null))}getNodeActionsStyles(){const t=this.hit?.canvasPos;return{"left.px":t?.x??0,"top.px":t?.y??0}}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-contextmenu"]],viewQuery:function(o,s){if(1&o&&e.GBs(Um.D,7),2&o){let a;e.mGM(a=e.lsd())&&(s.nodeActionsComponent=a.first)}},inputs:{node:"node",hit:"hit"},decls:2,vars:2,consts:[[1,"contextmenu"],["eventCategory","Context Node","theme","light",1,"contextmenu__node-actions",3,"nodeActionsClosed","ngStyle","node"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"app-node-actions",1),e.bIt("nodeActionsClosed",function(){return s.onNodeActionsClosed()}),e.k0s()()),2&o&&(e.R7$(),e.Y8G("ngStyle",s.getNodeActionsStyles())("node",s.node))},dependencies:[J.B3,Um.D],styles:[".contextmenu[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block;z-index:2}.contextmenu__node-actions[_ngcontent-%COMP%]{position:absolute}"]})}return n})();var Gn=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},$n=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const FT=["engine"],GT=n=>({"engine--hidden":n});function $T(n,i){1&n&&e.nrm(0,"div",2)}function BT(n,i){1&n&&e.nrm(0,"app-labels")}function zT(n,i){if(1&n&&e.nrm(0,"app-engine-contextmenu",3),2&n){const t=e.XpG();e.Y8G("node",t.contextMenuNode)("hit",t.contextMenuHit)}}function WT(n,i){1&n&&e.nrm(0,"div",4)}function XT(n,i){1&n&&e.nrm(0,"app-engine-progress",5)}function HT(n,i){if(1&n&&(e.j41(0,"div",6),e.nrm(1,"app-engine-stats",7),e.nI1(2,"async"),e.k0s()),2&n){const t=e.XpG(),o=e.sdS(1);e.Y8G("cdkDragBoundary",o),e.R7$(),e.Y8G("theme",t.isBackgroundLight?"light":"dark")("showAdvancedTools",e.bMT(2,3,t.showAdvancedTools$))}}function QT(n,i){1&n&&e.nrm(0,"app-engine-camera-position")}var Bs=function(n){return n[n.Pan=.4]="Pan",n[n.PanSlow=.04]="PanSlow",n[n.Zoom=5]="Zoom",n[n.ZoomSlow=1]="ZoomSlow",n[n.Rotate=.3]="Rotate",n[n.RotateSlow=.03]="RotateSlow",n}(Bs||{}),qo=function(n){return n[n.Rotate=6]="Rotate",n[n.Pan=1.75]="Pan",n[n.Zoom=2.5]="Zoom",n}(qo||{}),si=function(n){return n[n.Zoom=-6]="Zoom",n[n.TrackZoom=.5]="TrackZoom",n[n.Pan=1.25]="Pan",n[n.Rotate=1.5]="Rotate",n[n.Friction=.85]="Friction",n[n.ZoomFriction=.85]="ZoomFriction",n[n.FrictionThreshold=.002]="FrictionThreshold",n}(si||{}),_s=function(n){return n.Fade="engine--cursor-fade",n.Hide="engine--cursor-hide",n.Label="engine--cursor-label",n.Paint="engine--cursor-paint",n.Eyedropper="engine--cursor-eyedropper",n.Crosshair="engine--cursor-crosshair",n.Default="",n}(_s||{}),xm=function(n){return n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.LeftAndRight=4]="LeftAndRight",n}(xm||{});const jm=1e3/60;class An{wheel(i){const t=this.store.selectSnapshot(ze.S.getScrollMode),o=i.ctrlKey;t===Wo.M.DoNotCaptureShowMessage&&!o&&this.store.dispatch(new st.JK(!0)),(t===Wo.M.Capture||o)&&(i.preventDefault(),this.handleWheel(i))}onContextMenu(i){this.contextMenuEnable()&&this.handleContextMenu(i)}onMouseOut(){this.handleMouseOut()}onDocumentClick(i){const t=i.target,o=document.getElementById("container");this.hasFocus=o.contains(t)}constructor(i,t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it){this.actions=i,this.activatedRoute=t,this.animationService=o,this.cameraService=s,this.changeDetecton=a,this.engineService=r,this.xrService=_,this.sceneService=g,this.mediaService=P,this.paintService=F,this.renderer=ee,this.storageService=le,this.store=he,this.applicationEventService=ue,this.particleSystemsService=ye,this.engineRendererService=Ge,this.clippingPlanesService=Ve,this.liveAnnouncer=it,this.VERSION=A.VERSION,this.hasFocus=!1,this.flyCamera=!0,this.visible=!1,this.application=xn.c,this.cursorClass=_s.Default,this.chapterReady=!1,this.ngUnsubscribe=new k.B,this.display=!1,this.engineVisible=!0,this.inputEnabled=(0,e.hFB)(!0),this.contextMenuEnable=(0,e.hFB)(!0),this.background=new Li.t(null),this.scrollType=null,this.scrollTimeout=null,this.pinchTicks=0,this.progress="0",this.deltaTime=window.performance.now(),this.pinchMode="",this.cameraAnimating=!1,z.c.application===xn.c.Loft&&d.e(361).then(d.t.bind(d,5361,23)).then(_t=>{window.pako=_t}),this.showDebug=z.c.application===xn.c.Loft||"true"===this.storageService.getLocalItem(It.UT.CameraDebug),z.c.deploy===pi.Z.Production&&(z.c.application===xn.c.Studio||z.c.application===xn.c.Viewer)||console.table({Commit:A.COMMIT,Time:new Date(A.TIMESTAMP).toLocaleString(),Version:A.VERSION})}convertToLeafStateMap(i,t){const o={};return Object.entries(t).forEach(([s,a])=>{o[s]={},o[s][i]=a}),o}ngOnInit(){this.particleStateListener=new Bv(this.store,this.particleSystemsService),this.bindEngineEvents(),this.bindApplicationEvents(),this.bindChapterChangeEvents(),this.bindCameraEvents(),this.bindToolEvents(),this.bindMouseEvents(),this.bindKeyEvents(),this.initChangeListener(),this.initVideo(),this.initBackgroundListener(),this.initPlaybackSpeedListener(),this.initEngine(),this.bindHumanInteractions()}ngOnDestroy(){this.hammerManager&&(this.hammerManager.destroy(),this.hammerManager=null),this.particleStateListener.destroy(),this.engineService.destroyEngine(),this.animationService.destroyPlayer(),this.xrService.destroyXR(),this.canvas?.remove(),this.canvas=null,this.changeDetecton.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEngine(){const i=this.store.selectSnapshot(ze.S.getWebGLContextName),t=this.activatedRoute.snapshot.queryParams.disableTextureCompression,o="true"===t||t?.split(",").reduce((s,a)=>({...s,[a.trim().toLowerCase()]:!0}),{});this.engineService.initEngine({contextName:i,disableTextureCompression:o}),this.canvas=this.engineRendererService.getCanvas(),this.canvas.style.zIndex="1",this.canvas.dataset.test="engineCanvas",this.engineElement.nativeElement.prepend(this.canvas),this.xrEnabled$.pipe((0,D.p)(s=>s),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.xrService.initXR(this.engineService.engine)})}bindEngineEvents(){this.engineService.getEvent(Ct.X.Loaded).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new st.AU(!0))}),this.engineService.getEvent(Ct.X.TimelineChapterTransition).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applicationEventService.fireEvent(rt.F.LabelsChapterInfo,this.store.selectSnapshot(et.getChapterLabels))}),(0,ki.h)(this.engineService.getEvent(Ct.X.TimelinePlayed),this.engineService.getEvent(Ct.X.TimelinePaused)).pipe((0,p.Q)(this.ngUnsubscribe),(0,D.p)(()=>null!=this.store.selectSnapshot(me.N.getSelectedChapterId)),(0,wn.B)(50),(0,W.T)(()=>this.animationService.isPlaying())).subscribe(i=>{this.store.dispatch(new st.jM(i))}),this.engineService.getEvent(Ct.X.Tick).pipe((0,D.p)(()=>this.visible&&!(0,u.isNil)(this.engineService.engine?.story)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.inputEnabled()&&this.handleMouseInputEngineTick(i),this.handleCameraTick(i),this.deltaTime=window.performance.now()}),this.engineService.getEvent(Ct.X.TweenVisibilityUpdate).pipe((0,va.E)(this.store.select(me.N.getIsChapterAnimated),this.store.select(me.N.getSelectedChapterModelReady)),(0,D.p)(([i,t,o])=>t&&o&&Object.keys(i).length>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const t=[],o=[];Object.entries(i).forEach(([s,a])=>{a?t.push(s):o.push(s)}),t.length>0&&this.store.dispatch(new Vt.LV(!0,t)),o.length>0&&this.store.dispatch(new Vt.LV(!1,o)),this.applyShownPatches(i,!1)}),this.engineService.getEvent(Ct.X.VariantsUpdate).pipe((0,D.p)(i=>Object.keys(i).length>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applyVariantPatches(i,!0,!1,!1)}),this.engineService.getEvent(Ct.X.SceneObjectRenderable).pipe((0,Gv.w)(1e3),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{if(i.length){const t={};i.forEach(o=>{t[o.objectId]={renderable:!0}}),this.store.dispatch(new st.GT(t))}}),this.engineService.getEvent(Ct.X.AssetsLoadProgress).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({chapterId:i,chapterProgress:t})=>{const o=this.store.selectSnapshot(dt.getLoadChapters).length,r=1/o,P=t*r+(o-Math.max(this.store.selectSnapshot(dt.getLoadChaptersRemaining).length,1))*r;this.progress=P.toFixed(2),this.changeDetecton.markForCheck(),this.store.dispatch(new Xd(P,i,t))}),this.engineService.getEvent(Ct.X.CameraUpdated).pipe((0,D.p)(()=>!this.cameraAnimating),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!0,this.changeDetecton.markForCheck()}),this.engineService.getEvent(Ct.X.CameraRested).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.cameraAnimating=!1,this.changeDetecton.markForCheck()})}bindApplicationEvents(){this.actions.pipe((0,l.xi)(ct.dC),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterReady=!0}),this.enginePosition$.pipe((0,D.p)(i=>null!=i),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.enginePosition=i,this.repositionEngine(i)}),this.store.select(ze.S.getXrayModeEnabled).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(Rn.z.getCheckedNodes),o=this.store.selectSnapshot(Rn.z.getNodes),s=this.store.selectSnapshot(ze.S.getViewGraph);!1===i?(Object.keys(o||[]).forEach(a=>{this.paintService.paint(s,a,o[a].paint)}),t.forEach(a=>this.paintService.highlight(s,a.objectId,!0))):(this.paintService.paintAll(s,Object.keys(o),Ms.EC),this.paintService.paintAll(s,t.map(a=>a.objectId),Ms.NR))}),this.actions.pipe((0,l.xi)(st.K6),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.playChapterFromStart()}),this.engineDisplay$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.display=i,this.changeDetecton.markForCheck()}),this.engineVisible$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.engineVisible=i,this.changeDetecton.markForCheck()}),this.contextMenu$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.contextMenuNode=i.node,this.contextMenuHit=i.hit,this.changeDetecton.markForCheck()})}bindChapterChangeEvents(){this.selectedChapter$.pipe((0,D.p)(i=>!(0,u.isNil)(i)),(0,ks.J)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const o=this.store.selectSnapshot(ze.S.getChapter);if(this.store.selectSnapshot(me.N.getSelectedChapterReadyState).model){const r=t.id;if(i.id===r&&o===r)return;this.animationService.setChapter(r).then(()=>{this.store.dispatch(new Vt.IA(r)),yp(this.store,this.engineService),this.store.dispatch(new Ut.Yp(void 0))})}}),(0,cn.z)([this.clippingPlanes$,this.readyState$]).pipe((0,D.p)(([i,t])=>!(0,u.isNil)(i)&&!0===t?.model),(0,Tn.F)(u.isEqual),(0,wn.B)(0),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{this.clippingPlanesService.setClippingPlanes(i)}),(0,cn.z)([this.selectedChapterId$,this.readyState$,this.autoplay$,this.prefersReducedMotion$]).pipe((0,D.p)(([i,t,o,s])=>!((0,u.isNil)(i)||(0,u.isNil)(t)||(0,u.isNil)(o)||(0,u.isNil)(s))),(0,p.Q)(this.ngUnsubscribe)).subscribe(([,i,t,o])=>{const s=(0,u.get)(i,"animation",!1),a=this.store.selectSnapshot(me.N.getSelectedChapter),r=(0,u.get)(a,"ui.play.autoplay",!0),_=s&&t&&r&&!o;this.store.dispatch(new st.A6),this.store.dispatch(new st.dE(_))})}bindCameraEvents(){this.actions.pipe((0,l.xi)(Ut.Ih,st.W6),(0,D.p)(i=>!!(i instanceof Ut.Ih?i.camera:i.objectId)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=!this.store.selectSnapshot(ls.U.getPrefersReducedMotion)&&i.animate;let o;o=i instanceof Ut.Ih?t?this.flyToCamera(i.camera,i.animationDuration):this.jumpToCamera(i.camera):t?this.flyToObject(i.objectId,i.animationDuration):this.jumpToObject(i.objectId),o.then(()=>{this.liveAnnouncer.announce("Camera Postion Updated"),this.store.dispatch(new Ut.Nz),i instanceof Ut.Ih&&i.rotationCenter&&this.cameraService.setCameraRotationCenter(i.rotationCenter)})}),this.actions.pipe((0,l.xi)(Ut.bB),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.cameraService.panCameraStatic(i.x,i.y,i.z)}),this.actions.pipe((0,l.xi)(Ut.RJ),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.cameraService.rotateCameraStatic(i.x,i.y)}),this.actions.pipe((0,l.xi)(Ut.F5),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.cameraService.setAbsoluteZoom(i.value)})}bindToolEvents(){this.activeTool$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{switch(Object.values(_s).forEach(t=>{t&&this.renderer.removeClass(this.engineElement.nativeElement,t)}),i){case dn.s.Fade:this.renderer.addClass(this.engineElement.nativeElement,_s.Fade);break;case dn.s.Hide:this.renderer.addClass(this.engineElement.nativeElement,_s.Hide);break;case dn.s.Label:this.renderer.addClass(this.engineElement.nativeElement,_s.Label);break;case dn.s.Paint:this.renderer.addClass(this.engineElement.nativeElement,_s.Paint);break;case dn.s.Eyedropper:this.renderer.addClass(this.engineElement.nativeElement,_s.Eyedropper)}})}bindMouseEvents(){this.mouseMove$=(0,Sn.R)(this.engineElement.nativeElement,"mousemove"),this.mouseMove$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleMousePan(i)}),this.mouseMove$.pipe((0,va.E)(this.store.select(ze.S.getHoverPickEnabled)),(0,pm.c)(10),(0,D.p)(([,i])=>i),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{this.handleMouseHover(i)}),this.mouseLeave$=(0,Sn.R)(this.engineElement.nativeElement,"mouseleave"),this.mouseLeave$.pipe((0,pm.c)(10),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleMouseLeave()})}bindWindowKeyEvent(i){return(0,Sn.R)(window,i).pipe((0,D.p)(()=>this.hasFocus))}bindKeyEvents(){const i=["w","a","s","d","e","c","=","-","+","_","arrowleft","arrowright","arrowup","arrowdown","shiftKey"].reduce((s,a)=>(s[a]=!1,s),{}),t=new Li.t(i);let o;this.bindWindowKeyEvent("keydown").pipe((0,D.p)(s=>!(s.repeat||s.metaKey||s.ctrlKey)),(0,D.p)(s=>{const r=s.target.nodeName.toLowerCase();return!(["input","textarea","select","option","button"].indexOf(r)>=0)}),(0,p.Q)(this.ngUnsubscribe)).subscribe(s=>{t.next({...t.value,[s.key.toLowerCase()]:!0,shiftKey:s.shiftKey,hasMomentum:!1})}),this.bindWindowKeyEvent("keyup").pipe((0,D.p)(s=>!!s.key),(0,p.Q)(this.ngUnsubscribe)).subscribe(s=>{1===Object.values(o).filter(r=>!0===r).length?(this.applyMotion(o,!0),t.next({...t.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1===o.shiftKey})):t.next({...t.value,[s.key.toLowerCase()]:!1,shiftKey:s.shiftKey,hasMomentum:!1})}),t.pipe((0,D.p)(()=>this.inputEnabled()),(0,p.Q)(this.ngUnsubscribe)).subscribe(s=>{o=s,!1===s.hasMomentum&&this.applyMotion(s,!1)})}applyMotion(i,t){const o=new $v.x,s=i.shiftKey?Bs.ZoomSlow:Bs.Zoom,a=i.shiftKey?Bs.PanSlow:Bs.Pan,r=i.shiftKey?Bs.RotateSlow:Bs.Rotate;o.zoom+=i.c||i["-"]||i._?s:0,o.zoom-=i.e||i["="]||i["+"]?s:0,o.panX-=i.d?a:0,o.panX+=i.a?a:0,o.panY+=i.w?a:0,o.panY-=i.s?a:0,o.rotateX-=i.arrowright?r:0,o.rotateX+=i.arrowleft?r:0,o.rotateY+=i.arrowup?r:0,o.rotateY-=i.arrowdown?r:0,o.applyFriction=t,this.store.dispatch(new Ut.P4(o))}initChangeListener(){this.nodeStatePatches$.pipe((0,D.p)(i=>i.length>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.reduce((F,ee)=>{const le=ee.path[ee.path.length-1];return void 0!==F[le]&&F[le].push(ee),F},{available:[],shown:[],checked:[],paint:[],pickable:[],variant:[]}),o=F=>t[F].reduce((ee,le)=>(ee[le.path[2]]=le.value,ee),{}),s=o("available"),a=o("checked"),r=o("shown"),_=o("paint"),g=o("pickable"),P=o("variant");(0,u.isEmpty)(s)||this.applyAvailablePatches(s),(0,u.isEmpty)(r)||this.applyShownPatches(r,!0),(0,u.isEmpty)(a)||this.applyCheckedPatches(a),(0,u.isEmpty)(_)||this.applyPaintPatches(_),(0,u.isEmpty)(g)||this.applyPickablePatches(g),(0,u.isEmpty)(P)||this.applyVariantPatches(P,!1,!0,!0)})}initBackgroundListener(){(0,cn.z)([this.background$,this.engineDisplay$,this.engineVisible$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o])=>{this.renderer.setStyle(this.engineElement.nativeElement,"background-image",(0,Ds.tH)(i)),this.isBackgroundCheckered(i)?this.renderer.addClass(this.engineElement.nativeElement,"engine--checkered"):this.renderer.removeClass(this.engineElement.nativeElement,"engine--checkered"),this.renderer.setStyle(this.engineElement.nativeElement,"display",t?"block":"none"),this.renderer.setStyle(this.engineElement.nativeElement,"opacity",o?1:0)}),this.background$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.isBackgroundLight=(0,Ds.T4)(i),this.changeDetecton.markForCheck()})}initPlaybackSpeedListener(){this.store.select(ze.S.getPlaybackSpeed).pipe((0,D.p)(()=>this.store.selectSnapshot(me.N.getSelectedChapterAnimationReady)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.animationService.setPlaybackRate(i)})}repositionEngine(i){const t=this.engineElement.nativeElement,{top:o,left:s,width:a,height:r,visibility:_,scale:g,viewportWidth:P,viewportHeight:F}=i;this.renderer.setStyle(t,"left",`${s}px`),this.renderer.setStyle(t,"top",`${o}px`),this.renderer.setStyle(t,"width",`${a}px`),this.renderer.setStyle(t,"height",`${r}px`),this.renderer.setStyle(t,"transform",`scale(${g})`),this.renderer.setStyle(t,"zIndex",`${_}`),this.renderer.setStyle(t,"visibility",_===hp.g.Shown?"visible":"hidden"),P!==a||F!==r||1!==g?this.renderer.addClass(t,"engine--scaled"):this.renderer.removeClass(t,"engine--scaled");const ee=Math.max(1,Math.floor(1/g));t?.style?.setProperty("--engine-border-width",`${ee}px`),this.visible=_===hp.g.Shown,this.engineService.fireEvent(Ct.X.CanvasResized)}bindHumanInteractions(){this.hammerManager=new ei.Manager(this.engineRendererService.getCanvas()),this.hammerManager.add(new ei.Tap({event:"doubletap",taps:2,posThreshold:50})),this.hammerManager.add(new ei.Tap({event:"singletap"})),this.hammerManager.add(new ei.Pan({event:"pan",pointers:0})),this.hammerManager.add(new ei.Pinch({event:"pinch"})),this.hammerManager.add(new ei.Press({time:500})),this.hammerManager.on("singletap",o=>{this.store.selectSnapshot(ze.S.getClickPickEnabled)&&this.handleTap(o)}),this.hammerManager.on("doubletap",o=>{this.handleDoubleTap(o)}),this.hammerManager.on("press",o=>{o.preventDefault(),o.srcEvent.stopImmediatePropagation(),this.handlePress(o)}),this.hammerManager.on("pan",o=>{o.preventDefault(),this.handlePan(o)}),this.hammerManager.on("panend",o=>{this.handlePanEnd(o)}),this.hammerManager.on("pinchend",o=>{this.handlePinchEnd(o)});let i=0,t=0;this.hammerManager.on("pinchstart",o=>{i=o.scale,this.pinchMode=""}),this.hammerManager.on("pinchmove",o=>{if(this.pinchTicks>0)return;const s=Math.abs(o.deltaX)>60||Math.abs(o.deltaY)>60,a=o.scale>1.25||o.scale<.75;this.pinchMode?("pan"===this.pinchMode&&a&&!s&&(this.pinchMode="pinch"),"pinch"===this.pinchMode&&s&&!a&&(this.pinchMode="pan")):this.pinchMode=a?"pinch":"pan";const r=o.scale-i;i=o.scale;const _=t;t=0===r?0:r>0?1:-1,this.cameraService.setCameraPan(o.velocityX*si.Pan,o.velocityY*si.Pan),t+_!==0&&this.cameraService.setRelativeZoom(r*si.Zoom)})}handleMouseHover(i){if(i.buttons!==xm.None)return;const{offsetX:t,offsetY:o}=i,s=this.pickAtCanvasPosition(t,o,!1);if(s.objectId){const a=this.store.selectSnapshot(ze.S.getViewGraph),r=this.sceneService.getViewNode(a,s.objectId),_=this.store.selectSnapshot(ze.S.getHoveredNode);(!_||_.id!==r.id)&&this.store.dispatch(new st.DZ(r,s))}else null!=this.store.selectSnapshot(ze.S.getHoveredNode)&&this.store.dispatch(new st.DZ(null))}handleMouseLeave(){this.store.dispatch(new st.DZ(null))}handleMousePan(i){if(2===i.buttons||4===i.buttons){let{movementX:t,movementY:o}=i;t/=16,o/=16,this.cameraService.setCameraPan(t,o)}}handleMouseOut(){this.store.dispatch(new st.DZ(null))}handleWheel(i){let t=0;0===i.deltaMode?(null===this.scrollType&&(this.scrollType=Math.abs(i.deltaY)<10?"trackpad":"wheel"),t="trackpad"===this.scrollType?i.deltaY*si.TrackZoom:Math.sign(i.deltaY)*qo.Zoom):(this.scrollType="wheel",t=i.deltaY*qo.Zoom),clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollType=null},500),Math.abs(t)>40&&(t=40*Math.sign(t)),"trackpad"===this.scrollType?this.cameraService.setCameraZoom(t):this.zoomWithVelocity(t)}zoomWithVelocity(i){this.cameraService.setCameraZoom(i),requestAnimationFrame(()=>{i*=.85,Math.abs(i)>1&&this.zoomWithVelocity(i)})}handleContextMenu(i){i.preventDefault();const{offsetX:t,offsetY:o}=i,s=this.pickAtCanvasPosition(t,o),a=this.getNodeFromHit(s);this.store.dispatch(new st.fZ(a,s))}handlePanEnd(i){const t=this.store.selectSnapshot(Ti.x.getCameraMotion);if(this.pinchTicks>0||t.panX===i.velocityX&&t.panY===i.velocityY)return;const o=this.store.selectSnapshot(Ti.x.getPanMode);i.srcEvent.shiftKey||"pan"===o?(t.panX=i.velocityX*si.Pan,t.panY=i.velocityY*si.Pan):(t.rotateX=i.velocityX*si.Rotate,t.rotateY=i.velocityY*si.Rotate),t.applyFriction=!0,this.store.dispatch(new Ut.P4(t))}handlePinchEnd(i){const t=this.store.selectSnapshot(Ti.x.getCameraMotion);if("pan"===this.pinchMode)t.panX=i.velocityX*si.Pan,t.panY=i.velocityY*si.Pan;else{const o=i.velocity>0?1:-1;t.zoom=Math.sqrt(i.velocityX*i.velocityX+i.velocityY*i.velocityY)*-o*si.Zoom}t.applyFriction=!0,this.store.dispatch(new Ut.P4(t)),this.pinchTicks=10}handleTap(i){const{offsetX:t,offsetY:o}=this.getOffset(i),s=this.pickAtCanvasPosition(t,o),a=this.getNodeFromHit(s);this.store.dispatch(new st.zE(a,i,s))}handleDoubleTap(i){const{offsetX:t,offsetY:o}=this.getOffset(i),s=this.pickAtCanvasPosition(t,o),a=this.getNodeFromHit(s);a&&this.store.dispatch(new st.W6(a.id))}handlePress(i){const{offsetX:t,offsetY:o}=this.getOffset(i),s=this.pickAtCanvasPosition(t,o),a=this.getNodeFromHit(s);a&&this.store.dispatch(new st.W6(a.id))}handlePan(i){if(this.pinchTicks>0)return;const t=this.store.selectSnapshot(Ti.x.getPanMode),{velocityX:o,velocityY:s}=i;i.srcEvent.shiftKey||"pan"===t?this.cameraService.setCameraPan(o*si.Pan,s*si.Pan):this.cameraService.setCameraRotation(o*si.Rotate,s*si.Rotate)}handleMouseInputEngineTick(i){const t=this.cameraService.tickCameraRotation(),o=this.cameraService.tickCameraPan(),s=this.cameraService.tickCameraZoom(),a=Math.min(15,(window.performance.now()-this.deltaTime)/jm);if((t.vx||t.vy)&&this.cameraService.rotateCameraStatic(0!==t.vx?a*t.vx*qo.Rotate:0,0!==t.vy?a*t.vy*qo.Rotate:0),o.x||o.y){const r=this.cameraService.getLookDistance(),_=Math.max(r/80,.01);this.cameraService.panCameraStatic(a*o.x*_*qo.Pan,a*o.y*_*qo.Pan,a*o.z*_*qo.Pan)}0!==s&&this.cameraService.setRelativeZoom(a*s*qo.Zoom)}handleCameraTick(i){this.pinchTicks>0&&this.pinchTicks--,this.applyFriction();const t=this.store.selectSnapshot(Ti.x.getCameraMotion);this.cameraService.setCameraPan(t.panX,t.panY),this.cameraService.setCameraRotation(t.rotateX,t.rotateY),this.cameraService.setCameraZoom(t.zoom),this.cameraService.tickCamera(i)}applyCheckedPatches(i){this.engineService.fireEvent(Ct.X.SceneObjectsSelected,{selectedObjectsUpdate:i});const t=this.store.selectSnapshot(ze.S.getViewGraph),o=this.store.selectSnapshot(ze.S.getXrayModeEnabled);Object.entries(i).forEach(([s,a])=>{o?this.paintService.paint(t,s,!0===a?Ms.NR:Ms.EC):this.paintService.highlight(t,s,a)})}applyShownPatches(i,t){const o=Object.keys(i),s=this.sceneService.getObjectsById(o),a=o.reduce((P,F)=>(this.sceneService.isLeaf(s[F])&&(P[F]=i[F]),P),{});this.engineService.fireEvent(Ct.X.SceneObjectsShown,{enabledObjectsUpdate:a});const r=this.store.selectSnapshot(Rn.z.getNodes),_=Object.values(r).reduce((P,F)=>(P[F.objectId]=F.shown,P),{});t&&this.sceneService.setNodesVisible(_);const g=this.convertToLeafStateMap("shown",_);this.store.dispatch(new st.A0(g,r))}applyPaintPatches(i){Object.entries(i).forEach(([t,o])=>{this.paintService.colorObject(t,(0,br.Sf)(o))})}applyPickablePatches(i){const t=this.store.selectSnapshot(Rn.z.getNodes),o=Object.values(t).reduce((s,a)=>(s[a.objectId]=a.pickable,s),{});this.sceneService.setNodesProperty(o,"pickable"),this.store.dispatch(new st.$V(this.convertToLeafStateMap("pickable",o),t))}applyAvailablePatches(i){const t=this.store.selectSnapshot(Rn.z.getNodes),o=this.convertToLeafStateMap("available",i);this.store.dispatch(new st.Rc(o,t))}applyVariantPatches(i,t,o,s){if(t&&this.store.dispatch(new Vt._n(i,s)),o){const{anatomyObjects:a}=this.sceneService.getAnatomySceneGraph();Object.entries(i).forEach(([r,_])=>{this.sceneService.setObjectVariant(a,r,_)})}}getFriction(i){if(0===i)return 0;const t=(window.performance.now()-this.deltaTime)/jm;let s=i*Math.max(0,si.Friction+.1*(1-t));return Math.abs(s)<si.FrictionThreshold&&(s=0),s}applyFriction(){const i=this.store.selectSnapshot(Ti.x.getCameraMotion);!0===i.applyFriction&&(i.rotateX=this.getFriction(i.rotateX),i.rotateY=this.getFriction(i.rotateY),i.panX=this.getFriction(i.panX),i.panY=this.getFriction(i.panY),i.zoom=this.getFriction(i.zoom),0===i.rotateX&&0===i.rotateY&&0===i.panX&&0===i.panY&&0===i.zoom&&(i.applyFriction=!1),this.store.dispatch(new Ut.P4(i)))}flyToObject(i,t){return this.cameraService.flyToObject(i,t)}flyToCamera(i,t){return this.cameraService.flyToCamera(i,t)}jumpToObject(i){return this.cameraService.jumpToObject(i)}jumpToCamera(i){return this.cameraService.jumpToCamera(i)}getNodeFromHit(i){let t;if(i.objectId){const o=this.store.selectSnapshot(ze.S.getViewGraph);t=this.sceneService.getViewNode(o,i.objectId)}return t}pickAtCanvasPosition(i,t,o=!0){const s=this.enginePosition?.scale??1;if(1!==s){const a=1/s,r=A.vec3Pool.get();[i,t]=wi.scale(r,[i,t,0],a),A.vec3Pool.release(r)}return this.engineRendererService.pick(i,t,o)}getOffset(i){let t=0,o=0;i.center?(t=i.center.x,o=i.center.y):(t=i.clientX,o=i.clientY);const a=this.engineElement.nativeElement.getBoundingClientRect();return{offsetX:t-a.left,offsetY:o-a.top}}isTransparentBackground(i){return!!i&&(0,Ds.ty)(this.background.getValue())}isBackgroundCheckered(i){return z.c.application!==xn.c.Viewer&&this.isTransparentBackground(i)}playChapterFromStart(){this.store.selectSnapshot(me.N.getSelectedChapterReadyState).animation&&(this.store.dispatch(new st.A6),this.store.dispatch(new st.dE(!0)))}initVideo(){this.mediaService.getVideoEvents().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const{id:t,event:o}=i;"play"===o&&this.store.dispatch(new Zl(t)),this.store.selectSnapshot(Ea.getCurrentVideo)===t&&("pause"===o||"ended"===o)&&this.store.dispatch(new Zl(null))})}static#e=this.\u0275fac=function(t){return new(t||An)(e.rXU(l.En),e.rXU(K.nX),e.rXU(co.O),e.rXU(go.j),e.rXU(e.gRc),e.rXU(v.y),e.rXU(mm.S),e.rXU(Fi.w),e.rXU(vi),e.rXU(ir.s),e.rXU(e.sFG),e.rXU(It.n$),e.rXU(l.il),e.rXU(Po.S),e.rXU(tE),e.rXU(Er.z),e.rXU(ah),e.rXU(mo.Ai))};static#t=this.\u0275cmp=e.VBU({type:An,selectors:[["app-engine"]],viewQuery:function(t,o){if(1&t&&e.GBs(FT,7),2&t){let s;e.mGM(s=e.lsd())&&(o.engineElement=s.first)}},hostBindings:function(t,o){1&t&&e.bIt("wheel",function(a){return o.wheel(a)})("contextmenu",function(a){return o.onContextMenu(a)})("mouseout",function(a){return o.onMouseOut(a)})("click",function(a){return o.onDocumentClick(a)},!1,e.EBC)},inputs:{inputEnabled:[1,"inputEnabled"],contextMenuEnable:[1,"contextMenuEnable"]},decls:17,vars:27,consts:[["engine",""],["id","container","data-test","engine","aria-label","3D scene","role","complementary",1,"engine",3,"ngClass"],["role","img","aria-label","watermark","data-test","engineWatermark",1,"engine__watermark"],[3,"node","hit"],["data-test","engineInputBlocker",1,"engine__input-blocking"],["data-test","engineProgressBar"],["cdkDrag","",1,"engine__stats",3,"cdkDragBoundary"],[3,"theme","showAdvancedTools"]],template:function(t,o){if(1&t&&(e.j41(0,"div",1,0),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,$T,1,0,"div",2),e.nI1(5,"async"),e.DNE(6,BT,1,0,"app-labels"),e.nI1(7,"async"),e.DNE(8,zT,1,2,"app-engine-contextmenu",3)(9,WT,1,0,"div",4)(10,XT,1,0,"app-engine-progress",5),e.nI1(11,"async"),e.nrm(12,"app-engine-scroll")(13,"app-engine-fade"),e.DNE(14,HT,3,5,"div",6),e.nI1(15,"async"),e.DNE(16,QT,1,0,"app-engine-camera-position"),e.k0s()),2&t){const s=e.sdS(1);e.Y8G("ngClass",e.eq3(25,GT,"screen"===e.bMT(2,13,o.overlayType$))),e.BMQ("data-progress",o.progress)("data-chapter-ready",o.chapterReady)("data-camera-animating",o.cameraAnimating)("data-story-id",e.bMT(3,15,o.storyId$))("data-engine-version",o.VERSION),e.R7$(4),e.vxM(e.bMT(5,17,o.watermarkEnabled$)?4:-1),e.R7$(2),e.vxM(!1===e.bMT(7,19,o.xrActive$)?6:-1),e.R7$(2),e.vxM(o.contextMenuNode?8:-1),e.R7$(),e.vxM(o.inputEnabled()?-1:9),e.R7$(),e.vxM(e.bMT(11,21,o.showProgressBar$)?10:-1),e.R7$(4),e.vxM(e.bMT(15,23,o.statsEnabled$)?14:-1),e.R7$(2),e.vxM(o.showDebug&&s?16:-1)}},dependencies:[J.YU,Cr.T1,Fn,$s,RT,kT,xT,jT,VT,J.Jj],styles:[".engine[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;position:fixed;width:100vw;height:100vh;overflow:hidden;visibility:hidden;z-index:-1;-webkit-user-select:none;user-select:none}.engine--hidden[_ngcontent-%COMP%]{display:none!important}.engine--cursor-eyedropper[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-eyedropper.png) 7 20,pointer}.engine--cursor-paint[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-paint.svg) 7 20,pointer}.engine--cursor-fade[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-fade.svg) 7 20,pointer}.engine--cursor-hide[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-hide.svg) 7 20,pointer}.engine--cursor-label[_ngcontent-%COMP%]:hover{cursor:url(/assets/images/cursors/cursor-label.svg) 7 20,pointer}.engine--cursor-crosshair[_ngcontent-%COMP%]:hover{cursor:crosshair}.engine--checkered[_ngcontent-%COMP%]{background-color:#fff;background-size:24px 24px;background-position:0 0,12px 12px;background-image:linear-gradient(45deg,#d4d9e3 25%,transparent 25%,transparent 75%,#d4d9e3 75%,#d4d9e3),linear-gradient(45deg,#d4d9e3 25%,transparent 25%,transparent 75%,#d4d9e3 75%,#d4d9e3)}.engine--scaled[_ngcontent-%COMP%]{outline:var(--engine-border-width, 1px) solid #d4d9e3}.engine__controls[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;z-index:2}.engine__progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2}.engine__progress--hide[_ngcontent-%COMP%]{display:none}.engine__input-blocking[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3}.engine__watermark[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:101;pointer-events:none;background-image:url(/assets/images/BioDigital_watermark_1024x768.svg);background-repeat:no-repeat;background-position:center center;background-size:auto}.engine__stats[_ngcontent-%COMP%]{position:absolute;width:fit-content;max-height:calc(100vh - 32px);overflow:auto;top:16px;right:16px;z-index:2}@media (max-width: 768px){.engine__controls[_ngcontent-%COMP%]{bottom:96px}}@media (max-width: 959px){.engine__watermark[_ngcontent-%COMP%]{background-image:url(/assets/images/BioDigital_watermark_959x100.svg);background-size:contain}}"],changeDetection:0})}Gn([(0,l.l6)(ze.S.getEnginePosition),$n("design:type",h.c)],An.prototype,"enginePosition$",void 0),Gn([(0,l.l6)(ze.S.getHoveredNode),$n("design:type",h.c)],An.prototype,"hoveredNode$",void 0),Gn([(0,l.l6)(Rn.z.getPatches),$n("design:type",h.c)],An.prototype,"nodeStatePatches$",void 0),Gn([(0,l.l6)(ze.S.getActiveTool),$n("design:type",h.c)],An.prototype,"activeTool$",void 0),Gn([(0,l.l6)(ze.S.getDisplay),$n("design:type",h.c)],An.prototype,"engineDisplay$",void 0),Gn([(0,l.l6)(ze.S.getVisible),$n("design:type",h.c)],An.prototype,"engineVisible$",void 0),Gn([(0,l.l6)(ze.S.getShowProgressBar),$n("design:type",h.c)],An.prototype,"showProgressBar$",void 0),Gn([(0,l.l6)(ze.S.getContextMenu),$n("design:type",h.c)],An.prototype,"contextMenu$",void 0),Gn([(0,l.l6)(ze.S.getAutoplay),$n("design:type",h.c)],An.prototype,"autoplay$",void 0),Gn([(0,l.l6)(dt.getStoryId),$n("design:type",h.c)],An.prototype,"storyId$",void 0),Gn([(0,l.l6)(me.N.getSelectedChapter),$n("design:type",h.c)],An.prototype,"selectedChapter$",void 0),Gn([(0,l.l6)(me.N.getSelectedChapterId),$n("design:type",h.c)],An.prototype,"selectedChapterId$",void 0),Gn([(0,l.l6)(me.N.getSelectedChapterReadyState),$n("design:type",h.c)],An.prototype,"readyState$",void 0),Gn([(0,l.l6)(me.N.getSelectedChapterClippingPlanes),$n("design:type",h.c)],An.prototype,"clippingPlanes$",void 0),Gn([(0,l.l6)(me.N.getSelectedChapterBackground),$n("design:type",h.c)],An.prototype,"background$",void 0),Gn([(0,l.l6)(ze.S.getWatermarkEnabled),$n("design:type",h.c)],An.prototype,"watermarkEnabled$",void 0),Gn([(0,l.l6)(ze.S.getStatsEnabled),$n("design:type",h.c)],An.prototype,"statsEnabled$",void 0),Gn([(0,l.l6)(ze.S.getShowAdvancedStatsTools),$n("design:type",h.c)],An.prototype,"showAdvancedTools$",void 0),Gn([(0,l.l6)(On.U.getXROverlayType),$n("design:type",h.c)],An.prototype,"overlayType$",void 0),Gn([(0,l.l6)(ls.U.getPrefersReducedMotion),$n("design:type",h.c)],An.prototype,"prefersReducedMotion$",void 0),Gn([(0,l.l6)(On.U.getXREnabled),$n("design:type",h.c)],An.prototype,"xrEnabled$",void 0),Gn([(0,l.l6)(On.U.getXRActive),$n("design:type",h.c)],An.prototype,"xrActive$",void 0);var ps=d(46374);const KT=(n,i)=>({"pillbox-divider--horizontal":n,"pillbox-divider--vertical":i});let oc=(()=>{class n{constructor(){this.orientation="horizontal"}ngOnInit(){}get justifySelf(){return"vertical"===this.orientation?"stretch":""}get alignSelf(){return"horizontal"===this.orientation?"stretch":""}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-pillbox-divider"]],hostVars:4,hostBindings:function(o,s){2&o&&e.xc7("justify-self",s.justifySelf)("align-self",s.alignSelf)},inputs:{orientation:"orientation"},decls:1,vars:4,consts:[[1,"pillbox-divider",3,"ngClass"]],template:function(o,s){1&o&&e.nrm(0,"div",0),2&o&&e.Y8G("ngClass",e.l_i(1,KT,"horizontal"===s.orientation,"vertical"===s.orientation))},dependencies:[J.YU],styles:["[_nghost-%COMP%]{display:flex}.pillbox-divider[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.pillbox-divider--horizontal[_ngcontent-%COMP%]{height:100%;border-right:1px solid #d4d9e3}.pillbox-divider--vertical[_ngcontent-%COMP%]{width:40px;border-bottom:1px solid #d4d9e3}"],changeDetection:0})}return n})();const qT=["*"],JT=(n,i)=>({"pillbox--vertical":n,"pillbox--horizontal":i});function ZT(n,i){if(1&n){const t=e.RV6();e.qex(0),e.nrm(1,"app-pillbox-divider"),e.j41(2,"button",2),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.nrm(3,"app-icon",3),e.k0s(),e.bVm()}if(2&n){const t=e.XpG();e.R7$(2),e.Y8G("matTooltip","Close "+t.name),e.BMQ("aria-label","Close "+t.name)}}let no=(()=>{class n{constructor(){this.canExit=!1,this.padding="normal",this.orientation="horizontal",this.name="",this.exit=new e.bkB}ngOnInit(){}handleExitClick(){this.exit.emit()}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-pillbox"]],inputs:{canExit:"canExit",padding:"padding",orientation:"orientation",name:"name"},outputs:{exit:"exit"},ngContentSelectors:qT,decls:3,vars:5,consts:[[1,"pillbox",3,"ngClass"],[4,"ngIf"],["data-test","closePillboxButton","app-view-button","",3,"click","matTooltip"],["icon","times"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.DNE(2,ZT,4,2,"ng-container",1),e.k0s()),2&o&&(e.Y8G("ngClass",e.l_i(2,JT,"vertical"===s.orientation,"horizontal"===s.orientation)),e.R7$(2),e.Y8G("ngIf",s.canExit))},dependencies:[J.YU,J.bT,Qt.ri,Kt.oV,ut.R,oc],styles:[":host{display:inline-block}.pillbox{box-shadow:0 1px 4px 1px #0500380a;border:1px solid #d4d9e3;pointer-events:all;background:#fffffff2;border-radius:4px;display:flex;overflow:hidden;transition:all .1s ease-out}.pillbox:empty{border:0;box-shadow:none}.pillbox:hover{background:#fff}.pillbox--vertical{flex-direction:column;align-items:center}.pillbox--horizontal{flex-direction:row}\n"],encapsulation:2,changeDetection:0})}return n})();function eO(n,i){if(1&n){const t=e.RV6();e.j41(0,"li")(1,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.toggleCameraBar())}),e.nrm(2,"app-icon",10),e.j41(3,"span",8),e.pXf(4,1),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("short",!0)("matTooltip",t.cameraToggleTooltip()),e.R7$(),e.Y8G("icon",t.collapsed()?"angle-up":"angle-down")}}function tO(n,i){1&n&&(e.nrm(0,"app-icon",12),e.j41(1,"span",8),e.pXf(2,2),e.k0s())}function nO(n,i){1&n&&(e.nrm(0,"app-icon",13),e.j41(1,"span",8),e.pXf(2,3),e.k0s()),2&n&&e.Y8G("custom",!0)}function iO(n,i){if(1&n){const t=e.RV6();e.j41(0,"li")(1,"button",14),e.bIt("touchend",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))})("mouseup",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))})("keyup.enter",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("in"))}),e.nrm(2,"app-icon",15),e.k0s()(),e.j41(3,"li")(4,"button",16),e.bIt("touchend",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))})("mouseup",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))})("keyup.enter",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setZoomFixed("out"))}),e.nrm(5,"app-icon",17),e.k0s()()}}function oO(n,i){if(1&n){const t=e.RV6();e.j41(0,"li")(1,"button",11),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.togglePan())}),e.DNE(2,tO,3,0)(3,nO,3,1),e.k0s()(),e.DNE(4,iO,6,0)}if(2&n){let t;const o=e.XpG();e.R7$(),e.Y8G("matTooltip",o.cameraModeTooltip()),e.BMQ("aria-pressed","pan"===o.panMode()),e.R7$(),e.vxM("pan"===(t=o.panMode())?2:"rotate"===t?3:-1),e.R7$(2),e.vxM(o.zoomEnabled()?4:-1)}}let Vm=(()=>{class n{constructor(t,o,s,a){this.store=t,this.cameraService=o,this.viewService=s,this.liveAnnouncer=a,this.panMode=(0,je.ot)(this.store.select(Ti.x.getPanMode)),this.canvasHeightBreakpoint=(0,je.ot)(this.store.select(ze.S.getCanvasHeightBreakpoint)),this.zoomEnabled=(0,e.EWP)(()=>this.canvasHeightBreakpoint()>zo.h.Tiny),this.cameraToggleTooltip=(0,e.EWP)(()=>this.collapsed()?$localize`Open 3D Controls`:$localize`Close 3D Controls`),this.cameraModeTooltip=(0,e.EWP)(()=>"pan"===this.panMode()?$localize`Change to Rotate Mode`:$localize`Change to Pan Mode`),this.collapsed=(0,e.vPA)(!0)}setZoomFixed(t){this.cameraService.setCameraZoomWithVelocity("in"===t?-8:8);const s=(100*this.cameraService.getCameraZoom()).toFixed(0);this.liveAnnouncer.announce(`zoomed ${t} to ${s}%`)}returnToChapterCamera(){const t=this.store.selectSnapshot(me.N.getSelectedChapter);this.store.dispatch(new Ut.Ih(t.camera.location)).subscribe(()=>{this.liveAnnouncer.announce("recenter complete")})}resetChapter(){this.returnToChapterCamera();const t=this.store.selectSnapshot(me.N.getSelectedChapterId);this.store.dispatch(new bi.a.UndoAll(t)),this.store.dispatch(new Vt.q9(!1)),this.store.dispatch(new Je.S3)}togglePan(){this.viewService.togglePan()}toggleCameraBar(){this.collapsed.update(t=>!t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(go.j),e.rXU(En),e.rXU(mo.Ai))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-engine-camera-bar"]],standalone:!0,features:[e.aNF],decls:9,vars:2,consts:()=>{let t,o,s,a,r,_,g,P,F,ee;return t=$localize`:fa8adc0f5e22d9c18b37663b6f2bb1b50424eb1c8617328588319285229:Camera Control Buttons`,o=$localize`:ac4a855ff1671d74a0692e3b9ee5be349e6281ca6332173527621530176:Return to Starting Position`,s=$localize`:0459da369b661293df2216dab6d5504bc0ae736d4770948314010072135:Clicking this button will reset the camera viewing the 3D model`,a=$localize`:0c6b2042f7ade77091a6e0b314f5797a51644835918403358406080994:Toggle 3D navigation controls`,r=$localize`:240d93ec4b5179c4fd189688280eaa63b0d6d7836492222661583280:Pan mode active, change to rotate mode`,_=$localize`:e583fc810e521ceb2967fc19734fed46a2540c944140573029148607220:Rotate mode active, change to pan mode`,g=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,P=$localize`:34fb6028a6630cf3a7308084b31e86e89d0579651470758907984185227:Zoom In`,F=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,ee=$localize`:677ce9c57b5558cb10f0b39327d5a965bfb21dc51356460275822781324:Zoom Out`,[s,a,r,_,["direction","vertical","data-test","cameraBar","direction","vertical","appPreventFadeout",""],["role","group","aria-label",t],["app-view-button","","buttonSize","small","matTooltip",o,"matTooltipPosition","left","data-test","cameraReset",3,"click"],["size","lg","icon","location-crosshairs"],[1,"sr-only"],["app-view-button","","buttonSize","small","data-test","cameraToggleBar","matTooltipPosition","left",3,"click","short","matTooltip"],["size","sm",3,"icon"],["app-view-button","","buttonSize","small","matTooltipPosition","left","data-test","cameraPan",3,"click","matTooltip"],["size","lg","icon","arrows-up-down-left-right"],["size","lg","icon","rotate",3,"custom"],["app-view-button","","buttonSize","small","data-test","cameraZoomIn","aria-label",g,"matTooltip",P,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","plus"],["app-view-button","","buttonSize","small","data-test","cameraZoomOut","aria-label",F,"matTooltip",ee,"matTooltipPosition","left",3,"touchend","mouseup","keyup.enter"],["size","lg","icon","minus"]]},template:function(o,s){1&o&&(e.j41(0,"app-pillbox",4)(1,"ul",5),e.DNE(2,eO,5,3,"li"),e.j41(3,"li")(4,"button",6),e.bIt("click",function(){return s.returnToChapterCamera()}),e.nrm(5,"app-icon",7),e.j41(6,"span",8),e.pXf(7,0),e.k0s()()(),e.DNE(8,oO,5,4),e.k0s()()),2&o&&(e.R7$(2),e.vxM(s.zoomEnabled()?2:-1),e.R7$(6),e.vxM(s.collapsed()?-1:8))},dependencies:[J.MD,Kt.uc,Kt.oV,xi.h,Us,sn.o,ut.R,bn.C,Qt.ri,ps.b,no],encapsulation:2,data:{animation:[(0,xe.hZ)("expand",[(0,xe.kY)(":enter",[(0,xe.K2)([(0,xe.iF)({height:0}),(0,xe.i0)("150ms ease-in-out",(0,xe.iF)({height:"*"}))])]),(0,xe.kY)(":leave",[(0,xe.K2)([(0,xe.i0)("150ms ease-in-out",(0,xe.iF)({height:"0"}))])])]),(0,xe.hZ)("show",[(0,xe.kY)(":enter",[(0,xe.K2)([(0,xe.iF)({height:"0"}),(0,xe.i0)("125ms ease-in-out",(0,xe.iF)({height:"*"}))])]),(0,xe.kY)(":leave",[(0,xe.K2)([(0,xe.i0)("125ms 125ms ease-in-out",(0,xe.iF)({height:"0"}))])])])]},changeDetection:0})}return n})(),sc=(()=>{class n{constructor(t){this.store=t,this.animationPlaying=(0,je.ot)(this.store.select(ze.S.getAnimationPlaying)),this.animationPlayingTooltip=(0,e.EWP)(()=>this.animationPlaying()?$localize`Pause Animation`:$localize`Play Animation`)}handlePlayClick(){const t=this.store.selectSnapshot(ze.S.getAnimationPlaying);this.store.dispatch(new st.dE(!t))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-play"]],standalone:!0,features:[e.aNF],decls:4,vars:3,consts:[["app-view-button","","buttonSize","small","data-test","viewMediaPlay","matTooltipPosition","above",3,"click","matTooltip"],[1,"sr-only"],["size","lg","aria-hidden","true",3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"button",0),e.bIt("click",function(){return s.handlePlayClick()}),e.j41(1,"span",1),e.EFF(2),e.k0s(),e.nrm(3,"app-icon",2),e.k0s()),2&o&&(e.Y8G("matTooltip",s.animationPlayingTooltip()),e.R7$(2),e.JRh(s.animationPlayingTooltip()),e.R7$(),e.Y8G("icon",s.animationPlaying()?"pause":"play"))},dependencies:[J.MD,Kt.uc,Kt.oV,sn.o,ut.R,bn.C,Qt.ri],changeDetection:0})}return n})();const sO=["scrubber"],aO=["track"],rO=["bar"],lO=["handle"],cO=(n,i,t,o)=>({"view-slider--immediate":n,"view-slider--show-track":i,"view-slider--x":t,"view-slider--y":o});let Fm=(()=>{class n{get percent(){return this._percent}set percent(t){this._percent=t,this.dragging||(this.setScrubberBar(t),this.setScrubberHandle(t))}get dragging(){return this._dragging}set dragging(t){t!=this.dragging&&(t?this.dragStarted.emit(this.percent):this.dragEnded.emit(this.percent)),this._dragging=t,this.draggingChanged.emit(t)}constructor(t,o){this.renderer=t,this.changeDetectorRef=o,this.accessibleLabel="",this.sliderAxis="x",this.showTrack=!1,this._percent=0,this.percentChanged=new e.bkB,this._dragging=!1,this.animate=!0,this.draggingChanged=new e.bkB,this.dragStarted=new e.bkB,this.dragEnded=new e.bkB,this.trackClicked=new e.bkB,this.ngUnsubscribe=new k.B,this.trackWidth=0,this.dragPosition={x:0,y:0}}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.setScrubberBar(this.percent),this.setScrubberHandle(this.percent)}),this.initDragListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initDragListener(){this.dragInstance.moved.pipe((0,Ho.Z)(20),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.percent=this.calculateHandlePercent(),this.setScrubberBar(this.percent),this.percentChanged.emit(this.percent)})}handleDragStart(){this.dragging=!0,this.animate=!1}handleDragEnd(){this.dragging=!1,this.animate=!0}handleTrackClick(t){this.animate=!1,this.changeDetectorRef.markForCheck(),setTimeout(()=>{this.percent=this.getClickPercent(t),this.trackClicked.emit(this.percent),this.percentChanged.emit(this.percent),setTimeout(()=>{this.animate=!0})})}handleKeyDown(t){switch(t.key){case"Home":this.increment(-100),t.stopPropagation();break;case"End":this.increment(100),t.stopPropagation();break;case"PageDown":this.increment(-10),t.stopPropagation();break;case"PageUp":this.increment(10),t.stopPropagation();break;case"ArrowLeft":case"ArrowDown":this.increment(-1),t.stopPropagation();break;case"ArrowRight":case"ArrowUp":this.increment(1),t.stopPropagation()}}increment(t){this.percent+=t,this.percent>100&&(this.percent=100),this.percent<0&&(this.percent=0),this.percentChanged.emit(this.percent)}getClickPercent(t){const{height:o,width:s}=this.track.nativeElement.getBoundingClientRect();let a=0;switch(this.sliderAxis){case"x":a=t.offsetX/s*100;break;case"y":a=(o-t.offsetY)/o*100}return a>100&&(a=100),a<0&&(a=0),a}calculateHandlePercent(){const t=this.getTrackWidth(),o=this.scrubber.nativeElement.getBoundingClientRect().left,s=this.handle.nativeElement.getBoundingClientRect().left,a=this.getTrackHeight(),r=this.scrubber.nativeElement.getBoundingClientRect().top,_=this.handle.nativeElement.getBoundingClientRect().top;let g=0;switch(this.sliderAxis){case"x":g=(s-o)/t*100;break;case"y":g=100-(_-r)/a*100}return Math.min(Math.max(g,0),100)}setScrubberBar(t){switch(this.sliderAxis){case"x":this.renderer.setStyle(this.bar.nativeElement,"width",`${t}%`);break;case"y":this.renderer.setStyle(this.bar.nativeElement,"height",`${t}%`)}this.changeDetectorRef.markForCheck()}setScrubberHandle(t){let o,s;switch(this.sliderAxis){case"x":o=this.getTrackWidth(),this.dragPosition={...this.dragPosition,x:o*(t/100)};break;case"y":s=this.getTrackHeight(),this.dragPosition={...this.dragPosition,y:s-s*(t/100)}}this.changeDetectorRef.markForCheck()}getTrackWidth(){const{left:t,right:o}=this.scrubber.nativeElement.getBoundingClientRect();return o-t-this.handle.nativeElement.offsetWidth}getTrackHeight(){const{height:t}=this.scrubber.nativeElement.getBoundingClientRect();return t-this.handle.nativeElement.offsetHeight}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-slider"]],viewQuery:function(o,s){if(1&o&&(e.GBs(sO,7),e.GBs(aO,7),e.GBs(rO,7),e.GBs(lO,7),e.GBs(Cr.T1,5)),2&o){let a;e.mGM(a=e.lsd())&&(s.scrubber=a.first),e.mGM(a=e.lsd())&&(s.track=a.first),e.mGM(a=e.lsd())&&(s.bar=a.first),e.mGM(a=e.lsd())&&(s.handle=a.first),e.mGM(a=e.lsd())&&(s.dragInstance=a.first)}},inputs:{accessibleLabel:"accessibleLabel",sliderAxis:"sliderAxis",showTrack:"showTrack",percent:"percent"},outputs:{percentChanged:"percentChanged",draggingChanged:"draggingChanged",dragStarted:"dragStarted",dragEnded:"dragEnded",trackClicked:"trackClicked"},decls:8,vars:10,consts:[["scrubber",""],["track",""],["bar",""],["handle",""],[1,"view-slider",3,"ngClass"],[1,"view-slider__track",3,"click"],[1,"view-slider__bar"],["cdkDrag","","cdkDragBoundary",".view-slider","role","slider","tabindex","0","aria-valuemin","0","aria-valuemax","100",1,"view-slider__handle",3,"cdkDragStarted","cdkDragEnded","keydown","cdkDragLockAxis","cdkDragFreeDragPosition"]],template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"div",4,0)(2,"div",5,1),e.bIt("click",function(_){return e.eBV(a),e.Njj(s.handleTrackClick(_))}),e.nrm(4,"div",6,2),e.k0s(),e.j41(6,"div",7,3),e.bIt("cdkDragStarted",function(){return e.eBV(a),e.Njj(s.handleDragStart())})("cdkDragEnded",function(){return e.eBV(a),e.Njj(s.handleDragEnd())})("keydown",function(_){return e.eBV(a),e.Njj(s.handleKeyDown(_))}),e.k0s()()}2&o&&(e.Y8G("ngClass",e.ziG(5,cO,!s.animate,s.showTrack,"x"===s.sliderAxis,"y"===s.sliderAxis)),e.R7$(6),e.Y8G("cdkDragLockAxis",s.sliderAxis)("cdkDragFreeDragPosition",s.dragPosition),e.BMQ("aria-label",s.accessibleLabel)("aria-valuenow",s.percent))},dependencies:[J.YU,Cr.T1],styles:['.view-slider[_ngcontent-%COMP%]{--height: 28px;--width: 100%;--track-height: 4px;--track-width: 100%;--bar-height: 4px;--bar-width: 0;--handle-height: 28px;--handle-width: 32px;--handle-bulb-size: 12px;--track-color: #d4d9e3;--bar-color: #384c6c;--handle-color: transparent;--bar-hover-color: #2472e9;--handle-hover-color: #2472e9;--track-hover-color: #d4d9e3;--half-width: calc(var(--handle-width) / 2);--half-height: calc(var(--handle-height) / 2);position:relative;display:flex;justify-content:center;align-items:center;height:var(--height);width:var(--width)}.view-slider[_ngcontent-%COMP%]:hover, .view-slider.view-slider--show-track[_ngcontent-%COMP%]{cursor:pointer}.view-slider[_ngcontent-%COMP%]:hover.view-slider--x, .view-slider.view-slider--show-track.view-slider--x[_ngcontent-%COMP%]{--bar-height: 6px;--track-height: 6px}.view-slider[_ngcontent-%COMP%]:hover.view-slider--y, .view-slider.view-slider--show-track.view-slider--y[_ngcontent-%COMP%]{--bar-width: 6px;--track-width: 6px}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__bar[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{background:var(--bar-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%], .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{opacity:1}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__handle[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]:after{background:var(--handle-hover-color)}.view-slider[_ngcontent-%COMP%]:hover   .view-slider__track[_ngcontent-%COMP%]:after, .view-slider.view-slider--show-track[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]:after{background:var(--track-hover-color)}.view-slider--x[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{left:var(--half-width);right:var(--half-width)}.view-slider--y[_ngcontent-%COMP%]{--height: 100%;--width: 28px;--track-height: 100%;--track-width: 4px;--bar-height: 0;--bar-width: 4px;--handle-height: 32px;--handle-width: 28px;flex-direction:column-reverse;justify-content:flex-end}.view-slider--y[_ngcontent-%COMP%]:hover{--bar-width: 6px;--track-width: 6px}.view-slider--y[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%]{left:auto}.view-slider--y[_ngcontent-%COMP%]   .view-slider__track[_ngcontent-%COMP%]{flex-direction:column-reverse;top:var(--half-height);bottom:var(--half-height)}.view-slider--immediate[_ngcontent-%COMP%]   .view-slider__bar[_ngcontent-%COMP%], .view-slider--immediate[_ngcontent-%COMP%]   .view-slider__handle[_ngcontent-%COMP%]{transition:none!important}.view-slider__track[_ngcontent-%COMP%]{display:flex;align-items:center;position:absolute;inset:0}.view-slider__track[_ngcontent-%COMP%]:after{content:" ";background:var(--track-color);height:var(--track-height);width:var(--track-width);transition:all .2s ease-in-out,width 50ms}.view-slider__bar[_ngcontent-%COMP%]{border-radius:2px;position:absolute;background:var(--bar-color);height:var(--bar-height);width:var(--bar-width);z-index:2;left:0;transition:all .2s ease-in-out,width 50ms;pointer-events:none}.view-slider__handle[_ngcontent-%COMP%]{width:var(--handle-width);height:var(--handle-height);margin-left:-calc(var(--handle-width)/2);left:0;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2;opacity:0;transition:transform 50ms linear}.view-slider__handle[_ngcontent-%COMP%]:hover:after{transform:scale(1.3)}.view-slider__handle[_ngcontent-%COMP%]:after{opacity:1;content:"";width:var(--handle-bulb-size);height:var(--handle-bulb-size);border-radius:50%;background:var(--handle-color);transition:opacity .25s,transform ease-out .15s}.view-slider__handle-touch[_ngcontent-%COMP%]:after{opacity:1}'],changeDetection:0})}return n})();var ac=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},rc=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class us{constructor(i,t,o,s){this.store=i,this.animationService=t,this.engineService=o,this.changeDetetorRef=s,this.ngUnsubscribe=new k.B,this.duration=0,this.wasPlaying=!0,this.percent=0,this.accessibleLabel=$localize`media slider`}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePercentChanged(i){this.percent=i,this.scrubToPercent(i)}initChapterListener(){this.chapterReadyState$.pipe((0,D.p)(i=>!(0,u.isNil)(i)&&i.animation),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(this.animationService.getTime())})}initTimelineListener(){this.engineService.getEvent(Ct.X.TimelinePlaying).pipe((0,Ho.Z)(20),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.tick(i.time)}),this.engineService.getEvent(Ct.X.TimelineScrubbed).pipe((0,Ho.Z)(20),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.percent=this.getPercent(i.time)})}handleDragStart(){this.wasPlaying=this.store.selectSnapshot(ze.S.getAnimationPlaying),this.animationService.pause()}handleTrackClick(i){const t=this.store.selectSnapshot(ze.S.getAnimationPlaying);t&&this.animationService.pause(),this.percent=i,this.scrubToPercent(i),setTimeout(()=>{t&&this.animationService.unpause()})}handleDragEnd(){this.wasPlaying&&this.animationService.play()}tick(i){this.percent=this.getPercent(i),this.changeDetetorRef.markForCheck()}getPercent(i){return this.timerange?.lastTime>0?i/this.timerange.lastTime*100:0}scrubToPercent(i){this.timerange?.lastTime>0&&this.animationService.scrub(i/100*this.timerange.lastTime)}static#e=this.\u0275fac=function(t){return new(t||us)(e.rXU(l.il),e.rXU(co.O),e.rXU(v.y),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:us,selectors:[["app-view-scrubber"]],decls:1,vars:2,consts:[["data-test","viewMediaScrubber",3,"dragStarted","dragEnded","trackClicked","percentChanged","percent","accessibleLabel"]],template:function(t,o){1&t&&(e.j41(0,"app-view-slider",0),e.bIt("dragStarted",function(){return o.handleDragStart()})("dragEnded",function(){return o.handleDragEnd()})("trackClicked",function(a){return o.handleTrackClick(a)})("percentChanged",function(a){return o.handlePercentChanged(a)}),e.k0s()),2&t&&e.Y8G("percent",o.percent)("accessibleLabel",o.accessibleLabel)},dependencies:[Fm],encapsulation:2})}ac([(0,l.l6)(me.N.getSelectedChapterId),rc("design:type",h.c)],us.prototype,"selectedChapterId$",void 0),ac([(0,l.l6)(ze.S.getAnimationPlaying),rc("design:type",h.c)],us.prototype,"animationPlaying$",void 0),ac([(0,l.l6)(me.N.getSelectedChapterReadyState),rc("design:type",h.c)],us.prototype,"chapterReadyState$",void 0),ac([(0,l.l6)(de.getCanTouch),rc("design:type",h.c)],us.prototype,"canTouch$",void 0);class wr{constructor(i){this.store=i}setPlaybackSpeed(i){this.store.dispatch(new st.Vs(i))}static#e=this.\u0275fac=function(t){return new(t||wr)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:wr,selectors:[["app-view-playback-speed"]],decls:18,vars:4,consts:()=>{let i,t,o;return i=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,t=$localize`:4f8e5379083ddd28f3d57c885e7917c264af4f2a7596687563071324760:Playback Speed`,o=$localize`:077e90416bdae39a40441d0b94c5a9e8fcad45143080483882937310852:Normal`,[["playbackMenu","matMenu"],t,o,["app-view-button","","buttonSize","small","data-test","viewPlaybackSpeed","matTooltip",i,"matTooltipPosition","above",3,"matMenuTriggerFor"],[1,"px-2"],[1,"sr-only"],[1,"text-xs"],["icon","angle-up","size","xs",1,"ml-2"],["mat-menu-item","",3,"click"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"button",3)(1,"div",4)(2,"span",5),e.pXf(3,1),e.k0s(),e.j41(4,"span",6),e.EFF(5),e.nI1(6,"async"),e.k0s(),e.nrm(7,"app-icon",7),e.k0s()(),e.j41(8,"mat-menu",null,0)(10,"button",8),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPlaybackSpeed(1))}),e.pXf(11,2),e.k0s(),e.j41(12,"button",8),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPlaybackSpeed(.5))}),e.EFF(13,"0.5"),e.k0s(),e.j41(14,"button",8),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPlaybackSpeed(.25))}),e.EFF(15,"0.25"),e.k0s(),e.j41(16,"button",8),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPlaybackSpeed(.1))}),e.EFF(17,"0.1"),e.k0s()()}if(2&t){const s=e.sdS(9);e.Y8G("matMenuTriggerFor",s),e.R7$(5),e.SpI("",e.bMT(6,2,o.playbackSpeed$),"x ")}},dependencies:[Qt.ri,un.kk,un.fb,un.Cp,Kt.oV,ut.R,J.Jj],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(ze.S.getPlaybackSpeed),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],wr.prototype,"playbackSpeed$",void 0);var Pa=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},wa=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const pO=["mediaPlayButton"];function uO(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handlePlayChapterFromStartClick())}),e.j41(1,"span",7),e.pXf(2,0),e.k0s(),e.nrm(3,"app-icon",8),e.k0s()}}function hO(n,i){1&n&&e.nrm(0,"app-view-scrubber",9)}function gO(n,i){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.timeLabel," ")}}function mO(n,i){1&n&&e.nrm(0,"app-view-playback-speed")}class Ro{set autoFocus(i){i&&!this.triedToFocus&&setTimeout(()=>{this.playButton.focus()},0),this.triedToFocus=!0}constructor(i,t,o,s,a){this.animationService=i,this.engineService=t,this.viewService=o,this.store=s,this.changeDetectorRef=a,this.viewLayout=G,this.buttonSize=Qt.Mp.Default,this.showScrubber=!0,this.showSpeed=!0,this.triedToFocus=!1,this.ngUnsubscribe=new k.B,this.timeLabel="0:00 / 0:00",this.viewUI=G}ngOnInit(){this.initChapterListener(),this.initTimelineListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterListener(){this.chapterReadyState$.pipe((0,D.p)(i=>!(0,u.isNil)(i)&&i.animation),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timerange=this.animationService.getChapterTimeFrame(),this.tick(0)})}initTimelineListener(){this.engineService.getEvent(Ct.X.TimelinePlaying).pipe((0,Ho.Z)(500),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.tick(i.time)})}handlePlayClick(){this.viewService.toggleAnimation()}handlePlayChapterFromStartClick(){this.viewService.playChapterFromStart()}setPlaybackSpeed(i){this.store.dispatch(new st.Vs(i))}tick(i){this.timerange&&(this.timeLabel=`${this.getFormattedTime(i)} / ${this.getFormattedTime(this.timerange.lastTime)}`,this.changeDetectorRef.markForCheck())}getFormattedTime(i){return`${Math.floor(Math.floor(i)/60)}:${(0,u.padStart)((Math.floor(i)%60).toString(),2,"0")}`}static#e=this.\u0275fac=function(t){return new(t||Ro)(e.rXU(co.O),e.rXU(v.y),e.rXU(En),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Ro,selectors:[["app-view-media-bar"]],viewQuery:function(t,o){if(1&t&&e.GBs(pO,5),2&t){let s;e.mGM(s=e.lsd())&&(o.playButton=s.first)}},inputs:{buttonSize:"buttonSize",showScrubber:"showScrubber",showSpeed:"showSpeed",autoFocus:"autoFocus"},decls:10,vars:12,consts:()=>{let i,t;return i=$localize`:623c2eb512dd08c852fcda4f15379224c8c971337851550536336238650:Play Chapter From Start`,t=$localize`:b3e95ffdcd71216e76228de060aaa7fd8662266c162780291567006895:Play Chapter from Start`,[t,["data-test","viewMediaBar",1,"view-media-bar"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",i,"matTooltipPosition","above",3,"click",4,"ngIf"],["class","view-media-bar__scrubber",4,"ngIf"],["class","view-media-bar__time","data-test","viewMediaTime",4,"ngIf"],[4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewMediaRestart","matTooltip",i,"matTooltipPosition","above",3,"click"],[1,"sr-only"],["size","lg","icon","step-backward","aria-hidden","true"],[1,"view-media-bar__scrubber"],["data-test","viewMediaTime",1,"view-media-bar__time"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",1),e.nrm(1,"app-view-play"),e.DNE(2,uO,4,0,"button",2),e.nI1(3,"async"),e.DNE(4,hO,1,0,"app-view-scrubber",3),e.nI1(5,"async"),e.DNE(6,gO,2,1,"div",4),e.nI1(7,"async"),e.DNE(8,mO,1,0,"app-view-playback-speed",5),e.nI1(9,"async"),e.k0s()),2&t){let s,a,r,_;e.R7$(2),e.Y8G("ngIf","full"===(null==(s=e.bMT(3,4,o.mediaUI$))?null:s.template)),e.R7$(2),e.Y8G("ngIf","full"===(null==(a=e.bMT(5,6,o.mediaUI$))?null:a.template)&&o.showScrubber),e.R7$(2),e.Y8G("ngIf","full"===(null==(r=e.bMT(7,8,o.mediaUI$))?null:r.template)&&o.showScrubber),e.R7$(2),e.Y8G("ngIf","full"===(null==(_=e.bMT(9,10,o.mediaUI$))?null:_.template)&&o.showSpeed)}},dependencies:[J.bT,Qt.ri,Kt.oV,ut.R,sc,us,wr,J.Jj],styles:[".view-media-bar[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;position:relative}.view-media-bar__scrubber[_ngcontent-%COMP%]{flex:1}.view-media-bar__scrubber--disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.view-media-bar__time[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:0 12px;font-size:12px;color:#384c6c;height:100%;white-space:nowrap}.view-media-bar__playback[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:600}"],changeDetection:0})}Pa([(0,l.l6)(me.N.getSelectedChapterId),wa("design:type",h.c)],Ro.prototype,"selectedChapterId$",void 0),Pa([(0,l.l6)(me.N.getSelectedChapterReadyState),wa("design:type",h.c)],Ro.prototype,"chapterReadyState$",void 0),Pa([(0,l.l6)(ze.S.getPlaybackSpeed),wa("design:type",h.c)],Ro.prototype,"playbackSpeed$",void 0),Pa([(0,l.l6)(de.getAutoplay),wa("design:type",h.c)],Ro.prototype,"autoplay$",void 0),Pa([(0,l.l6)(Ke.getVisible(G.Audio)),wa("design:type",h.c)],Ro.prototype,"audioVisible$",void 0),Pa([(0,l.l6)(Ke.getUIEntry(G.Media)),wa("design:type",h.c)],Ro.prototype,"mediaUI$",void 0);var Jo=d(97352);function bO(n,i){1&n&&e.nrm(0,"app-spinner",3)}function yO(n,i){if(1&n&&(e.nrm(0,"app-icon",4),e.nI1(1,"async")),2&n){const t=e.XpG();e.Y8G("icon",e.bMT(1,1,t.muted$)?"volume-slash":"volume")}}class Aa{get text(){return this.store.selectSnapshot(Xi.getAudioMuted)?$localize`Unmute`:$localize`Mute`}constructor(i,t){this.store=i,this.mediaService=t,this.buttonSize="small",this.buttonShape="square",this.buttonTheme="transparent-fill"}handleClick(){const i=this.store.selectSnapshot(me.N.getSelectedChapter),t=!this.store.selectSnapshot(Xi.getAudioMuted);if(this.store.dispatch(new yi.SetAudioMuted(t)),t)this.mediaService.muteAudio();else if(this.mediaService.getPlayingAudio()?.length)this.mediaService.unmuteAudio(i.id);else{const s=this.store.selectSnapshot(de.getViewLanguage),a=this.store.selectSnapshot(de.getForceAudio);this.mediaService.getChapterAudioPlayer(i,s,a).then(()=>{this.mediaService.playChapterAudio(i.id)})}}static#e=this.\u0275fac=function(t){return new(t||Aa)(e.rXU(l.il),e.rXU(vi))};static#t=this.\u0275cmp=e.VBU({type:Aa,selectors:[["app-view-audio-mute"]],inputs:{disabled:"disabled",buttonSize:"buttonSize",buttonShape:"buttonShape",buttonTheme:"buttonTheme"},decls:5,vars:13,consts:()=>{let i;return i=$localize`:17517742950bb7560a3ca4c8fa23122e16b561163135353579204779711:mute audio`,[["type","button","app-view-button","","aria-label",i,"matTooltipPosition","above","data-test","viewAudioMute",1,"view-audio-mute",3,"click","buttonSize","buttonShape","buttonTheme","matTooltip","disabled"],["spinnerSize","small",4,"ngIf"],["appLogicalDir","","class","view-audio-mute__icon","aria-hidden","true",3,"icon",4,"ngIf"],["spinnerSize","small"],["appLogicalDir","","aria-hidden","true",1,"view-audio-mute__icon",3,"icon"]]},template:function(t,o){1&t&&(e.j41(0,"button",0),e.nI1(1,"async"),e.nI1(2,"async"),e.bIt("click",function(){return o.handleClick()}),e.DNE(3,bO,1,0,"app-spinner",1)(4,yO,2,3,"app-icon",2),e.k0s()),2&t&&(e.Y8G("buttonSize",o.buttonSize)("buttonShape",o.buttonShape)("buttonTheme",o.buttonTheme)("matTooltip",o.text)("disabled",o.disabled),e.BMQ("aria-pressed",!1===e.bMT(1,9,o.muted$))("data-test-muted",e.bMT(2,11,o.muted$)),e.R7$(3),e.Y8G("ngIf",o.disabled),e.R7$(),e.Y8G("ngIf",!o.disabled))},dependencies:[J.bT,Qt.ri,Kt.oV,ut.R,Jo.tI,Ao.e,J.Jj],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Xi.getAudioMuted),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Aa.prototype,"muted$",void 0);var zs=d(43881);const vO=(n,i,t)=>({"justify-between":n,"justify-start":i,"gap-2":t}),EO=()=>["outline","outline-blue-600"],CO=()=>[""];function TO(n,i){if(1&n&&e.nrm(0,"div",11),2&n){const t=e.XpG().$implicit;e.HbH(t.imageClass)}}function OO(n,i){if(1&n&&(e.j41(0,"span",10),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.title)}}function MO(n,i){if(1&n){const t=e.RV6();e.j41(0,"li")(1,"button",7),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleThemeSelected(s))}),e.j41(2,"div",8),e.DNE(3,TO,1,2,"div",9)(4,OO,2,1,"span",10),e.k0s()()()}if(2&n){const t=i.$implicit,o=e.XpG();e.R7$(),e.Y8G("matTooltip",t.title)("lang",o.lang()),e.BMQ("aria-label",t.arialLabel)("data-test-skin",t.id),e.R7$(),e.HbH(o.selectedTheme()===t?e.lJ4(7,EO):e.lJ4(8,CO)),e.R7$(),e.vxM(t.imageClass?3:4)}}function IO(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",6)(1,"mat-slider",12)(2,"input",13,0),e.bIt("valueChange",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleSliderChange(s,!1,!0))})("input",function(){e.eBV(t);const s=e.sdS(3),a=e.XpG();return e.Njj(a.handleSliderChange(s.value,!0,!1))}),e.k0s()(),e.j41(4,"div",14)(5,"span"),e.pXf(6,1),e.k0s(),e.j41(7,"span"),e.EFF(8),e.k0s()()()}if(2&n){const t=e.sdS(3),o=e.XpG();e.R7$(),e.Y8G("min",0)("max",100)("showTickMarks",!1),e.R7$(),e.Y8G("value",o.opacity()),e.R7$(6),e.SpI("",t.value,"%")}}let lc=(()=>{class n{constructor(t,o,s,a){this.store=t,this.sceneService=o,this.paintService=s,this.vendorAnalyticsService=a,this.skinUIConfig={"integumentary system":{title:$localize`Integumentary System`},off:{id:"off",title:$localize`Off`,arialLabel:$localize`Off`},"dark skin":{id:"dark",title:$localize`Dark Skin`,imageClass:"dark"},"medium skin":{id:"medium",title:$localize`Medium Skin`,imageClass:"medium"},"light skin":{id:"light",title:$localize`Light Skin`,imageClass:"light"},"fair skin":{id:"fair",title:$localize`Fair Skin`,imageClass:"fair"},"transparent skin":{id:"transparent",title:$localize`Transparent Skin`,imageClass:"transparent"}},this.offSkinTheme={id:"off",title:$localize`Off`,arialLabel:$localize`Turn off Skin`,objectVariants:{}},this.lang=e.hFB.required(),this.schema=e.hFB.required(),this.contentId=e.hFB.required(),this.contentType=e.hFB.required(),this.schemaTitle=(0,e.EWP)(()=>{const r=this.schema(),_=r.title.toLowerCase();return this.skinUIConfig[_]?.title??r.title}),this.compact=(0,e.hFB)(!1),this.themes=(0,e.EWP)(()=>{const r=function PO(n,i){return n.map(t=>{const o=t.title.toLowerCase(),s=i[o],a=s?.id??o.replace(/\s/g,""),r=s?.title??t.title,_=s?.arialLabel??$localize`Switch to ${r}`,g=Object.keys(t.objectVariants).some(F=>F.includes("female"))?"female":"male";let P=s?.imageClass?`view-skin__image--${g}--${s.imageClass}`:"";return{...t,id:a,title:r,arialLabel:_,imageClass:P}})}(this.schema().themes,this.skinUIConfig);return[this.offSkinTheme,...r]}),this.selectedThemeIndex=(0,e.EWP)(()=>{const r=this.themes(),_=this.nodes();return r.findIndex((g,P)=>g===this.offSkinTheme?this.allObjectIds().every(ee=>!1===_[ee]?.shown):Object.entries(g.objectVariants).every(([F,ee])=>_[F]?.variant===ee))}),this.selectedTheme=(0,e.EWP)(()=>this.themes()[this.selectedThemeIndex()]),this.isOffThemeSelected=(0,e.EWP)(()=>this.selectedTheme()===this.offSkinTheme),this.allObjectIds=(0,e.EWP)(()=>{const _=this.themes().reduce((g,P)=>{const F=Object.keys(P.objectVariants);return g.push(...F),g},[]);return Array.from(new Set(_))}),this.selectedObjectIds=(0,e.EWP)(()=>Object.keys(this.selectedTheme()?.objectVariants??{})),this.selectedSkinId=(0,e.EWP)(()=>this.selectedObjectIds().find(r=>r.includes("skin"))),this.opacity=(0,e.EWP)(()=>{const r=this.nodes(),_=this.selectedSkinId(),P=r[_]?.paint;return this.getObjectOpacity(P?.opacity)??100}),this.nodes=(0,je.ot)(this.store.select(Rn.z.getNodes))}toggleVisibility(t){t||this.handleThemeSelected(this.offSkinTheme)}handleThemeSelected(t){if(t===this.offSkinTheme){const _=this.allObjectIds();this.store.dispatch(new Vt.yr(!1,_)),this.store.dispatch(new Vt._n({}))}else{const{objectVariants:_}=t,g=Object.keys(_);this.store.dispatch(new Vt.yr(!0,g)),this.store.dispatch(new Vt._n(_))}const o=ho.l.toTitleCase(t.id),s=this.lang(),a=this.contentId(),r=this.contentType();this.vendorAnalyticsService.track("Skin Type",{skinType:o,contentId:a,contentType:r,lang:s})}handleSliderChange(t,o,s){const a=t/100,r=this.selectedObjectIds();if(o&&r.forEach(_=>{this.setObjectOpacity(_,a)}),s){const _=r.reduce((g,P)=>{const F=this.paintService.getColor(P);if(F){const ee=(0,br.H)(F);g[P]=ee}return g},{});this.store.dispatch(new Vt.Jp(void 0,void 0,_))}}setObjectOpacity(t,o){this.sceneService.getLeafIds(t).forEach(a=>{const r=this.paintService.getColor(a)?.opacity||1;let _;Array.isArray(r)?(_=[...r],_[0]=o):"number"==typeof r&&(_=o),this.paintService.colorObject(a,{opacity:_})})}getObjectOpacity(t){if(Array.isArray(t)){const[o]=t;return o}if("number"==typeof t)return t}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(Fi.w),e.rXU(ir.s),e.rXU(ve))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-skin-variants"]],inputs:{lang:[1,"lang"],schema:[1,"schema"],contentId:[1,"contentId"],contentType:[1,"contentType"],compact:[1,"compact"]},standalone:!0,features:[e.aNF],decls:8,vars:7,consts:()=>{let t;return t=$localize`:fd09d25b9e69b686d3fc0154c0b316c7c9f45cec8036200981586016464:Opacity`,[["slider","matSliderThumb"],t,[1,"flex","flex-col","gap-1","gray-400"],[1,"uppercase","text-2xs"],[1,"flex","flex-col","gap-1","p-3","border","border-gray-200","border-solid","rounded"],[1,"flex","flex-row","item-center","text-2xs",3,"ngClass"],[1,"grow"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","transparent","matTooltipPosition","below","data-test","skinToggleButton",1,"rounded-sm","focus:rounded-sm","focus:outline","focus:outline-blue-600",3,"click","matTooltip","lang"],[1,"flex","items-center","justify-center","w-10","h-10","text-black","bg-gray-100","rounded-sm"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm",3,"class"],[1,"break-words","hyphens-auto","text-2xs"],["role","img",1,"w-full","h-full","bg-center","bg-repeat","bg-cover","rounded-sm"],[1,"!w-full","!m-0",3,"min","max","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],[1,"flex","items-center","justify-between","uppercase","text-2xs"]]},template:function(o,s){1&o&&(e.j41(0,"div",2)(1,"div",3),e.EFF(2),e.k0s(),e.j41(3,"div",4)(4,"ul",5),e.Z7z(5,MO,5,9,"li",null,e.fX1),e.k0s(),e.DNE(7,IO,9,5,"div",6),e.k0s()()),2&o&&(e.R7$(2),e.JRh(s.schemaTitle()),e.R7$(2),e.Y8G("ngClass",e.sMw(3,vO,!s.compact(),s.compact(),s.compact())),e.R7$(),e.Dyx(s.themes()),e.R7$(2),e.vxM(!1===s.isOffThemeSelected()?7:-1))},dependencies:[J.MD,J.YU,zs.Ez,zs.IV,zs.OU,Kt.uc,Kt.oV,bn.C,Qt.ri],styles:[".view-skin__image--male--fair{background-image:url(maleskin_variants_fair.png)}.view-skin__image--male--light{background-image:url(maleskin_variants_light.png)}.view-skin__image--male--medium{background-image:url(maleskin_variants_medium.png)}.view-skin__image--male--dark{background-image:url(maleskin_variants_dark.png)}.view-skin__image--male--transparent{background-image:url(maleskin_variants_transparent.png)}.view-skin__image--female--fair{background-image:url(femaleskin_variants_fair.png)}.view-skin__image--female--light{background-image:url(femaleskin_variants_light.png)}.view-skin__image--female--medium{background-image:url(femaleskin_variants_medium.png)}.view-skin__image--female--dark{background-image:url(femaleskin_variants_dark.png)}.view-skin__image--female--transparent{background-image:url(femaleskin_variants_transparent.png)}\n"],encapsulation:2})}return n})();const wO=(n,i)=>i.name;function AO(n,i){if(1&n&&e.nrm(0,"app-view-skin-variants",6,0),2&n){const t=e.XpG();e.Y8G("compact",t.compact())("schema",t.skinVariantsSchema())("lang",t.lang())("contentId",t.storyId())("contentType",t.storyType())}}function RO(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",10)(1,"div",11),e.EFF(2),e.k0s(),e.j41(3,"div",12)(4,"button",13),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.toggleGroupVisibilityClick(s))}),e.j41(5,"div",14),e.nrm(6,"div",15),e.k0s()(),e.j41(7,"div",16)(8,"mat-slider",17)(9,"input",18,1),e.bIt("valueChange",function(s){const a=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.handleSliderChange(a,s,!1,!0))})("input",function(){const s=e.eBV(t).$implicit,a=e.sdS(10),r=e.XpG(2);return e.Njj(r.handleSliderChange(s,a.value,!0,!1))}),e.k0s()()()()()}if(2&n){const t=i.$implicit,o=e.XpG(2);e.AVh("view-visibility-layers__list-item--hidden",!t.visible),e.R7$(2),e.JRh(t.label),e.R7$(2),e.Y8G("buttonTheme","transparent-fill")("matTooltip",t.visible?o.hideLayersTooltip:o.showLayersTooltip),e.BMQ("aria-label",o.getGroupAriaLabel(t.name,t.visible)),e.R7$(2),e.Y8G("className",t.imageClassName),e.R7$(2),e.Y8G("min",0)("max",t.layers.length)("step",1)("showTickMarks",!0),e.R7$(),e.Y8G("value",t.position)}}function NO(n,i){if(1&n&&(e.j41(0,"ul",7),e.Z7z(1,RO,11,12,"li",9,wO),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Dyx(t.viewGroups())}}function kO(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",8)(1,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleAllClick(s.viewGroups(),s.allGroupsHidden()))}),e.EFF(2),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(2),e.SpI(" ",t.allGroupsHidden()?t.showAllLayersTooltip:t.hideAllLayersTooltip," ")}}let Dp=(()=>{class n{constructor(t,o,s,a){this.store=t,this.viewService=o,this.visibilityLayersService=s,this.elementRef=a,this.defaultSystemToImage={label:$localize`Layer`,icon:"layer"},this.systemToImage={"muscular system":{label:$localize`muscular system`,icon:"muscular-system"},"connective tissue":{label:$localize`connective tissue`,icon:"connective-tissue"},"skeletal system":{label:$localize`skeletal system`,icon:"skeletal-system"},"respiratory system":{label:$localize`respiratory system`,icon:"respiratory-system"},"endocrine system":{label:$localize`endocrine system`,icon:"endocrine-system"},"digestive system":{label:$localize`digestive system`,icon:"digestive-system"},"reproductive system":{label:$localize`reproductive system`,icon:"reproductive-system"},"urinary system":{label:$localize`urinary system`,icon:"urinary-system"},"cardiovascular system":{label:$localize`cardiovascular system`,icon:"cardiovascular-system"},"lymphatic system":{label:$localize`lymphatic system`,icon:"lymphatic-system"},"nervous system":{label:$localize`nervous system`,icon:"nervous-system"},"integumentary system":{label:$localize`integumentary system`,icon:"integumentary-system"}},this.showAllLayersTooltip=$localize`Show All Anatomy Layers`,this.hideAllLayersTooltip=$localize`Hide All Anatomy Layers`,this.showLayersTooltip=$localize`Show Layer`,this.hideLayersTooltip=$localize`Hide Layer`,this.skinLayersComponent=(0,e.ebz)(lc),this.selectedChapterLayerGroups=(0,je.ot)(this.store.select(me.N.getSelectedChapterLayerGroups)),this.skinVariantsSchema=(0,je.ot)(this.store.select(dt.getVariantSchema("skin"))),this.skinLayersUI=(0,je.ot)(this.store.select(Ke.getUIEntry(G.SkinLayers))),this.visibilityLayersUI=(0,je.ot)(this.store.select(Ke.getUIEntry(G.VisibilityLayers))),this.lang=(0,je.ot)(this.store.select(de.getViewLanguage)),this.storyId=(0,je.ot)(this.store.select(dt.getStoryId)),this.storyType=(0,je.ot)(this.store.select(dt.getStoryType)),this.compact=(0,e.hFB)(!1),this.showSkinLayers=(0,e.EWP)(()=>{const r=this.skinVariantsSchema(),_=this.skinLayersUI();return!(0,u.isNil)(r)&&_.enable}),this.showVisibilityLayers=(0,e.EWP)(()=>{const r=this.viewGroups(),_=this.visibilityLayersUI();return r.length>0&&_.enable}),this.viewGroups=(0,e.EWP)(()=>{const r=this.selectedChapterLayerGroups();return this.createViewLayerGroups(r)}),this.allGroupsHidden=(0,e.EWP)(()=>this.viewGroups().every(_=>!_.visible))}handleKeyPress(){this.viewService.elementHasFocus(this.elementRef.nativeElement)&&!this.viewService.isMaterialMenuOut()&&this.viewService.toggleLayers(!1)}handleSliderChange(t,o,s,a){this.setLayerGroupVisibility([{...t,position:o}],s,a)}toggleGroupVisibilityClick(t){const o=this.visibilityLayersService.computeGroupPositionsByFraction([t],t.visible?0:1);this.setLayerGroupVisibility(o,!0,!0)}handleToggleAllClick(t,o){this.toggleLayers(t,o)}getGroupAriaLabel(t,o){return o?$localize`Hide ${t} Layer`:$localize`Show ${t} Layer`}toggleLayers(t,o){const s=this.visibilityLayersService.computeGroupPositionsByFraction(t,o?1:0);this.setLayerGroupVisibility(s,!0,!0),this.skinLayersComponent()?.toggleVisibility(o)}setLayerGroupVisibility(t,o,s){const a=this.store.selectSnapshot(me.N.getSelectedChapterId);o&&this.visibilityLayersService.syncLayerGroupsToScene(t),s&&this.visibilityLayersService.syncLayerGroupsToState(a,t,!0)}createViewLayerGroups(t){return t.map((o,s)=>{const{name:a}=o,r=s+1,_=0!==o.position,g=a.toLowerCase(),P=this.systemToImage[g]??this.defaultSystemToImage,F=P===this.defaultSystemToImage?`${P.label} ${r}`:P.label,le="view-visibility-layers__image",ue=[le,`${le}--${P.icon}`].join(" ");return{...o,visible:_,label:F,imageClassName:ue}})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(En),e.rXU(wo),e.rXU(e.aKT))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-visibility-layers"]],viewQuery:function(o,s){1&o&&e.wEZ(s.skinLayersComponent,lc,5),2&o&&e.NyB()},hostBindings:function(o,s){1&o&&e.bIt("keydown.escape",function(){return s.handleKeyPress()},!1,e.EBC)},inputs:{compact:[1,"compact"]},standalone:!0,features:[e.aNF],decls:7,vars:6,consts:()=>{let t;return t=$localize`:3acd4e3a84c66d140da3c19c36a4d0d7ce688e6a6086371624662249440: Changing the value of the sliders will modify visibility of different layers of the model `,[["skinLayers",""],["slider","matSliderThumb"],t,["role","dialog","cdkTrapFocus","",1,"view-visibility-layers",3,"cdkTrapFocusAutoCapture"],[1,"sr-only"],[1,"flex","flex-col","flex-auto","gap-4","view-visibility-layers__list-wraper"],[3,"compact","schema","lang","contentId","contentType"],[1,"view-visibility-layers__list"],[1,"view-visibility-layers__toggle"],[1,"view-visibility-layers__list-item",3,"view-visibility-layers__list-item--hidden"],[1,"view-visibility-layers__list-item"],[1,"mb-1","uppercase","text-2xs"],[1,"view-visibility-layers__slider"],["type","button","app-view-button","","buttonSize","small","buttonShape","square","data-test","viewToolsButton",1,"view-visibility-layers__slider-button",3,"click","buttonTheme","matTooltip"],[1,"relative","flex","items-center","justify-center"],["role","img",3,"className"],[1,"pl-1","pr-6","grow"],[2,"width","100% !important",3,"min","max","step","showTickMarks"],["matSliderThumb","",3,"valueChange","input","value"],["app-view-button","","buttonTheme","light-gray-outline","buttonShape","rounded","buttonSize","small","cdkFocusInitial","",1,"w-full",3,"click"]]},template:function(o,s){1&o&&(e.j41(0,"div",3)(1,"span",4),e.pXf(2,2),e.k0s(),e.j41(3,"div",5),e.DNE(4,AO,2,5,"app-view-skin-variants",6)(5,NO,3,0,"ul",7),e.k0s(),e.DNE(6,kO,3,1,"div",8),e.k0s()),2&o&&(e.AVh("view-visibility-layers--overflow",!s.compact()),e.Y8G("cdkTrapFocusAutoCapture",!s.compact()),e.R7$(4),e.vxM(s.showSkinLayers()?4:-1),e.R7$(),e.vxM(s.showVisibilityLayers()?5:-1),e.R7$(),e.vxM(s.showVisibilityLayers()?6:-1))},dependencies:[mo.kB,Kt.uc,Kt.oV,zs.Ez,zs.IV,zs.OU,bn.C,Qt.ri,lc],styles:[".view-visibility-layers{display:flex;flex-direction:column;position:relative;max-height:100%}.view-visibility-layers__toggle{padding:20px 0}.view-visibility-layers__list{display:flex;flex-direction:column;gap:16px}.view-visibility-layers__list-item{color:#384c6c}.view-visibility-layers__list-item--hidden{color:#6d809f}.view-visibility-layers__slider{display:flex;align-items:center;border:1px solid #d4d9e3;border-radius:4px}.view-visibility-layers__slider-button{border-right:1px solid #d4d9e3!important}.view-visibility-layers__image{display:inline-block;width:20px;height:20px;background-repeat:no-repeat;background-position:center center;background-size:contain}.view-visibility-layers__image--muscular-system{background-image:url(muscular-system.svg)}.view-visibility-layers__image--connective-tissue{background-image:url(connective-tissue.svg)}.view-visibility-layers__image--skeletal-system{background-image:url(skeletal-system.svg)}.view-visibility-layers__image--respiratory-system{background-image:url(respiratory-system.svg)}.view-visibility-layers__image--endocrine-system{background-image:url(endocrine-system.svg)}.view-visibility-layers__image--digestive-system{background-image:url(digestive-system.svg)}.view-visibility-layers__image--reproductive-system{background-image:url(reproductive-system.svg)}.view-visibility-layers__image--urinary-system{background-image:url(urinary-system.svg)}.view-visibility-layers__image--cardiovascular-system{background-image:url(cardiovascular-system.svg)}.view-visibility-layers__image--lymphatic-system{background-image:url(lymphatic-system.svg)}.view-visibility-layers__image--nervous-system{background-image:url(nervous-system.svg)}.view-visibility-layers__image--integumentary-system{background-image:url(integumentary-system.svg)}.view-visibility-layers__image--layer{background-image:url(layer.svg)}.view-visibility-layers--overflow .view-visibility-layers__toggle{background-color:#fff;position:sticky!important;bottom:0}@media (hover: none){.view-visibility-layers input[type=range]{pointer-events:none!important}.view-visibility-layers input[type=range]::-webkit-slider-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-moz-range-thumb{pointer-events:all!important}.view-visibility-layers input[type=range]::-ms-thumb{pointer-events:all!important}}\n"],encapsulation:2,changeDetection:0})}return n})();var Gm=d(20342);function DO(n,i){if(1&n&&e.nrm(0,"a",1),2&n){const t=e.XpG();e.HbH(t.classClasses()),e.xc7("background-image",t.cssBackgroundImage()),e.BMQ("href",t.logoLinkoutUrl(),e.B4B)("rel",t.logoLinkRel())("target","_blank")("title",t.logoTitle())("aria-label",t.logoAriaLabel())}}function LO(n,i){if(1&n&&e.nrm(0,"span",1),2&n){const t=e.XpG();e.HbH(t.classClasses()),e.xc7("background-image",t.cssBackgroundImage()),e.BMQ("title",t.logoTitle())}}let $m=(()=>{class n{constructor(t){this.store=t,this.logoUI=(0,je.ot)(this.store.select(Ke.getUIEntry(G.Logo))),this.logoConfig=(0,je.ot)(this.store.select(Q_.X.getViewLogoConfig)),this.logoSize=(0,e.hFB)("full"),this.logoColor=(0,e.hFB)("color"),this.logoModel=(0,e.EWP)(()=>(0,Gm.g)(this.logoConfig(),this.logoSize(),this.logoColor())),this.logoDisplayMode=(0,e.EWP)(()=>{const o=this.logoUI()?.isHyperLink,s=this.logoLinkoutUrl();return o&&s?"link":"text"}),this.logoImageUrl=(0,e.EWP)(()=>this.logoModel()?.logo_url??""),this.logoLinkoutUrl=(0,e.EWP)(()=>this.logoModel()?.logo_linkout_url??""),this.isCustomBranding=(0,e.EWP)(()=>"logo_swap"===this.logoConfig()?.viewer?.viewer_logo_setting),this.classClasses=(0,e.EWP)(()=>["view-logo",`view-logo--${this.logoSize()}-${this.logoColor()}`]),this.cssBackgroundImage=(0,e.EWP)(()=>`url('${this.logoImageUrl()}')`),this.logoTitle=(0,e.EWP)(()=>this.isCustomBranding()?"":$localize`Powered by BioDigital`),this.logoAriaLabel=(0,e.EWP)(()=>this.isCustomBranding()?$localize`link opens in a new tab`:$localize`Powered by BioDigital (opens in a new tab)`),this.logoLinkRel=(0,e.EWP)(()=>this.isCustomBranding()?"noreferrer nofollow":"")}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-logo"]],inputs:{logoSize:[1,"logoSize"],logoColor:[1,"logoColor"]},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[["data-test","viewLogo",3,"class","background-image"],["data-test","viewLogo"]],template:function(o,s){if(1&o&&e.DNE(0,DO,1,9,"a",0)(1,LO,1,5,"span",0),2&o){let a;e.vxM("link"===(a=s.logoDisplayMode())?0:"text"===a?1:-1)}},dependencies:[J.MD],styles:["[_nghost-%COMP%]{display:flex;align-items:center}.view-logo[_ngcontent-%COMP%]{pointer-events:all;background-position:center center;background-repeat:no-repeat}.view-logo[_ngcontent-%COMP%]:focus{outline:#2472e9 solid 2px!important}.view-logo--small-color[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-color[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo--small-white[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center;height:40px}.view-logo--full-white[_ngcontent-%COMP%]{width:120px;height:33px}.view-logo[_ngcontent-%COMP%]:not([hidden]){display:flex}.view-logo[href][_ngcontent-%COMP%]:hover{cursor:pointer}"],changeDetection:0})}return n})();function Bm(n){if(null==n)return"";const i=new RegExp(/[^a-zA-Z0-9_]/,"gi");return n.replace(i,"_")}var zm=d(6049),So=d(73845),Ws=d(59162);const UO=["progressCircle"],xO=["*"],jO=(n,i)=>({"progress--text-small":n,"progress--animate":i});function VO(n,i){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.progress,"% ")}}function FO(n,i){1&n&&(e.j41(0,"div",7),e.SdG(1),e.k0s())}let Wm=(()=>{class n{get progress(){return this._progress}set progress(t){this._progress=t,this.updateCircle()}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=t}get diameter(){return this._diameter}set diameter(t){this._diameter=t}constructor(t,o){this.renderer=t,this.changeRef=o,this.textSize="default",this._progress=0,this.showPercent=!0,this.strokeColor="#2d72dc",this.fillColor="#ffffff",this.ringColor="#eaeff5",this._strokeWidth=8,this._diameter=120,this.fillOnComplete=!1,this.animate=!0}ngOnInit(){}ngAfterViewInit(){this.updateCircle()}updateCircle(){if(this.progressCircleRef){const o=2*this.progressCircleRef.nativeElement.r.baseVal.value*Math.PI,s=o-this.progress/100*o;this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}this.changeRef.markForCheck()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-progress-circle"]],viewQuery:function(o,s){if(1&o&&e.GBs(UO,7),2&o){let a;e.mGM(a=e.lsd())&&(s.progressCircleRef=a.first)}},inputs:{textSize:"textSize",progress:"progress",showPercent:"showPercent",strokeColor:"strokeColor",fillColor:"fillColor",ringColor:"ringColor",strokeWidth:"strokeWidth",diameter:"diameter",fillOnComplete:"fillOnComplete",animate:"animate"},ngContentSelectors:xO,decls:9,vars:20,consts:[["progressCircle",""],["data-test","progress",1,"progress",3,"ngClass"],["alt",""],[1,"progress__circle"],["class","progress__label","data-test","progressPercentage",4,"ngIf"],["class","progress__content","data-test","progressContent",4,"ngIf"],["data-test","progressPercentage",1,"progress__label"],["data-test","progressContent",1,"progress__content"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"div",1),e.qSk(),e.j41(1,"svg",2)(2,"g"),e.nrm(3,"circle",3),e.k0s(),e.j41(4,"g"),e.nrm(5,"circle",3,0),e.k0s()(),e.DNE(7,VO,2,1,"div",4)(8,FO,2,0,"div",5),e.k0s()),2&o&&(e.Y8G("ngClass",e.l_i(17,jO,"small"===s.textSize,s.animate)),e.R7$(),e.BMQ("width",s.diameter)("height",s.diameter),e.R7$(2),e.BMQ("stroke",s.ringColor)("stroke-width",s.strokeWidth)("fill",s.fillColor)("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),e.R7$(2),e.BMQ("stroke",s.strokeColor)("stroke-width",s.strokeWidth)("fill",100===s.progress&&s.fillOnComplete?s.strokeColor:"transparent")("r",s.diameter/2-s.strokeWidth)("cx",s.diameter/2)("cy",s.diameter/2),e.R7$(2),e.Y8G("ngIf",s.showPercent),e.R7$(),e.Y8G("ngIf",!s.showPercent))},dependencies:[J.YU,J.bT],styles:[".progress[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.progress--animate[_ngcontent-%COMP%]   .progress__circle[_ngcontent-%COMP%]{transition:stroke-dashoffset .35s,fill .35s}.progress--small[_ngcontent-%COMP%]   .progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.progress__ring[_ngcontent-%COMP%]{position:absolute;z-index:1}.progress__circle[_ngcontent-%COMP%]{transform:rotate(-90deg);transform-origin:50% 50%}.progress__label[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;font-weight:600;transform:translate(-50%,-50%);z-index:2;font-size:1.125rem;line-height:1.75rem}.progress__content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:#fff;position:absolute}"],changeDetection:0})}return n})();var Ar=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Rr=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function GO(n,i){if(1&n&&(e.qex(0),e.j41(1,"div",6),e.nrm(2,"app-progress-circle",7),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-progress-circle",8),e.k0s(),e.bVm()),2&n){const t=e.XpG();e.R7$(2),e.Y8G("progress",t.chapterPercent)("showPercent",!1)("animate",!1),e.R7$(2),e.Y8G("progress",t.countdownPercent)("showPercent",!1)("animate",!1)}}class bo{constructor(i,t,o,s){this.viewService=i,this.viewPlaythroughService=t,this.store=o,this.changeDetectorRef=s,this.showCount=!0,this.showPlaythrough=!1,this.buttonSize=Qt.Mp.Default,this.iconSize="md",this.buttonTheme="transparent-fill",this.interval=null,this.chapterPercent=0,this.countdownPercent=0,this.ngUnsubscribe=new k.B}ngOnInit(){this.initChapterListener(),this.initPlaythrough()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.stopChapterTimer()}handlePreviousClick(){this.viewService.previousChapter("Pagination")}handleNextClick(){this.viewService.nextChapter("Pagination")}initChapterListener(){this.store.select(me.N.getSelectedChapterId).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.stopChapterTimer()}),(0,cn.z)([this.store.select(ze.S.getChapter),this.store.select(de.getPlaythroughEnabled)]).pipe((0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{this.chapterPercent=0,t?this.startChapterTimer():this.stopChapterTimer()})}initPlaythrough(){this.viewPlaythroughService.countdownChanged.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const{countdown:t}=this.store.selectSnapshot(de.getPlaythroughSettings);this.countdownPercent=Math.floor(100-i/t*100),this.changeDetectorRef.markForCheck()})}startChapterTimer(){this.chapterPercent=0,this.countdownPercent=0,this.stopChapterTimer(),this.interval=setInterval(()=>{const i=this.viewPlaythroughService.calculateMaximumRemainingTime();this.chapterPercent=Math.ceil(i.current/i.duration*100),this.chapterPercent>100&&(this.chapterPercent=100),this.changeDetectorRef.markForCheck()},50)}stopChapterTimer(){this.interval&&clearInterval(this.interval),this.interval=null}static#e=this.\u0275fac=function(t){return new(t||bo)(e.rXU(En),e.rXU(dm),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:bo,selectors:[["app-view-pagination"]],inputs:{showCount:"showCount",showPlaythrough:"showPlaythrough",buttonSize:"buttonSize",iconSize:"iconSize",buttonTheme:"buttonTheme"},standalone:!0,features:[e.aNF],decls:10,vars:17,consts:()=>{let i,t,o;return i=$localize`:30249dc18ca1115e36390baf1cfe06e1805b6963744656089369810133:Chapter pagination`,t=$localize`:3228d65908ec43ba657d860b050c2a3871868cee8424575283863104959:Previous Chapter`,o=$localize`:95f5388846a3beaee5f870eb0996ed47d9c7819a8192680256063110394:Next Chapter`,[["aria-label",i,1,"view-pagination"],["data-test","viewPreviousChapter","aria-label",t,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],["icon","arrow-left","appLogicalDir","",3,"size"],["data-test","viewNextChapter","aria-label",o,"app-view-button","",3,"click","buttonSize","buttonTheme","disabled"],[4,"ngIf"],["icon","arrow-right","appLogicalDir","",3,"size"],[1,"view-pagination__playthrough"],["fillColor","transparent","ringColor","#eaeff5","strokeColor","#96a8c0","diameter","28","strokeWidth","3",3,"progress","showPercent","animate"],["fillColor","transparent","ringColor","transparent","strokeColor","#374a68","diameter","28","strokeWidth","3",3,"progress","showPercent","animate"]]},template:function(t,o){1&t&&(e.j41(0,"nav",0)(1,"button",1),e.nI1(2,"async"),e.bIt("click",function(){return o.handlePreviousClick()}),e.nrm(3,"app-icon",2),e.k0s(),e.j41(4,"button",3),e.nI1(5,"async"),e.nI1(6,"async"),e.bIt("click",function(){return o.handleNextClick()}),e.DNE(7,GO,5,6,"ng-container",4),e.nI1(8,"async"),e.nrm(9,"app-icon",5),e.k0s()()),2&t&&(e.R7$(),e.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",0===e.bMT(2,9,o.chapterIndex$)?"true":null),e.R7$(2),e.Y8G("size",o.iconSize),e.R7$(),e.Y8G("buttonSize",o.buttonSize)("buttonTheme",o.buttonTheme)("disabled",e.bMT(5,11,o.chapterIndex$)===e.bMT(6,13,o.chapterCount$)-1?"true":null),e.R7$(3),e.Y8G("ngIf",e.bMT(8,15,o.playthroughEnabled$)),e.R7$(2),e.Y8G("size",o.iconSize))},dependencies:[J.MD,J.bT,J.Jj,bn.C,Qt.ri,sn.o,ut.R,Ws.M,Wm],styles:["@keyframes _ngcontent-%COMP%_disappear{0%{top:0}to{top:100%}}.view-pagination[_ngcontent-%COMP%]{display:flex;position:relative;white-space:nowrap}.view-pagination__count[_ngcontent-%COMP%]{font-size:14px;padding:0 8px}.view-pagination__playthrough[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center}"],changeDetection:0})}Ar([(0,l.l6)(me.N.getSelectedChapterIndex),Rr("design:type",h.c)],bo.prototype,"chapterIndex$",void 0),Ar([(0,l.l6)(me.N.getNextChapter),Rr("design:type",h.c)],bo.prototype,"nextChapter$",void 0),Ar([(0,l.l6)(me.N.getPreviousChapter),Rr("design:type",h.c)],bo.prototype,"previousChapter$",void 0),Ar([(0,l.l6)(me.N.getChapterCount),Rr("design:type",h.c)],bo.prototype,"chapterCount$",void 0),Ar([(0,l.l6)(de.getPlaythroughEnabled),Rr("design:type",h.c)],bo.prototype,"playthroughEnabled$",void 0);let BO=(()=>{class n{transform(t,o){return Bm(t)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275pipe=e.EJ8({name:"elementID",type:n,pure:!0})}return n})();const zO=["chapter"],WO=n=>({"view-chapters__item--viewed":n}),XO=n=>({"outline outline-blue-600 outline-2":n});function HO(n,i){if(1&n){const t=e.RV6();e.nrm(0,"app-pillbox-divider"),e.j41(1,"button",12,1),e.bIt("menuOpened",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleChapterMenuOpen())}),e.j41(3,"div",13)(4,"div",14)(5,"span",15),e.pXf(6,3),e.k0s(),e.j41(7,"div",16),e.EFF(8),e.k0s(),e.j41(9,"div",17),e.EFF(10),e.qex(11),e.pXf(12,4),e.bVm(),e.EFF(13),e.k0s()(),e.j41(14,"div",18),e.nrm(15,"app-icon",19),e.k0s()()()}if(2&n){const t=e.XpG(2),o=e.sdS(4);e.R7$(),e.Y8G("matMenuTriggerFor",o),e.R7$(7),e.SpI(" ",t.getFormattedChapterTitle(t.chapterTitle(),t.chapterIndex())," "),e.R7$(2),e.SpI(" ",t.chapterIndex()+1," "),e.R7$(3),e.SpI(" ",t.chapterCount()," ")}}function QO(n,i){if(1&n&&(e.j41(0,"div",7),e.nrm(1,"app-view-pagination",11),e.DNE(2,HO,16,4),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("showCount",!1),e.R7$(),e.vxM(t.showTitle()?2:-1)}}function YO(n,i){if(1&n&&(e.j41(0,"div",8)(1,"span",20),e.EFF(2),e.k0s()()),2&n){const t=e.XpG();e.R7$(2),e.JRh(t.getFormattedChapterTitle(t.chapterTitle(),t.chapterIndex()))}}function KO(n,i){1&n&&(e.j41(0,"span",15),e.pXf(1,5),e.k0s())}function qO(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",21,2),e.nI1(2,"elementID"),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleChapterClick(s))}),e.nrm(3,"div",22),e.j41(4,"div",23),e.EFF(5),e.k0s(),e.DNE(6,KO,2,0,"span",15),e.k0s()}if(2&n){const t=i.$implicit,o=i.$index,s=e.XpG();e.Y8G("ngClass",e.eq3(10,WO,s.isViewed(t.id))),e.BMQ("data-chapter-id",e.bMT(2,8,t.id)),e.R7$(3),e.Y8G("ngClass",e.eq3(12,XO,t.id===s.selectedChapterId()))("defaultImage",s.defaultImage)("lazyLoad",s.getChapterThumb(t.id)),e.R7$(2),e.Lme(" ",o+1,": ",s.getFormattedChapterTitle(t.displayName,o)," "),e.R7$(),e.vxM(t.id===s.selectedChapterId()?6:-1)}}let Lp=(()=>{class n{constructor(t,o){this.viewService=t,this.store=o,this.defaultImage="/assets/images/view-chapter-thumbnail-placeholder.png",this.chapterElements=(0,e.dtW)("chapter",{read:e.aKT}),this.chapterTitle=(0,je.ot)(this.store.select(me.N.getSelectedChapterTitle)),this.chapterIndex=(0,je.ot)(this.store.select(me.N.getSelectedChapterIndex)),this.chapterCount=(0,je.ot)(this.store.select(me.N.getChapterCount)),this.chapters=(0,je.ot)(this.store.select(me.N.getStoryChapters)),this.selectedChapterId=(0,je.ot)(this.store.select(me.N.getSelectedChapterId)),this.showPagination=(0,e.hFB)(!0),this.showTitle=(0,e.hFB)(!0)}getChapterThumb(t){const s=this.store.selectSnapshot(Go.K.getRegisteredThumbnails).get(t);return s?s.snapshot||s.urls.small:""}getFormattedChapterTitle(t,o){return t||$localize`Chapter`+` ${o+1}`}isViewed(t){return this.store.selectSnapshot(me.N.getChaptersViewed).some(o=>o===t)}handleChapterMenuOpen(){setTimeout(()=>{this.scrollToSelectedChapter()})}handleNextClick(){this.viewService.nextChapter("titleOnly")}handleChapterClick(t){this.viewService.selectChapter(t)}handlePreviousClick(){this.viewService.previousChapter("titleOnly")}scrollToSelectedChapter(){const t=Bm(this.store.selectSnapshot(me.N.getSelectedChapterId));this.chapterElements().find(a=>a.nativeElement.dataset.chapterId===t)?.nativeElement.scrollIntoView({block:"center"})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-title-only"]],viewQuery:function(o,s){1&o&&e.wEZ(s.chapterElements,zO,5,e.aKT),2&o&&e.NyB()},inputs:{showPagination:[1,"showPagination"],showTitle:[1,"showTitle"]},standalone:!0,features:[e.aNF],decls:7,vars:1,consts:()=>{let t,o,s;return t=$localize`:0498f53592b97136a56a48a29c54aea03a15b5e09209125563388589034:Chapter List`,o=$localize`:169eed2bc3e08e1bea977bcc5d799379f6b8a7585881876145178332550:of`,s=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["chapterMenu","matMenu"],["chapterMenuTrigger","matMenuTrigger"],["chapter",""],t,o,s,["orientation","horizontal","data-test","viewTitleOnly","appPreventFadeout","",1,"relative"],[1,"flex","w-full","min-w-0"],["data-test","viewStaticTitle",1,"view-title-only__title","view-title-only__title--static"],[1,"view-chapters"],["mat-menu-item","",1,"view-chapters__item",3,"ngClass"],["data-test","viewFloatingPagination","buttonSize","small","iconSize","lg",3,"showCount"],["app-view-button","","data-test","viewChaptersButton","buttonSize","small",1,"w-full","min-w-0",3,"menuOpened","matMenuTriggerFor"],[1,"flex","flex-row","w-full"],[1,"px-2","py-0","overflow-hidden","text-start","grow"],[1,"sr-only"],[1,"view-title-only__title","view-title-only__title--truncated"],[1,"view-title-only__count"],[1,"view-title-only__icon"],["icon","angle-down","size","lg"],[1,"view-title-only__title--truncated"],["mat-menu-item","",1,"view-chapters__item",3,"click","ngClass"],[1,"view-chapters__thumb",3,"ngClass","defaultImage","lazyLoad"],[1,"view-chapters__title"]]},template:function(o,s){1&o&&(e.j41(0,"app-pillbox",6),e.DNE(1,QO,3,2,"div",7)(2,YO,3,1,"div",8),e.k0s(),e.j41(3,"mat-menu",9,0),e.Z7z(5,qO,7,14,"button",10,e.Vm6),e.k0s()),2&o&&(e.R7$(),e.vxM(s.showPagination()?1:s.showTitle()?2:-1),e.R7$(4),e.Dyx(s.chapters()))},dependencies:[J.MD,J.YU,un.Cn,un.kk,un.fb,un.Cp,ps.b,no,oc,bn.C,Qt.ri,sn.o,ut.R,zm.Y,BO,So.Un,So.Je,bo],styles:[".view-title-only{display:flex;align-items:center}.view-title-only__title{font-size:.875rem;line-height:1.25rem;font-weight:600;color:#0c1726}.view-title-only__title--static{padding:0 12px;min-height:40px;display:flex;align-items:center;min-width:0}.view-title-only__title--truncated{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.view-title-only__count{font-size:10px;text-transform:uppercase;color:#384c6c}.view-title-only__icon{display:flex;align-items:center;padding:0 8px}.view-chapters{min-width:300px;max-height:228px;overflow:auto}.view-chapters button.mat-mdc-menu-item{width:100%;height:auto;font-size:.75rem;line-height:1rem}.view-chapters div.mat-mdc-menu-content{padding:0}.view-chapters .mat-mdc-menu-item-text{display:flex;line-height:1.4em!important}.view-chapters__item{height:auto;white-space:normal;display:flex!important;padding:12px 20px!important;background-color:transparent;width:240px;transition:background-color 125ms,color 125ms}.view-chapters__item:first-of-type{border-top-left-radius:4px;border-top-right-radius:4px}.view-chapters__item:last-of-type{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.view-chapters__item:hover{cursor:pointer;background:#e7eaee}.view-chapters__item--selected{background-color:#2472e9!important;--mat-menu-item-label-text-color: #ffffff}.view-chapters__thumb{background-size:cover;background-color:#f8f9fa;border-radius:4px;background-repeat:no-repeat;border:2px solid white;flex:0 0 52px;height:52px;width:52px;transition:border-color .1s}.view-chapters__title{overflow-wrap:break-word;padding-inline-start:16px;word-break:break-word;white-space:normal;display:flex;flex-grow:1;font-weight:500}\n"],encapsulation:2,changeDetection:0})}return n})();const JO=["zones"],ZO=[[["","top",""]],[["","left",""]],[["","right",""]],[["","bottom",""]]],eM=["[top]","[left]","[right]","[bottom]"];let Xm=(()=>{class n{constructor(){this.zoneElRef=(0,e.ebz)("zones"),this.showZones=(0,e.hFB)([]),this.verticalPadding=(0,e.hFB)(12),this.horizontalPadding=(0,e.hFB)(12),(0,e.QZP)(()=>{const t=this.zoneElRef()?.nativeElement,o=this.verticalPadding(),s=this.horizontalPadding();t?.style?.setProperty("--zone-vertical-padding",`${o}px`),t?.style?.setProperty("--zone-horizontal-padding",`${s}px`)})}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-zones"]],viewQuery:function(o,s){1&o&&e.wEZ(s.zoneElRef,JO,5),2&o&&e.NyB()},inputs:{showZones:[1,"showZones"],verticalPadding:[1,"verticalPadding"],horizontalPadding:[1,"horizontalPadding"]},standalone:!0,features:[e.aNF],ngContentSelectors:eM,decls:10,vars:4,consts:[["zones",""],[1,"view-zones"],[1,"view-zones__zone","view-zones__zone--top"],[1,"view-zones__zone","view-zones__zone--left"],[1,"view-zones__zone","view-zones__zone--right"],[1,"view-zones__zone","view-zones__zone--bottom"]],template:function(o,s){1&o&&(e.NAR(ZO),e.j41(0,"div",1,0)(2,"div",2),e.SdG(3),e.k0s(),e.j41(4,"div",3),e.SdG(5,1),e.k0s(),e.j41(6,"div",4),e.SdG(7,2),e.k0s(),e.j41(8,"div",5),e.SdG(9,3),e.k0s()()),2&o&&(e.R7$(2),e.Y8G("@isShown",s.showZones().includes("top")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones().includes("left")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones().includes("right")?"shown":"hidden"),e.R7$(2),e.Y8G("@isShown",s.showZones().includes("bottom")?"shown":"hidden"))},styles:['[_nghost-%COMP%]{width:100%;height:100%;--zone-vertical-padding: 12px;--zone-horizontal-padding: 12px}.view-zones[_ngcontent-%COMP%]{width:100%;height:100%;display:grid;grid-template-areas:"top top top" "left . right" "bottom bottom bottom";grid-template-columns:minmax(40px,auto) 1fr minmax(40px,auto);grid-template-rows:auto 1fr auto;padding:var(--zone-vertical-padding) var(--zone-horizontal-padding);pointer-events:none;position:absolute;z-index:20}.view-zones__zone[_ngcontent-%COMP%]{opacity:0;display:flex;gap:8px}.view-zones__zone--left[_ngcontent-%COMP%]{grid-area:left;flex-direction:column}.view-zones__zone--right[_ngcontent-%COMP%]{grid-area:right;flex-direction:column}.view-zones__zone--top[_ngcontent-%COMP%]{grid-area:top;flex-direction:row;opacity:1}.view-zones__zone--top[_ngcontent-%COMP%]:not(:empty){margin-bottom:8px}.view-zones__zone--bottom[_ngcontent-%COMP%]{grid-area:bottom;flex-direction:row;justify-content:flex-end}.view-zones__zone--bottom[_ngcontent-%COMP%]:not(:empty){margin-top:8px}'],data:{animation:[(0,xe.hZ)("isShown",[(0,xe.wk)("shown",(0,xe.iF)({opacity:1})),(0,xe.wk)("hidden",(0,xe.iF)({opacity:0})),(0,xe.kY)("hidden => shown",[(0,xe.i0)("300ms ease-out")]),(0,xe.kY)("shown => hidden",[(0,xe.i0)("150ms ease-in")])])]},changeDetection:0})}return n})();var ji=d(84370);let tM=(()=>{class n{constructor(t,o){this.dialogRef=t,this.data=o,this.config=o}handleCloseClick(){this.dialogRef.close()}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-video-dialog"]],decls:4,vars:2,consts:[["role","dialog","aria-modal","true",1,"video-dialog"],["mode","full",1,"video-dialog__video",3,"sources"],["type","button","app-view-button","","buttonShape","rounded","buttonTheme","white","matTooltip","Close Dialog","matTooltipPosition","left","aria-label","Close Dialog",1,"video-dialog__close",3,"click"],["icon","times"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.nrm(1,"app-video-view",1),e.j41(2,"button",2),e.bIt("click",function(){return s.handleCloseClick()}),e.nrm(3,"app-icon",3),e.k0s()()),2&o&&(e.BMQ("aria-label",(s.config.title||"")+" Video Dialog"),e.R7$(),e.Y8G("sources",s.config.videoSources))},dependencies:[ut.R,Tm,Qt.ri],styles:[".video-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.video-dialog__video[_ngcontent-%COMP%]{display:block;max-width:100%}.video-dialog__close[_ngcontent-%COMP%]{position:fixed;top:24px;inset-inline-end:24px}"],changeDetection:0})}return n})();const Up=[{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.mpd",type:"application/dash+xml"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.m3u8",type:"application/x-mpegURL"},{src:"/umedia/video/a5b42697-64f5-43e1-97d2-48e62b8945ed/viewer.0000022.jpg",type:"image/jpeg"}];let xp=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,mo.Pd,Nt.G]})}return n})();var jp=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Vp=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class hs{constructor(i,t,o){this.store=i,this.visibilityLayersService=t,this.changeDetectorRef=o,this.accessibleLabel=$localize`layer slider`,this.percent=100,this.ngUnsubscribe=new k.B}ngOnInit(){this.initIndexPositionObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initIndexPositionObserver(){(0,cn.z)([this.selectedChapterCurrentLayersIndex$,this.selectedChapterCurrentLayersPosition$,this.selectedChapterCurrentLayers$]).pipe((0,D.p)(([i,t,o])=>!(0,u.isNil)(i)&&!(0,u.isNil)(t)&&!(0,u.isNil)(o)),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o])=>{const s=this.visibilityLayersService.indexPositionToFraction(o,i,t);this.percent=this.visibilityLayersService.fractionToPercent(s),this.changeDetectorRef.markForCheck()})}handleDragEnded(i){this.syncSliderLayers(i,!1,!0)}handleTrackClicked(i){this.syncSliderLayers(i,!1,!0)}handlePercentChanged(i){this.syncSliderLayers(i,!0,!1)}syncSliderLayers(i,t,o){const s=this.store.selectSnapshot(me.N.getSelectedChapterId),a=this.store.selectSnapshot(me.N.getSelectedChapterCurrentLayers),r=this.visibilityLayersService.percentToFraction(i),_=this.visibilityLayersService.fractionToIndex(a,r),g=this.visibilityLayersService.fractionToPosition(a,r,_);t&&this.visibilityLayersService.syncLayersToScene(a,_,g,!1),o&&this.visibilityLayersService.syncLayersToState(s,_,g)}static#e=this.\u0275fac=function(t){return new(t||hs)(e.rXU(l.il),e.rXU(to),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:hs,selectors:[["app-view-layers-slider"]],standalone:!0,features:[e.aNF],decls:4,vars:3,consts:()=>{let i;return i=$localize`:78670204058ee08d827f2323fab98b7520c7c51e7032204075609591368: Changing the value of the slider will modify visibility of different layers of the model `,[i,[1,"flex","justify-center","w-full",2,"height","200px"],[1,"sr-only"],["sliderAxis","y",3,"percentChanged","dragEnded","trackClicked","percent","showTrack","accessibleLabel"]]},template:function(t,o){1&t&&(e.j41(0,"div",1)(1,"span",2),e.pXf(2,0),e.k0s(),e.j41(3,"app-view-slider",3),e.bIt("percentChanged",function(a){return o.handlePercentChanged(a)})("dragEnded",function(a){return o.handleDragEnded(a)})("trackClicked",function(a){return o.handleTrackClicked(a)}),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("percent",o.percent)("showTrack",!0)("accessibleLabel",o.accessibleLabel))},dependencies:[xp,Fm],styles:['.view-layers-slider[_ngcontent-%COMP%]{--track-width: 5px;height:200px;width:40px;display:flex;justify-content:center}.view-layers-slider--disabled[_ngcontent-%COMP%]{opacity:.25;pointer-events:none}.view-layers-slider__group[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;width:28px;height:100%}.view-layers-slider__track[_ngcontent-%COMP%]{cursor:pointer;position:absolute;background:#8999b399;z-index:1;width:var(--track-width);border-radius:var(--track-width);top:14px;bottom:14px}.view-layers-slider__bar[_ngcontent-%COMP%]{position:absolute;background:#384c6c;width:var(--track-width);border-radius:var(--track-width);z-index:2;height:0;top:0;pointer-events:none}.view-layers-slider__handle[_ngcontent-%COMP%]{cursor:pointer;width:28px;height:28px;margin-top:-14px;top:14px;display:flex;align-items:center;justify-content:center;position:absolute;z-index:2}.view-layers-slider__handle[_ngcontent-%COMP%]:focus{outline:none;border:none}.view-layers-slider__handle--hide[_ngcontent-%COMP%]{display:none}.view-layers-slider__handle[_ngcontent-%COMP%]:after{content:"";width:12px;height:12px;border-radius:6px;background:#384c6c;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}.view-layers-slider__handle[_ngcontent-%COMP%]:hover:after, .view-layers-slider__handle[_ngcontent-%COMP%]:focus:after{background:#2472e9}'],changeDetection:0})}jp([(0,l.l6)(me.N.getSelectedChapterCurrentLayers),Vp("design:type",h.c)],hs.prototype,"selectedChapterCurrentLayers$",void 0),jp([(0,l.l6)(me.N.getSelectedChapterCurrentLayersIndex),Vp("design:type",h.c)],hs.prototype,"selectedChapterCurrentLayersIndex$",void 0),jp([(0,l.l6)(me.N.getSelectedChapterCurrentLayersPosition),Vp("design:type",h.c)],hs.prototype,"selectedChapterCurrentLayersPosition$",void 0);var Ra=d(28203);const nM=["viewMenu"],iM=["viewQuizMenu"],oM=n=>({"bg-blue-600 text-white":n}),sM=n=>({"font-bold":n});function aM(n,i){1&n&&e.nrm(0,"app-icon",39)}function rM(n,i){1&n&&e.nrm(0,"app-icon",40)}function lM(n,i){1&n&&e.nrm(0,"app-icon",41)}function cM(n,i){if(1&n&&(e.j41(0,"button",34)(1,"div",38),e.DNE(2,aM,1,0,"app-icon",39)(3,rM,1,0,"app-icon",40)(4,lM,1,0,"app-icon",41),e.k0s()()),2&n){let t;const o=e.XpG(2),s=e.sdS(22);e.Y8G("matMenuTriggerFor",s)("matTooltipPosition",o.tooltipPosition),e.R7$(2),e.vxM((t=o.activeTool())===o.toolEnum.Hide?2:t===o.toolEnum.Fade?3:4)}}function dM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",42),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleLayers())}),e.nrm(1,"app-icon",43),e.k0s()}if(2&n){let t;const o=e.XpG(2);e.Y8G("buttonTheme","show"===(null==(t=o.visibilityLayersUI())?null:t.status)?"blue-fill":"transparent-fill")("matTooltipPosition",o.tooltipPosition),e.BMQ("data-test-visibility-layers",o.visibilityLayersVisible())("data-test-skin-layers",o.skinLayersVisible())}}function _M(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",44),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleSearch())}),e.nrm(1,"app-icon",45),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("buttonTheme","show"===t.searchStatus()?"blue-fill":"transparent-fill")("matTooltipPosition",t.tooltipPosition),e.BMQ("aria-pressed","show"===t.searchStatus())}}function pM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",46),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleDraw())}),e.nrm(1,"app-icon",47),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("matTooltipPosition",t.tooltipPosition)}}function uM(n,i){if(1&n&&e.DNE(0,cM,5,3,"button",34)(1,dM,2,4,"button",35)(2,_M,2,3,"button",36)(3,pM,2,1,"button",37),2&n){const t=e.XpG();e.vxM(t.toolsVisible()?0:-1),e.R7$(),e.vxM(t.visibilityLayersVisible()?1:-1),e.R7$(),e.vxM(t.searchVisible()?2:-1),e.R7$(),e.vxM(t.whiteboardVisible()?3:-1)}}function hM(n,i){if(1&n&&(e.j41(0,"button",22),e.nrm(1,"app-icon",48),e.k0s()),2&n){const t=e.XpG(),o=e.sdS(6),s=e.sdS(25);e.Y8G("matMenuTriggerFor",t.heightBreakpoint()>t.canvasHeightBreakpoint.Small?s:o)("matTooltipPosition",t.tooltipPosition)}}function gM(n,i){1&n&&(e.j41(0,"app-pillbox",23),e.nrm(1,"app-view-layers-slider"),e.k0s())}function mM(n,i){1&n&&e.nrm(0,"app-icon",53)}function fM(n,i){1&n&&e.nrm(0,"app-icon",54)}function SM(n,i){1&n&&e.nrm(0,"app-icon",55)}function bM(n,i){if(1&n&&(e.j41(0,"button",49),e.DNE(1,mM,1,0,"app-icon",53)(2,fM,1,0,"app-icon",54)(3,SM,1,0,"app-icon",55),e.qex(4),e.pXf(5,8),e.bVm(),e.k0s()),2&n){let t;const o=e.XpG(2),s=e.sdS(22);e.Y8G("matMenuTriggerFor",s),e.R7$(),e.vxM((t=o.activeTool())===o.toolEnum.Hide?1:t===o.toolEnum.Fade?2:3)}}function yM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",56),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleLayers())}),e.nrm(1,"app-icon",57),e.qex(2),e.pXf(3,9),e.bVm(),e.k0s()}if(2&n){const t=e.XpG(2);e.BMQ("data-test-visibility-layers",t.visibilityLayersVisible())("data-test-skin-layers",t.skinLayersVisible())}}function vM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",58),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleSearch())}),e.nrm(1,"app-icon",59),e.qex(2),e.pXf(3,10),e.bVm(),e.k0s()}}function EM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",60),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleDraw())}),e.nrm(1,"app-icon",61),e.qex(2),e.pXf(3,11),e.bVm(),e.k0s()}}function CM(n,i){if(1&n&&e.DNE(0,bM,6,2,"button",49)(1,yM,4,2,"button",50)(2,vM,4,0,"button",51)(3,EM,4,0,"button",52),2&n){const t=e.XpG();e.vxM(t.toolsVisible()?0:-1),e.R7$(),e.vxM(t.visibilityLayersVisible()&&t.heightBreakpoint()<t.canvasHeightBreakpoint.Standard?1:-1),e.R7$(),e.vxM(t.searchVisible()?2:-1),e.R7$(),e.vxM(t.whiteboardVisible()?3:-1)}}function TM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",63),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleSelectTool(s.id))}),e.j41(1,"div",64)(2,"div",65),e.nrm(3,"app-icon",66),e.k0s(),e.j41(4,"div",67),e.EFF(5),e.k0s()()()}if(2&n){const t=i.$implicit,o=e.XpG(2);e.BMQ("data-test","viewQuizTools"+t.label),e.R7$(2),e.Y8G("ngClass",e.eq3(5,oM,o.activeTool()===t.id)),e.R7$(),e.Y8G("icon",t.icon),e.R7$(),e.Y8G("ngClass",e.eq3(7,sM,o.activeTool()===t.id)),e.R7$(),e.SpI(" ",t.label," ")}}function OM(n,i){if(1&n&&e.Z7z(0,TM,6,9,"button",62,e.Vm6),2&n){const t=e.XpG();e.Dyx(t.tools)}}function MM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",68),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleTakeQuiz())}),e.nrm(1,"app-icon",69),e.qex(2),e.pXf(3,12),e.bVm(),e.k0s()}if(2&n){let t;const o=e.XpG();e.Y8G("disabled",!(null!=(t=o.selectedChapterReady())&&t.model)||o.quizActive())}}function IM(n,i){1&n&&(e.qex(0),e.pXf(1,13),e.bVm())}function PM(n,i){1&n&&(e.qex(0),e.pXf(1,14),e.bVm())}function wM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",70),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleLabels())}),e.DNE(1,IM,2,0,"ng-container")(2,PM,2,0,"ng-container"),e.k0s()}if(2&n){const t=e.XpG();e.R7$(),e.vxM(t.showLabels()?1:2)}}function AM(n,i){1&n&&(e.qex(0),e.pXf(1,15),e.bVm())}function RM(n,i){1&n&&(e.qex(0),e.pXf(1,16),e.bVm())}function NM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",72),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.toggleXRModeClick("immersive-vr"))}),e.nrm(1,"app-icon",73),e.DNE(2,AM,2,0,"ng-container")(3,RM,2,0,"ng-container"),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled","immersive-ar"===t.xrSessionMode()),e.R7$(2),e.vxM(t.isVRActive()?2:3)}}function kM(n,i){1&n&&(e.qex(0),e.pXf(1,17),e.bVm())}function DM(n,i){1&n&&(e.qex(0),e.pXf(1,18),e.bVm())}function LM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",72),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.toggleXRModeClick("immersive-ar"))}),e.nrm(1,"app-icon",74),e.DNE(2,kM,2,0,"ng-container")(3,DM,2,0,"ng-container"),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled","immersive-vr"===t.xrSessionMode()),e.R7$(2),e.vxM(t.isARActive()?2:3)}}function UM(n,i){if(1&n&&e.DNE(0,NM,4,2,"button",71)(1,LM,4,2,"button",71),2&n){const t=e.XpG();e.vxM(t.isVREnabled()?0:-1),e.R7$(),e.vxM(t.isAREnabled()?1:-1)}}function xM(n,i){if(1&n&&(e.j41(0,"button",33),e.pXf(1,19),e.k0s()),2&n){e.XpG();const t=e.sdS(12);e.Y8G("matMenuTriggerFor",t)}}let Fp=(()=>{class n{constructor(t,o,s,a,r,_){this.viewService=t,this.viewUIService=o,this.quizService=s,this.dialog=a,this.store=r,this.directionality=_,this.toolEnum=dn.s,this.canvasHeightBreakpoint=zo.h,this.bookmarkViewMode=we,this.tools=[{id:dn.s.Select,label:$localize`Select`,icon:"mouse-pointer"},{id:dn.s.Hide,label:$localize`Hide`,icon:"eye-slash"},{id:dn.s.Fade,label:$localize`Fade`,icon:"adjust"}],this.viewMenu=(0,e.ebz)("viewMenu"),this.viewQuizMenu=(0,e.ebz)("viewQuizMenu"),this.heightBreakpoint=(0,je.ot)(this.store.select(ze.S.getCanvasHeightBreakpoint)),this.toolsVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Tools))),this.visibilityLayersVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.VisibilityLayers))),this.visibilityLayersUI=(0,je.ot)(this.store.select(Ke.getUIEntry(G.VisibilityLayers))),this.skinLayersVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.SkinLayers))),this.searchVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Search))),this.whiteboardVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Whiteboard))),this.toggleLabelsVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.ToggleLabels))),this.helpVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Help))),this.playthroughVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Playthrough))),this.toolbarOverflowVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.ToolbarOverflow))),this.quizPromptVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.QuizPrompt))),this.searchStatus=(0,je.ot)(this.store.select(Ke.getSearchStatus)),this.hasQuiz=(0,je.ot)(this.store.select(Fe.j.hasQuiz)),this.quizEnabled=(0,je.ot)(this.store.select(Fe.j.getQuizEnabled)),this.quizLocked=(0,je.ot)(this.store.select(Fe.j.getQuizModeLocked)),this.quizActive=(0,je.ot)(this.store.select(Fe.j.getQuizModeActive)),this.showLabels=(0,je.ot)(this.store.select(ze.S.getShowLabels)),this.activeTool=(0,je.ot)(this.store.select(ze.S.getActiveTool)),this.selectedChapterReady=(0,je.ot)(this.store.select(me.N.getSelectedChapterReadyState)),this.selectedBookmarkViewMode=(0,je.ot)(this.store.select(ft.getSelectedBookmarkViewMode)),this.isMobileWeb=(0,je.ot)(this.store.select(de.getIsMobileWeb)),this.xrSessionMode=(0,je.ot)(this.store.select(On.U.getXRSessionMode)),this.xrSupportedModes=(0,je.ot)(this.store.select(On.U.getXRSupportedModes)),this.xrEnabled=(0,je.ot)(this.store.select(On.U.getXREnabled)),this.xrActive=(0,je.ot)(this.store.select(On.U.getXRActive)),this.isVREnabled=(0,je.ot)(this.store.select(On.U.getVREnabled)),this.isAREnabled=(0,je.ot)(this.store.select(On.U.getAREnabled)),this.isVRActive=(0,je.ot)(this.store.select(On.U.getVRActive)),this.isARActive=(0,je.ot)(this.store.select(On.U.getXRActive)),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleSearch(){this.viewService.toggleSearch()}handleDraw(){this.viewService.toggleWhiteboard(!0)}handleSelectTool(t){(0,u.isNil)(t)||this.viewService.selectTool(t)}handleLayers(){this.viewService.toggleLayers()}handleToggleLabels(){this.viewService.showLabels()}handleTakeQuiz(){this.quizService.startQuiz()}handleHelpShortcuts(){this.viewService.toggleHelp(te.Shortcuts)}handleHelpBasics(){this.viewService.toggleHelp(te.Basics)}handlePlaythrough(t){this.viewService.togglePlaythrough(t)}handleTutorial(){this.viewService.toggleTutorial(!0)}handleVideo(t){this.dialog.open(tM,{id:ji.t.VideoDialog,backdropClass:"bd-dialog-backdrop",panelClass:"bd-dialog-panel",disableClose:!1,data:{videoSources:Up}}),t.stopPropagation()}isEnabled(t){return this.viewUIService.isUIEnabled(t)}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}toggleXRModeClick(t){this.store.selectSnapshot(On.U.getXRSessionMode)?this.store.dispatch(new Ui.W.ExitXR(!1)):this.store.dispatch(new Ui.W.EnterXR(t))}openRemoteQuest(){const t=new URL("https://oculus.com/open_url/");t.searchParams.set("url",location.href),window.open(t,"__blank")}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En),e.rXU(lp),e.rXU(ba),e.rXU(vt.bZ),e.rXU(l.il),e.rXU(Ra.dS))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-toolbar"]],viewQuery:function(o,s){1&o&&(e.wEZ(s.viewMenu,nM,5),e.wEZ(s.viewQuizMenu,iM,5)),2&o&&e.NyB(2)},standalone:!0,features:[e.aNF],decls:30,vars:12,consts:()=>{let t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt,$t,hn,rn,qe,en,Pt,ti;return t=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,o=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,s=$localize`:90fe9fae0783d2318d135abeb52592f09485421e4976034006498894948:More Options`,a=$localize`:ac0f81713a84217c9bd1d9bb460245d8190b073f5937251202465808296:More`,r=$localize`:58083a2c0d5c2b2184981c0887b01d1b3795eb613384117902239564995:Getting Started Video`,_=$localize`:27469d782d17f88ac1d4bbb5ab0715a83be9bfec1108080934572452765:3D Navigation Tutorial`,g=$localize`:eedb1f2596af2c8fcb065b15ace6b88d079e45db4831075576673859232:Keyboard Shortcuts`,P=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,F=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,ee=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,le=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,he=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,ue=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,ye=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,Ge=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,Ve=$localize`:7d208927e15566385c17967cc202c76e52e8f6a53354617747657053846:Selection Tools`,it=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,ot=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,_t=$localize`:a9c16db1d07908ad468c925fb3a36d96b98e90808647687729200262691:Draw`,xt=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,$t=$localize`:0176531c3e308e6a4f5dd4776a054145a1a6f2f34142825283571551211:Hide Labels`,hn=$localize`:5a595fd88f56c04bacea3ea933dd02f98f2131506701808385090866243:Show Labels`,rn=$localize`:d8f00947439583705b11afdb26b3606125755d7b1909228686165085461:Exit VR`,qe=$localize`:5830a413540a273b819289949937046a450e5d1d3237949197627908261:Enter VR`,en=$localize`:1d0d80fb57ed2c1c18d12b2df218541387455b4d6343763191422968223:Exit AR`,Pt=$localize`:ea19499751215e7ca470be4008a3fc22ed1281467143676568850518157:Enter AR`,ti=$localize`:79b5cb803980738a667e2f41746369c1efc9b0b11685423440406455552: Help `,[["viewMenu","matMenu"],["helpMenu","matMenu"],["selectionToolsMenu","matMenu"],["moreMenu","matMenu"],a,r,_,g,Ve,it,ot,_t,xt,$t,hn,rn,qe,en,Pt,ti,["data-test","viewToolbar",1,"view-toolbar"],["orientation","vertical","role","group","aria-label",t,"appPreventFadeout","",1,"view-toolbar__main"],["type","button","data-test","viewMenuButton","matTooltip",o,"app-view-button","","buttonSize","small","aria-label",s,3,"matMenuTriggerFor","matTooltipPosition"],["appPreventFadeout","","orientation","vertical","data-test","viewLayers",1,"view-toolbar__tools"],["data-test","viewMenu",1,"view-menu",3,"overlapTrigger"],["mat-menu-item","","data-test","viewMoreMenuButton",3,"matMenuTriggerFor"],[1,"view-menu"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","viewLaunchTutorial",3,"click","disabled"],["mat-menu-item","","data-test","viewKeyboardShortcuts",3,"click"],["data-test","selectionToolsMenu",1,"view-menu"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"disabled"],["mat-menu-item","","data-test","viewToggleLabels"],["data-test","viewHelpMenuButton","mat-menu-item","",3,"matMenuTriggerFor"],["app-view-button","","buttonSize","small","buttonTheme","transparent-fill","data-test","viewToolsButton","aria-label",P,"matTooltip",F,3,"matMenuTriggerFor","matTooltipPosition"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",ee,"matTooltip",le,3,"buttonTheme","matTooltipPosition"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",he,"matTooltip",ue,3,"buttonTheme","matTooltipPosition"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",ye,"matTooltip",Ge,3,"matTooltipPosition"],[1,"relative","flex","justify-center"],["size","lg","icon","eye-slash"],["size","lg","icon","adjust"],["size","lg","icon","mouse-pointer"],["app-view-button","","buttonSize","small","data-test","viewLayersButton","aria-label",ee,"matTooltip",le,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","sliders-simple"],["app-view-button","","buttonSize","small","data-test","viewSearchButton","aria-label",he,"matTooltip",ue,3,"click","buttonTheme","matTooltipPosition"],["size","lg","icon","magnifying-glass"],["app-view-button","","buttonSize","small","data-test","viewDrawButton","aria-label",ye,"matTooltip",Ge,3,"click","matTooltipPosition"],["size","lg","icon","pen"],["size","lg","icon","ellipsis-vertical"],["mat-menu-item","","data-test","viewToolsButton",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","viewLayersButton"],["mat-menu-item","","data-test","viewSearchButton"],["mat-menu-item","","data-test","viewDrawButton"],["size","lg","icon","eye-slash",1,"view-toolbar__menu-icon"],["size","lg","icon","adjust",1,"view-toolbar__menu-icon"],["size","lg","icon","mouse-pointer",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewLayersButton",3,"click"],["size","lg","icon","sliders-simple",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewSearchButton",3,"click"],["size","lg","icon","magnifying-glass",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewDrawButton",3,"click"],["size","lg","icon","pen",1,"view-toolbar__menu-icon"],["mat-menu-item","",1,"!px-2"],["mat-menu-item","",1,"!px-2",3,"click"],[1,"flex","items-center","gap-2","pr-4"],["aria-hidden","",1,"flex","items-center","justify-center","w-8","h-8","rounded",3,"ngClass"],["size","lg","appLogicalDir","",3,"icon"],[3,"ngClass"],["mat-menu-item","","data-test","viewQuizMenuButton",3,"click","disabled"],["size","lg","icon","user-graduate","appLogicalDir","",1,"view-toolbar__menu-icon"],["mat-menu-item","","data-test","viewToggleLabels",3,"click"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click","disabled"],["size","lg","icon","head-side-goggles",1,"view-toolbar__menu-icon"],["size","lg","icon","glasses",1,"view-toolbar__menu-icon"]]},template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"div",20)(1,"app-pillbox",21),e.DNE(2,uM,4,4)(3,hM,2,2,"button",22),e.k0s(),e.DNE(4,gM,2,0,"app-pillbox",23),e.k0s(),e.j41(5,"mat-menu",24,0),e.DNE(7,CM,4,4),e.j41(8,"button",25),e.qex(9),e.pXf(10,4),e.bVm(),e.k0s()(),e.j41(11,"mat-menu",26,1)(13,"button",27),e.bIt("click",function(_){return e.eBV(a),e.Njj(s.handleVideo(_))}),e.pXf(14,5),e.k0s(),e.j41(15,"button",28),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleTutorial())}),e.qex(16),e.pXf(17,6),e.bVm(),e.k0s(),e.j41(18,"button",29),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleHelpShortcuts())}),e.qex(19),e.pXf(20,7),e.bVm(),e.k0s()(),e.j41(21,"mat-menu",30,2),e.DNE(23,OM,2,0),e.k0s(),e.j41(24,"mat-menu",26,3),e.DNE(26,MM,4,1,"button",31)(27,wM,3,1,"button",32)(28,UM,2,2)(29,xM,2,1,"button",33),e.k0s()}if(2&o){let a,r;const _=e.sdS(25);e.R7$(2),e.vxM(s.heightBreakpoint()>s.canvasHeightBreakpoint.Small?2:-1),e.R7$(),e.vxM(s.toolbarOverflowVisible()?3:-1),e.R7$(),e.vxM("show"===(null==(a=s.visibilityLayersUI())?null:a.status)&&"single"===(null==(a=s.visibilityLayersUI())?null:a.layersMode)?4:-1),e.R7$(),e.Y8G("overlapTrigger",s.heightBreakpoint()<s.canvasHeightBreakpoint.Standard),e.R7$(2),e.vxM(s.heightBreakpoint()<s.canvasHeightBreakpoint.Standard?7:-1),e.R7$(),e.Y8G("matMenuTriggerFor",_),e.R7$(7),e.Y8G("disabled",!(null!=(r=s.selectedChapterReady())&&r.model)),e.R7$(8),e.vxM(s.toolsVisible()?23:-1),e.R7$(3),e.vxM(s.hasQuiz()&&s.quizEnabled()&&s.quizPromptVisible()&&!1===s.quizLocked()&&s.selectedBookmarkViewMode()!==s.bookmarkViewMode.Content&&s.isMobileWeb()?26:-1),e.R7$(),e.vxM(s.toggleLabelsVisible()?27:-1),e.R7$(),e.vxM(s.xrEnabled()?28:-1),e.R7$(),e.vxM(s.helpVisible()?29:-1)}},dependencies:[J.MD,J.YU,un.Cn,un.kk,un.fb,un.Cp,Kt.uc,Kt.oV,bn.C,Qt.ri,sn.o,ut.R,ps.b,no,xi.h,Us,Ao.e,hs],styles:[".view-toolbar[_ngcontent-%COMP%]{position:relative}.view-toolbar__menu-icon[_ngcontent-%COMP%]{display:inline-block;width:20px;text-align:center;margin-inline-end:4px}.view-toolbar__menu-icon--light[_ngcontent-%COMP%]{color:#384c6c}.view-toolbar__tools[_ngcontent-%COMP%]{position:absolute;z-index:2;inset-inline-start:48px;top:0;width:40px}"],changeDetection:0})}return n})();var io=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},an=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};let Bn=class Pd{constructor(i){this.store=i}static getStacksForChapter(i){return i.stacksForChapter??{}}static getUndoStack(i,t){return i[t]?.undoStack??[]}static getRedoStack(i,t){return i[t]?.redoStack??[]}static canUndo(i){return i.length>0}static canRedo(i){return i.length>0}static getUndoCount(i){return i.length}reset(i,t){i.patchState(jn.jM(i.getState(),o=>{o.stacksForChapter={}}))}undoAll(i,t){const o=i.getState();if(void 0===o.stacksForChapter[t.chapterId])return;const s=[...o.stacksForChapter[t.chapterId].undoStack].reverse(),a=s.flat().reduce((_,g)=>{const{patchAction:P,inverse:F}=g,ee=P?.type;return _[ee]=_[ee]??{actionClass:P,patches:[]},_[ee].patches.push(...F),_},{});Object.keys(a).forEach(_=>{const{actionClass:g,patches:P}=a[_];i.dispatch(new g(P))});const r=jn.jM(o,_=>{_.stacksForChapter[t.chapterId].undoStack=[],_.stacksForChapter[t.chapterId].redoStack=s});i.patchState(r)}preserveState(i,t){const o=this.store.selectSnapshot(me.N.getSelectedChapterId),s=jn.jM(i.getState(),a=>{0===t.patches.length||t.patches.some(_=>0===_.forward.length)&&t.patches.some(_=>0===_.inverse.length)||(void 0===a.stacksForChapter[o]&&(a.stacksForChapter[o]={redoStack:[],undoStack:[]}),a.stacksForChapter[o].redoStack=[],a.stacksForChapter[o].undoStack.push(t.patches))});i.patchState(s)}redo(i,t){const o=i.getState(),s=(0,u.get)(o.stacksForChapter[t.chapterId],"redoStack",[]);if(0===s.length)return;const a=s[s.length-1],r=jn.jM(o,_=>{_.stacksForChapter[t.chapterId].redoStack.pop(),_.stacksForChapter[t.chapterId].undoStack.push(a)});i.patchState(r),a.forEach(_=>{i.dispatch(new _.patchAction(_.forward))})}undo(i,t){const o=i.getState(),s=(0,u.get)(o.stacksForChapter[t.chapterId],"undoStack",[]);if(0===s.length)return;const a=s[s.length-1],r=jn.jM(o,_=>{_.stacksForChapter[t.chapterId].undoStack.pop(),_.stacksForChapter[t.chapterId].redoStack.push(a)});i.patchState(r),a.forEach(_=>{i.dispatch(new _.patchAction(_.inverse))})}static#e=this.\u0275fac=function(t){return new(t||Pd)(e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:Pd,factory:Pd.\u0275fac})};function VM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",5),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleUndoClick())}),e.nrm(1,"app-icon",6),e.k0s(),e.j41(2,"button",7),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleRedoClick())}),e.nrm(3,"app-icon",8),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled",!1===t.canUndo())("matTooltipPosition",t.tooltipPosition),e.R7$(),e.Y8G("custom",!0),e.R7$(),e.Y8G("disabled",!1===t.canRedo())("matTooltipPosition",t.tooltipPosition),e.R7$(),e.Y8G("custom",!0)}}function FM(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",1)(1,"app-pillbox",2),e.DNE(2,VM,4,6),e.j41(3,"button",3),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleResetClick())}),e.j41(4,"span",4),e.pXf(5,0),e.k0s()()()()}if(2&n){const t=e.XpG();e.Y8G("@show",void 0),e.R7$(2),e.vxM("full"===t.layout()?2:-1),e.R7$(),e.Y8G("disabled",!1===t.canUndo())("matTooltipPosition",t.tooltipPosition)}}io([(0,l.rc)(bi.a.Reset),an("design:type",Function),an("design:paramtypes",[Object,bi.a.Reset]),an("design:returntype",void 0)],Bn.prototype,"reset",null),io([(0,l.rc)(bi.a.UndoAll),an("design:type",Function),an("design:paramtypes",[Object,bi.a.UndoAll]),an("design:returntype",void 0)],Bn.prototype,"undoAll",null),io([(0,l.rc)(bi.a.SavePatches),an("design:type",Function),an("design:paramtypes",[Object,bi.a.SavePatches]),an("design:returntype",void 0)],Bn.prototype,"preserveState",null),io([(0,l.rc)(bi.a.Redo),an("design:type",Function),an("design:paramtypes",[Object,bi.a.Redo]),an("design:returntype",void 0)],Bn.prototype,"redo",null),io([(0,l.rc)(bi.a.Undo),an("design:type",Function),an("design:paramtypes",[Object,bi.a.Undo]),an("design:returntype",void 0)],Bn.prototype,"undo",null),io([(0,l.MD)([Bn]),an("design:type",Function),an("design:paramtypes",[Object]),an("design:returntype",Object)],Bn,"getStacksForChapter",null),io([(0,l.MD)([Bn.getStacksForChapter,me.N.getSelectedChapterId]),an("design:type",Function),an("design:paramtypes",[Object,String]),an("design:returntype",Array)],Bn,"getUndoStack",null),io([(0,l.MD)([Bn.getStacksForChapter,me.N.getSelectedChapterId]),an("design:type",Function),an("design:paramtypes",[Object,String]),an("design:returntype",Array)],Bn,"getRedoStack",null),io([(0,l.MD)([Bn.getUndoStack]),an("design:type",Function),an("design:paramtypes",[Array]),an("design:returntype",Boolean)],Bn,"canUndo",null),io([(0,l.MD)([Bn.getRedoStack]),an("design:type",Function),an("design:paramtypes",[Array]),an("design:returntype",Boolean)],Bn,"canRedo",null),io([(0,l.MD)([Bn.getUndoStack]),an("design:type",Function),an("design:paramtypes",[Array]),an("design:returntype",Number)],Bn,"getUndoCount",null),Bn=io([(0,l.Um)({injectContainerState:!1}),(0,l.Uw)({name:"undo",defaults:{stacksForChapter:{}}}),an("design:paramtypes",[l.il])],Bn);let Gp=(()=>{class n{constructor(t,o,s){this.store=t,this.viewService=o,this.directionality=s,this.canUndo=(0,je.ot)(this.store.select(Bn.canUndo)),this.canRedo=(0,je.ot)(this.store.select(Bn.canRedo)),this.layout=(0,e.hFB)("full"),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleUndoClick(){this.viewService.undo()}handleRedoClick(){this.viewService.redo()}handleResetClick(){this.viewService.resetChapter()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(En),e.rXU(Ra.dS))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-undo"]],inputs:{layout:[1,"layout"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let t,o,s,a,r,_,g;return t=$localize`:5d09ab375cce1f50ab075f60a2f4e3c2aa39ed465271497798766647376:Undo Tools`,o=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,s=$localize`:06c663bf1474713f57551123a46b34318543b67d7808756054397155068:Reset`,a=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,r=$localize`:4f26c54d5c3edadf92756d7d3ce466dde1f01e2a5775346636203685655:Undo`,_=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,g=$localize`:91b3b95ffa91d6355be5d7b3d48dfa32f3118bfa4221042196936324014:Redo`,[s,[1,"view-undo"],["orientation","vertical","role","group","aria-label",t,"appPreventFadeout",""],["app-view-button","","buttonSize","small","buttonShape","rounded","data-test","reset-btn","matTooltip",o,3,"click","disabled","matTooltipPosition"],[1,"font-semibold","text-2xs"],["app-view-button","","buttonSize","small","data-test","undo-btn","icon","undo","aria-label",a,"matTooltip",r,3,"click","disabled","matTooltipPosition"],["icon","undo","appLogicalDir","",3,"custom"],["app-view-button","","buttonSize","small","data-test","redo-btn","aria-label",_,"matTooltip",g,"icon","redo",3,"click","disabled","matTooltipPosition"],["icon","redo","appLogicalDir","",3,"custom"]]},template:function(o,s){1&o&&e.DNE(0,FM,6,4,"div",1),2&o&&e.vxM(s.canUndo()?0:-1)},dependencies:[J.MD,Kt.uc,Kt.oV,ps.b,no,xi.h,Us,Ao.e,bn.C,Qt.ri,sn.o,ut.R],styles:["[_nghost-%COMP%]{pointer-events:none}"],data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",(0,xe.K2)([(0,xe.iF)({transform:"translateX(-100%)",opacity:0}),(0,xe.i0)("150ms ease-in-out",(0,xe.iF)({transform:"translateX(0%)",opacity:1}))]))])]},changeDetection:0})}return n})();var $p=d(82192);let Bp=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([Fe.j]),J.MD,sn.o,fe.X1,Np]})}return n})(),cc=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([dt,me.N,et,Go.K,Ea]),J.MD,Lt.G,Nt.G,$p.G,Pr,fe.X1,Wn.y2.forChild(),Bp,Fn,cs,wp,Yo,ds,Fs,fo]})}return n})(),GM=(()=>{class n{constructor(t,o,s){this.mediaService=t,this.renderer2=o,this.markdownService=s,this.audioText=(0,e.hFB)(""),this.audioLocale=(0,e.hFB)(Jn.q.id),this.playing=(0,e.geq)(!1),this.loading=(0,e.geq)(!1),this.audioId=(0,e.EWP)(()=>{const a=this.audioText();return`${this.audioLocale()}-${a}`}),(0,e.QZP)(a=>{this.audioId(),this.removeAudioPlayer(),a(()=>{this.removeAudioPlayer()})})}play(){var t=this;return(0,pt.A)(function*(){if((0,u.isNil)(t.audioPlayer)){const o=t.audioLocale();yield t.setAudioPlayer(o)}t.audioPlayer.stop(),t.audioPlayer.play()})()}pause(){this.audioPlayer?.pause()}setAudioPlayer(t){var o=this;return(0,pt.A)(function*(){o.removeAudioPlayer(),o.loading.set(!0),o.audioPlayer=yield o.mediaService.addAudioPlayer(o.audioId(),o.getAudioSource(t),!1),o.audioPlayer.on("play",()=>{o.playing.set(!0)}),["pause","stop","end","loaderror","playerror"].forEach(r=>{o.audioPlayer.on(r,()=>o.playing.set(!1))}),["play"].forEach(r=>{o.audioPlayer.on(r,()=>o.playing.set(!0))}),o.loading.set(!1)})()}removeAudioPlayer(){this.audioPlayer?.stop(),this.mediaService.removeAudioPlayer(this.audioId()),this.audioPlayer=null}getAudioSource(t){var o=this;return(0,pt.A)(function*(){const s=o.audioText();return Kd(yield ho.l.getPlainTextFromMarkdown(o.renderer2,o.markdownService,s,!0),t)})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vi),e.rXU(e.sFG),e.rXU(Wn.Rl))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appAudioPlayer",""]],inputs:{audioText:[1,"audioText"],audioLocale:[1,"audioLocale"],playing:[1,"playing"],loading:[1,"loading"]},outputs:{playing:"playingChange",loading:"loadingChange"},exportAs:["audioPlayer"],standalone:!0})}return n})();function $M(n,i){1&n&&(e.qex(0),e.pXf(1,3),e.bVm())}function BM(n,i){1&n&&(e.qex(0),e.pXf(1,4),e.bVm())}let zM=(()=>{class n{constructor(t,o){this.store=t,this.nodeService=o,this.graph=(0,je.ot)(this.store.select(ze.S.getViewGraph)),this.nodeId=e.hFB.required(),this.title=(0,e.hFB)(""),this.nodeShown=(0,e.EWP)(()=>{const s=this.graph(),a=this.nodeId();return s.nodes[a]?.boolState?.shown})}handleCloseClick(){this.store.dispatch(new Je.S3)}handleToggleShownClick(t,o){const s=!o;this.nodeService.show(t,s),s||this.store.dispatch(new Je.S3)}handleFadeClick(t){this.nodeService.fade([t])}handleIsolateClick(t){this.nodeService.hideInverse([t])}getAudioLabel(t){return t?$localize`Pause Audio`:$localize`Play Audio`}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(fp.w))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-context-label"]],inputs:{nodeId:[1,"nodeId"],title:[1,"title"]},standalone:!0,features:[e.aNF],decls:21,vars:5,consts:()=>{let t,o,s,a,r;return t=$localize`:f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c87819314041543176992:Close`,o=$localize`:81d6fa1833302eff81aca2a44b472dbd23898f447797708308805705984:Fade`,s=$localize`:1d0272689cde55e9082a761694f77704b269d315424278156329248517:Isolate`,a=$localize`:1eede69e18c5ac9c0b0295b72cabb7e64e029e748461609631969932886:Hide`,r=$localize`:2aba1e87039819aca3b70faa9aa848c12bf139ca8461842260159597706:Show`,[["audio","audioPlayer"],o,s,a,r,["orientation","horizontal","padding","none"],[1,"flex","flex-col","items-stretch","w-full"],[1,"flex","items-center","justify-between","border-b","border-solid","border-b-gray-400"],["type","button","app-view-button","","appAudioPlayer","",3,"click","audioText","disabled"],["icon","volume-up"],[1,"flex-auto","text-sm","font-bold"],["type","button","app-view-button","","aria-label",t,3,"click"],["icon","times"],[1,"flex","items-center","divide-x","divide-gray-400","justify-evenly"],["type","button","app-view-button","","buttonSize","small",1,"flex-auto",3,"click"],[1,"text-xs","font-medium","uppercase"]]},template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"app-pillbox",5)(1,"div",6)(2,"div",7)(3,"button",8,0),e.bIt("click",function(){e.eBV(a);const _=e.sdS(4);return e.Njj(_.play())}),e.nrm(5,"app-icon",9),e.k0s(),e.j41(6,"div",10),e.EFF(7),e.k0s(),e.j41(8,"button",11),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleCloseClick())}),e.nrm(9,"app-icon",12),e.k0s()(),e.j41(10,"div",13)(11,"button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleToggleShownClick(s.nodeId(),s.nodeShown()))}),e.j41(12,"span",15),e.DNE(13,$M,2,0,"ng-container")(14,BM,2,0,"ng-container"),e.k0s()(),e.j41(15,"button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleFadeClick(s.nodeId()))}),e.j41(16,"span",15),e.pXf(17,1),e.k0s()(),e.j41(18,"button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleIsolateClick(s.nodeId()))}),e.j41(19,"span",15),e.pXf(20,2),e.k0s()()()()()}if(2&o){const a=e.sdS(4);e.R7$(3),e.Y8G("audioText",s.title())("disabled",a.loading()),e.BMQ("aria-label",s.getAudioLabel(a.playing())),e.R7$(4),e.JRh(s.title()),e.R7$(6),e.vxM(s.nodeShown()?13:14)}},dependencies:[J.MD,ps.b,no,bn.C,Qt.ri,sn.o,ut.R,GM],encapsulation:2,changeDetection:0})}return n})(),WM=(()=>{class n{constructor(t){this.store=t,this.selectingLocation=(0,je.ot)(this.store.select(On.U.getSelectingLocation))}handleToggleSelectingLocation(t){t?(this.store.dispatch(new Ui.W.SetARLocation),this.store.dispatch(new Ui.W.SetARSelectingLocation(!1))):this.store.dispatch(new Ui.W.SetARSelectingLocation(!0))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-xr-controls-bar"]],standalone:!0,features:[e.aNF],decls:7,vars:0,consts:()=>{let t,o,s;return t=$localize`:a00fddb6017dc71ea1d67721046393443bc075f45662376323613763162:XR Control Buttons`,o=$localize`:09a3819eec064e9b1e71734181cb6cdaf4e14cdf553682680938609163:Set new scene position`,s=$localize`:f56d4869e48b6899e74d5c664ea6aac99df9dc4c8445031949094621348:Place 3D model in AR space`,[s,["direction","vertical","data-test","xrControlsBar","direction","vertical","appPreventFadeout",""],["role","group","aria-label",t],["app-view-button","","buttonSize","small","matTooltip",o,"matTooltipPosition","left","data-test","xrSetPosition","appEventFence","",3,"click"],["size","lg","icon","location-crosshairs"],[1,"sr-only"]]},template:function(o,s){1&o&&(e.j41(0,"app-pillbox",1)(1,"ul",2)(2,"li")(3,"button",3),e.bIt("click",function(){return s.handleToggleSelectingLocation(s.selectingLocation())}),e.nrm(4,"app-icon",4),e.j41(5,"span",5),e.pXf(6,0),e.k0s()()()()())},dependencies:[J.MD,Kt.uc,Kt.oV,xi.h,Ta.L,Us,sn.o,ut.R,bn.C,Qt.ri,ps.b,no],encapsulation:2,changeDetection:0})}return n})();var Hs,XM=d(9984),HM=d(46889),Xs=d(13491);function Hm(n){const{rotation:i,scale:t,position:o,origin:s}=n;return{translate:Xs.n.fromArray(o),rotate:Xs.n.fromArray(i),scale:Xs.n.fromArray(t),pivot:Xs.n.fromArray(s)}}!function(n){n.slideTransition=(0,xe.lY)([(0,xe.iF)({transform:"translateY({{ from }}%)",opacity:0}),(0,xe.i0)("{{ duration }}ms ease-out",(0,xe.iF)({transform:"translateY({{ to }})",opacity:1}))]),n.fadeIn=(0,xe.lY)([(0,xe.iF)({opacity:0}),(0,xe.i0)("{{ duration }}ms ease-out",(0,xe.iF)({opacity:1}))]),n.fadeOut=(0,xe.lY)([(0,xe.iF)({opacity:"*"}),(0,xe.i0)("{{ duration }}ms ease-in",(0,xe.iF)({opacity:0}))])}(Hs||(Hs={}));const YM=["overlayContainer"],KM=["labelsContainer"],qM=()=>["top","right","bottom","left"],JM=n=>({"w-full":n});function ZM(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",4)(1,"div",21),e.EFF(2),e.nI1(3,"percent"),e.k0s(),e.j41(4,"button",22),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleResetScaleClick())}),e.nrm(5,"app-icon",23),e.k0s()()}if(2&n){const t=e.XpG();e.Y8G("@show",void 0),e.R7$(2),e.JRh(e.bMT(3,2,t.sceneScale()))}}function eI(n,i){1&n&&e.nrm(0,"app-view-toolbar")}function tI(n,i){1&n&&e.nrm(0,"app-view-undo",10),2&n&&e.Y8G("layout","full")}function nI(n,i){1&n&&(e.j41(0,"app-pillbox",24),e.nrm(1,"app-view-play"),e.k0s())}function iI(n,i){if(1&n&&(e.nrm(0,"app-xr-controls-bar"),e.DNE(1,nI,2,0,"app-pillbox",24)),2&n){const t=e.XpG();e.R7$(),e.vxM(t.mediaVisible()?1:-1)}}function oI(n,i){1&n&&(e.j41(0,"app-pillbox",24),e.nrm(1,"app-view-play"),e.k0s())}function sI(n,i){if(1&n&&(e.j41(0,"div",16),e.nrm(1,"app-xr-controls-bar"),e.DNE(2,oI,2,0,"app-pillbox",24),e.k0s()),2&n){const t=e.XpG();e.R7$(2),e.vxM(t.mediaVisible()?2:-1)}}function aI(n,i){if(1&n&&e.nrm(0,"app-view-context-label",17),2&n){let t,o;const s=e.XpG();e.Y8G("nodeId",null==(t=s.contextLabel())?null:t.objectId)("title",null==(o=s.contextLabel())?null:o.title)}}function rI(n,i){1&n&&e.nrm(0,"img",19)}function lI(n,i){1&n&&(e.PLo(0,2,1),e.j41(1,"p"),e.nrm(2,"em",26),e.k0s(),e.YFu())}function cI(n,i){1&n&&(e.PLo(0,2,2),e.j41(1,"p"),e.nrm(2,"em",26),e.k0s(),e.YFu())}function dI(n,i){1&n&&(e.PLo(0,2,3),e.j41(1,"p"),e.nrm(2,"em",26),e.k0s(),e.YFu())}function _I(n,i){if(1&n){const t=e.RV6();e.PLo(0,2,4),e.j41(1,"button",27),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleCancelClick())}),e.k0s(),e.YFu()}}function pI(n,i){if(1&n&&(e.j41(0,"div",20),e.PLo(1,2),e.DNE(2,lI,3,0,"p")(3,cI,3,0,"p")(4,dI,3,0,"p")(5,_I,2,0,"button",25),e.YFu(),e.k0s()),2&n){let t;const o=e.XpG();e.R7$(2),e.vxM("Pending"===(t=o.placementState())?2:"Valid"===t?3:4),e.R7$(3),e.vxM(o.placementCount()>1?5:-1)}}var Qm=function(n){return n.Pending="Pending",n}(Qm||{});let Km=(()=>{class n{constructor(t,o,s,a,r,_,g){let P;this.store=t,this.actions=o,this.snackBar=s,this.labelsService=a,this.engineService=r,this.sceneService=_,this.xrService=g,this.overlayContainerRef=(0,e.ebz)("overlayContainer"),this.labelsContainerRef=(0,e.ebz)("labelsContainer"),this.toolbarVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Toolbar))),this.mediaVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Media))),this.undoVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Undo))),this.contentMode=(0,je.ot)(this.store.select(de.getContentMode)),this.selectedChapter=(0,je.ot)(this.store.select(me.N.getSelectedChapter)),this.graph=(0,je.ot)(this.store.select(ze.S.getViewGraph)),this.checkedNodeIds=(0,je.ot)(this.store.select(Rn.z.getCheckedNodeIds)),this.selectingLocation=(0,je.ot)(this.store.select(On.U.getSelectingLocation)),this.viewGraph=(0,je.ot)(this.store.select(ze.S.getViewGraph)),this.contextLabel=(0,je.ot)(this.store.select(et.getContextLabel)),this.enginePlacementState=(0,je.ot)(this.store.select(On.U.getPlacementState)),this.labelsEnabled=(0,e.hFB)(!1),this.checkedNode=(0,e.EWP)(()=>{const F=this.graph(),ee=this.checkedNodeIds()[0];return F.nodes[ee]}),this.usdzUrl=(0,e.EWP)(()=>Sp(this.selectedChapter()?.contentBlocks??[])[0]),this.placementPending=(0,e.vPA)(!1),this.placementState=(0,e.EWP)(()=>{const F=this.enginePlacementState();return this.placementPending()?Qm.Pending:F}),this.placementCount=(0,e.vPA)(0),this.sceneScale=(0,e.vPA)(1),this.interacting=(0,e.vPA)(!1),this.initialTransform=new Map,this.engineService.engine.story.anatomySceneGraph.anatomyRoots.forEach(({objectId:F,sceneNode:ee})=>{this.initialTransform.set(F,Hm(ee))}),(0,e.QZP)(()=>{this.selectingLocation()&&this.placementCount.update(ee=>ee+1)},{allowSignalWrites:!0}),(0,e.QZP)(F=>{const ee=this.labelsContainerRef();this.labelsService.setLabelContainer(ee),F(()=>{this.labelsService.setLabelContainer(null)})}),(0,e.QZP)(F=>{this.selectingLocation()?(this.placementPending.set(!0),clearTimeout(P),setTimeout(()=>{this.placementPending.set(!1)},5e3)):this.placementPending.set(!1),F(()=>{clearTimeout(P)})},{allowSignalWrites:!0}),(0,e.QZP)(()=>{const F=this.placementPending();this.store.dispatch(new Ui.W.SetARSelectingLocationVisible(!F))}),this.actions.pipe((0,l.xi)(Ui.W.SetARLocationSuccess),(0,je.pQ)()).subscribe(()=>{this.snackBar.dismiss()}),this.actions.pipe((0,l.xi)(Ui.W.SetARLocationFail),(0,je.pQ)()).subscribe(()=>{this.handleSelectFail()}),this.initInputListeners()}ngOnDestroy(){this.hammerManager?.destroy(),this.hammerManager=null,this.resetSceneTransform(),this.initialTransform.clear()}initInputListeners(){let t="",o=1,s=0;const a=new k.B,r=new k.B,_=this.xrService.getObjectSelecting();a.asObservable().pipe((0,wn.B)(50),(0,va.E)(_),(0,D.p)(([g])=>!g),(0,je.pQ)()).subscribe(([,g])=>{const P=this.viewGraph(),F=this.sceneService.getViewNode(P,g?.objectId);this.store.dispatch(new st.zE(F,void 0,g))}),this.store.select(me.N.getSelectedChapterId).pipe((0,Tn.F)(),(0,je.pQ)()).subscribe(()=>{this.resetSceneTransform()}),(0,ki.h)(r,r.pipe((0,wn.B)(2e3),(0,W.T)(()=>!1))).pipe((0,je.pQ)()).subscribe(g=>{this.interacting.set(g)}),this.hammerManager=new Hammer.Manager(document.body),this.hammerManager.add(new Hammer.Tap({event:"press"})),this.hammerManager.add(new Hammer.Pan({event:"pan",pointers:0})),this.hammerManager.add(new Hammer.Pinch({event:"pinch"})),this.hammerManager.on("press",g=>{r.next(!0);const F=this.overlayContainerRef()?.nativeElement?.contains(g?.target);a.next(F)}),this.hammerManager.on("pan",g=>{if(this.selectingLocation())return;g.preventDefault();const{velocityX:P,velocityY:F}=g;this.applySceneRotate(P,F),r.next(!0)}),this.hammerManager.on("panend",g=>{this.selectingLocation()}),this.hammerManager.on("pinchstart",g=>{this.selectingLocation()||(o*=g.scale,t="",r.next(!0))}),this.hammerManager.on("pinchmove",g=>{if(this.selectingLocation())return;g.preventDefault();const P=Math.abs(g.deltaX)>60||Math.abs(g.deltaY)>60,F=g.scale>1.5||g.scale<.5;t?("pan"===t&&F&&!P&&(t="pinch"),"pinch"===t&&P&&!F&&(t="pan")):t=F?"pinch":"pan";const ee=o*g.scale,le=s;switch(s=0===ee?0:ee>0?1:-1,t){case"pan":{const{velocityX:he,velocityY:ue}=g;this.applySceneMove(he,ue);break}case"pinch":s+le!==0&&this.applySceneScale(ee)}r.next(!0)}),this.hammerManager.on("pinchend",g=>{o*=g.scale})}handleResetScaleClick(){this.applySceneScale(1)}handleOverlayClick(t,o){t&&(o!==XM.I.Valid?this.handleSelectFail():this.store.dispatch(new Ui.W.SetARLocation))}handleCancelClick(){this.store.dispatch(new Ui.W.SetARSelectingLocation(!1))}handleSelectFail(){this.displaySnackbar("You cannot place the object here.")}resetSceneTransform(){this.applySceneScale(1),this.initialTransform.forEach((t,o)=>{const{anatomyObjects:s}=this.engineService.engine.story.anatomySceneGraph,{sceneNode:a}=s.get(o);(0,A.applyTransform)(a,t)})}applySceneRotate(t,o){this.applyTransform((s,a)=>{const{rotate:r}=a,{y:g}=r;return{rotate:{y:(0,HM.nv)(g)+1*t}}})}applySceneMove(t,o){this.applyTransform((s,a)=>{const{translate:r}=a,{x:_,y:g}=r;return{translate:{x:_+.5*t,y:g-.5*o}}})}applySceneScale(t){t=(0,u.clamp)(t,.25,4),this.sceneScale.set(t),this.applyTransform(()=>({scale:{x:t,y:t,z:t}}))}applyTransform(t){const{engine:o}=this.engineService;o.story.anatomySceneGraph.anatomyRoots.forEach(s=>{!function QM(n,i){const o=i(n,Hm(n));o&&(0,A.applyTransform)(n,o)}(s.sceneNode,t)})}displaySnackbar(t){this.snackBar.open(t,"",{horizontalPosition:"left",verticalPosition:"top",duration:2e3})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(l.En),e.rXU(ui.UG),e.rXU(Tr.x),e.rXU(v.y),e.rXU(Fi.w),e.rXU(mm.S))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-xr-overlay"]],viewQuery:function(o,s){1&o&&(e.wEZ(s.overlayContainerRef,YM,5),e.wEZ(s.labelsContainerRef,KM,5)),2&o&&e.NyB(2)},inputs:{labelsEnabled:[1,"labelsEnabled"]},standalone:!0,features:[e.aNF],decls:23,vars:29,consts:()=>{let t;return t=$localize`:272a6581ac01a11353aaf8d6d40d7b9cb229a5dc6802581832720117990:${"\ufffd*2:1\ufffd"}:START_BLOCK_CASE:${"[\ufffd#1:1\ufffd|\ufffd#1:2\ufffd|\ufffd#1:3\ufffd]"}:START_PARAGRAPH:${"[\ufffd#2:1\ufffd|\ufffd#2:2\ufffd|\ufffd#2:3\ufffd]"}:START_EMPHASISED_TEXT:Slowly move your camera around to scan${"[\ufffd/#2:1\ufffd|\ufffd/#2:2\ufffd|\ufffd/#2:3\ufffd]"}:CLOSE_EMPHASISED_TEXT: a surface in the room. ${"[\ufffd/#1:1\ufffd|\ufffd/#1:2\ufffd|\ufffd/#1:3\ufffd]"}:CLOSE_PARAGRAPH:${"[\ufffd/*2:1\ufffd|\ufffd/*3:2\ufffd]"}:CLOSE_BLOCK_CASE:${"\ufffd*3:2\ufffd"}:START_BLOCK_CASE_1:${"[\ufffd#1:1\ufffd|\ufffd#1:2\ufffd|\ufffd#1:3\ufffd]"}:START_PARAGRAPH:${"[\ufffd#2:1\ufffd|\ufffd#2:2\ufffd|\ufffd#2:3\ufffd]"}:START_EMPHASISED_TEXT:Tap the white circle${"[\ufffd/#2:1\ufffd|\ufffd/#2:2\ufffd|\ufffd/#2:3\ufffd]"}:CLOSE_EMPHASISED_TEXT: to place the object.${"[\ufffd/#1:1\ufffd|\ufffd/#1:2\ufffd|\ufffd/#1:3\ufffd]"}:CLOSE_PARAGRAPH:${"[\ufffd/*2:1\ufffd|\ufffd/*3:2\ufffd]"}:CLOSE_BLOCK_CASE:${"\ufffd*4:3\ufffd"}:START_BLOCK_DEFAULT:${"[\ufffd#1:1\ufffd|\ufffd#1:2\ufffd|\ufffd#1:3\ufffd]"}:START_PARAGRAPH: You cannot place the object on this surface. ${"[\ufffd#2:1\ufffd|\ufffd#2:2\ufffd|\ufffd#2:3\ufffd]"}:START_EMPHASISED_TEXT:Please try to focus on different surface.${"[\ufffd/#2:1\ufffd|\ufffd/#2:2\ufffd|\ufffd/#2:3\ufffd]"}:CLOSE_EMPHASISED_TEXT:${"[\ufffd/#1:1\ufffd|\ufffd/#1:2\ufffd|\ufffd/#1:3\ufffd]"}:CLOSE_PARAGRAPH:${"\ufffd/*4:3\ufffd"}:CLOSE_BLOCK_DEFAULT:${"\ufffd*5:4\ufffd"}:START_BLOCK_IF:${"\ufffd#1:4\ufffd"}:START_TAG_BUTTON: Cancel ${"\ufffd/#1:4\ufffd"}:CLOSE_TAG_BUTTON:${"\ufffd/*5:4\ufffd"}:CLOSE_BLOCK_IF:`,t=e.k04(t),[["overlayContainer",""],["labelsContainer",""],t,[1,"absolute","top-0","bottom-0","left-0","right-0","z-50","flex","flex-col","items-center","w-screen","h-screen",3,"click"],["appEventFence","",1,"fixed","z-50","flex","items-center","justify-between","text-lg","font-medium","text-white","transform","-translate-x-1/2","bg-opacity-75","divide-x","divide-white","rounded-lg","bg-gray-950","left-1/2","top-20"],[1,"absolute","top-6","right-3"],["padding","none"],[3,"mode","title","modelUrl","transparent","bordered","compact"],[3,"showZones","hidden","verticalPadding","horizontalPadding"],["left",""],[3,"layout"],["bottom",""],[1,"flex","flex-col","items-end","w-full","gap-3","justify-items-end"],[1,"flex","flex-col","items-start","w-full","gap-3"],[1,"flex","flex-row","justify-between","w-full"],[3,"showPagination","showTitle","ngClass"],[1,"flex","flex-col","gap-1"],[1,"w-full",3,"nodeId","title"],[1,"absolute","top-0","bottom-0","left-0","right-0","w-full","h-full","pointer-events-none",3,"hidden"],["src","/assets/images/ar_move_phone.svg","width","200",1,"fixed","transform","-translate-x-1/2","-translate-y-1/2","top-1/2","left-1/2"],[1,"flex","flex-col","gap-3","p-6","mx-5","my-10","text-lg","font-medium","text-center","text-white","bg-opacity-50","border","border-gray-200","rounded-lg","bg-gray-950"],[1,"px-3"],["app-view-button","","buttonTheme","transparent","buttonSize","small",3,"click"],["icon","rotate-left"],["orientation","horizontal"],["app-view-button","","buttonTheme","white-outline","buttonShape","rounded",1,"w-full"],[1,"font-bold"],["app-view-button","","buttonTheme","white-outline","buttonShape","rounded",1,"w-full",3,"click"]]},template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"div",3,0),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleOverlayClick(s.selectingLocation(),s.enginePlacementState()))}),e.DNE(2,ZM,6,4,"button",4),e.j41(3,"div",5)(4,"app-pillbox",6),e.nrm(5,"app-view-xr-button",7),e.k0s()(),e.j41(6,"app-view-zones",8),e.qex(7,9),e.DNE(8,eI,1,0,"app-view-toolbar")(9,tI,1,1,"app-view-undo",10),e.bVm(),e.qex(10,11),e.j41(11,"div",12),e.DNE(12,iI,2,1),e.j41(13,"div",13)(14,"div",14),e.nrm(15,"app-view-title-only",15),e.DNE(16,sI,3,1,"div",16),e.k0s(),e.DNE(17,aI,1,2,"app-view-context-label",17),e.k0s()(),e.bVm(),e.k0s(),e.j41(18,"div",18,1),e.nrm(20,"app-labels"),e.k0s(),e.DNE(21,rI,1,0,"img",19)(22,pI,6,2,"div",20),e.k0s()}if(2&o){let a;e.AVh("pointer-events-none",!s.selectingLocation())("justify-end",s.selectingLocation()),e.R7$(2),e.vxM(s.interacting()&&1!==s.sceneScale()?2:-1),e.R7$(3),e.Y8G("mode","ar")("title",null==(a=s.selectedChapter())?null:a.displayName)("modelUrl",s.usdzUrl())("transparent",!0)("bordered",!1)("compact",!0),e.R7$(),e.Y8G("showZones",e.lJ4(26,qM))("hidden",s.selectingLocation())("verticalPadding",24)("horizontalPadding",12),e.R7$(2),e.vxM(s.toolbarVisible()?8:-1),e.R7$(),e.vxM(s.undoVisible()?9:-1),e.R7$(3),e.vxM(s.contextLabel()?-1:12),e.R7$(3),e.Y8G("showPagination",!0)("showTitle",!s.contextLabel())("ngClass",e.eq3(27,JM,!s.contextLabel())),e.R7$(),e.vxM(s.contextLabel()?16:-1),e.R7$(),e.vxM(s.contextLabel()?17:-1),e.R7$(),e.Y8G("hidden",!s.labelsEnabled()||s.selectingLocation()),e.R7$(3),e.vxM("Pending"===s.placementState()?21:-1),e.R7$(),e.vxM(s.selectingLocation()?22:-1)}},dependencies:[J.MD,J.YU,J.m1,ui._T,un.Cn,Kt.uc,bn.C,Qt.ri,sn.o,ut.R,ps.b,no,xi.h,Ta.L,Xm,Fp,Gp,sc,cc,Fn,zM,Ir,WM,Lp],encapsulation:2,data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",[(0,xe.sM)(Hs.fadeIn,{params:{duration:500}})])])]}})}return n})();function fI(n,i){if(1&n&&(e.j41(0,"h2",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.title())}}function SI(n,i){if(1&n&&e.nrm(0,"app-progress",6),2&n){const t=e.XpG();e.Y8G("value",t.storyLoadProgress())("total",1)("theme","light")}}function bI(n,i){if(1&n){const t=e.RV6();e.nrm(0,"app-view-xr-button",7),e.j41(1,"button",8),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleLearnMoreClick())}),e.pXf(2,0),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("mode",t.mode())("title",t.title())("modelUrl",t.modelUrl())("transparent",!1)("bordered",!1)("compact",!1)}}let qm=(()=>{class n{constructor(t){this.store=t,this.xrLoaderEnum=Di,this.nativeEnvironmentPlatform=fr.I,this.progressByChapter=(0,je.ot)(this.store.select(Ai.getChaptersLoadProgress)),this.chapter=(0,je.ot)(this.store.select(dt.getLoadingChapter)),this.selectedChapter=(0,je.ot)(this.store.select(me.N.getSelectedChapterId)),this.storyLoadProgress=(0,e.EWP)(()=>{const o=this.progressByChapter(),s=this.chapter(),a=this.selectedChapter();return(0,u.isNil)(s)||s.chapterId!==a?1:o[a]??0}),this.mode=e.hFB.required(),this.platform=e.hFB.required(),this.title=(0,e.hFB)(),this.contentBlocks=e.hFB.required(),this.learnMoreClick=(0,e.CGW)(),this.modelUrl=(0,e.EWP)(()=>Sp(this.contentBlocks()??[])[0])}handleLearnMoreClick(){this.learnMoreClick.emit()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-xr-loader-summary"]],inputs:{mode:[1,"mode"],platform:[1,"platform"],title:[1,"title"],contentBlocks:[1,"contentBlocks"]},outputs:{learnMoreClick:"learnMoreClick"},standalone:!0,features:[e.aNF],decls:7,vars:2,consts:()=>{let t;return t=$localize`:3fde104b80163b40899412fd782ea159e7fea74a2747860579732384082: Learn More `,[t,["role","dialog","aria-modal","true","aria-label","XR Loader",1,"fixed","top-0","bottom-0","left-0","right-0","z-50","flex","flex-col","items-center","w-screen","h-screen"],[1,"absolute","w-full","h-full","bg-gray-950","opacity-70"],[1,"absolute","flex","flex-col","items-center","justify-center","w-full","h-full","max-w-xs","gap-14"],[1,"text-2xl","font-bold","text-center","text-gray-100"],[1,"flex","flex-col","gap-6","w-72"],[3,"value","total","theme"],[3,"mode","title","modelUrl","transparent","bordered","compact"],["type","button","app-view-button","","buttonShape","rounded","buttonTheme","white-outline",3,"click"]]},template:function(o,s){1&o&&(e.j41(0,"div",1),e.nrm(1,"div",2),e.j41(2,"div",3),e.DNE(3,fI,2,1,"h2",4),e.j41(4,"div",5),e.DNE(5,SI,1,3,"app-progress",6)(6,bI,3,6),e.k0s()()()),2&o&&(e.R7$(3),e.vxM(s.title()?3:-1),e.R7$(2),e.vxM(s.storyLoadProgress()<1?5:6))},dependencies:[bn.C,Qt.ri,sn.o,Ws.M,Lm,Ir]})}return n})();function yI(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",1),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleFullscreenClick())}),e.j41(1,"span",2),e.EFF(2),e.k0s(),e.nrm(3,"app-icon",3),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("buttonSize",t.buttonSize())("matTooltip",t.fullscreenToggleTooltip()),e.R7$(2),e.JRh(t.fullscreenToggleTooltip()),e.R7$(),e.Y8G("icon",t.isFullscreen()?"compress":"expand")}}function vI(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"button",5),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleNewTabClick())}),e.nrm(2,"app-icon",6),e.k0s(),e.bVm()}if(2&n){const t=e.XpG(2);e.R7$(),e.Y8G("buttonSize",t.buttonSize())}}function EI(n,i){if(1&n&&e.DNE(0,vI,3,1,"ng-container",4),2&n){const t=e.XpG();e.Y8G("appFlagApplication",t.application.All)("appFlagApplicationMode","exclude")("appFlagApplicationNative",t.nativePlatform.All)}}let Jm=(()=>{class n{constructor(t){this.viewService=t,this.nativePlatform=fr.I,this.application=xn.c,this.buttonSize=(0,e.hFB)(Qt.Mp.Default),this.isFullscreen=(0,e.vPA)(!1),this.canFullscreen=(0,e.vPA)(!1),this.fullscreenToggleTooltip=(0,e.EWP)(()=>this.isFullscreen()?$localize`Exit Fullscreen`:$localize`Enter Fullscreen`),this.canFullscreen.set(po.canFullscreen());const o=(0,je.ot)(po.onFullscreenChange(),{initialValue:po.isFullscreen()});(0,e.QZP)(()=>{const s=o();this.isFullscreen.set(s)},{allowSignalWrites:!0})}handleFullscreenClick(){po.toggleFullscreen()}handleNewTabClick(){this.viewService.openInNewTab()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-fullscreen"]],inputs:{buttonSize:[1,"buttonSize"]},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:()=>{let t;return t=$localize`:0ced11d3928af0572f10cfd084c3f86347d3af606283253681872253092:Open in New Tab`,[["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"buttonSize","matTooltip"],["appPreventFadeout","","app-view-button","","data-test","viewFullscreenButton","matTooltipPosition","left",3,"click","buttonSize","matTooltip"],[1,"sr-only"],["size","lg",3,"icon"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],["appPreventFadeout","","app-view-button","","matTooltip",t,"matTooltipPosition","left","data-test","viewNewTab",3,"click","buttonSize"],["icon","arrow-up-right-from-square"]]},template:function(o,s){1&o&&e.DNE(0,yI,4,4,"button",0)(1,EI,1,3,"ng-container"),2&o&&e.vxM(s.canFullscreen()?0:1)},dependencies:[J.MD,Kt.uc,Kt.oV,xi.h,bp.Y,Us,sn.o,ut.R,bn.C,Qt.ri],encapsulation:2,changeDetection:0})}return n})(),Zm=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-button-loader"]],decls:5,vars:0,consts:()=>{let t,o,s;return t=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["type","button","aria-label",t,"type","button",1,"button-loader"],[1,"button-loader__button"],["src","assets/images/widget/loading_experience/interact-in-3d-arrow.svg","alt",o,1,"button-loader__3d-arrow"],[1,"button-loader__label"]]},template:function(o,s){1&o&&(e.j41(0,"button",1)(1,"div",2),e.nrm(2,"img",3),e.j41(3,"div",4),e.pXf(4,0),e.k0s()()())},styles:[".button-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.button-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@media print{.button-loader[_ngcontent-%COMP%]{display:none}}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__button[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__button[_ngcontent-%COMP%]{background-color:#2472e9;transform:scale(1.1)}.button-loader[_ngcontent-%COMP%]:focus   .button-loader__3d-arrow[_ngcontent-%COMP%], .button-loader[_ngcontent-%COMP%]:hover   .button-loader__3d-arrow[_ngcontent-%COMP%]{transform:scale(1.2)}.button-loader__button[_ngcontent-%COMP%]{display:flex;padding:12px 28px;border-radius:32px;align-items:center;transition:transform .25s,background-color .25s;background-color:#0c1726cc}.button-loader__3d-arrow[_ngcontent-%COMP%]{transition:transform .25s;margin-inline-end:4px}.button-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;color:#fff;font-weight:600;margin-inline-start:4px}"],changeDetection:0})}return n})(),ef=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-hand-loader"]],decls:6,vars:0,consts:()=>{let t,o,s;return t=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,o=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,s=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[s,["type","button","aria-label",t,1,"hand-loader"],[1,"hand-loader__container"],[1,"hand-loader__circle"],["src","assets/images/widget/loading_experience/interact-in-3d-hand.svg","alt",o,1,"hand-loader__3d-hand"],[1,"hand-loader__label"]]},template:function(o,s){1&o&&(e.j41(0,"button",1)(1,"div",2),e.nrm(2,"div",3)(3,"img",4),e.j41(4,"div",5),e.pXf(5,0),e.k0s()()())},styles:[".hand-loader[_ngcontent-%COMP%]{border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.hand-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}@keyframes _ngcontent-%COMP%_handKeyframes{0%{transform:scale(1.2)}25%{transform:scale(1)}40%{transform:scale(1)}60%{transform:scale(1.2)}to{transform:scale(1.2)}}@keyframes _ngcontent-%COMP%_circleKeyframes{0%{transform:scale(0)}20%{transform:scale(0);opacity:1}to{transform:scale(1);opacity:0}}.hand-loader[_ngcontent-%COMP%]:focus   .hand-loader__3d-hand[_ngcontent-%COMP%], .hand-loader[_ngcontent-%COMP%]:hover   .hand-loader__3d-hand[_ngcontent-%COMP%]{filter:drop-shadow(0 0 8px #2472e9)}.hand-loader__container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px}.hand-loader__circle[_ngcontent-%COMP%]{background-color:#fff;position:absolute;left:50%;margin-left:-40.5px;margin-top:-1.5px;width:70px;height:70px;border-radius:50%;animation:_ngcontent-%COMP%_circleKeyframes 2s infinite}.hand-loader__3d-hand[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_handKeyframes 2s ease-in-out infinite;position:absolute;height:96px;width:86px;left:50%;margin-left:-43px;margin-top:27px;transition:filter .3s ease-out}.hand-loader__label[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600;color:#fff;text-shadow:0px 1px 5px black;bottom:40px;position:absolute;text-align:center;width:100%}"],changeDetection:0})}return n})();const CI=["circle"],TI=["progressCircle"],OI=["progressContainer"];let tf=(()=>{class n{get percent(){return this._percent}set percent(t){null!=t&&(this._percent=t,this.setProgress(this.percent))}constructor(t){this.renderer=t,this.ngUnsubscribe=new k.B,this._percent=0}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions()}initSizeObserver(){(0,Sn.R)(window,"resize").pipe((0,wn.B)(10),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(t=100){const o=this.getCircumference();return o-t/100*o}setProgress(t=0){t>=100&&(t=100);const o=this.getCircumference(),s=this.getOffset(t);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}updateDimensions(){const t=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*t),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*t),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(t-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${t}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${t}`);const o=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${o}`),setTimeout(()=>{this.renderer.setStyle(this.progressCircleRef.nativeElement,"transition","stroke-dashoffset 300ms")})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-play-loader"]],viewQuery:function(o,s){if(1&o&&(e.GBs(CI,7),e.GBs(TI,7),e.GBs(OI,7)),2&o){let a;e.mGM(a=e.lsd())&&(s.circleRef=a.first),e.mGM(a=e.lsd())&&(s.progressCircleRef=a.first),e.mGM(a=e.lsd())&&(s.progressContainerRef=a.first)}},inputs:{percent:"percent"},decls:10,vars:0,consts:()=>{let t,o;return t=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,o=$localize`:4b03875d535c300d85a81c17105d24d85adadbae9093351263643113653:3D`,[["circle",""],["progressContainer",""],["progressCircle",""],o,["type","button","aria-label",t,1,"play-loader"],[1,"play-loader__circle"],[1,"play-loader__ring"],[1,"play-loader__ring-inner"],["icon","play",1,"play-loader__icon"],[1,"play-loader__label"]]},template:function(o,s){1&o&&(e.j41(0,"button",4)(1,"div",5,0),e.qSk(),e.j41(3,"svg",6,1),e.nrm(5,"circle",7,2),e.k0s(),e.joV(),e.nrm(7,"app-icon",8),e.j41(8,"div",9),e.pXf(9,3),e.k0s()()())},dependencies:[ut.R],styles:[".play-loader[_ngcontent-%COMP%]{--buttonSize: 35vw;border:0;background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.play-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__circle[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__circle[_ngcontent-%COMP%]{background:#fffc;transform:scale(1.1)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__icon[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__icon[_ngcontent-%COMP%]{color:#2472e9;transform:scale(1.2)}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__label[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__label[_ngcontent-%COMP%]{color:#fff}.play-loader[_ngcontent-%COMP%]:focus   .play-loader__ring[_ngcontent-%COMP%], .play-loader[_ngcontent-%COMP%]:hover   .play-loader__ring[_ngcontent-%COMP%]{stroke:#2472e9}.play-loader__circle[_ngcontent-%COMP%]{width:var(--buttonSize);height:var(--buttonSize);border-radius:50%;background-color:#0c1726cc;display:flex;align-items:center;justify-content:center;position:relative;transition:background-color .25s,color .25s,transform .25s}.play-loader__icon[_ngcontent-%COMP%]{font-size:calc(var(--buttonSize) / 2);color:#ffffffe6;transition:color .25s,transform .25s;margin-right:-10%}.play-loader__label[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:2;font-weight:600}.play-loader__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;stroke-width:4;stroke:#fff;fill:transparent;transform:rotate(-90deg)}@media (min-width: 600px){.play-loader__circle[_ngcontent-%COMP%]{width:160px;height:160px}.play-loader__icon[_ngcontent-%COMP%]{font-size:80px}}"],changeDetection:0})}return n})();class zp{constructor(i,t,o){this.overlay=i,this.content=t,this.data=o,this.afterClosed=new k.B,this.afterClosed$=this.afterClosed.asObservable(),i.backdropClick().subscribe(()=>this._close("backdropClick",o)),this.entered$=(0,ki.h)((0,Sn.R)(i.overlayElement,"mouseenter"),(0,Sn.R)(i.overlayElement,"mouseleave")).pipe((0,W.T)(s=>"mouseenter"===s.type),(0,p.Q)(this.afterClosed$))}close(i){this._close("close",i)}_close(i,t){this.overlay.dispose(),this.afterClosed.next({type:i,data:t}),this.afterClosed.complete()}}var dc=d(76939);function MI(n,i){if(1&n&&e.nrm(0,"div",4),2&n){const t=e.XpG();e.Y8G("innerHTML",t.content,e.npT)}}function II(n,i){1&n&&e.eu8(0)}function PI(n,i){if(1&n&&(e.qex(0),e.DNE(1,II,1,0,"ng-container",5),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngTemplateOutlet",t.content)("ngTemplateOutletContext",t.context)}}function wI(n,i){1&n&&e.eu8(0)}function AI(n,i){if(1&n&&(e.qex(0),e.DNE(1,wI,1,0,"ng-container",6),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngComponentOutlet",t.content)}}let RI=(()=>{class n{constructor(t){this.popupRef=t,this.renderMethod="component"}ngOnInit(){this.content=this.popupRef.content,"string"==typeof this.content?this.renderMethod="text":this.content instanceof e.C4Q&&(this.renderMethod="template",this.context={close:this.popupRef.close.bind(this.popupRef)})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(zp))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-popup"]],decls:5,vars:4,consts:[[1,"popup"],[3,"ngSwitch"],[3,"innerHTML",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"innerHTML"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.qex(1,1),e.DNE(2,MI,1,1,"div",2)(3,PI,2,2,"ng-container",3)(4,AI,2,1,"ng-container",3),e.bVm(),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngSwitch",s.renderMethod),e.R7$(),e.Y8G("ngSwitchCase","text"),e.R7$(),e.Y8G("ngSwitchCase","template"),e.R7$(),e.Y8G("ngSwitchCase","component"))},dependencies:[J.OI,J.T3,J.ux,J.e1],styles:["[_nghost-%COMP%]{width:100%;height:100%}.popup[_ngcontent-%COMP%]{background:#fff;border-radius:4px;padding:24px;overflow-y:auto;width:100%;height:100%;overflow-y:scroll;box-shadow:1px -1px 2px #1c2a3f1a,0 1px 2px #1c2a3f4d}"],changeDetection:0})}return n})();var No=function(n){return n.Above="above",n.Below="below",n.Left="left",n.Right="right",n}(No||{});const NI={[No.Above]:{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-12},[No.Below]:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:12},[No.Left]:{originX:"start",originY:"center",overlayX:"end",overlayY:"center",offsetX:-12},[No.Right]:{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:12}};let nf=(()=>{class n{constructor(t,o){this.overlay=t,this.injector=o}open(t){const{origin:o,content:s,data:a,width:r,height:_,maxHeight:g,maxWidth:P,hasBackdrop:F,positions:ee}=t,le=this.overlay.create(this.getOverlayConfig({origin:o,width:r,height:_,maxHeight:g,maxWidth:P,hasBackdrop:F,positions:ee})),he=new zp(le,s,a),ue=this.createInjector(he,this.injector);return le.attach(new dc.A8(RI,null,ue)),he}createInjector(t,o){const s=new WeakMap([[zp,t]]);return new dc.JP(o,s)}getPositionStrategy(t,o){return this.overlay.position().flexibleConnectedTo(t).withPositions(this.getPositions(o))}getOverlayConfig({origin:t,width:o,height:s,maxHeight:a,maxWidth:r,hasBackdrop:_,positions:g}){return new gr.rR({width:o,height:s,maxHeight:a,maxWidth:r,hasBackdrop:_??!0,backdropClass:"popup-scrim",positionStrategy:this.getOverlayPosition(t,g),scrollStrategy:this.overlay.scrollStrategies.reposition()})}getOverlayPosition(t,o){return o=o||[No.Above,No.Below,No.Left,No.Right],this.overlay.position().flexibleConnectedTo(t).withPositions(this.getPositions(o)).withPush(!0)}getPositions(t){return t.map(o=>NI[o])}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(gr.hJ),e.KVO(e.zZn))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const kI=(n,i,t,o)=>({"badge--blue":n,"badge--green":i,"badge--inline":t,"badge--block":o});function DI(n,i){if(1&n&&(e.j41(0,"div",1),e.nrm(1,"app-icon",3),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("icon",t.icon())}}function LI(n,i){if(1&n&&(e.j41(0,"div",2),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.label())}}let UI=(()=>{class n{constructor(){this.display=(0,e.hFB)("inline"),this.theme=(0,e.hFB)("none"),this.icon=(0,e.hFB)(""),this.label=(0,e.hFB)("")}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-badge"]],inputs:{display:[1,"display"],theme:[1,"theme"],icon:[1,"icon"],label:[1,"label"]},standalone:!0,features:[e.aNF],decls:3,vars:8,consts:[[1,"badge","flex","items-center",3,"ngClass"],[1,"badge__check"],[1,"badge__label"],[3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,DI,2,1,"div",1)(2,LI,2,1,"div",2),e.k0s()),2&o&&(e.Y8G("ngClass",e.ziG(3,kI,"blue"===s.theme(),"green"===s.theme(),"inline"===s.display(),"block"===s.display())),e.R7$(),e.vxM(s.icon()?1:-1),e.R7$(),e.vxM(s.label()?2:-1))},dependencies:[J.MD,J.YU,sn.o,ut.R],styles:[".badge{gap:8px;padding:4px 8px 4px 4px;border-radius:12px}.badge__check{display:flex;align-items:center;justify-content:center;border-radius:100%;width:14px;height:14px;font-size:.625rem;line-height:.75rem}.badge__label{font-size:.75rem;line-height:1rem;font-weight:500}.badge--inline{display:inline-flex}.badge--block{display:flex}.badge--blue{background-color:#a6dfff66;color:#0952c1}.badge--blue .badge__check{background-color:#2472e9;color:#fff}.badge--green{background-color:#c1efdf66;color:#14532d}.badge--green .badge__check{background-color:#166534;color:#fff}\n"],encapsulation:2,changeDetection:0})}return n})();function xI(n,i){if(1&n&&(e.j41(0,"li",4)(1,"div",5),e.EFF(2),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-html",7),e.k0s()()),2&n){const t=i.$implicit,o=i.$index;e.R7$(2),e.SpI("",o+1,"."),e.R7$(2),e.Y8G("markdownText",t.label)}}let jI=(()=>{class n{constructor(){this.references=e.hFB.required()}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-references"]],inputs:{references:[1,"references"]},standalone:!0,features:[e.aNF],decls:6,vars:0,consts:()=>{let t;return t=$localize`:0dc2e6fb6d0244d5024e73ede409a45d5b0c8a64449712922219700420:References`,[t,[1,"flex","flex-row","items-center","pb-3","font-bold"],["data-test","view-references",1,"view-references"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-row","gap-1","text-xs"],[1,"text-xs","text-right",2,"flex","0 0 20px"],[1,"flex-auto","w-full"],[1,"!text-gray-900",3,"markdownText"]]},template:function(o,s){1&o&&(e.j41(0,"div",1),e.pXf(1,0),e.k0s(),e.j41(2,"div",2)(3,"ol",3),e.Z7z(4,xI,5,2,"li",4,e.fX1),e.k0s()()),2&o&&(e.R7$(4),e.Dyx(s.references()))},dependencies:[Ko.V],styles:[".view-references{color:#384c6c}\n"],encapsulation:2,changeDetection:0})}return n})();const VI=n=>({"p-4 rounded shadow":n}),FI=(n,i)=>({hidden:n,"pt-6":i}),GI=n=>({"rotate-90":n});function $I(n,i){if(1&n&&(e.j41(0,"span"),e.pXf(1,0),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.uP7(t.updateDateText()),e.nnv(1)}}function BI(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,1),e.k0s())}function zI(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.open.set(!s.open()))}),e.j41(1,"div",13)(2,"span",14),e.DNE(3,$I,2,1,"span")(4,BI,2,0,"span"),e.k0s(),e.nrm(5,"app-icon",15),e.k0s()()}if(2&n){let t;const o=e.XpG(2);e.R7$(3),e.vxM(null!=(t=o.sourceInfo().reviewed)&&t.enabled&&null!=(t=o.sourceInfo().audit)&&t.enabled&&o.updateDate()?3:4),e.R7$(2),e.Y8G("ngClass",e.eq3(2,GI,o.open()))}}function WI(n,i){1&n&&e.nrm(0,"app-badge",17)}function XI(n,i){if(1&n&&(e.j41(0,"div")(1,"span",20),e.pXf(2,2),e.k0s(),e.j41(3,"time"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(3),e.BMQ("datetime",t.updateDateTime()),e.R7$(),e.JRh(t.updateDateText())}}function HI(n,i){if(1&n&&(e.j41(0,"a",19)(1,"span"),e.pXf(2,3),e.k0s(),e.nrm(3,"app-icon",21),e.k0s()),2&n){const t=e.XpG(3);e.BMQ("href",t.sourceInfo().reviewed.url,e.B4B)}}function QI(n,i){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,4),e.k0s(),e.EFF(3),e.k0s()),2&n){const t=e.XpG(4);e.R7$(3),e.SpI(" ",t.sourceInfo().collaborated.authors," ")}}function YI(n,i){if(1&n&&(e.j41(0,"div",16),e.nrm(1,"app-badge",22),e.DNE(2,QI,4,1,"div"),e.k0s()),2&n){const t=e.XpG(3);e.R7$(2),e.vxM(t.sourceInfo().collaborated.authors?2:-1)}}function KI(n,i){if(1&n&&(e.j41(0,"div",10)(1,"div",16),e.DNE(2,WI,1,0,"app-badge",17),e.j41(3,"div",18),e.DNE(4,XI,5,2,"div")(5,HI,4,1,"a",19),e.k0s()(),e.DNE(6,YI,3,1,"div",16),e.k0s()),2&n){let t,o,s,a;const r=e.XpG(2);e.R7$(2),e.vxM(null!=(t=r.sourceInfo().reviewed)&&t.enabled?2:-1),e.R7$(2),e.vxM(null!=(o=r.sourceInfo().audit)&&o.enabled&&r.updateDate()?4:-1),e.R7$(),e.vxM(null!=(s=r.sourceInfo().reviewed)&&s.url?5:-1),e.R7$(),e.vxM(null!=(a=r.sourceInfo().collaborated)&&a.enabled?6:-1)}}function qI(n,i){if(1&n&&(e.j41(0,"div",11),e.nrm(1,"app-view-references",23),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("references",t.references())}}function JI(n,i){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,5),e.k0s(),e.EFF(3),e.k0s()),2&n){const t=e.XpG(3);e.R7$(3),e.SpI(" ",t.updateDateText(),"")}}function ZI(n,i){if(1&n&&(e.j41(0,"div",10),e.nrm(1,"app-view-references",23),e.DNE(2,JI,4,1,"div"),e.k0s()),2&n){let t;const o=e.XpG(2);e.R7$(),e.Y8G("references",o.references()),e.R7$(),e.vxM(null!=(t=o.sourceInfo().audit)&&t.enabled&&o.updateDateText()?2:-1)}}function eP(n,i){if(1&n&&(e.j41(0,"div")(1,"em",20),e.pXf(2,6),e.k0s(),e.EFF(3),e.k0s()),2&n){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.updateDateText(),"")}}function tP(n,i){if(1&n&&(e.j41(0,"div",7),e.DNE(1,zI,6,4,"button",8),e.j41(2,"div",9),e.DNE(3,KI,7,4,"div",10)(4,qI,2,1,"div",11)(5,ZI,3,2,"div",10)(6,eP,4,1,"div"),e.k0s()()),2&n){let t;const o=e.XpG();e.Y8G("ngClass",e.eq3(7,VI,o.toggleable()&&o.open())),e.R7$(),e.vxM(o.toggleable()?1:-1),e.R7$(),e.Y8G("ngClass",e.l_i(9,FI,o.toggleable()&&!o.open(),o.toggleable()&&o.open())),e.R7$(),e.vxM(o.displaySources()?3:-1),e.R7$(),e.vxM(o.displayReferences()&&o.displaySources()?4:-1),e.R7$(),e.vxM(o.displayReferences()&&!o.displaySources()?5:-1),e.R7$(),e.vxM(!o.displayReferences()&&!o.displaySources()&&null!=(t=o.sourceInfo().audit)&&t.enabled&&o.updateDateText()?6:-1)}}let _c=(()=>{class n{constructor(t){this.store=t,this.sourceInfo=(0,je.ot)(this.store.select(dt.getStorySourceInfo)),this.storyType=(0,je.ot)(this.store.select(dt.getStoryType)),this.selectedBookmark=(0,je.ot)(this.store.select(ft.getSelectedBookmark)),this.toggleable=(0,e.hFB)(!1),this.open=(0,e.vPA)(!1),this.showSources=(0,e.EWP)(()=>this.storyType()===Se.c.Module),this.updateDate=(0,e.EWP)(()=>this.selectedBookmark()?.update_date_time??this.selectedBookmark()?.create_date_time),this.updateDateTime=(0,e.EWP)(()=>{const o=this.updateDate();return o?new Date(o).toISOString():void 0}),this.updateDateText=(0,e.EWP)(()=>{const o=this.updateDate();return o?new Date(o).toLocaleDateString():void 0}),this.displaySources=(0,e.EWP)(()=>{const o=this.sourceInfo();return this.showSources()&&o?.reviewed?.enabled||o?.collaborated?.enabled}),this.displayReferences=(0,e.EWP)(()=>this.references().length>0),this.references=(0,e.EWP)(()=>this.sourceInfo()?.references??[])}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-source-info"]],inputs:{toggleable:[1,"toggleable"]},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let t,o,s,a,r,_,g,P,F;return t=$localize`:ec2c1d22b6e2207023be0f04e37c533e4e5cc7ec7104746773075604544:Medically reviewed on ${"\ufffd0\ufffd"}:INTERPOLATION:`,o=$localize`:5bbf2bcdb5d3aa2b328ab66786845485b997e0e75233133710285034701:Source Information`,s=$localize`:8130925c3a61817eae8b407d5bbcdaaba8758d15429607993299883476:Medically Reviewed`,a=$localize`:c0036f237054be68e8a0cc165f3b71b2f874cbf163496578423295101:Updated on `,r=$localize`:9a747d50c4db80b1cb473adfd9e5a9c9e034b7d55574571308850658695:Read about our review process.`,_=$localize`:d5b8a08bdd48b443f541a8477c756faa70d686d5214207563889300286:Built in Collaboration`,g=$localize`:525d654f08c7e65835ec2836814a49aa1ba604f34382887906654551268:Created with`,P=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,F=$localize`:bc56b2e58706df3bcb07aa8e07b86d26e1e3d93d738579991266800938:Updated on`,[t,o,a,r,g,P,F,[1,"transition-all",3,"ngClass"],["app-view-button","","buttonSize","2xsmall",1,"w-full"],[1,"flex","flex-col","gap-6","[&_a]:break-all","text-xs",3,"ngClass"],[1,"flex","flex-col","gap-6"],["id","view-source-info-references"],["app-view-button","","buttonSize","2xsmall",1,"w-full",3,"click"],[1,"flex","items-center"],[1,"text-xs"],["icon","angle-right",1,"ml-1","transition-transform",3,"ngClass"],[1,"flex","flex-col","gap-2"],["theme","blue","icon","check","label",s],[1,"flex","flex-col","gap-1"],["target","_blank","rel","noreferrer nofollow",1,"hover:underline"],[1,"font-bold"],["icon","arrow-up-right-from-square",1,"ml-1"],["theme","green","icon","check","label",_],[3,"references"]]},template:function(o,s){1&o&&e.DNE(0,tP,7,12,"div",7),2&o&&e.vxM(s.sourceInfo()?0:-1)},dependencies:[J.MD,J.YU,bn.C,Qt.ri,sn.o,ut.R,UI,jI],styles:[".view-source-info{color:#0c1726}.view-source-info__toggle{color:#0c1726;font-size:.75rem;line-height:1rem}\n"],encapsulation:2,changeDetection:0})}return n})();var uc=d(5951),Wp=d(78109);const nP=[[["app-list-item"]]],iP=["app-list-item"];var sf=function(n){return n.Default="default",n.Commafied="commafied",n.flat="flat",n.inline="inline",n.bulleted="bulleted",n}(sf||{});let hc=(()=>{class n{constructor(){this.listType=sf.Default,this.dense=!1}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-list"]],inputs:{listType:"listType",dense:"dense"},ngContentSelectors:iP,decls:2,vars:3,consts:[[1,"list",3,"ngClass"]],template:function(o,s){1&o&&(e.NAR(nP),e.j41(0,"div",0),e.SdG(1),e.k0s()),2&o&&(e.AVh("list--dense",s.dense),e.Y8G("ngClass","list--"+s.listType))},dependencies:[J.YU],styles:['@charset "UTF-8";.list{display:flex;flex-direction:column}.list--dense{padding:0!important}.list--default app-list-item{display:list-item;margin-left:16px;list-style-type:disc}.list--commafied{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--commafied app-list-item:not(:last-child):after{content:", ";float:right;padding-right:4px}.list--bulleted{align-items:center;display:flex;flex-direction:row;flex-wrap:wrap;padding:0 4px 4px 0}.list--bulleted app-list-item:not(:last-child):after{content:" \\2022  ";float:right;padding-right:4px;padding-left:4px}.list--flat app-list-item:not(:last-child){margin-bottom:4px}.list--inline{display:inline-flex;align-items:center;display:flex;flex-direction:row;flex-wrap:wrap}.list--inline app-list-item{margin:0 8px 4px 0}.list__item{display:block}\n'],encapsulation:2,changeDetection:0})}return n})();const oP=["*"];let gc=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-list-item"]],ngContentSelectors:oP,decls:1,vars:0,template:function(o,s){1&o&&(e.NAR(),e.SdG(0))},encapsulation:2,changeDetection:0})}return n})();function sP(n,i){if(1&n&&(e.j41(0,"app-list-item")(1,"div",1),e.EFF(2),e.k0s()()),2&n){const t=i.$implicit;e.R7$(),e.BMQ("data-id",t.id),e.R7$(),e.JRh(t.label)}}let af=(()=>{class n{get objectIds(){return this._objectIds}set objectIds(t){this._objectIds=t;const o=this.store.selectSnapshot(ze.S.getViewGraph);this.nodes=this.graphService.getNodes(o,t),this.changeRef.markForCheck()}constructor(t,o,s){this.store=t,this.graphService=o,this.changeRef=s}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(Wp.w),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-object-tree"]],inputs:{objectIds:"objectIds"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[1,"text-sm","my-1"]],template:function(o,s){1&o&&(e.j41(0,"app-list"),e.DNE(1,sP,3,2,"app-list-item",0),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",s.nodes))},dependencies:[J.Sq,hc,gc],changeDetection:0})}return n})(),rf=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer-number"]],inputs:{number:"number"},decls:3,vars:1,consts:[[1,"number","text-2xs"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div"),e.EFF(2),e.k0s()()),2&o&&(e.R7$(2),e.JRh(s.number))},styles:[".number[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:20px;height:20px;color:#0c1726;border:1px solid rgba(56,76,108,.5);border-radius:50%}"],changeDetection:0})}return n})();function cP(n,i){if(1&n&&(e.j41(0,"div",3)(1,"div",4),e.nrm(2,"app-view-quiz-answer-number",5),e.k0s(),e.j41(3,"div",6),e.nrm(4,"app-quiz-label-anatomy-select",7),e.k0s()()),2&n){const t=i.index,o=e.XpG();e.R7$(2),e.Y8G("number",t+1),e.R7$(2),e.Y8G("options",o.options)("formControlName",t)}}class Nr{get options(){return this._options}set options(i){(0,u.isEqual)(i,this._options)||(this._options=i,this.buildFormOptions(i))}constructor(i){this.formBuilder=i,this.valueChange=new e.bkB,this.ngUnsubscribe=new k.B,this._options=[],this.form=this.formBuilder.group({options:this.formBuilder.array([])}),this.optionsArray=this.form.get("options")}ngOnInit(){this.initFormListeners(),this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({options:i})=>{this.valueChange.next(i)})}init(){this.activeSubmission$.pipe((0,D.p)(i=>!(0,u.isNil)(i)&&!(0,u.isNil)(i.answer)),(0,ks.J)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const o=function aP(n,i,t){const o=i.findIndex((a,r)=>!(0,u.isEqual)(n[r],a)),s=i[o];return i.map((a,r)=>(0,u.isEqual)(s,a)&&r!==o?t:a)}(i.answer||[],t.answer||[],"");(0,u.isEqual)(t,o)||this.form.patchValue({options:o||[]})}),this.activeSubmission$.pipe((0,D.p)(i=>!(0,u.isNil)(i)&&!(0,u.isNil)(i.answer)&&Array.isArray(i.answer)),(0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const o=i.answer;(0,u.isEqual)(this.form.value.options,o)||this.form.patchValue({options:o},{emitEvent:!1,onlySelf:!0})})}buildFormOptions(i){this.optionsArray.clear(),i.forEach(()=>{this.optionsArray.push(this.formBuilder.control(""))}),this.optionsArray.setValue(i.map(()=>""))}static#e=this.\u0275fac=function(t){return new(t||Nr)(e.rXU(fe.ze))};static#t=this.\u0275cmp=e.VBU({type:Nr,selectors:[["app-view-quiz-label-anatomy"]],inputs:{options:"options"},outputs:{valueChange:"valueChange"},decls:3,vars:2,consts:[[1,"options",3,"formGroup"],["formArrayName","options"],["class","options__item","data-test","questionAnswer",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"options__item"],[1,"mr-2"],[3,"number"],[1,"options__item-select"],[3,"options","formControlName"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,cP,5,3,"div",2),e.k0s()()),2&t&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.options))},dependencies:[J.Sq,fe.BC,fe.cb,fe.j4,fe.JD,fe.v8,Np,rf],styles:[".options__item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-bottom:12px}.options__item-select[_ngcontent-%COMP%]{border:1px solid #8999b3;border-radius:4px;flex:1 1 auto}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Fe.j.getActiveSubmission),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Nr.prototype,"activeSubmission$",void 0);var lf=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},cf=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function dP(n,i){if(1&n&&(e.j41(0,"mat-radio-button",8),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.label," ")}}function _P(n,i){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"mat-radio-group",6),e.bIt("change",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleMultipleChoiceChange(s))}),e.DNE(2,dP,2,2,"mat-radio-button",7),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.question.data.options)}}function pP(n,i){if(1&n&&(e.j41(0,"div",10),e.nrm(1,"app-view-quiz-object-tree",11),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("objectIds",t.question.data.correctAnswer)}}function uP(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,pP,2,1,"div",9),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",t.question.data.showAnswerList)}}function hP(n,i){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"app-view-quiz-label-anatomy",12),e.bIt("valueChange",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleLabelAnatomyChanges(s))}),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(),e.Y8G("options",t.question.data.options)}}function gP(n,i){if(1&n&&(e.j41(0,"div",1)(1,"div",2),e.nrm(2,"app-content-blocks",3),e.k0s(),e.j41(3,"div",4),e.DNE(4,_P,3,1,"div",5)(5,uP,2,1,"div",5)(6,hP,2,1,"div",5),e.k0s()()),2&n){const t=e.XpG();e.R7$(2),e.Y8G("contentBlocks",t.question.questionPrompt),e.R7$(),e.Y8G("ngSwitch",t.question.type),e.R7$(),e.Y8G("ngSwitchCase",t.QuestionType.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",t.QuestionType.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",t.QuestionType.LabelAnatomy)}}class Qs{get question(){return this._question}set question(i){this._question=i,this.initQuestionListeners()}get value(){return this._value}set value(i){this._value=i,this.onChange(i)}constructor(i,t){this.changeRef=i,this.viewService=t,this.disabled=!1,this.QuestionType=Pn.Q5,this.ngUnsubscribe=new k.B}handleMultipleChoiceChange(i){this.writeValue(i.value)}handleLabelAnatomyChanges(i){this.writeValue(i)}initQuestionListeners(){switch(this.question.type){case Pn.Q5.SelectAnatomy:this.initSelectAnatomyListeners();break;case Pn.Q5.Instructions:this.initInstructions()}}initSelectAnatomyListeners(){this.checkedNodesIds$.pipe((0,Tn.F)((i,t)=>(0,u.isEqual)(i,t)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.writeValue(i),this.changeRef.markForCheck()})}initInstructions(){setTimeout(()=>{this.writeValue("-"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}onChange(i){}onTouched(){}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}writeValue(i){this.value=i}setDisabledState(i){this.disabled=i}static#e=this.\u0275fac=function(t){return new(t||Qs)(e.rXU(e.gRc),e.rXU(En))};static#t=this.\u0275cmp=e.VBU({type:Qs,selectors:[["app-view-quiz-question"]],inputs:{question:"question",value:"value"},features:[e.Jv_([{provide:fe.kq,useExisting:(0,e.Rfq)(()=>Qs),multi:!0}])],decls:1,vars:1,consts:[["class","view-quiz-question text-sm mb-8","data-test","question",4,"ngIf"],["data-test","question",1,"view-quiz-question","text-sm","mb-8"],["data-test","questionPrompt",1,"view-quiz-question__prompt"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"flex","flex-col",3,"change"],["data-test","questionAnswer","class","view-quiz-question__option",3,"value",4,"ngFor","ngForOf"],["data-test","questionAnswer",1,"view-quiz-question__option",3,"value"],["class","ml-3",4,"ngIf"],[1,"ml-3"],[3,"objectIds"],[3,"valueChange","options"]],template:function(t,o){1&t&&e.DNE(0,gP,7,5,"div",0),2&t&&e.Y8G("ngIf",o.question)},dependencies:[J.Sq,J.bT,J.ux,J.e1,uc.VT,uc._g,Vs,af,Nr],styles:[".view-quiz-question__prompt{margin-bottom:8px}.view-quiz-question__option{font-size:.875rem;line-height:1.25rem;padding:12px;white-space:normal!important}.view-quiz-question__option>*{white-space:normal!important}\n"],encapsulation:2,changeDetection:0})}lf([(0,l.l6)(Rn.z.getCheckedNodeIds),cf("design:type",h.c)],Qs.prototype,"checkedNodesIds$",void 0),lf([(0,l.l6)(Fe.j.getActiveSubmission),cf("design:type",h.c)],Qs.prototype,"activeSubmission$",void 0);const mP=["*"];function fP(n,i){1&n&&e.nrm(0,"app-icon",6)}function SP(n,i){1&n&&e.nrm(0,"app-icon",7)}function bP(n,i){1&n&&(e.j41(0,"span",8),e.nrm(1,"span",9),e.k0s())}let Xp=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer-option"]],inputs:{correct:"correct"},ngContentSelectors:mP,decls:7,vars:7,consts:[["data-test","answerOptionContainer",1,"option"],[1,"flex","relative",3,"ngSwitch"],["class","option__icon option__icon--correct","style","font-size: 20px","icon","check-circle",4,"ngSwitchCase"],["class","option__icon option__icon--incorrect","style","font-size: 20px","icon","times-circle",4,"ngSwitchCase"],["class","option__icon",4,"ngSwitchDefault"],[1,"pl-2"],["icon","check-circle",1,"option__icon","option__icon--correct",2,"font-size","20px"],["icon","times-circle",1,"option__icon","option__icon--incorrect",2,"font-size","20px"],[1,"option__icon"],[1,"mat-radio-outer-circle"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"div",0)(1,"div",1),e.DNE(2,fP,1,0,"app-icon",2)(3,SP,1,0,"app-icon",3)(4,bP,2,0,"span",4),e.j41(5,"div",5),e.SdG(6),e.k0s()()()),2&o&&(e.AVh("option--correct",!0===s.correct)("option--incorrect",!1===s.correct),e.R7$(),e.Y8G("ngSwitch",s.correct),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1))},dependencies:[J.ux,J.e1,J.fG,ut.R],styles:[".option[_ngcontent-%COMP%]{padding:12px;border-radius:4px;margin-bottom:8px;color:#0c1726}.option--correct[_ngcontent-%COMP%]{border:1px solid #86efac;background-color:#f0fdf4}.option--incorrect[_ngcontent-%COMP%]{border:1px solid #dc2626;background-color:#fee2e2}.option__icon[_ngcontent-%COMP%]{position:relative;flex:0 0 20px;justify-content:center}.option__icon--correct[_ngcontent-%COMP%]{color:#86efac}.option__icon--incorrect[_ngcontent-%COMP%]{color:#dc2626}"],changeDetection:0})}return n})();function yP(n,i){if(1&n&&(e.j41(0,"div")(1,"app-view-quiz-answer-option",1)(2,"div"),e.EFF(3),e.k0s()()()),2&n){const t=i.$implicit,o=e.XpG();e.R7$(),e.Y8G("correct",o.isOptionAnswerCorrect(o.question,t.value,o.answer)),e.R7$(2),e.SpI(" ",t.label," ")}}let vP=(()=>{class n{constructor(){}ngOnInit(){}isOptionAnswerCorrect(t,o,s){const a=(0,_o.Br)(t,[o]);return o===s[0]||a?a:void 0}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-multiple-choice-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"correct"]],template:function(o,s){1&o&&e.DNE(0,yP,4,2,"div",0),2&o&&e.Y8G("ngForOf",s.question.data.options)},dependencies:[J.Sq,Xp],changeDetection:0})}return n})();function EP(n,i){1&n&&(e.qex(0),e.pXf(1,1),e.bVm())}function CP(n,i){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function TP(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",11)(1,"button",12),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleSelectedObjectsClick(s.answer))}),e.pXf(2,3),e.k0s(),e.j41(3,"button",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleCorrectObjectsClick(s.question.data.correctAnswer))}),e.EFF(4," Highlight Correct Answer "),e.k0s()()}}let OP=(()=>{class n{get isCorrect(){return(0,_o.Br)(this.question,this.answer)}constructor(t,o,s){this.graphService=t,this.viewService=o,this.store=s}fadeNonselected(t){const o=this.store.selectSnapshot(ze.S.getViewGraph),s=this.graphService.getInverseSelection(o,t),a=this.graphService.getNodes(o,s);this.store.dispatch(new Vt.Jp(Ms.EC,a.map(r=>r.id)))}handleCorrectObjectsClick(t){this.highlightNodes(t)}handleSelectedObjectsClick(t){this.highlightNodes(t)}highlightNodes(t){const o=t.filter(s=>s&&""!==s);this.resetSelectAndFade(),this.repositionCamera(o),this.fadeNonselected(o)}repositionCamera(t){1===t.length?this.store.dispatch(new st.W6(t[0])):this.viewService.resetCamera()}resetSelectAndFade(){this.viewService.clearSelectedNodes(),this.viewService.clearFadedNodes()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Wp.w),e.rXU(En),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-select-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:11,vars:5,consts:()=>{let t,o,s;return t=$localize`:4274205d4ae04ab28b67840a011bbbc3c207f6083164453258197222114:Correct! You selected:`,o=$localize`:86fadbb89f45c1d0fad1eae1936d43d4e59e065a682829795532587629:Incorrect! You selected:`,s=$localize`:a5dfb5defc5b4f7d9d17e3175f3a2832a33801872737293371102556031: Highlight My Answer `,[["selectAnatomyAnswer",""],t,o,s,[3,"correct"],[1,"flex","flex-col"],[1,"font-semibold"],[4,"ngIf"],[1,"mt-2","ml-2"],[3,"objectIds"],["class","flex flex-col gap-2 mt-4",4,"ngIf"],[1,"flex","flex-col","gap-2","mt-4"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightUserAnswers",1,"w-full",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","highlightCorrectAnswers",1,"w-full",3,"click"]]},template:function(o,s){if(1&o&&(e.j41(0,"div")(1,"app-view-quiz-answer-option",4,0)(3,"div",5)(4,"div")(5,"span",6),e.DNE(6,EP,2,0,"ng-container",7)(7,CP,2,0,"ng-container",7),e.k0s()(),e.j41(8,"div",8),e.nrm(9,"app-view-quiz-object-tree",9),e.k0s()()(),e.DNE(10,TP,5,0,"div",10),e.k0s()),2&o){const a=e.sdS(2);e.R7$(),e.Y8G("correct",s.isCorrect),e.R7$(5),e.Y8G("ngIf",a.correct),e.R7$(),e.Y8G("ngIf",!a.correct),e.R7$(2),e.Y8G("objectIds",s.answer),e.R7$(),e.Y8G("ngIf",!s.summary&&!s.isCorrect)}},dependencies:[J.bT,Qt.ri,af,Xp],changeDetection:0})}return n})();function MP(n,i){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.label.title," ")}}function IP(n,i){if(1&n&&(e.j41(0,"div"),e.pXf(1,2),e.k0s(),e.j41(2,"div",11),e.pXf(3,3),e.k0s()),2&n){const t=e.XpG(),o=t.$implicit,s=t.index,a=e.XpG();e.R7$(),e.uP7(a.getSelectedUserOption(s).label.title.trim()),e.nnv(1),e.R7$(2),e.uP7(o.label.title.trim()),e.nnv(3)}}function PP(n,i){if(1&n&&(e.j41(0,"div",5)(1,"div",6),e.nrm(2,"app-view-quiz-answer-number",7),e.k0s(),e.j41(3,"div",8)(4,"app-view-quiz-answer-option",9,0),e.DNE(6,MP,2,1,"div",10)(7,IP,4,2,"ng-template",null,1,e.C5r),e.k0s()()()),2&n){const t=i.index,o=e.sdS(5),s=e.sdS(8),a=e.XpG();e.R7$(2),e.Y8G("number",t+1),e.R7$(2),e.Y8G("correct",a.isOptionAnswerCorrect(t)),e.R7$(2),e.Y8G("ngIf",o.correct)("ngIfElse",s)}}let wP=(()=>{class n{constructor(){}ngOnInit(){}isOptionAnswerCorrect(t){return this.answer[t]===this.question.data.correctAnswer[t]}getSelectedUserOption(t){const o=this.answer[t];return this.question.data.options.find(s=>s.value===o)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-label-anatomy-answer"]],inputs:{question:"question",answer:"answer",summary:"summary"},decls:1,vars:1,consts:()=>{let t,o;return t=$localize`:a72b1c5957d49334a91017e69eb28a64b4794be93931625009645654184:You selected ${"\ufffd0\ufffd"}:INTERPOLATION:.`,o=$localize`:68452fc86b9a1e10579d11cafee518846c2acf747572660995305138875:This is the ${"\ufffd0\ufffd"}:INTERPOLATION:.`,[["answerOption",""],["falseBlock",""],t,o,["class","answers",4,"ngFor","ngForOf"],[1,"answers"],[1,"answers__number"],[3,"number"],[1,"answers__option"],[3,"correct"],[4,"ngIf","ngIfElse"],[1,"mt-1"]]},template:function(o,s){1&o&&e.DNE(0,PP,9,4,"div",4),2&o&&e.Y8G("ngForOf",s.question.data.options)},dependencies:[J.Sq,J.bT,Xp,rf],styles:[".answers[_ngcontent-%COMP%]{display:flex;flex-direction:row}.answers__number[_ngcontent-%COMP%]{border-top:1px solid transparent;margin-top:12px;margin-inline-end:8px}.answers__option[_ngcontent-%COMP%]{flex:1 1 auto}"],changeDetection:0})}return n})();function AP(n,i){if(1&n&&(e.j41(0,"div",7),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI("",t.questionNumber,".")}}function RP(n,i){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-multiple-choice-answer",8),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("question",t.question)("answer",t.answer)("summary",t.summary)}}function NP(n,i){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-select-anatomy-answer",8),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("question",t.question)("answer",t.answer)("summary",t.summary)}}function kP(n,i){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-view-quiz-label-anatomy-answer",8),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("question",t.question)("answer",t.answer)("summary",t.summary)}}function DP(n,i){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-content-blocks",3),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("contentBlocks",t.question.explanation)}}let df=(()=>{class n{constructor(t,o){this.store=t,this.contentBlocksService=o,this.QuestionType=Pn.Q5,this.hasExplanation=!1}ngOnInit(){this.store.dispatch(new Xt.B.SetQuizPickMode("none")),this.hasExplanation=this.contentBlocksService.hasContentBlockText(this.question.explanation)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(Ns.V))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-quiz-answer"]],inputs:{question:"question",questionNumber:"questionNumber",answer:"answer",summary:"summary"},decls:10,vars:7,consts:[["data-test","answer",1,"answer"],[1,"answer__prompt"],["class","mr-1",4,"ngIf"],[3,"contentBlocks"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","answer__explanation",4,"ngIf"],[1,"mr-1"],[3,"question","answer","summary"],[1,"answer__explanation"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,AP,2,1,"div",2),e.j41(3,"div"),e.nrm(4,"app-content-blocks",3),e.k0s()(),e.j41(5,"div",4),e.DNE(6,RP,2,3,"div",5)(7,NP,2,3,"div",5)(8,kP,2,3,"div",5),e.k0s(),e.DNE(9,DP,2,1,"div",6),e.k0s()),2&o&&(e.R7$(2),e.Y8G("ngIf",s.questionNumber),e.R7$(2),e.Y8G("contentBlocks",s.question.questionPrompt),e.R7$(),e.Y8G("ngSwitch",s.question.type),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",s.QuestionType.LabelAnatomy),e.R7$(),e.Y8G("ngIf",s.hasExplanation))},dependencies:[J.bT,J.ux,J.e1,Vs,vP,OP,wP],styles:[".answer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.answer__prompt[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.answer__explanation[_ngcontent-%COMP%]{padding-top:32px}"],changeDetection:0})}return n})();var LP=d(60391);let UP=(()=>{class n{constructor(t,o,s){this.http=t,this.markdownService=o,this.store=s}downloadResultsPDF(t="",o="",s="",a,r){return this.http.post("/ws/mc/pdf",this.getPDFHTML(t,o,s,a,r),{responseType:"arraybuffer",headers:new f.Lr({"Content-Type":"text/html; charset=utf-8"})}).pipe((0,W.T)(_=>{const g=new Blob([_],{type:"application/pdf"}),P=window.URL.createObjectURL(g),F=(s||"Quiz Results").replace(/ /g,"_").replace(/\W/g,"").toLowerCase(),ee=document.createElement("a");return ee.download=F,ee.href=P,ee.click(),!0}),(0,zi.W)(()=>(0,Rt.of)(!1)))}getPDFHTML(t,o,s,a,r){return`\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <style>\n\n          @media print {\n\n            html {\n              font-family: Arial;\n            }\n\n            body {\n              margin: 0;\n            }\n\n            ol {\n              list-style-position: inside;\n              padding-left: 0;\n            }\n\n            header {\n              position: running(header);\n              width: 100%;\n            }\n\n            header > div {\n              display: flex;\n              justify-content: space-between;\n            }\n\n            @page {\n              size: letter portrait;\n              margin: 1in;\n              \n              @top-center {\n                content: element(header);\n                width: 100%;\n              }\n\n              @bottom-center {\n                content: "Page " counter(page) " of " counter(pages);\n                font-size: 10px;\n              }\n            }\n\n          }\n          \n        </style>\n      </head>\n      <body style="font-size: 12px">\n\n        <header>\n          <div style="margin-bottom: .05in">\n            <div style="font-weight: 900">${t}</div>\n            <div style="text-align: right">\n                <span style="font-weight: 900">Score: </span>\n                <span>${r.correctTotal} out of ${r.scorableTotal}</span>\n            </div>\n          </div>\n\n          <div>\n            <div>${o}</div>\n            <div style="text-align: right">\n              <span style="font-weight: 900">Percentage: </span>\n              <span>${r.score}%</span>\n            </div>\n          </div>\n        </header>\n\n        \x3c!-- PDF CONTENT --\x3e\n\n        <div style="font-weight: 900; margin-bottom: .05in">${s}</div>\n        <div style="font-size: 10px">QUIZ RESULTS</div>\n\n        <br />\n\n        ${this.createPDFResponses(a,r)}\n        \n      </body>\n    </html>\n    `}createPDFResponses(t,o){const s=t.filter(g=>g.type!==Pn.Q5.Instructions),a=this.markdownService.renderer.list,r=this.markdownService.renderer.listitem;this.markdownService.renderer.list=g=>g.replace(/,$/,""),this.markdownService.renderer.listitem=g=>` ${g},`;const _=s.map(g=>{const P=this.getNormalizedAnswer(o.questionAnswers[g.id]);return this.createPDFResponse(g,P)}).join("\n      <br />\n      <br />\n    ");return this.markdownService.renderer.list=a,this.markdownService.renderer.listitem=r,`\n      <ol>\n        ${_}\n      </ol>\n    `}getNormalizedAnswer(t){return typeof t>"u"?[]:"string"==typeof t?[t]:t}createPDFResponse(t,o){let s=this.convertContentBlockArray(t.questionPrompt);t.type===Pn.Q5.SelectAnatomy&&t.data.showAnswerList&&(s=`${s} ${this.printAnatomyList(t.data.correctAnswer)}.`);const a=(0,_o.Br)(t,o);return`\n      <li style="font-weight: 900">\n        ${s}\n        <div style="font-weight: 400; margin-top: .1in; margin-left: .2in; line-height: .2in;">\n          <img src="${(a?"correct":"incorrect")+".svg"}" />\n          <span style="font-weight: 900; margin-left: .05in; margin-right: .05in">${a?"Correct!":"Incorrect!"}</span>\n          ${this.getResponseText(t,o,a)}\n        </div>\n        <p style="font-weight: 400; font-style: italic; margin-bottom: 0">\n          ${this.convertContentBlockArray(t.explanation)}\n        </p>\n      </li>\n    `}getResponseText(t,o,s){let a="";switch(t.type){case Pn.Q5.MultipleChoice:a=`You selected: ${this.getMultipleChoiceLabel(t,o[0])}.`,s||(a=`${a} The correct answer is: ${this.getMultipleChoiceLabel(t,t.data.correctAnswer)}.`);break;case Pn.Q5.LabelAnatomy:a=`You labeled the anatomy ${s?"correctly":"incorrectly. The correct answer is"}: ${this.printLabelList(t)}.`;break;case Pn.Q5.SelectAnatomy:s||(a=`You selected: ${this.printAnatomyList(o)}.`)}return a}printAnatomyList(t){const o=this.store.selectSnapshot(ze.S.getViewGraph);return t.map(s=>(0,na.dV)(o,s)?.label).join(", ")}printLabelList(t){return t.data.correctAnswer.map((o,s)=>`${s+1}. ${t.data.options.find(r=>r.value===o).label.title}`).join(", ")}getMultipleChoiceLabel(t,o){return t.data.options.find(a=>a.value===o)?.label}convertContentBlockArray(t){return t.filter(o=>o.type===hi.m.Markdown).map(o=>{const s=this.markdownService.parse(o.markdown);return this.stripHTML(s)}).join("\n")}stripHTML(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(Wn.Rl),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var gs=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},ms=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function xP(n,i){if(1&n&&(e.j41(0,"div",10)(1,"div",11),e.nrm(2,"app-progress-circle",12),e.j41(3,"div",13),e.pXf(4,0),e.k0s()()()),2&n){const t=e.XpG();e.R7$(2),e.Y8G("progress",null==t.quizScore?null:t.quizScore.score),e.R7$(2),e.uP7(null==t.quizScore?null:t.quizScore.correctTotal)(null==t.quizScore?null:t.quizScore.scorableTotal),e.nnv(4)}}function jP(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleResultsClick())}),e.nrm(1,"app-icon",21),e.qex(2),e.pXf(3,1),e.bVm(),e.k0s()}}function VP(n,i){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function FP(n,i){1&n&&(e.qex(0),e.pXf(1,3),e.bVm())}function GP(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleToggleSummaryClick())}),e.DNE(1,VP,2,0,"ng-container",23)(2,FP,2,0,"ng-container",23),e.k0s()}if(2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",t.showExplanation),e.R7$(),e.Y8G("ngIf",!t.showExplanation)}}function $P(n,i){if(1&n&&(e.j41(0,"div",26),e.nrm(1,"app-view-quiz-answer",27),e.k0s()),2&n){const t=i.$implicit,o=i.index,s=e.XpG(3);e.R7$(),e.Y8G("question",t)("questionNumber",o+1)("answer",null==s.quizScore?null:s.quizScore.questionAnswers[t.id])("summary",!0)}}function BP(n,i){if(1&n&&(e.j41(0,"div",24),e.DNE(1,$P,2,4,"div",25),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.questions)}}function zP(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",28),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleRestartClick())}),e.pXf(1,4),e.k0s()}}function WP(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleExitClick())}),e.pXf(1,5),e.k0s()}}function XP(n,i){if(1&n&&(e.j41(0,"div",14),e.DNE(1,jP,4,0,"button",15)(2,GP,3,2,"button",16)(3,BP,2,1,"div",17)(4,zP,2,0,"button",18),e.nI1(5,"async"),e.DNE(6,WP,2,0,"button",19),e.nI1(7,"async"),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.showSummaryEnabled&&t.showExplanationEnabled),e.R7$(),e.Y8G("ngIf",t.showSummaryEnabled&&t.showExplanationEnabled),e.R7$(),e.Y8G("ngIf",t.showExplanationEnabled&&t.showExplanation),e.R7$(),e.Y8G("ngIf",e.bMT(5,5,t.enableQuizRetake$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(7,7,t.quizLocked$))}}function HP(n,i){1&n&&(e.j41(0,"div",30),e.nrm(1,"app-spinner",31),e.k0s())}class oo{constructor(i,t,o,s){this.changeRef=i,this.quizService=t,this.quizPDFService=o,this.snackbar=s,this.questions=[],this.showSummaryEnabled=!1,this.showExplanationEnabled=!1,this.showExplanation=!1,this.loadingPDF=!1,this.ngUnsubscribe=new k.B,this.pdfInputs=new LP.m(1)}ngOnInit(){this.initReviewListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.pdfInputs.complete()}initReviewListeners(){(0,cn.z)([this.userFullName$,this.userEmail$,this.story$,this.questions$,this.submissions$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o,s,a])=>{this.questions=s,this.quizScore=(0,_o.MH)(s,a),this.pdfInputs.next([i,t,o,s,this.quizScore]),this.changeRef.markForCheck()}),this.quizSettings$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({showSummary:i,showExplanation:t})=>{this.showSummaryEnabled=!1!==i,this.showExplanationEnabled=!1!==t,this.changeRef.markForCheck()})}handleToggleSummaryClick(){this.showExplanation=!this.showExplanation}handleResultsClick(){this.loadingPDF=!0,this.pdfInputs.pipe((0,qt.s)(1),(0,Ln.Z)(([i,t,o,s,a])=>this.quizPDFService.downloadResultsPDF(i,t,o.displayName.toUpperCase(),s,a)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.loadingPDF=!1,i||this.snackbar.open("Error opening the results PDF."),this.changeRef.markForCheck()})}handleRestartClick(){this.quizService.resetQuiz(),this.quizService.startQuiz()}handleExitClick(){this.quizService.exitQuiz()}static#e=this.\u0275fac=function(t){return new(t||oo)(e.rXU(e.gRc),e.rXU(ba),e.rXU(UP),e.rXU(ui.UG))};static#t=this.\u0275cmp=e.VBU({type:oo,selectors:[["app-view-quiz-review"]],decls:4,vars:3,consts:()=>{let i,t,o,s,a,r;return i=$localize`:2bba53403aac78f4e44cdb7a38216c93a0a33ab71432800600767014651: You answered ${"\ufffd0\ufffd"}:INTERPOLATION: of ${"\ufffd1\ufffd"}:INTERPOLATION_1: questions correctly. `,t=$localize`:f57ccc4608c3db5d46b9ebd75467a841f5e7599e1835089687895717278:Download Results as PDF`,o=$localize`:1f4dec9e6be75af098a539e0eedf41f86f2c8c386268957596815378507:Hide Summary`,s=$localize`:96b2e76703c8dea4c7c173b97fff2a10f45c59073866918107243977386:Show Summary`,a=$localize`:bf6eb666b88af02c4793aba88435a71da36ba5d25529862952779485373: Take Again `,r=$localize`:19411ab6ff55d914e6f229a14e03ffc1127ffccf4002907482219878023: Exit Quiz `,[i,t,o,s,a,r,["data-test","quizReview",1,"review"],["class","review__container","data-test","quizDownload",4,"ngIf"],["class","flex flex-col gap-2",4,"ngIf"],["class","mt-10 review__loading",4,"ngIf"],["data-test","quizDownload",1,"review__container"],["data-test","quizSummary",1,"text-center"],["strokeWidth","12","diameter","96",3,"progress"],[1,"mt-5","mb-8","text-xs","font-semibold"],[1,"flex","flex-col","gap-2"],["class","w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",3,"click",4,"ngIf"],["class","w-full","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",3,"click",4,"ngIf"],["class","mt-3 review__summary","data-test","quizExplanation",4,"ngIf"],["class","w-full mt-8","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",3,"click",4,"ngIf"],["class","w-full mt-3","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizGetResultsButton",1,"w-full",3,"click"],["icon","download",1,"mr-1"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizToggleSummaryButton",1,"w-full",3,"click"],[4,"ngIf"],["data-test","quizExplanation",1,"mt-3","review__summary"],["class","my-6",4,"ngFor","ngForOf"],[1,"my-6"],[3,"question","questionNumber","answer","summary"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","blue-fill","data-test","quizTakeAgainButton",1,"w-full","mt-8",3,"click"],["app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-fill","data-test","quizExitButton",1,"w-full","mt-3",3,"click"],[1,"mt-10","review__loading"],["size","huge","direction","vertical","label","Loading"]]},template:function(t,o){1&t&&(e.j41(0,"div",6),e.DNE(1,xP,5,3,"div",7)(2,XP,8,9,"div",8)(3,HP,2,0,"div",9),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",o.showSummaryEnabled),e.R7$(),e.Y8G("ngIf",!o.loadingPDF),e.R7$(),e.Y8G("ngIf",o.loadingPDF))},dependencies:[J.Sq,J.bT,Qt.ri,ut.R,Jo.tI,Wm,df,J.Jj],styles:[".review[_ngcontent-%COMP%]{position:relative}.review__summary[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:4px 12px}"],changeDetection:0})}gs([(0,l.l6)(Fe.j.getAllQuestions),ms("design:type",h.c)],oo.prototype,"questions$",void 0),gs([(0,l.l6)(Fe.j.getAllSubmissions),ms("design:type",h.c)],oo.prototype,"submissions$",void 0),gs([(0,l.l6)(Fe.j.getQuizSettings),ms("design:type",h.c)],oo.prototype,"quizSettings$",void 0),gs([(0,l.l6)(Fe.j.getQuizModeLocked),ms("design:type",h.c)],oo.prototype,"quizLocked$",void 0),gs([(0,l.l6)(Fe.j.getEnableQuizRetake),ms("design:type",h.c)],oo.prototype,"enableQuizRetake$",void 0),gs([(0,l.l6)(Pe.getUserFullName),ms("design:type",h.c)],oo.prototype,"userFullName$",void 0),gs([(0,l.l6)(Pe.getUserEmail),ms("design:type",h.c)],oo.prototype,"userEmail$",void 0),gs([(0,l.l6)(dt.getStory),ms("design:type",h.c)],oo.prototype,"story$",void 0);var yo=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},vo=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const QP=(n,i)=>({"view-quiz--column":n,"view-quiz--drawer":i});function YP(n,i){if(1&n&&(e.nrm(0,"app-view-quiz-question",12),e.nI1(1,"async")),2&n){const t=e.XpG(2);e.Y8G("question",e.bMT(1,1,t.question$))}}function KP(n,i){if(1&n&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&n){let t;const o=e.XpG(3);e.R7$(),e.SpI(" ",(null==(t=e.bMT(2,1,o.question$))?null:t.nextLabel)||o.defaultNextButtonNext," ")}}function qP(n,i){1&n&&(e.j41(0,"div",17),e.pXf(1,0),e.k0s())}function JP(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleSubmit())}),e.j41(1,"div",14),e.nI1(2,"async"),e.DNE(3,KP,3,3,"div",15)(4,qP,2,0,"div",16),e.k0s()()}if(2&n){let t;const o=e.XpG(2);e.Y8G("disabled",!o.form.valid),e.R7$(),e.Y8G("ngSwitch",null==(t=e.bMT(2,3,o.question$))?null:t.type),e.R7$(2),e.Y8G("ngSwitchCase",o.quizQuestionType.Instructions)}}function ZP(n,i){if(1&n&&(e.j41(0,"div",8),e.DNE(1,YP,2,3,"app-view-quiz-question",9),e.nI1(2,"async"),e.j41(3,"div",10),e.DNE(4,JP,5,5,"button",11),e.nI1(5,"async"),e.nI1(6,"async"),e.k0s()()),2&n){let t;const o=e.XpG();e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("ngIf",e.bMT(2,3,o.question$)),e.R7$(3),e.Y8G("ngIf",(null==(t=e.bMT(5,5,o.quizSettings$))?null:t.showSubmit)&&e.bMT(6,7,o.lifecycle$)===o.Lifecycle.Question)}}function ew(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.nextQuestion())}),e.j41(1,"div",17),e.EFF(2),e.nI1(3,"async"),e.k0s()()}if(2&n){let t;const o=e.XpG(2);e.R7$(2),e.JRh((null==(t=e.bMT(3,1,o.question$))?null:t.nextLabel)||o.defaultNextButtonNext)}}function tw(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.handleViewSummaryClick())}),e.PLo(1,1),e.nrm(2,"div",17),e.YFu(),e.k0s()}}function nw(n,i){if(1&n&&(e.qex(0),e.DNE(1,tw,3,0,"button",23),e.nI1(2,"async"),e.bVm()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.quizReviewEnabled$))}}function iw(n,i){if(1&n&&(e.qex(0),e.j41(1,"div",18),e.nrm(2,"app-view-quiz-answer",19),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s(),e.qex(5,14),e.nI1(6,"async"),e.j41(7,"div",10),e.DNE(8,ew,4,3,"button",20)(9,nw,3,3,"ng-container",21),e.k0s(),e.bVm()()),2&n){const t=e.XpG();e.R7$(2),e.Y8G("question",e.bMT(3,5,t.question$))("answer",e.bMT(4,7,t.submission$).answer)("summary",!1),e.R7$(3),e.Y8G("ngSwitch",e.bMT(6,9,t.hasQuestionsRemaining$)),e.R7$(3),e.Y8G("ngSwitchCase",!0)}}function ow(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-quiz-review"),e.bVm())}function sw(n,i){if(1&n&&(e.j41(0,"div",25),e.qex(1),e.pXf(2,2),e.nI1(3,"async"),e.bVm(),e.qex(4),e.pXf(5,3),e.bVm(),e.k0s()),2&n){let t;const o=e.XpG();e.R7$(3),e.uP7(null==(t=e.bMT(3,1,o.questions$))?null:t.length),e.nnv(2)}}class Oi{constructor(i,t,o,s,a,r){this.store=i,this.actions=t,this.formBuilder=o,this.viewService=s,this.applicationEventService=a,this.viewQuizService=r,this.defaultNextButtonNext=$localize`Next Question`,this.showHeader=!0,this.mode="column",this.Lifecycle=Qo.h,this.quizQuestionType=Pn.Q5,this.sceneConfigStash={},this.ngUnsubscribe=new k.B}ngOnInit(){if(!this.store.selectSnapshot(Fe.j.getActiveQuestionId)){const i=this.store.selectSnapshot(Fe.j.getAllQuestions).at(0).id;this.store.dispatch(new Xt.B.SetActiveQuestion(i))}this.form=this.formBuilder.group({question:new fe.hs("",this.getQuizValidation())}),this.initQuestionObserver(),this.initAnswerObserver(),this.initEngineInteractionObserver(),this.applicationEventService.fireEvent(rt.F.QuizEntered,!0)}ngOnDestroy(){Object.entries(this.sceneConfigStash).forEach(([i,t])=>{this.store.dispatch(new Nn.qi(i,t.background))}),this.applicationEventService.fireEvent(rt.F.QuizExited,!0),this.viewService.selectTool(dn.s.Select),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}get answer(){const i=this.form.get("question").value;return Array.isArray(i)?i:[i]}initQuestionObserver(){this.question$.pipe((0,p.Q)(this.ngUnsubscribe),(0,D.p)(i=>void 0!==i)).subscribe(i=>{const t=this.store.selectSnapshot(me.N.getSelectedChapterId);i.chapterId!==t&&this.store.dispatch(new Nn.wg(i.chapterId)),this.form.reset(),this.setSceneConfig(i),i.type===Pn.Q5.Instructions&&this.form.get("question").setValue("-"),this.applicationEventService.fireEvent(rt.F.QuizQuestionLoaded,i)})}initAnswerObserver(){this.form.get("question").valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(Fe.j.getActiveQuestion),o=this.store.selectSnapshot(Fe.j.getActiveSubmission);void 0!==t&&(this.store.selectSnapshot(Fe.j.getAllSubmissions).some(s=>s.questionId===t.id)||((!o||!(0,u.isEqual)(o.answer,i))&&this.store.dispatch(new Xt.B.SetActiveSubmission({questionId:t.id,answer:i})),(0,u.isNil)(i)||this.applicationEventService.fireEvent(rt.F.QuizAnswerSelected,{questionId:t.id,answerId:i})))})}initEngineInteractionObserver(){this.viewService.selectTool(dn.s.Quiz),this.actions.pipe((0,l.xi)(st.zE),(0,D.p)(o=>{const{node:s,event:a}=o;return!(0,u.isNil)(s)&&this.store.selectSnapshot(ze.S.getActiveTool)===dn.s.Quiz&&!a.srcEvent.shiftKey})).pipe((0,D.p)(()=>"none"!==this.store.selectSnapshot(Fe.j.getPickMode)),(0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{"single"===this.store.selectSnapshot(Fe.j.getPickMode)&&this.viewService.clearSelectedNodes();const a=(0,u.get)(o,"hit.objectId");if(a){const _=this.store.selectSnapshot(Rn.z.getCheckedNodeIds).includes(a);this.store.dispatch(new Vt.q9(!_,[a]))}}),this.question$.pipe((0,Tn.F)((o,s)=>(0,u.get)(o,"id")===(0,u.get)(s,"id")),(0,D.p)(o=>!(0,u.isNil)(o))).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(o=>this.setQuestionPickMode(o))}setQuestionPickMode(i){const{type:t,data:o}=i;let s;s=t===Pn.Q5.SelectAnatomy?o.correctAnswer.length>1&&"any"!==o.selectType?"multi":"single":"none",this.store.dispatch(new Xt.B.SetQuizPickMode(s))}handleSubmit(){const i=this.store.selectSnapshot(Fe.j.getActiveQuestion);(this.form.valid||i.type===Pn.Q5.Instructions)&&this.viewQuizService.submitQuestion(i.id,this.answer)}handleViewSummaryClick(){this.viewSummary()}handleExitClick(){this.viewQuizService.exitQuiz()}nextQuestion(){this.viewQuizService.nextQuestion()}viewSummary(){this.store.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Review)),this.applicationEventService.fireEvent(rt.F.QuizCompleted,!0)}setSceneConfig(i){const{camera:t,background:o}=i?.sceneConfig||{},s=this.store.selectSnapshot(me.N.getChapter(i.chapterId));t&&(this.setStash(i.chapterId,{camera:s.camera.location}),setTimeout(()=>{this.store.dispatch(new Ut.Ih(t.location,!0,1))})),o&&(this.setStash(i.chapterId,{background:s.background}),this.store.dispatch(new Nn.qi(i.chapterId,o)))}setStash(i,t){this.sceneConfigStash[i]={...this.sceneConfigStash[i]||{},...t}}getQuizValidation(){return i=>{const t=i.value,o=Array.isArray(t)?t:[t],s=this.store.selectSnapshot(Fe.j.getActiveQuestion),a=(0,_o.Ie)(s),r=o.some(_=>(0,u.isNil)(_)||""===_);return a&&r?{invalidValues:r}:null}}static#e=this.\u0275fac=function(t){return new(t||Oi)(e.rXU(l.il),e.rXU(l.En),e.rXU(fe.ze),e.rXU(En),e.rXU(Po.S),e.rXU(ba))};static#t=this.\u0275cmp=e.VBU({type:Oi,selectors:[["app-view-quiz"]],inputs:{showHeader:"showHeader",mode:"mode"},decls:12,vars:22,consts:()=>{let i,t,o,s;return i=$localize`:71c77bb8cecdf11ec3eead24dd1ba506573fa9cd935187492052582731:Submit`,t=$localize`:19c0d80cbbbe6ab7d75dbe7c77ef3017ec5f4d967886851004377486562:${"\ufffd#2\ufffd"}:START_TAG_DIV:See Results${"\ufffd/#2\ufffd"}:CLOSE_TAG_DIV:`,o=$localize`:6649c9f6c298747891fb175dbe382be60e1728c66638623222432926474:{VAR_PLURAL, plural, =1 {Answer} other {Answers}}`,o=e.k04(o,{VAR_PLURAL:"\ufffd0\ufffd"}),s=$localize`:ceb65fed78c2ea1d81ce1514a244608fdc02bfca1766523863374888036:submitted`,[i,t,o,s,["data-test","quiz",1,"view-quiz",3,"ngClass"],["role","form","class","flex flex-col",3,"formGroup",4,"ngIf"],[4,"ngIf"],["class","text-base font-bold text-center",4,"ngIf"],["role","form",1,"flex","flex-col",3,"formGroup"],["formControlName","question",3,"question",4,"ngIf"],[1,"flex","flex-row-reverse"],["app-view-button","","class","view-quiz__button","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",3,"disabled","click",4,"ngIf"],["formControlName","question",3,"question"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionSubmit",1,"view-quiz__button",3,"click","disabled"],[3,"ngSwitch"],["class","px-4",4,"ngSwitchCase"],["class","px-4",4,"ngSwitchDefault"],[1,"px-4"],[1,"mb-8"],[3,"question","answer","summary"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button","data-test","questionNextButton",3,"click",4,"ngSwitchCase"],[4,"ngSwitchDefault"],["app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","data-test","questionNextButton",1,"view-quiz__button",3,"click"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded","class","view-quiz__button",3,"click",4,"ngIf"],["data-test","quizViewSummaryButton","app-view-button","","buttonTheme","blue-fill","buttonSize","small","buttonShape","rounded",1,"view-quiz__button",3,"click"],[1,"text-base","font-bold","text-center"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",4),e.DNE(1,ZP,7,9,"div",5),e.nI1(2,"async"),e.DNE(3,iw,10,11,"ng-container",6),e.nI1(4,"async"),e.DNE(5,ow,2,0,"ng-container",6),e.nI1(6,"async"),e.nI1(7,"async"),e.DNE(8,sw,6,3,"div",7),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s()),2&t){let s;e.Y8G("ngClass",e.l_i(19,QP,"column"===o.mode,"drawer"===o.mode)),e.R7$(),e.Y8G("ngIf",e.bMT(2,5,o.lifecycle$)===o.Lifecycle.Question),e.R7$(2),e.Y8G("ngIf",e.bMT(4,7,o.lifecycle$)===o.Lifecycle.Explanation),e.R7$(2),e.Y8G("ngIf",e.bMT(6,9,o.lifecycle$)===o.Lifecycle.Review&&e.bMT(7,11,o.quizReviewEnabled$)),e.R7$(3),e.Y8G("ngIf",!(e.bMT(9,13,o.hasQuestionsRemaining$)||e.bMT(10,15,o.quizReviewEnabled$)||null!=(s=e.bMT(11,17,o.quizSettings$))&&s.showExplanation))}},dependencies:[J.YU,J.bT,J.ux,J.e1,J.fG,Qt.ri,fe.BC,fe.cb,fe.j4,fe.JD,Qs,df,oo,J.Jj],styles:[".view-quiz[_ngcontent-%COMP%]{color:#384c6c}.view-quiz__button[_ngcontent-%COMP%]:disabled{opacity:.5}.view-quiz--column[_ngcontent-%COMP%]   .view-quiz__button[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}yo([(0,l.l6)(Fe.j.getQuizReviewEnabled),vo("design:type",h.c)],Oi.prototype,"quizReviewEnabled$",void 0),yo([(0,l.l6)(Fe.j.getActiveQuestion),vo("design:type",h.c)],Oi.prototype,"question$",void 0),yo([(0,l.l6)(Fe.j.getAllQuestions),vo("design:type",h.c)],Oi.prototype,"questions$",void 0),yo([(0,l.l6)(Fe.j.getActiveQuestionIndex),vo("design:type",h.c)],Oi.prototype,"questionIndex$",void 0),yo([(0,l.l6)(Fe.j.getQuestionTotal),vo("design:type",h.c)],Oi.prototype,"questionTotal$",void 0),yo([(0,l.l6)(Fe.j.getCorrectAnswerTotal),vo("design:type",h.c)],Oi.prototype,"correctAnswerTotal$",void 0),yo([(0,l.l6)(Fe.j.hasQuestionRemaining),vo("design:type",h.c)],Oi.prototype,"hasQuestionsRemaining$",void 0),yo([(0,l.l6)(Fe.j.getQuizSettings),vo("design:type",h.c)],Oi.prototype,"quizSettings$",void 0),yo([(0,l.l6)(Fe.j.getLifecycle),vo("design:type",h.c)],Oi.prototype,"lifecycle$",void 0),yo([(0,l.l6)(Fe.j.getQuizModeLocked),vo("design:type",h.c)],Oi.prototype,"quizLocked$",void 0),yo([(0,l.l6)(Fe.j.getActiveSubmission),vo("design:type",h.c)],Oi.prototype,"submission$",void 0);const aw=["container"],rw=n=>({"rotate-90":n});function lw(n,i){if(1&n&&(e.j41(0,"span"),e.pXf(1,1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.uP7(t.updateDateText()),e.nnv(1)}}function cw(n,i){1&n&&(e.j41(0,"span"),e.pXf(1,2),e.k0s())}function dw(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",null,0)(2,"button",3),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.toggleDetails())}),e.j41(3,"div",4)(4,"span",5),e.DNE(5,lw,2,1,"span")(6,cw,2,0,"span"),e.k0s(),e.nrm(7,"app-icon",6),e.k0s()()()}if(2&n){let t;const o=e.XpG();e.R7$(5),e.vxM(null!=(t=o.sourceInfo().reviewed)&&t.enabled&&null!=(t=o.sourceInfo().audit)&&t.enabled&&o.updateDate()?5:6),e.R7$(2),e.Y8G("ngClass",e.eq3(2,rw,o.open()))}}let _f=(()=>{class n{ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}constructor(t,o){this.store=t,this.popupService=o,this.ngUnsubscribe=new k.B,this.open=(0,e.vPA)(!1),this.sourceInfo=(0,je.ot)(this.store.select(dt.getStorySourceInfo)),this.selectedBookmark=(0,je.ot)(this.store.select(ft.getSelectedBookmark)),this.updateDate=(0,e.EWP)(()=>this.selectedBookmark()?.update_date_time??this.selectedBookmark()?.create_date_time),this.updateDateTime=(0,e.EWP)(()=>{const s=this.updateDate();return s?new Date(s).toISOString():void 0}),this.updateDateText=(0,e.EWP)(()=>{const s=this.updateDate();return s?new Date(s).toLocaleDateString():void 0})}toggleDetails(){const t=this.popupService.open({origin:this.container.nativeElement,positions:[No.Below],width:"272px",maxHeight:"484px",content:_c});this.open.set(!0),t.afterClosed$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.open.set(!1)})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(nf))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-source-info-toggle"]],viewQuery:function(o,s){if(1&o&&e.GBs(aw,5),2&o){let a;e.mGM(a=e.lsd())&&(s.container=a.first)}},standalone:!0,features:[e.aNF],decls:1,vars:1,consts:()=>{let t,o;return t=$localize`:ec2c1d22b6e2207023be0f04e37c533e4e5cc7ec7104746773075604544:Medically reviewed on ${"\ufffd0\ufffd"}:INTERPOLATION:`,o=$localize`:5bbf2bcdb5d3aa2b328ab66786845485b997e0e75233133710285034701:Source Information`,[["container",""],t,o,["app-view-button","","buttonSize","2xsmall","data-test","viewSourceInfoToggle",1,"w-full","overflow-hidden","rounded",3,"click"],[1,"flex","items-center"],[1,"text-xs"],["icon","angle-right",1,"ml-1","transition-transform",3,"ngClass"]]},template:function(o,s){1&o&&e.DNE(0,dw,8,4,"div"),2&o&&e.vxM(s.sourceInfo()?0:-1)},dependencies:[J.MD,J.YU,bn.C,Qt.ri,sn.o,ut.R],changeDetection:0})}return n})();const _w=(n,i)=>({"view-title--center":n,"view-title--ellipsis":i}),pw=(n,i)=>({"text-md":n,"text-lg":i});function uw(n,i){if(1&n&&(e.nrm(0,"h2",1),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.titles().metaTitle)),e.npT)}}function hw(n,i){if(1&n&&(e.nrm(0,"h2",3),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.titles().subTitle)),e.npT)}}let mc=(()=>{class n{get style(){const t=this.useEllipsis()?"overflow: hidden; display: flex; width: 100%;":"";return this.sanitizer.bypassSecurityTrustStyle(t)}constructor(t,o){this.sanitizer=t,this.store=o,this.story=(0,je.ot)(this.store.select(dt.getStory)),this.chapter=(0,je.ot)(this.store.select(me.N.getSelectedChapter)),this.pagination=(0,je.ot)(this.store.select(me.N.getChapterPagination)),this.activeQuestionIndex=(0,je.ot)(this.store.select(Fe.j.getActiveQuestionIndex)),this.quizSettings=(0,je.ot)(this.store.select(Fe.j.getQuizSettings)),this.quizLifecycle=(0,je.ot)(this.store.select(Fe.j.getLifecycle)),this.quizQuestionTotal=(0,je.ot)(this.store.select(Fe.j.getQuestionTotal)),this.mainTitle=(0,e.hFB)(""),this.metaTitle=(0,e.hFB)(""),this.subTitle=(0,e.hFB)(""),this.showMetaTitle=(0,e.hFB)(!0),this.showSubTitle=(0,e.hFB)(!0),this.useEllipsis=(0,e.hFB)(!1),this.includePagination=(0,e.hFB)(!1),this.dynamicTitle=(0,e.hFB)("none"),this.size=(0,e.hFB)("md"),this.align=(0,e.hFB)("left"),this.titles=(0,e.EWP)(()=>{const s=this.dynamicTitle(),a=this.inputTitles(),r=this.chapterTitles(),_=this.quizTitles();switch(s){case"chapter":return r;case"quiz":return _;default:return a}}),this.inputTitles=(0,e.EWP)(()=>({mainTitle:this.mainTitle(),metaTitle:this.metaTitle(),subTitle:this.subTitle()})),this.chapterTitles=(0,e.EWP)(()=>{const s=this.story(),a=this.chapter(),r=this.pagination(),_=this.includePagination(),g=ho.l.normalize(s?.displayName??""),P=a?.displayName?ho.l.normalize(a.displayName):$localize`Chapter`+` ${r.index+1}`;return{mainTitle:P,metaTitle:z.c.application===xn.c.Studio&&g!==P?g:"",subTitle:_?r?.label:""}}),this.quizTitles=(0,e.EWP)(()=>{const s=this.quizSettings(),a=this.quizLifecycle(),r=this.activeQuestionIndex(),_=this.quizQuestionTotal();return s.showProgress&&a!==Qo.h.Review?{mainTitle:`${$localize`Question ${r+1}`}<span class="font-normal">${$localize` of ${_}`}</span>`}:{mainTitle:$localize`Quiz`}})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(c.up),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-title"]],hostVars:2,hostBindings:function(o,s){2&o&&e.Aen(s.style)},inputs:{mainTitle:[1,"mainTitle"],metaTitle:[1,"metaTitle"],subTitle:[1,"subTitle"],showMetaTitle:[1,"showMetaTitle"],showSubTitle:[1,"showSubTitle"],useEllipsis:[1,"useEllipsis"],includePagination:[1,"includePagination"],dynamicTitle:[1,"dynamicTitle"],size:[1,"size"],align:[1,"align"]},standalone:!0,features:[e.aNF],decls:6,vars:15,consts:[[1,"view-title",3,"ngClass"],["id","view-title-meta",1,"view-title__meta",3,"innerHTML"],["id","view-title","tabindex","0",1,"view-title__main",3,"ngClass","innerHTML"],["id","view-title-sub",1,"view-title__sub",3,"innerHTML"]],template:function(o,s){if(1&o&&(e.j41(0,"section",0),e.DNE(1,uw,3,5,"h2",1),e.nrm(2,"h1",2),e.nI1(3,"markdown"),e.nI1(4,"async"),e.DNE(5,hw,3,5,"h2",3),e.k0s()),2&o){let a;e.Y8G("ngClass",e.l_i(9,_w,"center"===s.align(),s.useEllipsis())),e.R7$(),e.vxM((null==(a=s.titles().metaTitle)?null:a.length)>0&&s.showMetaTitle()?1:-1),e.R7$(),e.Y8G("ngClass",e.l_i(12,pw,"md"===s.size(),"lg"===s.size()))("innerHTML",e.bMT(4,7,e.bMT(3,5,s.titles().mainTitle)),e.npT),e.R7$(3),e.vxM(s.showSubTitle()?5:-1)}},dependencies:[J.MD,J.YU,J.Jj,Wn.y2,Wn.i0],styles:["[_nghost-%COMP%]{display:flex}.view-title[_ngcontent-%COMP%]{overflow-wrap:break-word;color:#0c1726;border-radius:4px;transition:background-color 125ms;flex:1 1 0;display:flex;flex-direction:column;align-items:flex-start}.view-title--ellipsis[_ngcontent-%COMP%]{width:0}.view-title--ellipsis[_ngcontent-%COMP%]   .view-title__meta[_ngcontent-%COMP%], .view-title--ellipsis[_ngcontent-%COMP%]   .view-title__main[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.view-title--center[_ngcontent-%COMP%]{justify-content:center}.view-title__meta[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;font-weight:400;color:#384c6c;overflow-wrap:anywhere;margin-bottom:4px}.view-title__main[_ngcontent-%COMP%]{color:#0c1726;text-align:start;font-weight:600;overflow-wrap:anywhere}.view-title__sub[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;text-align:start;margin-top:4px;color:#384c6c;font-weight:400}.view-title[_ngcontent-%COMP%]:hover   .view-title__count[_ngcontent-%COMP%]{display:none}.view-title[_ngcontent-%COMP%]:hover   .view-title__show[_ngcontent-%COMP%]{display:block}.view-title__show[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return n})(),pf=(()=>{class n{constructor(t){this.el=t,this.appScrollListener=(0,e.geq)()}ngOnInit(){this.el.nativeElement.addEventListener("scroll",()=>{this.emitScroll()})}ngOnDestroy(){this.el.nativeElement.removeEventListener("scroll",this.emitScroll)}emitScroll(){this.appScrollListener.set(this.el.nativeElement.scrollTop)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.aKT))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appScrollListener",""]],inputs:{appScrollListener:[1,"appScrollListener"]},outputs:{appScrollListener:"appScrollListenerChange"}})}return n})();class Na{constructor(i){this.store=i,this.injector=(0,e.WQX)(e.zZn),this.defaultImage=(0,e.hFB)("/assets/images/view-chapter-thumbnail-placeholder.png"),this.chapterId=e.hFB.required(),this.chapterThumb=(0,e.EWP)(()=>{const t=this.thumbnails().get(this.chapterId());return t?t.snapshot||t.urls.small:""}),this.thumbnails=(0,je.ot)(this.store.select(Go.K.getRegisteredThumbnails))}static#e=this.\u0275fac=function(t){return new(t||Na)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:Na,selectors:[["app-chapter-image"]],inputs:{defaultImage:[1,"defaultImage"],chapterId:[1,"chapterId"]},standalone:!0,features:[e.aNF],decls:1,vars:2,consts:[[1,"w-full","h-full","bg-cover",3,"defaultImage","lazyLoad"]],template:function(t,o){1&t&&e.nrm(0,"div",0),2&t&&e.Y8G("defaultImage",o.defaultImage())("lazyLoad",o.chapterThumb())},dependencies:[So.Un,So.Je],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Go.K.getRegisteredThumbnails),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Na.prototype,"thumbnails$",void 0);const bw=n=>({"!border-gray-200":n}),yw=n=>({"!outline-blue-600":n}),vw=(n,i)=>({"!bg-gray-200":n,"!bg-blue-600 !text-white !outline-blue-600":i}),Ew=n=>({"!opacity-100":n});function Cw(n,i){1&n&&e.nrm(0,"div",12)}function Tw(n,i){1&n&&e.nrm(0,"div",13)}function Ow(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",6)(1,"button",7),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleChapterClick(s))}),e.j41(2,"span",8),e.EFF(3),e.k0s(),e.j41(4,"div",9)(5,"div",10),e.EFF(6),e.k0s(),e.nrm(7,"app-chapter-image",11),e.k0s(),e.DNE(8,Cw,1,0,"div",12)(9,Tw,1,0,"div",13),e.k0s()()}if(2&n){const t=i.$implicit,o=i.$index,s=i.$index,a=i.$count,r=e.XpG();e.R7$(),e.Y8G("matTooltip",r.getTooltip(o,t)),e.BMQ("aria-current",r.selectedChapterIndex()===o)("data-id",t.id),e.R7$(2),e.JRh(t.displayName),e.R7$(),e.Y8G("ngClass",e.eq3(11,yw,o===r.selectedChapterIndex())),e.R7$(),e.Y8G("ngClass",e.l_i(13,vw,o<r.selectedChapterIndex(),r.selectedChapterIndex()===o)),e.R7$(),e.SpI(" ",o+1," "),e.R7$(),e.Y8G("chapterId",t.id)("ngClass",e.eq3(16,Ew,o<=r.selectedChapterIndex())),e.R7$(),e.vxM(0!==s?8:-1),e.R7$(),e.vxM(s!==a-1?9:-1)}}class kr{constructor(i,t){this.viewService=i,this.store=t,this.chapters=(0,je.ot)(this.store.select(me.N.getStoryChapters)),this.selectedChapterIndex=(0,je.ot)(this.store.select(me.N.getSelectedChapterIndex)),this.scrollTop=0,(0,e.QZP)(()=>{this.scrollChapterIntoView(this.selectedChapterIndex())})}getTooltip(i,t){return $localize`${i+1} of ${this.chapters().length}\: ${t.displayName}`}handleChapterClick(i){this.viewService.selectChapter(i)}handleNextChapter(){this.viewService.nextChapter("Pagination")}handlePreviousChapter(){this.viewService.previousChapter("Pagination")}scrollChapterIntoView(i){const t=document.querySelector(`[data-test="viewChapterThumbnail"]:nth-child(${i+1})`);null!=t&&setTimeout(()=>{t.scrollIntoView({block:"nearest"})})}static#e=this.\u0275fac=function(t){return new(t||kr)(e.rXU(En),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:kr,selectors:[["app-view-chapter-list"]],decls:8,vars:5,consts:()=>{let i,t;return i=$localize`:d34ec3fa65cd79fae0796d2e789e6217f0cc0a485014509299839865224:Chapter list`,t=$localize`:2be2e0ec21a9620412d9a21102e7645fce9d9cc15659091765954160016:List of Chapters`,[["data-test","viewChapterList",1,"flex","flex-col","h-full"],[1,"flex","items-center","justify-center","flex-grow-0","py-5","transition-colors","border-b","border-transparent","border-solid","bg-gray-50",3,"ngClass"],[1,"shadow"],["buttonSize","2xsmall",3,"showCount"],["aria-label",i,1,"flex-grow","overflow-x-hidden","overflow-y-auto","scroll-smooth"],["aria-label",t,3,"appScrollListenerChange","appScrollListener"],["data-test","viewChapterThumbnail"],["matTooltipPosition","right","data-test","viewChapterListButton",1,"relative","flex","flex-col","items-center","justify-center","w-full","py-2","cursor-pointer","group","min-h-20","focus:outline-none",3,"click","matTooltip"],[1,"sr-only"],[1,"absolute","z-10","transition-all","bg-white","border-2","border-white","border-solid","rounded","w-14","h-14","outline","outline-2","outline-gray-200","group-hover:outline-gray-400","group-focus:outline-blue-600",3,"ngClass"],[1,"absolute","top-0","left-0","z-20","flex","items-center","justify-center","w-6","h-6","font-semibold","text-gray-600","transition-all","-translate-x-[15px]","-translate-y-[15px]","bg-white","border","border-2","border-white","border-solid","rounded","rounded-full","outline","outline-2","-outline-offset-4","outline-gray-200","group-hover:outline-gray-400","group-focus:outline-blue-600","text-2xs",3,"ngClass"],[1,"overflow-hidden","transition-opacity","rounded","opacity-50","group-hover:opacity-100","group-focus:opacity-100",3,"chapterId","ngClass"],[1,"w-[2px]","h-1/2","bg-gray-200","absolute","z-0","top-0"],[1,"w-[2px]","h-1/2","bg-gray-200","absolute","z-0","bottom-0"]]},template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"app-pillbox",2),e.nrm(3,"app-view-pagination",3),e.k0s()(),e.j41(4,"nav",4)(5,"ol",5),e.mxI("appScrollListenerChange",function(a){return e.DH7(o.scrollTop,a)||(o.scrollTop=a),a}),e.Z7z(6,Ow,10,18,"li",6,e.Vm6),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngClass",e.eq3(3,bw,o.scrollTop>0)),e.R7$(2),e.Y8G("showCount",!1),e.R7$(2),e.R50("appScrollListener",o.scrollTop),e.R7$(),e.Dyx(o.chapters()))},dependencies:[J.YU,pf,Kt.oV,no,Na,bo],changeDetection:0})}function Mw(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"button",5),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handlePlayFromBeginning())}),e.nrm(2,"app-icon",6),e.j41(3,"span",7),e.pXf(4,1),e.k0s()(),e.nrm(5,"app-view-audio-mute",8),e.bVm()}}function Iw(n,i){1&n&&(e.j41(0,"button",9)(1,"div",10),e.nrm(2,"app-spinner",11),e.j41(3,"span",7),e.pXf(4,2),e.k0s()()()),2&n&&e.Y8G("disabled",!0)}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(me.N.getSelectedChapterId),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],kr.prototype,"selectedChapterId$",void 0);let Pw=(()=>{class n{constructor(t,o,s,a){this.viewService=t,this.mediaService=o,this.store=s,this.changeDetectorRef=a,this.hasAudioPlayer=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.initChapterPlayer()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterPlayer(){this.store.select(me.N.getSelectedChapter).pipe((0,is.M)(()=>{this.hasAudioPlayer=!1,this.changeDetectorRef.markForCheck()}),(0,lo.n)(t=>{const o=this.store.selectSnapshot(de.getViewLanguage),s=this.store.selectSnapshot(de.getForceAudio);return this.mediaService.getChapterAudioPlayer(t,o,s)}),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.hasAudioPlayer=!(0,u.isNil)(t),this.changeDetectorRef.markForCheck()})}handlePlayFromBeginning(){const t=this.store.selectSnapshot(me.N.getSelectedChapterId);this.mediaService.playChapterAudio(t),this.viewService.playChapterFromStart()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En),e.rXU(vi),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-audio-bar"]],decls:4,vars:2,consts:()=>{let t,o,s;return t=$localize`:5006279573e513c000899122cbef8e588b25faae2965090484617938475:play from beginning`,o=$localize`:81e8d1fd604d4f4e83ad3300e500ae3b35aa4be71494613406887362546:Play From Beginning`,s=$localize`:65026328a38cc4b6451777987b5dee29a779a10f3235113974618934655:Loading Audio`,[["loading",""],o,s,[1,"view-audio-bar"],[4,"ngIf","ngIfElse"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline","aria-label",t,"data-test","viewPlayFromBeginning",1,"view-audio-bar__play",3,"click"],["icon","rotate-left","aria-hidden","true"],[1,"ml-2","uppercase","text-2xs"],["buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline"],["type","button","app-view-button","","buttonSize","small","buttonShape","rounded","buttonTheme","light-gray-outline",1,"view-audio-bar__play",3,"disabled"],[1,"flex","justify-center","items-center"],["spinnerSize","small"]]},template:function(o,s){if(1&o&&(e.j41(0,"div",3),e.DNE(1,Mw,6,0,"ng-container",4)(2,Iw,5,1,"ng-template",null,0,e.C5r),e.k0s()),2&o){const a=e.sdS(3);e.R7$(),e.Y8G("ngIf",s.hasAudioPlayer)("ngIfElse",a)}},dependencies:[J.bT,Qt.ri,ut.R,Jo.tI,Aa],styles:[".view-audio-bar[_ngcontent-%COMP%]{display:flex;gap:12px}.view-audio-bar__play[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0})}return n})();var uf=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},hf=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const ww=n=>({"view-labels__item--selected":n}),Aw=n=>({"view-labels__content--shown":n});function Rw(n,i){if(1&n&&(e.j41(0,"div",11),e.nrm(1,"div",12),e.nI1(2,"markdown"),e.nI1(3,"async"),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("innerHTML",e.bMT(3,3,e.bMT(2,1,t.title)),e.npT)}}function Nw(n,i){if(1&n&&(e.j41(0,"div",13)(1,"div",14),e.nrm(2,"app-icon",15),e.nI1(3,"async"),e.k0s()()),2&n){let t;const o=e.XpG().$implicit,s=e.XpG();e.R7$(2),e.Y8G("ngClass",(null==(t=e.bMT(3,1,s.selectedLabel$))?null:t.id)===o.id?"rotate-90":"rotate-0")}}function kw(n,i){if(1&n&&(e.j41(0,"div",19),e.nrm(1,"app-content-blocks",20),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("contentBlocks",t.contentBlocks)}}function Dw(n,i){if(1&n&&(e.j41(0,"div",16),e.nI1(1,"async"),e.nI1(2,"async"),e.nrm(3,"app-html",17),e.DNE(4,kw,2,1,"div",18),e.k0s()),2&n){let t,o;const s=e.XpG(),a=s.$implicit,r=s.index,_=e.XpG();e.Y8G("ngClass",e.eq3(9,Aw,(null==(t=e.bMT(1,5,_.selectedLabel$))?null:t.id)===a.id)),e.BMQ("aria-hidden",(null==(o=e.bMT(2,7,_.selectedLabel$))?null:o.id)!==a.id)("id","content-"+r),e.R7$(3),e.Y8G("markdownText",a.description),e.R7$(),e.Y8G("ngIf",(null==a.contentBlocks?null:a.contentBlocks.length)>0)}}function Lw(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",3)(1,"button",4),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleLabelClick(s))}),e.j41(5,"span",5),e.pXf(6,0),e.k0s(),e.j41(7,"div",6),e.nrm(8,"app-label-pin",7),e.nI1(9,"async"),e.k0s(),e.DNE(10,Rw,4,5,"div",8)(11,Nw,4,3,"div",9),e.k0s(),e.DNE(12,Dw,5,11,"div",10),e.k0s()}if(2&n){let t,o,s,a;const r=i.$implicit,_=i.index,g=e.XpG();e.R7$(),e.Y8G("ngClass",e.eq3(23,ww,(null==(t=e.bMT(2,15,g.selectedLabel$))?null:t.id)===r.id)),e.BMQ("aria-current",(null==(o=e.bMT(3,17,g.selectedLabel$))?null:o.id)===r.id)("aria-controls","label-list-content-"+_)("aria-expanded",(null==(s=e.bMT(4,19,g.selectedLabel$))?null:s.id)===r.id)("id","label-list-item-"+_),e.R7$(7),e.Y8G("showOnNone",!0)("selected",(null==(a=e.bMT(9,21,g.selectedLabel$))?null:a.id)===r.id)("pinType",r.pinType)("labelTheme",r.theme)("sequence",g.getLabelSequence(r))("foregroundColor",null==r.themeStyles?null:r.themeStyles.pinForegroundColor)("backgroundColor",null==r.themeStyles?null:r.themeStyles.pinBackgroundColor),e.R7$(2),e.Y8G("ngIf",r.title),e.R7$(),e.Y8G("ngIf",r.description||(null==r.contentBlocks?null:r.contentBlocks.length)>0),e.R7$(),e.Y8G("ngIf",r.description||(null==r.contentBlocks?null:r.contentBlocks.length)>0)}}class ka{constructor(i,t){this.viewService=i,this.store=t,this.labelPinType=ci.O,this.labelSequentialtype=ia.C}ngOnInit(){}getLabelSequence(i){return this.store.selectSnapshot(et.getLabelSequence(i))}handleLabelClick(i){const t=this.store.selectSnapshot(et.getSelectedLabel);i.id===t?.id?this.viewService.clearSelectedLabel():this.viewService.selectLabel(i,!0)}static#e=this.\u0275fac=function(t){return new(t||ka)(e.rXU(En),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:ka,selectors:[["app-view-labels"]],decls:3,vars:3,consts:()=>{let i;return i=$localize`:e788aaf840ca6aea39b81480b735057823a73b532641792472434523020:Navigate to description for, `,[i,["data-test","viewLabelList",1,"view-labels"],["data-test","viewLabelListItem","class","view-labels__list-item",4,"ngFor","ngForOf"],["data-test","viewLabelListItem",1,"view-labels__list-item"],["data-test","viewLabelListButton",1,"view-labels__item",3,"click","ngClass"],[1,"sr-only"],[1,"view-labels__pin"],[1,"flex",3,"showOnNone","selected","pinType","labelTheme","sequence","foregroundColor","backgroundColor"],["class","view-labels__body",4,"ngIf"],["class","view-labels__expand","data-test","viewLabelsToggle",4,"ngIf"],["class","view-labels__content","data-test","viewLabelListContent",3,"ngClass",4,"ngIf"],[1,"view-labels__body"],[1,"view-labels__title","html",3,"innerHTML"],["data-test","viewLabelsToggle",1,"view-labels__expand"],["aria-hidden","true",1,"px-3"],["icon","angle-right",1,"transition-transform",3,"ngClass"],["data-test","viewLabelListContent",1,"view-labels__content",3,"ngClass"],["data-test","viewLabelListHtml",3,"markdownText"],["data-test","viewLabelListBlocks",4,"ngIf"],["data-test","viewLabelListBlocks"],[3,"contentBlocks"]]},template:function(t,o){1&t&&(e.j41(0,"ul",1),e.DNE(1,Lw,13,25,"li",2),e.nI1(2,"async"),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,o.labels$)))},dependencies:[J.YU,J.Sq,J.bT,Vs,ut.R,Ko.V,wp,Wn.i0,J.Jj],styles:[".view-labels__list-item{padding-bottom:8px}.view-labels__item{background:none;border:0;display:flex;padding:12px 0 12px 16px;cursor:pointer;transition:background-color 125ms,color 125ms,border 125ms;width:100%;gap:12px;text-align:left;align-items:center}.view-labels__item:focus{outline:#2472e9 solid 2px!important}.view-labels__item:hover,.view-labels__item--selected:hover{background-color:#0c17260d}.view-labels__item--selected .view-labels__title{font-weight:600}.view-labels__pin{display:flex;align-items:center;justify-content:center;flex:0 0 18px;height:18px}.view-labels__body{flex:1 1 auto}.view-labels__expand{flex-grow:0;display:flex;justify-content:center;align-items:center;position:relative;font-size:14px}.view-labels__title{color:#0c1726;font-size:.875rem;line-height:1.25rem}.view-labels__label{position:absolute;font-size:10px;top:3px}.view-labels__content{display:none;padding:8px 0 12px 46px;font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word;color:#384c6c}.view-labels__content--shown{display:block}\n"],encapsulation:2,changeDetection:0})}function Uw(n,i){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.description)}}function xw(n,i){if(1&n&&(e.j41(0,"li",2),e.nrm(1,"div",3),e.j41(2,"div",4)(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,Uw,2,1,"div",5),e.k0s()()),2&n){const t=i.$implicit,o=e.XpG();e.R7$(),e.xc7("background-color",o.getComputedColor(t.colors)),e.R7$(3),e.JRh(t.label),e.R7$(),e.Y8G("ngIf",t.description)}}uf([(0,l.l6)(et.getChapterLabels),hf("design:type",h.c)],ka.prototype,"labels$",void 0),uf([(0,l.l6)(et.getSelectedLabel),hf("design:type",h.c)],ka.prototype,"selectedLabel$",void 0);let jw=(()=>{class n{constructor(){}ngOnInit(){}getComputedColor(t){return Or.T.rgbToHex(t,!0)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-legend"]],inputs:{legend:"legend"},decls:2,vars:1,consts:()=>{let t;return t=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,[["aria-label",t,1,"view-legend"],["class","view-legend__item",4,"ngFor","ngForOf"],[1,"view-legend__item"],[1,"view-legend__color"],[1,"text-sm","view-legend__content"],["class","my-2",4,"ngIf"],[1,"my-2"]]},template:function(o,s){1&o&&(e.j41(0,"ul",0),e.DNE(1,xw,6,4,"li",1),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",s.legend))},dependencies:[J.Sq,J.bT],styles:['.view-legend{display:flex;flex-direction:column}.view-legend__item{padding:12px 12px 12px 16px;display:flex;gap:12px;flex-direction:row;justify-content:flex-start;align-items:flex-start}.view-legend__content{word-break:break-word;display:flex;flex-direction:column}.view-legend__color{border:2px solid white;outline:1px solid #8999b3;content:" ";display:block;flex:0 0 18px;width:18px;height:18px;border-radius:50%}.view-legend__color:after{content:" "}\n'],encapsulation:2,changeDetection:0})}return n})();const Vw=["*"];function Fw(n,i){if(1&n){const t=e.RV6();e.j41(0,"h2",0)(1,"button",2),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.togglePanel())}),e.j41(2,"div",3)(3,"span",4),e.EFF(4),e.k0s(),e.j41(5,"div",5),e.nrm(6,"app-icon",6),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(),e.BMQ("aria-expanded",t.open())("aria-controls",t.panelId()),e.R7$(3),e.JRh(t.label()),e.R7$(2),e.Y8G("ngClass",t.open()?"rotate-90":"rotate-0")}}let Gw=(()=>{class n{constructor(t){this.store=t,this.panelId=e.hFB.required(),this.label=(0,e.hFB)(""),this.showHeader=(0,e.hFB)(!0),this.canToggle=(0,e.hFB)(!0),this.open=(0,e.geq)(!1)}togglePanel(){const t=!this.open();this.open.set(t),this.store.dispatch(new E.TogglePanel(this.panelId(),t))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-panel"]],inputs:{panelId:[1,"panelId"],label:[1,"label"],showHeader:[1,"showHeader"],canToggle:[1,"canToggle"],open:[1,"open"]},outputs:{open:"openChange"},ngContentSelectors:Vw,decls:3,vars:3,consts:[[1,"-ml-1","text-sm","font-semibold"],[1,"transition-all",3,"id","ngClass"],["app-view-button","","buttonShape","rounded",1,"flex-grow","w-full","rounded","min-h-11",3,"click"],[1,"flex","justify-between","text-gray-900"],[1,"pl-1"],["aria-hidden","true",1,"px-3"],["icon","angle-right",1,"transition-transform",3,"ngClass"]],template:function(o,s){1&o&&(e.NAR(),e.DNE(0,Fw,7,4,"h2",0),e.j41(1,"div",1),e.SdG(2),e.k0s()),2&o&&(e.vxM(s.showHeader()?0:-1),e.R7$(),e.Y8G("id",s.panelId())("ngClass",s.open()?"pb-6":"h-0 overflow-hidden"))},dependencies:[Qt.ri,J.YU,ut.R],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return n})();var Hp=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Qp=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function $w(n,i){1&n&&e.nrm(0,"app-view-source-info",1),2&n&&e.Y8G("toggleable",!0)}function Bw(n,i){1&n&&e.nrm(0,"app-view-audio-bar",6)}function zw(n,i){if(1&n&&(e.j41(0,"div"),e.nrm(1,"app-content-blocks",10),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",t.tickerBlocks())("include",t.contentBlockTypes.Ticker)}}function Ww(n,i){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-content-blocks",10),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",t.mediaBlocks())("include",t.mediaBlockTypes)}}function Xw(n,i){if(1&n&&(e.j41(0,"app-view-panel",2),e.DNE(1,Bw,1,0,"app-view-audio-bar",6)(2,zw,2,2,"div"),e.j41(3,"section",7),e.nrm(4,"app-html",8),e.k0s(),e.DNE(5,Ww,2,2,"div",9),e.k0s()),2&n){const t=e.XpG();e.Y8G("showHeader",!1)("canToggle",!1)("open",!0),e.R7$(),e.vxM(t.audioVisible()?1:-1),e.R7$(),e.vxM(t.tickerBlocks().length>0?2:-1),e.R7$(2),e.Y8G("markdownText",t.chapterDescription()),e.R7$(),e.vxM(t.mediaBlocks().length>0?5:-1)}}function Hw(n,i){if(1&n&&(e.j41(0,"app-view-panel",3),e.nrm(1,"app-view-legend",11),e.k0s()),2&n){const t=e.XpG();e.Y8G("open",t.legendOpen()),e.R7$(),e.Y8G("legend",t.chapter().legend)}}function Qw(n,i){if(1&n&&(e.j41(0,"app-view-panel",4),e.nrm(1,"app-view-labels"),e.k0s()),2&n){const t=e.XpG();e.Y8G("open",t.labelsOpen())}}function Yw(n,i){if(1&n&&(e.j41(0,"app-view-panel",5),e.nrm(1,"app-content-blocks",12),e.k0s()),2&n){const t=e.XpG();e.Y8G("open",t.positionsOpen()),e.R7$(),e.Y8G("contentBlocks",t.positionBlocks())}}class fs{constructor(i,t,o){this.store=i,this.contentBlocksService=t,this.positionsService=o,this.contentTypes=Se.c,this.chapter=(0,je.ot)(this.store.select(me.N.getSelectedChapter)),this.chapterDescription=(0,e.EWP)(()=>{const s=this.chapter();return(0,u.trim)(s?.description??"")}),this.descriptionVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Description))),this.audioVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Audio))),this.contentBlocks=(0,je.ot)(this.store.select(me.N.getSelectedChapterContentBlocks)),this.mediaBlockTypes=[hi.m.Markdown,hi.m.Images,hi.m.AnimatedImages,hi.m.Videos],this.tickerBlocks=(0,e.EWP)(()=>{const s=this.contentBlocks()||[];return this.contentBlocksService.filterContentBlocksByType(s,[hi.m.Ticker])}),this.mediaBlocks=(0,e.EWP)(()=>{const s=this.contentBlocks()||[];return this.contentBlocksService.filterContentBlocksByType(s,this.mediaBlockTypes)}),this.positionBlocks=(0,e.EWP)(()=>{const s=this.contentBlocks()||[];let a=this.contentBlocksService.filterContentBlocksByType(s,[hi.m.Positions]);return a.length>0&&(a=this.insertStartingPosition(a)),a}),this.descriptionPanelVisible=(0,e.EWP)(()=>{const s=this.descriptionVisible(),a=this.audioVisible(),r=this.tickerBlocks(),_=this.chapterDescription(),g=this.mediaBlocks();return s&&(a||r.length>0||""!==_||g.length>0)}),this.toggledPanels=(0,je.ot)(this.store.select(de.getToggledPanels)),this.legendOpen=(0,e.EWP)(()=>this.computeOpen("legend")),this.labelsOpen=(0,e.EWP)(()=>this.computeOpen("labels")),this.positionsOpen=(0,e.EWP)(()=>this.computeOpen("positions")),this.layout=(0,e.hFB)(),this.contentBlockTypes=hi.m}computeOpen(i){const t=this.toggledPanels(),o=this.descriptionPanelVisible();return t.has(i)?t.get(i):!o}insertStartingPosition(i){return(i=(0,u.cloneDeep)(i))[0].positions.unshift(this.positionsService.startingPositionToAdditionalPosition(this.store.selectSnapshot(me.N.getSelectedChapterId))),i}static#e=this.\u0275fac=function(t){return new(t||fs)(e.rXU(l.il),e.rXU(Ns.V),e.rXU(up))};static#t=this.\u0275cmp=e.VBU({type:fs,selectors:[["app-view-content-mode"]],inputs:{layout:[1,"layout"]},decls:9,vars:11,consts:()=>{let i,t,o;return i=$localize`:5c5419db944ed6a96f9515a2ac0ee390ec8cf3b57297822327994766046:Legend`,t=$localize`:2af7efecfae8d7fed3b07f718a623eca1ad8163f546766753072101168:Labels`,o=$localize`:7acfeb6214be6d5b9c6ca7285d689dd1402ca446529261375582544700:Positions`,[["data-test","viewContentMode",1,"view-content-mode"],[1,"block","mb-4",3,"toggleable"],["panelId","description","aria-describedby","view-title",3,"showHeader","canToggle","open"],["panelId","legend","label",i,3,"open"],["label",t,"panelId","labels",3,"open"],["label",o,"panelId","positions",3,"open"],[1,"block","mb-4"],[1,"text-sm","break-words"],[3,"markdownText"],[1,"mt-5"],[3,"contentBlocks","include"],[3,"legend"],[3,"contentBlocks"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",0),e.DNE(1,$w,1,1,"app-view-source-info",1)(2,Xw,6,7,"app-view-panel",2)(3,Hw,2,2,"app-view-panel",3),e.nI1(4,"async"),e.DNE(5,Qw,2,1,"app-view-panel",4),e.nI1(6,"async"),e.nI1(7,"async"),e.DNE(8,Yw,2,2,"app-view-panel",5),e.k0s()),2&t){let s,a;e.R7$(),e.vxM("drawer"===o.layout()?1:-1),e.R7$(),e.vxM(o.descriptionPanelVisible()?2:-1),e.R7$(),e.vxM(null!=(s=o.chapter())&&s.legend&&(null==(s=o.chapter())?null:s.legend.length)>0&&e.bMT(4,5,o.legendVisible$)?3:-1),e.R7$(2),e.vxM(null!=(a=e.bMT(6,7,o.labels$))&&a.length&&e.bMT(7,9,o.labelListVisible$)?5:-1),e.R7$(3),e.vxM(o.positionBlocks().length>0?8:-1)}},dependencies:[Vs,Ko.V,Pw,_c,ka,jw,Gw,J.Jj],styles:[".view-content-mode[_ngcontent-%COMP%]{padding-bottom:24px}"],changeDetection:0})}Hp([(0,l.l6)(et.getChapterLabels),Qp("design:type",h.c)],fs.prototype,"labels$",void 0),Hp([(0,l.l6)(Ke.getVisible(G.LabelList)),Qp("design:type",h.c)],fs.prototype,"labelListVisible$",void 0),Hp([(0,l.l6)(Ke.getVisible(G.Legend)),Qp("design:type",h.c)],fs.prototype,"legendVisible$",void 0);let gf=(()=>{class n{constructor(t,o){this.store=t,this.el=o,this.appInfoScroll=!0,this.ngUnsubscribe=new k.B}ngOnInit(){this.store.selectSnapshot(Fe.j.hasQuiz)&&this.handleQuizScrolling(),this.handleChapterScrolling()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleChapterScrolling(){this.store.select(me.N.getSelectedChapterId).pipe((0,D.p)(()=>this.appInfoScroll),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()})}handleQuizScrolling(){const t=this.store.select(Fe.j.getQuizModeActive),o=this.store.select(Fe.j.getLifecycle);t.pipe((0,D.p)(()=>this.appInfoScroll),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.scrollToTop()}),o.pipe((0,D.p)(()=>this.appInfoScroll),(0,p.Q)(this.ngUnsubscribe)).subscribe(s=>{s===Qo.h.Explanation?setTimeout(()=>this.scrollToBottom()):this.scrollToTop()})}scrollToTop(){this.el.nativeElement.scrollTo({top:0})}scrollToBottom(){this.el.nativeElement.scrollTo({top:this.el.nativeElement.scrollHeight,behavior:"smooth"})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(e.aKT))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appInfoScroll",""]],inputs:{appInfoScroll:"appInfoScroll"}})}return n})();const Kw=[[["","header",""]],[["","body",""]],[["","aside",""]]],qw=["[header]","[body]","[aside]"],Jw=(n,i)=>({"view-column--padded":n,"view-column--show-aside":i}),Zw=n=>({"!border-gray-200":n});function e2(n,i){1&n&&(e.j41(0,"div",4),e.SdG(1,2),e.k0s())}let fc="-100%";const t2=(0,xe.lY)([(0,xe.iF)({transform:"translateX({{ translateX }})"}),(0,xe.i0)("150ms ease-in-out",(0,xe.iF)({transform:"*"}))],{params:{translateX:fc}}),n2=(0,xe.lY)([(0,xe.i0)("150ms ease-in-out",(0,xe.iF)({transform:"translateX({{ translateX }})"}))],{params:{translateX:fc}});let mf=(()=>{class n{get show(){return{value:this.floating(),params:{translateX:fc}}}constructor(t,o,s){this.el=t,this.store=o,this.localeId=s,this.animationsDisabled=this.store.selectSnapshot(ls.U.getPrefersReducedMotion),this.contentMode=(0,je.ot)(this.store.select(de.getContentMode)),this.animated=(0,e.hFB)(!1),this.padded=(0,e.hFB)(!0),this.wide=(0,e.hFB)(!1),this.floating=(0,e.hFB)(!1),this.showFooter=(0,e.hFB)(!1),this.showAside=(0,e.hFB)(!1),this.footerLabel=(0,e.hFB)(""),this.viewContentMode=Bt,this.footerExpanded=!1,this.scrollTop=0,"rtl"===(0,Jn.NS)(this.localeId).direction&&(fc="100%"),(0,e.QZP)(()=>{this.floating()&&this.el.nativeElement.classList.add("!absolute","z-50","top-0","start-0","bottom-0")}),(0,e.QZP)(()=>{const a=this.wide()?"424px":"320px";this.el.nativeElement.style.setProperty("--column-width",a)})}handleToggleFooter(t){this.footerExpanded=t}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.aKT),e.rXU(l.il),e.rXU(e.xe9))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-column"]],hostVars:2,hostBindings:function(o,s){2&o&&e.zvX("@show",s.show)("@.disabled",s.animationsDisabled)},inputs:{animated:[1,"animated"],padded:[1,"padded"],wide:[1,"wide"],floating:[1,"floating"],showFooter:[1,"showFooter"],showAside:[1,"showAside"],footerLabel:[1,"footerLabel"]},ngContentSelectors:qw,decls:6,vars:10,consts:[["role","main","data-test","viewColumn",1,"view-column",3,"ngClass"],[1,"border-b","border-transparent","border-solid","view-column__header",3,"ngClass"],[1,"view-column__body",3,"appScrollListenerChange","appScrollListener","appInfoScroll"],["class","view-column__aside",4,"ngIf"],[1,"view-column__aside"]],template:function(o,s){1&o&&(e.NAR(Kw),e.j41(0,"article",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.mxI("appScrollListenerChange",function(r){return e.DH7(s.scrollTop,r)||(s.scrollTop=r),r}),e.SdG(4,1),e.k0s(),e.DNE(5,e2,2,0,"div",3),e.k0s()),2&o&&(e.Y8G("ngClass",e.l_i(5,Jw,s.padded(),s.showAside())),e.R7$(),e.Y8G("ngClass",e.eq3(8,Zw,s.scrollTop>0||s.floating())),e.R7$(2),e.R50("appScrollListener",s.scrollTop),e.Y8G("appInfoScroll",s.contentMode()===s.viewContentMode.ChapterInfo||s.contentMode()===s.viewContentMode.Quiz),e.R7$(2),e.Y8G("ngIf",s.showAside()))},dependencies:[J.YU,J.bT,gf,pf],styles:['[_nghost-%COMP%]{--column-width: 320px;position:relative;width:var(--column-width);max-width:100vw}.view-column[_ngcontent-%COMP%]{background-color:#fff;border-right:1px solid #d4d9e3;height:100%;display:grid;grid-template-areas:"header" "content" "footer";grid-template-columns:auto;grid-template-rows:auto 1fr}.view-column--padded[_ngcontent-%COMP%]   .view-column__header[_ngcontent-%COMP%]{padding:20px 24px 12px}.view-column--padded[_ngcontent-%COMP%]   .view-column__body[_ngcontent-%COMP%]{padding:12px 24px 20px}.view-column--padded[_ngcontent-%COMP%]   .view-column__footer-content[_ngcontent-%COMP%]{padding:4px 24px 24px 12px}.view-column--show-aside[_ngcontent-%COMP%]{grid-template-areas:"aside header" "aside content" "aside footer";grid-template-columns:104px 320px}.view-column__aside[_ngcontent-%COMP%]{background-color:#f8f9fa;grid-area:aside;border-right:1px solid #d4d9e3}.view-column__aside[_ngcontent-%COMP%]:empty{display:none}.view-column__header[_ngcontent-%COMP%]{grid-area:header}.view-column__body[_ngcontent-%COMP%]{grid-area:content;overflow:auto}.view-column__footer[_ngcontent-%COMP%]{grid-area:footer;border:1px solid #d4d9e3;display:flex;flex-direction:column}.view-column__footer-toggle[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:16px 12px;color:#0c1726;font-size:.875rem;line-height:1.25rem;font-weight:600;text-transform:uppercase}.view-column__footer-content-wrapper[_ngcontent-%COMP%]{max-height:0;overflow:hidden;transition:all .5s}.view-column__footer-content-wrapper--expanded[_ngcontent-%COMP%]{overflow:auto;max-height:40vh}'],data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",(0,xe.sM)(t2)),(0,xe.kY)(":leave",(0,xe.sM)(n2))])]},changeDetection:0})}return n})();var ff=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Sf=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};class Da{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(t){return new(t||Da)};static#t=this.\u0275cmp=e.VBU({type:Da,selectors:[["app-view-column-chapter-header"]],decls:3,vars:3,consts:[["data-test","viewColumnHeader",1,"view-column-chapter-header"],[1,"view-column-chapter-header__title"],["size","lg",3,"dynamicTitle","showMetaTitle","showSubTitle"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-view-title",2),e.k0s()()),2&t&&(e.R7$(2),e.Y8G("dynamicTitle","chapter")("showMetaTitle",!1)("showSubTitle",!1))},dependencies:[mc],styles:[".view-column-chapter-header[_ngcontent-%COMP%]{min-height:32px;display:flex;align-items:center}.view-column-chapter-header__title[_ngcontent-%COMP%]{flex-grow:1;padding-right:12px}.view-column-chapter-header__pagination[_ngcontent-%COMP%]{align-self:flex-start}"],changeDetection:0})}ff([(0,l.l6)(me.N.getChapterCount),Sf("design:type",h.c)],Da.prototype,"chapterCount$",void 0),ff([(0,l.l6)(Ke.getVisible(G.Pagination)),Sf("design:type",h.c)],Da.prototype,"paginationVisible$",void 0);var bf=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},yf=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const i2=["sourceInformation"];function o2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-title",9),e.bVm()),2&n&&(e.R7$(),e.Y8G("dynamicTitle","quiz")("showMetaTitle",!1)("showSubTitle",!1))}function s2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-column-chapter-header")(2,"app-view-source-info-toggle"),e.bVm())}function a2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-content-mode"),e.bVm())}function r2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-quiz",10),e.bVm())}class La{constructor(i,t){this.store=i,this.popupService=t,this.contentMode=(0,je.ot)(this.store.select(de.getContentMode)),this.paginationVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Pagination))),this.viewContentMode=Bt}toggleSourceInformation(){this.popupService.open({origin:this.sourceInformationEl.nativeElement,content:_c}).afterClosed$.subscribe()}static#e=this.\u0275fac=function(t){return new(t||La)(e.rXU(l.il),e.rXU(nf))};static#t=this.\u0275cmp=e.VBU({type:La,selectors:[["app-view-column-container"]],viewQuery:function(t,o){if(1&t&&e.GBs(i2,5),2&t){let s;e.mGM(s=e.lsd())&&(o.sourceInformationEl=s.first)}},decls:11,vars:8,consts:[["data-test","viewColumnContainer",3,"padded","showAside"],["aside",""],[1,"block","h-full"],["header",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["body",""],[4,"ngIf"],[3,"dynamicTitle","showMetaTitle","showSubTitle"],["mode","column"]],template:function(t,o){1&t&&(e.j41(0,"app-view-column",0),e.qex(1,1),e.nrm(2,"app-view-chapter-list",2),e.bVm(),e.qex(3,3)(4,4),e.nI1(5,"async"),e.DNE(6,o2,2,3,"ng-container",5)(7,s2,3,0,"ng-container",6),e.bVm()(),e.qex(8,7),e.DNE(9,a2,2,0,"ng-container",8)(10,r2,2,0,"ng-container",8),e.bVm(),e.k0s()),2&t&&(e.Y8G("padded",o.contentMode()!==o.viewContentMode.Search)("showAside",o.paginationVisible()),e.R7$(4),e.Y8G("ngSwitch",e.bMT(5,6,o.contentMode$)),e.R7$(2),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(3),e.Y8G("ngIf",o.contentMode()===o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngIf",o.contentMode()===o.viewContentMode.Quiz))},dependencies:[J.bT,J.ux,J.e1,J.fG,Oi,_f,mc,kr,fs,mf,Da,J.Jj],styles:["[_nghost-%COMP%]{position:relative;height:100%}.view-column-container[_ngcontent-%COMP%]{height:100%}.view-column-container--hide-tabs[_ngcontent-%COMP%]   .view-column-container__tabs[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}bf([(0,l.l6)(de.getContentMode),yf("design:type",h.c)],La.prototype,"contentMode$",void 0),bf([(0,l.l6)(Ke.getVisible(G.Pagination)),yf("design:type",h.c)],La.prototype,"paginationVisible$",void 0);const l2=(n,i)=>({"rotate-180":n,"rotate-0":i});let c2=(()=>{class n{constructor(t,o,s){this.viewService=t,this.store=o,this.directionality=s,this.chapter=(0,je.ot)(this.store.select(me.N.getSelectedChapter)),this.viewUI=(0,je.ot)(this.store.select(Ke.getUI)),this.isOut=(0,e.EWP)(()=>!(0,u.isNil)(this.chapter())&&this.viewUI().column.status!==mt.Collapse),this.tooltipText=(0,e.EWP)(()=>this.isOut()?$localize`Close Info Panel`:$localize`Open Info Panel`),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}handleToggle(){const t=this.store.selectSnapshot(de.getContentMode);this.viewService.toggleColumn(),this.viewService.toggleSearch(null,!1),t===Bt.NodeInfo&&this.viewService.toggleNodeInfo(!1),t===Bt.LabelInfo&&this.viewService.toggleLabelInfo(!1)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En),e.rXU(l.il),e.rXU(Ra.dS))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-column-toggle"]],decls:3,vars:8,consts:[["orientation","vertical","appPreventFadeout",""],["app-view-button","","buttonSize","small","data-test","viewColumnToggle",3,"click","matTooltip","matTooltipPosition"],["appLogicalDir","","size","lg","icon","angles-left",1,"rotate--animate",3,"ngClass"]],template:function(o,s){1&o&&(e.j41(0,"app-pillbox",0)(1,"button",1),e.bIt("click",function(){return s.handleToggle()}),e.nrm(2,"app-icon",2),e.k0s()()),2&o&&(e.R7$(),e.Y8G("matTooltip",s.tooltipText())("matTooltipPosition",s.tooltipPosition),e.BMQ("aria-label",s.tooltipText())("aria-expanded",s.isOut()),e.R7$(),e.Y8G("ngClass",e.l_i(5,l2,!s.isOut(),s.isOut())))},dependencies:[Qt.ri,J.YU,Us,Ao.e,ut.R,Kt.oV,no],encapsulation:2,data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",[(0,xe.iF)({opacity:0,transform:"translateX(-32px)"}),(0,xe.i0)("300ms ease-in-out",(0,xe.iF)({opacity:1,transform:"*"}))]),(0,xe.kY)(":leave",[(0,xe.i0)("300ms ease-in-out",(0,xe.iF)({transform:"translateX(-32px)",opacity:0}))])])]},changeDetection:0})}return n})();const d2=["*"];function _2(n,i){if(1&n&&(e.j41(0,"div",7),e.nrm(1,"app-icon",8),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("icon",t.icon)}}function p2(n,i){if(1&n&&(e.j41(0,"h3",9),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.JRh(t.title)}}function u2(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleDismissClicked())}),e.nrm(1,"app-icon",11),e.k0s()}}function h2(n,i){if(1&n&&(e.j41(0,"div",1)(1,"div",2),e.DNE(2,_2,2,1,"div",3),e.j41(3,"div",4),e.DNE(4,p2,2,1,"h3",5),e.j41(5,"p"),e.SdG(6),e.k0s()()(),e.DNE(7,u2,2,0,"button",6),e.k0s()),2&n){const t=e.XpG();e.AVh("message-toggle--message","message"===t.type)("message-toggle--error","error"===t.type)("message-toggle--danger","danger"===t.type)("message-toggle--notification","notification"===t.type)("message-toggle--warning","warning"===t.type)("message-toggle--rounded","rounded"===t.toggleStyle)("message-toggle--light","light"===t.theme)("message-toggle--dark","dark"===t.theme)("message-toggle--left","left"===t.toggleAlign)("message-toggle--center","center"===t.toggleAlign)("message-toggle--icon-top","top"===t.alignIcon)("message-toggle--icon-center","center"===t.alignIcon)("message-toggle--icon-bottom","bottom"===t.alignIcon),e.Y8G("@show",void 0),e.R7$(2),e.Y8G("ngIf",t.icon),e.R7$(2),e.Y8G("ngIf",t.title),e.R7$(3),e.Y8G("ngIf",t.dismiss)}}let Dr=(()=>{class n{get shown(){return this._shown}set shown(t){this._shown!==t&&(this._shown=t,this.shownSubject.next(t),this.changeRef.markForCheck())}constructor(t){this.changeRef=t,this.type="message",this.theme="light",this.toggleAlign="left",this.alignIcon="top",this.showDelay=0,this.hideDelay=5e3,this.dismiss=!1,this.toggleStyle="rounded",this.handleDismiss=new k.B,this._shown=!0,this.shownSubject=new k.B,this.ngUnsubscribe=new k.B}ngOnInit(){this.initViewShownListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismissClicked(){this.handleDismiss.next()}initViewShownListeners(){this.shownSubject.pipe((0,D.p)(()=>this.hideDelay>0),(0,wn.B)(this.hideDelay),(0,D.p)(t=>t),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this._shown=!1,this.changeRef.markForCheck()})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-message-toggle"]],inputs:{type:"type",theme:"theme",toggleAlign:"toggleAlign",icon:"icon",alignIcon:"alignIcon",title:"title",showDelay:"showDelay",hideDelay:"hideDelay",dismiss:"dismiss",toggleStyle:"toggleStyle",shown:"shown"},outputs:{handleDismiss:"handleDismiss"},ngContentSelectors:d2,decls:1,vars:1,consts:[["class","message-toggle flex flex-row items-start justify-between",3,"message-toggle--message","message-toggle--error","message-toggle--danger","message-toggle--notification","message-toggle--warning","message-toggle--rounded","message-toggle--light","message-toggle--dark","message-toggle--left","message-toggle--center","message-toggle--icon-top","message-toggle--icon-center","message-toggle--icon-bottom",4,"ngIf"],[1,"message-toggle","flex","flex-row","items-start","justify-between"],[1,"message-toggle__wrapper","flex","flex-row","flex-auto"],["class","message-toggle__icon mr-3",4,"ngIf"],[1,"message-toggle__content"],["class","font-semibold mb-1",4,"ngIf"],["class","message-toggle__icon message-toggle__dismiss",3,"click",4,"ngIf"],[1,"message-toggle__icon","mr-3"],[3,"icon"],[1,"font-semibold","mb-1"],[1,"message-toggle__icon","message-toggle__dismiss",3,"click"],["icon","times"]],template:function(o,s){1&o&&(e.NAR(),e.DNE(0,h2,8,30,"div",0)),2&o&&e.Y8G("ngIf",s.shown)},dependencies:[J.bT,ut.R],styles:[":root{--message-toggle-color: #142136;--message-toggle-background-color: #eff6ff;--message-toggle-icon-color: #2472e9}.message-toggle{padding:16px;box-sizing:border-box;font-size:13px;line-height:20px;color:var(--message-toggle-color);background-color:var(--message-toggle-background-color)}.message-toggle--rounded{border-radius:4px}.message-toggle__icon{color:#fff;font-size:16px;background:none;border:none;color:var(--message-toggle-icon-color)}.message-toggle__content{padding:0 2px;word-break:break-word}.message-toggle__dismiss{font-size:14px;color:var(--message-toggle-color);cursor:pointer}.message-toggle--left .message-toggle__content{flex:1 1 auto}.message-toggle--center .message-toggle__wrapper{justify-content:center}.message-toggle--icon-top .message-toggle__icon{align-self:flex-start}.message-toggle--icon-center .message-toggle__icon{align-self:center}.message-toggle--icon-bottom .message-toggle__icon{align-self:flex-end}.message-toggle.message-toggle--message{--message-toggle-color: #142136;--message-toggle-background-color: #f0fdf4;--message-toggle-icon-color: #22c55e}.message-toggle.message-toggle--notification{--message-toggle-color: #142136;--message-toggle-background-color: #eff6ff;--message-toggle-icon-color: #2472e9}.message-toggle.message-toggle--warning{--message-toggle-color: #142136;--message-toggle-background-color: #fefce8;--message-toggle-icon-color: #eab308}.message-toggle.message-toggle--error,.message-toggle.message-toggle--danger{--message-toggle-color: #142136;--message-toggle-background-color: #fef2f2;--message-toggle-icon-color: #dc2626}.message-toggle--dark.message-toggle--message{--message-toggle-background-color: #dcfce7}.message-toggle--dark.message-toggle--notification{--message-toggle-background-color: #dbe9fe}.message-toggle--dark.message-toggle--warning{--message-toggle-background-color: #fef9c3}.message-toggle--dark.message-toggle--error,.message-toggle--dark.message-toggle--danger{--message-toggle-background-color: #fee2e2}\n"],encapsulation:2,data:{animation:[(0,xe.hZ)("show",[(0,xe.kY)(":enter",[(0,xe.sM)(Hs.fadeIn,{params:{duration:300}})]),(0,xe.kY)(":leave",[(0,xe.sM)(Hs.fadeOut,{params:{duration:300}})])])]},changeDetection:0})}return n})();function f2(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",2)(1,"app-message-toggle",3),e.bIt("handleDismiss",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleDismiss())}),e.j41(2,"div"),e.pXf(3,0),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("dismiss",!0))}class Lr{constructor(i){this.changeRef=i,this.shown=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.bookmark$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=(0,u.get)(i,"tags",[]);this.shown=t.includes("complete anatomy"),this.changeRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleDismiss(){this.shown=!1,this.changeRef.markForCheck()}static#e=this.\u0275fac=function(t){return new(t||Lr)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Lr,selectors:[["app-view-content-warning"]],decls:2,vars:3,consts:()=>{let i;return i=$localize`:1d4c33eaee2d38fb3172aed1c2b4dc7eee0c2eb6890030107605562637: This model is not optimized for use on mobile devices. For an optimal experience, please switch to a desktop device or try our Anatomy by Region. `,[i,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(t,o){1&t&&(e.DNE(0,f2,4,1,"div",1),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,o.bookmark$)&&o.shown)},dependencies:[J.bT,Dr,J.Jj],styles:[".warning{position:fixed;top:0;left:0;right:0;z-index:1001}\n"],encapsulation:2,changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(ft.getSelectedBookmark),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Lr.prototype,"bookmark$",void 0);const y2=["*"];class Ur{constructor(){this.toggle=new e.bkB,this.open=!1,this.fixed=!1,this.compact=!1}handleToggleClick(){this.toggle.emit()}static#e=this.\u0275fac=function(t){return new(t||Ur)};static#t=this.\u0275cmp=e.VBU({type:Ur,selectors:[["app-view-drawer-header"]],inputs:{open:"open",fixed:"fixed",compact:"compact"},outputs:{toggle:"toggle"},ngContentSelectors:y2,decls:5,vars:8,consts:[["app-view-button","","buttonSize","fill","data-test","drawerToggleButton",1,"view-drawer-header",3,"click"],[1,"view-drawer-header__content"],["size","md",1,"mx-4",3,"icon"]],template:function(t,o){if(1&t&&(e.NAR(),e.j41(0,"button",0),e.bIt("click",function(){return o.handleToggleClick()}),e.j41(1,"div",1),e.SdG(2),e.nrm(3,"app-icon",2),e.nI1(4,"async"),e.k0s()()),2&t){let s;e.AVh("view-drawer-header--fixed",o.fixed)("view-drawer-header--compact",o.compact),e.BMQ("aria-expanded",o.open),e.R7$(3),e.Y8G("icon","show"===(null==(s=e.bMT(4,6,o.viewUI$))?null:s.drawer.status)?"angle-down":"angle-up")}},dependencies:[Qt.ri,ut.R,J.Jj],styles:[".view-drawer-header[_ngcontent-%COMP%]{--header-height: 40px;font-size:16px;width:100%;border-bottom:1px solid #d4d9e3;min-height:var(--header-height)}.view-drawer-header--fixed[_ngcontent-%COMP%]{font-size:14px;height:var(--header-height)}.view-drawer-header--compact[_ngcontent-%COMP%]{--header-height: 24px;min-height:var(--header-height);height:var(--header-height);font-size:12px}.view-drawer-header__content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 16px;margin:0 auto;max-width:520px;min-height:var(--header-height)-4px}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Ke.getUI),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Ur.prototype,"viewUI$",void 0);var Mi=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Ii=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const v2=["viewDrawer"],E2=["viewDrawerContent"],C2=(n,i,t)=>({"view-drawer--closed":n,"view-drawer--active":i,"view-drawer--scrollable":t}),vf=n=>[n];function T2(n,i){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-spinner",10),e.nI1(2,"async"),e.k0s()),2&n){let t;const o=e.XpG();e.R7$(),e.Y8G("label",null==(t=e.bMT(2,1,o.scrim$))?null:t.label)}}function O2(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",11),e.bIt("toggle",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.ChapterInfo))}),e.nrm(2,"app-view-title",12),e.k0s(),e.bVm()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("compact",t.scrolled&&t.scrollThreshold),e.R7$(),e.Y8G("dynamicTitle","chapter")("showMetaTitle",!1)("showSubTitle",!1)("useEllipsis",t.scrolled&&t.scrollThreshold)}}function M2(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.bIt("toggle",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.Quiz))}),e.nrm(2,"app-view-title",14),e.k0s(),e.bVm()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("fixed",!0)("compact",t.scrolled&&t.scrollThreshold),e.R7$(),e.Y8G("dynamicTitle","quiz")("showMetaTitle",!1)("showSubTitle",!1)}}function I2(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.nI1(2,"async"),e.bIt("toggle",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.LabelInfo))}),e.nrm(3,"app-view-title",15),e.nI1(4,"async"),e.k0s(),e.bVm()}if(2&n){let t,o;const s=e.XpG();e.R7$(),e.Y8G("fixed","collapse"===(null==(t=e.bMT(2,5,s.drawerUI$))?null:t.status))("compact",s.scrolled&&s.scrollThreshold),e.R7$(2),e.Y8G("align","center")("mainTitle",null==(o=e.bMT(4,7,s.selectedLabel$))?null:o.title)("useEllipsis",s.scrolled&&s.scrollThreshold)}}function P2(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"app-view-drawer-header",13),e.nI1(2,"async"),e.bIt("toggle",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleClick(s.viewContentMode.VisibilityLayers))}),e.nrm(3,"app-view-title",16),e.k0s(),e.bVm()}if(2&n){let t;const o=e.XpG();e.R7$(),e.Y8G("fixed","collapse"===(null==(t=e.bMT(2,3,o.drawerUI$))?null:t.status))("compact",o.scrolled&&o.scrollThreshold),e.R7$(2),e.Y8G("align","left")}}function w2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-content-mode",17),e.bVm())}function A2(n,i){1&n&&e.nrm(0,"app-view-quiz",20)}function R2(n,i){if(1&n&&(e.j41(0,"div",18),e.DNE(1,A2,1,0,"app-view-quiz",19),e.nI1(2,"async"),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.quizModeActive$))}}function N2(n,i){if(1&n&&(e.j41(0,"div",24),e.nrm(1,"app-content-blocks",25),e.nI1(2,"async"),e.k0s()),2&n){let t;const o=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",null==(t=e.bMT(2,3,o.selectedLabel$))?null:t.contentBlocks)("exclude",e.eq3(5,vf,o.contentBlockTypes.CTA))("layout","compact")}}function k2(n,i){if(1&n&&(e.j41(0,"div",26),e.nrm(1,"app-content-blocks",27),e.nI1(2,"async"),e.k0s()),2&n){let t;const o=e.XpG(2);e.R7$(),e.Y8G("contentBlocks",null==(t=e.bMT(2,3,o.selectedLabel$))?null:t.contentBlocks)("include",e.eq3(5,vf,o.contentBlockTypes.CTA))("layout","compact")}}function D2(n,i){if(1&n&&(e.qex(0),e.DNE(1,N2,3,7,"div",21),e.nI1(2,"async"),e.nrm(3,"app-html",22),e.nI1(4,"async"),e.DNE(5,k2,3,7,"div",23),e.nI1(6,"async"),e.bVm()),2&n){let t,o,s;const a=e.XpG();e.R7$(),e.Y8G("ngIf",null==(t=e.bMT(2,3,a.selectedLabel$))?null:t.contentBlocks),e.R7$(2),e.Y8G("markdownText",null==(o=e.bMT(4,5,a.selectedLabel$))?null:o.description),e.R7$(2),e.Y8G("ngIf",null==(s=e.bMT(6,7,a.selectedLabel$))?null:s.contentBlocks)}}function L2(n,i){1&n&&(e.qex(0),e.nrm(1,"app-view-visibility-layers",28),e.bVm()),2&n&&(e.R7$(),e.Y8G("compact",!0))}class Kn{constructor(i,t,o){this.changeDetectorRef=i,this.viewService=t,this.store=o,this.viewContentMode=Bt,this.contentBlockTypes=hi.m,this.openChanged=new e.bkB,this.ngUnsubscribe=new k.B,this.viewMode=Kl,this.mode=Kl.Content,this.horizontalBreakpoint=Qn,this.scrolled=!1,this.scrollThreshold=!1}ngOnInit(){this.initQuizObserver(),this.initScrollObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initQuizObserver(){const i=this.selectedChapterReady$.pipe((0,W.T)(t=>t&&t.model),(0,D.p)(t=>t),(0,wn.B)(300));(0,cn.z)([i,this.quizModeActive$]).pipe((0,D.p)(([t])=>t),(0,p.Q)(this.ngUnsubscribe)).subscribe(([,t])=>{setTimeout(()=>{t&&(this.viewService.toggleDrawer(mt.Show),this.changeDetectorRef.markForCheck())})})}initScrollObserver(){(0,Sn.R)(this.viewDrawerContent.nativeElement,"scroll").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentScroll())}updateViewHeight(){const i=this.store.selectSnapshot(vn.getSiteHeader),s=rp(i,this.store.selectSnapshot(vn.getSiteHeaderHeight),Bl(i));this.viewDrawer.nativeElement.style.setProperty("--vh",`${s}px`)}handleToggleClick(i){const t=this.store.selectSnapshot(Ke.getUIEntry(G.Drawer));switch(i){case Bt.LabelInfo:this.viewService.clearSelectedLabel();break;case Bt.Quiz:this.viewService.toggleDrawer(t.status===mt.Show?mt.Collapse:mt.Show);break;default:this.viewService.toggleDrawer()}}handleDrawerKeydown(i){("ArrowDown"===i.key||"ArrowUp"===i.key)&&i.stopPropagation()}handleLabelBack(){this.viewService.clearSelectedLabel()}handlePreviousClick(){this.viewService.previousChapter("drawer")}handleNextClick(){this.viewService.nextChapter("drawer")}handleContentScroll(){const i=this.viewDrawerContent.nativeElement.scrollTop;this.scrollThreshold=this.viewDrawerContent.nativeElement.scrollHeight-this.viewDrawerContent.nativeElement.clientHeight>21;const s=i>0;s!==this.scrolled&&(this.scrolled=s,this.changeDetectorRef.markForCheck())}static#e=this.\u0275fac=function(t){return new(t||Kn)(e.rXU(e.gRc),e.rXU(En),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:Kn,selectors:[["app-view-drawer"]],viewQuery:function(t,o){if(1&t&&(e.GBs(v2,5),e.GBs(E2,7)),2&t){let s;e.mGM(s=e.lsd())&&(o.viewDrawer=s.first),e.mGM(s=e.lsd())&&(o.viewDrawerContent=s.first)}},outputs:{openChanged:"openChanged"},decls:22,vars:32,consts:[["viewDrawer",""],["viewDrawerContent",""],["role","main","data-test","viewPageDrawer",1,"view-drawer",3,"ngClass"],["class","view-drawer__scrim",4,"ngIf"],[1,"view-drawer__outer",3,"keydown"],[1,"view-drawer__inner",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"view-drawer__content",3,"appInfoScroll","ngSwitch"],["class","pt-3 pb-8",4,"ngSwitchCase"],[1,"view-drawer__scrim"],["size","large",3,"label"],[3,"toggle","compact"],[3,"dynamicTitle","showMetaTitle","showSubTitle","useEllipsis"],[3,"toggle","fixed","compact"],[3,"dynamicTitle","showMetaTitle","showSubTitle"],[3,"align","mainTitle","useEllipsis"],["mainTitle","Anatomy Layers",3,"align"],["layout","drawer",1,"mt-2"],[1,"pt-3","pb-8"],["mode","drawer",4,"ngIf"],["mode","drawer"],["appEventFence","",4,"ngIf"],[1,"text-sm",3,"markdownText"],["class","mt-2",4,"ngIf"],["appEventFence",""],[3,"contentBlocks","exclude","layout"],[1,"mt-2"],[3,"contentBlocks","include","layout"],[3,"compact"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"article",2,0),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,T2,3,3,"div",3),e.nI1(6,"async"),e.j41(7,"div",4),e.bIt("keydown",function(r){return e.eBV(s),e.Njj(o.handleDrawerKeydown(r))}),e.j41(8,"div",5),e.nI1(9,"async"),e.DNE(10,O2,3,5,"ng-container",6)(11,M2,3,5,"ng-container",6)(12,I2,5,9,"ng-container",6)(13,P2,4,5,"ng-container",6),e.j41(14,"div",7,1),e.nI1(16,"async"),e.nI1(17,"async"),e.DNE(18,w2,2,0,"ng-container",6)(19,R2,3,3,"div",8)(20,D2,7,9,"ng-container",6)(21,L2,2,1,"ng-container",6),e.k0s()()()()}if(2&t){let s,a;e.Y8G("ngClass",e.sMw(28,C2,!1===e.bMT(2,14,o.drawerVisible$),e.bMT(3,16,o.drawerVisible$),"show"===(null==(s=e.bMT(4,18,o.drawerUI$))?null:s.status))),e.R7$(5),e.Y8G("ngIf",null==(a=e.bMT(6,20,o.scrim$))?null:a.show),e.R7$(3),e.Y8G("ngSwitch",e.bMT(9,22,o.contentMode$)),e.R7$(2),e.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers),e.R7$(),e.Y8G("appInfoScroll",!0)("ngSwitch",e.bMT(16,24,o.contentMode$)),e.BMQ("tabindex",e.bMT(17,26,o.drawerVisible$)?0:-1),e.R7$(4),e.Y8G("ngSwitchCase",o.viewContentMode.ChapterInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.Quiz),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.LabelInfo),e.R7$(),e.Y8G("ngSwitchCase",o.viewContentMode.VisibilityLayers)}},dependencies:[J.YU,J.bT,J.ux,J.e1,Vs,Ta.L,gf,Jo.tI,Ko.V,Oi,Dp,mc,fs,Ur,J.Jj],styles:[".view-drawer{height:100%;padding-bottom:4px}.view-drawer--active,.view-drawer--closed{background-color:#fff}.view-drawer--scrollable{min-height:0}.view-drawer--scrollable .view-drawer__content{overflow-y:scroll}.view-drawer__header{position:relative;border-bottom:1px solid #e7eaee}.view-drawer__pagination,.view-drawer__media{display:flex;align-items:center;border-right:1px solid rgba(0,0,0,.1)}.view-drawer__toggle{padding:0 16px;display:flex;align-items:center;justify-content:center;width:100%;font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:600}.view-drawer__inner{height:100%;display:flex;flex-direction:column}.view-drawer__outer{outline:none;height:100%}.view-drawer__content{display:flex;flex:1 1 100%;flex-direction:column;width:100%;max-width:520px;margin:0 auto;padding:8px 16px}.view-drawer__scrim{background-color:#fff;position:absolute;display:flex;justify-content:center;align-items:center;z-index:50;inset:0}.view-drawer__pagination-tooltip{position:absolute;z-index:1000;bottom:100%;left:36px}\n"],encapsulation:2,changeDetection:0})}Mi([(0,l.l6)(de.getContentMode),Ii("design:type",h.c)],Kn.prototype,"contentMode$",void 0),Mi([(0,l.l6)(de.getScrim),Ii("design:type",h.c)],Kn.prototype,"scrim$",void 0),Mi([(0,l.l6)(me.N.getSelectedChapterTitle),Ii("design:type",h.c)],Kn.prototype,"selectedChapterTitle$",void 0),Mi([(0,l.l6)(me.N.getChapterPagination),Ii("design:type",h.c)],Kn.prototype,"pagination$",void 0),Mi([(0,l.l6)(me.N.getSelectedChapterReadyState),Ii("design:type",h.c)],Kn.prototype,"selectedChapterReady$",void 0),Mi([(0,l.l6)(me.N.getNextChapter),Ii("design:type",h.c)],Kn.prototype,"nextChapter$",void 0),Mi([(0,l.l6)(et.getSelectedLabel),Ii("design:type",h.c)],Kn.prototype,"selectedLabel$",void 0),Mi([(0,l.l6)(Fe.j.getQuizModeActive),Ii("design:type",h.c)],Kn.prototype,"quizModeActive$",void 0),Mi([(0,l.l6)(Fe.j.getActiveQuestionIndex),Ii("design:type",h.c)],Kn.prototype,"activeQuestionIndex$",void 0),Mi([(0,l.l6)(Fe.j.getQuestionTotal),Ii("design:type",h.c)],Kn.prototype,"questionTotal$",void 0),Mi([(0,l.l6)(Fe.j.getQuestionsRemaining),Ii("design:type",h.c)],Kn.prototype,"questionRemaining$",void 0),Mi([(0,l.l6)(Fe.j.getQuizSettings),Ii("design:type",h.c)],Kn.prototype,"quizSettings$",void 0),Mi([(0,l.l6)(Fe.j.getQuizModeLocked),Ii("design:type",h.c)],Kn.prototype,"quizLocked$",void 0),Mi([(0,l.l6)(Dn.getHorizontalBreakpoint),Ii("design:type",h.c)],Kn.prototype,"horizontalBreakpoint$",void 0),Mi([(0,l.l6)(Ke.getVisible(G.Drawer)),Ii("design:type",h.c)],Kn.prototype,"drawerVisible$",void 0),Mi([(0,l.l6)(Ke.getUIEntry(G.Drawer)),Ii("design:type",h.c)],Kn.prototype,"drawerUI$",void 0);let U2=(()=>{class n{constructor(t,o,s){this.viewService=t,this.directionality=o,this.store=s,this.viewUI=(0,je.ot)(this.store.select(Ke.getUI)),this.contentMode=(0,je.ot)(this.store.select(de.getContentMode)),this.isOut=(0,e.EWP)(()=>this.viewUI().drawer.status===mt.Show&&this.contentMode()===Bt.ChapterInfo),this.tooltipText=(0,e.EWP)(()=>this.isOut()?$localize`Close Info Panel`:$localize`Open Info Panel`),this.tooltipPosition="ltr"===this.directionality.value?"right":"left"}toggleDrawer(){const t=this.isOut()?mt.Hide:mt.Show;this.viewService.clearSelectedLabel(),this.viewService.setContentMode(Bt.ChapterInfo),this.viewService.toggleDrawer(t,!0)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En),e.rXU(Ra.dS),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-drawer-toggle"]],decls:2,vars:4,consts:[["app-view-button","","buttonSize","small","data-test","viewDrawerToggle",3,"click","matTooltip","matTooltipPosition","buttonTheme"],["size","lg","icon","info",3,"custom"]],template:function(o,s){1&o&&(e.j41(0,"button",0),e.bIt("click",function(){return s.toggleDrawer()}),e.nrm(1,"app-icon",1),e.k0s()),2&o&&(e.Y8G("matTooltip",s.tooltipText())("matTooltipPosition",s.tooltipPosition)("buttonTheme",s.isOut()?"blue-fill":"transparent-fill"),e.R7$(),e.Y8G("custom",!0))},dependencies:[Qt.ri,ut.R,Kt.oV],changeDetection:0})}return n})();function x2(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",2)(1,"app-message-toggle",3),e.bIt("handleDismiss",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleDismiss())}),e.j41(2,"div"),e.pXf(3,0),e.k0s()()()}2&n&&(e.R7$(),e.Y8G("dismiss",!0))}const Ys=[];let Sc,bc,V2=(()=>{class n{constructor(t,o){this.storageService=t,this.changeRef=o,this.shown=!1,this.sampling=!1}ngOnInit(){this.storageService.getLocalItem(It.UT.Iphone12Warning)||this.testDevices()}ngOnDestroy(){this.sampling=!1}testDevices(){const t=window.matchMedia("only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"),o=window.matchMedia("only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)"),s=window.matchMedia("only screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2)"),a=t.matches||o.matches||s.matches,r=/iPhone|iPad/.test(navigator.userAgent),_=/OS\s14/.test(navigator.userAgent);a&&r&&_&&this.startFrameSampling()}startFrameSampling(){this.sampling=!0,Sc=0,bc=Date.now();const t=()=>{this.frame()?(this.shown=!0,this.changeRef.markForCheck()):this.sampling&&requestAnimationFrame(t)};requestAnimationFrame(t)}frame(){Sc++;const t=Date.now();if(t>=bc+500){const s=Math.floor(500*Sc/(t-bc)*2);if(Ys.push(s),Ys.length>3&&Ys.shift(),3===Ys.length&&(Ys[0]+Ys[1]+Ys[2])/3<10)return!0;bc=t,Sc=0}}handleDismiss(){this.shown=!1,this.changeRef.markForCheck(),this.storageService.setLocalItem(It.UT.Iphone12Warning,!0)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(It.n$),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-iphone12-warning"]],decls:1,vars:1,consts:()=>{let t;return t=$localize`:6aa3f174a7565623c9f89ee56c05a46a791742c96041509682411192729: This model appears to be performing slowly on your device. For an optimal experience, please switch to a different device or try another model. `,[t,["class","warning",4,"ngIf"],[1,"warning"],["type","warning","toggleStyle","flat","icon","info-circle",3,"handleDismiss","dismiss"]]},template:function(o,s){1&o&&e.DNE(0,x2,4,1,"div",1),2&o&&e.Y8G("ngIf",s.shown)},dependencies:[J.bT,Dr],styles:[".warning[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1002}"],changeDetection:0})}return n})();const F2=["viewLoader"],G2=["*"];let $2=(()=>{class n{constructor(t,o,s,a){this.renderer=t,this.viewService=o,this.mediaService=s,this.store=a,this.ngUnsubscribe=new k.B}handleClick(){this.renderer.addClass(this.viewLoaderRef.nativeElement,"view-loader--disappear"),this.viewService.toggleInteract(!1),this.store.selectSnapshot(ls.U.getPrefersReducedMotion)||this.viewService.playChapterFromStart();const t=this.store.selectSnapshot(de.getViewLanguage),o=this.store.selectSnapshot(me.N.getSelectedChapter);this.store.selectSnapshot(de.getPlaythroughEnabled)||this.mediaService.getChapterAudioPlayer(o,t).then(a=>{if(a){const r=this.store.selectSnapshot(me.N.getSelectedChapterId);this.mediaService.playChapterAudio(r)}})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG),e.rXU(En),e.rXU(vi),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-loader"]],viewQuery:function(o,s){if(1&o&&e.GBs(F2,7),2&o){let a;e.mGM(a=e.lsd())&&(s.viewLoaderRef=a.first)}},ngContentSelectors:G2,decls:4,vars:0,consts:[["viewLoader",""],["role","dialog",1,"view-loader"],["role","button",3,"click"]],template:function(o,s){if(1&o){const a=e.RV6();e.NAR(),e.j41(0,"div",1,0)(2,"div",2),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleClick())}),e.SdG(3),e.k0s()()}},encapsulation:2,changeDetection:0})}return n})();function B2(n,i){if(1&n&&(e.j41(0,"p"),e.EFF(1),e.qex(2),e.pXf(3,0),e.bVm(),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.SpI("",t.chapterCount()," ")}}function z2(n,i){1&n&&(e.j41(0,"p"),e.pXf(1,1),e.k0s())}function W2(n,i){if(1&n&&(e.j41(0,"div",7),e.DNE(1,B2,4,1,"p")(2,z2,2,0,"p"),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.vxM(t.hasMultiChapter()?1:-1),e.R7$(),e.vxM(t.hasSkinVariants()?2:-1)}}function X2(n,i){1&n&&(e.qex(0),e.pXf(1,2),e.bVm())}function H2(n,i){1&n&&(e.qex(0),e.pXf(1,3),e.bVm())}function Q2(n,i){1&n&&(e.qex(0),e.pXf(1,4),e.bVm())}function Y2(n,i){if(1&n&&e.DNE(0,H2,2,0,"ng-container")(1,Q2,2,0,"ng-container"),2&n){const t=e.XpG(2);e.vxM(t.hasMultiChapter()?0:1)}}function K2(n,i){if(1&n&&(e.j41(0,"h1",6),e.EFF(1),e.k0s(),e.DNE(2,W2,3,2,"div",7),e.j41(3,"div",8),e.DNE(4,X2,2,0,"ng-container")(5,Y2,2,1),e.nrm(6,"app-icon",9),e.k0s()),2&n){let t;const o=e.XpG();e.R7$(),e.SpI(" ",o.story().displayName," "),e.R7$(),e.vxM(o.hasMultiChapter()||o.hasSkinVariants()?2:-1),e.R7$(2),e.vxM((t=o.selectedBookmarkViewMode())===o.bookmarkViewMode.Quiz?4:5)}}let Ef=(()=>{class n{constructor(t){this.store=t,this.bookmarkViewMode=we,this.story=(0,je.ot)(this.store.select(dt.getStory)),this.chapterCount=(0,je.ot)(this.store.select(me.N.getChapterCount)),this.selectedBookmarkViewMode=(0,je.ot)(this.store.select(ft.getSelectedBookmarkViewMode)),this.skinVariant=(0,je.ot)(this.store.select(dt.getVariantSchema("skin"))),this.hasSkinVariants=(0,e.EWP)(()=>!(0,u.isEmpty)(this.skinVariant())),this.hasMultiChapter=(0,e.EWP)(()=>this.chapterCount()>1)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-summary-loader"]],decls:2,vars:1,consts:()=>{let t,o,s,a,r,_;return t=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,o=$localize`:d904f74acb72356dd3547977ca3cf29d6da259465096495468612049743:Chapters`,s=$localize`:39967f284caff71af5063e41259bb4968bff203b4142145898284245309:Skin Options Available`,a=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,r=$localize`:2c55dafd02bed135add1986e10e77ae6607285332899734440722419896:Begin Interactive Tour`,_=$localize`:b13403343605d44ebc315fb7b618d8d859410163306128254471360973:Interact in 3D`,[o,s,a,r,_,["type","button","aria-label",t,1,"summary-loader"],[1,"text-2xl","font-bold"],[1,"summary-loader__sub-title"],[1,"summary-loader__cta"],["icon","arrow-right","appLogicalDir","",1,"ml-2"]]},template:function(o,s){1&o&&(e.j41(0,"button",5),e.DNE(1,K2,7,3),e.k0s()),2&o&&(e.R7$(),e.vxM(s.story()?1:-1))},dependencies:[Ao.e,ut.R],styles:['.button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;align-items:center;background:none;border-color:transparent;border-radius:4px;border-width:0;color:inherit;display:flex;font-family:Inter,sans-serif;justify-content:center;margin:0;outline:0 none;padding:0 16px;position:relative;text-align:center;text-decoration:none;transition:background-color .12s;width:100%}.button[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.button[_ngcontent-%COMP%]:focus   .button--themed[_ngcontent-%COMP%]{outline:#2472e9 solid 2px!important}.button[_ngcontent-%COMP%]:after{content:" ";background-color:#283853;border-radius:4px;display:block;position:absolute;inset:0;opacity:0;z-index:1;transition:opacity .06s}.button[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.7}.button__container[_ngcontent-%COMP%]{position:relative;z-index:2;width:100%}.button--uppercase[_ngcontent-%COMP%]{text-transform:uppercase}.button--expanded[_ngcontent-%COMP%]{display:flex;flex:1}.button--xsmall[_ngcontent-%COMP%]{height:24px;min-width:24px;padding:0 8px;font-size:.625rem;line-height:.75rem}.button--small[_ngcontent-%COMP%]{height:32px;min-width:32px;padding:0 12px;font-size:.75rem;line-height:1rem}.button--medium[_ngcontent-%COMP%]{height:36px;min-width:36px;padding:0 16px;font-size:.75rem;line-height:1rem}.button--large[_ngcontent-%COMP%]{height:48px;min-width:48px;padding:0 16px;font-size:.875rem;line-height:1.25rem}.button--no-border[_ngcontent-%COMP%]{border-radius:0!important}.button--no-border[_ngcontent-%COMP%]:after{border-radius:0!important}.button--left[_ngcontent-%COMP%]{text-align:left}.button--themed[_ngcontent-%COMP%]{color:#384c6c}.button--themed[_ngcontent-%COMP%]:hover{color:#142136}.button--themed[_ngcontent-%COMP%]:after{background-color:#d4d9e3}.button--dark[_ngcontent-%COMP%]{color:#d4d9e3}.button--dark[_ngcontent-%COMP%]:hover{color:#fff}.button--dark[_ngcontent-%COMP%]:after{background-color:#283853}.button--dark.button--flat[_ngcontent-%COMP%]{background:#384c6c}.button--dark.button--default[_ngcontent-%COMP%]{background:transparent}.button--dark.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #384c6c;transition:border-color .12s}.button--dark.button--outline[_ngcontent-%COMP%]:hover{border-color:#8999b3}.button--dark.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent;display:none}.button--dark.button--text[_ngcontent-%COMP%]{background:transparent;color:#d4d9e3}.button--dark.button--text[_ngcontent-%COMP%]:hover{color:#fff}.button--dark.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--dark.button--selected[_ngcontent-%COMP%]{background-color:#2472e9;color:#fff}.button--dark.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light[_ngcontent-%COMP%]{color:#283853}.button--light[_ngcontent-%COMP%]:hover{color:#142136}.button--light[_ngcontent-%COMP%]:after{background-color:#8999b3}.button--light[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.6}.button--light.button--flat[_ngcontent-%COMP%]{background:#d4d9e3;font-weight:500}.button--light.button--flat.button--selected[_ngcontent-%COMP%]{background-color:#8999b3}.button--light.button--default[_ngcontent-%COMP%]{background:transparent;color:#0c1726}.button--light.button--default[_ngcontent-%COMP%]:not(.button--disabled):hover:after{opacity:.2}.button--light.button--outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #8999b3;color:#283853;transition:border-color .12s}.button--light.button--outline[_ngcontent-%COMP%]:after{display:none}.button--light.button--outline[_ngcontent-%COMP%]:hover{background:#384c6c0d;border-color:#384c6c;color:#142136}.button--light.button--outline[_ngcontent-%COMP%]:hover:after{background-color:transparent}.button--light.button--selected[_ngcontent-%COMP%]{background-color:#e7eaee}.button--light.button--selected[_ngcontent-%COMP%]:hover:after{display:none}.button--light.button--text[_ngcontent-%COMP%]{color:#283853}.button--light.button--text[_ngcontent-%COMP%]:hover{color:#142136}.button--light.button--text[_ngcontent-%COMP%]:hover:after{display:none}.button--primary[_ngcontent-%COMP%]{background:#de3535;color:#fff}.button--primary[_ngcontent-%COMP%]:after{background:#f8f9fa}.button--primary[_ngcontent-%COMP%]:not([disabled]):hover:after{opacity:.1}.button--info[_ngcontent-%COMP%]{background:#3892dc;color:#fff}.button--info[_ngcontent-%COMP%]:after{background:#f8f9fa}.button--info[_ngcontent-%COMP%]:hover:after{opacity:.1}.button--selected[_ngcontent-%COMP%]{background-color:#2472e9}.button--disabled[_ngcontent-%COMP%]{opacity:.5}.button--circle[_ngcontent-%COMP%]{border-radius:50%}.button--circle.button--xsmall[_ngcontent-%COMP%]{width:24px}.button--circle.button--small[_ngcontent-%COMP%]{width:32px;padding:0 6px}.button--circle.button--medium[_ngcontent-%COMP%]{width:36px;padding:0 8px}.button--circle.button--large[_ngcontent-%COMP%]{width:48px}.button--circle[_ngcontent-%COMP%]:after{border-radius:50%}.button--rounded[_ngcontent-%COMP%]{border-radius:18px}.button--rounded[_ngcontent-%COMP%]:after{border-radius:18px}.summary-loader[_ngcontent-%COMP%]{border-color:transparent;background:none;border-width:0;outline:none;margin:0;pointer-events:all;background:#0006108c;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000;position:absolute;padding:36px;color:#fff;display:flex;justify-content:flex-start;align-items:flex-start;flex-direction:column;gap:8px}.summary-loader[_ngcontent-%COMP%]::-moz-focus-inner{border:0}.summary-loader[_ngcontent-%COMP%]:not([disabled]):hover{cursor:pointer}.summary-loader[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#000610b3}.summary-loader[_ngcontent-%COMP%]:hover   .summary-loader__cta[_ngcontent-%COMP%]{background-color:#2472e9;border-color:#2472e9}.summary-loader__title[_ngcontent-%COMP%]{font-size:24px;line-height:1.33em;font-weight:700}.summary-loader__sub-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;font-size:16px;line-height:1.25em;letter-spacing:.02em;text-align:left;gap:8px}.summary-loader__sub-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-child){padding-left:8px;border-left:2px solid #ffffff}.summary-loader__cta[_ngcontent-%COMP%]{width:220px;height:48px;border:1px solid #ffffff;border-radius:4px;margin-top:20px;font-weight:600px;font-size:16px;display:flex;justify-content:center;align-items:center;transition:all .25s ease-in-out}'],changeDetection:0})}return n})();function Z2(n,i){1&n&&e.nrm(0,"app-play-loader")}function eA(n,i){1&n&&e.nrm(0,"app-button-loader")}function tA(n,i){1&n&&e.nrm(0,"app-hand-loader")}function nA(n,i){1&n&&e.nrm(0,"app-summary-loader")}function iA(n,i){1&n&&e.nrm(0,"div",7)}class xr{constructor(i,t,o,s){this.changeRef=i,this.viewService=t,this.bookmarksService=o,this.imagesService=s,this.thumbnailURL="",this.interactionType=Ki}ngOnInit(){this.setThumbnailUrl()}handleClick(){this.viewService.toggleOnDemand(!1),this.viewService.toggleInteract(!1)}setThumbnailUrl(){this.contentType===Se.c.Bookmark?this.bookmarksService.getBookmarkModel(this.contentId).subscribe(i=>{this.thumbnailURL=i.thumbnail_url,this.changeRef.markForCheck()}):(this.thumbnailURL=this.imagesService.getIndexThumbnail(this.contentId),this.changeRef.markForCheck())}getPoweredByUrl(){return(typeof localBaseDirectory>"u"?"":localBaseDirectory)+"assets/images/powered-by-biodigital-logo.svg"}static#e=this.\u0275fac=function(t){return new(t||xr)(e.rXU(e.gRc),e.rXU(En),e.rXU(Bo),e.rXU($l))};static#t=this.\u0275cmp=e.VBU({type:xr,selectors:[["app-view-ondemand"]],inputs:{contentId:"contentId",contentType:"contentType"},decls:11,vars:10,consts:[[1,"ondemand",3,"click"],[1,"ondemand__image",3,"lazyLoad"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","ondemand__blank-overlay",4,"ngSwitchCase"],[1,"ondemand__logo"],[3,"src"],[1,"ondemand__blank-overlay"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.bIt("click",function(){return o.handleClick()}),e.nrm(1,"div",1),e.j41(2,"div",2),e.nI1(3,"async"),e.DNE(4,Z2,1,0,"app-play-loader",3)(5,eA,1,0,"app-button-loader",3)(6,tA,1,0,"app-hand-loader",3)(7,nA,1,0,"app-summary-loader",3)(8,iA,1,0,"div",4),e.k0s(),e.j41(9,"div",5),e.nrm(10,"img",6),e.k0s()()),2&t&&(e.R7$(),e.Y8G("lazyLoad",o.thumbnailURL),e.R7$(),e.Y8G("ngSwitch",e.bMT(3,8,o.interactType$)),e.R7$(2),e.Y8G("ngSwitchCase",o.interactionType.Play),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Button),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Hand),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.Summary),e.R7$(),e.Y8G("ngSwitchCase",o.interactionType.None),e.R7$(2),e.Y8G("src",o.getPoweredByUrl(),e.B4B))},dependencies:[J.ux,J.e1,So.Je,Zm,ef,tf,Ef,J.Jj],styles:[".ondemand__blank-overlay[_ngcontent-%COMP%]{background:#0003;display:flex;position:fixed;justify-content:center;align-items:center;inset:0;width:100%;height:100%;transition:background-color .25s,opacity .25s;z-index:10000}.ondemand__blank-overlay[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer;background:#0003}.ondemand__image[_ngcontent-%COMP%]{position:absolute;inset:0;background-size:cover;background-repeat:no-repeat;background-position:center center;filter:blur(6px);z-index:1000}.ondemand__logo[_ngcontent-%COMP%]{position:absolute;bottom:40px;justify-content:center;width:100%;z-index:20000;display:flex}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(de.getInteractType),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],xr.prototype,"interactType$",void 0);class jr{beforePrint(i){this.visible=!0,this.changeDetectorRef.markForCheck()}afterPrint(i){this.visible=!1,this.changeDetectorRef.markForCheck()}constructor(i,t){this.store=i,this.changeDetectorRef=t,this.ngUnsubscribe=new k.B,this.visible=!1}ngOnInit(){this.initImageUrlListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initImageUrlListener(){(0,cn.z)(this.storyChapters$,this.store.select(Go.K.getRegisteredThumbnails)).pipe((0,D.p)(([i,t])=>i.length>0&&t.size>0),(0,W.T)(([i,t])=>t.get(i[0].id).urls.large),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.imageUrl=i,this.changeDetectorRef.markForCheck()})}static#e=this.\u0275fac=function(t){return new(t||jr)(e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:jr,selectors:[["app-view-print"]],hostBindings:function(t,o){1&t&&e.bIt("beforeprint",function(){return o.beforePrint()},!1,e.tSv)("afterprint",function(){return o.afterPrint()},!1,e.tSv)},decls:3,vars:1,consts:[[1,"view-print"],["src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",1,"view-print__scrim"],[1,"view-print__image",3,"src"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.nrm(1,"img",1)(2,"img",2),e.k0s()),2&t&&(e.R7$(2),e.Y8G("src",o.imageUrl,e.B4B))},styles:[".view-print[_ngcontent-%COMP%]{background-color:#fff;display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10000;justify-content:space-around;margin:auto;margin-top:0!important}@media print{.view-print[_ngcontent-%COMP%]{display:flex}}.view-print__scrim[_ngcontent-%COMP%]{display:block;width:100%;height:100%;position:absolute;z-index:-1;inset:0}.view-print__image[_ngcontent-%COMP%]{display:block;flex:1 1 auto;object-fit:contain;margin:0 auto;z-index:1}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(me.N.getStoryChapters),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],jr.prototype,"storyChapters$",void 0);const aA=["circle"],rA=["progressCircle"],lA=["progressContainer"],cA=n=>({"view-progress--active":n}),dA=n=>({"view-progress__ring--pulse":n});function _A(n,i){if(1&n&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI("",t.percent,"%")}}let pA=(()=>{class n{get show(){return this._show}set show(t){setTimeout(()=>{this._show=t,this.changeDetectorRef.markForCheck()})}get percent(){return Math.floor(this._percent.value)}set percent(t){null!=t&&this._percent.next(t)}constructor(t,o){this.renderer=t,this.changeDetectorRef=o,this.ngUnsubscribe=new k.B,this.label=$localize`Loading...`,this._show=!1,this._percent=new Li.t(0)}ngOnInit(){this.initSizeObserver()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.updateDimensions(),this.initPercentObserver()}initPercentObserver(){this._percent.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.label=this.getLoadingLabel(this.percent),this.renderProgress(0===this.percent?100:this.percent),this.changeDetectorRef.markForCheck()})}initSizeObserver(){(0,Sn.R)(window,"resize").pipe((0,wn.B)(10),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateDimensions()})}calculateRadius(){return this.getCircleWidth()/2}getCircleWidth(){return this.circleRef.nativeElement.offsetWidth}getRadius(){return this.progressCircleRef.nativeElement.r.baseVal.value}getCircumference(){return 2*this.getRadius()*Math.PI}getOffset(t=100){const o=this.getCircumference();return o-t/100*o}renderProgress(t){t>=100&&(t=100);const o=this.getCircumference(),s=this.getOffset(t);this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${s}`)}getLoadingLabel(t){return 100===t?$localize`Launching...`:$localize`Loading...`}updateDimensions(){const t=this.calculateRadius();this.renderer.setAttribute(this.progressContainerRef.nativeElement,"width",""+2*t),this.renderer.setAttribute(this.progressContainerRef.nativeElement,"height",""+2*t),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"r",""+(t-6)),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cx",`${t}`),this.renderer.setAttribute(this.progressCircleRef.nativeElement,"cy",`${t}`);const o=this.getCircumference();this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDasharray",`${o} ${o}`),this.renderer.setStyle(this.progressCircleRef.nativeElement,"strokeDashoffset",`${o}`)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-progress"]],viewQuery:function(o,s){if(1&o&&(e.GBs(aA,7),e.GBs(rA,7),e.GBs(lA,7)),2&o){let a;e.mGM(a=e.lsd())&&(s.circleRef=a.first),e.mGM(a=e.lsd())&&(s.progressCircleRef=a.first),e.mGM(a=e.lsd())&&(s.progressContainerRef=a.first)}},inputs:{show:"show",percent:"percent"},decls:10,vars:10,consts:[["circle",""],["progressContainer",""],["progressCircle",""],["data-test","viewProgress","role","status","aria-live","polite",1,"view-progress",3,"ngClass"],["aria-hidden","true",1,"view-progress__circle"],[1,"view-progress__ring",3,"ngClass"],[1,"view-progress__ring-inner"],["class","view-progress__count",4,"ngIf"],[1,"view-progress__label"],[1,"view-progress__count"]],template:function(o,s){1&o&&(e.j41(0,"div",3)(1,"div",4,0),e.qSk(),e.j41(3,"svg",5,1),e.nrm(5,"circle",6,2),e.k0s(),e.DNE(7,_A,2,1,"div",7),e.joV(),e.j41(8,"div",8),e.EFF(9),e.k0s()()()),2&o&&(e.Y8G("ngClass",e.eq3(6,cA,s.show)),e.BMQ("aria-busy",s.show),e.R7$(),e.Y8G("@isOpen",s.show?"open":"closed"),e.R7$(2),e.Y8G("ngClass",e.eq3(8,dA,0===s.percent||100===s.percent)),e.R7$(4),e.Y8G("ngIf",s.percent>0&&s.percent<100),e.R7$(2),e.SpI(" ",s.label," "))},dependencies:[J.YU,J.bT],styles:[".view-progress[_ngcontent-%COMP%]{--circleSize: 35vw;pointer-events:none;position:absolute;display:flex;justify-content:center;align-items:center;inset:0;z-index:1000;transition:background-color .15s}@keyframes _ngcontent-%COMP%_progressPulse{0%{stroke-width:4}50%{stroke-width:1}to{stroke-width:4}}.view-progress--active[_ngcontent-%COMP%]{background-color:#0003}.view-progress__circle[_ngcontent-%COMP%]{transform:scale(0);width:var(--circleSize);height:var(--circleSize);border-radius:50%;background-color:#0c1726cc;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}.view-progress__count[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;color:#fff;font-weight:700}.view-progress__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;color:#fffc}.view-progress__ring[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:3;opacity:1;stroke-dashoffset:0;stroke-width:4;stroke:#fffc;fill:transparent;transform:rotate(-90deg)}.view-progress__ring--pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progressPulse ease-in-out infinite 2s}@media (min-width: 600px){.view-progress__circle[_ngcontent-%COMP%]{width:160px;height:160px}}"],data:{animation:[(0,xe.hZ)("isOpen",[(0,xe.wk)("open",(0,xe.iF)({transform:"scale(1)"})),(0,xe.wk)("closed",(0,xe.iF)({transform:"scale(0)"})),(0,xe.kY)("closed => open",[(0,xe.i0)("300ms ease-out")]),(0,xe.kY)("open => closed",[(0,xe.i0)("150ms ease-in")])])]},changeDetection:0})}return n})();var Cf=d(37737);let uA=(()=>{class n{constructor(){}onClick(t,o){o.select()}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appSelectOnFocus",""]],hostBindings:function(o,s){1&o&&e.bIt("click",function(r){return s.onClick(r,r.target)})}})}return n})();var hA=d(30356),Ua=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},xa=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const gA=["searchInput"],mA=["tabButton"],Tf=n=>({"view-search__action--selected":n});class ko{constructor(i,t,o){this.viewService=i,this.store=t,this.elementRef=o,this.application=xn.c,this.ngUnsubscribe=new k.B,this.themeEnum=Rm.P,this.treeSearchDisplayMode=uo.q}handleKeyPress(){this.viewService.elementHasFocus(this.elementRef.nativeElement)&&!this.viewService.isMaterialMenuOut()&&this.close()}ngOnInit(){this.initSearchForm()}ngAfterViewInit(){this.initDisplayModeSubscription()}initDisplayModeSubscription(){this.searchDisplayMode$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{setTimeout(()=>{this.searchInput.nativeElement.focus()})})}initSearchForm(){this.searchForm=new fe.gE({query:new fe.MJ("")});const i=this.searchForm.controls.query;this.searchQuery$=i.valueChanges.pipe((0,sa.Z)(i.value),(0,p.Q)(this.ngUnsubscribe))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}toggleDisplayMode(){let i=this.store.selectSnapshot(de.getSearchDisplayMode);i=i===uo.q.List?uo.q.Tree:uo.q.List,this.setDisplayMode(i)}setDisplayMode(i){this.store.dispatch(new E.SetSearchDisplayMode(i))}handleTreeButtonClick(){this.setDisplayMode(uo.q.Tree)}handleListButtonClick(){this.setDisplayMode(uo.q.List)}getActiveTab(){switch(this.store.selectSnapshot(de.getSearchDisplayMode)){case uo.q.List:return"searchTab";case uo.q.Tree:return"treeTab";default:return null}}shiftFocus(i,t){i.stopPropagation();const o=this._buttonRefs.toArray(),a=(o.findIndex(r=>r.nativeElement==document.activeElement)+t+o.length)%o.length;o[a].nativeElement.focus()}close(){this.searchForm.patchValue({query:""}),this.viewService.toggleSearch(null,!1)}static#e=this.\u0275fac=function(t){return new(t||ko)(e.rXU(En),e.rXU(l.il),e.rXU(e.aKT))};static#t=this.\u0275cmp=e.VBU({type:ko,selectors:[["app-view-search"]],viewQuery:function(t,o){if(1&t&&(e.GBs(gA,5),e.GBs(mA,5)),2&t){let s;e.mGM(s=e.lsd())&&(o.searchInput=s.first),e.mGM(s=e.lsd())&&(o._buttonRefs=s)}},hostBindings:function(t,o){1&t&&e.bIt("keydown.escape",function(){return o.handleKeyPress()},!1,e.EBC)},decls:31,vars:47,consts:()=>{let i,t,o,s;return i=$localize`:4c4305eb340456e2e50f1eb70a8061a4e63fc3521130690042989597231:Start typing the search term, then use tab to navigate the results`,t=$localize`:8f62b63665181ac3c3afe409d6d76530ef267bc11644955292665662544:Search for a structure`,o=$localize`:6490b3960cc7c4a789cdbd29575d93abad081e077906458871395232033:List`,s=$localize`:979a2479fa31a7c56e45cf33c4d29dbda0b3ace35139118152626940877:Tree`,[["searchInput",""],["tabButton",""],o,s,["role","dialog","cdkTrapFocus","",1,"view-search"],[1,"view-search__header",3,"formGroup"],[1,"view-search__input-row",3,"formGroup"],[1,"view-search__input-container"],["icon","search",1,"view-search__input-icon"],["appAutoFocus","","appSelectOnFocus","","type","search","aria-label",i,"placeholder",t,"formControlName","query",1,"view-search__input"],[1,"view-search__actions-row"],["role","tablist",1,"view-search__actions",3,"keydown.arrowleft","keydown.arrowright"],["type","button","role","tab","id","searchTab",1,"view-search__action",3,"click","keyup.space","ngClass"],["type","button","role","tab","id","treeTab",1,"view-search__action",3,"click","keyup.space","ngClass"],["role","tabpanel",1,"mt-3","view-search__body"],[3,"displayMode","theme","query","viewGraph","viewGraphMetadata","viewGraphRank","selectedChapter","layerOrderMode","showTreeNodeIds","showLatinLabel"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7),e.nrm(4,"app-icon",8)(5,"input",9,0),e.k0s()(),e.j41(7,"div",10)(8,"div",11),e.bIt("keydown.arrowleft",function(r){return e.eBV(s),e.Njj(o.shiftFocus(r,-1))})("keydown.arrowright",function(r){return e.eBV(s),e.Njj(o.shiftFocus(r,1))}),e.j41(9,"button",12,1),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleListButtonClick())})("keyup.space",function(){return e.eBV(s),e.Njj(o.handleListButtonClick())}),e.qex(14),e.pXf(15,2),e.bVm(),e.k0s(),e.j41(16,"button",13,1),e.nI1(18,"async"),e.nI1(19,"async"),e.nI1(20,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleTreeButtonClick())})("keyup.space",function(){return e.eBV(s),e.Njj(o.handleTreeButtonClick())}),e.qex(21),e.pXf(22,3),e.bVm(),e.k0s()()()(),e.j41(23,"div",14),e.nrm(24,"app-tree-search",15),e.nI1(25,"async"),e.nI1(26,"async"),e.nI1(27,"async"),e.nI1(28,"async"),e.nI1(29,"async"),e.nI1(30,"async"),e.k0s()()}2&t&&(e.R7$(),e.Y8G("formGroup",o.searchForm),e.R7$(),e.Y8G("formGroup",o.searchForm),e.R7$(7),e.Y8G("ngClass",e.eq3(43,Tf,e.bMT(11,19,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)),e.BMQ("aria-selected",e.bMT(12,21,o.searchDisplayMode$)===o.treeSearchDisplayMode.List)("tabIndex",e.bMT(13,23,o.searchDisplayMode$)===o.treeSearchDisplayMode.List?0:-1),e.R7$(7),e.Y8G("ngClass",e.eq3(45,Tf,e.bMT(18,25,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)),e.BMQ("aria-selected",e.bMT(19,27,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree)("tabIndex",e.bMT(20,29,o.searchDisplayMode$)===o.treeSearchDisplayMode.Tree?0:-1),e.R7$(7),e.BMQ("aria-labelledby",o.getActiveTab()),e.R7$(),e.Y8G("displayMode",e.bMT(25,31,o.searchDisplayMode$))("theme",o.themeEnum.Light)("query",e.bMT(26,33,o.searchQuery$))("viewGraph",e.bMT(27,35,o.treeGraph$))("viewGraphMetadata",e.bMT(28,37,o.viewGraphMetadata$))("viewGraphRank",e.bMT(29,39,o.viewGraphRank$))("selectedChapter",e.bMT(30,41,o.selectedChapter$))("layerOrderMode",!1)("showTreeNodeIds",!1)("showLatinLabel",!0))},dependencies:[mo.kB,J.YU,Cf.B,uA,fe.me,fe.BC,fe.cb,ut.R,fe.j4,fe.JD,hA.k,J.Jj],styles:[".view-search{display:flex;flex-direction:column;height:100%}@keyframes appear{0%{background-color:transparent}}.view-search__header{flex:0 0 auto;flex-direction:column;display:flex;animation:appear .25s ease-out}.view-search__actions-row{flex:0 0 auto;display:flex;align-items:center}.view-search__actions{display:flex;height:48px;flex:1;justify-content:space-between}.view-search__action{font-size:.625rem;line-height:.75rem;text-transform:uppercase;align-items:center;background:transparent;border:none;border-bottom:2px solid transparent;color:#384c6c;display:flex;flex-direction:column;flex:1;justify-content:flex-end;padding-bottom:8px;transition:all .3s ease-in-out;cursor:pointer}.view-search__action:hover:not(.view-search__action--selected){border-bottom-color:#f8f9fa}.view-search__action--selected{border-bottom-color:#2472e9;font-weight:600}.view-search__input-row{flex:0 0 auto;display:flex;padding:24px 0 0}.view-search__input-container{background-color:#fff;border:1px solid #8999b3;display:flex;flex-grow:1;border-radius:4px}.view-search__input-container:hover{border-color:#536788}.view-search__input-container:focus-within{outline:#2472e9 solid 2px!important;outline-offset:-2px}.view-search__input-icon{background:0 0;display:flex;align-items:center;justify-content:center;color:#536788;width:36px;height:36px;outline:0}.view-search__input{font-size:.875rem;line-height:1.25rem;font-weight:400;color:#0c1726;background:transparent;border:1px solid transparent;outline:none;flex:1 0 auto;padding:8px 12px 8px 0}.view-search__input::-ms-clear{display:none}.view-search__input::placeholder{color:#536788;opacity:1}.view-search__body{flex:1 1 100%}@media not all and (min-resolution: .001dpcm){@supports (-webkit-appearance: none){.view-search__input{font-size:16px;padding:4px 8px;width:0}}}\n"],encapsulation:2,changeDetection:0})}Ua([(0,l.l6)(ze.S.getViewGraph),xa("design:type",h.c)],ko.prototype,"viewGraph$",void 0),Ua([(0,l.l6)(ze.S.getTreeGraph),xa("design:type",h.c)],ko.prototype,"treeGraph$",void 0),Ua([(0,l.l6)(ze.S.getViewGraphMetadata),xa("design:type",h.c)],ko.prototype,"viewGraphMetadata$",void 0),Ua([(0,l.l6)(ze.S.getViewGraphRank),xa("design:type",h.c)],ko.prototype,"viewGraphRank$",void 0),Ua([(0,l.l6)(de.getSearchDisplayMode),xa("design:type",h.c)],ko.prototype,"searchDisplayMode$",void 0),Ua([(0,l.l6)(me.N.getSelectedChapter),xa("design:type",h.c)],ko.prototype,"selectedChapter$",void 0);const fA=["app-view-rounded-button",""];function SA(n,i){if(1&n&&e.nrm(0,"app-icon",3),2&n){const t=e.XpG();e.Y8G("icon",t.icon)}}let bA=(()=>{class n{constructor(){this.iconPlacement="left",this.compact=!1,this.buttonType="outline"}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["button","app-view-rounded-button",""]],inputs:{icon:"icon",iconPlacement:"iconPlacement",label:"label",compact:"compact",buttonType:"buttonType",shadow:"shadow"},attrs:fA,decls:4,vars:12,consts:[[1,"view-rounded-button"],["class","view-rounded-button__icon mx-1",3,"icon",4,"ngIf"],[1,"view-rounded-button__label","mx-1"],[1,"view-rounded-button__icon","mx-1",3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,SA,1,1,"app-icon",1),e.j41(2,"div",2),e.EFF(3),e.k0s()()),2&o&&(e.AVh("view-rounded-button--outline","outline"===s.buttonType)("view-rounded-button--solid","solid"===s.buttonType)("view-rounded-button--shadow",s.shadow)("view-rounded-button--compact",s.compact)("view-rounded-button--reverse","right"===s.iconPlacement),e.R7$(),e.Y8G("ngIf",s.icon),e.R7$(2),e.JRh(s.label))},dependencies:[J.bT,ut.R],styles:["button[app-view-rounded-button]{border-color:transparent;background:none;border-width:0;padding:0;outline:none;margin:0;pointer-events:all}button[app-view-rounded-button]:hover .view-rounded-button,button[app-view-rounded-button]:focus .view-rounded-button{color:#f8f9fa;border-color:#f8f9fa;background:#f8f9fa40}button[app-view-rounded-button]:hover .view-rounded-button--solid,button[app-view-rounded-button]:focus .view-rounded-button--solid{border-color:#f8f9fa40}.view-rounded-button{cursor:pointer;display:flex;flex-direction:row;align-items:center;justify-content:center;padding:12px 16px;border-style:solid;border-width:1px;border-radius:24px;color:#f8f9fa;border-color:#f8f9fa}.view-rounded-button__label{font-size:1rem;line-height:1.5rem}.view-rounded-button--solid{color:#070605;border-color:#070605;background:#f8f9fa}.view-rounded-button--shadow{box-shadow:0 0 8px #00000052}.view-rounded-button--reverse{flex-direction:row-reverse}.view-rounded-button--compact{padding:4px 8px}\n"],encapsulation:2,changeDetection:0})}return n})();var Ks=function(n){return n.CameraZoom="camera-zoom",n.CameraRotate="camera-rotate",n.CameraPan="camera-pan",n.NodeSelection="node-selection",n}(Ks||{});function Of(n,i,t=1e3,o=.001){return Kp(n).pipe((0,sa.Z)(i.getCameraZoom()),(0,W.T)(()=>i.getCameraZoom()),(0,ks.J)(),(0,W.T)(([s,a])=>a-s),(0,D.p)(s=>Math.abs(s)>o),(0,wn.B)(t))}function Mf(n,i,t=125){return Kp(n).pipe((0,sa.Z)(i.getLookDirection()),(0,W.T)(()=>i.getLookDirection()),(0,ks.J)(),(0,W.T)(([o,s])=>function MA(n,i){return wi.angle(n,i)>.001}(o,s)),(0,D.p)(o=>o),(0,wn.B)(t))}function If(n){return{camera:n.getCamera(),zoom:n.getCameraZoom()}}function Kp(n){return n.getEvent(Ct.X.CameraRested)}function Pf(n){const{eye:i,look:t}=n,o=wi.fromValues(i.x,i.y,i.z),s=wi.fromValues(t.x,t.y,t.z),a=wi.create();return wi.sub(a,o,s),a}var wf=d(68545);const PA=["*",[["","slide-footer",""]]],wA=["*","[slide-footer]"];function AA(n,i){if(1&n&&(e.j41(0,"h2",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.title," ")}}function RA(n,i){if(1&n&&e.nrm(0,"img",7),2&n){const t=e.XpG(2);e.Y8G("src",t.image,e.B4B)("alt",t.alt)}}function NA(n,i){if(1&n&&(e.j41(0,"div",1),e.DNE(1,AA,2,1,"h2",2),e.j41(2,"article",3),e.SdG(3),e.k0s(),e.DNE(4,RA,1,2,"img",4),e.j41(5,"div",5),e.SdG(6,1),e.k0s()()),2&n){const t=e.XpG();e.AVh("slide--expanded","expanded"===t.spacing),e.Y8G("@refresh",void 0),e.R7$(),e.Y8G("ngIf",t.title),e.R7$(3),e.Y8G("ngIf",t.image)}}let qp=(()=>{class n{set shown(t){this._shown=t,this.initTrigger(),this.changeRef.markForCheck()}get shown(){return this._shown}constructor(t,o,s,a,r,_){this.store=t,this.actions=o,this.engineService=s,this.cameraService=a,this.engineRendererService=r,this.changeRef=_,this.alt="",this.spacing="compact",this.exitEnabled=!0,this.triggerDelay=300,this.triggerComplete=new e.bkB,this._shown=!1,this.ngUnsubscribe=new k.B}ngOnInit(){}ngAfterViewInit(){this.initTrigger()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initTrigger(){if(this.ngUnsubscribe.next(),this.shown&&this.trigger){const t=this.resetCamera(),o=this.store.selectSnapshot(de.getCanTouch);(function yA(n,i,t,o,s,a){switch(n){case Ks.CameraZoom:return a?Of(t,o):function vA(n,i,t,o=1e3,s=.001){const a=t.getCanvas(),r=(0,Sn.R)(a,"wheel"),_=(0,Sn.R)(a,"touchmove").pipe((0,D.p)(P=>2===P.touches.length)),g=Of(n,i,o,s);return(0,ki.h)(r,_).pipe((0,Ln.Z)(()=>g))}(t,o,s);case Ks.CameraPan:return function TA(n,i,t,o=125){const s=t.getCanvas(),a=(0,Sn.R)(s,"mousemove").pipe((0,D.p)(g=>1===g.buttons&&g.shiftKey||2===g.buttons||4===g.buttons)),r=(0,Sn.R)(s,"touchmove").pipe((0,D.p)(g=>2===g.touches.length)),_=function CA(n,i,t=125){return Kp(n).pipe((0,sa.Z)(If(i)),(0,W.T)(()=>If(i)),(0,wn.B)(t),(0,ks.J)(),(0,W.T)(([o,s])=>function IA(n,i){const s=Pf(n.camera),a=Pf(i.camera),r=wi.create();wi.sub(r,s,a);const _=r.reduce((P,F)=>P+F),g=i.zoom-n.zoom;return(0!==g||0!==_)&&Math.abs(_)<1&&Math.abs(g)<.001}(o,s)),(0,D.p)(o=>o))}(n,i,o);return(0,ki.h)(a,r).pipe((0,Ln.Z)(()=>_))}(t,o,s);case Ks.CameraRotate:return a?Mf(t,o):function EA(n,i,t,o,s=1e3){const a=o.getCanvas(),r=(0,Sn.R)(a,"mousemove").pipe((0,D.p)(P=>1===P.buttons)),_=(0,Sn.R)(a,"touchmove").pipe((0,D.p)(P=>1===P.touches.length)),g=Mf(i,t,s);return(0,ki.h)(r,_).pipe((0,Ln.Z)(()=>g),(0,D.p)(()=>"rotate"===n.selectSnapshot(Ti.x.getPanMode)),(0,wn.B)(125))}(i,t,o,s);case Ks.NodeSelection:return function OA(n){return n.select(Rn.z.getCheckedNodes).pipe((0,ks.J)(),(0,D.p)(([,i])=>i.length>0))}(i)}})(this.trigger,this.store,this.engineService,this.cameraService,this.engineRendererService,o).pipe((0,wf.U)(t),(0,ws.c)(this.triggerDelay),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.triggerComplete.next()})}}resetCamera(){const o=this.store.selectSnapshot(me.N.getSelectedChapter)?.camera?.location;return(0,u.isNil)(o)?(0,Rt.of)(void 0):this.store.dispatch(new Ut.Ih(o,!0)).pipe((0,Ln.Z)(()=>this.actions.pipe((0,l.xi)(Ut.Nz))),(0,qt.s)(1))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(l.En),e.rXU(v.y),e.rXU(go.j),e.rXU(Er.z),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-slide"]],inputs:{title:"title",image:"image",alt:"alt",spacing:"spacing",shown:"shown",exitEnabled:"exitEnabled",trigger:"trigger",triggerDelay:"triggerDelay"},outputs:{triggerComplete:"triggerComplete"},ngContentSelectors:wA,decls:1,vars:1,consts:[["class","slide",3,"slide--expanded",4,"ngIf"],[1,"slide"],["class","slide__title",4,"ngIf"],[1,"slide__content"],["class","slide__image",3,"src","alt",4,"ngIf"],[1,"slide__footer"],[1,"slide__title"],[1,"slide__image",3,"src","alt"]],template:function(o,s){1&o&&(e.NAR(PA),e.DNE(0,NA,7,5,"div",0)),2&o&&e.Y8G("ngIf",s.shown)},dependencies:[J.bT],styles:[".slide[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;max-width:500px}.slide__title[_ngcontent-%COMP%]{margin-bottom:16px;font-weight:600;font-size:1.125rem;line-height:1.75rem}.slide__content[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1rem;line-height:1.5rem;line-height:1.5em;max-width:100%}.slide__image[_ngcontent-%COMP%]{margin:24px auto;max-width:100%;min-height:1px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500;display:flex;flex-direction:row;align-items:center;justify-content:center;max-width:100%}.slide--expanded[_ngcontent-%COMP%]   .slide__title[_ngcontent-%COMP%]{margin:16px}.slide--expanded[_ngcontent-%COMP%]   .slide__content[_ngcontent-%COMP%]{margin:48px}.slide--expanded[_ngcontent-%COMP%]   .slide__image[_ngcontent-%COMP%]{margin:48px auto}@media (max-width: 768px){.slide[_ngcontent-%COMP%]{max-width:400px}.slide__image[_ngcontent-%COMP%]{margin:16px}.slide__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem;margin-bottom:12px}.slide__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:12px}.slide__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 640px){.slide[_ngcontent-%COMP%]{max-width:320px}}@media (max-width: 480px){.slide[_ngcontent-%COMP%]{max-width:240px}.slide__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;margin-bottom:8px}.slide__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin-bottom:8px}.slide__image[_ngcontent-%COMP%]{margin:4px auto}.slide__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}@media (max-width: 320px){.slide[_ngcontent-%COMP%]{max-width:160px}}"],data:{animation:[(0,xe.hZ)("refresh",[(0,xe.kY)(":enter",[(0,xe.sM)(Hs.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0})}return n})();const kA=["*"];function DA(n,i){1&n&&(e.j41(0,"div",1)(1,"div",2),e.SdG(2),e.k0s()())}let Jp=(()=>{class n{set shown(t){this._shown=t,this.setSelectedSlide(0)}get shown(){return this._shown}constructor(t){this.changeRef=t,this.selectedSlideIndex=0,this._shown=!1,this.ngUnsubscribe=new k.B}ngOnInit(){}ngAfterViewInit(){this.initListeners(),setTimeout(()=>{this.setSlideShown(this.selectedSlideIndex)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}goToPrevSlide(){this.setSelectedSlide(this.selectedSlideIndex-1)}goToNextSlide(){this.setSelectedSlide(this.selectedSlideIndex+1)}setSelectedSlide(t){if(this.selectedSlideIndex=t,this.slides){const s=Math.max(0,Math.min(this.slides.length-1,t));this.selectedSlideIndex=s}this.setSlideShown(this.selectedSlideIndex)}initListeners(){(0,ki.h)(...this.slides.map(t=>t.triggerComplete.asObservable())).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.goToNextSlide()})}setSlideShown(t){this.slides&&this.slides.forEach((o,s)=>{o.shown=s===t}),this.changeRef.markForCheck()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-page"]],contentQueries:function(o,s,a){if(1&o&&e.wni(a,qp,4),2&o){let r;e.mGM(r=e.lsd())&&(s.slides=r)}},inputs:{shown:"shown"},ngContentSelectors:kA,decls:1,vars:1,consts:[["class","page",4,"ngIf"],[1,"page"],[1,"page__contents"]],template:function(o,s){1&o&&(e.NAR(),e.DNE(0,DA,3,0,"div",0)),2&o&&e.Y8G("ngIf",s.shown)},dependencies:[J.bT],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.page__contents[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}@media (max-width: 768px){.page__contents[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}}@media (max-width: 480px){.page__contents[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}}"],changeDetection:0})}return n})();const xA=["*"],jA=n=>({"pages--opaquer":n});function VA(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",1)(1,"button",2),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.nrm(2,"app-icon",3),e.k0s(),e.j41(3,"div",4),e.SdG(4),e.k0s(),e.j41(5,"div",5)(6,"button",6),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handlePrevClick())}),e.nrm(7,"app-icon",7),e.k0s(),e.j41(8,"div",8),e.EFF(9),e.k0s(),e.j41(10,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleNextClick())}),e.nrm(11,"app-icon",10),e.k0s()()()}if(2&n){const t=i.$implicit;e.Y8G("ngClass",e.eq3(7,jA,t.pageIndex==t.pageSize-1)),e.R7$(6),e.Y8G("disabled",t.pageIndex<1),e.BMQ("tabindex",t.pageIndex<1?-1:0),e.R7$(3),e.Lme("",t.pageIndex+1," / ",t.pageSize,""),e.R7$(),e.Y8G("disabled",t.pageIndex===t.pageSize-1),e.BMQ("tabindex",t.pageIndex===t.pageSize-1?-1:0)}}class ja{constructor(i,t){this.store=i,this.changeRef=t,this.ngUnsubscribe=new k.B}ngOnInit(){}ngAfterViewInit(){this.tutorial$.pipe((0,p.Q)(this.ngUnsubscribe),(0,D.p)(i=>null!=i&&i.pageSize>0)).subscribe(i=>{this.handleTutorialPages(i)}),this.store.dispatch(new E.SetTutorial({pageSize:this.pages.length,pageIndex:0}))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePrevClick(){this.store.dispatch(new E.TutorialPrevious)}handleNextClick(){this.store.dispatch(new E.TutorialNext)}handleExitClick(){this.store.dispatch(new E.ToggleWindow(_n.Tutorial,!1))}handleTutorialPages(i){this.pages.forEach((t,o)=>{t.shown=o===i.pageIndex}),this.changeRef.markForCheck()}static#e=this.\u0275fac=function(t){return new(t||ja)(e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:ja,selectors:[["app-view-tour-pages"]],contentQueries:function(t,o,s){if(1&t&&e.wni(s,Jp,4),2&t){let a;e.mGM(a=e.lsd())&&(o.pages=a)}},ngContentSelectors:xA,decls:2,vars:3,consts:()=>{let i,t,o,s,a,r;return i=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,t=$localize`:8a8cd4cbe664d8683580bdf9b28edb0bdac8acf9227449910725820734:Exit Tutorial`,o=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,s=$localize`:06547848178fce0f19047d0d07c2df326650718b2765563396217571020:Previous Tutorial Step`,a=$localize`:a165a2589725552dea3ac6e98be73c72f5ae03a01978646816781669814:Next Tutorial Step`,r=$localize`:4ff3dad8ce52dc71e7b3158b1b20b5039959dabf2249392320351386178: Next Tutorial Step`,[["class","pages",3,"ngClass",4,"ngIf"],[1,"pages",3,"ngClass"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","buttonSize","small","aria-label",i,"matTooltip",t,"matTooltipPosition","right","data-test","tutorialExitButton",1,"pages__close",3,"click"],["icon","times"],[1,"pages__contents"],[1,"pages__footer"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",o,"matTooltip",s,"matTooltipPosition","left","data-test","tutorialPreviousButton",1,"pages__nav",3,"click","disabled"],["icon","angle-left","appLogicalDir",""],[1,"mx-8"],["app-view-button","","buttonShape","rounded","buttonTheme","dark-gray-fill","aria-label",a,"matTooltip",r,"matTooltipPosition","right","data-test","tutorialNextButton",1,"pages__nav",3,"click","disabled"],["icon","angle-right","appLogicalDir",""]]},template:function(t,o){1&t&&(e.NAR(),e.DNE(0,VA,12,9,"div",0),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,o.tutorial$))},dependencies:[Qt.ri,J.YU,J.bT,Ao.e,ut.R,Kt.oV,J.Jj],styles:[".pages[_ngcontent-%COMP%]{pointer-events:none;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:20px auto 48px;max-width:600px;position:relative;background:#0c1726cc;border-radius:16px;padding:24px 28px 20px}.pages--opaquer[_ngcontent-%COMP%]{background:#0c1726e6}.pages__footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;font-size:1rem;line-height:1.5rem;font-weight:500}.pages__close[_ngcontent-%COMP%]{z-index:1;position:absolute;top:8px;inset-inline-end:8px;align-self:flex-end;display:flex;align-items:center;justify-content:center}.pages__contents[_ngcontent-%COMP%]{padding:16px 0}@media (max-width: 768px){.pages[_ngcontent-%COMP%]{margin:16px 12% 48px;border-radius:10px;padding:18px 22px 14px}.pages__contents[_ngcontent-%COMP%]{padding:24px 0}.pages__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem}}@media (max-width: 480px){.pages[_ngcontent-%COMP%]{margin:12px 10% 48px;border-radius:8px;padding:24px 20px 12px}.pages__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.pages__nav[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(de.getTutorial),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],ja.prototype,"tutorial$",void 0);let Af=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-success"]],inputs:{inline:"inline"},decls:2,vars:2,consts:[[1,"view-tour-success"],["icon","check",1,"view-tour-success__icon"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.nrm(1,"app-icon",1),e.k0s()),2&o&&e.AVh("view-tour-success--inline",s.inline)},dependencies:[ut.R],styles:[".view-tour-success{width:52px;height:52px;display:flex;background-color:#1bbc66;border-radius:50%;justify-content:center;align-items:center}.view-tour-success__icon{font-size:2.25rem;line-height:2.5rem;color:#fff}.view-tour-success--inline{display:inline-flex;width:32px;height:32px}.view-tour-success--inline .view-tour-success__icon{font-size:1.125rem;line-height:1.75rem}@media (max-width: 768px){.view-tour-success{width:36px;height:36px}.view-tour-success__icon{font-size:1.25rem;line-height:1.75rem}.view-tour-success--inline{display:inline-flex;width:24px;height:24px}.view-tour-success--inline .view-tour-success__icon{font-size:.75rem;line-height:1rem}}\n"],encapsulation:2,changeDetection:0})}return n})();function FA(n,i){if(1&n&&e.nrm(0,"app-icon",5),2&n){const t=e.XpG(2);e.Y8G("icon",t.icon)}}function GA(n,i){if(1&n&&(e.j41(0,"span",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.JRh(t.label)}}function $A(n,i){if(1&n&&(e.qex(0),e.DNE(1,FA,1,1,"app-icon",3)(2,GA,2,1,"span",4),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.icon),e.R7$(),e.Y8G("ngIf",t.icon)}}function BA(n,i){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.label," ")}}let zA=(()=>{class n{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-tip-button"]],inputs:{label:"label",icon:"icon"},decls:3,vars:2,consts:[[1,"view-tour-tip-button","my-1","mx-1",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"icon",4,"ngIf"],["class","sr-only",4,"ngIf"],[3,"icon"],[1,"sr-only"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,$A,3,2,"ng-container",1)(2,BA,2,1,"span",2),e.k0s()),2&o&&(e.Y8G("ngSwitch",!!s.icon),e.R7$(),e.Y8G("ngSwitchCase",!0))},dependencies:[J.bT,J.ux,J.e1,J.fG,ut.R],styles:[".view-tour-tip-button{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;color:#0c1726;background-color:#fff;border-radius:2px;font-weight:700;padding:4px;width:24px;height:24px}@media (max-width: 768px){.view-tour-tip-button{width:20px;height:20px}}\n"],encapsulation:2,changeDetection:0})}return n})();function HA(n,i){1&n&&(e.qex(0),e.pXf(1,14),e.bVm())}function QA(n,i){1&n&&(e.qex(0),e.pXf(1,15),e.bVm())}class Vr{constructor(i){this.viewService=i,this.triggers=Ks,this.videoTutorialSources=Up}ngOnInit(){this.captureScroll$=this.scrollMode$.pipe((0,W.T)(i=>i===Wo.M.Capture))}handleStartClick(){this.viewService.toggleTutorial(!1)}static#e=this.\u0275fac=function(t){return new(t||Vr)(e.rXU(En))};static#t=this.\u0275cmp=e.VBU({type:Vr,selectors:[["app-view-tour-desktop"]],decls:65,vars:12,consts:()=>{let i,t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt,$t,hn,rn;return i=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,t=$localize`:129a2224e1f9d19eb5e11e2a07fe10a7855564848515973702474791807:up`,o=$localize`:b5fbc7c7f007dd53b2318525bb7ff8b0376c9e371301930865667956193:down`,s=$localize`:478c0bf6552f7226e27bb5b57b8209a040ded2c67449548947549758066:left`,a=$localize`:4a379a71f932b31ecae93a9232f818eef02ece106520868693399199322:right`,r=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,_=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,g=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,P=$localize`:0cfd714a023e7dddfab02ebbaffddf8b3b7dd9881831081178261551807: Click and drag the model to change the viewing angle. `,F=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,ee=$localize`:c71aa1ed54f03bfd28210dccb6f900b4962ea522114624992018654005:You can also use the arrow keys`,le=$localize`:8b5e6e1e74d302bbdd638500b071bb0859f3ab405411319251728756176:to rotate.`,he=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,ue=$localize`:a6a4d760af95bd17149d92758784333d288f02a47584501271397744885:You can also use`,ye=$localize`:5be36bcbbbee99ffb6ea5f40636c92334e7c3d374307223492407933970:to zoom out.`,Ge=$localize`:197d3f7bb3c4bdbe8c11eb56a4cebb7bc9b5880c2383075435551442269: Hold the shift key and drag to move the model's position. `,Ve=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,it=$localize`:7e72d30152be758594ce5a0257a4fc0ee19f94d54528617795430260542:You can also use the`,ot=$localize`:a6e5a9592abcd7af3cf72b5d4ba3a12a124208c79056703775803925947:keys to pan.`,_t=$localize`:b9964d82e0ae5a31d53f6aef4fdaa996d15dce161011814326808580654: Click on an individual part of the model to highlight anatomy. `,xt=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,$t=$localize`:2949e52a456470cb255048c7e1e40b496934ed32962414889722492464: Double-click to zoom in on specific structures.`,hn=$localize`:c4673f13cb56aec8867cfdce431a5c1f283895f66288669230125842319: Hold the control key and scroll up and down to zoom in or out. `,rn=$localize`:dfdbec5eab67c07d82c394952e19cca3652719ea6750824053364243866: Scroll up and down to zoom in or out. `,[P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt,$t,hn,rn,["title",i,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"],["icon","caret-up","label",t],["icon","caret-down","label",o],["appLogicalDir","","icon","caret-left","label",s],["appLogicalDir","","icon","caret-right","label",a],["title",r,3,"trigger","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["label","+"],["label","-"],["title",_,3,"trigger"],["label","W"],["label","A"],["label","S"],["label","D"],["title",g,3,"trigger"]]},template:function(t,o){1&t&&(e.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",16),e.pXf(3,0),e.k0s(),e.j41(4,"app-view-tour-slide")(5,"div",17)(6,"div"),e.nrm(7,"app-view-tour-success",18),e.j41(8,"strong",19),e.pXf(9,1),e.k0s(),e.qex(10),e.pXf(11,2),e.bVm(),e.nrm(12,"app-view-tour-tip-button",20)(13,"app-view-tour-tip-button",21)(14,"app-view-tour-tip-button",22)(15,"app-view-tour-tip-button",23),e.qex(16),e.pXf(17,3),e.bVm(),e.k0s()()()(),e.j41(18,"app-view-tour-page")(19,"app-view-tour-slide",24),e.nI1(20,"async"),e.DNE(21,HA,2,0,"ng-container",25)(22,QA,2,0,"ng-container",26),e.k0s(),e.j41(23,"app-view-tour-slide")(24,"div",17)(25,"div"),e.nrm(26,"app-view-tour-success",18),e.j41(27,"strong",19),e.pXf(28,4),e.k0s(),e.qex(29),e.pXf(30,5),e.bVm(),e.nrm(31,"app-view-tour-tip-button",27),e.eu8(32),e.EFF(33,"to zoom in and "),e.nrm(34,"app-view-tour-tip-button",28),e.qex(35),e.pXf(36,6),e.bVm(),e.k0s()()()(),e.j41(37,"app-view-tour-page")(38,"app-view-tour-slide",29),e.pXf(39,7),e.k0s(),e.j41(40,"app-view-tour-slide")(41,"div",17)(42,"div"),e.nrm(43,"app-view-tour-success",18),e.j41(44,"strong",19),e.pXf(45,8),e.k0s(),e.qex(46),e.pXf(47,9),e.bVm(),e.nrm(48,"app-view-tour-tip-button",30)(49,"app-view-tour-tip-button",31)(50,"app-view-tour-tip-button",32)(51,"app-view-tour-tip-button",33),e.qex(52),e.pXf(53,10),e.bVm(),e.k0s()()()(),e.j41(54,"app-view-tour-page")(55,"app-view-tour-slide",34),e.pXf(56,11),e.k0s(),e.j41(57,"app-view-tour-slide")(58,"div",17)(59,"div"),e.nrm(60,"app-view-tour-success",18),e.j41(61,"strong",19),e.pXf(62,12),e.k0s(),e.qex(63),e.pXf(64,13),e.bVm(),e.k0s()()()()()),2&t&&(e.R7$(2),e.Y8G("trigger",o.triggers.CameraRotate),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.CameraZoom)("ngSwitch",e.bMT(20,10,o.captureScroll$)),e.R7$(2),e.Y8G("ngSwitchCase",!1),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.CameraPan),e.R7$(5),e.Y8G("inline",!0),e.R7$(12),e.Y8G("trigger",o.triggers.NodeSelection),e.R7$(5),e.Y8G("inline",!0))},dependencies:[J.ux,J.e1,J.fG,Ao.e,Jp,ja,qp,Af,zA,J.Jj],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(ze.S.getScrollMode),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Vr.prototype,"scrollMode$",void 0);let YA=(()=>{class n{constructor(t){this.viewService=t,this.triggers=Ks,this.videoTutorialSources=Up}handleStartClick(){this.viewService.toggleTutorial(!1)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(En))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-tour-mobile"]],decls:27,vars:5,consts:()=>{let t,o,s,a,r,_,g,P,F,ee;return t=$localize`:20058274f3bdffd2cf7023d350d44170f6ff7a121050269006235116171:Rotate`,o=$localize`:e76cd6dbaa898f85934f363fef654b29e44d004b6421460271971606186:Zoom`,s=$localize`:7cd14ceae63b4aba71ab7935638f5d3b799f4f4b9128067536654850026:Pan`,a=$localize`:eb55d5cbcf6e2a42868bede1caa64be0f1f1e4355702628055979003671:Explore the Anatomy`,r=$localize`:40fea76a56245ebbead6177bc3d17ae5ec40a1652280443087469838323: Tap and drag with one finger to change the viewing angle. `,_=$localize`:8427d89e9a09d73465919535774a238eb9d421db2729825529782328186: Pinch with two fingers to zoom in or out. `,g=$localize`:14defb0441cab2a9b33483931a54f51867c652e96006726473932808920: Use two fingers to adjust the model's position. `,P=$localize`:1a9195f9922538bdf4a4aff64ca479c285355cfe7928756420516267887: Tap on an individual part of the model to highlight anatomy. `,F=$localize`:50f7d911f4c3caa51c033edb36261331cb756e7f7923762190272525956:Tip:`,ee=$localize`:646945605f8dced01098f9c393573c2a9b46a8425072295053569562541:Double-tap to zoom in on specific structures.`,[r,_,g,P,F,ee,["title",t,3,"trigger"],["title",o,3,"trigger"],["title",s,3,"trigger"],["title",a,3,"trigger"],[1,"flex","justify-start","items-center"],[1,"mr-2",3,"inline"],[1,"font-semibold"]]},template:function(o,s){1&o&&(e.j41(0,"app-view-tour-pages")(1,"app-view-tour-page")(2,"app-view-tour-slide",6),e.pXf(3,0),e.k0s(),e.j41(4,"app-view-tour-slide"),e.nrm(5,"app-view-tour-success"),e.k0s()(),e.j41(6,"app-view-tour-page")(7,"app-view-tour-slide",7),e.pXf(8,1),e.k0s(),e.j41(9,"app-view-tour-slide"),e.nrm(10,"app-view-tour-success"),e.k0s()(),e.j41(11,"app-view-tour-page")(12,"app-view-tour-slide",8),e.pXf(13,2),e.k0s(),e.j41(14,"app-view-tour-slide"),e.nrm(15,"app-view-tour-success"),e.k0s()(),e.j41(16,"app-view-tour-page")(17,"app-view-tour-slide",9),e.pXf(18,3),e.k0s(),e.j41(19,"app-view-tour-slide")(20,"div",10)(21,"div"),e.nrm(22,"app-view-tour-success",11),e.j41(23,"strong",12),e.pXf(24,4),e.k0s(),e.qex(25),e.pXf(26,5),e.bVm(),e.k0s()()()()()),2&o&&(e.R7$(2),e.Y8G("trigger","camera-rotate"),e.R7$(5),e.Y8G("trigger",s.triggers.CameraZoom),e.R7$(5),e.Y8G("trigger",s.triggers.CameraPan),e.R7$(5),e.Y8G("trigger",s.triggers.NodeSelection),e.R7$(5),e.Y8G("inline",!0))},dependencies:[Jp,ja,qp,Af],changeDetection:0})}return n})();var Rf=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Nf=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};function KA(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",6)(1,"h2",7),e.pXf(2,1),e.k0s(),e.j41(3,"p",8),e.qex(4),e.pXf(5,2),e.bVm(),e.nrm(6,"button",9),e.nI1(7,"async"),e.nI1(8,"async"),e.j41(9,"mat-menu",null,0)(11,"button",10),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleSelectInputModeClick(s.inputModes.Mouse))}),e.EFF(12),e.k0s(),e.j41(13,"button",10),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleSelectInputModeClick(s.inputModes.Touch))}),e.EFF(14),e.k0s()()(),e.j41(15,"div",11)(16,"button",12),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.k0s(),e.j41(17,"button",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleStartClick())}),e.k0s()()()}if(2&n){const t=e.sdS(10),o=e.XpG();e.R7$(6),e.Y8G("compact",!0)("label",o.inputModesText[e.bMT(7,6,o.inputMode$)])("matMenuTriggerFor",t),e.BMQ("aria-label",o.inputModesText[e.bMT(8,8,o.inputMode$)]),e.R7$(6),e.SpI(" ",o.inputModesText[o.inputModes.Mouse]," "),e.R7$(2),e.SpI(" ",o.inputModesText[o.inputModes.Touch]," ")}}function qA(n,i){1&n&&e.nrm(0,"app-view-tour-mobile")}function JA(n,i){1&n&&e.nrm(0,"app-view-tour-desktop")}function ZA(n,i){if(1&n&&(e.j41(0,"div",14),e.nI1(1,"async"),e.DNE(2,qA,1,0,"app-view-tour-mobile",15)(3,JA,1,0,"app-view-tour-desktop",16),e.k0s()),2&n){const t=e.XpG();e.Y8G("ngSwitch",e.bMT(1,2,t.inputMode$)),e.R7$(2),e.Y8G("ngSwitchCase",t.inputModes.Touch)}}class Va{constructor(i,t,o){this.store=i,this.viewService=t,this.storageService=o,this.inputModes=Os,this.inputModesText={[Os.Mouse]:$localize`mouse, trackpad, or keyboard`,[Os.Touch]:$localize`touchscreen`},this.tourStarted=!1,this.tourEnded=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.initListeners(),this.store.dispatch(new E.TutorialSeen(!0))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.tutorial$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({pageIndex:i,pageSize:t})=>{this.tourStarted=i>-1,this.tourEnded=i===t-1}),(0,Sn.R)(window,"keyup").pipe((0,D.p)(i=>"Escape"===i.key),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.exit()})}handleExitClick(){this.exit()}handleStartClick(){this.store.dispatch(new E.StartTutorial(!1))}handleSelectInputModeClick(i){this.store.dispatch(new E.SetInputMode(i))}exit(){this.viewService.toggleTutorial(!1)}static#e=this.\u0275fac=function(t){return new(t||Va)(e.rXU(l.il),e.rXU(En),e.rXU(It.n$))};static#t=this.\u0275cmp=e.VBU({type:Va,selectors:[["app-view-tour"]],decls:3,vars:5,consts:()=>{let i,t,o,s,a,r,_;return i=$localize`:b6d518ec10f5635af884c06c0ee31f0d4589e8a2580493549510248593:Getting Started Tutorial`,t=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,o=$localize`:329b57635013c51987214c5913ca7092ec9a41be6199587308275891980:No, Thanks.`,s=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,a=$localize`:6aec50f9ac99e43913886a863d03bbd06133aa94188529236849865957:Start Tutorial`,r=$localize`:486c6addfeb93356cab8bbb37310c8f61534e1f29156212170228959929:Getting Started`,_=$localize`:80ef270109b95917aeaa29935ed0aeb1b53376275246430719012249797:Welcome! This tutorial will teach you how to navigate and explore in 3D using your`,[["inputSelectionMenu","matMenu"],r,_,["role","dialog","aria-label",i,"cdkTrapFocus","",1,"tour"],["class","tour__intro",4,"ngIf"],["class","tour__contents",3,"ngSwitch",4,"ngIf"],[1,"tour__intro"],[1,"tour__title"],[1,"tour__welcome"],["app-view-rounded-button","","buttonType","outline","icon","chevron-down","iconPlacement","right",1,"tour__input-selection","text-small",3,"compact","label","matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"tour__footer"],["app-view-rounded-button","","buttonType","outline","label",t,"aria-label",o,"data-test","tutorialExitButton",1,"mr-3",3,"click"],["app-view-rounded-button","","buttonType","solid","label",s,"aria-label",a,"data-test","tutorialStartButton",1,"ml-3",3,"click"],[1,"tour__contents",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]]},template:function(t,o){1&t&&(e.j41(0,"div",3),e.DNE(1,KA,18,10,"div",4)(2,ZA,4,4,"div",5),e.k0s()),2&t&&(e.AVh("tour--started",o.tourStarted),e.Y8G("@refresh",void 0),e.R7$(),e.Y8G("ngIf",!o.tourStarted),e.R7$(),e.Y8G("ngIf",o.tourStarted))},dependencies:[mo.kB,J.bT,J.ux,J.e1,J.fG,un.kk,un.fb,un.Cp,bA,Vr,YA,J.Jj],styles:[".tour[_ngcontent-%COMP%]{color:#fff;position:fixed;inset:0;z-index:100;pointer-events:none;display:flex;flex-direction:column;align-items:center;overflow:auto}.tour__title[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}.tour__welcome[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;margin:16px auto 32px}.tour__intro[_ngcontent-%COMP%]{background:#0c1726e6;border-radius:16px;margin:auto;padding:28px 32px;text-align:center;max-width:560px}.tour__input-selection[_ngcontent-%COMP%]{margin:0 8px;vertical-align:middle}.tour__header[_ngcontent-%COMP%]{flex:none;align-self:flex-end;justify-self:flex-start;margin:24px}.tour__contents[_ngcontent-%COMP%]{flex:auto;display:flex;flex-direction:column;justify-content:flex-end;width:100%}.tour__footer[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;display:flex;flex-direction:row;align-items:center;justify-content:center}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.875rem;line-height:2.25rem;cursor:pointer}.tour--ended[_ngcontent-%COMP%]   .tour__contents[_ngcontent-%COMP%]{justify-content:center}@media (max-width: 768px){.tour__intro[_ngcontent-%COMP%]{border-radius:12px;padding:20px 24px;margin:auto 12%;max-width:100%}.tour__intro__title[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;max-width:80%}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.875rem;line-height:1.25rem}.tour__footer[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}}@media (max-width: 480px){.tour__intro[_ngcontent-%COMP%]{border-radius:8px;padding:16px 20px;margin:auto 10%}.tour__intro__title[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.tour__intro__content[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;margin:12px auto 16px}.tour__header[_ngcontent-%COMP%]{margin:12px;font-size:.75rem;line-height:1rem}.tour__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.tour__nav-arrow[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}}"],data:{animation:[(0,xe.hZ)("refresh",[(0,xe.kY)(":enter",[(0,xe.sM)(Hs.slideTransition,{params:{duration:500,from:100,to:0}})])])]},changeDetection:0})}Rf([(0,l.l6)(de.getTutorial),Nf("design:type",h.c)],Va.prototype,"tutorial$",void 0),Rf([(0,l.l6)(de.getInputMode),Nf("design:type",h.c)],Va.prototype,"inputMode$",void 0);var Zp=d(42482),Fr=d(4951);const eR=["textRef"],tR=n=>({"whiteboard-label__label--active":n});function nR(n,i){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",4),e.bIt("cdkDragMoved",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.dragMoved(s,"corner1"))}),e.k0s(),e.j41(2,"div",5),e.bIt("cdkDragMoved",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.dragMoved(s,"corner2"))}),e.k0s(),e.j41(3,"div",6),e.bIt("cdkDragMoved",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.dragMoved(s,"corner3"))}),e.k0s(),e.j41(4,"div",7),e.bIt("cdkDragMoved",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.dragMoved(s,"corner4"))}),e.k0s(),e.j41(5,"div",8),e.bIt("cdkDragMoved",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.translateHandleMoved(s))}),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("cdkDragFreeDragPosition",t.dragHandles.corner1),e.R7$(),e.Y8G("cdkDragFreeDragPosition",t.dragHandles.corner2),e.R7$(),e.Y8G("cdkDragFreeDragPosition",t.dragHandles.corner3),e.R7$(),e.Y8G("cdkDragFreeDragPosition",t.dragHandles.corner4),e.R7$(),e.Y8G("cdkDragFreeDragPosition",t.dragHandles.translate)}}let iR=(()=>{class n{get id(){return this._id}set id(t){this._id=t,this.initialized=!1}set color(t){this.renderer.setStyle(this.textRef.nativeElement,"color",t)}set size(t){this.renderer.setStyle(this.textRef.nativeElement,"font-size",`${t}px`)}constructor(t,o,s,a,r){this.store=t,this.changeDetectorRef=o,this.renderer=s,this.actions=a,this.localeId=r,this.active=!0,this.initialized=!1,this.labelActive=new e.bkB,this.labelEmpty=new e.bkB,this.dragHandles={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.handleCoords={translate:{x:0,y:0},corner1:{x:0,y:0},corner2:{x:0,y:0},corner3:{x:0,y:0},corner4:{x:0,y:0}},this.textareaTransform={x:0,y:0,width:110,height:40},this.ngUnsubscribe=new k.B,this.handleDocumentBackspace=_=>{const{activeElement:g}=this.textRef.nativeElement;"Backspace"===_.key&&this.active&&!g&&this.deleteLabel()},this.handleTextboxMouseDown=_=>{this.active=!0,this.labelActive.next(this.id),this.refreshHandles()},this.handleDocumentMouseDown=_=>{const g=_.target.className.includes("view-whiteboard__canvas"),P=_.target.className.includes("whiteboard-label__label"),F=_.target.dataset.id===this.id;this.isLabelEmpty()&&!F&&this.initialized?this.deleteLabel():(g||P&&!F)&&(this.active=!1,this.changeDetectorRef.markForCheck())},this.handleTextKeyDown=_=>{if(_.stopPropagation(),this.isLabelEmpty()&&"Backspace"===_.key)return void this.deleteLabel();const g=this.textRef.nativeElement.scrollHeight,{corner1:P,corner3:F,corner4:ee}=this.handleCoords,le=P.y+g;this.handleCoords.corner3={...F,y:le},this.handleCoords.corner4={...ee,y:le},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.updateTextarea(),this.changeDetectorRef.markForCheck()},this.dir=(0,Jn.NS)(this.localeId).direction}ngOnInit(){this.initHandles(),this.initInteractionListeners(),this.initStateListeners(),setTimeout(()=>{this.textRef.nativeElement.focus(),this.initialized=!0})}ngOnDestroy(){this.textRef.nativeElement.removeEventListener("keydown",this.handleTextKeyDown),this.textRef.nativeElement.removeEventListener("mousedown",this.handleTextboxMouseDown),this.mouseDownListener(),this.backspaceListener(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initHandles(){this.textareaTransform.x=this.initialPos.x,this.textareaTransform.y=this.initialPos.y;const{x:t,y:o,width:s,height:a}=this.textareaTransform;this.dragHandles.corner1={x:t,y:o},this.dragHandles.corner2={x:t+s,y:o},this.dragHandles.corner3={x:t+s,y:o+a},this.dragHandles.corner4={x:t,y:o+a},this.dragHandles.translate={x:t+s/2,y:o+-10},this.handleCoords.corner1={...this.dragHandles.corner1},this.handleCoords.corner2={...this.dragHandles.corner2},this.handleCoords.corner3={...this.dragHandles.corner3},this.handleCoords.corner4={...this.dragHandles.corner4},this.handleCoords.translate={...this.dragHandles.translate},this.updateTextarea()}initStateListeners(){this.actions.pipe((0,l.xi)(st.k2),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.unsetActiveLabel()),this.store.select(de.getWhiteboardAnnotateMode).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t!==To.Text&&this.unsetActiveLabel()})}initInteractionListeners(){this.mouseDownListener=this.renderer.listen("document","mousedown",this.handleDocumentMouseDown),this.backspaceListener=this.renderer.listen("document","keydown",this.handleDocumentBackspace),this.textRef.nativeElement.addEventListener("mousedown",this.handleTextboxMouseDown),this.textRef.nativeElement.addEventListener("keydown",this.handleTextKeyDown)}unsetActiveLabel(){this.active=!1,this.labelActive.next(void 0),this.changeDetectorRef.markForCheck()}refreshHandles(){this.dragHandles.corner1={...this.handleCoords.corner1},this.dragHandles.corner2={...this.handleCoords.corner2},this.dragHandles.corner3={...this.handleCoords.corner3},this.dragHandles.corner4={...this.handleCoords.corner4},this.dragHandles.translate={...this.handleCoords.translate},this.changeDetectorRef.markForCheck()}isLabelEmpty(){return""===this.textRef.nativeElement.innerText||"\n"===this.textRef.nativeElement.innerText}deleteLabel(){this.labelEmpty.next(this.id)}updateTextarea(){const{corner1:t,corner2:o,corner3:s}=this.handleCoords;this.textareaTransform.x=t.x,this.textareaTransform.y=t.y,this.textareaTransform.width=o.x-t.x,this.textareaTransform.height=s.y-o.y,this.renderer.setStyle(this.textRef.nativeElement,"transform",`translate(${this.textareaTransform.x}px, ${this.textareaTransform.y}px)`),this.renderer.setStyle(this.textRef.nativeElement,"width",`${this.textareaTransform.width}px`),this.renderer.setStyle(this.textRef.nativeElement,"height",`${this.textareaTransform.height}px`)}updateTranslateHandle(){const{corner1:t,corner2:o}=this.handleCoords;this.handleCoords.translate={x:(o.x-t.x)/2+t.x,y:t.y+-10},this.dragHandles.translate={...this.handleCoords.translate}}setHandle(t,o,s){this.handleCoords[t]={...this.handleCoords[t],[o]:s[o]},this.dragHandles[t]={...this.handleCoords[t]}}addDiffToHandle(t,o){this.handleCoords[t]={x:this.handleCoords[t].x+o.x,y:this.handleCoords[t].y+o.y},this.dragHandles[t]={...this.handleCoords[t]}}translateHandleMoved(t){const o=t.source._dragRef.getFreeDragPosition(),s={x:o.x-this.handleCoords.translate.x,y:o.y-this.handleCoords.translate.y};this.handleCoords.translate={...o},this.addDiffToHandle("corner1",s),this.addDiffToHandle("corner2",s),this.addDiffToHandle("corner3",s),this.addDiffToHandle("corner4",s),this.updateTextarea()}dragMoved(t,o){const s=t.source._dragRef.getFreeDragPosition();this.handleCoords[o]={...s},"corner1"===o&&(this.setHandle("corner2","y",s),this.setHandle("corner4","x",s)),"corner2"===o&&(this.setHandle("corner1","y",s),this.setHandle("corner3","x",s)),"corner3"===o&&(this.setHandle("corner2","x",s),this.setHandle("corner4","y",s)),"corner4"===o&&(this.setHandle("corner1","x",s),this.setHandle("corner3","y",s)),this.updateTranslateHandle(),this.updateTextarea()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(e.gRc),e.rXU(e.sFG),e.rXU(l.En),e.rXU(e.xe9))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-view-whiteboard-label"]],viewQuery:function(o,s){if(1&o&&e.GBs(eR,7),2&o){let a;e.mGM(a=e.lsd())&&(s.textRef=a.first)}},inputs:{id:"id",initialPos:"initialPos",color:"color",size:"size"},outputs:{labelActive:"labelActive",labelEmpty:"labelEmpty"},decls:4,vars:6,consts:()=>{let t;return t=$localize`:0fde29c90b84be4dd7bc39adcce90313a570f14b1511122002214104331:Type..`,[["textRef",""],[1,"whiteboard-label"],[4,"ngIf"],["contenteditable","true","data-placeholder",t,1,"whiteboard-label__label",3,"dir","ngClass"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--top-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-right",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--bottom-left",3,"cdkDragMoved","cdkDragFreeDragPosition"],["cdkDrag","",1,"whiteboard-label__handle","whiteboard-label__handle--move",3,"cdkDragMoved","cdkDragFreeDragPosition"]]},template:function(o,s){1&o&&(e.j41(0,"div",1),e.DNE(1,nR,6,5,"div",2),e.nrm(2,"div",3,0),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngIf",!0===s.active),e.R7$(),e.Y8G("dir",s.dir)("ngClass",e.eq3(4,tR,!0===s.active)),e.BMQ("data-id",s.id))},dependencies:[J.YU,J.bT,Cr.T1,Ra.ig],styles:['.whiteboard-label[_ngcontent-%COMP%]{position:relative;z-index:1000}.whiteboard-label__handle[_ngcontent-%COMP%]{position:fixed;z-index:10;width:32px;height:32px;left:-16px;top:-16px}.whiteboard-label__handle[_ngcontent-%COMP%]:after{content:"";position:absolute;width:12px;height:12px;left:10px;top:10px;border-radius:50%;background-color:#2472e9}.whiteboard-label__handle[_ngcontent-%COMP%]:hover{cursor:pointer}.whiteboard-label__handle--top-left[_ngcontent-%COMP%]:hover{cursor:nw-resize}.whiteboard-label__handle--top-right[_ngcontent-%COMP%]:hover{cursor:ne-resize}.whiteboard-label__handle--bottom-right[_ngcontent-%COMP%]:hover{cursor:se-resize}.whiteboard-label__handle--bottom-left[_ngcontent-%COMP%]:hover{cursor:sw-resize}.whiteboard-label__handle--move[_ngcontent-%COMP%]:hover{cursor:move}.whiteboard-label__label[_ngcontent-%COMP%]{box-sizing:border-box;position:absolute;border:none;padding:5px;overflow-y:hidden}.whiteboard-label__label--active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px #2472e9}.whiteboard-label__label[_ngcontent-%COMP%]:focus{outline:none}.whiteboard-label__label[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#384c6c80}'],changeDetection:0})}return n})();var Ss=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},bs=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const oR=["colorBtn"];function sR(n,i){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,5),e.k0s()())}function aR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.setTextSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,sR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27)(6,"span"),e.EFF(7),e.k0s()()()()}if(2&n){const t=i.$implicit,o=e.XpG();e.R7$(3),e.Y8G("ngIf",t.size===e.bMT(4,2,o.textSize$)),e.R7$(4),e.SpI("",t.label,"px")}}function rR(n,i){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,6),e.k0s()())}function lR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.setBrushSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,rR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27),e.nrm(6,"app-icon",30),e.j41(7,"span"),e.EFF(8),e.k0s()()()()}if(2&n){const t=i.$implicit,o=e.XpG();e.R7$(3),e.Y8G("ngIf",t.size===e.bMT(4,4,o.brushSize$)),e.R7$(3),e.xc7("font-size",t.size,"px"),e.R7$(2),e.JRh(t.label)}}function cR(n,i){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,7),e.k0s()())}function dR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.setEraserSize(s.size))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,cR,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",31),e.nrm(6,"app-icon",30),e.j41(7,"span"),e.EFF(8),e.k0s()()()()}if(2&n){const t=i.$implicit,o=e.XpG();e.R7$(3),e.Y8G("ngIf",t.size===e.bMT(4,4,o.eraserSize$)),e.R7$(3),e.xc7("font-size",t.size,"px"),e.R7$(2),e.JRh(t.label)}}function _R(n,i){1&n&&(e.j41(0,"div"),e.nrm(1,"app-icon",28),e.j41(2,"span",29),e.pXf(3,8),e.k0s()())}function pR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.setBrushColor(s.color))}),e.j41(1,"div",24)(2,"div",25),e.DNE(3,_R,4,0,"div",26),e.nI1(4,"async"),e.k0s(),e.j41(5,"div",27),e.nrm(6,"span",32),e.j41(7,"span"),e.EFF(8),e.nI1(9,"titlecase"),e.k0s()()()()}if(2&n){const t=i.$implicit,o=e.XpG();e.R7$(3),e.Y8G("ngIf",t.color===e.bMT(4,4,o.brushColor$)),e.R7$(3),e.xc7("background-color",t.color),e.R7$(2),e.JRh(e.bMT(9,6,t.label))}}class so{constructor(i){this.store=i,this.textSizes=uh,this.brushSizes=ph,this.brushColors=[{label:$localize`Black`,color:Gd.color},{label:$localize`Red`,color:"#ff0000"},{label:$localize`Yellow`,color:"#ffff00"},{label:$localize`Green`,color:"#00ff00"},{label:$localize`Cyan`,color:"#00ffff"},{label:$localize`Blue`,color:"#0000ff"},{label:$localize`Pink`,color:"#ff00ff"},{label:$localize`White`,color:gh.color}],this.eraserSizes=hh,this.modeEnum=To,this.downloadClick=new e.bkB,this.clearClick=new e.bkB,this.exitClick=new e.bkB,this.ngUnsubscribe=new k.B}ngOnInit(){}ngAfterViewInit(){this.hasPaint$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{!i&&this.store.selectSnapshot(de.getWhiteboardAnnotateMode)===To.Erase&&this.handleModeSelect(To.Paint)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setBrushSize(i){this.store.dispatch(new E.SetWhiteboardBrushSize(i))}setBrushColor(i){this.store.dispatch(new E.SetWhiteboardBrushColor(i))}setTextSize(i){this.store.dispatch(new E.SetWhiteboardTextSize(i))}handleModeSelect(i){this.store.dispatch(new E.SetWhiteboardAnnotateMode(i))}setEraserSize(i){this.store.dispatch(new E.SetWhiteboardEraserSize(i))}handleDownloadClick(){this.downloadClick.next()}handleClearClick(){this.clearClick.next()}handleExitClick(){this.exitClick.next()}static#e=this.\u0275fac=function(t){return new(t||so)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:so,selectors:[["app-view-whiteboard-tools"]],viewQuery:function(t,o){if(1&t&&e.GBs(oR,7,e.aKT),2&t){let s;e.mGM(s=e.lsd())&&(o.colorBtn=s.first)}},outputs:{downloadClick:"downloadClick",clearClick:"clearClick",exitClick:"exitClick"},decls:37,vars:43,consts:()=>{let i,t,o,s,a,r,_,g,P,F,ee,le,he,ue;return i=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,t=$localize`:8fa4d523f7b91df4390120b85ed0406138273e1a9011959596901584887:Color`,o=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,s=$localize`:a0e8b3d9b3da6e0adfc24e2a32c7a6403b72fbf18792981974820069318:Brush`,a=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,r=$localize`:8ba143716c2da6e4120c0c1a804f0bdd9a7e5f5b6162693758764653365:Text`,_=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,g=$localize`:07845aefc0a7038371e36035e75183d0cfffbbc38027390660031780542:Eraser`,P=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,F=$localize`:99ee4faa69cd2ea8e3678c1f557c0ff1f05aae468700121026680200191:Clear`,ee=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,le=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,he=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,ue=$localize`:1e7180823484a8b886c921518255e24324c3d47b8167513183851535531:current`,[["colorBtn","matMenuTrigger"],["textSizeMenu","matMenu"],["brushSizeMenu","matMenu"],["eraserSizeMenu","matMenu"],["brushColorMenu","matMenu"],ee,le,he,ue,[1,"view-whiteboard-tools"],["name","Whiteboard","orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",i,"matTooltip",t,"matTooltipPosition","right",3,"matMenuTriggerFor","buttonTheme"],["size","lg","icon","tint"],["app-view-button","","buttonSize","small","aria-label",o,"matTooltip",s,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","paint-brush"],["app-view-button","","buttonSize","small","aria-label",a,"matTooltip",r,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme"],["size","lg","icon","text-size"],["app-view-button","","buttonSize","small","aria-label",_,"matTooltip",g,"matTooltipPosition","right",3,"click","matMenuTriggerFor","buttonTheme","disabled"],["size","lg","icon","eraser"],["orientation","vertical"],["app-view-button","","buttonSize","small","aria-label",P,"matTooltip",F,"matTooltipPosition","right",3,"click","disabled"],["size","lg","icon","trash"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","flex-row","items-center","justify-start"],[1,"view-whiteboard-tools__check"],[4,"ngIf"],[1,"view-whiteboard-tools__label"],["icon","check","aria-hidden","true",1,"mr-2"],[1,"sr-only"],["icon","circle","aria-hidden","true",1,"mr-2"],[1,"view-whiteboard-tools__label","flex","flex-auto","items-center"],[1,"view-whiteboard-tools__swatch"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",9)(1,"app-pillbox",10)(2,"button",11,0),e.nrm(4,"app-icon",12),e.k0s(),e.j41(5,"button",13),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleModeSelect(o.modeEnum.Paint))}),e.nrm(9,"app-icon",14),e.k0s(),e.j41(10,"button",15),e.nI1(11,"async"),e.nI1(12,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleModeSelect(o.modeEnum.Text))}),e.nrm(13,"app-icon",16),e.k0s(),e.j41(14,"button",17),e.nI1(15,"async"),e.nI1(16,"async"),e.nI1(17,"async"),e.nI1(18,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleModeSelect(o.modeEnum.Erase))}),e.nrm(19,"app-icon",18),e.k0s(),e.nrm(20,"app-pillbox-divider",19),e.j41(21,"button",20),e.nI1(22,"async"),e.nI1(23,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleClearClick())}),e.nrm(24,"app-icon",21),e.k0s(),e.j41(25,"mat-menu",null,1),e.DNE(27,aR,8,4,"button",22),e.k0s(),e.j41(28,"mat-menu",null,2),e.DNE(30,lR,9,6,"button",22),e.k0s(),e.j41(31,"mat-menu",null,3),e.DNE(33,dR,9,6,"button",22),e.k0s(),e.j41(34,"mat-menu",null,4),e.DNE(36,pR,10,8,"button",22),e.k0s()()()}if(2&t){const s=e.sdS(3),a=e.sdS(26),r=e.sdS(29),_=e.sdS(32),g=e.sdS(35);e.R7$(2),e.Y8G("matMenuTriggerFor",g)("buttonTheme",s.menuOpen?"blue-fill":"transparent-fill"),e.BMQ("aria-selected",s.menuOpen)("aria-pressed",s.menuOpen),e.R7$(3),e.Y8G("matMenuTriggerFor",r)("buttonTheme",e.bMT(6,21,o.mode$)===o.modeEnum.Paint?"blue-fill":"transparent-fill"),e.BMQ("aria-selected",e.bMT(7,23,o.mode$)===o.modeEnum.Paint)("aria-pressed",e.bMT(8,25,o.mode$)===o.modeEnum.Paint),e.R7$(5),e.Y8G("matMenuTriggerFor",a)("buttonTheme",e.bMT(11,27,o.mode$)===o.modeEnum.Text?"blue-fill":"transparent-fill"),e.BMQ("aria-pressed",e.bMT(12,29,o.mode$)===o.modeEnum.Text),e.R7$(4),e.Y8G("matMenuTriggerFor",_)("buttonTheme",e.bMT(15,31,o.mode$)===o.modeEnum.Erase?"blue-fill":"transparent-fill")("disabled",!1===e.bMT(16,33,o.hasPaint$)),e.BMQ("aria-selected",e.bMT(17,35,o.mode$)===o.modeEnum.Erase)("aria-pressed",e.bMT(18,37,o.mode$)===o.modeEnum.Erase),e.R7$(7),e.Y8G("disabled",!1===e.bMT(22,39,o.hasPaint$)&&!1===e.bMT(23,41,o.hasText$)),e.R7$(6),e.Y8G("ngForOf",o.textSizes),e.R7$(3),e.Y8G("ngForOf",o.brushSizes),e.R7$(3),e.Y8G("ngForOf",o.eraserSizes),e.R7$(3),e.Y8G("ngForOf",o.brushColors)}},dependencies:[Qt.ri,J.Sq,J.bT,ut.R,un.kk,un.fb,un.Cp,Kt.oV,no,oc,J.Jj,J.PV],styles:[".view-whiteboard-tools__check{min-width:20px;color:#2472e9}.view-whiteboard-tools__swatch{display:inline-block;width:14px;height:14px;border-radius:50%;margin-inline-end:8px;box-shadow:0 0 0 1px #8999b3}\n"],encapsulation:2,changeDetection:0})}Ss([(0,l.l6)(de.isWhiteboardLocked),bs("design:type",h.c)],so.prototype,"isLocked$",void 0),Ss([(0,l.l6)(de.getWhiteboardAnnotateMode),bs("design:type",h.c)],so.prototype,"mode$",void 0),Ss([(0,l.l6)(de.getWhiteboardBrushSize),bs("design:type",h.c)],so.prototype,"brushSize$",void 0),Ss([(0,l.l6)(de.getWhiteboardTextSize),bs("design:type",h.c)],so.prototype,"textSize$",void 0),Ss([(0,l.l6)(de.getWhiteboardBrushColor),bs("design:type",h.c)],so.prototype,"brushColor$",void 0),Ss([(0,l.l6)(de.getWhiteboardEraserSize),bs("design:type",h.c)],so.prototype,"eraserSize$",void 0),Ss([(0,l.l6)(de.getWhiteboardHasPaint),bs("design:type",h.c)],so.prototype,"hasPaint$",void 0),Ss([(0,l.l6)(de.getWhiteboardHasText),bs("design:type",h.c)],so.prototype,"hasText$",void 0);var qs=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Js=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const uR=["drawCanvas"],hR=["annotateWrapper"];function gR(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-view-whiteboard-label",14),e.nI1(1,"async"),e.bIt("labelActive",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleLabelActive(s))})("labelEmpty",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleLabelEmpty(s))}),e.k0s()}if(2&n){const t=i.$implicit,o=e.XpG();e.AVh("view-whiteboard__label--clickthrough",e.bMT(1,6,o.annotateMode$)!==o.whiteboardAnnotateMode.Text),e.Y8G("id",t.id)("initialPos",t.pos)("color",t.color)("size",t.size)}}function mR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitClick())}),e.j41(1,"span",16),e.pXf(2,2),e.k0s()()}}const yc=hr.H.PNG;class Eo{constructor(i,t,o,s,a,r,_,g,P){this.store=i,this.actions=t,this.viewService=o,this.clipboardService=s,this.applicationEventService=a,this.changeRef=r,this.animationService=_,this.snapshotService=g,this.snackbar=P,this.whiteboardAnnotateMode=To,this.labels=[],this.drawing=!1,this.brushSize=0,this.eraserSize=0,this.lineWidth=0,this.wasPlaying=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.siteHeader=this.store.selectSnapshot(vn.getSiteHeader),this.store.dispatch(new Un.SetHeader(as.Hide)),this.canvasElement=this.drawCanvas.nativeElement,this.canvasContext=this.canvasElement.getContext("2d"),this.initActiveLabelColorListener(),this.initActiveLabelTextSizeListener(),this.initAnnotateModeListener(),this.initBrushColorFromBackgroundListener(),this.animationService.isPlaying()&&(this.animationService.pause(),this.wasPlaying=!0)}ngAfterViewInit(){this.initCanvasListeners(),this.snapshotService.setDrawCanvas(this.drawCanvas.nativeElement),this.snapshotService.setAnnotateElement(this.annotateElement.nativeElement)}ngOnDestroy(){this.inputManager.destroy(),this.reset(),this.store.dispatch(new Un.SetHeader(this.siteHeader)),this.wasPlaying&&this.animationService.unpause(),this.snapshotService.setDrawCanvas(null),this.snapshotService.setAnnotateElement(null),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initAnnotateModeListener(){this.annotateMode$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{switch(this.inputManager&&this.inputManager.destroy(),i){case To.Paint:this.canvasContext.globalCompositeOperation="source-over",this.setLineWidth(this.brushSize),this.initDrawListeners();break;case To.Text:this.initTextListener();break;case To.Erase:this.canvasContext.globalCompositeOperation="destination-out",this.setLineWidth(this.eraserSize),this.initDrawListeners()}this.applicationEventService.fireEvent(rt.F.WhiteboardModeUpdated,i)})}initActiveLabelColorListener(){this.brushColor$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.labels.find(o=>o.id===this.activeLabelId);t&&(t.color=i,this.changeRef.markForCheck())})}initActiveLabelTextSizeListener(){this.textSize$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.labels.find(o=>o.id===this.activeLabelId);t&&(t.size=i,this.changeRef.markForCheck())})}initBrushColorFromBackgroundListener(){this.background$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=(0,Ds.T4)(i)?xy:jy;this.store.dispatch(new E.SetWhiteboardBrushColor(t.color))})}initTextListener(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Tap({event:"tap"})),this.inputManager.on("tap",i=>{if(this.activeLabelId)return void(this.activeLabelId=void 0);const t=(0,u.uniqueId)();let o=i.center.x,s=i.center.y;void 0!==i.pointers[0].x&&(o=i.pointers[0].x,s=i.pointers[0].y);const a=this.store.selectSnapshot(de.getWhiteboardBrushColor),r=this.store.selectSnapshot(de.getWhiteboardTextSize);this.labels.push({id:t,pos:{x:o,y:s},color:a,size:r}),this.activeLabelId=t,this.changeRef.markForCheck(),this.dispatchHasText()})}initCanvasListeners(){this.brushSize$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setBrushSize(i)}),this.brushColor$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setBrushColor(i)}),this.eraserSize$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setEraserSize(i)}),this.syncCanvas()}initDrawListeners(){this.inputManager=new Hammer.Manager(this.drawCanvas.nativeElement),this.inputManager.add(new Hammer.Pan({event:"pan",pointers:0})),this.inputManager.add(new Hammer.Tap({event:"tap"}));const i=new Map;this.inputManager.on("tap",t=>{this.changeRef.markForCheck();const{x:o,y:s}=this.getInputPosition(t);this.drawPoint(o,s),this.checkCanvasPaint()}),this.inputManager.on("panstart",t=>{this.drawing=!0,this.changeRef.markForCheck();const{x:o,y:s}=this.getInputPosition(t);i.set(t.pointers[0]?.pointerId||1,{x:o,y:s}),this.applicationEventService.fireEvent(rt.F.WhiteboardDrawingStarted)}),this.inputManager.on("pan",t=>{this.drawing=!0,this.changeRef.markForCheck();const{x:o,y:s}=this.getInputPosition(t),a=t.pointers[0]?.pointerId||1,{x:r,y:_}=i.get(a);this.drawLine(r,_,o,s),this.drawPoint(o,s),i.set(a,{x:o,y:s})}),this.inputManager.on("panend",()=>{this.drawing=!1,this.changeRef.markForCheck(),i.clear(),this.checkCanvasPaint(),this.applicationEventService.fireEvent(rt.F.WhiteboardDrawingFinished)})}handleLabelActive(i){this.activeLabelId=i;const t=this.labels.find(o=>o.id===i);t&&this.store.dispatch([new E.SetWhiteboardTextSize(t.size),new E.SetWhiteboardBrushColor(t.color)])}handleLabelEmpty(i){this.labels=this.labels.filter(t=>t.id!==i),this.changeRef.markForCheck(),this.dispatchHasText()}dispatchHasText(){this.store.dispatch(new E.SetWhiteboardHasText(this.labels.length>0))}handleResetClick(){this.reset()}handleCopyClick(){var i=this;return(0,pt.A)(function*(){try{const t=function(){var o=(0,pt.A)(function*(){return yield yield i.getSnapshotBlob()});return function(){return o.apply(this,arguments)}}();yield navigator.clipboard.write([new ClipboardItem({"image/png":t()})]),i.snackbar.open("Image copied")}catch{i.snackbar.open("Error copying image")}})()}handleDownloadClick(){var i=this;return(0,pt.A)(function*(){const t=yield i.getSnapshotBlob();i.downloadSnapshot(t)})()}handleExitClick(){this.resetCanvas(),this.viewService.toggleWhiteboard(!1)}getSnapshotBlob(){var i=this;return(0,pt.A)(function*(){const{width:t,height:o}=i.canvasElement,s=i.store.selectSnapshot(me.N.getSelectedChapterBackground),a=i.store.selectSnapshot(ze.S.getWatermarkEnabled),r=document.querySelector(".engine__watermark"),_=[i.drawCanvas.nativeElement,i.annotateElement.nativeElement];a&&!(0,u.isNil)(r)&&_.push(r);const g=(0,Ql.F$)(yc,s),P=i.snapshotService.getLogoFromBackground(s),F={...Ql._,crop:"original",imageType:yc,imageQuality:100,copyrightEnabled:!0,copyrightImagePath:P.logo_url};return i.store.dispatch(new st.k2(t,o,g,_,!0,F)),(0,Ci._)(i.actions.pipe((0,l.xi)(st.NO),(0,W.T)(ee=>ee.blob)))})()}getInputPosition(i){const t=i.pointers[0];return t?.pageX?{x:t.pageX,y:t.pageY}:{x:i.center.x,y:i.center.y}}checkCanvasPaint(){const i=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),o=new Uint32Array(i.data.buffer).some(s=>0!==s);this.store.dispatch(new E.SetWhiteboardHasPaint(o))}drawPoint(i,t){const o=this.lineWidth/2,s=2*Math.PI;this.canvasContext.beginPath(),this.canvasContext.arc(i,t,o,0,s),this.canvasContext.fill()}drawLine(i,t,o,s){this.canvasContext.beginPath(),this.canvasContext.moveTo(i,t),this.canvasContext.lineTo(o,s),this.canvasContext.stroke(),this.canvasContext.closePath()}reset(){this.resetCanvas(),this.labels=[],this.changeRef.markForCheck(),this.dispatchHasText()}setBrushSize(i){this.brushSize=i,this.setLineWidth(i)}setBrushColor(i){this.canvasContext.fillStyle=i,this.canvasContext.strokeStyle=i}setEraserSize(i){this.eraserSize=i,this.setLineWidth(i)}setLineWidth(i){this.canvasContext.lineWidth=i,this.lineWidth=i}syncCanvas(){const i=this.store.selectSnapshot(de.getWhiteboardBrushSize),t=this.store.selectSnapshot(de.getWhiteboardBrushColor),o=this.store.selectSnapshot(de.getWhiteboardEraserSize),{width:s,height:a}=this.getScreenDimensions();this.canvasElement.width=s,this.canvasElement.height=a,this.setBrushSize(i),this.setBrushColor(t),this.setEraserSize(o),this.canvasContext.lineJoin="round"}resetCanvas(){const{width:i,height:t}=this.canvasElement;this.canvasContext.clearRect(0,0,i,t),this.store.dispatch(new E.SetWhiteboardHasPaint(!1))}downloadSnapshot(i){const{displayName:t}=this.store.selectSnapshot(dt.getStory),a=`${(t||"").replace(/ /g,"_").replace(/\W/g,"").toLowerCase()}_drawing.${yc===hr.H.PNG?"png":"jpg"}`;!0===z.c.native||z.c.platform===Ls.N.SDK?Zp.X.blobToBase64(i).pipe((0,ra.q)(r=>this.clipboardService.copyToClipboard(r,"image")),(0,p.Q)(this.ngUnsubscribe)).subscribe(r=>{}):Zp.X.exportImage(i,yc,a)}getScreenDimensions(){const{innerWidth:i,innerHeight:t}=window;return{width:i,height:t}}static#e=this.\u0275fac=function(t){return new(t||Eo)(e.rXU(l.il),e.rXU(l.En),e.rXU(En),e.rXU(Fr.W),e.rXU(Po.S),e.rXU(e.gRc),e.rXU(co.O),e.rXU(pp.M),e.rXU(ui.UG))};static#t=this.\u0275cmp=e.VBU({type:Eo,selectors:[["app-view-whiteboard"]],viewQuery:function(t,o){if(1&t&&(e.GBs(uR,7),e.GBs(hR,7)),2&t){let s;e.mGM(s=e.lsd())&&(o.drawCanvas=s.first),e.mGM(s=e.lsd())&&(o.annotateElement=s.first)}},decls:19,vars:18,consts:()=>{let i,t,o,s,a,r;return i=$localize`:1979da7460819153e11d2078244645d94291b69c4323470180912194028:Copy`,t=$localize`:1979da7460819153e11d2078244645d94291b69c4323470180912194028:Copy`,o=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,s=$localize`:dc75033a5238fdc4f462212c847a45ba8018a3fd3099741642167775297:Download`,a=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,r=$localize`:321ea915069a7cb35969b033591534495fa061ec7029026028912706681:Exit Draw`,[["annotateWrapper",""],["drawCanvas",""],r,[1,"view-whiteboard"],["dir","ltr",1,"view-whiteboard__label-container"],["class","view-whiteboard__label",3,"view-whiteboard__label--clickthrough","id","initialPos","color","size","labelActive","labelEmpty",4,"ngFor","ngForOf"],["data-test","drawCanvas",1,"view-whiteboard__canvas"],["data-test","viewWhiteboardTools",1,"view-whiteboard__tools",3,"clearClick","downloadClick","exitClick"],[1,"view-whiteboard__actions"],["app-view-button","","buttonSize","small","data-test","viewWhiteboardCopy","aria-label",i,"matTooltip",t,"matTooltipPosition","right",3,"click"],["size","lg","icon","copy"],["app-view-button","","buttonSize","small","data-test","viewWhiteboardDownload","aria-label",o,"matTooltip",s,"matTooltipPosition","right",3,"click"],["size","lg","icon","down-to-bracket"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",a,3,"click",4,"ngIf"],[1,"view-whiteboard__label",3,"labelActive","labelEmpty","id","initialPos","color","size"],["data-test","viewDrawExit","app-view-button","","buttonSize","small","aria-label",a,3,"click"],[1,"px-3","text-xs","uppercase"]]},template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",3),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div",4,0),e.DNE(6,gR,2,8,"app-view-whiteboard-label",5),e.k0s(),e.nrm(7,"canvas",6,1),e.j41(9,"app-view-whiteboard-tools",7),e.bIt("clearClick",function(){return e.eBV(s),e.Njj(o.handleResetClick())})("downloadClick",function(){return e.eBV(s),e.Njj(o.handleDownloadClick())})("exitClick",function(){return e.eBV(s),e.Njj(o.handleExitClick())}),e.k0s(),e.j41(10,"div",8)(11,"app-pillbox")(12,"button",9),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleCopyClick())}),e.nrm(13,"app-icon",10),e.k0s(),e.j41(14,"button",11),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleDownloadClick())}),e.nrm(15,"app-icon",12),e.k0s()(),e.j41(16,"app-pillbox"),e.DNE(17,mR,3,0,"button",13),e.nI1(18,"async"),e.k0s()()()}2&t&&(e.AVh("view-whiteboard--drawing",o.drawing)("view-whiteboard--cursor-paint",e.bMT(1,10,o.annotateMode$)===o.whiteboardAnnotateMode.Paint)("view-whiteboard--cursor-erase",e.bMT(2,12,o.annotateMode$)===o.whiteboardAnnotateMode.Erase)("view-whiteboard--cursor-text",e.bMT(3,14,o.annotateMode$)===o.whiteboardAnnotateMode.Text),e.R7$(6),e.Y8G("ngForOf",o.labels),e.R7$(11),e.Y8G("ngIf",!1===e.bMT(18,16,o.isLocked$)))},dependencies:[Qt.ri,J.Sq,J.bT,ut.R,Ra.ig,Kt.oV,no,iR,so,J.Jj],styles:[".view-whiteboard{touch-action:none;position:fixed;inset:0;z-index:20;display:flex;flex-direction:column;align-items:center;justify-content:space-between;transition:all .3s linear}.view-whiteboard--drawing .view-whiteboard__tools,.view-whiteboard--drawing .view-whiteboard__actions{display:none}.view-whiteboard--cursor-paint:hover{cursor:url(/assets/images/cursor-whiteboard-paint.svg) 7 20,pointer}.view-whiteboard--cursor-erase:hover{cursor:url(/assets/images/cursor-whiteboard-erase.svg) 7 20,pointer}.view-whiteboard--cursor-text:hover{cursor:url(/assets/images/cursor-whiteboard-text.svg) 7 20,pointer}.view-whiteboard__canvas{position:absolute;inset:0;z-index:1}.view-whiteboard__label-container{position:absolute;inset:0;z-index:2;pointer-events:none}.view-whiteboard__label{position:absolute;top:0;left:0;z-index:10;pointer-events:all}.view-whiteboard__label--clickthrough{pointer-events:none}.view-whiteboard__tools{position:absolute;inset-inline-start:12px;top:12px;bottom:12px;z-index:20;display:flex;align-items:center}.view-whiteboard__actions{display:flex;gap:8px;position:absolute;inset-inline-end:12px;top:12px;z-index:20}\n"],encapsulation:2,changeDetection:0})}qs([(0,l.l6)(de.isWhiteboardLocked),Js("design:type",h.c)],Eo.prototype,"isLocked$",void 0),qs([(0,l.l6)(de.getWhiteboardAnnotateMode),Js("design:type",h.c)],Eo.prototype,"annotateMode$",void 0),qs([(0,l.l6)(de.getWhiteboardBrushSize),Js("design:type",h.c)],Eo.prototype,"brushSize$",void 0),qs([(0,l.l6)(de.getWhiteboardBrushColor),Js("design:type",h.c)],Eo.prototype,"brushColor$",void 0),qs([(0,l.l6)(de.getWhiteboardTextSize),Js("design:type",h.c)],Eo.prototype,"textSize$",void 0),qs([(0,l.l6)(de.getWhiteboardEraserSize),Js("design:type",h.c)],Eo.prototype,"eraserSize$",void 0),qs([(0,l.l6)(me.N.getSelectedChapterBackground),Js("design:type",h.c)],Eo.prototype,"background$",void 0);var St=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},bt=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const SR=["viewContainer"],bR=["columnContainer"],yR=["drawerContainer"],vR=["engineContainer"],ER=["view"],CR=["viewCameraBar"],TR=["viewLogo"],OR=["viewSceneBase"],MR=["viewToolbar"],IR=(n,i,t,o,s,a,r,_)=>({"view-page--layout-column":n,"view-page--layout-drawer":i,"view-page--show-aside":t,"view-page--column-open":o,"view-page--column-closed":s,"view-page--drawer-open":a,"view-page--drawer-closed":r,"view-page--drawer-peek":_}),PR=n=>({"view-page__drawer-nav--overflow":n}),Df=n=>({"w-full":n}),wR=n=>({grow:n}),AR=n=>({collapsed:n}),RR=n=>({"pt-2":n}),NR=(n,i,t)=>({"view-page__logo--mobile":n,"view-page__logo--web":i,"view-page__logo--raised":t});function kR(n,i){1&n&&e.nrm(0,"app-view-toolbar")}function DR(n,i){if(1&n&&(e.nrm(0,"app-view-undo",41),e.nI1(1,"async")),2&n){const t=e.XpG();e.Y8G("layout",e.bMT(1,1,t.canvasHeightBreakpoint$)>t.canvasHeightBreakpoint.Tiny?"full":"resetOnly")}}function LR(n,i){if(1&n&&(e.nrm(0,"app-view-title-only",49),e.nI1(1,"async")),2&n){const t=e.XpG(4);e.Y8G("showPagination",e.bMT(1,1,t.paginationVisible$))}}function UR(n,i){1&n&&e.nrm(0,"app-view-audio-mute")}function xR(n,i){if(1&n&&(e.j41(0,"app-pillbox",50),e.DNE(1,UR,1,0,"app-view-audio-mute",18),e.nI1(2,"async"),e.nrm(3,"app-view-drawer-toggle"),e.k0s()),2&n){const t=e.XpG(4);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.audioVisible$))}}function jR(n,i){if(1&n&&(e.j41(0,"div",46),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div"),e.DNE(5,LR,2,3,"app-view-title-only",47),e.nI1(6,"async"),e.k0s(),e.DNE(7,xR,4,3,"app-pillbox",48),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&n){const t=e.XpG(3);e.Y8G("ngClass",e.eq3(15,PR,e.bMT(1,3,t.titleOnlyVisible$)&&(e.bMT(2,5,t.drawerToggleVisible$)||e.bMT(3,7,t.audioVisible$)))),e.R7$(5),e.Y8G("ngIf",e.bMT(6,9,t.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(8,11,t.drawerToggleVisible$)||e.bMT(9,13,t.audioVisible$))}}function VR(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-pillbox")(1,"button",51),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.handleQuizClick())}),e.nrm(2,"app-icon",52),e.k0s()()}}function FR(n,i){if(1&n&&(e.j41(0,"div",44),e.DNE(1,jR,10,17,"div",45),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,VR,3,0,"app-pillbox",18),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,t.titleOnlyVisible$)||e.bMT(3,4,t.drawerToggleVisible$)||e.bMT(4,6,t.audioVisible$)),e.R7$(4),e.Y8G("ngIf",e.bMT(6,8,t.hasQuiz$)&&e.bMT(7,10,t.quizEnabled$)&&!1===e.bMT(8,12,t.quizModeLocked$)&&e.bMT(9,14,t.quizPromptVisible$)&&!1===e.bMT(10,16,t.quizModeActive$))}}function GR(n,i){if(1&n&&(e.qex(0,42),e.DNE(1,FR,11,18,"div",43),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.titleOnlyVisible$)||e.bMT(3,3,t.drawerToggleVisible$)||e.bMT(4,5,t.quizModeActive$)&&!1===e.bMT(5,7,t.quizModeLocked$))}}function $R(n,i){1&n&&e.nrm(0,"app-view-column-toggle")}function BR(n,i){if(1&n&&(e.qex(0),e.nrm(1,"app-view-title-only",56),e.nI1(2,"async"),e.bVm()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("showPagination",e.bMT(2,1,t.paginationVisible$))}}function zR(n,i){1&n&&e.nrm(0,"app-view-audio-mute")}function WR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",58),e.bIt("click",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.handleQuizClick())}),e.nrm(1,"app-icon",59),e.j41(2,"span",60),e.pXf(3,6),e.k0s()()}}function XR(n,i){if(1&n&&(e.j41(0,"app-pillbox"),e.DNE(1,zR,1,0,"app-view-audio-mute",18),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,WR,4,0,"button",57),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,t.audioVisible$)&&!1===e.bMT(3,4,t.columnVisible$)),e.R7$(3),e.Y8G("ngIf",e.bMT(5,6,t.hasQuiz$)&&e.bMT(6,8,t.quizEnabled$)&&!1===e.bMT(7,10,t.quizModeLocked$)&&e.bMT(8,12,t.quizPromptVisible$)&&!1===e.bMT(9,14,t.quizModeActive$))}}function HR(n,i){if(1&n&&(e.j41(0,"div",54)(1,"div",55),e.DNE(2,$R,1,0,"app-view-column-toggle",18),e.nI1(3,"async"),e.DNE(4,BR,3,3,"ng-container",18),e.nI1(5,"async"),e.DNE(6,XR,10,16,"app-pillbox",18),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",e.bMT(3,3,t.columnToggleVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(5,5,t.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,7,t.hasQuiz$)&&e.bMT(8,9,t.quizEnabled$)&&!1===e.bMT(9,11,t.quizModeLocked$)&&e.bMT(10,13,t.quizPromptVisible$)&&!1===e.bMT(11,15,t.quizModeActive$)||e.bMT(12,17,t.audioVisible$)&&!1===e.bMT(13,19,t.columnVisible$))}}function QR(n,i){if(1&n&&(e.qex(0,42),e.DNE(1,HR,14,21,"div",53),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.columnToggleVisible$)||e.bMT(3,3,t.titleOnlyVisible$)||e.bMT(4,5,t.quizModeActive$))}}function YR(n,i){1&n&&e.eu8(0,42)}function KR(n,i){if(1&n&&(e.j41(0,"div",23)(1,"app-pillbox",61),e.nrm(2,"app-view-xr-button",62),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()()),2&n){let t;const o=e.XpG();e.R7$(2),e.Y8G("mode","ar")("title",null==(t=e.bMT(3,6,o.story$))?null:t.displayName)("modelUrl",e.bMT(4,8,o.arModelUrl$))("transparent",!0)("bordered",!1)("compact",!0)}}function qR(n,i){1&n&&e.nrm(0,"app-engine-camera-bar")}function JR(n,i){1&n&&(e.j41(0,"app-pillbox",63),e.nrm(1,"app-view-fullscreen",64),e.k0s())}function ZR(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",76),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.handleToggleMedia(!1))}),e.nrm(2,"app-icon",77),e.k0s()}if(2&n){let t;const o=e.XpG(4);e.Y8G("matTooltip",o.mediaBarTooltip)("thin",!0),e.BMQ("aria-label",o.mediaBarTooltip)("aria-expanded","show"===(null==(t=e.bMT(1,4,o.mediaUI$))?null:t.status))}}function eN(n,i){if(1&n&&(e.j41(0,"div",71),e.nI1(1,"async"),e.nI1(2,"async"),e.j41(3,"app-pillbox",72),e.nI1(4,"async"),e.nI1(5,"async"),e.DNE(6,ZR,3,6,"button",73),e.nI1(7,"async"),e.nrm(8,"app-pillbox-divider",74)(9,"app-view-media-bar",75),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s()()),2&n){let t,o,s;const a=e.XpG(3);e.Y8G("ngClass",e.eq3(20,Df,e.bMT(1,6,a.horizontalBreakpoint$)>a.horizontalBreakpoint.XSmall&&"full"===(null==(t=e.bMT(2,8,a.mediaUI$))?null:t.template))),e.R7$(3),e.Y8G("ngClass",e.eq3(22,wR,e.bMT(4,10,a.horizontalBreakpoint$)>a.horizontalBreakpoint.XSmall&&"full"===(null==(o=e.bMT(5,12,a.mediaUI$))?null:o.template))),e.R7$(3),e.Y8G("ngIf",e.eq3(24,AR,"show"===(null==(s=e.bMT(7,14,a.mediaUI$))?null:s.status))),e.R7$(3),e.Y8G("autoFocus","keyboard"===a.focusOrigin)("showSpeed",e.bMT(10,16,a.horizontalBreakpoint$)>a.horizontalBreakpoint.XSmall)("showScrubber",e.bMT(11,18,a.horizontalBreakpoint$)>a.horizontalBreakpoint.XSmall)}}function tN(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"button",76),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.handleToggleMedia(!0))}),e.nrm(3,"app-icon",78),e.k0s(),e.nrm(4,"app-pillbox-divider",74),e.bVm()}if(2&n){let t;const o=e.XpG(4);e.R7$(),e.Y8G("matTooltip",o.mediaBarTooltip)("thin",!0),e.BMQ("aria-label",o.mediaBarTooltip)("aria-expanded","show"===(null==(t=e.bMT(2,4,o.mediaUI$))?null:t.status))}}function nN(n,i){if(1&n&&(e.j41(0,"app-pillbox",74),e.DNE(1,tN,5,6,"ng-container",18),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nrm(5,"app-view-play"),e.k0s()),2&n){let t;const o=e.XpG(3);e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,1,o.isMobileWeb$)&&"collapse"===(null==(t=e.bMT(3,3,o.mediaUI$))?null:t.status)&&"full"===(null==(t=e.bMT(4,5,o.mediaUI$))?null:t.template))}}function iN(n,i){if(1&n&&(e.j41(0,"div",68),e.DNE(1,eN,12,26,"div",69),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,nN,6,7,"app-pillbox",70),e.nI1(5,"async"),e.k0s()),2&n){let t,o;const s=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,2,s.mediaVisible$)&&"show"===(null==(t=e.bMT(3,4,s.mediaUI$))?null:t.status)),e.R7$(3),e.Y8G("ngIf","show"!==(null==(o=e.bMT(5,6,s.mediaUI$))?null:o.status))}}function oN(n,i){if(1&n&&(e.nrm(0,"app-view-title-only",82),e.nI1(1,"async"),e.nI1(2,"async")),2&n){const t=e.XpG(3);e.Y8G("showPagination",e.bMT(1,2,t.paginationVisible$))("showTitle",!1===e.bMT(2,4,t.drawerVisible$))}}function sN(n,i){1&n&&(e.j41(0,"app-pillbox",50),e.nrm(1,"app-view-drawer-toggle"),e.k0s())}function aN(n,i){if(1&n&&(e.j41(0,"div",79),e.nI1(1,"async"),e.j41(2,"div",80),e.nI1(3,"async"),e.DNE(4,oN,3,6,"app-view-title-only",81),e.nI1(5,"async"),e.k0s(),e.DNE(6,sN,2,0,"app-pillbox",48),e.nI1(7,"async"),e.k0s()),2&n){const t=e.XpG(2);e.Y8G("ngClass",e.eq3(12,RR,e.bMT(1,4,t.mediaVisible$))),e.R7$(2),e.Y8G("ngClass",e.eq3(14,Df,!1===e.bMT(3,6,t.drawerVisible$))),e.R7$(2),e.Y8G("ngIf",e.bMT(5,8,t.titleOnlyVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,10,t.drawerToggleVisible$))}}function rN(n,i){if(1&n&&(e.j41(0,"div",65),e.DNE(1,iN,6,8,"div",66),e.nI1(2,"async"),e.DNE(3,aN,8,16,"div",67),e.nI1(4,"async"),e.nI1(5,"async"),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,2,t.mediaVisible$)),e.R7$(2),e.Y8G("ngIf",!0===e.bMT(4,4,t.isMobileWeb$)&&"drawer"===e.bMT(5,6,t.viewLayout$))}}function lN(n,i){if(1&n&&(e.nrm(0,"app-view-logo",83),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async")),2&n){const t=e.XpG();e.Y8G("ngClass",e.sMw(11,NR,!0===e.bMT(1,3,t.isMobileWeb$),!1===e.bMT(2,5,t.isMobileWeb$),t.isLogoRaised))("logoColor",t.isBackgroundLight?"color":"white")("logoSize",!0===e.bMT(3,7,t.isMobileWeb$)||e.bMT(4,9,t.horizontalBreakpoint$)<=t.horizontalBreakpoint.Small?"small":"full")}}function cN(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",84)(1,"app-pillbox")(2,"button",51),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitQuiz())}),e.j41(3,"span",85),e.pXf(4,7),e.k0s()()()()}}function dN(n,i){1&n&&e.nrm(0,"app-view-column-container",86)}function _N(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-view-column",87),e.nI1(1,"async"),e.qex(2,88),e.j41(3,"div",89)(4,"div",90),e.pXf(5,8),e.k0s(),e.j41(6,"button",91),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleSearch(!1))}),e.nrm(7,"app-icon",92),e.j41(8,"span",93),e.pXf(9,9),e.k0s()()(),e.bVm(),e.qex(10,94),e.j41(11,"div",95),e.nrm(12,"app-view-search"),e.k0s(),e.bVm(),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("floating",!0)("padded",!1)("wide",e.bMT(1,3,t.paginationVisible$))}}function pN(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-view-column",96),e.nI1(1,"async"),e.qex(2,88),e.j41(3,"div",89)(4,"div",90),e.pXf(5,10),e.k0s(),e.j41(6,"button",97),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleToggleLayers())}),e.nrm(7,"app-icon",92),e.j41(8,"span",93),e.pXf(9,11),e.k0s()()(),e.bVm(),e.qex(10,94),e.j41(11,"div",98),e.nrm(12,"app-view-visibility-layers"),e.k0s(),e.bVm(),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("wide",e.bMT(1,3,t.paginationVisible$))("floating",!0)("padded",!1)}}function uN(n,i){1&n&&(e.j41(0,"div",99,5),e.nrm(2,"app-view-drawer"),e.k0s())}function hN(n,i){1&n&&e.nrm(0,"div",100)}function gN(n,i){if(1&n&&e.nrm(0,"app-view-ondemand",36),2&n){const t=e.XpG();e.Y8G("contentId",t.contentId)("contentType",t.contentType)}}function mN(n,i){1&n&&e.nrm(0,"app-view-tour")}function fN(n,i){1&n&&e.nrm(0,"app-view-whiteboard",37)}function SN(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-xr-loader-summary",101),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bIt("learnMoreClick",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleExitARClick())}),e.k0s()}if(2&n){let t,o,s;const a=e.XpG();e.Y8G("platform",e.bMT(1,4,a.platform$))("mode",null==(t=e.bMT(2,6,a.viewUI$))?null:t.xrLoader.template)("contentBlocks",null==(o=e.bMT(3,8,a.chapter$))?null:o.contentBlocks)("title",null==(s=e.bMT(4,10,a.story$))?null:s.displayName)}}function bN(n,i){if(1&n&&e.nrm(0,"app-play-loader",102),2&n){const t=e.XpG(2);e.Y8G("percent",t.chapterLoadProgress)}}function yN(n,i){1&n&&e.nrm(0,"app-button-loader")}function vN(n,i){1&n&&e.nrm(0,"app-hand-loader")}function EN(n,i){1&n&&e.nrm(0,"app-summary-loader")}function CN(n,i){if(1&n&&(e.j41(0,"app-view-loader"),e.DNE(1,bN,1,1,"app-play-loader",102),e.nI1(2,"async"),e.DNE(3,yN,1,0,"app-button-loader")(4,vN,1,0,"app-hand-loader")(5,EN,1,0,"app-summary-loader"),e.k0s()),2&n){let t;const o=e.XpG();e.R7$(),e.vxM("play"===(t=e.bMT(2,1,o.interactType$))?1:"button"===t?3:"hand"===t?4:"summary"===t?5:-1)}}function TN(n,i){if(1&n&&(e.nrm(0,"app-view-progress",103),e.nI1(1,"async")),2&n){const t=e.XpG();e.Y8G("show",e.bMT(1,2,t.viewWindow$)===t.viewWindow.Loader)("percent",t.chapterLoadProgress)}}function ON(n,i){1&n&&e.nrm(0,"app-view-print")}function MN(n,i){1&n&&e.nrm(0,"app-view-content-warning")}function IN(n,i){1&n&&e.nrm(0,"app-xr-overlay")}class ht{onClick(i){this.handleFirstClickTracking(i)}onActive(i){this.showTools$.next(!0)}onInactive(i){const t=this.store.selectSnapshot(de.getFadeout),o=this.store.selectSnapshot(de.getFadeoutPaused),s=this.viewLayout$.getValue();0!==t&&s!==Yn.Column&&!o&&this.showTools$.next(!1)}get arModelUrl$(){return this.chapter$.pipe((0,W.T)(i=>i?.contentBlocks??[]),(0,W.T)(i=>Sp(i)[0]))}constructor(i,t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt){this.activatedRoute=i,this.changeDetectorRef=t,this.store=o,this.actions=s,this.liveAnnouncer=a,this.viewService=r,this.viewQuizService=_,this.viewUIService=g,this.engineService=P,this.nodeService=F,this.animationService=ee,this.applicationEventService=le,this.vendorAnalyticsService=he,this.mediaService=ue,this.title=ye,this.platform=Ge,this.viewPlaythroughService=Ve,this.focusMonitor=it,this.dialog=ot,this.visibilityLayersService=_t,this.legacyVisibilityLayersService=xt,this.application=xn.c,this.environment=z.c,this.nativePlatform=fr.I,this.toolEnum=dn.s,this.showTools$=new Li.t(!1),this.mediaExpanded=!1,this.horizontalBreakpoint=Qn,this.canvasHeightBreakpoint=zo.h,this.viewContentMode=Bt,this.viewLayoutStatus=mt,this.viewMode=Kl,this.viewUI=G,this.viewWindow=_n,this.columnLayoutStatus=mt.Hide,this.drawerExpandable=!0,this.drawerOpen=!1,this.loadLabel="",this.chapterLoadProgress=0,this.chaptersLoaded=0,this.isBackgroundLight=!0,this.selectedChapterLoading=!1,this.viewToolsMode=lm,this.viewLayout$=new Li.t(Yn.Column),this.showZones=[],this.focusOrigin="",this.isLogoRaised=!1,this.ngUnsubscribe=new k.B}ngOnInit(){this.resetScene();const i=this.activatedRoute.snapshot.queryParams,{id:t,type:o,lang:s}=this.viewService.normalizeQueryParams(i),a="true"===i.xr;this.contentId=t,this.contentType=o,this.contentLang=s,this.store.dispatch(new Ui.W.SetEnabled(a))}ngAfterViewInit(){this.viewService.setViewLanguage(this.contentLang),this.loadStory(),this.store.dispatch(new Je.Ds({tag:!0,pin:!1})),this.store.dispatch(new st.kE(!0));const i=this.store.selectSnapshot(Ke.getUI).loader.template,t=this.store.selectSnapshot(Ke.getUI).xrLoader.template;this.store.dispatch(new st.Ti(i===Gi.Bar)),this.store.selectSnapshot(On.U.getXREnabled)&&t!==Di.None?this.store.dispatch(new E.ToggleWindow(_n.XRLoader,!0)):i!==Gi.None&&this.store.dispatch(new E.ToggleWindow(_n.Loader,!0)),this.liveAnnouncer.announce("Loading","polite"),this.store.select(Ke.getUIEntry(G.Playthrough)).pipe((0,D.p)(a=>a.enable),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(a=>{this.store.dispatch(new E.SetPlaythroughEnabled(a.enable))}),this.checkCapabilities(),this.initSizeObservers(),this.initHeaderObserver(),this.initViewUIObserver(),this.initUIObserver(),this.initKeyboardObserver(),this.initLoadProgressObserver(),this.initPlaythroughObserver(),this.initWindowObserver(),this.initMobileNav(),this.initBackgroundColorObserver(),this.initResponsiveLabels(),this.initNodeObserver(),this.initChapterObserver(),this.initChapterAudioPlayer(),this.initToolsFadeout(),this.initAccessibility(),this.initTooltips(),this.initQuizStateListener(),this.initVisibilityLayers(),this.storyId$.pipe((0,D.p)(a=>!(0,u.isNil)(a)&&"preview"!==a),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.initVendorAnalyticsEvents()),this.initAnatomyTree()}ngOnDestroy(){this.store.dispatch(new st.t5(!1)),this.store.dispatch(new vl),this.store.dispatch(new Je.S3),po.isFullscreen()&&po.exitFullscreen(),this.viewQuizService.exitQuiz(),this.unbindKeyboard(),this.mediaService.stopAllAudio(),this.mediaService.removeAllAudioPlayers(),this.store.dispatch(new yi.ResetAudio),this.viewPlaythroughService.clearChapterTimers(),this.destroyVisibilityLayers(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.focusMonitor.stopMonitoring(document.body),this.viewService.unobserveMaterialOverlay()}loadStory(){this.onDemand$.pipe((0,D.p)(i=>!i),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.viewService.initStory(this.contentId,this.contentType,this.contentLang)})}checkCapabilities(){const i=(0,ya.ZO)(),t=(0,ya.yd)();this.store.dispatch(new E.SetCanHover(i)),this.store.dispatch(new E.SetCanTouch(t)),this.store.dispatch(new E.SetCanFullscreen(po.canFullscreen())),this.store.dispatch(new E.SetInputMode(t?Os.Touch:Os.Mouse)),(0,Sn.R)(window,"orientationchange").pipe((0,wn.B)(100),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new E.SetCanHover((0,ya.ZO)())),this.store.dispatch(new E.SetCanTouch((0,ya.yd)()))})}initResponsiveLabels(){const i=(0,Sn.R)(window,"resize").pipe((0,wn.B)(100)),t=this.store.select(de.getLabelsBreakpoint),o=this.store.select(et.getSelectedLabel),s=this.store.select(et.getLabelsCollapsed);o.pipe((0,D.p)(()=>this.store.selectSnapshot(et.getLabelsCollapsed)),(0,p.Q)(this.ngUnsubscribe)).subscribe(a=>{this.viewService.toggleLabelInfo(null!=a)}),s.pipe((0,D.p)(()=>!!this.store.selectSnapshot(et.getSelectedLabel)),(0,p.Q)(this.ngUnsubscribe)).subscribe(a=>{this.viewService.toggleLabelInfo(a)}),(0,cn.z)(i,t).pipe((0,D.p)(([,a])=>!(0,u.isNil)(a)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkLabelsCollapsed()}),this.checkLabelsCollapsed()}initSizeObservers(){const i=kv({strategy:"scroll"});(0,Sn.R)(window,"resize").pipe((0,wn.B)(10),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateViewHeight(),this.refreshLayout()}),new h.c(s=>{i.listenTo(this.engineContainer.nativeElement,()=>{s.next()})}).pipe((0,wn.B)(10)).subscribe(()=>{this.resizeEngineContainer()})}initHeaderObserver(){this.store.select(vn.getSiteHeader).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.updateViewHeight()})}initUIObserver(){this.viewUI$.pipe((0,D.p)(i=>!(0,u.isNil)(i)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.refreshLayout()}),this.viewUI$.pipe((0,D.p)(i=>!(0,u.isNil)(i)),(0,Ho.Z)(100),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applicationEventService.fireEvent(rt.F.UIUpdated,i)}),this.viewWindow$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.applicationEventService.fireEvent(rt.F.UIWindowUpdated,i)}),(0,cn.z)([this.viewLayout$,this.isMobileWeb$,this.drawerVisible$,this.paginationVisible$,this.titleOnlyVisible$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o,s,a])=>{this.isLogoRaised=!(!t||i!==Yn.Drawer)&&(!o&&a||s&&o)})}initViewUIObserver(){(0,cn.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$,Dv(this.engineContainer.nativeElement),this.viewWindow$,this.store.select(me.N.getSelectedChapterId),this.store.select(Ai.getStoryLoadProgress),this.store.select(Ke.getUI),this.store.select(et.getSelectedLabel)]).pipe((0,p.Q)(this.ngUnsubscribe),(0,wn.B)(30)).subscribe(()=>{this.store.dispatch(new Vn.ToggleVisible({[G.Audio]:this.viewUIService.isVisible(G.Audio),[G.Camera]:this.viewUIService.isVisible(G.Camera),[G.Column]:this.viewUIService.isVisible(G.Column),[G.ColumnToggle]:this.viewUIService.isVisible(G.ColumnToggle),[G.Drawer]:this.viewUIService.isVisible(G.Drawer),[G.DrawerToggle]:this.viewUIService.isVisible(G.DrawerToggle),[G.Description]:this.viewUIService.isVisible(G.Description),[G.Fullscreen]:this.viewUIService.isVisible(G.Fullscreen),[G.Help]:this.viewUIService.isVisible(G.Help),[G.LabelList]:this.viewUIService.isVisible(G.LabelList),[G.Legend]:this.viewUIService.isVisible(G.Legend),[G.Logo]:this.viewUIService.isVisible(G.Logo),[G.Media]:this.viewUIService.isVisible(G.Media),[G.ToolbarOverflow]:this.viewUIService.isVisible(G.ToolbarOverflow),[G.NodeInfo]:this.viewUIService.isVisible(G.NodeInfo),[G.Pagination]:this.viewUIService.isVisible(G.Pagination),[G.Playthrough]:this.viewUIService.isVisible(G.Playthrough),[G.QuizPrompt]:this.viewUIService.isVisible(G.QuizPrompt),[G.Search]:this.viewUIService.isVisible(G.Search),[G.TitleOnly]:this.viewUIService.isVisible(G.TitleOnly),[G.Toolbar]:this.viewUIService.isVisible(G.Toolbar),[G.Tools]:this.viewUIService.isVisible(G.Tools),[G.ToggleLabels]:this.viewUIService.isVisible(G.ToggleLabels),[G.Undo]:this.viewUIService.isVisible(G.Undo),[G.VisibilityLayers]:this.viewUIService.isVisible(G.VisibilityLayers),[G.SkinLayers]:this.viewUIService.isVisible(G.SkinLayers),[G.Whiteboard]:this.viewUIService.isVisible(G.Whiteboard)}))})}initKeyboardObserver(){this.inputEnabled$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{i?this.bindKeyboard():this.unbindKeyboard()})}initNodeObserver(){this.actions.pipe((0,l.xi)(st.zE),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.viewService.delegateNodeClick(i.node,i.event)}),this.store.select(Rn.z.getSelectedNode).pipe((0,ks.J)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const o=(0,u.get)(i,"objectId",void 0),s=(0,u.get)(t,"objectId",void 0);(void 0===t||o!==s)&&this.viewService.toggleNodeInfo(!1)})}initChapterObserver(){this.store.select(me.N.getSelectedChapterId).pipe((0,D.p)(i=>!!i),(0,W.T)(()=>this.store.selectSnapshot(me.N.getSelectedChapter)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new Je.S3),this.setPageTitle(i),this.refreshLayout(),this.viewService.resetUI(),this.viewService.resetContentMode()}),this.store.select(ze.S.getChapter).pipe((0,D.p)(i=>!!i),(0,W.T)(()=>this.store.selectSnapshot(me.N.getSelectedChapter)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.viewService.applyChapterCamera(i),this.viewService.applyChapterScenegraph(i),this.engineService.fireEvent(Ct.X.SceneLoaded,null);const t=this.store.selectSnapshot(me.N.getChapterPagination);if(this.liveAnnouncer.announce(i.displayName?`Changed to ${i.displayName}, ${t.label}`:`Changed to ${t.label}`),this.store.selectSnapshot(de.getPlaythroughEnabled)){const s=this.store.selectSnapshot(de.getForceAudio);this.viewPlaythroughService.startChapterTimers(i,s);const a=this.store.selectSnapshot(me.N.getNextChapter);this.viewPlaythroughService.preloadAudio([a],s)}})}startPlaythroughMonitoring(){this.stopPlaythroughMonitoring(),this.playthroughMonitor$=(0,cn.z)([this.viewPlaythroughService.audioSubject,this.viewPlaythroughService.animationSubject,this.viewPlaythroughService.readingSubject,this.viewPlaythroughService.minimumSubject]).pipe((0,Ho.Z)(50),(0,W.T)(([i,t,o,s])=>i.complete&&t.complete&&o.complete&&s.complete),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{i&&this.viewPlaythroughService.startCountdown()}),this.playthroughCountdown$=this.viewPlaythroughService.countdownComplete.pipe((0,D.p)(()=>this.store.selectSnapshot(de.getPlaythroughEnabled)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(de.getPlaythroughSettings);this.store.selectSnapshot(me.N.isLastChapter)?i.loop?this.viewService.firstChapter("Playthrough Loop"):this.openPlaythroughDialog():this.viewService.nextChapter("playthrough")}),this.playthroughInterrupt$=(0,ki.h)((0,Sn.R)(document,"mousemove").pipe((0,Ho.Z)(50),(0,D.p)(i=>i.buttons>0)),(0,Sn.R)(document,"mousedown"),(0,Sn.R)(document,"keydown"),(0,Sn.R)(document,"wheel")).pipe((0,D.p)(()=>this.viewPlaythroughService.audioSubject.getValue().complete&&this.viewPlaythroughService.animationSubject.getValue().complete&&this.viewPlaythroughService.readingSubject.getValue().complete&&this.viewPlaythroughService.minimumSubject.getValue().complete),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.viewPlaythroughService.delayCountdown()})}stopPlaythroughMonitoring(){[this.playthroughMonitor$,this.playthroughCountdown$,this.playthroughInterrupt$].forEach(i=>{i instanceof Rv.yU&&i.unsubscribe()})}openPlaythroughDialog(){(0,u.isNil)(this.playthroughDialog)&&(this.playthroughDialog=this.dialog.open(Sr,{width:"100%",height:"100%"}),this.playthroughDialog.closed.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{switch(i){case"explore":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewService.firstChapter("Playthrough Modal - Explore");break;case"playAgain":this.viewService.togglePlaythrough(!0,!0),this.viewService.firstChapter("Playthrough Modal - Play Again");break;case"takeQuiz":this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1),this.viewQuizService.startQuiz();break;default:this.stopPlaythrough(),this.viewService.togglePlaythrough(!1,!1)}this.playthroughDialog=null}))}initChapterAudioPlayer(){this.store.select(me.N.getSelectedChapterId).pipe((0,D.p)(i=>!!i),(0,is.M)(()=>{this.mediaService.stopAllAudio()}),(0,wn.B)(300),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(de.getForceAudio);this.store.selectSnapshot(Fe.j.getQuizModeActive)||(i||this.viewUIService.isAudioVisible())&&this.viewService.playChapterAudio(i)})}initLoadProgressObserver(){this.chapterLoadProgress=0,this.store.select(Ai.getChaptersLoadProgress).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(dt.getLoadingChapter),o=this.store.selectSnapshot(me.N.getSelectedChapterId);if(!(0,u.isNil)(t)&&o===t.chapterId){const a=100*(i[o]??0),r=this.store.selectSnapshot(de.getOpenWindow)===_n.XRLoader;this.store.dispatch(new E.ToggleWindow(_n.Loader,!r)),this.chapterLoadProgress=a,this.changeDetectorRef.markForCheck()}}),this.store.select(Ai.getStoryLoadProgress).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.engineService.fireEvent(Ct.X.HumanProgress,{progress:i})}),this.actions.pipe((0,l.rM)(ct.dC),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.chapterLoadProgress=100,this.changeDetectorRef.markForCheck(),this.store.dispatch(new E.ToggleWindow(_n.Loader,!1)),this.liveAnnouncer.announce("Loading complete","polite")})}initPlaythroughObserver(){(0,cn.z)([this.store.select(de.getPlaythroughEnabled),this.viewWindow$,this.quizModeActive$]).pipe((0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o])=>{i&&null===t&&!0!==o?this.startPlaythrough():this.stopPlaythrough()})}initWindowObserver(){this.viewWindow$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{if(this.viewService.resetUI(),i===_n.Tutorial||i===_n.Interact)this.viewService.resetChapter(),this.viewService.toggleLabels(!1);else{const t=this.viewUIService.isUIEnabled(G.Labels);this.viewService.toggleLabels(t)}})}initMobileNav(){const i=(this.platform.ANDROID||this.platform.IOS||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(!function Lv(){try{return window.self!==window.top}catch{return!0}}()||z.c.platform===Ls.N.SDK);this.store.dispatch(new E.SetIsMobileWeb(i))}initBackgroundColorObserver(){this.background$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.isBackgroundLight=(0,Ds.T4)(i),this.changeDetectorRef.markForCheck()})}initToolsFadeout(){this.showTools$.pipe((0,p.Q)(this.ngUnsubscribe),(0,Tn.F)()).subscribe(o=>{this.showZones=this.store.selectSnapshot(de.getIsMobileWeb)?o?["top","right","bottom","left"]:["bottom"]:o?["top","right","bottom","left"]:["top"],this.changeDetectorRef.markForCheck()});const i=this.store.selectSnapshot(de.getFadeout);0===i&&this.showTools$.next(!0);const t=this.store.selectSnapshot(de.getIsMobileWeb);this.viewLayout$.pipe((0,p.Q)(this.ngUnsubscribe),(0,Tn.F)()).subscribe(o=>{this.showTools$.next(o===Yn.Column||0===i||t)}),this.showTools$.pipe((0,D.p)(o=>!0===o),(0,D.p)(()=>0!==i),(0,wn.B)(this.store.selectSnapshot(de.getFadeout)),(0,D.p)(()=>this.viewLayout$.getValue()!==Yn.Column),(0,D.p)(()=>!t),(0,D.p)(()=>!this.store.selectSnapshot(de.getFadeoutPaused)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.showTools$.next(!1)}),this.focusMonitor.monitor(document.body,!0).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{this.focusOrigin=o,("keyboard"===o||"touch"===o)&&this.showTools$.next(!0)}),this.viewService.observeMaterialOverlay(),this.viewService.materialOverlayOut$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new E.SetPreventFadeoutEvent("overlay",this.viewService.isMaterialMenuOut()))})}initVendorAnalyticsEvents(){const i={totalQuestions:0};this.store.select(Fe.j.getQuestionTotal).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{i.totalQuestions=t}),this.store.select(Fe.j.getQuizModeActive).pipe((0,D.p)(()=>this.store.selectSnapshot(Fe.j.getQuestionTotal)>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.vendorAnalyticsService.track("Quiz - Entered",i)}),this.actions.pipe((0,l.xi)(Xt.B.SubmitQuestionAnswer),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(Fe.j.getActiveQuestionIndex),o=this.store.selectSnapshot(Fe.j.getQuestionsRemaining);0===t&&this.vendorAnalyticsService.track("Quiz - First Question Answered",i),0===o&&this.vendorAnalyticsService.track("Quiz - Completed",i)}),this.store.select(me.N.getSelectedChapterModelReady).pipe((0,D.p)(t=>t),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{const t=this.store.selectSnapshot(dt.getStoryId),o=this.store.selectSnapshot(dt.getStory);this.vendorAnalyticsService.trackOncePerPage("View - Loaded",{id:t,chapters:o.chapters.length,tour:o.tags.includes("tour"),animated:o.tags.includes("animated"),quiz:this.store.selectSnapshot(Fe.j.hasQuiz),edit:!1})})}initAccessibility(){this.actions.pipe((0,l.xi)(Vt.yr)).subscribe(i=>{this.liveAnnouncer.announce("Object "+(i.show?"shown":"hidden"))})}initTooltips(){this.mediaUI$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.mediaBarTooltip="collapse"===i?.status?$localize`Open Media Bar`:$localize`Close Media Bar`,this.changeDetectorRef.markForCheck()})}initQuizStateListener(){(0,cn.z)([this.actions.pipe((0,l.rM)(ct.t1)),this.store.select(ft.getSelectedBookmarkViewMode)]).pipe((0,D.p)(([,i])=>!(0,u.isNil)(i)),(0,p.Q)(this.ngUnsubscribe)).subscribe(([,i])=>{const t=this.store.selectSnapshot(Fe.j.getQuizSettings);this.store.dispatch(new Xt.B.SetQuizSettings({...t,enabled:i!==we.Content}))})}initVisibilityLayers(){this.visibilityLayersService.initObservables(),this.legacyVisibilityLayersService.initObservables()}destroyVisibilityLayers(){this.visibilityLayersService.destroyObservables(),this.legacyVisibilityLayersService.destroyObservables()}initAnatomyTree(){this.store.dispatch(new Vv.Z(!1))}handleExitARClick(){this.store.dispatch(new E.ToggleWindow(_n.XRLoader,!1))}handleFirstClickTracking(i){i.composedPath().some(a=>"APP-SITE-HEADER"===a.nodeName)||1===this.store.selectSnapshot(Ai.getStoryLoadProgress)&&this.vendorAnalyticsService.trackOncePerPage("First Click")}handleToggleAutoplay(i){this.viewService.toggleAutoplay(i)}handleColumnToggle(){this.viewService.toggleColumn(),this.changeDetectorRef.markForCheck()}handleDrawClick(){this.viewService.toggleWhiteboard(!0)}handleQuizClick(){this.viewQuizService.startQuiz()}handleExitQuiz(){this.viewQuizService.exitQuiz()}handleToggleSearch(i){this.viewService.toggleSearch(uo.q.Tree,i)}handleToggleLayers(){this.viewService.toggleLayers(!1)}handleSelectTool(i){this.viewService.selectTool(i)}handleToggleMedia(i){this.viewService.toggleMedia(i)}checkLabelsCollapsed(){const i=this.store.selectSnapshot(Dn.getHorizontalBreakpoint),t=this.store.selectSnapshot(de.getLabelsBreakpoint),o=this.isLabelBreaking(t);this.store.dispatch(new Je.vf(o,i>=Qn.Large?tr.Q.Toggle:tr.Q.None))}isLabelBreaking(i){return window.innerWidth<i}bindKeyboard(){oi.bind("1",()=>this.viewService.selectTool(dn.s.Select)),oi.bind("2",()=>this.viewService.selectTool(dn.s.Hide)),oi.bind("3",()=>this.viewService.selectTool(dn.s.Fade)),oi.bind(["command+,","ctrl+,"],i=>{i.preventDefault(),this.store.selectSnapshot(Dn.getHorizontalBreakpoint)>Qn.Medium?this.viewService.toggleColumn():this.viewService.toggleDrawer(),this.changeDetectorRef.markForCheck()}),oi.bind(["command+enter","ctrl+enter","command+p"],i=>{i.preventDefault(),po.toggleFullscreen()}),oi.bind("meta+z",i=>{i.preventDefault(),this.viewService.undo()}),oi.bind(["meta+y","meta+shift+z"],i=>{i.preventDefault(),this.viewService.redo()}),oi.bind([".","pagedown"],()=>this.viewService.nextChapter("Keyboard")),oi.bind([",","pageup"],()=>this.viewService.previousChapter("Keyboard")),oi.bind(["del","backspace"],i=>{i.preventDefault(),this.viewService.hideSelectedStructures()}),oi.bind("R",i=>{i.preventDefault(),this.viewService.resetChapter()}),oi.bind("p",i=>{i.preventDefault(),this.viewService.togglePan()}),oi.bind("/",()=>{const i=this.store.selectSnapshot(Fe.j.getQuizModeActive),t=this.store.selectSnapshot(Ke.getUIEntry(G.Search))?.enable??!1;!i&&t&&this.viewService.toggleSearch()}),oi.bind("?",()=>this.viewService.toggleHelp(te.Shortcuts)),oi.bind(["space","k"],i=>{i.preventDefault(),this.viewService.toggleAnimation()}),oi.bind(["j","l"],i=>{switch(i.preventDefault(),i.key){case"j":this.animationService.scrubRelative(-1,!0);break;case"l":this.animationService.scrubRelative(1,!0)}}),oi.bind(["H","I","F"],i=>{i.preventDefault();const t=this.store.selectSnapshot(Rn.z.getCheckedNodeIds);if(t.length>0)switch(i.key){case"H":this.store.dispatch(new Vt.yr(!1,t));break;case"I":this.nodeService.hideInverse(t);break;case"F":this.nodeService.fade(t)}})}unbindKeyboard(){oi.reset()}resizeEngineContainer(){const{top:i,left:t,width:o,height:s}=this.engineContainer.nativeElement.getBoundingClientRect(),a=new Nv.j(o,s,t,i,o,s,hp.g.Shown,1);this.store.dispatch(new st.Sh(a))}updateViewHeight(){const i=this.store.selectSnapshot(vn.getSiteHeader),s=rp(i,this.store.selectSnapshot(vn.getSiteHeaderHeight),Bl(i));this.view.nativeElement.style.setProperty("--vh",`${s}px`)}resetScene(){this.store.dispatch(new st.t5(!0)),this.store.dispatch(new st.dB(!1)),this.store.dispatch(new st.pL(dn.s.Select)),this.store.dispatch(new vl),this.store.dispatch(new Ut.pU(!1)),this.engineService.getEvent(Ct.X.AssetsLoadProgress).pipe((0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new st.dB(!0))})}refreshLayout(){const i=this.store.selectSnapshot(Ke.getUI),t=this.store.selectSnapshot(de.getLayout);this.viewLayout$.next(this.viewUIService.getViewLayout(t)),this.columnLayoutStatus=i.column.status,this.updateViewHeight(),this.resizeEngineContainer(),this.store.dispatch(new Je.Tz(i.anatomyLabels.enable??!0,i.nodeInfo.enable??!0,!0,i.nodeAudio.enable??!0)),this.store.dispatch(new st.Gv((i.labels.enable??!0)&&(i.labels.shown??!0))),this.changeDetectorRef.markForCheck()}setPageTitle(i){const t=(0,u.get)(i,"displayName");this.title.setTitle((t?`${t} | `:"")+"BioDigital Human Platform")}deselectLabel(){this.store.dispatch(new Je.TR(null))}startPlaythrough(){this.startPlaythroughMonitoring();const i=this.store.selectSnapshot(de.getPlaythroughSettings);this.store.dispatch(new E.SetForceAudio(i.forceAudio));const t=i.forceAudio,o=this.store.selectSnapshot(me.N.getSelectedChapter),s=this.store.selectSnapshot(de.getViewLanguage);(t||this.mediaService.chapterHasAudio(o,s))&&(this.store.dispatch(new yi.SetAudioMuted(!1)),this.viewService.playChapterAudio(t),this.store.dispatch(new Vn.ToggleVisible({[G.Audio]:!0}))),this.viewPlaythroughService.startChapterTimers(o,t)}stopPlaythrough(){this.stopPlaythroughMonitoring(),this.viewPlaythroughService.clearChapterTimers(),this.mediaService.stopAllAudio(),this.mediaService.muteAudio(),this.store.dispatch(new yi.SetAudioMuted(!0))}static#e=this.\u0275fac=function(t){return new(t||ht)(e.rXU(K.nX),e.rXU(e.gRc),e.rXU(l.il),e.rXU(l.En),e.rXU(mo.Ai),e.rXU(En),e.rXU(ba),e.rXU(lp),e.rXU(v.y),e.rXU(fp.w),e.rXU(co.O),e.rXU(Po.S),e.rXU(ve),e.rXU(vi),e.rXU(c.hE),e.rXU(ke.OD),e.rXU(dm),e.rXU(mo.FN),e.rXU(_m.lG),e.rXU(wo),e.rXU(to))};static#t=this.\u0275cmp=e.VBU({type:ht,selectors:[["app-view-page"]],viewQuery:function(t,o){if(1&t&&(e.GBs(SR,7),e.GBs(bR,7),e.GBs(yR,5),e.GBs(vR,7),e.GBs(ER,7),e.GBs(CR,5),e.GBs(TR,5),e.GBs(OR,7),e.GBs(MR,5)),2&t){let s;e.mGM(s=e.lsd())&&(o.viewContainer=s.first),e.mGM(s=e.lsd())&&(o.columnContainer=s.first),e.mGM(s=e.lsd())&&(o.drawerContainer=s.first),e.mGM(s=e.lsd())&&(o.engineContainer=s.first),e.mGM(s=e.lsd())&&(o.view=s.first),e.mGM(s=e.lsd())&&(o.viewCameraBar=s.first),e.mGM(s=e.lsd())&&(o.viewLogo=s.first),e.mGM(s=e.lsd())&&(o.viewSceneBase=s.first),e.mGM(s=e.lsd())&&(o.viewToolbar=s.first)}},hostBindings:function(t,o){1&t&&e.bIt("click",function(a){return o.onClick(a)},!1,e.EBC)("mousemove",function(a){return o.onActive(a)},!1,e.EBC)("mouseenter",function(a){return o.onActive(a)},!1,e.EBC)("touchstart",function(a){return o.onActive(a)},!1,e.EBC)("mouseleave",function(a){return o.onInactive(a)},!1,e.EBC)},decls:83,vars:116,consts:()=>{let i,t,o,s,a,r,_,g,P;return i=$localize`:66a82c6638b304a349b7d43b13482fa7493419c91556772664146095223:Take Quiz`,t=$localize`:a8428f42065b95600de48a6a73096f397fe775487584706465725808283:Media Controls`,o=$localize`:76fbeb67fc76fbebecb31395a76d10d6f65188f44157627069774048070:Exit Quiz`,s=$localize`:774e30c83aba684afbcbdfc30ab51e5ccdbb08ef5018030683477673235:Close Anatomy`,a=$localize`:b4c7cd9839a91a097a7d23041261d812818f26881240960779977380559:Anatomy Search`,r=$localize`:8d649ab3a81d2e70497b706acb98ee078c9625cf6438735765171590350:Close anatomy column`,_=$localize`:e6871f3c841a7ea3095d82216180cdf00363e6307224674749555007457:Close Anatomy Layers`,g=$localize`:3a7999f75941d258d1b67979cf1dc683a5db872b8605048384026546143:Anatomy Layers`,P=$localize`:c02273112dd8379f0d352a3b817f7c69bc525b3c7920034665687725450:Close layers`,[["viewContainer",""],["view",""],["engineContainer",""],["viewSceneBase",""],["columnContainer",""],["drawerContainer",""],i,o,a,r,g,P,["id","viewContainer",3,"hidden"],[1,"view-page",3,"ngClass"],["id","engine-container","data-test","viewEngineContainer",1,"view-page__engine"],[3,"contextMenuEnable"],[3,"showZones"],["left",""],[4,"ngIf"],[3,"layout",4,"ngIf"],["top","",4,"ngIf"],["right",""],[1,"flex","flex-col","items-end","justify-end","h-full"],[1,"flex-auto"],[1,"flex","flex-col","gap-2"],["orientation","vertical","data-test","viewFullscreen",4,"ngIf"],["bottom",""],["class","w-full",4,"ngIf"],["class","view-page__logo",3,"ngClass","logoColor","logoSize",4,"ngIf"],["class","view-page__exit-quiz",4,"ngIf"],[1,"view-page__scene-base"],["class","view-page__column",4,"ngIf"],["data-test","viewSearch",3,"floating","padded","wide",4,"ngIf"],["data-test","viewVisibilityLayers",3,"wide","floating","padded",4,"ngIf"],["class","view-page__drawer",4,"ngIf"],["class","view-block-input",4,"ngIf"],[3,"contentId","contentType"],["data-test","viewWhiteboard"],[3,"platform","mode","contentBlocks","title"],[3,"show","percent",4,"ngIf"],[4,"appFlagApplication","appFlagApplicationMode","appFlagApplicationNative"],[3,"layout"],["top",""],["class","w-full view-page__title-nav",4,"ngIf"],[1,"w-full","view-page__title-nav"],["class","view-page__drawer-nav",3,"ngClass",4,"ngIf"],[1,"view-page__drawer-nav",3,"ngClass"],[3,"showPagination",4,"ngIf"],["appPreventFadeout","",4,"ngIf"],[3,"showPagination"],["appPreventFadeout",""],["app-view-button","","buttonSize","small",3,"click"],["size","lg","icon","user-graduate"],["class","flex justify-between w-full",4,"ngIf"],[1,"flex","justify-between","w-full"],[1,"flex","gap-2"],[1,"max-w-sm",3,"showPagination"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click",4,"ngIf"],["app-view-button","","buttonSize","small","data-test","viewQuizButton",3,"click"],["icon","user-graduate",1,"pl-3"],[1,"px-3","text-xs","font-semibold","uppercase"],["padding","none"],[3,"mode","title","modelUrl","transparent","bordered","compact"],["orientation","vertical","data-test","viewFullscreen"],["buttonSize","small"],[1,"w-full"],["class","flex justify-end gap-2","role","group","aria-label",t,4,"ngIf"],["class","view-page__mobile-nav",3,"ngClass",4,"ngIf"],["role","group","aria-label",t,1,"flex","justify-end","gap-2"],[3,"ngClass",4,"ngIf"],["orientation","horizontal",4,"ngIf"],[3,"ngClass"],["orientation","horizontal","appPreventFadeout","",3,"ngClass"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"matTooltip","thin","click",4,"ngIf"],["orientation","horizontal"],[1,"w-full",3,"autoFocus","showSpeed","showScrubber"],["appPreventFadeout","","app-view-button","","matTooltipPosition","left","buttonSize","small","data-test","viewMediaToggle",3,"click","matTooltip","thin"],["icon","angle-right","appLogicalDir",""],["icon","angle-left","appLogicalDir",""],[1,"view-page__mobile-nav",3,"ngClass"],[2,"min-width","0",3,"ngClass"],[3,"showPagination","showTitle",4,"ngIf"],[3,"showPagination","showTitle"],[1,"view-page__logo",3,"ngClass","logoColor","logoSize"],[1,"view-page__exit-quiz"],[1,"px-3","text-xs","uppercase"],[1,"view-page__column"],["data-test","viewSearch",3,"floating","padded","wide"],["header",""],[1,"flex","justify-between"],[1,"px-3","py-6","text-base","font-semibold"],["app-view-button","","matTooltip",s,"matTooltipPosition","right","data-test","viewSearchClose",3,"click"],["icon","times"],[1,"sr-only"],["body",""],[1,"h-full","px-3"],["data-test","viewVisibilityLayers",3,"wide","floating","padded"],["app-view-button","","matTooltip",_,"matTooltipPosition","right","data-test","viewVisibilityLayersClose",3,"click"],[1,"h-full","px-3","py-4"],[1,"view-page__drawer"],[1,"view-block-input"],[3,"learnMoreClick","platform","mode","contentBlocks","title"],[3,"percent"],[3,"show","percent"]]},template:function(t,o){if(1&t&&(e.j41(0,"div",12,0),e.nI1(2,"async"),e.j41(3,"div",13,1),e.nI1(5,"async"),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.nI1(10,"async"),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"async"),e.nI1(14,"async"),e.j41(15,"div",14,2),e.nrm(17,"app-engine",15),e.nI1(18,"async"),e.j41(19,"app-view-zones",16),e.qex(20,17),e.DNE(21,kR,1,0,"app-view-toolbar",18),e.nI1(22,"async"),e.DNE(23,DR,2,3,"app-view-undo",19),e.nI1(24,"async"),e.bVm(),e.DNE(25,GR,6,9,"ng-container",20),e.nI1(26,"async"),e.nI1(27,"async"),e.DNE(28,QR,5,7,"ng-container",20),e.nI1(29,"async"),e.DNE(30,YR,1,0,"ng-container",20),e.nI1(31,"async"),e.nI1(32,"async"),e.qex(33,21),e.j41(34,"div",22),e.DNE(35,KR,5,10,"div",23),e.nI1(36,"async"),e.nI1(37,"async"),e.nI1(38,"async"),e.nI1(39,"async"),e.j41(40,"div",24),e.DNE(41,qR,1,0,"app-engine-camera-bar",18),e.nI1(42,"async"),e.DNE(43,JR,2,0,"app-pillbox",25),e.nI1(44,"async"),e.k0s()(),e.bVm(),e.qex(45,26),e.DNE(46,rN,6,8,"div",27),e.nI1(47,"async"),e.nI1(48,"async"),e.bVm(),e.k0s(),e.DNE(49,lN,5,15,"app-view-logo",28),e.nI1(50,"async"),e.DNE(51,cN,5,0,"div",29),e.nI1(52,"async"),e.nI1(53,"async"),e.nrm(54,"div",30,3),e.k0s(),e.j41(56,"div",null,4),e.DNE(58,dN,1,0,"app-view-column-container",31),e.nI1(59,"async"),e.DNE(60,_N,13,5,"app-view-column",32),e.nI1(61,"async"),e.DNE(62,pN,13,5,"app-view-column",33),e.nI1(63,"async"),e.nI1(64,"async"),e.k0s(),e.DNE(65,uN,3,0,"div",34),e.nI1(66,"async"),e.k0s()(),e.DNE(67,hN,1,0,"div",35),e.nI1(68,"async"),e.DNE(69,gN,1,2,"app-view-ondemand",36),e.nI1(70,"async"),e.DNE(71,mN,1,0,"app-view-tour")(72,fN,1,0,"app-view-whiteboard",37)(73,SN,5,12,"app-xr-loader-summary",38)(74,CN,6,3,"app-view-loader")(75,TN,2,4,"app-view-progress",39),e.nI1(76,"async"),e.DNE(77,ON,1,0,"app-view-print",18),e.nI1(78,"async"),e.DNE(79,MN,1,0,"app-view-content-warning",40),e.nrm(80,"app-view-iphone12-warning"),e.DNE(81,IN,1,0,"app-xr-overlay"),e.nI1(82,"async")),2&t){let s,a,r,_,g,P;e.Y8G("hidden",e.bMT(2,27,o.arActive$)),e.R7$(3),e.Y8G("ngClass",e.lV(107,IR,"column"===e.bMT(5,29,o.viewLayout$),"drawer"===e.bMT(6,31,o.viewLayout$),e.bMT(7,33,o.paginationVisible$),e.bMT(8,35,o.columnVisible$),!1===e.bMT(9,37,o.columnVisible$),e.bMT(10,39,o.drawerVisible$)&&"show"===(null==(s=e.bMT(11,41,o.drawerUI$))?null:s.status),!1===e.bMT(12,43,o.drawerVisible$),e.bMT(13,45,o.drawerVisible$)&&"collapse"===(null==(s=e.bMT(14,47,o.drawerUI$))?null:s.status))),e.R7$(14),e.Y8G("contextMenuEnable",null==(a=e.bMT(18,49,o.contextMenu$))?null:a.enable),e.R7$(2),e.Y8G("showZones",o.showZones),e.R7$(2),e.Y8G("ngIf",e.bMT(22,51,o.toolbarVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(24,53,o.undoVisible$)),e.R7$(2),e.Y8G("ngIf","drawer"===e.bMT(26,55,o.viewLayout$)&&!1===e.bMT(27,57,o.isMobileWeb$)),e.R7$(3),e.Y8G("ngIf","column"===e.bMT(29,59,o.viewLayout$)),e.R7$(2),e.Y8G("ngIf","drawer"===e.bMT(31,61,o.viewLayout$)&&!0===e.bMT(32,63,o.isMobileWeb$)),e.R7$(5),e.vxM((e.bMT(36,65,o.arEnabled$)||e.bMT(37,67,o.nativeAREnabled$))&&!1===e.bMT(38,69,o.arActive$)&&e.bMT(39,71,o.viewWindow$)!==o.viewWindow.XRLoader?35:-1),e.R7$(6),e.Y8G("ngIf",e.bMT(42,73,o.cameraVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(44,75,o.fullscreenVisible$)),e.R7$(3),e.Y8G("ngIf",!0===e.bMT(47,77,o.isMobileWeb$)||e.bMT(48,79,o.mediaVisible$)),e.R7$(3),e.Y8G("ngIf",e.bMT(50,81,o.logoVisible$)),e.R7$(2),e.Y8G("ngIf",e.bMT(52,83,o.quizModeActive$)&&!e.bMT(53,85,o.quizModeLocked$)),e.R7$(7),e.Y8G("ngIf",e.bMT(59,87,o.columnVisible$)),e.R7$(2),e.Y8G("ngIf","show"===(null==(r=e.bMT(61,89,o.searchUI$))?null:r.status)),e.R7$(2),e.Y8G("ngIf","show"===(null==(_=e.bMT(63,91,o.visibilityLayersUI$))?null:_.status)&&"group"===(null==(_=e.bMT(64,93,o.visibilityLayersUI$))?null:_.layersMode)),e.R7$(3),e.Y8G("ngIf",e.bMT(66,95,o.drawerVisible$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(68,97,o.inputEnabled$)),e.R7$(2),e.vxM((g=e.bMT(70,99,o.viewWindow$))===o.viewWindow.OnDemand?69:g===o.viewWindow.Tutorial?71:g===o.viewWindow.Whiteboard?72:g===o.viewWindow.XRLoader?73:g===o.viewWindow.Interact?74:-1),e.R7$(6),e.Y8G("ngIf","circle"===(null==(P=e.bMT(76,101,o.viewUI$))?null:P.loader.template)),e.R7$(2),e.Y8G("ngIf",e.bMT(78,103,o.usePrintImage$)),e.R7$(2),e.Y8G("appFlagApplication",o.application.All)("appFlagApplicationMode","include")("appFlagApplicationNative",o.nativePlatform.All),e.R7$(2),e.vxM(e.bMT(82,105,o.arActive$)?81:-1)}},dependencies:[Qt.ri,J.YU,J.bT,bp.Y,Us,Ao.e,An,Vm,ut.R,Kt.oV,no,oc,Ro,Aa,sc,Dp,$m,Km,qm,Ir,Lp,Xm,Fp,Gp,Jm,Zm,ef,tf,La,c2,Lr,Kn,U2,V2,$2,xr,jr,pA,ko,Va,Eo,Ef,mf,J.Jj],styles:['.view-page{--drawer-height: 0;--column-width: 320px;border:none;width:100vw;height:calc(var(--vh, 1vh) * 100);max-height:100vh;overflow:hidden;display:grid;transition:all .25s}.view-page--layout-column{grid-template-rows:100%;grid-template-columns:var(--column-width) 1fr;grid-template-areas:"column engine"}.view-page--layout-drawer{grid-template-rows:1fr var(--drawer-height);grid-template-columns:1fr;grid-template-areas:"engine" "drawer"}.view-page--column-open{--column-width: 320px}.view-page--column-open.view-page--show-aside{--column-width: 424px}.view-page--column-closed{--column-width: 0}.view-page--drawer-peek{--drawer-height: 40px}.view-page--drawer-open{--drawer-height: 40%}.view-page--drawer-closed.view-page--has-drawer{--drawer-height: 0}.view-page__column{background-color:#fff;grid-area:column;height:100%}.view-page__engine{grid-area:engine;width:100%;height:100%;position:relative}.view-page__drawer{max-width:100vw;border-top:1px solid #d4d9e3;background-color:#fff;grid-area:drawer}.view-page--drawer-push{padding-bottom:var(--drawer-height)}.view-page__title-nav{display:flex;justify-content:flex-start;gap:8px}.view-page__drawer-nav{display:grid;grid-template-columns:minmax(0,1fr) auto;width:auto}.view-page__drawer-nav--overflow{gap:8px}.view-page__mobile-nav{display:flex;justify-content:space-between;gap:8px;width:auto}.view-page__logo{display:inline-block;position:absolute;inset-inline-start:12px;inset-block-end:12px;z-index:10}.view-page__logo--raised{inset-block-end:62px}.view-page__exit-quiz{position:absolute;inset-block-start:12px;inset-inline-end:12px;z-index:10}.view-page__scene-base{position:absolute;left:0;bottom:0;right:0;z-index:10;transition:transform .3s}@media (prefers-reduced-motion: reduce){.view-page{transition:none}}.view-block-input{position:fixed;inset:0;z-index:10000}\n'],encapsulation:2,changeDetection:0})}St([(0,l.l6)(dt.getStory),bt("design:type",h.c)],ht.prototype,"story$",void 0),St([(0,l.l6)(dt.getStoryId),bt("design:type",h.c)],ht.prototype,"storyId$",void 0),St([(0,l.l6)(Ke.getUI),bt("design:type",h.c)],ht.prototype,"viewUI$",void 0),St([(0,l.l6)(de.getAutoplay),bt("design:type",h.c)],ht.prototype,"autoplay$",void 0),St([(0,l.l6)(de.getInputEnabled),bt("design:type",h.c)],ht.prototype,"inputEnabled$",void 0),St([(0,l.l6)(de.getIsMobileWeb),bt("design:type",h.c)],ht.prototype,"isMobileWeb$",void 0),St([(0,l.l6)(de.getContentMode),bt("design:type",h.c)],ht.prototype,"contentMode$",void 0),St([(0,l.l6)(de.getFullscreenActive),bt("design:type",h.c)],ht.prototype,"fullscreenActive$",void 0),St([(0,l.l6)(de.getDrawerCoversContent),bt("design:type",h.c)],ht.prototype,"drawerCoversContent$",void 0),St([(0,l.l6)(de.getInteractType),bt("design:type",h.c)],ht.prototype,"interactType$",void 0),St([(0,l.l6)(de.getOnDemand),bt("design:type",h.c)],ht.prototype,"onDemand$",void 0),St([(0,l.l6)(de.getShowHelpTab),bt("design:type",h.c)],ht.prototype,"showHelpTab$",void 0),St([(0,l.l6)(de.getUsePrintImage),bt("design:type",h.c)],ht.prototype,"usePrintImage$",void 0),St([(0,l.l6)(de.getOpenWindow),bt("design:type",h.c)],ht.prototype,"viewWindow$",void 0),St([(0,l.l6)(de.getTutorialSeen),bt("design:type",h.c)],ht.prototype,"tutorialSeen$",void 0),St([(0,l.l6)(Ai.getStoryLoadProgress),bt("design:type",h.c)],ht.prototype,"storyLoadProgress$",void 0),St([(0,l.l6)(Dn.getHorizontalBreakpoint),bt("design:type",h.c)],ht.prototype,"horizontalBreakpoint$",void 0),St([(0,l.l6)(Dn.getVerticalBreakpoint),bt("design:type",h.c)],ht.prototype,"verticalBreakpoint$",void 0),St([(0,l.l6)(me.N.getSelectedChapter),bt("design:type",h.c)],ht.prototype,"chapter$",void 0),St([(0,l.l6)(me.N.getSelectedChapterReadyState),bt("design:type",h.c)],ht.prototype,"selectedChapterReady$",void 0),St([(0,l.l6)(me.N.getChaptersLoaded),bt("design:type",h.c)],ht.prototype,"chaptersLoaded$",void 0),St([(0,l.l6)(me.N.getSelectedChapterIndex),bt("design:type",h.c)],ht.prototype,"chapterIndex$",void 0),St([(0,l.l6)(me.N.getChapterCount),bt("design:type",h.c)],ht.prototype,"chapterCount$",void 0),St([(0,l.l6)(me.N.getSelectedChapterBackground),bt("design:type",h.c)],ht.prototype,"background$",void 0),St([(0,l.l6)(Ke.getVisible(G.Audio)),bt("design:type",h.c)],ht.prototype,"audioVisible$",void 0),St([(0,l.l6)(ze.S.getAnimationPlaying),bt("design:type",h.c)],ht.prototype,"animationPlaying$",void 0),St([(0,l.l6)(ze.S.getHoveredNode),bt("design:type",h.c)],ht.prototype,"hoveredNode$",void 0),St([(0,l.l6)(ze.S.getActiveTool),bt("design:type",h.c)],ht.prototype,"activeTool$",void 0),St([(0,l.l6)(ze.S.getEnginePosition),bt("design:type",h.c)],ht.prototype,"enginePosition$",void 0),St([(0,l.l6)(ze.S.getCanvasHeightBreakpoint),bt("design:type",h.c)],ht.prototype,"canvasHeightBreakpoint$",void 0),St([(0,l.l6)(et.getSelectedLabel),bt("design:type",h.c)],ht.prototype,"selectedLabel$",void 0),St([(0,l.l6)(Fe.j.hasQuiz),bt("design:type",h.c)],ht.prototype,"hasQuiz$",void 0),St([(0,l.l6)(Fe.j.getQuizModeActive),bt("design:type",h.c)],ht.prototype,"quizModeActive$",void 0),St([(0,l.l6)(Fe.j.getQuizModeLocked),bt("design:type",h.c)],ht.prototype,"quizModeLocked$",void 0),St([(0,l.l6)(Fe.j.getQuizEnabled),bt("design:type",h.c)],ht.prototype,"quizEnabled$",void 0),St([(0,l.l6)(Fe.j.getActiveQuestionIndex),bt("design:type",h.c)],ht.prototype,"activeQuestionIndex$",void 0),St([(0,l.l6)(Fe.j.getQuestionTotal),bt("design:type",h.c)],ht.prototype,"questionTotal$",void 0),St([(0,l.l6)(de.getStartingTool),bt("design:type",h.c)],ht.prototype,"startingTool$",void 0),St([(0,l.l6)(Ke.getVisible(G.Camera)),bt("design:type",h.c)],ht.prototype,"cameraVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Column)),bt("design:type",h.c)],ht.prototype,"columnVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Drawer)),bt("design:type",h.c)],ht.prototype,"drawerVisible$",void 0),St([(0,l.l6)(Ke.getUIEntry(G.Drawer)),bt("design:type",h.c)],ht.prototype,"drawerUI$",void 0),St([(0,l.l6)(Ke.getVisible(G.DrawerToggle)),bt("design:type",h.c)],ht.prototype,"drawerToggleVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Fullscreen)),bt("design:type",h.c)],ht.prototype,"fullscreenVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Logo)),bt("design:type",h.c)],ht.prototype,"logoVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Media)),bt("design:type",h.c)],ht.prototype,"mediaVisible$",void 0),St([(0,l.l6)(Ke.getUIEntry(G.Media)),bt("design:type",h.c)],ht.prototype,"mediaUI$",void 0),St([(0,l.l6)(Ke.getVisible(G.NodeInfo)),bt("design:type",h.c)],ht.prototype,"nodeInfoVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.QuizPrompt)),bt("design:type",h.c)],ht.prototype,"quizPromptVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Search)),bt("design:type",h.c)],ht.prototype,"searchVisible$",void 0),St([(0,l.l6)(Ke.getUIEntry(G.Search)),bt("design:type",h.c)],ht.prototype,"searchUI$",void 0),St([(0,l.l6)(Ke.getVisible(G.TitleOnly)),bt("design:type",h.c)],ht.prototype,"titleOnlyVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Toolbar)),bt("design:type",h.c)],ht.prototype,"toolbarVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Undo)),bt("design:type",h.c)],ht.prototype,"undoVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.VisibilityLayers)),bt("design:type",h.c)],ht.prototype,"visibilityLayersVisible$",void 0),St([(0,l.l6)(Ke.getUIEntry(G.VisibilityLayers)),bt("design:type",h.c)],ht.prototype,"visibilityLayersUI$",void 0),St([(0,l.l6)(Ke.getVisible(G.ColumnToggle)),bt("design:type",h.c)],ht.prototype,"columnToggleVisible$",void 0),St([(0,l.l6)(Ke.getVisible(G.Pagination)),bt("design:type",h.c)],ht.prototype,"paginationVisible$",void 0),St([(0,l.l6)(Ke.getUIEntry(G.ContextMenu)),bt("design:type",h.c)],ht.prototype,"contextMenu$",void 0),St([(0,l.l6)(On.U.getARActive),bt("design:type",h.c)],ht.prototype,"arActive$",void 0),St([(0,l.l6)(On.U.getAREnabled),bt("design:type",h.c)],ht.prototype,"arEnabled$",void 0),St([(0,l.l6)(On.U.getNativeAREnabled),bt("design:type",h.c)],ht.prototype,"nativeAREnabled$",void 0),St([(0,l.l6)(On.U.getXRPlatform),bt("design:type",h.c)],ht.prototype,"platform$",void 0);let eu=(()=>{class n{constructor(){}resolve(t){const o={...t.queryParams},s=Object.keys(o).reduce((a,r)=>{const _=Array.isArray(o[r]);return a[r]=_?(0,u.last)(o[r]):o[r],a},{});return(0,pl.N9)(s)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})();var PN=d(26047),Lf=d(60830);function ys(n,i){const{procName:t,actionFn:o,aliases:s=[],mapFnIn:a,mapFnOut:r,hideDefinition:_=!1}=i,g=function(F){const ee=this,le=a?a(F):F,he=o(le);if(!(typeof he>"u"))if(he instanceof h.c)he.pipe((0,Lf.$)()).subscribe(ye=>{const Ge=r?r(ye):ye;ee.setResult(Ge)});else{const ue=r?r(he):he;ee.setResult(ue)}};[t,...s].forEach(F=>{n.defineAPIProcedure(F,g,{hidden:_})})}var Ce=function(n){return n.AnnotationsCreate="annotations.create",n.AnnotationsDestroy="annotations.destroy",n.AnnotationsInfo="annotations.info",n.AnnotationsSetDescription="annotations.setDescription",n.AnnotationsSetLabelsShown="annotations.setLabelsShown",n.AnnotationsSetTitle="annotations.setTitle",n.AnnotationsUpdate="annotations.update",n.AnnotationsSetEnabled="annotations.setEnabled",n.CameraInfo="camera.info",n.CameraOrbit="camera.orbit",n.CameraPan="camera.pan",n.CameraReset="camera.reset",n.CameraSet="camera.set",n.CameraZoom="camera.zoom",n.setCameraMode="camera.setCameraMode",n.CameraDisableChapterCamera="camera.disableChapterCamera",n.CameraEnableChapterCamera="camera.enableChapterCamera",n.GetAnnotationInfo="annotations.info",n.HideAnnotations="annotations.hide",n.HotspotsCreate="hotspots.create",n.HotspotsDestroy="hotspots.destroy",n.HotspotsHide="hotspots.hide",n.HotspotsInfo="hotspots.info",n.HotspotsShow="hotspots.show",n.HotspotsTypes="hotspots.types",n.HotspotsUpdate="hotspots.update",n.HumanInfo="human.info",n.HumanCanvasInfo="human.canvasInfo",n.InputDisable="input.disable",n.InputEnable="input.enable",n.LabelsCreate="labels.create",n.LabelsDestroy="labels.destroy",n.LabelsInfo="labels.info",n.LabelsHide="labels.hide",n.LabelsSetEnabled="labels.setEnabled",n.LabelsShow="labels.show",n.LabelsUpdate="labels.update",n.LabelsCanvasUpdate="labels.canvasUpdate",n.LabelsSetScale="labels.setScale",n.NativeErrorMessage="native.errorMessage",n.NativeSetSdkOffline="native.setSdkOffline",n.NativeSetAppVersion="native.setAppVersion",n.NativeRedirect="native.redirect",n.NativeReload="native.reload",n.NativeOfflineModelIds="native.offlineModelIDs",n.QuizInfo="quiz.info",n.QuizEnter="quiz.enter",n.QuizExit="quiz.exit",n.QuizQuestion="quiz.currentQuestion",n.QuizSubmit="quiz.submit",n.QuizNextQuestion="quiz.next",n.QuizPreviousQuestion="quiz.previous",n.QuizSelectQuestion="quiz.select",n.QuizSet="quiz.set",n.QuizReset="quiz.reset",n.SceneMetaData="scene.metadata",n.SceneSetHighlightColor="scene.setHighlightColor",n.SceneColorObject="scene.colorObject",n.SceneDisableHighlight="scene.disableHighlight",n.SceneEnableHighlight="scene.enableHighlight",n.SceneGetColor="scene.getColor",n.SceneInfo="scene.info",n.SceneLoad="scene.load",n.ScenePick="scene.pick",n.SceneReset="scene.reset",n.SceneSelectObjects="scene.selectObjects",n.SceneShowObjects="scene.showObjects",n.SceneTransformObject="scene.transformObject",n.SceneUncolorObject="scene.uncolorObject",n.SceneSnapshot="scene.snapshot",n.SceneCapture="scene.capture",n.SceneRestore="scene.restore",n.SceneEnableXrayMode="scene.enableXray",n.SceneDisableXrayMode="scene.disableXray",n.SceneSetLayersSliderPosition="scene.setLayersSliderPosition",n.SceneGetLayers="scene.getLayers",n.SceneGetPositions="scene.getPositions",n.SceneSetBaseDirectory="scene.setBaseDirectory",n.ShowAnnotations="annotations.show",n.SetAnnotationsShown="annotations.setShown",n.TimelineInfo="timeline.info",n.TimelineQuery="timeline.query",n.TimelineNext="timeline.nextChapter",n.TimelinePause="timeline.pause",n.TimelinePlay="timeline.play",n.TimelinePrev="timeline.previousChapter",n.TimelineSet="timeline.set",n.TimelineSetPlaybackSpeed="timeline.setPlaybackSpeed",n.TimelineGetPlaybackSpeed="timeline.getPlaybackSpeed",n.UIGetBackground="ui.getBackground",n.UIGetDisplay="ui.getDisplay",n.UIGetWorldPosition="ui.getWorldPosition",n.UISetBackground="ui.setBackground",n.UIPresetBackground="ui.presetBackground",n.UISetDisplay="ui.setDisplay",n.UIResetDisplay="ui.resetDisplay",n.UISnapshot="ui.snapshot",n.focusObject="focus.focusObject",n.dissectSetEnabled="dissect.setEnabled",n.pickSingleSetEnabled="pick.single.setEnabled",n.pickMultiSetEnabled="pick.multi.setEnabled",n.getCanvasPos="scene.getCanvasPos",n.sceneSetClickMode="scene.setClickMode",n.sceneGetClickMode="scene.getClickMode",n.IsolateObject="scene.isolateObject",n.UISetOndemand="ui.setOndemand",n.UISetLoadingExperience="ui.setLoadingExperience",n.UISetScrollCaptureMode="ui.setScrollCaptureMode",n.UISetTutorial="ui.setTutorial",n.UISetQuizLock="ui.setQuizLock",n.UIGetWindow="ui.getWindow",n.SceneGetVariantSchemas="scene.getVariantSchemas",n}(Ce||{});function Wt(n){return(0,cn.z)([n.select(me.N.getStoryChapters),n.select(ze.S.getChapter)]).pipe((0,D.p)(([i,t])=>!(0,u.isEmpty)(i)&&!!t),(0,ws.c)(0),(0,qt.s)(1))}function vs(n){return n.select(me.N.getAllChaptersModelsReady).pipe((0,D.p)(i=>!0===i),(0,qt.s)(1))}function vc(n){return(0,cn.z)([n.select(dt.getStory),n.select(Rn.z.getNodes)]).pipe((0,D.p)(([i,t])=>!(0,u.isNil)(i)&&!(0,u.isEmpty)(t)),(0,qt.s)(1))}function tu(n){const i=n.captureCamera();return{position:i.lookAt.eye,target:i.lookAt.look,up:i.lookAt.up,zoom:i.zoom}}var Gr,Uf=d(34525);!function(n){n.isLegacyCaptureFormat=function i(s){return void 0!==s.engineVersion},n.convertCaptureFormat=function t(s){const a=Object.keys(s.objects).reduce((r,_)=>(r.push({objectId:_,selected:!1,hidden:!1}),r),[]);return{storyId:s.timeline.rootName.replace(".json",""),camera:{lookAt:s.camera,zoom:void 0},labels:[],objects:a,background:[],activeChapterId:s.timeline.scrub?s.timeline.scrub.chapterId:void 0}},n.convertMediaFormat=function o(s){const a={};return Object.entries(s).forEach(([r,_])=>{a[r]={fullUrl:_.fullUrl,lang:_.lang,streamType:_.streamType}}),a}}(Gr||(Gr={}));let xf=(()=>{class n{static#e=this.type="[Analytics] Authorize App"}return n})(),kN=(()=>{class n{static#e=this.type="[Analytics] Auth Success";constructor(t,o){this.userType=t,this.response=o}}return n})(),jf=(()=>{class n{static#e=this.type="[Analytics] Auth Failure";constructor(t,o){this.userType=t,this.response=o}}return n})(),$r=(()=>{class n{static#e=this.type="[Analytics] Log Interaction";constructor(t,o){this.interaction=t,this.source=o}}return n})(),nu=(()=>{class n{static#e=this.type="[Analyics] Log Interaction Success";constructor(t,o){this.interaction=t,this.response=o}}return n})(),DN=(()=>{class n{static#e=this.type="[Analyics] Log Interaction Failure";constructor(t,o){this.interaction=t,this.response=o}}return n})(),Vf=(()=>{class n{static#e=this.type="[Analytics] Log View Analytic"}return n})(),iu=(()=>{class n{static#e=this.type="[Analytics] Log Interaction Chance"}return n})(),Ff=(()=>{class n{static#e=this.type="[Analytics] Log First Interaction"}return n})(),Gf=(()=>{class n{static#e=this.type="[Analytics] Reset First Interaction"}return n})();function $f(n){if(!n)return null;const{objectId:i,canvasPos:t,worldPos:o,normal:s}=n;return{objectId:i||void 0,canvasPosition:t?{x:t.x,y:t.y}:void 0,mode:"query",position:o?Xs.n.fromArray(o):void 0,normal:s?Xs.n.fromArray(s):void 0}}function ou(n,i,t){const o=n.getObjectById(t).parent;return null!==o&&(i[o.objectId].checked||ou(n,i,o.objectId))}function Bf(n,i,t){const o=i.getEvent(Ct.X.HumanStarted).pipe((0,Lf.$)()),s=t.includes("/")?Se.c.Module:Se.c.Bookmark;return n.dispatch(new ct.Ye(t,s)),o}function zf(n,i){return n.dispatch(new st._y(!0)),i.fireEvent(Ct.X.SceneXrayEnabled),!0}function $N(n){return n.find(t=>t.type==hi.m.Images)?.images?.filter(t=>null!=t.urls?.default).map(t=>t.urls.default)??[]}function YN(n,i,t,o,s,a,r,_,g,P,F,ee,le,he,ue){return[{procName:Ce.SceneMetaData,actionFn:()=>function wN(n){return(0,cn.z)([n.select(dt.getStory),n.select(me.N.getStoryChapters)]).pipe((0,D.p)(([i,t])=>!(0,u.isNil)(i)&&!(0,u.isEmpty)(t)),(0,qt.s)(1))}(n).pipe((0,W.T)(([ye,Ge])=>({title:ye.displayName,description:ye.description,chapters:Ge.map(Ve=>({id:Ve.id,title:Ve.displayName,description:Ve.description,isAnimated:r.isChapterAnimated(Ve),loops:r.isChapterLooped(Ve),duration:r.getChapterTimeFrame(Ve.id),media:Gr.convertMediaFormat(Ve.media),images:Ve.contentBlocks?$N(Ve.contentBlocks):[],thumbnail:Ve.thumbnails?Ve.thumbnails.default:""}))})))},{procName:Ce.focusObject,actionFn:ye=>(function GN(n,i,t){n.select&&n.xray?zf(i,t):yp(i,t),n.select&&i.dispatch(new Vt.q9(!0,[n.objectId])),i.dispatch(new st.W6(n.objectId,!0,1))}(ye,n,t),!0),hideDefinition:!0},{procName:Ce.dissectSetEnabled,actionFn:ye=>(n.dispatch(new st.pL(ye.enable?dn.s.Hide:dn.s.Select)),!0),hideDefinition:!0},{procName:Ce.sceneSetClickMode,actionFn:ye=>(n.dispatch(new st.pL("select"===ye?dn.s.Select:"hide"===ye?dn.s.Hide:"fade"===ye?dn.s.Fade:dn.s.Select)),!0)},{procName:Ce.sceneGetClickMode,actionFn:()=>n.selectSnapshot(ze.S.getActiveTool)},{procName:Ce.pickSingleSetEnabled,actionFn:ye=>{const Ge=(()=>{switch(ye.enable){case void 0:return!n.selectSnapshot(de.getMultiPickModeEnabled);case!0:return!1;case!1:return!0}})();return n.dispatch(new E.SetMultiPickModeEnabled(Ge)),!0},hideDefinition:!0},{procName:Ce.pickMultiSetEnabled,actionFn:ye=>{const Ge=void 0===ye.enable?!n.selectSnapshot(de.getMultiPickModeEnabled):ye.enable;return n.dispatch(new E.SetMultiPickModeEnabled(Ge)),!0},hideDefinition:!0},{procName:Ce.getCanvasPos,actionFn:ye=>{const Ge=ee.getCanvas();return function NN(n,i,t,o,s){t&&wi.add(i,t,i);const a=n.getViewMat(),r=n.getProjMat(),_=Uf.create();wi.transformMat4(_,i,a),_[3]=1,Uf.transformMat4(_,_,r);const P=_[1],F=_[3];return[Math.round((1+_[0]/F)*o/2),Math.round((1-P/F)*s/2)]}(ee,ye.worldPos,ye.offset,Ge.width,Ge.height)},hideDefinition:!0},{procName:Ce.SceneCapture,actionFn:()=>Wt(n).pipe((0,W.T)(()=>function jN(n,i,t){const o=t.captureCamera(),s=i.selectSnapshot(Rn.z.getNodes),a=Object.keys(s).map(ee=>({objectId:ee,selected:s[ee].checked||ou(n,s,ee),hidden:!s[ee].shown})),r=i.selectSnapshot(me.N.getStoryChapters).map(ee=>({chapterId:ee.id,background:ee.background||rm.RK})),_=i.selectSnapshot(dt.getStoryId);return{camera:o,labels:i.selectSnapshot(et.getLabels),storyId:_,objects:a,background:r,activeChapterId:i.selectSnapshot(me.N.getSelectedChapterId)}}(le,n,s)))},{procName:Ce.SceneRestore,actionFn:ye=>vs(n).pipe((0,Ln.Z)(()=>{const Ge=Gr.isLegacyCaptureFormat(ye),Ve=Ge?Gr.convertCaptureFormat(ye):ye;return function FN(n,i,t,o,s){return Bf(t,o,i.storyId).pipe((0,Ln.Z)(()=>(0,Vd.H)(function VN(n,i,t,o=!1){return new Promise(s=>{const a=i.objects.filter(F=>!0===F.selected).map(F=>F.objectId),r=o?n.getLeafIds().filter(ee=>void 0===i.objects.find(ue=>ue.objectId===ee)):i.objects.filter(F=>!0===F.hidden).map(F=>F.objectId),_=i.background.map(F=>new Nn.qi(F.chapterId,F.background)),g=i.activeChapterId?[new Nn.wg(i.activeChapterId)]:[],P=void 0!==i.camera.zoom?[new Ut.F5(i.camera.zoom)]:[];setTimeout(()=>{t.dispatch([new Ut.Ih(i.camera.lookAt,!1),new Je.gJ(i.labels),new Vt.yr(!1,r,void 0,void 0,void 0,!0),new Vt.q9(!0,a),...P,...g,..._]),s(void 0)})})}(n,i,t,s))),(0,is.M)(()=>{o.fireEvent(Ct.X.SceneRestored)}),(0,W.T)(()=>!0))}(le,Ve,n,t,Ge)}))},{procName:Ce.SceneEnableXrayMode,actionFn:()=>Wt(n).pipe((0,W.T)(()=>zf(n,t)))},{procName:Ce.SceneDisableXrayMode,actionFn:()=>Wt(n).pipe((0,W.T)(()=>yp(n,t)))},{procName:Ce.SceneLoad,actionFn:ye=>vs(n).pipe((0,Ln.Z)(()=>{i.pipe((0,l.xi)(ct.Z0),(0,qt.s)(1)).subscribe(()=>{t.fireEvent(Ct.X.SceneReady)});const Ge=Bf(n,t,ye);return n.dispatch(new Gf),Ge}))},{procName:Ce.SceneSetBaseDirectory,actionFn:ye=>(F.fireEvent(rt.F.NativeSetBaseDirectory,ye),!0)},{procName:Ce.NativeSetSdkOffline,actionFn:ye=>(F.fireEvent(rt.F.NativeSetSdkOffline,ye),!0)},{procName:Ce.SceneReset,actionFn:()=>(_.resetChapter(),!0)},{procName:Ce.SceneInfo,actionFn:ye=>Wt(n).pipe((0,Ln.Z)(()=>vc(n)),(0,Ln.Z)(([Ge,Ve])=>{const it=ye?.chapterId;let ot=Ve;it&&(ot=n.selectSnapshot(Rn.z.getAllNodeState)[it]??{});const _t=ye?.objectId,xt=_t?[_t]:Object.keys(le.getObjects()),$t=!!ye.objectId,{displayName:hn}=Ge;return function UN(n,i,t,o,s,a,r,_){const g=a.map(P=>function LN(n,i,t,o,s,a){const r=t.getObjectById(s),{children:_,displayName:g,parent:P,shown:F}=r,ee=t.isLeaf(r)?i[s].checked||ou(t,i,s):void 0,le=i[s].available;return(a?function xN(n,i,t){const o=n.selectSnapshot(de.getNodeInfoFallback),s=n.selectSnapshot(de.getViewLanguage);return i.queryNodeInfo(t,o,s).pipe((0,W.T)(a=>a?.description||""),(0,zi.W)(()=>(0,Rt.of)("")))}(n,o,g):(0,Rt.of)("")).pipe((0,W.T)(ue=>({objectId:s,name:g,description:ue,available:le,shown:F,selected:ee,children:_?.map(ye=>ye.objectId),parent:P?P.objectId:null})))}(n,i,t,o,P,r));return(0,di.p)(g).pipe((0,W.T)(P=>{const F=P.reduce((ee,le)=>((_||le.available)&&(ee[le.objectId]=le),ee),{});return{name:s,objects:F}}))}(n,ot,le,he,hn,xt,$t,ye?.includeUnavailable??!it)}))},{procName:Ce.ScenePick,actionFn:ye=>$f(ee.pick(ye.x,ye.y))},{procName:Ce.SceneSelectObjects,actionFn:ye=>Wt(n).pipe((0,W.T)(()=>{const Ge=!0===ye.replace,Ve=ye;return delete Ve.replace,Ge&&n.dispatch(new Vt.q9(!1)),n.dispatch(new Vt.q9(!1,[],Ve)),!0}))},{procName:Ce.SceneShowObjects,actionFn:ye=>Wt(n).pipe((0,W.T)(()=>{delete ye.replace;const Ge=(it,ot)=>{const _t=le.getObjectById(it).children;let xt={[it]:ot};for(const $t of _t)void 0===ye[$t.objectId]&&(xt[$t.objectId]=ot,xt={...xt,...Ge($t.objectId,ot)});return xt},Ve=Object.entries(ye).reduce((it,[ot,_t])=>({...it,...Ge(ot,_t)}),{});return n.dispatch(new Vt.yr(!1,[],Ve,void 0,void 0,!0)),!0}))},{procName:Ce.IsolateObject,actionFn:ye=>{const Ge="string"==typeof ye?[ye]:ye,Ve=n.selectSnapshot(ze.S.getViewGraph),it=a.getInverseSelection(Ve,Ge),ot=a.getNodes(Ve,it);return n.dispatch(new Vt.yr(!1,ot.map(_t=>_t.id),void 0,void 0,void 0,!0)),!0}},{procName:Ce.SceneTransformObject,actionFn:ye=>Wt(n).pipe((0,W.T)(()=>(le.transformObject(ye.objectId,ye),!0)))},{procName:Ce.SceneColorObject,actionFn:ye=>vc(n).pipe((0,W.T)(()=>{const{objectId:Ge,tintColor:Ve,saturation:it,contrast:ot,brightness:_t,opacity:xt}=ye;return n.dispatch(new Vt.Jp((0,br.H)({tintColor:Ve,saturation:it,contrast:ot,brightness:_t,opacity:xt}),[Ge])),!0}))},{procName:Ce.SceneGetColor,actionFn:ye=>vc(n).pipe((0,W.T)(()=>{const Ge=n.selectSnapshot(Rn.z.getNodePaint)(ye.objectId);return(0,br.Sf)(Ge)}))},{procName:Ce.SceneUncolorObject,actionFn:ye=>vc(n).pipe((0,W.T)(()=>(n.dispatch(new Vt.Jp(Ms.NR,[ye.objectId])),!0)))},{procName:Ce.SceneDisableHighlight,actionFn:()=>(o.disableHighlight(),!0)},{procName:Ce.SceneEnableHighlight,actionFn:()=>(o.enableHighlight(),!0)},{procName:Ce.SceneSetHighlightColor,actionFn:ye=>(o.setHighlightColor(ye),!0)},{procName:Ce.SceneSetLayersSliderPosition,actionFn:ye=>Wt(n).pipe((0,W.T)(()=>{const{layersMode:Ge}=n.selectSnapshot(Ke.getUI).visibilityLayers;return Ge===aa.Group?function XN(n,i,t){const o=(0,u.clamp)(t.position,0,1),s=!0===t.record,a=n.selectSnapshot(me.N.getSelectedChapterId),r=n.selectSnapshot(me.N.getSelectedChapterLayerGroups),_=i.computeGroupPositionsByFraction(r,o);return i.syncLayerGroupsToScene(_),i.syncLayerGroupsToState(a,_,s),!0}(n,g,ye):function zN(n,i,t){const o=n.selectSnapshot(me.N.getSelectedChapterId),s=n.selectSnapshot(me.N.getSelectedChapterCurrentLayers),a=Math.min(1,Math.max(t.position,0)),r=i.fractionToIndex(s,a),_=i.fractionToPosition(s,a,r);return t.record?i.syncLayersToState(o,r,_):i.syncLayersToScene(s,r,_,!1),!0}(n,P,ye)}))},{procName:Ce.SceneGetLayers,actionFn:()=>Wt(n).pipe((0,W.T)(()=>{const{layersMode:ye}=n.selectSnapshot(Ke.getUI).visibilityLayers;return ye===aa.Group?function WN(n){return[n.selectSnapshot(me.N.getSelectedChapterLayerGroups).map(o=>o.layers).flat()]}(n):function BN(n){return n.selectSnapshot(me.N.getAllChaptersCurrentLayers)}(n)}))},{procName:Ce.SceneGetPositions,actionFn:()=>Wt(n).pipe((0,W.T)(()=>{const ye=ue.findContentBlockByType(n.selectSnapshot(me.N.getSelectedChapterContentBlocks),hi.m.Positions);return(ye?ye.positions:[]).map(Ve=>function HN(n){const i=n.camera.location;return{title:n.title,camera:{position:i.eye,target:i.look,up:i.up}}}(Ve))}))},{procName:Ce.SceneGetVariantSchemas,actionFn:()=>Wt(n).pipe((0,W.T)(()=>n.selectSnapshot(dt.getVariantSchemas)))}]}function Do(n,i,t,o){n.defineAPIEvent(i,{events:t||[i],map:o||(s=>s)})}function Wf(n){return n.selectSnapshot(ze.S.getPlaybackSpeed)}function Xf(n){return Or.T.getColors(n).map(t=>t[255])}function Hf(n,i){const t=n.selectSnapshot(me.N.getSelectedChapterBackground),{colors:o,colorStops:s,gradientType:a}=t,r=i.gradientType||a,_=i.colorStops||s;if(i.colors){const[g,P]=i.colors;return{colors:[...g,...P],gradientType:r,colorStops:_}}return{colors:o,gradientType:r,colorStops:_}}function Qf(n){return Object.entries(_n).reduce((i,[t,o])=>o===n?t:i,"None")}function Ec(n){return n.selectSnapshot(et.getChapterLabels)}function Yf(n,i){return function lk(n,i){return n.find(t=>i===t.id)}(Ec(n),i)}function su(n,i){const t=n.getMarkerById(i.id),o=n.getMarkerWorldPosition(t);return{annotationId:i.id,objectId:i.objectId||null,title:i.title,description:i.description,shown:i.shown,occludable:i.occludable,position:o?Xs.n.fromArray(o):null,canvasPosition:t?{x:t.screenPosition[0],y:t.screenPosition[1]}:null}}function au(n,i){const t=Yf(n,i.annotationId);return t?{...t,...i}:null}function ru(n,i){return i&&n.dispatch(new Je.lb(i)),!0}function lu(n,i){return n.dispatch(new Je.eH(i)),!0}function Kf(n,i){return n.reduce((t,o)=>({...t,[`${o}`]:i}),{})}function cu(n,i){return function gk(n,i){return Object.entries(n).filter(([t,o])=>i(t,o)).reduce((t,[o,s])=>({...t,[`${o}`]:s}),{})}(n,(t,o)=>o===i)}function qf(n,i){return Object.keys(cu(n,i))}function Jf(n,i,t){return function ck(n,i){return n.filter(t=>i.includes(t.id))}(n,qf(i,t))}function Zf(n,i,t){const o=qf(i,t).map(a=>function dk(n,...i){const t=i.map(s=>n.filter(r=>s===r.objectId));return function rk(n){const i=new Set(n);return Array.from(i.values())}([].concat(...t))}(n,a)).map(a=>a.map(r=>r.id));return Kf([].concat(...o),t)}function Sk(n,i){return[{eventName:rt.F.AnnotationsCreated,aliasEvents:[rt.F.LabelsCreated],mapFn:t=>su(n,t)},{eventName:rt.F.AnnotationsDestroyed,aliasEvents:[rt.F.LabelsDestroyed],mapFn:t=>({annotationId:t.id})},{eventName:rt.F.AnnotationsShown,aliasEvents:[rt.F.LabelsEnabled],mapFn:()=>!0},{eventName:rt.F.AnnotationsHidden,aliasEvents:[rt.F.LabelsDisabled],mapFn:()=>!0}]}function bk(n,i,t,o){return[{procName:Ce.AnnotationsInfo,actionFn:()=>Ec(n),mapFnOut:s=>function pk(n,i){return i.reduce((t,o)=>(t[o.id]=su(n,o),t),{})}(t,s)},{procName:Ce.AnnotationsCreate,mapFnIn:s=>function _k(n,i,t,o){const s=i.selectSnapshot(me.N.getSelectedChapter),a=n.getObjectById(o.objectId)?o.objectId:void 0;return t.deserializeAnnotation({annotationId:o.annotationId,title:o.title,description:o.description,objectId:a,pos:o.position,occludable:o.occludable,labelOffset:o.labelOffset,shown:o.shown,labelShown:o.shown},s,Hi.D.Annotation)}(o,n,i,s),actionFn:s=>function uk(n,i){return i.objectId?(n.dispatch(new Je.Sh(i,!0)),i):null}(n,s),mapFnOut:s=>s?su(t,s):null},{procName:Ce.AnnotationsUpdate,mapFnIn:s=>au(n,s),actionFn:s=>ru(n,s)},{procName:Ce.AnnotationsSetTitle,mapFnIn:s=>au(n,s),actionFn:s=>ru(n,s),hideDefinition:!0},{procName:Ce.AnnotationsSetDescription,mapFnIn:s=>au(n,s),actionFn:s=>ru(n,s),hideDefinition:!0},{procName:Ce.AnnotationsDestroy,mapFnIn:s=>Yf(n,s),actionFn:s=>function hk(n,i){return i&&n.dispatch(new Je.vx(i)),!0}(n,s)},{procName:Ce.ShowAnnotations,actionFn:()=>lu(n,!0)},{procName:Ce.SetAnnotationsShown,actionFn:()=>lu(n,!0),hideDefinition:!0},{procName:Ce.HideAnnotations,actionFn:()=>lu(n,!1)},{procName:Ce.AnnotationsSetLabelsShown,mapFnIn:s=>function mk(n,i){const{annotations:t,objects:o,replace:s}=i,r=t||{},_=o||{},g=Ec(n),P={...cu(r,!0),...cu(r,!1),...Zf(g,_,!0),...Zf(g,_,!1)};return s?{...Kf(g.map(F=>F.id),!1),...P}:P}(n,s),actionFn:s=>function fk(n,i){const t=Ec(n),o=Jf(t,i,!1),s=Jf(t,i,!0);n.dispatch(new Je.D3(s,!0)),n.dispatch(new Je.D3(o,!1))}(n,s),hideDefinition:!0}]}var Fa=d(20714);const yk={};function eS(n,i){i.hasOwnProperty("data")&&(i[n]=i.data)}const Lo={hotspotSeedId:0,hotspotIdMap:new Map,getHotspotMap:n=>{const{hotspotIdMap:i,createHotspotId:t}=Lo;return n.selectSnapshot(et.getLabels).forEach(s=>{const a=s.id;typeof i.get(a)>"u"&&t(a)}),i},createHotspotId:n=>(Lo.hotspotSeedId++,Lo.hotspotIdMap.set(n,Lo.hotspotSeedId),Lo.hotspotSeedId),getHotspotIdByLabel:(n,i,t)=>{const{getHotspotMap:o,createHotspotId:s}=Lo,r=o(n).get(i);return t&&typeof r>"u"?s(i):r},getLabelIdByHotspotId:(n,i)=>{const t=Lo.getHotspotMap(n),o=Array.from(t).find(([s,a])=>a===i);return o?o[0]:null}};function tS(n,i){const t=n.selectSnapshot(et.getLabels);return typeof i<"u"?t.filter(o=>o.chapterId===i):t}function Cc(n,i){const t=tS(n),o=Lo.getLabelIdByHotspotId(n,i);return t.find(s=>s.id===o)}function nS(n){return n===Fa.H.CirclePlus?ci.O.Plus:n===Fa.H.CircleMinus?ci.O.Minus:ci.O.Default}function du(n,i){return Lo.getHotspotIdByLabel(n,i)}function Tc(n,i){return{...i,id:du(n,i.id)}}function iS(n,i,t){const o=i.selectSnapshot(me.N.getStoryChapters);return t.map(s=>function Tk(n,i,t,o){const{id:s,chapterId:a,title:r,objectId:_}=o,g=t.findIndex(he=>a===he.id),P=Lo.getHotspotIdByLabel(i,s,!0),F=n.getMarkerById(s),ee=n.getMarkerWorldPosition(F),le=F?.marker3D?.direction;return{id:P,title:r,objectId:_,position:ee?oS(ee):null,direction:le?oS(le):null,canvasPosition:F?Ok(F.screenPosition):null,chapterScope:g,type:o.pinType===ci.O.PlusMinus?Fa.H.CirclePlus:Fa.H.Circle,shown:o.shown,data:yk[o.id]}}(n,i,o,s))}function oS(n){return{x:n[0],y:n[1],z:n[2]}}function Oc(n){return[n.x,n.y,n.z]}function Ok(n){return{x:n[0],y:n[1]}}function sS(n,i,t){return n.dispatch(new Je.D3(i,t)),!0}function _u(n,i){if("number"==typeof i){const t=Cc(n,i);return t?[t]:[]}return tS(n)}function Rk(n){return[{eventName:rt.F.HotspotsEntered,mapFn:i=>Tc(n,i)},{eventName:rt.F.HotspotsLeft,mapFn:i=>Tc(n,i)},{eventName:rt.F.HotspotsPicked,mapFn:i=>Tc(n,i)},{eventName:rt.F.HotspotsDisplayUpdated,mapFn:i=>Tc(n,i)},{eventName:rt.F.HotspotsPositionUpdated,mapFn:i=>function Ek(n,i){const{id:t,canvasPos:o}=i,{x:s,y:a}=o;return{id:du(n,t),canvasPosition:{x:s,y:a,0:s,1:a},occluded:i.occluded}}(n,i)}]}function Nk(n,i,t){return[{procName:Ce.HotspotsInfo,actionFn:o=>{const s="number"==typeof o?o:void 0;if(void 0!==s){const a=Cc(n,s);return iS(t,n,[a])[0]}{const a=_u(n,s);return iS(t,n,a)}}},{procName:Ce.HotspotsTypes,mapFnIn:()=>function Mk(){return Object.values(Fa.H).map(n=>`${n}`)}(),actionFn:o=>o},{procName:Ce.HotspotsCreate,mapFnIn:o=>function vk(n,i,t){const{title:o,objectId:s,position:a,direction:r,chapterScope:_,type:g}=t,P=n.selectSnapshot(me.N.getStoryChapters),F=n.selectSnapshot(me.N.getSelectedChapter),ee=n.selectSnapshot(me.N.getSelectedChapterIndex),le="number"==typeof _?_:ee,he=P[le]||F,ue=!1!==t.shown,Ge={title:o,type:g||Fa.H.CircleLabel,objectId:s,pos:a?Oc(a):null,dir:r?Oc(r):null,shown:ue,symbol:"",className:""},Ve=i.deserializeHotspots({},he,le,Ge);return Ve.title=o,Ve.flyTo=!1,Ve.flyToTarget=null,Ve.occludable=!0,Ve.pinGlow=!1,Ve.pinType=ci.O.PlusMinus,Ve.shown=ue,Ve.hideWire=!0,Ve.theme=Hi.D.StudioNext,Ve.pinType=nS(g),eS(Ve.id,t),Ve}(n,i,o),actionFn:o=>function Ik(n,i){return i.objectId?(n.dispatch(new Je.Sh(i,!0)),i):null}(n,o),mapFnOut:o=>o?du(n,o.id):null},{procName:Ce.HotspotsUpdate,mapFnIn:o=>function Ak(n,i){const t=Cc(n,i.id);return t?function Ck(n,i){const{title:t,objectId:o,direction:s,position:a,shown:r,type:_}=n,g={...i,title:t,objectId:o,shown:r,pos:a?Oc(a):null,dir:s?Oc(s):null,pinType:_?nS(_):null};return eS(i.id,n),{...i,...(0,u.omitBy)(g,u.isNil)}}(i,t):null}(n,o),actionFn:o=>o?function Pk(n,i){return n.dispatch(new Je.lb(i)),i}(n,o):null},{procName:Ce.HotspotsDestroy,mapFnIn:o=>Cc(n,o),actionFn:o=>o?function wk(n,i){return n.dispatch(new Je.vx(i)),i}(n,o):null},{procName:Ce.HotspotsShow,mapFnIn:o=>_u(n,o),actionFn:o=>sS(n,o,!0)},{procName:Ce.HotspotsHide,mapFnIn:o=>_u(n,o),actionFn:o=>sS(n,o,!1)}]}var aS=d(16124),kk=d(95370);function rS(n){return n.selectSnapshot(et.getChapterLabels)}function lS(n,i){return n.dispatch(new Je.eH(i)),!0}function Ga(n,i){return rS(n).find(o=>i===o.id)}function pu(n,i){return rS(n).filter(o=>i.includes(o.id))}function uu(n,i,t){return i&&i.objectId?(n.dispatch(t?new Je.Sh(i,!0):new Je.lb(i)),i):null}function cS(n,i){const t=document.createElement("span");return t.innerHTML=n,(0,u.trim)(t.textContent).length<=i}function dS(n,i){const t=(0,u.cloneDeep)(n);return t.title=i.title&&cS(i.title,100)?i.title:t.title,t.description=i.description&&cS(i.description,300)?i.description:t.description,t.theme=i.theme||t.theme,t.pinType=i.pinType||t.pinType,t.sequentialType=i.sequentialType||t.sequentialType,t.offset=function xk(n,i){return i||[-(n.hideWire?20:32),0]}(t,i.labelOffset),t.pinGlow=void 0!==i.pinGlow?i.pinGlow:t.pinGlow,t.hideWire=void 0!==i.hideWire?i.hideWire:t.hideWire,t.hideTag=void 0!==i.hideTag?i.hideTag:t.hideTag,t.collapseDescription=void 0!==i.collapseDescription?i.collapseDescription:t.collapseDescription,t.occludable=void 0!==i.occludable?i.occludable:t.occludable,t.cameraPosition=i.flyToCamera||t.cameraPosition,t.flyTo=function jk(n,i){return!1!==i&&(i||n.flyTo)}(t,i.flyTo),t.states=function Vk(n){if(!n.flyTo)return[];const i=[new aS.B,new aS.B];i[0].errands=[new Pp.T],i[1].errands=n.cameraPosition?[new kk.v(n.cameraPosition)]:[new Ip.F(n.objectId)]}(t),t}function $a(n,i){if(i){const t=n.getMarkerById(i.id),o=n.getMarkerWorldPosition(t);return t||console.warn(`No marker found for label ${i.id}`),{labelId:i.id,objectId:i.objectId,title:i.title,description:i.description,theme:i.theme,pinType:i.pinType,labelOffset:i.offset,hideWire:i.hideWire,pinGlow:i.pinGlow,occludable:i.occludable,sequentialType:i.sequentialType,shown:i.shown,collapseDescription:i.collapseDescription,hideTag:i.hideTag,flyTo:!0===i.flyTo,flyToCamera:i.cameraPosition,position:o??i.pos,canvasPosition:t?.screenPosition??[-1,-1],occluded:t?.occluded??!0}}return null}function _S(n,i){return i.reduce((t,o)=>(t[o.id]=$a(n,o),t),{})}function hu(n){return n.selectSnapshot(Fe.j.getAllQuestions)}function gu(n,i){return hu(n).find(t=>t.id===i)}function pS(n){return gu(n,fu(n))}function Ba(n){return{enabled:n.selectSnapshot(Fe.j.getQuizEnabled),active:n.selectSnapshot(Fe.j.getQuizModeActive),questions:Hk(hu(n)),questionId:fu(n),submissions:Bk(n,mu(n))}}function Bk(n,i){return i.map(t=>uS(n,t))}function uS(n,i){const t=pS(n);return{questionId:i.questionId,answerIds:t.data.correctAnswer,correctAnswerIds:yu(t),correct:(0,_o.Br)(t,i.answer)}}function mu(n){return n.selectSnapshot(Fe.j.getAllSubmissions)}function fu(n){return n.selectSnapshot(Fe.j.getActiveQuestionId)}function Su(n){const i=pS(n),t=function $k(n){return mu(n).find(t=>t.questionId===fu(n))}(n);return{question:bu(i),submission:t?uS(n,t):void 0}}function hS(n){return n.map(i=>function zk(n){const i=n.type;switch(i){case hi.m.Markdown:{const{markdown:t}=n;return{type:i,content:t}}case hi.m.Images:{const{images:t}=n;return{type:i,content:t.map(s=>s.urls.default)}}default:return{type:i,content:""}}}(i))}function bu(n){let i=[],t="";switch(n.type){case Pn.Q5.MultipleChoice:{const o=n.data;i=function Wk(n){return n.map(i=>function Xk(n){return{answerId:n.value,displayText:n.label}}(i))}(o.options),t=o.correctAnswer;break}case Pn.Q5.SelectAnatomy:i=n.data.correctAnswer.map(s=>({answerId:s,displayText:s})),t="";break;case Pn.Q5.LabelAnatomy:i=n.data.options.map(s=>({answerId:s.value,displayText:s.label.title})),t=""}return{questionId:n.id,questionType:n.type,questionPrompt:hS(n.questionPrompt),answerExplanation:hS(n.explanation),answers:i,answerId:t}}function Hk(n,i){const t=n.map(o=>bu(o));return typeof i<"u"?t.filter(o=>i.includes(o.questionId)):t}function yu(n){const i=bu(n);switch(i.questionType){case Pn.Q5.LabelAnatomy:case Pn.Q5.SelectAnatomy:return i.answers.map(({answerId:t})=>t);case Pn.Q5.Instructions:return["-"];default:return[i.answerId]}}var Kk=d(69984),vu=function(n){return n.InvalidUAID="analytic id does not exist",n.InvalidDeveloperId="Client id invalid",n.InvalidProductKey="app product key",n.MissingUAID="analytic id missing",n.WebOnlyAPI="Api key only compatible with Web Widget",n.AndroidOnlyAPI="Api key only compatible with Mobile Widget SDK for Android",n.IOSOnlyAPI="Api key only compatible with Mobile Widget SDK for iOS",n.MixedAPIKeys="Use of both an app product key and an app api key not allowed",n.ProductKeyNotRegistered='App product key "xxx" has not been registered or is incorrect.  Ensure it has been registered by the system admin',n.ProductKeyInvalidAppBundleID='The app product key "xxx" has not been authorized to be used for app bundle id "yyy".  Confirm the correct values are being used from the system admin',n.ProductKeyBundleIDWhitelist='Use of app product key "xxx" requires the affiliated app bundle id (app_domain) to be white-listed.  Ensure the system admin has white-listed "yyy"',n.ImproperProductKeyUsage='Improper use of app product key "xxx" detected. Contact the system admin if issue continues',n.InvalidPlatformSource="Invalid platform source",n.MissingSource="Missing source",n.MissingPlatform="Missing platform",n.MissingAppDomain="Missing app domain",n.APIKeyMissing="Api key missing",n.APIKeyInvalid="Api key invalid",n.DeveloperDeactivated="Developer account for api key is deactivated",n.BundleIDNotAllowed="App bundle id not allowed",n.BundleIDUnregistered="App bundle id unregistered",n}(vu||{});class qk{}const Jk={headers:new f.Lr({"Content-Type":"application/json; charset=utf-8"})},gS="127.0.0.1";let Eu=(()=>{class n{constructor(t,o){this.http=t,this.storageService=o}getAnalytic(t){return z.c.offline?(fetch("https://human.biodigital.com/ws/user/analytics?analytic_id="+t,{method:"GET",mode:"no-cors"}),(0,Rt.of)({success:!0})):this.http.get("/ws/user/analytics?analytic_id="+t).pipe((0,W.T)(()=>({success:!0})),(0,zi.W)(s=>(0,Rt.of)(this.parseError(s))))}sendAnalytic(t){if(z.c.offline){const a=t instanceof w?"https://human.biodigital.com/ws/user/analytics":"https://human.biodigital.com/ws/developer/apps/access/key",r=(0,Kk.stringify)(t);if(navigator.onLine)this.sendOfflineAnalytic(a,r),this.sendSavedOfflineMessages(a);else{const g="offline_event=1&event_timestamp="+(new Date).toISOString().substring(0,19)+"&"+r;this.storageService.setDatabaseAnalyticItem({url:a,message:g})}return(0,Rt.of)({success:!0})}return this.http.post(t instanceof w?"/ws/user/analytics":"/ws/developer/apps/access/key",t,Jk).pipe((0,W.T)(()=>({success:!0})),(0,zi.W)(a=>(0,Rt.of)(this.parseError(a))))}sendOfflineAnalytic(t,o){var s=this;return(0,pt.A)(function*(){fetch(t,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:o}).catch(()=>{navigator.onLine?setTimeout(()=>{fetch(t,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",mode:"no-cors",body:o})},300):s.storageService.setDatabaseAnalyticItem({url:t,message:o})})})()}sendSavedOfflineMessages(t){this.storageService.getDatabaseOfflineAnalytics(o=>{o.forEach(s=>{this.sendOfflineAnalytic(s.url??t,s.message)})})}buildUserAnalytic(t,o,s){const{widgetUrlConfig:a,parentUrl:r}=t,_=a.uaid,g=r.domain,P={...this.buildAppActivityData(t),parent_analytic_identifier:_,referer_domain:g,[`${o}_source`]:s},F={analytic_platform:S.Widget,analytic_type:o,analytic_data:P};return z.c.offline&&(F.app_domain=gS),(0,b.bj)(w,F)}buildDeveloperAnalytic(t,o,s=S.Widget,a){const{widgetUrlConfig:r,parentUrl:_,embedded:g}=t;return(0,b.bj)(qk,{platform:s,app_activity:o,app_productkey:r["app-productkey"],app_userid:r["app-userid"],app_apikey:r.dk,app_domain:z.c.offline?gS:_.full,app_activity_data:a,widget_is_fullscreen:!g})}buildAppActivityData(t){const{engineVersion:o,engineAPIVersion:s,widgetUrlConfig:a}=t,r={engine_version:o,api_version:s};return Object.entries(a).filter(([_])=>"dk"!==_).forEach(([_,g])=>{r[`url_param_${_}`]=g}),(0,b.bj)(C,r)}parseError(t){if(z.c.offline)return{success:!0,message:"",errorCode:null};const o=t.error.error,s=t.status,r=o&&o.message?o.message:"";return{success:s>=500&&s<=504,message:r,errorCode:Object.values(vu).includes(r)?r:null}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(It.n$))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Zo=function(n){return n.Init="init",n.View="view",n.ChanceInteraction="interactionc",n.FirstInteraction="interactionf",n.Call="call",n}(Zo||{});class e4{constructor(i,t,o){this.subject=i,this.callId=t,this.procedureName=o}setResult(i){const{callId:t,procedureName:o}=this;this.subject.next({callId:t,value:i,procedureName:o})}}const t4=Object.values(Ct.X),n4=Object.values(rt.F);let Cu=(()=>{class n{constructor(t,o){this.engineService=t,this.applicationEventService=o,this.proceduresMap={},this.hiddenProcedures={},this.eventsMap={},this.resultsSubject=new k.B,this.logEntries=[],this.ngUnsubscribe=new k.B,this.init()}getAPIProcedureNames(){return Object.keys(this.proceduresMap).filter(t=>!(!0===this.hiddenProcedures[t]))}getAPIEventNames(){const t=Object.keys(this.eventsMap);return[Ct.X.HumanReady,...t]}logAPIProcedure(t){this.logEntries.length>1e4&&this.logEntries.shift(),this.logEntries.push({engine_version:R,api_version:N,identifier:t,category:t.split(".")[0]})}getAPILog(){return this.logEntries}resetAPILog(){this.logEntries.length=0}callAPIProcedure(t,o,s){const a=this.proceduresMap[o];a?a(t,s):console.warn("API:",`Target procedure not found: ${o}`)}defineAPIEvent(t,o){this.eventsMap[t]&&console.warn("API:",`Redefining event: ${t}`),this.eventsMap[t]=o||t}defineAPIProcedure(t,o,s){this.proceduresMap[t]&&console.warn("API:",`Redefining procedure: ${t}`),this.hiddenProcedures[t]=!0===s?.hidden,this.proceduresMap[t]=(a,r)=>{o.call(new e4(this.resultsSubject,a,t),r??{})}}onResults(){return this.resultsSubject.asObservable()}getEvent(t,o){let s;if(t4.includes(t)?s=this.engineService.getEvent(t):n4.includes(t)&&(s=this.applicationEventService.getEvent(t)),!(0,u.isNil)(s))return o?s.pipe((0,qt.s)(1)):s}init(){const t=this;this.defineAPIProcedure("apiEvents.on",function(o){t.enableEvent.call(t,this,o,!1)},{hidden:!0}),this.defineAPIProcedure("apiEvents.once",function(o){t.enableEvent.call(t,this,o,!0)},{hidden:!0})}enableEvent(t,o,s){if(!this.eventsMap[o])return void console.warn("API:",`Event: ${o} not defined.`);const a=this.eventsMap[o];if("string"==typeof a){const r=this.getEvent(a,s);r?r.subscribe(_=>{t.setResult(_)}):console.warn("API:",`Error defining event: ${o}`)}else this.mapEvents(t,a,s)}mapEvents(t,o,s){const a=o.events,r=o.map;o.init&&o.init();const g=a.map(P=>{const F=this.getEvent(P,s);if(F)return F;console.warn("API:",`Error defining event: ${P}`)}).filter(P=>!(0,u.isNil)(P));(0,ki.h)(...g).subscribe(function _(P){const F=r?r(P):P;null!==F&&t.setResult(F||{})})}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(v.y),e.KVO(Po.S))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),i4=(()=>{class n{constructor(t,o,s){this.engineService=t,this.rpcService=o,this.zone=s,this.responseQueue=[],this.listening=!1,this.listen()}listen(){this.listening||(this.ngUnsubscribe||(this.ngUnsubscribe=new k.B),this.zone.runOutsideAngular(()=>{this._listen()}))}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null,this.listening=!1)}_listen(){this.listening=!0,this.engineService.getEvent(Ct.X.Started).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.sendResponse({message:"status",status:"ready"})}),this.rpcService.onResults().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(({callId:t,value:o})=>{this.sendResponse({results:{[t]:o}})}),(0,Sn.R)(window,"message").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=this.getClientRequest(t.data);if(!o)return;const{action:s,call:a}=o;"connect"===s?this.client||(this.client=t.source,this.clientOrigin=t.origin,this.sendResponse({message:"connected"}),this.flushResponseQueue()):a&&this.executeCall(o)})}getClientRequest(t){try{return JSON.parse(t)}catch{return}}sendResponse(t){const o=JSON.stringify(t);this.client?this.postClientMessage(o):this.responseQueue.push(o)}postClientMessage(t){this.client.postMessage(t,this.clientOrigin)}flushResponseQueue(){for(;this.responseQueue.length>0;)this.postClientMessage(this.responseQueue.pop())}executeCall(t){const{id:o,call:s,params:a}=t;try{this.rpcService.callAPIProcedure(o,s,a),this.rpcService.logAPIProcedure(s)}catch(r){console.error("API:",`Error executing API call [callId: ${o}, procedure: ${s}]: ${r}`)}}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(v.y),e.KVO(Cu),e.KVO(e.SKi))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var s4=d(79435);let a4=(()=>{class n{constructor(t,o,s,a,r,_,g,P,F,ee,le,he,ue,ye,Ge,Ve,it,ot,_t,xt,$t,hn){this.store=t,this.actions=o,this.cameraService=s,this.engineService=a,this.animationService=r,this.paintService=_,this.labelsService=g,this.graphService=P,this.viewService=F,this.analyticsService=ee,this.visibilityLayersService=le,this.legacyVisibilityLayersService=he,this.quizService=ue,this.rpcService=ye,this.windowClient=Ge,this.applicationEventService=Ve,this.engineRendererService=it,this.markerService=ot,this.sceneService=_t,this.contentInfoService=xt,this.contentBlocksService=$t,this.snapshotService=hn}listen(t,o){this.ngUnsubscribe||(this.ngUnsubscribe=new k.B),z.c.native&&this.initNativeEventListeners(),this.initProcedures(),this.initEvents(),t&&o&&this.logAPIUsage(o)}close(){this.ngUnsubscribe&&(this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=null)}logAPIUsage(t){setInterval(()=>{const s=this.rpcService.getAPILog(),a=(0,u.uniqBy)(s,r=>r.identifier);if(a.length>0){const r=JSON.stringify(a),_=this.analyticsService.buildDeveloperAnalytic(t,Zo.Call,S.WidgetAPI,r);this.analyticsService.sendAnalytic(_).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe({next:g=>{},error:g=>{throw new Error(g)}}),this.rpcService.resetAPILog()}},1e4)}initEvents(){Do(this.rpcService,Ct.X.HumanProgress,void 0,t=>t),function KN(n){return[{eventName:Ct.X.HumanReady,aliasEvents:[Ct.X.HumanStarted]},{eventName:Ct.X.Error,aliasEvents:[Ct.X.HumanError],mapFn:i=>i},{eventName:Ct.X.HumanCanvasResized,aliasEvents:[Ct.X.CanvasResized],mapFn:()=>n.selectSnapshot(ze.S.getEnginePosition)}]}(this.store).forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function QN(){return[{eventName:Ct.X.SceneLoaded,mapFn:()=>!0},{eventName:Ct.X.ScenePicked,aliasEvents:[Ct.X.PickPicked],mapFn:$f},{eventName:Ct.X.SceneObjectsSelected,mapFn:n=>n.selectedObjectsUpdate},{eventName:Ct.X.SceneObjectsShown,mapFn:n=>n.enabledObjectsUpdate},{eventName:Ct.X.SceneReady,aliasEvents:[Ct.X.Started,Ct.X.SceneReady]},{eventName:Ct.X.SceneRestored,mapFn:()=>!0},{eventName:Ct.X.SceneXrayEnabled,mapFn:()=>!0},{eventName:Ct.X.SceneXrayDisabled,mapFn:()=>!0},{eventName:rt.F.NativeShare,mapFn:n=>n},{eventName:rt.F.NativeDebugMessage,mapFn:n=>n}]}().forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function AN(n){return[{eventName:Ct.X.CameraUpdated,aliasEvents:[Ct.X.CameraRested],mapFn:()=>tu(n)}]}(this.cameraService).forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function JN(){return[{eventName:Ct.X.TimelinePlaying,mapFn:n=>n},{eventName:Ct.X.TimelineCompleted,mapFn:()=>!0},{eventName:Ct.X.TimelineChapterTransition,mapFn:n=>({previousChapter:n.oldChapterIndex,currentChapter:n.newChapterIndex,time:n.time})}]}().forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),[].forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function sk(){return[{eventName:rt.F.UIUpdated,mapFn:n=>em(n)},{eventName:rt.F.UIWindowUpdated,mapFn:n=>Qf(n)}]}().forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function Fk(n,i){return[...Sk(i),...Rk(n),{eventName:rt.F.LabelsChapterInfo,mapFn:t=>_S(i,t)},{eventName:rt.F.LabelsCreated,mapFn:t=>$a(i,t)},{eventName:rt.F.LabelsUpdated,mapFn:t=>$a(i,t)},{eventName:rt.F.LabelsDestroyed,mapFn:t=>({labelId:t.id})},{eventName:rt.F.LabelsEntered,mapFn:t=>t},{eventName:rt.F.LabelsLeft,mapFn:t=>t},{eventName:rt.F.LabelsPicked,mapFn:t=>t},{eventName:rt.F.LabelsMoved,mapFn:t=>t},{eventName:rt.F.LabelsEnabled,mapFn:()=>!0},{eventName:rt.F.LabelsDisabled,mapFn:()=>!0},{eventName:rt.F.LabelsShown,mapFn:t=>t},{eventName:rt.F.LabelsHidden,mapFn:t=>t}]}(this.store,this.markerService).forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function Qk(n){return[{eventName:rt.F.QuizEntered,mapFn:()=>Ba(n)},{eventName:rt.F.QuizExited,mapFn:()=>!0},{eventName:rt.F.QuizQuestionLoaded,mapFn:i=>i},{eventName:rt.F.QuizAnswerSelected,mapFn:i=>{const{questionId:t,answerId:o}=i;return{questionId:t,answerId:o,correctAnswerIds:yu(gu(n,i.questionId))}}},{eventName:rt.F.QuizAnswerSubmitted,mapFn:i=>{const t=gu(n,i.questionId),o=yu(t);return{questionId:i.questionId,answerIds:i.answer,correctAnswerIds:o,correct:(0,_o.Br)(t,i.answer)}}},{eventName:rt.F.QuizCompleted,mapFn:()=>{const i=hu(n),t=mu(n);return(0,_o.MH)(i,t)}}]}(this.store).forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)}),function o4(){return[{eventName:rt.F.WhiteboardDrawingStarted,mapFn:()=>!0},{eventName:rt.F.WhiteboardDrawingFinished,mapFn:()=>!0},{eventName:rt.F.WhiteboardModeUpdated,mapFn:n=>({mode:n})}]}().forEach(t=>{Do(this.rpcService,t.eventName,t.aliasEvents,t.mapFn)})}initProcedures(){(function qN(n,i,t,o){return[{procName:Ce.HumanInfo,actionFn:()=>({version:n,webglInfo:i.getWEBGLInfo(),apiFunctions:t.getAPIProcedureNames().sort(),apiEvents:t.getAPIEventNames().sort()})},{procName:Ce.HumanCanvasInfo,actionFn:()=>o.selectSnapshot(ze.S.getEnginePosition)}]})(R,this.engineService,this.rpcService,this.store).forEach(t=>{ys(this.rpcService,t)}),YN(this.store,this.actions,this.engineService,this.paintService,this.cameraService,this.graphService,this.animationService,this.viewService,this.visibilityLayersService,this.legacyVisibilityLayersService,this.applicationEventService,this.engineRendererService,this.sceneService,this.contentInfoService,this.contentBlocksService).forEach(t=>{ys(this.rpcService,t)}),function RN(n,i){return[{procName:Ce.CameraInfo,actionFn:()=>Wt(n).pipe((0,W.T)(()=>tu(i)))},{procName:Ce.CameraOrbit,actionFn:t=>Wt(n).pipe((0,W.T)(()=>(n.dispatch(new Ut.RJ(void 0===t.pitch?0:t.pitch,void 0===t.yaw?0:t.yaw)),!0)))},{procName:Ce.CameraPan,actionFn:t=>Wt(n).pipe((0,W.T)(()=>(n.dispatch(new Ut.bB(void 0===t.x?0:t.x,void 0===t.y?0:t.y,void 0===t.z?0:t.z)),!0)))},{procName:Ce.CameraReset,actionFn:()=>Wt(n).pipe((0,Ln.Z)(()=>n.dispatch(new Ut.nW)))},{procName:Ce.CameraSet,actionFn:t=>Wt(n).pipe((0,W.T)(()=>{const o=t.animate||!1;if(t.objectId)return n.dispatch(new st.W6(t.objectId,o,t.animationDuration)),!0;const s=tu(i);return n.dispatch(new Ut.Ih({eye:t.position||s.position,look:t.target||s.target,up:t.up||s.up},o)),!0}))},{procName:Ce.CameraZoom,actionFn:t=>Wt(n).pipe((0,W.T)(()=>(n.dispatch(new Ut.F5(t||0)),!0)))},{procName:Ce.setCameraMode,actionFn:t=>(n.dispatch(new Ut.vq("pan"===t?"pan":"rotate")),!0)},{procName:Ce.CameraDisableChapterCamera,actionFn:()=>(n.dispatch(new Ut.Qn(!1)),!0)},{procName:Ce.CameraEnableChapterCamera,actionFn:()=>(n.dispatch(new Ut.Qn(!0)),!0)}]}(this.store,this.cameraService).forEach(t=>{ys(this.rpcService,t)}),function ek(n,i,t){return[{procName:Ce.TimelineQuery,actionFn:()=>({chapters:n.selectSnapshot(me.N.getStoryChapters).map(s=>({description:s.description,displayName:s.displayName,annotations:s.labels.map(g=>({title:g.title,description:g.description}))}))}),hideDefinition:!0},{procName:Ce.TimelineInfo,actionFn:()=>Wt(n).pipe((0,W.T)(([o])=>function ZN(n,i,t){const o=t.getChapterTimeFrame();return{time:t.getTime(),startTime:o.firstTime,endTime:o.lastTime,chapters:i.map(s=>s.id),playing:t.isPlaying(),playbackSpeed:Wf(n)}}(n,o,i)))},{procName:Ce.TimelinePlay,actionFn:o=>vs(n).pipe((0,Ln.Z)(()=>{const s=i.getGlobalTime(),a=o.time??s,r=o.loop??!1;let _=o.chapterId;return void 0===_&&(_=i.mapGlobalTimeToChapterId(a)),new h.c(g=>{n.selectSnapshot(ze.S.getChapter)!==_&&n.dispatch(new Nn.wg(_)),n.select(ze.S.getChapter).pipe((0,D.p)(ee=>ee===_),(0,qt.s)(1)).subscribe(()=>function P(){if(a!==s){const ee=(0,A.clamp)(i.mapChapterGlobalTime(_,o.time),0,i.getChapterDuration());i.pause(),i.scrub(ee)}i.setAnimationLoop(r),i.play(),g.next(!0),g.complete()}())})}))},{procName:Ce.TimelinePause,actionFn:()=>Wt(n).pipe((0,W.T)(()=>(i.pause(),!0)))},{procName:Ce.TimelineSet,actionFn:o=>vs(n).pipe((0,Ln.Z)(()=>{if(void 0===o.time&&void 0===o.chapterId)return(0,Rt.of)(!0);let s=o.chapterId;void 0===s&&(s=i.mapGlobalTimeToChapterId(o.time));const a=n.selectSnapshot(ze.S.getChapter)!==s;return new h.c(r=>{function _(){let g=o.time??0;g=(0,A.clamp)(i.mapChapterGlobalTime(s,g),0,i.getChapterDuration()),i.pause(),i.scrub(g),r.next(!0),r.complete()}a?(n.select(ze.S.getChapter).pipe((0,D.p)(g=>g===s),(0,qt.s)(1)).subscribe(()=>_()),n.dispatch(new Nn.wg(s))):_()})}))},{procName:Ce.TimelineSetPlaybackSpeed,actionFn:o=>vs(n).pipe((0,W.T)(()=>"number"==typeof o&&(n.dispatch(new st.Vs(o)),!0)))},{procName:Ce.TimelineGetPlaybackSpeed,actionFn:()=>vs(n).pipe((0,W.T)(()=>Wf(n)))},{procName:Ce.TimelineNext,actionFn:()=>vs(n).pipe((0,W.T)(()=>(t.nextChapter("API"),!0)))},{procName:Ce.TimelinePrev,actionFn:()=>vs(n).pipe((0,W.T)(()=>(t.previousChapter("API"),!0)))}]}(this.store,this.animationService,this.viewService).forEach(t=>{ys(this.rpcService,t)}),function nk(n){return[{procName:Ce.InputEnable,actionFn:()=>(n.dispatch(new O(!0)),!0)},{procName:Ce.InputDisable,actionFn:()=>(n.dispatch(new O(!1)),!0)}]}(this.store).forEach(t=>{ys(this.rpcService,t)}),function ak(n,i,t,o,s){const a=new Li.t(!1);return i.pipe((0,l.rM)(Nn.lM)).subscribe(()=>{a.next(!0)}),[{procName:Ce.UIGetBackground,actionFn:()=>Wt(n).pipe((0,W.T)(()=>function ik(n){const{colors:i,gradientType:t,colorStops:o}=n;return{colors:Array.isArray(i)?[[i[0],i[1],i[2],i[3]],[i[4],i[5],i[6],i[7]]]:[[0,0,0,0],[0,0,0,0]],gradientType:t,colorStops:o}}(n.selectSnapshot(me.N.getSelectedChapterBackground))))},{procName:Ce.UISetBackground,mapFnIn:r=>{const{colors:_,colorStops:g,gradientType:P}=r;return{colors:_&&Xf(_),gradientType:P,colorStops:g}},actionFn:r=>Wt(n).pipe((0,W.T)(()=>{if(r){const _=Hf(n,r);n.dispatch(new Nn.pb(_))}return!0}))},{procName:Ce.UIPresetBackground,mapFnIn:r=>{const{colors:_,colorStops:g,gradientType:P}=r;return{colors:_&&Xf(_),gradientType:P,colorStops:g}},actionFn:r=>{if(r){const _=Hf(n,r);z.c.platform===Ls.N.SDK&&a.next(!1),a.pipe((0,D.p)(g=>!!g),(0,qt.s)(1)).subscribe(()=>{n.dispatch(new Nn.EN(_))})}return!0}},{procName:Ce.UIGetWorldPosition,actionFn:r=>Wt(n).pipe((0,W.T)(()=>{const{worldPos:_}=t.pick(r.x,r.y);if(_){const{0:g,1:P,2:F}=_;return{x:g,y:P,z:F}}return null}))},{procName:Ce.UISetOndemand,actionFn:r=>(n.dispatch([new E.ToggleWindow(_n.OnDemand,r.enabled)]),!0)},{procName:Ce.UISetLoadingExperience,actionFn:r=>((0,u.isEmpty)(r)?n.dispatch([new E.SetInteractType(Ki.None),new E.CloseWindow(_n.Interact)]):n.dispatch([new E.SetInteractType(r),new E.OpenWindow(_n.Interact)]),!0)},{procName:Ce.UISetScrollCaptureMode,actionFn:r=>(n.dispatch(new st.hk(r)),!0)},{procName:Ce.UISetTutorial,actionFn:r=>(n.dispatch([new E.ToggleWindow(_n.Tutorial,r.enabled),new E.StartTutorial(r.enabled)]),!0)},{procName:Ce.UIGetWindow,actionFn:()=>Qf(n.selectSnapshot(de.getOpenWindow))},{procName:Ce.UIGetDisplay,actionFn:()=>Wt(n).pipe((0,W.T)(()=>em(n.selectSnapshot(Ke.getUI))))},{procName:Ce.UISetDisplay,actionFn:r=>{const _=function rv(n){const i=null!=n.all?_p(n.all):new fa;return rs({all:n.all,startingColumn:n.startingColumn,fadeout:n.fadeout,drawerExpanded:n.infoExpand,logoIsHyperLink:void 0,[G.AnatomyLabels]:Zt(n.anatomyLabels,n.anatomyLabels),[G.Audio]:n.audio,[G.Camera]:Zt(n.nav,n.cameraMode,n.center,n.zoomIn,n.zoomOut,n.nav),[G.Column]:Zt(n.info,n.info),[G.ContextActions]:n.contextActions,[G.ContextMenu]:n.contextMenu,[G.Drawer]:Zt(n.info,n.info),[G.Fullscreen]:Zt(n.fullscreen,n.fullscreen),[G.Help]:Zt(n.help,n.help),[G.LabelList]:Zt(n.labelList,n.labelList),[G.Labels]:n.labels,[G.Layout]:n.layout,[G.Legend]:n.legend,[G.Logo]:n.logo,[G.Loader]:zl(n.loader),[G.XRLoader]:dp(n.xrLoader),[G.Media]:cp(n.playPause,Zt(n.scrubber,n["scrubber.chapters"]),n.media),[G.NodeAudio]:n.anatomyPronunciations,[G.NodeInfo]:n.anatomyDescriptions,[G.Pagination]:Zt(n.tour,n["tour.chapters"]),[G.Playthrough]:Zt(n.playthrough,n.autoplay),[G.QuizPrompt]:n["ui-quiz"],[G.Search]:Zt(n.objectTree,n.search),[G.TitleOnly]:Zt(n.info,n.info),[G.ToggleLabels]:void 0,[G.Toolbar]:Zt(n.toolbar,n.menu),[G.Tools]:Zt(n.tools,n.tools),[G.Tutorial]:void 0,[G.Undo]:Zt(n.reset,n.undo),[G.VisibilityLayers]:n.visibilityLayers,[G.VisibilityLayersMode]:Wl(n.visibilityLayersMode,n.skinLayers),[G.SkinLayers]:Zt(n.skinLayers),[G.Whiteboard]:n.whiteboard},i)}(r);return n.dispatch(new V(_)),r}},{procName:Ce.UIResetDisplay,actionFn:()=>{const r=n.selectSnapshot(Ke.getInitialUI);n.dispatch(new Vn.SetUI(r))}},{procName:Ce.UISetQuizLock,actionFn:r=>(i.pipe((0,l.xi)(ct.nm),(0,qt.s)(1)).subscribe(()=>{n.dispatch(new Xt.B.SetQuizLocked(r)),n.dispatch(new Xt.B.SetEnableQuizRetake(r)),!0===r&&o.startQuiz()}),!0)},{procName:Ce.UISnapshot,aliases:[Ce.SceneSnapshot],actionFn:r=>Wt(n).pipe((0,Ln.Z)(()=>{const{width:_,height:g}=t.getCanvas();r={width:_,height:g,openInTab:!1,includeDrawCanvas:!1,fileType:"jpeg",quality:.92,...r};const{width:P,height:F,openInTab:ee,fileType:le,includeDrawCanvas:he,quality:ue}=r,ye="jpeg"===le?hr.H.JPEG:hr.H.PNG,Ge=n.selectSnapshot(me.N.getSelectedChapterBackground),Ve=[];if(he){const _t=s.getDrawCanvas(),xt=s.getAnnotateElement();_t&&Ve.push(_t),xt&&Ve.push(xt)}const it=s.getLogoFromBackground(Ge),ot={...Ql._,crop:"original",imageType:ye,imageQuality:ue,copyrightEnabled:!0,copyrightImagePath:it.logo_url};return n.dispatch(new st.k2(P,F,Ge,Ve,!0,ot)).pipe((0,Ln.Z)(()=>i.pipe((0,l.xi)(st.NO),(0,qt.s)(1))),(0,Ln.Z)(_t=>Zp.X.blobToBase64(_t.blob)),(0,is.M)(_t=>{ee&&_t&&function ok(n){const i=window.open("","_blank");if(i){const t=i.document.createElement("img");t.src=n,i.document.body.appendChild(t)}}(_t)}),(0,zi.W)(()=>(0,Rt.of)(null)))}))}]}(this.store,this.actions,this.engineRendererService,this.quizService,this.snapshotService).forEach(t=>{ys(this.rpcService,t)}),function Gk(n,i,t,o,s,a){return[...bk(n,i,o,s),...Nk(n,i,o),{procName:Ce.LabelsInfo,actionFn:r=>Wt(n).pipe((0,W.T)(()=>r.length>0?pu(n,r):n.selectSnapshot(et.getChapterLabels))),mapFnOut:r=>_S(o,r)},{procName:Ce.LabelsCreate,actionFn:r=>Wt(n).pipe((0,W.T)(()=>{if(r.labelId&&Ga(n,r.labelId))return null;if(!r.objectId)return console.log("attempt to create a label with no objectId."),null;const _=function Dk(n,i,t){const o=i.makeDefaultStudioLabel();o.id=t.labelId||li.u.idWithPrefix("label"),o.objectId=t.objectId,o.pos=t.position,o.renderableIndex=0,o.occludable=!!t.position,o.flyTo=!0,o.description="",o.shown=!0;const s=n.selectSnapshot(me.N.getSelectedChapter);return s?(o.chapterId=s.id,dS(o,t)):null}(n,i,r);return uu(n,_,!0)}),(0,ws.c)(0)),mapFnOut:r=>$a(o,r)},{procName:Ce.LabelsUpdate,actionFn:r=>Wt(n).pipe((0,W.T)(()=>{let _=null;return Ga(n,r.labelId)&&(_=function Lk(n,i){return dS(Ga(n,i.labelId),i)}(n,r),uu(n,_,!1)),_})),mapFnOut:r=>$a(o,r)},{procName:Ce.LabelsCanvasUpdate,actionFn:r=>Wt(n).pipe((0,W.T)(()=>{let _=null;return Ga(n,r.labelId)&&(_=function Uk(n,i,t,o){const s=Ga(n,o.labelId),a=o.canvasPosition,r=i.pick(a[0],a[1]);return r&&r.objectId?(s.objectId=r.objectId,s.pos=[r.worldPos[0],r.worldPos[1],r.worldPos[2]],s.offset=[s.hideWire?20:32,0],s.barycentric=[r.barycentric[0],r.barycentric[1],r.barycentric[2]],s.primitiveIndex=r.triIndex,s.renderableIndex=r.renderableIndex||0,s.dir=t.getDirection(r),s):null}(n,t,a,r),_&&uu(n,_,!1)),_})),mapFnOut:r=>$a(o,r)},{procName:Ce.LabelsDestroy,actionFn:r=>Wt(n).pipe((0,W.T)(()=>{const _=Ga(n,r);return _?(n.dispatch(new Je.vx(_)),{labelId:_.id}):null}))},{procName:Ce.LabelsShow,actionFn:r=>Wt(n).pipe((0,W.T)(()=>(r.length>0?n.dispatch(new Je.D3(pu(n,r),!0)):lS(n,!0),!0)))},{procName:Ce.LabelsHide,actionFn:r=>Wt(n).pipe((0,W.T)(()=>(r.length>0?n.dispatch(new Je.D3(pu(n,r),!1)):lS(n,!1),!0)))},{procName:Ce.LabelsSetEnabled,aliases:[Ce.AnnotationsSetEnabled],actionFn:r=>{n.dispatch(new st.Gv(r.enable))},hideDefinition:!0},{procName:Ce.LabelsSetScale,actionFn:r=>{n.dispatch(new Je.tH(r.scale))}}]}(this.store,this.labelsService,this.engineRendererService,this.markerService,this.sceneService,this.cameraService).forEach(t=>{ys(this.rpcService,t)}),function Yk(n,i){function t(o){return n.selectSnapshot(Fe.j.getQuizModeActive)?o():{error:"quiz mode is not active"}}return[{procName:Ce.QuizInfo,actionFn:()=>Wt(n).pipe((0,W.T)(()=>n.selectSnapshot(Fe.j.hasQuiz)?Ba(n):null))},{procName:Ce.QuizSubmit,actionFn:o=>Wt(n).pipe((0,W.T)(()=>t(()=>(i.submitQuestion(o.questionId,o.answerIds),Ba(n)))))},{procName:Ce.QuizQuestion,actionFn:()=>t(()=>Wt(n).pipe((0,W.T)(()=>Su(n))))},{procName:Ce.QuizEnter,actionFn:()=>Wt(n).pipe((0,W.T)(()=>n.selectSnapshot(Fe.j.hasQuiz)?(i.startQuiz(),!0):{error:"quiz not found"}))},{procName:Ce.QuizExit,actionFn:()=>Wt(n).pipe((0,W.T)(()=>(i.exitQuiz(),!0)))},{procName:Ce.QuizSelectQuestion,actionFn:o=>t(()=>(n.dispatch(new Xt.B.SetActiveQuestion(o)),Ba(n)))},{procName:Ce.QuizNextQuestion,actionFn:()=>Wt(n).pipe((0,W.T)(()=>t(()=>(i.nextQuestion(),Su(n)))))},{procName:Ce.QuizPreviousQuestion,actionFn:()=>Wt(n).pipe((0,W.T)(()=>t(()=>(n.dispatch(new Xt.B.SetQuizLifecycle(Qo.h.Question)),n.dispatch(new Xt.B.PreviousQuestion),Su(n)))))},{procName:Ce.QuizReset,actionFn:()=>Wt(n).pipe((0,W.T)(()=>(i.resetQuiz(),Ba(n))))},{procName:Ce.QuizSet,actionFn:o=>Wt(n).pipe((0,W.T)(()=>{const{settings:s,startNumber:a,endNumber:r,locked:_}=o;if(!(0,u.isNil)(s)){const P=n.selectSnapshot(Fe.j.getQuizSettings);n.dispatch(new Xt.B.SetQuizSettings({...P,...s}))}if("number"==typeof a||"number"==typeof r){const P=n.selectSnapshot(me.N.getStoryChapters),F=(0,_o.En)(P),he=F.slice("number"==typeof a?a-1:0,"number"==typeof r?r:F.length);n.dispatch(new Xt.B.SetQuestions(he))}return"boolean"==typeof _&&n.dispatch(new Xt.B.SetQuizLocked(_)),n.dispatch(new Xt.B.SetQuizQuestionsMode("number"==typeof a&&"number"==typeof r?"restricted":"all")),Ba(n)}))}]}(this.store,this.quizService).forEach(t=>{ys(this.rpcService,t)})}initNativeEventListeners(){this.applicationEventService.getEvent(rt.F.NativeSetBaseDirectory).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{window.localBaseDirectory=t}),this.applicationEventService.getEvent(rt.F.NativeSetSdkOffline).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{window.sdkOffline=!0===t})}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(l.En),e.KVO(go.j),e.KVO(v.y),e.KVO(co.O),e.KVO(ir.s),e.KVO(Tr.x),e.KVO(Wp.w),e.KVO(En),e.KVO(Eu),e.KVO(wo),e.KVO(to),e.KVO(ba),e.KVO(Cu),e.KVO(i4),e.KVO(Po.S),e.KVO(Er.z),e.KVO(nr),e.KVO(Fi.w),e.KVO(s4.T),e.KVO(Ns.V),e.KVO(pp.M))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Tu=d(85884),mS=function(n){return n.Auth="auth",n}(mS||{}),r4=d(41775);class fS{}var Ou,Uo=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Cn=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const l4={authenticated:!1,bypassAnalytics:!1,activeRequests:new Set,loggedInteractions:{init:!1,view:!1,interactionc:!1,interactionf:!1,call:!1}};let Qi=class wd{static#e=Ou=this;static isAuthenticated(i){return i.authenticated}static isFirstInteractionLogged(i){return i.loggedInteractions.interactionf}authorizeAnalyticId(i){const{activeRequests:t}=i.getState();if(!t.has(Zo.Init)){const o=this.store.selectSnapshot(Z.getWidgetState),{embedded:s,userType:a,widgetUrlConfig:r}=o,_=r["bypass-analytics"];let g;i.patchState({bypassAnalytics:_}),!s||z.c.native||_?i.patchState({authenticated:!0}):(g=a===M.User?this.analyticsService.getAnalytic(r.uaid):this.analyticsService.sendAnalytic(this.analyticsService.buildDeveloperAnalytic(o,Zo.Init,S.WidgetAPI,this.analyticsService.buildAppActivityData(o))),t.add(Zo.Init),i.patchState({activeRequests:t}),g.pipe((0,Ot.j)(()=>{t.delete(Zo.Init),i.patchState({activeRequests:t})})).subscribe(P=>{const F=P.success;i.patchState({authenticated:F}),i.dispatch(F?new kN(a,P):new jf(a,P))}))}}logInteraction(i,{interaction:t,source:o}){const{activeRequests:s}=i.getState();if(!s.has(t)){const a=this.store.selectSnapshot(Z.getWidgetState),_=a.userType===M.User?this.analyticsService.buildUserAnalytic(a,t,o):this.analyticsService.buildDeveloperAnalytic(a,t,S.Widget,this.analyticsService.buildAppActivityData(a));s.add(t),i.patchState({activeRequests:s}),this.analyticsService.sendAnalytic(_).pipe((0,Ot.j)(()=>{s.delete(t),i.patchState({activeRequests:s})})).subscribe(g=>{i.dispatch(g.success?new nu(t,g):new DN(t,g))})}}logInteractionSuccess(i,t){const{loggedInteractions:o}=i.getState();o[t.interaction]=!0,i.patchState({loggedInteractions:o})}initView(i){const t=["interactive","complete"].includes(document.readyState),o=t?(0,Rt.of)(t):(0,Sn.R)(document,"DOMContentLoaded");this.store.select(Ou.isAuthenticated).pipe((0,wf.U)(o),(0,D.p)(s=>!0===s),(0,qt.s)(1)).subscribe(()=>{i.getState().bypassAnalytics||this.store.dispatch(new $r(Zo.View))})}logInteractionChance(i){const t=i.getState();!t.loggedInteractions.interactionc&&!t.bypassAnalytics&&i.dispatch(new $r(Zo.ChanceInteraction))}logFirstInteraction(i){i.getState().loggedInteractions.interactionf||i.dispatch([new iu,new $r(Zo.FirstInteraction)])}resetFirstInteraction(i){const t=i.getState().loggedInteractions;t.interactionf=!1,i.patchState({loggedInteractions:t})}constructor(i,t){this.store=i,this.analyticsService=t}ngxsOnInit(i){i.dispatch(new Vf)}static#t=this.\u0275fac=function(t){return new(t||wd)(e.KVO(l.il),e.KVO(Eu))};static#n=this.\u0275prov=e.jDH({token:wd,factory:wd.\u0275fac})};Uo([(0,l.rc)(xf),Cn("design:type",Function),Cn("design:paramtypes",[Object]),Cn("design:returntype",void 0)],Qi.prototype,"authorizeAnalyticId",null),Uo([(0,l.rc)($r),Cn("design:type",Function),Cn("design:paramtypes",[Object,$r]),Cn("design:returntype",void 0)],Qi.prototype,"logInteraction",null),Uo([(0,l.rc)(nu),Cn("design:type",Function),Cn("design:paramtypes",[Object,nu]),Cn("design:returntype",void 0)],Qi.prototype,"logInteractionSuccess",null),Uo([(0,l.rc)(Vf),Cn("design:type",Function),Cn("design:paramtypes",[Object]),Cn("design:returntype",void 0)],Qi.prototype,"initView",null),Uo([(0,l.rc)(iu),Cn("design:type",Function),Cn("design:paramtypes",[Object]),Cn("design:returntype",void 0)],Qi.prototype,"logInteractionChance",null),Uo([(0,l.rc)(Ff),Cn("design:type",Function),Cn("design:paramtypes",[Object]),Cn("design:returntype",void 0)],Qi.prototype,"logFirstInteraction",null),Uo([(0,l.rc)(Gf),Cn("design:type",Function),Cn("design:paramtypes",[Object]),Cn("design:returntype",void 0)],Qi.prototype,"resetFirstInteraction",null),Uo([(0,l.MD)(),Cn("design:type",Function),Cn("design:paramtypes",[fS]),Cn("design:returntype",void 0)],Qi,"isAuthenticated",null),Uo([(0,l.MD)(),Cn("design:type",Function),Cn("design:paramtypes",[fS]),Cn("design:returntype",void 0)],Qi,"isFirstInteractionLogged",null),Qi=Ou=Uo([(0,l.Uw)({name:"modules",defaults:l4}),Cn("design:paramtypes",[l.il,Eu])],Qi);const c4=new Set([Ce.CameraOrbit,Ce.CameraPan,Ce.CameraReset,Ce.CameraSet,Ce.CameraZoom,Ce.LabelsCreate,Ce.LabelsDestroy,Ce.LabelsHide,Ce.LabelsShow,Ce.LabelsUpdate,Ce.QuizEnter,Ce.QuizExit,Ce.QuizSubmit,Ce.QuizNextQuestion,Ce.QuizPreviousQuestion,Ce.QuizReset,Ce.QuizSet,Ce.SceneColorObject,Ce.ScenePick,Ce.SceneReset,Ce.SceneRestore,Ce.SceneSelectObjects,Ce.SceneSetLayersSliderPosition,Ce.SceneShowObjects,Ce.SceneTransformObject,Ce.SceneUncolorObject,Ce.TimelineNext,Ce.TimelinePause,Ce.TimelinePlay,Ce.TimelinePrev,Ce.TimelineSet,Ce.UISnapshot]);var SS=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},bS=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const d4=["logoElRef"];function _4(n,i){1&n&&(e.qex(0),e.nrm(1,"img",3,0),e.bVm())}class za{constructor(i){this.renderer=i,this.siteHeaderType=as,this.ngUnsubscribe=new k.B}ngAfterViewInit(){this.initLogoListener()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initLogoListener(){(0,cn.z)([this.headerLogoConfig$,this.siteHeader$]).pipe((0,D.p)(([i,t])=>!(0,u.isNil)(i)),(0,wn.B)(0),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const t=this.logoElRef.nativeElement,{logo_url:o}=(0,Gm.g)(i,"full","color");this.renderer.setAttribute(t,"src",o),this.renderer.setAttribute(t,"alt",$localize`Team Logo`),this.renderer.setAttribute(t,"aria-label",$localize`Team Logo`)})}static#e=this.\u0275fac=function(t){return new(t||za)(e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:za,selectors:[["app-viewer-header"]],viewQuery:function(t,o){if(1&t&&e.GBs(d4,5),2&t){let s;e.mGM(s=e.lsd())&&(o.logoElRef=s.first)}},decls:3,vars:4,consts:[["logoElRef",""],[1,"viewer-header",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"viewer-header__logo"]],template:function(t,o){1&t&&(e.j41(0,"div",1),e.nI1(1,"async"),e.DNE(2,_4,3,0,"ng-container",2),e.k0s()),2&t&&(e.Y8G("ngSwitch",e.bMT(1,2,o.siteHeader$)),e.R7$(2),e.Y8G("ngSwitchCase",o.siteHeaderType.Logo))},dependencies:[J.ux,J.e1,J.Jj],styles:[".viewer-header[_ngcontent-%COMP%]{background-color:#fff;border-bottom:1px solid #d4d9e3;display:flex;flex-direction:row;align-items:center;justify-content:center;height:var(--header-height)}.viewer-header__logo[_ngcontent-%COMP%]{min-height:20px;max-height:calc(var(--header-height) * .5);height:auto;width:auto;max-width:calc(100% - 32px)}"],changeDetection:0})}function p4(n,i){if(1&n){const t=e.RV6();e.j41(0,"a",1),e.bIt("click",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleClick(s))}),e.EFF(1,"Skip to main content"),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("href",t.mainContentLink,e.B4B)}}SS([(0,l.l6)(Q_.X.getHeaderLogoConfig),bS("design:type",h.c)],za.prototype,"headerLogoConfig$",void 0),SS([(0,l.l6)(vn.getSiteHeader),bS("design:type",h.c)],za.prototype,"siteHeader$",void 0);const yS="view-title";let u4=(()=>{class n{constructor(t,o){this.location=t,this.store=o,this.columnVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Column))),this.drawerVisible=(0,je.ot)(this.store.select(Ke.getVisible(G.Drawer))),this.show=(0,e.EWP)(()=>this.columnVisible()||this.drawerVisible()),this.mainContentLink=`#${yS}`}handleClick(t){t.preventDefault();const o=document.getElementById(yS);o&&o.focus()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(J.aZ),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-skip-nav"]],decls:1,vars:1,consts:[["appSkipNav","","tabindex","1","class","sr-only",3,"href","click",4,"ngIf"],["appSkipNav","","tabindex","1",1,"sr-only",3,"click","href"]],template:function(o,s){1&o&&e.DNE(0,p4,2,1,"a",0),2&o&&e.Y8G("ngIf",s.show())},dependencies:[J.bT],changeDetection:0})}return n})();var Wa=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Xa=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const h4=["widgetElRef"];function g4(n,i){if(1&n&&(e.j41(0,"div",5),e.nI1(1,"async"),e.nrm(2,"app-viewer-header"),e.k0s()),2&n){const t=e.XpG();e.Y8G("ngSwitch",e.bMT(1,1,t.siteHeader$))}}function m4(n,i){if(1&n&&(e.nrm(0,"div",6),e.nI1(1,"async")),2&n){const t=e.XpG();e.AVh("widget-shell--xr",e.bMT(1,2,t.xrActive$))}}const f4=(0,Jn.DC)().direction;document.dir=f4;class xo{constructor(i,t,o,s,a,r,_,g,P,F,ee,le,he){this.document=i,this.store=t,this.actions=o,this.activatedRoute=s,this.widgetAPIHandler=a,this.errorService=r,this.engineService=_,this.cameraService=g,this.storageService=P,this.renderer=F,this.viewService=ee,this.quizService=le,this.rpcService=he,this.siteHeaderType=as,this.title="Biodigital Human",this.environmentApplication=xn.c,this.environmentPlatform=Ls.N,this.ngUnsubscribe=new k.B,this.firstInteractionLogged$=this.store.select(Qi.isFirstInteractionLogged).pipe((0,D.p)(ue=>ue))}ngOnInit(){this.initErrorHandling(),this.initAnalytics();const{data:i}=this.activatedRoute.snapshot,t=i.widgetUrlConfig;this.initWidgetBreakpoints(t),this.initWidgetLabelScale(t),this.initWidgetLayout(t),this.initWidgetSetup(t),this.initFadeout(t),this.initStartingColumn(t),this.initStartingTool(t),this.initCustomWidgetSettings(t.paid),this.store.dispatch(new xf),this.initBackgroundFromWidget(t),this.initBackgroundFromChapter(),this.initCamera(t),this.initRotation(t),this.initQuizInteractions(t),this.widgetAPIHandler.listen(z.c.deploy===pi.Z.Production),this.initChaptersReadyListener(),this.initHumanReadyListener(),this.initDynamicLayout()}ngAfterViewInit(){this.initHeaderAndFooter()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initWidgetSetup(i){const t=window!==window.top,o=t?BD_DOCUMENT_REFERRER:window.location.href;this.store.dispatch(new j(o,t,i));const s=this.store.selectSnapshot(Ke.getUI),a=tm(i),r=nm(s,a);this.store.dispatch(new Vn.SetUI(r)),this.store.dispatch(new Vn.SetInitialUI(r));const _=function _v(n){return n["disable-scroll"]?Wo.M.DoNotCapture:n["disable-scroll.alert"]||n["disable-scroll.overlay"]?Wo.M.DoNotCaptureShowMessage:Wo.M.Capture}(i);this.store.dispatch(new st.hk(_));const g=function pv(n){return!0===n["ui-print-image"]}(i),P=function hv(n){return!1===n["auto-load"]}(i);(function gv(n){return!0===n["ui-poc-whiteboard"]})(i)&&(this.viewService.toggleWhiteboard(!0),this.store.dispatch(new E.SetWhiteboardLocked(!0)));const{interactType:F,isInteractActive:ee}=function uv(n,i,t){const o=n["initial.play"]||n.initial||n["initial.button"]||n["initial.hand"]||n["initial.hand-hint"]||n["initial.summary"]||i;return{interactType:(()=>{switch(!0){case n.initial:case n["initial.button"]:return Ki.Button;case n["initial.hand"]:case n["initial.hand-hint"]:return Ki.Hand;case n["initial.play"]:return Ki.Play;case n["initial.summary"]:return Ki.Summary;default:return t}})(),isInteractActive:o}}(i,this.store.selectSnapshot(de.shouldWindowOpen(_n.Interact)),this.store.selectSnapshot(de.getInteractType)),le=this.storageService.getLocalItem(It.UT.GettingStartedTutorial),he=!0===a.tutorial&&"true"!==le;this.store.dispatch([new E.SetOnDemand(P),new E.ToggleWindow(_n.OnDemand,P),new E.SetInteractType(F),new E.ToggleWindow(_n.Interact,ee),new E.ToggleWindow(_n.Tutorial,he),new E.StartTutorial(he),new E.SetUsePrintImage(g)]);const ue=function mv(n){return!0===n["demo-mode"]}(i);this.store.dispatch(new st.E7(ue))}initCustomWidgetSettings(i){z.c.offline||i&&(this.store.select(Z.getWidgetSettings).pipe((0,D.p)(t=>!(0,u.isNil)(t)&&t.length>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t.forEach(o=>{o.anatomy_description_fallback&&this.viewService.setAnatomyDescriptionFallback(o.anatomy_description_fallback);const s=o.group_logos;if(s){const a=s.viewer?.viewer_logo_setting;"logo_swap"===a?this.viewService.setViewLogos(s):"logo_cobranding"===a&&(this.viewService.setHeaderLogos(s),this.store.dispatch(new Un.SetHeader(as.Logo)))}})}),this.store.dispatch(new I(i)))}initErrorHandling(){this.actions.pipe((0,l.xi)(ct.S9),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleContentErrors()),this.actions.pipe((0,l.xi)(jf),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleAuthErrors(i))}initWidgetBreakpoints({"ui-collapse-label":i,"annotation-collapse":t}){const o=[i,t].find(s=>!(0,u.isNil)(s));(0,u.isNil)(o)||this.store.dispatch(new E.SetLabelBreakpoint(o))}initWidgetLabelScale({"label-scale":i}){(0,u.isNil)(i)||this.store.dispatch(new Je.tH(i))}initWidgetLayout({"ui-layout":i}){(0,u.isNil)(i)||this.store.dispatch(new E.SetLayout(i))}initFadeout({"ui-fadeout":i}){!(0,u.isNil)(i)&&(0,u.isNumber)(i)&&this.store.dispatch(new E.SetFadeout(i))}initStartingColumn({"ui-starting-column":i}){(0,u.isNil)(i)||this.store.dispatch(new E.SetStartingColumn(i))}initStartingTool({"ui-starting-tool":i}){(0,u.isNil)(i)||this.store.dispatch(new E.SetStartingTool(i))}initQuizInteractions(i){const t=this.store.select(ft.getSelectedBookmark);(0,cn.z)([this.store.select(Fe.j.hasQuiz),t]).pipe((0,D.p)(([o,s])=>!(0,u.isNil)(s)&&o),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(([o,s])=>{const a=this.store.selectSnapshot(Fe.j.getAllQuestions),_="true"==`${i["ui-quiz-locked"]}`,g=s.viewMode===we.Quiz;this.store.dispatch(new Xt.B.SetQuizLocked(_||g)),_&&this.store.dispatch(new Xt.B.SetEnableQuizRetake(!1));const P=parseInt(i["ui-quiz-start"],10),F=parseInt(i["ui-quiz-end"],10),ee=a.length,le=isNaN(P)?1:P,he=isNaN(F)?ee:F;if(1!==le||he!==ee){const Ge=a.filter((Ve,it)=>{const ot=it+1;return ot>=le&&ot<=he});this.store.dispatch(new Xt.B.SetQuestions(Ge))}const ye=isNaN(P)&&isNaN(F)?"all":"restricted";this.store.dispatch(new Xt.B.SetQuizQuestionsMode(ye)),(_||g)&&setTimeout(()=>{this.quizService.startQuiz()})})}initAnalytics(){this.getIntersectionObserver(this.document.body,.75).pipe((0,qt.s)(1)).subscribe(()=>{this.store.dispatch(new iu)});const i=this.getDocumentInteraction(),t=this.rpcService.onResults().pipe((0,D.p)(o=>c4.has(o.procedureName)));(0,ki.h)(i,t).pipe((0,wn.B)(125),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ff)})}initBackgroundFromWidget({background:i}){i&&(this.setWidgetTransparent((0,Ds.ty)(i)),this.actions.pipe((0,l.rM)(Nn.lM),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Nn.EN(i))}))}initBackgroundFromChapter(){this.store.select(me.N.getSelectedChapter).pipe((0,D.p)(i=>null!=i),(0,W.T)(i=>(0,Ds.ty)(i.background)),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setWidgetTransparent(i)})}initCamera({camera:i}){i&&this.actions.pipe((0,l.xi)(ct.dC),(0,qt.s)(1),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ut.Ih(i,!1))})}initRotation({"load-rotate":i}){if(i){let t=performance.now();const o=this.store.select(me.N.getSelectedChapter),s=this.store.select(me.N.getSelectedChapterReadyState);(0,PN.d)().pipe((0,va.E)(s),(0,D.p)(([,a])=>a?.model),(0,W.T)(()=>i*(performance.now()-t)*.001),(0,is.M)(()=>t=performance.now()),(0,p.Q)(this.firstInteractionLogged$),(0,p.Q)(this.ngUnsubscribe)).subscribe(a=>{this.cameraService.rotateCameraStatic(0,a)}),this.firstInteractionLogged$.pipe((0,va.E)(o),(0,p.Q)(this.ngUnsubscribe)).subscribe(([,a])=>{const r=a?.camera?.location;r&&this.store.dispatch(new Ut.Ih(r,!0,2))})}}initHumanReadyListener(){this.actions.pipe((0,l.xi)(z.c.platform===Ls.N.SDK?ct.nm:ct.P5)).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.engineService.fireEvent(Ct.X.Started,null)})}initChaptersReadyListener(){this.store.select(me.N.getAllChaptersModelsReady).pipe((0,D.p)(i=>!0===i),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new ct.P5)})}initDynamicLayout(){(0,cn.z)([this.store.select(Z.getWidgetApiUIConfig),this.store.select(Z.getWidgetUrlConfig),this.store.select(me.N.getSelectedChapter),this.store.select(Fe.j.getQuizModeActive),this.store.select(Fe.j.getActiveQuestion),this.store.select(On.U.getXRActive)]).pipe((0,D.p)(([i,t,o])=>null!=o&&null!=t),(0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t,o,s,a,r])=>{const _=tm(t),g=function lv(n){if(!n||!n.config)return null;const i=new fa;return i[G.Column]=n.config.info,i[G.Drawer]=n.config.info,i[G.Fullscreen]=n.config.fullscreen,i[G.Search]=n.config.objectTree,i[G.Camera]=n.config.nav,i[G.Loader]=zl(n.config.loader),i[G.Whiteboard]=n.config.whiteboard,i[G.VisibilityLayers]=n.config.visibilityLayers,i[G.VisibilityLayersMode]=Wl(n.config.visibilityLayersMode,n.config.skinLayers),i[G.SkinLayers]=n.config.skinLayers,i[G.ContextActions]=n.config.contextActions,i[G.Audio]=(0,u.isNil)(n.config.audio)?null:n.config.audio!==ii.None,i[G.Media]=cp(n.config.playPause,n.config.scrubber,n.config.mediaControls),i}(o.ui);this.viewService.setUI({apiUIConfig:i,urlUIConfig:_,chapterUIConfig:g,quizUIConfig:s?dv(a):null,xrUIConfig:r?cv():null})})}initHeaderAndFooter(){(0,cn.z)([this.horizontalBreakpoint$,this.verticalBreakpoint$]).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const o=i<=Qn.Medium?40:56,s=o;this.store.dispatch(new Un.SetHeaderHeight(o)),this.store.dispatch(new Un.SetFooterHeight(s));const a=this.widgetElRef.nativeElement;a.style.setProperty("--header-height",`${o}px`),a.style.setProperty("--footer-height",`${s}px`)})}handleContentErrors(){this.store.dispatch(new ct.yi(null,null)),this.errorService.redirectToErrorPage(Tu.Y.Content)}handleAuthErrors(i){z.c.deploy!==pi.Z.Local&&this.errorService.redirectToErrorPage(mS.Auth,i.response.errorCode)}getDocumentInteraction(){let i,t;return new h.c(o=>{i=new ei.Manager(document.documentElement),i.add([new ei.Tap({event:"singletap"}),new ei.Tap({event:"doubletap",taps:2}),new ei.Pan({event:"pan",direction:ei.DIRECTION_ALL,threshold:0})]),t=()=>o.next(),i.on("panstart",t),i.on("singletap",t),document.documentElement.addEventListener("keypress",t),document.documentElement.addEventListener("focusin",t),document.documentElement.addEventListener("wheel",t)}).pipe((0,Ot.j)(()=>{i&&(i.destroy(),i=null),document.documentElement.removeEventListener("keypress",t),document.documentElement.removeEventListener("focusin",t),document.documentElement.removeEventListener("wheel",t)}),(0,p.Q)(this.ngUnsubscribe))}getIntersectionObserver(i,t){return new h.c(o=>{const a=new IntersectionObserver(r=>{r[0].intersectionRatio>=t&&(o.next(i),o.complete(),a.unobserve(i))},{root:null,threshold:t});a.observe(i)})}setWidgetTransparent(i){i?this.renderer.setStyle(document.body,"background","none transparent"):this.renderer.removeStyle(document.body,"background")}static#e=this.\u0275fac=function(t){return new(t||xo)(e.rXU(J.qQ),e.rXU(l.il),e.rXU(l.En),e.rXU(K.nX),e.rXU(a4),e.rXU(r4.I),e.rXU(v.y),e.rXU(go.j),e.rXU(It.n$),e.rXU(e.sFG),e.rXU(En),e.rXU(ba),e.rXU(Cu))};static#t=this.\u0275cmp=e.VBU({type:xo,selectors:[["app-widget-master"]],viewQuery:function(t,o){if(1&t&&e.GBs(h4,7),2&t){let s;e.mGM(s=e.lsd())&&(o.widgetElRef=s.first)}},decls:9,vars:10,consts:[["widgetElRef",""],[1,"widget","theme-light"],["class","widget__header",3,"ngSwitch",4,"ngIf"],[1,"widget__body"],["class","widget-shell",3,"widget-shell--xr",4,"appFlagApplication","appFlagApplicationPlatform","appFlagApplicationMode"],[1,"widget__header",3,"ngSwitch"],[1,"widget-shell"]],template:function(t,o){1&t&&(e.j41(0,"div",1,0),e.nI1(2,"async"),e.nrm(3,"app-skip-nav"),e.DNE(4,g4,3,3,"div",2),e.nI1(5,"async"),e.j41(6,"div",3),e.nrm(7,"router-outlet"),e.k0s()(),e.DNE(8,m4,2,4,"div",4)),2&t&&(e.AVh("widget--xr",e.bMT(2,6,o.xrActive$)),e.R7$(4),e.Y8G("ngIf",e.bMT(5,8,o.siteHeader$)===o.siteHeaderType.Logo),e.R7$(4),e.Y8G("appFlagApplication",o.environmentApplication.All)("appFlagApplicationPlatform",o.environmentPlatform.SDK)("appFlagApplicationMode","exclude"))},dependencies:[J.bT,J.ux,K.n3,bp.Y,za,u4,J.Jj],styles:[".widget[_ngcontent-%COMP%]{--header-height: 56px;--footer-height: 56px;position:fixed;inset:0;display:flex;flex-direction:column;height:100vh;overflow:hidden}.widget__header[_ngcontent-%COMP%]{height:fit-content}.widget-shell[_ngcontent-%COMP%]{pointer-events:none;position:fixed;inset:0;z-index:99999;box-shadow:inset 0 0 0 1px #d4d9e3}.widget-shell--xr[_ngcontent-%COMP%]{display:none!important}"]})}Wa([(0,l.l6)(Z.getBypassAnalytics),Xa("design:type",h.c)],xo.prototype,"bypassAnalytics$",void 0),Wa([(0,l.l6)(vn.getSiteHeader),Xa("design:type",h.c)],xo.prototype,"siteHeader$",void 0),Wa([(0,l.l6)(Dn.getHorizontalBreakpoint),Xa("design:type",h.c)],xo.prototype,"horizontalBreakpoint$",void 0),Wa([(0,l.l6)(Dn.getVerticalBreakpoint),Xa("design:type",h.c)],xo.prototype,"verticalBreakpoint$",void 0),Wa([(0,l.l6)(Z.getEmbedded),Xa("design:type",h.c)],xo.prototype,"embedded$",void 0),Wa([(0,l.l6)(On.U.getXRActive),Xa("design:type",h.c)],xo.prototype,"xrActive$",void 0);const S4={title:"We're unable to find the model you're looking for.",description:'Please check your URL or visit the <a href="/" target="_blank">BioDigital Human</a> to see what\'s available in our 3D model library.'},b4={title:"Your BioDigital Human embed requires proper authentication.",description:""},y4={[vu.InvalidUAID]:{title:"Authentication Issues",description:"Your Human Widget has invalid user credentials.",url:"https://support.biodigital.com"}};function v4(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleSeeDetailsClick())}),e.EFF(1," See Details "),e.k0s()}}function E4(n,i){if(1&n&&(e.j41(0,"textarea",14),e.EFF(1,"        "),e.k0s()),2&n){const t=e.XpG(2);e.Y8G("value",t.engineErrorReport)}}function C4(n,i){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"h1",3),e.EFF(2,"The BioDigital Human encountered an error."),e.k0s(),e.j41(3,"h2",4),e.EFF(4," Error: "),e.j41(5,"span",5),e.EFF(6),e.k0s()(),e.j41(7,"div",6),e.EFF(8," To receive assistance with this error, please follow these steps: "),e.k0s(),e.j41(9,"ol",7)(10,"li",8)(11,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleDownloadClick())}),e.EFF(12," Download "),e.k0s(),e.EFF(13," the error report. "),e.k0s(),e.j41(14,"li",8)(15,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleActionClick(s.supportURL))}),e.EFF(16," Share the report "),e.k0s(),e.EFF(17," with the customer support team. "),e.k0s()(),e.j41(18,"div",10),e.DNE(19,v4,2,0,"button",11),e.j41(20,"div"),e.DNE(21,E4,2,1,"textarea",12),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(6),e.JRh(t.engineErrorMessage),e.R7$(13),e.Y8G("ngIf",!t.viewEngineErrorDetails),e.R7$(2),e.Y8G("ngIf",t.viewEngineErrorDetails)}}function T4(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",3),e.EFF(1),e.k0s(),e.j41(2,"div",15),e.qex(3),e.j41(4,"button",9),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleActionClick(s.supportURL))}),e.EFF(5," Contact Support "),e.k0s(),e.bVm(),e.k0s(),e.nrm(6,"div",16)}if(2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.title," "),e.R7$(5),e.Y8G("innerHTML",t.description,e.npT)}}const vS=[{path:"",component:xo,resolve:{widgetUrlConfig:eu},children:[{path:"",component:ht},{path:"error",component:(()=>{class n{handleSeeDetailsClick(){this.viewEngineErrorDetails=!0}get title(){return this.errorConfig.title}get description(){return this.errorConfig.description}constructor(t,o,s){this.router=t,this.snackBar=o,this.engineService=s,this.supportURL="https://support.biodigital.com",this.isEngineError=!1,this.viewEngineErrorDetails=!1;const{errorType:a,errorCode:r,error:_,errorUrl:g}=this.router.getCurrentNavigation().extras.state;this.errorType=a,this.errorUrl=g,this.errorCode=r,this.error=_}ngOnInit(){if(this.errorType===Tu.Y.Engine){this.isEngineError=!0;const t={contentId:this.errorUrl,error:this.error,webglInfo:this.engineService.getWEBGLInfo()};this.engineErrorMessage=t.error.message,this.engineErrorReport=JSON.stringify(t,null,2)}else this.errorConfig=this.errorType===Tu.Y.Content?S4:y4[this.errorCode]||b4}handleDownloadClick(){(0,Ug.saveAs)(new Blob([this.engineErrorReport],{type:"text/plain"}),"BioDigital_Error_Report.txt")}handleActionClick(t){window.open(t)||this.snackBar.open("Unable to open link in new window, please check your pop-up settings.")}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(K.Ix),e.rXU(ui.UG),e.rXU(v.y))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-error-page"]],decls:4,vars:2,consts:[["notEngineError",""],[1,"error"],[4,"ngIf","ngIfElse"],[1,"text-2xl","font-bold"],[1,"text-base","mt-4","mb-8"],[1,"font-semibold"],[1,"text-base","mb-4"],[1,"text-base"],[1,"my-4"],["app-button","","buttonType","outline","buttonTheme","light",3,"click"],[1,"mt-8"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click",4,"ngIf"],["class","error__details mt-2",3,"value",4,"ngIf"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","xs",3,"click"],[1,"error__details","mt-2",3,"value"],[1,"flex","items-start","mt-10"],[1,"error__description","text-base","mt-8",3,"innerHTML"]],template:function(o,s){if(1&o&&(e.j41(0,"div",1),e.DNE(1,C4,22,3,"div",2)(2,T4,7,2,"ng-template",null,0,e.C5r),e.k0s()),2&o){const a=e.sdS(3);e.R7$(),e.Y8G("ngIf",s.isEngineError)("ngIfElse",a)}},dependencies:[Mn.Q,J.bT],styles:[".error[_ngcontent-%COMP%]{margin:0 auto;max-width:640px;display:flex;flex-direction:column;padding:40px;color:#283853}.error[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style:decimal}.error__details[_ngcontent-%COMP%]{width:100%;height:200px}.error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .error__description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{color:#283853}"],changeDetection:0})}return n})()}]}],O4=!0===z.c.offline?K.iI.forRoot(vS,{useHash:!0}):K.iI.forRoot(vS);let M4=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({providers:[eu],imports:[O4,K.iI]})}return n})();var I4=d(37522),P4=d(29512),w4=d(57078),A4=d(50583),R4=d(83649),N4=d(43649),k4=d(98138);[I4.A,P4.A,w4.A,A4.A,R4.A,N4.A,k4.A].forEach(n=>{(0,J.EO)(n)});let ES=(()=>{class n{static forRoot(){return{ngModule:n,providers:[{provide:e.xe9,useFactory:Jn.kF},{provide:e.hnV,useFactory:bg,deps:[f.Qq,e.xe9],multi:!0}]}}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD]})}return n})();var CS=d(81488);class Br{}var ai=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Mt=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const TS="/viewer",Mu={publishing:!1,widgetURL:TS,dimensions:Rg.dimensions,minDimensions:{width:300,height:400},aspectRatio:{width:4,height:3}};let In=class Ad{static getDimensions(i){return i.dimensions}static getAspectRatio(i){return i.aspectRatio}static getMinDimensions(i){return i.minDimensions}static getWidgetURL(i){return i.widgetURL}static getPublishing(i){return i.publishing}setPublishWidgetURL(i,t){i.patchState({widgetURL:t.widgetURL||TS})}setPublishDimensions(i,t){i.patchState({dimensions:t.dimensions})}getPublishURL(i,t){const{model:o,camera:s,widgetOptions:a}=t,{widgetURL:r}=i.getState(),_=this.store.selectSnapshot(Pe.getUserLanguage),g=this.store.selectSnapshot(Pe.getSelectedUserApp),P=this.store.selectSnapshot(We.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetURL(o,r,a,s,ua.Single,_,g,P).subscribe(F=>{i.dispatch(new xl(o,F))},()=>{i.dispatch(new np(o))})}getPublishURLSuccess(i,t){this.vendorAnalyticsService.track("Publish - Success",{type:"url",source:"publish"})}getPublishURLFail(i,t){this.snackbar.open("Unable to generate URL.")}getPublishIFrame(i,t){const{model:o,camera:s,widgetOptions:a}=t,r=i.getState(),_=r.widgetURL,g=t.dimensions??r.dimensions,P=this.store.selectSnapshot(Pe.getUserLanguage),F=this.store.selectSnapshot(Pe.getSelectedUserApp),ee=this.store.selectSnapshot(We.getSelectedOrganizationProductAccountId);this.publishService.generateWidgetEmbed(o,_,a,g,s,ua.Single,P,F,ee).subscribe(le=>{i.dispatch(new Ul(le))},()=>{i.dispatch(new Vg)})}setPublishIFrameSuccess(i,t){this.vendorAnalyticsService.track("Publish - Success",{type:"iframe",source:"publish"})}savePublishImage(i,{imageData:t,imageType:o}){this.publishService.saveUserImage(t,o).subscribe(s=>{i.dispatch(new ip(s))},()=>{i.dispatch(new q1)})}savePublishImageSuccess(i,t){this.vendorAnalyticsService.track("Publish - Success",{type:"image",source:"publish"})}getPublishImage(i,t){const{model:o,camera:s,widgetOptions:a,imageData:r,fileType:_}=t,{widgetURL:g}=i.getState(),P=this.store.selectSnapshot(Pe.getUserLanguage),F=this.store.selectSnapshot(Pe.getSelectedUserApp);(0,di.p)(this.publishService.generateWidgetURL(o,g,a,s,ua.Single,P,F),this.publishService.saveUserImage(r,_)).subscribe(([ee,le])=>{const he=this.publishService.getImageEmbed(o.title,ee,le);i.dispatch(new J1(he))},()=>{i.dispatch(new Z1)})}setPublishing(i,{publishing:t}){i.patchState({publishing:t})}resetPublish(i,t){i.setState(Mu)}constructor(i,t,o,s){this.publishService=i,this.store=t,this.snackbar=o,this.vendorAnalyticsService=s}static#e=this.\u0275fac=function(t){return new(t||Ad)(e.KVO(Io),e.KVO(l.il),e.KVO(ui.UG),e.KVO(ve))};static#t=this.\u0275prov=e.jDH({token:Ad,factory:Ad.\u0275fac})};ai([(0,l.rc)(J_),Mt("design:type",Function),Mt("design:paramtypes",[Object,J_]),Mt("design:returntype",void 0)],In.prototype,"setPublishWidgetURL",null),ai([(0,l.rc)(Z_),Mt("design:type",Function),Mt("design:paramtypes",[Object,Z_]),Mt("design:returntype",void 0)],In.prototype,"setPublishDimensions",null),ai([(0,l.rc)(tp),Mt("design:type",Function),Mt("design:paramtypes",[Object,tp]),Mt("design:returntype",void 0)],In.prototype,"getPublishURL",null),ai([(0,l.rc)(xl),Mt("design:type",Function),Mt("design:paramtypes",[Object,xl]),Mt("design:returntype",void 0)],In.prototype,"getPublishURLSuccess",null),ai([(0,l.rc)(np),Mt("design:type",Function),Mt("design:paramtypes",[Object,np]),Mt("design:returntype",void 0)],In.prototype,"getPublishURLFail",null),ai([(0,l.rc)(ep),Mt("design:type",Function),Mt("design:paramtypes",[Object,ep]),Mt("design:returntype",void 0)],In.prototype,"getPublishIFrame",null),ai([(0,l.rc)(Ul),Mt("design:type",Function),Mt("design:paramtypes",[Object,Ul]),Mt("design:returntype",void 0)],In.prototype,"setPublishIFrameSuccess",null),ai([(0,l.rc)(Gg),Mt("design:type",Function),Mt("design:paramtypes",[Object,Gg]),Mt("design:returntype",void 0)],In.prototype,"savePublishImage",null),ai([(0,l.rc)(ip),Mt("design:type",Function),Mt("design:paramtypes",[Object,ip]),Mt("design:returntype",void 0)],In.prototype,"savePublishImageSuccess",null),ai([(0,l.rc)($g),Mt("design:type",Function),Mt("design:paramtypes",[Object,$g]),Mt("design:returntype",void 0)],In.prototype,"getPublishImage",null),ai([(0,l.rc)(jl),Mt("design:type",Function),Mt("design:paramtypes",[Object,jl]),Mt("design:returntype",void 0)],In.prototype,"setPublishing",null),ai([(0,l.rc)(Fg),Mt("design:type",Function),Mt("design:paramtypes",[Object,Fg]),Mt("design:returntype",void 0)],In.prototype,"resetPublish",null),ai([(0,l.MD)(),Mt("design:type",Function),Mt("design:paramtypes",[Br]),Mt("design:returntype",void 0)],In,"getDimensions",null),ai([(0,l.MD)(),Mt("design:type",Function),Mt("design:paramtypes",[Br]),Mt("design:returntype",void 0)],In,"getAspectRatio",null),ai([(0,l.MD)(),Mt("design:type",Function),Mt("design:paramtypes",[Br]),Mt("design:returntype",void 0)],In,"getMinDimensions",null),ai([(0,l.MD)(),Mt("design:type",Function),Mt("design:paramtypes",[Br]),Mt("design:returntype",void 0)],In,"getWidgetURL",null),ai([(0,l.MD)(),Mt("design:type",Function),Mt("design:paramtypes",[Br]),Mt("design:returntype",void 0)],In,"getPublishing",null),In=ai([(0,l.Uw)({name:"publish",defaults:Mu}),Mt("design:paramtypes",[Io,l.il,ui.UG,ve])],In);var D4=d(11562),zr=d(9529);let L4=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,sn.o,fe.YN,fe.X1]})}return n})(),OS=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,fe.X1,Lt.G,D4.YG,zr.bU,L4,l.rK.forFeature([In])]})}return n})(),Mc=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([ft]),J.MD,Nt.G,fe.X1,Lt.G,K.iI,OS]})}return n})();class ao{}class MS{}var IS=function(n){return n[n.Query=0]="Query",n[n.Path=1]="Path",n}(IS||{}),Wr=function(n){return n[n.Row=0]="Row",n[n.Card=1]="Card",n}(Wr||{});const U4=z.c.application===xn.c.Loft?Wr.Row:Wr.Card;var Ic=function(n){return n.Success="success",n.Fail="fail",n}(Ic||{});const x4="cdb/content",j4="cdb/copy/content",V4={headers:new f.Lr({"Content-Type":"application/json; charset=utf-8"})},F4=["production","client","preview","internal_content","public_preview","demos","social","exports","real_data"];let PS=(()=>{class n{constructor(t,o){this.http=t,this.sceneService=o}saveModule(t,o){o=this.formatModulePath(o);const s=[x4,"modules",o].join("/"),a=this.JSONStringify(t);return this.http.put(s,a,V4).pipe((0,W.T)(()=>Ic.Success),(0,zi.W)(({status:r})=>(0,Rt.of)(r>=200&&r<=202?Ic.Success:Ic.Fail)))}mergeModule(t,o,s="exception"){return this.http.post("/cdb/merge/modules",{loft:`${t}.json`,bridge:`${o}.json`,merge_option:s})}copyState(t,o){const s=[j4,"states",o].join("/"),a={headers:new f.Lr({"Content-Type":"application/json; charset=utf-8","source-state":t})};return this.http.put(s,{},a)}listContents(t,o,s,a=!1){const r=this.generateModulePath(t,o||"",s||"");return this.http.get(`/cdb/ls/content/modules/${r}`).pipe((0,W.T)(_=>a?_.contents.map(P=>{const F=P.name.replace("/content/modules/","").replace(".json",""),ee=P.name.split("/").pop().replace("/content/modules","").replace(".json",""),le=new Te;return le.id=F,le.title=ee,le.type=Se.c.Module,le}):_.contents))}getState(t){return this.http.get(`/cdb/ls/content/states/${t}`).pipe((0,W.T)(o=>o.contents))}getClients(){return this.http.get("/search/client").pipe((0,W.T)(t=>t.clients))}getUsedStates(){const t={};return Object.values(this.sceneService.getObjects()).reduce((o,s)=>(["transformId","morphId","geometryId","materialId"].forEach(a=>{const r=this.getPropertyState(s,a);r.length&&(t[r]=!0)}),s.hasOwnProperty("renderables")&&["morphId","geometryId","materialId"].forEach(a=>{s.renderables.forEach(_=>{const g=this.getPropertyState(_,a);g.length&&(t[g]=!0)})}),o),{}),Object.keys(t)}parseScenePath(t){const o=t.split("/");return 1===o.length?null:{fullPath:`https://qa.biodigital.com/content/modules/${t}`,relativePath:o.slice(0,o.length-1).join("/"),sceneName:o[o.length-1]}}formatModulePath(t){let o=t;return/\.json$/.test(t)||(o=`${o}.json`),o}getPrimaryCategories(){return(0,Rt.of)(F4)}getSecondaryCategories(t){switch(t){case"production":return(0,Rt.of)(["maleAdult","femaleAdult"]);case"client":return this.getClients();default:return(0,Rt.of)([])}}generateSaveModule(t){const o=this.parseScenePath(t),s=o.relativePath.split("/");return{id:t,name:o.sceneName,primaryCategory:s[0]||"",secondaryCategory:s[1]||""}}generateModulePath(t,o,s){const a=[];return t.length&&a.push(t),o.length&&a.push(o),s.length&&(s.indexOf(".json")<0&&(s=`${s}.json`),a.push(s)),a.join("/")}getPropertyState(t,o){return null!=t[o]?t[o].split("/")[0]:""}JSONStringify(t){return JSON.stringify(t).replace(/[\u007f-\uffff]/g,o=>"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(Fi.w))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class Iu{constructor(i="",t,o=25,s=0){this.query=i,this.sortBy=t,this.pageSize=o,this.offset=s}}class Xr{}let wS=(()=>{class n{constructor(t){this.store=t}ngOnInit(){}close(){this.store.dispatch(new kt.ShowFilters(!1,!0))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-gallery-drawer"]],decls:8,vars:2,consts:[["appEventFence","","data-test","galleryDrawer",1,"gallery-drawer"],[1,"gallery-drawer__header"],[1,"gallery-drawer__label"],["app-button","","buttonType","ghost","buttonTheme","light","type","button","title","Close","data-test","galleryDrawerClose",3,"click"],["icon","times","size","lg"],[1,"gallery-drawer__body"],["viewMode","expanded"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3,"Filters"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return s.close()}),e.nrm(5,"app-icon",4),e.k0s()(),e.j41(6,"div",5),e.nrm(7,"app-gallery-filters",6),e.k0s()()),2&o&&(e.Y8G("@expand",void 0),e.R7$(4),e.BMQ("aria-label","Close"))},styles:[".gallery-drawer[_ngcontent-%COMP%]{box-shadow:0 11px 15px #0003,0 24px 38px #00000024,0 9px 46px #0000001f;background:#fff;border-radius:16px 16px 0 0;display:block;position:fixed;bottom:0;top:auto;width:100vw}.gallery-drawer__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;border-bottom:1px solid #e7eaee;height:52px;padding:0 12px 0 20px;display:flex;align-items:center}.gallery-drawer__label[_ngcontent-%COMP%]{flex:1 0 auto}.gallery-drawer__body[_ngcontent-%COMP%]{padding:20px}"],data:{animation:[(0,xe.hZ)("expand",[(0,xe.kY)(":enter",[(0,xe.K2)([(0,xe.iF)({top:"100%"}),(0,xe.i0)("250ms ease-in-out",(0,xe.iF)({top:"*"}))])])])]},changeDetection:0})}return n})(),AS=(()=>{class n{constructor(t,o){this.overlay=t,this.store=o}openDrawer(){this.overlayRef||this._createOverlay();const t=new dc.A8(wS);this.overlayRef.attach(t)}closeDrawer(){this.overlayRef.detach()}_createOverlay(){const t=new gr.rR({hasBackdrop:!0,scrollStrategy:this.overlay.scrollStrategies.block()});this.overlayRef=this.overlay.create(t),this.overlayRef.backdropClick().subscribe(()=>{this.store.dispatch(new kt.ShowFilters(!1,!0))})}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(gr.hJ),e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Co=d(74394);class Xn{static#e=this.store=null;static#t=this.snackBar=null;static#n=this.router=null;static#i=this.appVersion="";static#o=this._offlineModelIDs=new Li.t([]);static#s=this._offlineModelIDs$=Xn._offlineModelIDs.asObservable();static getOfflineModelIDs(){return Xn._offlineModelIDs$}static setOfflineModelIDs(i){Xn._offlineModelIDs.next(i)}static getOfflineModelIDList(){return this._offlineModelIDs.getValue()}static setStore(i){Xn.store=i}static setServices(i,t){Xn.rpcService=i,Xn.applicationEventService=t}static setSnackBar(i){Xn.snackBar=i}static setRouter(i){Xn.router=i}static debug(i){this.fire(rt.F.NativeDebugMessage,i)}static fire(i,t){Xn.applicationEventService&&Xn.applicationEventService.fireEvent(i,t)}on(i,t){Xn.rpcService&&Xn.rpcService.getEvent(i,!1).subscribe(t)}send(i,t){let o=null,s={};switch(i){case Ce.NativeErrorMessage:o=Xn.snackBar.open(t,"OK",{duration:6e3,verticalPosition:"top"}),o.onAction().subscribe(()=>{o.dismiss()});break;case Ce.NativeSetAppVersion:Xn.appVersion=t.appVersion;break;case Ce.NativeRedirect:s=JSON.parse(t.queryItems),Xn.router.navigate([t.url],{queryParams:s});break;case Ce.NativeReload:window.location.href=t.url;break;case Ce.NativeOfflineModelIds:Xn.setOfflineModelIDs(t.modelIds);break;default:Xn.debug("unprocessed HumanWindowAPI send "+i)}}}var Ft=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Ae=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const RS=[kn.Organization,kn.Collection],G4=[...RS,kn.Category],NS={[Oo.Private]:"My Models",[Oo.TeamEdit]:"View & Edit",[Oo.TeamView]:"View Only"},$4=Object.fromEntries(Object.entries(NS).map(([n,i])=>[i,n])),kS={loading:!0,searchMode:IS.Query,viewMode:U4,showFilters:!1,searchResults:{total:0,items:[]},checkedResults:[],searchConfig:null,searchOptions:{offset:0,pageSize:0,sortBy:{ascending:!0,fields:[],label:""},query:""},sidenav:{enabled:!0,open:!0,disableClose:!1},bulkActions:{enabled:!0,active:!1,items:[]},cardActions:{enabled:!0}},B4=[...Co.Ht.tags,...Co.a.tags,...Co.oM.tags,...Co.Ue.tags,...Co.iE.tags];let gt=class Rd{static getLoading(i){return i.loading}static getSearchMode(i){return i.searchMode}static getSearchConfig(i){return i.searchConfig}static getSearchOptions(i){return i.searchOptions}static getSearchResults(i){return i.searchResults}static getHasFilters(i){return G4.includes(i?.type)||!0===z.c.native}static getAvailableTags(i,t){const o=new Set,s=i.items,a=z.c.native?Xn.getOfflineModelIDList():[];return RS.includes(t?.type)?function U1(n){const i=new Set;return n.forEach(t=>{const o=!0===t.is_owner,s=V_(t),a=Mg(t),r=kl(t);o?i.add(Oo.Private):s&&a?i.add(Oo.TeamEdit):(s&&!a||r)&&i.add(Oo.TeamView)}),Array.from(i)}(s).forEach(g=>{o.add(NS[g])}):s.forEach(_=>{_.tags.forEach(g=>{"quiz"===g&&(g="Quiz"),B4.includes(g)&&o.add(g)}),z.c.native&&a.includes(_.id)&&o.add("Downloaded")}),Array.from(o)}static getActiveTags(i){const t={};return(i?.tags??[]).forEach(s=>{const a=Co.Pg.find(r=>r.tags.some(_=>_===s));a&&(t[a?.title??""]=s)}),t}static getActiveTagsCount(i){return(0,u.compact)(i?.tags??[]).length}static getSearchType(i){return i?.type??null}static getSearchGroup(i){switch(i){case kn.Category:case kn.Community:case kn.Internal:case kn.Loft:return Se.c.Module;case kn.Collection:case kn.Private:case kn.Organization:return Se.c.Bookmark}}static getViewMode(i){return i.viewMode}static getShowFilters(i){return i.showFilters}static getSort(i){return i.searchOptions?.sortBy}static getSortOptions(i){switch(i){case kn.Loft:return[pr,Fl];case kn.Category:return[zg,Vl,pr,Fl];default:return[Vl,pr,Fl,Wg,Xg]}}static getSidenav(i){return i.sidenav}static getBulkActions(i){return i.bulkActions}static getBulkActionsAvailable(i){const{enabled:t,items:o}=i;return t&&o.length>0}static getBulkActionsActive(i){return i.active}static getCardActions(i){return i.cardActions}static getFilteredResults(i,t,o){if((0,u.isNil)(t)||(0,u.isNil)(o)||(0,u.isNil)(i))return{total:0,items:[]};let s=[...i.items];if(null!==t){const{ascending:a,fields:r}=t.sortBy,{offset:_,pageSize:g}=t;s=ap(i.items,r,a),s=Qg(t,o,s),s=s.slice(_,_+g)}return{total:i.total,items:s}}static getAllResults(i,t,o){const{ascending:s,fields:a}=t.sortBy;let r=ap(i.items,a,s);return r=Qg(t,o,r),{total:i.total,items:r}}static getCheckedResults(i){return i.checkedResults}static isZSpaceSearch(i){return i?.type===kn.Category&&i?.categoryId===Ei.a.Zspace}setSearchMode(i,t){i.patchState({searchMode:t.searchMode})}setViewMode(i,t){i.patchState({viewMode:t.viewMode})}showFilters(i,t){i.patchState({showFilters:t.show}),t.triggerDrawer&&(t.show?this.galleryService.openDrawer():this.galleryService.closeDrawer())}setSearchOptions(i,t){i.patchState({searchOptions:{...t.options}})}setActiveTags(i,t){const s={...i.getState().searchConfig,tags:(0,u.flatten)(Object.values(t.activeTags))};this.store.dispatch(new kt.SetSearchConfig(s))}setSearchConfig(i,t){const o=t.config||i.getState().searchConfig,s=t.options||i.getState().searchOptions;null!==o&&i.patchState({searchOptions:{...s},searchConfig:{...o}})}searchCategory(i,{categoryId:t}){const o="public"===t?new iv(""):new nv(t);i.dispatch(new kt.SetSearchConfig(o))}searchStudio(i,t){const{searchConfig:o,searchOptions:s}=i.getState(),a=new Iu("",pr),r=this.store.selectSnapshot(Pe.getUserLanguage),_=this.store.selectSnapshot(We.isZSpaceAccount);i.patchState({loading:!0,searchOptions:{...s,pageSize:a.pageSize,offset:a.offset},checkedResults:[]});let g=new h.c;switch(o.type){case kn.Category:g=this.exploreService.getAnatomyCategory(o.query,"all"===o.categoryId?"":o.categoryId,o.tags.filter(ee=>!ee.startsWith("Downloaded")),_,r);break;case kn.Organization:g=this.bookmarksService.getOrganizationContent(o.organizationId,o.query,r);break;case kn.Collection:g=this.organizationsService.getCollectionContent(o.organizationId,o.collectionId,o.query,r);break;case kn.Community:g=this.bookmarksService.getPublicBookmarks(o.query,r);break;case kn.Private:g=this.bookmarksService.getPrivateContent(o.query,r);break;case kn.Internal:g=this.exploreService.searchInternal(o.query,o.directory);break;case kn.Loft:const F=o.query.indexOf(".json")>0;g=this.modulesService.listContents(o.primary,o.secondary,F?o.query:"",!0).pipe((0,W.T)(ee=>F?ee:ee.filter(le=>le.title.indexOf(o.query)>=0)))}const P=o.tags.reduce((F,ee)=>{const le=$4[ee];return le&&F.push(le),F},[]);g.pipe((0,W.T)(F=>P.length>0?function L1(n,i,t=!0){return n.filter(o=>{const s=!0===o.is_owner,a=V_(o),r=Mg(o),_=kl(o),g=P=>{switch(P){case Oo.Private:return s;case Oo.TeamEdit:return a&&r;case Oo.TeamView:return a&&!r||_;default:return!1}};return t?i.every(g):i.some(g)})}(F,P):F),(0,Ot.j)(()=>i.patchState({loading:!1}))).subscribe(F=>{const ee=z.c.native?Xn.getOfflineModelIDList():[],le=o.tags.includes("Downloaded")?F.filter(he=>ee.includes(he.id)):F;i.dispatch(new kt.SearchSuccess(le))})}searchSuccess(i,t){i.patchState({searchResults:{items:t.bookmarks,total:t.bookmarks.length}});const o=i.getState().searchConfig,s=t.bookmarks.length>0?"Search - With Results":"Search - No Results",a={...o,tags:o.tags.filter(r=>""!==r).join(", ")};this.vendorAnalyticsService.track(s,a)}checkItem(i,t){let o=i.getState().checkedResults;const s=o.some(a=>a===t.id);t.checked&&!s?o=[...o,t.id]:t.checked||(o=o.filter(a=>a!==t.id)),i.patchState({checkedResults:o})}checkAll(i,t){const o=i.getState().searchResults.items.map(s=>s.id);i.patchState({checkedResults:o})}uncheckAll(i,t){i.patchState({checkedResults:[]})}setCheckedItems(i,t){i.patchState({checkedResults:t.ids})}setSidenav(i,t){i.patchState({sidenav:{...t.sidenav}})}setCardActions(i,t){i.patchState({cardActions:{...t.cardActions}})}setBulkActions(i,t){const{bulkActions:o}=i.getState();i.patchState({bulkActions:{...o,...t.bulkActions}})}clearResults(i,t){i.patchState({searchResults:{items:[],total:0}})}resetGallery(i,t){i.patchState(kS)}constructor(i,t,o,s,a,r,_){this.organizationsService=i,this.modulesService=t,this.exploreService=o,this.bookmarksService=s,this.galleryService=a,this.store=r,this.vendorAnalyticsService=_}static#e=this.\u0275fac=function(t){return new(t||Rd)(e.KVO(ce),e.KVO(PS),e.KVO(Gl),e.KVO(Bo),e.KVO(AS),e.KVO(l.il),e.KVO(ve))};static#t=this.\u0275prov=e.jDH({token:Rd,factory:Rd.\u0275fac})};Ft([(0,l.rc)(kt.SetSearchMode),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetSearchMode]),Ae("design:returntype",void 0)],gt.prototype,"setSearchMode",null),Ft([(0,l.rc)(kt.SetViewMode),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetViewMode]),Ae("design:returntype",void 0)],gt.prototype,"setViewMode",null),Ft([(0,l.rc)(kt.ShowFilters),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.ShowFilters]),Ae("design:returntype",void 0)],gt.prototype,"showFilters",null),Ft([(0,l.rc)(kt.SetSearchOptions),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetSearchOptions]),Ae("design:returntype",void 0)],gt.prototype,"setSearchOptions",null),Ft([(0,l.rc)(kt.SetActiveTags),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetActiveTags]),Ae("design:returntype",void 0)],gt.prototype,"setActiveTags",null),Ft([(0,l.rc)(kt.SetSearchConfig),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetSearchConfig]),Ae("design:returntype",void 0)],gt.prototype,"setSearchConfig",null),Ft([(0,l.rc)(kt.SearchCategory),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SearchCategory]),Ae("design:returntype",void 0)],gt.prototype,"searchCategory",null),Ft([(0,l.rc)(kt.SearchStudio),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SearchStudio]),Ae("design:returntype",void 0)],gt.prototype,"searchStudio",null),Ft([(0,l.rc)(kt.SearchSuccess),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SearchSuccess]),Ae("design:returntype",void 0)],gt.prototype,"searchSuccess",null),Ft([(0,l.rc)(kt.CheckItem),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.CheckItem]),Ae("design:returntype",void 0)],gt.prototype,"checkItem",null),Ft([(0,l.rc)(kt.CheckAll),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.CheckAll]),Ae("design:returntype",void 0)],gt.prototype,"checkAll",null),Ft([(0,l.rc)(kt.UncheckAll),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.UncheckAll]),Ae("design:returntype",void 0)],gt.prototype,"uncheckAll",null),Ft([(0,l.rc)(kt.SetCheckedItems),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetCheckedItems]),Ae("design:returntype",void 0)],gt.prototype,"setCheckedItems",null),Ft([(0,l.rc)(kt.SetSidenav),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetSidenav]),Ae("design:returntype",void 0)],gt.prototype,"setSidenav",null),Ft([(0,l.rc)(kt.SetCardActions),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetCardActions]),Ae("design:returntype",void 0)],gt.prototype,"setCardActions",null),Ft([(0,l.rc)(kt.SetBulkActions),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.SetBulkActions]),Ae("design:returntype",void 0)],gt.prototype,"setBulkActions",null),Ft([(0,l.rc)(kt.ClearResults),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.ClearResults]),Ae("design:returntype",void 0)],gt.prototype,"clearResults",null),Ft([(0,l.rc)(kt.Reset),Ae("design:type",Function),Ae("design:paramtypes",[Object,kt.Reset]),Ae("design:returntype",void 0)],gt.prototype,"resetGallery",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getLoading",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSearchMode",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSearchConfig",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSearchOptions",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSearchResults",null),Ft([(0,l.MD)([gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Object]),Ae("design:returntype",void 0)],gt,"getHasFilters",null),Ft([(0,l.MD)([gt.getSearchResults,gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Xr,Object]),Ae("design:returntype",void 0)],gt,"getAvailableTags",null),Ft([(0,l.MD)([gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Object]),Ae("design:returntype",void 0)],gt,"getActiveTags",null),Ft([(0,l.MD)([gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Object]),Ae("design:returntype",void 0)],gt,"getActiveTagsCount",null),Ft([(0,l.MD)([gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Object]),Ae("design:returntype",void 0)],gt,"getSearchType",null),Ft([(0,l.MD)([gt.getSearchType]),Ae("design:type",Function),Ae("design:paramtypes",[String]),Ae("design:returntype",void 0)],gt,"getSearchGroup",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getViewMode",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getShowFilters",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSort",null),Ft([(0,l.MD)([gt.getSearchType]),Ae("design:type",Function),Ae("design:paramtypes",[String]),Ae("design:returntype",void 0)],gt,"getSortOptions",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getSidenav",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getBulkActions",null),Ft([(0,l.MD)([gt.getBulkActions]),Ae("design:type",Function),Ae("design:paramtypes",[MS]),Ae("design:returntype",void 0)],gt,"getBulkActionsAvailable",null),Ft([(0,l.MD)([gt.getBulkActions]),Ae("design:type",Function),Ae("design:paramtypes",[MS]),Ae("design:returntype",Boolean)],gt,"getBulkActionsActive",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getCardActions",null),Ft([(0,l.MD)([gt.getSearchResults,gt.getSearchOptions,gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Xr,Iu,Object]),Ae("design:returntype",Xr)],gt,"getFilteredResults",null),Ft([(0,l.MD)([gt.getSearchResults,gt.getSearchOptions,gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Xr,Iu,Object]),Ae("design:returntype",Xr)],gt,"getAllResults",null),Ft([(0,l.MD)(),Ae("design:type",Function),Ae("design:paramtypes",[ao]),Ae("design:returntype",void 0)],gt,"getCheckedResults",null),Ft([(0,l.MD)([gt.getSearchConfig]),Ae("design:type",Function),Ae("design:paramtypes",[Object]),Ae("design:returntype",void 0)],gt,"isZSpaceSearch",null),gt=Ft([(0,l.Uw)({name:"gallery",defaults:kS}),Ae("design:paramtypes",[ce,PS,Gl,Bo,AS,l.il,ve])],gt);var Pu=d(78696);function z4(n,i){if(1&n&&(e.j41(0,"button",7),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.settings.miscText," ")}}function W4(n,i){if(1&n&&(e.j41(0,"button",8),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.Y8G("mat-dialog-close",!1),e.R7$(),e.SpI(" ",t.settings.cancelText," ")}}function X4(n,i){if(1&n&&(e.j41(0,"button",9),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.Y8G("mat-dialog-close",!0),e.R7$(),e.SpI(" ",t.settings.confirmText," ")}}let H4=(()=>{class n{constructor(t,o){this.dialogRef=t,this.data=o,this.settings={titleText:"Confirm Action",bodyText:"",confirmText:"Confirm",confirmColor:"primary",cancelText:"Cancel",confirmEnabled:!0,cancelEnabled:!0,miscText:""},o&&(this.settings={...this.settings,...o})}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-confirm-dialog"]],decls:9,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"text-sm"],["mat-dialog-actions",""],["app-button","","buttonTheme","light",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close",4,"ngIf"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close",4,"ngIf"],["app-button","","buttonTheme","light",3,"mat-dialog-close"],["type","button","app-button","","buttonTheme","light","data-test","confirmDialogCancelButton",3,"mat-dialog-close"],["type","button","app-button","","buttonType","primary","data-test","confirmDialogConfirmButton","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(o,s){1&o&&(e.j41(0,"h1",0),e.EFF(1),e.k0s(),e.j41(2,"div",1)(3,"div",2),e.EFF(4),e.k0s()(),e.j41(5,"div",3),e.DNE(6,z4,2,1,"button",4)(7,W4,2,2,"button",5)(8,X4,2,2,"button",6),e.k0s()),2&o&&(e.R7$(),e.JRh(s.settings.titleText),e.R7$(3),e.JRh(s.settings.bodyText),e.R7$(2),e.Y8G("ngIf",s.settings.miscText),e.R7$(),e.Y8G("ngIf",s.settings.cancelEnabled),e.R7$(),e.Y8G("ngIf",s.settings.confirmEnabled))},dependencies:[J.bT,vt.tx,vt.BI,vt.E7,vt.Yi,Mn.Q],styles:["[_nghost-%COMP%]{display:block}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;width:100%}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}@media (min-width: 480px){[_nghost-%COMP%]{min-width:320px}}"],changeDetection:0})}return n})();const Q4=["modalContents"];let DS=(()=>{class n{constructor(t,o,s,a,r,_){this.dialogRef=t,this.data=o,this.sanitizer=s,this.renderer=a,this.vendorAnalyticsService=r,this.productService=_}onMessage(t){switch(t.data.action){case"close":this.dialogRef.close(t.data);break;case"track":this.vendorAnalyticsService.track(t.data.label,{...t.data.metadata,platform:this.productService.productType})}}ngOnInit(){this.title=this.data.title,this.url=this.data.url?this.sanitizer.bypassSecurityTrustResourceUrl(this.data.url):"",this.renderer.setStyle(this.modalContents.nativeElement,"background-color",this.data.backgroundColor||"#ffffff")}closeDialog(){this.dialogRef.close()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(vt.Vh),e.rXU(c.up),e.rXU(e.sFG),e.rXU(ve),e.rXU(De))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-iframe-dialog"]],viewQuery:function(o,s){if(1&o&&e.GBs(Q4,7),2&o){let a;e.mGM(a=e.lsd())&&(s.modalContents=a.first)}},hostBindings:function(o,s){1&o&&e.bIt("message",function(r){return s.onMessage(r)},!1,e.tSv)},decls:6,vars:3,consts:[["modalContents",""],["role","dialog","aria-modal","true",1,"modal"],[1,"modal__contents"],["cdkFocusInitial","",1,"modal__frame",3,"src"],["app-button","","buttonTheme","light","buttonType","flat","buttonShape","circle","type","button","title","Close",1,"modal__close",3,"click"],["icon","times","size","lg"]],template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"div",1)(1,"div",2,0),e.nrm(3,"iframe",3),e.k0s(),e.j41(4,"button",4),e.bIt("click",function(){return e.eBV(a),e.Njj(s.closeDialog())}),e.nrm(5,"app-icon",5),e.k0s()()}2&o&&(e.BMQ("aria-label",s.title),e.R7$(3),e.Y8G("src",s.url,e.f$h),e.R7$(),e.BMQ("aria-label","Close"))},dependencies:[ut.R,Mn.Q],styles:[".modal[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;position:relative}.modal__close[_ngcontent-%COMP%]{margin-bottom:4px;align-self:flex-end;cursor:pointer;position:absolute;right:12px;top:12px}.modal__contents[_ngcontent-%COMP%]{flex-grow:1}.modal__frame[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0})}return n})();var Pc=function(n){return n.PersonalUse="Personal Use",n.Education="Education",n.Business="Business",n}(Pc||{});let LS=(()=>{class n{static#e=this.type="[Users] Join Organization";constructor(t){this.organization=t}}return n})(),Y4=(()=>{class n{static#e=this.type="[Users] Join Organization Success";constructor(t){this.organization=t}}return n})(),K4=(()=>{class n{static#e=this.type="[Users] Join Organization Fail";constructor(t){this.organization=t}}return n})(),US=(()=>{class n{static#e=this.type="[Users] Join Organization With Code";constructor(t){this.code=t}}return n})(),xS=(()=>{class n{static#e=this.type="[Users] Join Organization With Code Success";constructor(t){this.organizationName=t}}return n})(),q4=(()=>{class n{static#e=this.type="[Users] Join Organization With Code Fail";constructor(t){this.error=t}}return n})(),jS=(()=>{class n{static#e=this.type="[Users] Leave Organization";constructor(t){this.organization=t}}return n})(),J4=(()=>{class n{static#e=this.type="[Users] Leave Organization Success";constructor(t){this.organization=t}}return n})(),Z4=(()=>{class n{static#e=this.type="[Users] Leave Organization Fail";constructor(t){this.error=t}}return n})(),wc=(()=>{class n{static#e=this.type="[Users] Send Organization Invite";constructor(t,o){this.groupEID=t,this.invites=o}}return n})(),VS=(()=>{class n{static#e=this.type="[Users] Send Organization Invite Success";constructor(t){this.responses=t}}return n})(),FS=(()=>{class n{static#e=this.type="[Users] Send Organization Invite Fail";constructor(t){this.error=t}}return n})(),GS=(()=>{class n{static#e=this.type="[Users] Get Organization Users";constructor(t){this.groupId=t}}return n})(),wu=(()=>{class n{static#e=this.type="[Users] Get Organization Users Success";constructor(t){this.users=t}}return n})(),eD=(()=>{class n{static#e=this.type="[Users] Get Organization Users Fail";constructor(t){this.error=t}}return n})(),$S=(()=>{class n{static#e=this.type="[Users] Get Organization Invited Users";constructor(t){this.groupId=t}}return n})(),Au=(()=>{class n{static#e=this.type="[Users] Get Organization Invited Users Success";constructor(t){this.invites=t}}return n})(),tD=(()=>{class n{static#e=this.type="[Users] Get Organization Invited Users Fail";constructor(t){this.error=t}}return n})(),nD=(()=>{class n{static#e=this.type="[Users] Reset"}return n})(),BS=(()=>{class n{static#e=this.type="[Users] Update User Roles";constructor(t,o){this.groupId=t,this.users=o}}return n})(),iD=(()=>{class n{static#e=this.type="[Users] Update User Roles Success";constructor(t,o){this.groupId=t,this.users=o}}return n})(),oD=(()=>{class n{static#e=this.type="[Users] Update User Roles Fail"}return n})(),zS=(()=>{class n{static#e=this.type="[Users] Remove Organization User";constructor(t,o){this.groupId=t,this.users=o}}return n})(),sD=(()=>{class n{static#e=this.type="[Users] Remove Organization User Success";constructor(t,o){this.groupId=t,this.users=o}}return n})(),aD=(()=>{class n{static#e=this.type="[Users] Remove Organization User Fail"}return n})(),WS=(()=>{class n{static#e=this.type="[Users] Transfer Organization Content";constructor(t,o){this.groupId=t,this.users=o}}return n})(),rD=(()=>{class n{static#e=this.type="[Users] Transfer Organization Content Success";constructor(t,o){this.groupId=t,this.users=o}}return n})(),lD=(()=>{class n{static#e=this.type="[Users] Transfer Organization Content Fail"}return n})(),Ru=(()=>{class n{static#e=this.type="[Users] Get Eligible Join Organizations";constructor(t){this.params=t}}return n})(),Ac=(()=>{class n{static#e=this.type="[Users] Get Eligible Join Organizations Success";constructor(t){this.eligibleOrganizations=t}}return n})(),cD=(()=>{class n{static#e=this.type="[Users] Get Eligible Join Organizations Error";constructor(t){this.error=t}}return n})(),Nu=(()=>{class n{static#e=this.type="[Users] Clear Eligible Join Organizations"}return n})(),Hr=(()=>{class n{static#e=this.type="[Users] Get Join Requests";constructor(t){this.params=t}}return n})(),Rc=(()=>{class n{static#e=this.type="[Users] Get Join Requests Success";constructor(t){this.joinRequests=t}}return n})(),ku=(()=>{class n{static#e=this.type="[Users] Post Join Request";constructor(t,o){this.organizationId=t,this.description=o}}return n})(),dD=(()=>{class n{static#e=this.type="[Users] Post Join Request Success";constructor(t){this.joinRequestKey=t}}return n})(),XS=(()=>{class n{static#e=this.type="[Users] Post Join Request Error";constructor(t){this.error=t}}return n})(),Du=(()=>{class n{static#e=this.type="[Users] Delete Join Request";constructor(t){this.joinRequestKey=t}}return n})(),HS=(()=>{class n{static#e=this.type="[Users] Delete Join Request Success"}return n})(),QS=(()=>{class n{static#e=this.type="[Users] Delete Join Request Error";constructor(t){this.error=t}}return n})(),YS=(()=>{class n{static#e=this.type="[Users] Get Organization Join Requests";constructor(t){this.params=t}}return n})(),Lu=(()=>{class n{static#e=this.type="[Users] Get Organization Join Requests Success";constructor(t){this.organizationJoinRequests=t}}return n})(),_D=(()=>{class n{static#e=this.type="[Users] Get Organization Join Requests Error";constructor(t){this.error=t}}return n})(),KS=(()=>{class n{static#e=this.type="[Users] Accept Join Requests";constructor(t){this.joinRequests=t}}return n})(),pD=(()=>{class n{static#e=this.type="[Users] Accept Join Requests Success";constructor(t){this.count=t}}return n})(),uD=(()=>{class n{static#e=this.type="[Users] Accept Join Requests Error";constructor(t,o){this.count=t,this.error=o}}return n})(),qS=(()=>{class n{static#e=this.type="[Users] Deny Join Requests";constructor(t){this.joinRequestKeys=t}}return n})(),hD=(()=>{class n{static#e=this.type="[Users] Deny Join Requests Success";constructor(t){this.count=t}}return n})(),gD=(()=>{class n{static#e=this.type="[Users] Deny Join Requests Error";constructor(t,o){this.count=t,this.error=o}}return n})();var mD=d(7974),fD=d(63831),SD=d(26727);const Uu="/ws/organization/join/requests",Nc="/ws/user/join/requests",xu="/ws/organization/user",ju="/ws/organization/users";let ZS=(()=>{class n{constructor(t,o){this.http=t,this.productService=o}getOrganizationJoinRequests(t){const o={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...t},s=new f.Nl({fromObject:{...o}});return this.http.get(Uu,{params:s})}acceptOrganizationJoinRequests(t){return this.batchRequest(t,s=>this.http.post(Uu,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_accept:s}))}denyOrganizationJoinRequests(t){return this.batchRequest(t,s=>this.http.post(Uu,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_requests_deny:s}))}getEligibleJoinOrganizations(t){const o={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...t},s=new f.Nl({fromObject:{...o}});return this.http.get(`${Nc}/eligibility`,{params:s})}getJoinRequests(t){const o={version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,...t},s=new f.Nl({fromObject:{...o}});return this.http.get(Nc,{params:s})}postJoinRequest(t,o){return this.http.post(Nc,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,organization_id:t,request_desc:o})}deleteJoinRequest(t){return this.http.request("delete",Nc,{body:{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,join_request_key:t}})}getOrganizationUsers(t){const o=yt(t);return this.http.get(`${ju}${o}`).pipe((0,W.T)(s=>s.users),(0,W.T)(s=>s.map(a=>({...a,user_role:lr(a.user_role)}))))}getOrganizationInvites(t){const o=yt(t);return this.http.get(`/ws/organization/invite${o}`).pipe((0,W.T)(s=>s.invites),(0,W.T)(s=>s.map(a=>({...a,invite_user:{...a.inviter_user,user_role:lr(a.inviter_user.user_role)},invitee_user:{...a.invitee_user,user_role:lr(a.invitee_user.user_role)}}))))}sendOrganizationInvites(t,o,s){return this.http.post("/ws/organization/invite",{version:2,group_eid:t,invite_emails:o,site_verify_response:s}).pipe((0,W.T)(a=>{const{messages:r}=a.results_summary;return r}))}addUserToOrganization(t){return this.http.post(`${xu}/add`,{group_eid:t})}addUserWithGroupCode(t){return this.http.post(`${xu}/add`,{group_code:t}).pipe((0,W.T)(o=>o.organization_name))}updateUserRoles(t,o){return this.batchRequest(o,a=>this.http.post(ju,{group_id:t,update_users:a.map(r=>({user_id:r.userId,role_id:r.roleId}))}))}removeUser(t){return this.http.post(`${xu}/leave`,{version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,group_id:t})}removeUsers(t,o){return this.batchRequest(o,a=>this.http.post(ju,{group_id:t,remove_users:a.map(r=>this.createTransferRequest(r))}))}transferUserContent(t,o){return this.batchRequest(o,a=>this.http.post("/ws/organization/bookmark/transfer",{group_id:t,transfer_bookmarks:a.map(r=>this.createTransferRequest(r))}))}createUserDisplayModel(t,o,s){return{name:this.formatUserName(t),initials:this.formatBadgeLabel(t),email:t.user_email,id:t.user_id,role:t.user_role,activeDeveloper:this.hasActiveDeveloperAccount(t),selected:!1,invitationStatus:o,joinRequestKey:s}}isUserModel(t){return["developer_account","developer_account_active","developer_has_apps"].every(s=>t.hasOwnProperty(s))}hasActiveDeveloperAccount(t){return!!this.isUserModel(t)&&t.developer_account&&t.developer_account_active&&t.developer_has_apps}batchRequest(t,o){let s=0;const a=[];for(;s<t.length;){const _=t.slice(s,s+50);a.push(o(_)),s+=50}const r=(0,mD.c)(a,fD.T).pipe((0,SD.K)());return(0,di.p)(r).pipe((0,W.T)(()=>!0))}createTransferRequest(t){const{sourceUserId:o,targetUserId:s}=t;return"number"==typeof s?{user_id:o,group_bookmarks:{transfer_ownership:1,transfer_user_id:s}}:{user_id:o}}formatUserName(t){const{user_first_name:o,user_last_name:s}=t,a=[o,s].filter(r=>!!r);return a.length>0?a.join(" "):""}formatBadgeLabel(t){const{user_first_name:o,user_last_name:s}=t;return[o,s].filter(r=>!!r).map(r=>r[0]).join("")}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(De))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class ri{}var Fu,Vu=function(n){return n.Pending="pending",n.Accepted="accepted",n.Denied="denied",n.Expired="expired",n}(Vu||{}),Gt=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Re=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const eb={joining:!1,leaving:!1,inviting:!1,loadingUsers:!1,loadingInvites:!1,loadingOrganizationJoinRequests:!1,loadingJoinRequests:!1,loadingEligibleOrganizations:!1,postingJoinRequest:!1,deletingJoinRequest:!1,users:[],invites:[],joinRequests:[],organizationJoinRequests:[]};let At=class Nd{static#e=Fu=this;static getUsers(i){return i.users}static getInvites(i){return i.invites}static getUsersLoading(i){return i.loadingUsers}static getJoining(i){return i.joining}static getLeaving(i){return i.leaving}static getInviting(i){return i.inviting}static getLoadingJoinRequests(i){return i.loadingJoinRequests}static getLoadingOrganizationJoinRequests(i){return i.organizationJoinRequests}static getLoadingEligibleOrganizations(i){return i.loadingEligibleOrganizations}static getPostingJoinRequest(i){return i.postingJoinRequest}static getDeletingJoinRequest(i){return i.deletingJoinRequest}static getRequesting(i){return i.loadingJoinRequests||i.loadingEligibleOrganizations||i.postingJoinRequest||i.deletingJoinRequest}static getEligibleOrganizations(i){return i.eligibleOrganizations}static hasEligibleOrganizations(i){return Array.isArray(i.eligibleOrganizations)&&i.eligibleOrganizations.length>0}static getJoinRequests(i){return i.joinRequests}static getPendingJoinRequest(i){return i.joinRequests?.find(t=>t.request_status===Vu.Pending)}static getOrganizationJoinRequests(i){return i.organizationJoinRequests}static getPendingOrganizationJoinRequests(i){return i.organizationJoinRequests.filter(t=>t.request_status===Vu.Pending)}joinOrganization(i,{organization:t}){i.patchState({joining:!0}),this.usersService.addUserToOrganization(t.eid).pipe((0,Ot.j)(()=>i.patchState({joining:!1}))).subscribe(()=>i.dispatch(new Y4(t)),()=>i.dispatch(new K4(t)))}joinOrganizationWithCode(i,{code:t}){i.patchState({joining:!0}),this.usersService.addUserWithGroupCode(t).pipe((0,Ot.j)(()=>i.patchState({joining:!1}))).subscribe(o=>i.dispatch(new xS(o)),o=>i.dispatch(new q4(o)))}joinOrganizationWithCodeSuccess(){this.vendorAnalyticsService.track("Account Upgrade - Free Individual to Team")}leaveOrganization(i,{organization:t}){i.patchState({leaving:!0}),this.usersService.removeUser(t.id).pipe((0,Ot.j)(()=>i.patchState({leaving:!1}))).subscribe({next:()=>i.dispatch(new J4(t)),error:o=>i.dispatch(new Z4(o))})}sendOrganizationInvite(i,{groupEID:t,invites:o}){i.patchState({inviting:!0}),this.authService.verifyIsHuman("invites","",!0).pipe((0,Ln.Z)(({isHuman:s,verification:a})=>{if(!s)throw new Mo;return this.usersService.sendOrganizationInvites(t,o,a)}),(0,Ot.j)(()=>i.patchState({inviting:!1}))).subscribe({next:s=>{i.dispatch(new VS(s))},error:s=>{s instanceof Mo&&i.dispatch(new ca(s)),i.dispatch(new FS(s))}})}getOrganizationUsers(i,{groupId:t}){i.patchState({loadingUsers:!0}),this.usersService.getOrganizationUsers({group_id:t}).pipe((0,Ot.j)(()=>i.patchState({loadingUsers:!1}))).subscribe(o=>i.dispatch(new wu(o)),o=>i.dispatch(new eD(o)))}getOrganizationUsersSuccess(i,{users:t}){i.patchState({users:t})}getOrganizationUserInvites(i,{groupId:t}){i.patchState({loadingInvites:!0}),this.usersService.getOrganizationInvites({group_id:t,version:1,app_productkey:this.productService.productKey,app_producttype:this.productService.productType}).pipe((0,Ot.j)(()=>i.patchState({loadingInvites:!1}))).subscribe(o=>i.dispatch(new Au(o)),o=>i.dispatch(new tD(o)))}getOrganizationUserInvitesSuccess(i,{invites:t}){i.patchState({invites:t})}resetOrganizations(i){i.setState(eb)}updateUserRoles(i,{groupId:t,users:o}){this.usersService.updateUserRoles(t,o).subscribe(()=>i.dispatch(new iD(t,o)),()=>i.dispatch(new oD))}removeOrganizationUser(i,{groupId:t,users:o}){this.usersService.removeUsers(t,o).subscribe(()=>i.dispatch(new sD(t,o)),()=>i.dispatch(new aD))}transferOrganizationContent(i,{groupId:t,users:o}){this.usersService.transferUserContent(t,o).subscribe(()=>i.dispatch(new rD(t,o)),()=>i.dispatch(new lD))}clearEligibleJoinOrganizations(i,t){i.patchState({eligibleOrganizations:[]})}getEligibleJoinOrganizations(i,t){i.patchState({loadingEligibleOrganizations:!0}),this.usersService.getEligibleJoinOrganizations(t.params).pipe((0,Ot.j)(()=>i.patchState({loadingEligibleOrganizations:!1}))).subscribe({next:o=>{i.dispatch(new Ac(o.eligible_orgs))},error:o=>i.dispatch(new cD(o))})}getEligibleJoinOrganizationsSuccess(i,{eligibleOrganizations:t}){i.patchState({eligibleOrganizations:t})}getJoinRequests(i,t){i.patchState({loadingJoinRequests:!0}),this.usersService.getJoinRequests(t.params).pipe((0,Ot.j)(()=>i.patchState({loadingJoinRequests:!1}))).subscribe(o=>{i.dispatch(new Rc(o.join_requests))})}getJoinRequestsSuccess(i,{joinRequests:t}){i.patchState({joinRequests:t}),Fu.getPendingJoinRequest(i.getState())&&i.dispatch(new Nu)}postJoinRequest(i,t){i.patchState({postingJoinRequest:!0}),this.usersService.postJoinRequest(t.organizationId,t.description).pipe((0,Ot.j)(()=>i.patchState({postingJoinRequest:!1}))).subscribe({next:o=>{i.dispatch(new dD(o.join_request_key)),i.dispatch(new Hr)},error:o=>i.dispatch(new XS(o))})}deleteJoinRequest(i,t){i.patchState({deletingJoinRequest:!0}),this.usersService.deleteJoinRequest(t.joinRequestKey).pipe((0,Ot.j)(()=>i.patchState({deletingJoinRequest:!1}))).subscribe({next:()=>{i.dispatch(new HS),i.dispatch(new Hr)},error:o=>i.dispatch(new QS(o))})}getOrganizationJoinRequests(i,t){i.patchState({loadingOrganizationJoinRequests:!0}),this.usersService.getOrganizationJoinRequests(t.params).pipe((0,Ot.j)(()=>i.patchState({loadingOrganizationJoinRequests:!1}))).subscribe({next:o=>{i.dispatch(new Lu(o.join_requests))},error:o=>i.dispatch(new _D(o))})}getOrganizationJoinRequestsSuccess(i,{organizationJoinRequests:t}){i.patchState({organizationJoinRequests:t})}acceptJoinRequests(i,t){const o=t.joinRequests.length;this.usersService.acceptOrganizationJoinRequests(t.joinRequests).subscribe({next:()=>{i.dispatch(new pD(o))},error:s=>i.dispatch(new uD(o,s))})}denyJoinRequests(i,t){const o=t.joinRequestKeys.length;this.usersService.denyOrganizationJoinRequests(t.joinRequestKeys).subscribe({next:()=>{i.dispatch(new hD(o))},error:s=>i.dispatch(new gD(o,s))})}constructor(i,t,o,s){this.usersService=i,this.vendorAnalyticsService=t,this.productService=o,this.authService=s}static#t=this.\u0275fac=function(t){return new(t||Nd)(e.KVO(ZS),e.KVO(ve),e.KVO(De),e.KVO(_a))};static#n=this.\u0275prov=e.jDH({token:Nd,factory:Nd.\u0275fac})};function tb(n){return i=>{const t=ho.l.parseEmails(i.value),o=t.filter(_=>!ho.l.validateEmail(_)),s=t.length,a="number"==typeof n&&s>n;let r={};return a&&(r={...r,maxEmailsExceeded:a,currentEmailCount:s}),o.length>0&&(r={...r,invalidEmails:o}),Object.keys(r).length>0?(0,Rt.of)(r):(0,Rt.of)(null)}}Gt([(0,l.rc)(LS),Re("design:type",Function),Re("design:paramtypes",[Object,LS]),Re("design:returntype",void 0)],At.prototype,"joinOrganization",null),Gt([(0,l.rc)(US),Re("design:type",Function),Re("design:paramtypes",[Object,US]),Re("design:returntype",void 0)],At.prototype,"joinOrganizationWithCode",null),Gt([(0,l.rc)(xS),Re("design:type",Function),Re("design:paramtypes",[]),Re("design:returntype",void 0)],At.prototype,"joinOrganizationWithCodeSuccess",null),Gt([(0,l.rc)(jS),Re("design:type",Function),Re("design:paramtypes",[Object,jS]),Re("design:returntype",void 0)],At.prototype,"leaveOrganization",null),Gt([(0,l.rc)(wc),Re("design:type",Function),Re("design:paramtypes",[Object,wc]),Re("design:returntype",void 0)],At.prototype,"sendOrganizationInvite",null),Gt([(0,l.rc)(GS),Re("design:type",Function),Re("design:paramtypes",[Object,GS]),Re("design:returntype",void 0)],At.prototype,"getOrganizationUsers",null),Gt([(0,l.rc)(wu),Re("design:type",Function),Re("design:paramtypes",[Object,wu]),Re("design:returntype",void 0)],At.prototype,"getOrganizationUsersSuccess",null),Gt([(0,l.rc)($S),Re("design:type",Function),Re("design:paramtypes",[Object,$S]),Re("design:returntype",void 0)],At.prototype,"getOrganizationUserInvites",null),Gt([(0,l.rc)(Au),Re("design:type",Function),Re("design:paramtypes",[Object,Au]),Re("design:returntype",void 0)],At.prototype,"getOrganizationUserInvitesSuccess",null),Gt([(0,l.rc)(nD),Re("design:type",Function),Re("design:paramtypes",[Object]),Re("design:returntype",void 0)],At.prototype,"resetOrganizations",null),Gt([(0,l.rc)(BS),Re("design:type",Function),Re("design:paramtypes",[Object,BS]),Re("design:returntype",void 0)],At.prototype,"updateUserRoles",null),Gt([(0,l.rc)(zS),Re("design:type",Function),Re("design:paramtypes",[Object,zS]),Re("design:returntype",void 0)],At.prototype,"removeOrganizationUser",null),Gt([(0,l.rc)(WS),Re("design:type",Function),Re("design:paramtypes",[Object,WS]),Re("design:returntype",void 0)],At.prototype,"transferOrganizationContent",null),Gt([(0,l.rc)(Nu),Re("design:type",Function),Re("design:paramtypes",[Object,Nu]),Re("design:returntype",void 0)],At.prototype,"clearEligibleJoinOrganizations",null),Gt([(0,l.rc)(Ru),Re("design:type",Function),Re("design:paramtypes",[Object,Ru]),Re("design:returntype",void 0)],At.prototype,"getEligibleJoinOrganizations",null),Gt([(0,l.rc)(Ac),Re("design:type",Function),Re("design:paramtypes",[Object,Ac]),Re("design:returntype",void 0)],At.prototype,"getEligibleJoinOrganizationsSuccess",null),Gt([(0,l.rc)(Hr),Re("design:type",Function),Re("design:paramtypes",[Object,Hr]),Re("design:returntype",void 0)],At.prototype,"getJoinRequests",null),Gt([(0,l.rc)(Rc),Re("design:type",Function),Re("design:paramtypes",[Object,Rc]),Re("design:returntype",void 0)],At.prototype,"getJoinRequestsSuccess",null),Gt([(0,l.rc)(ku),Re("design:type",Function),Re("design:paramtypes",[Object,ku]),Re("design:returntype",void 0)],At.prototype,"postJoinRequest",null),Gt([(0,l.rc)(Du),Re("design:type",Function),Re("design:paramtypes",[Object,Du]),Re("design:returntype",void 0)],At.prototype,"deleteJoinRequest",null),Gt([(0,l.rc)(YS),Re("design:type",Function),Re("design:paramtypes",[Object,YS]),Re("design:returntype",void 0)],At.prototype,"getOrganizationJoinRequests",null),Gt([(0,l.rc)(Lu),Re("design:type",Function),Re("design:paramtypes",[Object,Lu]),Re("design:returntype",void 0)],At.prototype,"getOrganizationJoinRequestsSuccess",null),Gt([(0,l.rc)(KS),Re("design:type",Function),Re("design:paramtypes",[Object,KS]),Re("design:returntype",void 0)],At.prototype,"acceptJoinRequests",null),Gt([(0,l.rc)(qS),Re("design:type",Function),Re("design:paramtypes",[Object,qS]),Re("design:returntype",void 0)],At.prototype,"denyJoinRequests",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getUsers",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getInvites",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getUsersLoading",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getJoining",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getLeaving",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getInviting",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getLoadingJoinRequests",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getLoadingOrganizationJoinRequests",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getLoadingEligibleOrganizations",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getPostingJoinRequest",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getDeletingJoinRequest",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getRequesting",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getEligibleOrganizations",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"hasEligibleOrganizations",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getJoinRequests",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getPendingJoinRequest",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getOrganizationJoinRequests",null),Gt([(0,l.MD)(),Re("design:type",Function),Re("design:paramtypes",[ri]),Re("design:returntype",void 0)],At,"getPendingOrganizationJoinRequests",null),At=Fu=Gt([(0,l.Uw)({name:"users",defaults:eb}),Re("design:paramtypes",[ZS,ve,De,_a])],At);var Gu=d(53719),nb=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},ib=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const bD=["*"];function yD(n,i){if(1&n&&(e.j41(0,"div",10)(1,"app-message-toggle",11),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(2),e.SpI(" ",t.sentResponses.length," invite(s) have been sent. Please allow up to a few minutes for invitees to receive their invitations. ")}}function vD(n,i){if(1&n&&(e.qex(0),e.DNE(1,yD,3,1,"div",9),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.sentResponses.length>0)}}function ED(n,i){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.R7$(),e.SpI(" ",t," ")}}function CD(n,i){if(1&n&&(e.j41(0,"div",19)(1,"app-message-toggle",20)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,ED,2,1,"div",21),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(3),e.SpI("There was an error sending ",t.errorResponses.length," invite(s)."),e.R7$(),e.Y8G("ngForOf",t.formatResponses(t.errorResponses))}}function TD(n,i){if(1&n&&(e.j41(0,"div",19)(1,"app-message-toggle",20),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(2),e.SpI(" ",t.errorMessage," ")}}function OD(n,i){if(1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.R7$(2),e.Lme(" Please limit your entry to ",o.maxEmailCount,". Current count: ",null==t.errors?null:t.errors.currentEmailCount,". ")}}function MD(n,i){if(1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.R7$(2),e.Lme(" ",o.formatEmails(null==t.errors?null:t.errors.invalidEmails)," ",1===t.errors.invalidEmails.length?"is not a valid email address.":"are not valid email addresses."," ")}}function ID(n,i){if(1&n&&(e.j41(0,"option",27),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.Y8G("value",t.role_id),e.R7$(),e.SpI(" ",t.role_display_name," ")}}function PD(n,i){1&n&&(e.j41(0,"div",22)(1,"mat-error"),e.EFF(2," Please select a valid role. "),e.k0s()())}function wD(n,i){if(1&n&&(e.j41(0,"app-form-field",23)(1,"select",24)(2,"option",25),e.EFF(3,"--"),e.k0s(),e.DNE(4,ID,2,2,"option",26),e.k0s(),e.DNE(5,PD,3,0,"div",17),e.k0s()),2&n){const t=i.$implicit,o=e.XpG(3);e.R7$(4),e.Y8G("ngForOf",o.availableRoles),e.R7$(),e.Y8G("ngIf",t.touched&&t.invalid)}}function AD(n,i){if(1&n&&(e.qex(0,13),e.DNE(1,CD,5,2,"div",14)(2,TD,3,1,"div",14),e.j41(3,"app-form-field",15)(4,"textarea",16),e.EFF(5,"          "),e.k0s(),e.DNE(6,OD,3,2,"div",17)(7,MD,3,2,"div",17),e.k0s(),e.DNE(8,wD,6,2,"app-form-field",18),e.bVm()),2&n){const t=i.$implicit,o=e.XpG(2);e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("ngIf",o.errorResponses.length>0),e.R7$(),e.Y8G("ngIf",o.errorMessage),e.R7$(2),e.Y8G("placeholder","Enter up to "+o.maxEmailCount+" email addresses separated by commas or line breaks"),e.R7$(2),e.Y8G("ngIf",null==t.errors?null:t.errors.maxEmailsExceeded),e.R7$(),e.Y8G("ngIf",null==t.errors?null:t.errors.invalidEmails),e.R7$(),e.Y8G("ngIf",o.form.get("roleId"))}}function RD(n,i){if(1&n&&e.DNE(0,AD,9,7,"ng-container",12),2&n){const t=e.XpG();e.Y8G("ngIf",t.form.get("emails"))}}function ND(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleCancelClick())}),e.EFF(1),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("uppercase","inline"===t.layout),e.R7$(),e.SpI(" ",t.cancelText," ")}}function kD(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",30),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleInviteClick())}),e.EFF(2),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("uppercase","inline"===t.layout)("disabled",t.form.invalid||e.bMT(1,3,t.inviting$)),e.R7$(2),e.SpI(" ",t.errorResponses.length>0?"Try Again":t.sendText," ")}}function DD(n,i){1&n&&e.eu8(0)}function LD(n,i){1&n&&e.eu8(0)}function UD(n,i){if(1&n&&(e.qex(0),e.DNE(1,DD,1,0,"ng-container",31)(2,LD,1,0,"ng-container",31),e.bVm()),2&n){e.XpG();const t=e.sdS(3),o=e.sdS(5);e.R7$(),e.Y8G("ngTemplateOutlet",t),e.R7$(),e.Y8G("ngTemplateOutlet",o)}}function xD(n,i){1&n&&e.eu8(0)}function jD(n,i){1&n&&e.eu8(0)}function VD(n,i){if(1&n&&e.DNE(0,xD,1,0,"ng-container",31)(1,jD,1,0,"ng-container",31),2&n){e.XpG();const t=e.sdS(3),o=e.sdS(5);e.Y8G("ngTemplateOutlet",o),e.R7$(),e.Y8G("ngTemplateOutlet",t)}}function FD(n,i){if(1&n&&(e.j41(0,"div")(1,"div",28),e.DNE(2,ND,2,2,"ng-template",null,1,e.C5r)(4,kD,3,5,"ng-template",null,2,e.C5r)(6,UD,3,2,"ng-container",6)(7,VD,2,2,"ng-template",null,3,e.C5r),e.k0s()()),2&n){const t=e.sdS(8),o=e.XpG();e.R7$(6),e.Y8G("ngIf","inline"===o.layout)("ngIfElse",t)}}class Ha{get valid(){return this.form.valid}constructor(i,t,o,s){this.store=i,this.actions=t,this.formBuilder=o,this.changeRef=s,this.maxEmailCount=50,this.availableRoles=[],this.layout="inline",this.enableActions=!0,this.sendText="Send invites",this.cancelText="Cancel",this.inviteSent=new e.bkB,this.inviteCancelled=new e.bkB,this.ngUnsubscribe=new k.B,this.sent=!1,this.sentResponses=[],this.errorResponses=[]}ngOnInit(){this.initForm(),this.initInviteListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.store.dispatch(new Ol),this.currentUserRole=this.store.selectSnapshot(Pe.getUserRole),this.userRoles$.pipe((0,D.p)(i=>i.length>0),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.availableRoles=i.filter(t=>Al.indexOf(t.role_name)<=Al.indexOf(this.currentUserRole.role_name)),this.changeRef.markForCheck()}),this.form=this.formBuilder.group({emails:["",fe.k0.required,tb(this.maxEmailCount).bind(this)],roleId:["",fe.k0.required]})}initInviteListeners(){this.actions.pipe((0,l.xi)(wc),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.resetState(),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(VS),(0,p.Q)(this.ngUnsubscribe)).subscribe(({responses:i})=>{this.resetState(),this.sentResponses=i.filter(t=>"success"===t.status),this.errorResponses=i.filter(t=>"error"===t.status),this.sent=0===this.errorResponses.length,this.sent&&this.inviteSent.next(i),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(FS,ca),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.resetState(),this.errorMessage=ss(i.error)||"There was an error sending the invites, please try again.",this.changeRef.markForCheck()})}handleCancelClick(){this.inviteCancelled.next()}backToFormClick(){this.resetState(),this.changeRef.markForCheck()}handleInviteClick(){const{eid:i}=this.organization,o=ho.l.parseEmails(this.form.value.emails).map(s=>({user_email:s,role_id:parseInt(this.form.value.roleId,10)}));this.store.dispatch(new wc(i,o))}formatEmails(i){return i.join(", ")}formatResponses(i){const t=i.map(s=>s.reason);return[...new Set([...t])].map(s=>{const a=i.filter(_=>_.reason===s).map(_=>_.email),r=this.formatEmails(a);return`"${s}": ${r}`})}resetState(){this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.errorMessage=""}static#e=this.\u0275fac=function(t){return new(t||Ha)(e.rXU(l.il),e.rXU(l.En),e.rXU(fe.ze),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Ha,selectors:[["app-team-invite"]],inputs:{organization:"organization",layout:"layout",enableActions:"enableActions",sendText:"sendText",cancelText:"cancelText"},outputs:{inviteSent:"inviteSent",inviteCancelled:"inviteCancelled"},ngContentSelectors:bD,decls:8,vars:7,consts:[["sendFormTmp",""],["cancelBtnTmp",""],["sendBtnTmp",""],["blockBtnTmp",""],[1,"invite"],[1,"theme-light"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"invite__footer"],["class","my-1",4,"ngIf"],[1,"my-1"],["data-test","teamInviteSuccess","type","message"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","mb-4",4,"ngIf"],["theme","light","label","Invite via email"],["formControlName","emails","data-test","teamInviteEmails","rows","8",1,"invite__input","input",3,"placeholder"],["class","mt-1 text-xs",4,"ngIf"],["theme","light","label","Role",4,"ngIf"],[1,"mb-4"],["type","error"],[4,"ngFor","ngForOf"],[1,"mt-1","text-xs"],["theme","light","label","Role"],["formControlName","roleId",1,"input"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"invite__buttons"],["app-button","","buttonTheme","light","buttonType","default","data-test","skipInvitesButton",1,"invite__button",3,"click","uppercase"],["app-button","","buttonType","primary","data-test","sendInvitesButton",1,"invite__button",3,"click","uppercase","disabled"],[4,"ngTemplateOutlet"]],template:function(t,o){if(1&t&&(e.NAR(),e.j41(0,"div",4)(1,"div",5),e.DNE(2,vD,2,1,"ng-container",6)(3,RD,1,1,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(5,FD,9,2,"div",7),e.j41(6,"div",8),e.SdG(7,0,["[select]","invite - footer"]),e.k0s()()),2&t){const s=e.sdS(4);e.AVh("invite--inline","inline"===o.layout)("invite--block","block"===o.layout),e.R7$(2),e.Y8G("ngIf",o.sent)("ngIfElse",s),e.R7$(3),e.Y8G("ngIf",o.enableActions&&!o.sent)}},dependencies:[Mn.Q,J.Sq,J.bT,J.T3,ic,Gu.TL,fe.xH,fe.y7,fe.me,fe.wz,fe.BC,fe.cb,fe.j4,fe.JD,Dr,J.Jj],styles:[".invite__input[_ngcontent-%COMP%]{resize:vertical}.invite__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.invite__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.invite__buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:8px auto}.invite--inline[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin-left:16px}.invite--inline[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end}.invite--block[_ngcontent-%COMP%]   .invite__button[_ngcontent-%COMP%]{margin:16px 0}.invite--block[_ngcontent-%COMP%]   .invite__buttons[_ngcontent-%COMP%]{justify-content:flex-end;flex-direction:column}"],changeDetection:0})}nb([(0,l.l6)(At.getInviting),ib("design:type",h.c)],Ha.prototype,"inviting$",void 0),nb([(0,l.l6)(Pe.getUserRoles),ib("design:type",h.c)],Ha.prototype,"userRoles$",void 0);class Qr{constructor(i,t,o){this.clipboardService=i,this.changeRef=t,this.snackbar=o,this.ngUnsubscribe=new k.B,this.copyErrorMessage="There was a problem copying to the clipboard."}ngOnInit(){this.groupCode$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.groupCode=i,this.signupLink=`https://${window.location.host}/login/create?code=${i}`,this.changeRef.markForCheck()})}handleCopyCodeClick(i){i.preventDefault(),this.clipboardService.copyToClipboard(this.groupCode,"text").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackbar.open(t?"Team invite code copied to your clipboard.":this.copyErrorMessage)})}handleCopyLinkClick(i){i.preventDefault(),this.clipboardService.copyToClipboard(this.signupLink,"url").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.snackbar.open(t?"Team invite link copied to your clipboard.":this.copyErrorMessage)})}static#e=this.\u0275fac=function(t){return new(t||Qr)(e.rXU(Fr.W),e.rXU(e.gRc),e.rXU(ui.UG))};static#t=this.\u0275cmp=e.VBU({type:Qr,selectors:[["app-team-group-code"]],decls:10,vars:6,consts:[[1,"team-group-code","text-sm","mb-4"],[1,"flex","mb-3"],["type","text",1,"team-group-code__input","input",3,"readonly","value"],["app-button","","buttonSize","md","buttonTheme","light","buttonType","primary",1,"team-group-code__button","ml-4",3,"click","uppercase"],[1,"flex"],["type","text",1,"team-group-code__input","input","underline",3,"readonly","value"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.EFF(1," Share this code or invite link so people can join your team directly.\n"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"input",2),e.j41(4,"button",3),e.bIt("click",function(a){return o.handleCopyCodeClick(a)}),e.EFF(5," Copy Code "),e.k0s()(),e.j41(6,"div",4),e.nrm(7,"input",5),e.j41(8,"button",3),e.bIt("click",function(a){return o.handleCopyLinkClick(a)}),e.EFF(9," Copy Link "),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("readonly",!0)("value",o.groupCode),e.R7$(),e.Y8G("uppercase",!0),e.R7$(3),e.Y8G("readonly",!0)("value",o.signupLink),e.R7$(),e.Y8G("uppercase",!0))},dependencies:[Mn.Q],styles:[".team-group-code__input[_ngcontent-%COMP%]{background-color:#e7eaee!important}.team-group-code__button[_ngcontent-%COMP%]{flex:0 0 112px}"],changeDetection:0})}function WD(n,i){1&n&&e.eu8(0)}function XD(n,i){1&n&&e.eu8(0)}function HD(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",11)(1,"app-team-invite",12),e.bIt("inviteSent",function(s){e.eBV(t);const a=e.XpG();return e.Njj(a.handleInviteSent(s))})("inviteCancelled",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleInviteCancelled())}),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("organization",t.organization)("layout","inline")}}function QD(n,i){1&n&&(e.j41(0,"div",13),e.nrm(1,"app-team-group-code"),e.k0s())}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(We.getOrganizationGroupCode),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Qr.prototype,"groupCode$",void 0);class Yr{constructor(i,t){this.dialogRef=i,this.data=t,this.sent=!1,this.sentResponses=[],this.errorResponses=[],this.ngUnsubscribe=new k.B,this.organization=t.organization}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleInviteSent(i){setTimeout(()=>{this.inviteComplete()},5e3)}handleInviteCancelled(){this.inviteComplete()}inviteComplete(){this.dialogRef.close()}static#e=this.\u0275fac=function(t){return new(t||Yr)(e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:Yr,selectors:[["app-team-invite-dialog"]],decls:15,vars:4,consts:[["inviteTmpl",""],["groupCodeTmpl",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"dialog__close",3,"click"],["icon","times","size","lg"],["tabSize","medium","tabTheme","light","tabColor","red",3,"tabUnderline"],["label","Invite By Email"],[4,"ngTemplateOutlet"],["label","Share Code or Link"],[1,"theme-light","pt-6"],["sentText","Send invites","cancelText","Cancel",3,"inviteSent","inviteCancelled","organization","layout"],[1,"theme-light","py-6"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"h1",2),e.EFF(1,"Invite Members"),e.k0s(),e.j41(2,"div",3)(3,"div",4)(4,"button",5),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleInviteCancelled())}),e.nrm(5,"app-icon",6),e.k0s(),e.j41(6,"app-tabs",7)(7,"app-tab",8),e.DNE(8,WD,1,0,"ng-container",9),e.k0s(),e.j41(9,"app-tab",10),e.DNE(10,XD,1,0,"ng-container",9),e.k0s()(),e.DNE(11,HD,2,2,"ng-template",null,0,e.C5r)(13,QD,2,0,"ng-template",null,1,e.C5r),e.k0s()()}if(2&t){const s=e.sdS(12),a=e.sdS(14);e.R7$(4),e.BMQ("aria-label","Close"),e.R7$(2),e.Y8G("tabUnderline",!0),e.R7$(2),e.Y8G("ngTemplateOutlet",s),e.R7$(2),e.Y8G("ngTemplateOutlet",a)}},dependencies:[J.T3,vt.BI,vt.Yi,Mn.Q,ut.R,im.j,om.O,Ha,Qr],styles:[".dialog[_ngcontent-%COMP%]{width:480px}.dialog__input[_ngcontent-%COMP%]{resize:vertical}.dialog__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.dialog__actions--compact[_ngcontent-%COMP%]{justify-content:flex-end}.dialog__close[_ngcontent-%COMP%]{position:absolute;right:24px;top:24px}@media (max-width: 480px){.dialog[_ngcontent-%COMP%]{width:100%}}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(At.getInviting),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Yr.prototype,"inviting$",void 0);let ob=(()=>{class n{static#e=this.type="[Share] Reset";constructor(){}}return n})(),kc=(()=>{class n{static#e=this.type="[Share] Share Email Link";constructor(t){this.shareEmail=t}}return n})(),sb=(()=>{class n{static#e=this.type="[Share] Share Email Link Success";constructor(t){this.shareEmail=t}}return n})(),ab=(()=>{class n{static#e=this.type="[Share] Share Email Link Fail";constructor(t){this.error=t}}return n})();var Es=function(n){return n.Facebook="facebook",n.LinkedIn="linkedin",n.Twitter="twitter",n}(Es||{}),$u=function(n){return n.Model="model",n.Quiz="quiz",n}($u||{});let Bu=(()=>{class n{constructor(t,o){this.http=t,this.APP_BASE_URL=o}shareEmailLink(t){return this.http.post("/ws/user/share/email",t)}generateShareLink(t,o="en"){const s=t.thumbnail_url.replace("/small/","/large/");return{type:t.quiz?$u.Quiz:$u.Model,title:t.title,relativeUrl:this.createShareUrl(t,"share",o,!1,!1),fullUrl:this.createShareUrl(t,"share",o,!0,!1),thumbUrl:s,social:[{type:Es.Facebook,url:`https://www.facebook.com/sharer/sharer.php?u=${this.createShareUrl(t,Es.Facebook,o,!0,!0)}`},{type:Es.LinkedIn,url:`https://www.linkedin.com/sharing/share-offsite/?url=${this.createShareUrl(t,Es.LinkedIn,o,!0,!0)}`},{type:Es.Twitter,url:`http://twitter.com/share?url=${this.createShareUrl(t,Es.Twitter,o,!0,!0)}`}]}}createShareUrl(t,o,s,a,r){const _=t.id.replace(".json",""),g=Object.values(Es).includes(o),F=`/view?id=${_}&lang=${s}&ref=${o}`,ee=a||g?`${g?"https://human.biodigital.com":this.APP_BASE_URL}${F}`:F;return r?encodeURIComponent(ee):ee}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(f.Qq),e.KVO(Y_))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Dc=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},jo=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const rb={sharing:!1};let Qa=class kd{static getSharing(i){return i.sharing}resetShare(i,t){i.setState(rb)}sendEmail(i,{shareEmail:t}){i.patchState({sharing:!0}),this.authService.verifyIsHuman("share_email").pipe((0,Ln.Z)(({isHuman:o,verification:s})=>{if(!o)throw new Mo;return this.shareService.shareEmailLink({version:4,app_productkey:this.productService.productKey,app_producttype:this.productService.productType,site_verify_response:s,...t})}),(0,Ot.j)(()=>i.patchState({sharing:!1}))).subscribe({next:()=>{i.dispatch(new sb(t))},error:o=>{o instanceof Mo&&i.dispatch(new ca(o)),i.dispatch(new ab(o))}})}constructor(i,t,o){this.shareService=i,this.productService=t,this.authService=o}static#e=this.\u0275fac=function(t){return new(t||kd)(e.KVO(Bu),e.KVO(De),e.KVO(_a))};static#t=this.\u0275prov=e.jDH({token:kd,factory:kd.\u0275fac})};Dc([(0,l.rc)(ob),jo("design:type",Function),jo("design:paramtypes",[Object,ob]),jo("design:returntype",void 0)],Qa.prototype,"resetShare",null),Dc([(0,l.rc)(kc),jo("design:type",Function),jo("design:paramtypes",[Object,kc]),jo("design:returntype",void 0)],Qa.prototype,"sendEmail",null),Dc([(0,l.MD)(),jo("design:type",Function),jo("design:paramtypes",[class YD{}]),jo("design:returntype",void 0)],Qa,"getSharing",null),Qa=Dc([(0,l.Uw)({name:"share",defaults:rb}),jo("design:paramtypes",[Bu,De,_a])],Qa);var lb=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},cb=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const KD=["emailField"];function qD(n,i){1&n&&(e.qex(0),e.j41(1,"div",15)(2,"app-message-toggle",16),e.EFF(3," Your email was successfully sent. "),e.k0s()(),e.bVm())}function JD(n,i){if(1&n&&(e.j41(0,"div",15)(1,"app-message-toggle",22),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(2),e.SpI(" ",t.errorMessage," ")}}function ZD(n,i){1&n&&e.nrm(0,"app-spinner",23)}function e3(n,i){1&n&&(e.j41(0,"div",25)(1,"mat-error"),e.EFF(2,"Please enter a valid email address."),e.k0s()())}function t3(n,i){if(1&n&&(e.j41(0,"div",27)(1,"mat-error"),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(2).$implicit,o=e.XpG(3);e.R7$(2),e.Lme(" Maximum email addresses excceeded, ",t.currentEmailCount," of ",o.maxEmailCount," max. ")}}function n3(n,i){if(1&n&&e.DNE(0,t3,3,2,"div",26),2&n){const t=e.XpG().$implicit;e.Y8G("ngIf",t.maxEmailsExceeded)}}function i3(n,i){if(1&n&&(e.qex(0),e.DNE(1,e3,3,0,"div",24)(2,n3,1,1,"ng-template",null,2,e.C5r),e.bVm()),2&n){const t=i.$implicit,o=e.sdS(3);e.R7$(),e.Y8G("ngIf",t.invalidEmails)("ngIfElse",o)}}function o3(n,i){if(1&n){const t=e.RV6();e.DNE(0,JD,3,1,"div",17),e.j41(1,"form",18),e.bIt("submit",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.submitForm(s.config.shareLink))}),e.j41(2,"textarea",19,1),e.EFF(4,"          "),e.k0s(),e.j41(5,"button",20),e.nI1(6,"async"),e.DNE(7,ZD,1,0,"app-spinner",21),e.nI1(8,"async"),e.EFF(9),e.nI1(10,"async"),e.k0s()(),e.DNE(11,i3,4,2,"ng-container",6)}if(2&n){const t=e.XpG(2);e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("formGroup",t.form),e.R7$(4),e.Y8G("disabled",!t.form.valid||e.bMT(6,7,t.sharing$)),e.BMQ("aria-label","Send Email"),e.R7$(2),e.Y8G("ngIf",e.bMT(8,9,t.sharing$)),e.R7$(2),e.SpI(" ",e.bMT(10,11,t.sharing$)?"Sending":"Send Email"," "),e.R7$(2),e.Y8G("ngIf",t.form.get("emails").errors)}}function s3(n,i){if(1&n&&(e.qex(0),e.DNE(1,qD,4,0,"ng-container",14)(2,o3,12,13,"ng-template",null,0,e.C5r),e.bVm()),2&n){const t=e.sdS(3),o=e.XpG();e.R7$(),e.Y8G("ngIf",o.emailSent)("ngIfElse",t)}}function a3(n,i){if(1&n&&(e.j41(0,"a",28),e.nI1(1,"titlecase"),e.nI1(2,"titlecase"),e.nrm(3,"img",9),e.k0s()),2&n){const t=i.$implicit;e.Y8G("href",t.url,e.B4B)("matTooltip","Share via "+e.bMT(1,5,t.type)),e.BMQ("aria-label","Share via "+e.bMT(2,7,t.type))("data-test",t.type+"LinkButton"),e.R7$(3),e.Y8G("src","/assets/images/social/"+t.type+"-share.svg",e.B4B)}}function r3(n,i){if(1&n&&(e.j41(0,"p",29),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.config.description," ")}}class Ya{constructor(i,t,o,s,a,r,_,g){this.store=i,this.actions=t,this.dialogRef=o,this.data=s,this.clipboardService=a,this.snackBar=r,this.formBuilder=_,this.changeRef=g,this.maxEmailCount=50,this.config={title:"Share"},this.emailSent=!1,this.errorMessage="",this.formError="",this.ngUnsubscribe=new k.B,this.config={...this.config,...s},this.initForm()}ngOnInit(){this.initEmailListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({emails:["",fe.k0.required,tb(this.maxEmailCount).bind(this)]})}initEmailListeners(){this.actions.pipe((0,l.xi)(kc),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!1,this.errorMessage="",this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(sb),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.emailSent=!0,this.errorMessage="",setTimeout(()=>{this.emailSent=!1,this.form.setValue({emails:""}),this.changeRef.markForCheck(),setTimeout(()=>this.focus())},5e3),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(ab),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.emailSent=!1,this.errorMessage=ss(i.error)||"There was an error sending the email.",setTimeout(()=>this.focus()),this.changeRef.markForCheck()})}focus(){const i=this.emailField?.nativeElement;i&&i.focus()}submitForm(i){const{type:t,title:o,relativeUrl:s,thumbUrl:a}=i,r=ho.l.parseEmails(this.form.value.emails);this.store.dispatch(new kc({share_type:t,share_title:o,share_thumbnail_path:a,share_link_path:s,share_emails:r}))}handleCopyClick(i,t){this.clipboardService.copyToClipboard(i,"url").pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{this.snackBar.open(`Link ${o?"copied":"not copied"}.`)}),t.preventDefault()}handleCloseClick(){this.dialogRef.close()}static#e=this.\u0275fac=function(t){return new(t||Ya)(e.rXU(l.il),e.rXU(l.En),e.rXU(vt.CP),e.rXU(vt.Vh),e.rXU(Fr.W),e.rXU(ui.UG),e.rXU(fe.ok),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Ya,selectors:[["app-share-url-dialog"]],viewQuery:function(t,o){if(1&t&&e.GBs(KD,5),2&t){let s;e.mGM(s=e.lsd())&&(o.emailField=s.first)}},decls:14,vars:9,consts:[["emailFormTmp",""],["emailField",""],["maxEmailErrorTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"share-url-dialog"],[4,"ngIf"],[1,"share-url-dialog__social"],["target","_blank","aria-label","Copy Link","matTooltip","Copy Link","matTooltipPosition","below","data-test","copyLinkButton",1,"share-url-dialog__social-link",3,"click","href"],[3,"src"],["class","share-url-dialog__social-link","target","_blank","matTooltipPosition","below",3,"href","matTooltip",4,"ngFor","ngForOf"],["class","share-url-dialog__description my-3",4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonType","flat","buttonTheme","light","type","button","title","Close",1,"share-url-dialog__close",3,"click"],[4,"ngIf","ngIfElse"],[1,"my-2"],["type","message"],["class","my-2",4,"ngIf"],[1,"share-url-dialog__form",3,"submit","formGroup"],["rows","1","formControlName","emails","placeholder","Email, comma separated","data-test","emailEntryField",1,"share-url-dialog__input","input","theme-light"],["type","submit","app-button","","buttonType","primary","title","'Send Email'","data-test","emailLinkButton",1,"share-url-dialog__submit",3,"disabled"],["size","small","class","mr-2","render","inline",4,"ngIf"],["type","error"],["size","small","render","inline",1,"mr-2"],["class","my-1",4,"ngIf","ngIfElse"],[1,"my-1"],["class","flex flex-col my-1",4,"ngIf"],[1,"flex","flex-col","my-1"],["target","_blank","matTooltipPosition","below",1,"share-url-dialog__social-link",3,"href","matTooltip"],[1,"share-url-dialog__description","my-3"]],template:function(t,o){1&t&&(e.j41(0,"h1",3),e.EFF(1),e.k0s(),e.j41(2,"div",4)(3,"div",5),e.DNE(4,s3,4,2,"ng-container",6),e.nI1(5,"async"),e.j41(6,"div",7)(7,"a",8),e.bIt("click",function(a){return o.handleCopyClick(null==o.config.shareLink?null:o.config.shareLink.fullUrl,a)}),e.nrm(8,"img",9),e.k0s(),e.DNE(9,a3,4,9,"a",10),e.k0s(),e.DNE(10,r3,2,1,"p",11),e.k0s()(),e.j41(11,"div",12)(12,"button",13),e.bIt("click",function(){return o.handleCloseClick()}),e.EFF(13," Close "),e.k0s()()),2&t&&(e.R7$(),e.JRh(o.config.title),e.R7$(3),e.Y8G("ngIf",e.bMT(5,7,o.userProfile$)),e.R7$(3),e.Y8G("href",null==o.config.shareLink?null:o.config.shareLink.fullUrl,e.B4B),e.R7$(),e.Y8G("src","/assets/images/social/link-share.svg",e.B4B),e.R7$(),e.Y8G("ngForOf",null==o.config.shareLink?null:o.config.shareLink.social),e.R7$(),e.Y8G("ngIf",o.config.description),e.R7$(2),e.BMQ("aria-label","Close"))},dependencies:[J.Sq,J.bT,Gu.TL,vt.BI,vt.E7,vt.Yi,Kt.oV,Mn.Q,Jo.tI,Dr,fe.qT,fe.me,fe.BC,fe.cb,fe.j4,fe.JD,J.Jj,J.PV],styles:[".share-url-dialog__description[_ngcontent-%COMP%]{color:#536788;font-size:.75rem;line-height:1rem}.share-url-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:12px}.share-url-dialog__submit[_ngcontent-%COMP%]{flex:1 0 120px}.share-url-dialog__social[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;margin-top:32px;margin-bottom:20px}.share-url-dialog__social-link[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:100%;cursor:pointer}.share-url-dialog__social-link[_ngcontent-%COMP%]:focus{outline:#2472e9 solid 2px!important}.share-url-dialog__social-link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.share-url-dialog__input[_ngcontent-%COMP%], .share-url-dialog__input[_ngcontent-%COMP%]:disabled{background-color:#f8f9fa;color:#536788;font-size:.75rem;line-height:1rem;opacity:1;resize:vertical;max-height:240px}@media (max-width: 480px){.share-url-dialog__form[_ngcontent-%COMP%]{flex-wrap:wrap}}"],changeDetection:0})}function l3(n,i){if(1&n&&e.nrm(0,"img",17),2&n){const t=e.XpG().$implicit;e.Y8G("src",t.logo,e.B4B)}}function c3(n,i){if(1&n&&(e.j41(0,"h2",18),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.title," ")}}function d3(n,i){if(1&n&&e.nrm(0,"p",19),2&n){const t=e.XpG().$implicit;e.AVh("text-xl",t.logo)("font-medium",t.logo),e.Y8G("innerHTML",t.text,e.npT)}}function _3(n,i){if(1&n&&e.nrm(0,"img",20),2&n){const t=e.XpG().$implicit;e.Y8G("src",t.image,e.B4B)}}function p3(n,i){if(1&n&&(e.j41(0,"div",12),e.DNE(1,l3,1,1,"img",13)(2,c3,2,1,"h2",14)(3,d3,1,5,"p",15)(4,_3,1,1,"img",16),e.k0s()),2&n){const t=i.$implicit,o=i.index,s=e.XpG();e.AVh("slide__item--hidden",s.selectedIndex!==o),e.R7$(),e.Y8G("ngIf",t.logo),e.R7$(),e.Y8G("ngIf",t.title),e.R7$(),e.Y8G("ngIf",t.text),e.R7$(),e.Y8G("ngIf",t.image)}}function u3(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){const s=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleSelectSlideClick(s))}),e.k0s()}if(2&n){const t=i.$implicit,o=i.index,s=e.XpG();e.AVh("slide__nav-dot--active",s.selectedIndex===o),e.BMQ("title",t.title)("aria-label",t.title)}}lb([(0,l.l6)(Pe.getUserProfile),cb("design:type",h.c)],Ya.prototype,"userProfile$",void 0),lb([(0,l.l6)(Qa.getSharing),cb("design:type",h.c)],Ya.prototype,"sharing$",void 0);var Lc=function(n){return n[n.NewUser=0]="NewUser",n[n.ExistingUser=1]="ExistingUser",n[n.Group=2]="Group",n}(Lc||{});const h3=[{text:"We make it easy to visualize the human body<br/> for your educational needs - all in interactive 3D.",logo:"/assets/images/biodigital-logo.svg"},{title:"Explore",text:"Browse our digital library for 3D models to complement your curriculum.",image:"/assets/images/welcome-tour-explore.jpg"},{title:"Customize",text:"Use our authoring tools to create 3D views tailored to your educational goals.",image:"/assets/images/welcome-tour-customize.jpg"},{title:"Collaborate",text:"Share your saved 3D views with your team from a central Library.",image:"/assets/images/welcome-tour-collaborate.jpg"},{title:"Integrate",text:"Publish your interactive 3D model and drop into your digital content.",image:"/assets/images/welcome-tour-integrate.jpg"}],g3=[{title:"Introducing Human Studio",text:"The first product for authoring custom interactive 3D models of anatomy, disease and treatments.",image:"/assets/images/studio-tour-studio.jpg"},{title:"Interactive Labels",text:"Quickly add anatomical labels to call out key learning objectives.",image:"/assets/images/studio-tour-labels.jpg"},{title:"Paint",text:"Customize the look and feel of your 3D model by applying different paint effects to anatomical structures.",image:"/assets/images/studio-tour-paint.jpg"},{title:"Tour Builder",text:"Tell an interactive story by stringing together different views of your 3D model.",image:"/assets/images/studio-tour-tour.jpg"},{title:"Text Manager",text:"Add or modify text from one dedicated place.",image:"/assets/images/studio-tour-text.jpg"}];let m3=(()=>{class n{get isFirstSlide(){return 0===this.selectedIndex}get isLastSlide(){return this.selectedIndex===this.slides.length-1}constructor(t,o,s){switch(this.store=t,this.dialogRef=o,this.data=s,this.ngUnsubscribe=new k.B,this.settings={userType:Lc.NewUser},this.slides=[],this.selectedIndex=0,this.settings={...this.settings,...s},this.settings.userType){case Lc.NewUser:this.slides=h3;break;case Lc.ExistingUser:this.slides=g3}}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCloseTour(){this.close()}close(){this.dialogRef.close()}handleSelectSlideClick(t){this.selectedIndex=t}handleNextClick(){this.incrementSelectedIndex(1)}handlePrevClick(){this.incrementSelectedIndex(-1)}incrementSelectedIndex(t){this.selectedIndex=Math.max(0,this.selectedIndex+t)%this.slides.length}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-welcome-tour-dialog"]],decls:12,vars:8,consts:[["role","dialog","aria-modal","true","data-test","welcomeTour",1,"welcome"],[1,"slide"],["class","slide__item",3,"slide__item--hidden",4,"ngFor","ngForOf"],[1,"slide__nav"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Previous Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-left","size","md"],[1,"slide__nav-dots"],["type","button","class","slide__nav-dot",3,"slide__nav-dot--active","click",4,"ngFor","ngForOf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Next Slide",1,"slide__nav-arrow",3,"click","disabled"],["icon","chevron-right","size","md"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close","data-test","welcomeTourClose",1,"welcome__close",3,"click"],["icon","times","size","lg"],[1,"slide__item"],["class","slide__logo",3,"src",4,"ngIf"],["class","text-2xl uppercase mt-4",4,"ngIf"],["class","text-lg mt-4 mb-4",3,"text-xl","font-medium","innerHTML",4,"ngIf"],["class","slide__image",3,"src",4,"ngIf"],[1,"slide__logo",3,"src"],[1,"text-2xl","uppercase","mt-4"],[1,"text-lg","mt-4","mb-4",3,"innerHTML"],[1,"slide__image",3,"src"],["type","button",1,"slide__nav-dot",3,"click"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,p3,5,6,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return s.handlePrevClick()}),e.nrm(5,"app-icon",5),e.k0s(),e.j41(6,"div",6),e.DNE(7,u3,1,4,"button",7),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return s.handleNextClick()}),e.nrm(9,"app-icon",9),e.k0s()()(),e.j41(10,"button",10),e.bIt("click",function(){return s.handleCloseTour()}),e.nrm(11,"app-icon",11),e.k0s()()),2&o&&(e.BMQ("aria-label","Welcome Tour"),e.R7$(2),e.Y8G("ngForOf",s.slides),e.R7$(2),e.Y8G("disabled",s.isFirstSlide),e.BMQ("aria-label","Previous Slide"),e.R7$(3),e.Y8G("ngForOf",s.slides),e.R7$(),e.Y8G("disabled",s.isLastSlide),e.BMQ("aria-label","Next Slide"),e.R7$(2),e.BMQ("aria-label","Close"))},dependencies:[J.Sq,J.bT,Mn.Q,ut.R],styles:[".welcome[_ngcontent-%COMP%]{position:relative;display:flex;align-items:flex-end;flex-direction:column;padding:24px}.welcome__close[_ngcontent-%COMP%]{position:absolute;top:24px;right:24px}.slide[_ngcontent-%COMP%]{width:800px;height:600px;position:relative;margin:auto;display:flex;flex-direction:column;justify-content:space-between}.slide__item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.slide__item--hidden[_ngcontent-%COMP%]{display:none}.slide__logo[_ngcontent-%COMP%]{width:300px;margin:160px 0 40px}.slide__image[_ngcontent-%COMP%]{flex:2;overflow:auto;width:100%}.slide__nav[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;font-size:16px;margin:12px 0}.slide__nav-arrow[_ngcontent-%COMP%]{cursor:pointer;margin:auto 12px;opacity:.8}.slide__nav-arrow[_ngcontent-%COMP%]:hover:not([disabled]){opacity:1}.slide__nav-dots[_ngcontent-%COMP%]{display:flex}.slide__nav-dot[_ngcontent-%COMP%]{margin:auto 4px;cursor:pointer;display:flex;background-color:#14213666;border-radius:50%;border:none;width:14px;height:14px;line-height:17px}.slide__nav-dot[_ngcontent-%COMP%]:hover{background-color:#14213699}.slide__nav-dot--active[_ngcontent-%COMP%]{background-color:#2472e9}@media (max-width: 1024px){.slide[_ngcontent-%COMP%]{width:100%;height:80vh}}"],changeDetection:0})}return n})();const b3=(n,i,t,o)=>({"team-join--compact":n,"team-join--readonly":i,"team-join--theme-dark":t,"team-join--theme-light":o});function y3(n,i){1&n&&(e.j41(0,"div",3),e.nrm(1,"app-spinner",4),e.k0s())}function v3(n,i){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"img",13),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("src",t.pendingJoinOrganization.logoUrl,e.B4B)}}function E3(n,i){if(1&n&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.pendingJoinOrganization.name," ")}}function C3(n,i){if(1&n&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.pendingJoinOrganization.members," ")}}function T3(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleCancelJoinClick(s.pendingJoinRequest.join_request_key))}),e.EFF(1," Cancel Request "),e.k0s()}}function O3(n,i){if(1&n&&(e.qex(0),e.nrm(1,"app-html",5),e.j41(2,"div",6)(3,"div",7),e.DNE(4,v3,2,1,"div",8)(5,E3,2,1,"div",9)(6,C3,2,1,"div",10),e.k0s(),e.DNE(7,T3,2,0,"button",11),e.k0s(),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("markdownText",t.joinRequestText),e.R7$(3),e.Y8G("ngIf",t.pendingJoinOrganization.logoUrl),e.R7$(),e.Y8G("ngIf",!t.compact||!t.pendingJoinOrganization.logoUrl),e.R7$(),e.Y8G("ngIf",!t.compact),e.R7$(),e.Y8G("ngIf",!t.readonly)}}function M3(n,i){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"img",13),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("src",t.logoUrl,e.B4B)}}function I3(n,i){if(1&n&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",t.name," ")}}function P3(n,i){if(1&n&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",t.members," ")}}function w3(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.handleRequestJoinClick(s.id))}),e.EFF(1," Request to Join "),e.k0s()}}function A3(n,i){if(1&n&&(e.j41(0,"div",6)(1,"div",7),e.DNE(2,M3,2,1,"div",8)(3,I3,2,1,"div",9)(4,P3,2,1,"div",10),e.k0s(),e.DNE(5,w3,2,0,"button",20),e.k0s()),2&n){const t=e.XpG().$implicit,o=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.logoUrl),e.R7$(),e.Y8G("ngIf",!o.compact||!t.logoUrl),e.R7$(),e.Y8G("ngIf",!o.compact),e.R7$(),e.Y8G("ngIf",!o.readonly)}}function R3(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,A3,6,4,"div",19),e.k0s()),2&n){const t=i.index,o=e.XpG(2);e.R7$(),e.Y8G("ngIf",0===t||o.showAllOrganizations)}}function N3(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.toggleShowAllOrganizations())}),e.j41(1,"div",23),e.EFF(2),e.nrm(3,"app-icon",24),e.k0s()()}if(2&n){const t=e.XpG(2);e.Y8G("uppercase",!1),e.R7$(2),e.SpI(" ",t.toggleText," "),e.R7$(),e.Y8G("icon",t.showAllOrganizations?"caret-up":"caret-down")}}function k3(n,i){if(1&n&&(e.qex(0),e.nrm(1,"app-html",5),e.DNE(2,R3,2,1,"div",17)(3,N3,4,3,"button",18),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("markdownText",t.requestOrganizationsText),e.R7$(),e.Y8G("ngForOf",t.requestOrganizations),e.R7$(),e.Y8G("ngIf",t.showToggle)}}class Kr{get joinRequestText(){if(this._joinRequestText)return this._joinRequestText;{let i=this.pendingJoinOrganization?.name;return i=i?`${i} team`:"team",`Your request to join the ${i} is pending approval from a team administrator. It will automatically expire in 14 days if not approved.`}}set joinRequestText(i){this._joinRequestText=i}constructor(i,t,o,s){this.changeDetectorRef=i,this.store=t,this.actions=o,this.snackBar=s,this.readonly=!1,this.compact=!1,this.theme="dark",this.organizations=[],this._joinRequestText="",this.requestOrganizationsText="It looks like some of your teammates are already using the BioDigital Human.",this.pendingJoinRequestSuccess=new e.bkB,this.requestOrganizationsSuccess=new e.bkB,this.joinRequestsLoaded=!1,this.requestOrganizations=[],this.showAllOrganizations=!1,this.showToggle=!1,this.showMoreText="",this.ngUnsubscribe=new k.B}get showPendingRequest(){return void 0!==this.pendingJoinRequest}get showRequestOrganizations(){return void 0===this.pendingJoinRequest&&this.requestOrganizations.length>0}get toggleText(){return this.showAllOrganizations?"Show less":this.showMoreText}ngOnInit(){this.initEventListeners(),this.initRequests()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initRequests(){this.showAllOrganizations=!this.compact,0===this.organizations.length?this.store.dispatch(new Hr):this.createRequestOrganizations(this.organizations)}initEventListeners(){this.actions.pipe((0,l.xi)(Rc),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetJoinRequestsSuccess()),this.actions.pipe((0,l.xi)(Ac),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleGetEligibleOrganizationsSuccess()),this.actions.pipe((0,l.xi)(HS),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Join request successfully cancelled.")}),this.actions.pipe((0,l.xi)(QS),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with cancelling the request.")}),this.actions.pipe((0,l.xi)(XS),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("There was an error with making this request.")})}handleRequestJoinClick(i){this.store.dispatch(new ku(i))}handleCancelJoinClick(i){this.store.dispatch(new Du(i))}toggleShowAllOrganizations(){this.showAllOrganizations=!this.showAllOrganizations}handleGetJoinRequestsSuccess(){this.joinRequestsLoaded=!0,this.pendingJoinRequest=this.store.selectSnapshot(At.getPendingJoinRequest),this.pendingJoinRequest?this.pendingJoinOrganization=this.createDisplayOrganization(this.pendingJoinRequest.request_organization):this.store.dispatch(new Ru),this.pendingJoinRequestSuccess.next(this.pendingJoinRequest),this.changeDetectorRef.markForCheck()}handleGetEligibleOrganizationsSuccess(){this.createRequestOrganizations(this.store.selectSnapshot(At.getEligibleOrganizations)),this.requestOrganizationsSuccess.next(this.requestOrganizations),this.changeDetectorRef.markForCheck()}createRequestOrganizations(i){this.showToggle=this.compact&&i.length>1;const t=i.length-1;this.showMoreText=`Show ${t} more team${1===t?"":"s"}`,this.requestOrganizations=i.map(this.createDisplayOrganization,this),this.requestOrganizations.sort((o,s)=>s.logoUrl&&!o.logoUrl?1:-1),this.changeDetectorRef.markForCheck()}createDisplayOrganization(i){return{id:i.organization_id,name:i.organization_name,logoUrl:i.group_logos.default,members:`${i.users_count} member${1===i.users_count?"":"s"}`}}static#e=this.\u0275fac=function(t){return new(t||Kr)(e.rXU(e.gRc),e.rXU(l.il),e.rXU(l.En),e.rXU(ui.UG))};static#t=this.\u0275cmp=e.VBU({type:Kr,selectors:[["app-team-join"]],inputs:{readonly:"readonly",compact:"compact",theme:"theme",organizations:"organizations",joinRequestText:"joinRequestText",requestOrganizationsText:"requestOrganizationsText"},outputs:{pendingJoinRequestSuccess:"pendingJoinRequestSuccess",requestOrganizationsSuccess:"requestOrganizationsSuccess"},decls:7,vars:15,consts:[[1,"team-join",3,"ngClass"],["class","my-6",4,"ngIf"],[4,"ngIf"],[1,"my-6"],["size","huge"],[1,"team-join__text","block","my-4",3,"markdownText"],[1,"team-join__organization","flex","justify-between","mb-3"],[1,"team-join__organization-info","flex","flex-col"],["class","mb-3",4,"ngIf"],["class","team-join__organization-name",4,"ngIf"],["class","team-join__organization-members",4,"ngIf"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click",4,"ngIf"],[1,"mb-3"],[1,"team-join__organization-logo",3,"src"],[1,"team-join__organization-name"],[1,"team-join__organization-members"],["type","submit","app-button","","buttonTheme","light","buttonType","flat",3,"click"],[4,"ngFor","ngForOf"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"uppercase","click",4,"ngIf"],["class","team-join__organization flex justify-between mb-3",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click",4,"ngIf"],["type","submit","buttonTheme","light","app-button","","buttonType","primary",3,"click"],["app-button","","buttonSize","xs","buttonType","text","buttonTheme","light",3,"click","uppercase"],[1,"text-sm","underline"],[1,"pl-1",3,"icon"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.DNE(1,y3,2,0,"div",1),e.nI1(2,"async"),e.DNE(3,O3,8,5,"ng-container",2),e.nI1(4,"async"),e.DNE(5,k3,4,3,"ng-container",2),e.nI1(6,"async"),e.k0s()),2&t&&(e.Y8G("ngClass",e.ziG(10,b3,o.compact,o.readonly,"dark"===o.theme,"light"===o.theme)),e.R7$(),e.Y8G("ngIf",e.bMT(2,4,o.requesting$)),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(4,6,o.requesting$)&&o.showPendingRequest),e.R7$(2),e.Y8G("ngIf",!1===e.bMT(6,8,o.requesting$)&&o.showRequestOrganizations))},dependencies:[Mn.Q,J.YU,J.Sq,J.bT,ut.R,Jo.tI,Ko.V,J.Jj],styles:[".team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--theme-light[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{color:#283853}.team-join__organization[_ngcontent-%COMP%]{border:1px solid #d4d9e3;border-radius:4px;padding:16px}.team-join__organization-info[_ngcontent-%COMP%]{flex-basis:50%}.team-join__organization-logo[_ngcontent-%COMP%]{display:block;max-height:32px;max-width:100%}.team-join__organization-name[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;font-weight:600}.team-join__organization-members[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:500;color:#536788}.team-join--compact[_ngcontent-%COMP%]   .team-join__text[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization[_ngcontent-%COMP%]{border:none;border-radius:0;padding:0}.team-join--compact[_ngcontent-%COMP%]   .team-join__organization-name[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:500}.team-join--readonly[_ngcontent-%COMP%]   .team-join__organization-info[_ngcontent-%COMP%]{flex-basis:auto}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(At.getRequesting),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Kr.prototype,"requesting$",void 0);let D3=(()=>{class n{constructor(t,o,s,a){this.dialogRef=t,this.router=o,this.storageService=s,this.data=a,this.requestOrganizationsText="",this.organizations=[]}ngOnInit(){this.organizations=this.data.organizations,this.storageService.setLocalItem(It.UT.UserJoinPromptSeen,!0),this.dialogRef.afterClosed().subscribe(t=>{t&&this.router.navigateByUrl("/account/team")})}handleViewTeamsCancel(){this.dialogRef.close(!1)}handleViewTeamsClick(){this.dialogRef.close(!0)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(K.Ix),e.rXU(It.n$),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-user-join-dialog"]],decls:7,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"readonly","organizations"],["mat-dialog-actions",""],["app-button","","buttonType","primary",3,"click"]],template:function(o,s){1&o&&(e.j41(0,"h1",0),e.EFF(1,"We found your team"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"app-team-join",2),e.k0s(),e.j41(4,"div",3)(5,"button",4),e.bIt("click",function(){return s.handleViewTeamsClick()}),e.EFF(6,"View Teams"),e.k0s()()),2&o&&(e.R7$(3),e.Y8G("readonly",!0)("organizations",s.organizations))},dependencies:[vt.BI,vt.E7,vt.Yi,Mn.Q,Kr],changeDetection:0})}return n})();function L3(n,i){if(1&n&&e.nrm(0,"app-icon",2),2&n){const t=e.XpG();e.Y8G("icon",t.icon)}}let U3=(()=>{class n{constructor(){this.size="medium",this.type="outline",this.color="#CCCCCC"}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-profile-badge"]],inputs:{size:"size",type:"type",color:"color",icon:"icon",label:"label"},decls:3,vars:12,consts:[[1,"badge","uppercase"],[3,"icon",4,"ngIf"],[3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,L3,1,1,"app-icon",1),e.EFF(2),e.k0s()),2&o&&(e.AVh("badge--outline","outline"===s.type)("badge--solid","solid"===s.type)("badge--small","small"===s.size)("badge--medium","medium"===s.size)("badge--large","large"===s.size),e.R7$(),e.Y8G("ngIf",s.icon),e.R7$(),e.SpI(" ",s.label,"\n"))},dependencies:[J.bT,ut.R],styles:[".badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border-radius:50%;color:#0c1726}.badge--outline[_ngcontent-%COMP%]{border:1px solid #ffffff;background-color:#8999b399;color:#fff}.badge--small[_ngcontent-%COMP%]{width:32px;height:32px;font-size:.75rem;line-height:1rem}.badge--medium[_ngcontent-%COMP%]{width:40px;height:40px;font-size:.875rem;line-height:1.25rem}.badge--large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1rem;line-height:1.5rem}.badge--x-large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.125rem;line-height:1.75rem}"],changeDetection:0})}return n})();const V3=(n,i)=>({"team-user--light":n,"team-user--dark":i});function F3(n,i){if(1&n&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.user.name||"<Name Unknown>"," ")}}function G3(n,i){1&n&&(e.j41(0,"div",9),e.EFF(1,"Developer"),e.k0s())}function $3(n,i){if(1&n&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.user.email," ")}}function B3(n,i){if(1&n&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.AVh("team-user__role--expired","expired"===t.user.invitationStatus),e.R7$(),e.SpI(" ",t.user.invitationStatus?t.user.invitationStatus:t.user.role.role_display_name," ")}}class qr{constructor(){this.showEmail=!1,this.showRole=!0,this.theme="light"}set showNameUnknown(i){this.showName=i||this.user.name.length>0}static#e=this.\u0275fac=function(t){return new(t||qr)};static#t=this.\u0275cmp=e.VBU({type:qr,selectors:[["app-team-user"]],inputs:{user:"user",showEmail:"showEmail",showNameUnknown:"showNameUnknown",showRole:"showRole",theme:"theme"},decls:8,vars:10,consts:[[1,"team-user","flex","flex-row","grow","align-center","items-center",3,"ngClass"],[1,"team-user__badge","mr-3"],["type","outline","size","small",3,"label","icon"],[1,"team-user__text"],["class","team-user__name text-sm","data-test","teamMemberName",4,"ngIf"],["class","team-user__developer",4,"ngIf"],["class","team-user__email text-xs","data-test","teamMemberEmail",4,"ngIf"],["class","team-user__role flex flex-row items-center justify-end mx-2 text-2xs","data-test","teamMemberInfo",3,"team-user__role--expired",4,"ngIf"],["data-test","teamMemberName",1,"team-user__name","text-sm"],[1,"team-user__developer"],["data-test","teamMemberEmail",1,"team-user__email","text-xs"],["data-test","teamMemberInfo",1,"team-user__role","flex","flex-row","items-center","justify-end","mx-2","text-2xs"]],template:function(t,o){1&t&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-profile-badge",2),e.k0s(),e.j41(3,"div",3),e.DNE(4,F3,2,1,"div",4)(5,G3,2,0,"div",5)(6,$3,2,1,"div",6),e.k0s(),e.DNE(7,B3,2,3,"div",7),e.k0s()),2&t&&(e.Y8G("ngClass",e.l_i(7,V3,"light"===o.theme,"dark"===o.theme)),e.R7$(2),e.Y8G("label",o.user.initials)("icon",o.user.initials?"":"user"),e.R7$(2),e.Y8G("ngIf",o.showName),e.R7$(),e.Y8G("ngIf",o.user.activeDeveloper),e.R7$(),e.Y8G("ngIf",o.showEmail),e.R7$(),e.Y8G("ngIf",o.showRole))},dependencies:[J.YU,J.bT,U3],styles:[".team-user__badge[_ngcontent-%COMP%]{align-self:center}.team-user__text[_ngcontent-%COMP%]{width:0;flex-grow:1;flex-shrink:1;overflow:hidden}.team-user__name[_ngcontent-%COMP%]{color:#142136;overflow:hidden;text-overflow:ellipsis}.team-user__developer[_ngcontent-%COMP%]{height:16px;padding:0 8px;margin:4px 0;display:inline-flex;align-items:center;justify-content:center;font-size:8px;color:#384c6c;background-color:#e7eaee;border-radius:8px;border:1px solid #8999b3;text-transform:uppercase}.team-user__email[_ngcontent-%COMP%]{color:#384c6c;overflow:hidden;text-overflow:ellipsis}.team-user__role[_ngcontent-%COMP%]{text-transform:uppercase;color:#8999b3}.team-user__role--expired[_ngcontent-%COMP%]{color:#ef4444}.team-user--dark[_ngcontent-%COMP%]   .team-user__developer[_ngcontent-%COMP%]{background-color:#f8f9fa}"],changeDetection:0})}function X3(n,i){if(1&n&&(e.j41(0,"option",14),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.Y8G("value",t.role_id),e.R7$(),e.SpI(" ",t.role_display_name," ")}}function H3(n,i){if(1&n&&(e.j41(0,"select",12),e.DNE(1,X3,2,2,"option",13),e.nI1(2,"async"),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,t.userRoles$))}}function Q3(n,i){if(1&n&&(e.j41(0,"div",9),e.nrm(1,"app-team-user",10),e.DNE(2,H3,3,3,"select",11),e.k0s()),2&n){const t=i.$implicit,o=i.index,s=e.XpG();e.Y8G("formGroupName",o),e.R7$(),e.Y8G("user",t)("showEmail",!0)("showNameUnknown",!0)("showRole",!1),e.R7$(),e.Y8G("ngIf",s.data.accept)}}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Pe.isAdmin),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],qr.prototype,"isAdmin$",void 0);class Jr{constructor(i,t,o){this.dialogRef=i,this.formBuilder=t,this.data=o}ngOnInit(){this.action=this.data.accept?"approve":"deny";const i="request"+(this.data.users.length>1?"s":"");this.title=`${(0,u.capitalize)(this.action)} ${(0,u.capitalize)(i)}?`,this.text=`Are you sure you want to ${this.action} the following ${i} to join your team?`,this.initForm()}initForm(){const i=this.data.users.map(t=>this.formBuilder.group({joinRequestKey:t.joinRequestKey,roleId:t.role.role_id}));this.form=this.formBuilder.group({joinRequests:new fe.Bm(i)})}createPayload(){const{joinRequests:i}=this.form.value;return i.map(this.data.accept?t=>({join_request_key:t.joinRequestKey,user_role_id:parseInt(t.roleId)}):t=>t.joinRequestKey)}handleConfirmClick(){this.dialogRef.close(this.createPayload())}static#e=this.\u0275fac=function(t){return new(t||Jr)(e.rXU(vt.CP),e.rXU(fe.ze),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:Jr,selectors:[["app-team-join-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],["formArrayName","joinRequests"],[1,"my-3","text-sm"],["class","flex space-between align-center my-2 py-2",3,"formGroupName",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","mat-dialog-close",""],["app-button","","buttonType","primary",3,"click"],[1,"flex","space-between","align-center","my-2","py-2",3,"formGroupName"],[1,"flex","grow",3,"user","showEmail","showNameUnknown","showRole"],["class","input w-auto","formControlName","roleId",4,"ngIf"],["formControlName","roleId",1,"input","w-auto"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){1&t&&(e.j41(0,"h1",0),e.EFF(1),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),e.EFF(6),e.k0s(),e.DNE(7,Q3,3,6,"div",5),e.k0s()()(),e.j41(8,"div",6)(9,"button",7),e.EFF(10,"Cancel"),e.k0s(),e.j41(11,"button",8),e.bIt("click",function(){return o.handleConfirmClick()}),e.EFF(12),e.k0s()()),2&t&&(e.R7$(),e.JRh(o.title),e.R7$(2),e.Y8G("formGroup",o.form),e.R7$(3),e.JRh(o.text),e.R7$(),e.Y8G("ngForOf",o.data.users),e.R7$(5),e.SpI(" ",o.action," "))},dependencies:[J.Sq,J.bT,vt.tx,vt.BI,vt.E7,vt.Yi,Mn.Q,qr,fe.xH,fe.y7,fe.wz,fe.BC,fe.cb,fe.j4,fe.JD,fe.$R,fe.v8,J.Jj],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Pe.getUserRoles),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Jr.prototype,"userRoles$",void 0);const db={maxWidth:"100vw",width:"100vw",height:"100vh",panelClass:"full-modal"};let Zs=(()=>{class n{get isMobile(){return window.innerWidth<=959}constructor(t,o,s,a,r,_,g){this.dialog=t,this.applicationEventService=o,this.router=s,this.store=a,this.vendorAnalyticsService=r,this.productService=_,this.organizationsService=g}openShareDialog(t,o,s){return this.dialog.open(Ya,{id:ji.t.ShareUrlDialog,data:{title:o,description:s,shareLink:t},width:"480px",maxWidth:"90vw"})}openConfirmDialog(t){const o={id:ji.t.ConfirmDialog,...t};return this.dialog.open(H4,o)}openUpgradeDialog(t=!0){t&&this.closeAllDialogs();const o=this.store.selectSnapshot(Pe.getUserProfile),s=this.getContactProfileParams(o),a=o.premium_account_valid?o.premium_account_type:"free",r=(0,u.get)(o,"organizations[0].subscription.type","").toLowerCase(),_=this.store.selectSnapshot(We.isSubscriptionExpired),g=o.premium_account_eligibility.group_free_trial,P=oe(o.account_settings),F=(0,u.get)(P,"account_purpose.value","");let ee;if(z.c.native)ee="mobile.html";else switch(F){case Pc.Business:ee="business.html";break;case Pc.Education:ee="school.html";break;default:ee="individual.html"}const le={...s,accountType:a,subscription:r,expired:_,groupFreeTrial:g},Ge=`${z.c.native?"":{[pi.Z.Local]:"https://localhost:1234",[pi.Z.QA]:"https://pricing-qa.biodigital.com",[pi.Z.Staging]:"https://pricing.biodigital.com",[pi.Z.Production]:"https://pricing.biodigital.com"}[z.c.deploy]}/${ee}?${this.serializeQueryParams(le)}`,Ve={id:ji.t.PricingDialog,...db,data:{title:"Upgrade",url:Ge,backgroundColor:"#0B1220"}},it=encodeURIComponent(this.router.url);return this.dialog.open(DS,Ve).afterClosed().subscribe(ot=>{if(ot){const _t={action:"",plan:"",...ot.metadata},xt={business:["starter","premium","enterprise"],education:["class","institution"]};let $t="Individual";Object.entries(xt).forEach(([rn,qe])=>{qe.indexOf(_t.plan)&&($t=rn)}),_t.action&&this.vendorAnalyticsService.track(`Pricing - ${(0,u.capitalize)(_t.action)} - ${(0,u.capitalize)(_t.plan)}`,{platform:this.productService.productType,page:$t});let hn="";switch(_t.action){case"buy":if(z.c.native)return void this.applicationEventService.fireEvent(rt.F.NativeUpgrade);this.router.navigate(["/account/profile"],{queryParams:{section:"subscription",mode:"edit"}});break;case"contact":this.openContactDialog("pricing page");break;case"try":switch(!0){case xt.business.includes(_t.plan):hn=`/account/workflow/team/create?purpose=Business&returnTo=${it}`;break;case xt.education.includes(_t.plan):hn=`/account/workflow/team/create?purpose=Education&returnTo=${it}`;break;default:hn="account/workflow"}this.router.navigateByUrl(hn)}}else this.vendorAnalyticsService.track("Pricing - Exit")})}openContactDialog(t=""){const o=this.store.selectSnapshot(We.getOrganization),s=(0,u.isNil)(o)?"":`${o.id}`,a=this.store.selectSnapshot(Pe.getUserProfile),r=this.getContactProfileParams(a),_={[pi.Z.Local]:"http://craft-sandbox.biodigital.local",[pi.Z.QA]:"http://craft-sandbox.biodigital.local",[pi.Z.Staging]:"https://www.biodigital.com",[pi.Z.Production]:"https://www.biodigital.com"},g=z.c.native?_[pi.Z.Production]:_[z.c.deploy];if(z.c.native){const P=this.serializeQueryParams({...r,organizationId:s,utm_source:"human-mobile",utm_campaign:t});return window.open(`${g}/contact?${P}`,"_blank")}{const F=`${g}/headless/contact-us?${this.serializeQueryParams({...r,organizationId:s,utm_source:"human-web",utm_campaign:t})}`,ee={id:ji.t.ContactDialog,...db,data:{title:"Contact Us",url:F}};return this.dialog.open(DS,ee)}}openPremiumContentDialog(){const t=z.c.native||!this.isMobile;return this.openConfirmDialog({id:ji.t.PremiumContentDialog,data:{titleText:"Premium Content",bodyText:t?"This is premium content. Upgrade to a Premium Plan for unlimited access.":"This is premium content. Visit us on desktop to upgrade to a premium plan.",confirmText:"Upgrade Now",confirmEnabled:t,cancelText:"OK",confirmColor:"warn"}})}openAddUserDialog(){const t=this.store.selectSnapshot(We.getOrganization);this.dialog.open(Yr,{id:ji.t.AddTeamModelDialog,disableClose:!1,data:{organization:t}})}openWelcomeTourDialog(t,o){const s={id:ji.t.WelcomeTourDialog,disableClose:!1,data:{userType:t},...o};return this.dialog.open(m3,s)}openUserJoinDialog(t,o){return this.dialog.open(D3,{width:"480px",data:{userEmail:t,organizations:o}})}openTeamJoinDialog(t,o){return this.dialog.open(Jr,{width:"480px",disableClose:!1,data:{users:t,accept:o}})}closeAllDialogs(){this.dialog.closeAll()}getContactProfileParams(t){const{first_name:o,last_name:s,email:a}=t,r=(0,u.get)(t,"organizations[0].name",""),_=(0,u.get)(t,"organizations[0].group_attributes",[]),g=oe(t.account_settings),P=(0,u.get)(g,"account_purpose.value",""),F=(0,u.get)(g,"account_field.value",""),ee=(0,u.get)(g,"account_field.value",""),le=(0,u.get)(g,"account_role.value",""),he=this.organizationsService.getOrganizationAttribute(_,"account_settings","account_company_size"),ue=this.organizationsService.getOrganizationAttribute(_,"account_settings","account_company_website");return{first_name:o,last_name:s,email:a,company:r,website:ue?ue.value:"",purpose:P,role:le,program_type:ee,program_size:he?he.value:"",industry:P===Pc.Education?"Academia":F}}serializeQueryParams(t){return Object.entries(t).map(([o,s])=>{const a="string"!=typeof s?JSON.stringify(s):s;return`${o}=${encodeURIComponent(a)}`}).join("&")}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(vt.bZ),e.KVO(Po.S),e.KVO(K.Ix),e.KVO(l.il),e.KVO(ve),e.KVO(De),e.KVO(ce))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var fi=function(n){return n.Desktop="desktop",n.Tablet="tablet",n.Mobile="mobile",n}(fi||{});const K3={[fi.Desktop]:"Desktop",[fi.Tablet]:"iPad Pro 11",[fi.Mobile]:"iPhone 8 Plus"};let _b=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-toggle-group-item"]],inputs:{label:"label",tooltip:"tooltip",icon:"icon",value:"value"},decls:0,vars:0,template:function(o,s){},encapsulation:2,changeDetection:0})}return n})();var pb=d(65571);const q3=(n,i,t,o,s,a)=>({"toggle-group--theme-light":n,"toggle-group--theme-dark":i,"toggle-group--small":t,"toggle-group--medium":o,"toggle-group--large":s,"toggle-group--block":a});function J3(n,i){if(1&n&&e.nrm(0,"app-icon",7),2&n){const t=e.XpG().$implicit;e.Y8G("icon",t.icon)}}function Z3(n,i){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.label)}}function eL(n,i){if(1&n&&(e.j41(0,"mat-button-toggle",3)(1,"div",4),e.DNE(2,J3,1,1,"app-icon",5)(3,Z3,2,1,"span",6),e.k0s()()),2&n){const t=i.$implicit;e.Y8G("value",t.value)("matTooltip",t.tooltip||""),e.BMQ("aria-label",t.label||""),e.R7$(2),e.Y8G("ngIf",t.icon),e.R7$(),e.Y8G("ngIf",t.label)}}let tL=(()=>{class n extends Am{constructor(){super(...arguments),this.theme="light",this.display="inline",this.size="medium"}static#e=this.\u0275fac=(()=>{let t;return function(s){return(t||(t=e.xGo(n)))(s||n)}})();static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-toggle-group"]],contentQueries:function(o,s,a){if(1&o&&e.wni(a,_b,5),2&o){let r;e.mGM(r=e.lsd())&&(s.items=r)}},inputs:{theme:"theme",display:"display",size:"size"},features:[e.Jv_([{provide:fe.kq,useExisting:(0,e.Rfq)(()=>n),multi:!0}]),e.Vt3],decls:3,vars:11,consts:[[1,"toggle-group",3,"ngClass"],[3,"formControl","hideSingleSelectionIndicator"],[3,"value","matTooltip",4,"ngFor","ngForOf"],[3,"value","matTooltip"],[1,"toggle-group__label"],[3,"icon",4,"ngIf"],[4,"ngIf"],[3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"mat-button-toggle-group",1),e.DNE(2,eL,4,5,"mat-button-toggle",2),e.k0s()()),2&o&&(e.Y8G("ngClass",e.l4e(4,q3,"light"===s.theme,"dark"===s.theme,"small"===s.size,"medium"===s.size,"large"===s.size,"block"===s.display)),e.R7$(),e.Y8G("formControl",s.control)("hideSingleSelectionIndicator",!0),e.R7$(),e.Y8G("ngForOf",s.items))},dependencies:[J.YU,J.Sq,J.bT,pb.ec,pb.pc,Kt.oV,ut.R,fe.BC,fe.l_],styles:[".toggle-group{--mat-toggle-border-color: #d4d9e3;--mat-toggle-background-color: #0c1726;--mat-toggle-selected-background-color: #384c6c;--mat-toggle-selected-color: #f8f9fa;--mat-toggle-color: #536788;--mat-toggle-font-size: 14px;--mat-toggle-line-height: 20px;--mat-toggle-padding: 12px;--mat-toggle-min-width: 32px}.toggle-group .mat-button-toggle-group-appearance-standard{border:none}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle{background-color:#e7eaee;color:#384c6c;border:none;border-radius:0!important;padding:0}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle-label-content{font-weight:500;font-size:var(--mat-toggle-font-size);line-height:var(--mat-toggle-line-height);padding:var(--mat-toggle-padding);min-width:var(--mat-toggle-min-width)}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle:hover:not(.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle-checked){background-color:#d4d9e3;color:#142136}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle:first-child{border-radius:4px 0 0 4px!important}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle:last-child{border-radius:0 4px 4px 0!important}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle:last-child .mat-button-toggle-button{border-right:none}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle-checked{background-color:#283853;color:#fff}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle .mat-button-toggle-button{border-right:1px solid #d4d9e3}.toggle-group .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle .mat-button-toggle-button:focus{outline:#2472e9 solid 2px!important;outline-offset:-2px}.toggle-group__label{display:flex;flex-direction:row;align-items:center;justify-content:center;gap:8px}.toggle-group--small{--mat-toggle-font-size: 12px;--mat-toggle-line-height: 16px;--mat-toggle-padding: 6px;--mat-toggle-min-width: 28px}.toggle-group--medium{--mat-toggle-font-size: 14px;--mat-toggle-line-height: 20px;--mat-toggle-padding: 8px;--mat-toggle-min-width: 44px}.toggle-group--large{--mat-toggle-font-size: 14px;--mat-toggle-line-height: 20px;--mat-toggle-padding: 12px;--mat-toggle-min-width: 48px}.toggle-group--block .mat-button-toggle-group-appearance-standard.mat-button-toggle-group{display:flex;flex-direction:row;justify-content:space-evenly}.toggle-group--block .mat-button-toggle-group-appearance-standard.mat-button-toggle-group .mat-button-toggle{flex:1}\n"],encapsulation:2,changeDetection:0})}return n})();var ub=d(96513),nL=d(40798),hb=function(n){return n.Image="2d",n.Embed="3d",n}(hb||{});let iL=(()=>{class n{set url(t){t&&(this.src=this.sanitizer.bypassSecurityTrustResourceUrl(t))}constructor(t){this.sanitizer=t}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(c.up))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["iframe","appEmbedSrc",""]],hostVars:1,hostBindings:function(o,s){2&o&&e.Mr5("src",s.src,e.f$h)},inputs:{url:"url"}})}return n})();const oL=["embedViewerContainer"],sL=["previewContainer"],aL=["groupContainer"],rL=["embedViewerFrame"],lL=(n,i,t)=>({"embed-viewer--light":n,"embed-viewer--dark":i,"embed-viewer--compact":t}),cL=(n,i,t)=>({"embed-viewer__group--desktop":n,"embed-viewer__group--tablet":i,"embed-viewer__group--mobile":t}),Uc={[fi.Desktop]:{width:1,height:1},[fi.Tablet]:{width:834,height:1194},[fi.Mobile]:{width:414,height:736}};let gb=(()=>{class n{set model(t){if(t){const o=this.store.selectSnapshot(In.getWidgetURL),s=this.store.selectSnapshot(Pe.getUserLanguage),a=this.store.selectSnapshot(We.getSelectedOrganizationProductAccountId);let r=this.publishService.getWidgetURL(t,o,null,null,null,s,null,a);r+="&ui-fadeout=0",this.url=r}}get device(){return this._device}set device(t){this._device=t,this.options&&this.updateViewer(this.options)}get options(){return this._options}set options(t){t&&(this._options=t,this.updateViewer(this.options))}get topOffset(){const o=(this.previewRef.nativeElement.offsetHeight-this.height)/2;return this.scaleFactor<1?o:Math.max(0,o)}get leftOffset(){const o=(this.previewRef.nativeElement.offsetWidth-this.width)/2;return this.scaleFactor<1?o:Math.max(0,o)}get scaleFactor(){if(this.scalable){const{offsetWidth:t,offsetHeight:o}=this.previewRef.nativeElement;let s,a;return this.device===fi.Desktop?(s=this.previewRef.nativeElement.offsetWidth/this.width,a=this.previewRef.nativeElement.offsetHeight/this.height):(s=t/Uc[this.device].width,a=o/Uc[this.device].height),Math.min(s,a,1)}return 1}get scaleFactorPercentage(){return Math.round(100*this.scaleFactor)}get zoomInfoText(){if(this.device===fi.Desktop)return`Displayed at ${this.scaleFactorPercentage}%`;{const{width:t,height:o}=Uc[this.device];return`${K3[this.device]} (${t}x${o} resolution) displayed at ${this.scaleFactorPercentage}%`}}get previewHeight(){return this.containerRef.nativeElement.offsetHeight}get isDesktop(){return this.device===fi.Desktop}get isTablet(){return this.device===fi.Tablet}get isMobile(){return this.device===fi.Mobile}get isThemeLight(){return"light"===this.theme}get isThemeDark(){return"dark"===this.theme}constructor(t,o,s,a,r){this.cameraService=t,this.publishService=o,this.changeDetectorRef=s,this.store=a,this.renderer2=r,this.publishModeEnum=hb,this.theme="light",this.compact=!1,this.scalable=!1,this.labelScale=1,this.allVisibilityLayers=[],this.variantSchemas={},this.cameraUpdated=new e.bkB,this.ngUnsubscribe=new k.B,this.widgetOptionsSubject=new k.B}ngOnInit(){this._apiRef=new HumanAPI({iframeId:this.frameRef.nativeElement.id}),this.initAPIListeners(),this.initQuizAPIListeners(),this.initTutorialListeners(),this.initCameraListeners()}ngAfterViewInit(){this.updateViewer(this.options),(0,Sn.R)(window,"resize").pipe((0,wn.B)(50),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateViewer(this.options)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initAPIListeners(){this.getAPIEvent(Ct.X.HumanReady).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setupCameraTracking(),this.setupCameraRotation(),this.setViewerUIConfig(this.options?.options),this.getModelBackgroundColor().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.defaultBackgroundColor=t,this.setViewerBackground(this.options.backgroundColor||this.defaultBackgroundColor)}),this.getLayers().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.allVisibilityLayers=t,this.changeDetectorRef.markForCheck()}),this.getVariantSchemas().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.variantSchemas=t,this.changeDetectorRef.markForCheck()})})}initQuizAPIListeners(){this.widgetOptionsSubject.asObservable().pipe((0,W.T)(o=>o.uiQuiz),(0,D.p)(o=>!(0,u.isNil)(o))).pipe((0,Tn.F)((o,s)=>(0,u.isEqual)(o,s)),(0,D.p)(()=>!(0,u.isNil)(this._apiRef)),(0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{const{mode:s,number:a}=o,r=s===Rs.Locked;if(r){const _=parseInt(a,10),g=isNaN(_)?1:_,P=isNaN(_)?void 0:_;this._apiRef.send(Ce.QuizReset),this._apiRef.send(Ce.QuizSet,{locked:r,startNumber:g,endNumber:P}),this._apiRef.send(Ce.QuizEnter)}else this._apiRef.send(Ce.QuizSet,{locked:r}),this._apiRef.send(Ce.QuizExit)})}initTutorialListeners(){this.widgetOptionsSubject.asObservable().pipe((0,W.T)(t=>t.uiTutorial),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this._apiRef.send(Ce.UISetTutorial,{enabled:t})})}initCameraListeners(){this.widgetOptionsSubject.asObservable().pipe((0,W.T)(t=>t.loadRotate),(0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this._rotateDegrees=t})}updateViewer(t){this.width=t.dimensions.width,this.height=t.dimensions.height,this.scalable=t.scalable,this.setLabelsEnabled(t.labelsEnabled),this.setLabelScale(t.labelScale),this.setViewerUIConfig(t.options),this.setViewerBackground(this.options.backgroundColor||this.defaultBackgroundColor);const o=t.dimensions.type;this.setDeviceDimensions(o);const s=this.frameRef?.nativeElement;s&&(o===eo.Fixed?this.setFixedDimensions(s):o===eo.Responsive&&this.setResponsiveDimensions(s))}setResponsiveDimensions(t){this.renderer2.removeAttribute(t,"width"),this.renderer2.removeAttribute(t,"height");let o="width",s="height";this.device===fi.Desktop&&this.containerRef.nativeElement.offsetWidth/this.width>=this.containerRef.nativeElement.offsetHeight/this.height&&(o="height",s="width"),this.renderer2.setStyle(t,o,"100%"),this.renderer2.setStyle(t,s,"auto"),this.renderer2.setStyle(t,"aspect-ratio",`${this.width} / ${this.height}`),this.renderer2.setStyle(t,"max-height","100%")}setFixedDimensions(t){this.renderer2.setAttribute(t,"width",`${this.width}`),this.renderer2.setAttribute(t,"height",`${this.height}`),this.renderer2.setStyle(t,"width",`${this.width}px`),this.renderer2.setStyle(t,"height",`${this.height}px`),this.renderer2.setStyle(t,"aspect-ratio","auto")}setDeviceDimensions(t){this.device===fi.Desktop&&t===eo.Fixed?(this.renderer2.setStyle(this.groupContainerRef.nativeElement,"width",`${this.width}px`),this.renderer2.setStyle(this.groupContainerRef.nativeElement,"height",`${this.height}px`),this.renderer2.setStyle(this.groupContainerRef.nativeElement,"left",`${this.leftOffset}px`),this.renderer2.setStyle(this.groupContainerRef.nativeElement,"top",`${this.topOffset}px`)):(this.renderer2.removeStyle(this.groupContainerRef.nativeElement,"width"),this.renderer2.removeStyle(this.groupContainerRef.nativeElement,"height"),this.renderer2.removeStyle(this.groupContainerRef.nativeElement,"left"),this.renderer2.removeStyle(this.groupContainerRef.nativeElement,"top")),this.device!==fi.Desktop&&this.renderer2.setStyle(this.groupContainerRef.nativeElement,"left",(this.previewRef.nativeElement.offsetWidth-Uc[this.device].width*this.scaleFactor)/2+"px"),this.changeDetectorRef.markForCheck()}setViewerUIConfig(t){if(this._apiRef&&t){const o=this.convertWidgetOptionsToDisplayParams(t);this.setUIDisplay(o);const s={enabled:!t.autoLoad},a=(_=t.initial).button?Ki.Button:_.handHint?Ki.Hand:_.play?Ki.Play:_.summary?Ki.Summary:void 0,r=(_=>_.alert?Wo.M.DoNotCaptureShowMessage:_.overlay?Wo.M.DoNotCapture:Wo.M.Capture)(t.disableScroll);this._apiRef.send(Ce.UISetOndemand,s),this._apiRef.send(Ce.UISetLoadingExperience,a),this._apiRef.send(Ce.UISetScrollCaptureMode,r),this.widgetOptionsSubject.next(t)}var _}takeSnapshot(t="jpeg",o){return this.getAPIData(Ce.UISnapshot,{width:this.width,height:this.height,fileType:t,...o})}setCameraOrbit(t){this.sendAPIData(Ce.CameraOrbit,{yaw:t})}setViewerBackground(t){this._apiRef&&t&&this.sendAPIData(Ce.UIPresetBackground,t)}setLabelsEnabled(t){this._apiRef&&this.sendAPIData(t?Ce.LabelsShow:Ce.LabelsHide)}setLabelScale(t){this._apiRef&&this.sendAPIData(Ce.LabelsSetScale,{scale:t})}setupCameraTracking(){this.getCurrentCamera().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setDefaultCamera(t),this.getCameraUpdates().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{this.setUpdateCamera(o)})})}setupCameraRotation(){let t=performance.now();(0,ub.Y)(0,nL.X).pipe((0,D.p)(()=>!!this._rotateDegrees),(0,W.T)(()=>this._rotateDegrees*(performance.now()-t)*.001),(0,is.M)(()=>t=performance.now()),(0,p.Q)(this.ngUnsubscribe)).subscribe(o=>{this.setCameraOrbit(o)})}setDefaultCamera(t){this._defaultCamera=t,this.setUpdateCamera(t)}setUpdateCamera(t){this._currentCamera=t;const s=this.cameraService.areCamerasEqual(this.cameraService.roundCamera(this._defaultCamera,3),this.cameraService.roundCamera(this._currentCamera,3))?null:this._currentCamera;this.cameraUpdated.emit(s)}getAPIEvent(t){return new h.c(o=>{this._apiRef.on(t,s=>{o.next(s)})})}getAPIData(t,o){return new h.c(s=>{this._apiRef.send(t,o,a=>{s.next(a),s.complete()})})}sendAPIData(t,o){this._apiRef.send(t,o)}getCurrentCamera(){return this.getAPIData(Ce.CameraInfo).pipe((0,W.T)(t=>({eye:t.position,look:t.target,up:t.up})))}getModelBackgroundColor(){return this.getAPIData(Ce.UIGetBackground).pipe((0,W.T)(t=>{if(t){const{colors:o,gradientType:s,colorStops:a}=t,[r,_]=o;return{colors:[...r,..._],gradientType:s,colorStops:a}}return null}))}getCameraUpdates(){return this.getAPIEvent(Ct.X.CameraUpdated).pipe((0,W.T)(t=>{const{position:o,target:s,up:a}=t;return{eye:o,look:s,up:a}}))}setUIDisplay(t){this._apiRef.send(Ce.UISetDisplay,t)}getLayers(){return this.getAPIData(Ce.SceneGetLayers)}getVariantSchemas(){return this.getAPIData(Ce.SceneGetVariantSchemas)}convertWidgetOptionsToDisplayParams(t){return{anatomyDescriptions:t.uiAnatomyDescriptions,anatomyPronunciations:t.uiAnatomyPronunciations,anatomyLabels:t.uiAnatomyLabels,audio:t.uiAudio,chapterList:t.uiChapterList,fullscreen:t.uiFullscreen,help:t.uiHelp,info:t.uiInfo,labelList:t.uiLabelList,legend:t.uiLegend,loader:t.uiLoader,media:t.uiMedia,menu:t.uiMenu,nav:t.uiNav,playthrough:t.playthrough,search:t.uiSearch,tools:t.uiTools,undo:t.uiUndo,visibilityLayers:t.uiVisibilityLayers,skinLayers:t.uiSkinLayers,whiteboard:t.uiWhiteboard}}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(go.j),e.rXU(Io),e.rXU(e.gRc),e.rXU(l.il),e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-embed-viewer"]],viewQuery:function(o,s){if(1&o&&(e.GBs(oL,7),e.GBs(sL,7),e.GBs(aL,7),e.GBs(rL,7)),2&o){let a;e.mGM(a=e.lsd())&&(s.containerRef=a.first),e.mGM(a=e.lsd())&&(s.previewRef=a.first),e.mGM(a=e.lsd())&&(s.groupContainerRef=a.first),e.mGM(a=e.lsd())&&(s.frameRef=a.first)}},inputs:{model:"model",url:"url",device:"device",options:"options",theme:"theme",compact:"compact"},outputs:{cameraUpdated:"cameraUpdated"},decls:27,vars:14,consts:[["embedViewerContainer",""],["previewContainer",""],["groupContainer",""],["embedViewerFrame",""],[1,"embed-viewer",3,"ngClass"],[1,"embed-viewer__preview"],[1,"embed-viewer__group",3,"ngClass"],[1,"embed-viewer__group-text","mb-3"],[1,"embed-viewer__group-text","w-1/2","mb-10"],["appEmbedSrc","","allowfullscreen","","id","embed-viewer-frame","data-test","embedViewerFrame",1,"embed-viewer__frame",3,"url"],[1,"embed-viewer__group-text","w-1/2","mt-5","mb-10"],[1,"embed-viewer__group-text","mb-8"],[1,"embed-viewer__group-text","w-1/3","mb-8"],[1,"embed-viewer__group-text","w-66","mb-8"],[1,"embed-viewer__group-text","w-1/3"],[1,"embed-viewer__label"]],template:function(o,s){1&o&&(e.j41(0,"div",4,0)(2,"div",5,1)(4,"div",6,2),e.nrm(6,"div",7)(7,"div",8)(8,"iframe",9,3)(10,"div",10)(11,"div",7)(12,"div",11)(13,"div",7)(14,"div",7)(15,"div",12)(16,"div",7)(17,"div",7)(18,"div",7)(19,"div",13)(20,"div",7)(21,"div",11)(22,"div",7)(23,"div",7)(24,"div",14),e.k0s()(),e.j41(25,"div",15),e.EFF(26),e.k0s()()),2&o&&(e.Y8G("ngClass",e.sMw(6,lL,s.isThemeLight,s.isThemeDark,s.compact)),e.R7$(4),e.xc7("transform","scale("+s.scaleFactor+")"),e.Y8G("ngClass",e.sMw(10,cL,s.isDesktop,s.isTablet,s.isMobile)),e.R7$(4),e.Y8G("url",s.url),e.R7$(18),e.JRh(s.zoomInfoText))},dependencies:[J.YU,iL],styles:[".embed-viewer[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;align-items:center;width:100%;height:100%;position:relative;overflow:hidden}.embed-viewer--dark[_ngcontent-%COMP%]   .embed-viewer__frame[_ngcontent-%COMP%]{outline:1px solid #6c6c6c}.embed-viewer--dark[_ngcontent-%COMP%]   .embed-viewer__label[_ngcontent-%COMP%]{color:#0c1726}.embed-viewer--light[_ngcontent-%COMP%]   .embed-viewer__frame[_ngcontent-%COMP%]{outline:1px solid #d4d9e3}.embed-viewer--light[_ngcontent-%COMP%]   .embed-viewer__label[_ngcontent-%COMP%]{color:#536788}.embed-viewer__preview[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;width:100%}.embed-viewer__group[_ngcontent-%COMP%]{overflow:hidden}.embed-viewer__group--desktop[_ngcontent-%COMP%]{width:100%;height:100%;padding:0;transform-origin:center center;position:relative}.embed-viewer__group--desktop[_ngcontent-%COMP%] > .embed-viewer__group-text[_ngcontent-%COMP%]{display:none}.embed-viewer__group--tablet[_ngcontent-%COMP%]{border:2px solid #d4d9e3;border-radius:4px;width:834px;height:1194px;padding:40px;transform-origin:left top;position:relative}.embed-viewer__group--mobile[_ngcontent-%COMP%]{border:2px solid #d4d9e3;border-radius:4px;width:414px;height:736px;padding:40px 20px;transform-origin:left top;position:relative}.embed-viewer__group-text[_ngcontent-%COMP%]{background-color:#d9d9d9;height:16px;width:100%}.embed-viewer__container[_ngcontent-%COMP%]{position:relative}.embed-viewer__frame[_ngcontent-%COMP%]{display:block;box-shadow:0 0 0 1px #e7eaee;margin-left:auto;margin-right:auto}.embed-viewer__label[_ngcontent-%COMP%]{flex-basis:40px;padding-top:24px;font-size:.75rem;line-height:1rem;text-align:center}.embed-viewer--compact[_ngcontent-%COMP%]   .embed-viewer__label[_ngcontent-%COMP%]{padding-top:12px}"],changeDetection:0})}return n})();var _L=d(45024);const pL=["*"];let mb=(()=>{class n extends zr.Ky{handleToggleClick(){this.toggle()}constructor(t,o,s){super(t,o,s)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(zr.z8,12),e.rXU(e.gRc),e.rXU(_L.zP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-accordion-item"]],inputs:{title:"title"},features:[e.Vt3],ngContentSelectors:pL,decls:8,vars:9,consts:[[1,"accordion-item"],["tabindex","0",1,"accordion-item__header",3,"click"],[1,"accordion-item__title"],[1,"accordion-item__arrow",3,"icon"],[1,"accordion-item__body"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"div",0)(1,"h3")(2,"button",1),e.bIt("click",function(){return s.handleToggleClick()}),e.j41(3,"span",2),e.EFF(4),e.k0s(),e.nrm(5,"app-icon",3),e.k0s()(),e.j41(6,"div",4),e.SdG(7),e.k0s()()),2&o&&(e.AVh("accordion-item--expanded",s.expanded),e.R7$(2),e.BMQ("id","accordion-header-"+s.id)("aria-expanded",s.expanded)("aria-controls","accordion-body-"+s.id),e.R7$(2),e.JRh(s.title),e.R7$(),e.Y8G("icon",s.expanded?"chevron-down":"chevron-right"),e.R7$(),e.BMQ("id","accordion-body-"+s.id)("aria-labelledby","accordion-header-"+s.id))},dependencies:[ut.R],styles:["[_nghost-%COMP%]   .accordion-item[_ngcontent-%COMP%]{border-top:1px solid #d4d9e3}[_nghost-%COMP%]:last-child   .accordion-item[_ngcontent-%COMP%]{border-bottom:1px solid #d4d9e3}.accordion-item__header[_ngcontent-%COMP%]{cursor:pointer;border:none;display:flex;align-items:center;justify-content:space-between;background:none;width:100%;padding:12px 8px}.accordion-item__header[_ngcontent-%COMP%]:hover{background-color:#e7eaee}.accordion-item__title[_ngcontent-%COMP%]{color:#384c6c;font-size:.875rem;line-height:1.25rem;font-weight:500}.accordion-item__arrow[_ngcontent-%COMP%]{width:16px}.accordion-item__body[_ngcontent-%COMP%]{padding:8px 8px 32px;display:none}.accordion-item--expanded[_ngcontent-%COMP%]   .accordion-item__body[_ngcontent-%COMP%]{display:block}"],changeDetection:0})}return n})();const uL=["*"];var fb=function(n){return n.Danger="danger",n.Info="info",n}(fb||{});let hL=(()=>{class n{constructor(){this.type=fb.Info,this.theme="dark"}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-alert"]],inputs:{type:"type",theme:"theme"},ngContentSelectors:uL,decls:2,vars:5,consts:[[1,"app-alert",3,"ngClass"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.k0s()),2&o&&(e.AVh("app-alert--dark","dark"===s.theme)("app-alert--light","light"===s.theme),e.Y8G("ngClass","app-alert--"+s.type))},dependencies:[J.YU],styles:[":host{display:block}.app-alert{border-radius:4px;padding:16px;font-size:.75rem;line-height:1rem}.app-alert--info{background:#2490e926}.app-alert--danger{background:#de353526}.app-alert--light{color:#142136}.app-alert--light a,.app-alert--light a:visited{color:#283853}.app-alert--dark{color:#f8f9fa}.app-alert--dark a,.app-alert--dark a:visited{color:#fff}\n"],encapsulation:2,changeDetection:0})}return n})();var zu=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Wu=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};const gL=["publishOptionsEl"],mL=["embedAccordion"];function fL(n,i){if(1&n&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&n){const t=i.index;e.Y8G("value",t+1),e.R7$(),e.SpI(" ",t+1," ")}}function SL(n,i){if(1&n&&(e.j41(0,"div",72)(1,"mat-radio-group",73)(2,"mat-radio-button",74),e.EFF(3,"All questions"),e.k0s(),e.j41(4,"div",22)(5,"mat-radio-button",75),e.EFF(6,"Single question"),e.k0s(),e.j41(7,"select",76),e.DNE(8,fL,2,2,"option",77),e.k0s()()()()),2&n){const t=e.XpG(2);e.R7$(7),e.BMQ("aria-label","Question Number"),e.R7$(),e.Y8G("ngForOf",t.quizQuestions)}}function bL(n,i){if(1&n&&(e.j41(0,"app-accordion-item",66)(1,"fieldset",67)(2,"mat-checkbox",68),e.EFF(3,"Assessment Mode"),e.k0s(),e.DNE(4,SL,9,2,"div",69),e.k0s(),e.j41(5,"div",70)(6,"a",71),e.EFF(7," Learn more about quizzes in assessment mode "),e.k0s()()()),2&n){const t=e.XpG();e.Y8G("title","Quiz")("expanded",!0),e.R7$(),e.Y8G("formGroup",t.formQuiz),e.R7$(3),e.Y8G("ngIf",t.formQuiz.value.locked)}}function yL(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",87),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleViewerSizeClick(s))}),e.EFF(1),e.k0s()}if(2&n){const t=i.$implicit;e.R7$(),e.SpI(" ",t.title," ")}}function vL(n,i){1&n&&(e.j41(0,"fieldset",88)(1,"legend",89),e.EFF(2,"Viewer Aspect Ratio"),e.k0s(),e.j41(3,"app-form-field",90),e.nrm(4,"input",91),e.j41(5,"div",92),e.EFF(6,"Width ratio"),e.k0s()(),e.j41(7,"span",93),e.EFF(8,":"),e.k0s(),e.j41(9,"app-form-field",90),e.nrm(10,"input",94),e.j41(11,"div",92),e.EFF(12,"Height ratio"),e.k0s()()()),2&n&&(e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.BMQ("aria-label","Width"),e.R7$(5),e.Y8G("isCompact",!0),e.R7$(),e.BMQ("aria-label","Height"))}function EL(n,i){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"button",78,5),e.bIt("menuOpened",function(){e.eBV(t);const s=e.sdS(2),a=e.XpG();return e.Njj(a.handleViewerSizeMenuOpened(s))}),e.j41(3,"div",79)(4,"span"),e.EFF(5),e.k0s(),e.nrm(6,"app-icon",80),e.k0s()(),e.j41(7,"mat-menu",null,6),e.DNE(9,yL,2,1,"button",81),e.k0s(),e.DNE(10,vL,13,4,"fieldset",82),e.j41(11,"app-alert",83)(12,"a",84),e.EFF(13,"Some websites may strip the style attributes"),e.k0s(),e.EFF(14," required for responsive Viewer sizing "),e.k0s(),e.j41(15,"div",85)(16,"a",86),e.EFF(17," Learn more about aspect ratio "),e.k0s()()()}if(2&n){const t=e.sdS(8),o=e.XpG();e.R7$(),e.Y8G("uppercase",!1)("matMenuTriggerFor",t),e.R7$(4),e.JRh(o.selectedAspectRatio.title),e.R7$(4),e.Y8G("ngForOf",o.viewerFixedSizes),e.R7$(),e.Y8G("ngIf",o.isCustomAspectRatioSelected)}}function CL(n,i){if(1&n&&(e.j41(0,"fieldset",98)(1,"app-form-field",99),e.nrm(2,"input",100),e.j41(3,"div",92),e.EFF(4),e.k0s()(),e.j41(5,"span",93),e.EFF(6,"X"),e.k0s(),e.j41(7,"app-form-field",99),e.nrm(8,"input",101),e.j41(9,"div",92),e.EFF(10),e.k0s()()()),2&n){const t=i.ngIf;e.R7$(),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",t.width),e.BMQ("aria-label","Width"),e.R7$(2),e.SpI("Width min. ",t.width,"px"),e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",t.height),e.BMQ("aria-label","Height"),e.R7$(2),e.SpI("Height min. ",t.height,"px")}}function TL(n,i){if(1&n&&(e.j41(0,"div",96),e.DNE(1,CL,11,8,"fieldset",97),e.nI1(2,"async"),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.minDimensions$))}}function OL(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,TL,3,3,"div",95),e.nI1(2,"async"),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.dimensions$))}}function ML(n,i){1&n&&(e.j41(0,"div",102)(1,"app-form-field",103),e.nrm(2,"input",104),e.k0s()()),2&n&&(e.R7$(),e.Y8G("isCompact",!0),e.R7$(),e.BMQ("aria-label","Degree of Rotation"))}function IL(n,i){1&n&&(e.j41(0,"div",105)(1,"mat-checkbox",106),e.EFF(2,' Show "info icon" for description '),e.k0s(),e.j41(3,"mat-checkbox",107),e.EFF(4,' Show "audio icon" for pronunciations '),e.k0s()())}function PL(n,i){1&n&&(e.j41(0,"div",105)(1,"mat-checkbox",108),e.EFF(2,"Show label list in Information Panel"),e.k0s()())}function wL(n,i){1&n&&(e.j41(0,"li")(1,"mat-checkbox",111),e.EFF(2,"Anatomy layers"),e.k0s()())}function AL(n,i){1&n&&(e.j41(0,"li")(1,"mat-checkbox",112),e.EFF(2,"Skin selector"),e.k0s()())}function RL(n,i){if(1&n&&(e.j41(0,"li")(1,"mat-checkbox",109),e.EFF(2,"Customize appearance"),e.k0s(),e.j41(3,"ul",110),e.DNE(4,wL,3,0,"li",51)(5,AL,3,0,"li",51),e.k0s()()),2&n){const t=e.XpG();e.R7$(),e.Y8G("formControl",t.uiLayersEnabled)("indeterminate",t.uiLayersIndeterminate),e.R7$(3),e.Y8G("ngIf",t.hasVisibilityLayers()),e.R7$(),e.Y8G("ngIf",t.hasSkinLayers())}}function NL(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",113),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleEmbedClick())}),e.EFF(1," Reset to Default "),e.k0s()}}function kL(n,i){1&n&&(e.j41(0,"p",118),e.EFF(1," Make this model available to anyone by publishing it to the web. "),e.k0s())}function DL(n,i){1&n&&(e.j41(0,"p",118),e.EFF(1," Your content has been saved to "),e.j41(2,"strong",119),e.EFF(3,"My Library > Private."),e.k0s(),e.nrm(4,"br"),e.EFF(5," Share a direct link or copy the embed code to use on your website. "),e.k0s())}function LL(n,i){if(1&n){const t=e.RV6();e.j41(0,"div"),e.DNE(1,kL,2,0,"p",114)(2,DL,6,0,"p",114),e.j41(3,"div",115)(4,"button",116),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleGenerateIFrame())}),e.EFF(5," Copy embed code "),e.k0s(),e.j41(6,"button",117),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleGenerateURL())}),e.EFF(7," Copy link "),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.model.id===t.modelToPublish.id),e.R7$(),e.Y8G("ngIf",t.model.id!==t.modelToPublish.id),e.R7$(2),e.Y8G("disabled",!t.formEmbed.valid),e.R7$(2),e.Y8G("disabled",!t.formEmbed.valid)}}function UL(n,i){1&n&&(e.j41(0,"p",123),e.EFF(1," Save this model to "),e.j41(2,"strong",119),e.EFF(3,"My Library"),e.k0s(),e.EFF(4," to make it available for anyone, by publishing it to the web. "),e.k0s())}function xL(n,i){1&n&&(e.j41(0,"p",123),e.EFF(1," You can manage this saved model at anytime in "),e.nrm(2,"br"),e.j41(3,"strong",119),e.EFF(4,"My Library > Private > All Models."),e.k0s()())}function jL(n,i){1&n&&e.nrm(0,"app-spinner",124)}function VL(n,i){if(1&n){const t=e.RV6();e.DNE(0,UL,5,0,"p",120),e.nI1(1,"async"),e.DNE(2,xL,5,0,"p",120),e.nI1(3,"async"),e.j41(4,"div",115)(5,"button",121),e.nI1(6,"async"),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleSaveClick())}),e.EFF(7),e.nI1(8,"async"),e.DNE(9,jL,1,0,"app-spinner",122),e.nI1(10,"async"),e.k0s()()}if(2&n){const t=e.XpG();e.Y8G("ngIf",!1===e.bMT(1,5,t.copying$)),e.R7$(2),e.Y8G("ngIf",!0===e.bMT(3,7,t.copying$)),e.R7$(3),e.Y8G("disabled",e.bMT(6,9,t.copying$)),e.R7$(2),e.SpI(" ",!0===e.bMT(8,11,t.copying$)?"Saving to My Library":"Save & Publish"," "),e.R7$(2),e.Y8G("ngIf",e.bMT(10,13,t.copying$))}}class ea{get accordionExpanded(){return!!this.accordionItems&&this.accordionItems.toArray().every(i=>i.expanded)}get rotateEnabled(){return this.formEmbed.get("rotate").value.enabled}get viewerSizeType(){return this.formEmbed.value.viewerSizeType}get widgetOptionsValues(){return this.widgetOptionsGroup.value}get isCustomAspectRatioSelected(){return this.selectedAspectRatio.title===Ng.title}constructor(i,t,o,s,a,r,_,g,P,F,ee){this.store=i,this.actions=t,this.publishService=o,this.storageService=s,this.clipboardService=a,this.dialogService=r,this.storyService=_,this.snackBar=g,this.formBuilder=P,this.changeDetectorRef=F,this.renderer2=ee,this.mediaEnum=Bi,this.viewerSizeTypeEnum=eo,this.viewerFixedSizes=[...X1,Ng],this.selectedAspectRatio=X_,this.quizQuestions=[],this.submit=new k.B,this.requiresSave=!1,this.defaultEmbedFormValues=this.getEmbedFormDefaults(),this.ngUnsubscribe=new k.B,this.defaultWidgetOptions={...new $o,loadRotate:10},this.initEmbedForm()}ngOnInit(){this.model.type===Se.c.Module&&(0,u.isNil)(this.model.module_accessor_level)&&(this.requiresSave=!0),this.initQuizForm(),this.initQuizFormListeners(),this.initActionListeners(),this.setupEmbedForm(),this.initCopy(),this.store.dispatch(new jl(!0))}ngOnDestroy(){this.store.dispatch(new jl(!1)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initCopy(){this.actions.pipe((0,l.xi)(Ie.lN),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleCopySuccess(i)),this.actions.pipe((0,l.xi)(Ie.Cr),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleCopyFailure()),this.submit.pipe((0,wn.B)(100),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>this.onDebouncedSubmit()),this.modelToPublish=this.model}initEmbedForm(){const i=this.getWidgetOptions(),t=this.store.selectSnapshot(In.getDimensions),o=this.store.selectSnapshot(In.getAspectRatio),s=this.store.selectSnapshot(In.getMinDimensions),{button:a,handHint:r,play:_,summary:g}=i.initial,{alert:P,overlay:F}=i.disableScroll;this.formEmbed=this.formBuilder.group({viewerSizeType:this.formBuilder.control(eo.Responsive),dimensions:this.formBuilder.group({width:[t.width,[fe.k0.min(s.width)]],height:[t.height,[fe.k0.min(s.height)]]}),aspectRatio:this.formBuilder.group({width:[o.width,[fe.k0.min(1)]],height:[o.height,[fe.k0.min(1)]]}),options:this.formBuilder.group(i),loader:this.formBuilder.group({enabled:i.uiLoader!==Gi.None,mode:i.uiLoader}),rotate:this.formBuilder.group({enabled:null!==i.loadRotate,value:i.loadRotate}),autoLoad:this.formBuilder.control(i.autoLoad),playthrough:this.formBuilder.control(i.playthrough),initial:this.formBuilder.group({enabled:i.autoLoad&&(a||r||_||g),mode:a?"button":r?"handHint":_?"play":g?"summary":""}),disableScroll:this.formBuilder.group({enabled:P||F,mode:P?"alert":F?"overlay":""})}),this.uiLayersEnabled=new fe.MJ(i.uiSkinLayers||i.uiVisibilityLayers),this.widgetOptionsGroup=this.formEmbed.get("options"),JSON.stringify(this.defaultEmbedFormValues)!==JSON.stringify(this.formEmbed.value)&&this.formEmbed.markAsDirty(),this.widgetEmbedSettings=this.getEmbedPublishOptions(),this.changeDetectorRef.markForCheck()}initQuizForm(){if(this.formQuiz=this.formBuilder.group({locked:[!1],options:this.formBuilder.group({mode:["all"],number:[1]})}),(this.model.tags||[]).includes(As.Quiz)){const{id:o,type:s}=this.model;this.storyService.getStory(o,s).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(a=>{this.quizQuestions=(0,_o.En)(a.chapters),this.changeDetectorRef.markForCheck()})}}initQuizFormListeners(){const i=this.formEmbed.get("options"),t=this.formQuiz.get("locked"),o=this.formQuiz.get("options"),s=o.get("mode"),a=o.get("number");this.formQuiz.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(r=>{let _,g;const{locked:P,options:F}=r;if(P){const{mode:ee,number:le}=F;_=Rs.Locked,g="single"===ee?le:void 0}i.patchValue({uiQuiz:{mode:_,number:g}})}),t.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(r=>{r?o.enable():o.disable()}),a.valueChanges.pipe((0,Tn.F)(),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{!0===t.value&&"single"!==s.value&&s.setValue("single")}),t.setValue(!1)}initActionListeners(){this.actions.pipe((0,l.xi)(xl),(0,ra.q)(i=>this.copyToClipboard(i.url,"url")),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(i?"Successfully copied link to clipboard.":"Unable to copy link to clipboard.")}),this.actions.pipe((0,l.xi)(Ul),(0,ra.q)(i=>this.copyToClipboard(i.embed,"embed")),(0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(i?"Successfully copied embed code to clipboard.":"Unable to copy embed code to clipboard.")}),this.actions.pipe((0,l.xi)(Vg),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Unable to generate embed code.")})}setupEmbedForm(){const i=this.formEmbed.get("options"),t=this.formEmbed.get("dimensions"),o=this.formEmbed.get("loader"),s=this.formEmbed.get("rotate"),a=this.formEmbed.get("initial"),r=this.formEmbed.get("disableScroll"),_=i.get("uiMenu"),g=this.formEmbed.get("autoLoad"),P=this.formEmbed.get("playthrough"),F=o.get("enabled"),ee=o.get("mode");F.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{ee.patchValue(ue?fh:Gi.None)}),ee.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({uiLoader:ue}),ue!==Gi.None&&F.patchValue(!0,{emitEvent:!1})});const le=s.get("enabled"),he=s.get("value");le.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{ue?he.patchValue("number"==typeof he.value?he.value:this.defaultWidgetOptions.loadRotate):i.patchValue({loadRotate:null})}),he.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({loadRotate:ue})}),g.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({autoLoad:ue})}),P.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({playthrough:ue})}),a.get("enabled").valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{a.patchValue({mode:ue?"button":""})}),a.get("mode").valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{a.patchValue({enabled:!!ue},{emitEvent:!1}),i.patchValue({initial:{button:"button"===ue,handHint:"handHint"===ue,play:"play"===ue,summary:"summary"===ue}})}),r.get("enabled").valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{r.patchValue({mode:ue?"alert":""})}),r.get("mode").valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{r.patchValue({enabled:!!ue},{emitEvent:!1}),i.patchValue({disableScroll:{alert:"alert"===ue,overlay:"overlay"===ue}})}),t.valueChanges.pipe((0,wn.B)(300),(0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{this.setScreenDimensions(ue)}),this.dimensions$.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{t.setValue(ue,{emitEvent:!1})}),i.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{this.writeEmbedOptions(ue)}),i.valueChanges.pipe((0,sa.Z)(i.value),(0,Tn.F)((ue,ye)=>(0,u.isEqual)(ue,ye)),(0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{const{uiMenu:ye,uiTools:Ge,uiSearch:Ve,uiVisibilityLayers:it,uiSkinLayers:ot,uiWhiteboard:_t,uiHelp:xt}=ue,$t=[Ge,Ve,_t,xt],hn=[ot,it];this.hasVisibilityLayers()&&$t.push(it),this.hasSkinLayers()&&$t.push(ot);const rn=$t.length,qe=$t.filter(ro=>ro).length,Pt=qe>0&&qe!==rn;0===qe&&ye&&_.setValue(!1,{emitEvent:!1}),Pt&&!ye&&_.setValue(!0,{emitEvent:!1}),this.uiMenuIndeterminate=Pt;const ti=hn.some(ro=>ro),tn=hn.every(ro=>ro);this.uiLayersEnabled.setValue(ti,{emitEvent:!1}),this.uiLayersIndeterminate=ti&&!tn,this.changeDetectorRef.markForCheck()}),this.uiLayersEnabled.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({uiVisibilityLayers:ue,uiSkinLayers:ue})}),_.valueChanges.pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(ue=>{i.patchValue({uiTools:ue,uiSearch:ue,uiVisibilityLayers:ue,uiSkinLayers:ue,uiWhiteboard:ue,uiHelp:ue})}),this.formEmbed.valueChanges.pipe((0,wn.B)(100),(0,Tn.F)((ue,ye)=>(0,u.isEqual)(ue,ye)),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.widgetEmbedSettings=this.getEmbedPublishOptions(),this.changeDetectorRef.markForCheck()})}handleGenerateIFrame(){this.generateIFrameCode()}handleGenerateURL(){this.generateURL()}handleEmbedClick(){this.setEmbedFormDefaults()}handleHideAllEmbedUIClick(){const t={...this.formEmbed.value.options,uiAnatomyLabels:!1,uiInfo:!1,uiAudio:!1,uiMedia:Bi.None,uiNav:!1,uiTools:!1,uiUndo:!1,uiMenu:!1,uiSearch:!1,uiVisibilityLayers:!1,uiSkinLayers:!1,uiWhiteboard:!1,uiFullscreen:!1,uiHelp:!1};this.formEmbed.patchValue({options:t}),this.formEmbed.markAsDirty()}handleViewerSizeMenuOpened(i){const t=this.publishOptionsEl.nativeElement,{offsetWidth:o,clientWidth:s}=t,r=s-(o-s),_=document.querySelector(`#${i.menu.panelId}`);this.renderer2.setStyle(_,"width",`${r}px`),this.renderer2.setStyle(_,"max-width","100vw")}handleToggleAccordionClick(){this.accordionExpanded?this.embedAccordion.closeAll():this.embedAccordion.openAll()}handleViewerSizeClick(i){this.selectedAspectRatio={...i},this.formEmbed.patchValue({aspectRatio:{width:i.dimensions.width,height:i.dimensions.height}})}handleSaveClick(){this.submit.next()}hasVisibilityLayers(){return this.publishWidget.allVisibilityLayers.some(i=>Array.isArray(i)&&i.length>0)}hasSkinLayers(){return!(0,u.isEmpty)(this.publishWidget.variantSchemas.skin)}setScreenDimensions(i){this.store.dispatch(new Z_(i))}generateIFrameCode(){const{options:i,dimensions:t}=this.getEmbedPublishOptions();this.store.dispatch(new ep(this.modelToPublish,i,null,t))}generateURL(){this.store.dispatch(new tp(this.modelToPublish,this.formEmbed.value.options))}handleCopySuccess(i){this.snackBar.open(`"${i.bookmark.title}" saved to your library.`),this.requiresSave=!1,this.modelToPublish=i.bookmark}handleCopyFailure(){this.snackBar.open("There was an error adding to your library")}copyToClipboard(i,t){return this.clipboardService.copyToClipboard(i,t).pipe((0,ra.q)(o=>(0,Rt.of)(o)))}onDebouncedSubmit(){const i=this.model,t={isOwner:!0,id:i?i.id:null,title:i.title},o=this.store.selectSnapshot(Pe.getUserLanguage);this.store.dispatch(new Ie.eW(t.id,t.title,i.type,o))}setEmbedFormDefaults(){this.formEmbed.reset(this.defaultEmbedFormValues),this.formEmbed.markAsPristine(),this.changeDetectorRef.markForCheck()}getEmbedFormDefaults(){const i=new $o,{dimensions:t,aspectRatio:o}=Mu,{button:s,handHint:a,play:r,summary:_}=i.initial,{alert:g,overlay:P}=i.disableScroll;return{viewerSizeType:eo.Responsive,dimensions:{width:t.width,height:t.height},aspectRatio:{width:o.width,height:o.height},options:i,loader:{enabled:i.uiLoader!==Gi.None,mode:i.uiLoader},rotate:{enabled:null!==i.loadRotate,value:i.loadRotate},autoLoad:i.autoLoad,playthrough:i.playthrough,initial:{enabled:i.autoLoad&&(s||a||r||_),mode:s?"button":a?"handHint":r?"play":_?"summary":""},disableScroll:{enabled:g||P,mode:g?"alert":P?"overlay":""}}}getWidgetOptions(){const i=this.readEmbedOptions(),t=this.store.selectSnapshot(We.getWidgetOptions);return i?{...this.publishService.extendWidgetOptions(new $o,i),background:t?t.background:null,uiAudio:this.defaultWidgetOptions.uiAudio}:t||new $o}readEmbedOptions(){!function dL(n,i){const t=localStorage.getItem(It.UT.WidgetOptions);if(null===t)return;const o=JSON.parse(t);if(void 0!==o[n]&&(o[n].timestamp||0)<i){delete o[n];try{localStorage.setItem(It.UT.WidgetOptions,JSON.stringify(o))}catch{}}}(this.getStorageKey(),1573675067505);const o=this.storageService.getLocalJSON(It.UT.WidgetOptions);return o?o[this.getStorageKey()]:null}writeEmbedOptions(i){const t={...i};delete t.uiQuiz;const o={...t,timestamp:Date.now()},s=this.storageService.getLocalJSON(It.UT.WidgetOptions)||{};s[this.getStorageKey()]=o,this.storageService.setLocalItem(It.UT.WidgetOptions,s)}getStorageKey(){return this.store.selectSnapshot(Pe.getUserProfile).eid}getEmbedPublishOptions(){let i;const t=this.formEmbed.get("viewerSizeType").value;i=this.formEmbed.get(t===eo.Fixed?"dimensions":"aspectRatio");const o=this.formEmbed.value.options||{};return{dimensions:{width:i.get("width").value,height:i.get("height").value,type:t},labelsEnabled:!0,labelScale:1,scalable:!0,backgroundColor:null,options:o}}static#e=this.\u0275fac=function(t){return new(t||ea)(e.rXU(l.il),e.rXU(l.En),e.rXU(Io),e.rXU(It.n$),e.rXU(Fr.W),e.rXU(Zs),e.rXU(Pi.J),e.rXU(ui.UG),e.rXU(fe.ze),e.rXU(e.gRc),e.rXU(e.sFG))};static#t=this.\u0275cmp=e.VBU({type:ea,selectors:[["app-publish"]],viewQuery:function(t,o){if(1&t&&(e.GBs(gb,7),e.GBs(gL,5),e.GBs(mL,5,zr.z8),e.GBs(mb,5),e.GBs(un.kk,5)),2&t){let s;e.mGM(s=e.lsd())&&(o.publishWidget=s.first),e.mGM(s=e.lsd())&&(o.publishOptionsEl=s.first),e.mGM(s=e.lsd())&&(o.embedAccordion=s.first),e.mGM(s=e.lsd())&&(o.accordionItems=s),e.mGM(s=e.lsd())&&(o.items=s)}},inputs:{model:"model",device:"device"},decls:112,vars:42,consts:[["publishOptionsEl",""],["embedAccordion","cdkAccordion"],["rotate",""],["saveTemplate",""],["publishWidget",""],["trigger","matMenuTrigger"],["viewerSizes","matMenu"],[1,"publish","theme-light"],[1,"flex","justify-end","mb-3","publish__mode"],["type","button","app-button","","buttonSize","sm","buttonType","text","buttonTheme","light","buttonAlign","left","data-test","publishAccordionButton",1,"text-xs",3,"click","uppercase"],[1,"ml-2",3,"icon"],["data-test","publishOptions",1,"text-xs","publish__options",3,"formGroup"],[3,"multi"],[3,"title","expanded",4,"ngIf"],[3,"title"],[1,"publish__flex-group"],["formControlName","viewerSizeType",1,"flex","flex-row","w-full"],[1,"flex-auto",3,"value"],[1,"flex-auto","mr-2",3,"value"],[1,"mt-2",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"publish__input-group"],[1,"flex","items-center"],["formControlName","autoLoad"],["icon","info-circle","matTooltip","If you uncheck this, your 3D model won't load automatically, but page load time will improve.",1,"ml-2","publish__info-icon"],["formGroupName","rotate",1,"publish__input-group"],["formControlName","enabled"],["class","mb-3 ml-6",4,"ngIf"],["formGroupName","options"],["formControlName","uiTutorial"],["formGroupName","initial",1,"mt-2"],["label","3d Interaction Prompt","theme","light","display","block",3,"isCompact"],["formControlName","mode",1,"input"],["value","button",1,"my-1"],["value","handHint",1,"my-1"],["value","play",1,"my-1"],["value","summary",1,"my-1"],["value","",1,"my-1"],["formGroupName","options",1,"publish__input-group"],["formControlName","uiAnatomyLabels"],["class","ml-6",4,"ngIf"],["formControlName","uiInfo"],["formControlName","uiAudio"],[1,"mt-2"],["label","ANIMATION CONTROLS","theme","light","display","block",3,"isCompact"],["formControlName","uiMedia",1,"mt-1","input"],[3,"value"],["formGroupName","options",1,"flex","flex-col","gap-5"],["label","Upper Left","theme","light","display","block",3,"uppercase","labelElement","isCompact"],["formControlName","uiTools"],["formControlName","uiSearch"],[4,"ngIf"],["formControlName","uiWhiteboard"],["formControlName","uiHelp"],["formControlName","uiUndo"],["label","Bottom right","theme","light","display","block",3,"uppercase","labelElement","isCompact"],["formControlName","uiNav"],["formControlName","uiFullscreen"],[1,"px-2","py-6"],["type","button","app-button","","buttonType","outline","buttonTheme","light",1,"w-full",3,"click"],["type","button","class","w-full mt-3","app-button","","buttonType","outline","buttonTheme","light","data-test","publishResetEmbed",3,"click",4,"ngIf"],["href","https://support.biodigital.com/hc/en-us/articles/225773768-Publish-a-3D-model","target","_blank",1,"underline","text-link"],["data-test","publishActions",1,"publish__actions"],[4,"ngIf","ngIfElse"],[1,"publish__embed"],["theme","light",3,"device","model","options"],[3,"title","expanded"],[3,"formGroup"],["formControlName","locked","data-test","quizLocked"],["class","mt-2 ml-6","formGroupName","options","data-test","quizOptions",4,"ngIf"],[1,"mt-5"],["href","https://support.biodigital.com/hc/en-us/articles/6204568025495-View-Modes-for-3D-quizzes#h_01FR8MPPCA3WTZRHVV17H5AYRF","target","_blank",1,"underline","text-link"],["formGroupName","options","data-test","quizOptions",1,"mt-2","ml-6"],["formControlName","mode",1,"flex","flex-col"],["value","all","data-test","quizOptionsAll"],["value","single","data-test","quizOptionsSingle"],["formControlName","number","data-test","quizOptionsNumber",1,"w-1/3","ml-3","input"],[3,"value",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","buttonAlign","left",1,"w-full","mt-1",3,"menuOpened","uppercase","matMenuTriggerFor"],[1,"flex","flex-row","justify-between"],["icon","caret-down",1,"ml-1"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","items-baseline justify-between mt-3 publish__flex-group","formGroupName","aspectRatio",4,"ngIf"],["type","info","theme","light",1,"flex","mt-4"],["href","https://support.biodigital.com/hc/en-us/articles/9838935675287#h_01GTZYQ3XJY31JH00F5A8C7H4K","target","_blank",1,"underline","text-link"],[1,"pt-4"],["href","https://support.biodigital.com/hc/en-us/articles/9838935675287","target","_blank",1,"underline","text-link"],["mat-menu-item","",3,"click"],["formGroupName","aspectRatio",1,"items-baseline","justify-between","mt-3","publish__flex-group"],[1,"sr-only"],["theme","light","display","block",1,"flex-auto",3,"isCompact"],["type","number","formControlName","width","min","1","appAutoFocus","",1,"w-full","publish__input","input"],["form-field-help",""],[1,"mx-4","text-sm"],["type","number","formControlName","height","min","1",1,"w-full","publish__input","input"],["formGroupName","dimensions","label","Size",4,"ngIf"],["formGroupName","dimensions","label","Size"],["class","items-baseline justify-between publish__flex-group",4,"ngIf"],[1,"items-baseline","justify-between","publish__flex-group"],["theme","light","display","block",1,"w-1/2",3,"isCompact"],["type","number","formControlName","width",1,"w-full","publish__input","input",3,"min"],["type","number","formControlName","height",1,"w-full","publish__input","input",3,"min"],[1,"mb-3","ml-6"],["label","Degree of Rotation","theme","light",3,"isCompact"],["type","number","formControlName","value",1,"w-1/2","publish__input","input"],[1,"ml-6"],["formControlName","uiAnatomyDescriptions"],["formControlName","uiAnatomyPronunciations"],["formControlName","uiLabelList"],[3,"formControl","indeterminate"],[1,"ml-6","publish__input-group"],["formControlName","uiVisibilityLayers"],["formControlName","uiSkinLayers"],["type","button","app-button","","buttonType","outline","buttonTheme","light","data-test","publishResetEmbed",1,"w-full","mt-3",3,"click"],["class","py-2 mt-2 mb-2 text-xs",4,"ngIf"],[1,"publish__actions-content"],["app-button","","buttonType","primary","buttonTheme","light","data-test","copyEmbed3D",1,"w-full",3,"click","disabled"],["app-button","","buttonType","outline","buttonTheme","light","data-test","copyURL3D",1,"w-full",3,"click","disabled"],[1,"py-2","mt-2","mb-2","text-xs"],[1,"font-semibold"],["class","p-2 mt-2 mb-2 text-xs font-light",4,"ngIf"],["app-button","","buttonType","primary","buttonTheme","light","data-test","saveToMyLibrary",1,"w-full",3,"click","disabled"],["size","medium","class","ml-2","render","inline",4,"ngIf"],[1,"p-2","mt-2","mb-2","text-xs","font-light"],["size","medium","render","inline",1,"ml-2"]],template:function(t,o){if(1&t){const s=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"button",9),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleToggleAccordionClick())}),e.EFF(3),e.nrm(4,"app-icon",10),e.k0s()(),e.j41(5,"div",11,0)(7,"cdk-accordion",12,1),e.DNE(9,bL,8,4,"app-accordion-item",13),e.j41(10,"app-accordion-item",14)(11,"div",15)(12,"mat-radio-group",16)(13,"mat-radio-button",17),e.EFF(14,"Responsive"),e.k0s(),e.j41(15,"mat-radio-button",18),e.EFF(16,"Fixed"),e.k0s()()(),e.j41(17,"div",19),e.DNE(18,EL,18,5,"div",20)(19,OL,3,3,"div",20),e.k0s()(),e.j41(20,"app-accordion-item",14)(21,"fieldset",21)(22,"div",22)(23,"mat-checkbox",23),e.EFF(24,"Load 3D model automatically"),e.k0s(),e.nrm(25,"app-icon",24),e.k0s(),e.j41(26,"div",25)(27,"mat-checkbox",26,2),e.EFF(29,"Rotate 3D model on load"),e.k0s(),e.DNE(30,ML,3,2,"div",27),e.k0s(),e.j41(31,"div",28)(32,"mat-checkbox",29),e.EFF(33,"Launch tutorial on load"),e.k0s()(),e.j41(34,"div",30)(35,"app-form-field",31)(36,"select",32)(37,"option",33),e.EFF(38,"Show button"),e.k0s(),e.j41(39,"option",34),e.EFF(40,"Show animated hand"),e.k0s(),e.j41(41,"option",35),e.EFF(42,"Show play button"),e.k0s(),e.j41(43,"option",36),e.EFF(44,"Show summary"),e.k0s(),e.j41(45,"option",37),e.EFF(46,"Do not show prompt"),e.k0s()()()()()(),e.j41(47,"app-accordion-item",14)(48,"fieldset",38)(49,"mat-checkbox",39),e.EFF(50,"Show label when anatomy is selected"),e.k0s(),e.DNE(51,IL,5,0,"div",40),e.k0s()(),e.j41(52,"app-accordion-item",14)(53,"fieldset",38)(54,"mat-checkbox",41),e.EFF(55,"Show Information Panel"),e.k0s(),e.DNE(56,PL,3,0,"div",40),e.k0s()(),e.j41(57,"app-accordion-item",14)(58,"fieldset",38)(59,"mat-checkbox",42),e.EFF(60,"Show audio controls when available"),e.k0s(),e.j41(61,"div",43)(62,"app-form-field",44)(63,"select",45)(64,"option",46),e.EFF(65,"Show all (play/pause button & scrubber)"),e.k0s(),e.j41(66,"option",46),e.EFF(67,"Only show play/pause button"),e.k0s(),e.j41(68,"option",46),e.EFF(69,"Do not show"),e.k0s()()()()()(),e.j41(70,"app-accordion-item",14)(71,"fieldset",47)(72,"app-form-field",48)(73,"ul",21)(74,"li")(75,"mat-checkbox",49),e.EFF(76,"Selection tools (select, hide, fade)"),e.k0s()(),e.j41(77,"li")(78,"mat-checkbox",50),e.EFF(79,"Anatomy search"),e.k0s()(),e.DNE(80,RL,6,4,"li",51),e.j41(81,"li")(82,"mat-checkbox",52),e.EFF(83,"Draw"),e.k0s()(),e.j41(84,"li")(85,"mat-checkbox",53),e.EFF(86,"Help"),e.k0s()(),e.j41(87,"li")(88,"mat-checkbox",54),e.EFF(89,"Undo, redo, reset"),e.k0s()()()(),e.j41(90,"app-form-field",55)(91,"ul",21)(92,"li")(93,"mat-checkbox",56),e.EFF(94,"3D navigation controls"),e.k0s()(),e.j41(95,"li")(96,"mat-checkbox",57),e.EFF(97,"Fullscreen"),e.k0s()()()()()()(),e.j41(98,"div",58)(99,"button",59),e.bIt("click",function(){return e.eBV(s),e.Njj(o.handleHideAllEmbedUIClick())}),e.EFF(100," Hide All UI "),e.k0s(),e.DNE(101,NL,2,0,"button",60),e.k0s(),e.j41(102,"div",58)(103,"a",61),e.EFF(104," Learn about publishing 3D Embeds "),e.k0s()()(),e.j41(105,"div",62),e.DNE(106,LL,8,4,"div",63)(107,VL,11,15,"ng-template",null,3,e.C5r),e.k0s(),e.j41(109,"div",64),e.nrm(110,"app-embed-viewer",65,4),e.k0s()()}if(2&t){const s=e.sdS(8),a=e.sdS(28),r=e.sdS(108);e.R7$(2),e.Y8G("uppercase",!1),e.BMQ("aria-controls",s.id)("aria-expanded",o.accordionExpanded),e.R7$(),e.SpI(" ",o.accordionExpanded?"Collapse all":"Expand all"," "),e.R7$(),e.Y8G("icon",o.accordionExpanded?"minus-square":"plus-square"),e.R7$(),e.Y8G("formGroup",o.formEmbed),e.R7$(2),e.Y8G("multi",!0),e.BMQ("id",s.id),e.R7$(2),e.Y8G("ngIf",o.quizQuestions.length>0),e.R7$(),e.Y8G("title","Viewer Size"),e.R7$(2),e.BMQ("aria-label","Image Size"),e.R7$(),e.Y8G("value",o.viewerSizeTypeEnum.Responsive),e.R7$(2),e.Y8G("value",o.viewerSizeTypeEnum.Fixed),e.R7$(2),e.Y8G("ngSwitch",o.viewerSizeType),e.R7$(),e.Y8G("ngSwitchCase",o.viewerSizeTypeEnum.Responsive),e.R7$(),e.Y8G("ngSwitchCase",o.viewerSizeTypeEnum.Fixed),e.R7$(),e.Y8G("title","Loading Experience"),e.R7$(10),e.Y8G("ngIf",a.checked),e.R7$(5),e.Y8G("isCompact",!0),e.R7$(12),e.Y8G("title","Anatomy Labels"),e.R7$(4),e.Y8G("ngIf",o.widgetOptionsValues.uiAnatomyLabels),e.R7$(),e.Y8G("title","Information Panel"),e.R7$(4),e.Y8G("ngIf",o.widgetOptionsValues.uiInfo),e.R7$(),e.Y8G("title","Media Controls"),e.R7$(5),e.Y8G("isCompact",!0),e.R7$(2),e.Y8G("value",o.mediaEnum.Full),e.R7$(2),e.Y8G("value",o.mediaEnum.Small),e.R7$(2),e.Y8G("value",o.mediaEnum.None),e.R7$(2),e.Y8G("title","Tools"),e.R7$(2),e.Y8G("uppercase",!0)("labelElement",!1)("isCompact",!0),e.R7$(8),e.Y8G("ngIf",o.hasVisibilityLayers()||o.hasSkinLayers()),e.R7$(10),e.Y8G("uppercase",!0)("labelElement",!1)("isCompact",!0),e.R7$(11),e.Y8G("ngIf",o.formEmbed.dirty),e.R7$(5),e.Y8G("ngIf",!o.requiresSave)("ngIfElse",r),e.R7$(4),e.Y8G("device",o.device)("model",o.model)("options",o.widgetEmbedSettings)}},dependencies:[J.Sq,J.bT,J.ux,J.e1,Gs.So,uc.VT,uc._g,un.kk,un.fb,un.Cp,Kt.oV,fe.xH,fe.y7,fe.me,fe.Q0,fe.wz,fe.BC,fe.cb,fe.VZ,fe.l_,fe.j4,fe.JD,fe.$R,hL,Mn.Q,Cf.B,ic,ut.R,Jo.tI,mb,gb,zr.z8,J.Jj],styles:['.publish[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px auto;grid-template-rows:auto 1fr;column-gap:40px;height:100%;grid-template-areas:"mode embed" "options embed" "actions embed"}.publish__mode[_ngcontent-%COMP%]{grid-area:mode}.publish__options[_ngcontent-%COMP%]{grid-area:options;overflow:auto}.publish__screens[_ngcontent-%COMP%]{grid-area:screens;text-align:center}.publish__embed[_ngcontent-%COMP%]{grid-area:embed;background-color:#fff;overflow:auto;margin-top:44px}.publish__actions[_ngcontent-%COMP%]{border-top:1px solid #d4d9e3;position:relative;grid-area:actions}.publish__actions-content[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column;gap:12px}.publish__group[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto;column-gap:8px;align-items:center}.publish__flex-group[_ngcontent-%COMP%]{display:flex}.publish__input[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.publish__picker-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}.publish__input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.publish__info-icon[_ngcontent-%COMP%]{color:#8999b3;font-size:1rem;line-height:1.5rem}'],changeDetection:0})}function FL(n,i){if(1&n&&e.nrm(0,"app-publish",12),2&n){const t=e.XpG();e.Y8G("model",t.bookmark)("device",t.device)}}zu([(0,l.l6)(In.getDimensions),Wu("design:type",h.c)],ea.prototype,"dimensions$",void 0),zu([(0,l.l6)(In.getMinDimensions),Wu("design:type",h.c)],ea.prototype,"minDimensions$",void 0),zu([(0,l.l6)(ft.getCopying),Wu("design:type",h.c)],ea.prototype,"copying$",void 0);let GL=(()=>{class n{get device(){return this.form.value.device}constructor(t,o){this.dialogRef=t,this.deviceTypeEnum=fi,this.form=new fe.gE({device:new fe.MJ(fi.Desktop,[fe.k0.required])}),this.bookmark=o.bookmark}closeDialog(){this.dialogRef.close()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-publish-dialog"]],decls:13,vars:7,consts:[["data-test","publishDialog","role","dialog","aria-modal","true",1,"publish",3,"formGroup"],[1,"publish__header"],[1,"publish__heading"],[1,"flex","justify-center","flex-auto"],["formControlName","device","display","inline","size","medium"],["tooltip","Desktop View","icon","desktop-alt",3,"value"],["tooltip","Tablet View","icon","tablet-alt",3,"value"],["tooltip","Phone View","icon","mobile-alt",3,"value"],[1,"publish__contents"],[3,"model","device",4,"ngIf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"publish__close",3,"click"],["icon","times","size","lg"],[3,"model","device"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3,"Publish"),e.k0s(),e.j41(4,"div",3)(5,"app-toggle-group",4),e.nrm(6,"app-toggle-group-item",5)(7,"app-toggle-group-item",6)(8,"app-toggle-group-item",7),e.k0s()()(),e.j41(9,"div",8),e.DNE(10,FL,1,2,"app-publish",9),e.k0s(),e.j41(11,"button",10),e.bIt("click",function(){return s.closeDialog()}),e.nrm(12,"app-icon",11),e.k0s()()),2&o&&(e.Y8G("formGroup",s.form),e.BMQ("aria-label","Publish"),e.R7$(6),e.Y8G("value",s.deviceTypeEnum.Desktop),e.R7$(),e.Y8G("value",s.deviceTypeEnum.Tablet),e.R7$(),e.Y8G("value",s.deviceTypeEnum.Mobile),e.R7$(2),e.Y8G("ngIf",s.bookmark),e.R7$(),e.BMQ("aria-label","Close"))},dependencies:[J.bT,fe.BC,fe.cb,fe.j4,fe.JD,Mn.Q,ut.R,tL,_b,ea],styles:["a[_ngcontent-%COMP%]{color:#de3535}a[_ngcontent-%COMP%]:hover{color:#c11f1f}.publish[_ngcontent-%COMP%]{position:relative;padding:24px}.publish__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;height:40px}.publish__heading[_ngcontent-%COMP%]{flex:0 1 320px;font-size:1.25rem;line-height:1.75rem;font-weight:600}.publish__contents[_ngcontent-%COMP%]{height:calc(100vh - 216px)}.publish__close[_ngcontent-%COMP%]{position:absolute;top:24px;right:24px;color:#283853}.publish__close[_ngcontent-%COMP%]:hover{color:#142136}"],changeDetection:0})}return n})();var Le=function(n){return n.View="view",n.Edit="edit",n.Manage="manage",n.Publish="publish",n.Delete="delete",n.CopyURL="copyUrl",n.Share="share",n.AddToMyLibrary="addToMyLibrary",n.Duplicate="duplicate",n.SaveFromEdit="saveFromEdit",n.SaveFromView="saveFromView",n}(Le||{});const $L={[Le.View]:"",[Le.AddToMyLibrary]:"plus",[Le.SaveFromView]:"",[Le.SaveFromEdit]:"",[Le.Edit]:"wand-magic-sparkles",[Le.Share]:"share-alt",[Le.Publish]:"code",[Le.CopyURL]:"link",[Le.Duplicate]:"",[Le.Manage]:"",[Le.Delete]:""};function Sb(n){return{[Le.View]:"View",[Le.AddToMyLibrary]:"Save this Model",[Le.SaveFromView]:"Save this Model",[Le.SaveFromEdit]:"Save As",[Le.Edit]:`Customize in ${(0,u.capitalize)(n)}`,[Le.Share]:"Share",[Le.Publish]:"Publish",[Le.CopyURL]:"Copy URL",[Le.Duplicate]:"Duplicate",[Le.Manage]:"Manage",[Le.Delete]:"Delete"}}var BL=d(82798),zL=d(86600);function WL(n,i){if(1&n&&(e.j41(0,"span",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Lme("",t.remainingCount," ",1===t.remainingCount?"character":"characters"," remaining")}}function XL(n,i){if(1&n&&(e.j41(0,"span",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.Lme("",t.count,"/",t.max,"")}}function HL(n,i){if(1&n&&(e.j41(0,"div",1),e.DNE(1,WL,2,2,"span",2)(2,XL,2,2,"span",3),e.k0s()),2&n){const t=e.XpG();e.AVh("counter--inline","inline"===t.display),e.Y8G("ngSwitch",t.mode),e.R7$(),e.Y8G("ngSwitchCase","remaining")}}let QL=(()=>{class n{get remainingCount(){return this.max-this.count}constructor(t){this.ref=t,this.ngUnsubscribe=new k.B,this.display="block",this.mode="count"}ngOnInit(){this.count=0,this.max=this.field.maxLength||0}ngAfterViewInit(){this.getValueChanges().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.updateCount()})}ngAfterContentChecked(){this.updateCount()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateCount(){const t=this.getValue().length;this.count!==t&&(this.count=t,this.ref.markForCheck())}getValueChanges(){return this.field.getValueChanges?this.field.getValueChanges():(0,Sn.R)(this.field,"input")}getValue(){return typeof this.field.textValue<"u"?this.field.textValue:this.field.value}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-character-counter"]],inputs:{field:"field",display:"display",mode:"mode"},decls:1,vars:1,consts:[["class","counter text-2xs pt-1 pb-1",3,"counter--inline","ngSwitch",4,"ngIf"],[1,"counter","text-2xs","pt-1","pb-1",3,"ngSwitch"],["class","counter__label",4,"ngSwitchCase"],["class","counter__label",4,"ngSwitchDefault"],[1,"counter__label"]],template:function(o,s){1&o&&e.DNE(0,HL,3,4,"div",0),2&o&&e.Y8G("ngIf",s.max)},dependencies:[J.bT,J.ux,J.e1,J.fG],styles:[".theme-light[_nghost-%COMP%]   .counter__label[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .counter__label[_ngcontent-%COMP%]{color:#142136}.theme-dark[_nghost-%COMP%]   .counter__label[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .counter__label[_ngcontent-%COMP%]{color:#8999b3}.counter[_ngcontent-%COMP%]{display:block;width:100%;float:right;text-align:right}.counter--inline[_ngcontent-%COMP%]{display:inline-block;width:auto}"]})}return n})();const YL=(n,i)=>i.collection_id;function KL(n,i){if(1&n&&(e.j41(0,"p",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.settings.message," ")}}function qL(n,i){1&n&&(e.j41(0,"mat-error"),e.EFF(1,"Please enter a valid title."),e.k0s())}function JL(n,i){1&n&&(e.j41(0,"app-form-field",13)(1,"mat-select",16)(2,"mat-option",17),e.EFF(3,"Private Library"),e.k0s(),e.j41(4,"mat-option",18),e.EFF(5,"Team Library"),e.k0s()()())}function ZL(n,i){1&n&&(e.j41(0,"app-form-field",14)(1,"mat-select",19)(2,"mat-option",20),e.EFF(3,"View Only"),e.k0s(),e.j41(4,"mat-option",21),e.EFF(5,"View & Edit"),e.k0s()()())}function eU(n,i){if(1&n&&(e.j41(0,"mat-option",23),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.Y8G("value",t.collection_id),e.R7$(),e.JRh(t.collection_name)}}function tU(n,i){if(1&n&&(e.j41(0,"app-form-field",15)(1,"mat-select",22),e.Z7z(2,eU,2,2,"mat-option",23,YL),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(2),e.Dyx(t.collections())}}function nU(n,i){if(1&n&&e.DNE(0,JL,6,0,"app-form-field",13)(1,ZL,6,0,"app-form-field",14)(2,tU,4,0,"app-form-field",15),2&n){let t;const o=e.XpG();e.vxM(o.canEditBookmark()?0:-1),e.R7$(),e.vxM(o.canEditBookmark()&&o.addToTeam()?1:-1),e.R7$(),e.vxM((null==(t=o.collections())?null:t.length)>0&&o.addToTeam()?2:-1)}}function iU(n,i){1&n&&(e.j41(0,"app-form-field",8)(1,"mat-checkbox",24)(2,"span",25),e.EFF(3,"With the BioDigital Community"),e.k0s()()())}function oU(n,i){1&n&&(e.j41(0,"app-message-toggle",28)(1,"span"),e.EFF(2,"Only the following changes will be saved:"),e.k0s(),e.j41(3,"ul",29)(4,"li"),e.EFF(5,"Visibility of structures (hide, fade, isolate)"),e.k0s(),e.j41(6,"li"),e.EFF(7,"Starting position for each chapter"),e.k0s()()())}function sU(n,i){if(1&n&&(e.j41(0,"app-form-field",26)(1,"mat-checkbox",27)(2,"span",25),e.EFF(3,"Include changes to this 3D model"),e.k0s()()(),e.DNE(4,oU,8,0,"app-message-toggle",28)),2&n){const t=e.XpG();e.R7$(4),e.vxM(t.formIncludeViewChanges.value?4:-1)}}function aU(n,i){1&n&&e.nrm(0,"app-spinner",12)}let rU=(()=>{class n{get action(){return this.settings.action}get bookmark(){return this.settings.bookmark}get dialogTitle(){switch(this.action){case Le.Manage:return"Manage";case Le.AddToMyLibrary:return"Save this Model";case Le.Duplicate:return"Duplicate";case Le.SaveFromEdit:return"Save As";case Le.SaveFromView:return"bookmark"===this.bookmark.type?"Save As":"Save this Model"}}get saveWithViewChanges(){return this.action===Le.SaveFromView&&this.formIncludeViewChanges.value}get formTitle(){return this.form.get("title")}get formAddTo(){return this.form.get("addTo")}get formModelPermissions(){return this.form.get("modelPermissions")}get formSelectedCollections(){return this.form.get("selectedCollections")}get formIncludeViewChanges(){return this.form.get("includeViewChanges")}constructor(t,o,s,a,r,_,g,P,F,ee,le){this.store=t,this.formBuilder=o,this.dialogRef=s,this.data=a,this.snackbar=r,this.actions=_,this.organizationsService=g,this.positionsService=P,this.bookmarksService=F,this.storyService=ee,this.vendorAnalyticsService=le,this.userRole=(0,l.Lt)(Pe.getUserRole),this.organization=(0,l.Lt)(We.getOrganization),this.collections=(0,l.Lt)(We.getCollections),this.collectionsLoading=(0,l.Lt)(We.getCollectionsLoading),this.bookmarkSaving=(0,l.Lt)(ft.getSaving),this.bookmarkCopying=(0,l.Lt)(ft.getCopying),this.saving=(0,e.EWP)(()=>{const he=this.bookmarkCopying(),ue=this.bookmarkSaving();return he||ue}),this.form=this.formBuilder.group({title:["",[fe.k0.required,fe.k0.maxLength(60)]],addTo:["",fe.k0.required],modelPermissions:[""],publicAccess:[!1],selectedCollections:[[]],includeViewChanges:[!1]}),this.formValues=(0,je.ot)(this.form.valueChanges.pipe((0,W.T)(()=>this.form.getRawValue()))),this.addToTeam=(0,e.EWP)(()=>{const he=this.formValues();return!!he&&"team"===he.addTo}),this.titleAccessDirty=(0,e.EWP)(()=>{const he=this.formValues();if(!he)return!1;const ue={title:this.initialTitle,addTo:this.initialAddTo,modelPermissions:this.initialModelPermissions,publicAccess:this.initialPublicAccess},{title:ye,addTo:Ge,modelPermissions:Ve,publicAccess:it}=he;return!(0,u.isEqual)(ue,{title:ye,addTo:Ge,modelPermissions:Ve,publicAccess:it})}),this.collectionsDirty=(0,e.EWP)(()=>{const he=this.formValues();return!!he&&!(0,u.isEqual)(this.initialSelectedCollections,he.selectedCollections)}),this.formUnchanged=(0,e.EWP)(()=>{const he=this.titleAccessDirty(),ue=this.collectionsDirty();return!he&&!ue}),this.canAddTeamBookmarks=(0,e.EWP)(()=>{const he=this.userRole(),ue=this.organization();return!(0,u.isNil)(ue)&&Wi(he,Jt.AddTeamBookmarks)}),this.canEditBookmark=(0,e.EWP)(()=>{const he=this.userRole();return this.action===Le.SaveFromEdit||j_(he,this.bookmark)}),this.contentCollectionsMap=new Map,this.contentCollections=(0,e.vPA)([]),this.isGroupModule=!1,this.bookmarkAction=Le,this.ngUnsubscribe=new k.B,this.settings={...a},this.isGroupModule=G_(this.bookmark),this.initFormTitle(),this.initFormAccess(),this.getCollections(),(0,e.QZP)(()=>{this.collections(),this.contentCollections(),this.initFormSelectedCollections()})}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCancelClick(){this.dialogRef.close()}initFormTitle(){let t=this.bookmark.title??"";(this.action===Le.Duplicate||this.action===Le.SaveFromView&&"bookmark"===this.bookmark.type)&&(t=`Copy of ${t}`.slice(0,60)),this.initialTitle=t,this.form.patchValue({title:t}),this.isGroupModule&&this.formTitle.disable()}initFormAccess(){let t,o;const s=this.organization(),a=this.bookmarksService.getOrganizationBookmarkGroup(this.bookmark,s);this.isGroupModule?(t="team",o="view"):this.action===Le.Manage&&a?(t=a.visible?"team":"private",o=a.member_edit?"viewEdit":"view"):(t="private",o="view");const r=!s&&this.bookmark.tags.includes("public");this.initialAddTo=t,this.initialModelPermissions=o,this.initialPublicAccess=r,this.form.patchValue({addTo:t,modelPermissions:o,publicAccess:r}),this.isGroupModule&&(this.formAddTo.disable(),this.formModelPermissions.disable())}getCollections(){var t=this;return(0,pt.A)(function*(){const o=t.organization();if(o&&(t.collections()||t.store.dispatch(new Nl(o.id)),t.action!==Le.SaveFromEdit)){t.formSelectedCollections.disable();const s=yield(0,Ci._)(t.organizationsService.getCollections({group_id:o.id,content_type:t.bookmark.type,content_id:t.bookmark.id,include_content:1}));t.formSelectedCollections.enable(),t.contentCollections.set(s)}})()}initFormSelectedCollections(){const t=[];this.contentCollections().forEach(o=>{const s=o.collection_id;this.contentCollectionsMap.set(s,o.collection_content?.[0]?.collection_content_id??null),t.push(s)}),this.initialSelectedCollections=t,this.form.patchValue({selectedCollections:t})}initSubscriptions(){this.actions.pipe((0,l.xi)(Ie.x$,Ie.lN),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleSaveSuccess(t)}),this.actions.pipe((0,l.xi)(Ie.Ur,Ie.Cr),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleSaveFailure(t)),this.isGroupModule&&(this.actions.pipe((0,l.xi)(Ie.u),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleSaveSuccess(t),this.store.dispatch(new kt.SearchStudio)}),this.actions.pipe((0,l.xi)(Ie.Ny),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleSaveFailure(t))),this.dialogRef.beforeClosed().pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkCancelSave()})}handleSubmit(){const t=this.action===Le.AddToMyLibrary||this.action===Le.Duplicate||this.action===Le.SaveFromView&&!this.formIncludeViewChanges.value,o=this.action===Le.SaveFromEdit||this.saveWithViewChanges,s=this.action===Le.Manage,a=this.getBookmarkEntry();this.vendorAnalyticsService.track("Save Bookmark",{action:this.action,includeChanges:this.formIncludeViewChanges.value}),t?this.copyBookmark(a):o?this.saveBookmark(a):s&&this.manageBookmark(a)}copyBookmark(t){const o=this.canAddTeamBookmarks()&&t.add_group_access[0],s=this.canAddTeamBookmarks()&&t.addCollections;this.store.dispatch(new Ie.eW(t.id,t.title,this.bookmark.type,this.store.selectSnapshot(Pe.getUserLanguage),o,s))}saveBookmark(t){var o=this;return(0,pt.A)(function*(){if(o.isGroupModule)return void o.updateBookmarkCollections(t);let s=!1;o.formIncludeViewChanges.value&&(o.store.dispatch(new Ut.gV(o.store.selectSnapshot(me.N.getSelectedChapterId),o.positionsService.getCamera())),s=!0),o.store.dispatch(new Ie.iy(t,!0,s))})()}manageBookmark(t){var o=this;return(0,pt.A)(function*(){o.isGroupModule?o.updateBookmarkCollections(t):o.store.dispatch(new Ie.iy(t,!1,!1))})()}updateBookmarkCollections(t){this.store.dispatch(new Ie.Pd(this.bookmark,t.addCollections,t.removeCollections))}handleSaveSuccess(t){const o=t.bookmark,s=this.action===Le.Manage?`Your updates to "${o.title}" have been saved to your library.`:`"${o.title}" saved to your library.`;this.action===Le.SaveFromView&&(t instanceof Ie.x$||t instanceof Ie.lN)?this.snackbar.open(s,"Open",{duration:5e3}).onAction().subscribe(()=>{this.storyService.loadNewBookmark(t.bookmark,t.story,!0,0)}):this.snackbar.open(s),this.dialogRef.close(t)}handleSaveFailure(t){let o="";switch(t.constructor){case Ie.Ur:case Ie.Ny:o=`Unable to save bookmark "${this.formTitle}". Please try again.`;break;case Ie.Cr:o="There was an error adding to your library"}this.snackbar.open(o)}getBookmarkEntry(){const t=this.bookmark,o=this.action===Le.SaveFromEdit||this.saveWithViewChanges?null:t.id,s=t.viewMode,{title:a,publicAccess:r}=this.form.value;let _=[],g=[];const P=[],F=new Map;if(this.canAddTeamBookmarks()&&this.canEditBookmark()){const ee=this.createGroupAccess();ee?_=[ee]:g=t?t.group_access:[];const le=new Set(this.formSelectedCollections.value);this.collections().forEach(he=>{const ue=he.collection_id,ye=this.contentCollectionsMap.get(ue),Ge=le.has(ue);this.addToTeam()?((0,u.isNil)(ye)||this.action===Le.Duplicate)&&Ge?P.push(he):!(0,u.isNil)(ye)&&!Ge&&F.set(he,ye):(0,u.isNil)(ye)||F.set(he,ye)})}return{isOwner:!0,id:o,title:a,viewMode:s,addCollections:P,removeCollections:F,add_group_access:_,remove_group_access:g,public_access:r}}createGroupAccess(){const t=this.organization();if(t&&this.addToTeam())return{group_id:t.id,visible:!0,member_edit:"viewEdit"===this.formModelPermissions.value}}checkCancelSave(){this.bookmarkCopying()?this.store.dispatch(new Ie.M):this.bookmarkSaving()&&this.store.dispatch(new Ie.A)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(fe.ok),e.rXU(vt.CP),e.rXU(vt.Vh),e.rXU(ui.UG),e.rXU(l.En),e.rXU(ce),e.rXU(up),e.rXU(Bo),e.rXU(Pi.J),e.rXU(ve))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-save-bookmark-dialog"]],decls:19,vars:11,consts:[["title",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"theme-light",3,"formGroup"],[1,"text-gray-500","text-xs","my-3"],["theme","light","label","Title"],["type","text","name","title","maxlength","60","autocomplete","off","formControlName","title","required","","aria-label","Title","data-test","bookmarkTitleInput",1,"input"],[3,"field"],["theme","light","label","Share"],["mat-dialog-actions",""],["type","button","app-button","","buttonTheme","light",3,"click"],["type","submit","app-button","","buttonType","primary","data-test","saveButton",3,"click","disabled"],["size","medium","render","inline",1,"ml-2"],["theme","light","label","Add To"],["theme","light","label","Model Permissions"],["theme","light","label","Collection (Optional)","data-test","saveCollection"],["hideSingleSelectionIndicator","","formControlName","addTo","aria-label","Add To","data-test","bookmarkAddTo",1,"input","mt-2"],["value","private","data-test","bookmarkAddToPrivate"],["value","team","data-test","bookmarkAddToTeam"],["hideSingleSelectionIndicator","","formControlName","modelPermissions","aria-label","Model Permissions","data-test","bookmarkModelPermissions",1,"input","mt-2"],["value","view","data-test","bookmarkModelPermissionsView"],["value","viewEdit","data-test","bookmarkModelPermissionsViewEdit"],["aria-label","Collection (Optional)","formControlName","selectedCollections","multiple","",1,"input"],["data-test","saveCollectionOption",3,"value"],["formControlName","publicAccess"],[1,"text-xs"],["theme","light"],["formControlName","includeViewChanges"],["type","notification",1,"block","mt-2"],[1,"list-disc","list-inside"]],template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"h1",1),e.EFF(1),e.k0s(),e.j41(2,"div",2)(3,"form",3),e.DNE(4,KL,2,1,"p",4),e.j41(5,"app-form-field",5),e.nrm(6,"input",6,0)(8,"app-character-counter",7),e.DNE(9,qL,2,0,"mat-error"),e.k0s(),e.DNE(10,nU,3,3)(11,iU,4,0,"app-form-field",8)(12,sU,5,1),e.k0s()(),e.j41(13,"div",9)(14,"button",10),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleCancelClick())}),e.EFF(15,"Cancel"),e.k0s(),e.j41(16,"button",11),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleSubmit())}),e.EFF(17),e.DNE(18,aU,1,0,"app-spinner",12),e.k0s()()}if(2&o){const a=e.sdS(7);e.R7$(),e.JRh(s.dialogTitle),e.R7$(2),e.Y8G("formGroup",s.form),e.R7$(),e.vxM(s.settings.message?4:-1),e.R7$(4),e.Y8G("field",a),e.R7$(),e.vxM(s.formTitle.invalid?9:-1),e.R7$(),e.vxM(s.canAddTeamBookmarks()?10:-1),e.R7$(),e.vxM(s.organization()||s.action===s.bookmarkAction.AddToMyLibrary?-1:11),e.R7$(),e.vxM(s.action===s.bookmarkAction.SaveFromView?12:-1),e.R7$(4),e.Y8G("disabled",s.action===s.bookmarkAction.Manage&&s.formUnchanged()||s.collectionsLoading()||s.saving()||s.form.invalid),e.R7$(),e.SpI(" ",s.saving()?"Saving":"Save"," "),e.R7$(),e.vxM(s.saving()?18:-1)}},dependencies:[Gs.So,Gu.TL,BL.VO,zL.wT,vt.BI,vt.E7,vt.Yi,Mn.Q,ic,QL,Jo.tI,Dr,fe.qT,fe.me,fe.BC,fe.cb,fe.YS,fe.tU,fe.j4,fe.JD],changeDetection:0})}return n})();function lU(n,i){if(1&n&&e.nrm(0,"app-icon",3),2&n){const t=e.XpG();e.Y8G("icon",t.icon)}}var bb=function(n){return n.Blue="blue",n.Purple="purple",n.Green="green",n.Gray="gray",n}(bb||{});let cU=(()=>{class n{constructor(){this.label="",this.icon="",this.color=bb.Blue}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-tag"]],inputs:{label:"label",icon:"icon",color:"color"},decls:4,vars:3,consts:[[1,"tag",3,"ngClass"],["class","mr-2",3,"icon",4,"ngIf"],[1,"text-nowrap"],[1,"mr-2",3,"icon"]],template:function(o,s){1&o&&(e.j41(0,"span",0),e.DNE(1,lU,1,1,"app-icon",1),e.j41(2,"span",2),e.EFF(3),e.k0s()()),2&o&&(e.Y8G("ngClass","tag--"+s.color),e.R7$(),e.Y8G("ngIf",s.icon),e.R7$(2),e.JRh(s.label))},dependencies:[J.YU,J.bT,ut.R],styles:[".tag[_ngcontent-%COMP%]{align-items:center;background-color:#2472e9;border-radius:10px;color:#fff;display:inline-flex;font-size:10px;height:20px;padding:0 8px;text-transform:uppercase}.tag--blue[_ngcontent-%COMP%]{background-color:#2472e9}.tag--gray[_ngcontent-%COMP%]{background-color:#384c6c}.tag--green[_ngcontent-%COMP%]{background-color:#3f7d84}.tag--purple[_ngcontent-%COMP%]{background-color:#a855f7}"],changeDetection:0})}return n})();function dU(n,i){if(1&n&&e.nrm(0,"app-tag",11),2&n){const t=e.XpG();e.Y8G("icon",t.content.tagIcon)("label",t.content.tag)}}function _U(n,i){if(1&n&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&n){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.content.description)),e.npT)}}function pU(n,i){if(1&n&&(e.j41(0,"div",13),e.EFF(1," Already a member? "),e.j41(2,"a",14),e.EFF(3,"Sign in"),e.k0s(),e.EFF(4,". "),e.k0s()),2&n){const t=e.XpG();e.R7$(2),e.Y8G("href",t.content.signInUrl,e.B4B)}}function uU(n,i){if(1&n){const t=e.RV6();e.j41(0,"a",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleSecondaryActionClick())}),e.EFF(1),e.k0s()}if(2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.content.secondaryActionText," ")}}function hU(n,i){if(1&n&&(e.j41(0,"div",16),e.nrm(1,"img",17),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("src",t.content.image,e.B4B),e.BMQ("alt",t.content.title)}}let gU=(()=>{class n{constructor(){this.actionClick=new e.bkB,this.secondaryActionClick=new e.bkB}ngOnInit(){}handleActionClick(){this.actionClick.emit()}handleSecondaryActionClick(){this.secondaryActionClick.emit()}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-callout-content"]],inputs:{content:"content",compact:"compact"},outputs:{actionClick:"actionClick",secondaryActionClick:"secondaryActionClick"},decls:14,vars:9,consts:[["data-test","calloutContent",1,"callout","flex","flex-row","items-center"],[1,"callout__content","flex","flex-col","items-start","px-4"],[1,"flex","flex-row","items-center",2,"flex-wrap","wrap"],["data-test","calloutContentTitle",1,"callout__title"],["data-test","calloutContentTag",3,"icon","label",4,"ngIf"],["class","callout__description mt-5 html","data-test","calloutContentDescription",3,"innerHTML",4,"ngIf"],["class","mt-5","data-test","calloutContentSignInUrl",4,"ngIf"],[1,"callout__actions","mt-10"],["type","button","app-button","","buttonTheme","light","buttonType","primary","buttonSize","xl","data-test","calloutContentAction","cdkFocusInitial","",1,"mr-6",3,"click"],["class","text-link text-sm my-4","data-test","calloutContentSecondaryAction",3,"click",4,"ngIf"],["class","callout__image-container flex flex-row items-start justify-between px-4",4,"ngIf"],["data-test","calloutContentTag",3,"icon","label"],["data-test","calloutContentDescription",1,"callout__description","mt-5","html",3,"innerHTML"],["data-test","calloutContentSignInUrl",1,"mt-5"],[1,"text-link","underline",3,"href"],["data-test","calloutContentSecondaryAction",1,"text-link","text-sm","my-4",3,"click"],[1,"callout__image-container","flex","flex-row","items-start","justify-between","px-4"],["data-test","calloutContentImage",1,"callout__image",3,"src"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.j41(5,"div"),e.DNE(6,dU,1,2,"app-tag",4),e.k0s()(),e.DNE(7,_U,3,5,"div",5)(8,pU,5,1,"div",6),e.j41(9,"div",7)(10,"button",8),e.bIt("click",function(){return s.handleActionClick()}),e.EFF(11),e.k0s(),e.DNE(12,uU,2,1,"a",9),e.k0s()(),e.DNE(13,hU,2,2,"div",10),e.k0s()),2&o&&(e.AVh("callout--compact",s.compact),e.R7$(4),e.JRh(s.content.title),e.R7$(2),e.Y8G("ngIf",s.content.tag),e.R7$(),e.Y8G("ngIf",s.content.description),e.R7$(),e.Y8G("ngIf",s.content.signInUrl),e.R7$(3),e.SpI(" ",s.content.actionText," "),e.R7$(),e.Y8G("ngIf",s.content.secondaryActionText),e.R7$(),e.Y8G("ngIf",s.content.image&&!s.compact))},dependencies:[Mn.Q,J.bT,cU,J.Jj,Wn.i0],styles:[".callout[_ngcontent-%COMP%]{background-color:#fff}.callout__content[_ngcontent-%COMP%]{flex:1 1 auto}.callout__title[_ngcontent-%COMP%]{font-size:1.5rem;line-height:2rem;letter-spacing:inherit;color:#0c1726;font-weight:600;margin-right:20px}.callout__description[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem;display:flex;flex-direction:column;gap:24px}.callout__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;flex-flow:wrap}.callout__image-container[_ngcontent-%COMP%]{flex:1;flex-basis:480px;width:100%}.callout__image[_ngcontent-%COMP%]{max-width:480px}.callout--compact[_ngcontent-%COMP%]   .callout__content[_ngcontent-%COMP%]{flex-basis:100%}.callout--compact[_ngcontent-%COMP%]   .callout__title[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;margin-bottom:4px}.callout--compact[_ngcontent-%COMP%]   .callout__description[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;gap:16px}.callout[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"],changeDetection:0})}return n})();class Zr{constructor(i,t,o,s){this.router=i,this.dialogService=t,this.dialogRef=o,this.breakPoints=Qn,this.data=s}handleCloseClick(){this.dialogRef.close(!0)}handleActionClick(){"function"==typeof this.data.actionHandler?(this.data.actionHandler(),this.dialogRef.close()):this.dialogService.openUpgradeDialog(!1)}handleSecondaryActionClick(){this.router.navigate(["/results/bookmarks"]).then(()=>{this.dialogRef.close()})}static#e=this.\u0275fac=function(t){return new(t||Zr)(e.rXU(K.Ix),e.rXU(Zs),e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:Zr,selectors:[["app-premium-access-dialog"]],decls:8,vars:10,consts:[["data-test","premiumAccessDialog",1,"dialog","flex","flex-row","items-start"],[1,"flex","items-center","justify-center","flex-auto"],[1,"dialog__content","flex","flex-row","items-start","justify-center","flex-auto"],[3,"actionClick","secondaryActionClick","content","compact"],["app-button","","buttonType","default","buttonTheme","light","type","button","title","Close","data-test","premiumAccessDialogClose",1,"modal__close",3,"click"],["icon","times","size","lg"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.nI1(1,"async"),e.j41(2,"div",1)(3,"div",2)(4,"app-callout-content",3),e.nI1(5,"async"),e.bIt("actionClick",function(){return o.handleActionClick()})("secondaryActionClick",function(){return o.handleSecondaryActionClick()}),e.k0s()()(),e.j41(6,"button",4),e.bIt("click",function(){return o.handleCloseClick()}),e.nrm(7,"app-icon",5),e.k0s()()),2&t&&(e.AVh("dialog--compact",e.bMT(1,6,o.horizontalBreakpoint$)<=o.breakPoints.Medium),e.BMQ("aria-label","Premium Access"),e.R7$(4),e.Y8G("content",o.data)("compact",e.bMT(5,8,o.horizontalBreakpoint$)<=o.breakPoints.Medium),e.R7$(2),e.BMQ("aria-label","Close"))},dependencies:[Mn.Q,ut.R,gU,J.Jj],styles:[".dialog[_ngcontent-%COMP%]{padding:24px}.dialog__content[_ngcontent-%COMP%]{max-width:1140px}.dialog--compact[_ngcontent-%COMP%]   .dialog__content[_ngcontent-%COMP%]{margin:0}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(Dn.getHorizontalBreakpoint),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],Zr.prototype,"horizontalBreakpoint$",void 0);const SU=n=>({"signup-messaging--compact":n});function bU(n,i){if(1&n&&(e.j41(0,"app-list-item")(1,"div",11),e.nrm(2,"app-icon",12),e.j41(3,"div"),e.EFF(4),e.k0s()()()),2&n){const t=i.$implicit;e.R7$(4),e.JRh(t)}}function yU(n,i){if(1&n&&(e.qex(0),e.EFF(1," Unlock full access to the BioDigital library: "),e.j41(2,"div",8)(3,"app-list",9),e.DNE(4,bU,5,1,"app-list-item",10),e.k0s()(),e.bVm()),2&n){const t=e.XpG();e.R7$(4),e.Y8G("ngForOf",t.features)}}function vU(n,i){1&n&&(e.qex(0),e.EFF(1," Create a free account to explore 1000+ anatomy, physiology, and treatment models in interactive 3D. "),e.bVm())}function EU(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleLearnMoreClick())}),e.EFF(1," Learn More "),e.k0s()}if(2&n){const t=e.XpG();e.Y8G("buttonSize",t.compact?"md":"lg"),e.BMQ("aria-label","Learn More")}}function CU(n,i){if(1&n&&(e.j41(0,"p",14)(1,"a",15),e.EFF(2,"Already have an account? Sign in"),e.k0s()()),2&n){const t=e.XpG();e.R7$(),e.Y8G("queryParams",t.loginUrlParams)}}let TU=(()=>{class n{constructor(t,o){this.activatedRoute=t,this.router=o,this.features=["Complete male and female anatomy","600+ health condition and treatment 3D models","200+ 3D anatomy quizzes","Animated 3D models and virtual 3D tours"],this.compact=!1,this.loginUrlParams={}}ngOnInit(){this.loginUrlParams={returnUrl:this.router.url}}handleSignUpClick(t){this.router.navigate(["/login/create"],{queryParams:{returnUrl:this.router.url,ref:this.activatedRoute.snapshot.queryParams.ref||"share",utm_source:z.c.native?"human_mobile":"human_web",utm_campaign:"share",utm_medium:"PLG"}}),t.stopImmediatePropagation()}handleLearnMoreClick(){window.open(`https://www.biodigital.com?utm_source=${z.c.native?"human_mobile":"human_web"}&utm_medium=PLG&utm_campaign=share&ref=share`)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(K.nX),e.rXU(K.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-signup-messaging"]],inputs:{compact:"compact"},decls:9,vars:9,consts:[[1,"flex","flex-col","items-center","signup-messaging",3,"ngClass"],[1,"signup-messaging__content",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"signup-messaging__actions"],["type","button","app-button","","buttonType","primary","buttonTheme","light","title","Sign Up For Free","data-test","signupMessageButton",3,"click","buttonSize"],["type","button","app-button","","buttonType","outline","buttonTheme","light","title","Learn More",3,"buttonSize","click",4,"ngIf"],["class","signup-messaging__footer",4,"ngIf"],[1,"mt-7"],["listType","flat",1,"mt-2"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","my-1","signup-messaging__list-item"],["icon","check",1,"mr-2"],["type","button","app-button","","buttonType","outline","buttonTheme","light","title","Learn More",3,"click","buttonSize"],[1,"signup-messaging__footer"],["routerLink","/login",1,"signup-messaging__link","link",3,"queryParams"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"p",1),e.DNE(2,yU,5,1,"ng-container",2)(3,vU,2,0,"ng-container",3),e.k0s(),e.j41(4,"div",4)(5,"button",5),e.bIt("click",function(r){return s.handleSignUpClick(r)}),e.EFF(6," Sign Up For Free "),e.k0s(),e.DNE(7,EU,2,2,"button",6),e.k0s(),e.DNE(8,CU,3,1,"p",7),e.k0s()),2&o&&(e.Y8G("ngClass",e.eq3(7,SU,s.compact)),e.R7$(),e.Y8G("ngSwitch",s.compact),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(3),e.Y8G("buttonSize",s.compact?"md":"lg"),e.BMQ("aria-label","Sign Up For Free"),e.R7$(2),e.Y8G("ngIf",!s.compact),e.R7$(),e.Y8G("ngIf",!s.compact))},dependencies:[J.YU,J.Sq,J.bT,J.ux,J.e1,J.fG,K.Wk,Mn.Q,ut.R,hc,gc],styles:[".signup-messaging[_ngcontent-%COMP%]{background-color:#fff}.signup-messaging__content[_ngcontent-%COMP%]{color:#0c1726;font-size:1.25rem;line-height:1.75rem;font-weight:600;max-width:632px;text-align:center}.signup-messaging__list-item[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:400;color:#283853}.signup-messaging__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:32px;margin-top:40px}.signup-messaging__footer[_ngcontent-%COMP%]{color:#283853;font-size:.875rem;line-height:1.25rem;margin-top:28px}.signup-messaging__link[_ngcontent-%COMP%]{text-decoration:underline;color:#283853}.signup-messaging--compact[_ngcontent-%COMP%]{padding:40px 60px;border-radius:8px}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__content[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;text-align:left}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__actions[_ngcontent-%COMP%]{margin-top:28px}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__footer[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}@media (max-width: 959px){.signup-messaging--compact[_ngcontent-%COMP%]{padding:24px}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__list-item[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.signup-messaging--compact[_ngcontent-%COMP%]   .signup-messaging__actions[_ngcontent-%COMP%]{margin-top:20px}}@media (max-width: 480px){.signup-messaging__content[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}.signup-messaging__actions[_ngcontent-%COMP%]{width:80%;flex-direction:column;align-items:stretch;gap:16px;margin-top:28px}}"],changeDetection:0})}return n})(),OU=(()=>{class n{constructor(t,o,s){this.router=t,this.activatedRoute=o,this.dialogRef=s,this.ngUnsubscribe=new k.B}ngOnInit(){this.closeOnLoginPage()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}closeOnLoginPage(){(0,ki.h)(this.activatedRoute.url,this.router.events.pipe((0,D.p)(t=>t instanceof K.wF))).pipe((0,W.T)(()=>this.router.url),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{t.startsWith("/login")&&this.dialogRef.close()})}handleDismissClick(){this.dialogRef.close()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(K.Ix),e.rXU(K.nX),e.rXU(vt.CP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-signup-footer-dialog"]],decls:5,vars:3,consts:[["data-test","signupFooterDialog",1,"signup-footer-dialog","flex","flex-col","items-center"],[1,"signup-footer-dialog__message"],[3,"compact"],["app-button","","buttonType","default","buttonTheme","light","type","button","title","Close",1,"signup-footer-dialog__close",3,"click"],["icon","times","size","lg"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-signup-messaging",2),e.k0s(),e.j41(3,"button",3),e.bIt("click",function(){return s.handleDismissClick()}),e.nrm(4,"app-icon",4),e.k0s()()),2&o&&(e.BMQ("aria-label","Sign Up"),e.R7$(2),e.Y8G("compact",!1),e.R7$(),e.BMQ("aria-label","Close"))},dependencies:[Mn.Q,ut.R,TU],styles:[".signup-footer-dialog[_ngcontent-%COMP%]{padding-top:36px;padding-bottom:36px}.signup-footer-dialog__message[_ngcontent-%COMP%]{max-width:632px}.signup-footer-dialog__close[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px}@media (max-width: 480px){.signup-footer-dialog[_ngcontent-%COMP%]{padding-top:32px;padding-bottom:32px}.signup-footer-dialog__message[_ngcontent-%COMP%]{max-width:320px}}"],changeDetection:0})}return n})(),MU=(()=>{class n{constructor(t){this.dialogService=t}onClick(t){this.dialogService.openContactDialog()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Zs))};static#t=this.\u0275dir=e.FsC({type:n,selectors:[["","appSupportLink",""]],hostBindings:function(o,s){1&o&&e.bIt("click",function(r){return s.onClick(r)})("keydown.enter",function(r){return s.onClick(r)})}})}return n})();function IU(n,i){if(1&n&&(e.j41(0,"div",4),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.label," ")}}function PU(n,i){if(1&n&&(e.j41(0,"app-list-item")(1,"div",5),e.nrm(2,"app-icon",6),e.j41(3,"div"),e.EFF(4),e.k0s()()()),2&n){const t=i.$implicit;e.R7$(4),e.JRh(t)}}const AU=["Gain unlimited access to over 700 anatomy, disease and treatment models","Save unlimited 3D models","Embed models directly into your learning management system, website or application","Improve cross-team collaboration"];let RU=(()=>{class n{constructor(){this.label="Team plans are great for schools or businesses looking to create a collaborative\nexperience for their users. With a team plan, you get:",this.features=AU}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-team-features"]],inputs:{label:"label",features:"features"},decls:4,vars:2,consts:[[1,"feature","text-sm"],["class","mb-4",4,"ngIf"],["listType","flat"],[4,"ngFor","ngForOf"],[1,"mb-4"],[1,"my-1","flex","flex-row"],["icon","check",1,"mr-2"]],template:function(o,s){1&o&&(e.j41(0,"div",0),e.DNE(1,IU,2,1,"div",1),e.j41(2,"app-list",2),e.DNE(3,PU,5,1,"app-list-item",3),e.k0s()()),2&o&&(e.R7$(),e.Y8G("ngIf",s.label),e.R7$(2),e.Y8G("ngForOf",s.features))},dependencies:[J.Sq,J.bT,hc,gc,ut.R],changeDetection:0})}return n})(),kU=(()=>{class n{constructor(t,o,s){this.dialogService=t,this.storageService=o,this.dialogRef=s,this.supportEmail=z.c.supportEmail,this.upgradeLabel="Your 14-day trial has expired and your account now has limited functionality. To regain access to the full power of the BioDigital Human platform, choose the plan that\u2019s perfect for you and:"}ngOnInit(){}handleCancelClick(){this.storageService.setLocalItem(It.UT.TeamTrialExpirationSeen,!0),this.dialogRef.close()}handleChooseClick(){this.storageService.setLocalItem(It.UT.TeamTrialExpirationSeen,!0),this.dialogService.openUpgradeDialog()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Zs),e.rXU(It.n$),e.rXU(vt.CP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-trial-expired-dialog"]],decls:15,vars:2,consts:[[1,"dialog"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close",1,"dialog__close",3,"click"],["icon","times","size","lg"],[1,"dialog__content","flex","flex-col","items-center","justify-center"],[1,"mb-4","text-2xl","font-semibold","text-center"],["src","assets/images/biodigital-multidevice-graphic.jpg",1,"dialog__image"],["app-button","","buttonType","primary",1,"my-4",3,"click"],[1,"my-4"],[3,"label"],[1,"mt-4","text-sm"],["role","button","tabindex","0","appSupportLink","",1,"underline"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"button",1),e.bIt("click",function(){return s.handleCancelClick()}),e.nrm(2,"app-icon",2),e.k0s(),e.j41(3,"div",3)(4,"div",4),e.EFF(5,"Your free trial has ended"),e.k0s(),e.nrm(6,"img",5),e.j41(7,"button",6),e.bIt("click",function(){return s.handleChooseClick()}),e.EFF(8," Upgrade Now "),e.k0s(),e.j41(9,"div",7),e.nrm(10,"app-team-features",8),e.k0s(),e.j41(11,"div",9),e.EFF(12," Need more time for evaluation? "),e.j41(13,"span",10),e.EFF(14,"Contact us"),e.k0s()()()()),2&o&&(e.R7$(),e.BMQ("aria-label","Close"),e.R7$(9),e.Y8G("label",s.upgradeLabel))},dependencies:[Mn.Q,MU,ut.R,RU],styles:[".dialog[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;height:100%;padding:32px;width:90vw;height:90vh}.dialog__close[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px}.dialog__content[_ngcontent-%COMP%]{max-width:520px}.dialog__image[_ngcontent-%COMP%]{width:100%;max-width:360px}@media (max-width: 480px){.dialog[_ngcontent-%COMP%]{width:100vw;height:100vh}}"],changeDetection:0})}return n})();var mn=function(n){return n[n.BookmarkViewThresholdReached=0]="BookmarkViewThresholdReached",n[n.BookmarkViewLimitReached=1]="BookmarkViewLimitReached",n[n.BookmarkSaveThresholdReached=2]="BookmarkSaveThresholdReached",n[n.BookmarkSaveLimitReached=3]="BookmarkSaveLimitReached",n[n.ProAccountPastDue=4]="ProAccountPastDue",n[n.TeamTrailExpired=5]="TeamTrailExpired",n[n.Publish=6]="Publish",n[n.IndividualUploadVideo=7]="IndividualUploadVideo",n[n.ExternalAccountEdit=8]="ExternalAccountEdit",n[n.TeamEditModel=9]="TeamEditModel",n[n.TeamAddModel=10]="TeamAddModel",n[n.TeamPublish=11]="TeamPublish",n}(mn||{});const yb="School & Business Plans Only",DU={[mn.BookmarkViewThresholdReached]:{title:"BookmarkViewThresholdReach",actionText:"Upgrade Now"},[mn.BookmarkViewLimitReached]:{title:"You've reached your 10 free views this month",description:"You can come back next month for another 10 free views or upgrade your plan for unlimited access to 1000+ anatomy, condition, and treatment models.",image:"assets/images/biodigital-human-explore-3d-human-anatomy.jpg",actionText:"Upgrade Now"},[mn.ProAccountPastDue]:{title:"AccountPastDue",actionText:"Upgrade Now"},[mn.BookmarkSaveThresholdReached]:{title:"BookmarkSaveThresholdReached",actionText:"Upgrade Now"},[mn.BookmarkSaveLimitReached]:{title:"You've reached your limit of 5 saved models",description:"In order to save more models on your free plan, you will need to delete models in My Library or upgrade your plan.",image:"assets/images/biodigital-human-3d-model-my-library.jpg",actionText:"Upgrade Now",secondaryActionText:"Go to My Library to delete models"},[mn.TeamTrailExpired]:{title:"TrailExpired",actionText:"Upgrade Now"},[mn.Publish]:{title:"Publish your 3D model",description:"Upgrade to publish to your learning management system, website, or application and make your 3D models available for anyone to view and interact.",image:"assets/images/biodigital-human-publish-custom-3D-model.jpg",tag:yb,tagIcon:"lock",actionText:"Upgrade Now"},[mn.IndividualUploadVideo]:{title:"Add videos to your 3D model",description:"Upgrade your account, and take your content to the next level with video uploads. Plus, get full access to 1,000+ anatomy, condition and treatment models.",image:"assets/images/biodigital-human-upload-videos.jpg",tag:yb,tagIcon:"lock",actionText:"Upgrade Now"},[mn.ExternalAccountEdit]:{title:"Your Human Studio access has expired",actionText:"Contact Support",image:"assets/images/biodigital-human-customize-3D-model-in-studio.jpg"},[mn.TeamEditModel]:{title:"Customize your 3D model",image:"assets/images/biodigital-human-customize-3D-model-in-studio.png",actionText:"Join Team"},[mn.TeamAddModel]:{title:"Add to My Library",image:"assets/images/biodigital-human-3d-model-my-library.jpg",actionText:"Join Team"},[mn.TeamPublish]:{title:"Publish your 3D model",image:"assets/images/biodigital-human-publish-custom-3d-model.png",actionText:"Join Team"}};function LU(n,i,t){return`To let your institution know that you would like to continue using Human Studio, please contact the ${Zi.n3[n]} support team at <a class="text-link underline" target="_blank" href="${vb(n,i,t)}">${Zi.mY[n]}</a>.`}function vb(n,i,t){return(0,Zi.NP)(Zi.mY[n],"Request for Human Studio Access in the BioDigital Human",`Hello,\n  \nI received a notification that access to Human Studio has expired for my team.\n  \nI find Human Studio to be an invaluable resource, and would like my institution, ${i}, to know that I am interested in having our access restored. I would appreciate it if you could notify them on my behalf.\n  \nThanks!\n  \n${t}`)}var xc=function(n){return n.Modal="Modal",n.Footer="Footer",n.Notification="Notification",n}(xc||{});const UU={[mn.BookmarkViewLimitReached]:"View gate",[mn.BookmarkSaveLimitReached]:"Save gate",[mn.Publish]:"Publish gate",[mn.IndividualUploadVideo]:"Individual video upload gate",[mn.ExternalAccountEdit]:"External account edit gate"};let xU=(()=>{class n{constructor(t,o,s,a,r){this.store=t,this.dialog=o,this.vendorAnalyticsService=s,this.productService=a,this.router=r}openPastDue(){this.store.dispatch(new m_(mn.ProAccountPastDue,xc.Notification))}openBookmarkViewWarning(t,o){this.store.dispatch(new m_(mn.BookmarkViewThresholdReached,xc.Footer,{title:`You've viewed **${t} of ${o}** models this month.`,actionText:"Get Unlimited Acccess"}))}openPublicViewGate(){return this.dialog.open(OU,{id:ji.t.PublicViewGateDialog,backdropClass:"bd-dialog-backdrop-alt",panelClass:"bg-dialog-docked",disableClose:!0,data:{}}).afterClosed()}closePublicViewGate(){const t=this.dialog.getDialogById(ji.t.PublicViewGateDialog);t&&t.close()}openBookmarkViewLimit(){return this.openPremiumAccessDialog(mn.BookmarkViewLimitReached,{},!1)}openBookmarkSaveWarning(t,o){this.store.dispatch(new m_(mn.BookmarkSaveThresholdReached,xc.Footer,{title:`You've saved **${t} of ${o}** free models.`,actionText:"Get Unlimited Storage"}))}openBookmarkSaveLimit(){return this.openPremiumAccessDialog(mn.BookmarkSaveLimitReached)}openPublishPaywall(t){const o=t?.data?.organizations??[];if(o.length>0){const s=o?.[0]?.name??"",a=(0,Zi.eu)(t),r=(0,Zi.Iw)(t);return this.openPremiumAccessDialog(mn.TeamPublish,{description:`Join the **${s}** team to generate a direct link to your 3D model or seamlessly embed it into a learning management system or website.`,signInUrl:a,actionText:"Join Team",actionHandler:()=>{this.router.navigateByUrl(r)}})}return this.openPremiumAccessDialog(mn.Publish)}openEditPaywall(t){const s=(t?.data?.organizations??[])?.[0]?.name??"",a=(0,Zi.eu)(t),r=(0,Zi.Iw)(t);return this.openPremiumAccessDialog(mn.TeamEditModel,{description:`Join the **${s}** team to access Human Studio, where you can isolate, label, and paint key structures, build virtual tours and quizzes, and more!`,signInUrl:a,actionText:"Join Team",actionHandler:()=>{this.router.navigateByUrl(r)}})}openAddModelPaywall(t){const s=(t?.data?.organizations??[])?.[0]?.name??"",a=(0,Zi.eu)(t),r=(0,Zi.Iw)(t);return this.openPremiumAccessDialog(mn.TeamAddModel,{description:`Join the **${s}** team to add models to My Library and start collaborating with other members of your institution.`,signInUrl:a,actionText:"Join Team",actionHandler:()=>{this.router.navigateByUrl(r)}})}openVideoUploadGate(){return this.openPremiumAccessDialog(mn.IndividualUploadVideo)}openExternalAccountEditGate(t){const o=this.store.selectSnapshot(We.getOrganization).name,s=this.store.selectSnapshot(Pe.getUserProfile).first_name;return this.openPremiumAccessDialog(mn.ExternalAccountEdit,{description:LU(t,o,s),actionHandler:()=>{const a=document.createElement("a");a.href=vb(t,o,s),a.target="_blank",a.click()}})}openTrialExpired(){return this.dialog.open(kU,{id:ji.t.TrialExpiredDialog,panelClass:"bg-dialog-responsive"}).afterClosed()}openPremiumAccessDialog(t,o={},s=!0){const a={...DU[t],...o};if(this.getOpenPremiumDialogType()===mn.BookmarkViewLimitReached)return(0,Rt.of)(void 0);t===mn.BookmarkViewLimitReached&&this.clearDialogs(),this.vendorAnalyticsService.track(UU[t],{page:this.router.url,platform:this.productService.productKey});const _=this.getPremiumDialogId(t);return this.dialog.open(Zr,{id:_,backdropClass:s?void 0:"bd-dialog-backdrop-headless",panelClass:"bg-dialog-docked",disableClose:!s,data:a}).afterClosed()}clearDialogs(){this.dialog.closeAll()}clearUserNotifications(...t){this.store.dispatch(new V0(t))}getPremiumDialogId(t){return`${ji.t.PremiumAccessDialog}_${t}`}getOpenPremiumDialogType(){return Object.values(mn).find(t=>{const o=this.getPremiumDialogId(t),s=this.dialog.getDialogById(o);return!(0,u.isNil)(s)})}createViewinteractionGate(t,o,s){return this.store.select(me.N.getSelectedChapterModelReady).pipe((0,D.p)(_=>_)).pipe((0,lo.n)(()=>(0,ub.Y)(1e3)),(0,W.T)(_=>1e3*_)).pipe((0,W.T)(_=>_>=t))}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(vt.bZ),e.KVO(ve),e.KVO(De),e.KVO(K.Ix))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Si=function(n){return n[n.Select=0]="Select",n[n.Import=1]="Import",n[n.Explore=2]="Explore",n[n.Check=3]="Check",n}(Si||{});function jU(n,i){1&n&&(e.qex(0),e.nrm(1,"app-spinner",15),e.EFF(2," Deleting "),e.bVm())}function VU(n,i){1&n&&e.EFF(0,"Delete")}let FU=(()=>{class n{constructor(t,o,s,a,r,_){this.store=t,this.actions=o,this.snackBar=s,this.formBuilder=a,this.dialogRef=r,this.data=_,this.settings=(0,e.vPA)({bookmarks:[]}),this.deleting$=new Li.t(!1),this.ngUnsubscribe=new k.B,this.noun=(0,e.EWP)(()=>1===this.settings().bookmarks.length?"model":"models"),this.countedNoun=(0,e.EWP)(()=>`${1===this.settings().bookmarks.length?"":`${this.settings().bookmarks.length} `}${this.noun()}`),this.adjective=(0,e.EWP)(()=>1===this.settings().bookmarks.length?"this":"these"),this.settings.set({...this.settings(),..._})}ngOnInit(){this.initStateListeners(),this.initForm()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initStateListeners(){this.actions.pipe((0,l.xi)(Ie.CF,Ie.CR),(0,p.Q)(this.ngUnsubscribe)).subscribe(()=>{this.deleting$.next(!0)}),this.actions.pipe((0,l.xi)(Ie.te,Ie.DN),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.deleting$.next(!1),this.handleDeleteSuccess(t)}),this.actions.pipe((0,l.xi)(Ie.C$,Ie.Qw),(0,p.Q)(this.ngUnsubscribe)).subscribe(t=>{this.deleting$.next(!1),this.handleDeleteFailure(t)})}initForm(){this.form=this.formBuilder.group({confirm:[!1,fe.k0.requiredTrue]})}handleDeleteSuccess(t){this.dialogRef.close(!0)}handleDeleteFailure(t){this.snackBar.open(`There was an error deleting the ${t.bookmarkIds.length} requested ${this.noun}.`)}handleCancelClick(){this.dialogRef.close(!1)}handleDeleteClick(){const t=this.settings().bookmarks.map(o=>o.id);this.store.dispatch(1===t.length?new Ie.CR(t[0]):new Ie.CF(t))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(l.il),e.rXU(l.En),e.rXU(ui.UG),e.rXU(fe.ze),e.rXU(vt.CP),e.rXU(vt.Vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-delete-bookmarks-dialog"]],decls:39,vars:20,consts:[["defaultTmp",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],[1,"text-sm","theme-light"],[1,"font-bold"],[1,"ml-4","list-disc"],[1,"mt-2"],[1,"mt-6"],["formControlName","confirm"],[2,"white-space","normal"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","buttonType","default",3,"click","disabled"],["app-button","","buttonType","primary",3,"click","disabled"],[4,"ngIf","ngIfElse"],["size","small","render","inline",1,"mr-1"]],template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"h1",1),e.EFF(1),e.nI1(2,"titlecase"),e.k0s(),e.j41(3,"div",2)(4,"div",3)(5,"div",4)(6,"div"),e.EFF(7," Are you sure you want to "),e.j41(8,"em",5),e.EFF(9),e.k0s(),e.EFF(10," from My Library? "),e.j41(11,"ul",6)(12,"li",7),e.EFF(13),e.j41(14,"em",5),e.EFF(15,"Private"),e.k0s(),e.EFF(16," or "),e.j41(17,"em",5),e.EFF(18,"Team"),e.k0s(),e.EFF(19," collections. "),e.k0s(),e.j41(20,"li",7),e.EFF(21," This action "),e.j41(22,"em",5),e.EFF(23,"cannot be undone"),e.k0s(),e.EFF(24),e.k0s()()(),e.j41(25,"div",8)(26,"mat-checkbox",9)(27,"span",10),e.EFF(28),e.k0s()()()()()(),e.j41(29,"div",11)(30,"button",12),e.nI1(31,"async"),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleCancelClick())}),e.EFF(32," Cancel "),e.k0s(),e.j41(33,"button",13),e.nI1(34,"async"),e.bIt("click",function(){return e.eBV(a),e.Njj(s.handleDeleteClick())}),e.DNE(35,jU,3,0,"ng-container",14),e.nI1(36,"async"),e.DNE(37,VU,1,0,"ng-template",null,0,e.C5r),e.k0s()()}if(2&o){const a=e.sdS(38);e.R7$(),e.SpI("Delete ",e.bMT(2,12,s.countedNoun()),""),e.R7$(3),e.Y8G("formGroup",s.form),e.R7$(5),e.Lme("permanently delete ",s.adjective()," ",s.countedNoun(),""),e.R7$(4),e.SpI(" The ",s.noun()," will be no longer be available in your "),e.R7$(11),e.SpI(", and the ",s.noun()," cannot be recovered. "),e.R7$(4),e.Lme("I confirm that I want to permanently delete ",s.adjective()," ",s.countedNoun(),"."),e.R7$(2),e.Y8G("disabled",e.bMT(31,14,s.deleting$)),e.R7$(3),e.Y8G("disabled",s.form.invalid||e.bMT(34,16,s.deleting$)),e.R7$(2),e.Y8G("ngIf",e.bMT(36,18,s.deleting$))("ngIfElse",a)}},dependencies:[J.bT,Gs.So,vt.BI,vt.E7,vt.Yi,Mn.Q,Jo.tI,fe.BC,fe.cb,fe.j4,fe.JD,J.Jj,J.PV],styles:[".dialog[_ngcontent-%COMP%]{max-width:520px}.dialog__list[_ngcontent-%COMP%]{list-style-type:disc;margin:0;padding-left:40px}"],changeDetection:0})}return n})();const GU=[Le.View,Le.Edit],$U=[Le.Edit,Le.Publish];let Xu=(()=>{class n{constructor(t,o,s,a,r,_,g,P,F,ee,le,he,ue){this.store=t,this.publishService=o,this.dialogService=s,this.storageService=a,this.dialog=r,this.snackbar=_,this.router=g,this.bookmarksService=P,this.breakpointObserver=F,this.clipboardService=ee,this.userAccessService=le,this.vendorAnalyticsService=he,this.shareService=ue}getBookmarkActions(t,o,s,a,r){if((0,u.isNil)(o)||this.bookmarksService.isZSpaceModel(o)&&z.c.application!==xn.c.Loft)return[];const _=o.tags||[],g=j_(t,o),P=_.includes("public")&&!g?Se.c.Module:o.type,F=this.getBookmarkShareActions(o,P);let ee=[];switch(P){case Se.c.Module:ee=[Le.AddToMyLibrary,Le.SaveFromView,Le.Edit,...F],G_(o)&&ee.push(Le.Manage);break;case Se.c.Bookmark:ee=[Le.SaveFromView,Le.Edit,...F,Le.Manage,Le.Duplicate,Le.Delete]}ee=ee.filter(ue=>{if(z.c.application===xn.c.Loft&&!GU.includes(ue)||r&&r.excludeActions&&r.excludeActions.includes(ue)||r&&r.includeActions&&!r.includeActions.includes(ue))return!1;switch(ue){case Le.View:return!0;case Le.Edit:return function I1(n){return Wi(n,Jt.EditBookmarks)&&!z.c.native}(t);case Le.Delete:return function Tg(n,i){return!0===i.is_owner}(0,o);case Le.Duplicate:return function N1(n,i){const t=!0===i.is_owner,o=Wi(n,Jt.DuplicateTeamBookmarks);return!(!t&&!o)}(t,o);case Le.AddToMyLibrary:return function k1(n,i){return!kl(i)}(0,o);case Le.SaveFromView:return function D1(n,i,t){if(kl(i))return!1;const s=z.c.application===xn.c.Studio,a=t.startsWith("/view");return s&&a}(0,o,this.router.url);case Le.Manage:return function A1(n,i){return!!Wi(n,Jt.EditBookmarks)&&(!(!0!==i.is_owner&&!G_(i))||!!pa(i)&&Og(n,i))}(t,o);case Le.CopyURL:return Ig(t,0,s,a);case Le.Share:return(a?[Se.c.Module]:[Se.c.Module,Se.c.Bookmark]).includes(o.type);case Le.Publish:return F_(t);default:return!0}});const le=this.breakpointObserver.isMatched("(max-width: 959px)"),he=[Le.Edit,Le.Publish,Le.Manage];return(le||z.c.platform!==Ls.N.Web)&&(ee=ee.filter(ue=>!he.includes(ue))),z.c.native&&(ee=ee.filter(ue=>!$U.includes(ue))),ee}getBookmarkPrimaryActionLabel(t,o){let s="Select";if(o===Si.Select)s="Select";else if(o===Si.Import)s="Import";else{const a=t.viewMode??we.All;let r=t.tour?"View Tour":"View";this.bookmarksService.isZSpaceModel(t)&&this.storageService.getLocalItem(It.UT.ZSpaceDevice)&&(r=`${r} in XR`);let _=t.quiz?"Take Quiz":"";switch(a){case we.Content:_="";break;case we.Quiz:t.quiz&&(r="")}s=r||_}return s}checkBookmarkLimit(){return this.store.selectSnapshot(Pe.isPremiumUser)?(0,Rt.of)({limit_reached:!1}):this.bookmarksService.atMaxFreeBookmarkCount()}isPremiumRestrictedAction(t){const o=this.store.selectSnapshot(Pe.getUserProfile),s=!(0,u.isNil)(o),a=this.store.selectSnapshot(Pe.isPremiumUser),r=this.store.selectSnapshot(We.hasOrganization),_=a&&r;switch(t){case Le.Publish:return!s||!_;case Le.Edit:case Le.AddToMyLibrary:case Le.SaveFromView:return!s;default:return!1}}getBookmarkActionsGrouping(t){return{mainActions:t.slice(0,2),moreActions:t.slice(2)}}handleBookmarkAction(t,o){switch(t){case Le.View:this.view(o);break;case Le.Edit:this.edit(o);break;case Le.Manage:this.openSaveDialog({bookmark:o,action:Le.Manage});break;case Le.Delete:this.delete(o);break;case Le.CopyURL:this.copyURL(o);break;case Le.Duplicate:this.duplicate(o);break;case Le.AddToMyLibrary:this.addToMyLibrary(o);break;case Le.SaveFromEdit:this.saveFromEdit(o);break;case Le.SaveFromView:this.saveFromView(o);break;case Le.Share:this.share(o);break;case Le.Publish:this.publish(o)}}view(t){const{id:o,title:s}=t,a=this.store.selectSnapshot(Pe.getUserLocale).lang,r=this.publishService.isCustomWidget(t.embed_url_path),_=this.bookmarksService.isZSpaceModel(t),g=this.storageService.getLocalItem(It.UT.ZSpaceDevice),P={id:o,lang:a};if(t.unavailable)this.snackbar.open(`Error opening "${s}", it is unavailable.`);else if(r){const F=this.publishService.getWidgetURL(t,t.embed_url,new $o);window.open(F)?this.snackbar.open(`"${s}" loaded in a new tab.`):this.snackbar.open(`Error launching "${s}" in a new tab.`)}else if(_&&g){const F=this.publishService.buildWidgetURL("zspace-viewer",P);window.open(F)}else this.router.navigate(["/view"],{queryParams:P})}publish(t){var o=this;return(0,pt.A)(function*(){if(o.isPremiumRestrictedAction(Le.Publish)){const s=o.store.selectSnapshot(Pe.getProfile);yield(0,Ci._)(o.userAccessService.openPublishPaywall(s))}else o.dialog.open(GL,{width:"90vw",panelClass:"bd-publish-dialog-panel",data:{bookmark:t}})})()}openSaveDialog(t){var o=this;return(0,pt.A)(function*(){const s={id:ji.t.SaveBookmarkDialog,width:"512px",data:t};return o.dialog.closeAll(),(0,Ci._)(o.dialog.open(rU,s).afterClosed())})()}edit(t){var o=this;return(0,pt.A)(function*(){if(o.isPremiumRestrictedAction(Le.Edit)){const a=o.store.selectSnapshot(Pe.getProfile);yield(0,Ci._)(o.userAccessService.openEditPaywall(a))}else!function P1(n){return!1!==n?.human_studio_access}(o.store.selectSnapshot(We.getOrganizationAddOns))?o.userAccessService.openExternalAccountEditGate(Ei.a.WoltersKluwer).pipe((0,qt.s)(1)).subscribe():o.router.navigate(["/edit"],{queryParams:{id:t.id}})})()}copyURL(t){var o=this;return(0,pt.A)(function*(){const s=o.store.selectSnapshot(We.getWidgetOptions)||new $o,a=o.store.selectSnapshot(In.getWidgetURL),r=o.store.selectSnapshot(Pe.getUserLanguage),_=o.store.selectSnapshot(Pe.getSelectedUserApp),g=o.store.selectSnapshot(We.getSelectedOrganizationProductAccountId),P=yield(0,Ci._)(o.publishService.generateWidgetURL(t,a,s,null,ua.Single,r,_,g));(yield(0,Ci._)(o.clipboardService.copyToClipboard(P,"url")))&&o.snackbar.open("Successfully copied link to clipboard."),o.vendorAnalyticsService.track("Publish - Success",{type:"url",source:"bookmark-action"})})()}delete(t){return this.dialog.open(FU,{id:ji.t.BulkDeleteModelDialog,data:{bookmarks:[t]}})}share(t){const o=this.store.selectSnapshot(Pe.getUserLanguage),s=this.shareService.generateShareLink(t,o);return!0===z.c.native||z.c.platform===Ls.N.SDK?(this.clipboardService.nativeShareLink(s),(0,Rt.of)(null)):this.dialogService.openShareDialog(s,"Share","Anyone with the link can view this 3D model. They will need to create an account for full acccess.").afterClosed()}duplicate(t){this.checkBookmarkLimit().subscribe(o=>{o.limit_reached?this.userAccessService.openBookmarkSaveLimit():this.openSaveDialog({bookmark:t,action:Le.Duplicate})})}addToMyLibrary(t){var o=this;return(0,pt.A)(function*(){if(o.isPremiumRestrictedAction(Le.AddToMyLibrary)){const s=o.store.selectSnapshot(Pe.getProfile);yield(0,Ci._)(o.userAccessService.openAddModelPaywall(s))}else o.checkBookmarkLimit().subscribe(function(){var s=(0,pt.A)(function*(a){a.limit_reached?o.userAccessService.openBookmarkSaveLimit():o.openSaveDialog({bookmark:t,action:Le.AddToMyLibrary})});return function(a){return s.apply(this,arguments)}}())})()}saveFromEdit(t){var o=this;return(0,pt.A)(function*(){(yield(0,Ci._)(o.checkBookmarkLimit())).limit_reached?o.userAccessService.openBookmarkSaveLimit():o.openSaveDialog({bookmark:t,action:Le.SaveFromEdit})})()}saveFromView(t){var o=this;return(0,pt.A)(function*(){if(o.isPremiumRestrictedAction(Le.SaveFromView)){const a=o.store.selectSnapshot(Pe.getProfile);yield(0,Ci._)(o.userAccessService.openAddModelPaywall(a))}else(yield(0,Ci._)(o.checkBookmarkLimit())).limit_reached?o.userAccessService.openBookmarkSaveLimit():o.openSaveDialog({bookmark:t,action:Le.SaveFromView})})()}getBookmarkShareActions(t,o){if(o===Se.c.Module){const F=!(0,u.isNil)(t.module_accessor_level);if(F)return[Le.Publish];if(!F&&!0!==t.collection_content)return[Le.Publish,Le.Share]}const s=this.store.selectSnapshot(Pe.getUserRole),a=this.store.selectSnapshot(Pe.isPremiumUser),r=this.store.selectSnapshot(We.hasOrganization),_=[];return F_(s)&&_.push(Le.Publish),Ig(s,0,a,r)&&_.push(Le.CopyURL),!r&&o===Se.c.Bookmark&&_.push(Le.Share),_.length>0?[..._]:[]}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(l.il),e.KVO(Io),e.KVO(Zs),e.KVO(It.n$),e.KVO(vt.bZ),e.KVO(ui.UG),e.KVO(K.Ix),e.KVO(Bo),e.KVO(zd.QP),e.KVO(Fr.W),e.KVO(xU),e.KVO(ve),e.KVO(Bu))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const BU=["iframeEl"],zU=n=>({"quick-view__main--span":n}),WU=n=>({"quick-view__iframe-container--active":n}),XU=n=>({"quick-view__content--hide":n}),HU=n=>({"quick-view__chapters--single":n}),Eb=n=>({"quick-view__thumbnail--active":n}),QU=(n,i)=>({"quick-view__chapter--active":n,"quick-view__chapter--single":i});function YU(n,i){if(1&n&&(e.j41(0,"app-list-item"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.SpI("",t.story.chapters.length," Chapters")}}function KU(n,i){if(1&n&&(e.j41(0,"app-list-item"),e.EFF(1),e.k0s()),2&n){const t=i.$implicit;e.R7$(),e.SpI(" ",t," ")}}function qU(n,i){if(1&n&&(e.j41(0,"app-list",25),e.DNE(1,YU,2,1,"app-list-item",13)(2,KU,2,1,"app-list-item",17),e.k0s()),2&n){const t=e.XpG(2);e.Y8G("dense",!0),e.R7$(),e.Y8G("ngIf",t.story.chapters.length>1),e.R7$(),e.Y8G("ngForOf",t.bookmarkTags)}}function JU(n,i){if(1&n){const t=e.RV6();e.j41(0,"li")(1,"a",26),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.showPreview())}),e.j41(2,"div",27),e.nrm(3,"img",28),e.EFF(4," 3D "),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngClass",e.eq3(1,Eb,t.previewActive))}}function ZU(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",29)(1,"a",30),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.selectChapter(s))}),e.nrm(2,"img",31),e.k0s()()}if(2&n){const t=i.$implicit,o=i.index,s=e.XpG(2);e.Y8G("id","quick-view__thumbnail-"+t.id),e.R7$(),e.Y8G("matTooltip",o+1+" of "+s.story.chapters.length+": "+t.displayName)("ngClass",e.eq3(4,Eb,t.id===s.activeChapter.id&&!s.previewActive)),e.R7$(),e.Y8G("src",s.getImage(t,"small"),e.B4B)}}function e8(n,i){if(1&n&&(e.j41(0,"span",37),e.EFF(1),e.k0s()),2&n){const t=e.XpG().index;e.R7$(),e.SpI("",t+1,". ")}}function t8(n,i){if(1&n&&(e.qex(0),e.j41(1,"span",38),e.EFF(2),e.k0s(),e.bVm()),2&n){const t=e.XpG().$implicit;e.R7$(2),e.Lme("",t.quizQuestions.length," ",(null==t.quizQuestions?null:t.quizQuestions.length)>1?"Questions":"Question","")}}function n8(n,i){if(1&n&&e.nrm(0,"app-html",39),2&n){const t=e.XpG().$implicit;e.Y8G("markdownText",t.description)}}function i8(n,i){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"li",32)(2,"a",33),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.selectChapter(s))}),e.j41(3,"h2",34),e.DNE(4,e8,2,1,"span",35),e.EFF(5),e.k0s(),e.DNE(6,t8,3,2,"ng-container",13),e.k0s(),e.DNE(7,n8,1,1,"app-html",36),e.k0s(),e.bVm()}if(2&n){const t=i.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("id","quick-view__chapter-"+t.id)("ngClass",e.l_i(6,QU,t.id===o.activeChapter.id,1===o.story.chapters.length)),e.R7$(3),e.Y8G("ngIf",o.story.chapters.length>1),e.R7$(),e.SpI("",t.displayName," "),e.R7$(),e.Y8G("ngIf",null==t.quizQuestions?null:t.quizQuestions.length),e.R7$(),e.Y8G("ngIf",t.id===o.activeChapter.id&&t.description.length)}}function o8(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",40),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleBookmarkAction(s))}),e.EFF(1),e.k0s()}if(2&n){const t=i.$implicit,o=e.XpG(2);e.BMQ("data-test","quickViewAction"+o.bookmarkActionsLabels[t]),e.R7$(),e.SpI(" ",o.bookmarkActionsLabels[t]," ")}}function s8(n,i){if(1&n&&(e.j41(0,"button",41),e.nrm(1,"app-icon",42),e.k0s()),2&n){e.XpG();const t=e.sdS(23);e.Y8G("matMenuTriggerFor",t)}}function a8(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",43),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleBookmarkAction(s))}),e.EFF(1),e.k0s()}if(2&n){const t=i.$implicit,o=e.XpG(2);e.BMQ("data-test","quickViewAction"+o.bookmarkActionsLabels[t]),e.R7$(),e.SpI(" ",o.bookmarkActionsLabels[t]," ")}}function r8(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",3)(1,"header",4)(2,"h1",5),e.EFF(3),e.k0s(),e.DNE(4,qU,3,3,"app-list",6),e.k0s(),e.j41(5,"div",7),e.nrm(6,"div",8),e.j41(7,"div",9),e.nrm(8,"iframe",10,0),e.k0s()(),e.j41(10,"nav",11)(11,"ol",12),e.DNE(12,JU,5,3,"li",13)(13,ZU,3,6,"li",14),e.k0s()(),e.j41(14,"div",15)(15,"ol",16),e.DNE(16,i8,8,9,"ng-container",17),e.k0s()(),e.j41(17,"div",18)(18,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handlePrimaryAction())}),e.EFF(19),e.k0s(),e.DNE(20,o8,2,2,"button",20)(21,s8,2,1,"button",21),e.j41(22,"mat-menu",null,1),e.DNE(24,a8,2,2,"button",22),e.k0s()(),e.j41(25,"button",23),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleClose())}),e.nrm(26,"app-icon",24),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(3),e.SpI(" ",t.story.displayName," "),e.R7$(),e.Y8G("ngIf",(null==t.story.chapters?null:t.story.chapters.length)>1||(null==t.bookmarkTags?null:t.bookmarkTags.length)>0),e.R7$(),e.Y8G("ngClass",e.eq3(15,zU,t.previewActive)),e.R7$(),e.xc7("background-image","url("+t.activeImage+")"),e.R7$(),e.Y8G("ngClass",e.eq3(17,WU,t.previewActive)),e.R7$(5),e.Y8G("ngIf",t.previewEnabled),e.R7$(),e.Y8G("ngForOf",t.story.chapters),e.R7$(),e.Y8G("ngClass",e.eq3(19,XU,t.previewActive)),e.R7$(),e.Y8G("ngClass",e.eq3(21,HU,t.story.chapters.length<=1)),e.R7$(),e.Y8G("ngForOf",t.story.chapters),e.R7$(3),e.SpI(" ",t.primaryActionLabel," "),e.R7$(),e.Y8G("ngForOf",t.mainActions),e.R7$(),e.Y8G("ngIf",t.moreActions.length),e.R7$(3),e.Y8G("ngForOf",t.moreActions)}}const l8=Sb(z.c.application);let c8=(()=>{class n{constructor(t,o,s,a,r,_,g,P){this.storyService=t,this.store=o,this.changeRef=s,this.bookmarksService=a,this.bookmarkActionsService=r,this.data=_,this.VIEWER_BASE_URL=g,this.dialogRef=P,this.ngUnsubscribe=new k.B,this.bookmarkAction=Le,this.bookmarkActionsLabels=l8,this.bookmarkTags=[],this.previewActive=!1,this.previewEnabled=!1,this.actionMode=Si.Explore,this.mainActions=[],this.moreActions=[],this.bookmark=this.data.bookmark,this.actionMode=this.data.actionMode??Si.Explore}ngOnInit(){this.loadStory(this.bookmark),this.primaryActionLabel=this.bookmarkActionsService.getBookmarkPrimaryActionLabel(this.bookmark,this.actionMode),this.setBookmarkActions(this.bookmark),this.setTags(this.bookmark),this.setPreviewEnabled()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}loadStory(t){const o=this.store.selectSnapshot(Pe.getUserLanguage);this.storyService.getStory(t.id,t.type,o).pipe((0,qt.s)(1)).subscribe(s=>{this.story=s,this.selectChapter(s.chapters[0]),this.preloadImages(this.story),this.changeRef.markForCheck()}),this.changeRef.markForCheck()}selectChapter(t){this.previewActive=!1,this.activeChapter=t,this.activeImage=this.getImage(t),setTimeout(()=>{this.scrollChapterIntoView(t)})}showPreview(){if(this.previewActive=!0,!this.iframeRef.nativeElement.src){const o=this.store.selectSnapshot(Pe.getUserLanguage);this.iframeRef.nativeElement.src=`${this.VIEWER_BASE_URL}/?id=${this.bookmark.id}&lang=${o}&ui-all=false&ui-tour=true&ui-info=true&ui-loader=circle&ui-layout=drawer`}}getImage(t,o="large"){const s=this.bookmark;return(0,u.isNil)(t.thumbnails)?Fo.generateLegacyThumbnail(s.id,t.id)[o]:t.thumbnails[o]}preloadImages(t){t.chapters.forEach(o=>{(new Image).src=this.getImage(o)})}setBookmarkActions(t){if(this.actionMode===Si.Explore){const[o,s,a]=[this.store.selectSnapshot(Pe.getUserRole),this.store.selectSnapshot(Pe.isPremiumUser),this.store.selectSnapshot(We.hasOrganization)],r=this.bookmarkActionsService.getBookmarkActions(o,t,s,a,{excludeActions:[Le.View]}),{mainActions:_,moreActions:g}=this.bookmarkActionsService.getBookmarkActionsGrouping(r);this.mainActions=_,this.moreActions=g}}setTags(t){this.bookmarkTags=this.bookmarksService.getTags(t)}setPreviewEnabled(){const t=this.store.selectSnapshot(Pe.isPremiumUser),o=this.store.selectSnapshot(We.isValidPaidSubscription),s=this.store.selectSnapshot(We.isTrial),a=this.store.selectSnapshot(We.isSubscriptionExpired);this.previewEnabled=t||o||s&&!a}handlePrimaryAction(){this.actionMode===Si.Explore?(this.bookmarkActionsService.handleBookmarkAction(Le.View,this.bookmark),this.dialogRef.close()):this.dialogRef.close({selected:this.bookmark})}handleBookmarkAction(t){this.bookmarkActionsService.handleBookmarkAction(t,this.bookmark),this.dialogRef.close()}handleClose(){this.dialogRef.close()}scrollChapterIntoView(t){[document.getElementById(`quick-view__chapter-${t.id}`),document.getElementById(`quick-view__thumbnail-${t.id}`)].forEach(a=>{(0,ya.uK)()&&a&&a.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Pi.J),e.rXU(l.il),e.rXU(e.gRc),e.rXU(Bo),e.rXU(Xu),e.rXU(vt.Vh),e.rXU(K_),e.rXU(vt.CP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-quick-view"]],viewQuery:function(o,s){if(1&o&&e.GBs(BU,5),2&o){let a;e.mGM(a=e.lsd())&&(s.iframeRef=a.first)}},decls:1,vars:1,consts:[["iframeEl",""],["moreActionsMenu","matMenu"],["class","quick-view","data-test","quick-view","role","dialog","aria-modal","true",4,"ngIf"],["data-test","quick-view","role","dialog","aria-modal","true",1,"quick-view"],[1,"quick-view__header"],[1,"quick-view__title"],["class","quick-view__metadata","listType","bulleted",3,"dense",4,"ngIf"],[1,"quick-view__main",3,"ngClass"],[1,"quick-view__main-image"],[1,"quick-view__iframe-container",3,"ngClass"],[1,"quick-view__iframe"],[1,"quick-view__thumbnails"],[1,"quick-view__thumbnail-container"],[4,"ngIf"],[3,"id",4,"ngFor","ngForOf"],[1,"quick-view__content",3,"ngClass"],[1,"quick-view__chapters",3,"ngClass"],[4,"ngFor","ngForOf"],[1,"quick-view__actions"],["app-button","","buttonType","primary","data-test","quickViewActionPrimary",1,"w-full",3,"click"],["app-button","","buttonTheme","light","buttonType","outline","class","grow",3,"click",4,"ngFor","ngForOf"],["app-button","","buttonTheme","light","buttonType","outline","data-test","quickViewActionMore",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["app-button","","buttonType","text","buttonTheme","light","type","button","title","Close","aria-label","Close",1,"quick-view__close",3,"click"],["icon","times","size","lg"],["listType","bulleted",1,"quick-view__metadata",3,"dense"],["aria-label","Preview model","data-test","quickViewActionPreview",1,"quick-view__thumbnail","quick-view__thumbnail--text",3,"click","ngClass"],[1,"quick-view__toggle-3d"],["src","/assets/images/cube-regular.svg","alt","",2,"height","14px","width","14px"],[3,"id"],["data-test","quickViewActionChapterThumbnail",1,"quick-view__thumbnail",3,"click","matTooltip","ngClass"],[3,"src"],[1,"quick-view__chapter",3,"id","ngClass"],["data-test","quickViewActionChapterTitle",1,"quick-view__chapter-title",3,"click"],[1,"grow"],["class","quick-view__chapter-number",4,"ngIf"],["class","quick-view__chapter-content",3,"markdownText",4,"ngIf"],[1,"quick-view__chapter-number"],[1,"quick-view__metadata","pr"],[1,"quick-view__chapter-content",3,"markdownText"],["app-button","","buttonTheme","light","buttonType","outline",1,"grow",3,"click"],["app-button","","buttonTheme","light","buttonType","outline","data-test","quickViewActionMore",3,"matMenuTriggerFor"],["icon","ellipsis-vertical"],["mat-menu-item","",3,"click"]],template:function(o,s){1&o&&e.DNE(0,r8,27,23,"div",2),2&o&&e.Y8G("ngIf",s.story)},dependencies:[Mn.Q,J.YU,J.Sq,J.bT,hc,gc,un.kk,un.fb,un.Cp,Kt.oV,ut.R,Ko.V],styles:[".quick-view[_ngcontent-%COMP%]{--thumbnail-size: 64px;color:#0c1726;max-width:1024px;max-height:600px;height:100%;display:grid;grid-template:auto 380px auto/400px 400px;gap:16px 24px;padding:32px;position:relative}.quick-view__header[_ngcontent-%COMP%]{grid-row:1;grid-column:1/span 2;display:flex;flex-direction:column;gap:4px;width:100%}.quick-view__main[_ngcontent-%COMP%]{grid-row:2;grid-column:1;overflow:hidden;position:relative}.quick-view__main--span[_ngcontent-%COMP%]{grid-column:1/span 2;width:auto}.quick-view__thumbnails[_ngcontent-%COMP%]{grid-row:3;grid-column:1;overflow:hidden}.quick-view__content[_ngcontent-%COMP%]{grid-row:2;grid-column:2;overflow:hidden;display:flex;flex-direction:column}.quick-view__content--hide[_ngcontent-%COMP%]{display:none}.quick-view__actions[_ngcontent-%COMP%]{grid-row:3;grid-column:2;display:flex;gap:8px;flex-wrap:wrap}.quick-view__title[_ngcontent-%COMP%]{font-weight:600;font-size:1.25rem;line-height:1.75rem}.quick-view__main-image[_ngcontent-%COMP%]{background:#e7eaee url(/assets/images/logo-dark-transparent.svg) center center no-repeat;background-size:cover;border-radius:4px;inset:0;position:absolute}.quick-view__thumbnail-container[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%;display:flex;gap:8px;padding-bottom:16px}.quick-view__thumbnail[_ngcontent-%COMP%]{background:#0c1726;border:2px solid #d4d9e3;border-radius:4px;display:inline-flex;justify-content:center;align-items:center;overflow:hidden;opacity:.6;transition:all .25s ease-out;width:var(--thumbnail-size);height:var(--thumbnail-size);color:#fff;cursor:pointer}.quick-view__thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:var(--thumbnail-size);height:var(--thumbnail-size)}.quick-view__thumbnail[_ngcontent-%COMP%]:hover{opacity:1}.quick-view__thumbnail--active[_ngcontent-%COMP%]{opacity:1;border-color:#2472e9}.quick-view__thumbnail--text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.quick-view__toggle-3d[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:var(--thumbnail-size);width:var(--thumbnail-size);background:#fff;color:#0c1726;font-size:12px;gap:4px}.quick-view__iframe-container[_ngcontent-%COMP%]{position:absolute;overflow:hidden;width:100%;top:0;bottom:0;background-color:#0c1726;visibility:hidden;pointer-events:none}.quick-view__iframe-container--active[_ngcontent-%COMP%]{visibility:visible;pointer-events:all}.quick-view__iframe[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%}.quick-view__chapters[_ngcontent-%COMP%]{list-style:none;overflow-y:auto;position:relative}.quick-view__chapters--single[_ngcontent-%COMP%]{list-style:none}.quick-view__chapter[_ngcontent-%COMP%]{background-color:#fff;font-size:12px}.quick-view__chapter--active[_ngcontent-%COMP%]:not(.quick-view__chapter--single)   .quick-view__chapter-title[_ngcontent-%COMP%]{background-color:#f2f5fb}.quick-view__chapter--active[_ngcontent-%COMP%]   .quick-view__chapter-content[_ngcontent-%COMP%]{height:auto}.quick-view__chapter--active[_ngcontent-%COMP%] + .quick-view__chapter[_ngcontent-%COMP%]{position:sticky;bottom:0}.quick-view__chapter-title[_ngcontent-%COMP%]{border-radius:4px;cursor:pointer;display:flex;align-items:center;padding:8px;font-weight:600;gap:12px;font-size:.875rem;line-height:1.25rem;transition:all .15s ease-out}.quick-view__chapter-title[_ngcontent-%COMP%]:hover{background-color:#f2f5fb}.quick-view__chapter-number[_ngcontent-%COMP%]{font-weight:400}.quick-view__chapter-content[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;overflow-wrap:break-word;color:#384c6c;display:block;height:0;overflow:hidden;padding:8px 20px 24px 24px;transition:all .25s ease-out}.quick-view__metadata[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:500;color:#8999b3;display:block;white-space:nowrap}.quick-view__close[_ngcontent-%COMP%]{position:absolute;right:32px;top:32px}"],changeDetection:0})}return n})();function d8(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",3),e.bIt("menuOpened",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleMenuOpened())})("menuClosed",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.handleMenuClosed())}),e.nrm(1,"app-icon",4),e.k0s()}if(2&n){e.XpG();const t=e.sdS(2);e.Y8G("matMenuTriggerFor",t)}}function _8(n,i){if(1&n&&e.nrm(0,"app-icon",6),2&n){const t=e.XpG().$implicit,o=e.XpG();e.Y8G("icon",o.bookmarkActionsIcons[t])}}function p8(n,i){if(1&n){const t=e.RV6();e.j41(0,"button",5),e.bIt("click",function(s){const a=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.handleBookmarkActionClick(a,r.bookmark(),s))}),e.DNE(1,_8,1,1,"app-icon",6),e.EFF(2),e.k0s()}if(2&n){const t=i.$implicit,o=e.XpG();e.BMQ("data-test",o.bookmarkActionsDataIds[t]),e.R7$(),e.vxM(o.bookmarkActionsIcons[t]?1:-1),e.R7$(),e.SpI(" ",o.bookmarkActionsLabels[t]," ")}}const u8={[Le.View]:"galleryCardActionPrimary",[Le.AddToMyLibrary]:"galleryCardActionAddButton",[Le.SaveFromView]:"galleryCardActionSaveFromViewButton",[Le.SaveFromEdit]:"galleryCardActionSaveFromEditButton",[Le.Edit]:"galleryCardActionEditButton",[Le.Publish]:"galleryCardActionPublishButton",[Le.CopyURL]:"galleryCardActionCopyURLButton",[Le.Share]:"galleryCardActionShareButton",[Le.Duplicate]:"galleryCardActionDuplicateButton",[Le.Manage]:"galleryCardActionManageButton",[Le.Delete]:"galleryCardActionDeleteButton"},h8=Sb(z.c.application);let Cb=(()=>{class n{constructor(t){this.bookmarkActionsService=t,this.bookmarkActionEnum=Le,this.bookmarkActionsIcons=$L,this.bookmarkActionsLabels=h8,this.bookmarkActionsDataIds=u8,this.userRole=(0,l.Lt)(Pe.getUserRole),this.isPremiumUser=(0,l.Lt)(Pe.isPremiumUser),this.isTeamUser=(0,l.Lt)(We.hasOrganization),this.bookmark=(0,e.hFB)(),this.actionsEnabled=(0,e.hFB)(!0),this.menuOpen=(0,e.CGW)(),this.bookmarkActions=(0,e.EWP)(()=>{const o=this.bookmark(),s=this.userRole(),a=this.isPremiumUser(),r=this.isTeamUser();return(0,u.isNil)(s)||(0,u.isNil)(o)||(0,u.isNil)(a)||(0,u.isNil)(r)?[]:this.bookmarkActionsService.getBookmarkActions(s,o,a,r,{excludeActions:[Le.View]})})}handleMenuOpened(){this.menuOpen.emit(!0)}handleMenuClosed(){this.menuOpen.emit(!1)}handleBookmarkActionClick(t,o,s){this.handleBookmarkAction(t,o),s.stopImmediatePropagation()}handleOtherClick(t){t.stopImmediatePropagation()}handleBookmarkAction(t,o){this.bookmarkActionsService.handleBookmarkAction(t,o)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Xu))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-gallery-card-actions"]],inputs:{bookmark:[1,"bookmark"],actionsEnabled:[1,"actionsEnabled"]},outputs:{menuOpen:"menuOpen"},standalone:!0,features:[e.Jv_([J.PV]),e.aNF],decls:5,vars:1,consts:[["actionsMenu","matMenu"],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","sm","buttonShape","square","data-test","galleryCardActionMore",3,"matMenuTriggerFor"],["mat-menu-item",""],["app-button","","buttonType","outline","buttonTheme","light","buttonSize","sm","buttonShape","square","data-test","galleryCardActionMore",3,"menuOpened","menuClosed","matMenuTriggerFor"],["icon","ellipsis-vertical"],["mat-menu-item","",3,"click"],[1,"inline-flex","justify-center","w-5",3,"icon"]],template:function(o,s){1&o&&(e.DNE(0,d8,2,1,"button",1),e.j41(1,"mat-menu",null,0),e.Z7z(3,p8,3,3,"button",2,e.Vm6),e.k0s()),2&o&&(e.vxM(s.actionsEnabled()&&s.bookmarkActions().length?0:-1),e.R7$(3),e.Dyx(s.bookmarkActions()))},dependencies:[un.Cn,un.kk,un.fb,un.Cp,sn.o,ut.R,bn.C,Mn.Q],changeDetection:0})}return n})();function g8(n,i){if(1&n&&e.nrm(0,"img",2),2&n){const t=e.XpG().$implicit;e.Y8G("alt",t)}}function m8(n,i){if(1&n&&e.EFF(0),2&n){const t=e.XpG().$implicit;e.SpI(" ",t," ")}}function f8(n,i){if(1&n&&(e.j41(0,"li",1),e.DNE(1,g8,1,1,"img",2)(2,m8,1,1),e.k0s()),2&n){const t=i.$implicit;e.R7$(),e.vxM("zSpace"===t?1:2)}}let S8=(()=>{class n{constructor(){this.tags=(0,e.hFB)([])}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-gallery-card-tags"]],inputs:{tags:[1,"tags"]},standalone:!0,features:[e.aNF],decls:3,vars:0,consts:[[1,"flex"],[1,"flex","items-center","text-xs","text-gray-400","divider-comma"],["data-test","zSpaceCardTag","src","assets/images/zspace-tag.svg",3,"alt"]],template:function(o,s){1&o&&(e.j41(0,"ul",0),e.Z7z(1,f8,3,1,"li",1,e.Vm6),e.k0s()),2&o&&(e.R7$(),e.Dyx(s.tags()))},changeDetection:0})}return n})();var b8=d(86225);const Tb=(n,i)=>i.id,y8=(n,i,t,o,s)=>({"gallery-card--checked":n,"gallery-card--loading":i,"gallery-card--disabled":t,"gallery-card--checkable":o,"gallery-card--active":s}),Ob=()=>["/results/modules"],Mb=n=>({categoryId:n,type:"Category"}),v8=(n,i,t,o,s)=>({"gallery-row--checked":n,"gallery-row--loading":i,"gallery-row--disabled":t,"gallery-row--checkable":o,"gallery-row--active":s});function E8(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",5)(1,"mat-checkbox",18),e.bIt("change",function(s){e.eBV(t);const a=e.XpG(3);return e.Njj(a.handleCheckedChange(s))})("click",function(s){return e.eBV(t),e.Njj(s.stopImmediatePropagation())}),e.k0s()()}if(2&n){const t=e.XpG(3);e.R7$(),e.Y8G("value",t.bookmark().id)("checked",t.checked())}}function C8(n,i){1&n&&(e.j41(0,"div",9),e.nrm(1,"app-icon",19),e.k0s())}function T8(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",11)(1,"app-gallery-card-actions",20),e.bIt("menuOpen",function(s){e.eBV(t);const a=e.XpG(3);return e.Njj(a.handleMenuOpened(s))}),e.k0s()()}if(2&n){const t=e.XpG(3);e.R7$(),e.Y8G("bookmark",t.bookmark())("actionsEnabled",t.actionsEnabled())}}function O8(n,i){if(1&n&&(e.j41(0,"div",12),e.nrm(1,"app-gallery-card-tags",21),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("tags",t.galleryTags())}}function M8(n,i){if(1&n&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(4);e.R7$(),e.SpI(" ",t.updatedByLabel()," ")}}function I8(n,i){if(1&n&&(e.j41(0,"div",13)(1,"div"),e.EFF(2),e.k0s(),e.DNE(3,M8,2,1,"div"),e.k0s()),2&n){const t=e.XpG(3);e.R7$(2),e.SpI(" ",t.createdByLabel()," "),e.R7$(),e.vxM(t.updatedByLabel()?3:-1)}}function P8(n,i){if(1&n){const t=e.RV6();e.j41(0,"app-gallery-card-actions",20),e.bIt("menuOpen",function(s){e.eBV(t);const a=e.XpG(3);return e.Njj(a.handleMenuOpened(s))}),e.k0s()}if(2&n){const t=e.XpG(3);e.Y8G("bookmark",t.bookmark())("actionsEnabled",t.actionsEnabled())}}function w8(n,i){if(1&n&&(e.j41(0,"a",22),e.nrm(1,"app-category-image",23),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&n){const t=i.$implicit;e.Y8G("routerLink",e.lJ4(4,Ob))("queryParams",e.eq3(5,Mb,t.id)),e.R7$(),e.Y8G("category",t.id),e.R7$(2),e.JRh(t.title)}}function A8(n,i){if(1&n&&(e.j41(0,"div",17),e.Z7z(1,w8,4,7,"a",22,Tb),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Dyx(t.categories())}}function R8(n,i){if(1&n){const t=e.RV6();e.j41(0,"a",2),e.bIt("selectBookmark",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleBookmarkSelected(s))})("click",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleSelect(a.bookmark(),s))})("keyup.enter",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleSelect(a.bookmark(),s))}),e.j41(1,"div",3),e.nrm(2,"div",4),e.DNE(3,E8,2,2,"div",5),e.k0s(),e.j41(4,"div",6)(5,"div",7)(6,"div",8),e.DNE(7,C8,2,0,"div",9),e.j41(8,"div",10),e.EFF(9),e.k0s(),e.DNE(10,T8,2,2,"div",11),e.k0s(),e.DNE(11,O8,2,1,"div",12)(12,I8,4,2,"div",13),e.k0s(),e.j41(13,"div",14)(14,"button",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.handleQuickView(s.bookmark()))}),e.EFF(15," Quick View "),e.k0s(),e.DNE(16,P8,1,2,"app-gallery-card-actions",16),e.k0s()(),e.DNE(17,A8,3,0,"div",17),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("ngClass",e.s1E(19,y8,t.checked(),t.loading(),t.disabled(),t.checkable(),t.active()))("routerLink",t.routerLink())("queryParams",t.queryParams())("target",t.target())("tabindex",t.loading()||t.disabled()?-1:0)("matTooltip",t.tooltipText()),e.BMQ("data-type",t.bookmark().type)("data-loading",t.loading())("aria-label",t.bookmark().title),e.R7$(2),e.Y8G("defaultImage",t.defaultImage)("lazyLoad",t.bookmark().thumbnail_url),e.R7$(),e.vxM(t.checkable()?3:-1),e.R7$(4),e.vxM(t.availableOffline()?7:-1),e.R7$(2),e.SpI(" ",t.bookmark().title," "),e.R7$(),e.vxM(t.checkable()?-1:10),e.R7$(),e.vxM(t.galleryTags().length>0?11:-1),e.R7$(),e.vxM(t.bookmark().type===t.contentType.Bookmark?12:-1),e.R7$(4),e.vxM(t.checkable()?-1:16),e.R7$(),e.vxM(t.showCategories()?17:-1)}}function N8(n,i){if(1&n){const t=e.RV6();e.j41(0,"mat-checkbox",18),e.bIt("change",function(s){e.eBV(t);const a=e.XpG(3);return e.Njj(a.handleCheckedChange(s))})("click",function(s){return e.eBV(t),e.Njj(s.stopImmediatePropagation())}),e.k0s()}if(2&n){const t=e.XpG(3);e.Y8G("value",t.bookmark().id)("checked",t.checked())}}function k8(n,i){1&n&&(e.j41(0,"div",9),e.nrm(1,"app-icon",19),e.k0s())}function D8(n,i){if(1&n&&(e.j41(0,"a",35),e.nrm(1,"app-category-image",36),e.EFF(2),e.k0s()),2&n){const t=i.$implicit;e.Y8G("routerLink",e.lJ4(4,Ob))("queryParams",e.eq3(5,Mb,t.id)),e.R7$(),e.Y8G("category",t.id),e.R7$(),e.SpI(" ",t.title," ")}}function L8(n,i){if(1&n&&(e.j41(0,"div",31),e.Z7z(1,D8,3,7,"a",35,Tb),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Dyx(t.categories())}}function U8(n,i){if(1&n&&e.nrm(0,"app-gallery-card-tags",21),2&n){const t=e.XpG(3);e.Y8G("tags",t.galleryTags())}}function x8(n,i){if(1&n&&(e.j41(0,"li",37),e.EFF(1),e.k0s()),2&n){const t=e.XpG(4);e.R7$(),e.SpI(" ",t.updatedByLabel()," ")}}function j8(n,i){if(1&n&&(e.j41(0,"ul",33)(1,"li",37),e.EFF(2),e.k0s(),e.DNE(3,x8,2,1,"li",37),e.k0s()),2&n){const t=e.XpG(3);e.R7$(2),e.SpI(" ",t.createdByLabel()," "),e.R7$(),e.vxM(t.updatedByLabel()?3:-1)}}function V8(n,i){if(1&n&&(e.j41(0,"ul",33)(1,"li",38),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(2),e.SpI("Updated ",t.updateDateLabel(),"")}}function F8(n,i){if(1&n){const t=e.RV6();e.j41(0,"div",34)(1,"button",39),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3);return e.Njj(s.handleQuickView(s.bookmark()))}),e.EFF(2," Quick View "),e.k0s(),e.j41(3,"app-gallery-card-actions",20),e.bIt("menuOpen",function(s){e.eBV(t);const a=e.XpG(3);return e.Njj(a.handleMenuOpened(s))}),e.k0s()()}if(2&n){const t=e.XpG(3);e.R7$(3),e.Y8G("bookmark",t.bookmark())("actionsEnabled",t.actionsEnabled())}}function G8(n,i){if(1&n){const t=e.RV6();e.j41(0,"a",24),e.bIt("selectBookmark",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleBookmarkSelected(s))})("click",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleSelect(a.bookmark(),s))})("keyup.enter",function(s){e.eBV(t);const a=e.XpG(2);return e.Njj(a.handleSelect(a.bookmark(),s))}),e.nrm(1,"div",25),e.j41(2,"div",26)(3,"div",27)(4,"div",28),e.DNE(5,N8,1,2,"mat-checkbox",29)(6,k8,2,0,"div",9),e.j41(7,"div",30),e.EFF(8),e.k0s()(),e.DNE(9,L8,3,0,"div",31),e.j41(10,"div",32),e.DNE(11,U8,1,1,"app-gallery-card-tags",21)(12,j8,4,2,"ul",33)(13,V8,3,1,"ul",33),e.k0s()(),e.DNE(14,F8,4,2,"div",34),e.k0s()()}if(2&n){const t=e.XpG(2);e.Y8G("ngClass",e.s1E(18,v8,t.checked(),t.loading(),t.disabled(),t.checkable(),t.active()))("routerLink",t.routerLink())("queryParams",t.queryParams())("target",t.target())("tabindex",t.loading()||t.disabled()?-1:0)("matTooltip",t.tooltipText()),e.BMQ("data-type",t.bookmark().type)("data-loading",t.loading())("aria-label",t.bookmark().title),e.R7$(),e.Y8G("defaultImage",t.defaultImage)("lazyLoad",t.bookmark().thumbnail_url),e.R7$(4),e.vxM(t.checkable()?5:-1),e.R7$(),e.vxM(t.availableOffline()?6:-1),e.R7$(2),e.SpI(" ",t.bookmark().title," "),e.R7$(),e.vxM(t.showCategories()?9:-1),e.R7$(2),e.vxM(t.galleryTags().length>0?11:-1),e.R7$(),e.vxM(t.bookmark().type===t.contentType.Bookmark?12:t.bookmark().type===t.contentType.Module&&t.updateDateLabel()?13:-1),e.R7$(2),e.vxM(t.checkable()?-1:14)}}function $8(n,i){if(1&n&&e.DNE(0,R8,18,25,"a",0)(1,G8,15,24,"a",1),2&n){const t=e.XpG();e.vxM(t.viewMode()===t.galleryViewMode.Card?0:t.viewMode()===t.galleryViewMode.Row?1:-1)}}let B8=(()=>{class n{constructor(t,o,s,a,r,_,g){this.bookmarksService=t,this.bookmarkActionsService=o,this.dialog=s,this.store=a,this.storageService=r,this.publishService=_,this.datePipe=g,this.galleryViewMode=Wr,this.contentType=Se.c,this.defaultImage="/assets/images/card-thumbnail-placeholder.png",this.checked=(0,e.hFB)(!1),this.actionMode=(0,e.hFB)(Si.Explore),this.actionsEnabled=(0,e.hFB)(!0),this.loading=(0,e.hFB)(!1),this.viewMode=(0,e.hFB)(Wr.Card),this.bookmark=(0,e.hFB)(),this.selectBookmark=(0,e.CGW)(),this.checkChange=(0,e.CGW)(),this.menuOpened=(0,e.CGW)(),this.menuOpen=(0,e.vPA)(!1),this.lang=(0,l.Lt)(Pe.getUserLanguage),this.offlineModelIds=(0,je.ot)(Xn.getOfflineModelIDs()),this.hovered=(0,e.vPA)(!1),this.disabled=(0,e.EWP)(()=>{const P=this.bookmarksService.isZSpaceModel(this.bookmark()),F=this.bookmarksService.getZSpaceRestriction();return P&&F!==Ei.O.None}),this.tooltipText=(0,e.EWP)(()=>{const P=this.bookmarksService.getZSpaceRestriction();return this.disabled()&&P===Ei.O.Subscription?"Upgrade your account to view this zSpace model.":this.disabled()&&P===Ei.O.Device?"This content is only available on a zSpace device":void 0}),this.primaryActionLabel=(0,e.EWP)(()=>{switch(this.actionMode()){case Si.Select:return"Select";case Si.Import:return"Import";case Si.Explore:return this.bookmarkActionsService.getBookmarkPrimaryActionLabel(this.bookmark(),this.actionMode())}}),this.categories=(0,e.EWP)(()=>{let P=[];if(this.bookmark().type===Se.c.Module&&z.c.application===xn.c.Studio){P=this.bookmarksService.getCategories(this.bookmark(),this.lang(),["categories","specialties"]).sort((ee,le)=>ee.title<le.title?-1:1);const F=this.store.selectSnapshot(gt.getSearchConfig);if(P?.length&&F?.type===kn.Category){const ee=F.categoryId,le=P.findIndex(he=>he.id===ee);le>=0&&(0,Cr.HD)(P,le,0)}}return P}),this.showCategories=(0,e.EWP)(()=>{const P=this.categories(),F=this.bookmark(),ee=this.checkable();return P.length>0&&!ee&&F.type===Se.c.Module}),this.galleryTags=(0,e.EWP)(()=>this.bookmarksService.getTags(this.bookmark())),this.routerLink=(0,e.EWP)(()=>{const P=this.bookmarksService.isZSpaceModel(this.bookmark()),F=this.storageService.getLocalJSON(It.UT.ZSpaceDevice);return P&&F?null:this.actionMode()===Si.Explore?"/view":void 0}),this.queryParams=(0,e.EWP)(()=>({id:this.bookmark().id,lang:this.lang()})),this.target=(0,e.EWP)(()=>{const P=this.bookmarksService.isZSpaceModel(this.bookmark()),F=this.storageService.getLocalJSON(It.UT.ZSpaceDevice);return P&&F?"_blank":"_self"}),this.widgetUrl=(0,e.EWP)(()=>this.publishService.buildWidgetURL("zspace-viewer",{id:this.bookmark().id,lang:this.lang()})),this.availableOffline=(0,e.EWP)(()=>!!z.c.native&&this.offlineModelIds().includes(this.bookmark().id)),this.createdByLabel=(0,e.EWP)(()=>{const P=this.bookmark(),le=[`Created by ${P.author_first_name||P.author}`];if(P.create_date_time){const he=this.datePipe.transform(P.create_date_time,"shortDate");le.push(`on ${he}`)}return le.join(" ")}),this.updateDateLabel=(0,e.EWP)(()=>{const P=this.bookmark(),F=P.update_date_time||P.create_date_time;return F?this.datePipe.transform(F,"shortDate"):""}),this.updatedByLabel=(0,e.EWP)(()=>{const P=this.bookmark(),F=this.updateDateLabel(),ee=P.last_editor_first_name||P.last_editor;return ee&&F?`Updated by ${ee} on ${F}`:""}),this.checkable=(0,e.EWP)(()=>this.actionMode()===Si.Check),this.active=(0,e.EWP)(()=>!this.checkable()&&(this.menuOpen()||this.hovered()))}onMouseEnter(){this.hovered.set(!0)}onMouseLeave(){this.hovered.set(!1)}handleSelect(t,o){switch(this.actionMode()){case Si.Explore:if(!z.c.native){const s=this.bookmarksService.isZSpaceModel(this.bookmark()),a=this.storageService.getLocalJSON(It.UT.ZSpaceDevice);s&&a&&!this.disabled()&&(o.preventDefault(),o.stopPropagation(),window.open(this.widgetUrl()))}break;case Si.Import:case Si.Check:case Si.Select:o.preventDefault(),this.disabled()||this.handleBookmarkSelected(t),o.stopPropagation()}}handleBookmarkSelected(t){this.checkable()?this.checkChange.emit(!this.checked()):this.selectBookmark.emit(t)}handleCheckedChange(t){this.checkChange.emit(t.checked)}handleMenuOpened(t){this.menuOpen.set(t),this.menuOpened.emit(t)}handleQuickView(t){const o={id:"QuickViewDialog",panelClass:"bg-dialog-responsive",disableClose:!1,data:{bookmark:t,actionMode:this.actionMode()}};this.dialog.open(c8,o).afterClosed().pipe((0,qt.s)(1)).subscribe(s=>{s?.selected&&this.handleBookmarkSelected(s.selected)})}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(Bo),e.rXU(Xu),e.rXU(vt.bZ),e.rXU(l.il),e.rXU(It.n$),e.rXU(Io),e.rXU(J.vh))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-gallery-card"]],hostBindings:function(o,s){1&o&&e.bIt("mouseenter",function(){return s.onMouseEnter()})("mouseleave",function(){return s.onMouseLeave()})},inputs:{checked:[1,"checked"],actionMode:[1,"actionMode"],actionsEnabled:[1,"actionsEnabled"],loading:[1,"loading"],viewMode:[1,"viewMode"],bookmark:[1,"bookmark"]},outputs:{selectBookmark:"selectBookmark",checkChange:"checkChange",menuOpened:"menuOpened"},standalone:!0,features:[e.Jv_([J.vh]),e.aNF],decls:1,vars:1,consts:[["role","button","data-test","galleryCard","matTooltipPosition","after",1,"relative","z-auto","block","w-full","h-[240px]","lg:h-full","overflow-hidden","break-words","transition-all","bg-white","border","border-gray-200","border-solid","rounded-lg","cursor-pointer","group","gallery-card","hover:border-gray-400",3,"ngClass","routerLink","queryParams","target","tabindex","matTooltip"],["role","button","data-test","galleryCard","matTooltipPosition","after",1,"flex","flex-row","gallery-row","group",3,"ngClass","routerLink","queryParams","target","tabindex","matTooltip"],["role","button","data-test","galleryCard","matTooltipPosition","after",1,"relative","z-auto","block","w-full","h-[240px]","lg:h-full","overflow-hidden","break-words","transition-all","bg-white","border","border-gray-200","border-solid","rounded-lg","cursor-pointer","group","gallery-card","hover:border-gray-400",3,"selectBookmark","click","keyup.enter","ngClass","routerLink","queryParams","target","tabindex","matTooltip"],[1,"gallery-card__image-container","bg-[size:30%]","relative","bg-center","bg-no-repeat","bg-gray-100","pb-[100%]","border","rounded"],["role","img","card-image","",1,"absolute","top-0","bottom-0","left-0","right-0","transition-all","bg-center","bg-cover","gallery-card__image","lg:group-[.gallery-card--active]:scale-105",3,"defaultImage","lazyLoad"],[1,"absolute","flex","items-center","justify-start","w-full","p-2","gallery-card__header","grow"],[1,"gallery-card__content","absolute","border-solid","border-t","border-gray-200","bottom-0","flex","flex-col","justify-between","w-full","h-auto","p-3","transition-all","bg-white","group-[.gallery-card--active]:bg-white","group-[.gallery-card--active]:max-h-[180px]"],[1,"flex","flex-col"],[1,"flex","items-center","gap-2"],[1,"text-green-500","bg-center","bg-no-repeat","rounded-full"],["data-test","galleryCardLabel",1,"max-w-full","overflow-hidden","text-sm","font-semibold","text-gray-800","gallery-card__label","grow","text-ellipsis","whitespace-nowrap","group-[.gallery-card--active]:lg:overflow-visible","group-[.gallery-card--active]:lg:whitespace-normal"],["appEventFence","",1,"lg:hidden"],[1,"gallery-card__tags","hidden","group-[.gallery-card--active]:block"],[1,"hidden","text-xs","text-gray-400","group-[.gallery-card--active]:lg:block"],["appEventFence","",1,"gallery-card__actions","items-center","invisible","hidden","h-0","gap-2","overflow-hidden","transition-all","opacity-0","lg:flex","group-[.gallery-card--active]:opacity-100","group-[.gallery-card--active]:visible","group-[.gallery-card--active]:h-10","group-[.gallery-card--active]:overflow-visible"],["type","button","app-button","","buttonType","outline","buttonTheme","light","buttonSize","sm","data-test","galleryCardQuickView",1,"flex-auto","gallery-card__quick-view",3,"click"],[3,"bookmark","actionsEnabled"],[1,"gallery-card__category-container","absolute","flex","flex-wrap","gap-1","mr-2","left-2","top-2","lg:opacity-0","lg:group-[.gallery-card--active]:opacity-100"],[3,"change","click","value","checked"],["icon","arrow-circle-down"],[3,"menuOpen","bookmark","actionsEnabled"],[3,"tags"],["appEventFence","",1,"inline-flex","items-center","gap-1","px-2","py-1","font-semibold","text-gray-600","no-underline","uppercase","transition-all","rounded","gallery-card__category","hover:bg-gray-100","text-2xs","bg-white/80",3,"routerLink","queryParams"],["color","color",1,"w-4","h-4","gallery-card__category-icon",3,"category"],["role","button","data-test","galleryCard","matTooltipPosition","after",1,"flex","flex-row","gallery-row","group",3,"selectBookmark","click","keyup.enter","ngClass","routerLink","queryParams","target","tabindex","matTooltip"],["role","img","card-image","",1,"transition-all","bg-center","w-[100px]","h-[100px]","bg-cover","gallery-row__image","group-[.gallery-row--active]:scale-105",3,"defaultImage","lazyLoad"],[1,"gallery-row__content"],[1,"gallery-row__text"],[1,"flex","gap-2"],[3,"value","checked"],["data-test","galleryCardLabel",1,"gallery-row__label","grow"],[1,"flex","flex-row","flex-wrap","gap-1"],[1,"flex","flex-col","gap-1"],[1,"inline-flex","items-center"],["appEventFence","",1,"gallery-row__actions"],["appEventFence","",1,"inline-flex","items-center","gap-1","px-2","py-1","font-semibold","text-gray-600","no-underline","uppercase","transition-all","rounded","gallery-row__category","hover:bg-gray-100","text-2xs","bg-white/60",3,"routerLink","queryParams"],["color","color",1,"w-4","h-4","gallery-row__category-icon",3,"category"],[1,"text-xs","text-gray-400","divider-comma"],[1,"text-xs","text-gray-400"],["type","button","app-button","","buttonType","outline","buttonTheme","light","buttonSize","sm","data-test","galleryCardQuickView",1,"gallery-row__quick-view",3,"click"]],template:function(o,s){1&o&&e.DNE(0,$8,2,1),2&o&&e.vxM(s.bookmark()?0:-1)},dependencies:[J.MD,J.YU,K.iI,K.Wk,Kt.uc,Kt.oV,So.Un,So.Je,Gs.g7,Gs.So,sn.o,ut.R,bn.C,Mn.Q,xi.h,Ta.L,Cb,S8,b8.f],styles:['@keyframes _ngcontent-%COMP%_loaderShimmer{0%{background-position:100% 0}to{background-position:-100% 0}}[_nghost-%COMP%]{position:relative;display:block}.gallery-card__image-container[_ngcontent-%COMP%], .gallery-row__image-container[_ngcontent-%COMP%]{background-image:url(/assets/images/logo-dark-transparent.svg)}.gallery-card--disabled[_ngcontent-%COMP%], .gallery-row--disabled[_ngcontent-%COMP%]{opacity:.6}.gallery-card--checked[_ngcontent-%COMP%], .gallery-row--checked[_ngcontent-%COMP%]{outline-style:solid!important;outline-width:2px!important;outline-color:#2472e9!important}.gallery-card--loading[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]{pointer-events:none}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%], .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__image-container[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__image-container[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border-radius:100px;background:#e7eaee;background-image:linear-gradient(to right,#e7eaee,#f8f9fa 20%,#e7eaee 40% 100%);background-repeat:no-repeat;background-size:300% 100%;display:inline-block;position:relative;animation:_ngcontent-%COMP%_loaderShimmer 1.5s infinite forwards;border-radius:initial}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%], .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__image[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__image[_ngcontent-%COMP%]{background-image:none!important}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__label[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__label[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{display:none}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]:after, .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__label[_ngcontent-%COMP%]:after, .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]:after, .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__label[_ngcontent-%COMP%]:after{content:"";display:block;width:100%;height:16px;border-radius:100px;background:#e7eaee;background-image:linear-gradient(to right,#e7eaee,#f8f9fa 20%,#e7eaee 40% 100%);background-repeat:no-repeat;background-size:300% 100%;display:inline-block;position:relative;animation:_ngcontent-%COMP%_loaderShimmer 1.5s infinite forwards}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__tags[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__tags[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{display:none}.gallery-card--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]:after, .gallery-card--loading[_ngcontent-%COMP%]   .gallery-row__tags[_ngcontent-%COMP%]:after, .gallery-row--loading[_ngcontent-%COMP%]   .gallery-card[_ngcontent-%COMP%]:after, .gallery-row--loading[_ngcontent-%COMP%]   .gallery-row__tags[_ngcontent-%COMP%]:after{content:"";display:block;width:35%;height:16px;border-radius:100px;background:#e7eaee;background-image:linear-gradient(to right,#e7eaee,#f8f9fa 20%,#e7eaee 40% 100%);background-repeat:no-repeat;background-size:300% 100%;display:inline-block;position:relative;animation:_ngcontent-%COMP%_loaderShimmer 1.5s infinite forwards}',".gallery-row[_ngcontent-%COMP%]{border-radius:.25rem;display:flex;gap:12px;padding:12px;transition:all .15s ease-out;text-decoration:none}.gallery-row[_ngcontent-%COMP%]:hover   .gallery-row__label[_ngcontent-%COMP%]{text-decoration-line:underline}.gallery-row[_ngcontent-%COMP%]:hover   .gallery-row__image[_ngcontent-%COMP%]{transform:scale(1.07);box-shadow:1px 1px var(--shadow, rgba(34, 34, 34, .1)),0 1px 12px 0 var(--shadow, rgba(34, 34, 34, .1))}.gallery-row[_ngcontent-%COMP%]:hover   .gallery-row__actions[_ngcontent-%COMP%]{opacity:1}.gallery-row__image[_ngcontent-%COMP%]{--shadow: rgba(34, 34, 34, .1);box-shadow:1px 1px var(--shadow, rgba(34, 34, 34, .1)),0 1px 6px 0 var(--shadow, rgba(34, 34, 34, .1));width:100px;height:100px;background-size:cover;transition:all ease-out .2s}.gallery-row__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.gallery-row__text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.gallery-row__label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;max-width:100%;white-space:nowrap;font-size:.875rem;line-height:1.25rem;font-weight:600;color:#142136}.gallery-row__actions[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:4px;opacity:0;height:40px;transition:all .15s ease-out}.gallery-row__tags[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;font-weight:500;color:#8999b3;display:flex;text-decoration:none}.gallery-row__category[_ngcontent-%COMP%]{text-decoration:none;color:#0c1726;display:inline-flex;border-radius:4px;align-items:center;padding:4px;background-color:#fffc;transition:all .15s ease-out;margin:0 4px 0 0;font-size:.625rem;line-height:.75rem;text-transform:uppercase}.gallery-row__category[_ngcontent-%COMP%]:hover{background-color:#e7eaee}.gallery-row__category-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin-right:4px}.gallery-row__category-icon--mono[_ngcontent-%COMP%]{display:inline-block}.gallery-row__category-icon--color[_ngcontent-%COMP%]{display:none}.gallery-row__updated[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;color:#8999b3;display:flex}"],changeDetection:0})}return n})();const z8=["app-pill-button",""],W8=["*"],X8=n=>({"pill-button--selected":n});let H8=(()=>{class n{constructor(){this.selected=!1}ngOnInit(){}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["button","app-pill-button",""],["a","app-pill-button",""]],inputs:{selected:"selected"},attrs:z8,ngContentSelectors:W8,decls:2,vars:3,consts:[[1,"pill-button",3,"ngClass"]],template:function(o,s){1&o&&(e.NAR(),e.j41(0,"span",0),e.SdG(1),e.k0s()),2&o&&e.Y8G("ngClass",e.eq3(1,X8,s.selected))},dependencies:[J.YU],styles:["[_nghost-%COMP%]{border-color:transparent;background:none;border-width:0;padding:0;margin:0;border-radius:4px;outline:0 none}[_nghost-%COMP%]:not([disabled]):hover{cursor:pointer}[_nghost-%COMP%]:focus   .pill-button[_ngcontent-%COMP%]{outline:#2472e9 solid 2px!important}[_nghost-%COMP%]:disabled   .pill-button[_ngcontent-%COMP%], [_nghost-%COMP%]:disabled:hover   .pill-button[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#8999b3}.pill-button[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-family:Inter,sans-serif;font-weight:500;color:#384c6c;display:flex;align-items:center;justify-content:center;background-color:#e7eaee;border-radius:100px;padding:8px 16px;transition:background-color .12s,color .12s;width:100%}.pill-button[_ngcontent-%COMP%]:hover{background-color:#d4d9e3}.pill-button--selected[_ngcontent-%COMP%], .pill-button--selected[_ngcontent-%COMP%]:hover{background-color:#2472e9;color:#fff}"],changeDetection:0})}return n})();function K8(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",9)(1,"button",10),e.nI1(2,"async"),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.setTag(a.title,r.activeTags[a.title]===s?"":s))}),e.EFF(3),e.nI1(4,"titlecase"),e.k0s()()}if(2&n){let t;const o=i.$implicit,s=e.XpG().$implicit,a=e.XpG(2);e.R7$(),e.Y8G("disabled",!(null!=(t=e.bMT(2,3,a.availableTags$))&&t.includes(o)))("selected",a.activeTags[s.title]===o),e.R7$(2),e.SpI(" ",e.bMT(4,5,o)," ")}}function q8(n,i){if(1&n&&(e.j41(0,"div",5)(1,"h2",6),e.EFF(2),e.k0s(),e.j41(3,"ul",7),e.DNE(4,K8,5,7,"li",8),e.k0s()()),2&n){const t=i.$implicit;e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngForOf",t.tags)}}function J8(n,i){if(1&n&&(e.j41(0,"div",3),e.DNE(1,q8,5,2,"div",4),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.tagGroups)}}function Z8(n,i){if(1&n){const t=e.RV6();e.j41(0,"li",9)(1,"button",14),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.setTag(s.title,""))}),e.j41(2,"span",15),e.EFF(3),e.nI1(4,"titlecase"),e.k0s(),e.nrm(5,"app-icon",16),e.k0s()()}if(2&n){const t=e.XpG().$implicit;e.R7$(3),e.JRh(e.bMT(4,1,t))}}function ex(n,i){if(1&n&&(e.qex(0),e.DNE(1,Z8,6,3,"li",13),e.bVm()),2&n){const t=i.$implicit,o=e.XpG().$implicit,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",s.activeTags[o.title]===t)}}function tx(n,i){if(1&n&&(e.qex(0),e.DNE(1,ex,2,1,"ng-container",12),e.bVm()),2&n){const t=i.$implicit;e.R7$(),e.Y8G("ngForOf",t.tags)}}function nx(n,i){if(1&n&&(e.j41(0,"ul",11),e.DNE(1,tx,2,1,"ng-container",12),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.tagGroups)}}class el{get viewMode(){return this._viewMode}set viewMode(i){this._viewMode=i}get activeTags(){return this._activeTags}set activeTags(i){null==i&&(i={}),this._activeTags=i,this.activeTagList=Object.values(this.activeTags).reduce((t,o)=>(""!=o&&t.push(o),t),[]),this.changeDetectorRef.markForCheck()}constructor(i,t,o){this.changeDetectorRef=i,this.store=t,this.router=o,this.activeTagList=[],this.ngUnsubscribe=new k.B,this._viewMode="expanded",this.tagGroups=[],this._activeTags={},this.selectedTagChange=new e.bkB}ngOnInit(){this.store.select(gt.getActiveTags).pipe((0,p.Q)(this.ngUnsubscribe)).subscribe(i=>{this.activeTags=i}),this.initFilters()}isMyLibrary(){return this.router.url.includes("/results/bookmarks")}initFilters(){const i=z.c.native;this.tagGroups=[],i&&this.tagGroups.push(Co.VM),this.isMyLibrary()?this.tagGroups.push(Co.Ub):this.tagGroups=this.tagGroups.concat([Co.oM,{...Co.Ue,tags:(0,u.without)(Co.Ue.tags,"Quiz",Ei.a.Zspace,"read only")}])}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setTag(i,t){const o=this.store.selectSnapshot(gt.getActiveTags);o[i]=t,this.store.dispatch(new kt.SetActiveTags(o))}static#e=this.\u0275fac=function(t){return new(t||el)(e.rXU(e.gRc),e.rXU(l.il),e.rXU(K.Ix))};static#t=this.\u0275cmp=e.VBU({type:el,selectors:[["app-gallery-filters"]],inputs:{viewMode:"viewMode"},outputs:{selectedTagChange:"selectedTagChange"},decls:3,vars:4,consts:[["data-test","galleryFilters",1,"gallery-filters"],["class","gallery-filters__expanded","data-test","galleryFiltersExpanded",4,"ngIf"],["class","gallery-filters__tags","data-test","galleryFiltersSummary",4,"ngIf"],["data-test","galleryFiltersExpanded",1,"gallery-filters__expanded"],["class","gallery-filters__group",4,"ngFor","ngForOf"],[1,"gallery-filters__group"],[1,"gallery-filters__header"],[1,"gallery-filters__tags"],["class","gallery-filters__tag",4,"ngFor","ngForOf"],[1,"gallery-filters__tag"],["app-pill-button","","data-test","galleryFiltersTag",3,"click","disabled","selected"],["data-test","galleryFiltersSummary",1,"gallery-filters__tags"],[4,"ngFor","ngForOf"],["class","gallery-filters__tag",4,"ngIf"],["app-pill-button","","data-test","galleryFiltersTag",3,"click"],[1,"mr-2"],["icon","times"]],template:function(t,o){1&t&&(e.j41(0,"div",0),e.DNE(1,J8,2,1,"div",1)(2,nx,2,1,"ul",2),e.k0s()),2&t&&(e.AVh("gallery-filters--multiple",o.tagGroups.length>1),e.R7$(),e.Y8G("ngIf","expanded"===o.viewMode),e.R7$(),e.Y8G("ngIf","summary"===o.viewMode))},dependencies:[H8,J.Sq,J.bT,ut.R,J.Jj,J.PV],styles:[".gallery-filters__expanded[_ngcontent-%COMP%]{display:flex;gap:32px}.gallery-filters__header[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;font-weight:600;padding-bottom:8px}.gallery-filters__tag[_ngcontent-%COMP%]{display:inline-block;margin:0 12px 12px 0}@media (max-width: 540px){.gallery-filters__expanded[_ngcontent-%COMP%]{flex-direction:column;gap:0}.gallery-filters__group[_ngcontent-%COMP%]{padding:0 0 24px}}"],changeDetection:0})}!function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);s>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(gt.getAvailableTags),function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,h.c)],el.prototype,"availableTags$",void 0);var ix=d(32996);let ox=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,dc.jc,ix.z,sn.o,bn.C,Lt.G]})}return n})();var sx=d(27878),ax=d(67575);let Ib=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Lt.G,Nt.G,ax.PO,Pr,sx.wR]})}return n})();const rx=["featuredCard"];function lx(n,i){if(1&n&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.subtitle())}}function cx(n,i){if(1&n&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.metadata())}}function dx(n,i){if(1&n&&(e.j41(0,"figure",10),e.nrm(1,"img",11),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("lazyLoad",t.featuredIcon())}}let _x=(()=>{class n{constructor(){this.defaultImage="/assets/images/card-thumbnail-placeholder.png",this.title=e.hFB.required(),this.subtitle=(0,e.hFB)(),this.metadata=(0,e.hFB)(),this.image=(0,e.hFB)(),this.featuredIcon=(0,e.hFB)(),this.colorOnHover=(0,e.hFB)(!1),this.routerLink=(0,e.hFB)(),this.queryParams=(0,e.hFB)(),this.innerColor=(0,e.hFB)(),this.outerColor=(0,e.hFB)(),this.foreground=(0,e.hFB)("white"),this.gradientColor=(0,e.EWP)(()=>`linear-gradient(180deg, ${this.innerColor()} 0%, ${this.outerColor()} 100%)`),(0,e.QZP)(()=>{this.colorOnHover()?this.removeColorFromCard():this.applyColorToCard()})}onMouseEnter(){this.colorOnHover()&&this.applyColorToCard()}onMouseLeave(){this.colorOnHover()&&this.removeColorFromCard()}applyColorToCard(){this.featuredCardElement.nativeElement.style.setProperty("--background",this.gradientColor()),this.featuredCardElement.nativeElement.style.setProperty("--foreground",this.foreground()),this.colorOnHover()&&this.featuredCardElement.nativeElement.style.setProperty("--border",this.outerColor())}removeColorFromCard(){this.featuredCardElement.nativeElement.style.setProperty("--background","white"),this.featuredCardElement.nativeElement.style.setProperty("--foreground","#1c2a3f"),this.colorOnHover()&&this.featuredCardElement.nativeElement.style.setProperty("--border","#d7e0ea")}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-featured-card"]],viewQuery:function(o,s){if(1&o&&e.GBs(rx,7),2&o){let a;e.mGM(a=e.lsd())&&(s.featuredCardElement=a.first)}},inputs:{title:[1,"title"],subtitle:[1,"subtitle"],metadata:[1,"metadata"],image:[1,"image"],featuredIcon:[1,"featuredIcon"],colorOnHover:[1,"colorOnHover"],routerLink:[1,"routerLink"],queryParams:[1,"queryParams"],innerColor:[1,"innerColor"],outerColor:[1,"outerColor"],foreground:[1,"foreground"]},standalone:!0,features:[e.aNF],decls:12,vars:8,consts:[["featuredCard",""],[1,"@container","featured-card"],[1,"flex","w-full","rounded-lg","cursor-pointer","h-24","@xs:h-48",3,"mouseenter","mouseleave","routerLink","queryParams"],[1,"rounded-l-lg","hidden","@lg:block","h-48","w-48",3,"defaultImage","lazyLoad"],[1,"flex","flex-col","justify-between","h-full","w-full","p-4","@xs:p-8"],[1,"text-xs","@xs:text-lg","font-semibold"],[1,"flex","gap-3"],[1,"flex","flex-col","flex-grow","gap-2"],[1,"text-2xs","@xs:text-sm","font-normal","@xs:font-semibold"],[1,"hidden","@xs:block","text-2xs","@xs:text-sm","font-normal"],[1,"rounded","bg-white","min-w-8","min-h-8","w-8","h-8","items-center","justify-center","justify-self-end","self-end","hidden","@xs:flex"],[3,"lazyLoad"]],template:function(o,s){if(1&o){const a=e.RV6();e.j41(0,"div",1,0)(2,"a",2),e.bIt("mouseenter",function(){return e.eBV(a),e.Njj(s.onMouseEnter())})("mouseleave",function(){return e.eBV(a),e.Njj(s.onMouseLeave())}),e.nrm(3,"img",3),e.j41(4,"div",4)(5,"h1",5),e.EFF(6),e.k0s(),e.j41(7,"div",6)(8,"div",7),e.DNE(9,lx,2,1,"div",8)(10,cx,2,1,"div",9),e.k0s(),e.DNE(11,dx,2,1,"figure",10),e.k0s()()()()}2&o&&(e.R7$(2),e.Y8G("routerLink",s.routerLink())("queryParams",s.queryParams()),e.R7$(),e.Y8G("defaultImage",s.defaultImage)("lazyLoad",s.image()),e.R7$(3),e.SpI(" ",s.title()," "),e.R7$(3),e.vxM(s.subtitle()?9:-1),e.R7$(),e.vxM(s.metadata()?10:-1),e.R7$(),e.vxM(s.featuredIcon()?11:-1))},dependencies:[J.MD,K.iI,K.Wk,So.Un,So.Je],styles:[".featured-card[_ngcontent-%COMP%]{--background: white;--foreground: #1c2a3f;--border: transparent}.featured-card[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{background:var(--background);color:var(--foreground);outline:1px solid var(--border)!important}"],changeDetection:0})}return n})(),px=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([gt]),So.Un,K.iI,bn.C,J.MD,fe.X1,Mc,xi.h,Pu.H,Nt.G,CS.f,Ws.M,Lt.G,Gs.g7,ox,Ib,_x,Cb,B8]})}return n})();e.wjB(wS,function(){return[Mn.Q,Ta.L,ut.R,el]},[]);let Pb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,K.iI,Lt.G]})}return n})(),jc=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([ls.U]),J.MD]})}return n})(),wb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[Lt.G,Nt.G,J.MD,K.iI,CS.f,ES,fe.X1,Mc,px,Pb,jc,l.rK.forFeature([vn])]})}return n})(),Hu=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([On.U])]})}return n})();var ux=d(43631);let Qu=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([ux._,ze.S,Ti.x,Rn.z,Ai,ts.B]),J.MD,xi.h,Nt.G,fe.YN,fe.X1,cc,Lt.G,$p.G,Hu,$s,Vm]})}return n})(),hx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,OS,l.rK.forFeature([We])]})}return n})(),Ab=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),Yu=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,fe.YN,fe.X1,nc.D]})}return n})(),Rb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1,Yu]})}return n})(),Nb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),kb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),Db=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),Lb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Ub=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),xb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})();var Vo;!function(n){n.OpenLimit=(()=>{class _{static#e=this.type="[Dialog] Open Limit";constructor(){}}return _})(),n.CloseLimit=(()=>{class _{static#e=this.type="[Dialog] Close Limit";constructor(P){this.upgrade=P}}return _})(),n.OpenPremiumContent=(()=>{class _{static#e=this.type="[Dialog] Open Premium Content";constructor(){}}return _})(),n.ClosePremiumContent=(()=>{class _{static#e=this.type="[Dialog] Close Premium Content";constructor(P){this.confirmed=P}}return _})(),n.OpenUpgrade=(()=>{class _{static#e=this.type="[Dialog] Open Upgrade";constructor(){}}return _})(),n.CloseUpgrade=(()=>{class _{static#e=this.type="[Dialog] Close Upgrade";constructor(){}}return _})()}(Vo||(Vo={}));var tl=function(n,i,t,o){var r,s=arguments.length,a=s<3?i:null===o?o=Object.getOwnPropertyDescriptor(i,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(n,i,t,o);else for(var _=n.length-1;_>=0;_--)(r=n[_])&&(a=(s<3?r(a):s>3?r(i,t,a):r(i,t))||a);return s>3&&a&&Object.defineProperty(i,t,a),a},Yi=function(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)};let ta=class Dd{static getOpenDialog(i){return i.openDialog}openPremiumContent(i,t){this.dialogService.openPremiumContentDialog().afterClosed().subscribe(s=>{i.dispatch(new Vo.ClosePremiumContent(s))})}closePremiumContent(i,t){t.confirmed&&i.dispatch(new Vo.OpenUpgrade)}openUpgrade(i,t){this.dialogService.openUpgradeDialog()}constructor(i){this.dialogService=i}static#e=this.\u0275fac=function(t){return new(t||Dd)(e.KVO(Zs))};static#t=this.\u0275prov=e.jDH({token:Dd,factory:Dd.\u0275fac})};tl([(0,l.rc)(Vo.OpenPremiumContent),Yi("design:type",Function),Yi("design:paramtypes",[Object,Vo.OpenPremiumContent]),Yi("design:returntype",void 0)],ta.prototype,"openPremiumContent",null),tl([(0,l.rc)(Vo.ClosePremiumContent),Yi("design:type",Function),Yi("design:paramtypes",[Object,Vo.ClosePremiumContent]),Yi("design:returntype",void 0)],ta.prototype,"closePremiumContent",null),tl([(0,l.rc)(Vo.OpenUpgrade),Yi("design:type",Function),Yi("design:paramtypes",[Object,Vo.OpenUpgrade]),Yi("design:returntype",void 0)],ta.prototype,"openUpgrade",null),tl([(0,l.MD)(),Yi("design:type",Function),Yi("design:paramtypes",[class gx{}]),Yi("design:returntype",void 0)],ta,"getOpenDialog",null),ta=tl([(0,l.Uw)({name:"dialog",defaults:{openDialog:null}}),Yi("design:paramtypes",[Zs])],ta);let jb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Vb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Fb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Gb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),$b=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,fe.YN,fe.X1,Lt.G]})}return n})();var Bb=d(59464);let zb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Wb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Xb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,sn.o,bn.C]})}return n})();var mx=d(64026);let fx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,fe.YN,nc.D,fe.X1,Ws.M,bn.C,Ib,Bb.j,sn.o,mx.m,Pu.H]})}return n})(),Hb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1,fx,Yu]})}return n})(),Sx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),bx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Qb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Yb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),Kb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),yx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.YN,fe.X1]})}return n})(),qb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,Wn.y2.forChild()]})}return n})(),Jb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1,Yu]})}return n})(),Zb=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),ey=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),ty=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),ny=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G]})}return n})(),iy=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,Lt.G,fe.X1]})}return n})(),vx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([ta]),Ab,Rb,Jb,Nb,Kb,kb,Db,Xb,Lb,Ub,xb,jb,Vb,Fb,Gb,$b,zb,Wb,Hb,Qb,Yb,iy,Bb.j,nc.D,Lt.G,qb,Zb,ey,ty,ny,Ab,Rb,Jb,Nb,Kb,kb,Db,Xb,Lb,Ub,xb,jb,Hb,Vb,Fb,Gb,$b,zb,Wb,Sx,bx,Qb,Yb,iy,Pb,yx,qb,Zb,ey,ty,ny]})}return n})(),Ex=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,sn.o]})}return n})(),Cx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD]})}return n})();var Tx=d(18824),Ox=d(90556);let Mx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Nt.G,bn.C,xi.h,sn.o,Pr,Pu.H,fe.X1,Bp,Ws.M]})}return n})();const Ix=[];let Px=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[K.iI.forChild(Ix),K.iI]})}return n})();var oy=d(5584);let wx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,mo.Pd,bn.C,Nt.G,Qu,sn.o,oy.d,fe.YN,xp,Ws.M,Lt.G,sc]})}return n})(),Ax=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,sn.o,Om.H,bn.C]})}return n})(),Rx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([Xi]),J.MD]})}return n})(),Nx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([de]),l.rK.forFeature([Ke]),Wn.y2.forChild(),mo.Pd,Mc,bn.C,J.MD,Pr,xi.h,Qu,fe.YN,sn.o,So.Un,Nt.G,Rx,$p.G,Ex,ps.b,zm.Y,Cx,Ws.M,Bp,fe.X1,Lt.G,cc,Tx.j,oy.d,Ox.f,xp,wx,Mx,Px,Ax,Hu,zs.Ez,jc,_c,_f,Dp,lc,Na,$m,Km,qm,Ir,mc,Lp,bo,Fp,hs,Gp,Jm]})}return n})(),kx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({providers:[eu],imports:[l.rK.forFeature([Z]),J.MD,Lt.G]})}return n})(),Dx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,K.iI,bn.C,xi.h,sn.o,wb,jc]})}return n})(),sy=(()=>{class n{parse(t){t=t.replace(/&amp;/g,"&");const s=(new K.nU).parse(t);return this.ensureQueryParam(s.queryParams,"dk",t),this.ensureQueryParam(s.queryParams,"uaid",t),s}serialize(t){return(new K.nU).serialize(t).replace(/%2F/g,"/")}ensureQueryParam(t,o,s){if(t.hasOwnProperty(o))return t;const a=this.getParameterByName(o,s);return null!==a&&(t[o]=a),t}getParameterByName(t,o){o||(o=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");const a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(o);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})(),Lx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([Dn]),J.MD]})}return n})(),Ux=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([Bn]),J.MD]})}return n})();var xx=d(40832);function jx(){const n=new xx.A4;return n.link=(i,t,o)=>`<a href="${function Vx(n){return n.match(/^(?:(?:(?:ht)tps?):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i)?n:""}(i)}" target="_blank" rel="noreferrer nofollow">${o}</a>`,n.paragraph=i=>`<p>${i}</p>`,n.image=(i,t,o)=>"",{renderer:n,gfm:!1}}let Fx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,Wn.y2.forRoot({markedOptions:{provide:Wn.GY,useFactory:jx}})]})}return n})(),Gx=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[ve,{provide:"vendorAnalyticsConfig",useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({})}return n})(),$x=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[J.MD,l.rK.forFeature([Qi])]})}return n})();var Bx=d(77015),zx=d.n(Bx);const Wx={accessToken:z.c.rollbarToken,captureUncaught:!1,captureUnhandledRejections:!1,captureIp:!1,autoInstrument:{log:!1},payload:{environment:z.c.deploy.toLowerCase(),application:z.c.application,engineVersion:R,webGLEnabled:(0,ya.MN)()}},ay=new e.nKC("rollbar");class Qx{error(i){console.error(i)}}jn.IP(),jn.YT(),jn.ht(!1);const Yx=[{provide:K.Sd,useClass:sy},{provide:J.kB,useValue:"./"},{provide:J.hb,useClass:J.fw},{provide:ay,useFactory:function Hx(){return new Qx}}],Kx=[{provide:K.Sd,useClass:sy},{provide:ay,useFactory:function Xx(){return new(zx())(Wx)}}];let qx=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n,bootstrap:[mr]});static#n=this.\u0275inj=e.G2t({providers:[(0,f.$R)((0,f.Sx)()),...!0===z.c.offline?Yx:Kx],imports:[l.rK.forRoot(),Lx,ES.forRoot(),Gx.forRoot({enabled:!1,pendoId:z.c.pendoId,hubspotId:z.c.hubspotId}),Fx,c.Bb,y.wb,jc,Qu,Hu,Mc,wb,hx,cc,Ux,vx,Nx,Dx,kx,$x,Y1,M4]})}return n})();z.c.production&&(0,e.SmG)(),c.sG().bootstrapModule(qx).catch(n=>console.error(n))},95904:()=>{},42634:()=>{}},be=>{be.O(0,[502],()=>be(be.s=19408)),be.O()}]);