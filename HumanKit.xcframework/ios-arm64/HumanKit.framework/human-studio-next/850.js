(self.webpackChunkweb=self.webpackChunkweb||[]).push([[850],{72850:(En,Gi,v)=>{"use strict";v.r(Gi),v.d(Gi,{EditModule:()=>Pb});var w=v(60177),b=v(38645),A=v(28407),e=v(54438),d=v(67271),l=v(92014),k=v(32408),f=v(85052),m=v(15877),u=v(21472),h=v(35426),C=v(82656),T=v(76718),F=v(19827),_=v(2573),M=v(45415),P=v(41862);class ${}var L=v(92676),Q=v(81881);class xe{constructor(i,t,n){this.label=i,this.width=t,this.height=n}}const Be=new xe("Don't Resize",-1,-1),si=new xe("Mobile",360,640),q=new xe("Desktop",1280,720),fe=new xe("Tablet",768,1024);function ge(s,i,t){return`${s}: ${i} x ${t}`}var de=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},V=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const wt={view:M.x.Chapter,leftColumnCollapsed:!1,showTimelineEditor:!1,record:!0,layerOrderMode:!1,showTreeNodeIds:!1,showRootNodes:!1,canvasSize:Be,canvasSettings:{emulateDrawer:!1,emulateColumn:!1}};let g=class po{static getView(i){return i.view}static getLeftColumnCollapsed(i){return i.leftColumnCollapsed}static getShowTimelineEditor(i){return i.showTimelineEditor}static getRecord(i){return i.record}static getLayerOrderMode(i){return i.layerOrderMode}static getShowTreeNodeIds(i){return i.showTreeNodeIds}static getCanvasSize(i){return i.canvasSize}static getCanvasSettings(i){return i.canvasSettings}static getShowRootNodes(i){return i.showRootNodes}SetLayerOrderMode(i,t){i.patchState({layerOrderMode:t.layerOrderMode})}ShowTreeNodeIds(i,t){const n=null!=t.show?t.show:!i.getState().showTreeNodeIds;i.patchState({showTreeNodeIds:n})}showRootNodes(i,t){i.patchState({showRootNodes:t.show})}setView(i,t){i.patchState({view:t.view})}nextView(i,t){const{view:n}=i.getState(),o=Object.values(M.x),a=o[o.indexOf(n)+1]||o[0];i.patchState({view:a})}previousView(i,t){const{view:n}=i.getState(),o=Object.values(M.x),a=o[o.indexOf(n)-1]||o[o.length-1];i.patchState({view:a})}setLeftColumnCollapsed(i,t){i.patchState({leftColumnCollapsed:t.collapsed})}showTimelineEditor(i,t){i.patchState({showTimelineEditor:t.show})}resetEditPage(i,t){i.setState(wt),i.dispatch(new Q.yk)}setCanvasSize(i,t){i.patchState({canvasSize:t.size})}static#e=this.\u0275fac=function(t){return new(t||po)};static#t=this.\u0275prov=e.jDH({token:po,factory:po.\u0275fac})};de([(0,l.rc)(P.zA),V("design:type",Function),V("design:paramtypes",[Object,P.zA]),V("design:returntype",void 0)],g.prototype,"SetLayerOrderMode",null),de([(0,l.rc)(P.m3),V("design:type",Function),V("design:paramtypes",[Object,P.m3]),V("design:returntype",void 0)],g.prototype,"ShowTreeNodeIds",null),de([(0,l.rc)(P.N6),V("design:type",Function),V("design:paramtypes",[Object,P.N6]),V("design:returntype",void 0)],g.prototype,"showRootNodes",null),de([(0,l.rc)(P.yF),V("design:type",Function),V("design:paramtypes",[Object,P.yF]),V("design:returntype",void 0)],g.prototype,"setView",null),de([(0,l.rc)(P.$j),V("design:type",Function),V("design:paramtypes",[Object,P.$j]),V("design:returntype",void 0)],g.prototype,"nextView",null),de([(0,l.rc)(P.hE),V("design:type",Function),V("design:paramtypes",[Object,P.$j]),V("design:returntype",void 0)],g.prototype,"previousView",null),de([(0,l.rc)(P.HZ),V("design:type",Function),V("design:paramtypes",[Object,P.HZ]),V("design:returntype",void 0)],g.prototype,"setLeftColumnCollapsed",null),de([(0,l.rc)(P.ud),V("design:type",Function),V("design:paramtypes",[Object,P.ud]),V("design:returntype",void 0)],g.prototype,"showTimelineEditor",null),de([(0,l.rc)(P.tV),V("design:type",Function),V("design:paramtypes",[Object,P.tV]),V("design:returntype",void 0)],g.prototype,"resetEditPage",null),de([(0,l.rc)(P.IW),V("design:type",Function),V("design:paramtypes",[Object,P.IW]),V("design:returntype",void 0)],g.prototype,"setCanvasSize",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getView",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getLeftColumnCollapsed",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getShowTimelineEditor",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getRecord",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getLayerOrderMode",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getShowTreeNodeIds",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getCanvasSize",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getCanvasSettings",null),de([(0,l.MD)(),V("design:type",Function),V("design:paramtypes",[$]),V("design:returntype",void 0)],g,"getShowRootNodes",null),g=de([(0,l.Uw)({name:"edit",defaults:wt,children:[L.i]})],g);var S=v(76304),E=v(22679),B=v(35160),O=v(21082),I=v(14264),y=v(37925),rt=v(38399),ve=v(36110),De=v(19833),Bt=v(32914),be=v(17365),K=v(87996),wn=v(87145),ze=v(11756),Dt=v(39705),ai=v(60830),Ee=v(66056),ie=v(47610),La=v(24911),ms=v(15810),Ya=v(4664),$e=v(38753),U=v(33013),j=v(94495),Ft=v(7431),tt=v(47632),je=v(21523),H=v(47555),Rt=v(12347),ke=v(93915),Oe=v(16823),c=v(89417),$i=v(29160),za=v(46104),ee=v(34006),R=v(49204),Fn=v(74394),us=v(24477),Xa=v(28722),ae=v(11789),hs=v(95419),uo=v(44334),se=v(65776),Gt=v(91442),fs=v(31462),Me=v(27180),Oi=v(11040),$t=v(45144),Xe=v(66571),Qa=v(13955),gs=v(70744),Rn=v(63508),Ot=v(11876),Pn=v(13976),Fe=v(24418);class qa extends uo.D{constructor(){super(...arguments),this.type=se.m.AnimatedImages}}class Ha{constructor(){this.type=se.m.CTA}}var Qe=v(95416),te=v(81391),Ae=v(82765),qe=v(5951),Ce=v(14823),Je=v(71997),Y=v(21007);let bs=(()=>{class s{constructor(t,n){this.templateRef=t,this.viewContainer=n}ngOnInit(){this.update()}update(){"bookmark"===Fe.c.exportType?this.viewContainer.createEmbeddedView(this.templateRef):this.viewContainer.clear()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.C4Q),e.rXU(e.c1b))};static#t=this.\u0275dir=e.FsC({type:s,selectors:[["","appFlagExternal",""]]})}return s})();var _s=v(82124),Z=v(87505),Pt=v(98101),X=v(26779),jn=v(77242),Mn=v(41640),jt=v(87424),Mt=v(57018),me=v(18111),Ai=v(11562);let bt=(()=>{class s{get value(){return this.getColorFromHex(this._value)}set value(t){const n=this.getHexFromColor(t);n!==this._value&&(this._value=n,this.propagateChange(t),this.changeDetectorRef.markForCheck())}get hexValue(){return this._value}constructor(t){this.changeDetectorRef=t,this.colorPosition="left",this.useRootContainer=!0,this.dataTestAttributeVal="",this.type="hex",this.decimal=!0,this.alpha=!1,this.disabled=!1,this.onChange=()=>{},this.onTouched=()=>{},this.propagateChange=n=>{}}ngOnInit(){}handleColorPickerChange(t){this.value=this.getColorFromHex(t),this.changeDetectorRef.markForCheck()}writeValue(t){this.value=t}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}getColorFromHex(t){switch(this.type){case"rgb":return ae.T.hexToRgb(t,this.decimal);case"rgba":return ae.T.hexToRgba(t,this.decimal);case"rgbColor":const[n,o,a]=ae.T.hexToRgb(t,this.decimal);return{r:n,g:o,b:a};default:return t}}getHexFromColor(t){if("object"==typeof t&&"r"in t){const{r:n,g:o,b:a}=t;return ae.T.rgbToHex([n,o,a],this.decimal)}if(Array.isArray(t)){const[n,o,a,r]=t;return 4===t.length?ae.T.rgbaToHex([n,o,a,r],this.decimal):ae.T.rgbToHex([n,o,a],this.decimal)}return t.toString()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-color-picker-input"]],inputs:{value:"value",colorPosition:"colorPosition",useRootContainer:"useRootContainer",dataTestAttributeVal:"dataTestAttributeVal",type:"type",decimal:"decimal",alpha:"alpha"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:3,vars:10,consts:[[1,"color-picker-input"],["type","text","cpOutputFormat","hex",1,"input","color-picker-input__input",3,"colorPickerChange","disabled","value","colorPicker","cpEyeDropper","cpAlphaChannel","cpUseRootViewContainer","cpPosition"],[1,"color-picker-input__color"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"input",1),e.bIt("colorPickerChange",function(r){return o.handleColorPickerChange(r)}),e.k0s(),e.nrm(2,"div",2),e.k0s()),2&n&&(e.R7$(),e.Y8G("disabled",o.disabled)("value",o.hexValue)("colorPicker",o.hexValue)("cpEyeDropper",!0)("cpAlphaChannel",o.alpha?"always":"disabled")("cpUseRootViewContainer",o.useRootContainer)("cpPosition",o.colorPosition),e.BMQ("data-test",o.dataTestAttributeVal),e.R7$(),e.xc7("background",o.hexValue))},dependencies:[Ai.bk],styles:[".color-picker-input[_ngcontent-%COMP%]{position:relative}.color-picker-input__input[_ngcontent-%COMP%]{padding-right:36px;width:100%}.color-picker-input__color[_ngcontent-%COMP%]{pointer-events:none;border:1px solid #1b283c;display:block;position:absolute;right:6px;top:6px;z-index:10;height:24px;width:24px;border-radius:50%}.theme-light[_nghost-%COMP%]   .color-picker-input__color[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .color-picker-input__color[_ngcontent-%COMP%]{border-color:#96a8c0}"],changeDetection:0})}return s})();var In=v(9065),At=function(s){return s.Basic="basic",s.Extended="extended",s.Full="full",s}(At||{});function ho(s,i){return Array(i+1).join(s)}var Za=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function fo(s){return go(s,Za)}var vs=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function Cs(s){return go(s,vs)}var ys=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function go(s,i){return i.indexOf(s.nodeName)>=0}function ks(s,i){return s.getElementsByTagName&&i.some(function(t){return s.getElementsByTagName(t).length})}var Ge={};function Nn(s){return s?s.replace(/(\n+\s*)+/g,"\n"):""}function Ts(s){for(var i in this.options=s,this._keep=[],this._remove=[],this.blankRule={replacement:s.blankReplacement},this.keepReplacement=s.keepReplacement,this.defaultRule={replacement:s.defaultReplacement},this.array=[],s.rules)this.array.push(s.rules[i])}function bo(s,i,t){for(var n=0;n<s.length;n++){var o=s[n];if(nr(o,i,t))return o}}function nr(s,i,t){var n=s.filter;if("string"==typeof n){if(n===i.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(i.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof n)throw new TypeError("`filter` needs to be a string, array, or function");if(n.call(s,i,t))return!0}}function _o(s){var i=s.nextSibling||s.parentNode;return s.parentNode.removeChild(s),i}function Ss(s,i,t){return s&&s.parentNode===i||t(i)?i.nextSibling||i.parentNode:i.firstChild||i.nextSibling||i.parentNode}Ge.paragraph={filter:"p",replacement:function(s){return"\n\n"+s+"\n\n"}},Ge.lineBreak={filter:"br",replacement:function(s,i,t){return t.br+"\n"}},Ge.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(s,i,t){var n=Number(i.nodeName.charAt(1));return"setext"===t.headingStyle&&n<3?"\n\n"+s+"\n"+ho(1===n?"=":"-",s.length)+"\n\n":"\n\n"+ho("#",n)+" "+s+"\n\n"}},Ge.blockquote={filter:"blockquote",replacement:function(s){return"\n\n"+(s=(s=s.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},Ge.list={filter:["ul","ol"],replacement:function(s,i){var t=i.parentNode;return"LI"===t.nodeName&&t.lastElementChild===i?"\n"+s:"\n\n"+s+"\n\n"}},Ge.listItem={filter:"li",replacement:function(s,i,t){s=s.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var n=t.bulletListMarker+"   ",o=i.parentNode;if("OL"===o.nodeName){var a=o.getAttribute("start"),r=Array.prototype.indexOf.call(o.children,i);n=(a?Number(a)+r:r+1)+".  "}return n+s+(i.nextSibling&&!/\n$/.test(s)?"\n":"")}},Ge.indentedCodeBlock={filter:function(s,i){return"indented"===i.codeBlockStyle&&"PRE"===s.nodeName&&s.firstChild&&"CODE"===s.firstChild.nodeName},replacement:function(s,i,t){return"\n\n    "+i.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},Ge.fencedCodeBlock={filter:function(s,i){return"fenced"===i.codeBlockStyle&&"PRE"===s.nodeName&&s.firstChild&&"CODE"===s.firstChild.nodeName},replacement:function(s,i,t){for(var N,o=((i.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],a=i.firstChild.textContent,r=t.fence.charAt(0),p=3,x=new RegExp("^"+r+"{3,}","gm");N=x.exec(a);)N[0].length>=p&&(p=N[0].length+1);var z=ho(r,p);return"\n\n"+z+o+"\n"+a.replace(/\n$/,"")+"\n"+z+"\n\n"}},Ge.horizontalRule={filter:"hr",replacement:function(s,i,t){return"\n\n"+t.hr+"\n\n"}},Ge.inlineLink={filter:function(s,i){return"inlined"===i.linkStyle&&"A"===s.nodeName&&s.getAttribute("href")},replacement:function(s,i){var t=i.getAttribute("href");t&&(t=t.replace(/([()])/g,"\\$1"));var n=Nn(i.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+s+"]("+t+n+")"}},Ge.referenceLink={filter:function(s,i){return"referenced"===i.linkStyle&&"A"===s.nodeName&&s.getAttribute("href")},replacement:function(s,i,t){var a,r,n=i.getAttribute("href"),o=Nn(i.getAttribute("title"));switch(o&&(o=' "'+o+'"'),t.linkReferenceStyle){case"collapsed":a="["+s+"][]",r="["+s+"]: "+n+o;break;case"shortcut":a="["+s+"]",r="["+s+"]: "+n+o;break;default:var p=this.references.length+1;a="["+s+"]["+p+"]",r="["+p+"]: "+n+o}return this.references.push(r),a},references:[],append:function(s){var i="";return this.references.length&&(i="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),i}},Ge.emphasis={filter:["em","i"],replacement:function(s,i,t){return s.trim()?t.emDelimiter+s+t.emDelimiter:""}},Ge.strong={filter:["strong","b"],replacement:function(s,i,t){return s.trim()?t.strongDelimiter+s+t.strongDelimiter:""}},Ge.code={filter:function(s){return"CODE"===s.nodeName&&!("PRE"===s.parentNode.nodeName&&!s.previousSibling&&!s.nextSibling)},replacement:function(s){if(!s)return"";s=s.replace(/\r?\n|\r/g," ");for(var i=/^`|^ .*?[^ ].* $|`$/.test(s)?" ":"",t="`",n=s.match(/`+/gm)||[];-1!==n.indexOf(t);)t+="`";return t+i+s+i+t}},Ge.image={filter:"img",replacement:function(s,i){var t=Nn(i.getAttribute("alt")),n=i.getAttribute("src")||"",o=Nn(i.getAttribute("title"));return n?"!["+t+"]("+n+(o?' "'+o+'"':"")+")":""}},Ts.prototype={add:function(s,i){this.array.unshift(i)},keep:function(s){this._keep.unshift({filter:s,replacement:this.keepReplacement})},remove:function(s){this._remove.unshift({filter:s,replacement:function(){return""}})},forNode:function(s){return s.isBlank?this.blankRule:(i=bo(this.array,s,this.options))||(i=bo(this._keep,s,this.options))||(i=bo(this._remove,s,this.options))?i:this.defaultRule;var i},forEach:function(s){for(var i=0;i<this.array.length;i++)s(this.array[i],i)}};var Co,vo=typeof window<"u"?window:{},lr=function sr(){var s=vo.DOMParser,i=!1;try{(new s).parseFromString("","text/html")&&(i=!0)}catch{}return i}()?vo.DOMParser:function ar(){var s=function(){};return s.prototype.parseFromString=function rr(){var s=!1;try{document.implementation.createHTMLDocument("").open()}catch{vo.ActiveXObject&&(s=!0)}return s}()?function(i){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(i),t.close(),t}:function(i){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(i),t.close(),t},s}();function cr(s,i){var t;return function or(s){var i=s.element,t=s.isBlock,n=s.isVoid,o=s.isPre||function(W){return"PRE"===W.nodeName};if(i.firstChild&&!o(i)){for(var a=null,r=!1,p=null,x=Ss(p,i,o);x!==i;){if(3===x.nodeType||4===x.nodeType){var N=x.data.replace(/[ \r\n\t]+/g," ");if((!a||/ $/.test(a.data))&&!r&&" "===N[0]&&(N=N.substr(1)),!N){x=_o(x);continue}x.data=N,a=x}else{if(1!==x.nodeType){x=_o(x);continue}t(x)||"BR"===x.nodeName?(a&&(a.data=a.data.replace(/ $/,"")),a=null,r=!1):n(x)||o(x)?(a=null,r=!0):a&&(r=!1)}var z=Ss(p,x,o);p=x,x=z}a&&(a.data=a.data.replace(/ $/,""),a.data||_o(a))}}({element:t="string"==typeof s?function pr(){return Co=Co||new lr}().parseFromString('<x-turndown id="turndown-root">'+s+"</x-turndown>","text/html").getElementById("turndown-root"):s.cloneNode(!0),isBlock:fo,isVoid:Cs,isPre:i.preformattedCode?dr:null}),t}function dr(s){return"PRE"===s.nodeName||"CODE"===s.nodeName}function mr(s,i){return s.isBlock=fo(s),s.isCode="CODE"===s.nodeName||s.parentNode.isCode,s.isBlank=function ur(s){return!Cs(s)&&!function tr(s){return go(s,ys)}(s)&&/^\s*$/i.test(s.textContent)&&!function er(s){return ks(s,vs)}(s)&&!function ir(s){return ks(s,ys)}(s)}(s),s.flankingWhitespace=function hr(s,i){if(s.isBlock||i.preformattedCode&&s.isCode)return{leading:"",trailing:""};var t=function fr(s){var i=s.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:i[1],leadingAscii:i[2],leadingNonAscii:i[3],trailing:i[4],trailingNonAscii:i[5],trailingAscii:i[6]}}(s.textContent);return t.leadingAscii&&xs("left",s,i)&&(t.leading=t.leadingNonAscii),t.trailingAscii&&xs("right",s,i)&&(t.trailing=t.trailingNonAscii),{leading:t.leading,trailing:t.trailing}}(s,i),s}function xs(s,i,t){var n,o,a;return"left"===s?(n=i.previousSibling,o=/ $/):(n=i.nextSibling,o=/^ /),n&&(3===n.nodeType?a=o.test(n.nodeValue):t.preformattedCode&&"CODE"===n.nodeName?a=!1:1===n.nodeType&&!fo(n)&&(a=o.test(n.textContent))),a}var gr=Array.prototype.reduce,br=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Bn(s){if(!(this instanceof Bn))return new Bn(s);this.options=function Wa(s){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)t.hasOwnProperty(n)&&(s[n]=t[n])}return s}({},{rules:Ge,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(t,n){return n.isBlock?"\n\n":""},keepReplacement:function(t,n){return n.isBlock?"\n\n"+n.outerHTML+"\n\n":n.outerHTML},defaultReplacement:function(t,n){return n.isBlock?"\n\n"+t+"\n\n":t}},s),this.rules=new Ts(this.options)}function Es(s){var i=this;return gr.call(s.childNodes,function(t,n){var o="";return 3===(n=new mr(n,i.options)).nodeType?o=n.isCode?n.nodeValue:i.escape(n.nodeValue):1===n.nodeType&&(o=vr.call(i,n)),ws(t,o)},"")}function _r(s){var i=this;return this.rules.forEach(function(t){"function"==typeof t.append&&(s=ws(s,t.append(i.options)))}),s.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function vr(s){var i=this.rules.forNode(s),t=Es.call(this,s),n=s.flankingWhitespace;return(n.leading||n.trailing)&&(t=t.trim()),n.leading+i.replacement(t,s,this.options)+n.trailing}function ws(s,i){var t=function Ka(s){for(var i=s.length;i>0&&"\n"===s[i-1];)i--;return s.substring(0,i)}(s),n=function Ja(s){return s.replace(/^\n*/,"")}(i),o=Math.max(s.length-t.length,i.length-n.length);return t+"\n\n".substring(0,o)+n}Bn.prototype={turndown:function(s){if(!function Cr(s){return null!=s&&("string"==typeof s||s.nodeType&&(1===s.nodeType||9===s.nodeType||11===s.nodeType))}(s))throw new TypeError(s+" is not a string, or an element/document/fragment node.");if(""===s)return"";var i=Es.call(this,new cr(s,this.options));return _r.call(this,i)},use:function(s){if(Array.isArray(s))for(var i=0;i<s.length;i++)this.use(s[i]);else{if("function"!=typeof s)throw new TypeError("plugin must be a Function or an Array of Functions");s(this)}return this},addRule:function(s,i){return this.rules.add(s,i),this},keep:function(s){return this.rules.keep(s),this},remove:function(s){return this.rules.remove(s),this},escape:function(s){return br.reduce(function(i,t){return i.replace(t[0],t[1])},s)}};const yr=Bn;var kr=v(1314);const Tr=new yr({headingStyle:"atx"}).keep(kr.cb);var xr=v(91163),Dn=v(68947),Gn=v(35286);const Er=["containerEl"],wr=["toolbarEl"],Fr=["editEl"],Rr={[At.Basic]:["superscript","subscript"],[At.Extended]:["bold","italic","anchor","superscript","subscript"],[At.Full]:["bold","italic","anchor","orderedlist","unorderedlist","superscript","subscript"]};let Ut=(()=>{class s{set rows(t){this._rows=t,this.setRows(t)}get rows(){return this._rows}get value(){return this._value}set value(t){t!==this.value&&(this._value=t,this.handleValueUpdate())}constructor(t,n){this.renderer2=t,this.markdownService=n,this.resizeable=!0,this.inline=!0,this.compact=!1,this.mode=At.Full,this.textMode="textarea",this.textValue="",this.editorFocused=(0,e.vPA)(!1),this.valueChanges=new f.B,this.ngUnsubscribe=new f.B}ngAfterViewInit(){this.initEditor(),this.initListeners(),this.initContentLabel()}ngOnDestroy(){this.editor.destroy(),this.valueChanges.complete(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEditor(){var t=this;return(0,A.A)(function*(){t.editor=new xr(t.editEl.nativeElement,{toolbar:{relativeContainer:t.inline?t.toolbarEl.nativeElement:null,buttons:Rr[t.mode]},targetBlank:!0,buttonLabels:"fontawesome",paste:{forcePlainText:t.mode===At.Basic,cleanPastedHTML:t.mode!==At.Basic},anchor:{linkValidation:!0},disableReturn:"text"===t.textMode,placeholder:!!t.placeholder&&{text:t.placeholder}}),t.getEditorValueChanges(t.editor).pipe((0,I.p)(n=>{const o="number"==typeof t.maxLength,a=Dn.l.getPlainTextFromHTML(t.renderer2,n),r=o&&a.length>t.maxLength;return r&&t.setEditorValue(t.value),!r}),(0,In.Z)(125),(0,y.Q)(t.ngUnsubscribe)).subscribe(n=>{const o=function Sr(s){return Tr.turndown(s)}(n);o!==t.value&&(t.value=o,t.onChange(t.value))}),t.getEditorEvent(t.editor,"focus").pipe((0,y.Q)(t.ngUnsubscribe)).subscribe(()=>{t.editorFocused.set(!0)}),t.getEditorEvent(t.editor,"blur").pipe((0,y.Q)(t.ngUnsubscribe)).subscribe(()=>{t.editorFocused.set(!1)}),t.setEditorValue(t.value),t.setRows(t.rows)})()}initListeners(){(0,h.R)(this.editEl.nativeElement,"keydown").pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t.stopPropagation()})}initContentLabel(){const t=this.containerEl.nativeElement.closest("label");if(!(0,R.isNil)(t)){const n=t.getAttribute("aria-label")||"",o="textarea"===this.textMode;this.editEl.nativeElement.setAttribute("aria-label",n),this.editEl.nativeElement.setAttribute("aria-multiline",o.toString())}}getValueChanges(){return this.valueChanges.asObservable()}getEditorValue(t){return t.getContent(0)}getEditorValueChanges(t){return this.getEditorEvent(t,"editableInput").pipe((0,ve.T)(()=>this.getEditorValue(t)))}getEditorEvent(t,n){return new _.c(o=>{t.subscribe(n,a=>{o.next(a)})})}setEditorValue(t){var n=this;return(0,A.A)(function*(){if(n.editor){const o=yield n.markdownService.parse(t);n.editor.setContent(o)}})()}setRows(t){if(this.editEl&&this.editEl.nativeElement){this.renderer2.setStyle(this.editEl.nativeElement,"height",typeof t>"u"?"auto":16+16*t+"px")}}onChange(t){}onTouched(){}writeValue(t){t!==this.value&&(this.value=t,this.setEditorValue(t))}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t||void 0}handleValueUpdate(){var t=this;return(0,A.A)(function*(){t.textValue=yield Dn.l.getPlainTextFromMarkdown(t.renderer2,t.markdownService,t.value),t.valueChanges.next(t.value)})()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.sFG),e.rXU(Gn.Rl))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-rich-text-edit"]],viewQuery:function(n,o){if(1&n&&(e.GBs(Er,7),e.GBs(wr,7),e.GBs(Fr,7)),2&n){let a;e.mGM(a=e.lsd())&&(o.containerEl=a.first),e.mGM(a=e.lsd())&&(o.toolbarEl=a.first),e.mGM(a=e.lsd())&&(o.editEl=a.first)}},inputs:{rows:"rows",disabled:"disabled",resizeable:"resizeable",inline:"inline",compact:"compact",mode:"mode",textMode:"textMode",maxLength:"maxLength",placeholder:"placeholder"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:6,vars:13,consts:[["containerEl",""],["editEl",""],["toolbarEl",""],[1,"rich-text-edit"],["role","textbox",1,"rich-text-edit__editor","html","input"],[1,"rich-text-edit__toolbar","medium-editor-toolbar-container"]],template:function(n,o){1&n&&(e.j41(0,"div",3,0),e.nrm(2,"div",4,1)(4,"div",5,2),e.k0s()),2&n&&(e.AVh("rich-text-edit--inline",!0===o.inline)("medium-editor-focused",o.editorFocused())("medium-editor-compact",o.compact),e.R7$(2),e.AVh("rich-text-edit__editor--text","text"===o.textMode)("rich-text-edit__editor--textarea","textarea"===o.textMode)("rich-text-edit__editor--resizeable",o.resizeable),e.BMQ("data-disable-editing",o.disabled))},styles:[".input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,mat-select.input,textarea.input{border:1px solid #1b283c;border-radius:4px;background-color:#101823;color:#fff;display:block;min-height:36px;width:100%;font-size:14px;padding:8px 12px;font-family:Inter,sans-serif}@supports (font-variation-settings: normal){.input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,mat-select.input,textarea.input{font-family:Inter UI var alt,sans-serif}}.input:focus,[type=text].input:focus,[type=number].input:focus,[type=email].input:focus,[type=password].input:focus,[type=file].input:focus,[type=url].input:focus,select.input:focus,mat-select.input:focus,textarea.input:focus{outline:#2d72dc solid 2px!important}.input:focus.ng-invalid,[type=text].input:focus.ng-invalid,[type=number].input:focus.ng-invalid,[type=email].input:focus.ng-invalid,[type=password].input:focus.ng-invalid,[type=file].input:focus.ng-invalid,[type=url].input:focus.ng-invalid,select.input:focus.ng-invalid,mat-select.input:focus.ng-invalid,textarea.input:focus.ng-invalid{outline-color:#ed4758!important;outline-width:1px!important}.input--small,[type=text].input--small,[type=number].input--small,[type=email].input--small,[type=password].input--small,[type=file].input--small,[type=url].input--small,select.input--small,mat-select.input--small,textarea.input--small{font-size:12px;padding:8px;min-height:auto}.input--large,[type=text].input--large,[type=number].input--large,[type=email].input--large,[type=password].input--large,[type=file].input--large,[type=url].input--large,select.input--large,mat-select.input--large,textarea.input--large{font-size:16px;padding:12px}.input--success,[type=text].input--success,[type=number].input--success,[type=email].input--success,[type=password].input--success,[type=file].input--success,[type=url].input--success,select.input--success,mat-select.input--success,textarea.input--success{border-color:#38de38!important}.input:disabled,.input.mat-mdc-select-disabled,[type=text].input:disabled,[type=text].input.mat-mdc-select-disabled,[type=number].input:disabled,[type=number].input.mat-mdc-select-disabled,[type=email].input:disabled,[type=email].input.mat-mdc-select-disabled,[type=password].input:disabled,[type=password].input.mat-mdc-select-disabled,[type=file].input:disabled,[type=file].input.mat-mdc-select-disabled,[type=url].input:disabled,[type=url].input.mat-mdc-select-disabled,select.input:disabled,select.input.mat-mdc-select-disabled,mat-select.input:disabled,mat-select.input.mat-mdc-select-disabled,textarea.input:disabled,textarea.input.mat-mdc-select-disabled{opacity:.4}.input.ng-dirty.ng-invalid,[type=text].input.ng-dirty.ng-invalid,[type=number].input.ng-dirty.ng-invalid,[type=email].input.ng-dirty.ng-invalid,[type=password].input.ng-dirty.ng-invalid,[type=file].input.ng-dirty.ng-invalid,[type=url].input.ng-dirty.ng-invalid,select.input.ng-dirty.ng-invalid,mat-select.input.ng-dirty.ng-invalid,textarea.input.ng-dirty.ng-invalid{border:1px solid #ed4758}textarea.input--nonresizable{resize:none}select.input{height:36px}input.theme-dark,select.theme-dark,textarea.theme-dark,.theme-dark .input[type=text],.theme-dark .input[type=number],.theme-dark .input[type=email],.theme-dark .input[type=password],.theme-dark .input[type=file],.theme-dark .input[type=url],.theme-dark select.input,.theme-light mat-select.input,.theme-dark textarea.input{background-color:#101823;border:1px solid #374a68;color:#fff}input.theme-light,select.theme-light,textarea.theme-light,.theme-light .input[type=text],.theme-light .input[type=number],.theme-light .input[type=email],.theme-light .input[type=password],.theme-light .input[type=file],.theme-light .input[type=url],.theme-light select.input,.theme-light mat-select.input,.theme-light textarea.input{background-color:#fff;border:1px solid #96a8c0;color:#283853}input.theme-light:focus,select.theme-light:focus,textarea.theme-light:focus,.theme-light .input[type=text]:focus,.theme-light .input[type=number]:focus,.theme-light .input[type=email]:focus,.theme-light .input[type=password]:focus,.theme-light .input[type=file]:focus,.theme-light .input[type=url]:focus,.theme-light select.input:focus,.theme-light mat-select.input:focus,.theme-light textarea.input:focus{background-color:#fff}input.theme-light::placeholder,select.theme-light::placeholder,textarea.theme-light::placeholder,.theme-light .input[type=text]::placeholder,.theme-light .input[type=number]::placeholder,.theme-light .input[type=email]::placeholder,.theme-light .input[type=password]::placeholder,.theme-light .input[type=file]::placeholder,.theme-light .input[type=url]::placeholder,.theme-light select.input::placeholder,.theme-light mat-select.input::placeholder,.theme-light textarea.input::placeholder{color:#374a6880}.rich-text-edit{border-radius:4px;padding:0;position:relative}.rich-text-edit__toolbar{display:none;border-top:none;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.rich-text-edit__editor{font-size:12px;border-bottom:none!important}.rich-text-edit__editor--text{border:none!important;box-shadow:none!important;display:inline-block;height:1em}.rich-text-edit__editor--textarea{border:none!important;box-shadow:none!important;overflow:auto;contain:size}.rich-text-edit__editor--resizeable{resize:vertical}.rich-text-edit--inline{display:flex;flex-direction:column}.rich-text-edit--inline .rich-text-edit__toolbar{display:block}.theme-dark .rich-text-edit,.theme-dark .rich-text-edit__editor--text,.theme-dark .rich-text-edit__editor--textarea{background-color:#101823;border:1px solid #374a68;color:#fff}.theme-light .rich-text-edit{background-color:#fff;border:1px solid #96a8c0;color:#283853}.theme-light .rich-text-edit:focus{background-color:#fff}.theme-light .rich-text-edit::placeholder{color:#374a6880}.theme-light .rich-text-edit__editor--text,.theme-light .rich-text-edit__editor--textarea{background-color:#fff;border:1px solid #96a8c0;color:#283853}.theme-light .rich-text-edit__editor--text:focus,.theme-light .rich-text-edit__editor--textarea:focus{background-color:#fff}.theme-light .rich-text-edit__editor--text::placeholder,.theme-light .rich-text-edit__editor--textarea::placeholder{color:#374a6880}\n",'.medium-editor-anchor-preview,.medium-editor-toolbar{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;z-index:2000}@keyframes medium-editor-image-loading{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes medium-editor-pop-upwards{0%{opacity:0;transform:matrix(.97,0,0,1,0,12)}20%{opacity:.7;transform:matrix(.99,0,0,1,0,2)}40%{opacity:1;transform:matrix(1,0,0,1,0,-1)}to{transform:scale(1)}}.medium-editor-anchor-preview{left:0;line-height:1.4;max-width:280px;position:absolute;text-align:center;top:0;word-break:break-all;word-wrap:break-word;visibility:hidden}.medium-editor-anchor-preview a{color:#fff;display:inline-block;margin:5px 5px 10px}.medium-editor-placeholder-relative:after,.medium-editor-placeholder:after{content:attr(data-placeholder)!important;white-space:pre;padding:inherit;margin:inherit;font-style:italic}.medium-editor-anchor-preview-active{visibility:visible}.medium-editor-dragover{background:#ddd}.medium-editor-image-loading{animation:medium-editor-image-loading 1s infinite ease-in-out;background-color:#333;border-radius:100%;display:inline-block;height:40px;width:40px}.medium-editor-placeholder{position:relative}.medium-editor-placeholder:after{position:absolute;left:0;top:0}.medium-editor-placeholder-relative,.medium-editor-placeholder-relative:after{position:relative}.medium-toolbar-arrow-over:before,.medium-toolbar-arrow-under:after{border-style:solid;content:"";display:block;height:0;left:50%;margin-left:-8px;position:absolute;width:0}.medium-toolbar-arrow-under:after{border-width:8px 8px 0}.medium-toolbar-arrow-over:before{border-width:0 8px 8px;top:-8px}.medium-editor-toolbar{left:0;position:absolute;top:0;visibility:hidden}.medium-editor-toolbar ul{margin:0;padding:0}.medium-editor-toolbar li{float:left;list-style:none;margin:0;padding:0}.medium-editor-toolbar li button{box-sizing:border-box;cursor:pointer;display:block;font-size:14px;line-height:1.33;margin:0;padding:15px;text-decoration:none}.medium-editor-toolbar li button:focus{outline:0}.medium-editor-toolbar li .medium-editor-action-underline{text-decoration:underline}.medium-editor-toolbar li .medium-editor-action-pre{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;font-weight:100;padding:15px 0}.medium-editor-toolbar-active{visibility:visible}.medium-editor-sticky-toolbar{position:fixed;top:1px}.medium-editor-relative-toolbar{position:relative}.medium-editor-toolbar-active.medium-editor-stalker-toolbar{animation:medium-editor-pop-upwards .16s forwards linear}.medium-editor-action-bold{font-weight:bolder}.medium-editor-action-italic{font-style:italic}.medium-editor-toolbar-form{display:none}.medium-editor-toolbar-form a,.medium-editor-toolbar-form input{font-family:Helvetica Neue,Helvetica,Arial,sans-serif}.medium-editor-toolbar-form .medium-editor-toolbar-form-row{line-height:14px;margin-left:5px;padding-bottom:5px}.medium-editor-toolbar-form .medium-editor-toolbar-input,.medium-editor-toolbar-form label{border:none;box-sizing:border-box;font-size:14px;margin:0;padding:6px;width:316px;display:inline-block}.medium-editor-toolbar-form .medium-editor-toolbar-input:focus,.medium-editor-toolbar-form label:focus{appearance:none;border:none;box-shadow:none;outline:0}.medium-editor-toolbar-form a{display:inline-block;font-size:24px;font-weight:bolder;margin:0 10px;text-decoration:none}.medium-editor-toolbar-form-active{display:block}.medium-editor-toolbar-actions:after{clear:both;content:"";display:table}.medium-editor-element{word-wrap:break-word;min-height:30px}.medium-editor-element img{max-width:100%}.medium-editor-element sub{vertical-align:sub}.medium-editor-element sup{vertical-align:super}.medium-editor-hidden{display:none}\n',".input,:root .medium-editor-toolbar-form .medium-editor-toolbar-input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,mat-select.input,textarea.input{border:1px solid #1b283c;border-radius:4px;background-color:#101823;color:#fff;display:block;min-height:36px;width:100%;font-size:14px;padding:8px 12px;font-family:Inter,sans-serif}@supports (font-variation-settings: normal){.input,:root .medium-editor-toolbar-form .medium-editor-toolbar-input,[type=text].input,[type=number].input,[type=email].input,[type=password].input,[type=file].input,[type=url].input,select.input,mat-select.input,textarea.input{font-family:Inter UI var alt,sans-serif}}.input:focus,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:focus,[type=text].input:focus,[type=number].input:focus,[type=email].input:focus,[type=password].input:focus,[type=file].input:focus,[type=url].input:focus,select.input:focus,mat-select.input:focus,textarea.input:focus{outline:#2d72dc solid 2px!important}.input:focus.ng-invalid,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:focus.ng-invalid,[type=text].input:focus.ng-invalid,[type=number].input:focus.ng-invalid,[type=email].input:focus.ng-invalid,[type=password].input:focus.ng-invalid,[type=file].input:focus.ng-invalid,[type=url].input:focus.ng-invalid,select.input:focus.ng-invalid,mat-select.input:focus.ng-invalid,textarea.input:focus.ng-invalid{outline-color:#ed4758!important;outline-width:1px!important}.input--small,[type=text].input--small,[type=number].input--small,[type=email].input--small,[type=password].input--small,[type=file].input--small,[type=url].input--small,select.input--small,mat-select.input--small,textarea.input--small{font-size:12px;padding:8px;min-height:auto}.input--large,[type=text].input--large,[type=number].input--large,[type=email].input--large,[type=password].input--large,[type=file].input--large,[type=url].input--large,select.input--large,mat-select.input--large,textarea.input--large{font-size:16px;padding:12px}.input--success,[type=text].input--success,[type=number].input--success,[type=email].input--success,[type=password].input--success,[type=file].input--success,[type=url].input--success,select.input--success,mat-select.input--success,textarea.input--success{border-color:#38de38!important}.input:disabled,:root .medium-editor-toolbar-form .medium-editor-toolbar-input:disabled,.input.mat-mdc-select-disabled,:root .medium-editor-toolbar-form .mat-mdc-select-disabled.medium-editor-toolbar-input,[type=text].input:disabled,[type=text].input.mat-mdc-select-disabled,[type=number].input:disabled,[type=number].input.mat-mdc-select-disabled,[type=email].input:disabled,[type=email].input.mat-mdc-select-disabled,[type=password].input:disabled,[type=password].input.mat-mdc-select-disabled,[type=file].input:disabled,[type=file].input.mat-mdc-select-disabled,[type=url].input:disabled,[type=url].input.mat-mdc-select-disabled,select.input:disabled,select.input.mat-mdc-select-disabled,mat-select.input:disabled,mat-select.input.mat-mdc-select-disabled,textarea.input:disabled,textarea.input.mat-mdc-select-disabled{opacity:.4}.input.ng-dirty.ng-invalid,:root .medium-editor-toolbar-form .ng-dirty.ng-invalid.medium-editor-toolbar-input,[type=text].input.ng-dirty.ng-invalid,[type=number].input.ng-dirty.ng-invalid,[type=email].input.ng-dirty.ng-invalid,[type=password].input.ng-dirty.ng-invalid,[type=file].input.ng-dirty.ng-invalid,[type=url].input.ng-dirty.ng-invalid,select.input.ng-dirty.ng-invalid,mat-select.input.ng-dirty.ng-invalid,textarea.input.ng-dirty.ng-invalid{border:1px solid #ed4758}textarea.input--nonresizable{resize:none}select.input,:root .medium-editor-toolbar-form select.medium-editor-toolbar-input{height:36px}input.theme-dark,select.theme-dark,textarea.theme-dark,.theme-dark .input[type=text],:root .theme-dark .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=text].medium-editor-toolbar-input,.theme-dark .input[type=number],:root .theme-dark .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=number].medium-editor-toolbar-input,.theme-dark .input[type=email],:root .theme-dark .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=email].medium-editor-toolbar-input,.theme-dark .input[type=password],:root .theme-dark .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=password].medium-editor-toolbar-input,.theme-dark .input[type=file],:root .theme-dark .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=file].medium-editor-toolbar-input,.theme-dark .input[type=url],:root .theme-dark .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark [type=url].medium-editor-toolbar-input,.theme-dark select.input,:root .theme-dark .medium-editor-toolbar-form select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark select.medium-editor-toolbar-input,.theme-light mat-select.input,:root .theme-light .medium-editor-toolbar-form mat-select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light mat-select.medium-editor-toolbar-input,.theme-dark textarea.input,:root .theme-dark .medium-editor-toolbar-form textarea.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-dark textarea.medium-editor-toolbar-input{background-color:#101823;border:1px solid #374a68;color:#fff}input.theme-light,select.theme-light,textarea.theme-light,.theme-light .input[type=text],:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input,.theme-light .input[type=number],:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input,.theme-light .input[type=email],:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input,.theme-light .input[type=password],:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input,.theme-light .input[type=file],:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input,.theme-light .input[type=url],:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input,.theme-light select.input,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input,.theme-light mat-select.input,:root .theme-light .medium-editor-toolbar-form mat-select.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light mat-select.medium-editor-toolbar-input,.theme-light textarea.input,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input{background-color:#fff;border:1px solid #96a8c0;color:#283853}input.theme-light:focus,select.theme-light:focus,textarea.theme-light:focus,.theme-light .input[type=text]:focus,:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input:focus,.theme-light .input[type=number]:focus,:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input:focus,.theme-light .input[type=email]:focus,:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input:focus,.theme-light .input[type=password]:focus,:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input:focus,.theme-light .input[type=file]:focus,:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input:focus,.theme-light .input[type=url]:focus,:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input:focus,.theme-light select.input:focus,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input:focus,.theme-light mat-select.input:focus,:root .theme-light .medium-editor-toolbar-form mat-select.medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light mat-select.medium-editor-toolbar-input:focus,.theme-light textarea.input:focus,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input:focus,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input:focus{background-color:#fff}input.theme-light::placeholder,select.theme-light::placeholder,textarea.theme-light::placeholder,.theme-light .input[type=text]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=text].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=text].medium-editor-toolbar-input::placeholder,.theme-light .input[type=number]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=number].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=number].medium-editor-toolbar-input::placeholder,.theme-light .input[type=email]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=email].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=email].medium-editor-toolbar-input::placeholder,.theme-light .input[type=password]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=password].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=password].medium-editor-toolbar-input::placeholder,.theme-light .input[type=file]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=file].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=file].medium-editor-toolbar-input::placeholder,.theme-light .input[type=url]::placeholder,:root .theme-light .medium-editor-toolbar-form [type=url].medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light [type=url].medium-editor-toolbar-input::placeholder,.theme-light select.input::placeholder,:root .theme-light .medium-editor-toolbar-form select.medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light select.medium-editor-toolbar-input::placeholder,.theme-light mat-select.input::placeholder,:root .theme-light .medium-editor-toolbar-form mat-select.medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light mat-select.medium-editor-toolbar-input::placeholder,.theme-light textarea.input::placeholder,:root .theme-light .medium-editor-toolbar-form textarea.medium-editor-toolbar-input::placeholder,:root .medium-editor-toolbar-form .theme-light textarea.medium-editor-toolbar-input::placeholder{color:#374a6880}:root{--medium-toolbar-color: #131c2a;--medium-font-color: $gray-60;--medium-hover-font-color: $gray-60;--medium-selected-font-color: $gray-70;--medium-toolbar-border-color: $gray-20}:root .medium-editor-element{min-height:inherit}:root .medium-editor-relative-toolbar.medium-editor-toolbar{visibility:visible!important}:root .medium-toolbar-arrow-under:after{top:36px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:0;border-top:8px solid var(--medium-font-color)}:root .medium-toolbar-arrow-over:before{top:-8px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--medium-font-color);border-top:0}:root .medium-editor-toolbar{background-color:transparent;border-top:1px solid transparent;opacity:.3;z-index:500;margin-top:2px}:root .medium-editor-toolbar.medium-editor-stalker-toolbar{background-color:var(--medium-toolbar-color);border:1px solid var(--medium-toolbar-border-color);border-radius:4px;opacity:1}:root .medium-editor-toolbar li{margin:2px;padding:0}:root .medium-editor-toolbar li button{min-width:32px;height:32px;padding:8px;background-color:transparent;border:0;border-radius:0;color:var(--medium-font-color);transition:background-color .3s ease-in;font-size:12px}:root .medium-editor-action{color:var(--medium-font-color);border-top:1px solid transparent}:root .medium-editor-action:hover{color:var(--medium-hover-font-color);border-radius:4px}:root .medium-editor-action.medium-editor-button-active{color:var(--medium-selected-font-color)}:root .medium-editor-focused .medium-editor-toolbar{background-color:var(--medium-toolbar-color);border-top:1px solid var(--medium-toolbar-border-color);opacity:1}:root .medium-editor-compact .medium-editor-toolbar li{margin:0;padding:0}:root .medium-editor-compact .medium-editor-toolbar li button{min-width:30px;height:30px;padding:4px}:root .medium-editor-toolbar-form{padding:4px;border-radius:4px;color:var(--medium-selected-font-color)}:root .medium-editor-toolbar-form .medium-editor-toolbar-input{flex:1;box-sizing:border-box;color:var(--medium-selected-font-color)!important;background-color:var(--medium-toolbar-color)!important}:root .medium-editor-toolbar-form .medium-editor-toolbar-save,:root .medium-editor-toolbar-form .medium-editor-toolbar-close{margin:8px;padding:0;width:auto;height:auto;font-size:1em}:root .medium-editor-toolbar-form a{color:var(--medium-selected-font-color)}:root .medium-editor-toolbar-form-active{display:flex;flex-direction:row;align-items:center}:root .medium-editor-toolbar-anchor-preview{border-radius:4px;border:1px solid var(--medium-font-color);background-color:var(--medium-toolbar-color);color:var(--medium-font-color);font-size:12}:root .medium-editor-placeholder:after{color:var(--medium-font-color)}.theme-dark{--medium-toolbar-color: #131c2a;--medium-font-color: rgba(150, 168, 192, .6);--medium-hover-font-color: rgba(150, 168, 192, .8);--medium-selected-font-color: #d7e0ea;--medium-toolbar-border-color: #1c2a3f}.theme-light{--medium-toolbar-color: #f9fafd;--medium-font-color: rgba(40, 56, 83, .6);--medium-hover-font-color: rgba(40, 56, 83, .8);--medium-selected-font-color: #283853;--medium-toolbar-border-color: #d7e0ea}\n"],encapsulation:2,changeDetection:0})}return s})();var Ui=v(56657),Fs=v(46075);function Pr(s,i){if(1&s&&(e.j41(0,"div",7),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.description)}}function jr(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",8)(1,"div",9),e.nrm(2,"app-icon",10),e.k0s(),e.j41(3,"div",11)(4,"app-form-field",12),e.nrm(5,"app-content-upload-input",13),e.k0s(),e.j41(6,"div",14)(7,"app-form-field",15),e.nrm(8,"app-rich-text-edit",16,0)(10,"app-character-counter",17),e.k0s(),e.j41(11,"app-form-field",18),e.nrm(12,"textarea",19),e.k0s()()(),e.j41(13,"div",20)(14,"button",21),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRemoveImage(o))}),e.nrm(15,"app-icon",22),e.k0s()()()}if(2&s){const t=i.$implicit,n=e.sdS(9),o=e.XpG();e.Y8G("formGroup",t),e.R7$(4),e.Y8G("labelElement",!1)("label",o.title),e.R7$(),e.Y8G("canDelete",!1)("type",o.uploadType),e.R7$(3),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",n),e.R7$(4),e.Mz_("matTooltip","Remove ",o.title,"")}}const yo={[se.m.Images]:{uploadType:Fs.Sq.Image,title:"Image",description:""},[se.m.AnimatedImages]:{uploadType:Fs.Sq.AnimatedImage,title:"Animated GIF",description:"Upload videos (< 15 secs) to create an animated looping image (GIF), or upload your own in .webp format."}};let Mr=(()=>{class s{get type(){return this._type}set type(t){this._type=t,this.uploadType=yo[this.type].uploadType,this.title=yo[this.type].title,this.description=yo[this.type].description}get imageBlockImages(){return this.controlContainer.control.get("images")}constructor(t,n){this.controlContainer=t,this.formBuilder=n,this.max=1/0}ngOnDestroy(){this.removeEmptyImages()}handleAddImage(){const t=new uo.Y;this.imageBlockImages.push(this.addImage(t))}addImage(t){return this.formBuilder.group({urls:t.urls,alt:[t.alt,c.k0.maxLength(200)],caption:[t.caption,c.k0.maxLength(200)]})}handleRemoveImage(t){this.imageBlockImages.removeAt(t)}handleImageDrop(t){const{previousIndex:n,currentIndex:o}=t,a=this.imageBlockImages.at(n);this.imageBlockImages.removeAt(n),this.imageBlockImages.insert(o,a)}removeEmptyImages(){const t=this.imageBlockImages.value;for(let n=t.length-1;n>=0;n--)t[n].urls||this.imageBlockImages.removeAt(n)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ZU),e.rXU(c.ze))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-images-block"]],inputs:{max:"max",type:"type"},decls:8,vars:6,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],["class","text-xs mb-2",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","images",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button",3,"click","disabled"],[1,"text-xs","mb-2"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],[1,"flex","edit-block__body"],[1,"pr-1",2,"flex","0 0 240px",3,"labelElement","label"],["formControlName","urls",3,"canDelete","type"],[1,"grow"],["label","Label"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],["label","Alt"],["formControlName","alt",1,"input","edit-block__alt"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle",3,"click","matTooltip"],["icon","times"]],template:function(n,o){1&n&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2),e.k0s(),e.DNE(3,Pr,2,1,"div",3),e.j41(4,"div",4),e.bIt("cdkDropListDropped",function(r){return o.handleImageDrop(r)}),e.DNE(5,jr,16,12,"div",5),e.j41(6,"button",6),e.bIt("click",function(){return o.handleAddImage()}),e.EFF(7),e.k0s()(),e.bVm()),2&n&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(2),e.SpI("",o.title,"s"),e.R7$(),e.Y8G("ngIf",o.description),e.R7$(2),e.Y8G("ngForOf",o.imageBlockImages.controls),e.R7$(),e.Y8G("disabled",o.imageBlockImages.controls.length>=o.max),e.R7$(),e.SpI(" Add ",o.title," "))},dependencies:[w.Sq,w.bT,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,Z.K,Pt.P,X.R,Ui.c,te.O7,te.T1,te.Fb,Ut,Y.Q,Ce.oV],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__body[_ngcontent-%COMP%]{flex:1 0 auto}.edit-block__alt[_ngcontent-%COMP%]{resize:vertical}"],changeDetection:0})}return s})();var Vi=v(59369);function Ir(s,i){1&s&&(e.qex(0),e.j41(1,"mat-checkbox",4),e.EFF(2,"Show EKG Graph"),e.k0s(),e.bVm())}function Nr(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",11)(1,"div",12),e.nrm(2,"app-icon",13),e.k0s(),e.j41(3,"div",14)(4,"app-form-field",15),e.nrm(5,"app-content-upload-input",16),e.k0s(),e.j41(6,"app-form-field",17),e.nrm(7,"app-rich-text-edit",18,0)(9,"app-character-counter",19),e.k0s()(),e.j41(10,"div",20)(11,"button",21),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.handleRemoveImage(o))}),e.nrm(12,"app-icon",22),e.k0s()()()}if(2&s){const t=i.$implicit,n=e.sdS(8);e.Y8G("formGroup",t),e.R7$(4),e.Y8G("labelElement",!1),e.R7$(),e.Y8G("canDelete",!1),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",n)}}function Br(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-form-field",5)(2,"mat-checkbox",6),e.EFF(3,"Loop"),e.k0s(),e.qex(4,7),e.EFF(5," Creates the appearance of a continuous uninterrupted image "),e.bVm(),e.k0s(),e.j41(6,"div",8),e.bIt("cdkDropListDropped",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleImageDrop(o))}),e.DNE(7,Nr,13,8,"div",9),e.j41(8,"button",10),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleAddImage())}),e.EFF(9," Add EKG Image "),e.k0s()(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(7),e.Y8G("ngForOf",t.images.controls)}}let Dr=(()=>{class s{get images(){return this.controlContainer.control.get("images")}constructor(t,n){this.controlContainer=t,this.formBuilder=n,this.environmentApplication=Me.c}handleAddImage(){const t=new fs.F;this.images.push(this.addBlock(t))}addBlock(t){return this.formBuilder.group({urls:t.urls,alt:[t.alt,c.k0.maxLength(200)],caption:[t.caption,c.k0.maxLength(200)]})}handleRemoveImage(t){this.images.removeAt(t)}handleImageDrop(t){const{previousIndex:n,currentIndex:o}=t,a=this.images.at(n);this.images.removeAt(n),this.images.insert(o,a)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ZU),e.rXU(c.ze))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-ticker-block"]],decls:5,vars:3,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],[4,"appFlagApplication"],["formControlName","enable",1,"text-xs"],["label","Loop Image",1,"grow"],["formControlName","loopImage",1,"text-xs"],["form-field-help",""],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","images",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button",1,"w-40",3,"click"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],[1,"flex","edit-block__body"],["label","Image",1,"pr-1",2,"flex","0 0 240px",3,"labelElement"],["type","image","formControlName","urls",3,"canDelete"],["label","Label",1,"grow"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle","matTooltip","Remove Image",3,"click"],["icon","times"]],template:function(n,o){1&n&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2,"EKG"),e.k0s(),e.DNE(3,Ir,3,0,"ng-container",3)(4,Br,10,1,"ng-container",3),e.bVm()),2&n&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(3),e.Y8G("appFlagApplication",o.environmentApplication.Studio),e.R7$(),e.Y8G("appFlagApplication",o.environmentApplication.Loft))},dependencies:[w.Sq,c.BC,c.cb,c.j4,c.JD,c.v8,Z.K,Pt.P,X.R,Ui.c,te.O7,te.T1,te.Fb,Ut,Y.Q,Ae.So,Ce.oV,Vi.Y],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__body[_ngcontent-%COMP%]{flex:1 0 auto}"],changeDetection:0})}return s})();var Li=v(21424),ko=v(39596);function Gr(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",6)(1,"div",7),e.nrm(2,"app-icon",8),e.k0s(),e.j41(3,"app-form-field",9)(4,"app-content-upload-input",10),e.bIt("uploadInput",function(o){const a=e.eBV(t).index,r=e.XpG();return e.Njj(r.handleUploadInput(o,a))}),e.k0s(),e.j41(5,"div",11),e.EFF(6),e.k0s()(),e.j41(7,"app-form-field",12),e.nrm(8,"app-rich-text-edit",13,0)(10,"app-character-counter",14),e.k0s(),e.j41(11,"div",15)(12,"button",16),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRemoveVideo(o))}),e.nrm(13,"app-icon",17),e.k0s()()()}if(2&s){const t=i.$implicit,n=i.index,o=e.sdS(9),a=e.XpG();e.Y8G("formGroup",t),e.R7$(3),e.Y8G("labelElement",!1),e.R7$(),e.Y8G("canDelete",!1)("showExtensions",!1),e.R7$(2),e.SpI(" ",a.videoBlockVideos.value[n].srcFilename," "),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",o)}}let $r=(()=>{class s{get videoBlockVideos(){return this.controlContainer.control.get("videos")}constructor(t,n,o,a){this.controlContainer=t,this.formBuilder=n,this.store=o,this.userAccessService=a}ngOnDestroy(){this.filterVideos()}handleAddVideo(){if(this.store.selectSnapshot(Li.q.isValidPaidSubscription)){const t=new gs.Q;this.videoBlockVideos.push(this.createVideo(t))}else this.userAccessService.openVideoUploadGate()}createVideo(t){return this.formBuilder.group({url:t.url,caption:[t.caption,c.k0.maxLength(200)],srcFilename:t.srcFilename})}handleRemoveVideo(t){this.videoBlockVideos.removeAt(t)}handleVideoDrop(t){const{previousIndex:n,currentIndex:o}=t,a=this.videoBlockVideos.at(n);this.videoBlockVideos.removeAt(n),this.videoBlockVideos.insert(o,a)}handleUploadInput(t,n){const o=t.file?.name||"";this.videoBlockVideos.at(n).patchValue({srcFilename:o})}filterVideos(){const t=this.videoBlockVideos.value;for(let n=t.length-1;n>=0;n--)t[n].url||this.videoBlockVideos.removeAt(n)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ZU),e.rXU(c.ze),e.rXU(l.il),e.rXU(ko.p))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-videos-block"]],decls:7,vars:3,consts:[["caption",""],[3,"formGroup"],[1,"mb-2","text-sm","font-bold"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","videos",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block theme-light",3,"formGroup",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","data-test","addVideo",1,"w-40",3,"click","disabled"],["cdkDrag","",1,"edit-block","theme-light",3,"formGroup"],["cdkDragHandle","",1,"edit-block__handle"],["icon","grip-lines"],["label","Video",1,"edit-block__video",3,"labelElement"],["type","video","formControlName","url",3,"uploadInput","canDelete","showExtensions"],[1,"mb-1","break-words","text-2xs"],["label","Video Caption",1,"grow"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],[3,"field"],[1,"edit-block__actions"],["app-button","","buttonTheme","light","buttonShape","circle","matTooltip","Remove Video",3,"click"],["icon","times"]],template:function(n,o){1&n&&(e.qex(0,1),e.j41(1,"div",2),e.EFF(2,"Videos"),e.k0s(),e.j41(3,"div",3),e.bIt("cdkDropListDropped",function(r){return o.handleVideoDrop(r)}),e.DNE(4,Gr,14,10,"div",4),e.j41(5,"button",5),e.bIt("click",function(){return o.handleAddVideo()}),e.EFF(6," Add Video "),e.k0s()(),e.bVm()),2&n&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(4),e.Y8G("ngForOf",o.videoBlockVideos.controls),e.R7$(),e.Y8G("disabled",o.videoBlockVideos.controls.length>=3))},dependencies:[w.Sq,c.BC,c.cb,c.j4,c.JD,c.v8,Z.K,Pt.P,X.R,Ui.c,te.O7,te.T1,te.Fb,Ut,Y.Q,Ce.oV],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__video[_ngcontent-%COMP%]{width:240px;min-width:240px;padding-right:4px}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}"],changeDetection:0})}return s})();var it=v(59429);const Or=(s,i,t,n)=>({"text-to-speech--light":s,"text-to-speech--dark":i,"text-to-speech--compact":t,"text-to-speech--inline":n});function Ar(s,i){if(1&s&&(e.j41(0,"span",5),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.playStateText)}}let Ur=(()=>{class s{get text(){return this._text}set text(t){this._text=t,this.resetAudioState()}get localeId(){return this._localeId}set localeId(t){this._localeId=t,this.resetAudioState()}set language(t){const n=Oi.IB.find(o=>o.lang===t)||Oi.q;this.localeId=n.id}get playStateText(){return this.playing?"Stop narration":"Listen to narration"}constructor(t,n){this.changeRef=t,this.mediaService=n,this.theme="dark",this.readyState="empty",this.playing=!1,this.ended=!1,this.ngUnsubscribe=new f.B,this.id=it.u.getUuid()}ngOnDestroy(){this.destroyAudio(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePlayToggleClicked(){this.toggleAudio()}toggleAudio(){this.playing?this.pause():this.play(this.ended)}pause(){var t=this;return(0,A.A)(function*(){const n=yield t.mediaService.getAudioPlayer(t.id);(0,R.isNil)(n)||n.pause()})()}play(t=!1){var n=this;return(0,A.A)(function*(){let o;n.mediaService.hasAudioPlayer(n.id)?o=yield n.mediaService.getAudioPlayer(n.id):(o=yield n.mediaService.addAudioPlayer(n.id,n.mediaService.getTTSSources(n.text,n.localeId),!1),n.initAudioPlayer(o)),(0,R.isNil)(o)||(n.mediaService.stopAllOtherAudio(n.id),t&&o.stop(),o.play())})()}initAudioPlayer(t){this.readyState="loading",t.on("load",()=>{this.readyState="ready",this.changeRef.markForCheck()}),t.on("loaderror",()=>{this.resetAudioState(),this.changeRef.markForCheck()}),t.on("play",()=>{this.playing=!0,this.ended=!1,this.changeRef.markForCheck()}),t.on("pause",()=>{this.playing=!1,this.changeRef.markForCheck()}),t.on("end",()=>{this.playing=!1,this.ended=!0,this.changeRef.markForCheck()}),t.on("stop",()=>{this.playing=!1,this.changeRef.markForCheck()}),t.on("playerror",()=>{this.playing=!1,this.changeRef.markForCheck()}),this.changeRef.markForCheck()}resetAudioState(){this.destroyAudio(),this.readyState="empty",this.playing=!1,this.ended=!1,this.changeRef.markForCheck()}destroyAudio(){this.mediaService.removeAudioPlayer(this.id)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.gRc),e.rXU(hs.u))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-text-to-speech"]],inputs:{text:"text",localeId:"localeId",compact:"compact",inline:"inline",theme:"theme",language:"language"},decls:5,vars:10,consts:[[1,"text-to-speech",3,"ngClass"],["type","button","data-test","textNarrationButton",1,"text-to-speech__button","w-full",3,"click","disabled"],[1,"flex","flex-row","items-center"],[1,"text-to-speech__icon",3,"icon"],["class","text-to-speech__label flex-auto",4,"ngIf"],[1,"text-to-speech__label","flex-auto"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"button",1),e.bIt("click",function(){return o.handlePlayToggleClicked()}),e.j41(2,"div",2),e.nrm(3,"app-icon",3),e.DNE(4,Ar,2,1,"span",4),e.k0s()()()),2&n&&(e.Y8G("ngClass",e.ziG(5,Or,"light"===o.theme,"dark"===o.theme,o.compact,o.inline)),e.R7$(),e.Y8G("disabled","loading"===o.readyState),e.BMQ("aria-label",o.playStateText),e.R7$(2),e.Y8G("icon",o.playing?"pause":"play"),e.R7$(),e.Y8G("ngIf",!o.compact))},dependencies:[w.YU,w.bT,X.R],styles:[".text-to-speech__button[_ngcontent-%COMP%]{padding:4px 8px;cursor:pointer;background:none;border:none;border-radius:4px}.text-to-speech__button[_ngcontent-%COMP%]:focus{outline:#2d72dc solid 2px!important}.text-to-speech__icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid;border-radius:50%;font-size:.75rem;line-height:1rem}.text-to-speech__label[_ngcontent-%COMP%]{margin-left:12px;text-align:left;font-size:.875rem;line-height:1.25rem}.text-to-speech--inline[_ngcontent-%COMP%]{display:inline-block}.text-to-speech--compact[_ngcontent-%COMP%]{padding:4px}.text-to-speech--compact[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{width:20px;height:20px;font-size:.625rem;line-height:.75rem}.text-to-speech--compact[_ngcontent-%COMP%]   .text-to-speech__label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.text-to-speech--light[_ngcontent-%COMP%]   .text-to-speech__button[_ngcontent-%COMP%]{color:#374a68}.text-to-speech--light[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{border-color:#96a8c0}.text-to-speech--dark[_ngcontent-%COMP%]   .text-to-speech__button[_ngcontent-%COMP%]{color:#96a8c0}.text-to-speech--dark[_ngcontent-%COMP%]   .text-to-speech__icon[_ngcontent-%COMP%]{border-color:#374a68}"],changeDetection:0})}return s})();var $n=v(89079),Ke=v(49206),Yi=v(3272),Rs=v(72026),Ps=v(11818),Vr=v(4763),js=v(2096),Vt=v(45189);let To=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD,c.X1,Vt.G,Gn.y2.forChild()]})}return s})();const Lr=(s,i)=>i.value.id;function Yr(s,i){if(1&s&&(e.j41(0,"div",1),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.label())}}function zr(s,i){if(1&s&&(e.j41(0,"app-form-field",17),e.nrm(1,"input",19),e.k0s()),2&s){const t=e.XpG(2);e.Y8G("isCompact",!0),e.R7$(),e.Y8G("placeholder","e.g.,"+t.defaultReviewProcessUrl)}}function Xr(s,i){1&s&&(e.j41(0,"app-form-field",18),e.nrm(1,"input",20),e.k0s()),2&s&&e.Y8G("isCompact",!0)}function Qr(s,i){if(1&s&&(e.j41(0,"app-form-field",11)(1,"div",12)(2,"div",13)(3,"mat-checkbox",4),e.nrm(4,"app-badge",14),e.k0s()(),e.j41(5,"div",15)(6,"mat-checkbox",4),e.nrm(7,"app-badge",16),e.k0s()()()(),e.DNE(8,zr,2,2,"app-form-field",17)(9,Xr,2,1,"app-form-field",18)),2&s){const t=e.XpG();e.Y8G("labelElement",!1)("isCompact",!0),e.R7$(8),e.vxM(t.form.value.reviewed.enabled?8:-1),e.R7$(),e.vxM(t.form.value.collaborated.enabled?9:-1)}}function qr(s,i){if(1&s&&e.nrm(0,"input",6),2&s){const t=e.XpG();e.Y8G("value",t.updateDateText())}}function Hr(s,i){if(1&s){const t=e.RV6();e.j41(0,"li",21)(1,"span",22),e.EFF(2),e.k0s(),e.j41(3,"div",23),e.nrm(4,"app-rich-text-edit",24),e.k0s(),e.j41(5,"button",25),e.bIt("click",function(){const o=e.eBV(t).$index,a=e.XpG(2);return e.Njj(a.removeReferenceClick(o))}),e.j41(6,"span",26),e.EFF(7,"Remove reference"),e.k0s(),e.nrm(8,"app-icon",27),e.k0s()()}if(2&s){const n=i.$index;e.Y8G("formGroup",i.$implicit),e.R7$(2),e.SpI("",n+1,"."),e.R7$(2),e.Y8G("inline",!0)("compact",!0)}}function Wr(s,i){if(1&s&&(e.j41(0,"ol",9),e.Z7z(1,Hr,9,4,"li",21,Lr),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Dyx(t.referencesFormArray.controls)}}let Ms=(()=>{class s extends Ke.n{get referencesFormArray(){return this.form.controls.references}constructor(){super(),this.defaultReviewProcessUrl=js.eq,this.enabledSource=e.hFB.required(),this.label=(0,e.hFB)(""),this.updateDate=e.hFB.required(),this.updateDateText=(0,e.EWP)(()=>{const t=this.updateDate();return t?new Date(t).toLocaleDateString():""}),this.form=new c.gE({reviewed:new c.gE({enabled:new c.MJ(!1),authors:new c.MJ(""),url:new c.MJ(js.eq)}),collaborated:new c.gE({enabled:new c.MJ(!1),authors:new c.MJ(""),url:new c.MJ("")}),references:new c.Yp([]),audit:new c.gE({enabled:new c.MJ(!1)})}),this.initFormListeners()}initFormListeners(){this.form.valueChanges.pipe((0,$n.pQ)()).subscribe(t=>{this.value=t})}setFormValues(t){(0,R.isEqual)({...this.form.value,audit:{...this.form.value.audit,timestamp:void 0}},{...t,audit:{...t.audit,timestamp:void 0}})||(this.referencesFormArray.clear({emitEvent:!1}),t.references.forEach(()=>{this.referencesFormArray.push(new c.gE({id:new c.MJ(""),label:new c.MJ("")}),{emitEvent:!1})}),this.form.patchValue(t,{emitEvent:!1}))}handleAddReferenceClick(){const t=this.value,{references:n}=t;this.value={...t,references:[...n,{id:it.u.idWithPrefix("source-reference"),label:""}]}}removeReferenceClick(t){this.form.controls.references.removeAt(t)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-source-info-form"]],inputs:{enabledSource:[1,"enabledSource"],label:[1,"label"],updateDate:[1,"updateDate"]},standalone:!0,features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3,e.aNF],decls:16,vars:7,consts:[[1,"flex","flex-col","gap-4","theme-light","source-info-form",3,"formGroup"],[1,"text-sm","font-bold"],[1,"text-xs","source-info-form__blurb"],["label","Updated On","formGroupName","audit",3,"isCompact","labelElement"],["formControlName","enabled"],[1,"text-xs"],["type","text","disabled","",1,"mt-1","input",3,"value"],[1,"flex","flex-col","gap-4","mt-6"],[1,"text-sm","font-semibold"],["formArrayName","references",1,"flex","flex-col","gap-4"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",1,"w-40",3,"click"],["label","Trust Badges",3,"labelElement","isCompact"],[1,"flex","flex-row","gap-6"],["formGroupName","reviewed"],["theme","blue","icon","check","label","Medically Reviewed"],["formGroupName","collaborated"],["theme","green","icon","check","label","Built in Collaboration"],["label","Review Process Link","formGroupName","reviewed",3,"isCompact"],["label","Collaborators","formGroupName","collaborated",3,"isCompact"],["type","text","formControlName","url",1,"input",3,"placeholder"],["type","text","formControlName","authors","placeholder","e.g., Bill Nye, The Science Guy",1,"input"],[1,"flex","flex-row","items-start","justify-between","gap-3",3,"formGroup"],[1,"text-xs","text-right",2,"flex","0 1 20px"],[1,"flex-auto"],["textMode","text","mode","extended","placeholder","e.g., Gilroy, Anne M, et al. Atlas of Anatomy. New York, Thieme, 2020.","formControlName","label",3,"inline","compact"],["app-button","","buttonShape","square","buttonTheme","light",3,"click"],[1,"sr-only"],["icon","times"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.DNE(1,Yr,2,1,"div",1),e.j41(2,"div",2),e.EFF(3," Include the details of the source information in your content. "),e.k0s(),e.DNE(4,Qr,10,4),e.j41(5,"app-form-field",3)(6,"mat-checkbox",4)(7,"span",5),e.EFF(8,'Show "Updated on" date'),e.k0s()(),e.DNE(9,qr,1,1,"input",6),e.k0s(),e.j41(10,"div",7)(11,"h2",8),e.EFF(12,"References"),e.k0s(),e.DNE(13,Wr,3,0,"ol",9),e.j41(14,"button",10),e.bIt("click",function(){return o.handleAddReferenceClick()}),e.EFF(15," Add Reference "),e.k0s()()()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(),e.vxM(o.label()?1:-1),e.R7$(3),e.vxM(o.enabledSource()?4:-1),e.R7$(),e.Y8G("isCompact",!0)("labelElement",!1),e.R7$(4),e.vxM(o.form.value.audit.enabled?9:-1),e.R7$(4),e.vxM(o.referencesFormArray.controls.length>0?13:-1))},dependencies:[c.X1,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,Yi.D,Z.K,Ae.g7,Ae.So,Rs.o,X.R,Ps.C,Y.Q,Vr.n,To,Ut],styles:[".source-info-form[_ngcontent-%COMP%]{color:#131c2a}.source-info-form__blurb[_ngcontent-%COMP%]{color:#1c2a3f}"]})}return s})();var ri=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},li=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Jr=["lightLibInput"],Is=s=>({"content__section--selected":s}),Kr=s=>({"content__check-group--split":s});function Zr(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",17),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleChapterClick(o))}),e.j41(1,"div",18),e.EFF(2),e.k0s(),e.j41(3,"div",12),e.EFF(4),e.k0s()()}if(2&s){const t=i.$implicit,n=i.index,o=e.XpG();e.Y8G("ngClass",e.eq3(3,Is,t.id===o.selectedChapterId)),e.R7$(2),e.SpI("",n+1,"."),e.R7$(2),e.SpI(" ",t.displayName||"-No Title-"," ")}}function el(s,i){if(1&s&&(e.qex(0),e.j41(1,"div",27),e.nrm(2,"app-source-info-form",28),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s(),e.bVm()),2&s){let t;const n=e.XpG(2);e.R7$(2),e.Y8G("enabledSource",!1)("updateDate",null!==(t=null==(t=e.bMT(3,2,n.bookmark$))?null:t.update_date_time)&&void 0!==t?t:null==(t=e.bMT(4,4,n.bookmark$))?null:t.create_date_time)}}function tl(s,i){if(1&s&&(e.j41(0,"div",49)(1,"mat-checkbox",50),e.EFF(2),e.k0s()()),2&s){const t=i.$implicit;e.Y8G("formGroupName",i.index),e.R7$(2),e.SpI(" ",t.get("tag").value," ")}}function il(s,i){if(1&s&&(e.j41(0,"app-panel",46)(1,"div",47),e.DNE(2,tl,3,2,"div",48),e.k0s()()),2&s){const t=i.$implicit;e.Y8G("formGroupName",i.index)("label",t.get("title").value)("isCompact",!0),e.R7$(),e.Y8G("ngClass",e.eq3(5,Kr,t.get("tags").controls.length>=3)),e.R7$(),e.Y8G("ngForOf",t.get("tags").controls)}}function nl(s,i){if(1&s&&(e.j41(0,"li"),e.EFF(1),e.j41(2,"span",51),e.EFF(3),e.nI1(4,"uppercase"),e.k0s()()),2&s){const t=i.$implicit;e.R7$(),e.SpI(" ",t.libId," "),e.R7$(2),e.SpI("(",e.bMT(4,2,t.type),")")}}function ol(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",29)(2,"app-tabs",30)(3,"app-tab",31)(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleClearTagsSelectionClick())}),e.EFF(5," Clear Tags "),e.k0s(),e.j41(6,"div",33),e.DNE(7,il,3,7,"app-panel",34),e.k0s()(),e.j41(8,"app-tab",35),e.nrm(9,"app-source-info-form",36),e.nI1(10,"async"),e.nI1(11,"async"),e.k0s(),e.j41(12,"app-tab",37)(13,"div",38)(14,"div",39),e.EFF(15,"Any unused libraries will be removed during save."),e.k0s(),e.j41(16,"app-panel",40)(17,"ul",41),e.DNE(18,nl,5,4,"li",42),e.nI1(19,"async"),e.k0s(),e.j41(20,"div",43)(21,"input",44,1),e.bIt("input",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.checkGetLightLib())}),e.k0s(),e.j41(23,"button",45),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleLoadLightsLib())}),e.EFF(24," Load Library "),e.k0s()()()()()()(),e.bVm()}if(2&s){let t;const n=e.XpG(2);e.R7$(2),e.Y8G("scrollable",!0)("tabPadded",!0),e.R7$(5),e.Y8G("ngForOf",n.tagCategories.controls),e.R7$(2),e.Y8G("enabledSource",!0)("updateDate",null!==(t=null==(t=e.bMT(10,7,n.bookmark$))?null:t.update_date_time)&&void 0!==t?t:null==(t=e.bMT(11,9,n.bookmark$))?null:t.create_date_time),e.R7$(9),e.Y8G("ngForOf",e.bMT(19,11,n.lightLibs$)),e.R7$(5),e.Y8G("disabled",n.disableGetLightLib)}}function sl(s,i){if(1&s&&(e.j41(0,"div",19)(1,"form",20)(2,"app-form-field",21),e.nrm(3,"input",22,0)(5,"app-character-counter",23),e.k0s(),e.nrm(6,"mat-divider",24),e.DNE(7,el,5,6,"ng-container",25)(8,ol,25,13,"ng-container",26),e.k0s()()),2&s){const t=e.sdS(4),n=e.XpG();e.R7$(),e.Y8G("formGroup",n.bookmarkForm),e.R7$(4),e.Y8G("field",t)}}function al(s,i){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-images-block",74),e.j41(2,"div",75),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const t=e.XpG().$implicit;e.R7$(),e.Y8G("formGroup",t)("type",t.value.type)}}function rl(s,i){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-images-block",76),e.j41(2,"div",75),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const t=e.XpG().$implicit;e.R7$(),e.Y8G("formGroup",t)("type",t.value.type)("max",3)}}function ll(s,i){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-videos-block",52),e.j41(2,"div",75),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const t=e.XpG().$implicit;e.R7$(),e.Y8G("formGroup",t)}}function cl(s,i){if(1&s&&(e.qex(0),e.nrm(1,"app-edit-ticker-block",52),e.j41(2,"div",75),e.nrm(3,"mat-divider"),e.k0s(),e.bVm()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("formGroup",t)}}function pl(s,i){if(1&s&&(e.qex(0),e.DNE(1,cl,4,1,"ng-container",77),e.bVm()),2&s){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.showTickerBlock)}}function dl(s,i){1&s&&(e.j41(0,"div",72),e.DNE(1,al,4,2,"ng-container",73)(2,rl,4,3,"ng-container",73)(3,ll,4,1,"ng-container",73)(4,pl,2,1,"ng-container",73),e.k0s()),2&s&&(e.Y8G("ngSwitch",i.$implicit.value.type),e.R7$(),e.Y8G("ngSwitchCase","images"),e.R7$(),e.Y8G("ngSwitchCase","animatedImages"),e.R7$(),e.Y8G("ngSwitchCase","videos"),e.R7$(),e.Y8G("ngSwitchCase","ticker"))}function ml(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",78),e.nrm(1,"app-color-picker-input",79)(2,"input",80),e.j41(3,"button",81),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG(2);return e.Njj(a.handleRemoveLegendItem(o))}),e.nrm(4,"app-icon",82),e.k0s()()}2&s&&(e.Y8G("formGroupName",i.index),e.R7$(),e.Y8G("useRootContainer",!1))}function ul(s,i){if(1&s&&(e.j41(0,"div")(1,"div",83)(2,"div",84),e.nrm(3,"app-text-to-speech",85),e.nI1(4,"async"),e.k0s()()()),2&s){const t=e.XpG(2);e.R7$(3),e.Y8G("text",t.narrationText)("language",e.bMT(4,2,t.storyLanguage$))}}function hl(s,i){if(1&s&&(e.j41(0,"option",106)(1,"span"),e.EFF(2),e.nI1(3,"uppercase"),e.k0s()()),2&s){const t=i.$implicit,n=e.XpG(4);e.Y8G("value",t.lang)("disabled",n.usedLocales.includes(t.lang)),e.R7$(2),e.Lme("",t.title," (",e.bMT(3,4,t.lang),")")}}function fl(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",89)(1,"div",90)(2,"div",91)(3,"button",92),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG(3);return e.Njj(a.handleRemoveAudioItem(o))}),e.j41(4,"div",67)(5,"span",93),e.EFF(6,"replace file"),e.k0s(),e.nrm(7,"app-icon",82),e.k0s()()(),e.j41(8,"div",94)(9,"div",95),e.EFF(10,"Language"),e.k0s(),e.j41(11,"div",96)(12,"div",97)(13,"div",98),e.nrm(14,"img",99),e.j41(15,"span",100),e.EFF(16),e.k0s()(),e.nrm(17,"app-icon",101),e.k0s(),e.j41(18,"select",102),e.bIt("change",function(o){const a=e.eBV(t).index,r=e.XpG(3);return e.Njj(r.handleAudioItemChange(o,a))}),e.DNE(19,hl,4,6,"option",103),e.k0s()(),e.j41(20,"div",104)(21,"app-content-upload-input",105),e.bIt("uploadSuccess",function(o){const a=e.eBV(t).index,r=e.XpG(3);return e.Njj(r.onAudioFileSuccess(o,a))}),e.k0s()()()()()}if(2&s){const t=i.$implicit,n=i.index,o=e.XpG(3);e.Y8G("formGroupName",n),e.R7$(14),e.Y8G("src",o.getLocaleFlag(t.value.lang),e.B4B),e.R7$(2),e.JRh(o.getLocaleString(t.value.lang)),e.R7$(3),e.Y8G("ngForOf",o.locales),e.R7$(2),e.Y8G("canDelete",!1)}}function gl(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",107),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.handleAddAudioItem())}),e.EFF(1," Add Audio "),e.k0s()}}function bl(s,i){if(1&s&&(e.j41(0,"div")(1,"div",86),e.DNE(2,fl,22,5,"div",87),e.k0s(),e.DNE(3,gl,2,0,"button",88),e.k0s()),2&s){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.audio.controls),e.R7$(),e.Y8G("ngIf",t.usedLocales.length<t.locales.length)}}function _l(s,i){1&s&&e.eu8(0)}function vl(s,i){1&s&&e.nrm(0,"mat-divider",114),2&s&&e.Y8G("vertical",!0)}function Cl(s,i){1&s&&(e.j41(0,"mat-radio-group",131)(1,"app-list",127)(2,"app-list-item")(3,"mat-radio-button",71),e.EFF(4,"Play once"),e.k0s()(),e.j41(5,"app-list-item")(6,"mat-radio-button",71),e.EFF(7,"Play indefinitely"),e.k0s()()()()),2&s&&(e.R7$(3),e.Y8G("value",1),e.R7$(3),e.Y8G("value",-1))}function yl(s,i){1&s&&(e.j41(0,"mat-checkbox",132),e.EFF(1," Loop to Audio "),e.k0s())}function kl(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",115)(1,"div",60),e.EFF(2," Animation "),e.j41(3,"button",116),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.applyAnimationsToAll())}),e.nrm(4,"app-icon",69),e.k0s()(),e.j41(5,"div",117)(6,"app-form-field",118),e.DNE(7,Cl,8,2,"mat-radio-group",119)(8,yl,2,0,"mat-checkbox",120),e.nrm(9,"mat-divider",121),e.j41(10,"mat-checkbox",122),e.EFF(11," Autoplay "),e.k0s()(),e.j41(12,"app-form-field",123),e.qex(13,124),e.j41(14,"span",125),e.EFF(15,"Note:"),e.k0s(),e.EFF(16," Save to preview changes in Viewer. "),e.bVm(),e.j41(17,"mat-radio-group",126)(18,"app-list",127)(19,"app-list-item")(20,"mat-radio-button",128),e.EFF(21,"None"),e.k0s()(),e.j41(22,"app-list-item")(23,"mat-radio-button",129),e.EFF(24,"Play/Pause"),e.k0s()(),e.j41(25,"app-list-item")(26,"mat-radio-button",130),e.EFF(27,"Scrubber"),e.k0s()()()()()()()}if(2&s){const t=e.XpG(3);e.R7$(7),e.Y8G("ngIf",!t.hasAudio),e.R7$(),e.Y8G("ngIf",t.hasAudio)}}function Tl(s,i){if(1&s&&(e.j41(0,"option",71),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t.libId),e.R7$(),e.Lme(" ",t.libId," (",e.bMT(2,3,t.type),") ")}}function Sl(s,i){1&s&&(e.qex(0),e.j41(1,"mat-checkbox",136)(2,"span",38),e.EFF(3,"Enable skin options"),e.k0s()(),e.bVm())}function xl(s,i){if(1&s&&(e.j41(0,"option",71),e.EFF(1),e.k0s()),2&s){const t=i.$implicit,n=e.XpG(6);e.Y8G("value",t),e.R7$(),e.SpI(" ",n.layersModesTitles[t]," ")}}function El(s,i){if(1&s&&(e.j41(0,"app-form-field",140)(1,"select",141),e.DNE(2,xl,2,2,"option",113),e.k0s()()),2&s){const t=e.XpG(5);e.R7$(2),e.Y8G("ngForOf",t.layersModes)}}function wl(s,i){if(1&s&&(e.j41(0,"div",137)(1,"mat-checkbox",138)(2,"span",38),e.EFF(3,"Enable layer slider"),e.k0s()(),e.DNE(4,El,3,1,"app-form-field",139),e.k0s()),2&s){const t=e.XpG(4);e.R7$(4),e.Y8G("ngIf",!0===t.formVisibilityLayers.value)}}function Fl(s,i){if(1&s&&(e.qex(0),e.nrm(1,"mat-divider",24),e.j41(2,"div",133)(3,"div",134),e.EFF(4,"Anatomy Configuration"),e.k0s(),e.DNE(5,Sl,4,0,"ng-container",77),e.nI1(6,"async"),e.DNE(7,wl,5,1,"div",135),e.nI1(8,"async"),e.k0s(),e.bVm()),2&s){let t;const n=e.XpG(3);e.R7$(5),e.Y8G("ngIf",!n.isEmpty(e.bMT(6,2,n.skinVariants$))),e.R7$(2),e.Y8G("ngIf",(null==(t=e.bMT(8,4,n.visibilityLayers$))?null:t.length)>0)}}function Rl(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",27),e.nrm(2,"mat-divider"),e.k0s(),e.j41(3,"div",108),e.DNE(4,_l,1,0,"ng-container",109)(5,vl,1,1,"mat-divider",110)(6,kl,28,2,"div",111),e.k0s(),e.nrm(7,"mat-divider",24),e.j41(8,"div",66)(9,"div",60),e.EFF(10,"Lights"),e.k0s(),e.j41(11,"select",112),e.nI1(12,"async"),e.bIt("change",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleLightsChange())}),e.DNE(13,Tl,3,5,"option",113),e.nI1(14,"async"),e.k0s()(),e.DNE(15,Fl,9,6,"ng-container",77),e.nI1(16,"async"),e.nI1(17,"async"),e.bVm()}if(2&s){let t,n;e.XpG();const o=e.sdS(42),a=e.XpG();e.R7$(4),e.Y8G("ngTemplateOutlet",o),e.R7$(),e.Y8G("ngIf",a.selectedChapterAnimated),e.R7$(),e.Y8G("ngIf",a.selectedChapterAnimated),e.R7$(5),e.Y8G("disabled",0===(null==(t=e.bMT(12,6,a.selectedChapterLightLibs$))?null:t.length)),e.R7$(2),e.Y8G("ngForOf",e.bMT(14,8,a.selectedChapterLightLibs$)),e.R7$(2),e.Y8G("ngIf",(null==(n=e.bMT(16,10,a.visibilityLayers$))?null:n.length)>0||!a.isEmpty(e.bMT(17,12,a.skinVariants$)))}}function Pl(s,i){1&s&&e.eu8(0)}function jl(s,i){if(1&s&&(e.qex(0),e.nrm(1,"mat-divider",142),e.j41(2,"div",143),e.DNE(3,Pl,1,0,"ng-container",109),e.k0s(),e.bVm()),2&s){e.XpG();const t=e.sdS(42);e.R7$(3),e.Y8G("ngTemplateOutlet",t)}}function Ml(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",144)(1,"div",60),e.EFF(2," Transitions "),e.j41(3,"button",145),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.applyTransitionsToAll())}),e.nrm(4,"app-icon",69),e.k0s()(),e.j41(5,"app-form-field",146)(6,"mat-radio-group",147)(7,"app-list",127)(8,"app-list-item")(9,"mat-radio-button",148),e.EFF(10,"Fly To This Chapter"),e.k0s()(),e.j41(11,"app-list-item")(12,"mat-radio-button",149),e.EFF(13,"Jump To This Chapter"),e.k0s()()()()()()}}function Il(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",19)(1,"form",52)(2,"app-form-field",53),e.nrm(3,"input",54,0)(5,"app-character-counter",23),e.k0s(),e.j41(6,"app-form-field",55),e.nrm(7,"app-rich-text-edit",56,2)(9,"app-character-counter",23),e.k0s(),e.nrm(10,"mat-divider",57),e.qex(11,58),e.DNE(12,dl,5,5,"div",59),e.bVm(),e.j41(13,"div",38)(14,"div",60),e.EFF(15,"Legend"),e.k0s(),e.j41(16,"app-form-field",61)(17,"div",62),e.bIt("cdkDropListDropped",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleLegendItemDrop(o))}),e.DNE(18,ml,5,2,"div",63),e.k0s()(),e.j41(19,"button",64),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleAddLegendItem())}),e.EFF(20," Add Legend "),e.k0s()(),e.j41(21,"div",65),e.nrm(22,"mat-divider"),e.k0s(),e.j41(23,"div",66)(24,"div",67)(25,"div",60),e.EFF(26," Audio "),e.j41(27,"button",68),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleApplyAudioClick())}),e.nrm(28,"app-icon",69),e.k0s()()(),e.j41(29,"select",70)(30,"option",71),e.EFF(31,"Text to Speech Narration"),e.k0s(),e.j41(32,"option",71),e.EFF(33,"Audio File"),e.k0s(),e.j41(34,"option",71),e.EFF(35,"No Audio"),e.k0s()(),e.j41(36,"div",72),e.DNE(37,ul,5,4,"div",73)(38,bl,4,2,"div",73),e.k0s()(),e.DNE(39,Rl,18,14,"ng-container",26)(40,jl,4,1,"ng-container",25)(41,Ml,14,0,"ng-template",null,3,e.C5r),e.k0s()()}if(2&s){const t=e.sdS(4),n=e.sdS(8),o=e.XpG();e.R7$(),e.Y8G("formGroup",o.chapterForm),e.R7$(4),e.Y8G("field",t),e.R7$(2),e.Y8G("inline",!0)("resizeable",!1)("rows",16)("maxLength",1e4),e.R7$(2),e.Y8G("field",n),e.R7$(3),e.Y8G("ngForOf",o.contentBlocks.controls),e.R7$(6),e.Y8G("ngForOf",o.legend.controls),e.R7$(12),e.Y8G("value",o.audioPlaybackType.TTS),e.R7$(2),e.Y8G("value",o.audioPlaybackType.File),e.R7$(2),e.Y8G("value",o.audioPlaybackType.None),e.R7$(2),e.Y8G("ngSwitch",o.audioTypeValue),e.R7$(),e.Y8G("ngSwitchCase",o.audioPlaybackType.TTS),e.R7$(),e.Y8G("ngSwitchCase",o.audioPlaybackType.File)}}const Nl=Object.values($t.Y);class ot{get selectedChapterId(){return this.selectedChapterId$.value}set selectedChapterId(i){this.selectedChapterId$.next(i)}get selectedChapter(){return this.selectedChapter$.value}set selectedChapter(i){this.selectedChapter$.next(i)}get descriptionValue(){const{description:i}=this.chapterForm.value;return i}get audioTypeValue(){const{audioType:i}=this.chapterForm.value;return i}get hasAudio(){return this.audioTypeValue!==$t.Y.None}get tagCategories(){return this.bookmarkForm.controls.tagCategories}get legend(){return this.chapterForm.get("legend")}get audio(){return this.chapterForm.get("audio")}get formSkinLayers(){return this.chapterForm.get("skinLayers")}get formVisibilityLayers(){return this.chapterForm.get("visibilityLayers")}get formVisibilityLayersMode(){return this.chapterForm.get("visibilityLayersMode")}constructor(i,t,n,o,a,r,p,x,N,z,W,Se){this.fb=i,this.formBuilder=t,this.dialogRef=n,this.data=o,this.store=a,this.animationService=r,this.mediaService=p,this.snackbar=x,this.changeRef=N,this.dialogService=z,this.assetService=W,this.contentBlocksService=Se,this.isEmpty=R.isEmpty,this.locales=Oi.IB,this.audioPlaybackType=$t.Y,this.layersModeEnum=Ot.Z,this.layersModes=Object.values(Ot.Z),this.layersModesTitles={[Ot.Z.Single]:"Simple Slider",[Ot.Z.Group]:"Detailed Slider"},this.environmentApplication=Me.c,this.showTickerBlock=!1,this.selectedChapterId$=new $i.t(void 0),this.selectedChapter$=new $i.t(void 0),this.disableGetLightLib=!0,this.ngUnsubscribe=new f.B,this.usedLocales=[]}ngOnInit(){this.initLights(),this.initBookmarkForm(),this.initChaptersForm(),this.initChapterAudio()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initBookmarkForm(){this.bookmarkForm=new c.gE({displayName:new c.MJ("",[c.k0.maxLength(60),c.k0.required]),playthroughEnabled:new c.MJ(!1),tagCategories:new c.Yp([]),sourceInfo:new c.MJ({reviewed:null,collaborated:null,references:[],audit:null})});const i=this.store.selectSnapshot(je.J.getSelectedBookmark),t=this.store.selectSnapshot(E.t.getStory);this.setBookmarkFormValues(i,t),this.bookmarkForm.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleBookmarkFormChanges()})}initChaptersForm(){this.chapterForm=this.formBuilder.group({displayName:["",c.k0.maxLength(60)],description:["",c.k0.maxLength(1e4)],contentBlocks:new c.Bm([]),cameraAction:[""],playCount:[""],autoplay:[""],loopToAudio:[""],mediaControls:[""],legend:new c.Bm([]),audio:new c.Bm([]),lights:[""],skinLayers:[!1],visibilityLayers:[!1],visibilityLayersMode:[""],audioType:[""]}),this.selectChapter(this.data.chapterId?this.data.chapterId:""),this.chapterForm.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.handleChapterFormChanges()}),this.audio.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.usedLocales=i.map(t=>t.lang)}),(0,C.z)([this.formSkinLayers.valueChanges,this.formVisibilityLayersMode.valueChanges]).pipe((0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{i?(t===Ot.Z.Single&&this.chapterForm.patchValue({visibilityLayersMode:Ot.Z.Group}),this.formVisibilityLayersMode.disable()):this.formVisibilityLayersMode.enable()})}initChapterAudio(){const i=this.chapterForm.get("description");i.valueChanges.pipe((0,B.Z)(i.value),(0,K.B)(1e3),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.narrationText=t,this.changeRef.markForCheck()})}handleModuleClick(){this.selectChapter("")}handleChapterClick(i){this.selectChapter(i.id)}handleApplyAudioClick(){this.dialogService.openConfirmDialog({data:{titleText:"Audio Settings",bodyText:`Apply "${this.audioTypeValue===$t.Y.TTS?"Text to Speech Narration":"Audio File"}" setting to all chapters?`,confirmText:"Apply",confirmColor:"warn"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.applyAudioToAll()})}selectChapter(i){this.selectedChapterId=i,this.selectedChapter=this.store.selectSnapshot(j.N.getStoryChapters).find(t=>t.id===i),this.selectedChapterAnimated=this.selectedChapter&&this.animationService.isChapterAnimated(this.selectedChapter),this.selectedChapter&&this.setChapterFormValues(this.selectedChapter)}handleChapterFormChanges(){const i=this.store.selectSnapshot(j.N.getStoryChapters),t=i.findIndex(W=>W.id===this.selectedChapterId),n=i[t],{displayName:o,contentBlocks:a,description:r,cameraAction:p,legend:x}=this.chapterForm.value;this.store.dispatch(new U.O(n.id,r,o));const N=this.contentBlocksService.filterEmptyBlocks(a),z=this.contentBlocksService.findContentBlockByType(n.contentBlocks,se.m.Positions);z&&N.push(z),this.store.dispatch(new U.jo(n.id,N,!1)),this.store.dispatch(new U.VU(n.id,p)),this.store.dispatch(new U.sC(n.id,this.getFormUIConfig(n))),this.store.dispatch(new U.Lx(n.id,this.createLegendFromInputs(x)))}handleBookmarkFormChanges(){const{displayName:i,playthroughEnabled:t,sourceInfo:n}=this.bookmarkForm.value,o={enabled:t},r=this.bookmarkForm.controls.tagCategories.value.reduce((p,x)=>p.concat(this.getSelectedTagsByCategory(x)),[]);this.store.dispatch(new Ee.fK(i)),this.store.dispatch(new tt.e_(i)),this.store.dispatch(new Ee.Hd(r)),this.store.dispatch(new Ee.dr(o)),this.store.dispatch(new Ee.Pv(n))}setChapterFormValues(i){const t=i.description,n=i.displayName,o=i.contentBlocks,a=this.contentBlocksService.findContentBlockByType(o,se.m.Images)||new uo.D,r=this.contentBlocksService.findContentBlockByType(o,se.m.AnimatedImages)||new qa,p=this.contentBlocksService.findContentBlockByType(o,se.m.Videos)||new gs.F,x=this.contentBlocksService.findContentBlockByType(o,se.m.Ticker)||new fs.g,N=this.contentBlocksService.findContentBlockByType(o,se.m.CTA)||new Ha,z=[a,r,p,x,N];this.contentBlocks.setControl(0,this.newImagesBlockFormGroup(a),{emitEvent:!1}),this.contentBlocks.setControl(1,this.newAnimatedImagesBlockFormGroup(r),{emitEvent:!1}),this.contentBlocks.setControl(2,this.newVideosBlockFormGroup(p),{emitEvent:!1}),this.contentBlocks.setControl(3,this.newTickerBlockFormGroup(x),{emitEvent:!1}),this.contentBlocks.setControl(4,this.newCTABlockFormGroup(N),{emitEvent:!1}),this.showTickerBlock=Fe.c.application===this.environmentApplication.Loft||!this.contentBlocksService.isEmptyBlock(x);const W=i.camera.action||"flyTo",Se=(0,R.get)(i,"ui.play.count",1),Le=(0,R.get)(i,"ui.play.autoplay",!0),ti=(0,R.get)(i,"ui.play.loopToAudio",!0),et=(0,R.get)(i,"ui.config",{mediaControls:Xa.Y.Full}),Et=(0,us.ld)(et.playPause,et.scrubber,et.mediaControls),ii=et?.audio,ni=Object.values(i.media||{}).some(oi=>"audio"===oi.streamType),Sn=ii&&Nl.includes(ii)?ii:ni?$t.Y.File:$t.Y.None,ds=i.legend||[],ro=this.chapterForm.get("legend");ro.clear();const lo=this.createInputsFromLegend(ds);lo.forEach(oi=>{ro.push(this.formBuilder.group(oi))});const co=this.chapterForm.get("audio");co.clear();const xn=this.createAudioInputs();this.usedLocales=xn.map(oi=>oi.lang),xn.forEach(oi=>{co.push(this.formBuilder.group(oi))});const jb=(0,Rn.VV)(i)?.libId,Mb=this.store.selectSnapshot(E.t.getVariantSchema("skin")),Ib=!(0,R.isEmpty)(Mb),Va=et?.skinLayers??Ib,Bb=et.visibilityLayers??i.sliderLayers?.src?.layers?.length>0,Db=(0,us.mf)(et?.visibilityLayersMode,Va)??Ot.Z.Single;this.chapterForm.patchValue({displayName:n,description:t,contentBlocks:z,cameraAction:W,playCount:Se,autoplay:Le,loopToAudio:ti,mediaControls:Et,legend:lo,audio:xn,lights:jb,skinLayers:Va,visibilityLayers:Bb,visibilityLayersMode:Db,audioType:Sn})}setBookmarkFormValues(i,t){const n=i.title,o=t.tags||[],a=t.playthroughSettings?.enabled??!1,r=(0,R.merge)({references:[],audit:{enabled:!1}},t.sourceInfo),p=this.getTagCategories(o),x=this.createTagCategorySelections(p,o),N=this.bookmarkForm.controls.tagCategories;N.clear(),x.forEach(z=>{const W=this.formBuilder.group({title:"",tags:this.formBuilder.array(z.tags.map(Se=>this.formBuilder.group(Se)))});N.push(W)}),this.bookmarkForm.setValue({displayName:n,playthroughEnabled:a,tagCategories:x,sourceInfo:r})}closeDialog(){const i=this.store.selectSnapshot(j.N.getStoryChapters);this.dialogRef.close(i)}applyTransitionsToAll(){const i=this.store.selectSnapshot(j.N.getStoryChapters),{cameraAction:t}=this.chapterForm.value,n=i.map(o=>new U.VU(o.id,t));this.store.dispatch(n),this.snackbar.open("Transition properties applied to all chapters.")}applyAnimationsToAll(){const t=this.store.selectSnapshot(j.N.getStoryChapters).map(n=>{const o=(0,R.merge)(n.ui,this.getFormAnimationConfig(n));return new U.sC(n.id,o)});this.store.dispatch(t),this.snackbar.open("Animation properties applied to all chapters.")}applyAudioToAll(){const i=this.store.selectSnapshot(j.N.getStoryChapters),t=[];if(this.audioTypeValue===$t.Y.File){const o=this.store.selectSnapshot(j.N.getChapter(this.selectedChapterId)),a=o.media??{},r=i.filter(p=>p.id!==o.id).map(p=>{const x=p.id,z=this.mergeChapterAudio(a,p.media??{});return new U.Eh(x,z)});t.push(...r)}const n=i.map(o=>{const a=(0,R.merge)(o.ui,this.getFormAudioConfig(o));return new U.sC(o.id,a)});t.push(...n),this.store.dispatch(t),this.snackbar.open("Audio settings applied to all chapters.")}getFormUIConfig(i){return(0,R.merge)(i.ui,this.getFormAnimationConfig(this.chapterForm.value),this.getFormAudioConfig(this.chapterForm.value),this.getFormLayersConfig(this.chapterForm.value))}getFormAnimationConfig(i){const{playCount:t,autoplay:n,mediaControls:o,loopToAudio:a}=i;return{play:{count:t,autoplay:n,loopToAudio:a},config:{mediaControls:o}}}getFormAudioConfig(i){const{audioType:t}=i;return{config:{audio:t}}}getFormLayersConfig(i){const{skinLayers:t,visibilityLayers:n,visibilityLayersMode:o}=i;return{config:{skinLayers:t,visibilityLayers:n,visibilityLayersMode:o}}}handleClearTagsSelectionClick(){this.setAllTagSelections(!1)}setAllTagSelections(i){const t=this.bookmarkForm.get("tagCategories").value,n=(0,R.cloneDeep)(t);n.forEach(o=>{o.tags.forEach(a=>a.checked=i)}),this.bookmarkForm.patchValue({tagCategories:n})}getAllTagsList(i){const n=[...Object.values(Fn.IZ).reduce((a,r)=>a.concat(r.tags),[]),...i];return[...new Set(n)].sort()}getTagCategories(i){const t=Object.values(Fn.IZ).reduce((o,a)=>[...o,...a.tags],[]),n=i.filter(o=>!t.includes(o));return n.length>0?[...Fn.IZ,{title:"Uncategorized",tags:n}]:[...Fn.IZ]}getSelectedTagsByCategory(i){return i.tags.filter(t=>t.checked).map(t=>t.tag)}createTagCategorySelections(i,t){return i.map(n=>({title:n.title,tags:n.tags.map(o=>({tag:o,checked:t.includes(o)})).sort((o,a)=>o.tag.toLowerCase()<a.tag.toLowerCase()?-1:1)}))}handleAddLegendItem(){this.store.dispatch(new U.jy(this.selectedChapterId,{label:"",colors:[1,0,0]})),this.selectChapter(this.selectedChapterId)}handleRemoveLegendItem(i){const n=[...this.store.selectSnapshot(j.N.getChapter(this.selectedChapterId)).legend];n.splice(i,1),this.store.dispatch(new U.Lx(this.selectedChapterId,n)),this.selectChapter(this.selectedChapterId)}handleLegendItemDrop(i){const{previousIndex:t,currentIndex:n}=i,a=this.store.selectSnapshot(j.N.getChapter(this.selectedChapterId)).legend||[],r=(0,Gt.W)(a,t,n);this.store.dispatch(new U.Lx(this.selectedChapterId,r)),this.selectChapter(this.selectedChapterId)}createInputsFromLegend(i){return i.map(t=>{const{label:n,colors:o}=t;return{label:n,color:ae.T.rgbToHex(o,!0)}})}createLegendFromInputs(i){return i.map(t=>{const{label:n,color:o}=t;return{label:n,colors:ae.T.hexToRgb(o,!0)}})}createAudioInputs(){return this.mediaService.getAudioClips(this.selectedChapter.media).map(i=>({clipId:i.clipId,lang:i.lang,fullUrl:i.fullUrl}))}handleAddAudioItem(){const i=this.formBuilder.group({clipId:"",lang:Oi.IB.filter(t=>!this.usedLocales.includes(t.lang))[0]?.lang,fullUrl:""});this.audio.push(i)}onAudioFileSuccess(i,t){const n=this.audio.at(t).value,[o,a]=this.mediaService.createAudioClip(this.selectedChapter,i,n.lang),r=Object.assign({},this.selectedChapter.media);r[o]=a,this.store.dispatch(new U.Eh(this.selectedChapterId,r)),this.selectChapter(this.selectedChapterId),this.snackbar.open(`Successfully added ${i}.`)}handleAudioItemChange(i,t){const n=this.audio.at(t).value;n.clipId&&this.updateAudioLang(n.clipId,n.lang)}updateAudioLang(i,t){const n=Object.assign({},this.selectedChapter.media);n[i].lang=t,this.store.dispatch(new U.Eh(this.selectedChapterId,n))}handleRemoveAudioItem(i){const t=this.audio.at(i).value;t.clipId?this.deleteAudio(t.clipId):this.audio.removeAt(i)}deleteAudio(i){const t=Object.assign({},this.selectedChapter.media),o=Object.prototype.hasOwnProperty.call(t,i)?i:(0,R.findKey)(t,a=>a.clipId===i);o?(delete t[o],this.store.dispatch(new U.Eh(this.selectedChapterId,t)),this.selectChapter(this.selectedChapterId),this.snackbar.open("Successfully deleted audio clip.")):this.snackbar.open("Deleting audio clip failed.")}get contentBlocks(){return this.chapterForm.get("contentBlocks")}newImagesBlockFormGroup(i){return this.formBuilder.group({type:se.m.Images,images:this.formBuilder.array(i.images.map(t=>this.formBuilder.group({urls:t.urls,alt:[t.alt,c.k0.maxLength(200)],caption:[t.caption,c.k0.maxLength(200)]})))})}newAnimatedImagesBlockFormGroup(i){return this.formBuilder.group({type:se.m.AnimatedImages,images:this.formBuilder.array(i.images.map(t=>this.formBuilder.group({urls:t.urls,alt:[t.alt,c.k0.maxLength(200)],caption:[t.caption,c.k0.maxLength(200)]})))})}newVideosBlockFormGroup(i){return this.formBuilder.group({type:se.m.Videos,videos:this.formBuilder.array(i.videos.map(t=>this.formBuilder.group({url:t.url,caption:[t.caption,c.k0.maxLength(200)],srcFilename:t.srcFilename})))})}newTickerBlockFormGroup(i){return this.formBuilder.group({type:se.m.Ticker,loopImage:!1,enable:i.enable,images:this.formBuilder.array(i.images.map(t=>this.formBuilder.group({urls:t.urls,alt:[t.alt,c.k0.maxLength(200)],caption:[t.caption,c.k0.maxLength(200)]})))})}newCTABlockFormGroup(i){return this.formBuilder.group({type:se.m.CTA,action:i.action,label:i.label,url:i.url})}checkGetLightLib(){this.disableGetLightLib=0===this.lightLibInput.nativeElement.value.length}handleLightsChange(){const i=this.chapterForm.get("lights").value;this.store.dispatch(new U.zh(this.selectedChapter.id,i))}handleLoadLightsLib(){const i=this.store.selectSnapshot(E.t.getStory),t=this.store.selectSnapshot(j.N.getStoryChapters),n=(0,Rn.d0)(i,t),o=this.lightLibInput.nativeElement.value;n.some(r=>r===o)?this.snackbar.open(`${o} is already loaded.`):this.assetService.loadLightLib(o).then(r=>{n.push(r.libId),this.store.dispatch(new Ee.KM(n)),this.snackbar.open(`Successfully loaded ${o}.`),this.changeRef.markForCheck()},()=>{this.snackbar.open(`Unable to load ${o}.`)}).finally(()=>{this.lightLibInput.nativeElement.value="",this.disableGetLightLib=!0})}getLocaleFlag(i){return`/assets/images/flags/${this.getLocaleFromLang(i).country}.svg`}getLocaleString(i){const t=this.getLocaleFromLang(i);return`${t.title} (${t.lang.toUpperCase()})`}getLocaleFromLang(i){return Oi.IB.find(t=>t.lang===i)}initLights(){const i=this.store.select(E.t.getStory),t=this.store.select(j.N.getStoryChapters);this.lightLibs$=(0,C.z)([i,t]).pipe((0,ve.T)(([n,o])=>(0,Rn.d0)(n,o)),(0,O.F)((n,o)=>(0,R.isEqual)(n,o)),(0,ze.Z)(n=>{const o=n.map(a=>(0,u.H)(this.assetService.loadLightLib(a)));return(0,za.p)(o)}),(0,y.Q)(this.ngUnsubscribe)),this.selectedChapterLightLibs$=(0,C.z)([this.lightLibs$,this.selectedChapter$]).pipe((0,ve.T)(([n,o])=>{if((0,R.isNil)(o))return[];{const a=(0,Rn.VV)(o)?.type??"legacy";return n.filter(r=>r.type===a)}}),(0,y.Q)(this.ngUnsubscribe))}mergeChapterAudio(i,t){const n={...t};return Object.entries(t).filter(([,o])=>"audio"===o.streamType).forEach(([o])=>{delete n[o]}),Object.entries(i).filter(([,o])=>"audio"===o.streamType).forEach(([o,a])=>{n[o]=a}),n}static#e=this.\u0275fac=function(t){return new(t||ot)(e.rXU(c.ok),e.rXU(c.ze),e.rXU(ee.CP),e.rXU(ee.Vh),e.rXU(l.il),e.rXU(Rt.O),e.rXU(hs.u),e.rXU(Qe.UG),e.rXU(e.gRc),e.rXU(Xe.o),e.rXU(Qa.I),e.rXU(Pn.V))};static#t=this.\u0275cmp=e.VBU({type:ot,selectors:[["app-content-dialog"]],viewQuery:function(t,n){if(1&t&&e.GBs(Jr,5),2&t){let o;e.mGM(o=e.lsd())&&(n.lightLibInput=o.first)}},decls:23,vars:11,consts:[["displayName",""],["lightLibInput",""],["description",""],["editTransitionsTmp",""],[1,"content","theme-light"],[1,"content__header"],[1,"text-xl","font-semibold"],[1,"content__body"],[1,"content__sections"],[1,"mb-2"],[1,"content__section-label"],[1,"content__section",3,"click","ngClass"],[1,"content__title"],["class","content__section","data-test","contentChapterItem",3,"ngClass","click",4,"ngFor","ngForOf"],["class","content__editor",4,"ngIf"],[1,"content__footer"],["app-button","","buttonType","primary","buttonTheme","light","type","button","data-test","contentDialogClose",3,"mat-dialog-close"],["data-test","contentChapterItem",1,"content__section",3,"click","ngClass"],[1,"content__index"],[1,"content__editor"],[1,"flex","flex-col","h-full","theme-light",3,"formGroup"],["label","Model Title"],["type","text","formControlName","displayName","maxlength","60","placeholder","e.g. Human Heart","data-test","modelTitleDisplayName",1,"input"],[3,"field"],[1,"!my-4"],[4,"appFlagExternal"],[4,"appFlagInternal"],[1,"py-4"],["formControlName","sourceInfo","label","Source Information",3,"enabledSource","updateDate"],[1,"flex-auto",2,"overflow","auto"],["tabSize","medium","tabTheme","light",3,"scrollable","tabPadded"],["label","Content Tags"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","sm",1,"mb-4",3,"click"],["formArrayName","tagCategories"],[3,"formGroupName","label","isCompact",4,"ngFor","ngForOf"],["label","Source Information"],["formControlName","sourceInfo",3,"enabledSource","updateDate"],["label","Asset Libraries"],[1,"text-xs"],[1,"mb-2","text-xs"],["label","Lights"],[1,"mb-4"],[4,"ngFor","ngForOf"],[1,"flex"],["type","text","placeholder","Enter a library in the form <stateName>/<directoryName>",1,"input",3,"input"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",1,"flex-none","ml-3",3,"click","disabled"],[3,"formGroupName","label","isCompact"],["formArrayName","tags",1,"content__check-group",3,"ngClass"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["formControlName","checked"],[1,"font-semibold","text-uppercase"],[3,"formGroup"],["label","Chapter Title"],["type","text","formControlName","displayName","maxlength","60","data-test","chapterTitleInput",1,"w-full","input"],["label","Chapter Description"],["formControlName","description","data-test","chapterDescriptionInput",3,"inline","resizeable","rows","maxLength"],[1,"!my-8"],["formArrayName","contentBlocks"],[3,"ngSwitch",4,"ngFor","ngForOf"],[1,"mb-2","text-sm","font-bold"],["formArrayName","legend"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["class","flex flex-row items-center my-1 theme-light","cdkDrag","",3,"formGroupName",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","data-test","contentManagerAddLegend",1,"w-40",3,"click"],[1,"py-8"],[1,"py-2","text-xs"],[1,"flex","items-center"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply audio settings to all chapters","matTooltipPosition","above","title","Apply audio settings to all chapters",3,"click"],["icon","copy"],["formControlName","audioType","data-test","contentManagerAudioSelect",1,"mb-3","input"],[3,"value"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"formGroup","type"],[1,"my-8"],[3,"formGroup","type","max"],[4,"ngIf"],["cdkDrag","",1,"flex","flex-row","items-center","my-1","theme-light",3,"formGroupName"],["formControlName","color","dataTestAttributeVal","legendColorPicker",3,"useRootContainer"],["type","text","formControlName","label","placeholder","Legend label","data-test","contentMangerLegendLabel",1,"ml-2","input"],["app-button","","buttonType","text","buttonTheme","light","type","button","matTooltip","Remove",1,"mr-2",3,"click"],["icon","times"],[1,"content__tts-audio"],[1,"w-1/2"],["theme","light",3,"text","language"],["formArrayName","audio"],["class","flex flex-row items-center my-1 mb-3 theme-light content__audio",3,"formGroupName",4,"ngFor","ngForOf"],["app-button","","buttonType","outline","buttonTheme","light","type","button","class","w-40",3,"click",4,"ngIf"],[1,"flex","flex-row","items-center","my-1","mb-3","theme-light","content__audio",3,"formGroupName"],[1,"flex","flex-col","grow"],[1,"flex","justify-end"],["app-button","","buttonType","text","buttonTheme","light","buttonSize","sm","type","button","matTooltip","Remove Audio",1,"mr-2",3,"click"],[1,"pr-3","font-semibold","uppercase","text-2xs"],[1,"px-5"],[1,"pb-1","uppercase","text-2xs"],[1,"relative"],[1,"content__audio-language"],[1,"flex","items-center","pl-3"],["aria-hidden","true",1,"mr-3",3,"src"],["aria-hidden","true"],["icon","caret-down",1,"pr-4"],["formControlName","lang",1,"input","content__audio-language-select",3,"change"],["class","content__audio-language-option",3,"value","disabled",4,"ngFor","ngForOf"],[1,"mt-4","mb-8"],["type","audio","formControlName","fullUrl",3,"uploadSuccess","canDelete"],[1,"content__audio-language-option",3,"value","disabled"],["app-button","","buttonType","outline","buttonTheme","light","type","button",1,"w-40",3,"click"],[1,"py-2","text-xs","content__properties"],[4,"ngTemplateOutlet"],[3,"vertical",4,"ngIf"],["class","flex flex-col ml-2",4,"ngIf"],["formControlName","lights",1,"w-auto","input",3,"change","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"vertical"],[1,"flex","flex-col","ml-2"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply animation to all chapters","matTooltipPosition","above","title","Apply animation to all chapters",3,"click"],[1,"content__properties"],["label","Looping"],["class","content__group","formControlName","playCount",4,"ngIf"],["formControlName","loopToAudio",4,"ngIf"],[1,"!my-4","mr-4"],["formControlName","autoplay"],["label","Media Controls"],["form-field-help",""],[1,"font-bold"],["formControlName","mediaControls",1,"content__group"],["listType","flat"],["value","none"],["value","small"],["value","full"],["formControlName","playCount",1,"content__group"],["formControlName","loopToAudio"],[1,"flex","flex-col","py-2","text-xs"],[1,"mb-3","text-sm","font-bold"],["class","flex flex-col gap-3",4,"ngIf"],["formControlName","skinLayers"],[1,"flex","flex-col","gap-3"],["formControlName","visibilityLayers"],["label","Slider Type",4,"ngIf"],["label","Slider Type"],["formControlName","visibilityLayersMode",1,"w-auto","input"],[1,"!mt-8","mb-4"],[1,"text-xs","content__properties"],[1,"flex","flex-col"],["app-button","","buttonTheme","light","buttonType","text","matTooltip","Apply transition to all chapters","matTooltipPosition","above","title","Apply transition to all chapters",3,"click"],["label","Chapter Transition"],["formControlName","cameraAction",1,"content__group"],["data-test","contentManagerFlyToRadio","value","flyTo"],["value","jumpTo"]],template:function(t,n){if(1&t&&(e.j41(0,"div",4)(1,"div",5)(2,"div",6),e.EFF(3,"Content Manager"),e.k0s()(),e.j41(4,"div",7)(5,"div",8)(6,"div",9)(7,"div",10),e.EFF(8,"Model"),e.k0s(),e.j41(9,"div",11),e.bIt("click",function(){return n.handleModuleClick()}),e.j41(10,"div",12),e.EFF(11),e.nI1(12,"async"),e.k0s()()(),e.j41(13,"div",9)(14,"div",10),e.EFF(15,"Chapters"),e.k0s(),e.DNE(16,Zr,5,5,"div",13),e.nI1(17,"async"),e.k0s()(),e.DNE(18,sl,9,2,"div",14)(19,Il,43,15,"div",14),e.k0s(),e.j41(20,"div",15)(21,"button",16),e.EFF(22," Done "),e.k0s()()()),2&t){let o;e.R7$(9),e.Y8G("ngClass",e.eq3(9,Is,!n.selectedChapterId)),e.R7$(2),e.SpI(" ",(null==(o=e.bMT(12,5,n.story$))?null:o.displayName)||"-No Title-"," "),e.R7$(5),e.Y8G("ngForOf",e.bMT(17,7,n.chapters$)),e.R7$(2),e.Y8G("ngIf",!n.selectedChapterId),e.R7$(),e.Y8G("ngIf",n.selectedChapterId)}},dependencies:[w.YU,w.Sq,w.bT,w.T3,w.ux,w.e1,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.tU,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,Ae.So,qe.VT,qe._g,ee.tx,Ce.oV,Je.q,Y.Q,bs,_s.n,Z.K,Pt.P,X.R,jn.s,Mn.P,jt.j,Mt.O,me.g,bt,Ut,Ui.c,Mr,Dr,$r,Ur,Ms,w.Jj,w.Pc],styles:[".content[_ngcontent-%COMP%]{height:100%;width:100%;padding:24px}.content__header[_ngcontent-%COMP%]{border-bottom:1px solid #d7e0ea;height:40px;display:flex;justify-content:space-between;align-items:center}.content__body[_ngcontent-%COMP%]{height:calc(90vh - 152px);display:flex}.content__footer[_ngcontent-%COMP%]{border-top:1px solid #d7e0ea;height:64px;display:flex;align-items:center;justify-content:flex-end}.content__section-label[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;color:#96a8c0;margin-bottom:4px}.content__sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px 12px 0 0;flex:1 1 35%;overflow:auto}.content__index[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;padding:0 8px}.content__section[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:flex;padding:12px;border-left:4px solid transparent;border-radius:4px;margin-bottom:4px;cursor:pointer;transition:background-color .12s}.content__section[_ngcontent-%COMP%]:hover{background:#eaeff5}.content__section--selected[_ngcontent-%COMP%], .content__section--selected[_ngcontent-%COMP%]:hover{background:#eaeff5;color:#101823;border-color:#2d72dc}.content__title[_ngcontent-%COMP%]{word-break:break-word}.content__thumb[_ngcontent-%COMP%]{background:url(/assets/images/logo-dark-transparent.svg) center center no-repeat;background-size:50%;border-radius:4px;flex:0 0 64px;height:64px;margin-right:12px}.content__editor[_ngcontent-%COMP%]{border-left:1px solid #eaeff5;flex:1 1 75%;padding:16px 24px 48px 12px;overflow:auto}.content__group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.content__check-group[_ngcontent-%COMP%]{grid-template-columns:1fr;display:grid;grid-column-gap:12px;font-size:.75rem;line-height:1rem}.content__check-group--split[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.content__properties[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:grid;grid-template-columns:160px auto auto;grid-column-gap:8px}.content__block[_ngcontent-%COMP%]{display:flex;padding-bottom:16px}.content__block.cdk-drag-preview[_ngcontent-%COMP%] > .content__block-actions[_ngcontent-%COMP%], .content__block.cdk-drag-preview[_ngcontent-%COMP%] > .content__block-text[_ngcontent-%COMP%]{display:none}.content__block-handle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;flex:0 0 36px}.content__block-handle[_ngcontent-%COMP%]:hover{cursor:move}.content__block-image[_ngcontent-%COMP%]{flex:0 0 240px}.content__block-text[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px}.content__block-actions[_ngcontent-%COMP%]{flex:0 0 48px}.content__audio[_ngcontent-%COMP%]{background-color:#f9fafd;border-radius:4px}.content__tts-audio[_ngcontent-%COMP%]{padding:24px 0 24px 8px;border:1px dashed #96a8c0}.content__audio-language[_ngcontent-%COMP%]{padding:6px 0;display:flex;justify-content:space-between;align-items:center;background-color:#fff}.content__audio-language-option[_ngcontent-%COMP%]{font-size:13px}.content__audio-language-select[_ngcontent-%COMP%]{position:absolute;top:0;font-size:0;background:none!important;width:100%;height:36px;appearance:none}"],changeDetection:0})}ri([(0,l.l6)(E.t.getStory),li("design:type",_.c)],ot.prototype,"story$",void 0),ri([(0,l.l6)(je.J.getSelectedBookmark),li("design:type",_.c)],ot.prototype,"bookmark$",void 0),ri([(0,l.l6)(E.t.getStoryLanguage),li("design:type",_.c)],ot.prototype,"storyLanguage$",void 0),ri([(0,l.l6)(j.N.getStoryChapters),li("design:type",_.c)],ot.prototype,"chapters$",void 0),ri([(0,l.l6)(j.N.getSelectedChapterSrcLayers),li("design:type",_.c)],ot.prototype,"visibilityLayers$",void 0),ri([(0,l.l6)(E.t.getVariantSchema("skin")),li("design:type",_.c)],ot.prototype,"skinVariants$",void 0);var It=v(17766),ye=v(13409);const Bl={[H.s.Select]:"mouse-pointer",[H.s.Hide]:"eye-slash",[H.s.Paint]:"fill-drip",[H.s.Label]:"tag",[H.s.Isolate]:"hand-point-up",[H.s.Fade]:"lungs",[H.s.Positions]:"location-dot",[H.s.Quiz]:"user-graduate",[H.s.Eyedropper]:"eye-dropper",[H.s.Image]:"image",[H.s.Dimensions]:"ruler",[H.s.Background]:"square"};var Ie=v(73828),Lt=v(90856),Ns=v(38165),Dl=v(16606),Gl=v(3909),re=v(61295),On=v(75069),Bs=v(68504),So=v(37678),$l=v(16e3),Ol=v(82109),Ue=v(17215);class Al{constructor(i){this.namespaceMap={},this.duplicate=!1,this.replace=!1,Object.assign(this,i)}}var xo=v(21894),Eo=v(12374),Ds=v(97978),ci=v(97352),Ul=v(8961),wo=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Fo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Vl(s,i){1&s&&(e.j41(0,"div",28)(1,"app-message-toggle",29),e.EFF(2," The scene graph will be trimmed using the clipping planes of the currently active chapter. Objects shared with other chapters will be lost. A page reload is recommended. "),e.k0s()())}function Ll(s,i){if(1&s&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Yl(s,i){if(1&s&&(e.j41(0,"option",30),e.EFF(1),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function zl(s,i){if(1&s&&(e.j41(0,"app-form-field",31)(1,"select",32),e.DNE(2,Yl,2,2,"option",18),e.nI1(3,"async"),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",e.bMT(3,1,t.secondaryCategoryOptions$))}}function Xl(s,i){if(1&s&&(e.j41(0,"div",37),e.nrm(1,"app-icon",38),e.j41(2,"span",39),e.EFF(3),e.k0s(),e.j41(4,"span",40),e.EFF(5,"(File exists)"),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(t.modulePath)}}function Ql(s,i){if(1&s&&(e.j41(0,"div",41),e.nrm(1,"app-icon",42),e.j41(2,"span",39),e.EFF(3),e.k0s(),e.j41(4,"span",40),e.EFF(5,"(File exists and cannot be overwritten)"),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(t.modulePath)}}function ql(s,i){if(1&s&&(e.j41(0,"div",43),e.nrm(1,"app-icon",44),e.j41(2,"span",39),e.EFF(3),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(t.modulePath)}}function Hl(s,i){if(1&s&&(e.j41(0,"div",33),e.DNE(1,Xl,6,1,"div",34)(2,Ql,6,1,"div",35)(3,ql,4,1,"div",36),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.moduleExists&&!t.formDuplicateStates.value),e.R7$(),e.Y8G("ngIf",t.moduleExists&&t.formDuplicateStates.value),e.R7$(),e.Y8G("ngIf",!t.moduleExists)}}function Wl(s,i){1&s&&(e.j41(0,"app-form-field",45)(1,"mat-checkbox",46)(2,"span",7),e.EFF(3,"I intend to save to Production"),e.k0s()()())}function Jl(s,i){if(1&s&&(e.j41(0,"div",55)(1,"div",56)(2,"div",49)(3,"div",57),e.nrm(4,"mat-checkbox",58),e.k0s(),e.j41(5,"div",59),e.nrm(6,"input",60)(7,"input",61),e.k0s()()()()),2&s){const t=i.index;e.R7$(),e.Y8G("formGroupName",t)}}function Kl(s,i){if(1&s){const t=e.RV6();e.j41(0,"div"),e.nrm(1,"mat-divider",47),e.j41(2,"app-form-field",48)(3,"div",49),e.nrm(4,"input",50,1),e.j41(6,"button",51),e.bIt("click",function(){e.eBV(t);const o=e.sdS(5),a=e.XpG();return e.Njj(a.handleReplaceClick(o.value))}),e.EFF(7," Replace "),e.k0s(),e.j41(8,"button",52),e.bIt("click",function(){e.eBV(t);const o=e.sdS(5),a=e.XpG();return e.Njj(a.handlePrependClick(o.value))}),e.EFF(9," Prepend "),e.k0s()(),e.j41(10,"div",53),e.DNE(11,Jl,8,1,"div",54),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(11),e.Y8G("ngForOf",t.formStates.controls)}}function Zl(s,i){1&s&&(e.qex(0),e.nrm(1,"app-spinner",62),e.EFF(2," Validating "),e.bVm())}function ec(s,i){1&s&&(e.qex(0),e.nrm(1,"app-spinner",62),e.EFF(2," Saving "),e.bVm())}function tc(s,i){1&s&&(e.qex(0),e.EFF(1," Save Module "),e.bVm())}const Gs="[0-9a-zA-Z_]*",$s=/^[0-9a-zA-Z_]+$/;class Yt{get formName(){return this.form.controls.name}get formStates(){return this.form.controls.states}get formPrimaryCategory(){return this.form.controls.primaryCategory}get formSecondaryCategory(){return this.form.controls.secondaryCategory}get formDuplicateStates(){return this.form.controls.duplicateStates}constructor(i,t,n,o,a,r,p,x){this.store=i,this.actions=t,this.formBuilder=n,this.modulesService=o,this.changeDetector=a,this.snackbar=r,this.dialogRef=p,this.data=x,this.graphTrimDescriptions=xo.i,this.saving=!1,this.moduleExists=!1,this.validating=!1,this.ngUnsubscribe=new f.B,this.settings={...x},this.initForm()}ngOnInit(){this.store.dispatch(new Lt.lu),this.saveModule=this.generateSaveModule(),this.usedStates=this.modulesService.getUsedStates(),this.initApplicationListeners(),this.setFormValidators(),this.initFormListeners(),this.setFormValues(this.saveModule),this.populateStateValues()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initApplicationListeners(){this.actions.pipe((0,l.xi)(Lt.NZ),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleSaveSuccess(i.id)}),this.actions.pipe((0,l.xi)(Lt.G5),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleSaveFail(i.id)})}initFormListeners(){this.formPrimaryCategory.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new Lt.T_(i))}),(0,C.z)([this.formPrimaryCategory.valueChanges,this.formSecondaryCategory.valueChanges,this.formName.valueChanges,this.formDuplicateStates.valueChanges]).pipe((0,y.Q)(this.ngUnsubscribe),(0,K.B)(300)).subscribe(([i,t,n,o])=>{this.handleNameChange(i,t,n,o)}),(0,T.h)(this.formDuplicateStates.valueChanges,this.formStates.valueChanges).pipe((0,Dt.M)(()=>this.validating=!0),(0,K.B)(300),(0,Bt.n)(i=>this.checkStateGroups()),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.validating=!1,this.updateFormStates(i)})}initForm(){this.form=this.formBuilder.group({primaryCategory:this.formBuilder.control("",c.k0.required),secondaryCategory:this.formBuilder.control(""),name:this.formBuilder.control("",[c.k0.required,c.k0.pattern(Gs)]),trimUnavailable:this.formBuilder.control(!1),trimHidden:this.formBuilder.control(!1),trimClipped:this.formBuilder.control(!1),duplicateStates:this.formBuilder.control(!1),confirmProduction:this.formBuilder.control(!1,this.validateProductionSave),states:this.formBuilder.array([this.initStateForm("")])},{validators:[this.validateProductionSave]})}initStateForm(i){return this.formBuilder.group({include:[!0],oldState:[i],newState:[i,[c.k0.required,c.k0.pattern(Gs)]]})}handleReplaceClick(i){this.changeStatePrefix(i,"replace")}handlePrependClick(i){this.changeStatePrefix(i,"prepend")}handleSubmit(){this.form.valid&&this.save()}handleSaveSuccess(i){this.dialogRef.close(!0),this.snackbar.open(`"${i}" successfully saved.`)}handleSaveFail(i){this.dialogRef.close(),this.snackbar.open(`There was an error saving "${i}".`)}generateSaveModule(){return this.modulesService.generateSaveModule(this.settings.id)}populateStateValues(){for(;this.formStates.length>0;)this.formStates.removeAt(0);const i=[];this.modulesService.getUsedStates().forEach(t=>{const n={enabled:!0,state:t};this.formStates.push(this.initStateForm(n.state)),i.push(n)}),this.formStates.markAsDirty()}setFormValidators(){this.formPrimaryCategory.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{switch(i){case"production":case"client":this.formSecondaryCategory.setValidators([c.k0.required]);break;default:this.formSecondaryCategory.setValidators(null),this.formSecondaryCategory.setValue("")}})}setFormValues(i){this.form.patchValue({primaryCategory:"exports"===i.primaryCategory?"preview":i.primaryCategory||"preview",secondaryCategory:i.secondaryCategory||"",name:i.name||"",trimUnavailable:!1,trimHidden:!1,trimClipped:!1,duplicateStates:!1})}save(){const i=this.modulesService.generateModulePath(this.formPrimaryCategory.value,this.formSecondaryCategory.value,this.formName.value),t=new Al;this.formDuplicateStates.value&&(t.duplicate=!0,this.formStates.value.map(p=>{p.include&&(t.namespaceMap[p.oldState]=p.newState)}));const n=new xo.F,{trimUnavailable:o,trimHidden:a,trimClipped:r}=this.form.value;n.graph.unavailable=o,n.graph.hidden=a,n.graph.clipped=r,this.saving=!0,this.store.dispatch(new Lt.oJ(i,t,n))}handleNameChange(i,t,n,o){if(this.modulePath=this.modulesService.generateModulePath(i,t,n),this.formName.errors){const{pattern:a,required:r}=this.formName.errors;if(a||r)return}this.modulePath&&n.length&&this.modulesService.listContents(i,t,n).subscribe(a=>{this.moduleExists=a.length>0;const r=o&&this.moduleExists,p=!$s.test(n);this.formName.setErrors(r||p?{invalid:!0}:null),this.formName.markAsDirty(),this.changeDetector.markForCheck()})}validateProductionSave(i){const t=i.controls?.primaryCategory,n=i.controls?.confirmProduction;return t&&n&&"production"===t.value&&!1===n.value?{confirmProduction:!0}:null}checkStateGroups(){const i=this.formStates.controls.map(t=>this.validateStateGroup(t));return i.length>0?(0,C.z)(i):(0,m.of)([])}validateStateGroup(i){const n=i.controls.newState;return!0===this.formDuplicateStates.value&&!1!==i.controls.include.value?n.errors||0===n.value.length?(0,m.of)({stateControl:n,valid:!1}):this.modulesService.getState(n.value).pipe((0,ve.T)(a=>{const r=$s.test(n.value);return{stateControl:n,valid:0===a.length&&r}})):(0,m.of)({stateControl:n,valid:!0})}updateFormStates(i){i.forEach(t=>{t.valid?(t.stateControl.setErrors(null),t.stateControl.markAsDirty()):t.stateControl.setErrors({stateTaken:!0})}),this.changeDetector.markForCheck()}changeStatePrefix(i,t){this.formStates.controls.forEach(n=>{const o=n.controls.newState;switch(t){case"prepend":o.setValue(`${i}_${o.value}`);break;case"replace":const a=new RegExp(/[^_]*/),r=o.value.replace(a,i);o.setValue(r)}})}static#e=this.\u0275fac=function(t){return new(t||Yt)(e.rXU(l.il),e.rXU(l.En),e.rXU(c.ok),e.rXU(Ds.F),e.rXU(e.gRc),e.rXU(Qe.UG),e.rXU(ee.CP),e.rXU(ee.Vh))};static#t=this.\u0275cmp=e.VBU({type:Yt,selectors:[["app-save-module-dialog"]],decls:43,vars:19,consts:[["name",""],["prefix",""],["mat-dialog-title",""],["mat-dialog-content",""],["data-test","saveDialog",1,"theme-light"],[3,"submit","formGroup"],["data-test","duplicateStates","formControlName","duplicateStates"],[1,"text-xs"],["form-field-help",""],["label","Trim Options",3,"labelElement"],[1,"flex","flex-row","items-center","justify-between"],["data-test","trimHidden","formControlName","trimHidden",3,"matTooltip"],["data-test","trimUnavailable","formControlName","trimUnavailable",3,"matTooltip"],["formControlName","trimClipped",3,"matTooltip"],["class","mt-2",4,"ngIf"],[1,"!mb-4"],["label","Primary Category"],["data-test","primaryCategory","formControlName","primaryCategory",1,"input"],[3,"value",4,"ngFor","ngForOf"],["label","Secondary Category",4,"ngIf"],["label","Name"],["data-test","moduleName","type","text","formControlName","name",1,"w-full","input"],["class","pt-2 text-xs",4,"ngIf"],["label","Production Save",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","data-test","saveModuleSubmit","buttonTheme","light","buttonType","primary",3,"click","disabled"],[1,"mt-2"],["type","danger","icon","exclamation-circle"],[3,"value"],["label","Secondary Category"],["data-test","secondaryCategory","formControlName","secondaryCategory",1,"input"],[1,"pt-2","text-xs"],["class","text-blue-600",4,"ngIf"],["class","text-red-700",4,"ngIf"],["class","text-green-500",4,"ngIf"],[1,"text-blue-600"],["icon","exclamation-triangle"],[1,"pl-2"],[1,"pl-2","font-bold"],[1,"text-red-700"],["icon","exclamation-circle"],[1,"text-green-500"],["icon","check-circle"],["label","Production Save"],["formControlName","confirmProduction"],[1,"!my-4"],["label","Prefix"],[1,"flex"],["type","text","pattern","[^ ]*",1,"input","flex-25","w-25"],["data-test","prefixReplace","type","button","app-button","","buttonType","outline","buttonTheme","light",1,"ml-2",3,"click"],["data-test","prefixPrepend","type","button","app-button","","buttonType","outline","buttonTheme","light",1,"ml-2",3,"click"],["formArrayName","states",1,"py-4","text-xs"],["class","mb-2",4,"ngFor","ngForOf"],[1,"mb-2"],[3,"formGroupName"],[1,"flex-shrink","pt-2","pr-2"],["data-test","includeState","formControlName","include","matTooltip","Include State"],[1,"grow"],["data-test","oldState","type","hidden","formControlName","oldState",1,"input"],["data-test","newState","type","text","formControlName","newState",1,"input"],["size","medium","render","inline",1,"ml-2"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"h1",2),e.EFF(1,"Save Module"),e.k0s(),e.j41(2,"div",3)(3,"div",4)(4,"form",5),e.bIt("submit",function(){return e.eBV(o),e.Njj(n.handleSubmit())}),e.j41(5,"app-form-field")(6,"mat-checkbox",6)(7,"span",7),e.EFF(8,"Duplicate Content States"),e.k0s()(),e.j41(9,"div",8),e.EFF(10," This requires that you specify the location for the new module, and new unused names for each of the content states. "),e.k0s()(),e.j41(11,"app-form-field",9)(12,"div",10)(13,"mat-checkbox",11)(14,"span",7),e.EFF(15,"Hidden Objects"),e.k0s()(),e.j41(16,"mat-checkbox",12)(17,"span",7),e.EFF(18,"Unavailable Objects"),e.k0s()(),e.j41(19,"mat-checkbox",13)(20,"span",7),e.EFF(21,"Clipped Objects"),e.k0s()()(),e.DNE(22,Vl,3,0,"div",14),e.k0s(),e.nrm(23,"mat-divider",15),e.j41(24,"app-form-field",16)(25,"select",17),e.DNE(26,Ll,2,2,"option",18),e.nI1(27,"async"),e.k0s()(),e.DNE(28,zl,4,3,"app-form-field",19),e.nI1(29,"async"),e.j41(30,"app-form-field",20),e.nrm(31,"input",21,0),e.DNE(33,Hl,4,3,"div",22),e.k0s(),e.DNE(34,Wl,4,0,"app-form-field",23)(35,Kl,12,1,"div",24),e.k0s()()(),e.j41(36,"div",25)(37,"button",26),e.EFF(38,"Cancel"),e.k0s(),e.j41(39,"button",27),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSubmit())}),e.DNE(40,Zl,3,0,"ng-container",24)(41,ec,3,0,"ng-container",24)(42,tc,2,0,"ng-container",24),e.k0s()()}if(2&t){let o;const a=e.sdS(32);e.R7$(4),e.Y8G("formGroup",n.form),e.R7$(7),e.Y8G("labelElement",!1),e.R7$(2),e.Y8G("matTooltip",n.graphTrimDescriptions.hidden),e.R7$(3),e.Y8G("matTooltip",n.graphTrimDescriptions.unavailable),e.R7$(3),e.Y8G("matTooltip",n.graphTrimDescriptions.clipped),e.R7$(3),e.Y8G("ngIf",n.form.value.trimClipped),e.R7$(4),e.Y8G("ngForOf",e.bMT(27,15,n.primaryCategoryOptions$)),e.R7$(2),e.Y8G("ngIf",null==(o=e.bMT(29,17,n.secondaryCategoryOptions$))?null:o.length),e.R7$(5),e.Y8G("ngIf",n.modulePath&&a.value.length),e.R7$(),e.Y8G("ngIf","production"===n.formPrimaryCategory.value),e.R7$(),e.Y8G("ngIf",n.formDuplicateStates.value),e.R7$(4),e.Y8G("disabled",n.saving||!n.form.valid||n.validating),e.R7$(),e.Y8G("ngIf",n.validating),e.R7$(),e.Y8G("ngIf",n.saving),e.R7$(),e.Y8G("ngIf",!n.validating&&!n.saving)}},dependencies:[w.Sq,w.bT,Ae.So,ee.tx,ee.BI,ee.E7,ee.Yi,Ce.oV,Je.q,Y.Q,Z.K,X.R,ci.tI,Ul.X,c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,w.Jj],changeDetection:0})}wo([(0,l.l6)(Eo.z.getSaveModule),Fo("design:type",_.c)],Yt.prototype,"saveModule$",void 0),wo([(0,l.l6)(Eo.z.getPrimaryCategoryOptions("write")),Fo("design:type",_.c)],Yt.prototype,"primaryCategoryOptions$",void 0),wo([(0,l.l6)(Eo.z.getSecondaryCategoryOptions),Fo("design:type",_.c)],Yt.prototype,"secondaryCategoryOptions$",void 0);var zi=v(84370),Os=v(65881),As=v(62949),he=v(87710),An=v(7213),ic=v(59e3),Us=v(82323),Un=v(65650),nc=v(1580);const oc=[.1,.25,.5,1,1.5,2];var ue,s;(s=ue||(ue={})).SetScale=(()=>{class p{static#e=this.type="[Edit Timeline] Set Scale";constructor(N){this.scale=N}}return p})(),s.SetSelectedTimelineMapIds=(()=>{class p{static#e=this.type="[Edit Timeline] Set selectedTimelineMapIds";constructor(N){this.selectedTimelineMapIds=N}}return p})(),s.AddToSelectedTimelineMapIds=(()=>{class p{static#e=this.type="[Edit Timeline] Add to selectedTimelineMapIds";constructor(N){this.selectedTimelineMapIds=N}}return p})(),s.RemoveFromSelectedTimelineMapIds=(()=>{class p{static#e=this.type="[Edit Timeline] Remove from selectedTimelineMapIds";constructor(N){this.selectedTimelineMapIds=N}}return p})(),s.SetOverlappingTimelineMapIds=(()=>{class p{static#e=this.type="[Edit Timeline] Set overlappingTimelineMapIds";constructor(N){this.overlappingTimelineMapIds=N}}return p})(),s.SetCopiedTimelineMaps=(()=>{class p{static#e=this.type="[Edit Timeline] Set copiedTimelineMaps";constructor(N){this.copiedTimelineMaps=N}}return p})();class Vn{}var st=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},ce=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const sc={scale:1,selectedTimelineMapIds:new Set([]),overlappingTimelineMapIds:new Set([]),copiedTimelineMaps:[]};let Te=class mo{static getScale(i){return i.scale}static getSelectedTimelineMapIds(i){return i.selectedTimelineMapIds}static getOverlappingTimelineMapIds(i){return i.overlappingTimelineMapIds}static getCopiedTimelineMaps(i){return i.copiedTimelineMaps}setScale(i,{scale:t}){i.patchState({scale:t})}setSelectedTimelineMapIds(i,{selectedTimelineMapIds:t}){i.patchState({selectedTimelineMapIds:new Set(t)})}addSelectedTimelineMapId(i,t){const n=i.getState().selectedTimelineMapIds;t.selectedTimelineMapIds.forEach(o=>n.add(o)),i.patchState({selectedTimelineMapIds:new Set(Array.from(n))})}removeSelectedTimelineMapId(i,t){const n=i.getState().selectedTimelineMapIds;t.selectedTimelineMapIds.forEach(o=>n.delete(o)),i.patchState({selectedTimelineMapIds:new Set(Array.from(n))})}setOverlappingTimelineMapIds(i,{overlappingTimelineMapIds:t}){i.patchState({overlappingTimelineMapIds:new Set(t)})}setCopiedTimelineMaps(i,{copiedTimelineMaps:t}){i.patchState({copiedTimelineMaps:t})}static#e=this.\u0275fac=function(t){return new(t||mo)};static#t=this.\u0275prov=e.jDH({token:mo,factory:mo.\u0275fac})};st([(0,l.rc)(ue.SetScale),ce("design:type",Function),ce("design:paramtypes",[Object,ue.SetScale]),ce("design:returntype",void 0)],Te.prototype,"setScale",null),st([(0,l.rc)(ue.SetSelectedTimelineMapIds),ce("design:type",Function),ce("design:paramtypes",[Object,ue.SetSelectedTimelineMapIds]),ce("design:returntype",void 0)],Te.prototype,"setSelectedTimelineMapIds",null),st([(0,l.rc)(ue.AddToSelectedTimelineMapIds),ce("design:type",Function),ce("design:paramtypes",[Object,ue.AddToSelectedTimelineMapIds]),ce("design:returntype",void 0)],Te.prototype,"addSelectedTimelineMapId",null),st([(0,l.rc)(ue.RemoveFromSelectedTimelineMapIds),ce("design:type",Function),ce("design:paramtypes",[Object,ue.RemoveFromSelectedTimelineMapIds]),ce("design:returntype",void 0)],Te.prototype,"removeSelectedTimelineMapId",null),st([(0,l.rc)(ue.SetOverlappingTimelineMapIds),ce("design:type",Function),ce("design:paramtypes",[Object,ue.SetOverlappingTimelineMapIds]),ce("design:returntype",void 0)],Te.prototype,"setOverlappingTimelineMapIds",null),st([(0,l.rc)(ue.SetCopiedTimelineMaps),ce("design:type",Function),ce("design:paramtypes",[Object,ue.SetCopiedTimelineMaps]),ce("design:returntype",void 0)],Te.prototype,"setCopiedTimelineMaps",null),st([(0,l.MD)(),ce("design:type",Function),ce("design:paramtypes",[Vn]),ce("design:returntype",void 0)],Te,"getScale",null),st([(0,l.MD)(),ce("design:type",Function),ce("design:paramtypes",[Vn]),ce("design:returntype",void 0)],Te,"getSelectedTimelineMapIds",null),st([(0,l.MD)(),ce("design:type",Function),ce("design:paramtypes",[Vn]),ce("design:returntype",void 0)],Te,"getOverlappingTimelineMapIds",null),st([(0,l.MD)(),ce("design:type",Function),ce("design:paramtypes",[Vn]),ce("design:returntype",void 0)],Te,"getCopiedTimelineMaps",null),Te=st([(0,l.Uw)({name:"editTimeline",defaults:sc})],Te);var pi=v(58398),lt=v(63365),Vs=v(96728),Ls=v(79898),Ln=v(72865),Ys=v(54169),_t=v(28696),di=v(43194),zs=v(51452);let ac=(()=>{class s{constructor(t,n){this.store=t,this.dialogRef=n,this.actionMode=Ls.g.Import,this.application=Fe.c.application,this.contentType=It.c.Module,this.ngUnsubscribe=new f.B}ngOnInit(){this.initGallery()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initGallery(){const t=new Ln.qS("exports"),n=this.store.selectSnapshot(di.Y.getSearchOptions)||new Ys.n("",Vs.Ir);this.store.dispatch(new _t.w.SetCardActions({enabled:!1})),this.store.dispatch(new _t.w.SetBulkActions({enabled:!1,items:[]})),this.store.dispatch(new _t.w.SetSearchConfig(t)),this.store.dispatch(new _t.w.SetSearchOptions(n))}handleSelect(t){this.dialogRef.close(t)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(l.il),e.rXU(ee.CP))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-merge-module-dialog"]],decls:5,vars:4,consts:[[1,"merge"],[1,"merge__header"],[1,"merge__body"],["selectLabel","Import",3,"selectBookmark","actionMode","application","contentType","showSourcePicker"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2,"Merge Module"),e.k0s(),e.j41(3,"div",2)(4,"app-gallery-container",3),e.bIt("selectBookmark",function(r){return o.handleSelect(r)}),e.k0s()()()),2&n&&(e.R7$(4),e.Y8G("actionMode",o.actionMode)("application",o.application)("contentType",o.contentType)("showSourcePicker",!1))},dependencies:[zs.j],styles:["[_nghost-%COMP%]{display:block;position:relative;padding:12px;width:100%;height:100%}.merge[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.merge__header[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;border-bottom:solid 1px rgba(0,0,0,.12);padding:8px 20px;display:flex;align-items:center}.merge__body[_ngcontent-%COMP%]{flex:1 0 auto;position:relative}"],changeDetection:0})}return s})(),rc=(()=>{class s{constructor(t,n){this.dialogRef=t,this.data=n,this.resolve=new c.hs("loft")}ngOnInit(){}handleCancelClick(){this.dialogRef.close()}handleResolveClick(){this.dialogRef.close(this.resolve.value)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(ee.CP),e.rXU(ee.Vh))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-merge-conflict-dialog"]],decls:20,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"merge-conflict-dialog"],[1,"merge-conflict-dialog__message"],["icon","info-circle",1,"merge-conflict-dialog__message-icon","mr-3"],[1,"text-xs"],[1,"text-sm","mb-3"],[1,"text-xs","flex","flex-col",3,"formControl"],["value","loft",1,"mb-2"],["value","bridge"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","buttonType","default",3,"click"],["app-button","","buttonType","primary",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"h1",0),e.EFF(1,"Resolve Merge Conflicts"),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"app-icon",4),e.j41(6,"p",5),e.EFF(7," There are conflicts with Particle Systems that prevent automatic merging. "),e.k0s()(),e.j41(8,"div",6),e.EFF(9,"Choose which changes to accept"),e.k0s(),e.j41(10,"mat-radio-group",7)(11,"mat-radio-button",8),e.EFF(12),e.k0s(),e.j41(13,"mat-radio-button",9),e.EFF(14),e.k0s()()()(),e.j41(15,"div",10)(16,"button",11),e.bIt("click",function(){return o.handleCancelClick()}),e.EFF(17," Cancel "),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return o.handleResolveClick()}),e.EFF(19,"Resolve and Merge"),e.k0s()()),2&n&&(e.R7$(10),e.Y8G("formControl",o.resolve),e.R7$(2),e.SpI("",o.data.loft," (current)"),e.R7$(2),e.SpI("",o.data.bridge," (incoming)"))},dependencies:[qe.VT,qe._g,ee.BI,ee.E7,ee.Yi,Y.Q,X.R,c.BC,c.l_],styles:[".merge-conflict-dialog[_ngcontent-%COMP%]{width:400px}.merge-conflict-dialog__message[_ngcontent-%COMP%]{display:flex;padding:12px;align-items:center;justify-content:center;background-color:#ffe2db;border-radius:4px}.merge-conflict-dialog__message-icon[_ngcontent-%COMP%]{color:#de3535}"],changeDetection:0})}return s})();var lc=v(25382),_e=v(74988),mi=v(35379),cc=v(16058),pc=v(97443),Xs=v(12215),dc=v(91443),mc=v(90265);const uc=["previewBody"];let hc=(()=>{class s{constructor(t,n,o,a,r){this.dialogRef=t,this.publishService=n,this.changeDetectorRef=o,this.storageService=a,this.DeviceTypeEnum=mi.k,this.previewDimensions={[mi.k.Desktop]:q,[mi.k.Tablet]:fe,[mi.k.Mobile]:si},this.device=mi.k.Desktop,this.options={dimensions:{width:1,height:1,type:pc.M.Fixed},labelsEnabled:!0,labelScale:1,scalable:!0,backgroundColor:null,options:null},this.previewPadding=20,this.ngUnsubscribe=new f.B,this.data=r,this.formGroup=new c.gE({title:new c.MJ(""),width:new c.MJ(_e.SJ.width,[c.k0.required,c.k0.min(_e.SJ.width),c.k0.max(_e.Av.width)]),height:new c.MJ(_e.SJ.height,[c.k0.required,c.k0.min(_e.SJ.height),c.k0.max(_e.Av.height)])})}ngOnInit(){this.setEmbedUrl(),this.initFormListeners()}ngAfterViewInit(){const t=this.storageService.getSessionItem(Ue.d0.PreviewSize);t?this.setDimensions(t):this.setDevice(mi.k.Desktop)}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleCloseClick(){this.dialogRef.close()}setDeviceClick(t){this.setDevice(t)}setMaximizeClick(){this.viewerType=null;const{innerWidth:t,innerHeight:n}=window;this.setDimensions({width:t,height:n})}getDeviceTooltip(t){const{label:n,width:o,height:a}=this.previewDimensions[t];return ge(n,o,a)}getMaximizeTooltip(){const{innerWidth:t,innerHeight:n}=window;return ge("Maximize",t,n)}isMaximizeSelected(){const{innerWidth:t,innerHeight:n}=window,{width:o,height:a}=this.options.dimensions;return o===t&&a===n}setDevice(t){this.viewerType=null,this.setDimensions(this.previewDimensions[t])}initFormListeners(){this.formGroup.valueChanges.pipe((0,I.p)(()=>this.formGroup.valid),(0,K.B)(100),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(({width:t,height:n})=>{this.viewerType=null,this.setDimensions({width:t,height:n})})}setEmbedUrl(){const{lang:t,productAccountId:n,quizLocked:o,questionNumber:a}=this.data,r={id:"preview","ui-loader":"circle",lang:t};o&&(r["ui-quiz-locked"]=o,(0,R.isNil)(a)||(r["ui-quiz-start"]=a+1,r["ui-quiz-end"]=a+1)),n&&(r.paid=n),this.url=Fe.c.deploy===Xs.Z.Local||Fe.c.application===Me.c.Loft&&Fe.c.deploy===Xs.Z.QA?`/view?id=preview&lang=${t}`:this.publishService.buildWidgetURL("/viewer",r),this.changeDetectorRef.markForCheck()}setViewerType(t){Object.entries(this.previewDimensions).forEach(([n,o])=>{(0,R.isEqual)(o,t)&&(this.viewerType=n)})}setDimensions(t){this.setViewerType(t),this.formGroup.patchValue(t,{emitEvent:!1}),this.storageService.setSessionItem(Ue.d0.PreviewSize,t),Object.assign(this.options.dimensions,t),this.options={...this.options},this.changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(ee.CP),e.rXU(cc.D),e.rXU(e.gRc),e.rXU(Ue.n$),e.rXU(ee.Vh))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-preview-dialog"]],viewQuery:function(n,o){if(1&n&&e.GBs(uc,5),2&n){let a;e.mGM(a=e.lsd())&&(o.previewBody=a.first)}},decls:24,vars:17,consts:[["previewBody",""],["data-test","preview",1,"preview"],[1,"preview__header"],[1,"text-base"],[1,"flex","items-center","theme-dark",3,"formGroup"],[1,"preview__devices"],["data-test","previewMaximizeButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","maximize"],["data-test","previewDesktopButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","desktop"],["data-test","previewTabletButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","tablet-alt"],["data-test","previewMobileButton","app-button","","buttonTheme","dark","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","mobile-alt"],[1,"mx-3"],["isCompact","true","display","inline","label","width",1,"mr-4"],["data-test","previewWidth","type","number","formControlName","width",1,"input","input--small",2,"width","80px"],["isCompact","true","display","inline","label","height"],["data-test","previewHeight","type","number","formControlName","height",1,"input","input--small",2,"width","80px"],["data-test","previewClose","app-button","","buttonTheme","dark","buttonType","primary","buttonSize","sm",3,"click"],[1,"preview__body"],["theme","light",1,"preview__embed",3,"device","url","options","compact"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h2",3),e.EFF(3,"Preview"),e.k0s(),e.j41(4,"div",4)(5,"div",5)(6,"button",6),e.bIt("click",function(){return e.eBV(a),e.Njj(o.setMaximizeClick())}),e.nrm(7,"app-icon",7),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return e.eBV(a),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Desktop))}),e.nrm(9,"app-icon",9),e.k0s(),e.j41(10,"button",10),e.bIt("click",function(){return e.eBV(a),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Tablet))}),e.nrm(11,"app-icon",11),e.k0s(),e.j41(12,"button",12),e.bIt("click",function(){return e.eBV(a),e.Njj(o.setDeviceClick(o.DeviceTypeEnum.Mobile))}),e.nrm(13,"app-icon",13),e.k0s()(),e.nrm(14,"app-divider",14),e.j41(15,"app-form-field",15),e.nrm(16,"input",16),e.k0s(),e.j41(17,"app-form-field",17),e.nrm(18,"input",18),e.k0s()(),e.j41(19,"button",19),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleCloseClick())}),e.EFF(20," Exit Preview "),e.k0s()(),e.j41(21,"div",20,0),e.nrm(23,"app-embed-viewer",21),e.k0s()()}2&n&&(e.R7$(4),e.Y8G("formGroup",o.formGroup),e.R7$(2),e.Y8G("buttonType",o.isMaximizeSelected()?"info":"default")("matTooltip",o.getMaximizeTooltip()),e.BMQ("data-selected",o.isMaximizeSelected()),e.R7$(2),e.Y8G("buttonType","desktop"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Desktop)),e.BMQ("data-selected","desktop"===o.viewerType),e.R7$(2),e.Y8G("buttonType","tablet"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Tablet)),e.R7$(2),e.Y8G("buttonType","mobile"===o.viewerType?"info":"default")("matTooltip",o.getDeviceTooltip(o.DeviceTypeEnum.Mobile)),e.R7$(11),e.xc7("padding",o.previewPadding,"px"),e.Y8G("device",o.device)("url",o.url)("options",o.options)("compact",!0))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,Ce.oV,Y.Q,Z.K,X.R,dc.h,mc.B],styles:[".preview[_ngcontent-%COMP%]{height:100vh}.preview__header[_ngcontent-%COMP%]{height:48px;flex:0 0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#131c2a;color:#d7e0ea;border-bottom:1px solid #283853}.preview__devices[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.preview__body[_ngcontent-%COMP%]{height:calc(100vh - 48px);background:#fff;padding-top:12px}.preview__embed[_ngcontent-%COMP%]{display:block;width:100%;height:100%}"],changeDetection:0})}return s})();var Ro=v(93844),vt=v(58832),Re=v(76016),fc=v(35650),Yn=v(62943),Po=v(10352),Qs=v(32258),qs=v(93547),Xi=v(25780);let Ve=(()=>{class s{get digitSizeInPixels(){return 40+8*this.digitSize}get value(){return this._value}set value(t){null!=t&&(null==this._initialValue&&(this._initialValue=t),this._value=t,this.propagateChange(this.value))}constructor(){this.theme="dark",this.min=0,this.max=100,this.step=1,this.digitSize=5,this.label="",this._value=0,this.disabled=!1,this.blurred=new e.bkB,this.mouseUp=new e.bkB,this.onChange=()=>{},this.onTouched=()=>{},this.propagateChange=t=>{}}ngOnInit(){}handleMouseUp(){this.mouseUp.emit()}handleBlur(){this.blurred.emit()}handleRangeDoubleClick(){this.value=this._initialValue}writeValue(t){this.value=t}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-slider"]],inputs:{theme:"theme",min:"min",max:"max",step:"step",digitSize:"digitSize",value:"value",label:"label"},outputs:{blurred:"blurred",mouseUp:"mouseUp"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}])],decls:5,vars:18,consts:[[1,"slider"],[1,"slider__range"],["type","range",1,"range",3,"ngModelChange","dblclick","mouseup","ngModel","min","max","step","disabled"],[1,"slider__input"],["type","number","data-test","sliderNumberInput",1,"input",3,"ngModelChange","blur","ngModel","min","max","step","disabled"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"input",2),e.mxI("ngModelChange",function(r){return e.DH7(o.value,r)||(o.value=r),r}),e.bIt("dblclick",function(){return o.handleRangeDoubleClick()})("mouseup",function(){return o.handleMouseUp()}),e.k0s()(),e.j41(3,"div",3)(4,"input",4),e.mxI("ngModelChange",function(r){return e.DH7(o.value,r)||(o.value=r),r}),e.bIt("blur",function(){return o.handleBlur()}),e.k0s()()()),2&n&&(e.R7$(2),e.AVh("light","light"===o.theme)("dark","dark"===o.theme),e.R50("ngModel",o.value),e.Y8G("min",o.min)("max",o.max)("step",o.step)("disabled",o.disabled),e.BMQ("aria-label",o.label),e.R7$(),e.xc7("flex-basis",o.digitSizeInPixels+"px"),e.R7$(),e.R50("ngModel",o.value),e.Y8G("min",o.min)("max",o.max)("step",o.step)("disabled",o.disabled),e.BMQ("aria-label",o.label))},dependencies:[c.me,c.Q0,c.MR,c.BC,c.VZ,c.zX,c.vS],styles:[".slider[_ngcontent-%COMP%]{align-items:center;display:flex}.slider__range[_ngcontent-%COMP%]{flex:1 1 100%}.slider__input[_ngcontent-%COMP%]{flex:0 0 40px;margin-left:8px}"]})}return s})();var _c=v(345);let Hs=(()=>{class s{get isTransparent(){return this.color&&(0,Yn.ty)(this.color)}constructor(t){this.domSanitizer=t,this.size="medium"}getBackgroundCSS(){if(this.color&&!this.isTransparent){const t=(0,Yn.tH)(this.color);return this.domSanitizer.bypassSecurityTrustStyle(t)}return null}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(_c.up))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-swatch-item"]],inputs:{color:"color",size:"size",selected:"selected"},decls:1,vars:16,consts:[[1,"item"]],template:function(n,o){1&n&&e.nrm(0,"div",0),2&n&&(e.xc7("background-image",o.getBackgroundCSS()),e.AVh("item--x-small","x-small"===o.size)("item--small","small"===o.size)("item--medium","medium"===o.size)("item--large","large"===o.size)("item--x-large","x-large"===o.size)("item--selected",o.selected)("item--transparent",o.isTransparent))},styles:[".item[_ngcontent-%COMP%]{border-style:solid;border-width:1px;border-color:#eaeff5;border-radius:1px;cursor:pointer}.item--small[_ngcontent-%COMP%]{width:12px;height:12px}.item--medium[_ngcontent-%COMP%]{width:24px;height:24px}.item--large[_ngcontent-%COMP%]{width:36px;height:36px}.item--selected[_ngcontent-%COMP%]{border-color:#2d72dc;border-width:2px}.item--transparent[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f9fafd 48%,#de3535,#f9fafd 52%)}"],changeDetection:0})}return s})();var jo=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Mo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const vc=["presetTab"],Cc=["customTab"];function yc(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-swatch-item",22),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handlePresetSelected(o))}),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("color",t)("size","medium")("selected",n.backgroundsEqual(t,n.presetBackground))}}function kc(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-swatch-item",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handlePresetSelected(o))}),e.k0s()}2&s&&e.Y8G("color",i.$implicit)("size","medium")}function Tc(s,i){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"app-form-field",24)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleFormColorSelected("color1",o))}),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(2),e.xc7("background",t.getFormBackgroundHex("color1")),e.Y8G("colorPicker",t.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled")}}function Sc(s,i){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"app-form-field",26)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleFormColorSelected("color1",o))}),e.k0s()(),e.j41(3,"app-form-field",27)(4,"span",28),e.nrm(5,"app-slider",29),e.k0s()(),e.j41(6,"app-form-field",30)(7,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleFormColorSelected("color2",o))}),e.k0s()(),e.j41(8,"app-form-field",31)(9,"span",28),e.nrm(10,"app-slider",32),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(2),e.xc7("background",t.getFormBackgroundHex("color1")),e.Y8G("colorPicker",t.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100),e.R7$(2),e.xc7("background",t.getFormBackgroundHex("color2")),e.Y8G("colorPicker",t.getFormBackgroundHex("color2"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100)}}function xc(s,i){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"app-form-field",33)(2,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleFormColorSelected("color1",o))}),e.k0s()(),e.j41(3,"app-form-field",34)(4,"span",28),e.nrm(5,"app-slider",29),e.k0s()(),e.j41(6,"app-form-field",35)(7,"input",25),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleFormColorSelected("color2",o))}),e.k0s()(),e.j41(8,"app-form-field",36)(9,"span",28),e.nrm(10,"app-slider",32),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(2),e.xc7("background",t.getFormBackgroundHex("color1")),e.Y8G("colorPicker",t.getFormBackgroundHex("color1"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100),e.R7$(2),e.xc7("background",t.getFormBackgroundHex("color2")),e.Y8G("colorPicker",t.getFormBackgroundHex("color2"))("cpOutputFormat","hex")("cpAlphaChannel","disabled"),e.R7$(3),e.Y8G("min",0)("max",100)}}function Ec(s,i){1&s&&(e.j41(0,"div")(1,"app-alert",37),e.EFF(2," The background of your application will appear behind the 3D model. "),e.k0s()())}class zt{constructor(i,t,n,o,a){this.store=i,this.actions=t,this.fb=n,this.snackBar=o,this.popupRef=a,this.presetBackgrounds="module"===Fe.c.exportType?Po.aN:Po.vk,this.ngUnsubscribe=new f.B}ngOnInit(){this.initPresets(),this.initForm(),this.actions.pipe((0,l.rM)(U.EN),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Successfully applied color to all chapters.")})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initPresets(){this.presetBackground=this.store.selectSnapshot(j.N.getSelectedChapterBackground),this.background$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.presetBackground=i}),this.allChapterBackgrounds$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.distinctBackgrounds=i.filter((t,n)=>i.findIndex(o=>this.backgroundsEqual(t,o))===n)})}initForm(){const i=this.store.selectSnapshot(j.N.getSelectedChapterBackground);this.form=this.fb.group({type:["solid",[c.k0.required]],color1:["",[c.k0.required]],stop1:[0,[c.k0.required,c.k0.min(0),c.k0.max(100)]],color2:["",[c.k0.required]],stop2:[100,[c.k0.required,c.k0.min(0),c.k0.max(100)]]}),this.form.valueChanges.pipe((0,I.p)(()=>this.customTab.isActive),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.applyFromCustom()}),i&&this.setCustomColorForm(i)}handleFormColorSelected(i,t){this.form.get(i).setValue(t)}handlePresetSelected(i){this.presetBackground=i,this.store.dispatch(new U.pb(i))}handleResetClick(){this.store.dispatch(new U.Wd)}handleTabChange(i){this.customTab.isActive&&this.presetBackground&&this.setCustomColorForm(this.presetBackground)}backgroundsEqual(i,t){return(0,R.isEqual)(i,t)}getBackgroundHex(i){const t=i.colors;return ae.T.rgbToHex([t[0],t[1],t[2]])}getFormBackgroundHex(i){return this.form.get(i).value}applyAll(){const i=this.form.value.type;if(this.presetTab.isActive)this.store.dispatch(new U.EN(this.presetBackground));else if(this.customTab.isActive){const t=this.formToBackgroundColor(i);t&&this.store.dispatch(new U.EN(t))}}applyFromCustom(){const t=this.formToBackgroundColor(this.form.value.type);t&&this.store.dispatch(new U.pb(t))}setCustomColorForm(i){let t="solid",n="",o="",a=0,r=100;const{colors:p,gradientType:x,colorStops:N}=i,z=[p[0],p[1],p[2]],W=p.length<8?z:[p[4],p[5],p[6]];n=ae.T.rgbToHex(z,!1),o=ae.T.rgbToHex(W,!1),t=(0,Yn.ty)(i)?"transparent":(0,R.isEqual)(z,W)?"solid":x,a=N[0],r=N[1],this.form.patchValue({type:t,color1:n,stop1:a,color2:o,stop2:r})}formToBackgroundColor(i){const{color1:t,color2:n,stop1:o,stop2:a}=this.form.value;if("transparent"===i)return Po.Vw;if(!this.form.valid||(0,R.isNil)(t)||(0,R.isNil)(n))return null;const p="radial"===i?"radial":"linear",x=[...ae.T.hexToRgb(t,!1),1],N="solid"===i?x:[...ae.T.hexToRgb(n,!1),1];return{colors:[...x,...N],gradientType:p,colorStops:[o,a]}}static#e=this.\u0275fac=function(t){return new(t||zt)(e.rXU(l.il),e.rXU(l.En),e.rXU(c.ze),e.rXU(Qe.UG),e.rXU(Qs.W))};static#t=this.\u0275cmp=e.VBU({type:zt,selectors:[["app-background-color-dialog"]],viewQuery:function(t,n){if(1&t&&(e.GBs(vc,7),e.GBs(Cc,7)),2&t){let o;e.mGM(o=e.lsd())&&(n.presetTab=o.first),e.mGM(o=e.lsd())&&(n.customTab=o.first)}},decls:35,vars:8,consts:[["presetTab",""],["customTab",""],["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane",1,"background","theme-light"],["tabSize","medium","tabTheme","light",3,"activeTabChange"],["label","Presets"],[1,"background__section","mt-3"],[1,"background__swatches"],[3,"color","size","selected","click",4,"ngFor","ngForOf"],[1,"background__actions"],["app-button","","buttonTheme","light","buttonType","outline","buttonSize","md",3,"click"],[1,"text-2xs","text-nowrap"],["label","Currently Used"],[3,"color","size","click",4,"ngFor","ngForOf"],["label","Custom"],[1,"background__section","mt-4",3,"formGroup","ngSwitch"],["label","Type"],["formControlName","type",1,"input"],["value","solid"],["value","radial"],["value","linear"],["value","transparent"],[4,"ngSwitchCase"],[3,"click","color","size","selected"],[3,"click","color","size"],["label","Color"],["type","text","cpPosition","left",1,"input",3,"colorPickerChange","colorPicker","cpOutputFormat","cpAlphaChannel"],["label","Inner Color"],["label","Inner Radius"],["appEventFence",""],["theme","light","formControlName","stop1",3,"min","max"],["label","Outer Color"],["label","Outer Radius"],["theme","light","formControlName","stop2",3,"min","max"],["label","Starting Color"],["label","Starting Color Stop"],["label","Ending Color"],["label","Ending Color Stop"],["type","info","theme","light"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",2)(1,"app-tabs",3),e.bIt("activeTabChange",function(r){return e.eBV(o),e.Njj(n.handleTabChange(r))}),e.j41(2,"app-tab",4,0)(4,"div",5)(5,"app-form-field")(6,"div",6),e.DNE(7,yc,1,3,"app-swatch-item",7),e.k0s()(),e.j41(8,"div",8)(9,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.applyAll())}),e.j41(10,"span",10),e.EFF(11,"Apply to All"),e.k0s()(),e.j41(12,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.j41(13,"span",10),e.EFF(14,"Restore Original"),e.k0s()()(),e.j41(15,"app-form-field",11)(16,"div",6),e.DNE(17,kc,1,2,"app-swatch-item",12),e.k0s()()()(),e.j41(18,"app-tab",13,1)(20,"form",14)(21,"app-form-field",15)(22,"select",16)(23,"option",17),e.EFF(24,"Solid Color"),e.k0s(),e.j41(25,"option",18),e.EFF(26,"Radial Gradient"),e.k0s(),e.j41(27,"option",19),e.EFF(28,"Linear Gradient"),e.k0s(),e.j41(29,"option",20),e.EFF(30,"Transparent"),e.k0s()()(),e.DNE(31,Tc,3,5,"div",21)(32,Sc,11,14,"div",21)(33,xc,11,14,"div",21)(34,Ec,3,0,"div",21),e.k0s()()()()}2&t&&(e.R7$(7),e.Y8G("ngForOf",n.presetBackgrounds),e.R7$(10),e.Y8G("ngForOf",n.distinctBackgrounds),e.R7$(3),e.Y8G("formGroup",n.form)("ngSwitch",n.form.get("type").value),e.R7$(11),e.Y8G("ngSwitchCase","solid"),e.R7$(),e.Y8G("ngSwitchCase","radial"),e.R7$(),e.Y8G("ngSwitchCase","linear"),e.R7$(),e.Y8G("ngSwitchCase","transparent"))},dependencies:[w.Sq,w.ux,w.e1,te.T1,qs.C,Y.Q,Xi.L,Z.K,Ve,jt.j,Mt.O,Hs,c.qT,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,Ai.bk],styles:[".background[_ngcontent-%COMP%]{width:296px;min-height:280px}.background__section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.background__swatches[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:8px}.background__actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 24px}.background__actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:0}"],changeDetection:0})}jo([(0,l.l6)(j.N.getSelectedChapterBackground),Mo("design:type",_.c)],zt.prototype,"background$",void 0),jo([(0,l.l6)(j.N.getAllChaptersBackground),Mo("design:type",_.c)],zt.prototype,"allChapterBackgrounds$",void 0),jo([(0,l.l6)(j.N.getSelectedChapterIndex),Mo("design:type",_.c)],zt.prototype,"selectedChapterIndex$",void 0);var Qi=v(94909),ui=v(21604),Ws=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Js=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function wc(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",8)(1,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeOriginal))}),e.nrm(2,"app-icon",10),e.k0s(),e.j41(3,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeDesktop))}),e.nrm(4,"app-icon",11),e.k0s(),e.j41(5,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeTablet))}),e.nrm(6,"app-icon",12),e.k0s(),e.j41(7,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.setCanvasSizeClick(o.CanvasSizeMobile))}),e.nrm(8,"app-icon",13),e.k0s()()}if(2&s){const t=i.$implicit,n=e.XpG();e.R7$(),e.Y8G("buttonType",n.areDimensionsEqual(n.CanvasSizeOriginal,t)?"info":"default")("matTooltip",n.getTooltip(n.CanvasSizeOriginal)),e.R7$(2),e.Y8G("buttonType",n.areDimensionsEqual(n.CanvasSizeDesktop,t)?"info":"default")("matTooltip",n.getTooltip(n.CanvasSizeDesktop)),e.R7$(2),e.Y8G("buttonType",n.areDimensionsEqual(n.CanvasSizeTablet,t)?"info":"default")("matTooltip",n.getTooltip(n.CanvasSizeTablet)),e.R7$(2),e.Y8G("buttonType",n.areDimensionsEqual(n.CanvasSizeMobile,t)?"info":"default")("matTooltip",n.getTooltip(n.CanvasSizeMobile))}}class hi{constructor(i,t){this.store=i,this.popupRef=t,this.CanvasSizeOriginal=Be,this.CanvasSizeDesktop=q,this.CanvasSizeTablet=fe,this.CanvasSizeMobile=si,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setCanvasSizeClick(i){this.store.dispatch(new P.IW(i))}areDimensionsEqual(i,t){return i.width===t.width&&i.height===t.height}getTooltip(i){if((0,R.isEqual)(i,Be)){const t=this.store.selectSnapshot(S.S.getEnginePosition),{viewportWidth:n,viewportHeight:o}=t;return ge("Maximize",n,o)}{const{label:t,width:n,height:o}=i;return ge(t,n,o)}}initForm(){const i=this.store.selectSnapshot(S.S.getEnginePosition),t=this.store.selectSnapshot(g.getCanvasSize),{width:n,height:o}=this.areDimensionsEqual(t,Be)?{width:i.viewportWidth,height:i.viewportHeight}:t;this.form=new c.gE({width:new c.MJ(n,[c.k0.required,c.k0.min(_e.gG.width),c.k0.max(_e.ie.width)]),height:new c.MJ(o,[c.k0.required,c.k0.min(_e.gG.height),c.k0.max(_e.ie.height)])})}initFormListeners(){this.form.valueChanges.pipe((0,Qi.E)(this.canvasSize$),(0,K.B)(100),(0,I.p)(()=>this.form.valid),(0,y.Q)(this.ngUnsubscribe)).subscribe(([i])=>{const{width:t,height:n}=i;this.store.dispatch(new P.IW(new xe("Custom",t,n)))}),this.canvasSize$.pipe((0,Qi.E)(this.enginePosition$),(0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const{width:n,height:o}=i,{viewportWidth:a,viewportHeight:r}=t;"Custom"!=i.label&&(this.areDimensionsEqual(i,Be)?this.form.setValue({width:a,height:r},{emitEvent:!1}):this.form.setValue({width:n,height:o},{emitEvent:!1}))})}static#e=this.\u0275fac=function(t){return new(t||hi)(e.rXU(l.il),e.rXU(Qs.W))};static#t=this.\u0275cmp=e.VBU({type:hi,selectors:[["app-dimensions-dialog"]],standalone:!0,features:[e.aNF],decls:13,vars:4,consts:[["role","dialog","aria-modal","true","aria-label","Dimensions Dialog","cdkDrag","","cdkDragRootElement",".cdk-overlay-pane",1,"dimensions-dialog","theme-light"],["class","dimensions-dialog__sizes",4,"ngIf"],[1,"!my-3"],[1,"dimensions-dialog__form",3,"formGroup"],[1,"dimensions-dialog__field"],[1,"dimensions-dialog__field-label"],["type","number","formControlName","width",1,"input"],["type","number","formControlName","height",1,"input"],[1,"dimensions-dialog__sizes"],["app-button","","buttonTheme","light","buttonSize","sm","buttonShape","square",3,"click","buttonType","matTooltip"],["icon","maximize"],["icon","desktop"],["icon","tablet-alt"],["icon","mobile-alt"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,wc,9,8,"div",1),e.nI1(2,"async"),e.nrm(3,"mat-divider",2),e.j41(4,"form",3)(5,"label",4)(6,"span",5),e.EFF(7,"Width"),e.k0s(),e.nrm(8,"input",6),e.k0s(),e.j41(9,"label",4)(10,"span",5),e.EFF(11,"Height"),e.k0s(),e.nrm(12,"input",7),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngIf",e.bMT(2,2,n.canvasSize$)),e.R7$(3),e.Y8G("formGroup",n.form))},dependencies:[w.MD,w.bT,w.Jj,Vt.G,te.T1,Ce.oV,Je.q,te.ad,ui.G,Y.Q,X.R,c.X1,c.qT,c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,Yi.D],styles:[".dimensions-dialog[_ngcontent-%COMP%]{position:relative;width:200px;overflow:hidden}.dimensions-dialog__sizes[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:2px}.dimensions-dialog__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.dimensions-dialog__field[_ngcontent-%COMP%]{display:flex;align-items:center}.dimensions-dialog__field-label[_ngcontent-%COMP%]{color:#61779e;font-size:.625rem;line-height:.75rem;text-transform:uppercase;width:80px}"],changeDetection:0})}Ws([(0,l.l6)(S.S.getEnginePosition),Js("design:type",_.c)],hi.prototype,"enginePosition$",void 0),Ws([(0,l.l6)(g.getCanvasSize),Js("design:type",_.c)],hi.prototype,"canvasSize$",void 0);var Fc=v(5025),Rc=v(98020),Pc=v(20342),Io=v(1308),jc=v(46799),Zs=v(20339),ea=v(94604),Mc=v(84426),Ic=v(97307),Nc=v(51002),fi=v(79805);class Bc{constructor(){this.firstTime=0,this.lastTime=1}}var ct=v(515),Dc=v(40621),No=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Bo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Gc=["scrubber"],$c=s=>({"mr-4":s});function Oc(s,i){1&s&&e.nrm(0,"app-button-icon",7)}function Ac(s,i){1&s&&e.nrm(0,"app-button-icon",8)}function Uc(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",4),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handlePlayClick())}),e.DNE(1,Oc,1,0,"app-button-icon",5),e.nI1(2,"async"),e.DNE(3,Ac,1,0,"app-button-icon",6),e.nI1(4,"async"),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("buttonTheme",t.theme)("ngClass",e.eq3(8,$c,t.showScrubber)),e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,4,t.animationPlaying$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,6,t.animationPlaying$))}}function Vc(s,i){if(1&s){const t=e.RV6();e.j41(0,"input",9,0),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.percent,o)||(a.percent=o),e.Njj(o)}),e.bIt("mousedown",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleInputMouseDown())})("mouseup",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleInputMouseUp())}),e.k0s()}if(2&s){const t=e.XpG();e.R50("ngModel",t.percent)}}class Xt{get percent(){return this._percent}set percent(i){this._percent=i,this.animationService.isPlaying()||this.scrubPercent(this.percent)}constructor(i,t,n,o){this.changeDetection=i,this.animationService=t,this.store=n,this.engineService=o,this.theme="dark",this.showPlay=!0,this.showScrubber=!0,this.playing=!1,this.wasPlaying=!1,this.ngUnsubscribe=new f.B,this._percent=0,this.scrub$=new $i.t(0),this.interactive=!1,this.timeline=new Bc}ngOnInit(){this.bindApplicationEvents()}ngOnDestroy(){this.changeDetection.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.unsubscribe()}bindApplicationEvents(){this.chapterReadyState$.pipe((0,I.p)(i=>!!i.animation),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.initScrubber()}),this.engineService.getEvent(ct.X.TimelinePlaying).pipe((0,In.Z)(50),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>this.tick(i.time)),this.engineService.getEvent(ct.X.TimelineScrubbed).pipe((0,In.Z)(50),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.scrubber.nativeElement.value=this.getPercent(i.time)}),this.engineService.getEvent(ct.X.TimelineTimeFrameUpdated).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.timeline=this.animationService.getChapterTimeFrame(),this.percent=this.getPercent(this.animationService.getTime()),this.changeDetection.markForCheck()}),this.animationPlaying$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>this.playing=i)}handleInputMouseDown(){this.wasPlaying=this.playing,this.store.dispatch(new ie.dE(!1))}handleInputMouseUp(){this.store.dispatch(new ie.dE(this.wasPlaying))}handlePlayClick(){this.play()}play(){const i=!this.store.selectSnapshot(S.S.getAnimationPlaying);this.store.dispatch(new ie.dE(i))}initScrubber(){this.timeline=this.animationService.getChapterTimeFrame(),this.percent=0,this.changeDetection.markForCheck()}tick(i){this.percent=this.getPercent(i),this.changeDetection.markForCheck()}getPercent(i){const{lastTime:t}=this.timeline;return 0===t?0:i/t*100}scrubPercent(i){this.animationService.scrub(i/100*this.timeline.lastTime)}static#e=this.\u0275fac=function(t){return new(t||Xt)(e.rXU(e.gRc),e.rXU(Rt.O),e.rXU(l.il),e.rXU(fi.y))};static#t=this.\u0275cmp=e.VBU({type:Xt,selectors:[["app-engine-scrubber"]],viewQuery:function(t,n){if(1&t&&e.GBs(Gc,5),2&t){let o;e.mGM(o=e.lsd())&&(n.scrubber=o.first)}},inputs:{theme:"theme",showPlay:"showPlay",showScrubber:"showScrubber"},decls:3,vars:2,consts:[["scrubber",""],[1,"engine-scrubber"],["app-button","","buttonSize","sm","class","engine-scrubber__play",3,"buttonTheme","ngClass","click",4,"ngIf"],["class","engine-scrubber__input","type","range","style","width: 100%","min","0","max","100",3,"ngModel","ngModelChange","mousedown","mouseup",4,"ngIf"],["app-button","","buttonSize","sm",1,"engine-scrubber__play",3,"click","buttonTheme","ngClass"],["label","Play","iconPlacement","left","icon","play",4,"ngIf"],["label","Pause","iconPlacement","left","icon","pause",4,"ngIf"],["label","Play","iconPlacement","left","icon","play"],["label","Pause","iconPlacement","left","icon","pause"],["type","range","min","0","max","100",1,"engine-scrubber__input",2,"width","100%",3,"ngModelChange","mousedown","mouseup","ngModel"]],template:function(t,n){1&t&&(e.j41(0,"div",1),e.DNE(1,Uc,5,10,"button",2)(2,Vc,2,1,"input",3),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",n.showPlay),e.R7$(),e.Y8G("ngIf",n.showScrubber))},dependencies:[w.YU,w.bT,c.me,c.MR,c.BC,c.vS,Y.Q,Dc.T,w.Jj],styles:["[_nghost-%COMP%]{display:block;width:100%}.engine-scrubber[_ngcontent-%COMP%]{justify-content:center;align-items:center;display:flex;position:relative;width:100%;-webkit-user-select:none;user-select:none}.engine-scrubber__input[_ngcontent-%COMP%]{width:100%}.engine-scrubber__play[_ngcontent-%COMP%]{width:80px}"],changeDetection:0})}No([(0,l.l6)(j.N.getSelectedChapterId),Bo("design:type",_.c)],Xt.prototype,"selectedChapterId$",void 0),No([(0,l.l6)(j.N.getSelectedChapterReadyState),Bo("design:type",_.c)],Xt.prototype,"chapterReadyState$",void 0),No([(0,l.l6)(S.S.getAnimationPlaying),Bo("design:type",_.c)],Xt.prototype,"animationPlaying$",void 0);var zn=v(78109),Lc=v(44867);function Xc(s,i){if(1&s&&(e.j41(0,"div",1)(1,"div",2),e.EFF(2),e.k0s(),e.j41(3,"div",3),e.EFF(4),e.k0s()()),2&s){const t=i.ngIf,n=e.XpG();e.R7$(2),e.JRh(t.label),e.R7$(2),e.SpI(" ",n.nodeAncestors," ")}}class qi{constructor(i,t,n){this.graphService=i,this.store=t,this.changeDetection=n,this.ngUnsubscribe=new f.B}ngOnInit(){this.hoveredNode$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.nodeAncestors=this.getNodeAncestors(i).map(t=>t.label).slice(0,-1).join(" > "),this.nodeAncestors.length>160&&(this.nodeAncestors=`...${this.nodeAncestors.slice(-160)}`),this.changeDetection.markForCheck()})}ngOnDestroy(){this.changeDetection.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}getNodeAncestors(i){const t=this.store.selectSnapshot(S.S.getViewGraph);return(0,Lc.DS)(t,i.id,!0).map(n=>t.nodes[n]).reverse()}static#e=this.\u0275fac=function(t){return new(t||qi)(e.rXU(zn.w),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:qi,selectors:[["app-engine-breadcrumb"]],decls:2,vars:3,consts:[["class","breadcrumb",4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb__node"],[1,"breadcrumb__ancestors"]],template:function(t,n){1&t&&(e.DNE(0,Xc,5,2,"div",0),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,n.hoveredNode$))},dependencies:[w.bT,w.Jj],styles:[".breadcrumb[_ngcontent-%COMP%]{animation:fadeIn .25s ease forwards;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.breadcrumb__node[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;color:#fff;font-weight:700}.theme-light[_nghost-%COMP%]   .breadcrumb__node[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .breadcrumb__node[_ngcontent-%COMP%]{color:#101823}.breadcrumb__ancestors[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem;text-transform:uppercase;color:#96a8c0}.theme-light[_nghost-%COMP%]   .breadcrumb__ancestors[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .breadcrumb__ancestors[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(S.S.getHoveredNode),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],qi.prototype,"hoveredNode$",void 0);var D=v(59115);const Qc=["*"];var ta=function(s){return s.Inline="inline",s.Block="block",s}(ta||{});let gi=(()=>{class s{constructor(){this.render=ta.Inline}ngOnInit(){}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-button-group"]],inputs:{render:"render"},ngContentSelectors:Qc,decls:2,vars:0,consts:[[1,"app-button-group"]],template:function(n,o){1&n&&(e.NAR(),e.j41(0,"div",0),e.SdG(1),e.k0s())},styles:["app-button-group{display:flex}.app-button-group{display:inline-flex;position:relative;width:100%}.app-button-group button[app-button]:first-child span{border-top-right-radius:0!important;border-bottom-right-radius:0!important}.app-button-group button[app-button]:last-child span{border-top-left-radius:0!important;border-bottom-left-radius:0!important}.app-button-group button[app-button]:last-child:not([data-button-type=outline]){transform:translate(1px)!important}.app-button-group button[app-button]:last-child[data-button-type=outline]{transform:translate(-1px)!important}.app-button-group button[app-button]:not(:first-child):not(:last-child){transform:translate(1px)!important;border-radius:0!important}.app-button-group button[app-button]:not(:first-child):not(:last-child) span{border-radius:0!important}.app-button-group button[app-button]:not(:first-child):not(:last-child)[data-button-type=outline]{transform:translate(-1px)!important}\n"],encapsulation:2,changeDetection:0})}return s})();var qc=v(78183),Do=function(s){return s.Green="green",s.Yellow="yellow",s.Red="red",s}(Do||{});let ia=(()=>{class s{constructor(){this.color=Do.Green}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-status"]],inputs:{color:"color"},decls:1,vars:1,consts:[["data-test","status",1,"status",3,"ngClass"]],template:function(n,o){1&n&&e.nrm(0,"div",0),2&n&&e.Y8G("ngClass","status--"+o.color)},dependencies:[w.YU],styles:[".status[_ngcontent-%COMP%]{--dot-color: #33cd54;height:8px;width:8px;border-radius:50%;background-color:var(--dot-color)}.status--green[_ngcontent-%COMP%]{--dot-color: #33cd54}.status--yellow[_ngcontent-%COMP%]{--dot-color: #ffb92e}.status--red[_ngcontent-%COMP%]{--dot-color: #f44336}"],changeDetection:0})}return s})();var Xn=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Qn=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Hc(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",1)(1,"button",2),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handlePreviousClick())}),e.nrm(2,"app-icon",3),e.k0s(),e.j41(3,"span",4),e.EFF(4),e.nI1(5,"async"),e.k0s(),e.j41(6,"button",5),e.nI1(7,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleNextClick())}),e.nrm(8,"app-icon",6),e.k0s()()}if(2&s){let t,n;const o=e.XpG();e.R7$(),e.Y8G("disabled",0===o.chapterIndex),e.R7$(3),e.Lme(" ",o.chapterIndex+1," / ",null==(t=e.bMT(5,4,o.chapters$))?null:t.length," "),e.R7$(2),e.Y8G("disabled",o.chapterIndex===(null==(n=e.bMT(7,6,o.chapters$))?null:n.length)-1)}}class Nt{constructor(i,t){this.store=i,this.changeDetectorRef=t,this.ngUnsubscribe=new f.B}ngOnInit(){this.selectedChapterIndex$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.chapterIndex=i,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handlePreviousClick(){this.store.dispatch(new U.F0)}handleNextClick(){this.store.dispatch(new U.tg)}static#e=this.\u0275fac=function(t){return new(t||Nt)(e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Nt,selectors:[["app-edit-chapter-pagination"]],decls:2,vars:3,consts:[["class","chapter-pagination","appEventFence","",4,"ngIf"],["appEventFence","",1,"chapter-pagination"],["type","button",1,"chapter-pagination__button","chapter-pagination__button--back",3,"click","disabled"],["size","lg","icon","angle-left"],[1,"chapter-pagination__count"],["type","button",1,"chapter-pagination__button","chapter-pagination__button--next",3,"click","disabled"],["size","lg","icon","angle-right"]],template:function(t,n){if(1&t&&(e.DNE(0,Hc,9,8,"div",0),e.nI1(1,"async")),2&t){let o;e.Y8G("ngIf",(null==(o=e.bMT(1,1,n.chapters$))?null:o.length)>1)}},dependencies:[w.bT,Xi.L,X.R,w.Jj],styles:[".chapter-pagination{display:flex;height:56px;align-items:center;-webkit-user-select:none;user-select:none;position:relative}.chapter-pagination__button{background:transparent;border:none;color:#d7e0ea;padding:0 20px;flex:1 1 50%;height:100%;outline:none}.chapter-pagination__button:disabled{color:#61779e}.chapter-pagination__button:not(:disabled):hover{color:#fff;cursor:pointer}.chapter-pagination__button .app-button{height:100%}.chapter-pagination__button--back{text-align:left}.chapter-pagination__button--next{text-align:right}.chapter-pagination__count{font-size:.75rem;line-height:1rem;display:flex;align-items:center;white-space:nowrap;width:100%;height:100%;left:0;top:0;justify-content:center;position:absolute;pointer-events:none;z-index:10}\n"],encapsulation:2,changeDetection:0})}Xn([(0,l.l6)(E.t.getStory),Qn("design:type",_.c)],Nt.prototype,"story$",void 0),Xn([(0,l.l6)(j.N.getSelectedChapter),Qn("design:type",_.c)],Nt.prototype,"selectedChapter$",void 0),Xn([(0,l.l6)(j.N.getSelectedChapterIndex),Qn("design:type",_.c)],Nt.prototype,"selectedChapterIndex$",void 0),Xn([(0,l.l6)(j.N.getStoryChapters),Qn("design:type",_.c)],Nt.prototype,"chapters$",void 0);var G=v(12921),Go=v(76939);const Wc=["*"];function Jc(s,i){1&s&&e.SdG(0,0,["*ngIf","!currentPortal"])}function Kc(s,i){}function Zc(s,i){if(1&s&&e.DNE(0,Kc,0,0,"ng-template",1),2&s){const t=e.XpG();e.Y8G("cdkPortalOutlet",t.currentPortal)}}let nt=(()=>{class s{get currentPortal(){return this.portals[this.portals.length-1]}constructor(t,n){this.changeRef=t,this._viewContainerRef=n,this.portals=[],this.ngUnsubscribe=new f.B,this.portalSubscription=new f.B}ngOnInit(){this.initListeners()}ngOnDestroy(){this.currentPortal&&this.currentPortal.isAttached&&this.currentPortal.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.portalSubscription.asObservable().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.portals.push(t),this.changeRef.markForCheck()})}loadComponent(t){this.loadPortal(new Go.A8(t))}loadTemplate(t){this.loadPortal(new Go.VA(t,this._viewContainerRef))}loadPortal(t){this.portalSubscription.next(t)}back(){this.portals.pop(),this.changeRef.markForCheck()}exit(){this.portals.length=0,this.changeRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.gRc),e.rXU(e.c1b))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-portal"]],ngContentSelectors:Wc,decls:2,vars:2,consts:[[4,"ngIf"],[3,"cdkPortalOutlet"]],template:function(n,o){1&n&&(e.NAR(),e.DNE(0,Jc,1,0,"ng-content",0)(1,Zc,1,1,null,0)),2&n&&(e.Y8G("ngIf",!o.currentPortal),e.R7$(),e.Y8G("ngIf",o.currentPortal))},dependencies:[w.bT,Go.I3],changeDetection:0})}return s})();var le=v(35939),we=v(38970),pe=v(57535);const ep=[[["","column-group-header",""]],[["","column-group-body",""]]],tp=["[column-group-header]","[column-group-body]"];let at=(()=>{class s{get isActive(){return this._isActive}set isActive(t){this._isActive=t,this.show(this.isActive)}constructor(t,n){this.renderer=t,this.element=n,this._isActive=!1,this.compact=!0}ngOnInit(){}show(t){this.renderer.setStyle(this.element.nativeElement,"display",this.isActive?"flex":"none")}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(e.sFG),e.rXU(e.aKT))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-column-group"]],inputs:{label:"label",isActive:"isActive",compact:"compact"},ngContentSelectors:tp,decls:5,vars:2,consts:[[1,"column-group"],[1,"column-group__header"],[1,"column-group__body"]],template:function(n,o){1&n&&(e.NAR(ep),e.j41(0,"div",0)(1,"div",1),e.SdG(2),e.k0s(),e.j41(3,"div",2),e.SdG(4,1),e.k0s()()),2&n&&e.AVh("column-group--compact",o.compact)},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden}.column-group[_ngcontent-%COMP%]{height:100%;display:flex;flex:1 1 auto;flex-direction:column;overflow:hidden}.theme-light[_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%]{border-color:transparent}.theme-dark[_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%], .theme-dark   [_nghost-%COMP%]   .column-group__body[_ngcontent-%COMP%]{scrollbar-color:#96a8c0 #1c2a3f}.column-group__header[_ngcontent-%COMP%]{flex:0 1 auto;padding:8px 8px 12px}.column-group__header[_ngcontent-%COMP%]:empty{display:none}.column-group__body[_ngcontent-%COMP%]{border-top:1px solid #283853;display:flex;flex-direction:column;flex:1 1 100%;overflow-y:scroll;padding:0}.column-group--compact[_ngcontent-%COMP%]   .column-group__body[_ngcontent-%COMP%]{padding:0 12px 0 0}"],changeDetection:0})}return s})();const ip=[[["","column-nav",""]],[["","column-label",""]],[["","column-actions",""]],[["","column-header",""]],[["app-column-group"]],[["","column-group-actions",""]],[["","column-footer",""]]],np=["[column-nav]","[column-label]","[column-actions]","[column-header]","app-column-group","[column-group-actions]","[column-footer]"],op=s=>({"column__tab--selected":s});function sp(s,i){if(1&s&&(e.j41(0,"div",4),e.nrm(1,"app-spinner",5),e.j41(2,"div",6),e.EFF(3),e.k0s()()),2&s){const t=e.XpG();e.R7$(3),e.JRh(t.loadingLabel)}}function ap(s,i){1&s&&(e.j41(0,"div",7)(1,"div",8)(2,"div",9),e.SdG(3),e.k0s(),e.j41(4,"div",10),e.SdG(5,1),e.k0s(),e.j41(6,"div",11),e.SdG(7,2),e.k0s()(),e.SdG(8,3),e.k0s())}function rp(s,i){if(1&s){const t=e.RV6();e.j41(0,"span",18),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.handleColumnGroupSelect(o))}),e.j41(1,"div",19),e.EFF(2),e.k0s()()}if(2&s){const t=i.$implicit,n=e.XpG(3);e.Y8G("ngClass",e.eq3(3,op,n.isColumnGroupSelected(t))),e.R7$(),e.BMQ("data-test","column"+t.label),e.R7$(),e.SpI(" ",t.label," ")}}function lp(s,i){if(1&s&&(e.j41(0,"div",15),e.DNE(1,rp,3,5,"span",16),e.j41(2,"div",17),e.SdG(3,5),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.columnGroups)}}function cp(s,i){1&s&&(e.j41(0,"div",20),e.SdG(1,6),e.k0s())}function pp(s,i){if(1&s&&(e.qex(0),e.DNE(1,lp,4,1,"div",12),e.j41(2,"div",13),e.SdG(3,4),e.k0s(),e.DNE(4,cp,2,0,"div",14),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.columnGroups.length>1),e.R7$(3),e.Y8G("ngIf",!t.loading)}}class dp{constructor(i,t,n){this.index=i,this.label=t,this.component=n}}let pt=(()=>{class s{constructor(){this.showHeader=!0,this.loading=!1,this.loadingLabel="",this._selectedColumnGroup=new $i.t(0),this.selectedColumnGroupChange=new e.bkB,this.next=new e.bkB,this.previous=new e.bkB,this.ngUnsubscribe=new f.B}get selectedColumnGroup(){return this._selectedColumnGroup.value}set selectedColumnGroup(t){null!=t&&t!==this.selectedColumnGroup&&("string"==typeof t&&(t=t.toUpperCase()),this._selectedColumnGroup.next(t),this.selectedColumnGroupChange.emit(t))}ngAfterContentInit(){this.mapContentGroups(),this._selectedColumnGroup.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.showColumnGroup(t)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleColumnGroupSelect(t){this.selectedColumnGroup=t.label}mapContentGroups(){this.columnGroups=this.columnGroupsQuery.map((t,n)=>new dp(n,t.label,t))}showColumnGroup(t){this.columnGroups.forEach((n,o)=>{switch(typeof t){case"number":n.component.isActive=t===o;break;case"string":n.component.isActive=t.toString().toUpperCase()===n.label.toUpperCase()}})}isColumnGroupSelected(t){return("string"==typeof this._selectedColumnGroup.value?t.label.toUpperCase():t.index)===this._selectedColumnGroup.value}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-column"]],contentQueries:function(n,o,a){if(1&n&&e.wni(a,at,4),2&n){let r;e.mGM(r=e.lsd())&&(o.columnGroupsQuery=r)}},inputs:{label:"label",showHeader:"showHeader",loading:"loading",loadingLabel:"loadingLabel",selectedColumnGroup:"selectedColumnGroup"},outputs:{selectedColumnGroupChange:"selectedColumnGroupChange",next:"next",previous:"previous"},ngContentSelectors:np,decls:4,vars:3,consts:[[1,"column"],["class","column__loading",4,"ngIf"],["class","column__header",4,"ngIf"],[4,"ngIf"],[1,"column__loading"],["size","large"],[1,"column__loading-label"],[1,"column__header"],[1,"column__title"],[1,"column__nav"],[1,"column__label"],[1,"column__actions"],["class","column__tabs",4,"ngIf"],[1,"column__group"],["class","column__footer",4,"ngIf"],[1,"column__tabs"],["class","column__tab",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"column__tabs-actions","flex-auto","flex","flex-row","items-center","justify-end"],[1,"column__tab",3,"click","ngClass"],[1,"column__tab-label"],[1,"column__footer"]],template:function(n,o){1&n&&(e.NAR(ip),e.j41(0,"div",0),e.DNE(1,sp,4,1,"div",1)(2,ap,9,0,"div",2)(3,pp,5,2,"ng-container",3),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",o.showHeader&&!o.loading),e.R7$(),e.Y8G("ngIf",!o.loading))},dependencies:[w.YU,w.Sq,w.bT,ci.tI],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden;flex:1 1 auto}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;height:100%;overflow-y:hidden}.theme-light[_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]{color:#61779e}.theme-light[_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]:hover, .theme-light   [_nghost-%COMP%]   .column__tab[_ngcontent-%COMP%]:hover{color:#131c2a}.theme-light[_nghost-%COMP%]   .column__tab--selected[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__tab--selected[_ngcontent-%COMP%]{color:#131c2a}.theme-light[_nghost-%COMP%]   .column__footer[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .column__footer[_ngcontent-%COMP%]{border-color:#f9fafd}.column__loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex:1 1 100%;flex-direction:column}.column__loading-label[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;padding-top:8px;color:#ffffff80}.column__header[_ngcontent-%COMP%]{flex:0 0 auto}.column__tabs[_ngcontent-%COMP%]{display:flex;align-items:baseline;flex:0 0 auto;padding:8px 12px 0}.column__tabs-action[_ngcontent-%COMP%]{color:#fff}.column__tab[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;text-transform:uppercase;color:#96a8c0;padding:8px;-webkit-user-select:none;user-select:none}.column__tab[_ngcontent-%COMP%]:first-child{padding-left:0}.column__tab[_ngcontent-%COMP%]:after{content:"";display:block;border-bottom:3px solid #2d72dc;margin-top:4px;width:0;transition:.25s ease}.column__tab[_ngcontent-%COMP%]:hover{color:#fff;cursor:pointer}.column__tab--selected[_ngcontent-%COMP%]{color:#fff}.column__tab--selected[_ngcontent-%COMP%]:after{width:100%}.column__tab-label[_ngcontent-%COMP%]{padding:0 4px}.column__title[_ngcontent-%COMP%]{align-items:center;flex:1 1 100%;display:flex;min-height:48px;padding:0 8px}.column__arrow[_ngcontent-%COMP%]{flex:0 0 32px;display:flex}.column__nav[_ngcontent-%COMP%]{display:flex}.column__label[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;min-height:28px;align-items:center;padding:0 8px}.column__actions[_ngcontent-%COMP%]{flex:0 1 auto}.column__search[_ngcontent-%COMP%]{padding:0 12px 8px}.column__body[_ngcontent-%COMP%]{height:100%;overflow-y:scroll}.column__footer[_ngcontent-%COMP%]{border-top:1px solid #283853;flex:0 0 auto}.column__group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 100%;height:100%;overflow:hidden}.column__group-header[_ngcontent-%COMP%]{flex:0 1 auto}'],changeDetection:0})}return s})();const mp=[[["","list-actions",""]],"*"],up=["[list-actions]","*"];let Ne=(()=>{class s{constructor(t){this.portalComponent=t,this.navigate=new e.bkB}ngOnInit(){}handleNavigateClick(){this.navigate.emit(),this.portalComponent.back()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-portal-column"]],inputs:{label:"label"},outputs:{navigate:"navigate"},ngContentSelectors:up,decls:11,vars:1,consts:[["column-label",""],["column-nav",""],["app-button","",3,"click"],["icon","arrow-left","size","lg"],["column-actions",""],["column-group-body",""]],template:function(n,o){1&n&&(e.NAR(mp),e.j41(0,"app-column")(1,"div",0),e.EFF(2),e.k0s(),e.j41(3,"div",1)(4,"button",2),e.bIt("click",function(){return o.handleNavigateClick()}),e.nrm(5,"app-icon",3),e.k0s()(),e.j41(6,"div",4),e.SdG(7),e.k0s(),e.j41(8,"app-column-group"),e.qex(9,5),e.SdG(10,1),e.bVm(),e.k0s()()),2&n&&(e.R7$(2),e.SpI(" ",o.label," "))},dependencies:[pt,at,X.R,Y.Q],changeDetection:0})}return s})();class Hi{constructor(i,t){this.store=i,this.formBuilder=t,this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({colorEnabled:[!1],color:[""],alphaEnabled:[!1],alpha:[""],spritesEnabled:[!1],spriteRows:[0],spriteCols:[0],spriteStartFrame:[0],spriteEndFrame:[0]}),this.setValues(pe.yB)}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((i,t)=>{const n=this.createParticleSystem(i),o=this.createParticleSystem(t);return(0,R.isEqual)(n,o)}),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setParticleSystem(i)})}initParticleSystemListeners(){this.particleSystem$.pipe((0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)})}handleResetClick(){this.resetFormValues()}setParticleSystem(i){const t=this.createParticleSystem(i);this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}setValues(i){(0,we.bF)(i)&&this.setTextureValues(i.textures??[]),this.setSpriteValues(i)}setTextureValues(i){i.forEach(t=>{const{src:n,applyTo:o}=t,a=this.formGroup.get(o),r=this.formGroup.get(`${o}Enabled`);if(a){const p=!!n;a.setValue(n,{emitEvent:!1}),r.setValue(p,{emitEvent:!1})}})}resetFormValues(){this.formGroup.patchValue({colorEnabled:!1,color:"",alphaEnabled:!1,alpha:"",spritesEnabled:!1,...pe.yB})}createParticleSystem(i){const{spritesEnabled:t,spriteRows:n,spriteCols:o,spriteStartFrame:a,spriteEndFrame:r}=i,p=this.store.selectSnapshot(G.B.getSelectedParticleSystem),x=this.getTextures(i);return(0,pe.Ir)({...p,textures:x,spriteRows:t?n:void 0,spriteCols:t?o:void 0,spriteStartFrame:t?a:void 0,spriteEndFrame:t?r:void 0})}setSpriteValues(i){const{spriteRows:t,spriteCols:n,spriteStartFrame:o,spriteEndFrame:a}=i,p={spritesEnabled:[t,n,o,a].some(x=>!(0,R.isNil)(x)),...(0,pe.Ir)({spriteRows:t,spriteCols:n,spriteStartFrame:o,spriteEndFrame:a})};this.formGroup.patchValue(p,{emitEvent:!1})}getTextures(i){const{colorEnabled:t,color:n,alphaEnabled:o,alpha:a}=i,r=[];return t&&n&&r.push({src:n,applyTo:"color"}),o&&a&&r.push({src:a,applyTo:"alpha"}),r}static#e=this.\u0275fac=function(t){return new(t||Hi)(e.rXU(l.il),e.rXU(c.ze))};static#t=this.\u0275cmp=e.VBU({type:Hi,selectors:[["app-edit-particle-sprites"]],decls:22,vars:11,consts:[["systemActions","matMenu"],["label","Sprites"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[3,"overlapTrigger"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Color","toggleType","checkbox","formControlName","colorEnabled"],["type","text","formControlName","color","placeholder","path/of/texture",1,"input"],["label","Alpha","toggleType","checkbox","formControlName","alphaEnabled"],["type","text","formControlName","alpha","placeholder","path/of/texture",1,"input"],["label","Sprite Sheet","toggleType","checkbox","formControlName","spritesEnabled"],["label","Rows"],["formControlName","spriteRows",3,"min","max"],["label","Columns"],["formControlName","spriteCols",3,"min","max"],["label","Start Frame"],["formControlName","spriteStartFrame",3,"min","max"],["label","End Frame"],["formControlName","spriteEndFrame",3,"min","max"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",5,0)(6,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"div",7)(9,"app-panel",8),e.nrm(10,"input",9),e.k0s(),e.j41(11,"app-panel",10),e.nrm(12,"input",11),e.k0s(),e.j41(13,"app-panel",12)(14,"app-form-field",13),e.nrm(15,"app-slider",14),e.k0s(),e.j41(16,"app-form-field",15),e.nrm(17,"app-slider",16),e.k0s(),e.j41(18,"app-form-field",17),e.nrm(19,"app-slider",18),e.k0s(),e.j41(20,"app-form-field",19),e.nrm(21,"app-slider",20),e.k0s()()()()}if(2&t){const o=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(2),e.Y8G("overlapTrigger",!0),e.R7$(4),e.Y8G("formGroup",n.formGroup),e.R7$(7),e.Y8G("min",1)("max",16),e.R7$(2),e.Y8G("min",0)("max",16),e.R7$(2),e.Y8G("min",0)("max",255),e.R7$(2),e.Y8G("min",0)("max",255)}},dependencies:[c.me,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ne],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleSystem),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Hi.prototype,"particleSystem$",void 0);var na=v(1670),Ct=v(93815);let qn=(()=>{class s extends Ke.n{constructor(t,n){super(),this.formBuilder=t,this.changeRef=n,this.xmin=0,this.xmax=100,this.ymin=0,this.ymax=100,this.zmin=0,this.zmax=100,this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({vec:this.formBuilder.array([0,0,0])})}ngOnInit(){this.formGroup.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.value=t.vec})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){this.formGroup.patchValue({vec:t}),this.changeRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-vector"]],inputs:{xmin:"xmin",xmax:"xmax",ymin:"ymin",ymax:"ymax",zmin:"zmin",zmax:"zmax"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:8,vars:13,consts:[[3,"formGroup"],["formArrayName","vec"],["label","X","display","inline"],[3,"min","max","step","formControlName"],["label","Y","display","inline"],["label","Z","display","inline"]],template:function(n,o){1&n&&(e.qex(0,0)(1,1),e.j41(2,"app-form-field",2),e.nrm(3,"app-slider",3),e.k0s(),e.j41(4,"app-form-field",4),e.nrm(5,"app-slider",3),e.k0s(),e.j41(6,"app-form-field",5),e.nrm(7,"app-slider",3),e.k0s(),e.bVm()()),2&n&&(e.Y8G("formGroup",o.formGroup),e.R7$(3),e.Y8G("min",o.xmin)("max",o.xmax)("step",.1)("formControlName",0),e.R7$(2),e.Y8G("min",o.ymin)("max",o.ymax)("step",.1)("formControlName",1),e.R7$(2),e.Y8G("min",o.zmin)("max",o.zmax)("step",.1)("formControlName",2))},dependencies:[c.BC,c.cb,c.j4,c.JD,c.v8,Z.K,Ve],changeDetection:0})}return s})(),yt=(()=>{class s{transform(t,n){return Dn.l.prettyPrint(t)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275pipe=e.EJ8({name:"prettyPrint",type:s,pure:!0})}return s})();function _p(s,i){if(1&s&&(e.j41(0,"option",17),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,t)," ")}}function vp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-edit-particle-vector",19),e.k0s(),e.j41(3,"app-form-field",20),e.nrm(4,"app-slider",21),e.k0s(),e.j41(5,"app-form-field",22),e.nrm(6,"app-slider",23),e.k0s(),e.j41(7,"app-form-field",24),e.nrm(8,"app-slider",25),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",10)("step",.1),e.R7$(2),e.Y8G("min",0)("max",25),e.R7$(2),e.Y8G("min",0)("max",25))}function Cp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function yp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",-180)("max",180),e.R7$(2),e.Y8G("min",-180)("max",180))}function kp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",-720)("max",720),e.R7$(2),e.Y8G("min",0)("max",720))}function Tp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function Sp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",26),e.nrm(2,"app-slider",27),e.k0s(),e.j41(3,"app-form-field",28),e.nrm(4,"app-slider",29),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",10),e.R7$(2),e.Y8G("min",0)("max",10))}function xp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",30),e.nrm(2,"app-edit-particle-vector",31),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10))}function Ep(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",22),e.nrm(2,"app-slider",23),e.k0s(),e.j41(3,"app-form-field",24),e.nrm(4,"app-slider",25),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("min",0)("max",25),e.R7$(2),e.Y8G("min",0)("max",25))}function wp(s,i){1&s&&e.eu8(0)}function Fp(s,i){if(1&s&&(e.qex(0),e.DNE(1,wp,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const t=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",t)}}function Rp(s,i){1&s&&e.eu8(0)}function Pp(s,i){if(1&s&&(e.qex(0),e.DNE(1,Rp,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const t=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",t)}}function jp(s,i){1&s&&e.eu8(0)}function Mp(s,i){if(1&s&&(e.qex(0),e.DNE(1,jp,1,0,"ng-container",32),e.bVm()),2&s){e.XpG();const t=e.sdS(35);e.R7$(),e.Y8G("ngTemplateOutlet",t)}}function Ip(s,i){1&s&&(e.j41(0,"app-form-field",33),e.nrm(1,"app-edit-particle-vector",34),e.k0s(),e.j41(2,"app-form-field",35),e.nrm(3,"app-edit-particle-vector",36),e.k0s(),e.j41(4,"app-form-field",37),e.nrm(5,"app-edit-particle-vector",38),e.k0s()),2&s&&(e.R7$(),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-180)("xmax",180)("ymin",-180)("ymax",180)("zmin",-180)("zmax",180),e.R7$(2),e.Y8G("xmin",0)("xmax",20)("ymin",0)("ymax",20)("zmin",0)("zmax",20))}class Wi{constructor(i,t,n,o){this.store=i,this.formBuilder=t,this.portalComponent=n,this.particleSystemsService=o,this.creatorsEnum=we.Uy,this.creators=Object.values(we.Uy),this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({id:[""],name:[""],type:[""],directionAverage:[[0,0,0]],forceAverage:[0],directionVariance:[0],forceVariance:[0],average:[0],variance:[0],position:[[0,0,0]],scale:[[0,0,0]],rotate:[[0,0,0]],translate:[[0,0,0]]})}ngOnInit(){this.initFormListeners(),this.initCreatorListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=(0,pe.xM)(t.type,t);this.updateSystem(n)});const i=this.formGroup.get("type");i.valueChanges.pipe((0,B.Z)(i.value),(0,na.J)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{const o=pe.Mj[n],a=(0,pe.xM)(t,this.formGroup.value),r=(0,pe.xM)(n,{...o,position:a.translate,translate:a.position,...a});this.setValues(r,!1)})}initCreatorListeners(){this.particleCreator$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i,!1)})}setValues(i,t){this.formGroup.patchValue({...i},{emitEvent:t})}handleDuplicateClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleCreator);this.particleSystemsService.duplicateCreator(i,t)}handleResetClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleCreatorIndex);this.particleSystemsService.resetCreator(i,t)}handleRemoveClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleCreatorIndex);this.particleSystemsService.removeCreator(i,t),this.portalComponent.back()}updateSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=this.store.selectSnapshot(G.B.getSelectedParticleCreatorIndex);t.creators[n]=i,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}static#e=this.\u0275fac=function(t){return new(t||Wi)(e.rXU(l.il),e.rXU(c.ze),e.rXU(nt),e.rXU(Ct.c))};static#t=this.\u0275cmp=e.VBU({type:Wi,selectors:[["app-edit-particle-creator"]],decls:36,vars:18,consts:[["actionsMenu","matMenu"],["positionGroupTmp",""],["label","Creator"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"value"],["label","Direction Average"],["formControlName","directionAverage",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Direction Variance"],["formControlName","directionVariance",3,"min","max","step"],["label","Force Average"],["formControlName","forceAverage",3,"min","max"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max"],["label","Average"],["formControlName","average",3,"min","max"],["label","Variance"],["formControlName","variance",3,"min","max"],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],[4,"ngTemplateOutlet"],["label","Translate"],["formControlName","translate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Rotate"],["formControlName","rotate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Scale"],["formControlName","scale",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",2)(1,"div",3)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"app-panel",7)(13,"app-form-field",8),e.nrm(14,"input",9),e.k0s(),e.j41(15,"app-form-field",10)(16,"span",11),e.EFF(17),e.nI1(18,"async"),e.k0s()(),e.j41(19,"app-form-field",12)(20,"select",13),e.DNE(21,_p,3,4,"option",14),e.k0s()(),e.qex(22,15),e.DNE(23,vp,9,13,"ng-container",16)(24,Cp,5,4,"ng-container",16)(25,yp,5,4,"ng-container",16)(26,kp,5,4,"ng-container",16)(27,Tp,5,4,"ng-container",16)(28,Sp,5,4,"ng-container",16)(29,xp,3,6,"ng-container",16)(30,Ep,5,4,"ng-container",16)(31,Fp,2,1,"ng-container",16)(32,Pp,2,1,"ng-container",16)(33,Mp,2,1,"ng-container",16)(34,Ip,6,18,"ng-template",null,1,e.C5r),e.bVm(),e.k0s()()}if(2&t){let o;const a=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(5),e.JRh(null==(o=e.bMT(18,16,n.particleCreator$))?null:o.id),e.R7$(4),e.Y8G("ngForOf",n.creators),e.R7$(),e.Y8G("ngSwitch",n.formGroup.get("type").value),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.DirectionalVelocity),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.Lifetime),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomRotation),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomRotationSpeed),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomScale),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.SpriteAnimationDuration),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.PointPosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.RandomVelocity),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.SpherePosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.CylinderPosition),e.R7$(),e.Y8G("ngSwitchCase",n.creatorsEnum.CubePosition)}},dependencies:[w.Sq,w.T3,w.ux,w.e1,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ne,qn,w.Jj,yt],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleCreator),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Wi.prototype,"particleCreator$",void 0);let Np=(()=>{class s{constructor(t){this.portalComponent=t,this.itemClick=new e.bkB}onClick(){this.itemClick.next(this.portalComponent)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(nt))};static#t=this.\u0275dir=e.FsC({type:s,selectors:[["","appPortalItem",""]],hostBindings:function(n,o){1&n&&e.bIt("click",function(){return o.onClick()})},outputs:{itemClick:"itemClick"}})}return s})();const Bp=[[["","item-actions",""]]],Dp=["[item-actions]"];let Ji=(()=>{class s{constructor(){this.active=!0,this.itemClick=new e.bkB}ngOnInit(){}handleItemClick(t){this.itemClick.next(t)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-portal-item"]],inputs:{label:"label",active:"active",hint:"hint"},outputs:{itemClick:"itemClick"},ngContentSelectors:Dp,decls:4,vars:5,consts:[["appPortalItem","",1,"portal-item",3,"itemClick"],["toggleType","arrow",3,"toggleable","open","active","label","hint"],["panel-actions",""]],template:function(n,o){1&n&&(e.NAR(Bp),e.j41(0,"div",0),e.bIt("itemClick",function(r){return o.handleItemClick(r)}),e.j41(1,"app-panel",1)(2,"div",2),e.SdG(3),e.k0s()()()),2&n&&(e.R7$(),e.Y8G("toggleable",!1)("open",!1)("active",o.active)("label",o.label)("hint",o.hint))},dependencies:[me.g,Np],changeDetection:0})}return s})();function Gp(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",18),e.bIt("itemClick",function(){const o=e.eBV(t),a=o.$implicit,r=o.index,p=e.XpG(2);return e.Njj(p.handleItemClicked(a,r))}),e.j41(1,"div",19)(2,"button",20),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,2)(6,"button",8),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleDuplicateClick(o))}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){const o=e.eBV(t),a=o.$implicit,r=o.index,p=e.XpG(2);return e.Njj(p.handleResetClick(a,r))}),e.EFF(9,"Reset"),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){const o=e.eBV(t),a=o.$implicit,r=o.index,p=e.XpG(2);return e.Njj(p.handleRemoveClick(a,r))}),e.EFF(11,"Remove"),e.k0s()()()()}if(2&s){const t=i.$implicit,n=e.sdS(5),o=e.XpG(2);e.Y8G("label",o.getComponentLabel(t))("hint",t.type),e.R7$(2),e.Y8G("matMenuTriggerFor",n)}}function $p(s,i){if(1&s&&(e.qex(0),e.DNE(1,Gp,12,3,"app-portal-item",17),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.items)}}function Op(s,i){if(1&s&&(e.j41(0,"div",21),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.SpI(" There are no ",t.type,"s in this chapter. ")}}function Ap(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleAddClick(o))}),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("disabled",!n.isTypeAvailable(t)),e.R7$(),e.SpI(" ",e.bMT(2,2,t)," ")}}const Up=()=>!0;let $o=(()=>{class s{constructor(t,n){this.dialogService=t,this.particleSystemsService=n,this.types=[],this.items=[],this.isTypeAvailable=Up,this.itemClick=new e.bkB,this.addClick=new e.bkB,this.duplicateClick=new e.bkB,this.removeClick=new e.bkB,this.resetAllClick=new e.bkB,this.resetClick=new e.bkB,this.removeAllClick=new e.bkB,this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleItemClicked(t,n){this.itemClick.next(n)}handleAddClick(t){this.addClick.next(t)}handleDuplicateClick(t){this.duplicateClick.next(t)}handleResetClick(t,n){this.resetClick.next(n)}handleRemoveClick(t,n){this.removeClick.next(n)}handleResetAllClick(){this.dialogService.openConfirmDialog({data:{titleText:`Reset ${this.type}s`,bodyText:`Would you like to reset all ${this.type}s?`}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.resetAllClick.next()})}handleRemoveAllClick(){this.dialogService.openConfirmDialog({data:{titleText:`Remove All ${this.type}s`,bodyText:`Would you like to remove all ${this.type}s?`}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.removeAllClick.next()})}getComponentLabel(t){let n;return n=t.name?`**${t.name}**\n\n${t.id}`:t.id,n}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(Xe.o),e.rXU(Ct.c))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-list"]],inputs:{label:"label",type:"type",types:"types",items:"items",isTypeAvailable:"isTypeAvailable"},outputs:{itemClick:"itemClick",addClick:"addClick",duplicateClick:"duplicateClick",removeClick:"removeClick",resetAllClick:"resetAllClick",resetClick:"resetClick",removeAllClick:"removeAllClick"},decls:23,vars:9,consts:[["actionsMenu","matMenu"],["typesMenu","matMenu"],["itemActionsMenu","matMenu"],[3,"label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"list"],[1,"list__content"],[4,"ngIf"],[1,"flex","flex-col","items-center","my-2"],["class","list__message text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"matMenuTriggerFor"],["icon","angle-down"],["mat-menu-item","",3,"disabled","click",4,"ngFor","ngForOf"],[3,"label","hint","itemClick",4,"ngFor","ngForOf"],[3,"itemClick","label","hint"],["item-actions",""],["app-button","","buttonSize","xs",3,"matMenuTriggerFor"],[1,"list__message","text-xs","text-center","my-4"],["mat-menu-item","",3,"click","disabled"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.EFF(7,"Add New"),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleResetAllClick())}),e.EFF(9,"Reset to defaults"),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleRemoveAllClick())}),e.EFF(11),e.k0s()()(),e.j41(12,"div",9)(13,"div",10),e.DNE(14,$p,2,1,"ng-container",11),e.j41(15,"div",12),e.DNE(16,Op,2,1,"div",13),e.j41(17,"button",14),e.EFF(18),e.nrm(19,"app-icon",15),e.k0s()(),e.j41(20,"mat-menu",null,1),e.DNE(22,Ap,3,4,"button",16),e.k0s()()()()}if(2&n){const a=e.sdS(5),r=e.sdS(21);e.Y8G("label",o.label),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(4),e.Y8G("matMenuTriggerFor",r),e.R7$(5),e.SpI("Remove all ",o.type,"s"),e.R7$(3),e.Y8G("ngIf",o.items.length>0),e.R7$(2),e.Y8G("ngIf",0===o.items.length),e.R7$(),e.Y8G("matMenuTriggerFor",r),e.R7$(),e.SpI(" Add ",o.type," "),e.R7$(4),e.Y8G("ngForOf",o.types)}},dependencies:[w.Sq,w.bT,D.kk,D.fb,D.Cp,Y.Q,X.R,Ji,Ne,yt],styles:[".list[_ngcontent-%COMP%]{height:100%}.list__content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.list__message[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0})}return s})();var oa=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},sa=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Vp=()=>[];class bi{constructor(i,t,n){this.store=i,this.particleSystemsService=t,this.portalComponent=n,this.creatorTypes=Object.values(we.Uy),this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}selectClick(i){this.selectItem(i),i>-1&&this.portalComponent.loadComponent(Wi)}handleAddClick(i){this.createNew(i)}handleDuplicateClick(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.duplicateCreator(t,i)}handleRemoveClick(i){this.delete(i)}handleResetClick(i){this.resetDefault(i)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}selectItem(i){this.store.dispatch(new le.u.SelectParticleCreator(i))}createNew(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.createNewCreator(t,i)}resetDefault(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetCreator(t,i)}resetDefaults(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetCreators(i)}delete(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);t.creators=t.creators.filter((n,o)=>o!==i),this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t)),this.selectItem(-1)}deleteAll(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.store.dispatch(new le.u.UpdateParticleSystem(i.id,{...i,creators:[]}))}static#e=this.\u0275fac=function(t){return new(t||bi)(e.rXU(l.il),e.rXU(Ct.c),e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:bi,selectors:[["app-edit-particle-creator-list"]],decls:2,vars:5,consts:[["label","Creators","type","creator",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(a){return n.selectClick(a)})("addClick",function(a){return n.handleAddClick(a)})("removeClick",function(a){return n.handleRemoveClick(a)})("duplicateClick",function(a){return n.handleDuplicateClick(a)})("resetClick",function(a){return n.handleResetClick(a)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let o;e.Y8G("types",n.creatorTypes)("items",(null==(o=e.bMT(1,2,n.particleSystem$))?null:o.creators)||e.lJ4(4,Vp))}},dependencies:[$o,w.Jj],changeDetection:0})}oa([(0,l.l6)(G.B.getSelectedParticleSystemId),sa("design:type",_.c)],bi.prototype,"particleSystemId$",void 0),oa([(0,l.l6)(G.B.getSelectedParticleSystem),sa("design:type",_.c)],bi.prototype,"particleSystem$",void 0);let Lp=(()=>{class s{constructor(t,n){this.formBuilder=t,this.store=n,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.formGroup=this.formBuilder.group({layer:[1],depthMask:[!1],roundPoints:[!1],perspectivePoints:[!1],addAlpha:[!1]}),this.setDefaults(!1)}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setParticleSystem(t)})}initParticleSystemListeners(){this.store.select(G.B.getSelectedParticleSystem).pipe((0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setValues(t.properties,!1)})}handleResetClick(){this.setDefaults(!0)}setValues(t,n){this.formGroup.patchValue({...t},{emitEvent:n})}setParticleSystem(t){const o={...this.store.selectSnapshot(G.B.getSelectedParticleSystem),properties:t};this.store.dispatch(new le.u.UpdateParticleSystem(o.id,o))}setDefaults(t){this.setValues(pe.Fq,t)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-properties"]],decls:23,vars:5,consts:[["systemActions","matMenu"],["label","Properties"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[3,"overlapTrigger"],["mat-menu-item","",3,"click"],[1,"text-xs",3,"formGroup"],["label","Layer"],["formControlName","layer",3,"min","max"],["formControlName","depthMask"],["formControlName","roundPoints"],["formControlName","perspectivePoints"],["formControlName","addAlpha"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",5,0)(6,"button",6),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"app-panel",7)(9,"app-form-field",8),e.nrm(10,"app-slider",9),e.k0s(),e.j41(11,"app-form-field")(12,"mat-checkbox",10),e.EFF(13,"Depth Mask"),e.k0s()(),e.j41(14,"app-form-field")(15,"mat-checkbox",11),e.EFF(16,"Round Points"),e.k0s()(),e.j41(17,"app-form-field")(18,"mat-checkbox",12),e.EFF(19,"Perspective Points"),e.k0s()(),e.j41(20,"app-form-field")(21,"mat-checkbox",13),e.EFF(22,"Add Alpha"),e.k0s()()()()}if(2&n){const a=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(2),e.Y8G("overlapTrigger",!0),e.R7$(4),e.Y8G("formGroup",o.formGroup),e.R7$(2),e.Y8G("min",0)("max",1e3)}},dependencies:[c.BC,c.cb,c.j4,c.JD,Ae.So,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ne],changeDetection:0})}return s})();var Hn=v(65571);let Yp=(()=>{class s extends Ke.Z{constructor(){super(...arguments),this.shapeDirectionEnum=we.zu}ngOnInit(){}static#e=this.\u0275fac=(()=>{let t;return function(o){return(t||(t=e.xGo(s)))(o||s)}})();static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-direction-selector"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:7,vars:7,consts:[[3,"formControl"],[3,"value","matTooltip"],[1,"uppercase"]],template:function(n,o){1&n&&(e.j41(0,"mat-button-toggle-group",0)(1,"mat-button-toggle",1)(2,"div",2),e.EFF(3,"In"),e.k0s()(),e.j41(4,"mat-button-toggle",1)(5,"div",2),e.EFF(6,"Out"),e.k0s()()()),2&n&&(e.Y8G("formControl",o.control),e.R7$(),e.Y8G("value",o.shapeDirectionEnum.In)("matTooltip",o.shapeDirectionEnum.In),e.BMQ("aria-label",o.shapeDirectionEnum.In),e.R7$(3),e.Y8G("value",o.shapeDirectionEnum.Out)("matTooltip",o.shapeDirectionEnum.Out),e.BMQ("aria-label",o.shapeDirectionEnum.Out))},dependencies:[c.BC,c.l_,Hn.ec,Hn.pc,Ce.oV],changeDetection:0})}return s})(),zp=(()=>{class s extends Ke.Z{constructor(){super(...arguments),this.shapeTypesEnum=we.Po}ngOnInit(){}static#e=this.\u0275fac=(()=>{let t;return function(o){return(t||(t=e.xGo(s)))(o||s)}})();static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-shape-selector"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:9,vars:13,consts:[[3,"formControl"],[3,"value","matTooltip"],["icon","circle"],["icon","diamond"],["icon","cube"],["icon","rectangle-portrait"]],template:function(n,o){1&n&&(e.j41(0,"mat-button-toggle-group",0)(1,"mat-button-toggle",1),e.nrm(2,"app-icon",2),e.k0s(),e.j41(3,"mat-button-toggle",1),e.nrm(4,"app-icon",3),e.k0s(),e.j41(5,"mat-button-toggle",1),e.nrm(6,"app-icon",4),e.k0s(),e.j41(7,"mat-button-toggle",1),e.nrm(8,"app-icon",5),e.k0s()()),2&n&&(e.Y8G("formControl",o.control),e.R7$(),e.Y8G("value",o.shapeTypesEnum.Sphere)("matTooltip",o.shapeTypesEnum.Sphere),e.BMQ("aria-label",o.shapeTypesEnum.Sphere),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Plane)("matTooltip",o.shapeTypesEnum.Plane),e.BMQ("aria-label",o.shapeTypesEnum.Plane),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Cube)("matTooltip",o.shapeTypesEnum.Cube),e.BMQ("aria-label",o.shapeTypesEnum.Cube),e.R7$(2),e.Y8G("value",o.shapeTypesEnum.Cylinder)("matTooltip",o.shapeTypesEnum.Cylinder),e.BMQ("aria-label",o.shapeTypesEnum.Cylinder))},dependencies:[c.BC,c.l_,Hn.ec,Hn.pc,Ce.oV,X.R],changeDetection:0})}return s})(),aa=(()=>{class s extends Ke.n{constructor(t,n){super(),this.formBuilder=t,this.changeRef=n,this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({type:[we.Po.Cube],scale:[[0,0,0]],rotate:[[0,0,0]],translate:[[0,0,0]],direction:[we.zu.In]})}ngOnInit(){this.formGroup.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.value=t})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){this.formGroup.patchValue(t),this.changeRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-particle-shape"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:11,vars:19,consts:[[3,"formGroup"],["label","Shape Type"],["formControlName","type"],["label","Direction Selector"],["formControlName","direction"],["label","Translate"],["formControlName","translate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Rotate"],["formControlName","rotate",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Scale"],["formControlName","scale",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(n,o){1&n&&(e.qex(0,0),e.j41(1,"app-form-field",1),e.nrm(2,"app-edit-particle-shape-selector",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-edit-particle-direction-selector",4),e.k0s(),e.j41(5,"app-form-field",5),e.nrm(6,"app-edit-particle-vector",6),e.k0s(),e.j41(7,"app-form-field",7),e.nrm(8,"app-edit-particle-vector",8),e.k0s(),e.j41(9,"app-form-field",9),e.nrm(10,"app-edit-particle-vector",10),e.k0s(),e.bVm()),2&n&&(e.Y8G("formGroup",o.formGroup),e.R7$(6),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-180)("xmax",180)("ymin",-180)("ymax",180)("zmin",-180)("zmax",180),e.R7$(2),e.Y8G("xmin",0)("xmax",20)("ymin",0)("ymax",20)("zmin",0)("zmax",20))},dependencies:[c.BC,c.cb,c.j4,c.JD,Z.K,Yp,zp,qn],changeDetection:0})}return s})();function qp(s,i){if(1&s&&(e.j41(0,"option",15),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,t)," ")}}function Hp(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",16)(2,"mat-checkbox",17),e.EFF(3,"Trap Shape"),e.k0s()(),e.nrm(4,"app-edit-particle-shape",18),e.bVm())}class Ki{get isShapeType(){const{type:i}=this.formGroup.value;return pe.qA.includes(i)}constructor(i,t,n,o){this.store=i,this.formBuilder=t,this.portalComponent=n,this.particleSystemsService=o,this.constraintsEnum=we.lc,this.shapeTypesEnum=we.Po,this.availableConstraints=Object.values(we.lc),this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({id:[""],name:[""],type:[""],trap:[!1],shape:[]})}ngOnInit(){this.initFormListeners(),this.initConstraintListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const o=(0,pe.qg)(t.type,t);this.updateSystem(o)});const i=this.formGroup.get("type");i.valueChanges.pipe((0,B.Z)(i.value),(0,na.J)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{const o=pe.Fg[n],a=(0,pe.qg)(t,this.formGroup.value),r=(0,pe.qg)(n,{...o,...a});this.setValues(r,!1)})}initConstraintListeners(){this.particleConstraint$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.availableConstraints=Object.values(we.lc).filter(n=>(0,pe.t0)(t,n)),this.setValues(i,!1)})}setValues(i,t){this.formGroup.patchValue({...i},{emitEvent:t})}handleDuplicateClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleConstraint);this.particleSystemsService.duplicateConstraint(i,t)}handleResetClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleConstraintIndex);this.particleSystemsService.resetConstraint(i,t)}handleRemoveClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleConstraintIndex);this.particleSystemsService.removeConstraint(i,t),this.portalComponent.back()}updateSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=this.store.selectSnapshot(G.B.getSelectedParticleConstraintIndex);t.constraints[n]=i,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}static#e=this.\u0275fac=function(t){return new(t||Ki)(e.rXU(l.il),e.rXU(c.ze),e.rXU(nt),e.rXU(Ct.c))};static#t=this.\u0275cmp=e.VBU({type:Ki,selectors:[["app-edit-particle-constraint"]],decls:23,vars:7,consts:[["actionsMenu","matMenu"],["label","Constraint"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["label","Trap"],["formControlName","trap",1,"text-xs"],["formControlName","shape"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"app-panel",6)(13,"app-form-field",7),e.nrm(14,"input",8),e.k0s(),e.j41(15,"app-form-field",9)(16,"span",10),e.EFF(17),e.nI1(18,"async"),e.k0s()(),e.j41(19,"app-form-field",11)(20,"select",12),e.DNE(21,qp,3,4,"option",13),e.k0s()(),e.DNE(22,Hp,5,0,"ng-container",14),e.k0s()()}if(2&t){let o;const a=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(5),e.JRh(null==(o=e.bMT(18,5,n.particleConstraint$))?null:o.id),e.R7$(4),e.Y8G("ngForOf",n.availableConstraints),e.R7$(),e.Y8G("ngIf",n.isShapeType)}},dependencies:[w.Sq,w.bT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,Ae.So,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,me.g,Ne,aa,w.Jj,yt],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleConstraint),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Ki.prototype,"particleConstraint$",void 0);var ra=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},la=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Wp=()=>[];class _i{constructor(i,t,n){this.store=i,this.particleSystemsService=t,this.portalComponent=n,this.constraintTypes=Object.values(we.lc),this.isConstraintAvailable=()=>!0,this.isConstraintAvailable=this.checkConstraintAvailable.bind(this)}ngOnInit(){}selectClick(i){this.selectItem(i)}handleAddClick(i){this.createNew(i)}handleDuplicateClick(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.duplicateConstraint(t,i)}handleRemoveClick(i){this.delete(i)}handleResetClick(i){this.resetDefault(i)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}checkConstraintAvailable(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);return(0,pe.t0)(t,i)}selectItem(i){this.store.dispatch(new le.u.SelectParticleConstraint(i)),i>-1&&this.portalComponent.loadComponent(Ki)}createNew(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.createNewConstraint(t,i)}resetDefault(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetConstraint(t,i)}resetDefaults(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetConstraints(i)}delete(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);t.constraints=t.constraints.filter((n,o)=>o!==i),this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t)),this.selectItem(-1)}deleteAll(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.store.dispatch(new le.u.UpdateParticleSystem(i.id,{...i,constraints:[]}))}static#e=this.\u0275fac=function(t){return new(t||_i)(e.rXU(l.il),e.rXU(Ct.c),e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:_i,selectors:[["app-edit-particle-constraint-list"]],decls:2,vars:6,consts:[["label","Constraints","type","constraint",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items","isTypeAvailable"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(a){return n.selectClick(a)})("addClick",function(a){return n.handleAddClick(a)})("removeClick",function(a){return n.handleRemoveClick(a)})("duplicateClick",function(a){return n.handleDuplicateClick(a)})("resetClick",function(a){return n.handleResetClick(a)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let o;e.Y8G("types",n.constraintTypes)("items",(null==(o=e.bMT(1,3,n.particleSystem$))?null:o.constraints)||e.lJ4(5,Wp))("isTypeAvailable",n.isConstraintAvailable)}},dependencies:[$o,w.Jj],changeDetection:0})}function Zp(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-panel",14,1)(2,"div",15)(3,"button",5),e.nrm(4,"app-icon",6),e.k0s(),e.j41(5,"mat-menu",null,2)(7,"button",7),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRemovePathNodeClick(o))}),e.EFF(8,"Remove Node"),e.k0s(),e.j41(9,"button",7),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleDuplicatePathNodeClick(o))}),e.EFF(10," Duplicate Node "),e.k0s()()(),e.j41(11,"app-form-field",16),e.nrm(12,"app-edit-particle-vector",17),e.k0s(),e.j41(13,"app-form-field",18),e.nrm(14,"app-slider",19),e.k0s(),e.j41(15,"app-form-field",20),e.nrm(16,"app-slider",21),e.k0s(),e.j41(17,"app-form-field",22),e.nrm(18,"app-slider",23),e.k0s()()}if(2&s){const t=i.$implicit,n=i.index,o=e.sdS(1),a=e.sdS(6),r=e.XpG();e.Y8G("cdkDragDisabled",o.open)("open",!1)("label","Path Node #"+(n+1))("hint",r.formatNodeHint(t))("isCompact",!0)("formGroupName",n),e.R7$(3),e.Y8G("matMenuTriggerFor",a),e.R7$(9),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1)}}function ed(s,i){1&s&&(e.j41(0,"div",24),e.EFF(1," There are no Path Nodes in this updater. "),e.k0s())}ra([(0,l.l6)(G.B.getSelectedParticleSystemId),la("design:type",_.c)],_i.prototype,"particleSystemId$",void 0),ra([(0,l.l6)(G.B.getSelectedParticleSystem),la("design:type",_.c)],_i.prototype,"particleSystem$",void 0);const ca={position:[0,0,0],forceAverage:0,radius:0,forceVariance:0};class Zi{constructor(i,t,n){this.formBuilder=i,this.store=t,this.dialogService=n,this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({nodes:this.formBuilder.array([])}),this.nodesFormArray=this.formGroup.get("nodes")}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(t)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)})}handleAddPathNodeClick(){this.addPathNode()}handleRemoveAllPathNodesClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Path Nodes",bodyText:`Would you like to remove all ${this.nodesFormArray.length} Path Nodes?`}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{if(i){const t=this.createUpdaterFromValues({nodes:[]});this.updateSystem(t)}})}handleRemovePathNodeClick(i){this.nodesFormArray.removeAt(i)}handleDuplicatePathNodeClick(i){const t=this.createPathNodeFormGroup(i.value);this.nodesFormArray.push(t)}handlePathNodeDropped(i){const{previousIndex:t,currentIndex:n}=i,o=this.formGroup.value,{nodes:a}=o,r=(0,Gt.W)(a,t,n);this.nodesFormArray.clear(),r.forEach(p=>{const x=this.createPathNodeFormGroup(p);this.nodesFormArray.push(x)}),this.formGroup.patchValue({nodes:r})}addPathNode(){const i=this.createPathNodeFormGroup(ca);this.nodesFormArray.push(i)}createPathNodeFormGroup(i){const{position:t,forceAverage:n,radius:o,forceVariance:a}=i;return this.formBuilder.group({position:[t],forceAverage:[n],radius:[o],forceVariance:[a]})}setValues(i){i.type===we.$t.Path&&typeof i.nodes<"u"&&this.nodesFormArray.length!==i.nodes.length&&(this.nodesFormArray.clear(),i.nodes.forEach(()=>{const t=this.createPathNodeFormGroup(ca);this.nodesFormArray.push(t)})),this.formGroup.patchValue({...i},{emitEvent:!1,onlySelf:!0})}formatNodeHint(i){const t=i.value,{position:n,forceAverage:o,radius:a,forceVariance:r}=t;return`Postition: [${n}], Force Average: ${o}, Radius: ${a}, Force Variance: ${r}`}createUpdaterFromValues(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleUpdater);return(0,pe.MH)(t.type,{...t,...i})}updateSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=this.store.selectSnapshot(G.B.getSelectedParticleUpdaterIndex);t.updaters[n]=i,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}static#e=this.\u0275fac=function(t){return new(t||Zi)(e.rXU(c.ze),e.rXU(l.il),e.rXU(Xe.o))};static#t=this.\u0275cmp=e.VBU({type:Zi,selectors:[["app-edit-particle-updater-node"]],decls:19,vars:9,consts:[["pathNodeMenu","matMenu"],["nodePanel",""],["nodeActionsMenu","matMenu"],[3,"formGroup","label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["formArrayName","nodes"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["cdkDrag","","toggleType","arrow",3,"cdkDragDisabled","open","label","hint","isCompact","formGroupName",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","my-2"],["class","text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"click"],["cdkDrag","","toggleType","arrow",3,"cdkDragDisabled","open","label","hint","isCompact","formGroupName"],["panel-actions",""],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Force Average"],["formControlName","forceAverage",3,"min","max","step"],["label","Radius"],["formControlName","radius",3,"min","max","step"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max","step"],[1,"text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleAddPathNodeClick())}),e.EFF(7,"Add Node"),e.k0s(),e.j41(8,"button",7),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveAllPathNodesClick())}),e.EFF(9,"Remove All Nodes"),e.k0s()()(),e.qex(10,8),e.j41(11,"div",9),e.bIt("cdkDropListDropped",function(r){return e.eBV(o),e.Njj(n.handlePathNodeDropped(r))}),e.DNE(12,Zp,19,22,"app-panel",10),e.k0s(),e.j41(13,"div",11),e.DNE(14,ed,2,0,"div",12),e.nI1(15,"async"),e.nI1(16,"async"),e.j41(17,"button",13),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleAddPathNodeClick())}),e.EFF(18,"Add Node"),e.k0s()(),e.bVm(),e.k0s()}if(2&t){let o;const a=e.sdS(5);e.Y8G("formGroup",n.formGroup)("label","Path Nodes"),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(10),e.Y8G("ngForOf",n.nodesFormArray.controls),e.R7$(2),e.Y8G("ngIf",(null==(o=e.bMT(15,5,n.particleUpdater$))?null:o.nodes)&&0===(null==(o=e.bMT(16,7,n.particleUpdater$))?null:o.nodes.length))}},dependencies:[w.Sq,w.bT,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ne,qn,w.Jj],changeDetection:0})}function nd(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-panel",13)(1,"div",14)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,1)(6,"button",6),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRemovePathColorClick(o))}),e.EFF(7,"Remove Color"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleDuplicatePathColorClick(o))}),e.EFF(9," Duplicate Color "),e.k0s()()(),e.nrm(10,"app-color-picker-input",15),e.k0s()}if(2&s){const t=i.index,n=e.sdS(5);e.Y8G("toggleable",!1)("label","Color #"+(t+1))("isCompact",!0),e.R7$(2),e.Y8G("matMenuTriggerFor",n),e.R7$(8),e.Y8G("formControlName",t)("alpha",!0)("decimal",!1)}}function od(s,i){1&s&&(e.j41(0,"div",16),e.EFF(1," There are no colors in this updater. "),e.k0s())}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleUpdater),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Zi.prototype,"particleUpdater$",void 0);const pa=[255,0,0,1];class en{constructor(i,t,n){this.formBuilder=i,this.store=t,this.dialogService=n,this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({colors:this.formBuilder.array([[0,0,0,1],[0,0,0,1],[0,0,0,1]])}),this.colorsFormArray=this.formGroup.get("colors")}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(t)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)})}handleAddPathColorClick(){this.addPathColor()}handleRemoveAllPathColorsClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Colors",bodyText:`Would you like to remove all ${this.colorsFormArray.length} colors?`}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{if(i){const t=this.createUpdaterFromValues({colors:[]});this.updateSystem(t)}})}handleRemovePathColorClick(i){this.colorsFormArray.removeAt(i)}handleDuplicatePathColorClick(i){const t=this.createColorControl(i.value);this.colorsFormArray.push(t)}handlePathColorDropped(i){const{previousIndex:t,currentIndex:n}=i,o=this.formGroup.value,{colors:a}=o,r=(0,Gt.W)(a,t,n);this.colorsFormArray.clear(),r.forEach(p=>{const x=this.createColorControl(p);this.colorsFormArray.push(x)}),this.formGroup.patchValue({colors:r})}addPathColor(){const i=this.createColorControl(pa);this.colorsFormArray.push(i)}createColorControl(i){const t=this.formBuilder.control([]);return t.setValue(i),t}setValues(i){let t=(0,R.get)(i,"colors",[]);Array.isArray(t)&&Array.isArray(t)&&(t=this.colorModelToFormColor(t)),this.colorsFormArray.length!==t.length&&(this.colorsFormArray.clear(),t.forEach(()=>{const n=this.createColorControl(pa);this.colorsFormArray.push(n)})),this.formGroup.patchValue({colors:t},{emitEvent:!1,onlySelf:!0})}colorModelToFormColor(i){return i.map(([t,n,o,a])=>[t,n,o,a/255])}formColorToColorModel(i){return i.map(([t,n,o,a])=>[t,n,o,255*a])}createUpdaterFromValues(i){const t=i.colors,n=this.store.selectSnapshot(G.B.getSelectedParticleUpdater);return(0,pe.MH)(n.type,{...n,colors:this.formColorToColorModel(t)})}updateSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=this.store.selectSnapshot(G.B.getSelectedParticleUpdaterIndex);t.updaters[n]=i,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}static#e=this.\u0275fac=function(t){return new(t||en)(e.rXU(c.ze),e.rXU(l.il),e.rXU(Xe.o))};static#t=this.\u0275cmp=e.VBU({type:en,selectors:[["app-edit-particle-updater-color"]],decls:19,vars:9,consts:[["colorsMenu","matMenu"],["colorActionsMenu","matMenu"],[3,"formGroup","label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["formArrayName","colors"],["cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDropped"],["cdkDrag","",3,"toggleable","label","isCompact",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center","my-2"],["class","text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline",3,"click"],["cdkDrag","",3,"toggleable","label","isCompact"],["panel-actions",""],["type","rgba",3,"formControlName","alpha","decimal"],[1,"text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",2)(1,"div",3)(2,"button",4),e.nrm(3,"app-icon",5),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleAddPathColorClick())}),e.EFF(7,"Add Color"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveAllPathColorsClick())}),e.EFF(9,"Remove All Colors"),e.k0s()()(),e.qex(10,7),e.j41(11,"div",8),e.bIt("cdkDropListDropped",function(r){return e.eBV(o),e.Njj(n.handlePathColorDropped(r))}),e.DNE(12,nd,11,7,"app-panel",9),e.k0s(),e.j41(13,"div",10),e.DNE(14,od,2,0,"div",11),e.nI1(15,"async"),e.nI1(16,"async"),e.j41(17,"button",12),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleAddPathColorClick())}),e.EFF(18,"Add Color"),e.k0s()(),e.bVm(),e.k0s()}if(2&t){let o;const a=e.sdS(5);e.Y8G("formGroup",n.formGroup)("label","Colors"),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(10),e.Y8G("ngForOf",n.colorsFormArray.controls),e.R7$(2),e.Y8G("ngIf",(null==(o=e.bMT(15,5,n.particleUpdater$))?null:o.colors)&&0===(null==(o=e.bMT(16,7,n.particleUpdater$))?null:o.colors.length))}},dependencies:[w.Sq,w.bT,c.BC,c.cb,c.j4,c.JD,c.v8,te.O7,te.T1,D.kk,D.fb,D.Cp,Y.Q,X.R,me.g,bt,Ne,w.Jj],changeDetection:0})}function rd(s,i){if(1&s&&(e.j41(0,"option",16),e.EFF(1),e.nI1(2,"prettyPrint"),e.k0s()),2&s){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",e.bMT(2,2,t)," ")}}function ld(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-portal-item",17),e.bIt("itemClick",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleColorsClicked())}),e.k0s(),e.j41(2,"app-panel",18),e.nrm(3,"app-edit-particle-shape",19),e.k0s(),e.bVm()}2&s&&(e.R7$(),e.Y8G("label","Colors"))}function cd(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",20),e.nrm(3,"app-slider",21),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",24),e.nrm(7,"app-slider",25),e.k0s()(),e.j41(8,"app-panel",18),e.nrm(9,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function pd(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",26),e.nrm(3,"app-edit-particle-vector",27),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",28),e.nrm(7,"app-slider",29),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",0)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",.5),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function dd(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",24),e.nrm(7,"app-slider",25),e.k0s()(),e.j41(8,"app-panel",18),e.nrm(9,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function md(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",32),e.nrm(3,"app-slider",33),e.k0s()(),e.j41(4,"app-panel",18),e.nrm(5,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("min",0)("max",1)("step",.01))}function ud(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",22),e.nrm(5,"app-slider",23),e.k0s(),e.j41(6,"app-form-field",34),e.nrm(7,"app-slider",35),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",10)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}function hd(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",37),e.bIt("itemClick",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handlePathNodesClicked())}),e.k0s()}if(2&s){const t=i.$implicit;e.Y8G("label","Path Nodes")("hint",(t.nodes?t.nodes.length:0)+" Path Nodes")}}function fd(s,i){if(1&s&&(e.qex(0),e.DNE(1,hd,1,2,"app-portal-item",36),e.nI1(2,"async"),e.j41(3,"app-panel",18),e.nrm(4,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.particleUpdater$))}}function gd(s,i){1&s&&(e.qex(0),e.j41(1,"app-panel")(2,"app-form-field",30),e.nrm(3,"app-edit-particle-vector",31),e.k0s(),e.j41(4,"app-form-field",38),e.nrm(5,"app-edit-particle-vector",39),e.k0s(),e.j41(6,"app-form-field",22),e.nrm(7,"app-slider",23),e.k0s(),e.j41(8,"app-form-field",24),e.nrm(9,"app-slider",25),e.k0s()(),e.j41(10,"app-panel",18),e.nrm(11,"app-edit-particle-shape",19),e.k0s(),e.bVm()),2&s&&(e.R7$(3),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("xmin",-10)("xmax",10)("ymin",-10)("ymax",10)("zmin",-10)("zmax",10),e.R7$(2),e.Y8G("min",-25)("max",25)("step",1),e.R7$(2),e.Y8G("min",0)("max",25)("step",1))}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleUpdater),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],en.prototype,"particleUpdater$",void 0);class tn{constructor(i,t,n,o,a){this.store=i,this.formBuilder=t,this.portalComponent=n,this.particleSystemsService=o,this.dialogService=a,this.particleUpdaterEnum=we.$t,this.updaterTypes=Object.values(we.$t),this.ngUnsubscribe=new f.B,this.formGroup=this.formBuilder.group({id:[""],type:[""],name:[""],position:[[0,0,0]],direction:[[0,0,0]],friction:0,frequency:0,forceAverage:0,radius:0,forceVariance:0,directionAverage:[[0,0,0]],directionVariance:0,shapeEnabled:[!1],shape:[pe.C6]})}ngOnInit(){this.initFormListeners(),this.initUpdaterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(125),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.createUpdaterFromValues(this.formGroup.value);this.updateSystem(i)})}initUpdaterListeners(){this.particleUpdater$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)})}handleDuplicateClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleUpdater);this.particleSystemsService.duplicateUpdater(i,t)}handleResetClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleUpdaterIndex);this.particleSystemsService.resetUpdater(i,t)}handleRemoveClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem),t=this.store.selectSnapshot(G.B.getSelectedParticleUpdaterIndex);this.particleSystemsService.removeUpdater(i,t),this.portalComponent.back()}handlePathNodesClicked(){this.portalComponent.loadComponent(Zi)}handleColorsClicked(){this.portalComponent.loadComponent(en)}setValues(i){if(this.formGroup){const t="shape"in i&&!(0,R.isNil)(i.shape);this.formGroup.patchValue({...i,shapeEnabled:t},{emitEvent:!1,onlySelf:!0})}}createUpdaterFromValues(i){const{type:t,shapeEnabled:n,shape:o}=i,a=this.store.selectSnapshot(G.B.getSelectedParticleUpdater);return(0,pe.MH)(t,{...a,...i,shape:n?o:void 0})}updateSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=this.store.selectSnapshot(G.B.getSelectedParticleUpdaterIndex);t.updaters[n]=i,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}static#e=this.\u0275fac=function(t){return new(t||tn)(e.rXU(l.il),e.rXU(c.ze),e.rXU(nt),e.rXU(Ct.c),e.rXU(Xe.o))};static#t=this.\u0275cmp=e.VBU({type:tn,selectors:[["app-edit-particle-updater"]],decls:32,vars:15,consts:[["actionsMenu","matMenu"],["label","Updater"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name",1,"input"],["label","ID"],[1,"text-xs"],["label","Type"],["formControlName","type",1,"input"],[3,"value",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"value"],[3,"itemClick","label"],["label","Shape","toggleType","checkbox","formControlName","shapeEnabled"],["formControlName","shape"],["label","Frequency"],["formControlName","frequency",3,"min","max","step"],["label","Force Average"],["formControlName","forceAverage",3,"min","max","step"],["label","Force Variance"],["formControlName","forceVariance",3,"min","max","step"],["label","Direction Average"],["formControlName","directionAverage",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","Direction Variance"],["formControlName","directionVariance",3,"min","max","step"],["label","Position"],["formControlName","position",3,"xmin","xmax","ymin","ymax","zmin","zmax"],["label","friction"],["formControlName","friction",3,"min","max","step"],["label","Radius"],["formControlName","radius",3,"min","max","step"],[3,"label","hint","itemClick",4,"ngIf"],[3,"itemClick","label","hint"],["label","Direction"],["formControlName","direction",3,"xmin","xmax","ymin","ymax","zmin","zmax"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.j41(12,"div",6)(13,"app-panel")(14,"app-form-field",7),e.nrm(15,"input",8),e.k0s(),e.j41(16,"app-form-field",9)(17,"span",10),e.EFF(18),e.nI1(19,"async"),e.k0s()(),e.j41(20,"app-form-field",11)(21,"select",12),e.DNE(22,rd,3,4,"option",13),e.k0s()()(),e.qex(23,14),e.DNE(24,ld,4,1,"ng-container",15)(25,cd,10,9,"ng-container",15)(26,pd,12,15,"ng-container",15)(27,dd,10,12,"ng-container",15)(28,md,6,3,"ng-container",15)(29,ud,12,15,"ng-container",15)(30,fd,5,3,"ng-container",15)(31,gd,12,18,"ng-container",15),e.bVm(),e.k0s()()}if(2&t){let o;const a=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(10),e.Y8G("formGroup",n.formGroup),e.R7$(6),e.JRh(null==(o=e.bMT(19,13,n.particleUpdater$))?null:o.id),e.R7$(4),e.Y8G("ngForOf",n.updaterTypes),e.R7$(),e.Y8G("ngSwitch",n.formGroup.get("type").value),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.AgeColorBlend),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.BrownianMotion),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.UniformForce),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.RadialForce),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Friction),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Gravity),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.Path),e.R7$(),e.Y8G("ngSwitchCase",n.particleUpdaterEnum.AxisForce)}},dependencies:[w.Sq,w.bT,w.ux,w.e1,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ji,Ne,aa,qn,w.Jj,yt],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleUpdater),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],tn.prototype,"particleUpdater$",void 0);var da=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},ma=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const bd=()=>[];class vi{constructor(i,t,n,o){this.store=i,this.dialogService=t,this.particleSystemsService=n,this.portalComponent=o,this.updaterTypes=Object.values(we.$t),this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}selectClick(i){this.selectItem(i),i>-1&&this.portalComponent.loadComponent(tn)}handleRemoveClick(i){this.delete(i)}handleDuplicateClick(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.duplicateUpdater(t,i)}handleAddClick(i){this.createNew(i)}handleResetClick(i){this.resetDefault(i)}handleResetAllClick(){this.resetDefaults()}handleRemoveAllClick(){this.deleteAll()}selectItem(i){this.store.dispatch(new le.u.SelectParticleUpdater(i))}createNew(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.createNewUpdater(t,i)}resetDefault(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetUpdater(t,i)}resetDefaults(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.particleSystemsService.resetUpdaters(i)}delete(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);t.updaters=t.updaters.filter((n,o)=>o!==i),this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t)),this.selectItem(-1)}deleteAll(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.store.dispatch(new le.u.UpdateParticleSystem(i.id,{...i,updaters:[]}))}static#e=this.\u0275fac=function(t){return new(t||vi)(e.rXU(l.il),e.rXU(Xe.o),e.rXU(Ct.c),e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:vi,selectors:[["app-edit-particle-updater-list"]],decls:2,vars:5,consts:[["label","Updaters","type","updater",3,"itemClick","addClick","removeClick","duplicateClick","resetClick","resetAllClick","removeAllClick","types","items"]],template:function(t,n){if(1&t&&(e.j41(0,"app-edit-particle-list",0),e.nI1(1,"async"),e.bIt("itemClick",function(a){return n.selectClick(a)})("addClick",function(a){return n.handleAddClick(a)})("removeClick",function(a){return n.handleRemoveClick(a)})("duplicateClick",function(a){return n.handleDuplicateClick(a)})("resetClick",function(a){return n.handleResetClick(a)})("resetAllClick",function(){return n.handleResetAllClick()})("removeAllClick",function(){return n.handleRemoveAllClick()}),e.k0s()),2&t){let o;e.Y8G("types",n.updaterTypes)("items",(null==(o=e.bMT(1,2,n.particleSystem$))?null:o.updaters)||e.lJ4(4,bd))}},dependencies:[$o,w.Jj],changeDetection:0})}da([(0,l.l6)(G.B.getSelectedParticleSystemId),ma("design:type",_.c)],vi.prototype,"particleSystemId$",void 0),da([(0,l.l6)(G.B.getSelectedParticleSystem),ma("design:type",_.c)],vi.prototype,"particleSystem$",void 0);class nn{constructor(i,t){this.formBuilder=i,this.store=t,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({numParticles:[0],pointSize:[0],emissionAverage:[0],emissionVariance:[0]}),this.setValues((0,pe.Vs)())}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(125),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setParticleSystem(i)})}initParticleSystemListeners(){this.particleSystem$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)})}handleResetClick(){this.reset()}setParticleSystem(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n=(0,pe.Ir)({...t,...this.getParticleSystemFromForm(i)});this.store.dispatch(new le.u.UpdateParticleSystem(n.id,n))}setValues(i){this.form&&this.form.patchValue(i,{emitEvent:!1,onlySelf:!0})}reset(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystemId);this.setValues({...(0,pe.Vs)(),id:i})}getParticleSystemFromForm(i){const{numParticles:t,pointSize:n,emissionAverage:o,emissionVariance:a}=i;return{numParticles:t,pointSize:n,emissionAverage:o,emissionVariance:a}}static#e=this.\u0275fac=function(t){return new(t||nn)(e.rXU(c.ze),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:nn,selectors:[["app-edit-particle-system-basic-form"]],decls:17,vars:11,consts:[["actionsMenu","matMenu"],[3,"label"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Number of Particles"],["formControlName","numParticles",3,"min","max"],["label","Point Size"],["formControlName","pointSize",3,"min","max"],["label","Emission Average"],["formControlName","emissionAverage",3,"min","max"],["label","Emission Variance"],["formControlName","emissionVariance",3,"min","max"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(7,"Reset to default"),e.k0s()()(),e.j41(8,"app-panel",6)(9,"app-form-field",7),e.nrm(10,"app-slider",8),e.k0s(),e.j41(11,"app-form-field",9),e.nrm(12,"app-slider",10),e.k0s(),e.j41(13,"app-form-field",11),e.nrm(14,"app-slider",12),e.k0s(),e.j41(15,"app-form-field",13),e.nrm(16,"app-slider",14),e.k0s()()()}if(2&t){const o=e.sdS(5);e.Y8G("label","Quantity"),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("min",0)("max",1e4),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",0)("max",1e4),e.R7$(2),e.Y8G("min",0)("max",1e4)}},dependencies:[c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,Ve,me.g,Ne],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleSystem),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],nn.prototype,"particleSystem$",void 0);let Cd=(()=>{class s extends Ke.n{constructor(t){super(),this.fb=t,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({id:this.fb.control(void 0),baseColor:this.fb.control(void 0),blendMode:this.fb.control(void 0),baseColorMaps:this.fb.control(void 0),baseColorFresnel:this.fb.control(void 0),opacity:this.fb.control(void 0),opacityMaps:this.fb.control(void 0),opacityFresnel:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(100),(0,I.p)(()=>this.form.valid),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.formToMaterial(t);this.writeValue(n)})}setFormValues(t){if(t?.material){const{material:n}=t;this.form.patchValue(n,{emitEvent:!1,onlySelf:!0})}}setDisabledState(t){t?this.form.disable():this.form.enable()}formToMaterial(t){const n={material:{...t,workflow:"unlit",type:"material"}};return(0,R.omitBy)(n,R.isNil)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-unlit-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:30,vars:17,consts:[[3,"formGroup"],["label","ID"],["type","text","formControlName","id",1,"input"],["label","Base Color"],["type","rgbColor","formControlName","baseColor",3,"decimal"],["label","Blend Mode"],["formControlName","blendMode",1,"input"],["value",""],["value","normal"],["value","add"],["label","Base Color Maps"],["disabled","",1,"input"],["label","Base Color Fresnel"],["label","Opacity"],["formControlName","opacity",3,"min","max","step"],["label","Opacity Maps"],["label","Opacity Fresnel"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"app-form-field",1),e.nrm(2,"input",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-color-picker-input",4),e.k0s(),e.j41(5,"app-form-field",5)(6,"select",6),e.nrm(7,"option",7),e.j41(8,"option",8),e.EFF(9,"Normal"),e.k0s(),e.j41(10,"option",9),e.EFF(11,"Add"),e.k0s()()(),e.j41(12,"app-form-field",10)(13,"textarea",11),e.EFF(14),e.nI1(15,"json"),e.k0s()(),e.j41(16,"app-form-field",12)(17,"textarea",11),e.EFF(18),e.nI1(19,"json"),e.k0s()(),e.j41(20,"app-form-field",13),e.nrm(21,"app-slider",14),e.k0s(),e.j41(22,"app-form-field",15)(23,"textarea",11),e.EFF(24),e.nI1(25,"json"),e.k0s()(),e.j41(26,"app-form-field",16)(27,"textarea",11),e.EFF(28),e.nI1(29,"json"),e.k0s()()()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("decimal",!0),e.R7$(10),e.JRh(e.bMT(15,9,null==o.form.value?null:o.form.value.baseColorMaps)),e.R7$(4),e.JRh(e.bMT(19,11,null==o.form.value?null:o.form.value.baseColorFresnel)),e.R7$(3),e.Y8G("min",0)("max",1)("step",.1),e.R7$(3),e.JRh(e.bMT(25,13,null==o.form.value?null:o.form.value.opacityMaps)),e.R7$(4),e.JRh(e.bMT(29,15,null==o.form.value?null:o.form.value.opacityFresnel)))},dependencies:[c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,Z.K,Ve,bt,w.TG],changeDetection:0})}return s})(),yd=(()=>{class s extends Ke.n{constructor(t){super(),this.fb=t,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({id:this.fb.control(void 0),baseColor:this.fb.control(void 0),blendMode:this.fb.control(void 0),baseColorMaps:this.fb.control(void 0),baseColorFresnel:this.fb.control(void 0),opacity:this.fb.control(void 0),opacityMaps:this.fb.control(void 0),opacityFresnel:this.fb.control(void 0),emissive:this.fb.control(void 0),emissiveMaps:this.fb.control(void 0),emissiveFresnel:this.fb.control(void 0),ior:this.fb.control(void 0),metallic:this.fb.control(void 0),metallicMaps:this.fb.control(void 0),normalMaps:this.fb.control(void 0),occlusionMaps:this.fb.control(void 0),roughness:this.fb.control(void 0),roughnessMaps:this.fb.control(void 0),specularColor:this.fb.control(void 0),specularColorMaps:this.fb.control(void 0),specularFactor:this.fb.control(void 0),specularFactorMaps:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(100),(0,I.p)(()=>this.form.valid),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.formToMaterial(t);this.writeValue(n)})}setFormValues(t){t?.material&&this.form.patchValue(t?.material,{emitEvent:!1,onlySelf:!0})}setDisabledState(t){t?this.form.disable():this.form.enable()}formToMaterial(t){const n={material:{...t,workflow:"physical",type:"material"}};return(0,R.omitBy)(n,R.isNil)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-physical-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:49,vars:28,consts:[[3,"formGroup"],["label","ID"],["type","text","formControlName","id",1,"input"],["label","Base Color"],["type","rgbColor","formControlName","baseColor",3,"decimal"],["label","Emissive"],["type","rgbColor","formControlName","emissive",3,"decimal"],["label","Emissive Maps"],["disabled","",1,"input"],["label","Emissive Fresnel"],["label","IOR"],["type","number","formControlName","ior",1,"input"],["label","Metallic"],["type","number","formControlName","metallic",1,"input"],["label","Metallic Maps"],["label","Normal maps"],["label","Occlusion Maps"],["label","Roughness"],["type","number","formControlName","roughness",1,"input"],["label","Roughness Maps"],["label","Specular Color"],["type","rgbColor","formControlName","specularColor",3,"decimal"],["label","Specular Color Maps"],["label","Specular Factor"],["type","number","formControlName","specularFactor",1,"input"],["label","Save Factor Maps"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"app-form-field",1),e.nrm(2,"input",2),e.k0s(),e.j41(3,"app-form-field",3),e.nrm(4,"app-color-picker-input",4),e.k0s(),e.j41(5,"app-form-field",5),e.nrm(6,"app-color-picker-input",6),e.k0s(),e.j41(7,"app-form-field",7)(8,"textarea",8),e.EFF(9),e.nI1(10,"json"),e.k0s()(),e.j41(11,"app-form-field",9)(12,"textarea",8),e.EFF(13),e.nI1(14,"json"),e.k0s()(),e.j41(15,"app-form-field",10),e.nrm(16,"input",11),e.k0s(),e.j41(17,"app-form-field",12),e.nrm(18,"input",13),e.k0s(),e.j41(19,"app-form-field",14)(20,"textarea",8),e.EFF(21),e.nI1(22,"json"),e.k0s()(),e.j41(23,"app-form-field",15)(24,"textarea",8),e.EFF(25),e.nI1(26,"json"),e.k0s()(),e.j41(27,"app-form-field",16)(28,"textarea",8),e.EFF(29),e.nI1(30,"json"),e.k0s()(),e.j41(31,"app-form-field",17),e.nrm(32,"input",18),e.k0s(),e.j41(33,"app-form-field",19)(34,"textarea",8),e.EFF(35),e.nI1(36,"json"),e.k0s()(),e.j41(37,"app-form-field",20),e.nrm(38,"app-color-picker-input",21),e.k0s(),e.j41(39,"app-form-field",22)(40,"textarea",8),e.EFF(41),e.nI1(42,"json"),e.k0s()(),e.j41(43,"app-form-field",23),e.nrm(44,"input",24),e.k0s(),e.j41(45,"app-form-field",25)(46,"textarea",8),e.EFF(47),e.nI1(48,"json"),e.k0s()()()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("decimal",!0),e.R7$(2),e.Y8G("decimal",!0),e.R7$(3),e.JRh(e.bMT(10,12,null==o.form.value?null:o.form.value.emissiveMaps)),e.R7$(4),e.JRh(e.bMT(14,14,null==o.form.value?null:o.form.value.emissiveFresnel)),e.R7$(8),e.JRh(e.bMT(22,16,null==o.form.value?null:o.form.value.metallicMaps)),e.R7$(4),e.JRh(e.bMT(26,18,null==o.form.value?null:o.form.value.normalMaps)),e.R7$(4),e.JRh(e.bMT(30,20,null==o.form.value?null:o.form.value.occlusionMaps)),e.R7$(6),e.JRh(e.bMT(36,22,null==o.form.value?null:o.form.value.roughnessMaps)),e.R7$(3),e.Y8G("decimal",!0),e.R7$(3),e.JRh(e.bMT(42,24,null==o.form.value?null:o.form.value.specularColorMaps)),e.R7$(6),e.JRh(e.bMT(48,26,null==o.form.value?null:o.form.value.specularFactorMaps)))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.j4,c.JD,Z.K,bt,w.TG],changeDetection:0})}return s})(),kd=(()=>{class s extends Ke.n{constructor(t){super(),this.fb=t,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){const{baseColor:t,alpha:n}=pe.DT,{r:o,g:a,b:r}=t;this.form=this.fb.group({material:this.fb.group({color:this.fb.control([o,a,r,n])}),textures:this.fb.control(void 0)})}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(100),(0,I.p)(()=>this.form.valid),(0,O.F)((t,n)=>(0,R.isEqual)(t,n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const n=this.formToMaterial(t);this.writeValue(n)})}setFormValues(t){const n=t?this.materialToForm(t):null;this.form.patchValue(n,{emitEvent:!1,onlySelf:!0})}setDisabledState(t){t?this.form.disable():this.form.enable()}formToMaterial(t){const{material:n,textures:o}=t,{color:a}=n,[r,p,x,N]=a;return{material:{baseColor:{r,g:p,b:x},alpha:N},textures:o}}materialToForm(t){const{material:n,textures:o}=t,{alpha:a,baseColor:r}=n,{r:p,g:x,b:N}=r;return{material:{color:[p,x,N,a??pe.DT.alpha]},textures:o}}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-legacy-material-form"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:3,vars:3,consts:[[3,"formGroup"],["formGroupName","material"],["type","rgba","formControlName","color",3,"decimal","alpha"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.qex(1,1),e.nrm(2,"app-color-picker-input",2),e.bVm(),e.k0s()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("decimal",!0)("alpha",!0))},dependencies:[c.BC,c.cb,c.j4,c.JD,c.$R,bt],changeDetection:0})}return s})();function xd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleDeleteClick())}),e.EFF(1," Delete Material "),e.k0s()}}function Ed(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-panel")(1,"button",8),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.createDefaultMaterial())}),e.EFF(2," Create Default Material "),e.k0s()()}}function wd(s,i){1&s&&(e.j41(0,"app-panel",13),e.nrm(1,"app-edit-legacy-material-form",14),e.k0s())}function Fd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(t);const o=e.XpG(4);return e.Njj(o.convertMaterialClick(o.form.value.unlitMaterial))}),e.EFF(1," Convert Material "),e.k0s()}}function Rd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){e.eBV(t);const o=e.XpG(4);return e.Njj(o.convertMaterialClick(o.form.value.physicalMaterial))}),e.EFF(1," Convert Material "),e.k0s()}}function Pd(s,i){if(1&s&&(e.j41(0,"div",18)(1,"p",19),e.EFF(2,' Note: This material is referenced by a "materialId", the values below are read-only. Click "Convert Materia" to convert to an inline material definition (editable). '),e.k0s(),e.DNE(3,Fd,2,0,"button",20)(4,Rd,2,0,"button",20),e.k0s()),2&s){const t=e.XpG(3);e.R7$(3),e.Y8G("ngIf",t.form.value.unlitMaterial),e.R7$(),e.Y8G("ngIf",t.form.value.physicalMaterial)}}function jd(s,i){if(1&s&&(e.j41(0,"app-panel",15),e.nrm(1,"input",16),e.DNE(2,Pd,5,2,"div",17),e.k0s()),2&s){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.form.value.unlitMaterial||t.form.value.physicalMaterial)}}function Md(s,i){1&s&&(e.j41(0,"app-panel",21),e.nrm(1,"app-edit-unlit-material-form",22),e.k0s())}function Id(s,i){1&s&&(e.j41(0,"app-panel",23),e.nrm(1,"app-edit-physical-material-form",24),e.k0s())}function Nd(s,i){if(1&s&&(e.qex(0),e.DNE(1,wd,2,0,"app-panel",9)(2,jd,3,1,"app-panel",10)(3,Md,2,0,"app-panel",11)(4,Id,2,0,"app-panel",12),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.form.value.legacyMaterial),e.R7$(),e.Y8G("ngIf",t.form.value.materialId),e.R7$(),e.Y8G("ngIf",t.form.value.unlitMaterial),e.R7$(),e.Y8G("ngIf",t.form.value.physicalMaterial)}}class on{constructor(i,t,n,o,a){this.store=i,this.fb=t,this.changeRef=n,this.engineService=o,this.dialogService=a,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.fb.group({materialId:this.fb.control(null),legacyMaterial:this.fb.control(null),unlitMaterial:this.fb.control(null),physicalMaterial:this.fb.control(null)})}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(100),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,Qi.E)(this.particleSystem$),(0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{const{materialId:n,legacyMaterial:o,unlitMaterial:a,physicalMaterial:r}=i,p={...(0,pe.EA)(t),...n?{materialId:n}:{...o,...a,...r}};this.store.dispatch(new le.u.UpdateParticleSystem(t.id,p))})}initParticleSystemListeners(){this.particleSystem$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,O.F)((i,t)=>(0,R.isEqual)(i,t))).subscribe(i=>{(0,we.bF)(i)?(this.activeMaterialSystem=i,this.setLegacyMaterial(i)):(0,we.Xr)(i)?(this.activeMaterialSystem=i,this.setMaterialReference(i.materialId)):(0,we.kC)(i)?(this.activeMaterialSystem=i,this.setParticleMaterial(i.material)):(this.activeMaterialSystem=null,this.setEmptyMaterial()),this.changeRef.markForCheck()})}createDefaultMaterial(){const t={...this.store.selectSnapshot(G.B.getSelectedParticleSystem),material:pe.DT};this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t))}handleDeleteClick(){this.dialogService.openConfirmDialog({data:{titleText:"Delete Material",bodyText:"Are you sure you want to delete this material?",confirmText:"Delete",confirmColor:"warn"}}).afterClosed().pipe((0,be.s)(1),(0,Qi.E)(this.particleSystem$),(0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{if(i){const n=(0,pe.EA)(t);this.store.dispatch(new le.u.UpdateParticleSystem(t.id,n))}})}convertMaterialClick(i){const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem),n={...(0,pe.EA)(t),...i};this.store.dispatch(new le.u.UpdateParticleSystem(t.id,n))}setMaterialReference(i){this.engineService.server.getAsset("material",i).then(t=>{this.setParticleMaterial(t,i),this.changeRef.markForCheck()})}setParticleMaterial(i,t){let n,o;switch(i.workflow){case"physical":o={material:{...i,id:t??i.id}};break;case"unlit":n={material:{...i,id:t??i.id}}}this.form.setValue({materialId:t??null,legacyMaterial:null,unlitMaterial:n??null,physicalMaterial:o??null})}setLegacyMaterial(i){const{material:t,textures:n}=i;this.form.setValue({materialId:null,legacyMaterial:{material:t,textures:n},unlitMaterial:null,physicalMaterial:null})}setEmptyMaterial(){this.form.setValue({materialId:null,legacyMaterial:null,unlitMaterial:null,physicalMaterial:null})}static#e=this.\u0275fac=function(t){return new(t||on)(e.rXU(l.il),e.rXU(c.ok),e.rXU(e.gRc),e.rXU(fi.y),e.rXU(Xe.o))};static#t=this.\u0275cmp=e.VBU({type:on,selectors:[["app-edit-particle-system-material-form"]],decls:9,vars:6,consts:[["actionsMenu","matMenu"],[3,"label","formGroup"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click",4,"ngIf"],[4,"ngIf"],["mat-menu-item","",3,"click"],["app-button","","buttonTheme","dark","buttonType","outline",1,"w-full",3,"click"],["label","Legacy Material",4,"ngIf"],["label","Material ID",4,"ngIf"],["label","Unlit Material",4,"ngIf"],["label","Physical Material",4,"ngIf"],["label","Legacy Material"],["formControlName","legacyMaterial"],["label","Material ID"],["type","text","formControlName","materialId",1,"input"],["class","my-2",4,"ngIf"],[1,"my-2"],[1,"my-2","text-sm","font-semibold","text-red-700"],["app-button","","buttonTheme","dark","buttonType","outline","class","w-full",3,"click",4,"ngIf"],["label","Unlit Material"],["formControlName","unlitMaterial"],["label","Physical Material"],["formControlName","physicalMaterial"]],template:function(t,n){if(1&t&&(e.j41(0,"app-portal-column",1)(1,"div",2)(2,"button",3),e.nrm(3,"app-icon",4),e.k0s(),e.j41(4,"mat-menu",null,0),e.DNE(6,xd,2,0,"button",5),e.k0s()(),e.DNE(7,Ed,3,0,"app-panel",6)(8,Nd,5,4,"ng-container",6),e.k0s()),2&t){const o=e.sdS(5);e.Y8G("label","Material")("formGroup",n.form),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(4),e.Y8G("ngIf",n.activeMaterialSystem),e.R7$(),e.Y8G("ngIf",!n.activeMaterialSystem),e.R7$(),e.Y8G("ngIf",n.activeMaterialSystem)}},dependencies:[w.bT,c.me,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,X.R,me.g,Ne,Cd,yd,kd],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleSystem),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],on.prototype,"particleSystem$",void 0);const Oo=()=>[];function Gd(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.loadCreators(o))}),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("label","Creators ("+t.length+")")("hint",n.formatHint(t))}}function $d(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.loadUpdaters(o))}),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("label","Updaters ("+t.length+")")("hint",n.formatHint(t))}}function Od(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",15),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.loadConstraints(o))}),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("label","Constraints ("+t.length+")")("hint",n.formatHint(t))}}class sn{constructor(i,t,n,o,a,r,p){this.formBuilder=i,this.store=t,this.actions=n,this.dialogService=o,this.particleSystemsService=a,this.eumPrintPipe=r,this.portalComponent=p,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initParticleSystemListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({name:[""]}),this.setValues((0,pe.Vs)())}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(125),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(G.B.getSelectedParticleSystem);i.name!==t.name&&(t.name=i.name,this.store.dispatch(new le.u.UpdateParticleSystem(t.id,t)))})}initParticleSystemListeners(){this.particleSystem$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setValues(i)}),this.actions.pipe((0,l.xi)(le.u.DuplicateParticleSystemSuccess),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.store.dispatch(new le.u.SelectParticleSystem(i.id))})}setValues(i){this.form&&this.form.patchValue(i,{emitEvent:!1,onlySelf:!0})}handleDuplicateClick(){this.duplicateParticleSystem()}handleResetClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.dialogService.openConfirmDialog({data:{titleText:"Reset Particle System",bodyText:`Would you like to reset Particle System "${i.id}"?`,confirmText:"Remove"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.resetParticleSystem()})}handleRemoveClick(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystem);this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle System",bodyText:`Would you like to remove Particle System "${i.id}" from this chapter?`,confirmText:"Remove"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.removeParticleSystem()})}formatHint(i){return i.map(t=>this.eumPrintPipe.transform(t.type)).join(", ")}loadBasic(i){i.loadComponent(nn)}loadMaterial(i){i.loadComponent(on)}loadSprites(i){i.loadComponent(Hi)}loadProperties(i){i.loadComponent(Lp)}loadCreators(i){i.loadComponent(bi)}loadConstraints(i){i.loadComponent(_i)}loadUpdaters(i){i.loadComponent(vi)}duplicateParticleSystem(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystemId),t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.duplicateParticleSystem(i,t)}resetParticleSystem(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystemId);this.particleSystemsService.resetParticleSystem(i)}removeParticleSystem(){const i=this.store.selectSnapshot(G.B.getSelectedParticleSystemId),t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.removeChapterParticleSystem(i,t),this.store.dispatch(new le.u.SelectParticleSystem(null)),this.portalComponent.back()}static#e=this.\u0275fac=function(t){return new(t||sn)(e.rXU(c.ze),e.rXU(l.il),e.rXU(l.En),e.rXU(Xe.o),e.rXU(Ct.c),e.rXU(yt),e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:sn,selectors:[["app-edit-particle-systems-form"]],features:[e.Jv_([yt])],decls:30,vars:17,consts:[["actionsMenu","matMenu"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["label","Name"],["type","text","formControlName","name","data-test","particleSystemName",1,"input"],["label","ID"],[1,"text-xs"],["label","Quantity",3,"itemClick"],["label","Material",3,"itemClick"],["label","Sprites",3,"itemClick"],["label","Properties",3,"itemClick"],[3,"label","hint","itemClick",4,"ngIf"],[3,"itemClick","label","hint"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column")(1,"div",1)(2,"button",2),e.nrm(3,"app-icon",3),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",4),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleDuplicateClick())}),e.EFF(7,"Duplicate"),e.k0s(),e.j41(8,"button",4),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick())}),e.EFF(9,"Reset to default"),e.k0s(),e.j41(10,"button",4),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveClick())}),e.EFF(11,"Remove"),e.k0s()()(),e.qex(12),e.j41(13,"app-panel",5)(14,"app-form-field",6),e.nrm(15,"input",7),e.k0s(),e.j41(16,"app-form-field",8)(17,"span",9),e.EFF(18),e.nI1(19,"async"),e.k0s()()(),e.j41(20,"app-portal-item",10),e.bIt("itemClick",function(r){return e.eBV(o),e.Njj(n.loadBasic(r))}),e.k0s(),e.j41(21,"app-portal-item",11),e.bIt("itemClick",function(r){return e.eBV(o),e.Njj(n.loadMaterial(r))}),e.k0s(),e.j41(22,"app-portal-item",12),e.bIt("itemClick",function(r){return e.eBV(o),e.Njj(n.loadSprites(r))}),e.k0s(),e.j41(23,"app-portal-item",13),e.bIt("itemClick",function(r){return e.eBV(o),e.Njj(n.loadProperties(r))}),e.k0s(),e.DNE(24,Gd,1,2,"app-portal-item",14),e.nI1(25,"async"),e.DNE(26,$d,1,2,"app-portal-item",14),e.nI1(27,"async"),e.DNE(28,Od,1,2,"app-portal-item",14),e.nI1(29,"async"),e.bVm(),e.k0s()}if(2&t){let o,a,r,p;const x=e.sdS(5);e.R7$(2),e.Y8G("matMenuTriggerFor",x),e.R7$(11),e.Y8G("formGroup",n.form),e.R7$(5),e.JRh(null==(o=e.bMT(19,6,n.particleSystem$))?null:o.id),e.R7$(6),e.Y8G("ngIf",(null==(a=e.bMT(25,8,n.particleSystem$))?null:a.creators)||e.lJ4(14,Oo)),e.R7$(2),e.Y8G("ngIf",(null==(r=e.bMT(27,10,n.particleSystem$))?null:r.updaters)||e.lJ4(15,Oo)),e.R7$(2),e.Y8G("ngIf",(null==(p=e.bMT(29,12,n.particleSystem$))?null:p.constraints)||e.lJ4(16,Oo))}},dependencies:[w.bT,c.me,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,me.g,Ji,Ne,w.Jj],changeDetection:0})}function Vd(s,i){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Apply Existing "),e.k0s()),2&s){e.XpG();const t=e.sdS(26);e.Y8G("matMenuTriggerFor",t)}}function Ld(s,i){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Duplicate Existing "),e.k0s()),2&s){e.XpG();const t=e.sdS(29);e.Y8G("matMenuTriggerFor",t)}}function Yd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleRemoveAllAssignClick())}),e.EFF(1," Remove All "),e.k0s()}}function zd(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-portal-item",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleParticleSystemClick(o))}),e.j41(1,"div",24)(2,"button",25),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleToggleParticleSystemVisible(o))}),e.nrm(3,"app-icon",26),e.k0s(),e.j41(4,"button",27),e.nrm(5,"app-icon",8),e.k0s(),e.j41(6,"mat-menu",null,4)(8,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleDuplicateSystemClick(o))}),e.EFF(9,"Duplicate"),e.k0s(),e.j41(10,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleResetParticleClick(o))}),e.EFF(11,"Reset"),e.k0s(),e.j41(12,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleRemoveAssignClick(o))}),e.EFF(13,"Remove"),e.k0s()()()()}if(2&s){const t=i.$implicit,n=e.sdS(7),o=e.XpG(2);e.Y8G("label",o.getSystemLabel(t))("active",o.isSystemVisible(t)),e.R7$(3),e.Y8G("icon",o.isSystemVisible(t)?"eye":"eye-slash"),e.R7$(),e.Y8G("matMenuTriggerFor",n)}}function Xd(s,i){if(1&s&&(e.qex(0),e.DNE(1,zd,14,4,"app-portal-item",22),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.assignedParticleSystem)}}function Qd(s,i){1&s&&(e.j41(0,"div",28),e.EFF(1," There are no particle systems in this chapter. "),e.k0s())}function qd(s,i){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Apply Existing "),e.k0s()),2&s){e.XpG();const t=e.sdS(26);e.Y8G("matMenuTriggerFor",t)}}function Hd(s,i){if(1&s&&(e.j41(0,"button",21),e.EFF(1," Duplicate Existing "),e.k0s()),2&s){e.XpG();const t=e.sdS(29);e.Y8G("matMenuTriggerFor",t)}}function Wd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleApplyParticleClick(o))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit;e.R7$(),e.SpI(" ",t.id," ")}}function Jd(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleDuplicacteParticleClick(o))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit;e.R7$(),e.SpI(" ",t.id," ")}}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getSelectedParticleSystem),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],sn.prototype,"particleSystem$",void 0);class an{constructor(i,t,n,o,a,r){this.store=i,this.actions=t,this.changeRef=n,this.particleSystemsService=o,this.dialogService=a,this.portalComponent=r,this.particleSystems=[],this.assignedParticleSystem=[],this.unassignedParticleSystem=[],this.particleSystemSelected=new e.bkB,this.chapterParticles=[],this.ngUnsubscribe=new f.B}ngOnInit(){this.initParticleListListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initParticleListListeners(){const i=this.store.select(G.B.getParticleSystemsList),t=this.store.select(j.N.getSelectedChapterId),n=this.store.select(G.B.getAssignedParticleSystems);(0,C.z)(i,n,t).pipe((0,I.p)(([o,a,r])=>!!r),(0,y.Q)(this.ngUnsubscribe)).subscribe(([o,a,r])=>{const p=a[r]||[];this.particleSystems=o,this.assignedParticleSystem=p.map(x=>o.find(N=>N.id===x)),this.unassignedParticleSystem=o.filter(x=>!p.includes(x.id)),this.changeRef.markForCheck()}),this.actions.pipe((0,l.xi)(le.u.UnassignParticle),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const o=this.store.selectSnapshot(G.B.getParticleSystems),a=this.store.selectSnapshot(G.B.getAssignedParticleSystems),r=Object.keys(o),p=Object.values(a).reduce((N,z)=>N.concat(z),[]),x=r.filter(N=>!p.includes(N));x.length>0&&(x.forEach(N=>{this.store.dispatch(new le.u.DeleteParticleSystem(N))}),this.changeRef.markForCheck())})}handleParticleSystemClick(i){this.particleSystemSelected.emit(i),this.store.dispatch(new le.u.SelectParticleSystem(i.id)),this.portalComponent.loadComponent(sn)}handleDuplicateSystemClick(i){this.duplicateParticleSystem(i)}handleRemoveAllAssignClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle Systems",bodyText:"Would you like to remove all Particle Systems from this chapter?",confirmText:"Remove All"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{i&&this.removeAllParticleAssignments()})}handleRemoveAssignClick(i){this.dialogService.openConfirmDialog({data:{titleText:"Remove Particle System",bodyText:`Would you like to remove Particle System "${i.id}" from this chapter?`,confirmText:"Remove"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.removeChapterParticleSystem(i.id)})}handleCreateParticleClick(){this.createParticleSystem()}handleApplyParticleClick(i){this.addChapterParticleSystem(i.id)}handleDuplicacteParticleClick(i){this.duplicateParticleSystem(i)}handleResetParticleClick(i){this.dialogService.openConfirmDialog({data:{titleText:"Reset Particle System",bodyText:`Would you like to reset Particle System "${i.id}"?`,confirmText:"Reset"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t&&this.resetParticleSystem(i)})}handleToggleParticleSystemVisible(i){this.toggleParticleSystemVisible(i)}isSystemVisible(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);return this.particleSystemsService.isParticleSystemVisible(i.id,t)}getSystemLabel(i){let t;return t=i.name?`**${i.name}**\n\n${i.id}`:i.id,t}createParticleSystem(){const i=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.createParticleSystem(i)}resetParticleSystem(i){this.particleSystemsService.resetParticleSystem(i.id)}removeAllParticleAssignments(){const i=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.removeAllChapterParticleSystem(i)}addChapterParticleSystem(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.addChapterParticleSystem(i,t)}removeChapterParticleSystem(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.removeChapterParticleSystem(i,t)}duplicateParticleSystem(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.duplicateParticleSystem(i.id,t)}toggleParticleSystemVisible(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.particleSystemsService.toggleParticleSystemVisible(i.id,t)}static#e=this.\u0275fac=function(t){return new(t||an)(e.rXU(l.il),e.rXU(l.En),e.rXU(e.gRc),e.rXU(Ct.c),e.rXU(Xe.o),e.rXU(nt))};static#t=this.\u0275cmp=e.VBU({type:an,selectors:[["app-edit-particle-systems-list"]],outputs:{particleSystemSelected:"particleSystemSelected"},decls:32,vars:13,consts:[["particleListSystemsMenu","matMenu"],["particleCreateSystemsMenu","matMenu"],["applySystemsMenu","matMenu"],["duplicateSystemsMenu","matMenu"],["systemActions","matMenu"],["label","Particle Systems"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngIf"],[1,"list"],[1,"list__content"],[4,"ngIf"],[1,"flex","flex-col","items-center","my-2"],["class","list__message text-xs text-center my-4",4,"ngIf"],["app-button","","buttonType","outline","data-test","addParticleSystemButton",3,"matMenuTriggerFor"],["icon","angle-down"],["mat-menu-item","","data-test","createNewSystem",3,"click"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"matMenuTriggerFor"],["data-test","openParticleOptions",3,"label","active","click",4,"ngFor","ngForOf"],["data-test","openParticleOptions",3,"click","label","active"],["item-actions",""],["app-button","","buttonSize","xs",3,"click"],[3,"icon"],["app-button","","buttonSize","xs",3,"matMenuTriggerFor"],[1,"list__message","text-xs","text-center","my-4"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",5)(1,"div",6)(2,"button",7),e.nrm(3,"app-icon",8),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleCreateParticleClick())}),e.EFF(7,"Create new"),e.k0s(),e.DNE(8,Vd,2,1,"button",10)(9,Ld,2,1,"button",10)(10,Yd,2,0,"button",11),e.k0s()(),e.j41(11,"div",12)(12,"div",13),e.DNE(13,Xd,2,1,"ng-container",14),e.j41(14,"div",15),e.DNE(15,Qd,2,0,"div",16),e.j41(16,"button",17),e.EFF(17," Add Particle System "),e.nrm(18,"app-icon",18),e.k0s(),e.j41(19,"mat-menu",null,1)(21,"button",19),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleCreateParticleClick())}),e.EFF(22," Create new "),e.k0s(),e.DNE(23,qd,2,1,"button",10)(24,Hd,2,1,"button",10),e.k0s()(),e.j41(25,"mat-menu",null,2),e.DNE(27,Wd,2,1,"button",20),e.k0s(),e.j41(28,"mat-menu",null,3),e.DNE(30,Jd,2,1,"button",20),e.nI1(31,"async"),e.k0s()()()()}if(2&t){const o=e.sdS(5),a=e.sdS(20);e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.Y8G("ngIf",n.unassignedParticleSystem.length),e.R7$(),e.Y8G("ngIf",n.particleSystems.length),e.R7$(),e.Y8G("ngIf",n.assignedParticleSystem.length>0),e.R7$(3),e.Y8G("ngIf",n.assignedParticleSystem.length>0),e.R7$(2),e.Y8G("ngIf",0===n.assignedParticleSystem.length),e.R7$(),e.Y8G("matMenuTriggerFor",a),e.R7$(7),e.Y8G("ngIf",n.unassignedParticleSystem.length),e.R7$(),e.Y8G("ngIf",n.particleSystems.length),e.R7$(3),e.Y8G("ngForOf",n.unassignedParticleSystem),e.R7$(3),e.Y8G("ngForOf",e.bMT(31,11,n.particleSystems$))}},dependencies:[w.Sq,w.bT,D.kk,D.fb,D.Cp,Y.Q,X.R,Ji,Ne,w.Jj],styles:[".list[_ngcontent-%COMP%]{height:100%}.list__content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.list__message[_ngcontent-%COMP%]{color:#61779e}"],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(G.B.getParticleSystemsList),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],an.prototype,"particleSystems$",void 0);class Wn{}var Jn=v(3266);function Kd(s,i){1&s&&(e.j41(0,"mat-checkbox",6),e.EFF(1,"Moving Forwards"),e.k0s())}function Zd(s,i){1&s&&(e.j41(0,"mat-checkbox",7),e.EFF(1,"Moving Backwards"),e.k0s())}function em(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleShowClick(o.transition))}),e.EFF(1," Preview "),e.k0s()}}function tm(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleRemovePositionClick())}),e.EFF(1," Remove "),e.k0s()}}function im(s,i){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"app-form-field",8),e.nrm(2,"app-color-picker-input",9),e.k0s(),e.j41(3,"app-form-field",10)(4,"div",11),e.nrm(5,"input",12),e.j41(6,"app-button-group")(7,"button",13),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleSecondClick(1))}),e.EFF(8," 1s "),e.k0s(),e.j41(9,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleSecondClick(2))}),e.EFF(10," 2s "),e.k0s(),e.j41(11,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleSecondClick(3))}),e.EFF(12," 3s "),e.k0s()()()(),e.j41(13,"app-form-field",15)(14,"button",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleRecordPositionClick())}),e.EFF(15," Capture Position "),e.k0s(),e.j41(16,"app-button-group",17),e.DNE(17,em,2,0,"button",18)(18,tm,2,0,"button",18),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(7),e.Y8G("uppercase",!1),e.R7$(2),e.Y8G("uppercase",!1),e.R7$(2),e.Y8G("uppercase",!1),e.R7$(6),e.Y8G("ngIf",t.transition.camera),e.R7$(),e.Y8G("ngIf",t.transition.camera)}}let nm=(()=>{class s{get transition(){return this._transition}set transition(t){(0,R.isEqual)(t,this._transition)||(this._transition={...t},this.setFormValues(t),this.transitionChange.emit(this.transition),this.changeDetectorRef.markForCheck())}get settings(){return this._settings}set settings(t){(0,R.isEqual)(t,this._settings)||(this._settings={...this._settings,...t},this.changeDetectorRef.markForCheck())}constructor(t,n,o,a,r){this.formBuilder=t,this.store=n,this.cameraService=o,this.matSnackBar=a,this.changeDetectorRef=r,this._transition=new Wn,this.transitionChange=new e.bkB,this._settings={onNext:!0,onPrevious:!0},this.ngUnsubscribe=new f.B;const p=new Wn;this.form=this.formBuilder.group({fadeColor:"",duration:0,onNext:p.onNext,onPrevious:p.onPrevious})}ngOnInit(){this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>this.handleFormChanges(t))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleShowClick(t){this.store.dispatch(new Ft.Ih(t.camera,!0,t.duration))}handleRecordPositionClick(){this.transition={...this.transition,camera:this.cameraService.getCamera()},this.matSnackBar.open("Position captured")}handleRemovePositionClick(){this.transition={...this.transition,camera:null},this.matSnackBar.open("Position removed")}handleFormChanges(t){const n={...this.transition,fadeColor:t.fadeColor,onNext:t.onNext,onPrevious:t.onPrevious,duration:t.duration};this.transition=n}handleSecondClick(t){this.form.patchValue({duration:t})}setFormValues(t){const n={duration:2,fadeColor:"",onNext:!1,onPrevious:!1,...t};this.form.setValue({fadeColor:n.fadeColor,duration:n.duration,onNext:n.onNext,onPrevious:n.onPrevious})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(l.il),e.rXU(Jn.j),e.rXU(Qe.UG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-transition-form"]],inputs:{transition:"transition",settings:"settings"},outputs:{transitionChange:"transitionChange"},decls:6,vars:4,consts:[["autocomplete","off",3,"formGroup"],["label","Enable"],[1,"flex","flex-col","text-xs"],["formControlName","onNext","data-test","movingForwardsItem",4,"ngIf"],["formControlName","onPrevious","data-test","movingBackwardsItem",4,"ngIf"],[4,"ngIf"],["formControlName","onNext","data-test","movingForwardsItem"],["formControlName","onPrevious","data-test","movingBackwardsItem"],["label","Fade"],["formControlName","fadeColor","dataTestAttributeVal","transitionColorPicker"],["label","Duration (Seconds)"],[1,"flex"],["type","number","min","0","step",".1","formControlName","duration","required","",1,"w-1/4","mr-2","input"],["app-button","","buttonType","outline","data-test","transitionOneSecondButton",3,"click","uppercase"],["app-button","","buttonType","outline",3,"click","uppercase"],["label","Position"],["app-button","","buttonType","outline","buttonSize","sm","data-test","transitionCapturePosition",1,"w-full","mb-2",3,"click"],["render","block"],["app-button","","buttonType","outline","buttonSize","sm","class","w-full",3,"click",4,"ngIf"],["app-button","","buttonType","outline","buttonSize","sm",1,"w-full",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"form",0)(1,"app-form-field",1)(2,"div",2),e.DNE(3,Kd,2,0,"mat-checkbox",3)(4,Zd,2,0,"mat-checkbox",4),e.k0s()(),e.DNE(5,im,19,5,"div",5),e.k0s()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(3),e.Y8G("ngIf",o.settings.onNext),e.R7$(),e.Y8G("ngIf",o.settings.onPrevious),e.R7$(),e.Y8G("ngIf",o.settings.onNext&&o.transition.onNext||o.settings.onPrevious&&o.transition.onPrevious))},dependencies:[w.bT,c.qT,c.me,c.Q0,c.BC,c.cb,c.YS,c.VZ,c.j4,c.JD,Ae.So,Y.Q,gi,Z.K,bt],changeDetection:0})}return s})();const am=()=>({onNext:!0,onPrevious:!1}),rm=()=>({onNext:!1,onPrevious:!0});function lm(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-tabs",2)(1,"app-tab",3)(2,"div",4)(3,"app-edit-transition-form",5),e.bIt("transitionChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleTransitionChange(o,"post"))}),e.k0s()()(),e.j41(4,"app-tab",6)(5,"div",4)(6,"app-edit-transition-form",5),e.bIt("transitionChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleTransitionChange(o,"pre"))}),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(3),e.Y8G("settings",e.lJ4(4,am))("transition",t.postTransition),e.R7$(3),e.Y8G("settings",e.lJ4(5,rm))("transition",t.preTransition)}}class rn{constructor(i,t){this.changeDetectorRef=i,this.store=t,this.ngUnsubscribe=new f.B}ngOnInit(){this.chapter$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.postTransition=(0,R.get)(i,"transitions.post")||new Wn,this.preTransition=(0,R.get)(i,"transitions.pre")||new Wn,this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleTransitionChange(i,t){const n=this.store.selectSnapshot(j.N.getSelectedChapter);this.store.dispatch(new U.sN(n.id,i,t))}static#e=this.\u0275fac=function(t){return new(t||rn)(e.rXU(e.gRc),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:rn,selectors:[["app-edit-transition"]],decls:4,vars:3,consts:[["label","Transitions"],["tabSize","small","tabTheme","dark",4,"ngIf"],["tabSize","small","tabTheme","dark"],["data-test","transitionPostChapter","label","Post-Chapter"],[1,"pt-1"],[3,"transitionChange","settings","transition"],["data-test","transitionPreChapter","label","Pre-Chapter"]],template:function(t,n){1&t&&(e.j41(0,"app-portal-column",0)(1,"app-panel"),e.DNE(2,lm,7,6,"app-tabs",1),e.nI1(3,"async"),e.k0s()()),2&t&&(e.R7$(2),e.Y8G("ngIf",e.bMT(3,1,n.chapter$)))},dependencies:[w.bT,jt.j,Mt.O,me.g,Ne,nm,w.Jj],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(j.N.getSelectedChapter),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],rn.prototype,"chapter$",void 0);var Kn=v(11724);let cm=(()=>{class s{constructor(t,n){this.formBuilder=t,this.store=n,this.transparencyModes=Kn.TransparencyModeEnum,this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({mode:[Kn.TransparencyModeEnum.Alpha]})}ngOnInit(){this.store.select(j.N.getSelectedChapterId).pipe((0,ve.T)(()=>this.store.selectSnapshot(j.N.getSelectedChapter)),(0,I.p)(t=>!(0,R.isNil)(t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setFormValue(t.transparencyMode)}),this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.setTransparencyMode(t.mode)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValue(t){this.form.setValue({mode:t},{emitEvent:!1})}setTransparencyMode(t,n=!0){this.store.dispatch(new ie._h(t)),n&&this.setChapterTransparencyMode(t)}setChapterTransparencyMode(t){const n=this.store.selectSnapshot(j.N.getSelectedChapter);this.store.dispatch(new U.Nw(n.id,t))}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-transparency-mode"]],decls:12,vars:6,consts:[["label","Transparency Mode"],[3,"open"],[3,"formGroup"],["formControlName","mode","data-test","transparencyModeSelect",1,"input"],[3,"value"]],template:function(n,o){1&n&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1)(2,"form",2)(3,"select",3)(4,"option",4),e.EFF(5,"Alpha (Default)"),e.k0s(),e.j41(6,"option",4),e.EFF(7,"Improved Alpha"),e.k0s(),e.j41(8,"option",4),e.EFF(9,"Add Alpha"),e.k0s(),e.j41(10,"option",4),e.EFF(11,"Alpha To Coverage"),e.k0s()()()()()),2&n&&(e.R7$(),e.Y8G("open",!0),e.R7$(),e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("value",o.transparencyModes.Alpha),e.R7$(2),e.Y8G("value",o.transparencyModes.ImprovedAlpha),e.R7$(2),e.Y8G("value",o.transparencyModes.AddAlpha),e.R7$(2),e.Y8G("value",o.transparencyModes.AlphaToCoverage))},dependencies:[c.qT,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,me.g,Ne],changeDetection:0})}return s})();var Pe=function(s){return s.Blur="blur",s.RadialBlur="radialBlur",s.FXAA="fxaa",s.SSAO="sao",s.DOF="dof",s.GroundShadow="groundShadow",s}(Pe||{});const kt={[Pe.SSAO]:{effect:Pe.SSAO,sampleRadius:1.2,intensity:50,bias:.1,scale:.3,cutoff:0},[Pe.Blur]:{effect:Pe.Blur,blur:.1},[Pe.RadialBlur]:{effect:Pe.RadialBlur,radius:.1,center:[0,0],blur:.25},[Pe.DOF]:{effect:Pe.DOF,focusStart:0,focusEnd:5,blur:.5},[Pe.FXAA]:{effect:Pe.FXAA},[Pe.GroundShadow]:{effect:Pe.GroundShadow,blur:.5,opacity:1,xPos:0,yPos:0,zPos:0,size:10}};function ln(s,i){const t=kt[s],n=Object.keys(t).reduce((o,a)=>{const r=i[a];return typeof r<"u"&&(o[a]=r),o},{});return{effect:s,...t,...n}}const cn={"fog.enabled":!1,"fog.density":1,"fog.color":[.96,.96,.96],"fog.start":0,"fog.end":50,"fog.mode":Kn.FogModeNumericEnum.Linear,"fog.min":0,"fog.max":.75},pm=ae.T.rgbToHex(cn["fog.color"],!0);let dm=(()=>{class s{constructor(t,n){this.formBuilder=t,this.store=n,this.fogModes=Kn.FogModeNumericEnum,this.ngUnsubscribe=new f.B,this._defaultChapterEffects=[],this._defaultChapterProperties={},this.form=this.formBuilder.group({saoEnabled:!1,blurEnabled:!1,radialBlurEnabled:!1,dofEnabled:!1,fogEnabled:!1,groundShadowEnabled:!1,sao:this.formBuilder.group({...kt.sao}),blur:this.formBuilder.group({...kt.blur}),radialBlur:this.formBuilder.group({...kt.radialBlur,center:this.formBuilder.array([...kt.radialBlur.center])}),dof:this.formBuilder.group({...kt.dof}),fog:this.formBuilder.group({...cn,"fog.color":pm}),groundShadow:this.formBuilder.group({...kt.groundShadow})})}ngOnInit(){this.initEvents()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initEvents(){this.store.select(j.N.getSelectedChapterId).pipe((0,ve.T)(()=>this.store.selectSnapshot(j.N.getSelectedChapter)),(0,I.p)(t=>!(0,R.isNil)(t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this._defaultChapterEffects=(t.customData||{postprocess:[]}).postprocess||[],this._defaultChapterProperties=t.properties||{},this.setFormValues(this._defaultChapterEffects,this._defaultChapterProperties)}),this.form.valueChanges.pipe((0,K.B)(100),(0,O.F)(R.isEqual),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.handleFormChanges(t)})}handleFormChanges(t){const n=this.getEffectFormValues(t),o=this.getFogEffectFormValues(t);this.applyEffects(n,o)}setFormValues(t,n){this.clearEffectsForm(),t.forEach(o=>{this.setEffectFormValues(o,!0)}),this.setFogEffectFormValues(n)}setEffectFormValues(t,n){const o=t.effect;this.form.patchValue({[`${o}Enabled`]:n,[o]:t},{emitEvent:!1})}clearEffectsForm(){Object.values(kt).forEach(t=>{this.setEffectFormValues(t,!1)}),this.setFogEffectFormValues({...cn,"fog.enabled":!1})}getEffectFormValues(t){const n=[],{saoEnabled:o,blurEnabled:a,radialBlurEnabled:r,dofEnabled:p,groundShadowEnabled:x}=t,{sao:N,blur:z,radialBlur:W,dof:Se,groundShadow:Le}=t;return o&&n.push(ln(Pe.SSAO,N)),a&&n.push(ln(Pe.Blur,z)),r&&n.push(ln(Pe.RadialBlur,W)),p&&n.push(ln(Pe.DOF,Se)),x&&n.push(ln(Pe.GroundShadow,Le)),n.length>0&&n.push(kt.fxaa),n}setFogEffectFormValues(t){const n=this.createFogEffect(t),o=n["fog.enabled"],r=ae.T.rgbToHex(n["fog.color"],!0);this.form.patchValue({fogEnabled:o,fog:{...n,"fog.color":r}},{emitEvent:!1})}getFogEffectFormValues(t){const{fogEnabled:n,fog:o}=t;return{...this.createFogEffect(o),"fog.enabled":n}}applyEffects(t,n){const o={...n};this.store.dispatch(new ie.uM(t)),this.store.dispatch(new ie.YI(o));const a=this.store.selectSnapshot(j.N.getSelectedChapter);this.store.dispatch(new U.rT(a.id,t,o))}createFogEffect(t){const n=Object.entries(cn).reduce((a,[r,p])=>{const x=t[r];return(0,R.isNil)(x)||(a[r]=x),a},{...cn}),o=t["fog.color"];return!(0,R.isNil)(o)&&"string"==typeof o&&(n["fog.color"]=ae.T.hexToRgb(o,!0)),n}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-post-processing"]],decls:35,vars:34,consts:[["label","PostProcessing",3,"formGroup"],["label","Blur","toggleType","checkbox","formControlName","blurEnabled","formGroupName","blur","data-test","postProcessingBlur"],["label","Blur"],["formControlName","blur","data-test","postProcessingBlurInput",3,"min","max","step"],["label","Radial Blur","toggleType","checkbox","formControlName","radialBlurEnabled","formGroupName","radialBlur","data-test","postProcessingRadialBlur"],["label","Radius"],["formControlName","radius","data-test","postProcessingRadialBlurRadius",3,"min","max","step"],["formArrayName","center"],["label","Center X"],["formControlName","0","data-test","postProcessingRadialBlurCenterX",3,"min","max","step"],["label","Center Y"],["formControlName","1","data-test","postProcessingRadialBlurCenterY",3,"min","max","step"],["formControlName","blur","data-test","postProcessingRadialBlurInput",3,"min","max","step"],["label","Fog","toggleType","checkbox","formControlName","fogEnabled","formGroupName","fog","dataTestAttributeVal","fogPanel","data-test","postProcessingFog"],["label","Mode"],["formControlName","fog.mode","data-test","postProcessingFogMode",1,"input"],[3,"ngValue"],["label","Color"],["formControlName","fog.color","dataTestAttributeVal","fogColor"],["label","Density"],["formControlName","fog.density","data-test","postProcessingFogDensity",3,"min","max","step"],["label","Start"],["formControlName","fog.start","data-test","postProcessingFogStart",3,"min","max","step"],["label","End"],["formControlName","fog.end","data-test","postProcessingFogEnd",3,"min","max","step"],["label","Min"],["formControlName","fog.min","data-test","postProcessingFogMin",3,"min","max","step"],["label","Max"],["formControlName","fog.max","data-test","postProcessingFogMax",3,"min","max","step"]],template:function(n,o){1&n&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1)(2,"app-form-field",2),e.nrm(3,"app-slider",3),e.k0s()(),e.j41(4,"app-panel",4)(5,"app-form-field",5),e.nrm(6,"app-slider",6),e.k0s(),e.j41(7,"div",7)(8,"app-form-field",8),e.nrm(9,"app-slider",9),e.k0s(),e.j41(10,"app-form-field",10),e.nrm(11,"app-slider",11),e.k0s()(),e.j41(12,"app-form-field",2),e.nrm(13,"app-slider",12),e.k0s()(),e.j41(14,"app-panel",13)(15,"app-form-field",14)(16,"select",15)(17,"option",16),e.EFF(18,"Linear"),e.k0s(),e.j41(19,"option",16),e.EFF(20,"Exponential (v1)"),e.k0s(),e.j41(21,"option",16),e.EFF(22,"Exponential (v2)"),e.k0s()()(),e.j41(23,"app-form-field",17),e.nrm(24,"app-color-picker-input",18),e.k0s(),e.j41(25,"app-form-field",19),e.nrm(26,"app-slider",20),e.k0s(),e.j41(27,"app-form-field",21),e.nrm(28,"app-slider",22),e.k0s(),e.j41(29,"app-form-field",23),e.nrm(30,"app-slider",24),e.k0s(),e.j41(31,"app-form-field",25),e.nrm(32,"app-slider",26),e.k0s(),e.j41(33,"app-form-field",27),e.nrm(34,"app-slider",28),e.k0s()()()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(3),e.Y8G("min",0)("max",.25)("step",.01),e.R7$(3),e.Y8G("min",0)("max",2)("step",.1),e.R7$(3),e.Y8G("min",-1)("max",1)("step",.1),e.R7$(2),e.Y8G("min",-1)("max",1)("step",.1),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(4),e.Y8G("ngValue",o.fogModes.Linear),e.R7$(2),e.Y8G("ngValue",o.fogModes.Exponential),e.R7$(2),e.Y8G("ngValue",o.fogModes.ExponentialSquared),e.R7$(5),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",100)("step",1),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01))},dependencies:[c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,Z.K,Ve,me.g,bt,Ne],changeDetection:0})}return s})();var mm=v(53799);function fm(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-panel",3)(2,"app-form-field",4)(3,"app-slider",5),e.bIt("mouseUp",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleEndInteraction())})("blurred",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleEndInteraction())}),e.k0s()(),e.j41(4,"app-form-field",6)(5,"app-slider",7),e.bIt("mouseUp",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleEndInteraction())})("blurred",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleEndInteraction())}),e.k0s()()(),e.bVm()}if(2&s){const t=i.$implicit;e.R7$(),e.FS9("label",t.label),e.FS9("formGroupName",t.formGroupName),e.R7$(2),e.Y8G("min",0)("max",1)("step",.01),e.R7$(2),e.Y8G("min",0)("max",5)("step",.01)}}class pn{constructor(i,t,n){this.formBuilder=i,this.store=t,this.changeDetectorRef=n,this.clipDirections=[{label:"Left",formGroupName:"left"},{label:"Right",formGroupName:"right"},{label:"Top",formGroupName:"top"},{label:"Bottom",formGroupName:"bottom"},{label:"Front",formGroupName:"front"},{label:"Back",formGroupName:"back"}],this.ngUnsubscribe=new f.B}ngOnInit(){this.initForm(),this.initFormListeners(),this.initClippingPlanesListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleEndInteraction(){this.handleFormChangeEvent(this.form.value,!0)}initForm(){const i=this.store.selectSnapshot(j.N.getSelectedChapterClippingPlanes),t=this.createFormFromClips(i),n={};Object.entries(t.clippingPlanes).map(([o,a])=>{n[o]=this.formBuilder.group(a)}),this.form=this.formBuilder.group({clippingPlanesEnabled:t.clippingPlanesEnabled,clippingPlanes:this.formBuilder.group(n)})}initFormListeners(){this.form.valueChanges.pipe((0,O.F)(R.isEqual),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const n=this.store.selectSnapshot(j.N.getSelectedChapterClippingPlanes).enabled!==i.clippingPlanesEnabled;this.handleFormChangeEvent(i,n)})}initClippingPlanesListeners(){this.clippingPlanes$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,O.F)(R.isEqual),(0,In.Z)(50),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.form.setValue(this.createFormFromClips(i),{emitEvent:!1}),this.changeDetectorRef.markForCheck()})}handleFormChangeEvent(i,t){const n=this.store.selectSnapshot(j.N.getSelectedChapterId),o=this.createClipsFromForm(i);this.store.dispatch(new U.Ej(n,o,i.clippingPlanesEnabled,t))}createFormFromClips(i){const{enabled:t,clips:n}=i;return{clippingPlanesEnabled:t,clippingPlanes:Object.entries(n).reduce((a,[r,p])=>(a[r]={progress:p.progress,fadeDistance:p.fadeDistance},a),{})}}createClipsFromForm(i){const{clippingPlanesEnabled:t,clippingPlanes:n}=i;return Object.entries(n).reduce((o,[a,r])=>{const p=t&&r.progress>0,x=t&&r.fadeDistance>0,N=mm.A[a];return o[a]={...r,clipId:N,enabled:p,fade:x},o},{})}static#e=this.\u0275fac=function(t){return new(t||pn)(e.rXU(c.ze),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:pn,selectors:[["app-edit-clipping-planes"]],decls:3,vars:2,consts:[["label","Clipping Planes",3,"formGroup"],["label","Enabled","toggleType","checkbox","formControlName","clippingPlanesEnabled","formGroupName","clippingPlanes","data-test","clippingPlanesEnabledPanel"],[4,"ngFor","ngForOf"],["toggleType","none",3,"label","formGroupName"],["label","Progress"],["formControlName","progress",3,"mouseUp","blurred","min","max","step"],["label","Fade Distance"],["formControlName","fadeDistance",3,"mouseUp","blurred","min","max","step"]],template:function(t,n){1&t&&(e.j41(0,"app-portal-column",0)(1,"app-panel",1),e.DNE(2,fm,6,8,"ng-container",2),e.k0s()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("ngForOf",n.clipDirections))},dependencies:[w.Sq,c.BC,c.cb,c.j4,c.JD,c.$R,Z.K,Ve,me.g,Ne],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(j.N.getSelectedChapterClippingPlanes),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],pn.prototype,"clippingPlanes$",void 0);const Ao={"camera.optics.near":.1,"camera.optics.far":5e3,"camera.optics.fov":55,"camera.zoomLimits":{max:300,min:.01}};function _m(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleResetClick([o]))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.R7$(),e.SpI(" ",n.propertyLabels[t]," ")}}function vm(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleApplyAllClick([o]))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.R7$(),e.SpI(" ",n.propertyLabels[t]," ")}}function Cm(s,i){if(1&s&&(e.j41(0,"app-list-item")(1,"div",19),e.EFF(2),e.k0s(),e.j41(3,"div",20),e.EFF(4),e.nI1(5,"json"),e.k0s()()),2&s){const t=i.$implicit;e.R7$(2),e.JRh(t.key),e.R7$(2),e.JRh(e.bMT(5,2,t.value))}}const ym={"camera.optics.fov":"Field of View","camera.zoomLimits":"Zoom Limits","camera.zoomLimits.min":"Zoom Limits (Min)","camera.zoomLimits.max":"Zoom Limits (Max)"};class dn{constructor(i,t,n,o){this.store=i,this.formBuilder=t,this.engineService=n,this.changeRef=o,this.propertyLabels=ym,this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({properties:this.formBuilder.group({"camera.optics.fov":[null],"camera.zoomLimits":this.formBuilder.group({max:[null],min:[null]})})});const a=this.form.get("properties");this.cameraProperties=Object.keys(a.controls),this.form.patchValue({properties:{...Ao}})}ngOnInit(){this.initFormListeners(),this.initChapterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(125),(0,y.Q)(this.ngUnsubscribe)).subscribe(({properties:i})=>{const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.engineService.setProperties(i);const n=this.getMinimumProperties(i,Ao);this.store.dispatch(new U.R([t],n))})}initChapterListeners(){this.selectedChapter$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,O.F)((i,t)=>(0,R.isEqual)(i.properties,t.properties)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.properties??{},o=Object.keys(this.form.value.properties);this.extraProperties=(0,R.pickBy)(t,(a,r)=>!o.includes(r)),this.form.patchValue({properties:t},{emitEvent:!1}),this.changeRef.markForCheck()})}handleEndInteraction(){}handleResetClick(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId),n=this.getPropertiesBySource(i,Ao);this.form.patchValue({properties:n}),this.store.dispatch(new U.X_([t],i))}handleApplyAllClick(i){const n=this.store.selectSnapshot(j.N.getSelectedChapter).properties??{},o=this.getPropertiesBySource(i,n),a=this.store.selectSnapshot(j.N.getStoryChapters).map(r=>r.id);this.store.dispatch(new U.R(a,o))}getMinimumProperties(i,t){return Object.entries(i).reduce((n,[o,a])=>((0,R.isEqual)(a,t[o])||(n[o]=a),n),{})}getPropertiesBySource(i,t){return i.reduce((n,o)=>(t?.[o]&&(n[o]=t[o]),n),{})}static#e=this.\u0275fac=function(t){return new(t||dn)(e.rXU(l.il),e.rXU(c.ze),e.rXU(fi.y),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:dn,selectors:[["app-edit-chapter-properties"]],decls:32,vars:21,consts:[["propActionsMenu","matMenu"],["resetMenu","matMenu"],["applyMenu","matMenu"],["label","Properties",3,"formGroup"],["list-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["label","Camera Properties","formGroupName","properties"],[3,"label"],["formControlName","camera.optics.fov","data-test","propertiesCameraFOV",3,"mouseUp","blurred","min","max","step"],["formGroupName","camera.zoomLimits"],["formControlName","min","data-test","propertiesCameraMin",3,"mouseUp","blurred","min","max","step"],["formControlName","max","data-test","propertiesCameraMax",3,"mouseUp","blurred","min","max","step"],["label","Additional Properties"],["listType","flat",1,"text-xs"],[4,"ngFor","ngForOf"],[1,"font-semibold"],[1,"font-light"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-portal-column",3)(1,"div",4)(2,"button",5),e.nrm(3,"app-icon",6),e.k0s(),e.j41(4,"mat-menu",null,0)(6,"button",7),e.EFF(7,"Reset Defaults"),e.k0s(),e.j41(8,"button",7),e.EFF(9,"Apply to all chapters"),e.k0s()(),e.j41(10,"mat-menu",null,1)(12,"button",8),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetClick(n.cameraProperties))}),e.EFF(13," All Camera Properties "),e.k0s(),e.DNE(14,_m,2,1,"button",9),e.k0s(),e.j41(15,"mat-menu",null,2)(17,"button",8),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleApplyAllClick(n.cameraProperties))}),e.EFF(18," All Camera Properties "),e.k0s(),e.DNE(19,vm,2,1,"button",9),e.k0s()(),e.j41(20,"app-panel",10)(21,"app-form-field",11)(22,"app-slider",12),e.bIt("mouseUp",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.qex(23,13),e.j41(24,"app-form-field",11)(25,"app-slider",14),e.bIt("mouseUp",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.j41(26,"app-form-field",11)(27,"app-slider",15),e.bIt("mouseUp",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())})("blurred",function(){return e.eBV(o),e.Njj(n.handleEndInteraction())}),e.k0s()(),e.bVm(),e.k0s(),e.j41(28,"app-panel",16)(29,"app-list",17),e.DNE(30,Cm,6,4,"app-list-item",18),e.nI1(31,"keyvalue"),e.k0s()()()}if(2&t){const o=e.sdS(5),a=e.sdS(11),r=e.sdS(16);e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(4),e.Y8G("matMenuTriggerFor",a),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(6),e.Y8G("ngForOf",n.cameraProperties),e.R7$(5),e.Y8G("ngForOf",n.cameraProperties),e.R7$(2),e.Y8G("label",n.propertyLabels["camera.optics.fov"]),e.R7$(),e.Y8G("min",20)("max",75)("step",5),e.R7$(2),e.Y8G("label",n.propertyLabels["camera.zoomLimits.min"]),e.R7$(),e.Y8G("min",5)("max",10)("step",.25),e.R7$(),e.Y8G("label",n.propertyLabels["camera.zoomLimits.max"]),e.R7$(),e.Y8G("min",10)("max",350)("step",10),e.R7$(3),e.Y8G("ngForOf",e.bMT(31,19,n.extraProperties))}},dependencies:[w.Sq,c.BC,c.cb,c.j4,c.JD,c.$R,D.kk,D.fb,D.Cp,Y.Q,Z.K,X.R,jn.s,Mn.P,Ve,me.g,Ne,w.TG,w.lG],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(j.N.getSelectedChapter),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],dn.prototype,"selectedChapter$",void 0);var Uo=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Vo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function km(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-portal",null,0)(3,"app-portal-item",3),e.nI1(4,"async"),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleTransitionClick(o))}),e.k0s(),e.j41(5,"app-portal-item",4),e.nI1(6,"async"),e.nI1(7,"prettyPrint"),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleTransparencyClick(o))}),e.k0s(),e.j41(8,"app-portal-item",5),e.nI1(9,"async"),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEffectsClick(o))}),e.k0s(),e.j41(10,"app-portal-item",6),e.nI1(11,"async"),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleClippingPlanesClick(o))}),e.k0s(),e.j41(12,"app-portal-item",7),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleParticlesClick(o))}),e.k0s(),e.j41(13,"app-portal-item",8),e.nI1(14,"async"),e.bIt("itemClick",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handlePropertiesClick(o))}),e.k0s()(),e.bVm()}if(2&s){let t;const n=e.XpG();e.R7$(3),e.Y8G("hint",n.getTransitionsHint(e.bMT(4,6,n.selectedChapter$))),e.R7$(2),e.Y8G("hint",e.bMT(7,10,null==(t=e.bMT(6,8,n.selectedChapter$))?null:t.transparencyMode)),e.R7$(3),e.Y8G("hint",n.getLookEffectsHint(e.bMT(9,12,n.selectedChapter$))),e.R7$(2),e.Y8G("hint",n.getClippingPlanesHint(e.bMT(11,14,n.clippingPlanes$))),e.R7$(2),e.Y8G("hint",n.getParticlesHint(n.chapterParticleSystems)),e.R7$(),e.Y8G("hint",n.getPropertiesHint(e.bMT(14,16,n.selectedChapter$)))}}function Tm(s,i){1&s&&(e.j41(0,"app-column",9)(1,"app-column-group"),e.qex(2,10)(3),e.j41(4,"div",11),e.nrm(5,"img",12),e.EFF(6," Welcome to Human Studio! "),e.nrm(7,"br"),e.EFF(8,"Select a tool to get started. "),e.k0s(),e.bVm()(),e.k0s()()),2&s&&e.Y8G("showHeader",!1)}class Qt{get chapterParticleSystems(){const i=this.store.selectSnapshot(j.N.getSelectedChapterId);return this.store.selectSnapshot(G.B.particleSystemsForChapter(i))}constructor(i,t){this.store=i,this.enumPrintPipe=t,this.application=Me.c,this.ngUnsubscribe=new f.B}ngOnInit(){}ngAfterViewInit(){this.initContentRefresh()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initContentRefresh(){const i=this.portals.first;i&&this.selectedChapterId$.pipe((0,O.F)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{i.exit()})}handleTransitionClick(i){i.loadComponent(rn)}handleTransparencyClick(i){i.loadComponent(cm)}handleEffectsClick(i){i.loadComponent(dm)}handleClippingPlanesClick(i){i.loadComponent(pn)}handleParticlesClick(i){i.loadComponent(an)}handlePropertiesClick(i){i.loadComponent(dn)}getTransitionsHint(i){const t=(0,R.get)(i,"transitions.post"),o=[];return(0,R.get)(i,"transitions.pre")&&o.push("Pre Transition"),t&&o.push("Post Transition"),this.formatHint(o)}getLookEffectsHint(i){const t=i?.customData?.postprocess??[],n=i?.properties??{},o=t.map(a=>a.effect);return!0===n["fog.enabled"]&&o.push("fog"),this.formatHint(o)}getClippingPlanesHint(i){return this.formatHint(Object.keys((i||{clips:{}}).clips))}getParticlesHint(i){return this.formatHint(i.map(t=>t.id))}getPropertiesHint(i){return Object.keys(i?.properties??{}).join(", ")}formatHint(i){return i.map(t=>this.enumPrintPipe.transform(t)).join(", ")}static#e=this.\u0275fac=function(t){return new(t||Qt)(e.rXU(l.il),e.rXU(yt))};static#t=this.\u0275cmp=e.VBU({type:Qt,selectors:[["app-edit-document-context"]],viewQuery:function(t,n){if(1&t&&e.GBs(nt,5),2&t){let o;e.mGM(o=e.lsd())&&(n.portals=o)}},features:[e.Jv_([yt])],decls:2,vars:2,consts:[["portal",""],[4,"appFlagApplication"],[3,"showHeader",4,"appFlagApplication"],["label","Transitions","data-test","loftTransitions",3,"itemClick","hint"],["label","Transparency Mode","data-test","loftTransparencyMode",3,"itemClick","hint"],["label","Post Processing","data-test","loftPostProcessing",3,"itemClick","hint"],["label","Clipping Planes","data-test","loftClippingPlanes",3,"itemClick","hint"],["label","Particle Systems","data-test","loftParticles",3,"itemClick","hint"],["label","Properties","data-test","loftProperties",3,"itemClick","hint"],[3,"showHeader"],["column-group-body",""],[1,"context","text-sm"],["src","/assets/images/logo-blue.svg",1,"context__logo"]],template:function(t,n){1&t&&e.DNE(0,km,15,18,"ng-container",1)(1,Tm,9,1,"app-column",2),2&t&&(e.Y8G("appFlagApplication",n.application.Loft),e.R7$(),e.Y8G("appFlagApplication",n.application.Studio))},dependencies:[pt,at,Vi.Y,nt,Ji,w.Jj,yt],styles:["a[_ngcontent-%COMP%]{color:#96a8c080}.column[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.context[_ngcontent-%COMP%]{height:100%;flex-direction:column;display:flex;justify-content:center;padding:16px;text-align:center;color:#96a8c080}.context__logo[_ngcontent-%COMP%]{width:40px;display:block;margin:20px auto;opacity:.3}"],changeDetection:0})}Uo([(0,l.l6)(j.N.getSelectedChapterId),Vo("design:type",_.c)],Qt.prototype,"selectedChapterId$",void 0),Uo([(0,l.l6)(j.N.getSelectedChapter),Vo("design:type",_.c)],Qt.prototype,"selectedChapter$",void 0),Uo([(0,l.l6)(j.N.getSelectedChapterClippingPlanes),Vo("design:type",_.c)],Qt.prototype,"clippingPlanes$",void 0);var Sm=v(78674);let xm=(()=>{class s{constructor(t,n){this.previousRouteService=t,this.router=n,this.url=""}ngOnInit(){this.url=this.previousRouteService.getPreviousUrl()}exit(){switch(!0){case this.url.startsWith("/explore"):case this.url.startsWith("/results/"):case this.url.startsWith("/view"):this.router.navigateByUrl(this.url);break;default:this.router.navigateByUrl("/results/bookmarks")}}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(Sm.g),e.rXU(b.Ix))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-exit"]],decls:2,vars:0,consts:[["app-button","","buttonType","outline","buttonSize","sm","buttonShape","square","compact","true","type","button","matTooltip","Exit","aria-label","Exit",3,"click"],["icon","right-from-bracket"]],template:function(n,o){1&n&&(e.j41(0,"button",0),e.bIt("click",function(){return o.exit()}),e.nrm(1,"app-icon",1),e.k0s())},dependencies:[Ce.oV,Y.Q,X.R],changeDetection:0})}return s})();var Em=v(3829),ua=v(76872),ha=v(24151),fa=v(79817),ga=v(90908),wm=v(69568),qt=function(s){return s.Object="object",s.Position="position",s}(qt||{}),ba=v(49746),Zn=v(95370),_a=v(16124),Fm=v(26513);function Rm(s,i){1&s&&(e.j41(0,"app-form-field",24),e.nrm(1,"input",60),e.k0s())}function Pm(s,i){1&s&&(e.j41(0,"app-form-field",28),e.nrm(1,"input",60),e.k0s())}function jm(s,i){if(1&s&&(e.j41(0,"app-form-field",33),e.nrm(1,"app-rich-text-edit",61,3)(3,"app-character-counter",18),e.k0s()),2&s){const t=e.sdS(2);e.R7$(),e.Y8G("inline",!0)("compact",!0)("rows",1)("maxLength",100),e.R7$(2),e.Y8G("field",t)}}function Mm(s,i){1&s&&(e.qex(0,39),e.j41(1,"app-form-field",62),e.nrm(2,"app-color-picker-input",63),e.k0s(),e.j41(3,"app-form-field",64),e.nrm(4,"app-color-picker-input",65),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.Y8G("alpha",!0),e.R7$(2),e.Y8G("alpha",!0))}function Im(s,i){if(1&s&&(e.j41(0,"app-form-field",42)(1,"select",66)(2,"option",38),e.EFF(3,"Alphabetical"),e.k0s(),e.j41(4,"option",38),e.EFF(5,"Numerical"),e.k0s()()()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("value",t.labelSequentialType.Alphabetical),e.R7$(2),e.Y8G("value",t.labelSequentialType.Numerical)}}function Nm(s,i){1&s&&(e.j41(0,"div")(1,"mat-checkbox",67),e.EFF(2,"Show tag"),e.k0s()())}function Bm(s,i){1&s&&(e.j41(0,"div")(1,"mat-checkbox",68),e.EFF(2,"Show all content"),e.k0s()())}function Dm(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-form-field")(1,"button",70),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleRecordPositionClick())}),e.EFF(2," Mark Position "),e.k0s()()}}function Gm(s,i){if(1&s&&(e.j41(0,"div",59)(1,"app-form-field")(2,"select",69)(3,"option",38),e.EFF(4,"Zoom to label structure"),e.k0s(),e.j41(5,"option",38),e.EFF(6,"Zoom to fixed position"),e.k0s()()(),e.DNE(7,Dm,3,0,"app-form-field"),e.k0s()),2&s){const t=e.XpG();e.R7$(3),e.Y8G("value",t.labelFlyTo.Object),e.R7$(2),e.Y8G("value",t.labelFlyTo.Position),e.R7$(2),e.vxM(t.flyToTarget===t.labelFlyTo.Position?7:-1)}}const $m=new RegExp("(https?://)?([\\da-z.-]+)\\.([a-z.]{2,6})[/\\w .-]*/?","i"),eo={action:"link",label:"",url:""},Om={urls:null,alt:"",caption:""},Am={url:null,caption:"",srcFilename:""},Um={pinForegroundColor:"#FFFFFFFF",pinBackgroundColor:"#000000FF"};let Vm=(()=>{class s{get flyTo(){return this.form.value.flyTo}get flyToTarget(){return this.form.value.flyToTarget}get hasImage(){return!(0,R.isNil)(this.form.value.image.urls)}get hasAnimatedImage(){return!(0,R.isNil)(this.form.value.animatedImage.urls)}get hasVideo(){return!(0,R.isNil)(this.form.value.video.url)}get video(){return this.form.value.video}get theme(){return this.form.value.theme}get pinType(){return this.form.value.pinType}constructor(t,n,o,a,r){this.formBuilder=t,this.store=n,this.cameraService=o,this.contentBlocksService=a,this.matSnackBar=r,this.labelTheme=ua.D,this.labelPinType=ha.O,this.labelSequentialType=fa.C,this.labelFlyTo=qt,this.label=e.hFB.required(),this.open=(0,e.hFB)(!1),this.sequence=(0,e.hFB)(),this.opened=(0,e.CGW)();const p=new wm.ed("");this.form=this.formBuilder.group({title:[p.title],description:[p.description],theme:[p.theme],pinType:[p.pinType,c.k0.required],sequentialType:[p.sequentialType,c.k0.required],pinGlow:[p.pinGlow],collapseDescription:[p.collapseDescription],hideWire:[p.hideWire],hideTag:[p.hideTag],expandTag:[p.expandTag],showDescription:[p.showDescription],flyTo:[!1],flyToTarget:[null],themeStyles:this.formBuilder.group({pinForegroundColor:[""],pinBackgroundColor:[""]}),cta:this.formBuilder.group({action:"link",label:[""],url:["",[c.k0.pattern($m)]]}),image:this.formBuilder.group({urls:[],alt:[""],caption:[""]}),animatedImage:this.formBuilder.group({urls:[],alt:[""],caption:[""]}),video:this.formBuilder.group({url:[],caption:[""],srcFilename:[""]})}),(0,$n.br)(this.label).pipe((0,O.F)((x,N)=>(0,R.isEqual)(x,N)),(0,$n.pQ)()).subscribe(x=>{this.setFormValues(x)}),this.form.valueChanges.pipe((0,$n.pQ)()).subscribe(x=>this.handleFormChanges(x))}handleRecordPositionClick(){const t=this.label(),n=JSON.parse(JSON.stringify(t.states)),o=this.prepareLabelStates(n);o[1].errands=[new Zn.v(this.cameraService.getCamera())],this.store.dispatch(new ke.HP(t.id,o)),this.matSnackBar.open("Recorded marked position")}handleRemove(){this.store.dispatch(new ke.vx(this.label()))}handleFormChanges(t){const n=(0,R.cloneDeep)(this.label());if(n.title=t.title,n.description=t.description||"",n.theme=t.theme,n.pinType=t.pinType,n.sequentialType=t.sequentialType,n.pinGlow=t.pinGlow,n.collapseDescription=t.collapseDescription,n.hideWire=t.hideWire,n.hideTag=t.hideTag,n.expandTag=t.expandTag,n.showDescription=t.showDescription,t.flyTo)switch(n.states=this.prepareLabelStates(n.states),n.flyTo=t.flyTo,n.flyToTarget=t.flyToTarget,t.flyToTarget){case qt.Object:n.states[1].errands=[new ba.F(n.objectId)];break;case qt.Position:if(!((0,R.get)(n,"states[1].errands[0]")instanceof Zn.v)){const a=this.cameraService.getCamera();n.cameraPosition=a,n.states[1].errands=[new Zn.v(a)]}}else n.states&&n.states.length&&n.states[1]&&(n.states[1].errands=[]);n.contentBlocks=this.toContentBlocks(t),n.themeStyles=t.themeStyles,this.store.dispatch(new ke.lb(n,!0))}handleAlignClick(t){const n=(0,R.cloneDeep)(this.label()),o=n.hideWire?20:32;switch(t){case"left":n.offset=[-o,0];break;case"right":n.offset=[o,0]}this.store.dispatch(new ke.lb(n,!0))}handleOpened(){this.opened.emit()}prepareLabelStates(t){let n=t?[...t]:[];return n||(n=[]),n[0]||(n[0]=new _a.B,n[0].id=it.u.idWithPrefix("label-state")),n[1]||(n[1]=new _a.B,n[1].id=it.u.idWithPrefix("label-state")),n}setFormValues(t){const n={title:t.title,description:t.description||"",theme:t.theme,pinType:t.pinType,sequentialType:t.sequentialType,pinGlow:t.pinGlow,collapseDescription:t.collapseDescription,hideWire:t.hideWire,hideTag:t.hideTag,flyTo:null,flyToTarget:qt.Object,themeStyles:{...Um,...t.themeStyles},expandTag:t.expandTag,showDescription:t.showDescription,cta:this.fromContentBlocks(t.contentBlocks??[],se.m.CTA),image:this.fromContentBlocks(t.contentBlocks??[],se.m.Images),animatedImage:this.fromContentBlocks(t.contentBlocks??[],se.m.AnimatedImages),video:this.fromContentBlocks(t.contentBlocks??[],se.m.Videos)},o=(0,R.get)(t,"states[1].errands[0]");o&&(n.flyTo=!0,n.flyToTarget=1==o instanceof Zn.v?qt.Position:qt.Object),this.form.setValue(n,{emitEvent:!1})}fromContentBlocks(t,n){const o=this.contentBlocksService.findContentBlockByType(t,n);let a,r;switch(n){case se.m.Images:case se.m.AnimatedImages:a=Om;break;case se.m.Videos:a=Am;break;case se.m.CTA:a=eo}return o&&(this.contentBlocksService.isContentBlockType(o,se.m.Images)||this.contentBlocksService.isContentBlockType(o,se.m.AnimatedImages)?r=o.images[0]??{...a}:this.contentBlocksService.isContentBlockType(o,se.m.Videos)?r=o.videos[0]??{...a}:this.contentBlocksService.isContentBlockType(o,se.m.CTA)&&(r={action:o?.action||eo.action,label:o?.label||eo.label,url:o?.url||eo.url})),{...a,...r}}toContentBlocks(t){const n=[],o=this.toImageBlock(se.m.Images,t.image);o&&n.push(o);const a=this.toImageBlock(se.m.AnimatedImages,t.animatedImage);a&&n.push(a);const{url:r,caption:p,srcFilename:x}=t.video;r&&n.push({type:se.m.Videos,videos:[{url:r,caption:p,srcFilename:x}]});const{action:N,label:z,url:W}=t.cta;return W&&n.push({type:se.m.CTA,action:N,label:z,url:W}),n}toImageBlock(t,n){let o;const{urls:a,alt:r}=n;return(!(0,R.isNil)(a)||r)&&(o={type:t,images:[{urls:a,alt:r}]}),o}handleUploadInput(t){this.form.controls.video.patchValue({srcFilename:t.file?.name||""},{emitEvent:!1})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok),e.rXU(l.il),e.rXU(Jn.j),e.rXU(Pn.V),e.rXU(Qe.UG))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-label-widget"]],inputs:{label:[1,"label"],open:[1,"open"],sequence:[1,"sequence"]},outputs:{opened:"opened"},decls:91,vars:39,consts:[["labelMenu","matMenu"],["title",""],["description",""],["caption",""],["toggleType","arrow",3,"opened","label","open"],["panel-prefix",""],[1,"flex","items-center","justify-start",2,"width","36px","height","36px"],[3,"pinType","labelTheme","sequence","foregroundColor","backgroundColor"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["autocomplete","off",3,"formGroup"],["tabSize","small","tabTheme","dark"],["label","Content"],[1,"flex","flex-col","gap-2","pt-2","pl-1"],["label","Title"],["textMode","text","mode","basic","formControlName","title",3,"inline","compact","maxLength"],[3,"field"],["label","Description"],["textMode","textarea","formControlName","description","rows","9",3,"inline","compact","maxLength"],["formGroupName","image"],["label","Image",1,"block","mt-2",3,"labelElement"],["type","image","formControlName","urls"],["label","Image Alt"],["formGroupName","animatedImage"],["label","Animated GIF",1,"block","mt-4",3,"labelElement"],["type","animatedImage","formControlName","urls"],["label","Animated GIF Alt"],["formGroupName","video"],["label","Video",1,"block","mt-2",3,"labelElement"],[1,"mb-1","break-words","text-2xs"],["data-test","labelUploadVideo","type","video","formControlName","url",3,"uploadInput","showExtensions"],["label","Video Caption"],["label","Style"],[1,"pt-2","pl-1","text-xs"],["label","Theme"],["formControlName","theme",1,"input"],[3,"value"],["formGroupName","themeStyles"],["label","Pin"],["formControlName","pinType",1,"input"],["label","Sequence Type"],["label","Type"],[1,"flex","gap-2"],["formControlName","hideWire",1,"grow","input"],[3,"ngValue"],["app-button","","buttonType","outline","buttonShape","square","matTooltip","Align Left",3,"click"],["icon","caret-left"],["app-button","","buttonType","outline","buttonShape","square","matTooltip","Align Right",3,"click"],["icon","caret-right"],["formControlName","pinGlow"],["label","Actions"],["label","On load"],["listType","flat"],["formControlName","hideTag",1,"mr-4"],["formControlName","collapseDescription"],["label","On click"],["formControlName","flyTo"],[1,"pt-2","pl-6"],["type","text","formControlName","alt",1,"input"],["mode","basic","formControlName","caption",3,"inline","compact","rows","maxLength"],["label","Pin Foreground"],["formControlName","pinForegroundColor",3,"alpha"],["label","Pin Background"],["formControlName","pinBackgroundColor",3,"alpha"],["formControlName","sequentialType",1,"input"],["formControlName","expandTag"],["formControlName","showDescription"],["formControlName","flyToTarget",1,"input"],["app-button","","buttonType","outline","buttonSize","sm",1,"w-full",3,"click"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-panel",4),e.bIt("opened",function(){return e.eBV(a),e.Njj(o.handleOpened())}),e.qex(1,5),e.j41(2,"div",6),e.nrm(3,"app-label-pin",7),e.k0s(),e.bVm(),e.j41(4,"span",8)(5,"button",9),e.nrm(6,"app-icon",10),e.k0s(),e.j41(7,"mat-menu",null,0)(9,"button",11),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleRemove())}),e.EFF(10,"Remove"),e.k0s()()(),e.j41(11,"form",12)(12,"app-tabs",13)(13,"app-tab",14)(14,"div",15)(15,"app-form-field",16),e.nrm(16,"app-rich-text-edit",17,1)(18,"app-character-counter",18),e.k0s(),e.j41(19,"app-form-field",19),e.nrm(20,"app-rich-text-edit",20,2)(22,"app-character-counter",18),e.k0s(),e.qex(23,21),e.j41(24,"app-form-field",22),e.nrm(25,"app-content-upload-input",23),e.k0s(),e.DNE(26,Rm,2,0,"app-form-field",24),e.bVm(),e.qex(27,25),e.j41(28,"app-form-field",26),e.nrm(29,"app-content-upload-input",27),e.k0s(),e.DNE(30,Pm,2,0,"app-form-field",28),e.bVm(),e.qex(31,29),e.j41(32,"app-form-field",30)(33,"div",31),e.EFF(34),e.k0s(),e.j41(35,"app-content-upload-input",32),e.bIt("uploadInput",function(p){return e.eBV(a),e.Njj(o.handleUploadInput(p))}),e.k0s()(),e.DNE(36,jm,4,5,"app-form-field",33),e.bVm(),e.k0s()(),e.j41(37,"app-tab",34)(38,"div",35)(39,"app-form-field",36)(40,"select",37)(41,"option",38),e.EFF(42,"Dark"),e.k0s(),e.j41(43,"option",38),e.EFF(44,"Light"),e.k0s(),e.j41(45,"option",38),e.EFF(46,"Custom"),e.k0s()()(),e.DNE(47,Mm,5,2,"ng-container",39),e.j41(48,"app-form-field",40)(49,"select",41)(50,"option",38),e.EFF(51,"Circle"),e.k0s(),e.j41(52,"option",38),e.EFF(53,"Plus / Minus"),e.k0s(),e.j41(54,"option",38),e.EFF(55,"Sequential"),e.k0s(),e.j41(56,"option",38),e.EFF(57,"None"),e.k0s()()(),e.DNE(58,Im,6,2,"app-form-field",42),e.j41(59,"app-form-field",43)(60,"div",44)(61,"select",45)(62,"option",46),e.EFF(63,"Floating"),e.k0s(),e.j41(64,"option",46),e.EFF(65,"Leader Line"),e.k0s()(),e.j41(66,"app-button-group")(67,"button",47),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleAlignClick("left"))}),e.nrm(68,"app-icon",48),e.k0s(),e.j41(69,"button",49),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleAlignClick("right"))}),e.nrm(70,"app-icon",50),e.k0s()()()(),e.j41(71,"app-form-field")(72,"mat-checkbox",51),e.EFF(73," Make Pin Glow "),e.k0s()()()(),e.j41(74,"app-tab",52)(75,"div",35)(76,"app-form-field",53)(77,"app-list",54)(78,"app-list-item")(79,"mat-checkbox",55),e.EFF(80," Hide tag "),e.k0s()(),e.j41(81,"app-list-item")(82,"mat-checkbox",56),e.EFF(83," Hide all content "),e.k0s()()()(),e.j41(84,"app-form-field",57),e.DNE(85,Nm,3,0,"div")(86,Bm,3,0,"div"),e.j41(87,"div")(88,"mat-checkbox",58),e.EFF(89,"Zoom label"),e.k0s(),e.DNE(90,Gm,8,3,"div",59),e.k0s()()()()()()()}if(2&n){let a,r;const p=e.sdS(8),x=e.sdS(17),N=e.sdS(21);e.Y8G("label",o.label().title)("open",o.open()),e.R7$(3),e.Y8G("pinType",o.label().pinType)("labelTheme",o.label().theme)("sequence",o.sequence())("foregroundColor",null==(a=o.label().themeStyles)?null:a.pinForegroundColor)("backgroundColor",null==(r=o.label().themeStyles)?null:r.pinBackgroundColor),e.R7$(2),e.Y8G("matMenuTriggerFor",p),e.R7$(6),e.Y8G("formGroup",o.form),e.R7$(5),e.Y8G("inline",!0)("compact",!0)("maxLength",100),e.R7$(2),e.Y8G("field",x),e.R7$(2),e.Y8G("inline",!0)("compact",!0)("maxLength",300),e.R7$(2),e.Y8G("field",N),e.R7$(2),e.Y8G("labelElement",!1),e.R7$(2),e.vxM(o.hasImage?26:-1),e.R7$(2),e.Y8G("labelElement",!1),e.R7$(2),e.vxM(o.hasAnimatedImage?30:-1),e.R7$(2),e.Y8G("labelElement",!1),e.R7$(2),e.JRh(o.video.srcFilename),e.R7$(),e.Y8G("showExtensions",!1),e.R7$(),e.vxM(o.hasVideo?36:-1),e.R7$(5),e.Y8G("value",o.labelTheme.Annotation),e.R7$(2),e.Y8G("value",o.labelTheme.StudioNext),e.R7$(2),e.Y8G("value",o.labelTheme.Custom),e.R7$(2),e.vxM(o.theme===o.labelTheme.Custom&&o.pinType!==o.labelPinType.None?47:-1),e.R7$(3),e.Y8G("value",o.labelPinType.Default),e.R7$(2),e.Y8G("value",o.labelPinType.PlusMinus),e.R7$(2),e.Y8G("value",o.labelPinType.Sequential),e.R7$(2),e.Y8G("value",o.labelPinType.None),e.R7$(2),e.vxM(o.label().pinType===o.labelPinType.Sequential?58:-1),e.R7$(4),e.Y8G("ngValue",!0),e.R7$(2),e.Y8G("ngValue",!1),e.R7$(21),e.vxM(o.label().hideTag?85:-1),e.R7$(),e.vxM(o.label().collapseDescription?86:-1),e.R7$(4),e.vxM(o.flyTo?90:-1)}},dependencies:[c.qT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD,c.$R,Ae.So,D.kk,D.fb,D.Cp,Ce.oV,Y.Q,gi,Z.K,Pt.P,X.R,jn.s,Mn.P,jt.j,Mt.O,me.g,bt,Fm.b,Ut,Ui.c],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return s})();const Lm=(s,i)=>i.id;function Ym(s,i){1&s&&(e.j41(0,"div",19)(1,"div",22),e.EFF(2,"Add a label"),e.k0s(),e.j41(3,"div",17),e.EFF(4,"Click on an object in the 3D scene to start adding labels."),e.k0s()())}function zm(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",21)(1,"app-label-widget",23),e.bIt("opened",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleOpened(o))}),e.k0s(),e.j41(2,"div",24),e.nrm(3,"app-icon",25),e.k0s()()}if(2&s){let t;const n=i.$implicit,o=e.XpG();e.R7$(),e.Y8G("label",n)("sequence",o.getLabelSequence(n))("open",(null==(t=o.selectedLabel())?null:t.id)===n.id),e.BMQ("data-id",n.id)}}let Xm=(()=>{class s{constructor(t){this.store=t,this.labelTheme=ua.D,this.labelPinType=ha.O,this.labelSequentialType=fa.C,this.selectedChapter=(0,l.Lt)(j.N.getSelectedChapter),this.labels=(0,l.Lt)($e.y.getChapterLabels),this.selectedLabel=(0,l.Lt)($e.y.getSelectedLabel),this.lockCamera=(0,l.Lt)(Em.x.getLockCamera),this.interactive=(0,e.EWP)(()=>!0===this.selectedChapter()?.readyState?.model),(0,e.QZP)(()=>{const n=this.selectedLabel();(0,R.isNil)(n)||setTimeout(()=>this.scrollLabelIntoView(n))})}handleOpened(t){this.store.dispatch(new ke.TR(t))}handleRemoveChapterLabels(){this.store.dispatch(new ke.u1(this.store.selectSnapshot(j.N.getSelectedChapter),!0))}handleNext(){this.store.dispatch(new P.$j)}handlePrevious(){this.store.dispatch(new P.hE)}handleCheckedChange(t){this.store.dispatch(new Ft.pU(t.checked))}getLabelSequence(t){return this.store.selectSnapshot($e.y.getLabelSequence(t))}convertLabels(t,n){const o=this.store.selectSnapshot(n?$e.y.getChapterLabels:$e.y.getLabels);this.store.dispatch(new ke.$K(o,t))}scrollLabelIntoView(t){const n=document.querySelector(`[data-id="${t.id}"]`);(0,ga.uK)()&&!(0,R.isNil)(n)&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}handleDrop(t){const n=this.store.selectSnapshot($e.y.getChapterLabels);(0,te.HD)(n,t.previousIndex,t.currentIndex);let o=this.store.selectSnapshot($e.y.getLabels).filter(a=>!n.some(r=>r.id===a.id));o=[...o,...n],this.store.dispatch(new ke.gJ(o))}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-label-context"]],decls:52,vars:8,consts:[["labelMenu","matMenu"],["storyTrigger","matMenuTrigger"],["chapterTrigger","matMenuTrigger"],["convertMenu","matMenu"],["convertThemeMenu","matMenu"],["convertPinsMenu","matMenu"],[3,"loading"],["column-label",""],["column-actions",""],["app-button","",1,"context__actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],["label","Label"],["column-group-header",""],[1,"pl-2"],[3,"change","checked"],[1,"text-xs"],["column-group-body",""],[1,"p-3"],["cdkDropList","",1,"labels",3,"cdkDropListDropped"],["cdkDrag","",1,"labels__item"],[1,"text-xs","font-bold"],[1,"grow",3,"opened","label","sequence","open"],["cdkDragHandle","",1,"labels__handle"],["icon","grip-lines"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-column",6)(1,"div",7),e.EFF(2,"Labels"),e.k0s(),e.j41(3,"div",8)(4,"button",9),e.nrm(5,"app-icon",10),e.k0s(),e.j41(6,"mat-menu",null,0)(8,"button",11),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleRemoveChapterLabels())}),e.EFF(9," Remove this chapter's labels "),e.k0s(),e.nrm(10,"mat-divider"),e.j41(11,"button",12,1),e.EFF(13," Convert all labels "),e.k0s(),e.j41(14,"button",12,2),e.EFF(16," Convert this chapter's labels "),e.k0s()(),e.j41(17,"mat-menu",null,3)(19,"button",12),e.EFF(20,"Theme"),e.k0s(),e.j41(21,"button",12),e.EFF(22,"Pin"),e.k0s()(),e.j41(23,"mat-menu",null,4)(25,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({theme:o.labelTheme.Annotation},p.menuOpen))}),e.EFF(26," Dark Theme "),e.k0s(),e.j41(27,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({theme:o.labelTheme.StudioNext},p.menuOpen))}),e.EFF(28," Light Theme "),e.k0s()(),e.j41(29,"mat-menu",null,5)(31,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({pinType:o.labelPinType.Default},p.menuOpen))}),e.EFF(32," Circle "),e.k0s(),e.j41(33,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({pinType:o.labelPinType.PlusMinus},p.menuOpen))}),e.EFF(34," Plus / Minus "),e.k0s(),e.j41(35,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({pinType:o.labelPinType.Sequential,sequentialType:o.labelSequentialType.Alphabetical},p.menuOpen))}),e.EFF(36," Alphabetical "),e.k0s(),e.j41(37,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({pinType:o.labelPinType.Sequential,sequentialType:o.labelSequentialType.Numerical},p.menuOpen))}),e.EFF(38," Numerical "),e.k0s(),e.j41(39,"button",11),e.bIt("click",function(){e.eBV(a);const p=e.sdS(15);return e.Njj(o.convertLabels({pinType:o.labelPinType.None},p.menuOpen))}),e.EFF(40," None "),e.k0s()()(),e.j41(41,"app-column-group",13),e.qex(42,14),e.j41(43,"div",15)(44,"mat-checkbox",16),e.bIt("change",function(p){return e.eBV(a),e.Njj(o.handleCheckedChange(p))}),e.j41(45,"span",17),e.EFF(46,"Disable label zoom while editing"),e.k0s()()(),e.bVm(),e.qex(47,18),e.DNE(48,Ym,5,0,"div",19),e.j41(49,"div",20),e.bIt("cdkDropListDropped",function(p){return e.eBV(a),e.Njj(o.handleDrop(p))}),e.Z7z(50,zm,4,4,"div",21,Lm),e.k0s(),e.bVm(),e.k0s()()}if(2&n){let a;const r=e.sdS(7),p=e.sdS(18),x=e.sdS(24),N=e.sdS(30);e.Y8G("loading",!o.interactive()),e.R7$(4),e.Y8G("matMenuTriggerFor",r),e.R7$(7),e.Y8G("matMenuTriggerFor",p),e.R7$(3),e.Y8G("matMenuTriggerFor",p),e.R7$(5),e.Y8G("matMenuTriggerFor",x),e.R7$(2),e.Y8G("matMenuTriggerFor",N),e.R7$(23),e.Y8G("checked",o.lockCamera()),e.R7$(4),e.vxM(0===(null==(a=o.labels())?null:a.length)?48:-1),e.R7$(2),e.Dyx(o.labels())}},dependencies:[te.O7,te.T1,te.Fb,Ae.So,D.kk,D.fb,D.Cp,Je.q,Y.Q,pt,at,X.R,Vm],styles:[".context__actions[_ngcontent-%COMP%]{flex:0 1 auto}.labels__item[_ngcontent-%COMP%]{position:relative}.labels__item[_ngcontent-%COMP%]:hover   .labels__handle[_ngcontent-%COMP%]{opacity:1}.labels__handle[_ngcontent-%COMP%]{border:4px solid transparent;display:flex;align-items:center;justify-content:center;background:#131c2a;width:44px;height:36px;cursor:move;color:#96a8c0;position:absolute;left:4px;top:16px;z-index:10;opacity:0;transition:opacity .15s}.labels[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.2}"],changeDetection:0})}return s})();var Ht=v(20458),va=v(4951),Ca=v(40470);class to{constructor(i){this.label=i||"",this.id=it.u.idWithPrefix("palette"),this.recipes=[],this.open=!0}}function Qm(s,i){1&s&&(e.j41(0,"app-alert",15),e.EFF(1," There was an error importing your palette. "),e.k0s())}let qm=(()=>{class s{constructor(t,n,o){this.formBuilder=t,this.dialogRef=n,this.changeDetectorRef=o,this.hasError=!1}ngOnInit(){this.initForm()}initForm(){this.form=this.formBuilder.group({import:["",c.k0.required]})}handleSubmit(){const t=this.form.get("import").value;this.createPalette(t)}createPalette(t){this.hasError=!1;try{const n=JSON.parse(t),o=(0,Ca.bj)(to,n);delete o.id,this.dialogRef.close(o)}catch{this.hasError=!0,this.changeDetectorRef.markForCheck()}}handleFile(t){var n=new FileReader;n.onload=o=>{this.createPalette(o.target.result)},n.readAsText(t.target.files[0])}onReaderLoad(t){this.createPalette(t.target.result)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(ee.CP),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-import-palette-dialog"]],decls:18,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["data-test","importPaletteDialog",1,"edit-import-palette-dialog","theme-light"],["type","danger","theme","light","class","mb-4 block",4,"ngIf"],["tabTheme","light"],["label","Paste Text"],["data-test","importForm",3,"submit","formGroup"],["label","Palette"],["formControlName","import","rows","6","name","import","data-test","importText",1,"input"],["label","Upload file"],["label","Palette File"],["type","file",1,"input",3,"change"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","buttonType","primary",3,"click"],["type","danger","theme","light",1,"mb-4","block"]],template:function(n,o){1&n&&(e.j41(0,"h1",0),e.EFF(1,"Import Palette"),e.k0s(),e.j41(2,"div",1)(3,"div",2),e.DNE(4,Qm,2,0,"app-alert",3),e.j41(5,"app-tabs",4)(6,"app-tab",5)(7,"form",6),e.bIt("submit",function(){return o.handleSubmit()}),e.j41(8,"app-form-field",7),e.nrm(9,"textarea",8),e.k0s()()(),e.j41(10,"app-tab",9)(11,"app-form-field",10)(12,"input",11),e.bIt("change",function(r){return o.handleFile(r)}),e.k0s()()()()()(),e.j41(13,"div",12)(14,"button",13),e.EFF(15,"Cancel"),e.k0s(),e.j41(16,"button",14),e.bIt("click",function(){return o.handleSubmit()}),e.EFF(17,"Import"),e.k0s()()),2&n&&(e.R7$(4),e.Y8G("ngIf",o.hasError),e.R7$(3),e.Y8G("formGroup",o.form))},dependencies:[w.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,ee.tx,ee.BI,ee.E7,ee.Yi,qs.C,Y.Q,Z.K,jt.j,Mt.O],changeDetection:0})}return s})();function He(s){let i="";return"number"==typeof s?i=s.toFixed(2):(0,lt._U)(s)?i=function Hm(s){return`(Center: ${He(s.center)}, Edge: ${He(s.edge)}, Center Bias: ${He(s.centerBias)}, Edge Bias: ${He(s.edgeBias)}, Power: ${s.power})`}(s):(0,lt._o)(s)&&(i=function Wm(s){return ae.T.rgbToHex(ae.T.rgbFromDecimal(s)).toUpperCase()}(s)),i}const Zm=["palette"],eu=(s,i,t)=>({"paint-palette-swatch--slash":s,"paint-palette-swatch--selected":i,"paint-palette-swatch--large":t});function tu(s,i){if(1&s&&(e.j41(0,"div",4),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.SpI(" ",t.label,"\n")}}class Tt{get engineRecipe(){return this._engineRecipe}set engineRecipe(i){this._engineRecipe=i,this.recipe=(0,lt.H)(this.engineRecipe)}get recipe(){return this._recipe}set recipe(i){this._recipe=i,this.recipe&&(this.updateStyle(this.recipe),this.updateTooltip())}get label(){return this._label}set label(i){this._label=i,this.updateTooltip()}constructor(i,t){this.renderer=i,this.changeDetectorRef=t,this.showLabel=!0,this.size="small",this.highlightSelected=!0,this.selected=!1,this.showSlash=!1,this.ngUnsubscribe=new f.B}ngOnInit(){this.currentRecipe$.pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(()=>this.highlightSelected),(0,I.p)(i=>!(0,R.isNil)(i))).subscribe(i=>{this.selected=this.isSelected(this.recipe,i),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateStyle(i){let t=1;if((0,lt._M)(i)&&(t=(0,R.isNumber)(i.opacity)?i.opacity>1?i.opacity/100:i.opacity:.4),(0,lt._U)(i.tintColor)){const n=ae.T.rgbToHex(ae.T.rgbFromDecimal(i.tintColor.center)),o=ae.T.rgbToHex(ae.T.rgbFromDecimal(i.tintColor.edge));this.renderer.setStyle(this.element.nativeElement,"background",`radial-gradient(${n} 0%, ${o} 60%)`)}else{const n=this.makeColor(i,t);this.renderer.setStyle(this.element.nativeElement,"background",n)}this.showSlash=!1===i.tintColor&&!1===i.brightness&&!1===i.contrast&&!1===i.opacity&&!1===i.saturation}makeColor(i,t=1){const n=i.tintColor;if(!n)return`rgba(255,255,255,${t})`;const[o,a,r]=n;return`rgba(${255*o}, ${255*a}, ${255*r}, ${t})`}updateTooltip(){if(!this.recipe)return;let i=[];this.label&&i.push(this.label);const t=[...i,...[{key:"Color",value:He(this.recipe.tintColor)},{key:"Saturation",value:He(this.recipe.saturation)},{key:"Contrast",value:He(this.recipe.contrast)},{key:"Brightness",value:He(this.recipe.brightness)},{key:"Opacity",value:He(this.recipe.opacity)}].filter(n=>""!==n.value).map(n=>`${n.key}: ${n.value}`)].join("\n\n");this.tooltip=t}isSelected(i,t){return(0,R.isEqual)(i,t)}static#e=this.\u0275fac=function(t){return new(t||Tt)(e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Tt,selectors:[["app-paint-swatch"],["button","app-paint-swatch",""]],viewQuery:function(t,n){if(1&t&&e.GBs(Zm,7),2&t){let o;e.mGM(o=e.lsd())&&(n.element=o.first)}},inputs:{engineRecipe:"engineRecipe",recipe:"recipe",label:"label",showLabel:"showLabel",size:"size",icon:"icon",highlightSelected:"highlightSelected"},decls:4,vars:7,consts:[["palette",""],["matTooltipClass","whitespace-pre-line","matTooltipPosition","above","data-test","paintPaletteSwatch",1,"paint-palette-swatch",3,"ngClass","matTooltip"],[1,"paint-palette-swatch__style"],["class","paint-palette-swatch__label",4,"ngIf"],[1,"paint-palette-swatch__label"]],template:function(t,n){1&t&&(e.j41(0,"div",1),e.nrm(1,"div",2,0),e.k0s(),e.DNE(3,tu,2,1,"div",3)),2&t&&(e.Y8G("ngClass",e.sMw(3,eu,n.showSlash,n.selected,"large"===n.size))("matTooltip",n.tooltip),e.R7$(3),e.Y8G("ngIf",n.showLabel))},dependencies:[w.YU,w.bT,Ce.oV],styles:["[app-paint-swatch]{display:inline-flex;justify-content:center;align-items:center;flex-direction:column}button[app-paint-swatch]{cursor:pointer;background:none;border:none;margin:0;padding:0}.paint-palette-swatch__label{display:block;width:48px;height:20px;padding:4px 4px 0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#fff;font-size:9px}.paint-palette-swatch{cursor:pointer;background-color:#fff;background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3E%3Cg fill='%23CCCCCC' fill-opacity='1'%3E%3Cpath fill-rule='evenodd' d='M0 0h4v4H0V0zm4 4h4v4H4V4z'/%3E%3C/g%3E%3C/svg%3E\");border-radius:50%;display:flex;justify-content:center;align-items:center;width:24px;height:24px;position:relative}.paint-palette-swatch:hover:active{transform:scale(.9)}.paint-palette-swatch--large{width:36px;height:36px}.paint-palette-swatch--selected .paint-palette-swatch__style{box-shadow:0 0 0 2px #7fb6f5}.paint-palette-swatch--slash:after{content:\" \";position:absolute;height:3px;width:100%;background-color:#f44336cc;transform:rotate(135deg)}.paint-palette-swatch__style{position:absolute;width:100%;height:100%;border-radius:50%;box-shadow:0 0 0 1px #374a68}.paint-palette-swatch__icon{text-shadow:0 0px 2px rgba(0,0,0,.8)}\n"],encapsulation:2,changeDetection:0})}function iu(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",12),e.nrm(1,"app-paint-swatch",13)(2,"input",14),e.j41(3,"button",15),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRemove(o))}),e.nrm(4,"app-icon",16),e.k0s()()}if(2&s){const t=i.$implicit,n=i.index,o=e.XpG();e.Y8G("formGroup",t),e.R7$(),e.Y8G("recipe",o.palette.recipes[n])("highlightSelected",!1)("showLabel",!1)}}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(L.i.getCurrentRecipe),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Tt.prototype,"currentRecipe$",void 0);let Lo=(()=>{class s{get recipes(){return this.form.get("recipes")}constructor(t,n,o,a){this.dialogRef=t,this.data=n,this.formBuilder=o,this.store=a,this.ngUnsubscribe=new f.B,this.activeRecipeIndex=null,this.showDetails=!1,this.form=this.formBuilder.group({label:["",c.k0.required],recipes:this.formBuilder.array([])}),this.palette=(0,R.cloneDeep)(this.data.palette)}ngOnInit(){this.updateForm(this.palette),this.handleFormChanges()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateForm(t){this.form.get("label").setValue(t.label),t.recipes.forEach(n=>{const o=this.formBuilder.group({label:[n.label]});this.recipes.push(o)})}handleFormChanges(){this.form.get("recipes").valueChanges.pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(t=>t.length)).subscribe(t=>{this.palette.recipes.forEach((n,o)=>{this.palette.recipes[o].label=t[o].label})})}handleRemoveRecipe(t){this.palette.recipes.splice(t,1),this.store.dispatch(new Q.ut(this.palette))}handleSubmit(){const t=(0,Ca.bj)(to,{...this.palette,label:this.form.get("label").value});this.dialogRef.close(t)}handleRecipeDrop(t){const{previousIndex:n,currentIndex:o}=t;this.palette.recipes=(0,Gt.W)(this.palette.recipes,n,o),this.recipes.controls=(0,Gt.W)(this.recipes.controls,n,o)}handleRecipeClick(t){this.activeRecipeIndex=t,this.showDetails=!1}handleRemove(t){this.palette.recipes.splice(t,1),this.activeRecipeIndex=null}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(ee.CP),e.rXU(ee.Vh),e.rXU(c.ze),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-palette-dialog"]],decls:15,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["data-test","editPaletteDialog",1,"edit-palette-dialog","theme-light"],["data-test","editPaletteForm",3,"submit","formGroup"],["label","Label"],["type","text","formControlName","label","cdkFocusInitial","","data-test","paletteLabel",1,"input"],["label","Colors","cdkDropList","","cdkDropListOrientation","vertical","formArrayName","recipes",3,"cdkDropListDropped"],[1,"edit-palette-dialog__recipes","theme-light"],["data-test","paletteRecipe","class","edit-palette-dialog__item","cdkDrag","",3,"formGroup",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","type","button",3,"mat-dialog-close"],["app-button","","buttonType","primary","data-test","paletteSubmit",3,"click"],["data-test","paletteRecipe","cdkDrag","",1,"edit-palette-dialog__item",3,"formGroup"],[1,"mr-2",3,"recipe","highlightSelected","showLabel"],["type","label","placeholder","Label (optional)","formControlName","label","tabindex","0",1,"input","theme-light"],["type","button","app-button","","buttonType","outline","buttonTheme","light","tabindex","-1",1,"ml-2",3,"click"],["icon","times"]],template:function(n,o){1&n&&(e.j41(0,"h1",0),e.EFF(1,"Manage Palette"),e.k0s(),e.j41(2,"div",1),e.nrm(3,"div",2),e.j41(4,"form",3),e.bIt("submit",function(){return o.handleSubmit()}),e.j41(5,"app-form-field",4),e.nrm(6,"input",5),e.k0s(),e.j41(7,"app-form-field",6),e.bIt("cdkDropListDropped",function(r){return o.handleRecipeDrop(r)}),e.j41(8,"div",7),e.DNE(9,iu,5,4,"div",8),e.k0s()()()(),e.j41(10,"div",9)(11,"button",10),e.EFF(12,"Cancel"),e.k0s(),e.j41(13,"button",11),e.bIt("click",function(){return o.handleSubmit()}),e.EFF(14," Done "),e.k0s()()),2&n&&(e.R7$(4),e.Y8G("formGroup",o.form),e.R7$(5),e.Y8G("ngForOf",o.recipes.controls))},dependencies:[w.Sq,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,te.O7,te.T1,ee.tx,ee.BI,ee.E7,ee.Yi,Y.Q,Z.K,X.R,Tt],styles:[".edit-palette-dialog__recipes[_ngcontent-%COMP%]{padding:16px 0;max-height:320px;overflow-y:scroll}.edit-palette-dialog__item[_ngcontent-%COMP%]{border-radius:4px;display:flex;align-items:center;padding:8px}.edit-palette-dialog__item[_ngcontent-%COMP%]:hover{background:#eaeff5}"],changeDetection:0})}return s})(),io=(()=>{class s{constructor(t,n,o,a,r){this.dialogService=t,this.clipboardService=n,this.snackbar=o,this.store=a,this.dialog=r}selectRecipe(t){this.store.dispatch(new Q.Hr),this.store.dispatch(new Q.WD(t)),this.store.dispatch(new ie.pL(H.s.Paint))}copyPaletteToClipboard(t){const n=(0,R.cloneDeep)(t);delete n.open;const o=JSON.stringify(n);this.clipboardService.copyToClipboard(o,"text").pipe((0,be.s)(1)).subscribe(a=>{this.snackbar.open(a?"Successfully copied palette to clipboard.":"Failed to copy palette to clipboard.")})}downloadPalette(t){const n={...t};delete n.id,delete n.open;const a=`${t.label.toLocaleLowerCase()||"palette"}.json`,r=JSON.stringify(t),p=new Blob([r],{type:"text/plain;charset=utf-8"});(0,So.saveAs)(p,a)}removePalette(t){this.dialogService.openConfirmDialog({data:{titleText:"Remove Palette",bodyText:`Would you like to remove the '${t.label}' palette?`,confirmText:"Remove Palette"}}).afterClosed().pipe((0,be.s)(1),(0,I.p)(n=>!0===n)).subscribe(()=>{this.store.dispatch(new Q.yG(t.id))})}openImportPalette(){this.dialog.open(qm,{width:"480px"}).afterClosed().pipe((0,be.s)(1),(0,I.p)(n=>!(0,R.isNil)(n))).subscribe(n=>{this.dialog.open(Lo,{width:"480px",data:{palette:n}}).afterClosed().pipe((0,be.s)(1),(0,I.p)(a=>!(0,R.isNil)(a))).subscribe(a=>{this.store.dispatch(new Q.hd(a))})})}static#e=this.\u0275fac=function(n){return new(n||s)(e.KVO(Xe.o),e.KVO(va.W),e.KVO(Qe.UG),e.KVO(l.il),e.KVO(ee.bZ))};static#t=this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function su(s,i){1&s&&(e.j41(0,"span"),e.EFF(1,"structure"),e.k0s())}function au(s,i){1&s&&(e.j41(0,"span"),e.EFF(1,"structures"),e.k0s())}class mn{constructor(i){this.store=i}handleClearClick(){this.store.dispatch(new re.q9(!1))}static#e=this.\u0275fac=function(t){return new(t||mn)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:mn,selectors:[["app-selected-nodes-panel"]],decls:13,vars:11,consts:[[1,"panel","text-xs","uppercase"],[1,"panel__count"],[4,"ngIf"],[1,"panel__clear"],["buttonSize","sm","app-button","",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"async"),e.nI1(4,"number"),e.DNE(5,su,2,0,"span",2),e.nI1(6,"async"),e.DNE(7,au,2,0,"span",2),e.nI1(8,"async"),e.EFF(9," selected "),e.k0s(),e.j41(10,"div",3)(11,"button",4),e.bIt("click",function(){return n.handleClearClick()}),e.EFF(12,"Clear"),e.k0s()()()),2&t&&(e.R7$(2),e.SpI(" ",e.bMT(4,5,e.bMT(3,3,n.checkedNodesCount$))," "),e.R7$(3),e.Y8G("ngIf",1===e.bMT(6,7,n.checkedNodesCount$)),e.R7$(2),e.Y8G("ngIf",e.bMT(8,9,n.checkedNodesCount$)>1))},dependencies:[Y.Q,w.bT,w.Jj,w.QX],styles:[".panel[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px;justify-content:space-between;align-items:center}.panel__count[_ngcontent-%COMP%]{flex:1 0 auto}.panel__clear[_ngcontent-%COMP%]{flex:0 0 auto;opacity:.3}"],changeDetection:0})}function cu(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.handleRecipeClick(o))}),e.k0s()}if(2&s){const t=i.$implicit;e.Y8G("recipe",t)("label",t.label)}}function pu(s,i){if(1&s&&(e.j41(0,"div",6)(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.DNE(4,cu,1,2,"button",9),e.k0s()()),2&s){const t=i.$implicit;e.R7$(2),e.SpI(" ",t.label," "),e.R7$(2),e.Y8G("ngForOf",t.recipes)}}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(ye.z.getCheckedNodesCount),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],mn.prototype,"checkedNodesCount$",void 0);class un{constructor(i){this.editPaintService=i,this.name="",this.groupedPresets=[{label:"Colors",recipes:Ht.Me},{label:"Effects",recipes:Ht._d}]}ngOnInit(){}handleRecipeClick(i){this.editPaintService.selectRecipe(i)}isSelected(i,t){return JSON.stringify(i)===JSON.stringify(t)}static#e=this.\u0275fac=function(t){return new(t||un)(e.rXU(io))};static#t=this.\u0275cmp=e.VBU({type:un,selectors:[["app-paint-presets"]],decls:7,vars:3,consts:[["toggleType","arrow",3,"open","noPadding"],["panel-label","",1,"font-semibold","px-3","py-2"],[1,"font-semibold","flex","items-center","px-",2,"min-height","36px"],[1,"px-3","pb-2"],[1,"paint-presets"],["class","paint-presets__group",4,"ngFor","ngForOf"],[1,"paint-presets__group"],[1,"text-2xs","uppercase","text-gray-400","py-2","pl-1"],[1,"px-1"],["app-paint-swatch","","class","mr-2 mb-2","data-test","paintPreset",3,"recipe","label","click",4,"ngFor","ngForOf"],["app-paint-swatch","","data-test","paintPreset",1,"mr-2","mb-2",3,"click","recipe","label"]],template:function(t,n){1&t&&(e.j41(0,"app-panel",0)(1,"div",1)(2,"div",2),e.EFF(3,"BioDigital"),e.k0s()(),e.j41(4,"div",3)(5,"div",4),e.DNE(6,pu,5,2,"div",5),e.k0s()()()),2&t&&(e.Y8G("open",!0)("noPadding",!0),e.R7$(6),e.Y8G("ngForOf",n.groupedPresets))},dependencies:[w.Sq,me.g,Tt],styles:[".paint-presets[_ngcontent-%COMP%]{display:flex;flex-flow:column}"],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(L.i.getCurrentRecipe),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],un.prototype,"colorRecipe$",void 0);var ya=v(45434),ka=v(1367);const du=["tabsEl"];function mu(s,i){if(1&s&&(e.qex(0),e.j41(1,"app-form-field",14),e.nrm(2,"app-slider",15),e.k0s(),e.bVm()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("min",t.min)("max",t.max)}}function uu(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",16),e.nrm(2,"app-color-picker-input",17),e.k0s(),e.bVm())}function hu(s,i){if(1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-slider",15),e.k0s(),e.j41(3,"app-form-field",19),e.nrm(4,"app-slider",15),e.k0s(),e.bVm()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("min",t.fresnelMin)("max",t.fresnelMax),e.R7$(2),e.Y8G("min",t.fresnelMin)("max",t.fresnelMax)}}function fu(s,i){1&s&&(e.qex(0),e.j41(1,"app-form-field",18),e.nrm(2,"app-color-picker-input",17),e.k0s(),e.j41(3,"app-form-field",19),e.nrm(4,"app-color-picker-input",17),e.k0s(),e.bVm())}let gu=(()=>{class s{get value(){return this._value}set value(t){(0,R.isEqual)(t,this.value)||(this._value=t,this.setFormValues(t))}get colorMode(){return this._colorMode}set colorMode(t){this._colorMode=t}constructor(t){this.formBuilder=t,this.min=0,this.max=100,this.fresnelMin=0,this.fresnelMax=100,this._value=null,this.simpleMode="number",this.fresnelMode="scalar",this.valueUpdated=new e.bkB,this._colorMode="numeric",this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({numericValue:[0],hexValue:["#ff0000"],fresnel:this.formBuilder.group({center:this.formBuilder.group({numericValue:[100],hexValue:["#ff0000"]}),edge:this.formBuilder.group({numericValue:[0],hexValue:["#0000ff"]}),centerBias:[100],edgeBias:[0],power:[1]})})}ngOnInit(){this.form.valueChanges.pipe((0,K.B)(300),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.emitCurrentValue()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){"number"==typeof t?(this.setSimpleValues(t),this.colorMode="numeric"):Array.isArray(t)?(this.setRGBValues(t),this.colorMode="numeric"):(0,lt._U)(t)&&(Array.isArray(t.center)?this.setColorFresnesValues(t):this.setScalarFresnesValues(t),this.colorMode="fresnel")}setSimpleValues(t){this.form.patchValue({numericValue:t},{emitEvent:!1,onlySelf:!0})}setRGBValues(t){const n=ae.T.rgbToHex(t,!0);this.form.patchValue({hexValue:n},{emitEvent:!1,onlySelf:!0})}setScalarFresnesValues(t){const{edge:n,center:o,edgeBias:a,centerBias:r,power:p}=t;this.form.patchValue({fresnel:{edge:{numericValue:100*n},center:{numericValue:100*o},edgeBias:100*a,centerBias:100*r,power:p}},{emitEvent:!1,onlySelf:!0})}setColorFresnesValues(t){const{edge:n,center:o,centerBias:a,edgeBias:r,power:p}=t,x=ae.T.rgbToHex(n,!0),N=ae.T.rgbToHex(o,!0);this.form.patchValue({fresnel:{edge:{hexValue:x},center:{hexValue:N},edgeBias:100*r,centerBias:100*a,power:p}},{emitEvent:!1,onlySelf:!0})}setColorMode(t){this.colorMode=0===t?"numeric":"fresnel",this.emitCurrentValue()}emitCurrentValue(){const t=this.getColorValue();this.valueUpdated.emit(t)}getColorValue(){const t=this.form.value;return"fresnel"===this.colorMode?"color"===this.fresnelMode?this.getColorFresnelValue(t):this.getSclarFresnelValue(t):"number"===this.simpleMode?this.getSimpleValue(t):this.getRGBValue(t)}getSimpleValue(t){const{numericValue:n}=t;return n}getRGBValue(t){const{hexValue:n}=t;return ae.T.hexToRgb(n,!0)}getColorFresnelValue(t){const{fresnel:n}=t,{edge:o,center:a,edgeBias:r,centerBias:p,power:x}=n,N=ae.T.hexToRgb(o.hexValue,!0),z=ae.T.hexToRgb(a.hexValue,!0);return new ya.m({edge:N,center:z,edgeBias:r/100,centerBias:p/100,power:x})}getSclarFresnelValue(t){const{fresnel:n}=t,{edge:o,center:a,centerBias:r,edgeBias:p,power:x}=n;return new ka.R({edge:o.numericValue/100,center:a.numericValue/100,centerBias:r/100,edgeBias:p/100,power:x})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-paint-recipe"]],viewQuery:function(n,o){if(1&n&&e.GBs(du,7),2&n){let a;e.mGM(a=e.lsd())&&(o.tabs=a.first)}},inputs:{min:"min",max:"max",fresnelMin:"fresnelMin",fresnelMax:"fresnelMax",value:"value",simpleMode:"simpleMode",fresnelMode:"fresnelMode"},outputs:{valueUpdated:"valueUpdated"},decls:17,vars:14,consts:[["tabsEl",""],[1,"recipe",3,"formGroup"],["tabSize","small","tabTheme","dark",3,"activeTabChange","activeTab"],["label","Simple",3,"ngSwitch"],[1,"pt-2","pl-1"],[4,"ngSwitchCase"],["label","Advanced",3,"ngSwitch"],["formGroupName","fresnel",1,"pt-2","pl-1"],["label","Center Bias"],["formControlName","centerBias",3,"min","max"],["label","Edge Bias"],["formControlName","edgeBias",3,"min","max"],["label","Power"],["formControlName","power",3,"min","max"],["label","Value"],["formControlName","numericValue",3,"min","max"],["label","Color"],["formControlName","hexValue"],["label","Center","formGroupName","center"],["label","Edge","formGroupName","edge"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"form",1)(1,"app-tabs",2,0),e.bIt("activeTabChange",function(p){return e.eBV(a),e.Njj(o.setColorMode(p))}),e.j41(3,"app-tab",3)(4,"div",4),e.DNE(5,mu,3,2,"ng-container",5)(6,uu,3,0,"ng-container",5),e.k0s()(),e.j41(7,"app-tab",6)(8,"div",7),e.DNE(9,hu,5,4,"ng-container",5)(10,fu,5,0,"ng-container",5),e.j41(11,"app-form-field",8),e.nrm(12,"app-slider",9),e.k0s(),e.j41(13,"app-form-field",10),e.nrm(14,"app-slider",11),e.k0s(),e.j41(15,"app-form-field",12),e.nrm(16,"app-slider",13),e.k0s()()()()()}2&n&&(e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("activeTab","numeric"===o.colorMode?0:1),e.R7$(2),e.Y8G("ngSwitch",o.simpleMode),e.R7$(2),e.Y8G("ngSwitchCase","number"),e.R7$(),e.Y8G("ngSwitchCase","rgb"),e.R7$(),e.Y8G("ngSwitch",o.fresnelMode),e.R7$(2),e.Y8G("ngSwitchCase","scalar"),e.R7$(),e.Y8G("ngSwitchCase","color"),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",0)("max",100),e.R7$(2),e.Y8G("min",1)("max",5))},dependencies:[w.ux,w.e1,c.qT,c.BC,c.cb,c.j4,c.JD,c.$R,Z.K,Ve,jt.j,Mt.O,bt],styles:[".recipe__heading[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px;font-size:.75rem;line-height:1rem;font-weight:700;color:#96a8c0}.theme-light[_nghost-%COMP%]   .recipe__heading[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .recipe__heading[_ngcontent-%COMP%]{color:1px solid #374a68}.recipe__group[_ngcontent-%COMP%]{padding-top:4px;padding-bottom:4px;border-top:1px solid #1c2a3f}.theme-light[_nghost-%COMP%]   .recipe__group[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .recipe__group[_ngcontent-%COMP%]{border-top:1px solid #eaeff5}"],changeDetection:0})}return s})();var bu=v(68114);const Cu=["tintColorRef"],yu=["saturationRef"],ku=["contrastRef"],Tu=["brightnessRef"],Su=["opacityRef"];class hn{constructor(i,t,n){this.formBuilder=i,this.store=t,this.changeDetector=n,this.paintBrushMode=bu.u,this.ngUnsubscribe=new f.B;const{tintColor:o,saturation:a,contrast:r,brightness:p,opacity:x}=this.store.selectSnapshot(L.i.getCurrentRecipe),N=this.store.selectSnapshot(L.i.getPaintBrushMode);this.form=this.formBuilder.group({tintColorEnabled:this.isColorValueEnabled(o),saturationEnabled:this.isColorValueEnabled(a),contrastEnabled:this.isColorValueEnabled(r),brightnessEnabled:this.isColorValueEnabled(p),opacityEnabled:this.isColorValueEnabled(x),paintBrushMode:N})}ngOnInit(){this.colorRecipe$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.colorRecipe=i,this.changeDetector.markForCheck()}),this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleFormChanges(i)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFormChanges(i){this.handleRecipeUpdates({tintColor:this.tintColorRef.value,saturation:this.saturationRef.value,contrast:this.contrastRef.value,brightness:this.brightnessRef.value,opacity:this.opacityRef.value}),this.store.dispatch(new Q.GG(i.paintBrushMode))}handleTintColorUpdates(i){this.colorRecipe={...this.colorRecipe,tintColor:i},this.isFeatureEnabled("tintColor")&&this.handleRecipeUpdates(this.colorRecipe)}handleOpacityUpdates(i){this.colorRecipe={...this.colorRecipe,opacity:i},this.isFeatureEnabled("opacity")&&this.handleRecipeUpdates(this.colorRecipe)}handleContrastUpdates(i){this.colorRecipe={...this.colorRecipe,contrast:i},this.isFeatureEnabled("contrast")&&this.handleRecipeUpdates(this.colorRecipe)}handleBrightnessUpdates(i){this.colorRecipe={...this.colorRecipe,brightness:i},this.isFeatureEnabled("brightness")&&this.handleRecipeUpdates(this.colorRecipe)}handleSaturationUpdates(i){this.colorRecipe={...this.colorRecipe,saturation:i},this.isFeatureEnabled("saturation")&&this.handleRecipeUpdates(this.colorRecipe)}handleRecipeUpdates(i){const t=this.store.selectSnapshot(L.i.getCurrentRecipe),{tintColor:n,saturation:o,contrast:a,brightness:r,opacity:p}=i,x={tintColor:this.isFeatureEnabled("tintColor")?n||[1,0,0]:void 0,saturation:this.isFeatureEnabled("saturation")?o||0:void 0,contrast:this.isFeatureEnabled("contrast")?a||0:void 0,brightness:this.isFeatureEnabled("brightness")?r||0:void 0,opacity:this.isFeatureEnabled("opacity")?p||100:void 0};(0,R.isEqual)(x,t)||this.store.dispatch(new Q.WD(x))}isFeatureEnabled(i){return!0===this.form.get(`${i}Enabled`).value}isColorValueEnabled(i){return!(0,R.isNil)(i)&&!1!==i}static#e=this.\u0275fac=function(t){return new(t||hn)(e.rXU(c.ze),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:hn,selectors:[["app-paint-widget-advanced"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Cu,7),e.GBs(yu,7),e.GBs(ku,7),e.GBs(Tu,7),e.GBs(Su,7)),2&t){let o;e.mGM(o=e.lsd())&&(n.tintColorRef=o.first),e.mGM(o=e.lsd())&&(n.saturationRef=o.first),e.mGM(o=e.lsd())&&(n.contrastRef=o.first),e.mGM(o=e.lsd())&&(n.brightnessRef=o.first),e.mGM(o=e.lsd())&&(n.opacityRef=o.first)}},inputs:{label:"label"},decls:16,vars:26,consts:[["tintColorRef",""],["opacityRef",""],["saturationRef",""],["contrastRef",""],["brightnessRef",""],["autocomplete","off",3,"formGroup"],["label","Color","toggleType","checkbox","formControlName","tintColorEnabled"],["simpleMode","rgb","fresnelMode","color",3,"valueUpdated","value","min","max","fresnelMin","fresnelMax"],["label","Opacity","toggleType","checkbox","formControlName","opacityEnabled"],[3,"valueUpdated","value","min","max","fresnelMin","fresnelMax"],["label","Saturation","toggleType","checkbox","formControlName","saturationEnabled"],["label","Contrast","toggleType","checkbox","formControlName","contrastEnabled"],["label","Brightness","toggleType","checkbox","formControlName","brightnessEnabled"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"form",5)(1,"app-panel",6)(2,"app-paint-recipe",7,0),e.bIt("valueUpdated",function(r){return e.eBV(o),e.Njj(n.handleTintColorUpdates(r))}),e.k0s()(),e.j41(4,"app-panel",8)(5,"app-paint-recipe",9,1),e.bIt("valueUpdated",function(r){return e.eBV(o),e.Njj(n.handleOpacityUpdates(r))}),e.k0s()(),e.j41(7,"app-panel",10)(8,"app-paint-recipe",9,2),e.bIt("valueUpdated",function(r){return e.eBV(o),e.Njj(n.handleSaturationUpdates(r))}),e.k0s()(),e.j41(10,"app-panel",11)(11,"app-paint-recipe",9,3),e.bIt("valueUpdated",function(r){return e.eBV(o),e.Njj(n.handleContrastUpdates(r))}),e.k0s()(),e.j41(13,"app-panel",12)(14,"app-paint-recipe",9,4),e.bIt("valueUpdated",function(r){return e.eBV(o),e.Njj(n.handleBrightnessUpdates(r))}),e.k0s()()()}2&t&&(e.Y8G("formGroup",n.form),e.R7$(2),e.Y8G("value",n.colorRecipe.tintColor)("min",0)("max",255)("fresnelMin",0)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.opacity)("min",0)("max",100)("fresnelMin",0)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.saturation)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.contrast)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100),e.R7$(3),e.Y8G("value",n.colorRecipe.brightness)("min",-100)("max",100)("fresnelMin",-100)("fresnelMax",100))},dependencies:[c.qT,c.BC,c.cb,c.j4,c.JD,me.g,gu],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(L.i.getCurrentRecipe),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],hn.prototype,"colorRecipe$",void 0);var xu=v(43654),Eu=v(15913);const dt={tintColor:[1,1,1],opacity:100,contrast:0,brightness:0,saturation:0};function Ru(s,i){1&s&&(e.j41(0,"div",10)(1,"span",11),e.EFF(2,"Note:"),e.k0s(),e.EFF(3," The preset you have selected contains some settings that cannot be customized. "),e.k0s())}function Pu(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-form-field",12)(1,"input",13),e.bIt("colorPickerChange",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleColorPickerChange(o))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.xc7("background",t.colorPickerHex),e.Y8G("colorPicker",t.colorPickerHex)("cpOutputFormat","hex")("cpAlphaChannel","disabled")("cpEyeDropper",!0)}}function ju(s,i){1&s&&(e.j41(0,"app-form-field",14),e.nrm(1,"app-slider",15),e.k0s()),2&s&&(e.R7$(),e.Y8G("min",0)("max",100))}class fn{constructor(i,t,n){this.formBuilder=i,this.store=t,this.changeDetector=n,this.colorPickerHex="#ffffff",this.fresnelColor=!1,this.fresnelOpacity=!1,this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({tintColor:[[...dt.tintColor]],saturation:[dt.saturation],contrast:[dt.contrast],brightness:[dt.brightness],opacity:[dt.opacity]})}ngOnInit(){this.colorRecipe$.pipe((0,I.p)(i=>null!=i&&JSON.stringify(i)!==JSON.stringify(this.colorRecipe),(0,y.Q)(this.ngUnsubscribe))).subscribe(i=>{this.colorRecipe=i,this.fresnelColor=i.tintColor instanceof ya.m,this.fresnelOpacity=i.opacity instanceof ka.R,this.setFormValues(i),this.changeDetector.markForCheck()}),this.form.valueChanges.pipe((0,Eu.s)(()=>(0,xu.O)(300)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleFormChanges(i)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(i){let t=dt.tintColor;Array.isArray(i.tintColor)&&(this.colorPickerHex=ae.T.rgbToHex(i.tintColor,!0),t=i.tintColor);let n=dt.opacity;"number"==typeof i.opacity&&(n=i.opacity);let o=dt.contrast;"number"==typeof i.contrast&&(o=i.contrast);let a=dt.brightness;"number"==typeof i.brightness&&(a=i.brightness);let r=dt.saturation;"number"==typeof i.saturation&&(r=i.saturation),this.form.setValue({tintColor:t,saturation:r,contrast:o,brightness:a,opacity:n},{emitEvent:!1,onlySelf:!0})}handleFormChanges(i){const t={...this.colorRecipe};t.saturation=i.saturation,t.brightness=i.brightness,t.contrast=i.contrast,this.fresnelOpacity||(t.opacity=i.opacity),this.fresnelColor||(t.tintColor="string"==typeof i.tintColor?ae.T.hexToRgb(i.tintColor,!0):i.tintColor),this.store.dispatch(new Q.WD(t))}handleColorPickerChange(i){this.colorPickerHex=i,this.form.patchValue({tintColor:ae.T.hexToRgb(i,!0)})}static#e=this.\u0275fac=function(t){return new(t||fn)(e.rXU(c.ze),e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:fn,selectors:[["app-paint-widget"]],inputs:{label:"label"},decls:10,vars:10,consts:[["autocomplete","off",3,"formGroup"],["class","pb-4 text-xs text-gray-400",4,"ngIf"],["label","Color",4,"ngIf"],["label","Opacity",4,"ngIf"],["label","Saturation"],["formControlName","saturation",3,"min","max"],["label","Contrast"],["formControlName","contrast",3,"min","max"],["label","Brightness"],["formControlName","brightness",3,"min","max"],[1,"pb-4","text-xs","text-gray-400"],[1,"font-bold"],["label","Color"],["type","text","cpPosition","left","readonly","",1,"input",3,"colorPickerChange","colorPicker","cpOutputFormat","cpAlphaChannel","cpEyeDropper"],["label","Opacity"],["formControlName","opacity",3,"min","max"]],template:function(t,n){1&t&&(e.j41(0,"form",0),e.DNE(1,Ru,4,0,"div",1)(2,Pu,2,6,"app-form-field",2)(3,ju,2,2,"app-form-field",3),e.j41(4,"app-form-field",4),e.nrm(5,"app-slider",5),e.k0s(),e.j41(6,"app-form-field",6),e.nrm(7,"app-slider",7),e.k0s(),e.j41(8,"app-form-field",8),e.nrm(9,"app-slider",9),e.k0s()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.fresnelColor||n.fresnelOpacity),e.R7$(),e.Y8G("ngIf",!n.fresnelColor),e.R7$(),e.Y8G("ngIf",!n.fresnelOpacity),e.R7$(2),e.Y8G("min",-100)("max",100),e.R7$(2),e.Y8G("min",-100)("max",100),e.R7$(2),e.Y8G("min",-100)("max",100))},dependencies:[w.bT,Ai.bk,c.qT,c.BC,c.cb,c.j4,c.JD,Z.K,Ve],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(L.i.getCurrentRecipe),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],fn.prototype,"colorRecipe$",void 0);var Yo=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},zo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Mu(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",i.$implicit)}function Iu(s,i){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}function Nu(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",i.$implicit)}function Bu(s,i){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}function Du(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleRecipeClick(o))}),e.k0s()}2&s&&e.Y8G("engineRecipe",i.$implicit)}function Gu(s,i){1&s&&(e.j41(0,"div",17)(1,"span",18),e.EFF(2,"No Brushes Found"),e.k0s()())}class Wt{constructor(i,t){this.store=i,this.editPaintService=t,this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleRecipeClick(i){const t=(0,lt.H)(i);this.store.dispatch(new Q.Hr),this.store.dispatch(new Q.WD(t)),this.store.dispatch(new ie.pL(H.s.Paint))}handleExport(i){const t=this.store.selectSnapshot(E.t.getStory).displayName||"Story Palette",n=this.store.selectSnapshot(L.i.getUniqueStoryRecipes).map(a=>(0,lt.H)(a)),o=new to(t);o.recipes=n,"copy"===i?this.editPaintService.copyPaletteToClipboard(o):this.editPaintService.downloadPalette(o)}static#e=this.\u0275fac=function(t){return new(t||Wt)(e.rXU(l.il),e.rXU(io))};static#t=this.\u0275cmp=e.VBU({type:Wt,selectors:[["app-paint-currently-used"]],decls:33,vars:21,consts:[["menu","matMenu"],["toggleType","arrow",3,"noPadding","open"],["panel-label","",1,"font-semibold","px-3","py-2"],[1,"font-semibold","flex","items-center",2,"min-height","36px"],["panel-actions","","appEventFence","",1,"py-2"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[1,"px-3","pb-2"],["tabSize","small","tabTheme","dark"],["label","This Model"],[1,"paint-currently-used","px-1"],["app-paint-swatch","","class","mr-2 mb-2",3,"engineRecipe","click",4,"ngFor","ngForOf"],["class","p-2",4,"ngIf"],["label","This Chapter"],["label","Recent"],["mat-menu-item","",3,"click"],["app-paint-swatch","",1,"mr-2","mb-2",3,"click","engineRecipe"],[1,"p-2"],[1,"text-2xs","text-gray-400","italic"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-panel",1)(1,"div",2)(2,"div",3),e.EFF(3,"Recent"),e.k0s()(),e.j41(4,"div",4)(5,"button",5),e.nrm(6,"app-icon",6),e.k0s()(),e.j41(7,"div",7)(8,"app-tabs",8)(9,"app-tab",9)(10,"div",10),e.DNE(11,Mu,1,1,"button",11),e.nI1(12,"async"),e.k0s(),e.DNE(13,Iu,3,0,"div",12),e.nI1(14,"async"),e.k0s(),e.j41(15,"app-tab",13)(16,"div",10),e.DNE(17,Nu,1,1,"button",11),e.nI1(18,"async"),e.k0s(),e.DNE(19,Bu,3,0,"div",12),e.nI1(20,"async"),e.k0s(),e.j41(21,"app-tab",14)(22,"div",10),e.DNE(23,Du,1,1,"button",11),e.nI1(24,"async"),e.k0s(),e.DNE(25,Gu,3,0,"div",12),e.nI1(26,"async"),e.k0s()()()(),e.j41(27,"mat-menu",null,0)(29,"button",15),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleExport("copy"))}),e.EFF(30," Copy this model's palette to clipboard "),e.k0s(),e.j41(31,"button",15),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleExport("download"))}),e.EFF(32,"Download this model's palette"),e.k0s()()}if(2&t){let o,a,r;const p=e.sdS(28);e.Y8G("noPadding",!0)("open",!0),e.R7$(5),e.Y8G("matMenuTriggerFor",p),e.R7$(6),e.Y8G("ngForOf",e.bMT(12,9,n.uniqueStoryRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(o=e.bMT(14,11,n.uniqueStoryRecipes$))&&o.length)),e.R7$(4),e.Y8G("ngForOf",e.bMT(18,13,n.chapterRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(a=e.bMT(20,15,n.chapterRecipes$))&&a.length)),e.R7$(4),e.Y8G("ngForOf",e.bMT(24,17,n.recentRecipes$)),e.R7$(2),e.Y8G("ngIf",!(null!=(r=e.bMT(26,19,n.recentRecipes$))&&r.length))}},dependencies:[w.Sq,w.bT,D.kk,D.fb,D.Cp,Y.Q,Xi.L,X.R,jt.j,Mt.O,me.g,Tt,w.Jj],styles:[".paint-currently-used[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"],changeDetection:0})}Yo([(0,l.l6)(L.i.getRecentRecipes),zo("design:type",_.c)],Wt.prototype,"recentRecipes$",void 0),Yo([(0,l.l6)(L.i.getUniqueStoryRecipes),zo("design:type",_.c)],Wt.prototype,"uniqueStoryRecipes$",void 0),Yo([(0,l.l6)(L.i.getCurrentChapterRecipes),zo("design:type",_.c)],Wt.prototype,"chapterRecipes$",void 0);var Ci=v(76774);let Xo=(()=>{class s{constructor(t){this.store=t}duplicateChapter(t){const n=(0,Os.G)(),a=this.store.selectSnapshot(G.B.particleSystemsForChapter(t.id)).map(W=>new le.u.AssignParticle(W.id,n));this.store.dispatch(a);const r=this.store.selectSnapshot(G.B.getTweenParticleLookup)[t.id];void 0!==r&&this.store.dispatch(new le.u.SetLookupForChapter(n,r)),this.store.selectSnapshot($e.y.getChapterLabels).forEach(W=>{this.store.dispatch(new ke.Sh({...(0,R.cloneDeep)(W),id:it.u.idWithPrefix("label"),chapterId:n},!1))}),this.store.selectSnapshot(he.j.getQuizQuestionsByChapter(t.id)).forEach(W=>{const Se=it.u.idWithPrefix("question"),Le=(0,Ci.z9)(W,Se,n);this.store.dispatch(new Re.B.AddQuestion(Le))});const z=this.store.selectSnapshot(E.t.getStory);this.store.dispatch([new re.q9(!1),new re.rg(t.id,n),new U.PA(z,t,n)])}removeChapter(t){void 0!==this.store.selectSnapshot(G.B.getTweenParticleLookup)[t.id]&&this.store.dispatch(new le.u.DeleteChapterLookup(t.id)),this.store.dispatch(new U.YA(t))}static#e=this.\u0275fac=function(n){return new(n||s)(e.KVO(l.il))};static#t=this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function $u(s,i){if(1&s&&(e.j41(0,"tr")(1,"td",6),e.EFF(2),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.JRh(t.recipe.label)}}function Ou(s,i){if(1&s&&(e.j41(0,"tr")(1,"td",7),e.EFF(2),e.k0s(),e.j41(3,"td",8),e.EFF(4),e.k0s()()),2&s){const t=i.$implicit;e.R7$(2),e.JRh(t.label),e.R7$(2),e.JRh(t.value)}}let Au=(()=>{class s{get recipe(){return this._recipe}set recipe(t){this._recipe=t,this.values=this.recipe?this.getValues(this.recipe):[]}constructor(){this.values=[]}ngOnInit(){}getValues(t){return[{label:"Color",value:He(t.tintColor)},{label:"Saturation",value:He(t.saturation)},{label:"Contrast",value:He(t.contrast)},{label:"Brightness",value:He(t.brightness)},{label:"Opacity",value:He(t.opacity)}].filter(n=>""!=n.value)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-recipe-summary"]],inputs:{recipe:"recipe"},decls:6,vars:4,consts:[[1,"edit-recipe-summary"],["size","large",3,"recipe","highlightSelected"],[1,"edit-recipe-summary__details"],[1,"w-full"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","2",1,"px-2","pb-1","italic"],[1,"px-2","pb-1","w-1/2","font-semibold"],[1,"px-1","pb-1","w-1/2"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.nrm(1,"app-paint-swatch",1),e.j41(2,"div",2)(3,"table",3),e.DNE(4,$u,3,1,"tr",4)(5,Ou,5,2,"tr",5),e.k0s()()()),2&n&&(e.R7$(),e.Y8G("recipe",o.recipe)("highlightSelected",!1),e.R7$(3),e.Y8G("ngIf",o.recipe.label),e.R7$(),e.Y8G("ngForOf",o.values))},dependencies:[w.Sq,w.bT,Tt],styles:[".edit-recipe-summary[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px 0;align-items:flex-start;font-size:.625rem;line-height:.75rem}.edit-recipe-summary__details[_ngcontent-%COMP%]{flex-grow:1;max-height:160px;overflow-y:auto}.theme-light[_nghost-%COMP%]   .edit-recipe-summary[_ngcontent-%COMP%], .theme-light   [_nghost-%COMP%]   .edit-recipe-summary[_ngcontent-%COMP%]{color:#101823}"],changeDetection:0})}return s})();function Lu(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleAddToPalette(o))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit;e.R7$(),e.SpI(" Add to ",t.label," ")}}function Yu(s,i){1&s&&e.nrm(0,"mat-divider")}class gn{get recipe(){return this._recipe}set recipe(i){this._recipe=i}constructor(i,t,n,o){this.store=i,this.dialog=t,this.snackbar=n,this.editService=o,this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleAddToPalette(i){this.store.dispatch(new Q.yJ(this.recipe,i.id)),this.store.dispatch(new Q.wx(i.id,!0)),this.snackbar.open(`Successfully added to '${i.label}' palette.`)}handleNewPalette(){const i=new to;i.recipes.push(this.recipe),this.dialog.open(Lo,{width:"480px",data:{palette:i}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(n=>!(0,R.isNil)(n))).subscribe(n=>{this.store.dispatch(new Q.hd(n))})}static#e=this.\u0275fac=function(t){return new(t||gn)(e.rXU(l.il),e.rXU(ee.bZ),e.rXU(Qe.UG),e.rXU(Xo))};static#t=this.\u0275cmp=e.VBU({type:gn,selectors:[["app-edit-paint-panel"]],inputs:{recipe:"recipe"},decls:13,vars:8,consts:[["paletteMenu","matMenu"],[1,"edit-paint-panel"],[1,"grow",3,"recipe"],[1,"flex","flex-col"],["app-button","","buttonType","outline","buttonSize","sm","buttonShape","square","matTooltip","Add to Palette","matTooltipPosition","above","data-test","addToPaletteButton",1,"pb-2",3,"matMenuTriggerFor"],["icon","plus"],["yPosition","above"],["mat-menu-item","","data-test","addToExistingPalette",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-menu-item","","data-test","addPaintToNewPaletteButton",3,"click"],["mat-menu-item","","data-test","addToExistingPalette",3,"click"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",1),e.nrm(1,"app-edit-recipe-summary",2),e.j41(2,"div",3)(3,"button",4),e.nrm(4,"app-icon",5),e.k0s()()(),e.j41(5,"mat-menu",6,0),e.DNE(7,Lu,2,1,"button",7),e.nI1(8,"async"),e.DNE(9,Yu,1,0,"mat-divider",8),e.nI1(10,"async"),e.j41(11,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleNewPalette())}),e.EFF(12," Add to New Palette... "),e.k0s()()}if(2&t){let o;const a=e.sdS(6);e.R7$(),e.Y8G("recipe",n.recipe),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(4),e.Y8G("ngForOf",e.bMT(8,4,n.palettes$)),e.R7$(2),e.Y8G("ngIf",null==(o=e.bMT(10,6,n.palettes$))?null:o.length)}},dependencies:[w.Sq,w.bT,D.kk,D.fb,D.Cp,Ce.oV,Je.q,Y.Q,X.R,Au,w.Jj],styles:[".edit-paint-panel[_ngcontent-%COMP%]{color:#fff;display:flex;padding:8px 12px;align-items:flex-start}.edit-paint-panel__list[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px;font-size:.625rem;line-height:.75rem;column-count:2;column-gap:8px;column-width:50%}.edit-paint-panel__item[_ngcontent-%COMP%]{padding-bottom:4px}"],changeDetection:0})}function zu(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleRecipeClick(o))}),e.k0s()}if(2&s){const t=i.$implicit;e.Y8G("label",t.label)("recipe",t)}}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(L.i.getPalettes),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],gn.prototype,"palettes$",void 0);let Xu=(()=>{class s{get palette(){return this._palette}set palette(t){this._palette=t}constructor(t,n,o){this.dialog=t,this.store=n,this.editPaintService=o,this.ngUnsubscribe=new f.B}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleEdit(t){this.dialog.open(Lo,{width:"480px",data:{palette:t}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(o=>!(0,R.isNil)(o))).subscribe(o=>{this.store.dispatch(new Q.ut(o))})}handleRemove(t){this.editPaintService.removePalette(t)}handleExport(t){this.editPaintService.copyPaletteToClipboard(t)}handleDownload(t){this.editPaintService.downloadPalette(t)}handlePanelOpened(t,n){const o=this.store.selectSnapshot(L.i.getPalettes),a=o.findIndex(r=>r.id===n);a>=0&&(o[a].open=t),this.store.dispatch(new Q.T2(o))}handleRecipeClick(t){this.editPaintService.selectRecipe(t)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(ee.bZ),e.rXU(l.il),e.rXU(io))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-palette-panel"]],inputs:{palette:"palette"},decls:20,vars:6,consts:[["menu","matMenu"],["toggleType","arrow","data-test","palettePanel",3,"opened","open","noPadding"],["panel-label","",1,"font-semibold","px-3","py-2"],["data-test","palettePanelLabel"],["panel-actions","","appEventFence","",1,"py-2"],["app-button","","data-test","palettePanelMenuButton",3,"matMenuTriggerFor"],["icon","ellipsis-v"],[1,"flex","flex-wrap","px-3","pb-2"],["app-paint-swatch","","class","mr-2 mb-2",3,"label","recipe","click",4,"ngFor","ngForOf"],["mat-menu-item","","data-test","palettePanelEditButton",3,"click"],["mat-menu-item","","data-test","palettePanelRemoveButton",3,"click"],["mat-menu-item","","data-test","palettePanelCopyButton",3,"click"],["mat-menu-item","","data-test","palettePanelDownloadButton",3,"click"],["app-paint-swatch","",1,"mr-2","mb-2",3,"click","label","recipe"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-panel",1),e.bIt("opened",function(p){return e.eBV(a),e.Njj(o.handlePanelOpened(p,o.palette.id))}),e.j41(1,"div",2)(2,"span",3),e.EFF(3),e.k0s()(),e.j41(4,"div",4)(5,"button",5),e.nrm(6,"app-icon",6),e.k0s()(),e.j41(7,"div",7),e.DNE(8,zu,1,2,"button",8),e.k0s()(),e.j41(9,"mat-menu",null,0)(11,"button",9),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleEdit(o.palette))}),e.EFF(12," Manage Palette... "),e.k0s(),e.j41(13,"button",10),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleRemove(o.palette))}),e.EFF(14," Remove... "),e.k0s(),e.nrm(15,"mat-divider"),e.j41(16,"button",11),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleExport(o.palette))}),e.EFF(17," Copy palette to clipboard "),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleDownload(o.palette))}),e.EFF(19," Download palette "),e.k0s()()}if(2&n){const a=e.sdS(10);e.Y8G("open",o.palette.open)("noPadding",!0),e.BMQ("data-test-value",o.palette.id),e.R7$(3),e.JRh(o.palette.label),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(3),e.Y8G("ngForOf",o.palette.recipes)}},dependencies:[w.Sq,D.kk,D.fb,D.Cp,Je.q,Y.Q,Xi.L,X.R,me.g,Tt],styles:[".palette__button[_ngcontent-%COMP%]{cursor:pointer;width:24px;height:24px;display:inline-flex;justify-content:center;align-items:center;background:none;border:none;margin:0;padding:0}"],changeDetection:0})}return s})();var yi=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},ki=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Qu(s,i){1&s&&e.nrm(0,"app-edit-palette-panel",20),2&s&&e.Y8G("palette",i.$implicit)}function qu(s,i){1&s&&e.nrm(0,"app-paint-widget")}function Hu(s,i){if(1&s&&(e.j41(0,"app-column-group",21,1),e.qex(2,13),e.j41(3,"div",22),e.DNE(4,qu,1,0,"app-paint-widget",19),e.k0s(),e.bVm(),e.k0s()),2&s){const t=e.sdS(1);e.R7$(4),e.Y8G("ngIf",t.isActive)}}function Wu(s,i){1&s&&e.nrm(0,"app-paint-widget-advanced")}function Ju(s,i){if(1&s&&(e.j41(0,"app-column-group",21,2),e.qex(2,13),e.DNE(3,Wu,1,0,"app-paint-widget-advanced",19),e.bVm(),e.k0s()),2&s){const t=e.sdS(1);e.R7$(3),e.Y8G("ngIf",t.isActive)}}function Ku(s,i){if(1&s&&(e.nrm(0,"app-edit-paint-panel",23),e.nI1(1,"async")),2&s){const t=e.XpG();e.Y8G("recipe",e.bMT(1,1,t.currentRecipe$))}}function Zu(s,i){if(1&s){const t=e.RV6();e.qex(0),e.nrm(1,"app-selected-nodes-panel"),e.j41(2,"button",24),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handlePaintNodesClick())}),e.EFF(3," Apply Paint "),e.k0s(),e.bVm()}}class mt{constructor(i,t,n,o,a){this.store=i,this.actions=t,this.changeDetector=n,this.editPaintService=o,this.nodeService=a,this.activeToolEnum=H.s,this.application=Me.c,this.ngUnsubscribe=new f.B}ngOnInit(){this.initInitialRecipe(),this.bindApplicationEvents()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initInitialRecipe(){null==this.store.selectSnapshot(L.i.getCurrentRecipe)&&this.store.dispatch(new Q.WD(Ht.Rn))}bindApplicationEvents(){this.actions.pipe((0,l.xi)(ie.zE),(0,I.p)(()=>{const i=this.store.selectSnapshot(S.S.getActiveTool);return[H.s.Paint,H.s.Eyedropper].includes(i)}),(0,I.p)(i=>null!=i.node&&!i.event.srcEvent.shiftKey),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{switch(this.store.selectSnapshot(S.S.getActiveTool)){case H.s.Eyedropper:this.handleEyeDropperNodeClicked(i);break;case H.s.Paint:this.handlePaintNodeClicked(i)}}),this.selectedChapter$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.interactive=i.readyState.model,this.changeDetector.markForCheck()})}handleRecipeClick(i){this.editPaintService.selectRecipe(i)}handleClickTool(i){this.store.dispatch(new ie.pL(i))}handleClearChapterPaint(){const i=this.store.selectSnapshot(ye.z.getNodeIds);this.store.dispatch(new re.Jp(Ht.NR,i))}handleImportPalette(){this.editPaintService.openImportPalette()}handlePaintNodesClick(){const i=this.store.selectSnapshot(ye.z.getCheckedNodeIds);this.nodeService.applyCurrentRecipe(i)}handleEyeDropperNodeClicked(i){const t=this.store.selectSnapshot(ye.z.getNodePaint)(i.node.id),n=(0,lt.Sf)(t);(0,pi.Jl)(n)?this.store.dispatch(new Q.WD(t)):this.store.dispatch(new Q.WD(Ht.NR))}handlePaintNodeClicked(i){this.nodeService.applyCurrentRecipe([i.node.id])}handleNext(){this.store.dispatch(new P.$j)}handlePrevious(){this.store.dispatch(new P.hE)}handleEyedropperClick(){const i=this.store.selectSnapshot(S.S.getActiveTool)===H.s.Eyedropper?H.s.Paint:H.s.Eyedropper;this.store.dispatch(new ie.pL(i))}static#e=this.\u0275fac=function(t){return new(t||mt)(e.rXU(l.il),e.rXU(l.En),e.rXU(e.gRc),e.rXU(io),e.rXU(ea.w))};static#t=this.\u0275cmp=e.VBU({type:mt,selectors:[["app-edit-paint-context"]],decls:30,vars:16,consts:[["paintMenu","matMenu"],["customColorGroup",""],["advancedColorGroup",""],[3,"loading"],["column-label",""],["column-actions",""],["app-button","",3,"click","buttonType"],["icon","eye-dropper"],["app-button","","data-test","paintMenuButton",1,"context__actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","importPaletteButton",3,"click"],["label","Paints"],["column-group-body",""],[3,"palette",4,"ngFor","ngForOf"],["label","Customize",4,"appFlagApplication"],["column-footer",""],[1,"pb-4","ph-4"],[3,"recipe",4,"ngIf"],[4,"ngIf"],[3,"palette"],["label","Customize"],[1,"p-3"],[3,"recipe"],["buttonType","outline","app-button","","data-test","applyPaintButton",1,"w-full","mt-2",3,"click"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-column",3)(1,"div",4),e.EFF(2,"Paint"),e.k0s(),e.j41(3,"div",5)(4,"button",6),e.nI1(5,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleEyedropperClick())}),e.nrm(6,"app-icon",7),e.k0s(),e.j41(7,"button",8),e.nrm(8,"app-icon",9),e.k0s(),e.j41(9,"mat-menu",null,0)(11,"button",10),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleClearChapterPaint())}),e.EFF(12,"Clear this chapter's paint"),e.k0s(),e.nrm(13,"mat-divider"),e.j41(14,"button",11),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleImportPalette())}),e.EFF(15," Import Palette... "),e.k0s()()(),e.j41(16,"app-column-group",12),e.qex(17,13),e.nrm(18,"app-paint-presets")(19,"app-paint-currently-used"),e.DNE(20,Qu,1,1,"app-edit-palette-panel",14),e.nI1(21,"async"),e.bVm(),e.k0s(),e.DNE(22,Hu,5,1,"app-column-group",15)(23,Ju,4,1,"app-column-group",15),e.j41(24,"div",16)(25,"div",17),e.DNE(26,Ku,2,3,"app-edit-paint-panel",18),e.nI1(27,"async"),e.DNE(28,Zu,4,0,"ng-container",19),e.nI1(29,"async"),e.k0s()()()}if(2&t){const o=e.sdS(10);e.Y8G("loading",!n.interactive),e.R7$(4),e.Y8G("buttonType",e.bMT(5,8,n.activeTool$)===n.activeToolEnum.Eyedropper?"info":"default"),e.R7$(3),e.Y8G("matMenuTriggerFor",o),e.R7$(13),e.Y8G("ngForOf",e.bMT(21,10,n.palettes$)),e.R7$(2),e.Y8G("appFlagApplication",n.application.Studio),e.R7$(),e.Y8G("appFlagApplication",n.application.Loft),e.R7$(3),e.Y8G("ngIf",e.bMT(27,12,n.currentRecipe$)),e.R7$(2),e.Y8G("ngIf",e.bMT(29,14,n.checkedNodesCount$)>0)}},dependencies:[w.Sq,w.bT,D.kk,D.fb,D.Cp,Je.q,Y.Q,pt,at,Vi.Y,X.R,mn,un,hn,fn,Wt,gn,Xu,w.Jj],changeDetection:0})}yi([(0,l.l6)(S.S.getActiveTool),ki("design:type",_.c)],mt.prototype,"activeTool$",void 0),yi([(0,l.l6)(ye.z.getCheckedNodesCount),ki("design:type",_.c)],mt.prototype,"checkedNodesCount$",void 0),yi([(0,l.l6)(L.i.getCurrentRecipe),ki("design:type",_.c)],mt.prototype,"currentRecipe$",void 0),yi([(0,l.l6)(L.i.getPalettes),ki("design:type",_.c)],mt.prototype,"palettes$",void 0),yi([(0,l.l6)(j.N.getSelectedChapterId),ki("design:type",_.c)],mt.prototype,"selectedChapterId$",void 0),yi([(0,l.l6)(j.N.getSelectedChapter),ki("design:type",_.c)],mt.prototype,"selectedChapter$",void 0);var Qo=v(71441),bn=v(62751),qo=v(91003),Ho=v(15185),Ta=v(93455);function eh(s,i){1&s&&e.nrm(0,"app-spinner",9)}function th(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",7),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openPositions())}),e.EFF(1," Open Positions "),e.k0s()}}var Ti=function(s){return s.Starting="starting",s.Additional="additional",s}(Ti||{});let Wo=(()=>{class s{constructor(t,n,o){this.store=t,this.snackbar=n,this.positionsService=o,this.mode=Ti.Starting,this.buttonSize="md",this.openPositionsOption=!1,this.additionalPositionCaptured=new e.bkB,this.savingThumbnail=(0,e.vPA)(!1)}get tooltipText(){return this.mode===Ti.Starting?"Click to capture your starting position. When viewers enter the chapter, this is what they'll see.":""}handleCaptureClick(t,n){var o=this;return(0,A.A)(function*(){let a,r;const p=[];t&&(a=o.captureCamera(),p.push("position")),n&&(r=yield o.captureThumbnail(),p.push("thumbnail")),o.mode===Ti.Additional&&o.additionalPositionCaptured.emit({camera:a,thumbnail:r}),o.snackbar.open(`Successfully captured chapter ${o.mode} ${p.join(" and ")}.`)})()}openPositions(){this.store.dispatch(new ie.pL(H.s.Positions)),this.store.dispatch(new P.yF(M.x.Positions))}captureThumbnail(){var t=this;return(0,A.A)(function*(){if(t.mode!==Ti.Starting){t.savingThumbnail.set(!0);const n=yield t.positionsService.captureAdditionalPositionThumbnail(t.chapter.id),o=new Ta.V;return o.urls=n,t.savingThumbnail.set(!1),o}t.positionsService.captureStartingPositionThumbnail(t.chapter.id)})()}captureCamera(){if(this.mode!==Ti.Starting)return{...this.positionsService.getCamera(),action:bn.L.FlyTo};this.positionsService.captureStartingPositionCamera(this.chapter.id)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(l.il),e.rXU(Qe.UG),e.rXU(qo.c))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-capture-position"]],inputs:{mode:"mode",chapter:"chapter",buttonSize:"buttonSize",openPositionsOption:"openPositionsOption"},outputs:{additionalPositionCaptured:"additionalPositionCaptured"},decls:15,vars:8,consts:[["captureMenu","matMenu"],["render","block",1,"w-full"],["app-button","","buttonTheme","dark","buttonType","outline","matTooltipPosition","below","data-test","captureThumbnail",1,"grow",3,"click","buttonSize","matTooltip","disabled"],[1,"flex","items-center","justify-center"],["render","block","size","small","class","mr-2 theme-dark",4,"ngIf"],["app-button","","buttonTheme","dark","buttonType","outline","buttonShape","square",3,"buttonSize","matMenuTriggerFor","disabled"],["icon","caret-down"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["render","block","size","small",1,"mr-2","theme-dark"]],template:function(n,o){if(1&n){const a=e.RV6();e.j41(0,"app-button-group",1)(1,"button",2),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleCaptureClick(!0,!0))}),e.j41(2,"div",3),e.DNE(3,eh,1,0,"app-spinner",4),e.j41(4,"span"),e.EFF(5,"Capture"),e.k0s()()(),e.j41(6,"button",5),e.nrm(7,"app-icon",6),e.k0s()(),e.j41(8,"mat-menu",null,0)(10,"button",7),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleCaptureClick(!0,!1))}),e.EFF(11,"Capture Position Only"),e.k0s(),e.j41(12,"button",7),e.bIt("click",function(){return e.eBV(a),e.Njj(o.handleCaptureClick(!1,!0))}),e.EFF(13,"Capture Thumbnail Only"),e.k0s(),e.DNE(14,th,2,0,"button",8),e.k0s()}if(2&n){const a=e.sdS(9);e.R7$(),e.Y8G("buttonSize",o.buttonSize)("matTooltip",o.tooltipText)("disabled",o.savingThumbnail()),e.R7$(2),e.Y8G("ngIf",o.savingThumbnail()),e.R7$(3),e.Y8G("buttonSize",o.buttonSize)("matMenuTriggerFor",a)("disabled",o.savingThumbnail()),e.R7$(8),e.Y8G("ngIf",o.openPositionsOption)}},dependencies:[Y.Q,gi,w.bT,X.R,D.kk,D.fb,D.Cp,Ce.oV,ci.tI],changeDetection:0})}return s})();var Sa=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},xa=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const ih=["position"];function nh(s,i){1&s&&(e.j41(0,"div",11),e.EFF(1," Use the 3D controls to adjust your viewing angle as desired, and click "),e.j41(2,"span",12),e.EFF(3,"Add New Position"),e.k0s(),e.EFF(4," below to save. "),e.k0s())}function oh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",13,0)(2,"app-panel",14),e.bIt("opened",function(o){const a=e.eBV(t).index,r=e.XpG();return e.Njj(r.handleOpened(o,a))}),e.qex(3,15),e.j41(4,"div",16),e.nrm(5,"app-thumbnail-view",17),e.k0s(),e.bVm(),e.j41(6,"span",18)(7,"button",19),e.nrm(8,"app-icon",20),e.k0s(),e.j41(9,"mat-menu",null,1)(11,"button",21),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.copyPosition(o))}),e.EFF(12,"Copy Position"),e.k0s(),e.j41(13,"button",22),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.pastePosition(o))}),e.EFF(14," Paste Position "),e.k0s(),e.nrm(15,"mat-divider"),e.j41(16,"button",21),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.removePosition(o))}),e.EFF(17,"Remove"),e.k0s()()(),e.j41(18,"app-form-field",23),e.nrm(19,"input",24,2)(21,"app-character-counter",25),e.k0s(),e.j41(22,"app-capture-position",26),e.nI1(23,"async"),e.bIt("additionalPositionCaptured",function(o){const a=e.eBV(t).index,r=e.XpG();return e.Njj(r.handleAdditionalPositionCaptured(o,a))}),e.k0s()()()}if(2&s){const t=i.$implicit,n=i.index,o=e.sdS(10),a=e.sdS(20),r=e.XpG();e.Y8G("formGroup",t),e.R7$(2),e.Y8G("label",t.value.title)("open",n===r.openedIndex()),e.R7$(3),e.Y8G("thumbnail",t.value.thumbnail),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.Y8G("disabled",!r.additionalPositionClipboard()),e.R7$(6),e.Y8G("maxLength",60),e.R7$(2),e.Y8G("field",a),e.R7$(),e.Y8G("chapter",e.bMT(23,9,r.selectedChapter$))}}function sh(s,i){1&s&&e.nrm(0,"app-spinner",27)}class Si{get positionsBlockPositions(){return this.controlContainer.control.get("positions")}constructor(i,t,n,o,a){this.controlContainer=i,this.formBuilder=t,this.positionsService=n,this.snackbar=o,this.store=a,this.openedIndex=(0,e.vPA)(-1),this.savingThumbnail=(0,e.vPA)(!1),this.additionalPositionClipboard=(0,e.vPA)(this.positionsService.additionalPositionClipboard),this.ngUnsubscribe=new f.B}ngOnInit(){this.selectedChapterId$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.openedIndex.set(-1)})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}trackPositionsControls(i,t){return t.value.thumbnail.urls.large}handleImageDrop(i){const{previousIndex:t,currentIndex:n}=i,o=this.positionsBlockPositions.at(t);this.positionsBlockPositions.removeAt(t,{emitEvent:!1}),this.positionsBlockPositions.insert(n,o)}handleOpened(i,t){if(this.openedIndex.set(i?t:-1),i){const n=this.positionsBlockPositions.at(t).value;this.store.dispatch(new Ft.Ih(n.camera.location,n.camera.action===bn.L.FlyTo,void 0,n.camera.rotationCenter))}}handleAdditionalPositionCaptured(i,t){const{camera:n,thumbnail:o}=i,a=this.positionsBlockPositions.at(t);if(n&&a.patchValue({camera:n},{emitEvent:!o}),o){const{urls:r}=o;a.get("thumbnail").patchValue({urls:r},{emitEvent:!0})}}copyPosition(i){const t=this.positionsBlockPositions.at(i).value;this.positionsService.copyAdditionalPosition(t),this.additionalPositionClipboard.set(this.positionsService.additionalPositionClipboard),this.snackbar.open("Copied additional position.")}pastePosition(i){this.additionalPositionClipboard()&&(this.positionsBlockPositions.at(i).patchValue({...this.additionalPositionClipboard()}),this.positionsService.additionalPositionClipboard=null,this.additionalPositionClipboard.set(null),this.snackbar.open("Additional position successfully pasted."))}removePosition(i){this.positionsBlockPositions.removeAt(i)}addPosition(){var i=this;return(0,A.A)(function*(){const t=yield i.createNewPosition();i.positionsBlockPositions.push(i.formBuilder.group({title:[t.title,c.k0.maxLength(60)],thumbnail:i.formBuilder.group({urls:t.thumbnail.urls}),camera:t.camera})),setTimeout(()=>{i.positions.last.nativeElement.scrollIntoView(),i.handleOpened(!0,i.positionsBlockPositions.length-1)},0)})()}createNewPosition(){var i=this;return(0,A.A)(function*(){i.savingThumbnail.set(!0);const t=yield i.positionsService.captureAdditionalPositionThumbnail(i.store.selectSnapshot(j.N.getSelectedChapterId));i.savingThumbnail.set(!1);const n=new Ta.V;n.urls=t;const o=i.positionsService.getCamera(),a=new Qo.q,r=`Position ${i.positionsBlockPositions.length+1}`;return a.camera={...o,action:bn.L.FlyTo},a.title=r,a.thumbnail=n,a})()}static#e=this.\u0275fac=function(t){return new(t||Si)(e.rXU(c.ZU),e.rXU(c.ze),e.rXU(qo.c),e.rXU(Qe.UG),e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:Si,selectors:[["app-edit-positions-block"]],viewQuery:function(t,n){if(1&t&&e.GBs(ih,5),2&t){let o;e.mGM(o=e.lsd())&&(n.positions=o)}},decls:10,vars:6,consts:[["position",""],["labelMenu","matMenu"],["title",""],[3,"formGroup"],["class","my-3 ml-3 text-xs",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical","formArrayName","positions",3,"cdkDropListDropped"],["cdkDrag","","class","edit-block",3,"formGroup",4,"ngFor","ngForOf","ngForTrackBy"],[1,"edit-positions-block__add"],["app-button","","buttonType","flat",1,"w-full",3,"click","disabled"],[1,"flex","items-center","justify-center"],["render","block","size","small","class","mr-2 theme-dark",4,"ngIf"],[1,"my-3","ml-3","text-xs"],[1,"font-bold"],["cdkDrag","",1,"edit-block",3,"formGroup"],["toggleType","arrow",3,"opened","label","open"],["panel-prefix",""],[1,"edit-block__thumbnail"],[3,"thumbnail"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],["label","Title"],["type","text","formControlName","title","placeholder","Enter a response",1,"input",3,"maxLength"],[3,"field"],["buttonSize","md","mode","additional",1,"flex","w-full","mt-4",3,"additionalPositionCaptured","chapter"],["render","block","size","small",1,"mr-2","theme-dark"]],template:function(t,n){1&t&&(e.qex(0,3),e.DNE(1,nh,5,0,"div",4),e.j41(2,"div",5),e.bIt("cdkDropListDropped",function(a){return n.handleImageDrop(a)}),e.DNE(3,oh,24,11,"div",6),e.k0s(),e.j41(4,"div",7)(5,"button",8),e.bIt("click",function(){return n.addPosition()}),e.j41(6,"div",9),e.DNE(7,sh,1,0,"app-spinner",10),e.j41(8,"span"),e.EFF(9,"Add New Position"),e.k0s()()()(),e.bVm()),2&t&&(e.Y8G("formGroup",n.controlContainer.control),e.R7$(),e.Y8G("ngIf",0===n.positionsBlockPositions.controls.length),e.R7$(2),e.Y8G("ngForOf",n.positionsBlockPositions.controls)("ngForTrackBy",n.trackPositionsControls),e.R7$(2),e.Y8G("disabled",n.savingThumbnail()),e.R7$(2),e.Y8G("ngIf",n.savingThumbnail()))},dependencies:[w.Sq,w.bT,c.me,c.BC,c.cb,c.j4,c.JD,c.v8,Z.K,Pt.P,X.R,te.O7,te.T1,Y.Q,D.kk,D.fb,D.Cp,Je.q,ci.tI,me.g,Ho.J,Wo,w.Jj],styles:[".edit-block__thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-right:12px}.edit-positions-block__add[_ngcontent-%COMP%]{padding:8px 0 8px 12px;background:#131c2a;position:sticky;bottom:0;z-index:1000}"],changeDetection:0})}Sa([(0,l.l6)(j.N.getSelectedChapterId),xa("design:type",_.c)],Si.prototype,"selectedChapterId$",void 0),Sa([(0,l.l6)(j.N.getSelectedChapter),xa("design:type",_.c)],Si.prototype,"selectedChapter$",void 0);var Jo=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Ko=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function ah(s,i){1&s&&(e.qex(0),e.EFF(1," to This Chapter"),e.bVm())}function rh(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.pasteStartingPosition(!0))}),e.EFF(2," Paste Starting Position to All Chapters "),e.k0s(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("disabled",!t.startingPositionClipboard())}}function lh(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.copyAdditionalPositions())}),e.EFF(2," Copy This Chapter's Additional Positions "),e.k0s(),e.j41(3,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.pasteAdditionalPositions())}),e.EFF(4," Paste Additional Positions To This Chapter "),e.k0s(),e.j41(5,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.pasteAdditionalPositions(!0))}),e.EFF(6," Paste Additional Positions To All Chapters "),e.k0s(),e.nrm(7,"mat-divider"),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("disabled",!t.hasAdditionalPositions),e.R7$(2),e.Y8G("disabled",!t.additionalPositionsClipboard()),e.R7$(2),e.Y8G("disabled",!t.additionalPositionsClipboard())}}class Jt{constructor(i,t,n,o,a,r){this.store=i,this.actions=t,this.positionsService=n,this.contentBlocksService=o,this.formBuilder=a,this.snackbar=r,this.interactive=!1,this.startingPositionClipboard=(0,e.vPA)(this.positionsService.startingPositionClipboard),this.additionalPositionsClipboard=(0,e.vPA)(this.positionsService.additionalPositionsClipboard),this.isLoft=Fe.c.application===Me.c.Loft,this.ngUnsubscribe=new f.B}get positionsBlock(){return this.additionalPositionsForm.get("positionsBlock")}get positions(){return this.positionsBlock.get("positions")}get hasAdditionalPositions(){return this.positions.length>0}ngOnInit(){this.initForms(),this.initChapterListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleOpened(i){if(i){const t=this.store.selectSnapshot(j.N.getSelectedChapter);this.store.dispatch(new Ft.Ih(t.camera.location,t.camera.action===bn.L.FlyTo,void 0,t.camera.rotationCenter))}}copyStartingPosition(){const i=this.store.selectSnapshot(j.N.getSelectedChapterId),t=this.positionsService.copyStartingPosition(i);t&&this.startingPositionClipboard.set(this.positionsService.startingPositionClipboard),this.snackbar.open(t?"Copied starting position.":"Unable to copy starting position. Missing camera or thumbnail.")}pasteStartingPosition(i=!1){const t=this.positionsService.pasteStartingPosition(i);t>0&&(this.startingPositionClipboard.set(null),this.syncStartingPositionForm(),this.snackbar.open(1===t?"Starting position successfully pasted.":`Starting position successfully pasted to ${t} chapters.`))}copyAdditionalPositions(){this.positionsService.copyAdditionalPositions(this.positions.value),this.additionalPositionsClipboard.set(this.positionsService.additionalPositionsClipboard),this.snackbar.open("Copied additional positions.")}pasteAdditionalPositions(i=!1){const t=this.positionsService.pasteAdditionalPositions(i);t>0&&(this.additionalPositionsClipboard.set(null),this.syncAdditionalPositionsForm(),this.snackbar.open(1===t?"Additional positions successfully pasted.":`Additional positions successfully pasted to ${t} chapters.`))}removeAdditionalPositions(){const i=new Qo.z;this.additionalPositionsForm.setControl("positionsBlock",this.newPositionsBlockFormGroup(i))}initForms(){this.startingPositionForm=this.formBuilder.group({title:[""]}),this.startingPositionForm.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.syncStartingPositionState(i.title)}),this.additionalPositionsForm=this.formBuilder.group({positionsBlock:this.formBuilder.group({type:[se.m.Positions],positions:new c.Bm([])})}),this.additionalPositionsForm.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.syncAdditionalPositionsState(i.positionsBlock)})}initChapterListeners(){this.selectedChapterId$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(j.N.getSelectedChapter);this.otherContentBlocks=this.contentBlocksService.filterContentBlocksByType(i.contentBlocks,[],[se.m.Positions]),this.syncStartingPositionForm(),this.syncAdditionalPositionsForm()}),this.actions.pipe((0,l.rM)(On.a.Undo,On.a.Redo),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.syncAdditionalPositionsForm()}),this.selectedChapter$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.interactive=i.readyState.model})}syncStartingPositionForm(){const i=this.store.selectSnapshot(j.N.getSelectedChapter).camera.title;this.startingPositionForm.patchValue({title:i},{emitEvent:!1})}syncStartingPositionState(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId);this.store.dispatch(new U.pN(t,i))}syncAdditionalPositionsForm(){const i=this.store.selectSnapshot(j.N.getSelectedChapter),t=this.contentBlocksService.findContentBlockByType(i.contentBlocks,se.m.Positions)||new Qo.z;this.additionalPositionsForm.setControl("positionsBlock",this.newPositionsBlockFormGroup(t),{emitEvent:!1}),this.additionalPositionsForm.patchValue({positionsBlock:t},{emitEvent:!1})}syncAdditionalPositionsState(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId),n=[...this.otherContentBlocks,...this.contentBlocksService.filterEmptyBlocks([i])];this.store.dispatch(new U.jo(t,n,!0))}newPositionsBlockFormGroup(i){return this.formBuilder.group({type:i.type,positions:this.formBuilder.array(i.positions.map(t=>this.formBuilder.group({title:[t.title,c.k0.maxLength(60)],thumbnail:this.formBuilder.group({urls:t.thumbnail.urls}),camera:t.camera})))})}static#e=this.\u0275fac=function(t){return new(t||Jt)(e.rXU(l.il),e.rXU(l.En),e.rXU(qo.c),e.rXU(Pn.V),e.rXU(c.ok),e.rXU(Qe.UG))};static#t=this.\u0275cmp=e.VBU({type:Jt,selectors:[["app-edit-positions-context"]],decls:45,vars:25,consts:[["title",""],["startingPositionMenu","matMenu"],["additionalPositionsMenu","matMenu"],[1,"edit-positions",3,"loading"],["column-label",""],["column-header","",1,"edit-positions__starting-position"],[1,"edit-positions__head"],[1,"edit-positions__title"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["toggleType","arrow",3,"opened","label","open","formGroup"],["panel-prefix",""],[1,"edit-positions__starting-position-thumbnail"],[3,"thumbnail"],["label","Title"],["type","text","formControlName","title","placeholder","Enter a response",1,"input",3,"maxLength"],[3,"field"],["buttonSize","md","mode","starting",1,"edit-positions__starting-position-capture",3,"chapter"],["column-group-body",""],[1,"edit-positions__additional-positions"],[3,"formGroup"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],[4,"ngIf"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-column",3)(1,"div",4),e.EFF(2,"Positions"),e.k0s(),e.j41(3,"div",5)(4,"div",6)(5,"div",7),e.EFF(6,"Starting Position"),e.k0s(),e.j41(7,"button",8),e.nrm(8,"app-icon",9),e.k0s()(),e.j41(9,"app-panel",10),e.nI1(10,"async"),e.bIt("opened",function(r){return e.eBV(o),e.Njj(n.handleOpened(r))}),e.qex(11,11),e.j41(12,"div",12),e.nrm(13,"app-thumbnail-view",13),e.nI1(14,"async"),e.nI1(15,"async"),e.k0s(),e.bVm(),e.j41(16,"app-form-field",14),e.nrm(17,"input",15,0)(19,"app-character-counter",16),e.k0s(),e.nrm(20,"app-capture-position",17),e.nI1(21,"async"),e.k0s()(),e.j41(22,"app-column-group"),e.qex(23,18),e.j41(24,"div",19)(25,"div",6)(26,"div",7),e.EFF(27,"Additional Positions"),e.k0s(),e.j41(28,"button",8),e.nrm(29,"app-icon",9),e.k0s()(),e.j41(30,"form",20),e.nrm(31,"app-edit-positions-block",20),e.k0s()(),e.bVm(),e.k0s()(),e.j41(32,"mat-menu",null,1)(34,"button",21),e.bIt("click",function(){return e.eBV(o),e.Njj(n.copyStartingPosition())}),e.EFF(35,"Copy Starting Position"),e.k0s(),e.j41(36,"button",22),e.bIt("click",function(){return e.eBV(o),e.Njj(n.pasteStartingPosition())}),e.EFF(37," Paste Starting Position "),e.DNE(38,ah,2,0,"ng-container",23),e.k0s(),e.DNE(39,rh,3,1,"ng-container",23),e.k0s(),e.j41(40,"mat-menu",null,2),e.DNE(42,lh,8,3,"ng-container",23),e.j41(43,"button",22),e.bIt("click",function(){return e.eBV(o),e.Njj(n.removeAdditionalPositions())}),e.EFF(44," Remove This Chapter's Additional Positions "),e.k0s()()}if(2&t){let o,a;const r=e.sdS(18),p=e.sdS(33),x=e.sdS(41);e.Y8G("loading",!n.interactive),e.R7$(7),e.Y8G("matMenuTriggerFor",p),e.R7$(2),e.Y8G("label",null==(o=e.bMT(10,17,n.selectedChapter$))?null:o.camera.title)("open",!0)("formGroup",n.startingPositionForm),e.R7$(4),e.Y8G("thumbnail",null==(a=e.bMT(14,19,n.thumbnails$))?null:a.get(null==(a=e.bMT(15,21,n.selectedChapter$))?null:a.id)),e.R7$(4),e.Y8G("maxLength",60),e.R7$(2),e.Y8G("field",r),e.R7$(),e.Y8G("chapter",e.bMT(21,23,n.selectedChapter$)),e.R7$(8),e.Y8G("matMenuTriggerFor",x),e.R7$(2),e.Y8G("formGroup",n.additionalPositionsForm),e.R7$(),e.Y8G("formGroup",n.positionsBlock),e.R7$(5),e.Y8G("disabled",!n.startingPositionClipboard()),e.R7$(2),e.Y8G("ngIf",n.isLoft),e.R7$(),e.Y8G("ngIf",n.isLoft),e.R7$(3),e.Y8G("ngIf",n.isLoft),e.R7$(),e.Y8G("disabled",!n.hasAdditionalPositions)}},dependencies:[w.bT,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,D.kk,D.fb,D.Cp,Je.q,Y.Q,pt,at,Z.K,Pt.P,X.R,me.g,Ho.J,Wo,Si,w.Jj],styles:[".edit-positions__starting-position[_ngcontent-%COMP%]{border-top:1px solid #283853;padding-right:12px;display:flex;flex-direction:column;overflow-y:scroll}.edit-positions__starting-position-thumbnail[_ngcontent-%COMP%]{flex:0 0 56px;height:56px;width:56px;margin-right:12px}.edit-positions__starting-position-capture[_ngcontent-%COMP%]{display:flex;width:100%;margin-top:16px}.edit-positions__additional-positions[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-positions__head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:4px 0 4px 16px}.edit-positions__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}"],changeDetection:0})}Jo([(0,l.l6)(j.N.getSelectedChapterId),Ko("design:type",_.c)],Jt.prototype,"selectedChapterId$",void 0),Jo([(0,l.l6)(j.N.getSelectedChapter),Ko("design:type",_.c)],Jt.prototype,"selectedChapter$",void 0),Jo([(0,l.l6)(Un.K.getRegisteredThumbnails),Ko("design:type",_.c)],Jt.prototype,"thumbnails$",void 0);var ch=v(35892),Kt=v(43753),Ea=(v(24484),v(53719));const ph=s=>({"input--success":s});function dh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"mat-radio-group",9),e.nrm(3,"mat-radio-button",10),e.k0s(),e.nrm(4,"input",11),e.j41(5,"button",12),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleDeleteOption(o))}),e.nrm(6,"app-icon",13),e.k0s()()()}if(2&s){const t=i.$implicit,n=i.index,o=e.XpG();e.R7$(),e.Y8G("formGroupName",n),e.R7$(),e.Y8G("formControl",o.correctOptionControl)("name",o.optionGroupName),e.R7$(),e.Y8G("value",t.get("value").value),e.R7$(),e.Y8G("ngClass",e.eq3(6,ph,t.get("value").value==o.correctOptionControl.value)),e.R7$(),e.BMQ("aria-label","Delete Question")}}function mh(s,i){1&s&&(e.j41(0,"div",14)(1,"mat-error"),e.EFF(2," Please select an answer. "),e.k0s()())}let uh=(()=>{class s extends Ke.n{get optionsControl(){return this.form.get("options")}get correctOptionControl(){return this.form.get("correctAnswer")}constructor(t,n,o,a){super(),this.formBuilder=t,this.changeRef=n,this.store=o,this.actions=a,this.optionGroupName="",this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({correctAnswer:["",c.k0.required],options:this.formBuilder.array([])}),this.optionGroupName=it.u.getUuid()}ngOnInit(){this.initFormListeners(),this.initNodeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.writeValue(t)}),this.optionsControl.valueChanges.pipe((0,I.p)(()=>!(0,R.isNil)(this.form.value.correctAnswer)),(0,K.B)(125),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{t.some(n=>n.value===this.form.value.correctAnswer)||(this.form.patchValue({correctAnswer:t[t.length-1].value}),this.changeRef.markForCheck())})}initNodeListeners(){this.actions.pipe((0,l.xi)(ie.zE),(0,I.p)(()=>this.store.selectSnapshot(S.S.getActiveTool)===H.s.Quiz&&this.question.id===this.store.selectSnapshot(he.j.getActiveQuestionId)),(0,I.p)(t=>{const{node:n,event:o}=t;return!(0,R.isNil)(n)&&!o.srcEvent.shiftKey}),(0,ve.T)(t=>(0,R.trim)((0,R.get)(t,"node.label",""))),(0,I.p)(t=>""!==t),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.createOption(t),this.changeRef.markForCheck()})}handleAddOptionClick(t){this.createOption(),t.preventDefault()}handleDeleteOption(t){this.optionsControl.removeAt(t)}handleDrop(t){const{previousIndex:n,currentIndex:o}=t,{options:a}=this.form.value,r=(0,Gt.W)(a,n,o);this.optionsControl.clear(),r.forEach(p=>{this.optionsControl.push(this.formBuilder.group(p))}),this.form.patchValue({options:r})}createOption(t){const n=(0,Ci.tI)(t);this.optionsControl.push(this.formBuilder.group(n))}setFormValues(t){const{options:n}=t;this.optionsControl.length!==n.length&&(this.optionsControl.clear(),n.forEach(o=>{this.optionsControl.push(this.formBuilder.group(o))})),this.form.patchValue(t),this.changeRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(e.gRc),e.rXU(l.il),e.rXU(l.En))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-quiz-multiple-choice"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:8,vars:3,consts:[["label","Answers",3,"formGroup"],["formArrayName","options","cdkDropList","",3,"cdkDropListDropped"],["class","mb-2","data-test","questionAnswer","cdkDrag","",4,"ngFor","ngForOf"],[1,"flex","flex-row","items-center"],[3,"click"],[1,"text-xs","text-gray-400"],["class","mt-1",4,"ngIf"],["data-test","questionAnswer","cdkDrag","",1,"mb-2"],[1,"flex","flex-row","items-center",3,"formGroupName"],["data-test","questionAnswerCorrect",3,"formControl","name"],[3,"value"],["type","text","formControlName","label","placeholder","Enter a response","data-test","questionAnswerLabel",1,"input",3,"ngClass"],["app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Question",3,"click"],["icon","times","size","lg"],[1,"mt-1"]],template:function(n,o){1&n&&(e.j41(0,"app-form-field",0)(1,"div",1),e.bIt("cdkDropListDropped",function(r){return o.handleDrop(r)}),e.DNE(2,dh,7,8,"div",2),e.j41(3,"div",3)(4,"mat-radio-button",4),e.bIt("click",function(r){return o.handleAddOptionClick(r)}),e.j41(5,"span",5),e.EFF(6,"Add Option"),e.k0s()()()(),e.DNE(7,mh,3,0,"div",6),e.k0s()),2&n&&(e.Y8G("formGroup",o.form),e.R7$(2),e.Y8G("ngForOf",o.optionsControl.controls),e.R7$(5),e.Y8G("ngIf",o.optionsControl.controls.length>0&&!o.correctOptionControl.valid))},dependencies:[w.YU,w.Sq,w.bT,c.me,c.BC,c.cb,c.l_,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,qe.VT,qe._g,Ea.TL,Y.Q,Z.K,X.R],changeDetection:0})}return s})();var hh=v(39358);function bh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",10)(1,"div",5),e.EFF(2),e.k0s(),e.j41(3,"button",11),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleDeleteSelectionClick(o.id))}),e.nrm(4,"app-icon",12),e.k0s()()}if(2&s){const t=i.$implicit;e.R7$(),e.BMQ("data-id",t.id),e.R7$(),e.JRh(t.label),e.R7$(),e.BMQ("aria-label","Delete Selection")}}class xi extends Ke.n{constructor(i,t,n,o,a,r){super(),this.store=i,this.actions=t,this.formBuilder=n,this.changeRef=o,this.graphService=a,this.viewService=r,this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({showAnswerList:[!1],selectType:"all",correctAnswer:this.formBuilder.array([])})}ngOnInit(){this.initFormListeners(),this.initNodeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.writeValue(i);const t=i.correctAnswer,n=this.store.selectSnapshot(S.S.getViewGraph);this.nodes=this.graphService.getNodes(n,t),this.changeRef.markForCheck()})}initNodeListeners(){this.activeQuestion$.pipe((0,Dt.M)(()=>{this.viewService.clearSelectedNodes()}),(0,I.p)(()=>this.question.id===this.store.selectSnapshot(he.j.getActiveQuestionId)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{setTimeout(()=>{this.selectNodes(this.value.correctAnswer,!0)})}),this.actions.pipe((0,l.xi)(ie.zE),(0,I.p)(()=>this.store.selectSnapshot(S.S.getActiveTool)===H.s.Quiz&&this.question.id===this.store.selectSnapshot(he.j.getActiveQuestionId)),(0,I.p)(i=>{const{node:t,event:n}=i;return!(0,R.isNil)(t)&&!n.srcEvent.shiftKey}),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.hit?i.hit.objectId:"";if(t){const o=this.store.selectSnapshot(ye.z.getNodes)[t].checked;this.selectNodes([t],!o)}this.changeRef.markForCheck()})}handleDeleteSelectionClick(i){this.selectNodes([i],!1)}setFormValues(i){this.form.setControl("correctAnswer",this.formBuilder.array(i.correctAnswer)),this.form.patchValue(i),this.changeRef.markForCheck()}selectNodes(i,t){this.store.dispatch(new re.q9(t,i));const{showAnswerList:n,selectType:o,correctAnswer:a}=this.form.value;let r=[...a];r=t?[...r,...i.filter(p=>!r.includes(p))]:[...r.filter(p=>!i.includes(p))],this.setFormValues({showAnswerList:n,selectType:o,correctAnswer:r})}static#e=this.\u0275fac=function(t){return new(t||xi)(e.rXU(l.il),e.rXU(l.En),e.rXU(c.ze),e.rXU(e.gRc),e.rXU(zn.w),e.rXU(hh.z))};static#t=this.\u0275cmp=e.VBU({type:xi,selectors:[["app-edit-quiz-select-anatomy"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>xi),multi:!0}]),e.Vt3],decls:16,vars:4,consts:[[3,"formGroup"],["label","ANSWERS (Select the anatomy in 3D)",3,"uppercase","isCompact"],[1,"edit-quiz-select-anatomy__group"],["class","flex flex-row items-center justify-between","data-test","questionAnswer",4,"ngFor","ngForOf"],["formControlName","showAnswerList"],[1,"text-xs"],["label","CORRECT ANSWER"],["formControlName","selectType"],["value","all",1,"mb-2"],["value","any","data-test","questionSelectAny"],["data-test","questionAnswer",1,"flex","flex-row","items-center","justify-between"],["data-test","questionAnswerRemoveButton","app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Selection",3,"click"],["icon","times","size","lg"]],template:function(t,n){1&t&&(e.qex(0,0),e.nrm(1,"app-form-field",1),e.j41(2,"div",2),e.DNE(3,bh,5,3,"div",3),e.k0s(),e.j41(4,"app-form-field")(5,"mat-checkbox",4)(6,"span",5),e.EFF(7,"Show answer list in the question text"),e.k0s()()(),e.j41(8,"app-form-field",6)(9,"mat-radio-group",7)(10,"mat-radio-button",8)(11,"span",5),e.EFF(12,"Must select all answers listed"),e.k0s()(),e.j41(13,"mat-radio-button",9)(14,"span",5),e.EFF(15,"Can select any of the answers listed"),e.k0s()()()(),e.bVm()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("uppercase",!1)("isCompact",!0),e.R7$(2),e.Y8G("ngForOf",n.nodes))},dependencies:[w.Sq,c.BC,c.cb,c.j4,c.JD,Ae.So,qe.VT,qe._g,Y.Q,Z.K,X.R],styles:[".edit-quiz-select-anatomy__group[_ngcontent-%COMP%]{margin-bottom:24px;display:flex;flex-direction:column;row-gap:4px}"],changeDetection:0})}function Ch(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7),e.EFF(3),e.k0s(),e.j41(4,"div",8),e.nrm(5,"app-icon",9),e.k0s()(),e.qex(6,10),e.nrm(7,"input",11),e.bVm(),e.j41(8,"button",12),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleDeleteSelectionClick(o))}),e.nrm(9,"app-icon",13),e.k0s()()}if(2&s){const t=i.index;e.Y8G("formGroupName",t),e.R7$(3),e.JRh(t+1),e.R7$(5),e.BMQ("aria-label","Delete Selection")}}function yh(s,i){1&s&&e.nrm(0,"mat-error")}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(he.j.getActiveQuestionId),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],xi.prototype,"activeQuestion$",void 0);class Ei extends Ke.n{get optionsControl(){return this.form.get("options")}constructor(i,t,n,o,a,r){super(),this.store=i,this.actions=t,this.formBuilder=n,this.changeRef=o,this.graphService=a,this.cameraService=r,this.ngUnsubscribe=new f.B,this.form=this.formBuilder.group({correctAnswer:this.formBuilder.array([]),options:this.formBuilder.array([],this.getLabelValidators())})}ngOnInit(){this.initFormListeners(),this.initNodeListeners(),this.initLabelListeners()}ngOnDestroy(){this.store.dispatch(new ie.Gv(!0)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.options,n=this.store.selectSnapshot(he.j.getActiveQuestionLabels),a={correctAnswer:t.map(r=>r.value),options:t.map(r=>{const{value:p,label:x,model:N}=r,z=n.find(Se=>Se.value===p);return{value:p,label:{...z?z.label:N,...x}}})};this.writeValue(a),this.changeRef.markForCheck()})}initNodeListeners(){this.actions.pipe((0,l.xi)(ie.zE),(0,I.p)(()=>this.store.selectSnapshot(S.S.getActiveTool)===H.s.Quiz&&this.question.id===this.store.selectSnapshot(he.j.getActiveQuestionId)),(0,I.p)(i=>{const{node:t,event:n}=i;return!(0,R.isNil)(t)&&!n.srcEvent.shiftKey}),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=i.hit;if(t&&t.objectId){const n=t.objectId,o=this.store.selectSnapshot(j.N.getSelectedChapterId),a=this.store.selectSnapshot(S.S.getViewGraph),[r]=this.graphService.getNodes(a,[n]),p=this.cameraService.getDirection(t),x=(0,Ci.Aw)(o,r,t,p),N=(0,Ci.br)(x);this.addOption(N)}this.changeRef.markForCheck()})}initLabelListeners(){this.activeQuestion$.pipe((0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=(0,R.isNil)(i);this.store.dispatch(new ie.Gv(t))})}handleDeleteSelectionClick(i){this.handleDeleteOption(i)}setFormValues(i){const t=i.options;this.optionsControl.length!==t.length&&this.setFormOptions(t),this.form.patchValue(i),this.changeRef.markForCheck()}handleDeleteOption(i){this.optionsControl.removeAt(i)}handleDrop(i){const{previousIndex:t,currentIndex:n}=i,o=this.form.value.options,a=(0,Gt.W)(o,t,n);this.setFormOptions(o),this.form.patchValue({options:a})}setFormOptions(i){this.optionsControl.clear(),i.forEach(t=>{this.addOption(t)})}addOption(i){this.optionsControl.push(this.formBuilder.group({value:i.value,label:this.formBuilder.group({title:[i.label.title]}),model:i.label}))}getLabelValidators(){return i=>{const n=i.value.map(a=>a.value),o=(0,R.uniq)(n).length<n.length;return o?{hasDuplicates:o}:null}}static#e=this.\u0275fac=function(t){return new(t||Ei)(e.rXU(l.il),e.rXU(l.En),e.rXU(c.ze),e.rXU(e.gRc),e.rXU(zn.w),e.rXU(Jn.j))};static#t=this.\u0275cmp=e.VBU({type:Ei,selectors:[["app-edit-quiz-label-anatomy"]],inputs:{question:"question"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>Ei),multi:!0}]),e.Vt3],decls:5,vars:4,consts:[["cdkDropList","",1,"label",3,"cdkDropListDropped","formGroup"],["label","ANSWERS (Select the anatomy to be labeled)","formArrayName","options",3,"uppercase"],["class","flex flex-row items-center justify-between mb-2","cdkDrag","",3,"formGroupName",4,"ngFor","ngForOf"],[1,"mt-1"],[4,"ngIf"],["cdkDrag","",1,"flex","flex-row","items-center","justify-between","mb-2",3,"formGroupName"],["cdkDragHandle","","data-test","questionAnswerNumber",1,"label__pin"],[1,"label__label"],[1,"label__drag"],["icon","grip-lines"],["formGroupName","label"],["type","text","formControlName","title","data-test","questionAnswer",1,"input"],["data-test","questionAnswerRemoveButton","app-button","","buttonType","text","buttonTheme","dark","buttonSize","sm","type","button","title","Delete Selection",3,"click"],["icon","times","size","lg"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.bIt("cdkDropListDropped",function(a){return n.handleDrop(a)}),e.j41(1,"app-form-field",1),e.DNE(2,Ch,10,3,"div",2),e.j41(3,"div",3),e.DNE(4,yh,1,0,"mat-error",4),e.k0s()()()),2&t&&(e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("uppercase",!1),e.R7$(),e.Y8G("ngForOf",n.optionsControl.controls),e.R7$(2),e.Y8G("ngIf",!n.optionsControl.valid))},dependencies:[w.Sq,w.bT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,te.O7,te.T1,te.Fb,Ea.TL,Y.Q,Z.K,X.R],styles:[".label__pin[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center}.label__pin[_ngcontent-%COMP%]:hover{cursor:move}.label__pin[_ngcontent-%COMP%]:hover   .label__label[_ngcontent-%COMP%]{display:none}.label__pin[_ngcontent-%COMP%]:hover   .label__drag[_ngcontent-%COMP%]{display:block}.label__label[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;color:#101823;font-size:10px;width:24px;height:24px;background-image:url(/assets/images/labels/circle.svg);background-repeat:no-repeat;background-position:center;background-size:auto}.label__drag[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}function Sh(s,i){if(1&s&&e.nrm(0,"app-edit-quiz-multiple-choice",29),2&s){const t=e.XpG();e.Y8G("question",t.question)}}function xh(s,i){if(1&s&&e.nrm(0,"app-edit-quiz-select-anatomy",29),2&s){const t=e.XpG();e.Y8G("question",t.question)}}function Eh(s,i){if(1&s&&e.nrm(0,"app-edit-quiz-label-anatomy",29),2&s){const t=e.XpG();e.Y8G("question",t.question)}}function wh(s,i){1&s&&(e.j41(0,"div",17)(1,"app-form-field",30),e.nrm(2,"app-rich-text-edit",31,1),e.k0s()()),2&s&&(e.R7$(2),e.Y8G("inline",!0)("compact",!0)("resizeable",!0)("rows",6))}function Fh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",32)(1,"button",33),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handlePreviewCameraClick())}),e.EFF(2," Preview "),e.k0s(),e.j41(3,"button",34),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleRemoveCameraClick())}),e.EFF(4," Remove "),e.k0s()()}}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(he.j.getActiveQuestionId),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Ei.prototype,"activeQuestion$",void 0);class wi{get question(){return this._question}set question(i){(0,R.isEqual)(i,this.question)||(this._question=i,this.setFormValues(i),this.textLabel=this.question.type===Kt.Q5.Instructions?"Text":"Question")}get quizCamera(){return(0,R.get)(this.question,"sceneConfig.camera")}constructor(i,t,n,o){this.formBuilder=i,this.store=t,this.cameraService=n,this.changeDetectorRef=o,this.questionTypesMap=Kt.of,this.questionDescriptionsMap=Kt.sb,this.questionTypes=Kt.Q5,this.defaultNextButtonNext=Ci.qH,this.open=!1,this.opened=new e.bkB,this.textLabel=" ",this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners(),this.initQuestionChangeListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initForm(){this.form=this.formBuilder.group({questionPrompt:this.formBuilder.group({type:"markdown",markdown:""}),data:[],explanation:this.formBuilder.group({type:"markdown",markdown:""}),nextLabel:"",showChapterLabels:!1,camera:[]})}initFormListeners(){this.form.valueChanges.pipe((0,K.B)(125),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t={...this.question,...this.createQuestionFromValues(i)};this.store.dispatch(new Re.B.SetQuestion(t))})}initQuestionChangeListeners(){this.questions$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const n=this.getQuestionIndex(this.question.id);this.questionNum=n+1,this.changeDetectorRef.markForCheck()})}handleOpened(i){this.opened.emit({panel:this.panel,opened:i})}handleRemoveQuestionClick(){this.store.dispatch(new Re.B.RemoveQuestions([this.question.id]))}handleCaptureCameraClick(){const i=this.cameraService.getCamera();this.form.patchValue({camera:i})}handlePreviewCameraClick(){const i=this.quizCamera;i&&this.store.dispatch(new Ft.Ih(i.location,!0,1))}handleRemoveCameraClick(){this.form.patchValue({camera:void 0})}handlePreviewQuestion(){const i=this.getQuestionIndex(this.question.id);this.store.dispatch(new P.lN(!0,i))}setFormValues(i){const{questionPrompt:t,explanation:n,data:o,sceneConfig:a,nextLabel:r,showChapterLabels:p}=i,x=(0,R.get)(a,"camera.location");this.form.patchValue({questionPrompt:t[0],data:o,explanation:n[0],camera:x,nextLabel:r,showChapterLabels:p},{emitEvent:!1,onlySelf:!0})}createQuestionFromValues(i){const{questionPrompt:t,explanation:n,data:o,camera:a,nextLabel:r,showChapterLabels:p}=i,x={};return a&&(x.camera={action:bn.L.FlyTo,location:a}),{questionPrompt:[t],data:o,explanation:[n],sceneConfig:x,nextLabel:r,showChapterLabels:p}}getQuestionIndex(i){const t=this.store.selectSnapshot(j.N.getStoryChapters).map(n=>n.id);return this.store.selectSnapshot(he.j.getQuestionIndex(t,i))}static#e=this.\u0275fac=function(t){return new(t||wi)(e.rXU(c.ze),e.rXU(l.il),e.rXU(Jn.j),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:wi,selectors:[["app-quiz-question-form"]],viewQuery:function(t,n){if(1&t&&e.GBs(me.g,7),2&t){let o;e.mGM(o=e.lsd())&&(n.panel=o.first)}},inputs:{label:"label",question:"question",open:"open"},outputs:{opened:"opened"},decls:42,vars:19,consts:[["questionMenu","matMenu"],["questionPrompt",""],["toggleType","arrow","data-test","questionPanel",3,"opened","label","open"],["panel-prefix",""],["data-test","questionNumText",1,"question__pin"],["panel-actions",""],["app-button","","buttonSize","sm",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["tabSize","small","tabTheme","dark"],["label","Content"],[1,"mt-5"],["label","Type","matTooltipPosition","left",3,"matTooltip"],[1,"text-xs"],["formGroupName","questionPrompt",3,"label"],["data-test","questionPrompt","formControlName","markdown",3,"inline","compact","resizeable","rows"],[1,"mt-2"],[3,"ngSwitch"],["formControlName","data",3,"question",4,"ngSwitchCase"],["class","mt-2",4,"ngIf"],["label","Advanced"],[1,"mt-4"],["label","Custom Starting Position","formGroupName","camera"],["buttonType","outline","app-button","","data-test","questionMarkPosition",1,"w-full",3,"click"],["class","flex flex-row justify-between mt-3",4,"ngIf"],["label","Next Button Text"],["type","text","formControlName","nextLabel","data-test","questionNextText",1,"input",3,"placeholder"],["formControlName","showChapterLabels","data-test","questionShowChapterLabels"],["formControlName","data",3,"question"],["label","Answer Explanation","formGroupName","explanation"],["formControlName","markdown","data-test","questionExplanation",3,"inline","compact","resizeable","rows"],[1,"flex","flex-row","justify-between","mt-3"],["buttonType","outline","app-button","","data-test","questionPreviewPosition",1,"w-1/2","mr-1",3,"click"],["buttonType","outline","app-button","","data-test","questionRemovePosition",1,"w-1/2","ml-1",3,"click"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-panel",2),e.bIt("opened",function(r){return e.eBV(o),e.Njj(n.handleOpened(r))}),e.qex(1,3),e.j41(2,"div",4),e.EFF(3),e.k0s(),e.bVm(),e.j41(4,"div",5)(5,"button",6),e.nrm(6,"app-icon",7),e.k0s(),e.j41(7,"mat-menu",null,0)(9,"button",8),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handlePreviewQuestion())}),e.EFF(10,"Preview Question"),e.k0s(),e.nrm(11,"mat-divider"),e.j41(12,"button",8),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveQuestionClick())}),e.EFF(13,"Remove"),e.k0s()()(),e.j41(14,"div",9)(15,"app-tabs",10)(16,"app-tab",11)(17,"div",12)(18,"app-form-field",13)(19,"span",14),e.EFF(20),e.k0s()(),e.j41(21,"app-form-field",15),e.nrm(22,"app-rich-text-edit",16,1),e.k0s()(),e.j41(24,"div",17),e.qex(25,18),e.DNE(26,Sh,1,1,"app-edit-quiz-multiple-choice",19)(27,xh,1,1,"app-edit-quiz-select-anatomy",19)(28,Eh,1,1,"app-edit-quiz-label-anatomy",19),e.bVm(),e.k0s(),e.DNE(29,wh,4,4,"div",20),e.k0s(),e.j41(30,"app-tab",21)(31,"div",22)(32,"app-form-field",23)(33,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleCaptureCameraClick())}),e.EFF(34," Mark Position "),e.k0s(),e.DNE(35,Fh,5,0,"div",25),e.k0s(),e.j41(36,"app-form-field",26),e.nrm(37,"input",27),e.k0s(),e.j41(38,"app-form-field")(39,"mat-checkbox",28)(40,"span",14),e.EFF(41,"Show chapter's labels"),e.k0s()()()()()()()()}if(2&t){const o=e.sdS(8);e.Y8G("label",n.label)("open",n.open),e.R7$(3),e.SpI(" ",n.questionNum," "),e.R7$(2),e.Y8G("matMenuTriggerFor",o),e.R7$(9),e.Y8G("formGroup",n.form),e.R7$(4),e.Y8G("matTooltip",n.questionDescriptionsMap[n.question.type]),e.R7$(2),e.JRh(n.questionTypesMap[n.question.type]),e.R7$(),e.Y8G("label",n.textLabel),e.R7$(),e.Y8G("inline",!0)("compact",!0)("resizeable",!0)("rows",6),e.R7$(3),e.Y8G("ngSwitch",n.question.type),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.MultipleChoice),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.SelectAnatomy),e.R7$(),e.Y8G("ngSwitchCase",n.questionTypes.LabelAnatomy),e.R7$(),e.Y8G("ngIf",n.question.type!==n.questionTypes.Instructions),e.R7$(6),e.Y8G("ngIf",n.quizCamera),e.R7$(2),e.Y8G("placeholder",n.defaultNextButtonNext)}},dependencies:[w.bT,w.ux,w.e1,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,Ae.So,D.kk,D.fb,D.Cp,Ce.oV,Je.q,Y.Q,Z.K,X.R,jt.j,Mt.O,me.g,Ut,uh,xi,Ei],styles:[".question__pin[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;color:#101823;font-size:10px;width:24px;height:24px;position:relative;left:-8px;top:4px;background-image:url(/assets/images/labels/circle.svg);background-repeat:no-repeat;background-position:center;background-size:auto}"],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(he.j.getAllQuestions),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],wi.prototype,"questions$",void 0);const Zo={[vt._.All]:{label:"Enable View and Quiz",shortLabel:"View and Quiz",description:"Enable both View mode and Quiz mode.",dataTest:"enableViewAndQuiz"},[vt._.Quiz]:{label:"Show Quiz Only",shortLabel:"Quiz Only",description:"Enable Quiz mode only, and disable View mode.",dataTest:"enableQuiz"},[vt._.Content]:{label:"Disable Quiz",shortLabel:"Disabled",description:"Enable View mode only, and disable Quiz mode.",dataTest:"disableQuiz"}};var es=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},ts=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Rh(s,i){if(1&s&&(e.j41(0,"mat-radio-button",16),e.EFF(1),e.k0s()),2&s){const t=i.$implicit,n=e.XpG();e.Y8G("value",t),e.BMQ("title",null==n.bookmarkViewModesMetadata[t]?null:n.bookmarkViewModesMetadata[t].description)("data-test",null==n.bookmarkViewModesMetadata[t]?null:n.bookmarkViewModesMetadata[t].dataTest),e.R7$(),e.JRh(null==n.bookmarkViewModesMetadata[t]?null:n.bookmarkViewModesMetadata[t].label)}}class Zt{constructor(i,t,n){this.formBuilder=i,this.store=t,this.dialogRef=n,this.bookmarkViewModesMetadata=Zo,this.bookmarkViewModes=[vt._.All,vt._.Quiz,vt._.Content],this.ngUnsubscribe=new f.B;const o=this.store.selectSnapshot(he.j.getQuizSettings),a=this.store.selectSnapshot(je.J.getSelectedBookmarkViewMode);this.form=this.formBuilder.group({bookmarkViewMode:this.formBuilder.nonNullable.control(a),quizSettings:this.formBuilder.nonNullable.group(o)})}ngOnInit(){this.initFormListeners(),this.initSettingsListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initFormListeners(){this.form.controls.quizSettings.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setQuizSettings(i)}),this.form.controls.bookmarkViewMode.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setBookmarkViewMode(i)})}initSettingsListeners(){this.quizSettings$.pipe((0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.form.controls.quizSettings.patchValue(i,{emitEvent:!1})}),this.selectedBookmarkViewMode$.pipe((0,O.F)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.form.controls.bookmarkViewMode.patchValue(i,{emitEvent:!1})}),this.allQuestions$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{i.length>0?this.form.enable():this.form.disable()})}handleDoneClick(){this.dialogRef.close()}setQuizSettings(i){this.store.dispatch(new Re.B.SetQuizSettings(i))}setBookmarkViewMode(i){this.store.dispatch(new tt.pE(i))}static#e=this.\u0275fac=function(t){return new(t||Zt)(e.rXU(c.ok),e.rXU(l.il),e.rXU(ee.CP))};static#t=this.\u0275cmp=e.VBU({type:Zt,selectors:[["app-quiz-settings-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"dialog",3,"formGroup"],["label","Access"],["formControlName","bookmarkViewMode",1,"flex","flex-col"],[3,"value",4,"ngFor","ngForOf"],["formGroupName","quizSettings"],["label","Validation"],["listType","flat"],["formControlName","showSummary"],["formControlName","showExplanation"],["label","UI Elements"],["formControlName","showProgress"],["formControlName","showSubmit"],["mat-dialog-actions",""],["app-button","","buttonTheme","light","buttonType","primary",3,"click"],[3,"value"]],template:function(t,n){1&t&&(e.j41(0,"h1",0),e.EFF(1,"Quiz Settings"),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"app-form-field",3)(5,"mat-radio-group",4),e.DNE(6,Rh,2,4,"mat-radio-button",5),e.k0s()(),e.qex(7,6),e.j41(8,"app-form-field",7)(9,"app-list",8)(10,"app-list-item")(11,"mat-checkbox",9),e.EFF(12,"Show summary page"),e.k0s()(),e.j41(13,"app-list-item")(14,"mat-checkbox",10),e.EFF(15,"Show answers and explanations"),e.k0s()()()(),e.j41(16,"app-form-field",11)(17,"app-list",8)(18,"app-list-item")(19,"mat-checkbox",12),e.EFF(20,"Progress indicator"),e.k0s()(),e.j41(21,"app-list-item")(22,"mat-checkbox",13),e.EFF(23,"Submit Button"),e.k0s()()()(),e.bVm(),e.k0s()(),e.j41(24,"div",14)(25,"button",15),e.bIt("click",function(){return n.handleDoneClick()}),e.EFF(26," Done "),e.k0s()()),2&t&&(e.R7$(3),e.Y8G("formGroup",n.form),e.R7$(3),e.Y8G("ngForOf",n.bookmarkViewModes))},dependencies:[w.Sq,Ae.So,qe.VT,qe._g,ee.BI,ee.E7,ee.Yi,c.BC,c.cb,c.j4,c.JD,c.$R,Y.Q,Z.K,jn.s,Mn.P],styles:[".dialog[_ngcontent-%COMP%]{font-size:12px!important}.dialog__close[_ngcontent-%COMP%]{position:absolute;right:24px;top:24px}"],changeDetection:0})}es([(0,l.l6)(he.j.getAllQuestions),ts("design:type",_.c)],Zt.prototype,"allQuestions$",void 0),es([(0,l.l6)(he.j.getQuizSettings),ts("design:type",_.c)],Zt.prototype,"quizSettings$",void 0),es([(0,l.l6)(je.J.getSelectedBookmarkViewMode),ts("design:type",_.c)],Zt.prototype,"selectedBookmarkViewMode$",void 0);var Ph=v(34763);let jh=(()=>{class s{transform(t,n){if((0,R.isNil)(t)||(0,R.isNil)(n))return t;const o=`${t}`,a=o.substring(0,n);return a.length<o.length?a+"...":a}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275pipe=e.EJ8({name:"ellipsis",type:s,pure:!0})}return s})();var Fi=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Ri=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Mh=["questionItemElements"];function Ih(s,i){if(1&s&&e.nrm(0,"app-status",23),2&s){const t=e.XpG();e.Y8G("color",t.quizStatusActive?"green":"red")}}function Nh(s,i){if(1&s&&(e.j41(0,"span",24),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.JRh(t.quizStatusLabel)}}function Bh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",25,2)(2,"app-quiz-question-form",26),e.nI1(3,"ellipsis"),e.nI1(4,"async"),e.bIt("opened",function(o){const a=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.handleOpened(a,o))}),e.k0s(),e.j41(5,"div",27),e.nrm(6,"app-icon",28),e.k0s()()}if(2&s){const t=i.$implicit,n=e.XpG();e.R7$(2),e.FS9("label",e.i5U(3,3,n.getQuestionText(t),80)),e.Y8G("question",t)("open",e.bMT(4,6,n.activeQuestionId$)===t.id)}}function Dh(s,i){1&s&&(e.j41(0,"div",29),e.EFF(1," There are no questions in this chapter. "),e.k0s())}function Gh(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.addQuestion(o))}),e.EFF(1),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG();e.Y8G("matTooltip",n.questionDescriptionsMap[t]),e.R7$(),e.SpI(" ",n.questionTypesMap[t]," ")}}class ut{constructor(i,t,n,o,a,r){this.store=i,this.actions=t,this.changeRef=n,this.dialogService=o,this.dialog=a,this.contentBlocksService=r,this.questionTypes=Object.keys(Kt.of),this.questionTypesMap=Kt.of,this.questionDescriptionsMap=Kt.sb,this.statusColor=Do,this.bookmarkViewModesMetadata=Zo,this.selectedChapterQuestions=[],this.selectedChapterHasQuestions=!1,this.quizStatusLabel="",this.quizStatusActive=!1,this.quizHasQuestions=!1,this.ngUnsubscribe=new f.B}ngOnInit(){this.initChapterQuestionListeners(),this.initPanelListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initChapterQuestionListeners(){(0,C.z)([this.chapters$,this.selectedChapterId$,this.allQuestions$,this.quizEnabled$,this.bookmarkViewMode$]).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t,n,o,a])=>{this.selectedChapterQuestions=this.store.selectSnapshot(he.j.getQuizQuestionsByChapter(t)),this.selectedChapterHasQuestions=this.selectedChapterQuestions.length>0,this.quizHasQuestions=n.length>0,this.quizStatusLabel=Zo[a]?.shortLabel,this.quizStatusActive=this.quizHasQuestions&&o&&!(a===vt._.Content),this.changeRef.markForCheck()}),(0,ch.x)(this.selectedChapterId$,this.actions.pipe((0,l.rM)(Re.B.SetQuestions))).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Re.B.SetActiveQuestion(void 0))})}initPanelListeners(){this.actions.pipe((0,l.rM)(Re.B.AddQuestion),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.selectedChapterQuestions.length-1;this.store.dispatch(new Re.B.SetActiveQuestion(this.selectedChapterQuestions[i].id));const n=this.questionForms.toArray()[i];n&&this.setActivePanel(n.panel)}),this.activeQuestionId$.pipe((0,I.p)(i=>!!i),(0,O.F)(),(0,De.c)(0),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.selectedChapterQuestions.findIndex(o=>o.id===i),n=this.questionItemElements.toArray()[t];if(n){const o=(0,Ph.C)(n.nativeElement);o&&(o.scrollTop=n.nativeElement.offsetTop)}})}handleOpened(i,t){t.opened&&this.setActivePanel(t.panel),this.store.dispatch(new Re.B.SetActiveQuestion(t.opened?i.id:void 0))}handleQuizSettingsClick(){return this.dialog.open(Zt,{id:zi.t.QuizSettingsDialog,width:"320px"})}handleRemoveChapterQuizClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove Chapter Questions",bodyText:"Would you like to remove all the questions in this chapter?"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{if(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId),n=this.store.selectSnapshot(he.j.getAllQuestions).filter(o=>o.chapterId===t).map(o=>o.id);this.store.dispatch(new Re.B.RemoveQuestions(n))}})}handleRemoveQuizClick(){this.dialogService.openConfirmDialog({data:{titleText:"Remove All Questions",bodyText:"Would you like to remove all the questions in this quiz?"}}).afterClosed().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{if(i){const t=this.store.selectSnapshot(he.j.getAllQuestions).map(n=>n.id);this.store.dispatch(new Re.B.RemoveQuestions(t))}})}getQuestionText(i){const{questionPrompt:t}=i;return this.contentBlocksService.extractContentBlockText(t,"\n")}addQuestion(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId),n={...(0,Ci.UB)(i),chapterId:t};this.store.dispatch(new Re.B.AddQuestion(n))}setActivePanel(i){this.questionForms.toArray().filter(t=>t.panel!==i).forEach(t=>{t.panel.open=!1}),this.changeRef.markForCheck()}trackByKey(i,t){return t.id}handleDrop(i){const t=this.store.selectSnapshot(j.N.getSelectedChapterId),n=this.store.selectSnapshot(he.j.getQuizQuestionsByChapter(t));(0,te.HD)(n,i.previousIndex,i.currentIndex);let o=this.store.selectSnapshot(he.j.getAllQuestions).filter(a=>!n.some(r=>r.id===a.id));o=[...o,...n],this.store.dispatch(new Re.B.SetQuestions(o))}static#e=this.\u0275fac=function(t){return new(t||ut)(e.rXU(l.il),e.rXU(l.En),e.rXU(e.gRc),e.rXU(Xe.o),e.rXU(ee.bZ),e.rXU(Pn.V))};static#t=this.\u0275cmp=e.VBU({type:ut,selectors:[["app-edit-quiz-context"]],viewQuery:function(t,n){if(1&t&&(e.GBs(wi,5),e.GBs(Mh,5)),2&t){let o;e.mGM(o=e.lsd())&&(n.questionForms=o),e.mGM(o=e.lsd())&&(n.questionItemElements=o)}},decls:29,vars:9,consts:[["quizActionsMenu","matMenu"],["addQuestionMenu","matMenu"],["questionItemElements",""],[3,"loading"],["column-label",""],[1,"flex","items-center"],["data-test","quizStatus","class","ml-3 mr-2",3,"color",4,"ngIf"],["class","uppercase text-2xs",4,"ngIf"],["column-actions",""],["app-button","","data-test","quizSettingsButton","matTooltip","Quiz Settings",3,"click"],["icon","cog"],["app-button","","data-test","questionActionsTrigger","matTooltip","Quiz Bulk Actions",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","","data-test","questionRemoveChapterQuestions",3,"click"],["mat-menu-item","","data-test","questionRemoveAllQuestions",3,"click"],["label","Quiz"],["column-group-body",""],["cdkDropList","",1,"questions","pl-2","relative",3,"cdkDropListDropped"],["class","questions__item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],["class","questions__no-chapter-questions",4,"ngIf"],[1,"questions__add"],["app-button","","buttonType","flat",1,"w-full",3,"matMenuTriggerFor"],["mat-menu-item","","matTooltipPosition","left",3,"matTooltip","click",4,"ngFor","ngForOf"],["data-test","quizStatus",1,"ml-3","mr-2",3,"color"],[1,"uppercase","text-2xs"],["cdkDrag","",1,"questions__item"],[3,"opened","question","label","open"],["cdkDragHandle","",1,"questions__handle"],["icon","grip-lines"],[1,"questions__no-chapter-questions"],["mat-menu-item","","matTooltipPosition","left",3,"click","matTooltip"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-column",3)(1,"div",4)(2,"div",5)(3,"span"),e.EFF(4,"Quiz"),e.k0s(),e.DNE(5,Ih,1,1,"app-status",6)(6,Nh,2,1,"span",7),e.k0s()(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleQuizSettingsClick())}),e.nrm(9,"app-icon",10),e.k0s(),e.j41(10,"button",11),e.nrm(11,"app-icon",12),e.k0s(),e.j41(12,"mat-menu",null,0)(14,"button",13),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveChapterQuizClick())}),e.EFF(15," Remove this chapter's quiz questions "),e.k0s(),e.j41(16,"button",14),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRemoveQuizClick())}),e.EFF(17," Remove quiz "),e.k0s()()(),e.j41(18,"app-column-group",15),e.qex(19,16),e.j41(20,"div",17),e.bIt("cdkDropListDropped",function(r){return e.eBV(o),e.Njj(n.handleDrop(r))}),e.DNE(21,Bh,7,8,"div",18)(22,Dh,2,0,"div",19),e.j41(23,"div",20)(24,"button",21),e.EFF(25," Add a Question "),e.k0s()(),e.j41(26,"mat-menu",null,1),e.DNE(28,Gh,2,2,"button",22),e.k0s()(),e.bVm(),e.k0s()()}if(2&t){const o=e.sdS(13),a=e.sdS(27);e.Y8G("loading",!1),e.R7$(5),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(4),e.Y8G("matMenuTriggerFor",o),e.R7$(11),e.Y8G("ngForOf",n.selectedChapterQuestions)("ngForTrackBy",n.trackByKey),e.R7$(),e.Y8G("ngIf",!n.selectedChapterHasQuestions),e.R7$(2),e.Y8G("matMenuTriggerFor",a),e.R7$(4),e.Y8G("ngForOf",n.questionTypes)}},dependencies:[w.Sq,w.bT,te.O7,te.T1,te.Fb,D.kk,D.fb,D.Cp,Ce.oV,Y.Q,pt,at,X.R,ia,wi,w.Jj,jh],styles:[".questions__item[_ngcontent-%COMP%]{position:relative}.questions__item[_ngcontent-%COMP%]:hover   .questions__handle[_ngcontent-%COMP%]{opacity:1}.questions__handle[_ngcontent-%COMP%]{border:4px solid transparent;display:flex;align-items:center;justify-content:center;background:#131c2a;width:36px;height:36px;cursor:move;color:#96a8c0;position:absolute;left:4px;top:12px;z-index:10;opacity:0}.questions__no-chapter-questions[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#61779e;margin-top:16px;font-size:.75rem;line-height:1rem}.questions__add[_ngcontent-%COMP%]{position:sticky;bottom:0;padding:12px 0 12px 8px;background:#131c2a;z-index:1000}"],changeDetection:0})}Fi([(0,l.l6)(j.N.getStoryChapters),Ri("design:type",_.c)],ut.prototype,"chapters$",void 0),Fi([(0,l.l6)(j.N.getSelectedChapterId),Ri("design:type",_.c)],ut.prototype,"selectedChapterId$",void 0),Fi([(0,l.l6)(he.j.getAllQuestions),Ri("design:type",_.c)],ut.prototype,"allQuestions$",void 0),Fi([(0,l.l6)(he.j.getActiveQuestionId),Ri("design:type",_.c)],ut.prototype,"activeQuestionId$",void 0),Fi([(0,l.l6)(he.j.getQuizEnabled),Ri("design:type",_.c)],ut.prototype,"quizEnabled$",void 0),Fi([(0,l.l6)(je.J.getSelectedBookmarkViewMode),Ri("design:type",_.c)],ut.prototype,"bookmarkViewMode$",void 0);var $h=v(77428);let Oh=(()=>{class s{get count(){return this._count}set count(t){this._count=t}constructor(){this._count=0}ngOnInit(){}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-reload-countdown"]],inputs:{count:"count"},decls:6,vars:1,consts:[["data-test","reloadCountdown",1,"reload-countdown"],["total","90",3,"value"],[1,"text-base","mt-2"],[1,"text-xs"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.nrm(1,"app-progress",1),e.j41(2,"div",2),e.EFF(3,"Duplicating states on the server."),e.k0s(),e.j41(4,"div",3),e.EFF(5," This page will automatically reload in 90 seconds. You may reload it sooner at your own risk, however it's possible not all states will have completed duplicating. "),e.k0s()()),2&n&&(e.R7$(),e.Y8G("value",o.count))},dependencies:[$h.X],styles:["[_nghost-%COMP%]{display:flex;position:absolute;justify-content:center;align-items:center;background:#00000080;color:#fff;z-index:10000;inset:0}.reload-countdown[_ngcontent-%COMP%]{width:400px;height:400px}"],changeDetection:0})}return s})();var wa=v(82542),Ah=v(90917),is=v(43631),ns=v(65478),Uh=v(7806),Vh=v(60724),Fa=(v(57238),function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a}),Ra=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const os=s=>({hidden:s});class Pi{constructor(i,t,n){this.dialog=i,this.dialogService=t,this.editService=n,this.selected=!1}handleDuplicateClick(){this.duplicateChapter()}handleRemoveClick(){this.removeChapter()}handleContentClick(){this.openChapterContentDialog(this.chapter.id)}duplicateChapter(){this.editService.duplicateChapter(this.chapter)}removeChapter(){this.dialogService.openConfirmDialog({data:{titleText:"Remove chapter",bodyText:"This cannot be undone.",confirmText:"Remove",confirmColor:"warn"}}).afterClosed().subscribe(t=>{t&&this.editService.removeChapter(this.chapter)})}openChapterContentDialog(i){this.dialog.open(ot,{width:"60vw",height:"auto",data:{chapterId:i}})}static#e=this.\u0275fac=function(t){return new(t||Pi)(e.rXU(ee.bZ),e.rXU(Xe.o),e.rXU(Xo))};static#t=this.\u0275cmp=e.VBU({type:Pi,selectors:[["app-chapter-actions"]],inputs:{chapter:"chapter",selected:"selected"},decls:10,vars:14,consts:[[1,"flex","gap-2"],["buttonSize","2xs","mode","starting",3,"ngClass","chapter","openPositionsOption"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","matTooltipPosition","below","data-test","editInfo",3,"click","ngClass"],[3,"ngClass"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","buttonShape","square","matTooltipPosition","below","matTooltip","Duplicate This Chapter","data-test","duplicateChapter",3,"click"],["size","sm","icon","clone"],["app-button","","buttonTheme","dark","buttonType","outline","buttonSize","2xs","buttonShape","square","matTooltipPosition","below","matTooltip","Remove Chapter",3,"click","disabled"],["size","sm","icon","trash-alt"]],template:function(t,n){if(1&t&&(e.j41(0,"div",0),e.nrm(1,"app-capture-position",1),e.j41(2,"button",2),e.bIt("click",function(){return n.handleContentClick()}),e.EFF(3," Edit Info "),e.k0s(),e.j41(4,"app-button-group",3)(5,"button",4),e.bIt("click",function(){return n.handleDuplicateClick()}),e.nrm(6,"app-icon",5),e.k0s(),e.j41(7,"button",6),e.nI1(8,"async"),e.bIt("click",function(){return n.handleRemoveClick()}),e.nrm(9,"app-icon",7),e.k0s()()()),2&t){let o;e.R7$(),e.Y8G("ngClass",e.eq3(8,os,!n.selected))("chapter",n.chapter)("openPositionsOption",!0),e.R7$(),e.Y8G("ngClass",e.eq3(10,os,!n.selected)),e.R7$(2),e.Y8G("ngClass",e.eq3(12,os,!n.selected)),e.R7$(3),e.Y8G("disabled",1===(null==(o=e.bMT(8,6,n.chapters$))?null:o.length))}},dependencies:[w.YU,Ce.oV,Y.Q,gi,X.R,Wo,w.Jj],changeDetection:0})}function Lh(s,i){1&s&&(e.j41(0,"span",11),e.EFF(1,"No title"),e.k0s())}function Yh(s,i){if(1&s&&(e.nrm(0,"div",12),e.nI1(1,"markdown"),e.nI1(2,"async")),2&s){const t=e.XpG();e.Y8G("innerHTML",e.bMT(2,3,e.bMT(1,1,t.shortDescription)),e.npT)}}function zh(s,i){1&s&&(e.j41(0,"div",13)(1,"span",11),e.EFF(2,"No description"),e.k0s()())}Fa([(0,l.l6)(j.N.getStoryChapters),Ra("design:type",_.c)],Pi.prototype,"chapters$",void 0),Fa([(0,l.l6)(Un.K.getRegisteredThumbnails),Ra("design:type",_.c)],Pi.prototype,"thumbnails$",void 0);let Pa=(()=>{class s{constructor(){this.canRemove=!0,this.compact=!1,this.duplicate=new e.bkB,this.remove=new e.bkB}get chapter(){return this._chapter}set chapter(t){this._chapter=t}get shortDescription(){const n=this.chapter?.description||"";return n.length<=48?n:n.replace("<br>","").substr(0,45)+"..."}handleDuplicateClick(){this.duplicate.emit(this.chapter)}handleRemoveClick(){this.remove.emit(this.chapter)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-chapter-card"]],inputs:{chapter:"chapter",selected:"selected",canRemove:"canRemove",compact:"compact",thumbnail:"thumbnail"},outputs:{duplicate:"duplicate",remove:"remove"},decls:12,vars:14,consts:[["data-test","chapterCard",1,"chapter-card"],[1,"chapter-card__content"],[1,"chapter-card__image",3,"matTooltip","matTooltipPosition","matTooltipDisabled"],[3,"thumbnail"],[1,"chapter-card__body"],[1,"chapter-card__title"],["class","italic text-gray-400",4,"ngIf"],["class","chapter-card__description html",3,"innerHTML",4,"ngIf"],["class","chapter-card__description",4,"ngIf"],[1,"chapter-card__actions"],[3,"selected","chapter"],[1,"italic","text-gray-400"],[1,"chapter-card__description","html",3,"innerHTML"],[1,"chapter-card__description"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"app-thumbnail-view",3),e.k0s(),e.j41(4,"div",4)(5,"div",5),e.EFF(6),e.DNE(7,Lh,2,0,"span",6),e.k0s(),e.DNE(8,Yh,3,5,"div",7)(9,zh,3,0,"div",8),e.k0s()(),e.j41(10,"div",9),e.nrm(11,"app-chapter-actions",10),e.k0s()()),2&n&&(e.AVh("chapter-card--selected",o.selected)("chapter-card--compact",o.compact),e.R7$(2),e.Y8G("matTooltip",o.chapter.displayName)("matTooltipPosition","right")("matTooltipDisabled",!o.compact),e.R7$(),e.Y8G("thumbnail",o.thumbnail),e.R7$(3),e.SpI(" ",o.chapter.displayName," "),e.R7$(),e.Y8G("ngIf",!o.chapter.displayName),e.R7$(),e.Y8G("ngIf",o.shortDescription),e.R7$(),e.Y8G("ngIf",!o.shortDescription),e.R7$(2),e.Y8G("selected",o.selected)("chapter",o.chapter))},dependencies:[w.bT,Ce.oV,Ho.J,Pi,w.Jj,Gn.i0],styles:[".chapter-card[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:8px;transition:background-color .12s}.chapter-card[_ngcontent-%COMP%]:active{cursor:grabbing}.chapter-card[_ngcontent-%COMP%]:hover, .chapter-card--selected[_ngcontent-%COMP%]:hover{background-color:#283853b3;cursor:pointer}.chapter-card[_ngcontent-%COMP%]:hover   .chapter-card__title[_ngcontent-%COMP%], .chapter-card--selected[_ngcontent-%COMP%]:hover   .chapter-card__title[_ngcontent-%COMP%]{color:#fff}.chapter-card--loading[_ngcontent-%COMP%]{background:#1c2a3fcc;display:flex;margin:-4px;position:absolute;inset:0;justify-content:center;align-items:center}.chapter-card--selected[_ngcontent-%COMP%]{background:#1c2a3f}.chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__title[_ngcontent-%COMP%], .chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__description[_ngcontent-%COMP%]{color:#fff}.chapter-card--selected[_ngcontent-%COMP%]   .chapter-card__image[_ngcontent-%COMP%]{border-color:#2d72dc}.chapter-card__content[_ngcontent-%COMP%]{display:flex}.chapter-card__image[_ngcontent-%COMP%]{border-radius:4px;border:2px solid transparent;flex:0 0 90px;height:90px;position:relative}.chapter-card__body[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;padding:0 0 0 12px;overflow:hidden}.chapter-card__title[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;font-weight:700;word-break:break-word;color:#d7e0ea;white-space:initial}.chapter-card__description[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;color:#d7e0ea}.chapter-card__actions[_ngcontent-%COMP%]{margin-top:8px;text-align:right}.chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__content[_ngcontent-%COMP%]{justify-content:center}.chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__body[_ngcontent-%COMP%], .chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__actions[_ngcontent-%COMP%], .chapter-card--compact[_ngcontent-%COMP%]   .chapter-card__add[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}return s})();var ss=v(97948),_n=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},vn=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};class St{constructor(i,t,n,o){this.store=i,this.storageService=t,this.dialogRef=n,this.changeDetectorRef=o,this.application=Fe.c.application,this.actionMode=Ls.g.Import,this.contentType=It.c.Module,this.ngUnsubscribe=new f.B}ngOnInit(){this.initGallery(),this.observeSearchConfig()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initGallery(){const i=this.getDefaultSearchConfig(),t=this.store.selectSnapshot(di.Y.getSearchOptions)||new Ys.n("",Vs.Ir);this.store.dispatch(new _t.w.SetCardActions({enabled:!1})),this.store.dispatch(new _t.w.SetBulkActions({enabled:!1,items:[]})),this.store.dispatch(new _t.w.SetSearchConfig(i)),this.store.dispatch(new _t.w.SetSearchOptions(t))}observeSearchConfig(){this.searchConfig$.pipe((0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.contentType=i.type===ss.n.Category?It.c.Module:It.c.Bookmark,i.type===ss.n.Loft&&this.saveSearchConfig(i),this.changeDetectorRef.markForCheck()})}handleSelect(i){this.store.dispatch(new _t.w.SelectBookmark(i)),this.dialogRef.close(i)}getDefaultSearchConfig(){if(Fe.c.application===Me.c.Studio)return new Ln.pf("all");{const i=this.storageService.getLocalJSON(Ue.UT.RecentSearchConfig);if(i?.type===ss.n.Loft){const{primary:t,secondary:n}=i;return new Ln.qS(t,n)}return new Ln.qS("production","maleAdult")}}saveSearchConfig({type:i,primary:t,secondary:n}){this.storageService.setLocalItem(Ue.UT.RecentSearchConfig,{type:i,primary:t,secondary:n})}static#e=this.\u0275fac=function(t){return new(t||St)(e.rXU(l.il),e.rXU(Ue.n$),e.rXU(ee.CP),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:St,selectors:[["app-import-model-dialog"]],decls:5,vars:5,consts:[[1,"import"],[1,"import__header"],[1,"import__body"],["selectLabel","Import",3,"selectBookmark","actionMode","actionsEnabled","application","contentType","showSourcePicker"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2,"Import Chapters"),e.k0s(),e.j41(3,"div",2)(4,"app-gallery-container",3),e.bIt("selectBookmark",function(a){return n.handleSelect(a)}),e.k0s()()()),2&t&&(e.R7$(4),e.Y8G("actionMode",n.actionMode)("actionsEnabled",!1)("application",n.application)("contentType",n.contentType)("showSourcePicker",!0))},dependencies:[zs.j],styles:["[_nghost-%COMP%]{display:block;position:relative;padding:24px;width:100%;height:100%}.import[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.import__header[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem;border-bottom:solid 1px rgba(0,0,0,.12);padding:8px 20px;display:flex;align-items:center}.import__body[_ngcontent-%COMP%]{flex:1 0 auto;position:relative}"],changeDetection:0})}_n([(0,l.l6)(di.Y.getViewMode),vn("design:type",_.c)],St.prototype,"viewMode$",void 0),_n([(0,l.l6)(di.Y.getLoading),vn("design:type",_.c)],St.prototype,"loading$",void 0),_n([(0,l.l6)(di.Y.getFilteredResults),vn("design:type",_.c)],St.prototype,"results$",void 0),_n([(0,l.l6)(di.Y.getSearchConfig),vn("design:type",_.c)],St.prototype,"searchConfig$",void 0),_n([(0,l.l6)(Oe.k.isPremiumUser),vn("design:type",_.c)],St.prototype,"isPremiumUser$",void 0);var Xh=v(93253),no=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},oo=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Qh=["chapterBrowser"];function qh(s,i){1&s&&(e.j41(0,"div",9),e.nrm(1,"app-spinner",10),e.k0s())}function Hh(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",11)(1,"app-chapter-card",12),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.handleClickChapter(o))})("remove",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleRemove(o))})("duplicate",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleDuplicate(o))}),e.k0s()()}if(2&s){let t,n;const o=i.$implicit,a=e.XpG();e.R7$(),e.Y8G("id","chapter-card__"+o.id)("chapter",o)("thumbnail",null==(t=e.bMT(2,6,a.thumbnails$))?null:t.get(o.id))("selected",(null==(n=e.bMT(3,8,a.selectedChapter$))?null:n.id)===o.id)("canRemove",e.bMT(4,10,a.chapters$).length>1)("compact",a.compact)}}class xt{constructor(i,t,n){this.store=i,this.editService=t,this.dialog=n,this.compact=!1,this.ngUnsubscribe=new f.B,this.currentChapterId=""}ngOnInit(){}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngAfterViewInit(){this.selectedChapter$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.currentChapterId=i.id,setTimeout(()=>{this.scrollChapterIntoView(i)})})}handleDrop(i){this.store.dispatch(new U.Oj(i.previousIndex,i.currentIndex))}handleClickChapter(i){i.id!==this.currentChapterId&&this.store.dispatch(new U.yz(i))}handleImportChapters(){this.dialog.open(St,{id:zi.t.ImportDialog,maxWidth:"90vw",width:"90vw",height:"90vh"}).afterClosed().pipe((0,I.p)(t=>null!=t)).subscribe(t=>{const n=this.store.selectSnapshot(Oe.k.getUserLanguage);this.store.dispatch(new Ee.fn(t.id,t.type,n))})}handleNextClick(){this.store.dispatch(new U.tg)}handlePreviousClick(){this.store.dispatch(new U.F0)}handleDuplicate(i){this.duplicateChapter(i)}handleDuplicateSelected(){const i=this.store.selectSnapshot(j.N.getSelectedChapter);this.duplicateChapter(i)}handleRemove(i){this.removeChapter(i)}duplicateChapter(i){this.editService.duplicateChapter(i)}removeChapter(i){this.dialog.open(Xh.w,{data:{titleText:"Remove chapter",bodyText:"This cannot be undone.",confirmText:"Remove",confirmColor:"warn"}}).afterClosed().subscribe(t=>{t&&this.editService.removeChapter(i)})}trackChapter(i,t){return t.id}scrollChapterIntoView(i){const t=document.getElementById(`chapter-card__${i.id}`);(0,ga.uK)()&&t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}static#e=this.\u0275fac=function(t){return new(t||xt)(e.rXU(l.il),e.rXU(Xo),e.rXU(ee.bZ))};static#t=this.\u0275cmp=e.VBU({type:xt,selectors:[["app-chapter-browser"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Qh,7),e.GBs(Pa,5)),2&t){let o;e.mGM(o=e.lsd())&&(n.chapterBrowserElement=o.first),e.mGM(o=e.lsd())&&(n.chapterCards=o)}},inputs:{compact:"compact"},decls:16,vars:13,consts:[["chapterBrowser",""],["importMenu","matMenu"],["data-test","chapterBrowser","cdkDropList","","cdkDropListOrientation","vertical",1,"chapter-browser",3,"cdkDropListDropped"],["data-test","chapterSpinner","class","chapter-browser__scrim",4,"ngIf"],["class","chapter-browser__item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"chapter-browser__add"],["app-button","","buttonType","flat","data-test","addChapter",1,"w-full",3,"matMenuTriggerFor"],["mat-menu-item","",2,"min-width","240px",3,"click"],["mat-menu-item","","data-test","importChapter",3,"click"],["data-test","chapterSpinner",1,"chapter-browser__scrim"],["size","huge"],["cdkDrag","",1,"chapter-browser__item"],[3,"click","remove","duplicate","id","chapter","thumbnail","selected","canRemove","compact"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",2,0),e.bIt("cdkDropListDropped",function(r){return e.eBV(o),e.Njj(n.handleDrop(r))}),e.DNE(2,qh,2,0,"div",3),e.nI1(3,"async"),e.DNE(4,Hh,5,12,"div",4),e.nI1(5,"async"),e.j41(6,"div",5)(7,"button",6),e.EFF(8," Add Chapter "),e.k0s()()(),e.j41(9,"mat-menu",null,1)(11,"button",7),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleDuplicateSelected())}),e.EFF(12),e.nI1(13,"async"),e.k0s(),e.j41(14,"button",8),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleImportChapters())}),e.EFF(15," Import Chapters... "),e.k0s()()}if(2&t){let o;const a=e.sdS(10);e.AVh("chapter-browser--compact",n.compact),e.R7$(2),e.Y8G("ngIf",!e.bMT(3,7,n.allChaptersLoaded$)),e.R7$(2),e.Y8G("ngForOf",e.bMT(5,9,n.chapters$))("ngForTrackBy",n.trackChapter),e.R7$(3),e.Y8G("matMenuTriggerFor",a),e.R7$(5),e.SpI(' Duplicate "',(null==(o=e.bMT(13,11,n.selectedChapter$))?null:o.displayName)||"Chapter",'" ')}},dependencies:[w.Sq,w.bT,te.O7,te.T1,D.kk,D.fb,D.Cp,Y.Q,ci.tI,Pa,w.Jj],styles:[".chapter-browser[_ngcontent-%COMP%]{display:flex;flex-direction:column;-webkit-user-select:none;user-select:none;position:relative}.chapter-browser__scrim[_ngcontent-%COMP%]{background:#10182380;display:flex;justify-content:center;align-items:center;position:absolute;z-index:9;inset:0}.chapter-browser__item[_ngcontent-%COMP%]{flex:0 0 100%;display:block;padding:8px 0}.chapter-browser__item[_ngcontent-%COMP%]:last-child{border-bottom:0}.chapter-browser__item.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px 4px 0 0;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.chapter-browser__item.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.chapter-browser__add[_ngcontent-%COMP%]{bottom:0;position:sticky;background:#131c2a;padding:12px 0;z-index:1000}.chapter-browser__new[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;border-radius:4px;color:#374a68;min-height:60px;width:100%;border:1px dashed #374a68;display:flex;justify-content:center;align-items:center;text-align:center;margin:8px 0;padding:12px;transition:border-color .06s,color}.chapter-browser__new[_ngcontent-%COMP%]:hover{border-color:#fff;color:#fff;cursor:pointer}.chapter-browser[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.2}.chapter-browser[_ngcontent-%COMP%]   .cdk-drop-list-dragging[_ngcontent-%COMP%]   .chapter-browser__item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.chapter-browser--compact[_ngcontent-%COMP%]   .chapter-browser__add[_ngcontent-%COMP%]{display:none}"],changeDetection:0})}no([(0,l.l6)(j.N.getStoryChapters),oo("design:type",_.c)],xt.prototype,"chapters$",void 0),no([(0,l.l6)(j.N.getSelectedChapter),oo("design:type",_.c)],xt.prototype,"selectedChapter$",void 0),no([(0,l.l6)(Un.K.getRegisteredThumbnails),oo("design:type",_.c)],xt.prototype,"thumbnails$",void 0),no([(0,l.l6)(j.N.getAllChaptersModelsReady),oo("design:type",_.c)],xt.prototype,"allChaptersLoaded$",void 0);var ja=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Ma=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function Wh(s,i){if(1&s&&(e.j41(0,"button",29)(1,"span"),e.EFF(2,"Select"),e.k0s(),e.nrm(3,"app-icon",30),e.k0s()),2&s){e.XpG();const t=e.sdS(5);e.Y8G("matMenuTriggerFor",t)}}function Jh(s,i){1&s&&e.EFF(0," structure ")}function Kh(s,i){1&s&&e.EFF(0," structures ")}function Zh(s,i){if(1&s&&(e.j41(0,"button",31),e.EFF(1),e.nI1(2,"async"),e.nI1(3,"number"),e.DNE(4,Jh,1,0),e.nI1(5,"async"),e.nI1(6,"async"),e.DNE(7,Kh,1,0),e.EFF(8," selected "),e.nrm(9,"app-icon",32),e.k0s()),2&s){const t=e.XpG(),n=e.sdS(14);e.Y8G("matMenuTriggerFor",n),e.R7$(),e.SpI(" ",e.bMT(3,5,e.bMT(2,3,t.checkedNodesCount$))," "),e.R7$(3),e.vxM(1===e.bMT(5,7,t.checkedNodesCount$)?4:e.bMT(6,9,t.checkedNodesCount$)>1?7:-1)}}function ef(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",34),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleSelectAvailable(!1))}),e.EFF(2," Select Available "),e.k0s(),e.j41(3,"button",35),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleSelectUnavailable(!1))}),e.EFF(4," Select Unavailable "),e.k0s(),e.bVm()}}function tf(s,i){if(1&s&&(e.qex(0),e.DNE(1,ef,5,0,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.perChapterTreeEnabled$))}}function nf(s,i){if(1&s&&(e.qex(0),e.j41(1,"button",36),e.EFF(2," Available / Unavailable "),e.k0s(),e.bVm()),2&s){e.XpG(2);const t=e.sdS(65);e.R7$(),e.Y8G("matMenuTriggerFor",t)}}function of(s,i){if(1&s&&(e.qex(0),e.DNE(1,nf,3,1,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.perChapterTreeEnabled$))}}function sf(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",34),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleSelectAvailable(!0))}),e.EFF(2," Select Available "),e.k0s(),e.j41(3,"button",35),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.handleSelectUnavailable(!0))}),e.EFF(4," Select Unavailable "),e.k0s(),e.bVm()}}function af(s,i){if(1&s&&(e.qex(0),e.DNE(1,sf,5,0,"ng-container",33),e.nI1(2,"async"),e.bVm()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.perChapterTreeEnabled$))}}class ji{constructor(i,t){this.store=i,this.graphService=t,this.application=Me.c,this.leaves=[]}handleClearSelection(){this.store.dispatch(new re.q9(!1))}handleBulkShow(){this.store.dispatch(new re.yr(!0,this.store.selectSnapshot(ye.z.getCheckedNodeIds)))}handleBulkHide(){const i=this.store.selectSnapshot(ye.z.getNodes),t=Object.values(i).reduce((n,o)=>(n[o.objectId]=!o.checked&&o.shown,n),{});this.store.dispatch(new re.yr(!1,[],t))}handleHideInverse(){const i=this.store.selectSnapshot(ye.z.getNodes),t=Object.values(i).reduce((n,o)=>(n[o.objectId]=!!o.checked&&o.shown,n),{});this.store.dispatch(new re.yr(!1,[],t))}handleSelectAll(){this.store.dispatch(new re.q9(!0))}handleSelectInverse(){this.selectNodesByFilter(({checked:i})=>!i)}handleSelectShown(i){this.selectNodesByFilter(({shown:t,checked:n})=>!(i&&!n)&&t)}handleSelectHidden(i){this.selectNodesByFilter(({shown:t,checked:n})=>!(i&&!n||t))}handleSelectAvailable(i){this.selectNodesByFilter(({available:t,checked:n})=>!(i&&!n)&&t)}handleSelectUnavailable(i){this.selectNodesByFilter(({available:t,checked:n})=>!(i&&!n||t))}handleBulkPickable(i){const t=this.store.selectSnapshot(ye.z.getNodes),n=Object.values(t).reduce((o,a)=>(o[a.objectId]=a.checked?i:a.pickable,o),{});this.store.dispatch(new re.Ke(!1,[],n))}handleInverseUnpickable(){const i=this.store.selectSnapshot(ye.z.getNodes),t=Object.values(i).reduce((n,o)=>(n[o.objectId]=!!o.checked&&o.pickable,n),{});this.store.dispatch(new re.Ke(!1,[],t))}handleBulkAvailable(i){const t=this.store.selectSnapshot(ye.z.getNodes),n=Object.values(t).reduce((o,a)=>(o[a.objectId]=a.checked?i:a.available,o),{});this.store.dispatch(new re.Ws(!1,[],n))}handleFadeSelected(){const i=this.store.selectSnapshot(ye.z.getCheckedNodeIds);this.store.dispatch(new re.Jp(Ht.EC,i))}handleFadeInverse(){const i=this.store.selectSnapshot(ye.z.getCheckedNodeIds),t=this.store.selectSnapshot(S.S.getViewGraph),n=this.graphService.getInverseSelection(t,i);this.store.dispatch(new re.Jp(Ht.EC,n))}selectNodesByFilter(i){const t=this.store.selectSnapshot(ye.z.getNodes),n=Object.entries(t).reduce((o,[a,r])=>(o[a]=i(r),o),{});this.store.dispatch(new re.q9(!1,[],n))}static#e=this.\u0275fac=function(t){return new(t||ji)(e.rXU(l.il),e.rXU(zn.w))};static#t=this.\u0275cmp=e.VBU({type:ji,selectors:[["app-checked-nodes"]],decls:70,vars:16,consts:[["selectMenu","matMenu"],["checkAllMenu","matMenu"],["selectActions","matMenu"],["showHideActions","matMenu"],["fadeActions","matMenu"],["pickableActions","matMenu"],["availableActions","matMenu"],["app-button","","buttonSize","xs","data-test","selectStructuresMenu",3,"matMenuTriggerFor",4,"ngIf"],["app-button","","buttonSize","xs","data-test","selectedNodesMenu",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","","data-test","selectAllStructures",3,"click"],["mat-menu-item","","data-test","selectShownStructures",3,"click"],["mat-menu-item","","data-test","selectHiddenStructures",3,"click"],[4,"appFlagApplication","appFlagApplicationMode"],["mat-menu-item","","data-test","selectActionsMenu",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","showHideMenu",3,"matMenuTriggerFor"],["data-test","nodeActionsFadeTrigger","mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","","data-test","pickableMenu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","selectEverythingElse",3,"click"],["mat-menu-item","","data-test","showSelected",3,"click"],["mat-menu-item","","data-test","hideSelected",3,"click"],["mat-menu-item","","data-test","hideEverythingElse",3,"click"],["mat-menu-item","","data-test","fadeThis",3,"click"],["mat-menu-item","","data-test","fadeEverythingElse",3,"click"],["mat-menu-item","","data-test","makePickable",3,"click"],["mat-menu-item","","data-test","makeUnpickable",3,"click"],["mat-menu-item","","data-test","makeEverythingElseUnpickable",3,"click"],["mat-menu-item","","data-test","makeAvailable",3,"click"],["mat-menu-item","","data-test","makeUnavailable",3,"click"],["app-button","","buttonSize","xs","data-test","selectStructuresMenu",3,"matMenuTriggerFor"],["icon","caret-down",1,"ml-1"],["app-button","","buttonSize","xs","data-test","selectedNodesMenu",3,"matMenuTriggerFor"],["icon","caret-down",1,"inline-block","pl-1"],[4,"ngIf"],["mat-menu-item","","data-test","selectAvailableStructures",3,"click"],["mat-menu-item","","data-test","selectUnavailableStructures",3,"click"],["mat-menu-item","","data-test","availableMenu",3,"matMenuTriggerFor"]],template:function(t,n){if(1&t){const o=e.RV6();e.DNE(0,Wh,4,1,"button",7),e.nI1(1,"async"),e.DNE(2,Zh,10,11,"button",8),e.nI1(3,"async"),e.j41(4,"mat-menu",null,0)(6,"button",9),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectAll())}),e.EFF(7," Select All "),e.k0s(),e.j41(8,"button",10),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectShown(!1))}),e.EFF(9," Select Visible (Shown) "),e.k0s(),e.j41(10,"button",11),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectHidden(!1))}),e.EFF(11," Select Hidden "),e.k0s(),e.DNE(12,tf,3,3,"ng-container",12),e.k0s(),e.j41(13,"mat-menu",null,1)(15,"button",13),e.EFF(16," Select "),e.k0s(),e.nrm(17,"mat-divider"),e.j41(18,"button",14),e.EFF(19," Show / Hide "),e.k0s(),e.j41(20,"button",15),e.EFF(21," Fade "),e.k0s(),e.j41(22,"button",16),e.EFF(23," Selectable / Unselectable "),e.k0s(),e.DNE(24,of,3,3,"ng-container",12),e.nrm(25,"mat-divider"),e.j41(26,"button",17),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleClearSelection())}),e.EFF(27,"Clear Selection"),e.k0s()(),e.j41(28,"mat-menu",null,2)(30,"button",18),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectInverse())}),e.EFF(31," Select Everything Else "),e.k0s(),e.j41(32,"button",10),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectShown(!0))}),e.EFF(33," Select Visible (Shown) "),e.k0s(),e.j41(34,"button",11),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectHidden(!0))}),e.EFF(35," Select Hidden "),e.k0s(),e.DNE(36,af,3,3,"ng-container",12),e.nrm(37,"mat-divider"),e.j41(38,"button",17),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleClearSelection())}),e.EFF(39,"Clear Selection"),e.k0s()(),e.j41(40,"mat-menu",null,3)(42,"button",19),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkShow())}),e.EFF(43,"Show Selected"),e.k0s(),e.j41(44,"button",20),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkHide())}),e.EFF(45,"Hide Selected"),e.k0s(),e.nrm(46,"mat-divider"),e.j41(47,"button",21),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleHideInverse())}),e.EFF(48," Hide Everything Else "),e.k0s()(),e.j41(49,"mat-menu",null,4)(51,"button",22),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleFadeSelected())}),e.EFF(52,"Fade Selected"),e.k0s(),e.j41(53,"button",23),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleFadeInverse())}),e.EFF(54," Fade Everything Else "),e.k0s()(),e.j41(55,"mat-menu",null,5)(57,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkPickable(!0))}),e.EFF(58," Make Selectable "),e.k0s(),e.j41(59,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkPickable(!1))}),e.EFF(60," Make Unselectable "),e.k0s(),e.nrm(61,"mat-divider"),e.j41(62,"button",26),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleInverseUnpickable())}),e.EFF(63," Make Everything Else Unselectable "),e.k0s()(),e.j41(64,"mat-menu",null,6)(66,"button",27),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkAvailable(!0))}),e.EFF(67," Make Available "),e.k0s(),e.j41(68,"button",28),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleBulkAvailable(!1))}),e.EFF(69," Make Unavailable "),e.k0s()()}if(2&t){const o=e.sdS(29),a=e.sdS(41),r=e.sdS(50),p=e.sdS(56);e.Y8G("ngIf",0===e.bMT(1,12,n.checkedNodesCount$)),e.R7$(2),e.Y8G("ngIf",e.bMT(3,14,n.checkedNodesCount$)),e.R7$(10),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include"),e.R7$(3),e.Y8G("matMenuTriggerFor",o),e.R7$(3),e.Y8G("matMenuTriggerFor",a),e.R7$(2),e.Y8G("matMenuTriggerFor",r),e.R7$(2),e.Y8G("matMenuTriggerFor",p),e.R7$(2),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include"),e.R7$(12),e.Y8G("appFlagApplication",n.application.Loft)("appFlagApplicationMode","include")}},dependencies:[w.bT,D.kk,D.fb,D.Cp,Je.q,Y.Q,Vi.Y,X.R,w.Jj,w.QX],changeDetection:0})}ja([(0,l.l6)(is._.getPerChapterTreeEnabled),Ma("design:type",_.c)],ji.prototype,"perChapterTreeEnabled$",void 0),ja([(0,l.l6)(ye.z.getCheckedNodesCount),Ma("design:type",_.c)],ji.prototype,"checkedNodesCount$",void 0);var ht=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},ft=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const rf=["columnBody"],lf=["columnGroupBody"],cf=["searchInput"];function pf(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",28)(1,"button",29),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleToggleAvailableNodesShown(!0))}),e.EFF(3," Entire Tree "),e.k0s(),e.j41(4,"button",29),e.nI1(5,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleToggleAvailableNodesShown(!1))}),e.EFF(6," Chapter Tree "),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("buttonType",!0===e.bMT(2,2,t.showUnavailableNodes$)?"blue-fill":"default"),e.R7$(3),e.Y8G("buttonType",!1===e.bMT(5,4,t.showUnavailableNodes$)?"blue-fill":"default")}}function df(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",30),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.clearQuery())}),e.EFF(1," Clear "),e.k0s()}}function mf(s,i){if(1&s&&(e.j41(0,"button",31),e.nrm(1,"app-icon",32),e.k0s()),2&s){e.XpG();const t=e.sdS(31);e.Y8G("matMenuTriggerFor",t)}}function uf(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",33),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.setLayerOrderMode(!1))}),e.nrm(1,"app-icon",34),e.k0s()}}function hf(s,i){if(1&s&&(e.j41(0,"div",35),e.nrm(1,"app-tree",36),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("theme",t.themeEnum.Dark)("graph",e.bMT(2,4,t.treeGraph$))("layerOrderMode",e.bMT(3,6,t.layerOrderMode$))("showTreeNodeIds",e.bMT(4,8,t.showTreeNodeIds$))}}function ff(s,i){if(1&s&&(e.j41(0,"div"),e.nrm(1,"app-tree-nested-node",39),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.k0s()),2&s){const t=i.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("theme",n.themeEnum.Dark)("node",t)("graph",e.bMT(2,6,n.treeGraph$))("nested",!1)("layerOrderMode",e.bMT(3,8,n.layerOrderMode$))("showTreeNodeIds",e.bMT(4,10,n.showTreeNodeIds$))}}function gf(s,i){if(1&s&&(e.j41(0,"cdk-virtual-scroll-viewport",37),e.DNE(1,ff,5,12,"div",38),e.k0s()),2&s){const t=e.XpG();e.xc7("height",t.searchHeight,"px"),e.Y8G("itemSize",48),e.R7$(),e.Y8G("cdkVirtualForOf",t.searchResults)("cdkVirtualForTrackBy",t.trackTreeNode)}}class We{get selectedColumnGroup(){return this._selectedColumnGroup}set selectedColumnGroup(i){this._selectedColumnGroup=i}constructor(i,t,n,o){this.store=i,this.renderer=t,this.changeDetector=n,this.engineEventsService=o,this.application=Me.c,this.themeEnum=wa.P,this.isLoft=Fe.c.application===Me.c.Loft,this._selectedColumnGroup="chapters",this.loadingLabel="",this.interactive=!1,this.searchHeight=0,this.searchControl=new c.MJ(""),this.searchResults=[],this.copies=[],this.ngUnsubscribe=new f.B}ngOnInit(){const i=this.store.selectSnapshot(j.N.getSelectedChapter);i&&i.readyState.model&&(this.interactive=!0),this.searchQuery$=this.searchControl.valueChanges.pipe((0,B.Z)(this.searchControl.value)),this.searchQuery$.pipe((0,Qi.E)(this.treeGraph$),(0,y.Q)(this.ngUnsubscribe)).subscribe(([t,n])=>{this.searchResults=this.search(n,t),this.getSearchHeight().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(o=>{this.searchHeight=o,this.changeDetector.markForCheck()})}),this.engineEventsService.getEvent(ct.X.AssetsLoadProgress).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(({chapterProgress:t})=>{const n=this.store.selectSnapshot(j.N.getChaptersLoaded);let o="";n.count>1&&(o=`Loading Chapter ${n.modelChapters.length+1} of ${n.count}: `),o+=`${Math.round(100*t)}%`,this.loadingLabel=o,this.changeDetector.markForCheck()}),this.currentChapter$.pipe((0,I.p)(t=>null!=t),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.interactive=t.readyState.model}),(0,C.z)([this.store.select(ye.z.getCheckedNodesCount),this.store.select(S.S.getLabelEditNode)]).pipe((0,I.p)(([t,n])=>t>0||!(0,R.isNil)(n)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.selectedColumnGroup="anatomy",this.changeDetector.markForCheck()}),this.leftColumnCollapsed$.pipe((0,I.p)(t=>t),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.selectedColumnGroup="chapters",this.changeDetector.markForCheck()})}ngAfterViewInit(){this.renderer.listen("window","resize",i=>{this.getSearchHeight().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.searchHeight=t,this.changeDetector.markForCheck()})})}ngOnDestroy(){this.changeDetector.detach(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleKeyup(i){"Escape"===i.key&&(this.clearQuery(),this.searchInput.nativeElement.blur())}toggleCollapseNavigationClick(){const i=this.store.selectSnapshot(g.getLeftColumnCollapsed);this.store.dispatch(new P.HZ(!i))}handleToggleIds(){this.store.dispatch(new P.m3)}handleToggleRootNodes(){const i=this.store.selectSnapshot(g.getShowRootNodes);this.store.dispatch(new P.N6(!i))}handleToggleAvailableNodesShown(i){this.store.dispatch(new Zs.Z(i))}handleCollapseStructures(){this.store.dispatch(new ie.v$)}getSearchHeight(){return new _.c(i=>{const t=(0,R.get)(this.columnGroupBody,"nativeElement.parentElement.offsetHeight");null!=t&&(i.next(t),i.complete())})}clearQuery(){this.searchControl.setValue("")}search(i,t){return(0,Ah.i)(i,t,[{field:"label",dir:"asc"},{field:"depth",dir:"asc"}])}trackTreeNode(i,t){return t.id}setLayerOrderMode(i){this.store.dispatch(new P.zA(i))}autoSortLayers(){this.store.dispatch(new ie.RZ),this.setLayerOrderMode(!0)}resetLayers(){this.store.dispatch(new ie.PF),this.setLayerOrderMode(!0)}static#e=this.\u0275fac=function(t){return new(t||We)(e.rXU(l.il),e.rXU(e.sFG),e.rXU(e.gRc),e.rXU(fi.y))};static#t=this.\u0275cmp=e.VBU({type:We,selectors:[["app-navigation-context"]],viewQuery:function(t,n){if(1&t&&(e.GBs(rf,5),e.GBs(lf,7),e.GBs(cf,7)),2&t){let o;e.mGM(o=e.lsd())&&(n.columnBody=o.first),e.mGM(o=e.lsd())&&(n.columnGroupBody=o.first),e.mGM(o=e.lsd())&&(n.searchInput=o.first)}},decls:55,vars:35,consts:[["searchInput",""],["treeActions","matMenu"],["layerOrderActions","matMenu"],["columnGroupBody",""],[1,"navigation-context",3,"selectedColumnGroupChange","loadingLabel","loading","showHeader","selectedColumnGroup"],["column-group-actions",""],["app-button","","buttonSize","sm","buttonShape","square","data-test","editColumnToggle",3,"click","matTooltip"],["size","lg",3,"icon"],["label","Chapters"],["column-group-body",""],[1,"pt-2","pl-2"],["label","Anatomy"],["column-group-header",""],[1,"navigation-context__anatomy-header"],["class","mt-2 mb-4 navigation-context__anatomy-toggle",4,"ngIf"],[1,"navigation-context__search"],["type","text","placeholder","Search...",1,"input","navigation-context__input",3,"keyup","formControl"],["app-button","","buttonType","text","class","navigation-context__clear",3,"click",4,"ngIf"],[1,"navigation-context__anatomy-subheader"],[1,"navigation-context__selected"],["app-button","","buttonSize","xs","matTooltip","Collapse Open Tree Structures",3,"click"],["icon","minus","size","xs"],["app-button","","buttonSize","xs","class","ml-1",3,"matMenuTriggerFor",4,"ngIf"],["class","ml-1","app-button","","buttonSize","xs","matTooltip","Exit Layer Order Manager",3,"click",4,"ngIf"],["mat-menu-item","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["class","px-2 pt-2",4,"ngIf"],["style","margin-right: -12px",3,"itemSize","height",4,"ngIf"],[1,"mt-2","mb-4","navigation-context__anatomy-toggle"],["app-button","","buttonSize","sm",1,"flex-auto",3,"click","buttonType"],["app-button","","buttonType","text",1,"navigation-context__clear",3,"click"],["app-button","","buttonSize","xs",1,"ml-1",3,"matMenuTriggerFor"],["icon","ellipsis-v","size","xs"],["app-button","","buttonSize","xs","matTooltip","Exit Layer Order Manager",1,"ml-1",3,"click"],["icon","times"],[1,"px-2","pt-2"],[3,"theme","graph","layerOrderMode","showTreeNodeIds"],[2,"margin-right","-12px",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[2,"height","48px",3,"theme","node","graph","nested","layerOrderMode","showTreeNodeIds"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-column",4),e.nI1(1,"async"),e.mxI("selectedColumnGroupChange",function(r){return e.eBV(o),e.DH7(n.selectedColumnGroup,r)||(n.selectedColumnGroup=r),e.Njj(r)}),e.j41(2,"div",5)(3,"button",6),e.nI1(4,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.toggleCollapseNavigationClick())}),e.nrm(5,"app-icon",7),e.nI1(6,"async"),e.k0s()(),e.j41(7,"app-column-group",8),e.qex(8,9),e.j41(9,"div",10),e.nrm(10,"app-chapter-browser"),e.k0s(),e.bVm(),e.k0s(),e.j41(11,"app-column-group",11),e.qex(12,12),e.j41(13,"div",13),e.DNE(14,pf,7,6,"div",14),e.nI1(15,"async"),e.j41(16,"div",15)(17,"input",16,0),e.bIt("keyup",function(r){return e.eBV(o),e.Njj(n.handleKeyup(r))}),e.k0s(),e.DNE(19,df,2,0,"button",17),e.nI1(20,"async"),e.k0s(),e.j41(21,"div",18),e.nrm(22,"app-checked-nodes",19),e.j41(23,"div")(24,"button",20),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleCollapseStructures())}),e.nrm(25,"app-icon",21),e.k0s(),e.DNE(26,mf,2,1,"button",22),e.nI1(27,"async"),e.DNE(28,uf,2,0,"button",23),e.nI1(29,"async"),e.k0s()(),e.j41(30,"mat-menu",null,1)(32,"button",24),e.EFF(33,"Layer Order"),e.k0s(),e.nrm(34,"mat-divider"),e.j41(35,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleToggleIds())}),e.EFF(36,"Toggle IDs"),e.k0s(),e.j41(37,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleToggleRootNodes())}),e.EFF(38),e.nI1(39,"async"),e.k0s()(),e.j41(40,"mat-menu",null,2)(42,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.setLayerOrderMode(!0))}),e.EFF(43,"Manage Layer Order"),e.k0s(),e.nrm(44,"mat-divider"),e.j41(45,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.autoSortLayers())}),e.EFF(46,"Auto Sort Layer Order"),e.k0s(),e.j41(47,"button",25),e.bIt("click",function(){return e.eBV(o),e.Njj(n.resetLayers())}),e.EFF(48,"Reset Layer Order"),e.k0s()()(),e.bVm(),e.j41(49,"div",9,3),e.DNE(51,hf,5,10,"div",26),e.nI1(52,"async"),e.DNE(53,gf,2,5,"cdk-virtual-scroll-viewport",27),e.nI1(54,"async"),e.k0s()()()}if(2&t){const o=e.sdS(41);e.Y8G("loadingLabel",n.loadingLabel)("loading",!e.bMT(1,15,n.allChaptersReady$))("showHeader",!1),e.R50("selectedColumnGroup",n.selectedColumnGroup),e.R7$(3),e.Y8G("matTooltip",e.bMT(4,17,n.leftColumnCollapsed$)?"Expand":"Collapse"),e.R7$(2),e.Y8G("icon",e.bMT(6,19,n.leftColumnCollapsed$)?"right-to-line":"left-to-line"),e.R7$(9),e.Y8G("ngIf",n.isLoft&&e.bMT(15,21,n.perChapterTreeEnabled$)),e.R7$(3),e.Y8G("formControl",n.searchControl),e.R7$(2),e.Y8G("ngIf",e.bMT(20,23,n.searchQuery$).length>0),e.R7$(7),e.Y8G("ngIf",n.isLoft&&!e.bMT(27,25,n.layerOrderMode$)),e.R7$(2),e.Y8G("ngIf",n.isLoft&&e.bMT(29,27,n.layerOrderMode$)),e.R7$(4),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.SpI(" ",e.bMT(39,29,n.showRootNodes$)?"Hide":"Show"," Root Nodes "),e.R7$(13),e.Y8G("ngIf",0===e.bMT(52,31,n.searchQuery$).length),e.R7$(2),e.Y8G("ngIf",e.bMT(54,33,n.searchQuery$).length>0&&n.searchHeight)}},dependencies:[w.bT,c.me,c.BC,c.l_,D.kk,D.fb,D.Cp,Ce.oV,Je.q,ns.yg,ns.E$,ns.d6,Y.Q,pt,at,X.R,Uh.g,Vh.r,xt,ji,w.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.navigation-context__anatomy-toggle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:4px;background-color:#101823;padding:4px;border-radius:4px}.navigation-context__anatomy-subheader[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.navigation-context__loading[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:center}.navigation-context__search[_ngcontent-%COMP%]{position:relative;margin-bottom:8px}.navigation-context__input[_ngcontent-%COMP%]{padding-right:56px;width:100%}.navigation-context__clear[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.navigation-context__selected[_ngcontent-%COMP%]{display:flex}.navigation-context__actions[_ngcontent-%COMP%]{border-radius:4px;color:#d7e0ea;display:flex;flex:0 0 24px;height:24px;justify-content:center;align-items:center}.navigation-context__actions[_ngcontent-%COMP%]:hover{background-color:#1c2a3f;color:#fff;cursor:pointer}.navigation-context--selected[_ngcontent-%COMP%]   .navigation-context__actions[_ngcontent-%COMP%]:hover{background-color:#2d72dc}"],changeDetection:0})}ht([(0,l.l6)(is._.getPerChapterTreeEnabled),ft("design:type",_.c)],We.prototype,"perChapterTreeEnabled$",void 0),ht([(0,l.l6)(S.S.getTreeGraph),ft("design:type",_.c)],We.prototype,"treeGraph$",void 0),ht([(0,l.l6)(j.N.getSelectedChapter),ft("design:type",_.c)],We.prototype,"currentChapter$",void 0),ht([(0,l.l6)(j.N.getChaptersLoaded),ft("design:type",_.c)],We.prototype,"chaptersLoaded$",void 0),ht([(0,l.l6)(j.N.getAllChaptersModelsReady),ft("design:type",_.c)],We.prototype,"allChaptersReady$",void 0),ht([(0,l.l6)(g.getLayerOrderMode),ft("design:type",_.c)],We.prototype,"layerOrderMode$",void 0),ht([(0,l.l6)(g.getShowRootNodes),ft("design:type",_.c)],We.prototype,"showRootNodes$",void 0),ht([(0,l.l6)(is._.getShowUnavailableNodes),ft("design:type",_.c)],We.prototype,"showUnavailableNodes$",void 0),ht([(0,l.l6)(g.getLeftColumnCollapsed),ft("design:type",_.c)],We.prototype,"leftColumnCollapsed$",void 0),ht([(0,l.l6)(g.getShowTreeNodeIds),ft("design:type",_.c)],We.prototype,"showTreeNodeIds$",void 0);class Cn{constructor(i){this.store=i}toggleCollapseNavigationClick(){const i=this.store.selectSnapshot(g.getLeftColumnCollapsed);this.store.dispatch(new P.HZ(!i))}static#e=this.\u0275fac=function(t){return new(t||Cn)(e.rXU(l.il))};static#t=this.\u0275cmp=e.VBU({type:Cn,selectors:[["app-navigation-context-compact"]],decls:11,vars:9,consts:[[3,"showHeader"],[3,"compact"],["column-group-header",""],[1,"flex","justify-end"],["app-button","","buttonSize","xs","buttonShape","square","data-test","editColumnToggle",3,"click","matTooltip"],["size","lg",3,"icon"],["column-group-body",""],[1,"px-3"]],template:function(t,n){1&t&&(e.j41(0,"app-column",0)(1,"app-column-group",1),e.qex(2,2),e.j41(3,"div",3)(4,"button",4),e.nI1(5,"async"),e.bIt("click",function(){return n.toggleCollapseNavigationClick()}),e.nrm(6,"app-icon",5),e.nI1(7,"async"),e.k0s()(),e.bVm(),e.j41(8,"div",6)(9,"div",7),e.nrm(10,"app-chapter-browser",1),e.k0s()()()()),2&t&&(e.Y8G("showHeader",!1),e.R7$(),e.Y8G("compact",!1),e.R7$(3),e.Y8G("matTooltip",e.bMT(5,5,n.leftColumnCollapsed$)?"Expand":"Collapse"),e.R7$(2),e.Y8G("icon",e.bMT(7,7,n.leftColumnCollapsed$)?"right-to-line":"left-to-line"),e.R7$(4),e.Y8G("compact",!0))},dependencies:[Ce.oV,Y.Q,pt,at,X.R,xt,w.Jj],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(g.getLeftColumnCollapsed),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Cn.prototype,"leftColumnCollapsed$",void 0);var as=v(2094);const Ze=300,yf=["currentTime"];class yn{constructor(i,t,n){this.changeDetection=i,this.engineService=t,this.animationService=n,this.ngUnsubscribe=new f.B,this.currentTimeFocused=!1}ngOnInit(){this.selectedChapterId$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.setCurrentTime(this.animationService.getTime()),this.changeDetection.markForCheck()}),(0,T.h)(this.engineService.getEvent(ct.X.TimelinePlaying),this.engineService.getEvent(ct.X.TimelineScrubbed)).pipe((0,as.c)(20),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setCurrentTime(i.time)}),this.engineService.getEvent(ct.X.TimelineTimeFrameUpdated).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.changeDetection.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleFocus(){this.currentTimeFocused=!0,this.currentTimeInput.nativeElement.value=""}handleBlur(){this.currentTimeFocused=!1,this.animationService.pause();const i=this.animationService.parseFormattedTime(this.currentTimeInput.nativeElement.value||this.currentTime);this.animationService.scrub(i)}setChapterTimeFrame(){this.duration=this.animationService.formatTime(this.animationService.getChapterDuration())}setCurrentTime(i){this.currentTime=this.animationService.formatTime(i),this.currentTimeFocused||(this.currentTimeInput.nativeElement.value=this.currentTime)}static#e=this.\u0275fac=function(t){return new(t||yn)(e.rXU(e.gRc),e.rXU(fi.y),e.rXU(Rt.O))};static#t=this.\u0275cmp=e.VBU({type:yn,selectors:[["app-engine-current-time"]],viewQuery:function(t,n){if(1&t&&e.GBs(yf,7),2&t){let o;e.mGM(o=e.lsd())&&(n.currentTimeInput=o.first)}},decls:5,vars:1,consts:[["currentTime",""],[1,"engine-current-time"],["type","text",1,"input","engine-current-time__current-time",3,"focus","blur"],[1,"text-xs","ml-2"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",1)(1,"input",2,0),e.bIt("focus",function(){return e.eBV(o),e.Njj(n.handleFocus())})("blur",function(){return e.eBV(o),e.Njj(n.handleBlur())}),e.k0s(),e.j41(3,"span",3),e.EFF(4),e.k0s()()}2&t&&(e.R7$(4),e.SpI("/ ",n.duration,""))},styles:[".engine-current-time[_ngcontent-%COMP%]{display:flex;align-items:center;color:#d7e0ea}.engine-current-time__current-time[type=text][_ngcontent-%COMP%]{width:100px;color:inherit}"],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(j.N.getSelectedChapterId),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],yn.prototype,"selectedChapterId$",void 0);let kf=(()=>{class s{constructor(t){this.animationService=t}ngOnInit(){}handleClick(){this.animationService.scrubFrame(this.direction)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(Rt.O))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-engine-frame-control"]],inputs:{direction:"direction"},decls:2,vars:1,consts:[["app-button","","buttonShape","square","type","button",3,"click"],["size","lg",3,"icon"]],template:function(n,o){1&n&&(e.j41(0,"button",0),e.bIt("click",function(){return o.handleClick()}),e.nrm(1,"app-icon",1),e.k0s()),2&n&&(e.R7$(),e.Y8G("icon","next"===o.direction?"step-forward":"step-backward"))},dependencies:[Y.Q,X.R],changeDetection:0})}return s})();var Ia=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Na=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Tf=(s,i)=>({"timeline-map--selected":s,"timeline-map--overlapping":i}),Sf=(s,i)=>({"width.px":s,"left.px":i});function xf(s,i){1&s&&(e.j41(0,"div",9),e.nrm(1,"app-icon",10),e.k0s())}function Ef(s,i){1&s&&(e.j41(0,"div",11),e.nrm(1,"app-icon",12),e.k0s())}function wf(s,i){1&s&&(e.j41(0,"div",13),e.nrm(1,"app-icon",14),e.k0s())}class Mi{constructor(i,t){this.animationService=i,this.changeDetectorRef=t,this.ngUnsubscribe=new f.B}ngOnInit(){this.hasAnimations="dummy"!==this.timelineMap.name&&"dummy"!==this.timelineMap.data.timeline,this.stateTimeRange=this.buildStateTimeRange(),this.looping=!this.timelineMap.data.fit&&"loop"===this.timelineMap.data.onEnd,this.initListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}ngOnChanges(){const i=this.timelineMap.end-this.timelineMap.start;this.left=this.timelineMap.start*Ze*this.scale,this.width=i*Ze*this.scale}initListeners(){this.selectedTimelineMapIds$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.selected=i.has(this.timelineMap.id),this.changeDetectorRef.markForCheck()}),this.overlappingTimelineMapIds$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.overlapping=i.has(this.timelineMap.id),this.changeDetectorRef.markForCheck()})}buildStateTimeRange(){const t=this.timelineMap.data.end;return`${this.animationService.formatTime(this.timelineMap.data.start)} - ${this.animationService.formatTime(t)}`}static#e=this.\u0275fac=function(t){return new(t||Mi)(e.rXU(Rt.O),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Mi,selectors:[["app-timeline-map"]],inputs:{scale:"scale",timelineMap:"timelineMap"},features:[e.OA$],decls:11,vars:13,consts:[[1,"timeline-map",3,"ngClass","ngStyle"],[1,"timeline-map__top"],[1,"timeline-map__name","text-2xs"],[1,"timeline-map__middle"],[1,"timeline-map__state-time-range","text-2xs"],[1,"timeline-map__bottom"],["class","timeline-map__no-animations mr-2",4,"ngIf"],["class","timeline-map__fit mr-2",4,"ngIf"],["class","timeline-map__loop",4,"ngIf"],[1,"timeline-map__no-animations","mr-2"],["icon","exclamation-circle","size","xs","matTooltip","This state has no animations"],[1,"timeline-map__fit","mr-2"],["icon","arrows-alt-h","size","xs"],[1,"timeline-map__loop"],["icon","repeat-alt","size","xs"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3),e.k0s()(),e.j41(4,"div",3)(5,"div",4),e.EFF(6),e.k0s()(),e.j41(7,"div",5),e.DNE(8,xf,2,0,"div",6)(9,Ef,2,0,"div",7)(10,wf,2,0,"div",8),e.k0s()()),2&t&&(e.Y8G("ngClass",e.l_i(7,Tf,n.selected,n.overlapping))("ngStyle",e.l_i(10,Sf,n.width,n.left)),e.R7$(3),e.JRh(n.timelineMap.name),e.R7$(3),e.JRh(n.stateTimeRange),e.R7$(2),e.Y8G("ngIf",!n.hasAnimations),e.R7$(),e.Y8G("ngIf",n.timelineMap.data.fit),e.R7$(),e.Y8G("ngIf",n.looping))},dependencies:[w.YU,w.bT,w.B3,Ce.oV,X.R],styles:[".timeline-map[_ngcontent-%COMP%]{position:absolute;height:100%;background-color:#283853;border:2px solid transparent;border-right:1px solid #131c2a;cursor:pointer;display:flex;flex-direction:column;justify-content:space-evenly;min-width:0;padding:0 4px;-webkit-user-select:none;user-select:none}.timeline-map__top[_ngcontent-%COMP%], .timeline-map__middle[_ngcontent-%COMP%], .timeline-map__bottom[_ngcontent-%COMP%]{display:flex;min-height:33%;flex:0 0 33%;align-items:center}.timeline-map__name[_ngcontent-%COMP%], .timeline-map__state-time-range[_ngcontent-%COMP%]{color:#d7e0ea;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.timeline-map__bottom[_ngcontent-%COMP%]{overflow:hidden}.timeline-map__fit[_ngcontent-%COMP%]{color:#ff0}.timeline-map__loop[_ngcontent-%COMP%]{color:#0ff}.timeline-map--selected[_ngcontent-%COMP%]{border:2px solid #2d72dc;z-index:1}.timeline-map--overlapping[_ngcontent-%COMP%]{background-color:#a81914}"],changeDetection:0})}Ia([(0,l.l6)(Te.getSelectedTimelineMapIds),Na("design:type",_.c)],Mi.prototype,"selectedTimelineMapIds$",void 0),Ia([(0,l.l6)(Te.getOverlappingTimelineMapIds),Na("design:type",_.c)],Mi.prototype,"overlappingTimelineMapIds$",void 0);var Ii=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Ni=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const Ff=["leafTimelinesWindow"],Rf=["rulerWindow"],Pf=["tracksWindow"],jf=["timelineRuler"],Mf=["currentTimeHead"],If=["currentTimeLine"],Nf=["hoverTimeHead"],Bf=["hoverTimeLine"],Df=["hoverTimeLabel"],ei=s=>({"width.px":s}),rs=s=>({"left.px":s}),Gf=s=>({"edit-timeline__hover-time-head--show":s}),$f=s=>({"height.px":s}),Of=s=>({"edit-timeline__hover-time-line--show":s}),Af=s=>({"edit-timeline__seconds-mark":s});function Uf(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",42),e.bIt("mouseenter",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.handleRulerMarkMouseEnter(o))}),e.j41(1,"div",43),e.bIt("click",function(){const o=e.eBV(t).index,a=e.XpG();return e.Njj(a.scrubToRulerMark(o))}),e.EFF(2),e.k0s()()}if(2&s){const t=i.$implicit;e.Y8G("ngStyle",e.eq3(3,rs,t.left))("ngClass",e.eq3(5,Af,t.seconds)),e.R7$(2),e.SpI(" ",t.label," ")}}function Vf(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",44),e.bIt("click",function(o){const a=e.eBV(t).index,r=e.XpG();return e.Njj(r.handleTimelineClick(o,a))}),e.j41(1,"div",45),e.EFF(2),e.k0s(),e.j41(3,"button",46),e.nrm(4,"app-icon",47),e.k0s(),e.j41(5,"mat-menu",null,9)(7,"button",48),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.addTimelineClip(o))}),e.EFF(8,"Add Clip"),e.k0s(),e.j41(9,"button",49),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.pasteTimelineMaps(o))}),e.EFF(10),e.k0s()()()}if(2&s){const t=i.$implicit,n=e.sdS(6),o=e.XpG();e.R7$(2),e.SpI(" ",t," "),e.R7$(),e.Y8G("matMenuTriggerFor",n),e.R7$(6),e.Y8G("disabled",!o.hasCopiedTimelineMaps),e.R7$(),e.SpI(" ",o.pasteClipsText," ")}}function Lf(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-timeline-map",52),e.bIt("click",function(o){const a=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.handleTimelineMapClick(o,a))}),e.k0s()}if(2&s){const t=i.$implicit,n=e.XpG(2);e.Y8G("scale",n.scale)("timelineMap",t)}}function Yf(s,i){if(1&s&&(e.j41(0,"div",50),e.DNE(1,Lf,1,2,"app-timeline-map",51),e.k0s()),2&s){const t=i.$implicit;e.R7$(),e.Y8G("ngForOf",t)}}class gt{constructor(i,t,n,o,a){this.store=i,this.animationService=t,this.engineService=n,this.renderer=o,this.changeDetectorRef=a,this.storyAnimationNames$=new $i.t([]),this.showHoverTimeIndicator=!1,this.ngUnsubscribe=new f.B}ngOnInit(){this.setStoryAnimationNames(),this.setScrollbarWidth(),this.setLeafTimelinesWindowWidth(),this.initListeners(),this.initEngineEventListeners(),this.initBrowserEventListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initListeners(){this.scale$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setScale(i),this.setCurrentTimeIndicator(this.animationService.getTime()),this.buildRulerMarks(),this.checkOverflowX(),this.changeDetectorRef.markForCheck()}),this.selectedTimelineMapIds$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.selectedTimelineMapIds=i,this.changeDetectorRef.markForCheck()}),this.copiedTimelineMaps$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.copiedTimelineMaps=i,this.setHasCopiedTimelineMaps(),this.changeDetectorRef.markForCheck()}),(0,C.z)([this.storyAnimationNames$,this.selectedChapterTimelineMap$]).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t])=>{this.buildChapterLeafTimelinesMaps(i,t),this.checkTimelineMapOverlaps(),this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()}),this.selectedChapterId$.pipe((0,I.p)(i=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.setCurrentTimeIndicator(this.animationService.getTime()),this.store.dispatch(new ue.SetSelectedTimelineMapIds([])),this.changeDetectorRef.markForCheck()}),this.loadChaptersRemaining$.pipe((0,I.p)(i=>0===i.length),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setStoryAnimationNames(),this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()})}initEngineEventListeners(){(0,T.h)(this.engineService.getEvent(ct.X.TimelinePlaying),this.engineService.getEvent(ct.X.TimelineScrubbed)).pipe((0,as.c)(20),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.setCurrentTimeIndicator(i.time)}),this.engineService.getEvent(ct.X.TimelineTimeFrameUpdated).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.setChapterTimeFrame(),this.changeDetectorRef.markForCheck()})}initBrowserEventListeners(){(0,h.R)(window,"resize").pipe((0,K.B)(50),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.checkOverflowX(),this.changeDetectorRef.markForCheck()}),(0,h.R)(this.tracksWindow.nativeElement,"scroll").pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleTracksScroll()),(0,h.R)(this.leafTimelinesWindow.nativeElement,"scroll").pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(()=>this.handleLeafTimelinesScroll())}checkOverflowX(){this.overflowX=this.tracksContainerWidth>this.tracksWindow.nativeElement.clientWidth}handleCTIMouseDown(i){i.preventDefault();const t=(0,h.R)(window,"mousemove"),n=(0,h.R)(window,"mouseup").pipe((0,ai.$)()),o=this.tracksWindow.nativeElement.getBoundingClientRect();this.scrubbing=!0,n.subscribe(()=>{this.scrubbing=!1,this.autoScrolling=!1}),t.pipe((0,as.c)(20),(0,y.Q)(n)).subscribe(a=>{const r=a.clientX;if(this.overflowX&&(r>o.right||r<o.left?(this.autoScrollOffset=r>o.right?r-o.right:r-o.left,this.autoScrolling||(this.autoScrolling=!0,this.autoScroll())):this.autoScrolling=!1),!this.autoScrolling){const p=this.timelineRuler.nativeElement.getBoundingClientRect();this.scrubToTime((r-p.left)/(Ze*this.scale))}})}autoScroll(){const i=this.tracksWindow.nativeElement.getBoundingClientRect(),t=()=>{const n=this.tracksWindow.nativeElement.scrollLeft;let o;o=this.autoScrollOffset<0?(n-20)/(Ze*this.scale):(i.width+n-20)/(Ze*this.scale),this.scrubToTime(o+this.autoScrollOffset/(Ze*this.scale));const x=(this.autoScrollOffset>0?1:-1)*Math.sqrt(Math.abs(this.autoScrollOffset));this.setTracksScrollLeft(n+x),this.autoScrolling&&requestAnimationFrame(t)};requestAnimationFrame(t)}handleTracksScroll(){this.ignoreScrollEvent?this.ignoreScrollEvent=!1:this.setLeafTimelinesScrollTop(this.tracksWindow.nativeElement.scrollTop),this.setRulerScrollLeft(this.tracksWindow.nativeElement.scrollLeft)}handleLeafTimelinesScroll(){this.ignoreScrollEvent?this.ignoreScrollEvent=!1:this.setTracksScrollTop(this.leafTimelinesWindow.nativeElement.scrollTop)}setRulerScrollLeft(i){this.rulerWindow.nativeElement.scrollLeft=i}setTracksScrollLeft(i){this.tracksWindow.nativeElement.scrollLeft=i}setTracksScrollTop(i){this.ignoreScrollEvent=!0,this.tracksWindow.nativeElement.scrollTop=i}setLeafTimelinesScrollTop(i){this.ignoreScrollEvent=!0,this.leafTimelinesWindow.nativeElement.scrollTop=i}handleRulerMarkMouseEnter(i){if(!this.scrubbing){this.showHoverTimeIndicator=!0;let t=i/this.rulerMarksPerSecond;t=this.animationService.getNearestFrameTime(t),this.setHoverTimeIndicator(t)}}handleRulerMouseEnter(i){if(!this.scrubbing){this.showHoverTimeIndicator=!0;let t=i.offsetX/(Ze*this.scale);t=this.animationService.getNearestFrameTime(t),this.setHoverTimeIndicator(t)}}handleRulerMouseMove(i){if(!this.scrubbing&&i.currentTarget===i.target){let t=i.offsetX/(Ze*this.scale);t=this.animationService.getNearestFrameTime(t),this.setHoverTimeIndicator(t)}}handleRulerMouseLeave(){this.showHoverTimeIndicator=!1}handleTimelineMapClick(i,t){i.shiftKey?this.selectedTimelineMapIds.has(t.id)?this.store.dispatch(new ue.RemoveFromSelectedTimelineMapIds([t.id])):this.store.dispatch(new ue.AddToSelectedTimelineMapIds([t.id])):this.store.dispatch(new ue.SetSelectedTimelineMapIds([t.id]))}handleTimelineClick(i,t){const o=this.chapterTimelinesMaps[t].map(a=>a.id);i.shiftKey?o.every(r=>this.selectedTimelineMapIds.has(r))?this.store.dispatch(new ue.RemoveFromSelectedTimelineMapIds(o)):this.store.dispatch(new ue.AddToSelectedTimelineMapIds(o)):this.store.dispatch(new ue.SetSelectedTimelineMapIds(o))}buildChapterLeafTimelinesMaps(i,t){this.chapterTimelinesMaps=i.map(n=>t.filter(a=>a.data.timeline===n))}checkTimelineMapOverlaps(){const i=new Set;this.chapterTimelinesMaps.forEach(t=>{for(let n=0;n<t.length-1;n++){const o=t[n];for(let a=n+1;a<t.length;a++){const r=t[a];(o.start<r.start?o.end>r.start:o.start<r.end)&&i.add(o.id).add(r.id)}}}),this.store.dispatch(new ue.SetOverlappingTimelineMapIds(Array.from(i)))}pasteTimelineMaps(i){const t=this.copiedTimelineMaps.map(o=>{const a=(0,R.cloneDeep)(o);return a.id=it.u.getUuid(),a.data.timeline=i,a});this.animationService.updateTimelineClips(t),this.store.dispatch(new U.lc(t));const n=t.map(o=>o.id);this.store.dispatch(new ue.SetSelectedTimelineMapIds(n))}setHasCopiedTimelineMaps(){const i=this.copiedTimelineMaps.length;this.hasCopiedTimelineMaps=i>0,this.pasteClipsText=this.hasCopiedTimelineMaps?1===i?"Paste Clip":`Paste ${i} Clips`:"Paste Clips"}addTimelineClip(i){let n;const o=this.store.selectSnapshot(j.N.getSelectedChapter).timelineMap.filter(a=>a.data.timeline===i).sort((a,r)=>a.end-r.end).pop();if(null!=o){const a=o.end-o.start;n=(0,R.cloneDeep)(o),n.id=it.u.getUuid(),n.start=o.end,n.end=n.start+a}else n={id:it.u.getUuid(),start:0,end:this.manifestsMaxTimes?.[i]??1,name:"",data:{timeline:i,start:0,end:this.manifestsMaxTimes?.[i]??1,fit:!1,onEnd:"freeze"}};this.animationService.updateTimelineClips([n]),this.store.dispatch(new U.lc([n])),this.store.dispatch(new ue.SetSelectedTimelineMapIds([n.id]))}setStoryAnimationNames(){this.storyAnimationNames$.next(this.animationService.getStoryAnimationNames())}setChapterTimeFrame(){this.chapterDuration=this.animationService.getChapterDuration(),this.setTracksWidths(),this.buildRulerMarks(),this.checkOverflowX()}setScale(i){this.scale=i,this.rulerMarksPerSecond=.1===this.scale?1:.25===this.scale?2:3,this.setTracksWidths()}buildRulerMarks(){const i=Math.floor(this.chapterDuration*this.rulerMarksPerSecond)+1;this.rulerMarks=[];const t=o=>o/this.rulerMarksPerSecond+"s",n=o=>o%this.rulerMarksPerSecond*(this.animationService.fps/this.rulerMarksPerSecond)+"f";for(let o=0;o<i;o++){const a=o%this.rulerMarksPerSecond==0,r=a?t(o):n(o);this.rulerMarks.push({left:o*(Ze/this.rulerMarksPerSecond)*this.scale,label:r,seconds:a})}}setCurrentTimeIndicator(i){const n=`translate3d(${i*Ze*this.scale}px, 0px, 0px)`;this.renderer.setStyle(this.currentTimeHead.nativeElement,"transform",n),this.renderer.setStyle(this.currentTimeLine.nativeElement,"transform",n)}setHoverTimeIndicator(i){const n=`translate3d(${i*Ze*this.scale}px, 0px, 0px)`;this.renderer.setStyle(this.hoverTimeHead.nativeElement,"transform",n),this.renderer.setStyle(this.hoverTimeLine.nativeElement,"transform",n),this.renderer.setStyle(this.hoverTimeLabel.nativeElement,"transform",`translate3d(0px, ${this.tracksWindow.nativeElement.scrollTop}px, 0px)`),this.hoverTimeFormatted=this.animationService.formatTime(i),this.hoverTimeFrames=`${this.animationService.secondsToFrames(i)}f`,this.hoverTimeSeconds=Math.round(1e4*i)/1e4+"s"}setTracksWidths(){this.chapterWidth=this.chapterDuration*Ze*this.scale,this.tracksContainerWidth=this.chapterWidth+40}scrubToRulerMark(i){const t=i/this.rulerMarksPerSecond;this.animationService.pause(),this.scrubToTime(t)}scrubToRulerPosition(i){let t=i.offsetX/(Ze*this.scale);t=this.animationService.getNearestFrameTime(t),this.animationService.pause(),this.scrubToTime(t)}setLeafTimelinesWindowWidth(){this.renderer.setStyle(this.leafTimelinesWindow.nativeElement,"width",`calc(100% + ${this.scrollBarWidth}px)`)}setScrollbarWidth(){const i=this.tracksWindow.nativeElement;this.scrollBarWidth=i.offsetWidth-i.clientWidth}scrubToTime(i){this.animationService.scrub(i)}static#e=this.\u0275fac=function(t){return new(t||gt)(e.rXU(l.il),e.rXU(Rt.O),e.rXU(fi.y),e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:gt,selectors:[["app-edit-timeline"]],viewQuery:function(t,n){if(1&t&&(e.GBs(Ff,7),e.GBs(Rf,7),e.GBs(Pf,7),e.GBs(jf,7),e.GBs(Mf,7),e.GBs(If,7),e.GBs(Nf,7),e.GBs(Bf,7),e.GBs(Df,7)),2&t){let o;e.mGM(o=e.lsd())&&(n.leafTimelinesWindow=o.first),e.mGM(o=e.lsd())&&(n.rulerWindow=o.first),e.mGM(o=e.lsd())&&(n.tracksWindow=o.first),e.mGM(o=e.lsd())&&(n.timelineRuler=o.first),e.mGM(o=e.lsd())&&(n.currentTimeHead=o.first),e.mGM(o=e.lsd())&&(n.currentTimeLine=o.first),e.mGM(o=e.lsd())&&(n.hoverTimeHead=o.first),e.mGM(o=e.lsd())&&(n.hoverTimeLine=o.first),e.mGM(o=e.lsd())&&(n.hoverTimeLabel=o.first)}},inputs:{manifestsMaxTimes:"manifestsMaxTimes"},decls:49,vars:44,consts:[["rulerWindow",""],["timelineRuler",""],["currentTimeHead",""],["hoverTimeHead",""],["leafTimelinesWindow",""],["tracksWindow",""],["currentTimeLine",""],["hoverTimeLine",""],["hoverTimeLabel",""],["leafTimelineActionsMenu","matMenu"],[1,"edit-timeline"],[1,"edit-timeline__header-left"],[1,"edit-timeline__frame-controls"],["direction","previous",1,"ml-2"],["direction","next",1,"mr-2"],[1,"edit-timeline__header"],[1,"edit-timeline__ruler-window"],[1,"edit-timeline__ruler-container",3,"ngStyle"],[1,"edit-timeline__ruler",3,"mouseenter","mousemove","mouseleave","click","ngStyle"],["appEventFence","","class","edit-timeline__ruler-mark",3,"ngStyle","ngClass","mouseenter",4,"ngFor","ngForOf"],[1,"edit-timeline__indicator-heads",3,"ngStyle"],[1,"edit-timeline__total-time-head",3,"ngStyle"],[1,"edit-timeline__current-time-head",3,"mousedown"],["icon","grip-lines-vertical"],[1,"edit-timeline__hover-time-head",3,"ngClass"],[1,"edit-timeline__header-gutter",3,"ngStyle"],[1,"edit-timeline__body-left"],[1,"edit-timeline__leaf-timelines-window"],[1,"edit-timeline__leaf-timelines-container"],[1,"edit-timeline__leaf-timelines"],["class","edit-timeline__leaf-timeline",3,"click",4,"ngFor","ngForOf"],[1,"edit-timeline__body-left-gutter",3,"ngStyle"],[1,"edit-timeline__body"],[1,"edit-timeline__tracks-window"],[1,"edit-timeline__tracks-container",3,"ngStyle"],[1,"edit-timeline__tracks",3,"ngStyle"],["class","edit-timeline__track",4,"ngFor","ngForOf"],[1,"edit-timeline__indicator-lines",3,"ngStyle"],[1,"edit-timeline__total-time-line",3,"ngStyle"],[1,"edit-timeline__current-time-line"],[1,"edit-timeline__hover-time-line",3,"ngClass"],[1,"edit-timeline__hover-time-line-label"],["appEventFence","",1,"edit-timeline__ruler-mark",3,"mouseenter","ngStyle","ngClass"],[1,"edit-timeline__ruler-mark-label","text-xs",3,"click"],[1,"edit-timeline__leaf-timeline",3,"click"],[1,"edit-timeline__leaf-timeline-label","text-xs"],["app-button","","appEventFence","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],[1,"edit-timeline__track"],[3,"scale","timelineMap","click",4,"ngFor","ngForOf"],[3,"click","scale","timelineMap"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",10)(1,"div",11)(2,"div",12),e.nrm(3,"app-engine-frame-control",13)(4,"app-engine-frame-control",14)(5,"app-engine-current-time"),e.k0s()(),e.j41(6,"div",15)(7,"div",16,0)(9,"div",17)(10,"div",18,1),e.bIt("mouseenter",function(r){return e.eBV(o),e.Njj(n.handleRulerMouseEnter(r))})("mousemove",function(r){return e.eBV(o),e.Njj(n.handleRulerMouseMove(r))})("mouseleave",function(){return e.eBV(o),e.Njj(n.handleRulerMouseLeave())})("click",function(r){return e.eBV(o),e.Njj(n.scrubToRulerPosition(r))}),e.DNE(12,Uf,3,7,"div",19),e.k0s(),e.j41(13,"div",20),e.nrm(14,"div",21),e.j41(15,"div",22,2),e.bIt("mousedown",function(r){return e.eBV(o),e.Njj(n.handleCTIMouseDown(r))}),e.nrm(17,"app-icon",23),e.k0s(),e.nrm(18,"div",24,3),e.k0s()()(),e.nrm(20,"div",25),e.k0s(),e.j41(21,"div",26)(22,"div",27,4)(24,"div",28)(25,"div",29),e.DNE(26,Vf,11,4,"div",30),e.nI1(27,"async"),e.k0s()()(),e.nrm(28,"div",31),e.k0s(),e.j41(29,"div",32)(30,"div",33,5)(32,"div",34)(33,"div",35),e.DNE(34,Yf,2,1,"div",36),e.k0s(),e.j41(35,"div",37),e.nrm(36,"div",38)(37,"div",39,6),e.j41(39,"div",40,7)(41,"div",41,8)(43,"div"),e.EFF(44),e.k0s(),e.j41(45,"div"),e.EFF(46),e.k0s(),e.j41(47,"div"),e.EFF(48),e.k0s()()()()()()()()}2&t&&(e.R7$(9),e.Y8G("ngStyle",e.eq3(20,ei,n.tracksContainerWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(22,ei,n.chapterWidth)),e.R7$(2),e.Y8G("ngForOf",n.rulerMarks),e.R7$(),e.Y8G("ngStyle",e.eq3(24,ei,n.chapterWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(26,rs,n.chapterWidth)),e.R7$(4),e.Y8G("ngClass",e.eq3(28,Gf,n.showHoverTimeIndicator)),e.R7$(2),e.Y8G("ngStyle",e.eq3(30,ei,n.scrollBarWidth)),e.R7$(6),e.Y8G("ngForOf",e.bMT(27,18,n.storyAnimationNames$)),e.R7$(2),e.Y8G("ngStyle",e.eq3(32,$f,n.scrollBarWidth)),e.R7$(4),e.Y8G("ngStyle",e.eq3(34,ei,n.tracksContainerWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(36,ei,n.chapterWidth)),e.R7$(),e.Y8G("ngForOf",n.chapterTimelinesMaps),e.R7$(),e.Y8G("ngStyle",e.eq3(38,ei,n.chapterWidth)),e.R7$(),e.Y8G("ngStyle",e.eq3(40,rs,n.chapterWidth)),e.R7$(3),e.Y8G("ngClass",e.eq3(42,Of,n.showHoverTimeIndicator)),e.R7$(5),e.JRh(n.hoverTimeFormatted),e.R7$(2),e.JRh(n.hoverTimeFrames),e.R7$(2),e.JRh(n.hoverTimeSeconds))},dependencies:[w.YU,w.Sq,w.B3,yn,kf,D.kk,D.fb,D.Cp,Y.Q,Xi.L,X.R,Mi,w.Jj],styles:['.edit-timeline[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;height:12px}.edit-timeline[_ngcontent-%COMP%]{display:grid;width:100%;background-color:#101823;grid-template-areas:"header-left header" "body-left body";grid-template-columns:320px 1fr;grid-template-rows:56px 1fr}.edit-timeline__header-left[_ngcontent-%COMP%]{grid-area:header-left;border-bottom:1px solid #283853;border-right:1px solid #283853}.edit-timeline__header[_ngcontent-%COMP%]{grid-area:header;display:flex}.edit-timeline__header-gutter[_ngcontent-%COMP%]{flex-shrink:0;border-left:1px solid #283853;border-bottom:1px solid #283853}.edit-timeline__body-left[_ngcontent-%COMP%]{grid-area:body-left;display:flex;flex-direction:column;border-right:1px solid #283853;overflow:hidden}.edit-timeline__body-left-gutter[_ngcontent-%COMP%]{flex-shrink:0;border-top:1px solid #283853}.edit-timeline__body[_ngcontent-%COMP%]{grid-area:body;overflow:hidden}.edit-timeline__frame-controls[_ngcontent-%COMP%]{display:flex;height:100%;align-items:center}.edit-timeline__ruler-window[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow:hidden}.edit-timeline__ruler-container[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;justify-content:center}.edit-timeline__ruler[_ngcontent-%COMP%]{position:relative;height:100%}.edit-timeline__ruler-mark[_ngcontent-%COMP%]{position:absolute;height:100%}.edit-timeline__ruler-mark[_ngcontent-%COMP%]:before{content:" ";bottom:0;position:absolute;height:22px;border-left:1px solid #283853}.edit-timeline__ruler-mark-label[_ngcontent-%COMP%]{color:#61779e;position:absolute;bottom:22px;cursor:pointer}.edit-timeline__ruler-mark-label[_ngcontent-%COMP%]:hover{color:#d7e0ea}.edit-timeline__seconds-mark[_ngcontent-%COMP%]:before{height:26px}.edit-timeline__seconds-mark[_ngcontent-%COMP%]   .edit-timeline__ruler-mark-label[_ngcontent-%COMP%]{color:#96a8c0;bottom:26px}.edit-timeline__seconds-mark[_ngcontent-%COMP%]   .edit-timeline__ruler-mark-label[_ngcontent-%COMP%]:hover{color:#d7e0ea}.edit-timeline__indicator-heads[_ngcontent-%COMP%]{position:absolute;pointer-events:none;height:100%;top:0}.edit-timeline__leaf-timelines-window[_ngcontent-%COMP%]{width:100%;height:100%;overflow-y:scroll;position:relative}.edit-timeline__leaf-timelines-container[_ngcontent-%COMP%]{width:100%;min-height:100%;display:flex;position:absolute}.edit-timeline__leaf-timelines[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;background-color:#131c2a}.edit-timeline__leaf-timeline[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 8px;height:48px;border-bottom:1px solid #283853;cursor:pointer}.edit-timeline__leaf-timeline-label[_ngcontent-%COMP%]{flex-grow:1;padding:0 8px;word-break:break-all;-webkit-user-select:none;user-select:none;color:#d7e0ea}.edit-timeline__leaf-timeline-label[_ngcontent-%COMP%]:hover{color:#fff}.edit-timeline__tracks-window[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:scroll;background-color:#101823;scrollbar-color:#283853 transparent}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar:vertical{border-left:1px solid #283853}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar:horizontal{border-top:1px solid #283853}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:transparent}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#374a68;border-radius:6px}.edit-timeline__tracks-window[_ngcontent-%COMP%]::-webkit-scrollbar-corner{background-color:transparent;border-top:1px solid #283853;border-left:1px solid #283853}.edit-timeline__tracks-container[_ngcontent-%COMP%]{position:absolute;min-height:100%;display:flex;justify-content:center}.edit-timeline__tracks[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;z-index:0}.edit-timeline__track[_ngcontent-%COMP%]{display:flex;position:relative;height:48px;background-color:#131c2a;border-bottom:1px solid #101823}.edit-timeline__indicator-lines[_ngcontent-%COMP%]{position:absolute;height:100%;top:0;pointer-events:none;z-index:1}.edit-timeline__current-time-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;left:0;height:50px;width:16px;margin-left:-8px;background-color:#2d72dc;cursor:pointer;color:#61779e;pointer-events:all}.edit-timeline__current-time-head[_ngcontent-%COMP%]:after{content:" ";position:absolute;bottom:-16px;border:8px solid transparent;border-top-color:#2d72dc}.edit-timeline__current-time-line[_ngcontent-%COMP%]{position:absolute;left:0;margin-left:-1px;height:100%;border-right:2px solid #2d72dc}.edit-timeline__total-time-head[_ngcontent-%COMP%]{position:absolute;height:50%;bottom:0;border-right:2px solid #283853}.edit-timeline__total-time-head[_ngcontent-%COMP%]:before{content:" ";position:absolute;height:12px;width:12px;margin-left:-5px;background-color:#283853}.edit-timeline__total-time-head[_ngcontent-%COMP%]:after{content:" ";position:absolute;top:12px;margin-left:-5px;border:6px solid transparent;border-top-color:#283853}.edit-timeline__total-time-line[_ngcontent-%COMP%]{position:absolute;height:100%;border-right:2px solid #283853}.edit-timeline__hover-time-head[_ngcontent-%COMP%]{position:absolute;display:none;height:100%;border-right:1px solid #2d72dc}.edit-timeline__hover-time-head--show[_ngcontent-%COMP%]{display:flex}.edit-timeline__hover-time-line[_ngcontent-%COMP%]{position:absolute;display:none;justify-content:center;height:100%;border-right:1px solid #2d72dc}.edit-timeline__hover-time-line--show[_ngcontent-%COMP%]{display:flex}.edit-timeline__hover-time-line-label[_ngcontent-%COMP%]{position:absolute;top:4px;color:#fff;background:#101823cc;border-radius:4px;font-size:10px;padding:0 8px}.edit-timeline__hover-time-line-label[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:4px 0}'],changeDetection:0})}Ii([(0,l.l6)(Te.getScale),Ni("design:type",_.c)],gt.prototype,"scale$",void 0),Ii([(0,l.l6)(Te.getSelectedTimelineMapIds),Ni("design:type",_.c)],gt.prototype,"selectedTimelineMapIds$",void 0),Ii([(0,l.l6)(Te.getCopiedTimelineMaps),Ni("design:type",_.c)],gt.prototype,"copiedTimelineMaps$",void 0),Ii([(0,l.l6)(E.t.getLoadChaptersRemaining),Ni("design:type",_.c)],gt.prototype,"loadChaptersRemaining$",void 0),Ii([(0,l.l6)(j.N.getSelectedChapterId),Ni("design:type",_.c)],gt.prototype,"selectedChapterId$",void 0),Ii([(0,l.l6)(j.N.getSelectedChapterTimelineMap),Ni("design:type",_.c)],gt.prototype,"selectedChapterTimelineMap$",void 0);var Ba=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},Da=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};function zf(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"button",8),e.nrm(4,"app-icon",9),e.k0s(),e.j41(5,"mat-menu",null,1)(7,"button",10),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.copyTimelineMaps())}),e.EFF(8,"Copy"),e.k0s(),e.j41(9,"button",10),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.duplicateTimelineMap())}),e.EFF(10,"Duplicate"),e.k0s(),e.j41(11,"button",10),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.deleteTimelineMaps())}),e.EFF(12,"Remove"),e.k0s()(),e.bVm()}if(2&s){const t=e.sdS(6),n=e.XpG();e.R7$(2),e.JRh(n.selectedTimelineMapsLabel),e.R7$(),e.Y8G("matMenuTriggerFor",t)}}function Xf(s,i){1&s&&(e.j41(0,"div",12)(1,"app-form-field",27)(2,"mat-radio-group",28)(3,"mat-radio-button",29),e.EFF(4,"Freeze "),e.k0s(),e.j41(5,"mat-radio-button",30),e.EFF(6,"Loop "),e.k0s()()()())}function Qf(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"form",11)(2,"div",12)(3,"app-form-field",13)(4,"input",14,2),e.bIt("keyup.enter",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEnter(o))}),e.k0s(),e.nrm(6,"app-character-counter",15),e.k0s()(),e.j41(7,"div",12)(8,"app-form-field",16)(9,"input",17),e.bIt("keyup.enter",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEnter(o))}),e.k0s()(),e.j41(10,"app-form-field",18)(11,"input",19),e.bIt("keyup.enter",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEnter(o))}),e.k0s()()(),e.j41(12,"div",12)(13,"app-form-field",20)(14,"input",21),e.bIt("keyup.enter",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEnter(o))}),e.k0s()(),e.j41(15,"app-form-field",22)(16,"input",23),e.bIt("keyup.enter",function(o){e.eBV(t);const a=e.XpG();return e.Njj(a.handleEnter(o))}),e.k0s()()(),e.j41(17,"div",12)(18,"mat-checkbox",24)(19,"span",25),e.EFF(20,"Fit clip to timeline."),e.k0s()()(),e.DNE(21,Xf,7,0,"div",26),e.k0s(),e.bVm()}if(2&s){const t=e.sdS(5),n=e.XpG();e.R7$(),e.Y8G("formGroup",n.form),e.R7$(5),e.Y8G("field",t),e.R7$(12),e.Y8G("indeterminate",n.indeterminateFit),e.R7$(3),e.Y8G("ngIf",n.fitIsFalse)}}function qf(s,i){1&s&&(e.j41(0,"p",31),e.EFF(1,"Click on a clip in the timeline panel to edit it."),e.k0s())}const Hf=/(^[+-/*]=)(.+$)/;class Bi{constructor(i,t,n,o){this.store=i,this.formBuilder=t,this.animationService=n,this.changeDetectorRef=o,this.ngUnsubscribe=new f.B}ngOnInit(){this.form=this.formBuilder.group({name:[null,c.k0.maxLength(100)],start:[null,{updateOn:"blur"}],end:[null,{updateOn:"blur"}],dataStart:[null,{updateOn:"blur"}],dataEnd:[null,{updateOn:"blur"}],fit:[null,{updateOn:"change"}],onEnd:[null,{updateOn:"change"}]}),this.form.valueChanges.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleFormChanges(i)}),this.selectedChapterTimelineMap$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.chapterTimelineMaps=i}),this.selectedTimelineMapIds$.pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.selectedTimelineMapIds=Array.from(i),this.buildAggregateTimelineMap(),this.setFormValues(),this.setHasSelectedTimelineMaps(),this.setSelectedTimelineMapsLabel(),this.changeDetectorRef.markForCheck()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}getSelectedTimelineMaps(){return this.selectedTimelineMapIds.map(i=>this.chapterTimelineMaps.find(t=>i===t.id))}getTimelineMap(i){return this.chapterTimelineMaps.find(t=>i===t.id)}buildAggregateTimelineMap(){const i=[],t=[],n=[],o=[],a=[],r=[],p=[],x=(Ye,ni,Sn)=>Ye===Sn[0],N=(Ye,ni)=>Ye&&ni.length>0?ni[0]:null;this.getSelectedTimelineMaps().forEach(Ye=>{i.push(Ye.name),t.push(Ye.start),n.push(Ye.end),o.push(Ye.data.start),a.push(Ye.data.end),r.push(Ye.data.fit),p.push(Ye.data.onEnd)});const W=i.every(x),Se=t.every(x),Le=n.every(x),ti=o.every(x),et=a.every(x),Et=r.every(x),ii=p.every(x);this.aggregateTimelineMap={name:N(W,i),start:N(Se,t),end:N(Le,n),dataStart:N(ti,o),dataEnd:N(et,a),fit:N(Et,r),onEnd:N(ii,p)}}setFormValues(){let i=this.aggregateTimelineMap.start,t=this.aggregateTimelineMap.end,n=this.aggregateTimelineMap.dataStart,o=this.aggregateTimelineMap.dataEnd;"number"==typeof i&&(i=this.animationService.formatTime(i)),"number"==typeof t&&(t=this.animationService.formatTime(t)),"number"==typeof n&&(n=this.animationService.formatTime(n)),"number"==typeof o&&(o=this.animationService.formatTime(o)),this.form.setValue({name:this.aggregateTimelineMap.name,start:i,end:t,dataStart:n,dataEnd:o,fit:this.aggregateTimelineMap.fit,onEnd:this.aggregateTimelineMap.onEnd},{emitEvent:!1}),this.indeterminateFit=null===this.aggregateTimelineMap.fit,this.fitIsFalse=!1===this.aggregateTimelineMap.fit}parseTimeInput(i){const t=i.match(Hf);if(t){const n=t[1],o=this.animationService.parseFormattedTime(t[2]);return new Function("value",`return value ${n} ${o}`)}return this.animationService.parseFormattedTime(i)}handleFormChanges(i){const t=Object.entries(i).filter(([o,a])=>"name"===o?null!==a:null!==a&&""!==a),n=Object.fromEntries(t);["start","end","dataStart","dataEnd"].forEach(o=>{n.hasOwnProperty(o)&&(n[o]=this.parseTimeInput(n[o]))}),this.updateTimelineMaps(this.buildUpdates(n)),this.buildAggregateTimelineMap(),this.setFormValues()}handleEnter(i){const t=i.target,n=t.value,o=t.getAttribute("formcontrolname");this.form.get(o).patchValue(n)}buildUpdates(i){const t=Array.from(this.store.selectSnapshot(Te.getSelectedTimelineMapIds)),n=(o,a)=>{let r="function"==typeof a?a(o):a;return r<0&&(r=o),r};return t.map(o=>{const a=this.getTimelineMap(o),r={...a.data};return Object.entries(i).forEach(([p,x])=>{switch(p){case"start":case"end":a[p]=n(a[p],x);break;case"dataStart":r.start=n(a.data.start,x);break;case"dataEnd":r.end=n(a.data.end,x);break;case"fit":r.fit=x;break;case"onEnd":r.onEnd=x;break;default:a[p]=x}}),a.data=r,a})}copyTimelineMaps(){const t=Array.from(this.selectedTimelineMapIds).map(n=>{const o=this.getTimelineMap(n);return(0,R.cloneDeep)(o)});this.store.dispatch(new ue.SetCopiedTimelineMaps(t))}duplicateTimelineMap(){const i=[],t=this.getSelectionOffset();this.selectedTimelineMapIds.forEach(o=>{const a=this.getTimelineMap(o),r=(0,R.cloneDeep)(a);r.id=it.u.getUuid();const p=r.end-r.start;r.start=r.start+t,r.end=r.start+p,i.push(r)}),this.animationService.updateTimelineClips(i),this.store.dispatch(new U.lc(i));const n=i.map(o=>o.id);this.store.dispatch(new ue.SetSelectedTimelineMapIds(n))}updateTimelineMaps(i){this.animationService.updateTimelineClips(i),this.store.dispatch(new U.is(i))}deleteTimelineMaps(){const i=Array.from(this.store.selectSnapshot(Te.getSelectedTimelineMapIds));this.animationService.deleteTimelineClips(i),this.store.dispatch(new U.Bc(i)),this.store.dispatch(new ue.SetSelectedTimelineMapIds([]))}setSelectedTimelineMapsLabel(){this.selectedTimelineMapsLabel=`${this.selectedTimelineMapIds.length} ${this.selectedTimelineMapIds.length>1?"clips":"clip"} selected`}setHasSelectedTimelineMaps(){this.hasSelectedTimelineMaps=this.selectedTimelineMapIds.length>0}getSelectionOffset(){const i=this.getSelectedTimelineMaps(),t=i.map(x=>x.data.timeline),n={},o=this.store.selectSnapshot(j.N.getSelectedChapter);i.forEach(x=>{const N=x.id;if(!Object.hasOwnProperty.call(n,"leafTimelineId")){let z=0;o.timelineMap.filter(W=>t.includes(W.data.timeline)).forEach(W=>{W.end>z&&(z=W.end)}),n[N]=z}});const a=Object.values(n),r=Math.max(...a);let p=1/0;return i.forEach(x=>{x.start<p&&(p=x.start)}),r-p}static#e=this.\u0275fac=function(t){return new(t||Bi)(e.rXU(l.il),e.rXU(c.ze),e.rXU(Rt.O),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Bi,selectors:[["app-edit-timeline-maps"]],decls:7,vars:3,consts:[["noSelectedTimelineMaps",""],["timelineMapsActionsMenu","matMenu"],["name",""],[1,"edit-timeline-maps"],[1,"edit-timeline-maps__header"],[4,"ngIf"],[1,"edit-timeline-maps__body"],[4,"ngIf","ngIfElse"],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],["autocomplete","off",1,"edit-timeline-maps__form",3,"formGroup"],[1,"edit-timeline-maps__form-row"],["label","Name",1,"grow"],["type","text","maxlength","100","formControlName","name","autocomplete","timelinemap-name",1,"input","w-full",3,"keyup.enter"],[3,"field"],["label","In Point",1,"mr-2"],["type","text","formControlName","start",1,"input","w-full",3,"keyup.enter"],["label","Out Point",1,"ml-2"],["type","text","formControlName","end",1,"input","w-full",3,"keyup.enter"],["label","State Start",1,"mr-2"],["type","text","formControlName","dataStart",1,"input","w-full",3,"keyup.enter"],["label","State End",1,"ml-2"],["type","text","formControlName","dataEnd",1,"input","w-full",3,"keyup.enter"],["formControlName","fit",1,"pb-4",3,"indeterminate"],[1,"text-xs"],["class","edit-timeline-maps__form-row",4,"ngIf"],["label","On End",1,"grow"],["formControlName","onEnd",1,"flex"],["value","freeze",1,"grow","text-xs"],["value","loop",1,"grow","text-xs"],[1,"text-xs","pt-2"]],template:function(t,n){if(1&t&&(e.j41(0,"div",3)(1,"div",4),e.DNE(2,zf,13,2,"ng-container",5),e.k0s(),e.j41(3,"div",6),e.DNE(4,Qf,22,4,"ng-container",7)(5,qf,2,0,"ng-template",null,0,e.C5r),e.k0s()()),2&t){const o=e.sdS(6);e.R7$(2),e.Y8G("ngIf",n.hasSelectedTimelineMaps),e.R7$(2),e.Y8G("ngIf",n.hasSelectedTimelineMaps)("ngIfElse",o)}},dependencies:[w.bT,c.qT,c.me,c.BC,c.cb,c.tU,c.j4,c.JD,Ae.So,qe.VT,qe._g,D.kk,D.fb,D.Cp,Y.Q,Z.K,Pt.P,X.R],styles:[".edit-timeline-maps[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.edit-timeline-maps__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;height:56px;flex-shrink:0;border-bottom:1px solid #283853;padding:0 16px}.edit-timeline-maps__body[_ngcontent-%COMP%]{flex-grow:1;padding:16px 16px 0}.edit-timeline-maps__form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-timeline-maps__form-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}Ba([(0,l.l6)(j.N.getSelectedChapterTimelineMap),Da("design:type",_.c)],Bi.prototype,"selectedChapterTimelineMap$",void 0),Ba([(0,l.l6)(Te.getSelectedTimelineMapIds),Da("design:type",_.c)],Bi.prototype,"selectedTimelineMapIds$",void 0);var Wf=v(30582),so=function(s){return s.Pixels="pixels",s.Inches="inches",s}(so||{}),kn=v(9592);class Ga{constructor(i={width:700,height:550},t=kn.H.PNG,n=so.Pixels,o=1,a=!1){this.dimensions=i,this.imageType=t,this.imageSizeType=n,this.labelScale=o,this.labelsDisabled=a}}var Jf=v(56583),Di=v(94528),ao=v(42482),Kf=v(37737);function Zf(s,i){if(1&s&&(e.j41(0,"option",4),e.EFF(1),e.k0s()),2&s){const t=i.$implicit,n=e.XpG();e.Y8G("value",t.title),e.R7$(),e.SpI(" ",n.formatScreenSizeText(t)," ")}}function eg(s,i){if(1&s&&(e.j41(0,"fieldset",5)(1,"legend",6),e.EFF(2,"Image Dimensions Pixels"),e.k0s(),e.j41(3,"app-form-field",7),e.nrm(4,"input",8),e.j41(5,"div",9),e.EFF(6),e.k0s()(),e.j41(7,"span",10),e.EFF(8,"X"),e.k0s(),e.j41(9,"app-form-field",7),e.nrm(10,"input",11),e.j41(11,"div",9),e.EFF(12),e.k0s()()()),2&s){const t=e.XpG();e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",t.minSnapshotPixels.width)("max",t.maxSnapshotPixels.width),e.BMQ("aria-label","Width"),e.R7$(2),e.SpI("Max width ",t.maxSnapshotPixels.width,"px"),e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",t.minSnapshotPixels.height)("max",t.maxSnapshotPixels.height),e.BMQ("aria-label","Height"),e.R7$(2),e.SpI("Max height ",t.maxSnapshotPixels.height,"px")}}const cs={width:300,height:300},ps={width:5120,height:2880};let tg=(()=>{class s extends Ke.n{get currentWidth(){return this._currentWidth}set currentWidth(t){this._currentWidth=Math.round(t),this.screens=this.getScreens(),this.changeRef.markForCheck()}get currentHeight(){return this._currentHeight}set currentHeight(t){this._currentHeight=Math.round(t),this.screens=this.getScreens(),this.changeRef.markForCheck()}get selectedScreenTitle(){return this.formGroup.value.title}constructor(t,n){super(),this.formBuilder=t,this.changeRef=n,this.minSnapshotPixels=cs,this.maxSnapshotPixels=ps,this.snapshotSizes=[..._e.aC],this.currentSnapTitle="Canvas Size",this.customSnapTitle="Custom",this.screens=[],this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){const{width:n,height:o}=t,r=this.getScreens().find(({dimensions:z})=>z.width===n&&z.height===o),p=this.formGroup.value.title;this.formGroup.patchValue({title:p===this.customSnapTitle?p:r?.title||this.customSnapTitle,width:n,height:o},{emitEvent:!1}),this.changeRef.markForCheck()}formatScreenSizeText(t){const{title:n,dimensions:o}=t,{width:a,height:r}=o;return n===this.customSnapTitle?n:this.formatScreenText(n,a,r)}formatScreenText(t,n,o){return`${t} (${n} x ${o} px)`}getScreens(){const{width:t,height:n}=this.formGroup.value;return[{..._e.w2,title:this.currentSnapTitle,dimensions:{width:this.currentWidth,height:this.currentHeight}},..._e.aC,{..._e.w2,title:this.customSnapTitle,dimensions:{width:t,height:n}}]}initForm(){const t=this.currentSnapTitle,{width:n,height:o}=_e.w2.dimensions;this.formGroup=this.formBuilder.nonNullable.group({title:new c.MJ(t),width:new c.MJ(n,[c.k0.required,c.k0.min(cs.width),c.k0.max(ps.width)]),height:new c.MJ(o,[c.k0.required,c.k0.min(cs.height),c.k0.max(ps.height)])})}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(250),(0,I.p)(()=>this.formGroup.valid),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const{title:n,width:o,height:a}=t;if(n===this.currentSnapTitle)this.value={width:this.currentWidth,height:this.currentHeight};else if(n===this.customSnapTitle)this.value={width:o,height:a};else{const r=this.snapshotSizes.find(p=>p.title===n);if(r){const{dimensions:p}=r;this.value={...p}}}})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-dimensions-pixels"]],inputs:{currentWidth:"currentWidth",currentHeight:"currentHeight"},features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:5,vars:3,consts:[[3,"formGroup"],["formControlName","title",1,"input"],[3,"value",4,"ngFor","ngForOf"],["class","flex flex-row justify-between items-baseline mt-2 pb-4",4,"ngIf"],[3,"value"],[1,"flex","flex-row","justify-between","items-baseline","mt-2","pb-4"],[1,"sr-only"],["theme","dark","display","block",1,"w-1/2",3,"isCompact"],["type","number","formControlName","width","appAutoFocus","",1,"publish__input","input","w-full",3,"min","max"],["form-field-help","",1,"text-2xs"],[1,"px-3","text-sm"],["type","number","formControlName","height",1,"publish__input","input","w-full",3,"min","max"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"app-form-field")(2,"select",1),e.DNE(3,Zf,2,2,"option",2),e.k0s()(),e.DNE(4,eg,13,10,"fieldset",3),e.k0s()),2&n&&(e.Y8G("formGroup",o.formGroup),e.R7$(3),e.Y8G("ngForOf",o.screens),e.R7$(),e.Y8G("ngIf",o.selectedScreenTitle===o.customSnapTitle))},dependencies:[w.Sq,w.bT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.VZ,c.zX,c.j4,c.JD,Kf.B,Z.K],changeDetection:0})}return s})(),ig=(()=>{class s extends Ke.n{constructor(t,n){super(),this.formBuilder=t,this.changeRef=n,this.snapshotPPI=_e.Un,this.minSnapshotInches=_e.P2,this.maxSnapshotInches=_e.t6,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initFormListeners()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}setFormValues(t){const{width:n,height:o}=t;this.formGroup.patchValue({width:n,height:o},{emitEvent:!1}),this.changeRef.markForCheck()}initForm(){this.formGroup=this.formBuilder.nonNullable.group({title:new c.MJ(""),width:new c.MJ(0,[c.k0.required,c.k0.min(this.minSnapshotInches.width),c.k0.max(this.maxSnapshotInches.width)]),height:new c.MJ(0,[c.k0.required,c.k0.min(0),c.k0.max(1e3)])})}initFormListeners(){this.formGroup.valueChanges.pipe((0,K.B)(100),(0,I.p)(()=>this.formGroup.valid),(0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{const{width:n,height:o}=t;this.value={width:n,height:o}})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ok),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-dimensions-inches"]],features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3],decls:16,vars:14,consts:[[3,"formGroup"],[1,"flex","flex-row","justify-between","items-baseline"],[1,"sr-only"],["theme","dark","display","block",1,"w-1/2",3,"isCompact"],["type","number","formControlName","width","step",".01",1,"publish__input","input","w-full",3,"min","max"],["form-field-help","",1,"text-2xs"],[1,"px-3","text-sm"],["type","number","formControlName","height","step",".01",1,"publish__input","input","w-full",3,"min","max"],[1,"mt-2","pb-4","text-xs","text-gray-400"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"fieldset",1)(2,"legend",2),e.EFF(3,"Image Dimensions Inches"),e.k0s(),e.j41(4,"app-form-field",3),e.nrm(5,"input",4),e.j41(6,"div",5),e.EFF(7),e.k0s()(),e.j41(8,"span",6),e.EFF(9,"X"),e.k0s(),e.j41(10,"app-form-field",3),e.nrm(11,"input",7),e.j41(12,"div",5),e.EFF(13),e.k0s()()(),e.j41(14,"p",8),e.EFF(15),e.k0s()()),2&n&&(e.Y8G("formGroup",o.formGroup),e.R7$(4),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",o.minSnapshotInches.width)("max",o.maxSnapshotInches.width),e.BMQ("aria-label","Width"),e.R7$(2),e.Lme(" Width ",o.minSnapshotInches.width,'" to ',o.maxSnapshotInches.width,'" '),e.R7$(3),e.Y8G("isCompact",!0),e.R7$(),e.Y8G("min",o.minSnapshotInches.height)("max",o.maxSnapshotInches.height),e.BMQ("aria-label","Height"),e.R7$(2),e.Lme(" Height ",o.minSnapshotInches.height,'" to ',o.maxSnapshotInches.height,'" '),e.R7$(2),e.SpI("Images are published at ",o.snapshotPPI," dpi"))},dependencies:[c.me,c.Q0,c.BC,c.cb,c.VZ,c.zX,c.j4,c.JD,Z.K],changeDetection:0})}return s})();function sg(s,i){if(1&s&&(e.nrm(0,"app-edit-image-dimensions-pixels",31),e.nI1(1,"async"),e.nI1(2,"async")),2&s){let t,n;const o=e.XpG();e.Y8G("currentWidth",null==(t=e.bMT(1,2,o.enginePosition$))?null:t.viewportWidth)("currentHeight",null==(n=e.bMT(2,4,o.enginePosition$))?null:n.viewportHeight)}}function ag(s,i){1&s&&e.nrm(0,"app-edit-image-dimensions-inches",32)}function rg(s,i){1&s&&(e.j41(0,"app-form-field",33),e.nrm(1,"app-slider",34),e.k0s()),2&s&&(e.R7$(),e.Y8G("label","Label scale"))}class Tn{get imageSizeType(){return this.formSnapshot.value.imageSizeType}get labelsDisabled(){return this.formSnapshot.value.labelsDisabled}constructor(i,t,n,o,a,r,p,x,N){this.store=i,this.actions=t,this.storageService=n,this.snapshotService=o,this.clipboardService=a,this.dialogService=r,this.formBuilder=p,this.snackBar=x,this.changeDetectorRef=N,this.imageSizeTypeEnum=so,this.imageTypeEnum=kn.H,this.widgetSnapshotSettings=new f.B,this.ngUnsubscribe=new f.B,this.initForm()}ngOnInit(){this.initialLabelScale=this.store.selectSnapshot($e.y.getLabelScale),this.initialLabelsShown=this.store.selectSnapshot($e.y.getLabels).reduce((t,{id:n,shown:o})=>(t[n]=o,t),{}),this.initialCanvasSize=this.store.selectSnapshot(g.getCanvasSize);const i=this.readSnapshotOptions();this.syncSnapshotOptionsToScene(i),this.initSnapshotActionListeners(),this.initFormListeners()}ngOnDestroy(){this.store.dispatch(new ke.tH(this.initialLabelScale));const i=this.store.selectSnapshot($e.y.getLabels),t=[],n=[];Object.entries(this.initialLabelsShown).forEach(([o,a])=>{const r=i.find(p=>p.id===o);a?t.push(r):n.push(r)}),this.store.dispatch(new ke.D3(t,!0)),this.store.dispatch(new ke.D3(n,!1)),this.store.dispatch(new P.IW(this.initialCanvasSize)),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}handleResetDefaultsClick(){const i=this.getSnapshotFormFromOptions(new Ga);this.formSnapshot.reset(i)}downloadClick(){const{imageType:i}=this.formSnapshot.value;this.takeSnapshot().pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(t=>{this.downloadSnapshot(t,i)})}copyEmbedClick(){const i=this.store.selectSnapshot(je.J.getSelectedBookmark),{imageType:t}=this.formSnapshot.value,n=kn.G[t];this.takeSnapshot().pipe((0,ze.Z)(o=>ao.X.blobToBase64(o)),(0,ai.$)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(o=>{const a=new Jf.$;this.store.dispatch(new Di.yX(i,o,n,a))})}copyLinkClick(){const{imageType:i}=this.formSnapshot.value,t=kn.G[i];this.takeSnapshot().pipe((0,ze.Z)(n=>ao.X.blobToBase64(n)),(0,ai.$)(),(0,y.Q)(this.ngUnsubscribe)).subscribe(n=>{this.store.dispatch(new Di.Iz(n,t))})}initForm(){const i=this.readSnapshotOptions(),t=this.getSnapshotFormFromOptions(i),{pixelDimensions:n,inchesDimensions:o,imageType:a,imageSizeType:r,labelScale:p,labelsDisabled:x}=t;this.formSnapshot=this.formBuilder.nonNullable.group({pixelDimensions:this.formBuilder.control(n),inchesDimensions:this.formBuilder.control(o),imageSizeType:new c.MJ(r,[c.k0.required]),imageType:new c.MJ(a,[c.k0.required]),labelsDisabled:new c.MJ(x),labelScale:new c.MJ(p,[c.k0.required])})}initFormListeners(){const i=this.formSnapshot.controls.pixelDimensions,t=this.formSnapshot.controls.inchesDimensions;this.formSnapshot.valueChanges.pipe((0,K.B)(100),(0,O.F)((n,o)=>(0,R.isEqual)(n,o)),(0,y.Q)(this.ngUnsubscribe)).subscribe(n=>{const o=this.getSnapshotOptionsFromForm(n);this.syncSnapshotOptionsToScene(o),this.writeSnapshotOptions(o),this.changeDetectorRef.markForCheck()}),t.valueChanges.pipe((0,K.B)(500),(0,I.p)(()=>t.valid),(0,y.Q)(this.ngUnsubscribe)).subscribe(n=>{const a=this.pixelsToInchesDimensions(i.value);if(!(0,R.isEqual)(n,a)){const r=this.inchesToPixelsDimensions(n);i.patchValue({...r},{emitEvent:!1})}}),i.valueChanges.pipe((0,K.B)(500),(0,I.p)(()=>i.valid),(0,y.Q)(this.ngUnsubscribe)).subscribe(n=>{const a=this.inchesToPixelsDimensions(t.value);if(!(0,R.isEqual)(n,a)){const r=this.pixelsToInchesDimensions(n);t.patchValue({...r},{emitEvent:!1})}})}initSnapshotActionListeners(){this.actions.pipe((0,l.xi)(Di.F0),(0,ze.Z)(i=>this.copyToClipboard(i.embed,"embed")),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(i?"Successfully copied image embed code to clipboard.":"Unable to copy image embed code to clipboard.")}),this.actions.pipe((0,l.xi)(Di.SJ),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Unable to generate embed code.")}),this.actions.pipe((0,l.xi)(Di.DU),(0,ze.Z)(i=>this.copyToClipboard(i.imageURL,"url")),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackBar.open(i?"Successfully copied image URL to clipboard.":"Unable to copy image URL to clipboard.")}),this.actions.pipe((0,l.xi)(Di.YJ),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackBar.open("Unable to generate image URL.")}),this.actions.pipe((0,l.xi)(tt.x$),(0,K.B)(100),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.getSnapshotOptionsFromForm(this.formSnapshot.value);this.syncSnapshotOptionsToScene(i)})}copyToClipboard(i,t){return this.clipboardService.copyToClipboard(i,t).pipe((0,ze.Z)(n=>(0,m.of)(n)))}takeSnapshot(){const i=this.store.selectSnapshot(S.S.getEnginePosition),t=this.getSnapshotOptionsFromForm(this.formSnapshot.value),{imageType:n,dimensions:o,labelsDisabled:a}=t,{width:r,height:p}=o,x=!a,N=this.store.selectSnapshot(j.N.getSelectedChapterBackground),z=(0,Io.F$)(n,N),W=this.snapshotService.getLogoFromBackground(N);let Se=!0;!Fe.c.production&&"true"===localStorage.getItem("disableCopyright")&&(Se=!1);const Le={...Io._,crop:"original",imageType:n,imageQuality:1,copyrightEnabled:Se,copyrightImagePath:W.logo_url};return this.snapshotService.takeSnapshot(r,p,z,[],x,Le,i.scale)}downloadSnapshot(i,t){const n=this.store.selectSnapshot(E.t.getStory)?.displayName,o=this.store.selectSnapshot(j.N.getSelectedChapter)?.displayName,r=ao.X.createModelFileName(n,o,kn.G[t]);return ao.X.exportImage(i,t,r)}inchesToPixelsDimensions(i){const{width:t,height:n}=i;return{width:(0,_e.jN)(t),height:(0,_e.jN)(n)}}pixelsToInchesDimensions(i){const{width:t,height:n}=i;return{width:(0,_e.Fg)(t),height:(0,_e.Fg)(n)}}getSnapshotFormFromOptions(i){const{dimensions:t,imageType:n,imageSizeType:o,labelsDisabled:a,labelScale:r}=i,{width:p,height:x}=t;return{pixelDimensions:{width:p,height:x},inchesDimensions:{width:(0,_e.Fg)(p),height:(0,_e.Fg)(x)},imageSizeType:o,imageType:n,labelsDisabled:a,labelScale:r}}getSnapshotOptionsFromForm(i){const{inchesDimensions:t,pixelDimensions:n,imageSizeType:o,imageType:a,labelsDisabled:r,labelScale:p}=i;return{dimensions:o===so.Inches?this.inchesToPixelsDimensions(t):n,imageType:a,imageSizeType:o,labelScale:p,labelsDisabled:r}}syncSnapshotOptionsToScene(i){const{dimensions:t,labelsDisabled:n,labelScale:o}=i,{width:a,height:r}=t;this.store.dispatch(new ke.eH(!n)),this.store.dispatch(new ke.tH(o));const p=this.store.selectSnapshot(S.S.getEnginePosition),x=p.viewportWidth===a&&p.viewportHeight===r?Be:new xe("Custom",a,r);this.store.dispatch(new P.IW(x))}getStorageKey(){return this.store.selectSnapshot(Oe.k.getUserProfile).eid}writeSnapshotOptions(i){const t=this.storageService.getLocalJSON(Ue.UT.SnapshotOptions),n=this.getStorageKey();this.storageService.setLocalItem(Ue.UT.SnapshotOptions,{...t??{},[n]:i})}readSnapshotOptions(){const i=this.getStorageKey(),n=this.storageService.getLocalJSON(Ue.UT.SnapshotOptions)?.[i];return{...new Ga,...n??{}}}static#e=this.\u0275fac=function(t){return new(t||Tn)(e.rXU(l.il),e.rXU(l.En),e.rXU(Ue.n$),e.rXU(Wf.M),e.rXU(va.W),e.rXU(Xe.o),e.rXU(c.ok),e.rXU(Qe.UG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:Tn,selectors:[["app-edit-image-form"]],decls:45,vars:13,consts:[["actionsMenu","matMenu"],["downloadMenu","matMenu"],["column-label",""],["column-actions",""],["app-button","",3,"matMenuTriggerFor"],["icon","ellipsis-v"],["mat-menu-item","",3,"click"],[3,"formGroup"],["column-group-body",""],[3,"showHeader"],["label","Image Size"],["formControlName","imageSizeType",1,"flex","flex-row","w-full","text-xs"],[1,"flex-auto",3,"value"],[1,"flex-auto","ml-10",3,"value"],[3,"ngSwitch"],["formControlName","pixelDimensions",3,"currentWidth","currentHeight",4,"ngSwitchCase"],["formControlName","inchesDimensions",4,"ngSwitchCase"],["label","Format"],["formControlName","imageType",1,"input"],["matTooltip","Highest quality, best for print and offline use.",3,"value"],["matTooltip","Smallest file size, best for most uses.",3,"value"],["label","Label Visibility"],["formControlName","labelsDisabled",1,"text-xs"],["label","Label Size",4,"ngIf"],[1,"mt-2"],[1,"w-full"],["app-button","","buttonType","flat","buttonSize","sm","data-test","editDownloadImage",1,"grow",3,"click"],["app-button","","buttonType","flat","buttonSize","sm",2,"flex","0 0 40px",3,"matMenuTriggerFor"],["icon","caret-down"],["mat-menu-item","","data-test","editCopyImageEmbed",3,"click"],["mat-menu-item","","data-test","editCopyImageLink",3,"click"],["formControlName","pixelDimensions",3,"currentWidth","currentHeight"],["formControlName","inchesDimensions"],["label","Label Size"],["theme","dark","formControlName","labelScale","min","1","max","5","step","0.1","digitSize","3",1,"grow",3,"label"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"app-column")(1,"h2",2),e.EFF(2,"Image"),e.k0s(),e.j41(3,"div",3)(4,"button",4),e.nrm(5,"app-icon",5),e.k0s(),e.j41(6,"mat-menu",null,0)(8,"button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleResetDefaultsClick())}),e.EFF(9,"Reset Defaults"),e.k0s()()(),e.j41(10,"app-column-group",7),e.qex(11,8),e.j41(12,"app-panel",9)(13,"app-form-field",10)(14,"mat-radio-group",11)(15,"mat-radio-button",12),e.EFF(16,"Pixels"),e.k0s(),e.j41(17,"mat-radio-button",13),e.EFF(18,"Inches"),e.k0s()()(),e.qex(19,14)(20),e.DNE(21,sg,3,6,"app-edit-image-dimensions-pixels",15)(22,ag,1,0,"app-edit-image-dimensions-inches",16),e.bVm()(),e.j41(23,"app-form-field",17)(24,"select",18)(25,"option",19),e.EFF(26," PNG "),e.k0s(),e.j41(27,"option",20),e.EFF(28," JPG "),e.k0s()()(),e.j41(29,"app-form-field",21)(30,"mat-checkbox",22),e.EFF(31,"Hide all labels"),e.k0s()(),e.DNE(32,rg,2,1,"app-form-field",23),e.j41(33,"div",24)(34,"app-button-group",25)(35,"button",26),e.bIt("click",function(){return e.eBV(o),e.Njj(n.downloadClick())}),e.EFF(36," Download "),e.k0s(),e.j41(37,"button",27),e.nrm(38,"app-icon",28),e.k0s()(),e.j41(39,"mat-menu",null,1)(41,"button",29),e.bIt("click",function(){return e.eBV(o),e.Njj(n.copyEmbedClick())}),e.EFF(42," Copy Embed "),e.k0s(),e.j41(43,"button",30),e.bIt("click",function(){return e.eBV(o),e.Njj(n.copyLinkClick())}),e.EFF(44," Copy Link "),e.k0s()()()(),e.bVm(),e.k0s()()}if(2&t){const o=e.sdS(7),a=e.sdS(40);e.R7$(4),e.Y8G("matMenuTriggerFor",o),e.R7$(6),e.Y8G("formGroup",n.formSnapshot),e.R7$(2),e.Y8G("showHeader",!1),e.R7$(2),e.BMQ("aria-label","Image Size"),e.R7$(),e.Y8G("value",n.imageSizeTypeEnum.Pixels),e.R7$(2),e.Y8G("value",n.imageSizeTypeEnum.Inches),e.R7$(2),e.Y8G("ngSwitch",n.imageSizeType),e.R7$(2),e.Y8G("ngSwitchCase",n.imageSizeTypeEnum.Pixels),e.R7$(),e.Y8G("ngSwitchCase",n.imageSizeTypeEnum.Inches),e.R7$(3),e.Y8G("value",n.imageTypeEnum.PNG),e.R7$(2),e.Y8G("value",n.imageTypeEnum.JPEG),e.R7$(5),e.Y8G("ngIf",!n.labelsDisabled),e.R7$(5),e.Y8G("matMenuTriggerFor",a)}},dependencies:[w.bT,w.ux,w.e1,c.xH,c.y7,c.wz,c.BC,c.cb,c.j4,c.JD,Ae.So,qe.VT,qe._g,D.kk,D.fb,D.Cp,Ce.oV,Y.Q,gi,pt,at,Z.K,X.R,Ve,me.g,tg,ig,w.Jj],changeDetection:0})}!function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);o>3&&a&&Object.defineProperty(i,t,a)}([(0,l.l6)(S.S.getEnginePosition),function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata("design:type",i)}(0,_.c)],Tn.prototype,"enginePosition$",void 0);var lg=v(11583);let cg=(()=>{class s{constructor(){}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-upgrade"]],decls:21,vars:1,consts:[[1,"edit-image-upgrade"],["column-label","",1,"w-full","flex","flex-row","items-center","justify-between"],["icon","lock","label","School & Business Plans"],[3,"compact"],["column-group-body",""],[1,"edit-image-upgrade__body"],["src","assets/images/2d_image_workflow.gif",1,"edit-image-upgrade__banner"],[1,"font-bold"],["app-button","","buttonType","primary","href","https://support.biodigital.com/hc/en-us/articles/360023856054-Publish-a-2D-image-of-a-model","target","_blank",1,"text-link","w-full","mt-4"]],template:function(n,o){1&n&&(e.j41(0,"app-column",0)(1,"h2",1)(2,"span"),e.EFF(3,"Image"),e.k0s(),e.nrm(4,"app-tag",2),e.k0s(),e.j41(5,"app-column-group",3),e.qex(6,4),e.j41(7,"app-panel")(8,"div",5),e.nrm(9,"img",6),e.j41(10,"p"),e.EFF(11," Create, customize, and download high-quality images of your 3D models for digital or print solutions. "),e.k0s(),e.j41(12,"p"),e.EFF(13," Downloading images is only available with a "),e.j41(14,"span",7),e.EFF(15,"School or Business plan"),e.k0s(),e.EFF(16,". "),e.k0s(),e.j41(17,"p"),e.EFF(18,"Unlock this feature by upgrading your account."),e.k0s(),e.j41(19,"a",8),e.EFF(20,"Learn More"),e.k0s()()(),e.bVm(),e.k0s()()),2&n&&(e.R7$(5),e.Y8G("compact",!1))},dependencies:[Y.Q,pt,at,lg.e,me.g],styles:[".edit-image-upgrade__body[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem;display:flex;flex-direction:column;align-items:stretch;gap:16px;padding:0 4px}.edit-image-upgrade__banner[_ngcontent-%COMP%]{display:block;width:100%;height:auto;border:1px solid #283853;border-radius:4px}"],changeDetection:0})}return s})();function pg(s,i){1&s&&e.nrm(0,"app-edit-image-form")}function dg(s,i){1&s&&e.nrm(0,"app-edit-image-upgrade")}let mg=(()=>{class s{constructor(t,n){this.store=t,this.changeRef=n,this.ngUnsubscribe=new f.B}ngOnInit(){this.init()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}init(){(0,C.z)([this.store.select(Oe.k.getUserRole),this.store.select(Oe.k.isPremiumUser),this.store.select(Li.q.hasOrganization),this.store.select(Li.q.getOrganizationAddOns)]).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(([t,n,o,a])=>{this.publishImageEnabled=(0,An.KZ)(t,n,o,a),this.changeRef.markForCheck()})}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(l.il),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-image-context"]],decls:3,vars:2,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"]],template:function(n,o){1&n&&(e.qex(0,0),e.DNE(1,pg,1,0,"app-edit-image-form",1)(2,dg,1,0,"app-edit-image-upgrade",2),e.bVm()),2&n&&(e.Y8G("ngSwitch",o.publishImageEnabled),e.R7$(),e.Y8G("ngSwitchCase",!0))},dependencies:[w.ux,w.e1,w.fG,Tn,cg],changeDetection:0})}return s})(),ug=(()=>{class s{transform(t,n){return Dn.l.normalize(`${t||""}`)}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275pipe=e.EJ8({name:"textNormalize",type:s,pure:!0})}return s})();var ne=function(s,i,t,n){var r,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(s,i,t,n);else for(var p=s.length-1;p>=0;p--)(r=s[p])&&(a=(o<3?r(a):o>3?r(i,t,a):r(i,t))||a);return o>3&&a&&Object.defineProperty(i,t,a),a},oe=function(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)};const hg=["engineContainer"],fg=["dimensionsTool"],gg=["backgroundTool"],bg=["engineWatermarkEl"],_g=(s,i,t)=>({"edit--show-timeline-editor":s,"edit--loading":i,"edit--left-collapsed":t}),vg=s=>({"edit__breadcrumb--hide":s}),Cg=(s,i,t)=>({ready:s,show:i,manifests:t});function yg(s,i){1&s&&e.nrm(0,"a",68)}function kg(s,i){1&s&&e.nrm(0,"a",69)}function Tg(s,i){1&s&&(e.j41(0,"span",75),e.EFF(1,"Upgrade Now"),e.k0s())}function Sg(s,i){1&s&&e.nrm(0,"app-spinner",77)}function xg(s,i){if(1&s&&(e.qex(0),e.DNE(1,Sg,1,0,"app-spinner",76),e.nI1(2,"async"),e.j41(3,"span"),e.EFF(4,"Save"),e.k0s(),e.bVm()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",e.bMT(2,1,t.saving$))}}function Eg(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-button-group")(1,"button",70),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleSaveBookmark())}),e.j41(3,"div",71),e.DNE(4,Tg,2,0,"span",72)(5,xg,5,3,"ng-container",24),e.k0s()(),e.j41(6,"button",73),e.nI1(7,"async"),e.nrm(8,"app-icon",74),e.k0s()()}if(2&s){const t=e.XpG(),n=e.sdS(104);e.R7$(),e.Y8G("disabled",e.bMT(2,5,t.saving$)),e.R7$(2),e.Y8G("ngSwitch",t.atBookmarkLimit),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(2),e.Y8G("matMenuTriggerFor",n)("disabled",e.bMT(7,7,t.saving$))}}function wg(s,i){if(1&s){const t=e.RV6();e.j41(0,"app-button-group")(1,"button",78),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.saveModule())}),e.EFF(3," Save "),e.k0s(),e.j41(4,"button",79),e.nI1(5,"async"),e.nrm(6,"app-icon",74),e.k0s()()}if(2&s){const t=e.XpG(),n=e.sdS(118);e.R7$(),e.Y8G("disabled",e.bMT(2,3,t.saving$)),e.R7$(3),e.Y8G("matMenuTriggerFor",n)("disabled",e.bMT(5,5,t.saving$))}}function Fg(s,i){1&s&&e.nrm(0,"app-edit-exit")}function Rg(s,i){1&s&&e.nrm(0,"app-navigation-context-compact")}function Pg(s,i){1&s&&e.nrm(0,"app-navigation-context")}function jg(s,i){if(1&s&&e.nrm(0,"app-status",80),2&s){const t=e.XpG();e.Y8G("color",t.quizStatusActive?"green":"red")}}function Mg(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",27)(1,"button",81),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.handleToggleStats())}),e.nrm(3,"app-icon",82),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("matTooltip",e.bMT(2,1,t.statsEnabled$)?"Hide Stats Tool":"Show Stats Tool")}}function Ig(s,i){1&s&&e.nrm(0,"img",83,5)}function Ng(s,i){1&s&&e.nrm(0,"app-edit-document-context")}function Bg(s,i){1&s&&e.nrm(0,"app-edit-label-context")}function Dg(s,i){1&s&&e.nrm(0,"app-edit-paint-context")}function Gg(s,i){1&s&&e.nrm(0,"app-edit-quiz-context")}function $g(s,i){1&s&&e.nrm(0,"app-edit-image-context")}function Og(s,i){1&s&&e.nrm(0,"app-edit-positions-context")}function Ag(s,i){1&s&&e.nrm(0,"app-edit-chapter-pagination")}function Ug(s,i){1&s&&(e.j41(0,"div",84),e.nrm(1,"app-engine-scrubber",85),e.k0s())}function Vg(s,i){if(1&s&&(e.j41(0,"button",90),e.EFF(1),e.nI1(2,"async"),e.nrm(3,"app-icon",91),e.k0s()),2&s){e.XpG();const t=e.sdS(4),n=e.XpG();e.Y8G("matMenuTriggerFor",t),e.R7$(),e.SpI(" ",n.formatTimelineScale(e.bMT(2,2,n.timelineScale$))," ")}}function Lg(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.setTimelineScale(o))}),e.j41(1,"div"),e.EFF(2),e.k0s()()}if(2&s){const t=i.$implicit,n=e.XpG(2);e.R7$(2),e.JRh(n.formatTimelineScale(t))}}function Yg(s,i){1&s&&e.nrm(0,"app-spinner",94)}function zg(s,i){if(1&s&&e.nrm(0,"app-icon",29),2&s){const t=e.XpG().ngIf;e.Y8G("icon",t.show?"compress-alt":"expand-alt")}}function Xg(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",92),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.toggleTimelineEditor())}),e.DNE(1,Yg,1,0,"app-spinner",93)(2,zg,1,1,"ng-template",null,7,e.C5r),e.k0s()}if(2&s){const t=i.ngIf,n=e.sdS(3);e.Y8G("matTooltip",t.ready||t.manifests?t.show?"Close Timeline Editor":"Open Timeline Editor":"Loading Timeline Editor")("disabled",!t.ready&&!t.manifests),e.R7$(),e.Y8G("ngIf",!t.ready&&!t.manifests)("ngIfElse",n)}}function Qg(s,i){if(1&s&&(e.j41(0,"div",86),e.DNE(1,Vg,4,4,"button",87),e.nI1(2,"async"),e.j41(3,"mat-menu",null,6),e.DNE(5,Lg,3,1,"button",88),e.k0s(),e.DNE(6,Xg,4,4,"button",89),e.nI1(7,"async"),e.nI1(8,"async"),e.nI1(9,"async"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,3,t.showTimelineEditor$)),e.R7$(4),e.Y8G("ngForOf",t.timelineScales),e.R7$(),e.Y8G("ngIf",e.sMw(11,Cg,e.bMT(7,5,t.allChaptersReady$),e.bMT(8,7,t.showTimelineEditor$),e.bMT(9,9,t.manifestsMaxTimes$)))}}function qg(s,i){if(1&s&&(e.nrm(0,"app-edit-timeline",95),e.nI1(1,"async")),2&s){const t=e.XpG();e.Y8G("manifestsMaxTimes",e.bMT(1,1,t.manifestsMaxTimes$))}}function Hg(s,i){1&s&&e.nrm(0,"app-edit-timeline-maps",96)}function Wg(s,i){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",61),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.exportQuizKey())}),e.EFF(2,"Export Quiz Key"),e.k0s(),e.bVm()}}function Jg(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",97),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.publishBookmark())}),e.EFF(2," Publish "),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("disabled",t.atBookmarkLimit||e.bMT(1,1,t.saving$))}}function Kg(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",98),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.upgrade())}),e.EFF(1," Upgrade Now "),e.k0s()}}function Zg(s,i){if(1&s){const t=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.exportQuizKey())}),e.EFF(1," Export Quiz Key "),e.k0s()}}function eb(s,i){if(1&s&&e.nrm(0,"app-edit-reload-countdown",99),2&s){const t=e.XpG();e.Y8G("count",t.reloadCount)}}class J{constructor(i,t,n,o,a,r,p,x,N,z,W,Se,Le,ti,et,Et,ii,Ye,ni,Sn,ds,ro,lo,co,xn){this.actions=i,this.activatedRoute=t,this.router=n,this.nodeService=o,this.animationService=a,this.serializeModuleService=r,this.modulesService=p,this.bookmarkActionsService=x,this.vendorAnalyticsService=N,this.dialog=z,this.dialogService=W,this.storageService=Se,this.userAccessService=Le,this.location=ti,this.snackBar=et,this.store=Et,this.storyService=ii,this.sceneService=Ye,this.popupService=ni,this.cleanupService=Sn,this.imageService=ds,this.engineRendererService=ro,this.snackbar=lo,this.renderer=co,this.changeDetectorRef=xn,this.layoutThemeEnum=d.Z,this.editViewEnum=M.x,this.toolEnum=H.s,this.environmentApplication=Me.c,this.toolIcons=Bl,this.exportType=Fe.c.exportType,this.canvasSizeTooltip="Emulate canvas size",this.reloadCount=0,this.showReloadBlocker=!1,this.isStoryDirty=!1,this.timelineScales=oc,this.ngUnsubscribe=new f.B,this.application=Me.c,this.isAnimated=!1,this.atBookmarkLimit=!1,this.quizHasQuestions=!1,this.quizStatusActive=!1}ngOnInit(){const{id:i}=this.activatedRoute.snapshot.queryParams;this.id=this.sanitizeRouteId(i),this.type=this.storyService.getStoryType(this.id),this.store.dispatch(new ms.G.SetTheme(d.Z.Dark)),this.store.dispatch(new ie.pL(H.s.Select)),this.store.dispatch(new P.tV),this.store.dispatch(new ie.t5(!0)),this.store.dispatch(new ie.Gv(!0)),this.store.dispatch(new ie.Ti(!0)),this.store.dispatch(new Ft.pU(!0)),this.store.dispatch(new ke.Tz(!1)),this.store.dispatch(new Ee.yi(this.id,this.type)),this.store.dispatch(new tt.Xt(this.id,this.type)),this.store.dispatch(new ke.Ds({tag:!0,pin:!0})),this.store.dispatch(new ie.kE(!1)),this.store.dispatch(new ie.jM(!1)),Fe.c.application===Me.c.Loft&&(this.store.dispatch(new $l.h.Reset),this.allChaptersReady$.pipe((0,B.Z)(!1),(0,O.F)(),(0,I.p)(t=>t),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ee.V_)}),this.store.dispatch(new Zs.Z(!0))),this.resizeEngineContainer(),this.initListeners(),this.initAuthChecks(),this.initKeyboardListeners(),this.initDirtyCheck(),this.initVendorAnalyticsEvents(),this.prepareThumbnails(this.id),this.initViewGraphListeners(),this.initContentViews(),this.initPaints(),this.initStoryRecipes(),this.initNodePaintListener(),this.initQuizStateListener(),this.initEngineWatermarkListeners()}ngAfterViewInit(){setTimeout(()=>this.resizeEngineContainer(),0)}ngOnDestroy(){this.store.dispatch(new ms.G.SetTheme(d.Z.Light)),this.store.dispatch(new ie.t5(!1)),this.store.dispatch(new ke.Tz(!1)),this.unbindKeyboardListeners(),this.cleanupService.resetScene(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}canDeactivate(){if(this.store.selectSnapshot(Oe.k.getUserProfile)&&this.isStoryDirty&&!this.atBookmarkLimit){const t=this.store.selectSnapshot(je.J.getSelectedBookmark),n=this.getBookmarkSaveType(t);return this.confirmSaveDialog(!0).pipe((0,rt.q)(o=>{if(typeof o>"u")return(0,m.of)(!1);if(!o)return(0,m.of)(!0);switch(Fe.c.application){case Me.c.Studio:return("save"===n?this.saveBookmark(t,!0):(0,u.H)(this.saveNewBookmarkDialog(t)).pipe((0,ve.T)(r=>r.bookmark))).pipe((0,ve.T)(()=>!0));case Me.c.Loft:this.openSaveModuleDialog(this.id).afterClosed().pipe((0,ve.T)(()=>!0))}}),(0,y.Q)(this.ngUnsubscribe))}return(0,m.of)(!0)}resizeEngineContainer(){const{offsetLeft:i,offsetTop:t,offsetWidth:n,offsetHeight:o}=this.engineContainer.nativeElement;let[a,r,p,x]=[i,t,n,o];const N=this.store.selectSnapshot(g.getCanvasSettings);let z=!1;const W=this.store.selectSnapshot(g.getCanvasSize);(-1!==W.width||-1!==W.height)&&([p,x]=[W.width,W.height],N.emulateDrawer&&W.width<960&&(z=!0,x-=64),N.emulateColumn&&W.width>=960&&(z=!0,p-=320),r=t+(o-x)/2,a=i+(n-p)/2);const ti=Math.min(n/p,o/x,1);this.canvasSizeTooltip=z?`Canvas Size: ${p}px x ${x}px with ${p>=960?As.G.Column:As.G.Drawer}`:`Canvas Size: ${p}px x ${x}px`;const et=new La.j(n,o,a,r,p,x,Ya.g.Shown,ti);this.store.dispatch(new ie.Sh(et))}initListeners(){this.windowResize$=(0,h.R)(window,"resize"),(0,C.z)([this.engineReady$,this.incoming$]).pipe((0,I.p)(([i,t])=>i&&!!t.id),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.loadStory()}),(0,T.h)(this.showTimelineEditor$,this.windowResize$,this.canvasSize$,this.leftColumnCollapsed$).pipe((0,De.c)(10),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.resizeEngineContainer()}),this.record$.subscribe(i=>{this.record=i}),this.selectedChapterId$.pipe((0,I.p)(i=>!!i),(0,ve.T)(()=>this.store.selectSnapshot(j.N.getSelectedChapter)),(0,I.p)(i=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleChapterChanging(i)}),this.engineChapterId$.pipe((0,I.p)(i=>!!i),(0,ve.T)(()=>this.store.selectSnapshot(j.N.getSelectedChapter)),(0,I.p)(i=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleChapterChanged(i)}),this.actions.pipe((0,l.rM)(U.Oj),(0,ve.T)(()=>this.store.selectSnapshot(j.N.getSelectedChapter)),(0,I.p)(i=>!(0,R.isNil)(i?.camera?.location)),(0,y.Q)(this.ngUnsubscribe)).subscribe(({camera:i})=>{const{location:t,rotationCenter:n}=i;this.store.dispatch(new Ft.Ih(t,!1,void 0,n))}),this.selectedLabel$.pipe((0,O.F)((i,t)=>i?.id===t?.id),(0,I.p)(i=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new ie.pL(H.s.Label)),this.store.dispatch(new P.yF(M.x.Label))}),this.actions.pipe((0,l.xi)(ie.zE),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleNodeClick(i.node,i.event)}),this.actions.pipe((0,l.xi)(tt.x$),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleSaveBookmarkSuccess(i)),this.actions.pipe((0,l.xi)(tt.Ur),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleSaveBookmarkFailure(i)),this.actions.pipe((0,l.xi)(Lt.NZ),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>this.handleSaveModuleSuccess(i)),this.actions.pipe((0,l.xi)(U.PA),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{setTimeout(()=>{this.snackbar.open(`Duplicated chapter "${i.chapter.displayName}"`)})}),this.actions.pipe((0,l.xi)(U.YA),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackbar.open(`"${i.chapter.displayName}" chapter has been removed`)}),this.actions.pipe((0,l.xi)(Ee.S9),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ee.yi(null,null)),this.router.navigate(["/404"],{queryParams:{errorType:"content",errorUrl:this.router.url},skipLocationChange:!0})}),this.actions.pipe((0,l.xi)(Ee.yw),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.snackbar.open(`Successfully imported ${i.story.displayName}.`)}),this.actions.pipe((0,l.xi)(ie.RZ,ie.PF),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.snackbar.open("Successfully updated model layers.")}),this.actions.pipe((0,l.xi)(P.lN),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.preview("modal",i.quizLocked,i.quizQuestion)}),this.actions.pipe((0,l.xi)(U.lc,U.Bc),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(j.N.getSelectedChapter);this.isAnimated=this.animationService.isChapterAnimated(i)}),this.chapterReadyState$.pipe((0,I.p)(i=>!(0,R.isNil)(i)&&!0===i.animation),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(j.N.getSelectedChapter);(0,R.get)(i,"ui.play.autoplay",!1)&&(this.animationService.scrub(.1),this.animationService.scrub(0))})}initAuthChecks(){this.selectedBookmark$.pipe((0,I.p)(i=>!!i),(0,I.p)(i=>!this.isBookmarkEditable(i)),(0,Bt.n)(()=>this.bookmarkActionsService.checkBookmarkLimit()),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{this.handleBookmarkLimit(i)})}initContentViews(){(0,C.z)([this.store.select(Oe.k.isPremiumUser),this.store.select(j.N.getSelectedChapterModelReady),this.store.select(Oe.k.getContentViews)]).pipe((0,I.p)(([i,t,n])=>!i&&t&&!n.limit_reached),(0,be.s)(1),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.store.dispatch(new Ns.e0(this.id,this.type))})}initStoryRecipes(){this.story$.pipe((0,I.p)(i=>null!=i),(0,y.Q)(this.ngUnsubscribe),(0,K.B)(0),(0,be.s)(1)).subscribe(i=>{this.store.dispatch(new Q.yE),i.chapters.forEach(t=>{const n=[];(0,R.isNil)(t.synchronization)||Object.values(t.synchronization).forEach(o=>{(0,pi.Jl)(o)&&n.push(o)}),this.store.dispatch(new Q.b8(t.id,n)),(Fe.c.application===Me.c.Studio&&this.type)===It.c.Module&&this.store.dispatch(new Ee.Pv(void 0))})})}initPaints(){const i=this.storageService.getLocalJSON(Ue.UT.RecentRecipes);this.store.dispatch(new Q.Nf(i));const t=this.storageService.getLocalJSON(Ue.UT.PaintPalettes);this.store.dispatch(new Q.T2(t))}initNodePaintListener(){this.actions.pipe((0,l.rM)(re.Jp),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(L.i.getCurrentRecipeForEngine);(0,pi.Jl)(i)&&this.store.dispatch(new Q.Df(i));const t=this.store.selectSnapshot(ye.z.getNodes),n=this.buildChapterRecipes(t),o=this.store.selectSnapshot(j.N.getSelectedChapterId);this.store.dispatch(new Q.b8(o,n)),this.changeDetectorRef.markForCheck()})}initQuizStateListener(){(0,C.z)([this.allQuestions$,this.quizEnabled$,this.bookmarkViewMode$]).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(([i,t,n])=>{this.quizHasQuestions=i.length>0,this.quizStatusActive=this.quizHasQuestions&&t&&!(n===vt._.Content),this.changeDetectorRef.markForCheck()}),(0,C.z)([this.actions.pipe((0,l.rM)(Ee.t1)),this.store.select(je.J.getSelectedBookmarkViewMode)]).pipe((0,I.p)(([,i])=>!(0,R.isNil)(i)),(0,y.Q)(this.ngUnsubscribe)).subscribe(([,i])=>{const t=this.store.selectSnapshot(he.j.getQuizSettings);this.store.dispatch(new Re.B.SetQuizSettings({...t,enabled:i!==vt._.Content}))})}buildChapterRecipes(i){const t=Object.values(i).reduce((n,o)=>{if((0,pi.Jl)(o.paint)){const a=(0,lt.Sf)(o.paint);n.push(a)}return n},[]);return(0,pi.c7)(t).sort(pi.UD)}initDirtyCheck(){this.actions.pipe((0,l.xi)(Ee.Z0,tt.x$,Lt.NZ,Ns.cO),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.isStoryDirty=!1}),this.actions.pipe((0,l.xi)(re.Jp,re.Ke,re.yr,ke.Sh,ke.vx,ke.lb,ke.yi,U.PA,U.YA,Ee.yw,Ee.Nu,tt.e_,Ee.fK,U.qi,U.EN,U.Ej,U.Nw,U.sN,U.rT,U.Oj,U.O,U.sC,U.VU,Us.V9,U.tn,Re.B.AddQuestion,Re.B.ReorderQuestions,Re.B.RemoveQuestions,Re.B.SetQuestion),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{this.isStoryDirty=!0})}initVendorAnalyticsEvents(){this.store.select(j.N.getSelectedChapterModelReady).pipe((0,I.p)(i=>i),(0,be.s)(1),(0,y.Q)(this.ngUnsubscribe)).subscribe(()=>{const i=this.store.selectSnapshot(E.t.getStoryId),t=this.store.selectSnapshot(E.t.getStory);this.vendorAnalyticsService.trackOncePerPage("View - Loaded",{id:i,chapters:t.chapters.length,tour:t.tags.includes("tour"),animated:t.tags.includes("animated"),quiz:this.store.selectSnapshot(he.j.hasQuiz),edit:!0})})}initViewGraphListeners(){this.store.select(g.getShowRootNodes).pipe((0,wn.i)(1),(0,y.Q)(this.ngUnsubscribe)).subscribe(i=>{const t=this.store.selectSnapshot(j.N.getSelectedChapter),n=this.sceneService.createViewGraph({includeRoot:i,availableObjects:t.availableObjects});this.store.dispatch(new ie.LL(n))})}initEngineWatermarkListeners(){(0,C.z)([this.activeTool$,this.logoConfig$,this.background$,this.enginePosition$]).pipe((0,I.p)(([,i])=>!(0,R.isNil)(i)),(0,O.F)((i,t)=>(0,R.isEqual)(i,t)),(0,K.B)(0),(0,y.Q)(this.ngUnsubscribe)).subscribe(([,i,t])=>{const n=this.engineWatermarkEl?.nativeElement;if(!n)return;const o=this.engineRendererService.getCanvas(),r=(0,Pc.g)(i,"full",(0,Yn.T4)(t)?"color":"white").logo_url;this.renderer.setAttribute(n,"src",r);const{innerHeight:p}=window,{left:x,bottom:N}=o.getBoundingClientRect(),{x:z,y:W}=Io._.copyrightOffset,Le=x+z;this.renderer.setStyle(n,"bottom",p-N-W+"px"),this.renderer.setStyle(n,"left",`${Le}px`)})}handleBookmarkLimit(i){const{limit_reached:o}=i;this.atBookmarkLimit=o;const a=this.store.selectSnapshot(Oe.k.getUserProfile),r=this.store.selectSnapshot(je.J.getSelectedBookmark);if(a&&r){const p=a.premium_account_valid,x=this.isBookmarkEditable(r);o&&!x&&!p&&this.userAccessService.openBookmarkSaveLimit()}}initKeyboardListeners(){Ie.bind("1",()=>this.handleSelectTool(H.s.Select)),Ie.bind("2",()=>this.handleSelectTool(H.s.Hide)),Ie.bind("3",()=>this.handleSelectTool(H.s.Paint)),Ie.bind("4",()=>this.handleSelectTool(H.s.Label)),Ie.bind("5",()=>this.handleSelectTool(H.s.Positions)),Ie.bind("6",()=>this.handleSelectTool(H.s.Quiz)),Ie.bind("7",()=>this.handleSelectTool(H.s.Image)),Ie.bind("shift+3",()=>this.handleSelectTool(H.s.Eyedropper)),Ie.bind("meta+,",i=>{i.preventDefault();const t=this.store.selectSnapshot(g.getLeftColumnCollapsed);this.store.dispatch(new P.HZ(!t))}),Ie.bind("meta+z",i=>{i.preventDefault(),this.undo()}),Ie.bind(["meta+y","meta+shift+z"],i=>{i.preventDefault(),this.redo()}),Ie.bind([".","pagedown"],()=>this.nextChapter()),Ie.bind([",","pageup"],()=>this.previousChapter()),Ie.bind(["del","backspace"],()=>this.handleDelete()),Ie.bind("meta+a",i=>{i.preventDefault(),this.handleSelectAll()}),Ie.bind(["H","I","F","P"],i=>{i.preventDefault();const t=this.store.selectSnapshot(ye.z.getCheckedNodeIds);if(t.length>0)switch(i.key){case"H":this.store.dispatch(new re.yr(!1,t));break;case"I":this.nodeService.hideInverse(t);break;case"F":this.nodeService.fade(t);break;case"P":this.nodeService.applyCurrentRecipe(t)}})}unbindKeyboardListeners(){Ie.reset()}handleStoryTitleClick(){this.openContentDialog()}handleChapterTitleClick(){const i=this.store.selectSnapshot(j.N.getSelectedChapterId);this.openContentDialog(i)}handleChapterChanging(i){this.isAnimated=this.animationService.isChapterAnimated(i)}handleChapterChanged(i){const t=this.store.selectSnapshot(g.getShowRootNodes),n=this.sceneService.createViewGraph({includeRoot:t,availableObjects:i.availableObjects});this.store.dispatch(new ie.LL(n)),this.store.dispatch(new re.IA(i.id));const{camera:o,transparencyMode:a}=i;this.store.dispatch(new ie._h(a)),(0,R.isNil)(o)||this.handleCameraAction(o)}handleCameraAction(i){const{action:t,location:n,rotationCenter:o}=i;this.store.dispatch(new Ft.Ih(n,"flyTo"===t,void 0,o))}handleSelectTool(i){switch(i!==H.s.Background&&i!==H.s.Dimensions&&this.store.dispatch(new ie.pL(i)),i){case H.s.Paint:case H.s.Eyedropper:this.store.dispatch(new P.yF(M.x.Paint));break;case H.s.Label:this.store.dispatch(new P.yF(M.x.Label));break;case H.s.Positions:this.store.dispatch(new P.yF(M.x.Positions));break;case H.s.Quiz:this.store.dispatch(new P.yF(M.x.Quiz));break;case H.s.Image:this.store.dispatch(new P.yF(M.x.Image));break;case H.s.Background:this.popupService.open({origin:this.backgroundTool.nativeElement,content:zt}).afterClosed$.pipe((0,be.s)(1),(0,y.Q)(this.ngUnsubscribe)).subscribe();break;case H.s.Dimensions:this.popupService.open({origin:this.dimensionsTool.nativeElement,content:hi}).afterClosed$.pipe((0,be.s)(1),(0,y.Q)(this.ngUnsubscribe)).subscribe();break;default:this.store.dispatch(new P.yF(M.x.Chapter))}}handleUndoClick(){this.undo()}handleRedoClick(){this.redo()}handleToggleStats(){const i=this.store.selectSnapshot(S.S.getStatsEnabled);this.store.dispatch(new ie.BM(!i,!1))}handleDelete(){const i=this.store.selectSnapshot($e.y.getSelectedLabel),t=this.store.selectSnapshot(ye.z.getCheckedNodeIds);i?this.store.dispatch(new ke.vx(i)):t.length&&this.store.dispatch(new re.yr(!1,t))}handleSelectAll(){this.store.dispatch(new re.q9(!0))}loadStory(){const{id:i,type:t}=this.store.selectSnapshot(E.t.getIncomingStoryInfo),n=this.store.selectSnapshot(Oe.k.getUserLanguage);this.store.dispatch(new Ee.Ye(i,t,n))}handleNodeClick(i,t){const n=this.store.selectSnapshot(S.S.getActiveTool);if(i||t.srcEvent.shiftKey)if(t.srcEvent.shiftKey){if(!i)return;const a=this.store.selectSnapshot(ye.z.getNodes)[i.id].checked;this.store.dispatch(new re.q9(!a,[i.id])),this.store.dispatch(new re.hg(i.id))}else{const o=!this.store.selectSnapshot(ye.z.getNodes)[i.id].checked;switch(n){case H.s.Hide:this.store.dispatch(new re.yr(!1,[i.id]));break;case H.s.Select:this.store.dispatch(new re.q9(!1)),o&&(this.store.dispatch(new re.q9(!0,[i.id])),this.store.dispatch(new re.hg(i.id))),this.store.dispatch(new ie._o(i))}}else this.store.dispatch(new re.q9(!1))}toggleTimelineEditor(){const i=!this.store.selectSnapshot(g.getShowTimelineEditor);this.store.dispatch(new P.ud(i))}setTimelineScale(i){this.store.dispatch(new ue.SetScale(i))}formatTimelineScale(i){return 100*i+"%"}handleSaveBookmark(){if(this.atBookmarkLimit)this.upgrade();else{const i=this.store.selectSnapshot(je.J.getSelectedBookmark);switch(this.getBookmarkSaveType(i)){case"save":this.saveBookmark(i).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(F.l);break;case"saveAs":this.saveBookmarkAs()}}}saveModule(){this.openSaveModuleDialog(this.id)}saveBookmarkAs(){const i=this.store.selectSnapshot(je.J.getSelectedBookmark);this.bookmarkActionsService.handleBookmarkAction(Ro.t9.SaveFromEdit,i)}publishBookmark(){var i=this;return(0,A.A)(function*(){if(i.atBookmarkLimit)return;const t=i.store.selectSnapshot(je.J.getSelectedBookmark),n=i.getBookmarkSaveType(t);if("save"===n&&t)i.isStoryDirty?i.confirmSaveDialog().pipe((0,rt.q)(o=>o?i.saveBookmark(t,!0):(0,m.of)(t)),(0,y.Q)(i.ngUnsubscribe)).subscribe(o=>{i.openPublishDialog(o)}):i.openPublishDialog(t);else if("saveAs"===n){const a=yield i.saveNewBookmarkDialog(t,"You must save your changes to publish your model.");a&&i.openPublishDialog(a.bookmark)}})()}isBookmarkEditable(i){if(i){const t=this.store.selectSnapshot(Oe.k.getUserRole),n=An.dE(t,i);return i.type===It.c.Bookmark&&n}return!1}getBookmarkSaveType(i){return i&&this.isBookmarkEditable(i)?"save":"saveAs"}handleSaveBookmarkSuccess(i){const{bookmark:t,story:n}=i;this.storyService.loadNewBookmark(t,n,"save"===i.method,this.store.selectSnapshot(j.N.getSelectedChapterIndex)),this.snackBar.open(`${t.title} saved to your library.`)}handleSaveModuleSuccess(i){this.id=this.sanitizeRouteId(i.id);const t=this.store.selectSnapshot(j.N.getSelectedChapterIndex);if(i.statesDuplicated){this.reloadCount=0,this.showReloadBlocker=!0;const o=setInterval(()=>{this.reloadCount++,this.changeDetectorRef.markForCheck()},1e3);setTimeout(()=>{clearInterval(o),this.showReloadBlocker=!1,this.changeDetectorRef.markForCheck(),window.location.reload()},9e4)}else this.store.dispatch(new Ee.Ck(i.id,i.story,It.c.Module,t,!0))}handleSaveBookmarkFailure(i){this.snackBar.open(`Unable to save "${i.bookmarkEntry.title}". Please try again.`)}openContentDialog(i=""){this.dialog.open(ot,{width:"90vw",maxWidth:"1280px",height:"90vh",data:{chapterId:i}})}preview(i,t=!1,n){if(this.bookmarkActionsService.isPremiumRestrictedAction(Ro.t9.Publish)){const z=this.store.selectSnapshot(Oe.k.getProfile);return void this.userAccessService.openPublishPaywall(z)}(0,R.isNil)(n)||(t=!0);const o=this.store.selectSnapshot(j.N.getStoryChapters),a=(0,Os.S)(o,!1),r=this.serializeModuleService.serialize({},new xo.F,!1,this.store.selectSnapshot(E.t.getStory),this.store.selectSnapshot(j.N.getStoryChapters),a,!1).story,p=this.store.selectSnapshot(je.J.getSelectedBookmark),x=this.store.selectSnapshot(Oe.k.getUserLanguage),N=this.store.selectSnapshot(Li.q.getSelectedOrganizationProductAccountId);this.storageService.setDatabaseItem(Ue.AJ.PreviewStory,r).then(()=>this.storageService.setDatabaseItem(Ue.AJ.PreviewBookmark,p)).then(()=>{switch(i){case"modal":this.dialog.open(hc,{panelClass:"bd-preview-dialog-panel",data:{quizLocked:t,questionNumber:n,lang:x,productAccountId:N}});break;case"tab":window.open(`/view?id=preview&lang=${x}`)}})}undo(){this.store.dispatch(new On.a.Undo(this.store.selectSnapshot(j.N.getSelectedChapterId)))}redo(){this.store.dispatch(new On.a.Redo(this.store.selectSnapshot(j.N.getSelectedChapterId)))}upgrade(){this.dialogService.openUpgradeDialog()}openInSceneEditor(){window.open(`https://scene-editor.biodigital.com/apps/editor/?m=${this.id}.json`)}openInViewer(){window.open(`https://human-qa.biodigital.com/viewer/?id=${this.id}&ui-label-list=true`)}sanitizeRouteId(i){return i=i.replace(/\.json$/,""),this.location.replaceState("edit",`?id=${i}`),i}nextChapter(){this.store.selectSnapshot(j.N.getAllChaptersModelsReady)&&this.store.dispatch(new U.tg)}previousChapter(){this.store.selectSnapshot(j.N.getAllChaptersModelsReady)&&this.store.dispatch(new U.F0)}prepareThumbnails(i){this.allChaptersReady$.pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(t=>t),(0,ve.T)(()=>this.store.selectSnapshot(E.t.getStory)),(0,be.s)(1)).subscribe(t=>{this.imageService.generateFreshChapterImages(t.chapters,i,Fe.c.application===Me.c.Studio&&this.type===It.c.Module).pipe((0,y.Q)(this.ngUnsubscribe)).subscribe(o=>{const a=this.store.selectSnapshot(Un.K.getRegisteredThumbnails);o.forEach(r=>{a.set(r.chapterId,r)}),this.store.dispatch(new Us.W2(a))})})}exportWrittenContent(){const i=this.storyService.exportWrittenContent(this.store.selectSnapshot(E.t.getStory),this.store.selectSnapshot(j.N.getStoryChapters),this.store.selectSnapshot($e.y.getLabels)),t=`${this.store.selectSnapshot(E.t.getStory).displayName||"story"}.txt`,n=new Blob([i],{type:"text/plain;charset=utf-8"});(0,So.saveAs)(n,t)}exportQuizKey(){const i=this.storyService.exportQuizKey(this.store.selectSnapshot(he.j.getAllQuestions)),t=`${this.store.selectSnapshot(E.t.getStory).displayName||"story"}.md`,n=new Blob([i],{type:"text/plain;charset=utf-8"});(0,So.saveAs)(n,t)}mergeModule(){let i=null,t=(0,m.of)(!0);this.isStoryDirty&&(t=this.confirmModuleMergeSaveDialog().pipe((0,y.Q)(this.ngUnsubscribe),(0,I.p)(n=>n),(0,ze.Z)(()=>this.openSaveModuleDialog(this.id).afterClosed()),(0,I.p)(n=>n))),t.pipe((0,y.Q)(this.ngUnsubscribe),(0,ze.Z)(()=>this.openMergeModuleDialog().afterClosed()),(0,I.p)(n=>null!=n),(0,Dt.M)(n=>{i=n.id}),(0,ze.Z)(()=>this.modulesService.mergeModule(this.id,i)),(0,ze.Z)(n=>n.success?(0,m.of)(n):this.resolveMergeConflict(this.id,i))).subscribe(n=>{this.snackBar.open(`${this.id} was successfully merged with ${i}`),this.store.dispatch(new Ee.Nu(n.merged))})}resolveMergeConflict(i,t){return this.openMergeConflictDialog(i,t).afterClosed().pipe((0,I.p)(n=>null!=n),(0,ze.Z)(n=>this.modulesService.mergeModule(i,t,n)),(0,I.p)(n=>n.success))}openMergeModuleDialog(){return this.dialog.open(ac,{id:zi.t.MergeModuleDialog,maxWidth:"90vw",width:"90vw",height:"90vh"})}openMergeConflictDialog(i,t){return this.dialog.open(rc,{id:zi.t.MergeConflictDialog,data:{loft:i,bridge:t}})}confirmModuleMergeSaveDialog(){return this.dialogService.openConfirmDialog({data:{titleText:"Unsaved Changes",bodyText:"You must save before merging files. Continue to save changes.",confirmText:"Continue",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed()}confirmSaveDialog(i){return this.dialogService.openConfirmDialog({data:{titleText:"Save Changes",bodyText:"Would you like to save your changes to your model?",confirmText:"Save",cancelText:"Don't Save",miscText:i?"Cancel":"",confirmColor:"warn"}}).afterClosed()}saveBookmark(i,t=!1){t&&this.snackBar.open(`Saving "${i.title}"...`);const n=this.isBookmarkEditable(i);return this.store.dispatch(new tt.iy({isOwner:n,id:i.id,title:i.title,viewMode:i.viewMode},!0,!1)).pipe((0,rt.q)(()=>this.actions.pipe((0,l.xi)(tt.x$,tt.Ur),(0,ai.$)())),(0,ve.T)(o=>o instanceof tt.x$?o.bookmark:i))}saveNewBookmarkDialog(i,t){return this.bookmarkActionsService.openSaveDialog({action:Ro.t9.SaveFromEdit,bookmark:i,message:t})}openPublishDialog(i){this.bookmarkActionsService.publish(i)}openSaveModuleDialog(i,t){this.dialog.closeAll();const n={id:zi.t.SaveModuleDialog,width:"480px",data:{id:i},...t};return this.dialog.open(Yt,n)}static#e=this.\u0275fac=function(t){return new(t||J)(e.rXU(l.En),e.rXU(b.nX),e.rXU(b.Ix),e.rXU(ea.w),e.rXU(Rt.O),e.rXU(Mc.g),e.rXU(Ds.F),e.rXU(lc.h),e.rXU(ic.e),e.rXU(ee.bZ),e.rXU(Xe.o),e.rXU(Ue.n$),e.rXU(ko.p),e.rXU(w.aZ),e.rXU(Qe.UG),e.rXU(l.il),e.rXU(Dl.J),e.rXU(fc.w),e.rXU(Fc.O),e.rXU(Gl.M),e.rXU(nc.M),e.rXU(jc.z),e.rXU(Qe.UG),e.rXU(e.sFG),e.rXU(e.gRc))};static#t=this.\u0275cmp=e.VBU({type:J,selectors:[["app-edit"]],viewQuery:function(t,n){if(1&t&&(e.GBs(hg,7),e.GBs(fg,7,e.aKT),e.GBs(gg,7,e.aKT),e.GBs(bg,5,e.aKT)),2&t){let o;e.mGM(o=e.lsd())&&(n.engineContainer=o.first),e.mGM(o=e.lsd())&&(n.dimensionsTool=o.first),e.mGM(o=e.lsd())&&(n.backgroundTool=o.first),e.mGM(o=e.lsd())&&(n.engineWatermarkEl=o.first)}},decls:131,vars:130,consts:[["dimensionsTool",""],["backgroundTool",""],["engineContainer",""],["fileMenuBookmarks","matMenu"],["fileMenuModules","matMenu"],["engineWatermarkEl",""],["timelineScale","matMenu"],["timelineButtons",""],[1,"edit","edit--dark","theme-dark",3,"ngClass"],[1,"edit__header-left"],["routerLink","/","class","edit__logo",4,"appFlagApplication"],["routerLink","/results/modules","class","edit__logo",4,"appFlagApplication"],["data-test","openContentManagerButton",1,"edit__title",3,"click","title"],[1,"edit__title-text"],[1,"edit__title-icon"],["icon","pencil"],[1,"edit__header-right"],["buttonSize","sm","buttonShape","square"],["app-button","","buttonType","outline","buttonSize","sm","compact","true","data-test","previewTrigger",3,"click","disabled"],[4,"appFlagExternal"],[4,"appFlagInternal"],[4,"appFlagApplication"],[1,"edit__scene-left",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"edit__header-bar"],[1,"flex","flex-row"],[1,"edit__toolbar-group"],["app-button","","buttonSize","sm","buttonShape","square","data-test","selectTool",3,"click","buttonType","matTooltip"],[3,"icon"],["app-button","","buttonSize","sm","buttonShape","square","data-test","hideTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","paintTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","labelTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","positionsTool",3,"click","buttonType","matTooltip"],[1,"relative"],["class","absolute pointer-events-none","style","z-index: 2",3,"color",4,"ngIf"],["app-button","","buttonSize","sm","buttonShape","square","data-test","quizTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","imageTool",3,"click","buttonType","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","dimensionsTool",3,"click","buttonType","disabled","matTooltip"],["app-button","","buttonSize","sm","buttonShape","square","data-test","backgroundTool",3,"click","buttonType","matTooltip"],[1,"flex","items-center","justify-center"],[3,"color","size"],["class","edit__toolbar-group",4,"appFlagApplication"],[1,"edit__toolbar-group","edit__toolbar-group--compact"],["app-button","","buttonSize","sm","buttonShape","square","data-test","undo","matTooltip","Undo",3,"click","disabled"],["icon","undo",3,"custom"],["app-button","","buttonSize","sm","buttonShape","square","matTooltip","Redo","data-test","redo",3,"click","disabled"],["icon","redo",3,"custom"],[1,"edit__scene"],[1,"edit__camera-bar"],["class","edit__watermark",4,"ngIf"],[1,"edit__scene-right",3,"ngSwitch"],[1,"edit__footer-left"],[4,"ngIf"],[1,"edit__footer-bar"],[1,"edit__breadcrumb",3,"ngClass"],["class","pointer-events-none edit__animation",4,"ngIf"],["class","edit__timeline-options",4,"appFlagApplication"],[1,"edit__timeline-bar"],["class","edit__timeline",3,"manifestsMaxTimes",4,"ngIf"],["class","edit__timeline-map",4,"ngIf"],["mat-menu-item","",3,"click"],["mat-menu-item","","data-test","publishBookmark",3,"disabled","click",4,"appFlagExternal"],["mat-menu-item","","data-test","upgradeSubscriptionButton",3,"click",4,"ngIf"],["mat-menu-item","","data-test","saveBookmark",3,"click","disabled"],["mat-menu-item","","data-test","saveBookmarkAs",3,"click","disabled"],["mat-menu-item","",3,"click",4,"ngIf"],[3,"count",4,"ngIf"],["routerLink","/",1,"edit__logo"],["routerLink","/results/modules",1,"edit__logo"],["app-button","","data-test","saveBookmark","buttonType","primary","buttonSize","sm",3,"click","disabled"],[1,"flex","items-center","justify-center",3,"ngSwitch"],["class","text-nowrap",4,"ngSwitchCase"],["app-button","","buttonType","primary","buttonSize","sm","buttonShape","square","data-test","saveBookmarkMenu",2,"flex","0 0 40px",3,"matMenuTriggerFor","disabled"],["icon","caret-down"],[1,"text-nowrap"],["render","block","size","small","class","mr-1 theme-dark",4,"ngIf"],["render","block","size","small",1,"mr-1","theme-dark"],["app-button","","data-test","saveModuleTrigger","buttonType","primary","buttonSize","sm","compact","true",1,"grow",3,"click","disabled"],["app-button","","buttonType","primary","buttonSize","sm","buttonShape","square",3,"matMenuTriggerFor","disabled"],[1,"absolute","pointer-events-none",2,"z-index","2",3,"color"],["app-button","","buttonSize","sm","buttonShape","square","data-test","enableStatsTool",3,"click","matTooltip"],["icon","memory"],[1,"edit__watermark"],[1,"pointer-events-none","edit__animation"],[1,"pointer-events-auto",2,"width","400px"],[1,"edit__timeline-options"],["app-button","","matTooltip","Zoom options",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["app-button","",3,"matTooltip","disabled","click",4,"ngIf"],["app-button","","matTooltip","Zoom options",3,"matMenuTriggerFor"],["icon","angle-down"],["app-button","",3,"click","matTooltip","disabled"],["size","medium",4,"ngIf","ngIfElse"],["size","medium"],[1,"edit__timeline",3,"manifestsMaxTimes"],[1,"edit__timeline-map"],["mat-menu-item","","data-test","publishBookmark",3,"click","disabled"],["mat-menu-item","","data-test","upgradeSubscriptionButton",3,"click"],[3,"count"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",8),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.j41(4,"div",9),e.DNE(5,yg,1,0,"a",10)(6,kg,1,0,"a",11),e.j41(7,"div",12),e.nI1(8,"async"),e.nI1(9,"textNormalize"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleStoryTitleClick())}),e.j41(10,"span",13),e.EFF(11),e.nI1(12,"async"),e.nI1(13,"textNormalize"),e.k0s(),e.j41(14,"div",14),e.nrm(15,"app-icon",15),e.k0s()()(),e.j41(16,"div",16),e.nrm(17,"app-help-menu",17),e.j41(18,"button",18),e.nI1(19,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.preview("modal"))}),e.EFF(20," Preview "),e.k0s(),e.DNE(21,Eg,9,9,"app-button-group",19)(22,wg,7,7,"app-button-group",20)(23,Fg,1,0,"app-edit-exit",21),e.k0s(),e.j41(24,"div",22),e.nI1(25,"async"),e.DNE(26,Rg,1,0,"app-navigation-context-compact",23)(27,Pg,1,0,"app-navigation-context",24),e.k0s(),e.j41(28,"div",25)(29,"div",26)(30,"div",27)(31,"button",28),e.nI1(32,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Select))}),e.nrm(33,"app-icon",29),e.k0s(),e.j41(34,"button",30),e.nI1(35,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Hide))}),e.nrm(36,"app-icon",29),e.k0s(),e.j41(37,"button",31),e.nI1(38,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Paint))}),e.nrm(39,"app-icon",29),e.k0s(),e.j41(40,"button",32),e.nI1(41,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Label))}),e.nrm(42,"app-icon",29),e.k0s()(),e.j41(43,"div",27)(44,"button",33),e.nI1(45,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Positions))}),e.nrm(46,"app-icon",29),e.k0s(),e.j41(47,"div",34),e.DNE(48,jg,1,1,"app-status",35),e.j41(49,"button",36),e.nI1(50,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Quiz))}),e.nrm(51,"app-icon",29),e.k0s()(),e.j41(52,"button",37),e.nI1(53,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Image))}),e.nrm(54,"app-icon",29),e.k0s()(),e.j41(55,"div",27)(56,"button",38,0),e.nI1(58,"async"),e.nI1(59,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Dimensions))}),e.nrm(60,"app-icon",29),e.k0s(),e.j41(61,"button",39,1),e.nI1(63,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSelectTool(n.toolEnum.Background))}),e.j41(64,"div",40),e.nrm(65,"app-swatch-item",41),e.nI1(66,"async"),e.k0s()()(),e.DNE(67,Mg,4,3,"div",42),e.k0s(),e.j41(68,"div",43)(69,"button",44),e.nI1(70,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleUndoClick())}),e.nrm(71,"app-icon",45),e.k0s(),e.j41(72,"button",46),e.nI1(73,"async"),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleRedoClick())}),e.nrm(74,"app-icon",47),e.k0s()()(),e.j41(75,"div",48,2),e.nrm(77,"app-engine")(78,"app-engine-camera-bar",49),e.DNE(79,Ig,2,0,"img",50),e.nI1(80,"async"),e.k0s(),e.j41(81,"div",51),e.nI1(82,"async"),e.DNE(83,Ng,1,0,"app-edit-document-context",23)(84,Bg,1,0,"app-edit-label-context",23)(85,Dg,1,0,"app-edit-paint-context",23)(86,Gg,1,0,"app-edit-quiz-context",23)(87,$g,1,0,"app-edit-image-context",23)(88,Og,1,0,"app-edit-positions-context",23),e.k0s(),e.j41(89,"div",52),e.DNE(90,Ag,1,0,"app-edit-chapter-pagination",53),e.nI1(91,"async"),e.k0s(),e.j41(92,"div",54)(93,"div",55),e.nI1(94,"async"),e.nrm(95,"app-engine-breadcrumb"),e.k0s(),e.DNE(96,Ug,2,0,"div",56)(97,Qg,10,15,"div",57),e.k0s(),e.j41(98,"div",58),e.DNE(99,qg,2,3,"app-edit-timeline",59),e.nI1(100,"async"),e.DNE(101,Hg,1,0,"app-edit-timeline-maps",60),e.nI1(102,"async"),e.k0s()(),e.j41(103,"mat-menu",null,3)(105,"button",61),e.bIt("click",function(){return e.eBV(o),e.Njj(n.exportWrittenContent())}),e.EFF(106,"Export Text"),e.k0s(),e.DNE(107,Wg,3,0,"ng-container",53),e.nI1(108,"async"),e.nrm(109,"mat-divider"),e.DNE(110,Jg,3,3,"button",62)(111,Kg,2,0,"button",63),e.nrm(112,"mat-divider"),e.j41(113,"button",64),e.bIt("click",function(){return e.eBV(o),e.Njj(n.handleSaveBookmark())}),e.EFF(114," Save "),e.k0s(),e.j41(115,"button",65),e.bIt("click",function(){return e.eBV(o),e.Njj(n.saveBookmarkAs())}),e.EFF(116," Save as ... "),e.k0s()(),e.j41(117,"mat-menu",null,4)(119,"button",61),e.bIt("click",function(){return e.eBV(o),e.Njj(n.openInSceneEditor())}),e.EFF(120,"Open in Scene Editor..."),e.k0s(),e.j41(121,"button",61),e.bIt("click",function(){return e.eBV(o),e.Njj(n.openInViewer())}),e.EFF(122,"Open in QA Viewer..."),e.k0s(),e.nrm(123,"mat-divider"),e.j41(124,"button",61),e.bIt("click",function(){return e.eBV(o),e.Njj(n.exportWrittenContent())}),e.EFF(125,"Export Text"),e.k0s(),e.DNE(126,Zg,2,0,"button",66),e.nI1(127,"async"),e.j41(128,"button",61),e.bIt("click",function(){return e.eBV(o),e.Njj(n.mergeModule())}),e.EFF(129,"Merge Module"),e.k0s()(),e.DNE(130,eb,1,1,"app-edit-reload-countdown",67)}if(2&t){let o,a;e.Y8G("ngClass",e.sMw(124,_g,e.bMT(1,64,n.showTimelineEditor$),!e.bMT(2,66,n.allChaptersReady$),e.bMT(3,68,n.leftColumnCollapsed$))),e.R7$(5),e.Y8G("appFlagApplication",n.environmentApplication.Studio),e.R7$(),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(),e.Y8G("title",e.bMT(9,72,null==(o=e.bMT(8,70,n.selectedBookmark$))?null:o.title)),e.R7$(4),e.JRh(e.bMT(13,76,null==(a=e.bMT(12,74,n.selectedBookmark$))?null:a.title)),e.R7$(7),e.Y8G("disabled",n.atBookmarkLimit||e.bMT(19,78,n.saving$)),e.R7$(5),e.Y8G("appFlagApplication",n.application.Studio),e.R7$(),e.Y8G("ngSwitch",e.bMT(25,80,n.leftColumnCollapsed$)),e.R7$(2),e.Y8G("ngSwitchCase",!0),e.R7$(5),e.Y8G("buttonType",e.bMT(32,82,n.activeTool$)===n.toolEnum.Select?"info":"default")("matTooltip",n.toolEnum.Select),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Select]),e.R7$(),e.Y8G("buttonType",e.bMT(35,84,n.activeTool$)===n.toolEnum.Hide?"info":"default")("matTooltip",n.toolEnum.Hide),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Hide]),e.R7$(),e.Y8G("buttonType",e.bMT(38,86,n.activeTool$)===n.toolEnum.Paint?"info":"default")("matTooltip",n.toolEnum.Paint),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Paint]),e.R7$(),e.Y8G("buttonType",e.bMT(41,88,n.activeTool$)===n.toolEnum.Label?"info":"default")("matTooltip",n.toolEnum.Label),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Label]),e.R7$(2),e.Y8G("buttonType",e.bMT(45,90,n.activeTool$)===n.toolEnum.Positions?"info":"default")("matTooltip",n.toolEnum.Positions),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Positions]),e.R7$(2),e.Y8G("ngIf",n.quizHasQuestions),e.R7$(),e.Y8G("buttonType",e.bMT(50,92,n.activeTool$)===n.toolEnum.Quiz?"info":"default")("matTooltip",n.toolEnum.Quiz),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Quiz]),e.R7$(),e.Y8G("buttonType",e.bMT(53,94,n.activeTool$)===n.toolEnum.Image?"info":"default")("matTooltip",n.toolEnum.Image),e.R7$(2),e.Y8G("icon",n.toolIcons[n.toolEnum.Image]),e.R7$(2),e.Y8G("buttonType",e.bMT(58,96,n.activeTool$)===n.toolEnum.Dimensions?"info":"default")("disabled",e.bMT(59,98,n.activeTool$)===n.toolEnum.Image)("matTooltip",n.canvasSizeTooltip),e.R7$(4),e.Y8G("icon",n.toolIcons[n.toolEnum.Dimensions]),e.R7$(),e.Y8G("buttonType",e.bMT(63,100,n.activeTool$)===n.toolEnum.Background?"info":"default")("matTooltip",n.toolEnum.Background),e.R7$(4),e.Y8G("color",e.bMT(66,102,n.background$))("size","small"),e.R7$(2),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(2),e.Y8G("disabled",!e.bMT(70,104,n.canUndo$)),e.R7$(2),e.Y8G("custom",!0),e.R7$(),e.Y8G("disabled",!e.bMT(73,106,n.canRedo$)),e.R7$(2),e.Y8G("custom",!0),e.R7$(5),e.Y8G("ngIf",e.bMT(80,108,n.activeTool$)===n.toolEnum.Image),e.R7$(2),e.Y8G("ngSwitch",e.bMT(82,110,n.view$)),e.R7$(2),e.Y8G("ngSwitchCase",n.editViewEnum.Chapter),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Label),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Paint),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Quiz),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Image),e.R7$(),e.Y8G("ngSwitchCase",n.editViewEnum.Positions),e.R7$(2),e.Y8G("ngIf",e.bMT(91,112,n.allChaptersReady$)),e.R7$(3),e.Y8G("ngClass",e.eq3(128,vg,!e.bMT(94,114,n.hoveredNode$))),e.R7$(3),e.Y8G("ngIf",n.isAnimated),e.R7$(),e.Y8G("appFlagApplication",n.environmentApplication.Loft),e.R7$(2),e.Y8G("ngIf",e.bMT(100,116,n.showTimelineEditor$)),e.R7$(2),e.Y8G("ngIf",e.bMT(102,118,n.showTimelineEditor$)),e.R7$(6),e.Y8G("ngIf",e.bMT(108,120,n.questionTotal$)>0),e.R7$(4),e.Y8G("ngIf",n.atBookmarkLimit),e.R7$(2),e.Y8G("disabled",n.atBookmarkLimit),e.R7$(2),e.Y8G("disabled",n.atBookmarkLimit),e.R7$(11),e.Y8G("ngIf",e.bMT(127,122,n.questionTotal$)>0),e.R7$(4),e.Y8G("ngIf",n.showReloadBlocker)}},dependencies:[w.YU,w.Sq,w.bT,w.ux,w.e1,w.fG,b.Wk,Ic._,Nc.k,Xt,qi,D.kk,D.fb,D.Cp,Ce.oV,Je.q,Y.Q,gi,Vi.Y,bs,_s.n,qc.E,X.R,ci.tI,Hs,ia,Nt,Qt,xm,Xm,mt,Jt,ut,Oh,We,Cn,gt,Bi,mg,w.Jj,ug],styles:['@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.edit[_ngcontent-%COMP%]{min-width:1140px;min-height:632px;width:100vw;height:100vh;overflow-y:hidden;overflow-x:auto;position:relative;background:#131c2a;color:#fff;display:grid;grid-template-areas:"header-left header-left header-right" "scene-left header-bar scene-right" "scene-left scene scene-right" "footer-left footer-bar footer-right" "edit-timeline edit-timeline edit-timeline";grid-template-columns:320px auto 280px;grid-template-rows:48px 48px 1fr 56px 0}.edit--left-collapsed[_ngcontent-%COMP%]{grid-template-columns:144px auto auto 280px;grid-template-areas:"header-left header-left header-left header-right" "scene-left header-bar header-bar scene-right" "scene-left scene scene scene-right" "footer-left footer-bar footer-bar footer-right" "edit-timeline edit-timeline edit-timeline edit-timeline"}.edit--show-timeline-editor[_ngcontent-%COMP%]{grid-template-rows:48px 48px 1fr 56px 388px}.edit--show-timeline-editor[_ngcontent-%COMP%]   .edit__timeline-bar[_ngcontent-%COMP%]{display:flex}.edit--loading[_ngcontent-%COMP%]   .edit__timeline-bar[_ngcontent-%COMP%]{opacity:.2;pointer-events:none}.edit__logo[_ngcontent-%COMP%]{background:#131c2a url(/assets/images/logo-white.svg) center center no-repeat;background-size:32px;border-right:1px solid #1c2a3f;border-bottom:1px solid #283853;grid-area:logo;width:48px;height:48px;transition:background-color .25s}.edit__logo[_ngcontent-%COMP%]:hover{background-color:#de3535}.edit__title[_ngcontent-%COMP%]{align-items:center;cursor:pointer;color:#d7e0ea;height:100%;padding-left:12px;letter-spacing:1px;font-weight:300;min-width:272px;max-width:calc(100vw - 308px);display:flex;justify-content:space-between;font-size:1rem;line-height:1.5rem}.edit__title[_ngcontent-%COMP%]:hover{color:#fff}.edit__title[_ngcontent-%COMP%]:hover   .edit__title-icon[_ngcontent-%COMP%]{visibility:visible;color:#fff}.edit__title-text[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding-right:12px}.edit__title-icon[_ngcontent-%COMP%]{visibility:hidden;color:#d7e0ea;font-size:12px}.edit__watermark[_ngcontent-%COMP%]{position:fixed;z-index:10}.edit__camera-bar[_ngcontent-%COMP%]{position:absolute;right:4px;bottom:4px;z-index:10}.edit__header-left[_ngcontent-%COMP%]{background:#131c2a;border-bottom:1px solid #283853;display:flex;align-items:center;justify-content:flex-start;grid-area:header-left}.edit__header-center[_ngcontent-%COMP%]{background:#131c2a;border-bottom:1px solid #283853;grid-area:header-center}.edit__header-bar[_ngcontent-%COMP%]{background:#131c2a;border-left:1px solid #283853;border-right:1px solid #283853;display:flex;flex-direction:row;justify-content:space-between;grid-area:header-bar}.edit__header-right[_ngcontent-%COMP%]{background:#131c2a;align-items:center;justify-content:flex-end;grid-area:header-right;border-bottom:1px solid #283853;display:flex;gap:8px;margin-right:12px}.edit__pagination[_ngcontent-%COMP%]{grid-area:pagination;display:flex;border-left:1px solid #1c2a3f;padding-left:8px}.edit__scene-left[_ngcontent-%COMP%]{background:#131c2a;grid-area:scene-left;min-height:0;overflow-y:hidden}.edit__scene[_ngcontent-%COMP%]{box-shadow:0 0 0 4px #fff;margin:4px;background:#f9fafd;grid-area:scene;position:relative}.edit__scene-right[_ngcontent-%COMP%]{background:#131c2a;grid-area:scene-right;min-height:0;overflow-y:auto}.edit__footer-left[_ngcontent-%COMP%]{background-color:#131c2a;grid-area:footer-left;z-index:20}.edit__footer-right[_ngcontent-%COMP%]{background-color:#131c2a;display:flex;align-items:center;padding:0 8px;justify-content:space-between;grid-area:footer-right;z-index:20}.edit__footer-bar[_ngcontent-%COMP%]{background-color:#131c2a;border-top:1px solid #283853;grid-area:footer-bar;position:relative;display:flex;align-items:center;overflow-x:auto;white-space:nowrap;z-index:20}.edit__timeline-bar[_ngcontent-%COMP%]{background-color:#131c2a;border-top:1px solid #283853;grid-area:edit-timeline;display:none;z-index:20}.edit__timeline[_ngcontent-%COMP%]{display:flex;flex-grow:1}.edit__timeline-map[_ngcontent-%COMP%]{width:280px;flex-shrink:0;border-left:1px solid #283853}.edit__page-actions[_ngcontent-%COMP%]{display:flex;flex:1 1 33%;padding-right:12px;justify-content:flex-end}.edit__page-actions--hidden[_ngcontent-%COMP%]{display:none}.edit__breadcrumb[_ngcontent-%COMP%]{background:#131c2a;padding:8px 0 0;position:absolute;width:100%;height:100%;z-index:2}.edit__breadcrumb[_ngcontent-%COMP%]:after, .edit__breadcrumb[_ngcontent-%COMP%]:before{content:" ";background-color:#131c2a;bottom:0;box-shadow:0 0 16px 4px #131c2a;position:absolute;right:0;top:0;width:4px}.edit__breadcrumb--hide[_ngcontent-%COMP%]{display:none}.edit__progress[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;z-index:3}.edit__animation[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:center;width:100%;z-index:1}.edit__toolbar-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;padding:0 16px}.edit__toolbar-group[_ngcontent-%COMP%]:not(:last-child){border-right:1px solid #283853}.edit__toolbar-group[_ngcontent-%COMP%]:first-child{margin-left:0;border-left:0}.edit__toolbar-group--compact[_ngcontent-%COMP%]{gap:4px;padding:0 8px}.edit__timeline-options[_ngcontent-%COMP%]{display:flex;position:absolute;justify-content:flex-end;width:100%;z-index:0}'],changeDetection:0})}ne([(0,l.l6)(k.W.getTheme),oe("design:type",_.c)],J.prototype,"theme$",void 0),ne([(0,l.l6)(g.getView),oe("design:type",_.c)],J.prototype,"view$",void 0),ne([(0,l.l6)(S.S.getActiveTool),oe("design:type",_.c)],J.prototype,"activeTool$",void 0),ne([(0,l.l6)(g.getLeftColumnCollapsed),oe("design:type",_.c)],J.prototype,"leftColumnCollapsed$",void 0),ne([(0,l.l6)(g.getShowTimelineEditor),oe("design:type",_.c)],J.prototype,"showTimelineEditor$",void 0),ne([(0,l.l6)(g.getRecord),oe("design:type",_.c)],J.prototype,"record$",void 0),ne([(0,l.l6)(g.getCanvasSize),oe("design:type",_.c)],J.prototype,"canvasSize$",void 0),ne([(0,l.l6)(Bs.o.canUndo),oe("design:type",_.c)],J.prototype,"canUndo$",void 0),ne([(0,l.l6)(Bs.o.canRedo),oe("design:type",_.c)],J.prototype,"canRedo$",void 0),ne([(0,l.l6)(S.S.getReady),oe("design:type",_.c)],J.prototype,"engineReady$",void 0),ne([(0,l.l6)(S.S.getChapter),oe("design:type",_.c)],J.prototype,"engineChapterId$",void 0),ne([(0,l.l6)(ye.z.getNodes),oe("design:type",_.c)],J.prototype,"nodes$",void 0),ne([(0,l.l6)(S.S.getHoveredNode),oe("design:type",_.c)],J.prototype,"hoveredNode$",void 0),ne([(0,l.l6)(S.S.getViewGraph),oe("design:type",_.c)],J.prototype,"viewGraph$",void 0),ne([(0,l.l6)(S.S.getAnimationPlaying),oe("design:type",_.c)],J.prototype,"animationPlaying$",void 0),ne([(0,l.l6)(Ol.N.getStoryLoadProgress),oe("design:type",_.c)],J.prototype,"loadProgress$",void 0),ne([(0,l.l6)(E.t.getStory),oe("design:type",_.c)],J.prototype,"story$",void 0),ne([(0,l.l6)(E.t.getIncomingStoryInfo),oe("design:type",_.c)],J.prototype,"incoming$",void 0),ne([(0,l.l6)($e.y.getLabels),oe("design:type",_.c)],J.prototype,"labels$",void 0),ne([(0,l.l6)($e.y.getSelectedLabel),oe("design:type",_.c)],J.prototype,"selectedLabel$",void 0),ne([(0,l.l6)(j.N.getChaptersLoaded),oe("design:type",_.c)],J.prototype,"chaptersLoaded$",void 0),ne([(0,l.l6)(j.N.getAllChaptersModelsReady),oe("design:type",_.c)],J.prototype,"allChaptersReady$",void 0),ne([(0,l.l6)(j.N.getSelectedChapterId),oe("design:type",_.c)],J.prototype,"selectedChapterId$",void 0),ne([(0,l.l6)(je.J.getSelectedBookmark),oe("design:type",_.c)],J.prototype,"selectedBookmark$",void 0),ne([(0,l.l6)(je.J.getSelectedBookmarkViewMode),oe("design:type",_.c)],J.prototype,"selectedBookmarkViewMode$",void 0),ne([(0,l.l6)(j.N.getSelectedChapterReadyState),oe("design:type",_.c)],J.prototype,"chapterReadyState$",void 0),ne([(0,l.l6)(je.J.getSaving),oe("design:type",_.c)],J.prototype,"saving$",void 0),ne([(0,l.l6)(he.j.getQuestionTotal),oe("design:type",_.c)],J.prototype,"questionTotal$",void 0),ne([(0,l.l6)(Oe.k.getUserProfile),oe("design:type",_.c)],J.prototype,"userProfile$",void 0),ne([(0,l.l6)(Te.getScale),oe("design:type",_.c)],J.prototype,"timelineScale$",void 0),ne([(0,l.l6)(E.t.getAnimationManifests),oe("design:type",_.c)],J.prototype,"manifestsMaxTimes$",void 0),ne([(0,l.l6)(j.N.getSelectedChapterBackground),oe("design:type",_.c)],J.prototype,"background$",void 0),ne([(0,l.l6)(he.j.getAllQuestions),oe("design:type",_.c)],J.prototype,"allQuestions$",void 0),ne([(0,l.l6)(he.j.getQuizEnabled),oe("design:type",_.c)],J.prototype,"quizEnabled$",void 0),ne([(0,l.l6)(je.J.getSelectedBookmarkViewMode),oe("design:type",_.c)],J.prototype,"bookmarkViewMode$",void 0),ne([(0,l.l6)(S.S.getEnginePosition),oe("design:type",_.c)],J.prototype,"enginePosition$",void 0),ne([(0,l.l6)(Rc.X.getViewLogoConfig),oe("design:type",_.c)],J.prototype,"logoConfig$",void 0),ne([(0,l.l6)(S.S.getStatsEnabled),oe("design:type",_.c)],J.prototype,"statsEnabled$",void 0);var tb=v(20736),ib=v(85446),nb=v(63665);let $a=(()=>{class s{constructor(){}canDeactivate(t){return!!t.canDeactivate&&t.canDeactivate()}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var ob=v(22083),sb=v(70737),ab=v(30234);let rb=(()=>{class s{constructor(t,n,o,a){this.store=t,this.router=n,this.snackbar=o,this.userAccessService=a}canActivate(){return this.store.select(Oe.k.getUserRole).pipe((0,I.p)(n=>!(0,R.isNil)(n)),(0,be.s)(1),(0,De.c)(0),(0,ve.T)(n=>this.canEdit(n)))}canEdit(t){if(!An._m(t,sb.y.EditBookmarks))return this.snackbar.open("You do not have access to edit this bookmark."),this.router.navigate(["/results/bookmarks"]),!1;const o=this.store.selectSnapshot(Li.q.getOrganizationAddOns);if(!An.dl(o)){const a=`${location.pathname}${location.search}`,r=/^\/edit/;return this.userAccessService.openExternalAccountEditGate(ab.a.WoltersKluwer).pipe((0,be.s)(1)).subscribe(()=>{r.test(a)&&this.router.navigate(["/results/modules"])}),!1}return!0}static#e=this.\u0275fac=function(n){return new(n||s)(e.KVO(l.il),e.KVO(b.Ix),e.KVO(Qe.UG),e.KVO(ko.p))};static#t=this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const lb=[{path:"",component:tb.m,canActivate:[ib.q,nb.Y,rb],data:{siteHeaderType:ob.D.Hide,fixedHeight:!0,title:Fe.c.application},children:[{path:"new",pathMatch:"full",component:J,canDeactivate:[$a]},{component:J,path:"**",canDeactivate:[$a]}]}];let Oa=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[b.iI.forChild(lb),b.iI]})}return s})();var cb=v(16515),pb=v(10381),db=v(45367),mb=v(36569),ub=v(28107),hb=v(40430),fb=v(27800),gb=v(42887),bb=v(59162),_b=v(24184),vb=v(39685),Cb=v(27878),Aa=v(13403),yb=v(42617),Ua=v(8377);let kb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD,Vt.G,ui.G,c.X1,Ua.l]})}return s})();var Tb=v(66598);let Sb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD,Vt.G,ui.G,c.X1,Ai.YG,Yi.D,Tb.S,te.ad]})}return s})(),xb=(()=>{class s{constructor(t){this.controlContainer=t,this.theme=(0,e.hFB)(wa.P.Light)}static#e=this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ZU))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["app-edit-cta-block"]],inputs:{theme:[1,"theme"]},standalone:!0,features:[e.aNF],decls:11,vars:4,consts:[[3,"formGroup"],["label","CTA Action",3,"theme"],["formControlName","action",1,"input"],["value","link"],["value","ar-link"],["label","CTA Label",3,"theme"],["type","text","formControlName","label",1,"input"],["label","CTA URL",3,"theme"],["type","url","formControlName","url",1,"input"]],template:function(n,o){1&n&&(e.qex(0,0),e.j41(1,"app-form-field",1)(2,"select",2)(3,"option",3),e.EFF(4,"Link"),e.k0s(),e.j41(5,"option",4),e.EFF(6,"AR Link"),e.k0s()()(),e.j41(7,"app-form-field",5),e.nrm(8,"input",6),e.k0s(),e.j41(9,"app-form-field",7),e.nrm(10,"input",8),e.k0s(),e.bVm()),2&n&&(e.Y8G("formGroup",o.controlContainer.control),e.R7$(),e.Y8G("theme",o.theme()),e.R7$(6),e.Y8G("theme",o.theme()),e.R7$(2),e.Y8G("theme",o.theme()))},dependencies:[c.YN,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.X1,c.j4,c.JD,Yi.D,Z.K],styles:[".edit-block[_ngcontent-%COMP%]{background:#f9fafd;padding:8px;margin-bottom:8px;display:flex}.edit-block__handle[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__handle[_ngcontent-%COMP%]:hover{cursor:grab}.edit-block__actions[_ngcontent-%COMP%]{align-items:flex-start;flex:0 0 40px;display:flex;justify-content:center}.edit-block__body[_ngcontent-%COMP%]{flex:1 0 auto}.edit-block__alt[_ngcontent-%COMP%]{resize:vertical}"],changeDetection:0})}return s})(),Eb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD,c.X1,Yi.D,Rs.o,Aa.j,te.ad,To,Ps.C,Vt.G,ui.G,xb]})}return s})(),wb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD,Vt.G,ui.G,c.X1,Ua.l]})}return s})(),Fb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[w.MD]})}return s})();var Rb=v(18824);let Pb=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[l.rK.forFeature([g,L.i,Te]),Sb,w.MD,Ai.YG,db.P,Oa,c.X1,c.YN,cb.x,Vt.G,ui.G,pb.k,mb.q,ub.R,hb.i,gb.x,bb.M,fb.I,Fb,To,Gn.y2.forChild(),_b.C,vb.y,Aa.j,Cb.wR,yb.c,kb,wb,Eb,Rb.j,Ms,Oa]})}return s})()},91163:function(En,Gi,v){var w;"classList"in document.createElement("_")||function(b){"use strict";if("Element"in b){var A="classList",e="prototype",d=b.Element[e],l=Object,k=String[e].trim||function(){return this.replace(/^\s+|\s+$/g,"")},f=Array[e].indexOf||function(_){for(var M=0,P=this.length;P>M;M++)if(M in this&&this[M]===_)return M;return-1},m=function(_,M){this.name=_,this.code=DOMException[_],this.message=M},u=function(_,M){if(""===M)throw new m("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(M))throw new m("INVALID_CHARACTER_ERR","String contains an invalid character");return f.call(_,M)},h=function(_){for(var M=k.call(_.getAttribute("class")||""),P=M?M.split(/\s+/):[],$=0,L=P.length;L>$;$++)this.push(P[$]);this._updateClassName=function(){_.setAttribute("class",this.toString())}},C=h[e]=[],T=function(){return new h(this)};if(m[e]=Error[e],C.item=function(_){return this[_]||null},C.contains=function(_){return-1!==u(this,_+="")},C.add=function(){var _,M=arguments,P=0,$=M.length,L=!1;do{-1===u(this,_=M[P]+"")&&(this.push(_),L=!0)}while(++P<$);L&&this._updateClassName()},C.remove=function(){var _,M,P=arguments,$=0,L=P.length,Q=!1;do{for(M=u(this,_=P[$]+"");-1!==M;)this.splice(M,1),Q=!0,M=u(this,_)}while(++$<L);Q&&this._updateClassName()},C.toggle=function(_,M){var P=this.contains(_+=""),$=P?!0!==M&&"remove":!1!==M&&"add";return $&&this[$](_),!0===M||!1===M?M:!P},C.toString=function(){return this.join(" ")},l.defineProperty){var F={get:T,enumerable:!0,configurable:!0};try{l.defineProperty(d,A,F)}catch(_){-2146823252===_.number&&(F.enumerable=!1,l.defineProperty(d,A,F))}}else l[e].__defineGetter__&&d.__defineGetter__(A,T)}}(self),function(b){"use strict";if(b.URL=b.URL||b.webkitURL,b.Blob&&b.URL)try{return void new Blob}catch{}var A=b.BlobBuilder||b.WebKitBlobBuilder||b.MozBlobBuilder||function(d){var l=function(q){return Object.prototype.toString.call(q).match(/^\[object\s(.*)\]$/)[1]},k=function(){this.data=[]},f=function(q,fe,ge){this.data=q,this.size=q.length,this.type=fe,this.encoding=ge},m=k.prototype,u=f.prototype,h=d.FileReaderSync,C=function(q){this.code=this[this.name=q]},T="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),F=T.length,_=d.URL||d.webkitURL||d,M=_.createObjectURL,P=_.revokeObjectURL,$=_,L=d.btoa,Q=d.atob,xe=d.ArrayBuffer,Be=d.Uint8Array,si=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(f.fake=u.fake=!0;F--;)C.prototype[T[F]]=F+1;return _.createObjectURL||($=d.URL=function(q){var fe,ge=document.createElementNS("http://www.w3.org/1999/xhtml","a");return ge.href=q,"origin"in ge||("data:"===ge.protocol.toLowerCase()?ge.origin=null:(fe=q.match(si),ge.origin=fe&&fe[1])),ge}),$.createObjectURL=function(q){var fe,ge=q.type;return null===ge&&(ge="application/octet-stream"),q instanceof f?(fe="data:"+ge,"base64"===q.encoding?fe+";base64,"+q.data:"URI"===q.encoding?fe+","+decodeURIComponent(q.data):L?fe+";base64,"+L(q.data):fe+","+encodeURIComponent(q.data)):M?M.call(_,q):void 0},$.revokeObjectURL=function(q){"data:"!==q.substring(0,5)&&P&&P.call(_,q)},m.append=function(q){var fe=this.data;if(Be&&(q instanceof xe||q instanceof Be)){for(var ge="",de=new Be(q),V=0,wt=de.length;wt>V;V++)ge+=String.fromCharCode(de[V]);fe.push(ge)}else if("Blob"===l(q)||"File"===l(q)){if(!h)throw new C("NOT_READABLE_ERR");var g=new h;fe.push(g.readAsBinaryString(q))}else q instanceof f?"base64"===q.encoding&&Q?fe.push(Q(q.data)):"URI"===q.encoding?fe.push(decodeURIComponent(q.data)):"raw"===q.encoding&&fe.push(q.data):("string"!=typeof q&&(q+=""),fe.push(unescape(encodeURIComponent(q))))},m.getBlob=function(q){return arguments.length||(q=null),new f(this.data.join(""),q,"raw")},m.toString=function(){return"[object BlobBuilder]"},u.slice=function(q,fe,ge){var de=arguments.length;return 3>de&&(ge=null),new f(this.data.slice(q,de>1?fe:this.data.length),ge,this.encoding)},u.toString=function(){return"[object Blob]"},u.close=function(){this.size=0,delete this.data},k}(b);b.Blob=function(d,l){var k=l&&l.type||"",f=new A;if(d)for(var m=0,u=d.length;u>m;m++)Uint8Array&&d[m]instanceof Uint8Array?f.append(d[m].buffer):f.append(d[m]);var h=f.getBlob(k);return!h.slice&&h.webkitSlice&&(h.slice=h.webkitSlice),h},b.Blob.prototype=(Object.getPrototypeOf||function(d){return d.__proto__})(new b.Blob)}(typeof self<"u"&&self||typeof window<"u"&&window||this.content||this),function(b,A){"use strict";typeof process<"u"&&process&&process.versions&&process.versions.electron?void 0!==(w=function(){return A}.call(Gi,v,Gi,En))&&(En.exports=w):En.exports=A}(0,function(){"use strict";function b(A,e){return this.init(A,e)}return b.extensions={},function(A){function e(m,u){var h,C=Array.prototype.slice.call(arguments,2);u=u||{};for(var T=0;T<C.length;T++){var F=C[T];if(F)for(h in F)F.hasOwnProperty(h)&&typeof F[h]<"u"&&(m||!1===u.hasOwnProperty(h))&&(u[h]=F[h])}return u}var d=!1;try{var l=document.createElement("div"),k=document.createTextNode(" ");l.appendChild(k),d=l.contains(k)}catch{}var f={isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),isEdge:null!==/Edge\/\d+/.exec(navigator.userAgent),isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:A.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(m){return!!(f.isMac&&m.metaKey||!f.isMac&&m.ctrlKey)},isKey:function(m,u){var h=f.getKeyCode(m);return!1===Array.isArray(u)?h===u:-1!==u.indexOf(h)},getKeyCode:function(m){var u=m.which;return null===u&&(u=null!==m.charCode?m.charCode:m.keyCode),u},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var m=[!0].concat(Array.prototype.slice.call(arguments));return e.apply(this,m)},defaults:function(){var m=[!1].concat(Array.prototype.slice.call(arguments));return e.apply(this,m)},createLink:function(m,u,h,C){var T=m.createElement("a");return f.moveTextRangeIntoElement(u[0],u[u.length-1],T),T.setAttribute("href",h),C&&("_blank"===C&&T.setAttribute("rel","noopener noreferrer"),T.setAttribute("target",C)),T},findOrCreateMatchingTextNodes:function(m,u,h){for(var C=m.createTreeWalker(u,NodeFilter.SHOW_ALL,null,!1),T=[],F=0,_=!1,M=null,P=null;null!==(M=C.nextNode());)if(!(M.nodeType>3))if(3===M.nodeType){if(!_&&h.start<F+M.nodeValue.length&&(_=!0,P=f.splitStartNodeIfNeeded(M,h.start,F)),_&&f.splitEndNodeIfNeeded(M,P,h.end,F),_&&F===h.end)break;if(_&&F>h.end+1)throw new Error("PerformLinking overshot the target!");_&&T.push(P||M),F+=M.nodeValue.length,null!==P&&(F+=P.nodeValue.length,C.nextNode()),P=null}else"img"===M.tagName.toLowerCase()&&(!_&&h.start<=F&&(_=!0),_&&T.push(M));return T},splitStartNodeIfNeeded:function(m,u,h){return u!==h?m.splitText(u-h):null},splitEndNodeIfNeeded:function(m,u,h,C){var T,F;F=h-C-(u?m.nodeValue.length:0),(T=C+m.nodeValue.length+(u?u.nodeValue.length:0)-1)>=h&&C!==T&&0!==F&&(u||m).splitText(F)},splitByBlockElements:function(m){if(3!==m.nodeType&&1!==m.nodeType)return[];var u=[],h=b.util.blockContainerElementNames.join(",");if(3===m.nodeType||0===m.querySelectorAll(h).length)return[m];for(var C=0;C<m.childNodes.length;C++){var T=m.childNodes[C];3===T.nodeType?u.push(T):1===T.nodeType&&(0===T.querySelectorAll(h).length?u.push(T):u=u.concat(b.util.splitByBlockElements(T)))}return u},findAdjacentTextNodeWithContent:function(m,u,h){var C,T=!1,F=h.createNodeIterator(m,NodeFilter.SHOW_TEXT,null,!1);for(C=F.nextNode();C;){if(C===u)T=!0;else if(T&&3===C.nodeType&&C.nodeValue&&C.nodeValue.trim().length>0)break;C=F.nextNode()}return C},findPreviousSibling:function(m){if(!m||f.isMediumEditorElement(m))return!1;for(var u=m.previousSibling;!u&&!f.isMediumEditorElement(m.parentNode);)u=(m=m.parentNode).previousSibling;return u},isDescendant:function(m,u,h){if(!m||!u)return!1;if(m===u)return!!h;if(1!==m.nodeType)return!1;if(d||3!==u.nodeType)return m.contains(u);for(var C=u.parentNode;null!==C;){if(C===m)return!0;C=C.parentNode}return!1},isElement:function(m){return!(!m||1!==m.nodeType)},throttle:function(m,u){var h,C,T,_=null,M=0,P=function(){M=Date.now(),_=null,T=m.apply(h,C),_||(h=C=null)};return u||0===u||(u=50),function(){var $=Date.now(),L=u-($-M);return h=this,C=arguments,0>=L||L>u?(_&&(clearTimeout(_),_=null),M=$,T=m.apply(h,C),_||(h=C=null)):_||(_=setTimeout(P,L)),T}},traverseUp:function(m,u){if(!m)return!1;do{if(1===m.nodeType){if(u(m))return m;if(f.isMediumEditorElement(m))return!1}m=m.parentNode}while(m);return!1},htmlEntities:function(m){return String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(m,u){var h,C,T,F,M,P,$=!1,L=["insertHTML",!1,u];if(!b.util.isEdge&&m.queryCommandSupported("insertHTML"))try{return m.execCommand.apply(m,L)}catch{}if((h=m.getSelection()).rangeCount){if(C=h.getRangeAt(0),f.isMediumEditorElement(P=C.commonAncestorContainer)&&!P.firstChild)C.selectNode(P.appendChild(m.createTextNode("")));else if(3===P.nodeType&&0===C.startOffset&&C.endOffset===P.nodeValue.length||3!==P.nodeType&&P.innerHTML===C.toString()){for(;!f.isMediumEditorElement(P)&&P.parentNode&&1===P.parentNode.childNodes.length&&!f.isMediumEditorElement(P.parentNode);)P=P.parentNode;C.selectNode(P)}for(C.deleteContents(),(T=m.createElement("div")).innerHTML=u,F=m.createDocumentFragment();T.firstChild;)M=F.appendChild(T.firstChild);C.insertNode(F),M&&((C=C.cloneRange()).setStartAfter(M),C.collapse(!0),b.selection.selectRange(m,C)),$=!0}return m.execCommand.callListeners&&m.execCommand.callListeners(L,$),$},execFormatBlock:function(m,u){var C=f.getTopBlockContainer(b.selection.getSelectionStart(m));if("blockquote"===u){if(C&&Array.prototype.slice.call(C.childNodes).some(function(T){return f.isBlockContainer(T)}))return m.execCommand("outdent",!1,null);if(f.isIE)return m.execCommand("indent",!1,u)}if(C&&u===C.nodeName.toLowerCase()&&(u="p"),f.isIE&&(u="<"+u+">"),C&&"blockquote"===C.nodeName.toLowerCase()){if(f.isIE&&"<p>"===u)return m.execCommand("outdent",!1,u);if((f.isFF||f.isEdge)&&"p"===u)return Array.prototype.slice.call(C.childNodes).some(function(T){return!f.isBlockContainer(T)})&&m.execCommand("formatBlock",!1,u),m.execCommand("outdent",!1,u)}return m.execCommand("formatBlock",!1,u)},setTargetBlank:function(m,u){var h,C=u||!1;if("a"===m.nodeName.toLowerCase())m.target="_blank",m.rel="noopener noreferrer";else for(m=m.getElementsByTagName("a"),h=0;h<m.length;h+=1)!1!==C&&C!==m[h].attributes.href.value||(m[h].target="_blank",m[h].rel="noopener noreferrer")},removeTargetBlank:function(m,u){var h;if("a"===m.nodeName.toLowerCase())m.removeAttribute("target"),m.removeAttribute("rel");else for(m=m.getElementsByTagName("a"),h=0;h<m.length;h+=1)u===m[h].attributes.href.value&&(m[h].removeAttribute("target"),m[h].removeAttribute("rel"))},addClassToAnchors:function(m,u){var h,C,T=u.split(" ");if("a"===m.nodeName.toLowerCase())for(C=0;C<T.length;C+=1)m.classList.add(T[C]);else{var F=m.getElementsByTagName("a");if(0===F.length){var _=f.getClosestTag(m,"a");m=_?[_]:[]}else m=F;for(h=0;h<m.length;h+=1)for(C=0;C<T.length;C+=1)m[h].classList.add(T[C])}},isListItem:function(m){if(!m)return!1;if("li"===m.nodeName.toLowerCase())return!0;for(var u=m.parentNode,h=u.nodeName.toLowerCase();"li"===h||!f.isBlockContainer(u)&&"div"!==h;){if("li"===h)return!0;if(!(u=u.parentNode))return!1;h=u.nodeName.toLowerCase()}return!1},cleanListDOM:function(m,u){if("li"===u.nodeName.toLowerCase()){var h=u.parentElement;"p"===h.parentElement.nodeName.toLowerCase()&&(f.unwrap(h.parentElement,m),b.selection.moveCursor(m,u.firstChild,u.firstChild.textContent.length))}},splitOffDOMTree:function(m,u,h){for(var C=u,T=null,F=!h;C!==m;){var _,M=C.parentNode,P=M.cloneNode(!1),$=F?C:M.firstChild;for(T&&(F?P.appendChild(T):_=T),T=P;$;){var L=$.nextSibling;$===C?($.hasChildNodes()?$=$.cloneNode(!1):$.parentNode.removeChild($),$.textContent&&T.appendChild($),$=F?L:null):($.parentNode.removeChild($),($.hasChildNodes()||$.textContent)&&T.appendChild($),$=L)}_&&T.appendChild(_),C=M}return T},moveTextRangeIntoElement:function(m,u,h){if(!m||!u)return!1;var C=f.findCommonRoot(m,u);if(!C)return!1;if(u===m){var T=m.parentNode,F=m.nextSibling;return T.removeChild(m),h.appendChild(m),F?T.insertBefore(h,F):T.appendChild(h),h.hasChildNodes()}for(var _,M,P,$=[],L=0;L<C.childNodes.length;L++)if(P=C.childNodes[L],_){if(f.isDescendant(P,u,!0)){M=P;break}$.push(P)}else f.isDescendant(P,m,!0)&&(_=P);var Q=M.nextSibling,xe=C.ownerDocument.createDocumentFragment();return _===m?(_.parentNode.removeChild(_),xe.appendChild(_)):xe.appendChild(f.splitOffDOMTree(_,m)),$.forEach(function(Be){Be.parentNode.removeChild(Be),xe.appendChild(Be)}),M===u?(M.parentNode.removeChild(M),xe.appendChild(M)):xe.appendChild(f.splitOffDOMTree(M,u,!0)),h.appendChild(xe),M.parentNode===C?C.insertBefore(h,M):Q?C.insertBefore(h,Q):C.appendChild(h),h.hasChildNodes()},depthOfNode:function(m){for(var u=0,h=m;null!==h.parentNode;)h=h.parentNode,u++;return u},findCommonRoot:function(m,u){for(var h=f.depthOfNode(m),C=f.depthOfNode(u),T=m,F=u;h!==C;)h>C?(T=T.parentNode,h-=1):(F=F.parentNode,C-=1);for(;T!==F;)T=T.parentNode,F=F.parentNode;return T},isElementAtBeginningOfBlock:function(m){for(var h;!f.isBlockContainer(m)&&!f.isMediumEditorElement(m);){for(h=m;h=h.previousSibling;)if((3===h.nodeType?h.nodeValue:h.textContent).length>0)return!1;m=m.parentNode}return!0},isMediumEditorElement:function(m){return m&&m.getAttribute&&!!m.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(m){return f.traverseUp(m,function(u){return f.isMediumEditorElement(u)})},isBlockContainer:function(m){return m&&3!==m.nodeType&&-1!==f.blockContainerElementNames.indexOf(m.nodeName.toLowerCase())},getClosestBlockContainer:function(m){return f.traverseUp(m,function(u){return f.isBlockContainer(u)||f.isMediumEditorElement(u)})},getTopBlockContainer:function(m){var u=!!f.isBlockContainer(m)&&m;return f.traverseUp(m,function(h){return f.isBlockContainer(h)&&(u=h),!(u||!f.isMediumEditorElement(h)||(u=h,0))}),u},getFirstSelectableLeafNode:function(m){for(;m&&m.firstChild;)m=m.firstChild;if("table"===(m=f.traverseUp(m,function(h){return-1===f.emptyElementNames.indexOf(h.nodeName.toLowerCase())})).nodeName.toLowerCase()){var u=m.querySelector("th, td");u&&(m=u)}return m},getFirstTextNode:function(m){return f.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),f._getFirstTextNode(m)},_getFirstTextNode:function(m){if(3===m.nodeType)return m;for(var u=0;u<m.childNodes.length;u++){var h=f._getFirstTextNode(m.childNodes[u]);if(null!==h)return h}return null},ensureUrlHasProtocol:function(m){return-1===m.indexOf("://")?"http://"+m:m},warn:function(){void 0!==A.console&&"function"==typeof A.console.warn&&A.console.warn.apply(A.console,arguments)},deprecated:function(m,u,h){var C=m+" is deprecated, please use "+u+" instead.";h&&(C+=" Will be removed in "+h),f.warn(C)},deprecatedMethod:function(m,u,h,C){f.deprecated(m,u,C),"function"==typeof this[u]&&this[u].apply(this,h)},cleanupAttrs:function(m,u){u.forEach(function(h){m.removeAttribute(h)})},cleanupTags:function(m,u){-1!==u.indexOf(m.nodeName.toLowerCase())&&m.parentNode.removeChild(m)},unwrapTags:function(m,u){-1!==u.indexOf(m.nodeName.toLowerCase())&&b.util.unwrap(m,document)},getClosestTag:function(m,u){return f.traverseUp(m,function(h){return h.nodeName.toLowerCase()===u.toLowerCase()})},unwrap:function(m,u){for(var h=u.createDocumentFragment(),C=Array.prototype.slice.call(m.childNodes),T=0;T<C.length;T++)h.appendChild(C[T]);h.childNodes.length?m.parentNode.replaceChild(h,m):m.parentNode.removeChild(m)},guid:function(){function m(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return m()+m()+"-"+m()+"-"+m()+"-"+m()+"-"+m()+m()+m()}};b.util=f}(window),(A=function(e){b.util.extend(this,e)}).extend=function(e){var d,l=this;d=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return l.apply(this,arguments)},b.util.extend(d,l);var k=function(){this.constructor=d};return k.prototype=l.prototype,d.prototype=new k,e&&b.util.extend(d.prototype,e),d},A.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(e){return this.base.options[e]}},["execAction","on","off","subscribe","trigger"].forEach(function(e){A.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}}),b.Extension=A,function(){function A(d){return b.util.isBlockContainer(d)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var e={findMatchingSelectionParent:function(d,l){var k,m=l.getSelection();return 0!==m.rangeCount&&(k=m.getRangeAt(0),b.util.traverseUp(k.commonAncestorContainer,d))},getSelectionElement:function(d){return this.findMatchingSelectionParent(function(l){return b.util.isMediumEditorElement(l)},d)},exportSelection:function(d,l){if(!d)return null;var k=null,f=l.getSelection();if(f.rangeCount>0){var m,u=f.getRangeAt(0),h=u.cloneRange();h.selectNodeContents(d),h.setEnd(u.startContainer,u.startOffset),k={start:m=h.toString().length,end:m+u.toString().length},this.doesRangeStartWithImages(u,l)&&(k.startsWithImage=!0);var C=this.getTrailingImageCount(d,k,u.endContainer,u.endOffset);if(C&&(k.trailingImageCount=C),0!==m){var T=this.getIndexRelativeToAdjacentEmptyBlocks(l,d,u.startContainer,u.startOffset);-1!==T&&(k.emptyBlocksIndex=T)}}return k},importSelection:function(d,l,k,f){if(d&&l){var m=k.createRange();m.setStart(l,0),m.collapse(!0);var u,h=l,C=[],T=0,F=!1,_=!1,M=0,P=!1,$=!1,L=null;for((f||d.startsWithImage||typeof d.emptyBlocksIndex<"u")&&($=!0);!P&&h;)if(h.nodeType>3)h=C.pop();else{if(3!==h.nodeType||_){if(d.trailingImageCount&&_&&("img"===h.nodeName.toLowerCase()&&M++,M===d.trailingImageCount)){for(var Q=0;h.parentNode.childNodes[Q]!==h;)Q++;m.setEnd(h.parentNode,Q+1),P=!0}if(!P&&1===h.nodeType)for(var xe=h.childNodes.length-1;xe>=0;)C.push(h.childNodes[xe]),xe-=1}else u=T+h.length,!F&&d.start>=T&&d.start<=u&&($||d.start<u?(m.setStart(h,d.start-T),F=!0):L=h),F&&d.end>=T&&d.end<=u&&(d.trailingImageCount?_=!0:(m.setEnd(h,d.end-T),P=!0)),T=u;P||(h=C.pop())}!F&&L&&(m.setStart(L,L.length),m.setEnd(L,L.length)),typeof d.emptyBlocksIndex<"u"&&(m=this.importSelectionMoveCursorPastBlocks(k,l,d.emptyBlocksIndex,m)),f&&(m=this.importSelectionMoveCursorPastAnchor(d,m)),this.selectRange(k,m)}},importSelectionMoveCursorPastAnchor:function(d,l){if(d.start===d.end&&3===l.startContainer.nodeType&&l.startOffset===l.startContainer.nodeValue.length&&b.util.traverseUp(l.startContainer,function(C){return"a"===C.nodeName.toLowerCase()})){for(var f=l.startContainer,m=l.startContainer.parentNode;null!==m&&"a"!==m.nodeName.toLowerCase();)m.childNodes[m.childNodes.length-1]!==f?m=null:(f=m,m=m.parentNode);if(null!==m&&"a"===m.nodeName.toLowerCase()){for(var u=null,h=0;null===u&&h<m.parentNode.childNodes.length;h++)m.parentNode.childNodes[h]===m&&(u=h);l.setStart(m.parentNode,u+1),l.collapse(!0)}}return l},importSelectionMoveCursorPastBlocks:function(d,l,k,f){var m,u,h=d.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,A,!1),C=f.startContainer,T=0;for(k=k||1,m=3===C.nodeType&&b.util.isBlockContainer(C.previousSibling)?C.previousSibling:b.util.getClosestBlockContainer(C);h.nextNode();)if(u){if(u=h.currentNode,++T===k||u.textContent.length>0)break}else m===h.currentNode&&(u=h.currentNode);return u||(u=m),f.setStart(b.util.getFirstSelectableLeafNode(u),0),f},getIndexRelativeToAdjacentEmptyBlocks:function(d,l,k,f){if(k.textContent.length>0&&f>0)return-1;var m=k;if(3!==m.nodeType&&(m=k.childNodes[f]),m){if(!b.util.isElementAtBeginningOfBlock(m))return-1;var u=b.util.findPreviousSibling(m);if(!u||u.nodeValue)return-1}for(var h=b.util.getClosestBlockContainer(k),C=d.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,A,!1),T=0;C.nextNode();){var F=""===C.currentNode.textContent;if((F||T>0)&&(T+=1),C.currentNode===h)return T;F||(T=0)}return T},doesRangeStartWithImages:function(d,l){if(0!==d.startOffset||1!==d.startContainer.nodeType)return!1;if("img"===d.startContainer.nodeName.toLowerCase())return!0;var k=d.startContainer.querySelector("img");if(!k)return!1;for(var f=l.createTreeWalker(d.startContainer,NodeFilter.SHOW_ALL,null,!1);f.nextNode();){var m=f.currentNode;if(m===k)break;if(m.nodeValue)return!1}return!0},getTrailingImageCount:function(d,l,k,f){if(0===f||1!==k.nodeType||"img"!==k.nodeName.toLowerCase()&&!k.querySelector("img"))return 0;for(var m=k.childNodes[f-1];m.hasChildNodes();)m=m.lastChild;for(var u,h=d,C=[],T=0,F=!1,_=!1,M=!1,P=0;!M&&h;)if(h.nodeType>3)h=C.pop();else{if(3!==h.nodeType||_){if("img"===h.nodeName.toLowerCase()&&P++,h===m)M=!0;else if(1===h.nodeType)for(var $=h.childNodes.length-1;$>=0;)C.push(h.childNodes[$]),$-=1}else P=0,u=T+h.length,!F&&l.start>=T&&l.start<=u&&(F=!0),F&&l.end>=T&&l.end<=u&&(_=!0),T=u;M||(h=C.pop())}return P},selectionContainsContent:function(d){var l=d.getSelection();if(!l||l.isCollapsed||!l.rangeCount)return!1;if(""!==l.toString().trim())return!0;var k=this.getSelectedParentElement(l.getRangeAt(0));return!(!k||!("img"===k.nodeName.toLowerCase()||1===k.nodeType&&k.querySelector("img")))},selectionInContentEditableFalse:function(d){var l,k=this.findMatchingSelectionParent(function(f){var m=f&&f.getAttribute("contenteditable");return"true"===m&&(l=!0),"#text"!==f.nodeName&&"false"===m},d);return!l&&k},getSelectionHtml:function(d){var l,k,f,m="",u=d.getSelection();if(u.rangeCount){for(f=d.createElement("div"),l=0,k=u.rangeCount;k>l;l+=1)f.appendChild(u.getRangeAt(l).cloneContents());m=f.innerHTML}return m},getCaretOffsets:function(d,l){var k,f;return l||(l=window.getSelection().getRangeAt(0)),k=l.cloneRange(),f=l.cloneRange(),k.selectNodeContents(d),k.setEnd(l.endContainer,l.endOffset),f.selectNodeContents(d),f.setStart(l.endContainer,l.endOffset),{left:k.toString().length,right:f.toString().length}},rangeSelectsSingleNode:function(d){var l=d.startContainer;return l===d.endContainer&&l.hasChildNodes()&&d.endOffset===d.startOffset+1},getSelectedParentElement:function(d){return d?this.rangeSelectsSingleNode(d)&&3!==d.startContainer.childNodes[d.startOffset].nodeType?d.startContainer.childNodes[d.startOffset]:3===d.startContainer.nodeType?d.startContainer.parentNode:d.startContainer:null},getSelectedElements:function(d){var l,k,f,m=d.getSelection();if(!m.rangeCount||m.isCollapsed||!m.getRangeAt(0).commonAncestorContainer)return[];if(3===(l=m.getRangeAt(0)).commonAncestorContainer.nodeType){for(k=[],f=l.commonAncestorContainer;f.parentNode&&1===f.parentNode.childNodes.length;)k.push(f.parentNode),f=f.parentNode;return k}return[].filter.call(l.commonAncestorContainer.getElementsByTagName("*"),function(u){return"function"!=typeof m.containsNode||m.containsNode(u,!0)})},selectNode:function(d,l){var k=l.createRange();k.selectNodeContents(d),this.selectRange(l,k)},select:function(d,l,k,f,m){var u=d.createRange();return u.setStart(l,k),f?u.setEnd(f,m):u.collapse(!0),this.selectRange(d,u),u},clearSelection:function(d,l){l?d.getSelection().collapseToStart():d.getSelection().collapseToEnd()},moveCursor:function(d,l,k){this.select(d,l,k)},getSelectionRange:function(d){var l=d.getSelection();return 0===l.rangeCount?null:l.getRangeAt(0)},selectRange:function(d,l){var k=d.getSelection();k.removeAllRanges(),k.addRange(l)},getSelectionStart:function(d){var l=d.getSelection().anchorNode;return l&&3===l.nodeType?l.parentNode:l}};b.selection=e}(),function(){function A(d,l){return!!d&&d.some(function(k){if("function"!=typeof k.getInteractionElements)return!1;var f=k.getInteractionElements();return!!f&&(Array.isArray(f)||(f=[f]),f.some(function(m){return b.util.isDescendant(m,l,!0)}))})}var e=function(d){this.base=d,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};e.prototype={InputEventOnContenteditableSupported:!b.util.isIE&&!b.util.isEdge,attachDOMEvent:function(d,l,k,f){var m=this.base.options.contentWindow,u=this.base.options.ownerDocument;d=b.util.isElement(d)||[m,u].indexOf(d)>-1?[d]:d,Array.prototype.forEach.call(d,function(h){h.addEventListener(l,k,f),this.events.push([h,l,k,f])}.bind(this))},detachDOMEvent:function(d,l,k,f){var m,u,h=this.base.options.contentWindow,C=this.base.options.ownerDocument;d&&(d=b.util.isElement(d)||[h,C].indexOf(d)>-1?[d]:d,Array.prototype.forEach.call(d,function(T){-1!==(m=this.indexOfListener(T,l,k,f))&&(u=this.events.splice(m,1)[0])[0].removeEventListener(u[1],u[2],u[3])}.bind(this)))},indexOfListener:function(d,l,k,f){var m,u,h;for(m=0,u=this.events.length;u>m;m+=1)if((h=this.events[m])[0]===d&&h[1]===l&&h[2]===k&&h[3]===f)return m;return-1},detachAllDOMEvents:function(){for(var d=this.events.pop();d;)d[0].removeEventListener(d[1],d[2],d[3]),d=this.events.pop()},detachAllEventsFromElement:function(d){for(var l=this.events.filter(function(u){return u&&u[0].getAttribute&&u[0].getAttribute("medium-editor-index")===d.getAttribute("medium-editor-index")}),k=0,f=l.length;f>k;k++){var m=l[k];this.detachDOMEvent(m[0],m[1],m[2],m[3])}},attachAllEventsToElement:function(d){this.listeners.editableInput&&(this.contentCache[d.getAttribute("medium-editor-index")]=d.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(l){this.attachDOMEvent(d,l.name,l.handler.bind(this))},this)},enableCustomEvent:function(d){void 0!==this.disabledEvents[d]&&delete this.disabledEvents[d]},disableCustomEvent:function(d){this.disabledEvents[d]=!0},attachCustomEvent:function(d,l){this.setupListener(d),this.customEvents[d]||(this.customEvents[d]=[]),this.customEvents[d].push(l)},detachCustomEvent:function(d,l){var k=this.indexOfCustomListener(d,l);-1!==k&&this.customEvents[d].splice(k,1)},indexOfCustomListener:function(d,l){return this.customEvents[d]&&this.customEvents[d].length?this.customEvents[d].indexOf(l):-1},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(d,l,k){this.customEvents[d]&&!this.disabledEvents[d]&&this.customEvents[d].forEach(function(f){f(l,k)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(d){d.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=function(d){this.handleDocumentExecCommand(d)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var d=this.options.ownerDocument;if(this.execCommandListener&&d.execCommand.listeners){var l=d.execCommand.listeners.indexOf(this.execCommandListener);-1!==l&&d.execCommand.listeners.splice(l,1),d.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var d=this.options.ownerDocument;if(!d.execCommand.listeners){var l=function(f,m){d.execCommand.listeners&&d.execCommand.listeners.forEach(function(u){u({command:f[0],value:f[2],args:f,result:m})})},k=function(){var f=d.execCommand.orig.apply(this,arguments);if(!d.execCommand.listeners)return f;var m=Array.prototype.slice.call(arguments);return l(m,f),f};k.orig=d.execCommand,k.listeners=[],k.callListeners=l,d.execCommand=k}},unwrapExecCommand:function(){var d=this.options.ownerDocument;d.execCommand.orig&&(d.execCommand=d.execCommand.orig)},setupListener:function(d){if(!this.listeners[d]){switch(d){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(l){this.contentCache[l.getAttribute("medium-editor-index")]=l.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":case"editableKeydownEnter":case"editableKeydownTab":case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[d]=!0}},attachToEachElement:function(d,l){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(k){this.attachDOMEvent(k,d,l.bind(this))},this),this.eventsCache.push({name:d,handler:l})},cleanupElement:function(d){var l=d.getAttribute("medium-editor-index");l&&(this.detachAllEventsFromElement(d),this.contentCache&&delete this.contentCache[l])},focusElement:function(d){d.focus(),this.updateFocus(d,{target:d,type:"focus"})},updateFocus:function(d,l){var k,f=this.base.getFocusedElement();f&&"click"===l.type&&this.lastMousedownTarget&&(b.util.isDescendant(f,this.lastMousedownTarget,!0)||A(this.base.extensions,this.lastMousedownTarget))&&(k=f),k||this.base.elements.some(function(u){return!k&&b.util.isDescendant(u,d,!0)&&(k=u),!!k},this);var m=!b.util.isDescendant(f,d,!0)&&!A(this.base.extensions,d);k!==f&&(f&&m&&(f.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",l,f)),k&&(k.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",l,k))),m&&this.triggerCustomEvent("externalInteraction",l)},updateInput:function(d,l){if(this.contentCache){var k=d.getAttribute("medium-editor-index"),f=d.innerHTML;f!==this.contentCache[k]&&this.triggerCustomEvent("editableInput",l,d),this.contentCache[k]=f}},handleDocumentSelectionChange:function(d){if(d.currentTarget&&d.currentTarget.activeElement){var l,k=d.currentTarget.activeElement;this.base.elements.some(function(f){return!!b.util.isDescendant(f,k,!0)&&(l=f,!0)},this),l&&this.updateInput(l,{target:k,currentTarget:l})}},handleDocumentExecCommand:function(){var d=this.base.getFocusedElement();d&&this.updateInput(d,{target:d,currentTarget:d})},handleBodyClick:function(d){this.updateFocus(d.target,d)},handleBodyFocus:function(d){this.updateFocus(d.target,d)},handleBodyMousedown:function(d){this.lastMousedownTarget=d.target},handleInput:function(d){this.updateInput(d.currentTarget,d)},handleClick:function(d){this.triggerCustomEvent("editableClick",d,d.currentTarget)},handleBlur:function(d){this.triggerCustomEvent("editableBlur",d,d.currentTarget)},handleKeypress:function(d){if(this.triggerCustomEvent("editableKeypress",d,d.currentTarget),this.keypressUpdateInput){var l={target:d.target,currentTarget:d.currentTarget};setTimeout(function(){this.updateInput(l.currentTarget,l)}.bind(this),0)}},handleKeyup:function(d){this.triggerCustomEvent("editableKeyup",d,d.currentTarget)},handleMouseover:function(d){this.triggerCustomEvent("editableMouseover",d,d.currentTarget)},handleDragging:function(d){this.triggerCustomEvent("editableDrag",d,d.currentTarget)},handleDrop:function(d){this.triggerCustomEvent("editableDrop",d,d.currentTarget)},handlePaste:function(d){this.triggerCustomEvent("editablePaste",d,d.currentTarget)},handleKeydown:function(d){return this.triggerCustomEvent("editableKeydown",d,d.currentTarget),b.util.isKey(d,b.util.keyCode.SPACE)?this.triggerCustomEvent("editableKeydownSpace",d,d.currentTarget):b.util.isKey(d,b.util.keyCode.ENTER)||d.ctrlKey&&b.util.isKey(d,b.util.keyCode.M)?this.triggerCustomEvent("editableKeydownEnter",d,d.currentTarget):b.util.isKey(d,b.util.keyCode.TAB)?this.triggerCustomEvent("editableKeydownTab",d,d.currentTarget):b.util.isKey(d,[b.util.keyCode.DELETE,b.util.keyCode.BACKSPACE])?this.triggerCustomEvent("editableKeydownDelete",d,d.currentTarget):void 0}},b.Events=e}(),function(){var A=b.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(e){A.isBuiltInButton(e)?b.Extension.call(this,this.defaults[e]):b.Extension.call(this,e)},init:function(){b.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return"function"==typeof this.action?this.action(this.base.options):this.action},getAria:function(){return"function"==typeof this.aria?this.aria(this.base.options):this.aria},getTagNames:function(){return"function"==typeof this.tagNames?this.tagNames(this.base.options):this.tagNames},createButton:function(){var e=this.document.createElement("button"),d=this.contentDefault,l=this.getAria(),k=this.getEditorOption("buttonLabels");return e.classList.add("medium-editor-action"),e.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(f){e.classList.add(f)}),e.setAttribute("data-action",this.getAction()),l&&(e.setAttribute("title",l),e.setAttribute("aria-label",l)),this.attrs&&Object.keys(this.attrs).forEach(function(f){e.setAttribute(f,this.attrs[f])},this),"fontawesome"===k&&this.contentFA&&(d=this.contentFA),e.innerHTML=d,e},handleClick:function(e){e.preventDefault(),e.stopPropagation();var d=this.getAction();d&&this.execAction(d)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var e=null;return this.useQueryState&&(e=this.base.queryCommandState(this.getAction())),e},isAlreadyApplied:function(e){var d,l,k=!1,f=this.getTagNames();return!1===this.knownState||!0===this.knownState?this.knownState:(f&&f.length>0&&(k=-1!==f.indexOf(e.nodeName.toLowerCase())),!k&&this.style&&(d=this.style.value.split("|"),l=this.window.getComputedStyle(e,null).getPropertyValue(this.style.prop),d.forEach(function(m){this.knownState||((k=-1!==l.indexOf(m))||"text-decoration"!==this.style.prop)&&(this.knownState=k)},this)),k)}});A.isBuiltInButton=function(e){return"string"==typeof e&&b.extensions.button.prototype.defaults.hasOwnProperty(e)},b.extensions.button=A}(),b.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}},function(){var A=b.extensions.button.extend({init:function(){b.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return!!this.hasForm&&this.getForm().classList.contains(this.activeClass)},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.hideToolbarDefaultActions()},setToolbarPosition:function(){var e=this.base.getExtensionByName("toolbar");e&&e.setToolbarPosition()}});b.extensions.form=A}(),function(){var A=b.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){b.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(e){e.preventDefault(),e.stopPropagation();var d=b.selection.getSelectionRange(this.document);return"a"===d.startContainer.nodeName.toLowerCase()||"a"===d.endContainer.nodeName.toLowerCase()||b.util.getClosestTag(b.selection.getSelectedParentElement(d),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(e){b.util.isKey(e,b.util.keyCode.K)&&b.util.isMetaCtrlKey(e)&&!e.shiftKey&&this.handleClick(e)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var e=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return e.push('<a href="#" class="medium-editor-toolbar-save">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),e.push('<a href="#" class="medium-editor-toolbar-close">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),e.join("")},isDisplayed:function(){return b.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){b.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(e){var d=this.getInput(),l=this.getAnchorTargetCheckbox(),k=this.getAnchorButtonCheckbox();if("string"==typeof(e=e||{value:""})&&(e={value:e}),this.base.saveSelection(),this.hideToolbarDefaultActions(),b.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),d.value=e.value,d.focus(),l&&(l.checked="_blank"===e.target),k){var f=e.buttonClass?e.buttonClass.split(" "):[];k.checked=-1!==f.indexOf(this.customClassOption)}},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},getFormOpts:function(){var e=this.getAnchorTargetCheckbox(),d=this.getAnchorButtonCheckbox(),l={value:this.getInput().value.trim()};return this.linkValidation&&(l.value=this.checkLinkFormat(l.value)),l.target="_self",e&&e.checked&&(l.target="_blank"),d&&d.checked&&(l.buttonClass=this.customClassOption),l},doFormSave:function(){var e=this.getFormOpts();this.completeFormSave(e)},completeFormSave:function(e){this.base.restoreSelection(),this.execAction(this.action,e),this.base.checkSelection()},ensureEncodedUri:function(e){return e===decodeURI(e)?encodeURI(e):e},ensureEncodedUriComponent:function(e){return e===decodeURIComponent(e)?encodeURIComponent(e):e},ensureEncodedParam:function(e){var d=e.split("="),k=d[1];return d[0]+(void 0===k?"":"="+this.ensureEncodedUriComponent(k))},ensureEncodedQuery:function(e){return e.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(e){var l=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i.test(e),k="",m=e.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),u=m[1],h=m[2],C=m[3];if(/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/.test(e))return"tel:"+e;if(!l){var T=u.split("/")[0];(T.match(/.+(\.|:).+/)||"localhost"===T)&&(k="http://")}return k+this.ensureEncodedUri(u)+(void 0===h?"":"?"+this.ensureEncodedQuery(h))+(void 0===C?"":"#"+C)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(e){var d=e.querySelector(".medium-editor-toolbar-close"),l=e.querySelector(".medium-editor-toolbar-save"),k=e.querySelector(".medium-editor-toolbar-input");this.on(e,"click",this.handleFormClick.bind(this)),this.on(k,"keyup",this.handleTextboxKeyup.bind(this)),this.on(d,"click",this.handleCloseClick.bind(this)),this.on(l,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var d=this.document.createElement("div");return d.className="medium-editor-toolbar-form",d.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),d.innerHTML=this.getTemplate(),this.attachFormEvents(d),d},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(e){return e.keyCode===b.util.keyCode.ENTER?(e.preventDefault(),void this.doFormSave()):void(e.keyCode===b.util.keyCode.ESCAPE&&(e.preventDefault(),this.doFormCancel()))},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});b.extensions.anchor=A}(),function(){var A=b.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var e=this.document.createElement("div");return e.id="medium-editor-anchor-preview-"+this.getEditorId(),e.className="medium-editor-anchor-preview",e.innerHTML=this.getTemplate(),this.on(e,"click",this.handleClick.bind(this)),e},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(e){return!(!this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&!e.getAttribute("data-disable-preview"))||(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=e.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=e.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=e,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(e){var d,l,k,f,m,u=this.window.innerWidth,h=this.anchorPreview.offsetHeight,C=(e=e||this.activeAnchor).getBoundingClientRect(),T=this.diffLeft,F=this.diffTop,_=this.getEditorOption("elementsContainer"),M=["absolute","fixed"].indexOf(window.getComputedStyle(_).getPropertyValue("position"))>-1,P={};d=this.anchorPreview.offsetWidth/2;var $=this.base.getExtensionByName("toolbar");$&&(T=$.diffLeft,F=$.diffTop),l=T-d,M?(f=_.getBoundingClientRect(),["top","left"].forEach(function(L){P[L]=C[L]-f[L]}),P.width=C.width,P.height=C.height,C=P,u=f.width,m=_.scrollTop):m=this.window.pageYOffset,k=C.left+C.width/2,m+=h+C.top+C.height-F-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(m)+"px",this.anchorPreview.style.right="initial",d>k?(this.anchorPreview.style.left=l+d+"px",this.anchorPreview.style.right="initial"):d>u-k?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=l+k+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(e){var d=this.base.getExtensionByName("anchor"),l=this.activeAnchor;d&&l&&(e.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(l){var k={value:l.attributes.href.value,target:l.getAttribute("target"),buttonClass:l.getAttribute("class")};d.showForm(k),l=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(e){var d=b.util.getClosestTag(e.target,"a");if(!1!==d){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(d.outerHTML)||/href=["']#\S+["']/.test(d.outerHTML)))return!0;var l=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&l&&l.isDisplayed&&l.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==d&&this.detachPreviewHandlers(),this.anchorToPreview=d,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))}},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;(new Date).getTime()-this.lastOver>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});b.extensions.anchorPreview=A}(),function(){function A(u){return!b.util.getClosestTag(u,"a")}var e,d,l,k,f;e=[" ","\t","\n","\r","\xa0","\u2000","\u2001","\u2002","\u2003","\u2028","\u2029"],l="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+(d="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw")+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?\xab\xbb\u201c\u201d\u2018\u2019])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+d+"))",k=new RegExp("^("+d+")$","i"),f=new RegExp(l,"gi");var m=b.Extension.extend({init:function(){b.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var u=0,h=0;h<this.window._mediumEditors.length;h++){var C=this.window._mediumEditors[h];null!==C&&void 0!==C.getExtensionByName("autoLink")&&u++}return 1===u},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(u,h){this.performLinking(h)},onKeypress:function(u){this.disableEventHandling||b.util.isKey(u,[b.util.keyCode.SPACE,b.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var h=this.base.exportSelection();this.performLinking(u.target)&&this.base.importSelection(h,!0)}catch(C){window.console&&window.console.error("Failed to perform linking",C),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(u){var h=b.util.splitByBlockElements(u),C=!1;0===h.length&&(h=[u]);for(var T=0;T<h.length;T++)C=this.removeObsoleteAutoLinkSpans(h[T])||C,C=this.performLinkingWithinElement(h[T])||C;return this.base.events.updateInput(u,{target:u,currentTarget:u}),C},removeObsoleteAutoLinkSpans:function(u){if(!u||3===u.nodeType)return!1;for(var h=u.querySelectorAll('span[data-auto-link="true"]'),C=!1,T=0;T<h.length;T++){var F=h[T].textContent;if(-1===F.indexOf("://")&&(F=b.util.ensureUrlHasProtocol(F)),h[T].getAttribute("data-href")!==F&&A(h[T])){C=!0;var _=F.replace(/\s+$/,"");if(h[T].getAttribute("data-href")===_){var P=b.util.splitOffDOMTree(h[T],this.splitTextBeforeEnd(h[T],F.length-_.length));h[T].parentNode.insertBefore(P,h[T].nextSibling)}else b.util.unwrap(h[T],this.document)}}return C},splitTextBeforeEnd:function(u,h){for(var C=this.document.createTreeWalker(u,NodeFilter.SHOW_TEXT,null,!1),T=!0;T;)T=null!==C.lastChild();for(var F,_,M;h>0&&null!==M;)(_=(F=C.currentNode).nodeValue).length>h?(M=F.splitText(_.length-h),h=0):(M=C.previousNode(),h-=_.length);return M},performLinkingWithinElement:function(u){for(var h=this.findLinkableText(u),T=0;T<h.length;T++){var F=b.util.findOrCreateMatchingTextNodes(this.document,u,h[T]);this.shouldNotLink(F)||this.createAutoLink(F,h[T].href)}return!1},shouldNotLink:function(u){for(var h=!1,C=0;C<u.length&&!1===h;C++)h=!!b.util.traverseUp(u[C],function(T){return"a"===T.nodeName.toLowerCase()||T.getAttribute&&"true"===T.getAttribute("data-auto-link")});return h},findLinkableText:function(u){for(var h=u.textContent,C=null,T=[];null!==(C=f.exec(h));){var _=C.index+C[0].length;!(0!==C.index&&-1===e.indexOf(h[C.index-1])||_!==h.length&&-1===e.indexOf(h[_]))&&(-1!==C[0].indexOf("/")||k.test(C[0].split(".").pop().split("?").shift()))&&T.push({href:C[0],start:C.index,end:_})}return T},createAutoLink:function(u,h){h=b.util.ensureUrlHasProtocol(h);var C=b.util.createLink(this.document,u,h,this.getEditorOption("targetBlank")?"_blank":null),T=this.document.createElement("span");for(T.setAttribute("data-auto-link","true"),T.setAttribute("data-href",h),C.insertBefore(T,C.firstChild);C.childNodes.length>1;)T.appendChild(C.childNodes[1])}});b.extensions.autoLink=m}(),function(){function A(l){var k=b.util.getContainerEditorElement(l);Array.prototype.slice.call(k.parentElement.querySelectorAll("."+e)).forEach(function(m){m.classList.remove(e)})}var e="medium-editor-dragover",d=b.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){b.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(l){l.preventDefault(),l.dataTransfer.dropEffect="copy";var k=l.target.classList?l.target:l.target.parentElement;A(k),"dragover"===l.type&&k.classList.add(e)},handleDrop:function(l){l.preventDefault(),l.stopPropagation(),this.base.selectElement(l.target);var k=this.base.exportSelection();k.start=k.end,this.base.importSelection(k),l.dataTransfer.files&&Array.prototype.slice.call(l.dataTransfer.files).forEach(function(f){this.isAllowedFile(f)&&f.type.match("image")&&this.insertImageFile(f)},this),A(l.target)},isAllowedFile:function(l){return this.allowedTypes.some(function(k){return!!l.type.match(k)})},insertImageFile:function(l){if("function"==typeof FileReader){var k=new FileReader;k.readAsDataURL(l),k.addEventListener("load",function(f){var m=this.document.createElement("img");m.src=f.target.result,b.util.insertHTMLCommand(this.document,m.outerHTML)}.bind(this))}}});b.extensions.fileDragging=d}(),function(){var A=b.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){b.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(e){var d=e.key.charCodeAt(0);this.keys[d]||(this.keys[d]=[]),this.keys[d].push(e)},this)},handleKeydown:function(e){var d=b.util.getKeyCode(e);if(this.keys[d]){var l=b.util.isMetaCtrlKey(e),k=!!e.shiftKey,f=!!e.altKey;this.keys[d].forEach(function(m){m.meta!==l||m.shift!==k||m.alt!==f&&void 0!==m.alt||(e.preventDefault(),e.stopPropagation(),"function"==typeof m.command?m.command.apply(this):!1!==m.command&&this.execAction(m.command))},this)}}});b.extensions.keyboardCommands=A}(),function(){var A=b.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){b.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var d=this.document.queryCommandValue("fontName")+"";this.showForm(d)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(e){var d=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),d.value=e||"",d.focus()},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var e,d=this.document,l=d.createElement("div"),k=d.createElement("select"),f=d.createElement("a"),m=d.createElement("a");l.className="medium-editor-toolbar-form",l.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(l,"click",this.handleFormClick.bind(this));for(var u=0;u<this.fonts.length;u++)(e=d.createElement("option")).innerHTML=this.fonts[u],e.value=this.fonts[u],k.appendChild(e);return k.className="medium-editor-toolbar-select",l.appendChild(k),this.on(k,"change",this.handleFontChange.bind(this)),m.setAttribute("href","#"),m.className="medium-editor-toobar-save",m.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",l.appendChild(m),this.on(m,"click",this.handleSaveClick.bind(this),!0),f.setAttribute("href","#"),f.className="medium-editor-toobar-close",f.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",l.appendChild(f),this.on(f,"click",this.handleCloseClick.bind(this)),l},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){b.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("face")&&e.removeAttribute("face")})},handleFontChange:function(){var e=this.getSelect().value;""===e?this.clearFontName():this.execAction("fontName",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});b.extensions.fontName=A}(),function(){var A=b.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){b.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var d=this.document.queryCommandValue("fontSize")+"";this.showForm(d)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(e){var d=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),d.value=e||"",d.focus()},destroy:function(){return!!this.form&&(this.form.parentNode&&this.form.parentNode.removeChild(this.form),void delete this.form)},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var e=this.document,d=e.createElement("div"),l=e.createElement("input"),k=e.createElement("a"),f=e.createElement("a");return d.className="medium-editor-toolbar-form",d.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(d,"click",this.handleFormClick.bind(this)),l.setAttribute("type","range"),l.setAttribute("min","1"),l.setAttribute("max","7"),l.className="medium-editor-toolbar-input",d.appendChild(l),this.on(l,"change",this.handleSliderChange.bind(this)),f.setAttribute("href","#"),f.className="medium-editor-toobar-save",f.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",d.appendChild(f),this.on(f,"click",this.handleSaveClick.bind(this),!0),k.setAttribute("href","#"),k.className="medium-editor-toobar-close",k.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",d.appendChild(k),this.on(k,"click",this.handleCloseClick.bind(this)),d},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){b.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("size")&&e.removeAttribute("size")})},handleSliderChange:function(){var e=this.getInput().value;"4"===e?this.clearFontSize():this.execAction("fontSize",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});b.extensions.fontSize=A}(),function(){function e(u,h,C){var T=u.clipboardData||h.clipboardData||C.dataTransfer,F={};if(!T)return F;if(T.getData){var _=T.getData("Text");_&&_.length>0&&(F["text/plain"]=_)}if(T.types)for(var M=0;M<T.types.length;M++){var P=T.types[M];F[P]=T.getData(P)}return F}var d="%ME_PASTEBIN%",l=null,k=null,f=function(u){u.stopPropagation()},m=b.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){b.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(u){this.on(u,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(u,h){this.on(h,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(u,h){if(!u.defaultPrevented){var C=e(u,this.window,this.document),T=C["text/html"],F=C["text/plain"];this.window.clipboardData&&void 0===u.clipboardData&&!T&&(T=F),(T||F)&&(u.preventDefault(),this.doPaste(T,F,h))}},doPaste:function(u,h,C){var T,F,_="";if(this.cleanPastedHTML&&u)return this.cleanPaste(u);if(h){if(this.getEditorOption("disableReturn")||C&&C.getAttribute("data-disable-return"))_=b.util.htmlEntities(h);else if((T=h.split(/[\r\n]+/g)).length>1)for(F=0;F<T.length;F+=1)""!==T[F]&&(_+="<p>"+b.util.htmlEntities(T[F])+"</p>");else _=b.util.htmlEntities(T[0]);b.util.insertHTMLCommand(this.document,_)}},handlePasteBinPaste:function(u){if(!u.defaultPrevented){var h=e(u,this.window,this.document),C=h["text/html"],T=h["text/plain"],F=k;return!this.cleanPastedHTML||C?(u.preventDefault(),this.removePasteBin(),this.doPaste(C,T,F),void this.trigger("editablePaste",{currentTarget:F,target:F},F)):void setTimeout(function(){this.cleanPastedHTML&&(C=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(C,T,F),this.trigger("editablePaste",{currentTarget:F,target:F},F)}.bind(this),0)}this.removePasteBin()},handleKeydown:function(u,h){b.util.isKey(u,b.util.keyCode.V)&&b.util.isMetaCtrlKey(u)&&(u.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(h))},createPasteBin:function(u){var h,C=b.selection.getSelectionRange(this.document),T=this.window.pageYOffset;k=u,C&&(T+=(h=C.getClientRects()).length?h[0].top:void 0!==C.startContainer.getBoundingClientRect?C.startContainer.getBoundingClientRect().top:C.getBoundingClientRect().top),l=C;var F=this.document.createElement("div");F.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),F.setAttribute("style","border: 1px red solid; position: absolute; top: "+T+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),F.setAttribute("contentEditable",!0),F.innerHTML=d,this.document.body.appendChild(F),this.on(F,"focus",f),this.on(F,"focusin",f),this.on(F,"focusout",f),F.focus(),b.selection.selectNode(F,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(F,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==l&&(b.selection.selectRange(this.document,l),l=null),null!==k&&(k=null);var u=this.getPasteBin();u&&u&&(this.off(u,"focus",f),this.off(u,"focusin",f),this.off(u,"focusout",f),this.off(u,"paste",this.boundHandlePaste),u.parentElement.removeChild(u))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var u=this.getPasteBin();if(!u||u.firstChild&&"mcepastebin"===u.firstChild.id)return!1;var h=u.innerHTML;return!(!h||h===d)&&h},cleanPaste:function(u){var h,C,T,F,_=/<p|<br|<div/.test(u),M=[].concat(this.preCleanReplacements||[],function A(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d)(((?!&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d).)*)(?:&quot;|&rdquo;|&ldquo;|"|\u201c|\u201d)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}(),this.cleanReplacements||[]);for(h=0;h<M.length;h+=1)u=u.replace(M[h][0],M[h][1]);if(!_)return this.pasteHTML(u);for((T=this.document.createElement("div")).innerHTML="<p>"+u.split("<br><br>").join("</p><p>")+"</p>",C=T.querySelectorAll("a,p,div,br"),h=0;h<C.length;h+=1)switch(F=C[h],F.innerHTML=F.innerHTML.replace(/\n/gi," "),F.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(F);break;case"br":this.filterLineBreak(F)}this.pasteHTML(T.innerHTML)},pasteHTML:function(u,h){h=b.util.defaults({},h,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var C,T,F,_,M=this.document.createDocumentFragment();for(M.appendChild(this.document.createElement("body")),(_=M.querySelector("body")).innerHTML=u,this.cleanupSpans(_),C=_.querySelectorAll("*"),F=0;F<C.length;F+=1)"a"===(T=C[F]).nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&b.util.setTargetBlank(T),b.util.cleanupAttrs(T,h.cleanAttrs),b.util.cleanupTags(T,h.cleanTags),b.util.unwrapTags(T,h.unwrapTags);b.util.insertHTMLCommand(this.document,_.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(u){return u&&("p"===u.nodeName.toLowerCase()||"div"===u.nodeName.toLowerCase())},filterCommonBlocks:function(u){/^\s*$/.test(u.textContent)&&u.parentNode&&u.parentNode.removeChild(u)},filterLineBreak:function(u){this.isCommonBlock(u.previousElementSibling)?this.removeWithParent(u):!this.isCommonBlock(u.parentNode)||u.parentNode.firstChild!==u&&u.parentNode.lastChild!==u?u.parentNode&&1===u.parentNode.childElementCount&&""===u.parentNode.textContent&&this.removeWithParent(u):this.removeWithParent(u)},removeWithParent:function(u){u&&u.parentNode&&(u.parentNode.parentNode&&1===u.parentNode.childElementCount?u.parentNode.parentNode.removeChild(u.parentNode):u.parentNode.removeChild(u))},cleanupSpans:function(u){var h,C,T,F=u.querySelectorAll(".replace-with"),_=function(M){return M&&"#text"!==M.nodeName&&"false"===M.getAttribute("contenteditable")};for(h=0;h<F.length;h+=1)(T=this.document.createElement((C=F[h]).classList.contains("bold")?"b":"i")).innerHTML=C.classList.contains("bold")&&C.classList.contains("italic")?"<i>"+C.innerHTML+"</i>":C.innerHTML,C.parentNode.replaceChild(T,C);for(F=u.querySelectorAll("span"),h=0;h<F.length;h+=1){if(b.util.traverseUp(C=F[h],_))return!1;b.util.unwrap(C,this.document)}}});b.extensions.paste=m}(),function(){var A=b.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){b.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(e,d){this.initElement(d)},initElement:function(e){e.getAttribute("data-placeholder")||e.setAttribute("data-placeholder",this.text),this.updatePlaceholder(e)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(e,d){this.cleanupElement(d)},cleanupElement:function(e){e.getAttribute("data-placeholder")===this.text&&e.removeAttribute("data-placeholder")},showPlaceholder:function(e){e&&(b.util.isFF&&0===e.childNodes.length?(e.classList.add("medium-editor-placeholder-relative"),e.classList.remove("medium-editor-placeholder")):(e.classList.add("medium-editor-placeholder"),e.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(e){e&&(e.classList.remove("medium-editor-placeholder"),e.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(e,d){return e.querySelector("img, blockquote, ul, ol, table")||""!==e.textContent.replace(/^\s+|\s+$/g,"")?this.hidePlaceholder(e):void(d||this.showPlaceholder(e))},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(e,d){var l=this.hideOnClick&&d===this.base.getFocusedElement();this.updatePlaceholder(d,l)},handleFocus:function(e,d){this.hidePlaceholder(d)},handleBlur:function(e,d){this.updatePlaceholder(d)}});b.extensions.placeholder=A}(),function(){var A=b.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){b.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(e,d){return this.base.extensions.forEach(function(l){return l!==this?e.apply(d||this,arguments):void 0},this)},createToolbar:function(){var e=this.document.createElement("div");return e.id="medium-editor-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",e.className+=this.static?" static-toolbar":this.relativeContainer?" medium-editor-relative-toolbar":" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(d){d.hasForm&&e.appendChild(d.getForm())}),this.attachEventHandlers(),e},createToolbarButtons:function(){var e,d,l,k,f,m,u=this.document.createElement("ul");return u.id="medium-editor-toolbar-actions"+this.getEditorId(),u.className="medium-editor-toolbar-actions",u.style.display="block",this.buttons.forEach(function(h){"string"==typeof h?(f=h,m=null):(f=h.name,m=h),(k=this.base.addBuiltInExtension(f,m))&&"function"==typeof k.getButton&&(d=k.getButton(this.base),e=this.document.createElement("li"),b.util.isElement(d)?e.appendChild(d):e.innerHTML=d,u.appendChild(e))},this),(l=u.querySelectorAll("button")).length>0&&(l[0].classList.add(this.firstButtonClass),l[l.length-1].classList.add(this.lastButtonClass)),u},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=b.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(e){return!(e&&e.target&&b.util.isDescendant(this.getToolbarElement(),e.target))&&void this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return"block"===this.getToolbarActionsElement().style.display},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(e){e.hasForm&&e.isDisplayed()&&e.hideForm()})},multipleBlockElementsSelected:function(){var d=new RegExp("<("+b.util.blockContainerElementNames.join("|")+")[^>]*>","g"),k=b.selection.getSelectionHtml(this.document).replace(/<[^\/>][^>]*><\/[^>]+>/gim,"").match(d);return!!k&&k.length>1},modifySelection:function(){var d=this.window.getSelection().getRangeAt(0);if(this.standardizeSelectionStart&&d.startContainer.nodeValue&&d.startOffset===d.startContainer.nodeValue.length){var l=b.util.findAdjacentTextNodeWithContent(b.selection.getSelectionElement(this.window),d.startContainer,this.document);if(l){for(var k=0;0===l.nodeValue.substr(k,1).trim().length;)k+=1;d=b.selection.select(this.document,l,k,d.endContainer,d.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||b.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var e=b.selection.getSelectionElement(this.window);return!e||-1===this.getEditorElements().indexOf(e)||e.getAttribute("data-disable-toolbar")?this.hideToolbar():this.updateOnEmptySelection&&this.static?this.showAndUpdateToolbar():!b.selection.selectionContainsContent(this.document)||!1===this.allowMultiParagraphSelection&&this.multipleBlockElementsSelected()?this.hideToolbar():void this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(e){"function"==typeof e.isActive&&"function"==typeof e.setInactive&&e.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var e,d=[],l=null,k=b.selection.getSelectionRange(this.document),f=function(m){"function"==typeof m.checkState?m.checkState(e):"function"==typeof m.isActive&&"function"==typeof m.isAlreadyApplied&&"function"==typeof m.setActive&&!m.isActive()&&m.isAlreadyApplied(e)&&m.setActive()};if(k&&(this.forEachExtension(function(m){return"function"==typeof m.queryCommandState&&null!==(l=m.queryCommandState())?void(l&&"function"==typeof m.setActive&&m.setActive()):void d.push(m)}),e=b.selection.getSelectedParentElement(k),this.getEditorElements().some(function(m){return b.util.isDescendant(m,e,!0)})))for(;e&&(d.forEach(f),!b.util.isMediumEditorElement(e));)e=e.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var e=this.base.getFocusedElement(),d=this.window.getSelection();return e?void(!this.static&&d.isCollapsed||(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(e):this.positionToolbar(d)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))):this},positionStaticToolbar:function(e){this.getToolbarElement().style.left="0";var d,l=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,k=this.window.innerWidth,f=this.getToolbarElement(),m=e.getBoundingClientRect(),u=m.top+l,h=m.left+m.width/2,C=f.offsetHeight,T=f.offsetWidth,F=T/2;switch(this.sticky?l>u+e.offsetHeight-C-this.stickyTopOffset?(f.style.top=u+e.offsetHeight-C+"px",f.classList.remove("medium-editor-sticky-toolbar")):l>u-C-this.stickyTopOffset?(f.classList.add("medium-editor-sticky-toolbar"),f.style.top=this.stickyTopOffset+"px"):(f.classList.remove("medium-editor-sticky-toolbar"),f.style.top=u-C+"px"):f.style.top=u-C+"px",this.align){case"left":d=m.left;break;case"right":d=m.right-T;break;case"center":d=h-F}0>d?d=0:d+T>k&&(d=k-Math.ceil(T)-1),f.style.left=d+"px"},positionToolbar:function(e){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var d=e.getRangeAt(0),l=d.getBoundingClientRect();(!l||0===l.height&&0===l.width&&d.startContainer===d.endContainer)&&(l=1===d.startContainer.nodeType&&d.startContainer.querySelector("img")?d.startContainer.querySelector("img").getBoundingClientRect():d.startContainer.getBoundingClientRect());var k,f,m=this.window.innerWidth,u=this.getToolbarElement(),h=u.offsetHeight,T=u.offsetWidth/2,_=this.diffLeft-T,M=this.getEditorOption("elementsContainer"),P=["absolute","fixed"].indexOf(window.getComputedStyle(M).getPropertyValue("position"))>-1,$={},L={};P?(f=M.getBoundingClientRect(),["top","left"].forEach(function(Q){L[Q]=l[Q]-f[Q]}),L.width=l.width,L.height=l.height,l=L,m=f.width,$.top=M.scrollTop):$.top=this.window.pageYOffset,k=l.left+l.width/2,$.top+=l.top-h,l.top<50?(u.classList.add("medium-toolbar-arrow-over"),u.classList.remove("medium-toolbar-arrow-under"),$.top+=50+l.height-this.diffTop):(u.classList.add("medium-toolbar-arrow-under"),u.classList.remove("medium-toolbar-arrow-over"),$.top+=this.diffTop),T>k?($.left=_+T,$.right="initial"):T>m-k?($.left="auto",$.right=0):($.left=_+k,$.right="initial"),["top","left","right"].forEach(function(Q){u.style[Q]=$[Q]+(isNaN($[Q])?"":"px")})}});b.extensions.toolbar=A}(),function(){var A=b.Extension.extend({init:function(){b.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){var d="medium-editor-dragover";e.preventDefault(),e.dataTransfer.dropEffect="copy","dragover"===e.type?e.target.classList.add(d):"dragleave"===e.type&&e.target.classList.remove(d)},handleDrop:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&Array.prototype.slice.call(e.dataTransfer.files,0).some(function(k){var f,m;k.type.match("image")&&((f=new FileReader).readAsDataURL(k),b.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+(m="medium-img-"+ +new Date)+'" />'),f.onload=function(){var u=this.document.getElementById(m);u&&(u.removeAttribute("id"),u.removeAttribute("class"),u.src=f.result)}.bind(this))}.bind(this)),e.target.classList.remove("medium-editor-dragover")}});b.extensions.imageDragging=A}(),function(){function A(g){var S=b.selection.getSelectionStart(this.options.ownerDocument),E=S.textContent,B=b.selection.getCaretOffsets(S);(void 0===E[B.left-1]||""===E[B.left-1].trim()||void 0!==E[B.left]&&""===E[B.left].trim())&&g.preventDefault()}function e(g,S){if(this.options.disableReturn||S.getAttribute("data-disable-return"))g.preventDefault();else if(this.options.disableDoubleReturn||S.getAttribute("data-disable-double-return")){var E=b.selection.getSelectionStart(this.options.ownerDocument);(E&&""===E.textContent.trim()&&"li"!==E.nodeName.toLowerCase()||E.previousElementSibling&&"br"!==E.previousElementSibling.nodeName.toLowerCase()&&""===E.previousElementSibling.textContent.trim())&&g.preventDefault()}}function d(g){var S=b.selection.getSelectionStart(this.options.ownerDocument);"pre"===(S&&S.nodeName.toLowerCase())&&(g.preventDefault(),b.util.insertHTMLCommand(this.options.ownerDocument,"    ")),b.util.isListItem(S)&&(g.preventDefault(),this.options.ownerDocument.execCommand(g.shiftKey?"outdent":"indent",!1,null))}function l(g){var S,E=b.selection.getSelectionStart(this.options.ownerDocument),B=E.nodeName.toLowerCase(),O=/^(\s+|<br\/?>)?$/i,I=/h\d/i;b.util.isKey(g,[b.util.keyCode.BACKSPACE,b.util.keyCode.ENTER])&&E.previousElementSibling&&I.test(B)&&0===b.selection.getCaretOffsets(E).left?b.util.isKey(g,b.util.keyCode.BACKSPACE)&&O.test(E.previousElementSibling.innerHTML)?(E.previousElementSibling.parentNode.removeChild(E.previousElementSibling),g.preventDefault()):!this.options.disableDoubleReturn&&b.util.isKey(g,b.util.keyCode.ENTER)&&((S=this.options.ownerDocument.createElement("p")).innerHTML="<br>",E.previousElementSibling.parentNode.insertBefore(S,E),g.preventDefault()):b.util.isKey(g,b.util.keyCode.DELETE)&&E.nextElementSibling&&E.previousElementSibling&&!I.test(B)&&O.test(E.innerHTML)&&I.test(E.nextElementSibling.nodeName.toLowerCase())?(b.selection.moveCursor(this.options.ownerDocument,E.nextElementSibling),E.previousElementSibling.parentNode.removeChild(E),g.preventDefault()):b.util.isKey(g,b.util.keyCode.BACKSPACE)&&"li"===B&&O.test(E.innerHTML)&&!E.previousElementSibling&&!E.parentElement.previousElementSibling&&E.nextElementSibling&&"li"===E.nextElementSibling.nodeName.toLowerCase()?((S=this.options.ownerDocument.createElement("p")).innerHTML="<br>",E.parentElement.parentElement.insertBefore(S,E.parentElement),b.selection.moveCursor(this.options.ownerDocument,S),E.parentElement.removeChild(E),g.preventDefault()):b.util.isKey(g,b.util.keyCode.BACKSPACE)&&!1!==b.util.getClosestTag(E,"blockquote")&&0===b.selection.getCaretOffsets(E).left?(g.preventDefault(),b.util.execFormatBlock(this.options.ownerDocument,"p")):b.util.isKey(g,b.util.keyCode.ENTER)&&!1!==b.util.getClosestTag(E,"blockquote")&&0===b.selection.getCaretOffsets(E).right?((S=this.options.ownerDocument.createElement("p")).innerHTML="<br>",E.parentElement.insertBefore(S,E.nextSibling),b.selection.moveCursor(this.options.ownerDocument,S),g.preventDefault()):b.util.isKey(g,b.util.keyCode.BACKSPACE)&&b.util.isMediumEditorElement(E.parentElement)&&!E.previousElementSibling&&E.nextElementSibling&&O.test(E.innerHTML)&&(g.preventDefault(),b.selection.moveCursor(this.options.ownerDocument,E.nextSibling),E.parentElement.removeChild(E))}function k(g){var E=b.selection.getSelectionStart(this.options.ownerDocument);E&&(b.util.isMediumEditorElement(E)&&0===E.children.length&&!b.util.isBlockContainer(E)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),!b.util.isKey(g,b.util.keyCode.ENTER)||b.util.isListItem(E)||b.util.isBlockContainer(E)||("a"===E.nodeName.toLowerCase()?this.options.ownerDocument.execCommand("unlink",!1,null):g.shiftKey||g.ctrlKey||this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}function f(g,S){var E=S.parentNode.querySelector('textarea[medium-editor-textarea-id="'+S.getAttribute("medium-editor-textarea-id")+'"]');E&&(E.value=S.innerHTML.trim())}function m(g){g._mediumEditors||(g._mediumEditors=[null]),this.id||(this.id=g._mediumEditors.length),g._mediumEditors[this.id]=this}function u(g){g._mediumEditors&&g._mediumEditors[this.id]&&(g._mediumEditors[this.id]=null)}function h(g,S,E){var B=[];if(g||(g=[]),"string"==typeof g&&(g=S.querySelectorAll(g)),b.util.isElement(g)&&(g=[g]),E)for(var O=0;O<g.length;O++){var I=g[O];!b.util.isElement(I)||I.getAttribute("data-medium-editor-element")||I.getAttribute("medium-editor-textarea-id")||B.push(I)}else B=Array.prototype.slice.apply(g);return B}function C(g){var S=g.parentNode.querySelector('textarea[medium-editor-textarea-id="'+g.getAttribute("medium-editor-textarea-id")+'"]');S&&(S.classList.remove("medium-editor-hidden"),S.removeAttribute("medium-editor-textarea-id")),g.parentNode&&g.parentNode.removeChild(g)}function F(g,S,E){return g=function T(g,S){return Object.keys(S).forEach(function(E){void 0===g[E]&&(g[E]=S[E])}),g}(g,{window:E.options.contentWindow,document:E.options.ownerDocument,base:E}),"function"==typeof g.init&&g.init(),g.name||(g.name=S),g}function _(){return!this.elements.every(function(g){return!!g.getAttribute("data-disable-toolbar")})&&!1!==this.options.toolbar}function M(){return!!_.call(this)&&!1!==this.options.anchorPreview}function P(){return!1!==this.options.placeholder}function $(){return!1!==this.options.autoLink}function L(){return!1!==this.options.imageDragging}function Q(){return!1!==this.options.keyboardCommands}function xe(){return!this.options.extensions.imageDragging}function Be(g){for(var S=this.options.ownerDocument.createElement("div"),E=Date.now(),B="medium-editor-"+E,O=g.attributes;this.options.ownerDocument.getElementById(B);)E++,B="medium-editor-"+E;S.className=g.className,S.id=B,S.innerHTML=g.value,g.setAttribute("medium-editor-textarea-id",B);for(var I=0,y=O.length;y>I;I++)S.hasAttribute(O[I].nodeName)||S.setAttribute(O[I].nodeName,O[I].value);return g.form&&this.on(g.form,"reset",function(rt){rt.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(B))}.bind(this)),g.classList.add("medium-editor-hidden"),g.parentNode.insertBefore(S,g),S}function si(g,S){if(!g.getAttribute("data-medium-editor-element")){"textarea"===g.nodeName.toLowerCase()&&(g=Be.call(this,g),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=f.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),this.options.disableEditing||g.getAttribute("data-disable-editing")||(g.setAttribute("contentEditable",!0),g.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(g.getAttribute("data-disable-return")||g.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=e.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),this.options.disableReturn||g.getAttribute("data-disable-return")||this.on(g,"keyup",k.bind(this));var E=b.util.guid();g.setAttribute("data-medium-editor-element",!0),g.classList.add("medium-editor-element"),g.setAttribute("role","textbox"),g.setAttribute("aria-multiline",!0),g.setAttribute("data-medium-editor-editor-index",S),g.setAttribute("medium-editor-index",E),wt[E]=g.innerHTML,this.events.attachAllEventsToElement(g)}return g}function q(){this.subscribe("editableKeydownTab",d.bind(this)),this.subscribe("editableKeydownDelete",l.bind(this)),this.subscribe("editableKeydownEnter",l.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",A.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=e.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function fe(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(O){"toolbar"!==O&&this.options.extensions[O]&&this.extensions.push(F(this.options.extensions[O],O,this))},this),xe.call(this)){var g=this.options.fileDragging;g||(g={},L.call(this)||(g.allowedTypes=[])),this.addBuiltInExtension("fileDragging",g)}var S={paste:!0,"anchor-preview":M.call(this),autoLink:$.call(this),keyboardCommands:Q.call(this),placeholder:P.call(this)};Object.keys(S).forEach(function(O){S[O]&&this.addBuiltInExtension(O)},this);var E=this.options.extensions.toolbar;if(!E&&_.call(this)){var B=b.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});E=new b.extensions.toolbar(B)}E&&this.extensions.push(F(E,"toolbar",this))}function ge(g,S){return S&&[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]].forEach(function(B){S.hasOwnProperty(B[0])&&void 0!==S[B[0]]&&b.util.deprecated(B[0],B[1],"v6.0.0")}),b.util.defaults({},S,g)}function de(g,S){var E;if(E=/^append-(.+)$/gi.exec(g))return b.util.execFormatBlock(this.options.ownerDocument,E[1]);if("fontSize"===g)return S.size&&b.util.deprecated(".size option for fontSize command",".value","6.0.0"),this.options.ownerDocument.execCommand("fontSize",!1,S.value||S.size);if("fontName"===g)return S.name&&b.util.deprecated(".name option for fontName command",".value","6.0.0"),this.options.ownerDocument.execCommand("fontName",!1,S.value||S.name);if("createLink"===g)return this.createLink(S);if("image"===g){var y=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,y)}if("html"===g){var rt=this.options.contentWindow.getSelection().toString().trim();return b.util.insertHTMLCommand(this.options.ownerDocument,rt)}if(/justify([A-Za-z]*)$/g.exec(g)){var ve=this.options.ownerDocument.execCommand(g,!1,null),De=b.selection.getSelectedParentElement(b.selection.getSelectionRange(this.options.ownerDocument));return De&&V.call(this,b.util.getTopBlockContainer(De)),ve}return this.options.ownerDocument.execCommand(g,!1,S&&S.value)}function V(g){if(g){var S,E=Array.prototype.slice.call(g.childNodes).filter(function(B){var O="div"===B.nodeName.toLowerCase();return O&&!S&&(S=B.style.textAlign),O});E.length&&(this.saveSelection(),E.forEach(function(B){if(B.style.textAlign===S){var O=B.lastChild;if(O){b.util.unwrap(B,this.options.ownerDocument);var I=this.options.ownerDocument.createElement("BR");O.parentNode.insertBefore(I,O.nextSibling)}}},this),g.style.textAlign=S,this.restoreSelection())}}var wt={};b.prototype={init:function(g,S){return this.options=ge.call(this,this.defaults,S),this.origElements=g,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(m.call(this,this.options.contentWindow),this.events=new b.Events(this),this.elements=[],this.addElements(this.origElements),0!==this.elements.length&&(this.isActive=!0,fe.call(this),q.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(g){"function"==typeof g.destroy&&g.destroy()},this),this.events.destroy(),this.elements.forEach(function(g){this.options.spellcheck&&(g.innerHTML=g.innerHTML),g.removeAttribute("contentEditable"),g.removeAttribute("spellcheck"),g.removeAttribute("data-medium-editor-element"),g.classList.remove("medium-editor-element"),g.removeAttribute("role"),g.removeAttribute("aria-multiline"),g.removeAttribute("medium-editor-index"),g.removeAttribute("data-medium-editor-editor-index"),g.getAttribute("medium-editor-textarea-id")&&C(g)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,u.call(this,this.options.contentWindow))},on:function(g,S,E,B){return this.events.attachDOMEvent(g,S,E,B),this},off:function(g,S,E,B){return this.events.detachDOMEvent(g,S,E,B),this},subscribe:function(g,S){return this.events.attachCustomEvent(g,S),this},unsubscribe:function(g,S){return this.events.detachCustomEvent(g,S),this},trigger:function(g,S,E){return this.events.triggerCustomEvent(g,S,E),this},delay:function(g){var S=this;return setTimeout(function(){S.isActive&&g()},this.options.delay)},serialize:function(){var g,E={},B=this.elements.length;for(g=0;B>g;g+=1)E[""!==this.elements[g].id?this.elements[g].id:"element-"+g]={value:this.elements[g].innerHTML.trim()};return E},getExtensionByName:function(g){var S;return this.extensions&&this.extensions.length&&this.extensions.some(function(E){return E.name===g&&(S=E,!0)}),S},addBuiltInExtension:function(g,S){var E,B=this.getExtensionByName(g);if(B)return B;switch(g){case"anchor":E=b.util.extend({},this.options.anchor,S),B=new b.extensions.anchor(E);break;case"anchor-preview":B=new b.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":B=new b.extensions.autoLink;break;case"fileDragging":B=new b.extensions.fileDragging(S);break;case"fontname":B=new b.extensions.fontName(this.options.fontName);break;case"fontsize":B=new b.extensions.fontSize(S);break;case"keyboardCommands":B=new b.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":B=new b.extensions.paste(this.options.paste);break;case"placeholder":B=new b.extensions.placeholder(this.options.placeholder);break;default:b.extensions.button.isBuiltInButton(g)&&(S?(E=b.util.defaults({},S,b.extensions.button.prototype.defaults[g]),B=new b.extensions.button(E)):B=new b.extensions.button(g))}return B&&this.extensions.push(F(B,g,this)),B},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var g=this.getExtensionByName("toolbar");return g&&g.checkState(),this},queryCommandState:function(g){var S,B=null;(S=/^full-(.+)$/gi.exec(g))&&(g=S[1]);try{B=this.options.ownerDocument.queryCommandState(g)}catch{B=null}return B},execAction:function(g,S){var E,B;return(E=/^full-(.+)$/gi.exec(g))?(this.saveSelection(),this.selectAllContents(),B=de.call(this,E[1],S),this.restoreSelection()):B=de.call(this,g,S),"insertunorderedlist"!==g&&"insertorderedlist"!==g||b.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),B},getSelectedParentElement:function(g){return void 0===g&&(g=this.options.contentWindow.getSelection().getRangeAt(0)),b.selection.getSelectedParentElement(g)},selectAllContents:function(){var g=b.selection.getSelectionElement(this.options.contentWindow);if(g){for(;1===g.children.length;)g=g.children[0];this.selectElement(g)}},selectElement:function(g){b.selection.selectNode(g,this.options.ownerDocument);var S=b.selection.getSelectionElement(this.options.contentWindow);S&&this.events.focusElement(S)},getFocusedElement:function(){var g;return this.elements.some(function(S){return!g&&S.getAttribute("data-medium-focused")&&(g=S),!!g},this),g},exportSelection:function(){var g=b.selection.getSelectionElement(this.options.contentWindow),S=this.elements.indexOf(g),E=null;return S>=0&&(E=b.selection.exportSelection(g,this.options.ownerDocument)),null!==E&&0!==S&&(E.editableElementIndex=S),E},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(g,S){g&&b.selection.importSelection(g,this.elements[g.editableElementIndex||0],this.options.ownerDocument,S)},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(g){var S,E=b.selection.getSelectionElement(this.options.contentWindow),B={};if(-1!==this.elements.indexOf(E)){try{if(this.events.disableCustomEvent("editableInput"),g.url&&b.util.deprecated(".url option for createLink",".value","6.0.0"),(S=g.url||g.value)&&S.trim().length>0){var O=this.options.contentWindow.getSelection();if(O){var I,y,rt,ve,De=O.getRangeAt(0),Bt=De.commonAncestorContainer;if(3===De.endContainer.nodeType&&3!==De.startContainer.nodeType&&0===De.startOffset&&De.startContainer.firstChild===De.endContainer&&(Bt=De.endContainer),y=b.util.getClosestBlockContainer(De.startContainer),rt=b.util.getClosestBlockContainer(De.endContainer),3!==Bt.nodeType&&0!==Bt.textContent.length&&y===rt){var be=y||E,K=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),I=this.exportSelection(),K.appendChild(be.cloneNode(!0)),E===be?b.selection.select(this.options.ownerDocument,be.firstChild,0,be.lastChild,3===be.lastChild.nodeType?be.lastChild.nodeValue.length:be.lastChild.childNodes.length):b.selection.select(this.options.ownerDocument,be,0,be,be.childNodes.length);var wn=this.exportSelection();0===(ve=b.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,K,{start:I.start-wn.start,end:I.end-wn.start,editableElementIndex:I.editableElementIndex})).length&&((K=this.options.ownerDocument.createDocumentFragment()).appendChild(Bt.cloneNode(!0)),ve=[K.firstChild.firstChild,K.firstChild.lastChild]),b.util.createLink(this.options.ownerDocument,ve,S.trim());var ze=(K.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;b.util.insertHTMLCommand(this.options.ownerDocument,K.firstChild.innerHTML.replace(/^\s+/,"")),I.start-=ze,I.end-=ze,this.importSelection(I)}else this.options.ownerDocument.execCommand("createLink",!1,S);this.options.targetBlank||"_blank"===g.target?b.util.setTargetBlank(b.selection.getSelectionStart(this.options.ownerDocument),S):b.util.removeTargetBlank(b.selection.getSelectionStart(this.options.ownerDocument),S),g.buttonClass&&b.util.addClassToAnchors(b.selection.getSelectionStart(this.options.ownerDocument),g.buttonClass)}}if(this.options.targetBlank||"_blank"===g.target||g.buttonClass){(B=this.options.ownerDocument.createEvent("HTMLEvents")).initEvent("input",!0,!0,this.options.contentWindow);for(var Dt=0,ai=this.elements.length;ai>Dt;Dt+=1)this.elements[Dt].dispatchEvent(B)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",B,E)}},cleanPaste:function(g){this.getExtensionByName("paste").cleanPaste(g)},pasteHTML:function(g,S){this.getExtensionByName("paste").pasteHTML(g,S)},setContent:function(g,S){if(this.elements[S=S||0]){var E=this.elements[S];E.innerHTML=g,this.checkContentChanged(E)}},getContent:function(g){return this.elements[g=g||0]?this.elements[g].innerHTML.trim():null},checkContentChanged:function(g){g=g||b.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(g,{target:g,currentTarget:g})},resetContent:function(g){if(g){var S=this.elements.indexOf(g);-1!==S&&this.setContent(wt[g.getAttribute("medium-editor-index")],S)}else this.elements.forEach(function(E,B){this.setContent(wt[E.getAttribute("medium-editor-index")],B)},this)},addElements:function(g){var S=h(g,this.options.ownerDocument,!0);return 0!==S.length&&void S.forEach(function(E){E=si.call(this,E,this.id),this.elements.push(E),this.trigger("addElement",{target:E,currentTarget:E},E)},this)},removeElements:function(g){var E=h(g,this.options.ownerDocument).map(function(B){return B.getAttribute("medium-editor-textarea-id")&&B.parentNode?B.parentNode.querySelector('div[medium-editor-textarea-id="'+B.getAttribute("medium-editor-textarea-id")+'"]'):B});this.elements=this.elements.filter(function(B){return-1===E.indexOf(B)||(this.events.cleanupElement(B),B.getAttribute("medium-editor-textarea-id")&&C(B),this.trigger("removeElement",{target:B,currentTarget:B},B),!1)},this)}},b.getEditorFromElement=function(g){var S=g.getAttribute("data-medium-editor-editor-index"),E=g&&g.ownerDocument&&(g.ownerDocument.defaultView||g.ownerDocument.parentWindow);return E&&E._mediumEditors&&E._mediumEditors[S]?E._mediumEditors[S]:null}}(),b.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0},b.parseVersionString=function(A){var e=A.split("-"),d=e[0].split("."),l=e.length>1?e[1]:"";return{major:parseInt(d[0],10),minor:parseInt(d[1],10),revision:parseInt(d[2],10),preRelease:l,toString:function(){return[d[0],d[1],d[2]].join(".")+(l?"-"+l:"")}}},b.version=b.parseVersionString.call(this,"5.23.3"),b;var A}())}}]);