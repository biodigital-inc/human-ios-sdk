!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var a,n,o=[],r=!0,c=!1;try{for(i=i.call(e);!(r=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(s){c=!0,n=s}finally{try{r||null==i.return||i.return()}finally{if(c)throw n}}return o}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{RmqX:function(i,a,o){"use strict";o.r(a),o.d(a,"SearchModule",(function(){return qe}));var c=o("ofXK"),s=o("tyNb"),l=o("AcyG"),u=o("GCmh"),b=o("XNiG"),h=o("itXk"),p=o("HDdC"),d=o("08/d"),g=o("eKhQ"),f=o("EETq"),m=o("ECVi"),y=o("1G5W"),v=o("pLZG"),k=o("/uUt"),O=o("lJxs"),S=o("zP0r"),j=o("IzEk"),w=o("Zy1z"),C=o("LvDl"),P=o("J9/X"),A=o("AytR"),R=o("p345"),U=o("Lyqc"),I=o("ZR5G"),B=o("ft4l"),T=o("l4YF"),E=o("f3gM"),L=o("3Pt+"),D=o("0IaG"),V=o("a0wz"),x=o("QtmD"),N=o("DTUA"),F=o("QkH1"),M=o("WoAB"),q=o("fXoL"),_=o("dNgK"),z=o("IlST"),$=o("Jk2I"),G=o("XoCC"),W=o("Y8QC"),X=o("QibW"),Q=function(e,t,i,a){var n,o=arguments.length,r=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function Z(e,t){if(1&e&&(q.Tb(0),q.Qb(1,"app-progress",7),q.Vb(2,"div",8),q.Qb(3,"app-spinner",9),q.Pc(4),q.Ub(),q.Sb()),2&e){var i=q.gc();q.Db(1),q.mc("value",i.copyBookmarkPercent),q.Db(3),q.Sc(" Copying ",i.copyBookmarkNumber," of ",i.settings.bookmarks.length," bookmarks. ")}}function H(e,t){if(1&e&&(q.Vb(0,"option",7),q.Pc(1),q.Ub()),2&e){var i=t.$implicit;q.mc("value",i.collection_id),q.Db(1),q.Rc(" ",i.collection_name," ")}}function K(e,t){if(1&e&&(q.Vb(0,"app-form-field",15),q.Vb(1,"select",16),q.Vb(2,"option",7),q.Pc(3,"--"),q.Ub(),q.Nc(4,H,2,2,"option",17),q.hc(5,"async"),q.Ub(),q.Ub()),2&e){var i=q.gc(2);q.Db(2),q.mc("value",null),q.Db(2),q.mc("ngForOf",q.ic(5,2,i.collections$))}}function Y(e,t){if(1&e&&(q.Tb(0),q.Vb(1,"app-form-field",10),q.Vb(2,"mat-radio-group",11),q.Vb(3,"mat-radio-button",12),q.Pc(4,"Team - View Only"),q.Ub(),q.Vb(5,"mat-radio-button",13),q.Pc(6,"Team - View & Edit"),q.Ub(),q.Ub(),q.Ub(),q.Nc(7,K,6,4,"app-form-field",14),q.hc(8,"async"),q.Sb()),2&e){var i,a=q.gc();q.Db(7),q.mc("ngIf",null==(i=q.ic(8,1,a.collections$))?null:i.length)}}function ee(e,t){1&e&&(q.Tb(0),q.Qb(1,"app-spinner",9),q.Pc(2," Adding "),q.Sb())}function te(e,t){1&e&&(q.Tb(0),q.Pc(1," Add "),q.Sb())}var ie,ae,ne,oe,re,ce,se=((ie=function(){function i(e,t,a,o,r,c,s,l){n(this,i),this.store=e,this.actions=t,this.formBuilder=a,this.dialogRef=o,this.snackBar=r,this.storageService=c,this.data=s,this.changeRef=l,this.ngUnsubscribe=new b.a,this.newBookmarkIds=[],this.copyBookmarkNumber=0,this.copyBookmarkPercent=0,this.canAddTeamBookmarks=!1,this.settings=Object.assign({},s);var u=this.store.selectSnapshot(g.a.getOrganization);u&&this.store.dispatch(new V.h(u.id))}return r(i,[{key:"ngOnInit",value:function(){this.initForm(),this.initObservers(),this.initPermissions()}},{key:"ngOnDestroy",value:function(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}},{key:"handleSubmit",value:function(){this.form.valid&&(this.bookmarkIterator=t(this.settings.bookmarks),this.copyNextBookmark())}},{key:"copyNextBookmark",value:function(){var e=this,t=Object(C.last)(this.bookmarkIterator);this.copyBookmarkNumber=this.settings.bookmarks.length-this.bookmarkIterator.length,this.copyBookmarkPercent=(this.copyBookmarkNumber-1)/this.settings.bookmarks.length*100,setTimeout((function(){e.addTeamModel(t)}))}},{key:"handleCopySuccess",value:function(e){this.bookmarkIterator.pop();var t=Object(C.get)(e,"collection.collection_name","Team Library");this.snackBar.open("Added ".concat(e.newBookmark.title," to ").concat(t,".")),this.newBookmarkIds.push(e.newBookmark.id),this.bookmarkIterator.length?this.copyNextBookmark():this.dialogRef.close(this.newBookmarkIds)}},{key:"handleCopyFailure",value:function(e){var t=this,i=this.settings.bookmarks.find((function(t){return t.id===e.id}));1===this.bookmarkIterator.length?this.snackBar.open("Adding ".concat(i.title," to your team library has failed. Please try again.")):(this.snackBar.open("Adding ".concat(i.title," to your team library has failed. Automatically retrying after 2 seconds.")),setTimeout((function(){t.copyNextBookmark()}),2e3))}},{key:"initForm",value:function(){var e=this,t="true"===this.storageService.getLocalItem(N.b.DefaultGroupEdit),i=this.storageService.getLocalItem(N.b.DefaultCollectionId);this.form=this.formBuilder.group({groupEditEnabled:[""+t,L.C.required],collectionId:[i]}),this.form.valueChanges.pipe(Object(y.a)(this.ngUnsubscribe)).subscribe((function(t){var i=t.groupEditEnabled,a=t.collectionId;i?e.storageService.setLocalItem(N.b.DefaultGroupEdit,i):e.storageService.removeLocalItem(N.b.DefaultGroupEdit),a?e.storageService.setLocalItem(N.b.DefaultCollectionId,a):e.storageService.removeLocalItem(N.b.DefaultCollectionId)}))}},{key:"initObservers",value:function(){var e=this;this.actions.pipe(Object(l.l)(U.l),Object(y.a)(this.ngUnsubscribe)).subscribe((function(t){e.handleCopySuccess(t)})),this.actions.pipe(Object(l.l)(U.k),Object(y.a)(this.ngUnsubscribe)).subscribe((function(t){e.handleCopyFailure(t)}))}},{key:"initPermissions",value:function(){var t=this;Object(h.b)([this.userRole$,this.organization$]).pipe(Object(y.a)(this.ngUnsubscribe)).subscribe((function(i){var a=e(i,2),n=a[0],o=a[1];t.canAddTeamBookmarks=!Object(C.isNil)(o)&&F.k(n,M.a.AddTeamBookmarks),t.changeRef.markForCheck()}))}},{key:"addTeamModel",value:function(e){var t=this.form.value,i=t.groupEditEnabled,a=t.collectionId,n=this.store.selectSnapshot(g.a.getOrganization),o=this.store.selectSnapshot(g.a.getCollections),r=this.store.selectSnapshot(m.a.getUserLocale).lang,c=this.canAddTeamBookmarks?{group_id:n.id,member_edit:"true"===i,visible:!0}:void 0,s=this.canAddTeamBookmarks?o.filter((function(e){return""+e.collection_id===a})):void 0;this.store.dispatch(new U.j(e.id,e.title,e.type,r,c,s))}}]),i}()).\u0275fac=function(e){return new(e||ie)(q.Pb(l.h),q.Pb(l.b),q.Pb(L.f),q.Pb(D.g),q.Pb(_.b),q.Pb(N.d),q.Pb(D.a),q.Pb(q.i))},ie.\u0275cmp=q.Jb({type:ie,selectors:[["app-add-team-model-dialog"]],decls:16,vars:14,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"dialog"],[3,"formGroup","submit"],[4,"ngIf"],["mat-dialog-actions","",1,"pt-2"],["app-button","","buttonTheme","light","type","button",1,"mr-2",3,"mat-dialog-close"],["app-button","","buttonType","primary","cdkFocusInitial","",3,"disabled","click"],[3,"value"],[1,"text-14","pt-2","pb-4"],["size","small","render","inline",1,"mr-1"],["theme","light","label","Permissions",1,"mt-2","mb-2"],["formControlName","groupEditEnabled",1,"dialog__radio-group","text-12","mt-2"],["value","false",1,"mb-2"],["value","true"],["label","Collection (Optional)","theme","light","class","mb-2",4,"ngIf"],["label","Collection (Optional)","theme","light",1,"mb-2"],["formControlName","collectionId",1,"input"],[3,"value",4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(q.Vb(0,"h1",0),q.Pc(1,"Add to Team Library"),q.Ub(),q.Vb(2,"div",1),q.Vb(3,"form",2),q.cc("submit",(function(){return t.handleSubmit()})),q.Nc(4,Z,5,3,"ng-container",3),q.hc(5,"async"),q.Nc(6,Y,9,3,"ng-container",3),q.Ub(),q.Ub(),q.Vb(7,"div",4),q.Vb(8,"button",5),q.Pc(9," Cancel "),q.Ub(),q.Vb(10,"button",6),q.cc("click",(function(){return t.handleSubmit()})),q.hc(11,"async"),q.Nc(12,ee,3,0,"ng-container",3),q.hc(13,"async"),q.Nc(14,te,2,0,"ng-container",3),q.hc(15,"async"),q.Ub(),q.Ub()),2&e&&(q.Db(3),q.mc("formGroup",t.form),q.Db(1),q.mc("ngIf",t.settings.bookmarks.length>1&&q.ic(5,6,t.copying$)),q.Db(2),q.mc("ngIf",t.canAddTeamBookmarks),q.Db(4),q.mc("disabled",q.ic(11,8,t.copying$)),q.Db(2),q.mc("ngIf",q.ic(13,10,t.copying$)),q.Db(2),q.mc("ngIf",!q.ic(15,12,t.copying$)))},directives:[D.h,D.e,L.E,L.s,L.j,c.p,D.c,z.a,D.d,$.a,G.a,W.a,X.b,L.r,L.i,X.a,L.B,L.v,L.D,c.o],pipes:[c.b],styles:[".dialog__radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media (min-width:480px){.dialog[_ngcontent-%COMP%]{min-width:380px}}"],changeDetection:0}),Q([Object(l.e)(m.a.getUserRole),J("design:type",p.a)],ie.prototype,"userRole$",void 0),Q([Object(l.e)(g.a.getOrganization),J("design:type",p.a)],ie.prototype,"organization$",void 0),Q([Object(l.e)(g.a.getCollections),J("design:type",p.a)],ie.prototype,"collections$",void 0),Q([Object(l.e)(x.a.getCopying),J("design:type",p.a)],ie.prototype,"copying$",void 0),ie),le=o("5sb6"),ue=o("eqP/"),be=o("+8WF"),he=o("XqAe"),pe=o("PV7u"),de=o("0MNC"),ge=o("c8sk"),fe=o("tgUM"),me=o("ihWl"),ye=o("Mgbk"),ve=o("LRne"),ke=o("uAsG"),Oe=o("Iab2"),Se=o("xo8B"),je=o("PWQe"),we=o("CSvP"),Ce=((ae=function(){function e(t,i,a){n(this,e),this.store=t,this.APP_BASE_URL=i,this.VIEWER_BASE_URL=a}return r(e,[{key:"getStudioSearchConfigFromEmptyRoute",value:function(e){return this.store.select(m.a.getUserProfile).pipe(Object(v.a)(Boolean),Object(j.a)(1),Object(O.a)((function(t){switch(e.data.settings.contentType){case I.a.Module:return new me.a("all");case I.a.Bookmark:var i=Object(C.get)(t,"organizations[0].id");return i?new me.f(i):new me.g;case I.a.Internal:return new me.d}})))}},{key:"getStudioSearchConfigFromRoute",value:function(e){var t=e.queryParams,i=Object(C.get)(t,"categoryId","all"),a=parseInt(Object(C.get)(t,"organizationId",null),10),n=parseInt(Object(C.get)(t,"collectionId",null),10),o=Object(C.get)(t,"type",f.a.Category),r=Object(C.get)(t,"tags","").split("|"),c=Object(C.get)(t,"query",""),s=Object(C.get)(t,"directory","");switch(o){case f.a.Category:return Object(ve.a)(new me.a(i,r,c));case f.a.Community:return Object(ve.a)(new me.c(c,r));case f.a.Private:return Object(ve.a)(new me.g(c,r));case f.a.Collection:return Object(ve.a)(new me.b(a,n,c,r));case f.a.Organization:return Object(ve.a)(new me.f(a,c,r));case f.a.Internal:return Object(ve.a)(new me.d(c,s,r))}}},{key:"getSearchOptionsFromRoute",value:function(e){var t=e.queryParams,i=e.data.settings,a=Object(C.get)(t,"sort","").split("|"),n="true"===Object(C.get)(t,"asc","true"),o=new ye.a("",null),r=fe.c.find((function(e){return Object(C.isEqual)(a,e.fields)&&e.ascending===n}));return Object(C.isNil)(r)&&(r=i.contentType!==I.a.Module&&i.contentType!==I.a.Internal||A.a.application===R.a.Loft?fe.d:fe.e),Object(C.isNil)(r)||(o.sortBy=r),o}},{key:"getLoftSearchConfigFromEmptyRoute",value:function(){return new me.e("production","maleAdult","")}},{key:"getLoftSearchConfigFromRoute",value:function(e){var t=e.queryParams,i=Object(C.get)(t,"primary"),a=Object(C.get)(t,"secondary"),n=Object(C.get)(t,"query","");return i?new me.e(i,a,n):null}},{key:"exportBookmarksToCSV",value:function(){var e,t=this.getCheckedResults(),i=this.store.selectSnapshot(ge.a.getWidgetURL),a=this.store.selectSnapshot(g.a.getWidgetOptions),n=this.store.selectSnapshot(g.a.getAppFeatures),o=n&&n.offlinePkgGen,r=this.store.selectSnapshot(m.a.getUserLanguage),c=this.store.selectSnapshot(m.a.getSelectedUserApp),s=this.store.selectSnapshot(g.a.getCollections),l=null===(e=this.store.selectSnapshot(g.a.getOrganization))||void 0===e?void 0:e.id,u=this.store.selectSnapshot(g.a.getSelectedOrganizationProductAccountId);this.store.dispatch(new U.p(t,l,s,i,r,c,a,o,u))}},{key:"exportModulesToCSV",value:function(){var e=this,i=Object(ke.b)(this.store.selectSnapshot(m.a.getUserProfile)),a=this.getCheckedResults().map((function(t){return Object.assign(Object.assign({title:t.title,specialty:Object(C.get)(Object(Se.c)(t),"title",""),category:Object(C.get)(Object(Se.b)(t),"title",""),viewer:"".concat(e.VIEWER_BASE_URL,"/?id=").concat(t.id)},i?{viewer:"".concat(e.VIEWER_BASE_URL,"/?id=").concat(t.id)}:{}),{app:"".concat(e.APP_BASE_URL,"/view?id=").concat(t.id),animated:t.animated?"yes":"no",tour:t.tour?"yes":"no",created:t.create_date_time})})),n=[{label:"Model Title",field:"title"},{label:"Specialty",field:"specialty"},{label:"Category",field:"category"}].concat(t(i?[{label:"Human Viewer Link",field:"viewer"}]:[]),[{label:"Web App Link",field:"app"},{label:"Animated",field:"animated"},{label:"Tour",field:"tour"},{label:"Created Date",field:"created"}]);Object(je.a)(a,n).subscribe((function(e){var t="BioDigital-Library-".concat((new Date).toISOString().split("T")[0],".csv"),i=new Blob([e],{type:"text/csv;charset=utf-8"});Object(Oe.saveAs)(i,t)}))}},{key:"getCheckedResults",value:function(){var e=this.store.selectSnapshot(u.a.getAllResults),t=this.store.selectSnapshot(u.a.getCheckedResults);return e.items.filter((function(e){return t.some((function(t){return e.id===t}))}))}}]),e}()).\u0275fac=function(e){return new(e||ae)(q.Zb(l.h),q.Zb(we.a),q.Zb(we.c))},ae.\u0275prov=q.Lb({token:ae,factory:ae.\u0275fac,providedIn:"root"}),ae),Pe=o("u47x"),Ae=o("TRdv"),Re=function(e,t,i,a){var n,o=arguments.length,r=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(r=(o<3?n(r):o>3?n(t,i,r):n(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},Ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ie=((ne=function(){function i(e,t,a,o,r,c,s,l,u,h,p,g){n(this,i),this.actions=e,this.activatedRoute=t,this.bookmarksService=a,this.bookmarkActionsService=o,this.breakpointObserver=r,this.router=c,this.searchService=s,this.dialog=l,this.store=u,this.location=h,this.urlSerializer=p,this.liveAnnouncer=g,this.categories=d.a.categories,this.application=A.a.application,this.environmentApplication=R.a,this.ngUnsubscribe=new b.a}return r(i,[{key:"ngOnInit",value:function(){var e=this;this.searchSettings=this.activatedRoute.snapshot.data.settings,this.activatedRoute.queryParams.pipe(Object(y.a)(this.ngUnsubscribe)).subscribe((function(){(e.activatedRoute.snapshot.queryParamMap.has("primary")?e.searchLoftFromRoute:e.searchStudioFromRoute).call(e,e.activatedRoute.snapshot)})),this.store.dispatch(new P.a.SetCardActions({enabled:!0})),this.updateSidenavEnabled(this.searchSettings),this.keepRouteUpdated(),this.observeActionResults(),this.keepBulkActionsUpdated(),this.initAccessibilty()}},{key:"ngOnDestroy",value:function(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.store.dispatch(new P.a.Reset)}},{key:"initAccessibilty",value:function(){var t=this;Object(h.b)([this.store.select(u.a.getFilteredResults),this.store.select(u.a.getSearchConfig),this.store.select(u.a.getLoading),Object(ue.a)(this.store)]).pipe(Object(v.a)((function(t){var i=e(t,3),a=i[0],n=i[1],o=i[2];return!Object(C.isNil)(a)&&!Object(C.isNil)(n)&&!o})),Object(k.a)((function(e,t){return Object(C.isEqual)(e[0],t[0])})),Object(y.a)(this.ngUnsubscribe)).subscribe((function(i){var a=e(i,4),n=a[0],o=a[1],r=(a[2],a[3]),c=n.total,s=n.items,l=o.query,u=[];u.push(0===c?"No results found":c===s.length?"Showing ".concat(c," results"):"Showing ".concat(s.length," of ").concat(c," results")),u.push(l?'for search, "'.concat(l,'"'):'for category, "'.concat(r,'"'));var b=u.join(" ")+".";t.liveAnnouncer.announce(b)})),this.actions.pipe(Object(l.l)(P.a.CheckAll),Object(O.a)((function(){return t.store.selectSnapshot(u.a.getCheckedResults)})),Object(y.a)(this.ngUnsubscribe)).subscribe((function(e){t.liveAnnouncer.announce(e.length+" models selected.")})),this.actions.pipe(Object(l.l)(P.a.UncheckAll),Object(y.a)(this.ngUnsubscribe)).subscribe((function(){t.liveAnnouncer.announce("Model selections cleared.")})),this.viewMode$.pipe(Object(k.a)((function(e,t){return Object(C.isEqual)(e,t)})),Object(S.a)(1),Object(y.a)(this.ngUnsubscribe)).subscribe((function(e){t.liveAnnouncer.announce("Gallery view mode updated to ".concat(e===be.a.Card?"Card":"List"," View."))}))}},{key:"searchStudioFromRoute",value:function(e){var t=this;(Object(C.isEmpty)(e.queryParams)?this.searchService.getStudioSearchConfigFromEmptyRoute(e):this.searchService.getStudioSearchConfigFromRoute(e)).pipe(Object(j.a)(1)).subscribe((function(i){var a=t.searchService.getSearchOptionsFromRoute(e);t.store.dispatch(new P.a.SetSearchOptions(a)),i&&t.store.dispatch(new P.a.SetSearchConfig(i))}))}},{key:"searchLoftFromRoute",value:function(e){var t=Object(C.isEmpty)(e.queryParams)?this.searchService.getLoftSearchConfigFromEmptyRoute():this.searchService.getLoftSearchConfigFromRoute(e),i=this.searchService.getSearchOptionsFromRoute(e);this.store.dispatch(new P.a.SetSearchOptions(i)),this.store.dispatch(new P.a.SetSearchConfig(t))}},{key:"updateSidenavEnabled",value:function(e){var t=this;e.application===R.a.Studio&&e.contentType===I.a.Bookmark&&this.store.select(m.a.isPrivateUser).pipe(Object(v.a)((function(e){return null!==e})),Object(y.a)(this.ngUnsubscribe)).subscribe((function(e){var i=t.store.selectSnapshot(u.a.getSidenav);t.store.dispatch(new P.a.SetSidenav(Object.assign(Object.assign({},i),{enabled:!e})))}))}},{key:"keepRouteUpdated",value:function(){var t=this;Object(h.b)(this.store.select(u.a.getSearchConfig),this.store.select(u.a.getSearchOptions)).pipe(Object(v.a)((function(t){var i=e(t,2),a=i[0],n=i[1];return!Object(C.isNil)(a)&&!Object(C.isNil)(n)})),Object(k.a)((function(e,t){return Object(C.isEqual)(e,t)})),Object(w.a)(),Object(y.a)(this.ngUnsubscribe)).subscribe((function(i){var a=e(i,2),n=e(a[0],1)[0],o=e(a[1],2),r=o[0],c=o[1],s=t.getUrlTree(r,c),l=Object(C.isEqual)(Object(C.omit)(n,["query"]),Object(C.omit)(r,["query"]));t.router.navigateByUrl(t.router.serializeUrl(s),{skipLocationChange:l}),l&&t.replaceLocationState()}))}},{key:"observeActionResults",value:function(){var e=this;this.actions.pipe(Object(l.l)(U.B,U.o,U.e,U.l),Object(y.a)(this.ngUnsubscribe)).subscribe((function(t){e.store.dispatch(new P.a.SearchStudio)}))}},{key:"keepBulkActionsUpdated",value:function(){var t=this;Object(h.b)([this.breakpointObserver.observe("(max-width: 959px)"),this.userProfile$,this.searchConfig$]).pipe(Object(y.a)(this.ngUnsubscribe),Object(v.a)((function(t){var i=e(t,3)[2];return!Object(C.isNil)(i)}))).subscribe((function(i){var a=e(i,3)[2];a&&t.updateBulkActions(a)}))}},{key:"updateBulkActions",value:function(e){var i,a,n,o=new T.a;switch(o.active=!1,e.type){case f.a.Private:case f.a.Organization:case f.a.Collection:case f.a.Category:i=this.store.selectSnapshot(m.a.getUserRole),a=this.store.selectSnapshot(m.a.isPremiumUser),n=F.g(i,a)?[B.a.ExportCSV]:[],o.enabled=!0,o.items=t(n),e.type===f.a.Category&&"true"===localStorage.getItem("bulkAdd")&&o.items.push(B.a.AddToTeamLibrary),e.type!==f.a.Collection&&e.type!==f.a.Organization&&e.type!==f.a.Private||"true"!==localStorage.getItem("bulkDelete")||o.items.push(B.a.Delete);break;default:o.enabled=!1}(A.a.platform!==E.a.Web||this.breakpointObserver.isMatched("(max-width: 959px)"))&&(o.enabled=!1),this.store.dispatch(new P.a.SetBulkActions(o))}},{key:"handleBulkAction",value:function(e){var t=e.name,i=this.store.selectSnapshot(u.a.getSearchConfig);switch(t){case B.a.ExportCSV:i.type===f.a.Category?this.searchService.exportModulesToCSV():this.searchService.exportBookmarksToCSV();break;case B.a.AddToTeamLibrary:if(i.type===f.a.Category){var a=this.store.selectSnapshot(u.a.getAllResults),n=this.store.selectSnapshot(u.a.getCheckedResults).map((function(e){return a.items.find((function(t){return t.id===e}))}));this.dialog.open(se,{id:le.a.AddTeamModelDialog,data:{bookmarks:n}})}break;case B.a.Delete:if(i.type===f.a.Collection||i.type===f.a.Organization||i.type===f.a.Private){var o=this.store.selectSnapshot(u.a.getCheckedResults);this.store.dispatch(new U.c(o));break}}}},{key:"handleView",value:function(e){this.bookmarkActionsService.view(e)}},{key:"replaceLocationState",value:function(){var e=this.store.selectSnapshot(u.a.getSearchConfig),t=this.store.selectSnapshot(u.a.getSearchOptions),i=this.getUrlTree(e,t),a=this.urlSerializer.serialize(i);this.location.replaceState(a)}},{key:"getUrlTree",value:function(t,i){var a=window.location.pathname,n=Object(C.get)(i,"sortBy.fields",[]).join("|"),o=Object(C.get)(i,"sortBy.ascending",!0),r={};n.length&&(r.sort=n,r.asc=o);var c={tags:Object(C.compact)(Object(C.get)(t,"tags",[])).join("|")},s=Object.entries(Object.assign(Object.assign(Object.assign({},t),c),r)).reduce((function(i,a){var n=e(a,2),o=n[0],r=n[1];return null!==r&&""!==r&&(i[o]=r),t.type===f.a.Loft&&(["primary","secondary","query"].includes(o)||delete i[o]),i}),{});return this.router.createUrlTree([a],{queryParams:s})}}]),i}()).\u0275fac=function(e){return new(e||ne)(q.Pb(l.b),q.Pb(s.a),q.Pb(he.a),q.Pb(pe.a),q.Pb(de.a),q.Pb(s.e),q.Pb(Ce),q.Pb(D.b),q.Pb(l.h),q.Pb(c.k),q.Pb(s.k),q.Pb(Pe.i))},ne.\u0275cmp=q.Jb({type:ne,selectors:[["app-search-page"]],decls:2,vars:3,consts:[[1,"search-page"],[3,"application","contentType","showSourcePicker","bulkAction","selectBookmark"]],template:function(e,t){1&e&&(q.Vb(0,"div",0),q.Vb(1,"app-gallery-container",1),q.cc("bulkAction",(function(e){return t.handleBulkAction(e)}))("selectBookmark",(function(e){return t.handleView(e)})),q.Ub(),q.Ub()),2&e&&(q.Db(1),q.mc("application",t.searchSettings.application)("contentType",t.searchSettings.contentType)("showSourcePicker",t.application===t.environmentApplication.Loft))},directives:[Ae.a],styles:[".search-page[_ngcontent-%COMP%]{min-height:100%;display:flex}"],changeDetection:0}),Re([Object(l.e)(u.a.getFilteredResults),Ue("design:type",p.a)],ne.prototype,"results$",void 0),Re([Object(l.e)(u.a.getSearchConfig),Ue("design:type",p.a)],ne.prototype,"searchConfig$",void 0),Re([Object(l.e)(m.a.getUserProfile),Ue("design:type",p.a)],ne.prototype,"userProfile$",void 0),Re([Object(l.e)(g.a.getOrganization),Ue("design:type",p.a)],ne.prototype,"organization$",void 0),Re([Object(l.e)(g.a.getCollections),Ue("design:type",p.a)],ne.prototype,"collections$",void 0),Re([Object(l.e)(u.a.getViewMode),Ue("design:type",p.a)],ne.prototype,"viewMode$",void 0),ne),Be=o("uZ1g"),Te=o("P+IX"),Ee=((oe=function(){function e(){n(this,e)}return r(e,[{key:"resolve",value:function(e){var t;switch(e.routeConfig.path){case"bookmarks":t=I.a.Bookmark;break;case"modules":t=I.a.Module;break;case"internal":t=I.a.Internal}return{application:A.a.application,contentType:t}}}]),e}()).\u0275fac=function(e){return new(e||oe)},oe.\u0275prov=q.Lb({token:oe,factory:oe.\u0275fac}),oe),Le=o("mmXA"),De=[{path:"",component:Be.a,canActivate:[Te.a],data:{fixedHeight:!0,overflowFix:!0,siteHeaderType:Le.a.Search},children:[{path:"modules",resolve:{settings:Ee},component:Ie,data:{title:"Explore"}},{path:"bookmarks",resolve:{settings:Ee},component:Ie,data:{title:"My Library"}},{path:"internal",resolve:{settings:Ee},component:Ie}]}],Ve=((re=function e(){n(this,e)}).\u0275mod=q.Nb({type:re}),re.\u0275inj=q.Mb({factory:function(e){return new(e||re)},imports:[[s.i.forChild(De)],s.i]}),re),xe=o("3ros"),Ne=o("Tx//"),Fe=o("vvyD"),Me=o("+dkL"),qe=((ce=function e(){n(this,e)}).\u0275mod=q.Nb({type:ce}),ce.\u0275inj=q.Mb({factory:function(e){return new(e||ce)},providers:[Ee],imports:[[c.c,Ne.a,Ve,xe.a,Fe.a,Me.a]]}),ce)}}])}();