/*!
 * BioDigital Human RPC Messaging Client
 * V3.0.0
 * Built on 2023-10-12
 * Copyright 2023, BioDigital, Inc.
 */(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{G:()=>s});class t{iframe;destroyed=!1;handle=Date.now();subs={};connected=!1;messageBuffer=[];constructor(e){if(!e.iframeId)throw"Config expected: iframeId";const t=document.getElementById(e.iframeId);if(!t)throw`Element not found: '${e.iframeId}'`;if(!(t instanceof HTMLIFrameElement))throw`Element is not an iframe: '${e.iframeId}'`;this.iframe=t,this.connect(e)}destroy(){this.destroyed=!0}call(e,t,n,i){const o={call:e,params:t,ok:n,once:i,version:s};this.connected?this.send(o,n,i):this.messageBuffer.unshift(o)}connect(e){let t=null;const s=()=>{n(),t=window.setInterval((()=>{!this.destroyed&&this.iframe&&this.iframe.contentWindow?this.iframe.contentWindow.postMessage(JSON.stringify({action:"connect"}),"*"):n()}),100)},n=()=>{t&&(clearInterval(t),t=null)};window.addEventListener("message",(t=>{if("unsupported"===t.data)"function"==typeof e.onUnsupported&&e.onUnsupported();else{let s;try{s=JSON.parse(t.data)}catch(e){return}if(s.message){const t=s.message,i=s.status;"connected"===t?(this.connected=!0,this.sendQueuedMessages(),"function"==typeof e.onConnected&&e.onConnected()):"status"===t&&"ready"===i&&(n(),"function"==typeof e.onReady&&e.onReady())}if(s.results||s.response){const e=s.results||s.response;for(const t in e){const s=e[t];this.subs[t]&&this.set(t,s)}}s.error}})),this.iframe.addEventListener("load",s),this.iframe.addEventListener("unload",n),s()}sendQueuedMessages(){for(;this.messageBuffer.length>0;){const e=this.messageBuffer.pop();e&&this.send(e,e.ok,e.once)}}send(e,t,s){if(t){const n=this.on((e=>{void 0!==s&&!0!==s||this.off(n),t.call(this,e)}));e.id=n,this.sendMessage(e)}else this.sendMessage(e)}sendMessage(e){this.iframe.contentWindow&&this.iframe.contentWindow.postMessage(JSON.stringify(e),"*")}set(e,t){const s=this.subs[e];s&&s.call(this,t)}on(e){return this.handle++,this.subs[this.handle]=e,this.handle}off(e){delete this.subs[e]}}const s="3.0.0";window.HumanAPI=class{static VERSION=s;ready=!1;rpc;readyCallbacks=[];constructor(e){"string"==typeof e&&(e={iframeId:e}),e.onReady=()=>{this.ready=!0;for(let e=0;e<this.readyCallbacks.length;e++)this.readyCallbacks[e]();this.readyCallbacks.length=0},this.rpc=new t(e)}send(e,t={},s){return"function"==typeof t&&(s=t,t={}),"function"==typeof s&&(s=s.bind(this)),this.rpc.call(e,t,s),this}on(e,t){return this.handleEvent(e,t,!1),this}once(e,t){return this.handleEvent(e,t,!0),this}handleEvent(e,t,s){if("function"==typeof t&&(t=t.bind(this)),"human.ready"===e)return this.ready?t():this.readyCallbacks.push(t),this;const n=s?"apiEvents.once":"apiEvents.on";this.rpc.call(n,e,t,s)}}})();